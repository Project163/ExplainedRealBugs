diff --git a/maven-archiver/pom.xml b/maven-archiver/pom.xml
index a591ae44..e1785508 100644
--- a/maven-archiver/pom.xml
+++ b/maven-archiver/pom.xml
@@ -74,6 +74,11 @@
         </exclusion>
       </exclusions>
     </dependency>
+    <dependency>
+      <groupId>org.apache.maven</groupId>
+      <artifactId>maven-core</artifactId>
+      <version>${mavenVersion}</version>
+    </dependency>
     <dependency>
       <groupId>org.codehaus.plexus</groupId>
       <artifactId>plexus-archiver</artifactId>
diff --git a/maven-archiver/src/main/java/org/apache/maven/archiver/MavenArchiver.java b/maven-archiver/src/main/java/org/apache/maven/archiver/MavenArchiver.java
index 5f9da498..93a626b6 100644
--- a/maven-archiver/src/main/java/org/apache/maven/archiver/MavenArchiver.java
+++ b/maven-archiver/src/main/java/org/apache/maven/archiver/MavenArchiver.java
@@ -21,6 +21,7 @@ package org.apache.maven.archiver;
 
 import org.apache.maven.artifact.Artifact;
 import org.apache.maven.artifact.DependencyResolutionRequiredException;
+import org.apache.maven.execution.MavenSession;
 import org.apache.maven.project.MavenProject;
 import org.codehaus.plexus.archiver.ArchiverException;
 import org.codehaus.plexus.archiver.jar.JarArchiver;
@@ -85,13 +86,20 @@ public class MavenArchiver
      * Return a pre-configured manifest
      *
      * @todo Add user attributes list and user groups list
+     * @deprecated
      */
     public Manifest getManifest( MavenProject project, MavenArchiveConfiguration config )
         throws ManifestException, DependencyResolutionRequiredException
+    {
+        return getManifest( null, project, config );
+    }
+
+    public Manifest getManifest( MavenSession session, MavenProject project, MavenArchiveConfiguration config )
+        throws ManifestException, DependencyResolutionRequiredException
     {
         boolean hasManifestEntries = !config.isManifestEntriesEmpty();
         Map<String, String> entries = hasManifestEntries ? config.getManifestEntries() : Collections.EMPTY_MAP;
-        Manifest manifest = getManifest( project, config.getManifest(), entries );
+        Manifest manifest = getManifest( session, project, config.getManifest(), entries );
 
         // any custom manifest entries in the archive configuration manifest?
         if ( hasManifestEntries )
@@ -152,7 +160,13 @@ public class MavenArchiver
     public Manifest getManifest( MavenProject project, ManifestConfiguration config )
         throws ManifestException, DependencyResolutionRequiredException
     {
-        return getManifest( project, config, Collections.<String, String>emptyMap() );
+        return getManifest( null, project, config, Collections.<String, String>emptyMap() );
+    }
+
+    public Manifest getManifest( MavenSession mavenSession, MavenProject project, ManifestConfiguration config )
+        throws ManifestException, DependencyResolutionRequiredException
+    {
+        return getManifest( mavenSession, project, config, Collections.<String, String>emptyMap() );
     }
 
     private void addManifestAttribute( Manifest manifest, Map<String, String> map, String key, String value )
@@ -182,14 +196,15 @@ public class MavenArchiver
         }
     }
 
-    protected Manifest getManifest( MavenProject project, ManifestConfiguration config, Map<String, String> entries )
+    protected Manifest getManifest( MavenSession session, MavenProject project, ManifestConfiguration config,
+                                    Map<String, String> entries )
         throws ManifestException, DependencyResolutionRequiredException
     {
         // TODO: Should we replace "map" with a copy? Note, that we modify it!
 
         // Added basic entries
         Manifest m = new Manifest();
-        addManifestAttribute( m, entries, "Created-By", "Apache Maven" );
+        addCreatedByEntry( session, m, entries );
 
         addCustomEntries( m, entries, config );
 
@@ -459,8 +474,18 @@ public class MavenArchiver
         archiveFile = outputFile;
     }
 
+    /**
+     * @deprecated
+     */
     public void createArchive( MavenProject project, MavenArchiveConfiguration archiveConfiguration )
         throws ArchiverException, ManifestException, IOException, DependencyResolutionRequiredException
+    {
+        createArchive( null, project, archiveConfiguration );
+    }
+
+    public void createArchive( MavenSession session, MavenProject project,
+                               MavenArchiveConfiguration archiveConfiguration )
+        throws ArchiverException, ManifestException, IOException, DependencyResolutionRequiredException
     {
         // we have to clone the project instance so we can write out the pom with the deployment version,
         // without impacting the main project instance...
@@ -516,7 +541,7 @@ public class MavenArchiver
             archiver.setManifest( manifestFile );
         }
 
-        Manifest manifest = getManifest( workingProject, archiveConfiguration );
+        Manifest manifest = getManifest( session, workingProject, archiveConfiguration );
 
         // Configure the jar
         archiver.addConfiguredManifest( manifest );
@@ -549,6 +574,21 @@ public class MavenArchiver
         archiver.createArchive();
     }
 
+    private void addCreatedByEntry( MavenSession session, Manifest m, Map entries )
+        throws ManifestException
+    {
+        String createdBy = "Apache Maven";
+        if ( session != null ) // can be null due to API backwards compatibility
+        {
+            String mavenVersion = session.getExecutionProperties().getProperty( "maven.version" );
+            if ( mavenVersion != null )
+            {
+                createdBy += " " + mavenVersion;
+            }
+        }
+        addManifestAttribute( m, entries, "Created-By", createdBy );
+    }
+
 
     private Artifact findArtifactWithFile( Set artifacts, File file )
     {
diff --git a/maven-archiver/src/test/java/org/apache/maven/archiver/MavenArchiverTest.java b/maven-archiver/src/test/java/org/apache/maven/archiver/MavenArchiverTest.java
index 7edff116..ceaa2b8c 100644
--- a/maven-archiver/src/test/java/org/apache/maven/archiver/MavenArchiverTest.java
+++ b/maven-archiver/src/test/java/org/apache/maven/archiver/MavenArchiverTest.java
@@ -19,35 +19,42 @@ package org.apache.maven.archiver;
  * under the License.
  */
 
+import junit.framework.TestCase;
+import org.apache.maven.artifact.Artifact;
+import org.apache.maven.artifact.handler.ArtifactHandler;
+import org.apache.maven.artifact.handler.DefaultArtifactHandler;
+import org.apache.maven.artifact.repository.ArtifactRepository;
+import org.apache.maven.execution.MavenSession;
+import org.apache.maven.execution.ReactorManager;
+import org.apache.maven.model.Build;
+import org.apache.maven.model.Model;
+import org.apache.maven.model.Organization;
+import org.apache.maven.monitor.event.EventDispatcher;
+import org.apache.maven.project.MavenProject;
+import org.apache.maven.settings.Settings;
+import org.codehaus.plexus.PlexusContainer;
+import org.codehaus.plexus.archiver.jar.JarArchiver;
+import org.codehaus.plexus.archiver.jar.Manifest;
+import org.codehaus.plexus.util.FileUtils;
+import org.codehaus.plexus.util.StringUtils;
+
 import java.io.File;
 import java.net.URI;
 import java.net.URL;
 import java.util.ArrayList;
 import java.util.Collections;
 import java.util.Comparator;
+import java.util.Date;
 import java.util.HashMap;
 import java.util.Iterator;
 import java.util.List;
 import java.util.Map;
+import java.util.Properties;
 import java.util.Set;
 import java.util.TreeSet;
 import java.util.jar.Attributes;
 import java.util.jar.JarFile;
 
-import junit.framework.TestCase;
-
-import org.apache.maven.artifact.Artifact;
-import org.apache.maven.artifact.handler.ArtifactHandler;
-import org.apache.maven.artifact.handler.DefaultArtifactHandler;
-import org.apache.maven.model.Build;
-import org.apache.maven.model.Model;
-import org.apache.maven.model.Organization;
-import org.apache.maven.project.MavenProject;
-import org.codehaus.plexus.archiver.jar.JarArchiver;
-import org.codehaus.plexus.archiver.jar.Manifest;
-import org.codehaus.plexus.util.FileUtils;
-import org.codehaus.plexus.util.StringUtils;
-
 public class MavenArchiverTest
     extends TestCase
 {
@@ -70,6 +77,8 @@ public class MavenArchiverTest
     {
         MavenArchiver archiver = new MavenArchiver();
 
+        MavenSession session = getDummySession();
+
         Model model = new Model();
         model.setArtifactId( "dummy" );
 
@@ -89,7 +98,7 @@ public class MavenArchiverTest
 
         Manifest manifest;
 
-        manifest = archiver.getManifest( project, config );
+        manifest = archiver.getManifest( session, project, config );
 
         assertNotNull( manifest.getMainSection() );
 
@@ -111,7 +120,7 @@ public class MavenArchiverTest
 
         artifacts.add( artifact1 );
 
-        manifest = archiver.getManifest( project, config );
+        manifest = archiver.getManifest( session, project, config );
 
         assertEquals( null, manifest.getMainSection().getAttributeValue( "Extension-List" ) );
 
@@ -124,7 +133,7 @@ public class MavenArchiverTest
 
         artifacts.add( artifact2 );
 
-        manifest = archiver.getManifest( project, config );
+        manifest = archiver.getManifest( session, project, config );
 
         assertEquals( "dummy2", manifest.getMainSection().getAttributeValue( "Extension-List" ) );
 
@@ -137,7 +146,7 @@ public class MavenArchiverTest
 
         artifacts.add( artifact3 );
 
-        manifest = archiver.getManifest( project, config );
+        manifest = archiver.getManifest( session, project, config );
 
         assertEquals( "dummy2", manifest.getMainSection().getAttributeValue( "Extension-List" ) );
 
@@ -150,7 +159,7 @@ public class MavenArchiverTest
 
         artifacts.add( artifact4 );
 
-        manifest = archiver.getManifest( project, config );
+        manifest = archiver.getManifest( session, project, config );
 
         assertEquals( "dummy2 dummy4", manifest.getMainSection().getAttributeValue( "Extension-List" ) );
     }
@@ -164,6 +173,8 @@ public class MavenArchiverTest
         {
             MavenArchiver archiver = new MavenArchiver();
 
+            MavenSession session = getDummySession();
+
             Model model = new Model();
             model.setArtifactId( "dummy" );
 
@@ -188,9 +199,10 @@ public class MavenArchiverTest
             archiveConfiguration.setManifest( manifestConfig );
             archiveConfiguration.addManifestEntry( "Class-Path", "help/" );
 
-            Manifest manifest = archiver.getManifest( project, archiveConfiguration );
+            Manifest manifest = archiver.getManifest( session, project, archiveConfiguration );
             String classPath = manifest.getMainSection().getAttribute( "Class-Path" ).getValue();
-            assertTrue( "User specified Class-Path entry was not added to manifest", classPath.indexOf( "help/" ) != -1 );
+            assertTrue( "User specified Class-Path entry was not added to manifest",
+                        classPath.indexOf( "help/" ) != -1 );
             assertTrue( "Class-Path generated by addClasspath was not added to manifest",
                         classPath.indexOf( tempFile.getName() ) != -1 );
         }
@@ -198,7 +210,6 @@ public class MavenArchiverTest
         {
             tempFile.delete();
         }
-
     }
 
     public void testRecreation()
@@ -214,13 +225,14 @@ public class MavenArchiverTest
         archiver.setArchiver( jarArchiver );
         archiver.setOutputFile( jarArchiver.getDestFile() );
 
+        MavenSession session = getDummySession();
         MavenProject project = getDummyProject();
 
         MavenArchiveConfiguration config = new MavenArchiveConfiguration();
         config.setForced( false );
 
         FileUtils.deleteDirectory( "target/maven-archiver" );
-        archiver.createArchive( project, config );
+        archiver.createArchive( session, project, config );
         assertTrue( jarFile.exists() );
         jarFile.setLastModified( System.currentTimeMillis() - 60000L );
         long time = jarFile.lastModified();
@@ -232,11 +244,11 @@ public class MavenArchiverTest
             f.setLastModified( time );
         }
 
-        archiver.createArchive( project, config );
+        archiver.createArchive( session, project, config );
         assertEquals( jarFile.lastModified(), time );
 
         config.setForced( true );
-        archiver.createArchive( project, config );
+        archiver.createArchive( session, project, config );
         assertTrue( jarFile.lastModified() > time );
     }
 
@@ -256,12 +268,13 @@ public class MavenArchiverTest
             archiver.setArchiver( jarArchiver );
             archiver.setOutputFile( jarArchiver.getDestFile() );
 
+            MavenSession session = getDummySession();
             MavenProject project = getDummyProject();
 
             MavenArchiveConfiguration config = new MavenArchiveConfiguration();
             config.setForced( true );
             config.getManifest().setAddDefaultImplementationEntries( false );
-            archiver.createArchive( project, config );
+            archiver.createArchive( session, project, config );
             assertTrue( jarFile.exists() );
 
             jar = new JarFile( jarFile );
@@ -294,14 +307,16 @@ public class MavenArchiverTest
             archiver.setArchiver( jarArchiver );
             archiver.setOutputFile( jarArchiver.getDestFile() );
 
+            MavenSession session = getDummySession();
             MavenProject project = getDummyProject();
+
             String ls = System.getProperty( "line.separator" );
             project.setDescription( "foo " + ls + " bar " );
             MavenArchiveConfiguration config = new MavenArchiveConfiguration();
             config.setForced( true );
             config.getManifest().setAddDefaultImplementationEntries( true );
             config.addManifestEntry( "Description", project.getDescription() );
-            archiver.createArchive( project, config );
+            archiver.createArchive( session, project, config );
             assertTrue( jarFile.exists() );
 
             jar = new JarFile( jarFile );
@@ -337,7 +352,9 @@ public class MavenArchiverTest
             archiver.setArchiver( jarArchiver );
             archiver.setOutputFile( jarArchiver.getDestFile() );
 
+            MavenSession session = getDummySession();
             MavenProject project = getDummyProject();
+
             String ls = System.getProperty( "line.separator" );
             project.setDescription( "foo " + ls + " bar " );
             MavenArchiveConfiguration config = new MavenArchiveConfiguration();
@@ -346,7 +363,7 @@ public class MavenArchiverTest
             config.addManifestEntry( "Description", project.getDescription() );
             // config.addManifestEntry( "EntryWithTab", " foo tab " + ( '\u0009' ) + ( '\u0009' ) + " bar tab" + (
             // '\u0009' ) );
-            archiver.createArchive( project, config );
+            archiver.createArchive( session, project, config );
             assertTrue( jarFile.exists() );
 
             jar = new JarFile( jarFile );
@@ -368,6 +385,58 @@ public class MavenArchiverTest
         }
     }
 
+    public void testDeprecatedCreateArchiveAPI()
+        throws Exception
+    {
+        JarFile jar = null;
+        try
+        {
+            File jarFile = new File( "target/test/dummy.jar" );
+            jarFile.delete();
+            assertFalse( jarFile.exists() );
+            JarArchiver jarArchiver = new JarArchiver();
+            jarArchiver.setDestFile( jarFile );
+
+            MavenArchiver archiver = new MavenArchiver();
+            archiver.setArchiver( jarArchiver );
+            archiver.setOutputFile( jarArchiver.getDestFile() );
+
+            MavenProject project = getDummyProject();
+            MavenArchiveConfiguration config = new MavenArchiveConfiguration();
+            config.setForced( true );
+            config.getManifest().setAddDefaultImplementationEntries( true );
+            config.getManifest().setAddDefaultSpecificationEntries( true );
+
+            archiver.createArchive( project, config );
+            assertTrue( jarFile.exists() );
+            jar = new JarFile( jarFile );
+
+            Attributes manifest = jar.getManifest().getMainAttributes();
+
+            assertEquals( "Apache Maven", manifest.get( new Attributes.Name( "Created-By" ) ) ); // no version number
+
+            assertEquals( "archiver test", manifest.get( Attributes.Name.SPECIFICATION_TITLE ) );
+            assertEquals( "0.1", manifest.get( Attributes.Name.SPECIFICATION_VERSION ) );
+            assertEquals( "Apache", manifest.get( Attributes.Name.SPECIFICATION_VENDOR ) );
+
+            assertEquals( "archiver test", manifest.get( Attributes.Name.IMPLEMENTATION_TITLE ) );
+            assertEquals( "0.1", manifest.get( Attributes.Name.IMPLEMENTATION_VERSION ) );
+            assertEquals( "org.apache.dummy", manifest.get( Attributes.Name.IMPLEMENTATION_VENDOR_ID ) );
+            assertEquals( "Apache", manifest.get( Attributes.Name.IMPLEMENTATION_VENDOR ) );
+
+            assertEquals( System.getProperty( "java.version" ), manifest.get( new Attributes.Name( "Build-Jdk" ) ) );
+            assertEquals( System.getProperty( "user.name" ), manifest.get( new Attributes.Name( "Built-By" ) ) );
+        }
+        finally
+        {
+            // cleanup streams
+            if ( jar != null )
+            {
+                jar.close();
+            }
+        }
+    }
+
     public void testManifestEntries()
         throws Exception
     {
@@ -384,6 +453,7 @@ public class MavenArchiverTest
             archiver.setArchiver( jarArchiver );
             archiver.setOutputFile( jarArchiver.getDestFile() );
 
+            MavenSession session = getDummySession();
             MavenProject project = getDummyProject();
             MavenArchiveConfiguration config = new MavenArchiveConfiguration();
             config.setForced( true );
@@ -403,28 +473,24 @@ public class MavenArchiverTest
             manifestSections.add( manifestSection );
             config.setManifestSections( manifestSections );
             config.getManifest().setMainClass( "org.apache.maven.Foo" );
-            archiver.createArchive( project, config );
+            archiver.createArchive( session, project, config );
             assertTrue( jarFile.exists() );
             jar = new JarFile( jarFile );
 
             Attributes manifest = jar.getManifest().getMainAttributes();
 
-            assertEquals( "Apache Maven", manifest.get( new Attributes.Name( "Created-By" ) ) );
-            assertEquals( "archiver test", manifest.get( Attributes.Name.SPECIFICATION_TITLE ) );// "Specification-Title"
-            // ) );
-            assertEquals( "0.1", manifest.get( Attributes.Name.SPECIFICATION_VERSION ) );// "Specification-Version" ) );
-            assertEquals( "Apache", manifest.get( Attributes.Name.SPECIFICATION_VENDOR ) );// "Specification-Vendor" )
-            // );
-
-            assertEquals( "archiver test", manifest.get( Attributes.Name.IMPLEMENTATION_TITLE ) );// "Implementation-Title"
-            // ) );
-            assertEquals( "0.1", manifest.get( Attributes.Name.IMPLEMENTATION_VERSION ) );// "Implementation-Version" )
-            // );
-            assertEquals( "org.apache.dummy", manifest.get( Attributes.Name.IMPLEMENTATION_VENDOR_ID ) );// "Implementation-Vendor-Id"
-            // ) );
-            assertEquals( "Apache", manifest.get( Attributes.Name.IMPLEMENTATION_VENDOR ) );// "Implementation-Vendor" )
-            // );
-            assertEquals( "org.apache.maven.Foo", manifest.get( Attributes.Name.MAIN_CLASS ) );// "Main-Class" ) );
+            assertEquals( "Apache Maven 3.0.4", manifest.get( new Attributes.Name( "Created-By" ) ) );
+
+            assertEquals( "archiver test", manifest.get( Attributes.Name.SPECIFICATION_TITLE ) );
+            assertEquals( "0.1", manifest.get( Attributes.Name.SPECIFICATION_VERSION ) );
+            assertEquals( "Apache", manifest.get( Attributes.Name.SPECIFICATION_VENDOR ) );
+
+            assertEquals( "archiver test", manifest.get( Attributes.Name.IMPLEMENTATION_TITLE ) );
+            assertEquals( "0.1", manifest.get( Attributes.Name.IMPLEMENTATION_VERSION ) );
+            assertEquals( "org.apache.dummy", manifest.get( Attributes.Name.IMPLEMENTATION_VENDOR_ID ) );
+            assertEquals( "Apache", manifest.get( Attributes.Name.IMPLEMENTATION_VENDOR ) );
+
+            assertEquals( "org.apache.maven.Foo", manifest.get( Attributes.Name.MAIN_CLASS ) );
 
             assertEquals( "bar", manifest.get( new Attributes.Name( "foo" ) ) );
             assertEquals( "olivier", manifest.get( new Attributes.Name( "first-name" ) ) );
@@ -438,7 +504,46 @@ public class MavenArchiverTest
             manifest = jar.getManifest().getAttributes( "UserSection" );
 
             assertEquals( "value", manifest.get( new Attributes.Name( "key" ) ) );
+        }
+        finally
+        {
+            // cleanup streams
+            if ( jar != null )
+            {
+                jar.close();
+            }
+        }
+    }
+
+    public void testCreatedByManifestEntryWithoutMavenVersion()
+        throws Exception
+    {
+        JarFile jar = null;
+        try
+        {
+            File jarFile = new File( "target/test/dummy.jar" );
+            jarFile.delete();
+            assertFalse( jarFile.exists() );
+            JarArchiver jarArchiver = new JarArchiver();
+            jarArchiver.setDestFile( jarFile );
+
+            MavenArchiver archiver = new MavenArchiver();
+            archiver.setArchiver( jarArchiver );
+            archiver.setOutputFile( jarArchiver.getDestFile() );
+
+            MavenSession session = getDummySessionWithoutMavenVersion();
+            MavenProject project = getDummyProject();
+
+            MavenArchiveConfiguration config = new MavenArchiveConfiguration();
+            config.setForced( true );
+
+            archiver.createArchive( session, project, config );
+            assertTrue( jarFile.exists() );
+
+            jar = new JarFile( jarFile );
+            Map entries = jar.getManifest().getMainAttributes();
 
+            assertEquals( "Apache Maven", entries.get( new Attributes.Name( "Created-By" ) ) );
         }
         finally
         {
@@ -458,6 +563,8 @@ public class MavenArchiverTest
     {
         MavenArchiver archiver = new MavenArchiver();
 
+        MavenSession session = getDummySession();
+
         MavenProject project = getDummyProject();
         MavenArchiveConfiguration config = new MavenArchiveConfiguration();
 
@@ -468,7 +575,7 @@ public class MavenArchiverTest
         manifestSections.add( manifestSection );
         config.setManifestSections( manifestSections );
 
-        Manifest manifest = archiver.getManifest( project, config );
+        Manifest manifest = archiver.getManifest( session, project, config );
 
         Manifest.Section section = manifest.getSection( "SectionOne" );
         assertNotNull( "The section is not present in the manifest as it should be.", section );
@@ -481,6 +588,7 @@ public class MavenArchiverTest
     public void testDefaultClassPathValue()
         throws Exception
     {
+        MavenSession session = getDummySession();
         MavenProject project = getDummyProject();
         JarFile jar = null;
         try
@@ -501,7 +609,7 @@ public class MavenArchiverTest
             config.getManifest().setAddDefaultSpecificationEntries( true );
             config.getManifest().setMainClass( "org.apache.maven.Foo" );
             config.getManifest().setAddClasspath( true );
-            archiver.createArchive( project, config );
+            archiver.createArchive( session, project, config );
             assertTrue( jarFile.exists() );
             jar = new JarFile( jarFile );
 
@@ -525,6 +633,7 @@ public class MavenArchiverTest
     public void testDefaultClassPathValue_WithSnapshot()
         throws Exception
     {
+        MavenSession session = getDummySession();
         MavenProject project = getDummyProjectWithSnapshot();
         JarFile jar = null;
         try
@@ -545,7 +654,7 @@ public class MavenArchiverTest
             config.getManifest().setAddDefaultSpecificationEntries( true );
             config.getManifest().setMainClass( "org.apache.maven.Foo" );
             config.getManifest().setAddClasspath( true );
-            archiver.createArchive( project, config );
+            archiver.createArchive( session, project, config );
             assertTrue( jarFile.exists() );
             jar = new JarFile( jarFile );
 
@@ -569,6 +678,7 @@ public class MavenArchiverTest
     public void testMavenRepoClassPathValue()
         throws Exception
     {
+        MavenSession session = getDummySession();
         MavenProject project = getDummyProject();
         JarFile jar = null;
         try
@@ -590,14 +700,13 @@ public class MavenArchiverTest
             config.getManifest().setMainClass( "org.apache.maven.Foo" );
             config.getManifest().setAddClasspath( true );
             config.getManifest().setClasspathLayoutType( ManifestConfiguration.CLASSPATH_LAYOUT_TYPE_REPOSITORY );
-            archiver.createArchive( project, config );
+            archiver.createArchive( session, project, config );
             assertTrue( jarFile.exists() );
             jar = new JarFile( jarFile );
 
-            Manifest manifest = archiver.getManifest( project, config );
+            Manifest manifest = archiver.getManifest( session, project, config );
             String[] classPathEntries =
-                StringUtils.split(
-                                   new String( manifest.getMainSection().getAttributeValue( "Class-Path" ).getBytes() ),
+                StringUtils.split( new String( manifest.getMainSection().getAttributeValue( "Class-Path" ).getBytes() ),
                                    " " );
             assertEquals( "org/apache/dummy/dummy1/1.0/dummy1-1.0.jar", classPathEntries[0] );
             assertEquals( "org/apache/dummy/foo/dummy2/1.5/dummy2-1.5.jar", classPathEntries[1] );
@@ -609,7 +718,6 @@ public class MavenArchiverTest
             assertEquals( "org/apache/dummy/dummy1/1.0/dummy1-1.0.jar", classPathEntries[0] );
             assertEquals( "org/apache/dummy/foo/dummy2/1.5/dummy2-1.5.jar", classPathEntries[1] );
             assertEquals( "org/apache/dummy/bar/dummy3/2.0/dummy3-2.0.jar", classPathEntries[2] );
-
         }
         finally
         {
@@ -624,6 +732,7 @@ public class MavenArchiverTest
     public void testMavenRepoClassPathValue_WithSnapshot()
         throws Exception
     {
+        MavenSession session = getDummySession();
         MavenProject project = getDummyProjectWithSnapshot();
         JarFile jar = null;
         try
@@ -645,26 +754,26 @@ public class MavenArchiverTest
             config.getManifest().setMainClass( "org.apache.maven.Foo" );
             config.getManifest().setAddClasspath( true );
             config.getManifest().setClasspathLayoutType( ManifestConfiguration.CLASSPATH_LAYOUT_TYPE_REPOSITORY );
-            archiver.createArchive( project, config );
+            archiver.createArchive( session, project, config );
             assertTrue( jarFile.exists() );
             jar = new JarFile( jarFile );
 
-            Manifest manifest = archiver.getManifest( project, config );
+            Manifest manifest = archiver.getManifest( session, project, config );
             String[] classPathEntries =
-                StringUtils.split(
-                                   new String( manifest.getMainSection().getAttributeValue( "Class-Path" ).getBytes() ),
+                StringUtils.split( new String( manifest.getMainSection().getAttributeValue( "Class-Path" ).getBytes() ),
                                    " " );
-            assertEquals( "org/apache/dummy/dummy1/1.1-SNAPSHOT/dummy1-1.1-20081022.112233-1.jar", classPathEntries[0] );
+            assertEquals( "org/apache/dummy/dummy1/1.1-SNAPSHOT/dummy1-1.1-20081022.112233-1.jar",
+                          classPathEntries[0] );
             assertEquals( "org/apache/dummy/foo/dummy2/1.5/dummy2-1.5.jar", classPathEntries[1] );
             assertEquals( "org/apache/dummy/bar/dummy3/2.0/dummy3-2.0.jar", classPathEntries[2] );
 
             String classPath = jar.getManifest().getMainAttributes().getValue( Attributes.Name.CLASS_PATH );
             assertNotNull( classPath );
             classPathEntries = StringUtils.split( classPath, " " );
-            assertEquals( "org/apache/dummy/dummy1/1.1-SNAPSHOT/dummy1-1.1-20081022.112233-1.jar", classPathEntries[0] );
+            assertEquals( "org/apache/dummy/dummy1/1.1-SNAPSHOT/dummy1-1.1-20081022.112233-1.jar",
+                          classPathEntries[0] );
             assertEquals( "org/apache/dummy/foo/dummy2/1.5/dummy2-1.5.jar", classPathEntries[1] );
             assertEquals( "org/apache/dummy/bar/dummy3/2.0/dummy3-2.0.jar", classPathEntries[2] );
-
         }
         finally
         {
@@ -679,6 +788,7 @@ public class MavenArchiverTest
     public void testCustomClassPathValue()
         throws Exception
     {
+        MavenSession session = getDummySession();
         MavenProject project = getDummyProject();
         JarFile jar = null;
         try
@@ -701,15 +811,14 @@ public class MavenArchiverTest
             config.getManifest().setAddClasspath( true );
             config.getManifest().setClasspathLayoutType( ManifestConfiguration.CLASSPATH_LAYOUT_TYPE_CUSTOM );
             config.getManifest().setCustomClasspathLayout(
-                                                           "${artifact.groupIdPath}/${artifact.artifactId}/${artifact.version}/TEST-${artifact.artifactId}-${artifact.version}${dashClassifier?}.${artifact.extension}" );
-            archiver.createArchive( project, config );
+                "${artifact.groupIdPath}/${artifact.artifactId}/${artifact.version}/TEST-${artifact.artifactId}-${artifact.version}${dashClassifier?}.${artifact.extension}" );
+            archiver.createArchive( session, project, config );
             assertTrue( jarFile.exists() );
             jar = new JarFile( jarFile );
 
-            Manifest manifest = archiver.getManifest( project, config );
+            Manifest manifest = archiver.getManifest( session, project, config );
             String[] classPathEntries =
-                StringUtils.split(
-                                   new String( manifest.getMainSection().getAttributeValue( "Class-Path" ).getBytes() ),
+                StringUtils.split( new String( manifest.getMainSection().getAttributeValue( "Class-Path" ).getBytes() ),
                                    " " );
             assertEquals( "org/apache/dummy/dummy1/1.0/TEST-dummy1-1.0.jar", classPathEntries[0] );
             assertEquals( "org/apache/dummy/foo/dummy2/1.5/TEST-dummy2-1.5.jar", classPathEntries[1] );
@@ -721,7 +830,6 @@ public class MavenArchiverTest
             assertEquals( "org/apache/dummy/dummy1/1.0/TEST-dummy1-1.0.jar", classPathEntries[0] );
             assertEquals( "org/apache/dummy/foo/dummy2/1.5/TEST-dummy2-1.5.jar", classPathEntries[1] );
             assertEquals( "org/apache/dummy/bar/dummy3/2.0/TEST-dummy3-2.0.jar", classPathEntries[2] );
-
         }
         finally
         {
@@ -736,6 +844,7 @@ public class MavenArchiverTest
     public void testCustomClassPathValue_WithSnapshotResolvedVersion()
         throws Exception
     {
+        MavenSession session = getDummySession();
         MavenProject project = getDummyProjectWithSnapshot();
         JarFile jar = null;
         try
@@ -758,27 +867,27 @@ public class MavenArchiverTest
             config.getManifest().setAddClasspath( true );
             config.getManifest().setClasspathLayoutType( ManifestConfiguration.CLASSPATH_LAYOUT_TYPE_CUSTOM );
             config.getManifest().setCustomClasspathLayout(
-                                                           "${artifact.groupIdPath}/${artifact.artifactId}/${artifact.baseVersion}/TEST-${artifact.artifactId}-${artifact.version}${dashClassifier?}.${artifact.extension}" );
-            archiver.createArchive( project, config );
+                "${artifact.groupIdPath}/${artifact.artifactId}/${artifact.baseVersion}/TEST-${artifact.artifactId}-${artifact.version}${dashClassifier?}.${artifact.extension}" );
+            archiver.createArchive( session, project, config );
             assertTrue( jarFile.exists() );
             jar = new JarFile( jarFile );
 
-            Manifest manifest = archiver.getManifest( project, config );
+            Manifest manifest = archiver.getManifest( session, project, config );
             String[] classPathEntries =
-                StringUtils.split(
-                                   new String( manifest.getMainSection().getAttributeValue( "Class-Path" ).getBytes() ),
+                StringUtils.split( new String( manifest.getMainSection().getAttributeValue( "Class-Path" ).getBytes() ),
                                    " " );
-            assertEquals( "org/apache/dummy/dummy1/1.1-SNAPSHOT/TEST-dummy1-1.1-20081022.112233-1.jar", classPathEntries[0] );
+            assertEquals( "org/apache/dummy/dummy1/1.1-SNAPSHOT/TEST-dummy1-1.1-20081022.112233-1.jar",
+                          classPathEntries[0] );
             assertEquals( "org/apache/dummy/foo/dummy2/1.5/TEST-dummy2-1.5.jar", classPathEntries[1] );
             assertEquals( "org/apache/dummy/bar/dummy3/2.0/TEST-dummy3-2.0.jar", classPathEntries[2] );
 
             String classPath = jar.getManifest().getMainAttributes().getValue( Attributes.Name.CLASS_PATH );
             assertNotNull( classPath );
             classPathEntries = StringUtils.split( classPath, " " );
-            assertEquals( "org/apache/dummy/dummy1/1.1-SNAPSHOT/TEST-dummy1-1.1-20081022.112233-1.jar", classPathEntries[0] );
+            assertEquals( "org/apache/dummy/dummy1/1.1-SNAPSHOT/TEST-dummy1-1.1-20081022.112233-1.jar",
+                          classPathEntries[0] );
             assertEquals( "org/apache/dummy/foo/dummy2/1.5/TEST-dummy2-1.5.jar", classPathEntries[1] );
             assertEquals( "org/apache/dummy/bar/dummy3/2.0/TEST-dummy3-2.0.jar", classPathEntries[2] );
-
         }
         finally
         {
@@ -793,6 +902,7 @@ public class MavenArchiverTest
     public void testCustomClassPathValue_WithSnapshotForcingBaseVersion()
         throws Exception
     {
+        MavenSession session = getDummySession();
         MavenProject project = getDummyProjectWithSnapshot();
         JarFile jar = null;
         try
@@ -815,15 +925,14 @@ public class MavenArchiverTest
             config.getManifest().setAddClasspath( true );
             config.getManifest().setClasspathLayoutType( ManifestConfiguration.CLASSPATH_LAYOUT_TYPE_CUSTOM );
             config.getManifest().setCustomClasspathLayout(
-                                                           "${artifact.groupIdPath}/${artifact.artifactId}/${artifact.baseVersion}/TEST-${artifact.artifactId}-${artifact.baseVersion}${dashClassifier?}.${artifact.extension}" );
-            archiver.createArchive( project, config );
+                "${artifact.groupIdPath}/${artifact.artifactId}/${artifact.baseVersion}/TEST-${artifact.artifactId}-${artifact.baseVersion}${dashClassifier?}.${artifact.extension}" );
+            archiver.createArchive( session, project, config );
             assertTrue( jarFile.exists() );
             jar = new JarFile( jarFile );
 
-            Manifest manifest = archiver.getManifest( project, config );
+            Manifest manifest = archiver.getManifest( session, project, config );
             String[] classPathEntries =
-                StringUtils.split(
-                                   new String( manifest.getMainSection().getAttributeValue( "Class-Path" ).getBytes() ),
+                StringUtils.split( new String( manifest.getMainSection().getAttributeValue( "Class-Path" ).getBytes() ),
                                    " " );
             assertEquals( "org/apache/dummy/dummy1/1.1-SNAPSHOT/TEST-dummy1-1.1-SNAPSHOT.jar", classPathEntries[0] );
             assertEquals( "org/apache/dummy/foo/dummy2/1.5/TEST-dummy2-1.5.jar", classPathEntries[1] );
@@ -835,7 +944,6 @@ public class MavenArchiverTest
             assertEquals( "org/apache/dummy/dummy1/1.1-SNAPSHOT/TEST-dummy1-1.1-SNAPSHOT.jar", classPathEntries[0] );
             assertEquals( "org/apache/dummy/foo/dummy2/1.5/TEST-dummy2-1.5.jar", classPathEntries[1] );
             assertEquals( "org/apache/dummy/bar/dummy3/2.0/TEST-dummy3-2.0.jar", classPathEntries[2] );
-
         }
         finally
         {
@@ -1090,4 +1198,35 @@ public class MavenArchiverTest
 
         return result;
     }
+
+    private MavenSession getDummySession()
+    {
+        Properties executionProperties = new Properties();
+        executionProperties.put( "maven.version", "3.0.4" );
+
+        return getDummySession( executionProperties );
+    }
+
+    private MavenSession getDummySessionWithoutMavenVersion()
+    {
+        return getDummySession( new Properties() );
+    }
+
+    private MavenSession getDummySession( Properties executionProperties )
+    {
+        PlexusContainer container = null;
+        Settings settings = null;
+        ArtifactRepository localRepo = null;
+        EventDispatcher eventDispatcher = null;
+        ReactorManager reactorManager = null;
+        List goals = null;
+        String executionRootDir = null;
+        Date startTime = new Date();
+        MavenSession session =
+            new MavenSession( container, settings, localRepo, eventDispatcher, reactorManager, goals, executionRootDir,
+                              executionProperties, startTime );
+
+        return session;
+    }
+
 }
