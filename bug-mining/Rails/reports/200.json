{"url":"https://api.github.com/repos/rails/rails/issues/50672","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/50672/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/50672/comments","events_url":"https://api.github.com/repos/rails/rails/issues/50672/events","html_url":"https://github.com/rails/rails/issues/50672","id":2072396416,"node_id":"I_kwDNIULOe4ZCgA","number":50672,"title":"db:schema:load:<name> purges test database","user":{"login":"romuloceccon","id":40032,"node_id":"MDQ6VXNlcjQwMDMy","avatar_url":"https://avatars.githubusercontent.com/u/40032?v=4","gravatar_id":"","url":"https://api.github.com/users/romuloceccon","html_url":"https://github.com/romuloceccon","followers_url":"https://api.github.com/users/romuloceccon/followers","following_url":"https://api.github.com/users/romuloceccon/following{/other_user}","gists_url":"https://api.github.com/users/romuloceccon/gists{/gist_id}","starred_url":"https://api.github.com/users/romuloceccon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romuloceccon/subscriptions","organizations_url":"https://api.github.com/users/romuloceccon/orgs","repos_url":"https://api.github.com/users/romuloceccon/repos","events_url":"https://api.github.com/users/romuloceccon/events{/privacy}","received_events_url":"https://api.github.com/users/romuloceccon/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":107191,"node_id":"MDU6TGFiZWwxMDcxOTE=","url":"https://api.github.com/repos/rails/rails/labels/activerecord","name":"activerecord","color":"0b02e1","default":false,"description":null},{"id":126910270,"node_id":"MDU6TGFiZWwxMjY5MTAyNzA=","url":"https://api.github.com/repos/rails/rails/labels/With%20reproduction%20steps","name":"With reproduction steps","color":"009800","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2024-01-09T13:43:19Z","updated_at":"2025-07-21T11:01:39Z","closed_at":"2025-07-21T11:01:39Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Commit [adb64db43d](https://github.com/rails/rails/commit/adb64db43dba5cad1007ce57e25df67f8b3e91f8#diff-4a42b5efdab725af0936f94b4a84dcf6a8be8738e28ed265e0a3e74f275f5048R491) changed task `db:schema:load:<name>` to invoke `db:test:purge:<name>`.\r\n\r\nBecause of that Rails 7.1 breaks my workflow for initializing a local environment:\r\n\r\n- create database with `db:create`\r\n- run custom SQL to create Postgres extensions, schemas and triggers\r\n- load schema with `db:schema:load:<name>`\r\n\r\nStrangely, `db:schema:load` keeps the old behavior, and I could not find the explanation for the change in the commit message or in related Github issues.\r\n\r\nAlso, it _requires_ a test database to be configured in `database.yml`; otherwise the task fails:\r\n\r\n```\r\n$ RAILS_ENV=development bin/rails db:schema:load:primary\r\nbin/rails aborted!\r\nTypeError: Invalid type for configuration. Expected Symbol, String, or Hash. Got nil (TypeError)\r\n\r\n        raise TypeError, \"Invalid type for configuration. Expected Symbol, String, or Hash. Got #{config.inspect}\"\r\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n\r\nTasks: TOP => db:schema:load:primary => db:test:purge:primary\r\n(See full trace by running task with --trace)\r\n```\r\n\r\nCan someone confirm the change was intentional?\r\n\r\n**Steps to reproduce the failure**\r\n\r\n- `$ rails new rails_bug`\r\n- `$ cd rails_bug`\r\n- use the following `database.yml`:\r\n\r\n```\r\ndevelopment:\r\n  one:\r\n    adapter: sqlite3\r\n    database: storage/development.sqlite3\r\n  two:\r\n    adapter: sqlite3\r\n    database: storage/development_two.sqlite3\r\n    migrations_paths: db/migrate_two\r\n```\r\n- `$ bin/rails db:migrate:one`\r\n- `$ bin/rails db:schema:load:one`\r\n\r\n**Expected behavior**\r\n\r\nNo error.\r\n\r\n**Actual behavior**\r\n\r\nTypeError invoking database task.\r\n\r\n**System configuration**\r\n\r\nRails 7.1.2\r\nRuby 3.2.2\r\n","closed_by":{"login":"byroot","id":44640,"node_id":"MDQ6VXNlcjQ0NjQw","avatar_url":"https://avatars.githubusercontent.com/u/44640?v=4","gravatar_id":"","url":"https://api.github.com/users/byroot","html_url":"https://github.com/byroot","followers_url":"https://api.github.com/users/byroot/followers","following_url":"https://api.github.com/users/byroot/following{/other_user}","gists_url":"https://api.github.com/users/byroot/gists{/gist_id}","starred_url":"https://api.github.com/users/byroot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/byroot/subscriptions","organizations_url":"https://api.github.com/users/byroot/orgs","repos_url":"https://api.github.com/users/byroot/repos","events_url":"https://api.github.com/users/byroot/events{/privacy}","received_events_url":"https://api.github.com/users/byroot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rails/rails/issues/50672/reactions","total_count":5,"+1":5,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/rails/issues/50672/timeline","performed_via_github_app":null,"state_reason":"completed"}