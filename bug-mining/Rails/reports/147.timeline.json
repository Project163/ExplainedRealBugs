[{"id":14589812995,"node_id":"MEE_lADNIULOmbI6Fs8AAAADZZ7hAw","url":"https://api.github.com/repos/rails/rails/issues/events/14589812995","actor":{"login":"kamipo","id":12642,"node_id":"MDQ6VXNlcjEyNjQy","avatar_url":"https://avatars.githubusercontent.com/u/12642?v=4","gravatar_id":"","url":"https://api.github.com/users/kamipo","html_url":"https://github.com/kamipo","followers_url":"https://api.github.com/users/kamipo/followers","following_url":"https://api.github.com/users/kamipo/following{/other_user}","gists_url":"https://api.github.com/users/kamipo/gists{/gist_id}","starred_url":"https://api.github.com/users/kamipo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kamipo/subscriptions","organizations_url":"https://api.github.com/users/kamipo/orgs","repos_url":"https://api.github.com/users/kamipo/repos","events_url":"https://api.github.com/users/kamipo/events{/privacy}","received_events_url":"https://api.github.com/users/kamipo/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-10-10T11:41:43Z","performed_via_github_app":null},{"id":14589813009,"node_id":"SE_lADNIULOmbI6Fs8AAAADZZ7hEQ","url":"https://api.github.com/repos/rails/rails/issues/events/14589813009","actor":{"login":"kamipo","id":12642,"node_id":"MDQ6VXNlcjEyNjQy","avatar_url":"https://avatars.githubusercontent.com/u/12642?v=4","gravatar_id":"","url":"https://api.github.com/users/kamipo","html_url":"https://github.com/kamipo","followers_url":"https://api.github.com/users/kamipo/followers","following_url":"https://api.github.com/users/kamipo/following{/other_user}","gists_url":"https://api.github.com/users/kamipo/gists{/gist_id}","starred_url":"https://api.github.com/users/kamipo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kamipo/subscriptions","organizations_url":"https://api.github.com/users/kamipo/orgs","repos_url":"https://api.github.com/users/kamipo/repos","events_url":"https://api.github.com/users/kamipo/events{/privacy}","received_events_url":"https://api.github.com/users/kamipo/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-10-10T11:41:43Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rails/rails/issues/comments/2404867690","html_url":"https://github.com/rails/rails/issues/53260#issuecomment-2404867690","issue_url":"https://api.github.com/repos/rails/rails/issues/53260","id":2404867690,"node_id":"IC_kwDNIULOj1deag","user":{"login":"davidpiegza","id":697113,"node_id":"MDQ6VXNlcjY5NzExMw==","avatar_url":"https://avatars.githubusercontent.com/u/697113?v=4","gravatar_id":"","url":"https://api.github.com/users/davidpiegza","html_url":"https://github.com/davidpiegza","followers_url":"https://api.github.com/users/davidpiegza/followers","following_url":"https://api.github.com/users/davidpiegza/following{/other_user}","gists_url":"https://api.github.com/users/davidpiegza/gists{/gist_id}","starred_url":"https://api.github.com/users/davidpiegza/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidpiegza/subscriptions","organizations_url":"https://api.github.com/users/davidpiegza/orgs","repos_url":"https://api.github.com/users/davidpiegza/repos","events_url":"https://api.github.com/users/davidpiegza/events{/privacy}","received_events_url":"https://api.github.com/users/davidpiegza/received_events","type":"User","user_view_type":"public","site_admin":true},"created_at":"2024-10-10T11:43:57Z","updated_at":"2024-10-10T11:43:57Z","body":"A possible fix is to add a `unless loaded?` check in [this line](https://github.com/rails/rails/commit/b0a6fe4c14995ea7f3548accb46977adcf8da7db#diff-79b53b2602bf702bdd8ce677e096be6a6923a54236e17237c16068a510078683R1976):\n\n```ruby\nself.references_values |= [Arel.sql(table_name, retryable: true)] unless loaded?\n```","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/comments/2404867690/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"davidpiegza","id":697113,"node_id":"MDQ6VXNlcjY5NzExMw==","avatar_url":"https://avatars.githubusercontent.com/u/697113?v=4","gravatar_id":"","url":"https://api.github.com/users/davidpiegza","html_url":"https://github.com/davidpiegza","followers_url":"https://api.github.com/users/davidpiegza/followers","following_url":"https://api.github.com/users/davidpiegza/following{/other_user}","gists_url":"https://api.github.com/users/davidpiegza/gists{/gist_id}","starred_url":"https://api.github.com/users/davidpiegza/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidpiegza/subscriptions","organizations_url":"https://api.github.com/users/davidpiegza/orgs","repos_url":"https://api.github.com/users/davidpiegza/repos","events_url":"https://api.github.com/users/davidpiegza/events{/privacy}","received_events_url":"https://api.github.com/users/davidpiegza/received_events","type":"User","user_view_type":"public","site_admin":true}},{"url":"https://api.github.com/repos/rails/rails/issues/comments/2404871499","html_url":"https://github.com/rails/rails/issues/53260#issuecomment-2404871499","issue_url":"https://api.github.com/repos/rails/rails/issues/53260","id":2404871499,"node_id":"IC_kwDNIULOj1dtSw","user":{"login":"fatkodima","id":5657035,"node_id":"MDQ6VXNlcjU2NTcwMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5657035?v=4","gravatar_id":"","url":"https://api.github.com/users/fatkodima","html_url":"https://github.com/fatkodima","followers_url":"https://api.github.com/users/fatkodima/followers","following_url":"https://api.github.com/users/fatkodima/following{/other_user}","gists_url":"https://api.github.com/users/fatkodima/gists{/gist_id}","starred_url":"https://api.github.com/users/fatkodima/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fatkodima/subscriptions","organizations_url":"https://api.github.com/users/fatkodima/orgs","repos_url":"https://api.github.com/users/fatkodima/repos","events_url":"https://api.github.com/users/fatkodima/events{/privacy}","received_events_url":"https://api.github.com/users/fatkodima/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-10T11:45:53Z","updated_at":"2024-10-10T11:46:26Z","body":"You should perform the query inside the block, not just return the relation:\r\n```ruby\r\n    values = ApplicationRecord.connected_to(role: :writing) do\r\n      Post.pluck(\"posts.id\")\r\n    end\r\n```","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/comments/2404871499/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"fatkodima","id":5657035,"node_id":"MDQ6VXNlcjU2NTcwMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5657035?v=4","gravatar_id":"","url":"https://api.github.com/users/fatkodima","html_url":"https://github.com/fatkodima","followers_url":"https://api.github.com/users/fatkodima/followers","following_url":"https://api.github.com/users/fatkodima/following{/other_user}","gists_url":"https://api.github.com/users/fatkodima/gists{/gist_id}","starred_url":"https://api.github.com/users/fatkodima/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fatkodima/subscriptions","organizations_url":"https://api.github.com/users/fatkodima/orgs","repos_url":"https://api.github.com/users/fatkodima/repos","events_url":"https://api.github.com/users/fatkodima/events{/privacy}","received_events_url":"https://api.github.com/users/fatkodima/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rails/rails/issues/comments/2405087752","html_url":"https://github.com/rails/rails/issues/53260#issuecomment-2405087752","issue_url":"https://api.github.com/repos/rails/rails/issues/53260","id":2405087752,"node_id":"IC_kwDNIULOj1q6CA","user":{"login":"davidpiegza","id":697113,"node_id":"MDQ6VXNlcjY5NzExMw==","avatar_url":"https://avatars.githubusercontent.com/u/697113?v=4","gravatar_id":"","url":"https://api.github.com/users/davidpiegza","html_url":"https://github.com/davidpiegza","followers_url":"https://api.github.com/users/davidpiegza/followers","following_url":"https://api.github.com/users/davidpiegza/following{/other_user}","gists_url":"https://api.github.com/users/davidpiegza/gists{/gist_id}","starred_url":"https://api.github.com/users/davidpiegza/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidpiegza/subscriptions","organizations_url":"https://api.github.com/users/davidpiegza/orgs","repos_url":"https://api.github.com/users/davidpiegza/repos","events_url":"https://api.github.com/users/davidpiegza/events{/privacy}","received_events_url":"https://api.github.com/users/davidpiegza/received_events","type":"User","user_view_type":"public","site_admin":true},"created_at":"2024-10-10T13:24:18Z","updated_at":"2024-10-10T13:24:18Z","body":"@fatkodima Thanks for the quick response. This works for simple queries but it's tricky for complex queries when a base scope is returned and `pluck` is called outside of the `connected_to` block.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/comments/2405087752/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"davidpiegza","id":697113,"node_id":"MDQ6VXNlcjY5NzExMw==","avatar_url":"https://avatars.githubusercontent.com/u/697113?v=4","gravatar_id":"","url":"https://api.github.com/users/davidpiegza","html_url":"https://github.com/davidpiegza","followers_url":"https://api.github.com/users/davidpiegza/followers","following_url":"https://api.github.com/users/davidpiegza/following{/other_user}","gists_url":"https://api.github.com/users/davidpiegza/gists{/gist_id}","starred_url":"https://api.github.com/users/davidpiegza/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidpiegza/subscriptions","organizations_url":"https://api.github.com/users/davidpiegza/orgs","repos_url":"https://api.github.com/users/davidpiegza/repos","events_url":"https://api.github.com/users/davidpiegza/events{/privacy}","received_events_url":"https://api.github.com/users/davidpiegza/received_events","type":"User","user_view_type":"public","site_admin":true}},{"id":14591362581,"node_id":"MEE_lADNIULOmbI6Fs8AAAADZbaGFQ","url":"https://api.github.com/repos/rails/rails/issues/events/14591362581","actor":{"login":"fatkodima","id":5657035,"node_id":"MDQ6VXNlcjU2NTcwMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5657035?v=4","gravatar_id":"","url":"https://api.github.com/users/fatkodima","html_url":"https://github.com/fatkodima","followers_url":"https://api.github.com/users/fatkodima/followers","following_url":"https://api.github.com/users/fatkodima/following{/other_user}","gists_url":"https://api.github.com/users/fatkodima/gists{/gist_id}","starred_url":"https://api.github.com/users/fatkodima/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fatkodima/subscriptions","organizations_url":"https://api.github.com/users/fatkodima/orgs","repos_url":"https://api.github.com/users/fatkodima/repos","events_url":"https://api.github.com/users/fatkodima/events{/privacy}","received_events_url":"https://api.github.com/users/fatkodima/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-10-10T13:24:20Z","performed_via_github_app":null},{"id":14591362596,"node_id":"SE_lADNIULOmbI6Fs8AAAADZbaGJA","url":"https://api.github.com/repos/rails/rails/issues/events/14591362596","actor":{"login":"fatkodima","id":5657035,"node_id":"MDQ6VXNlcjU2NTcwMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5657035?v=4","gravatar_id":"","url":"https://api.github.com/users/fatkodima","html_url":"https://github.com/fatkodima","followers_url":"https://api.github.com/users/fatkodima/followers","following_url":"https://api.github.com/users/fatkodima/following{/other_user}","gists_url":"https://api.github.com/users/fatkodima/gists{/gist_id}","starred_url":"https://api.github.com/users/fatkodima/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fatkodima/subscriptions","organizations_url":"https://api.github.com/users/fatkodima/orgs","repos_url":"https://api.github.com/users/fatkodima/repos","events_url":"https://api.github.com/users/fatkodima/events{/privacy}","received_events_url":"https://api.github.com/users/fatkodima/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-10-10T13:24:20Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rails/rails/issues/comments/2405095027","html_url":"https://github.com/rails/rails/issues/53260#issuecomment-2405095027","issue_url":"https://api.github.com/repos/rails/rails/issues/53260","id":2405095027,"node_id":"IC_kwDNIULOj1rWcw","user":{"login":"fatkodima","id":5657035,"node_id":"MDQ6VXNlcjU2NTcwMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5657035?v=4","gravatar_id":"","url":"https://api.github.com/users/fatkodima","html_url":"https://github.com/fatkodima","followers_url":"https://api.github.com/users/fatkodima/followers","following_url":"https://api.github.com/users/fatkodima/following{/other_user}","gists_url":"https://api.github.com/users/fatkodima/gists{/gist_id}","starred_url":"https://api.github.com/users/fatkodima/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fatkodima/subscriptions","organizations_url":"https://api.github.com/users/fatkodima/orgs","repos_url":"https://api.github.com/users/fatkodima/repos","events_url":"https://api.github.com/users/fatkodima/events{/privacy}","received_events_url":"https://api.github.com/users/fatkodima/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-10T13:27:32Z","updated_at":"2024-10-10T13:27:32Z","body":"Building queries inside `connected_to` and running them outside and expecting them to run on the correct database is a programmer error.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/comments/2405095027/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"fatkodima","id":5657035,"node_id":"MDQ6VXNlcjU2NTcwMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5657035?v=4","gravatar_id":"","url":"https://api.github.com/users/fatkodima","html_url":"https://github.com/fatkodima","followers_url":"https://api.github.com/users/fatkodima/followers","following_url":"https://api.github.com/users/fatkodima/following{/other_user}","gists_url":"https://api.github.com/users/fatkodima/gists{/gist_id}","starred_url":"https://api.github.com/users/fatkodima/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fatkodima/subscriptions","organizations_url":"https://api.github.com/users/fatkodima/orgs","repos_url":"https://api.github.com/users/fatkodima/repos","events_url":"https://api.github.com/users/fatkodima/events{/privacy}","received_events_url":"https://api.github.com/users/fatkodima/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rails/rails/issues/comments/2405385492","html_url":"https://github.com/rails/rails/issues/53260#issuecomment-2405385492","issue_url":"https://api.github.com/repos/rails/rails/issues/53260","id":2405385492,"node_id":"IC_kwDNIULOj19FFA","user":{"login":"davidpiegza","id":697113,"node_id":"MDQ6VXNlcjY5NzExMw==","avatar_url":"https://avatars.githubusercontent.com/u/697113?v=4","gravatar_id":"","url":"https://api.github.com/users/davidpiegza","html_url":"https://github.com/davidpiegza","followers_url":"https://api.github.com/users/davidpiegza/followers","following_url":"https://api.github.com/users/davidpiegza/following{/other_user}","gists_url":"https://api.github.com/users/davidpiegza/gists{/gist_id}","starred_url":"https://api.github.com/users/davidpiegza/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidpiegza/subscriptions","organizations_url":"https://api.github.com/users/davidpiegza/orgs","repos_url":"https://api.github.com/users/davidpiegza/repos","events_url":"https://api.github.com/users/davidpiegza/events{/privacy}","received_events_url":"https://api.github.com/users/davidpiegza/received_events","type":"User","user_view_type":"public","site_admin":true},"created_at":"2024-10-10T15:05:39Z","updated_at":"2024-10-10T15:09:22Z","body":"> expecting them to run on the correct database\n\nI think it's not about the expectation on which database it runs. The issue is about \"a call to `pluck` fails with an error on a loaded relation\". \n\nFor example, it also fails in this case (without using `connected_to`):\n```ruby\nposts = Post.all\nposts.to_a\nposts.pluck(\"posts.id\")\n```\n\nIt works when calling `pluck(:id)`.\n\nI'll update the example above to simplify it.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/comments/2405385492/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"davidpiegza","id":697113,"node_id":"MDQ6VXNlcjY5NzExMw==","avatar_url":"https://avatars.githubusercontent.com/u/697113?v=4","gravatar_id":"","url":"https://api.github.com/users/davidpiegza","html_url":"https://github.com/davidpiegza","followers_url":"https://api.github.com/users/davidpiegza/followers","following_url":"https://api.github.com/users/davidpiegza/following{/other_user}","gists_url":"https://api.github.com/users/davidpiegza/gists{/gist_id}","starred_url":"https://api.github.com/users/davidpiegza/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidpiegza/subscriptions","organizations_url":"https://api.github.com/users/davidpiegza/orgs","repos_url":"https://api.github.com/users/davidpiegza/repos","events_url":"https://api.github.com/users/davidpiegza/events{/privacy}","received_events_url":"https://api.github.com/users/davidpiegza/received_events","type":"User","user_view_type":"public","site_admin":true}},{"id":14593222886,"node_id":"RTE_lADNIULOmbI6Fs8AAAADZdLo5g","url":"https://api.github.com/repos/rails/rails/issues/events/14593222886","actor":{"login":"davidpiegza","id":697113,"node_id":"MDQ6VXNlcjY5NzExMw==","avatar_url":"https://avatars.githubusercontent.com/u/697113?v=4","gravatar_id":"","url":"https://api.github.com/users/davidpiegza","html_url":"https://github.com/davidpiegza","followers_url":"https://api.github.com/users/davidpiegza/followers","following_url":"https://api.github.com/users/davidpiegza/following{/other_user}","gists_url":"https://api.github.com/users/davidpiegza/gists{/gist_id}","starred_url":"https://api.github.com/users/davidpiegza/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidpiegza/subscriptions","organizations_url":"https://api.github.com/users/davidpiegza/orgs","repos_url":"https://api.github.com/users/davidpiegza/repos","events_url":"https://api.github.com/users/davidpiegza/events{/privacy}","received_events_url":"https://api.github.com/users/davidpiegza/received_events","type":"User","user_view_type":"public","site_admin":true},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2024-10-10T15:09:36Z","rename":{"from":"[ActiveRecord] A call to `pluck` after `connected_to` fails with `ActiveRecord::UnmodifiableRelation` error","to":"[ActiveRecord] A call to `pluck` fails with `ActiveRecord::UnmodifiableRelation` error"},"performed_via_github_app":null},{"id":14593926579,"node_id":"REFE_lADNIULOmbI6Fs8AAAADZd2lsw","url":"https://api.github.com/repos/rails/rails/issues/events/14593926579","actor":{"login":"kamipo","id":12642,"node_id":"MDQ6VXNlcjEyNjQy","avatar_url":"https://avatars.githubusercontent.com/u/12642?v=4","gravatar_id":"","url":"https://api.github.com/users/kamipo","html_url":"https://github.com/kamipo","followers_url":"https://api.github.com/users/kamipo/followers","following_url":"https://api.github.com/users/kamipo/following{/other_user}","gists_url":"https://api.github.com/users/kamipo/gists{/gist_id}","starred_url":"https://api.github.com/users/kamipo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kamipo/subscriptions","organizations_url":"https://api.github.com/users/kamipo/orgs","repos_url":"https://api.github.com/users/kamipo/repos","events_url":"https://api.github.com/users/kamipo/events{/privacy}","received_events_url":"https://api.github.com/users/kamipo/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"03d949bb0ea1abac04c8cdeba1c55f1a066545b5","commit_url":"https://api.github.com/repos/kamipo/rails/commits/03d949bb0ea1abac04c8cdeba1c55f1a066545b5","created_at":"2024-10-10T15:57:57Z","performed_via_github_app":null},{"actor":{"login":"kamipo","id":12642,"node_id":"MDQ6VXNlcjEyNjQy","avatar_url":"https://avatars.githubusercontent.com/u/12642?v=4","gravatar_id":"","url":"https://api.github.com/users/kamipo","html_url":"https://github.com/kamipo","followers_url":"https://api.github.com/users/kamipo/followers","following_url":"https://api.github.com/users/kamipo/following{/other_user}","gists_url":"https://api.github.com/users/kamipo/gists{/gist_id}","starred_url":"https://api.github.com/users/kamipo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kamipo/subscriptions","organizations_url":"https://api.github.com/users/kamipo/orgs","repos_url":"https://api.github.com/users/kamipo/repos","events_url":"https://api.github.com/users/kamipo/events{/privacy}","received_events_url":"https://api.github.com/users/kamipo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-10T15:58:27Z","updated_at":"2024-10-10T15:58:27Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rails/rails/issues/53264","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/53264/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/53264/comments","events_url":"https://api.github.com/repos/rails/rails/issues/53264/events","html_url":"https://github.com/rails/rails/pull/53264","id":2579263163,"node_id":"PR_kwDNIULOfj5iuA","number":53264,"title":"Fix `pluck` with qualified name on loaded relation","user":{"login":"kamipo","id":12642,"node_id":"MDQ6VXNlcjEyNjQy","avatar_url":"https://avatars.githubusercontent.com/u/12642?v=4","gravatar_id":"","url":"https://api.github.com/users/kamipo","html_url":"https://github.com/kamipo","followers_url":"https://api.github.com/users/kamipo/followers","following_url":"https://api.github.com/users/kamipo/following{/other_user}","gists_url":"https://api.github.com/users/kamipo/gists{/gist_id}","starred_url":"https://api.github.com/users/kamipo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kamipo/subscriptions","organizations_url":"https://api.github.com/users/kamipo/orgs","repos_url":"https://api.github.com/users/kamipo/repos","events_url":"https://api.github.com/users/kamipo/events{/privacy}","received_events_url":"https://api.github.com/users/kamipo/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":107191,"node_id":"MDU6TGFiZWwxMDcxOTE=","url":"https://api.github.com/repos/rails/rails/labels/activerecord","name":"activerecord","color":"0b02e1","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2024-10-10T15:58:26Z","updated_at":"2024-10-10T16:18:07Z","closed_at":"2024-10-10T16:18:04Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":8514,"node_id":"MDEwOlJlcG9zaXRvcnk4NTE0","name":"rails","full_name":"rails/rails","private":false,"owner":{"login":"rails","id":4223,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQyMjM=","avatar_url":"https://avatars.githubusercontent.com/u/4223?v=4","gravatar_id":"","url":"https://api.github.com/users/rails","html_url":"https://github.com/rails","followers_url":"https://api.github.com/users/rails/followers","following_url":"https://api.github.com/users/rails/following{/other_user}","gists_url":"https://api.github.com/users/rails/gists{/gist_id}","starred_url":"https://api.github.com/users/rails/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rails/subscriptions","organizations_url":"https://api.github.com/users/rails/orgs","repos_url":"https://api.github.com/users/rails/repos","events_url":"https://api.github.com/users/rails/events{/privacy}","received_events_url":"https://api.github.com/users/rails/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rails/rails","description":"Ruby on Rails","fork":false,"url":"https://api.github.com/repos/rails/rails","forks_url":"https://api.github.com/repos/rails/rails/forks","keys_url":"https://api.github.com/repos/rails/rails/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rails/rails/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rails/rails/teams","hooks_url":"https://api.github.com/repos/rails/rails/hooks","issue_events_url":"https://api.github.com/repos/rails/rails/issues/events{/number}","events_url":"https://api.github.com/repos/rails/rails/events","assignees_url":"https://api.github.com/repos/rails/rails/assignees{/user}","branches_url":"https://api.github.com/repos/rails/rails/branches{/branch}","tags_url":"https://api.github.com/repos/rails/rails/tags","blobs_url":"https://api.github.com/repos/rails/rails/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rails/rails/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rails/rails/git/refs{/sha}","trees_url":"https://api.github.com/repos/rails/rails/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rails/rails/statuses/{sha}","languages_url":"https://api.github.com/repos/rails/rails/languages","stargazers_url":"https://api.github.com/repos/rails/rails/stargazers","contributors_url":"https://api.github.com/repos/rails/rails/contributors","subscribers_url":"https://api.github.com/repos/rails/rails/subscribers","subscription_url":"https://api.github.com/repos/rails/rails/subscription","commits_url":"https://api.github.com/repos/rails/rails/commits{/sha}","git_commits_url":"https://api.github.com/repos/rails/rails/git/commits{/sha}","comments_url":"https://api.github.com/repos/rails/rails/comments{/number}","issue_comment_url":"https://api.github.com/repos/rails/rails/issues/comments{/number}","contents_url":"https://api.github.com/repos/rails/rails/contents/{+path}","compare_url":"https://api.github.com/repos/rails/rails/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rails/rails/merges","archive_url":"https://api.github.com/repos/rails/rails/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rails/rails/downloads","issues_url":"https://api.github.com/repos/rails/rails/issues{/number}","pulls_url":"https://api.github.com/repos/rails/rails/pulls{/number}","milestones_url":"https://api.github.com/repos/rails/rails/milestones{/number}","notifications_url":"https://api.github.com/repos/rails/rails/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rails/rails/labels{/name}","releases_url":"https://api.github.com/repos/rails/rails/releases{/id}","deployments_url":"https://api.github.com/repos/rails/rails/deployments","created_at":"2008-04-11T02:19:47Z","updated_at":"2025-11-10T02:03:47Z","pushed_at":"2025-11-10T00:33:52Z","git_url":"git://github.com/rails/rails.git","ssh_url":"git@github.com:rails/rails.git","clone_url":"https://github.com/rails/rails.git","svn_url":"https://github.com/rails/rails","homepage":"https://rubyonrails.org","size":271619,"stargazers_count":57840,"watchers_count":57840,"language":"Ruby","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":22025,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1341,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["activejob","activerecord","framework","html","mvc","rails","ruby"],"visibility":"public","forks":22025,"open_issues":1341,"watchers":57840,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/rails/rails/pulls/53264","html_url":"https://github.com/rails/rails/pull/53264","diff_url":"https://github.com/rails/rails/pull/53264.diff","patch_url":"https://github.com/rails/rails/pull/53264.patch","merged_at":"2024-10-10T16:18:04Z"},"body":"Since #53064 `arel_columns` is no longer a side-effect free helper method, so it runs on the spawned relation.\r\n\r\nFixes #53260.\r\n","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/53264/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/rails/issues/53264/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":14594188513,"node_id":"CE_lADNIULOmbI6Fs8AAAADZeGk4Q","url":"https://api.github.com/repos/rails/rails/issues/events/14594188513","actor":{"login":"kamipo","id":12642,"node_id":"MDQ6VXNlcjEyNjQy","avatar_url":"https://avatars.githubusercontent.com/u/12642?v=4","gravatar_id":"","url":"https://api.github.com/users/kamipo","html_url":"https://github.com/kamipo","followers_url":"https://api.github.com/users/kamipo/followers","following_url":"https://api.github.com/users/kamipo/following{/other_user}","gists_url":"https://api.github.com/users/kamipo/gists{/gist_id}","starred_url":"https://api.github.com/users/kamipo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kamipo/subscriptions","organizations_url":"https://api.github.com/users/kamipo/orgs","repos_url":"https://api.github.com/users/kamipo/repos","events_url":"https://api.github.com/users/kamipo/events{/privacy}","received_events_url":"https://api.github.com/users/kamipo/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2024-10-10T16:18:05Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/rails/rails/issues/comments/2405544126","html_url":"https://github.com/rails/rails/issues/53260#issuecomment-2405544126","issue_url":"https://api.github.com/repos/rails/rails/issues/53260","id":2405544126,"node_id":"IC_kwDNIULOj2Gwvg","user":{"login":"kamipo","id":12642,"node_id":"MDQ6VXNlcjEyNjQy","avatar_url":"https://avatars.githubusercontent.com/u/12642?v=4","gravatar_id":"","url":"https://api.github.com/users/kamipo","html_url":"https://github.com/kamipo","followers_url":"https://api.github.com/users/kamipo/followers","following_url":"https://api.github.com/users/kamipo/following{/other_user}","gists_url":"https://api.github.com/users/kamipo/gists{/gist_id}","starred_url":"https://api.github.com/users/kamipo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kamipo/subscriptions","organizations_url":"https://api.github.com/users/kamipo/orgs","repos_url":"https://api.github.com/users/kamipo/repos","events_url":"https://api.github.com/users/kamipo/events{/privacy}","received_events_url":"https://api.github.com/users/kamipo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-10T16:18:49Z","updated_at":"2024-10-10T16:18:49Z","body":"Thanks for the report. Fixed by #53264.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/comments/2405544126/reactions","total_count":2,"+1":0,"-1":0,"laugh":0,"hooray":2,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kamipo","id":12642,"node_id":"MDQ6VXNlcjEyNjQy","avatar_url":"https://avatars.githubusercontent.com/u/12642?v=4","gravatar_id":"","url":"https://api.github.com/users/kamipo","html_url":"https://github.com/kamipo","followers_url":"https://api.github.com/users/kamipo/followers","following_url":"https://api.github.com/users/kamipo/following{/other_user}","gists_url":"https://api.github.com/users/kamipo/gists{/gist_id}","starred_url":"https://api.github.com/users/kamipo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kamipo/subscriptions","organizations_url":"https://api.github.com/users/kamipo/orgs","repos_url":"https://api.github.com/users/kamipo/repos","events_url":"https://api.github.com/users/kamipo/events{/privacy}","received_events_url":"https://api.github.com/users/kamipo/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"cgunther","id":107416,"node_id":"MDQ6VXNlcjEwNzQxNg==","avatar_url":"https://avatars.githubusercontent.com/u/107416?v=4","gravatar_id":"","url":"https://api.github.com/users/cgunther","html_url":"https://github.com/cgunther","followers_url":"https://api.github.com/users/cgunther/followers","following_url":"https://api.github.com/users/cgunther/following{/other_user}","gists_url":"https://api.github.com/users/cgunther/gists{/gist_id}","starred_url":"https://api.github.com/users/cgunther/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cgunther/subscriptions","organizations_url":"https://api.github.com/users/cgunther/orgs","repos_url":"https://api.github.com/users/cgunther/repos","events_url":"https://api.github.com/users/cgunther/events{/privacy}","received_events_url":"https://api.github.com/users/cgunther/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-12-17T23:58:06Z","updated_at":"2024-12-17T23:58:06Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rails/rails/issues/53934","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/53934/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/53934/comments","events_url":"https://api.github.com/repos/rails/rails/issues/53934/events","html_url":"https://github.com/rails/rails/issues/53934","id":2737975230,"node_id":"I_kwDNIULOozIvvg","number":53934,"title":"`ActiveRecord::UnmodifiableRelation` occurs when passing a string to `.group` and calling `.count` then `.reload`.","user":{"login":"kehra","id":3517601,"node_id":"MDQ6VXNlcjM1MTc2MDE=","avatar_url":"https://avatars.githubusercontent.com/u/3517601?v=4","gravatar_id":"","url":"https://api.github.com/users/kehra","html_url":"https://github.com/kehra","followers_url":"https://api.github.com/users/kehra/followers","following_url":"https://api.github.com/users/kehra/following{/other_user}","gists_url":"https://api.github.com/users/kehra/gists{/gist_id}","starred_url":"https://api.github.com/users/kehra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kehra/subscriptions","organizations_url":"https://api.github.com/users/kehra/orgs","repos_url":"https://api.github.com/users/kehra/repos","events_url":"https://api.github.com/users/kehra/events{/privacy}","received_events_url":"https://api.github.com/users/kehra/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2024-12-13T09:49:39Z","updated_at":"2025-02-05T10:47:32Z","closed_at":"2024-12-18T16:36:29Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":8514,"node_id":"MDEwOlJlcG9zaXRvcnk4NTE0","name":"rails","full_name":"rails/rails","private":false,"owner":{"login":"rails","id":4223,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQyMjM=","avatar_url":"https://avatars.githubusercontent.com/u/4223?v=4","gravatar_id":"","url":"https://api.github.com/users/rails","html_url":"https://github.com/rails","followers_url":"https://api.github.com/users/rails/followers","following_url":"https://api.github.com/users/rails/following{/other_user}","gists_url":"https://api.github.com/users/rails/gists{/gist_id}","starred_url":"https://api.github.com/users/rails/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rails/subscriptions","organizations_url":"https://api.github.com/users/rails/orgs","repos_url":"https://api.github.com/users/rails/repos","events_url":"https://api.github.com/users/rails/events{/privacy}","received_events_url":"https://api.github.com/users/rails/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rails/rails","description":"Ruby on Rails","fork":false,"url":"https://api.github.com/repos/rails/rails","forks_url":"https://api.github.com/repos/rails/rails/forks","keys_url":"https://api.github.com/repos/rails/rails/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rails/rails/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rails/rails/teams","hooks_url":"https://api.github.com/repos/rails/rails/hooks","issue_events_url":"https://api.github.com/repos/rails/rails/issues/events{/number}","events_url":"https://api.github.com/repos/rails/rails/events","assignees_url":"https://api.github.com/repos/rails/rails/assignees{/user}","branches_url":"https://api.github.com/repos/rails/rails/branches{/branch}","tags_url":"https://api.github.com/repos/rails/rails/tags","blobs_url":"https://api.github.com/repos/rails/rails/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rails/rails/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rails/rails/git/refs{/sha}","trees_url":"https://api.github.com/repos/rails/rails/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rails/rails/statuses/{sha}","languages_url":"https://api.github.com/repos/rails/rails/languages","stargazers_url":"https://api.github.com/repos/rails/rails/stargazers","contributors_url":"https://api.github.com/repos/rails/rails/contributors","subscribers_url":"https://api.github.com/repos/rails/rails/subscribers","subscription_url":"https://api.github.com/repos/rails/rails/subscription","commits_url":"https://api.github.com/repos/rails/rails/commits{/sha}","git_commits_url":"https://api.github.com/repos/rails/rails/git/commits{/sha}","comments_url":"https://api.github.com/repos/rails/rails/comments{/number}","issue_comment_url":"https://api.github.com/repos/rails/rails/issues/comments{/number}","contents_url":"https://api.github.com/repos/rails/rails/contents/{+path}","compare_url":"https://api.github.com/repos/rails/rails/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rails/rails/merges","archive_url":"https://api.github.com/repos/rails/rails/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rails/rails/downloads","issues_url":"https://api.github.com/repos/rails/rails/issues{/number}","pulls_url":"https://api.github.com/repos/rails/rails/pulls{/number}","milestones_url":"https://api.github.com/repos/rails/rails/milestones{/number}","notifications_url":"https://api.github.com/repos/rails/rails/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rails/rails/labels{/name}","releases_url":"https://api.github.com/repos/rails/rails/releases{/id}","deployments_url":"https://api.github.com/repos/rails/rails/deployments","created_at":"2008-04-11T02:19:47Z","updated_at":"2025-11-10T02:03:47Z","pushed_at":"2025-11-10T00:33:52Z","git_url":"git://github.com/rails/rails.git","ssh_url":"git@github.com:rails/rails.git","clone_url":"https://github.com/rails/rails.git","svn_url":"https://github.com/rails/rails","homepage":"https://rubyonrails.org","size":271619,"stargazers_count":57840,"watchers_count":57840,"language":"Ruby","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":22025,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1341,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["activejob","activerecord","framework","html","mvc","rails","ruby"],"visibility":"public","forks":22025,"open_issues":1341,"watchers":57840,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"After upgrading from version 7.1 to 7.2, `ActiveRecord::UnmodifiableRelation` error started occurring.\r\n\r\nI pass a string as an argument to the `.group` method of ActiveRecord object and call the `.count` method. Then, after updating the associated records, I call the `.reload` method to refresh the state and attempt to call the `.count` method again, but it results in an `ActiveRecord::UnmodifiableRelation` error.\r\n\r\nI'm not sure whether this behavior is intentional, but since the error does not occur depending on the method arguments passed to the `.group` method, I created this issue.\r\n\r\n### Steps to reproduce\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  # gem \"rails\"\r\n  # If you want to test against edge Rails replace the previous line with this:\r\n  gem \"rails\", github: \"rails/rails\", branch: \"main\"\r\n\r\n  gem \"sqlite3\"\r\nend\r\n\r\nrequire \"active_record/railtie\"\r\nrequire \"minitest/autorun\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nENV[\"DATABASE_URL\"] = \"sqlite3::memory:\"\r\n\r\nclass TestApp < Rails::Application\r\n  config.load_defaults Rails::VERSION::STRING.to_f\r\n  config.eager_load = false\r\n  config.logger = Logger.new($stdout)\r\nend\r\nRails.application.initialize!\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :posts, force: true do |t|\r\n  end\r\n\r\n  create_table :comments, force: true do |t|\r\n    t.integer :post_id\r\n  end\r\nend\r\n\r\nclass Post < ActiveRecord::Base\r\n  has_many :comments\r\nend\r\n\r\nclass Comment < ActiveRecord::Base\r\n  belongs_to :post\r\nend\r\n\r\nclass BugTest < ActiveSupport::TestCase\r\n  def test_association_stuff\r\n    post = Post.create!\r\n    post.comments.create!\r\n\r\n    posts = Post.joins(:comments).group('comments.id')\r\n\r\n    assert_equal({1 => 1}, posts.count)\r\n\r\n    post.comments.create!\r\n\r\n    posts.reload # `ActiveRecord::UnmodifiableRelation` occurs here\r\n    assert_equal({1 => 1, 2 => 1}, posts.count)\r\n  end\r\nend\r\n```\r\n\r\n### Expected behavior\r\nWe can call `.reload` successfully.\r\n\r\n### Actual behavior\r\n`ActiveRecord::UnmodifiableRelation` occurs when we call `.reload`.\r\n\r\n### System configuration\r\n**Rails version**:\r\n7.2.2.1, 8.0(main)\r\n\r\n**Ruby version**:\r\n3.3","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/53934/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/rails/issues/53934/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"}]