{"url":"https://api.github.com/repos/rails/rails/issues/53368","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/53368/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/53368/comments","events_url":"https://api.github.com/repos/rails/rails/issues/53368/events","html_url":"https://github.com/rails/rails/issues/53368","id":2598201919,"node_id":"I_kwDNIULOmt1qPw","number":53368,"title":"Order-dependant test failure in railties with `GeneratorsTest#test_generator_suggestions_except_en_locale`","user":{"login":"Earlopain","id":14981592,"node_id":"MDQ6VXNlcjE0OTgxNTky","avatar_url":"https://avatars.githubusercontent.com/u/14981592?v=4","gravatar_id":"","url":"https://api.github.com/users/Earlopain","html_url":"https://github.com/Earlopain","followers_url":"https://api.github.com/users/Earlopain/followers","following_url":"https://api.github.com/users/Earlopain/following{/other_user}","gists_url":"https://api.github.com/users/Earlopain/gists{/gist_id}","starred_url":"https://api.github.com/users/Earlopain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Earlopain/subscriptions","organizations_url":"https://api.github.com/users/Earlopain/orgs","repos_url":"https://api.github.com/users/Earlopain/repos","events_url":"https://api.github.com/users/Earlopain/events{/privacy}","received_events_url":"https://api.github.com/users/Earlopain/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2024-10-18T19:03:01Z","updated_at":"2024-10-21T18:30:45Z","closed_at":"2024-10-21T18:30:45Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Steps to reproduce\r\nRunning with 31550306975da257c2eb02c16426e994f6cb5f6e\r\n```\r\n$ cd railties\r\n# If someone could explain how to use minitest_bisect, that would be great :smile: \r\n$ bin/test --seed 27653\r\nRun options: --seed 27653\r\n\r\n# Running:\r\n\r\n............................................................................................................................................................................................................E\r\n\r\nError:\r\nGeneratorsTest#test_generator_suggestions_except_en_locale:\r\nI18n::InvalidLocaleData: can not load translations from /home/earlopain/Documents/rails/tmp/d20241018-307935-921g0r/app/config/locales/en.yml: #<Errno::ENOENT: No such file or directory @ rb_sysopen - /home/earlopain/Documents/rails/tmp/d20241018-307935-921g0r/app/config/locales/en.yml>\r\n    /home/earlopain/.rbenv/versions/3.3.5/lib/ruby/gems/3.3.0/gems/i18n-1.14.5/lib/i18n/backend/base.rb:261:in `rescue in load_yml'\r\n    /home/earlopain/.rbenv/versions/3.3.5/lib/ruby/gems/3.3.0/gems/i18n-1.14.5/lib/i18n/backend/base.rb:253:in `load_yml'\r\n    /home/earlopain/.rbenv/versions/3.3.5/lib/ruby/gems/3.3.0/gems/i18n-1.14.5/lib/i18n/backend/base.rb:235:in `load_file'\r\n    /home/earlopain/.rbenv/versions/3.3.5/lib/ruby/gems/3.3.0/gems/i18n-1.14.5/lib/i18n/backend/base.rb:17:in `block in load_translations'\r\n    /home/earlopain/.rbenv/versions/3.3.5/lib/ruby/gems/3.3.0/gems/i18n-1.14.5/lib/i18n/backend/base.rb:16:in `each'\r\n    /home/earlopain/.rbenv/versions/3.3.5/lib/ruby/gems/3.3.0/gems/i18n-1.14.5/lib/i18n/backend/base.rb:16:in `load_translations'\r\n    /home/earlopain/.rbenv/versions/3.3.5/lib/ruby/gems/3.3.0/gems/i18n-1.14.5/lib/i18n/backend/simple.rb:84:in `init_translations'\r\n    /home/earlopain/.rbenv/versions/3.3.5/lib/ruby/gems/3.3.0/gems/i18n-1.14.5/lib/i18n/backend/simple.rb:50:in `available_locales'\r\n    /home/earlopain/.rbenv/versions/3.3.5/lib/ruby/gems/3.3.0/gems/i18n-1.14.5/lib/i18n/config.rb:45:in `available_locales'\r\n    /home/earlopain/.rbenv/versions/3.3.5/lib/ruby/gems/3.3.0/gems/i18n-1.14.5/lib/i18n/config.rb:51:in `available_locales_set'\r\n    /home/earlopain/.rbenv/versions/3.3.5/lib/ruby/gems/3.3.0/gems/i18n-1.14.5/lib/i18n.rb:374:in `locale_available?'\r\n    /home/earlopain/.rbenv/versions/3.3.5/lib/ruby/gems/3.3.0/gems/i18n-1.14.5/lib/i18n.rb:380:in `enforce_available_locales!'\r\n    /home/earlopain/.rbenv/versions/3.3.5/lib/ruby/gems/3.3.0/gems/i18n-1.14.5/lib/i18n/config.rb:36:in `default_locale='\r\n    /home/earlopain/.rbenv/versions/3.3.5/lib/ruby/gems/3.3.0/gems/i18n-1.14.5/lib/i18n.rb:74:in `default_locale='\r\n    test/generators_test.rb:62:in `ensure in test_generator_suggestions_except_en_locale'\r\n    test/generators_test.rb:62:in `test_generator_suggestions_except_en_locale'\r\n\r\n\r\nbin/test test/generators_test.rb:48\r\n\r\n.E\r\n\r\nError:\r\nRails::Command::RoutesTest#test_rails_routes_with_controller_search_key:\r\nRuntimeError: rails command failed (1): bin/rails routes -c cart 2>&1\r\nFrozenError: can't modify frozen Array: [\"/home/earlopain/Documents/rails/tmp/d20241018-307935-921g0r/app/lib\"]\r\n\r\n    test/isolation/abstract_unit.rb:420:in `rails'\r\n    test/commands/routes_test.rb:421:in `run_routes_command'\r\n    test/commands/routes_test.rb:131:in `block in <class:RoutesTest>'\r\n# And many more thereafter\r\n```\r\n\r\n### Extra details\r\nI have traced this back to be caused by the following test https://github.com/rails/rails/blob/094aeca1378fd901510959a956fc887df745f153/railties/test/application/configuration/custom_test.rb. Stubbing this one out resolves the failures. I have no idea about what the solution would be, some global i18n state seems to be modified.","closed_by":{"login":"rafaelfranca","id":47848,"node_id":"MDQ6VXNlcjQ3ODQ4","avatar_url":"https://avatars.githubusercontent.com/u/47848?v=4","gravatar_id":"","url":"https://api.github.com/users/rafaelfranca","html_url":"https://github.com/rafaelfranca","followers_url":"https://api.github.com/users/rafaelfranca/followers","following_url":"https://api.github.com/users/rafaelfranca/following{/other_user}","gists_url":"https://api.github.com/users/rafaelfranca/gists{/gist_id}","starred_url":"https://api.github.com/users/rafaelfranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rafaelfranca/subscriptions","organizations_url":"https://api.github.com/users/rafaelfranca/orgs","repos_url":"https://api.github.com/users/rafaelfranca/repos","events_url":"https://api.github.com/users/rafaelfranca/events{/privacy}","received_events_url":"https://api.github.com/users/rafaelfranca/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rails/rails/issues/53368/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/rails/issues/53368/timeline","performed_via_github_app":null,"state_reason":"completed"}