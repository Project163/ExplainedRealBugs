{"url":"https://api.github.com/repos/rails/rails/issues/55525","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/55525/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/55525/comments","events_url":"https://api.github.com/repos/rails/rails/issues/55525/events","html_url":"https://github.com/rails/rails/issues/55525","id":3340354380,"node_id":"I_kwDNIULOxxnDTA","number":55525,"title":"`ActiveStorage::Service::S3ServiceTest#test_uploading_a_large_object_in_multiple_parts` gets `RailsStrictWarnings::WarningError`","user":{"login":"yahonda","id":73684,"node_id":"MDQ6VXNlcjczNjg0","avatar_url":"https://avatars.githubusercontent.com/u/73684?v=4","gravatar_id":"","url":"https://api.github.com/users/yahonda","html_url":"https://github.com/yahonda","followers_url":"https://api.github.com/users/yahonda/followers","following_url":"https://api.github.com/users/yahonda/following{/other_user}","gists_url":"https://api.github.com/users/yahonda/gists{/gist_id}","starred_url":"https://api.github.com/users/yahonda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yahonda/subscriptions","organizations_url":"https://api.github.com/users/yahonda/orgs","repos_url":"https://api.github.com/users/yahonda/repos","events_url":"https://api.github.com/users/yahonda/events{/privacy}","received_events_url":"https://api.github.com/users/yahonda/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":664533972,"node_id":"MDU6TGFiZWw2NjQ1MzM5NzI=","url":"https://api.github.com/repos/rails/rails/labels/activestorage","name":"activestorage","color":"bfd4f2","default":false,"description":null},{"id":776781281,"node_id":"MDU6TGFiZWw3NzY3ODEyODE=","url":"https://api.github.com/repos/rails/rails/labels/ci%20issues","name":"ci issues","color":"aaafff","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2025-08-21T05:36:23Z","updated_at":"2025-08-24T20:07:06Z","closed_at":"2025-08-24T20:07:06Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Managed to reproduce CI failure at https://buildkite.com/rails/rails-nightly/builds/2709#0198c422-4221-41bc-9dc4-e0d09f494d79/1197-1277\n\n### Steps to reproduce\n\n```ruby\ngit clone https://github.com/rails/rails\ncd rails/activestorage\n```\n- Edit the `test/service/configurations.yml` and enable the s3 one (values are masked)\n```ruby\ns3:\n  service: S3\n  access_key_id: \"***\"\n  secret_access_key: \"***\"\n  region: \"***\"\n  bucket: \"***\"\n```\n\n```ruby\nbundle update aws-sdk-s3 --conservative\nRAILS_STRICT_WARNINGS=1 bin/test test/service/s3_service_test.rb -n test_compose\n```\n\n### Expected behavior\nIt should pass.\n\n### Actual behavior\n\nIt raises the `RailsStrictWarnings::WarningError` because of the \"Called deprecated method `upload_stream` of Aws::S3::Object. Use `Aws::S3::TransferManager#upload_stream` instead.\" warning since `aws-sdk-s3` 1.197.0 \n\n```ruby\n$ bundle update aws-sdk-s3 --conservative\nFetching gem metadata from https://rubygems.org/.........\nResolving dependencies...\nResolving dependencies...\nUsing aws-sdk-core 3.229.0 (was 3.215.1)\nUsing aws-sdk-s3 1.197.0 (was 1.177.0)\nBundle updated!\n1 installed gem you directly depend on is looking for funding.\n  Run `bundle fund` for details\n$ git diff\ndiff --git a/Gemfile.lock b/Gemfile.lock\nindex 5d1be453e1..86450fb7c7 100644\n--- a/Gemfile.lock\n+++ b/Gemfile.lock\n@@ -126,16 +126,19 @@ GEM\n     ast (2.4.2)\n     aws-eventstream (1.3.0)\n     aws-partitions (1.1037.0)\n-    aws-sdk-core (3.215.1)\n+    aws-sdk-core (3.229.0)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n+      bigdecimal\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n-    aws-sdk-s3 (1.177.0)\n-      aws-sdk-core (~> 3, >= 3.210.0)\n+    aws-sdk-s3 (1.197.0)\n+      aws-sdk-core (~> 3, >= 3.228.0)\n       aws-sdk-kms (~> 1)\n       aws-sigv4 (~> 1.5)\n     aws-sdk-sns (1.92.0)\n$ RAILS_STRICT_WARNINGS=1 bin/test test/service/s3_service_test.rb -n test_compose\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/capybara-3.40.0/lib/capybara/session/config.rb:95: warning: URI::RFC3986_PARSER.make_regexp is obsolete. Use URI::RFC2396_PARSER.make_regexp explicitly.\n== 20170806125915 CreateActiveStorageTables: migrating ========================\n-- create_table(:active_storage_blobs, {id: :primary_key})\n   -> 0.0006s\n-- create_table(:active_storage_attachments, {id: :primary_key})\n   -> 0.0005s\n-- create_table(:active_storage_variant_records, {id: :primary_key})\n   -> 0.0004s\n== 20170806125915 CreateActiveStorageTables: migrated (0.0015s) ===============\n\n==  ActiveStorageCreateUsers: migrating =======================================\n-- create_table(:users)\n   -> 0.0002s\n==  ActiveStorageCreateUsers: migrated (0.0002s) ==============================\n\n==  ActiveStorageCreateGroups: migrating ======================================\n-- create_table(:groups)\n   -> 0.0002s\n==  ActiveStorageCreateGroups: migrated (0.0002s) =============================\n\nRun options: -n test_compose --seed 5866\n\n# Running:\n\n#################### DEPRECATION WARNING ####################\nCalled deprecated method `upload_stream` of Aws::S3::Object. Use `Aws::S3::TransferManager#upload_stream` instead.\nMethod `upload_stream` will be removed in next major version.\n#############################################################\n/home/yahonda/src/github.com/rails/rails/activestorage/lib/active_storage/service/s3_service.rb:103:in 'ActiveStorage::Service::S3Service#compose'\n/home/yahonda/src/github.com/rails/rails/activestorage/test/service/shared_service_tests.rb:156:in 'block (2 levels) in <module:SharedServiceTests>'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest/test.rb:94:in 'block (2 levels) in Minitest::Test#run'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest/test.rb:190:in 'Minitest::Test#capture_exceptions'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest/test.rb:89:in 'block in Minitest::Test#run'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:368:in 'Minitest::Runnable#time_it'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest/test.rb:88:in 'Minitest::Test#run'\n/home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/executor/test_helper.rb:5:in 'block in ActiveSupport::Executor::TestHelper#run'\n/home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/execution_wrapper.rb:104:in 'ActiveSupport::ExecutionWrapper.perform'\n/home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/executor/test_helper.rb:5:in 'ActiveSupport::Executor::TestHelper#run'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:1208:in 'Minitest.run_one_method'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:447:in 'Minitest::Runnable.run_one_method'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:434:in 'block (2 levels) in Minitest::Runnable.run'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:430:in 'Array#each'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:430:in 'block in Minitest::Runnable.run'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:472:in 'Minitest::Runnable.on_signal'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:459:in 'Minitest::Runnable.with_info_handler'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:429:in 'Minitest::Runnable.run'\n/home/yahonda/src/github.com/rails/rails/railties/lib/rails/test_unit/line_filtering.rb:10:in 'Rails::LineFiltering#run'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:332:in 'block in Minitest.__run'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:332:in 'Array#map'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:332:in 'Minitest.__run'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:288:in 'Minitest.run'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:86:in 'block in Minitest.autorun'\nE\n\nError:\nActiveStorage::Service::S3ServiceTest#test_compose:\nRailsStrictWarnings::WarningError: #################### DEPRECATION WARNING ####################\nCalled deprecated method `upload_stream` of Aws::S3::Object. Use `Aws::S3::TransferManager#upload_stream` instead.\nMethod `upload_stream` will be removed in next major version.\n#############################################################\n/home/yahonda/src/github.com/rails/rails/activestorage/lib/active_storage/service/s3_service.rb:103:in 'ActiveStorage::Service::S3Service#compose'\n/home/yahonda/src/github.com/rails/rails/activestorage/test/service/shared_service_tests.rb:156:in 'block (2 levels) in <module:SharedServiceTests>'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest/test.rb:94:in 'block (2 levels) in Minitest::Test#run'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest/test.rb:190:in 'Minitest::Test#capture_exceptions'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest/test.rb:89:in 'block in Minitest::Test#run'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:368:in 'Minitest::Runnable#time_it'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest/test.rb:88:in 'Minitest::Test#run'\n/home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/executor/test_helper.rb:5:in 'block in ActiveSupport::Executor::TestHelper#run'\n/home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/execution_wrapper.rb:104:in 'ActiveSupport::ExecutionWrapper.perform'\n/home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/executor/test_helper.rb:5:in 'ActiveSupport::Executor::TestHelper#run'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:1208:in 'Minitest.run_one_method'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:447:in 'Minitest::Runnable.run_one_method'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:434:in 'block (2 levels) in Minitest::Runnable.run'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:430:in 'Array#each'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:430:in 'block in Minitest::Runnable.run'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:472:in 'Minitest::Runnable.on_signal'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:459:in 'Minitest::Runnable.with_info_handler'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:429:in 'Minitest::Runnable.run'\n/home/yahonda/src/github.com/rails/rails/railties/lib/rails/test_unit/line_filtering.rb:10:in 'Rails::LineFiltering#run'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:332:in 'block in Minitest.__run'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:332:in 'Array#map'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:332:in 'Minitest.__run'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:288:in 'Minitest.run'\n/home/yahonda/.local/share/mise/installs/ruby/3.4.5/lib/ruby/gems/3.4.0/gems/minitest-5.25.5/lib/minitest.rb:86:in 'block in Minitest.autorun'\n\n    /home/yahonda/src/github.com/rails/rails/tools/strict_warnings.rb:35:in 'RailsStrictWarnings#warn'\n\n\nbin/test test/service/shared_service_tests.rb:142\n\n\n\nFinished in 2.519935s, 0.3968 runs/s, 0.0000 assertions/s.\n1 runs, 0 assertions, 0 failures, 1 errors, 0 skips\n$\n``` \n\n### System configuration\n\n**Rails version**:  main branch\n\n**Ruby version**:  ruby 3.4.5 (2025-07-16 revision 20cda200d3) +PRISM [x86_64-linux]\n\n","closed_by":{"login":"byroot","id":44640,"node_id":"MDQ6VXNlcjQ0NjQw","avatar_url":"https://avatars.githubusercontent.com/u/44640?v=4","gravatar_id":"","url":"https://api.github.com/users/byroot","html_url":"https://github.com/byroot","followers_url":"https://api.github.com/users/byroot/followers","following_url":"https://api.github.com/users/byroot/following{/other_user}","gists_url":"https://api.github.com/users/byroot/gists{/gist_id}","starred_url":"https://api.github.com/users/byroot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/byroot/subscriptions","organizations_url":"https://api.github.com/users/byroot/orgs","repos_url":"https://api.github.com/users/byroot/repos","events_url":"https://api.github.com/users/byroot/events{/privacy}","received_events_url":"https://api.github.com/users/byroot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rails/rails/issues/55525/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/rails/issues/55525/timeline","performed_via_github_app":null,"state_reason":"completed"}