{"url":"https://api.github.com/repos/rails/rails/issues/49210","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/49210/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/49210/comments","events_url":"https://api.github.com/repos/rails/rails/issues/49210/events","html_url":"https://github.com/rails/rails/issues/49210","id":1888756645,"node_id":"I_kwDNIULOcJQjpQ","number":49210,"title":".dockerignore is not excluding pids, storage directories","user":{"login":"rubys","id":4815,"node_id":"MDQ6VXNlcjQ4MTU=","avatar_url":"https://avatars.githubusercontent.com/u/4815?v=4","gravatar_id":"","url":"https://api.github.com/users/rubys","html_url":"https://github.com/rubys","followers_url":"https://api.github.com/users/rubys/followers","following_url":"https://api.github.com/users/rubys/following{/other_user}","gists_url":"https://api.github.com/users/rubys/gists{/gist_id}","starred_url":"https://api.github.com/users/rubys/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rubys/subscriptions","organizations_url":"https://api.github.com/users/rubys/orgs","repos_url":"https://api.github.com/users/rubys/repos","events_url":"https://api.github.com/users/rubys/events{/privacy}","received_events_url":"https://api.github.com/users/rubys/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2023-09-09T14:06:24Z","updated_at":"2023-09-09T18:28:46Z","closed_at":"2023-09-09T18:28:46Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Steps to reproduce\r\n\r\n```sh\r\nrm -rf demo\r\nrails new demo --main\r\ncd demo\r\ntouch tmp/pids/server.pid\r\ndocker buildx build . -t rails-demo\r\ndocker run --rm -i -t rails-demo ls -l tmp/pids\r\n```\r\n\r\n### Expected behavior\r\nNo `server.pid` in the container\r\n\r\n### Actual behavior\r\n`server.pid` file exists in container\r\n\r\n### System configuration\r\n**Rails version**: `--main`\r\n\r\n**Ruby version**:\r\n\r\nruby 3.2.2 (2023-03-30 revision e51014f9c0) [arm64-darwin22]\r\n\r\n**Additional information**\r\n\r\nThe problem was first reported as [App deployment getting stuck at pushing image to fly](https://community.fly.io/t/app-deployment-getting-stuck-at-pushing-image-to-fly/15140/1).  The problem was determined to be that the storage directory was being uploaded making the image too big.  The identified solution was to remove two lines\r\n\r\n```diff\r\n # Ignore pidfiles, but keep the directory.\r\n /tmp/pids/*\r\n-!/tmp/pids/  # <-- bug: This line should be deleted, is basically making the previous line useless, all files inside /tmp/pids are being sent to the context\r\n !/tmp/pids/.keep\r\n\r\n # Ignore storage (uploaded files in development and any SQLite databases).\r\n /storage/*\r\n !/storage/.keep\r\n /tmp/storage/*\r\n-!/tmp/storage/ # <-- bug: This line should be deleted, is also making the previous line useless, all files inside /tmp/storage are being sent to the context. This directory had 5.5 GB of data in my case.\r\n !/tmp/storage/.keep\r\n```","closed_by":{"login":"rafaelfranca","id":47848,"node_id":"MDQ6VXNlcjQ3ODQ4","avatar_url":"https://avatars.githubusercontent.com/u/47848?v=4","gravatar_id":"","url":"https://api.github.com/users/rafaelfranca","html_url":"https://github.com/rafaelfranca","followers_url":"https://api.github.com/users/rafaelfranca/followers","following_url":"https://api.github.com/users/rafaelfranca/following{/other_user}","gists_url":"https://api.github.com/users/rafaelfranca/gists{/gist_id}","starred_url":"https://api.github.com/users/rafaelfranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rafaelfranca/subscriptions","organizations_url":"https://api.github.com/users/rafaelfranca/orgs","repos_url":"https://api.github.com/users/rafaelfranca/repos","events_url":"https://api.github.com/users/rafaelfranca/events{/privacy}","received_events_url":"https://api.github.com/users/rafaelfranca/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rails/rails/issues/49210/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/rails/issues/49210/timeline","performed_via_github_app":null,"state_reason":"completed"}