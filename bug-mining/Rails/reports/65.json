{"url":"https://api.github.com/repos/rails/rails/issues/48770","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/48770/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/48770/comments","events_url":"https://api.github.com/repos/rails/rails/issues/48770/events","html_url":"https://github.com/rails/rails/issues/48770","id":1814236326,"node_id":"I_kwDNIULObCMMpg","number":48770,"title":"HashWithIndifferentAccess#to_proc does not map keys to values as Hash#to_proc does","user":{"login":"jasonkarns","id":119972,"node_id":"MDQ6VXNlcjExOTk3Mg==","avatar_url":"https://avatars.githubusercontent.com/u/119972?v=4","gravatar_id":"","url":"https://api.github.com/users/jasonkarns","html_url":"https://github.com/jasonkarns","followers_url":"https://api.github.com/users/jasonkarns/followers","following_url":"https://api.github.com/users/jasonkarns/following{/other_user}","gists_url":"https://api.github.com/users/jasonkarns/gists{/gist_id}","starred_url":"https://api.github.com/users/jasonkarns/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasonkarns/subscriptions","organizations_url":"https://api.github.com/users/jasonkarns/orgs","repos_url":"https://api.github.com/users/jasonkarns/repos","events_url":"https://api.github.com/users/jasonkarns/events{/privacy}","received_events_url":"https://api.github.com/users/jasonkarns/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":107194,"node_id":"MDU6TGFiZWwxMDcxOTQ=","url":"https://api.github.com/repos/rails/rails/labels/activesupport","name":"activesupport","color":"FC9300","default":false,"description":null},{"id":41328116,"node_id":"MDU6TGFiZWw0MTMyODExNg==","url":"https://api.github.com/repos/rails/rails/labels/attached%20PR","name":"attached PR","color":"006b75","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2023-07-20T15:13:09Z","updated_at":"2023-11-17T19:54:59Z","closed_at":"2023-10-04T07:56:59Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"`Hash#to_proc` returns a proc that maps key to its value in the hash.\r\n\r\n`HashWithIndifferentAccess#to_proc` however, does not generate a proc that behaves similarly.\r\n\r\nThere are two distinct behaviors that deviate from expections. Firstly, since HWIA normalizes symbol keys to strings internally, then HWIA#to_proc will _only_ work with string keys. (symbol keys map to nil). If a HWIA is constructed with symbol keys, then it should be expected that `#to_proc` honor that form.\r\n\r\nThe more general behavior, I think, is that one would expect a HWIA#to_proc to still map keys indifferently. So even if the HWIA were constructed with string keys, it should still accept symbols as well, since that is the point of HWIA (and since the proc is intended to essentially equate to `#[]`).\r\n\r\n### Steps to reproduce\r\n\r\nRepro gist: https://gist.github.com/jasonkarns/b8cfea9d681f3754648d807dc6710d63\r\n\r\n```ruby\r\nregular_hash = {a: 1, b: 2}\r\nindifferent_hash = regular_hash.with_indifferent_access\r\n\r\nkeys = regular_hash.keys # symbol keys\r\n\r\nkeys.map(&indifferent_hash)\r\n```\r\n\r\n### Expected behavior\r\n\r\nI would expect the result to be `[1,2]` just as `keys.map(&regular_hash)` would return.\r\n\r\n### Actual behavior\r\n\r\nActual result is `[nil, nil]`\r\n\r\n### System configuration\r\n**Rails version**: 7.0.6\r\n\r\n**Ruby version**: 3.1.3\r\n","closed_by":{"login":"rafaelfranca","id":47848,"node_id":"MDQ6VXNlcjQ3ODQ4","avatar_url":"https://avatars.githubusercontent.com/u/47848?v=4","gravatar_id":"","url":"https://api.github.com/users/rafaelfranca","html_url":"https://github.com/rafaelfranca","followers_url":"https://api.github.com/users/rafaelfranca/followers","following_url":"https://api.github.com/users/rafaelfranca/following{/other_user}","gists_url":"https://api.github.com/users/rafaelfranca/gists{/gist_id}","starred_url":"https://api.github.com/users/rafaelfranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rafaelfranca/subscriptions","organizations_url":"https://api.github.com/users/rafaelfranca/orgs","repos_url":"https://api.github.com/users/rafaelfranca/repos","events_url":"https://api.github.com/users/rafaelfranca/events{/privacy}","received_events_url":"https://api.github.com/users/rafaelfranca/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rails/rails/issues/48770/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/rails/issues/48770/timeline","performed_via_github_app":null,"state_reason":"completed"}