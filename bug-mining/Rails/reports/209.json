{"url":"https://api.github.com/repos/rails/rails/issues/55161","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/55161/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/55161/comments","events_url":"https://api.github.com/repos/rails/rails/issues/55161/events","html_url":"https://github.com/rails/rails/issues/55161","id":3122533275,"node_id":"I_kwDNIULOuh4Tmw","number":55161,"title":"When rendering a partial, any mention of the string \"render\" inside a `cache` block results in the logged error message \"Couldn't find template for digesting: strings/string\"","user":{"login":"cannikin","id":300,"node_id":"MDQ6VXNlcjMwMA==","avatar_url":"https://avatars.githubusercontent.com/u/300?v=4","gravatar_id":"","url":"https://api.github.com/users/cannikin","html_url":"https://github.com/cannikin","followers_url":"https://api.github.com/users/cannikin/followers","following_url":"https://api.github.com/users/cannikin/following{/other_user}","gists_url":"https://api.github.com/users/cannikin/gists{/gist_id}","starred_url":"https://api.github.com/users/cannikin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cannikin/subscriptions","organizations_url":"https://api.github.com/users/cannikin/orgs","repos_url":"https://api.github.com/users/cannikin/repos","events_url":"https://api.github.com/users/cannikin/events{/privacy}","received_events_url":"https://api.github.com/users/cannikin/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":3666649,"node_id":"MDU6TGFiZWwzNjY2NjQ5","url":"https://api.github.com/repos/rails/rails/labels/actionview","name":"actionview","color":"d7e102","default":false,"description":null},{"id":41328116,"node_id":"MDU6TGFiZWw0MTMyODExNg==","url":"https://api.github.com/repos/rails/rails/labels/attached%20PR","name":"attached PR","color":"006b75","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2025-06-05T20:17:17Z","updated_at":"2025-08-06T16:46:07Z","closed_at":"2025-08-06T16:46:07Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Steps to reproduce\n\nCreate a file `_partial.html.erb` with the following contents alongside the minimal reproduction shown below:\n\n```erb\n<%# _partial.html.erb %>\n\n<% cache \"key\" do %>\n  <div class=\"render flex\" data-action=\"controller#render other-controller#click\">\n    Hello, world!\n  </div>\n<% end %>\n```\n\nMinimal reproduction:\n\n```\n# frozen_string_literal: true\n\nrequire \"bundler/inline\"\n\ngemfile(true) do\n  source \"https://rubygems.org\"\n\n  gem \"rails\"\nend\n\nrequire \"action_controller/railtie\"\nrequire \"action_view/railtie\"\nrequire \"minitest/autorun\"\n\nputs \"#{Rails::VERSION::STRING.to_f}\"\n\nclass TestApp < Rails::Application\n  config.load_defaults Rails::VERSION::STRING.to_f\n  config.eager_load = false\n  config.logger = Logger.new($stdout)\n  config.secret_key_base = \"secret_key_base\"\n  config.action_controller.perform_caching = true\n  config.action_controller.enable_fragment_cache_logging = true\n  config.cache_store = :null_store\n  config.paths[\"app/views\"] << File.expand_path(\".\")\nend\nRails.application.initialize!\n\nclass BugTest < ActionView::TestCase\n\n  # this render works fine\n  def test_regular_erb_render\n    render inline: <<~ERB\n      <% cache \"key\" do %>\n        <div class=\"render flex\" data-action=\"controller#render other-controller#click\">\n          Hello, world!\n        </div>\n      <% end %>\n    ERB\n\n    assert true\n  end\n\n  # rendering the same code, but as nested inline render works fine\n  def test_nested_inline_render\n    nested_partial = <<~ERB\n      <% cache \"key\" do %>\n        <div class=\"render flex\" data-action=\"controller#render other-controller#click\">\n          Hello, world!\n        </div>\n      <% end %>\n    ERB\n\n    render inline: <<~ERB, locals: { nested_partial: nested_partial }\n      <%= render inline: nested_partial %>\n    ERB\n\n    assert true\n  end\n\n  # rendering the same code, but as a partial on the file system fails\n  def test_file_partial\n    render inline: <<~ERB\n      <%= render partial: \"partial\" %>\n    ERB\n\n    assert false, \"Check for 'Couldn't find template for digesting: flexes/flex' in log output ↑\"\n  end\nend\n```\n\n### Expected behavior\n\nEverything should render fine, cache is written, no error messages output.\n\n### Actual behavior\n\nWhen running the third test `test_file_partial` the logs will show an error message:\n\n```\nCouldn't find template for digesting: flexes/flex\nCouldn't find template for digesting: others/other\n```\n\nIf the string `render` appears anywhere in the partial, anything following will be assumed to be a template name (ie. `flex` in the above example), and Rails will attempt to digest it for the cache key.\n\nIt also occurs even if another symbol separates the two, like in the Stimulus action `turbo:before-stream-render@document->leaderboard#render` the error message will read \"Couldn't find template for digesting: documents/document\".  This is how I actually found the bug originally—removing the Stimulus action string in my code made the error go away.\n\nThis only occurs inside of a `cache` block, and only if the template that contains it is nested at least one level deep in partial rendering, and that partial is on the file system (as seen above it wasn't an issue when rendering an inline partial).\n\n### System configuration\n\n**Rails version**: 8.0\n\n**Ruby version**: 3.4.2\n","closed_by":{"login":"tenderlove","id":3124,"node_id":"MDQ6VXNlcjMxMjQ=","avatar_url":"https://avatars.githubusercontent.com/u/3124?v=4","gravatar_id":"","url":"https://api.github.com/users/tenderlove","html_url":"https://github.com/tenderlove","followers_url":"https://api.github.com/users/tenderlove/followers","following_url":"https://api.github.com/users/tenderlove/following{/other_user}","gists_url":"https://api.github.com/users/tenderlove/gists{/gist_id}","starred_url":"https://api.github.com/users/tenderlove/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tenderlove/subscriptions","organizations_url":"https://api.github.com/users/tenderlove/orgs","repos_url":"https://api.github.com/users/tenderlove/repos","events_url":"https://api.github.com/users/tenderlove/events{/privacy}","received_events_url":"https://api.github.com/users/tenderlove/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rails/rails/issues/55161/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/rails/issues/55161/timeline","performed_via_github_app":null,"state_reason":"completed"}