{"url":"https://api.github.com/repos/rails/rails/issues/46784","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/46784/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/46784/comments","events_url":"https://api.github.com/repos/rails/rails/issues/46784/events","html_url":"https://github.com/rails/rails/issues/46784","id":1505648136,"node_id":"I_kwDNIULOWb5eCA","number":46784,"title":"raw_post being empty for \"Transfer-Encoding: chunked\"","user":{"login":"tooooooooomy","id":2306108,"node_id":"MDQ6VXNlcjIzMDYxMDg=","avatar_url":"https://avatars.githubusercontent.com/u/2306108?v=4","gravatar_id":"","url":"https://api.github.com/users/tooooooooomy","html_url":"https://github.com/tooooooooomy","followers_url":"https://api.github.com/users/tooooooooomy/followers","following_url":"https://api.github.com/users/tooooooooomy/following{/other_user}","gists_url":"https://api.github.com/users/tooooooooomy/gists{/gist_id}","starred_url":"https://api.github.com/users/tooooooooomy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tooooooooomy/subscriptions","organizations_url":"https://api.github.com/users/tooooooooomy/orgs","repos_url":"https://api.github.com/users/tooooooooomy/repos","events_url":"https://api.github.com/users/tooooooooomy/events{/privacy}","received_events_url":"https://api.github.com/users/tooooooooomy/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":107189,"node_id":"MDU6TGFiZWwxMDcxODk=","url":"https://api.github.com/repos/rails/rails/labels/actionpack","name":"actionpack","color":"FFF700","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2022-12-21T03:15:15Z","updated_at":"2023-03-12T02:42:51Z","closed_at":"2023-03-12T02:42:05Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"`raw_post` of chunked request is empty. I would like to open a feature request to handle chunked request by action pack.\r\nI found the same issue was raised by @hahmed and he sent [the PR to fix it](https://github.com/rails/rails/pull/37423) but was closed at that time.\r\nThe reason why the PR closed is the problem was solved with Puma by adding CONTENT_LENGTH request header at the Puma layer by [this PR](https://github.com/puma/puma/pull/2287).\r\nHowever, the same problem still happens with unicorn, thin and webrick at least.\r\nIt is helpful to us application developers if this problem would be taken care by rails so that we won't have to check neither the request is chunked nor which rack http server is used.\r\n\r\n### Steps to reproduce\r\nI prepared environments to reproduce the problem via docker. Please download it and follow the instruction of README.\r\nhttps://github.com/kazu9su/rails-experiment\r\n\r\n### Expected behavior\r\nIf the chunked request is sent to the rails server, application can read the `raw_post` with any rack http server.\r\n\r\n### Actual behavior\r\nWe can access to the request body with `raw_post` with only the rack http server which buffers the request body upfront like Puma.\r\n\r\n* Reproduced the problem with...\r\n  * Puma 4.3.3(The version before [Content-Length change](https://github.com/puma/puma/pull/2287) was merged)\r\n  * Unicorn 6.1.0\r\n  * Thin 1.8.1\r\n  * Webrick 1.7.0","closed_by":{"login":"tooooooooomy","id":2306108,"node_id":"MDQ6VXNlcjIzMDYxMDg=","avatar_url":"https://avatars.githubusercontent.com/u/2306108?v=4","gravatar_id":"","url":"https://api.github.com/users/tooooooooomy","html_url":"https://github.com/tooooooooomy","followers_url":"https://api.github.com/users/tooooooooomy/followers","following_url":"https://api.github.com/users/tooooooooomy/following{/other_user}","gists_url":"https://api.github.com/users/tooooooooomy/gists{/gist_id}","starred_url":"https://api.github.com/users/tooooooooomy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tooooooooomy/subscriptions","organizations_url":"https://api.github.com/users/tooooooooomy/orgs","repos_url":"https://api.github.com/users/tooooooooomy/repos","events_url":"https://api.github.com/users/tooooooooomy/events{/privacy}","received_events_url":"https://api.github.com/users/tooooooooomy/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rails/rails/issues/46784/reactions","total_count":2,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":2},"timeline_url":"https://api.github.com/repos/rails/rails/issues/46784/timeline","performed_via_github_app":null,"state_reason":"completed"}