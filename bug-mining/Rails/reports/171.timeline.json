[{"url":"https://api.github.com/repos/rails/rails/issues/comments/2521814735","html_url":"https://github.com/rails/rails/issues/53858#issuecomment-2521814735","issue_url":"https://api.github.com/repos/rails/rails/issues/53858","id":2521814735,"node_id":"IC_kwDNIULOlk_Wzw","user":{"login":"yahonda","id":73684,"node_id":"MDQ6VXNlcjczNjg0","avatar_url":"https://avatars.githubusercontent.com/u/73684?v=4","gravatar_id":"","url":"https://api.github.com/users/yahonda","html_url":"https://github.com/yahonda","followers_url":"https://api.github.com/users/yahonda/followers","following_url":"https://api.github.com/users/yahonda/following{/other_user}","gists_url":"https://api.github.com/users/yahonda/gists{/gist_id}","starred_url":"https://api.github.com/users/yahonda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yahonda/subscriptions","organizations_url":"https://api.github.com/users/yahonda/orgs","repos_url":"https://api.github.com/users/yahonda/repos","events_url":"https://api.github.com/users/yahonda/events{/privacy}","received_events_url":"https://api.github.com/users/yahonda/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-12-06T00:30:34Z","updated_at":"2024-12-06T00:30:34Z","body":"Somehow, it only fails when the postgresql adapter is used.\r\n\r\n- Steps to reproduce\r\n```ruby\r\nfor i in sqlite3 mysql2 trilogy postgresql\r\ndo\r\necho $i\r\nARCONN=$i bin/test test/cases/instrumentation_test.rb --seed 49010 -n \"/^(?:ActiveRecord::TransactionInSqlActiveRecordPayloadTest#(?:test_payload_without_an_open_transaction)|ActiveRecord::InstrumentationTest#(?:test_payload_connection_with_query_cache_enabled))$/\" -v\r\ndone\r\n```\r\n\r\n- Actual results with all bundled adapters\r\n```ruby\r\n$ for i in sqlite3 mysql2 trilogy postgresql;  do echo $i;  ARCONN=$i bin/test test/cases/instrumentation_test.rb --seed 49010 -n \"/^(?:ActiveRecord::TransactionInSqlActiveRecordPayloadTest#(?:test_payload_without_an_open_transaction)|ActiveRecord::InstrumentationTest#(?:test_payload_connection_with_query_cache_enabled))$/\" -v; done\r\nsqlite3\r\nUsing sqlite3\r\nRun options: --seed 49010 -n \"/^(?:ActiveRecord::TransactionInSqlActiveRecordPayloadTest#(?:test_payload_without_an_open_transaction)|ActiveRecord::InstrumentationTest#(?:test_payload_connection_with_query_cache_enabled))$/\" -v\r\n\r\n# Running:\r\n\r\nActiveRecord::TransactionInSqlActiveRecordPayloadTest#test_payload_without_an_open_transaction = 0.01 s = .\r\nActiveRecord::InstrumentationTest#test_payload_connection_with_query_cache_enabled = 0.00 s = .\r\n\r\nFinished in 0.017978s, 111.2446 runs/s, 278.1115 assertions/s.\r\n2 runs, 5 assertions, 0 failures, 0 errors, 0 skips\r\nmysql2\r\nUsing mysql2\r\nRun options: --seed 49010 -n \"/^(?:ActiveRecord::TransactionInSqlActiveRecordPayloadTest#(?:test_payload_without_an_open_transaction)|ActiveRecord::InstrumentationTest#(?:test_payload_connection_with_query_cache_enabled))$/\" -v\r\n\r\n# Running:\r\n\r\nActiveRecord::TransactionInSqlActiveRecordPayloadTest#test_payload_without_an_open_transaction = 0.01 s = .\r\nActiveRecord::InstrumentationTest#test_payload_connection_with_query_cache_enabled = 0.01 s = .\r\n\r\nFinished in 0.025769s, 77.6131 runs/s, 194.0326 assertions/s.\r\n2 runs, 5 assertions, 0 failures, 0 errors, 0 skips\r\ntrilogy\r\nUsing trilogy\r\nRun options: --seed 49010 -n \"/^(?:ActiveRecord::TransactionInSqlActiveRecordPayloadTest#(?:test_payload_without_an_open_transaction)|ActiveRecord::InstrumentationTest#(?:test_payload_connection_with_query_cache_enabled))$/\" -v\r\n\r\n# Running:\r\n\r\nActiveRecord::TransactionInSqlActiveRecordPayloadTest#test_payload_without_an_open_transaction = 0.01 s = .\r\nActiveRecord::InstrumentationTest#test_payload_connection_with_query_cache_enabled = 0.01 s = .\r\n\r\nFinished in 0.024330s, 82.2018 runs/s, 205.5044 assertions/s.\r\n2 runs, 5 assertions, 0 failures, 0 errors, 0 skips\r\npostgresql\r\nUsing postgresql\r\nRun options: --seed 49010 -n \"/^(?:ActiveRecord::TransactionInSqlActiveRecordPayloadTest#(?:test_payload_without_an_open_transaction)|ActiveRecord::InstrumentationTest#(?:test_payload_connection_with_query_cache_enabled))$/\" -v\r\n\r\n# Running:\r\n\r\nActiveRecord::TransactionInSqlActiveRecordPayloadTest#test_payload_without_an_open_transaction = 0.01 s = .\r\nActiveRecord::InstrumentationTest#test_payload_connection_with_query_cache_enabled = 0.02 s = F\r\n\r\n\r\nFailure:\r\nActiveRecord::InstrumentationTest#test_payload_connection_with_query_cache_enabled [test/cases/instrumentation_test.rb:142]:\r\nExpected 2 instead of 3 notifications for sql.active_record.\r\nExpected: 2\r\n  Actual: 3\r\n\r\n\r\nbin/test test/cases/instrumentation_test.rb:138\r\n\r\n\r\nFinished in 0.030704s, 65.1378 runs/s, 97.7067 assertions/s.\r\n2 runs, 3 assertions, 1 failures, 0 errors, 0 skips\r\n$\r\n```","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/comments/2521814735/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"yahonda","id":73684,"node_id":"MDQ6VXNlcjczNjg0","avatar_url":"https://avatars.githubusercontent.com/u/73684?v=4","gravatar_id":"","url":"https://api.github.com/users/yahonda","html_url":"https://github.com/yahonda","followers_url":"https://api.github.com/users/yahonda/followers","following_url":"https://api.github.com/users/yahonda/following{/other_user}","gists_url":"https://api.github.com/users/yahonda/gists{/gist_id}","starred_url":"https://api.github.com/users/yahonda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yahonda/subscriptions","organizations_url":"https://api.github.com/users/yahonda/orgs","repos_url":"https://api.github.com/users/yahonda/repos","events_url":"https://api.github.com/users/yahonda/events{/privacy}","received_events_url":"https://api.github.com/users/yahonda/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":15552797863,"node_id":"LE_lADNIULOojqtNM8AAAADnwTcpw","url":"https://api.github.com/repos/rails/rails/issues/events/15552797863","actor":{"login":"yahonda","id":73684,"node_id":"MDQ6VXNlcjczNjg0","avatar_url":"https://avatars.githubusercontent.com/u/73684?v=4","gravatar_id":"","url":"https://api.github.com/users/yahonda","html_url":"https://github.com/yahonda","followers_url":"https://api.github.com/users/yahonda/followers","following_url":"https://api.github.com/users/yahonda/following{/other_user}","gists_url":"https://api.github.com/users/yahonda/gists{/gist_id}","starred_url":"https://api.github.com/users/yahonda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yahonda/subscriptions","organizations_url":"https://api.github.com/users/yahonda/orgs","repos_url":"https://api.github.com/users/yahonda/repos","events_url":"https://api.github.com/users/yahonda/events{/privacy}","received_events_url":"https://api.github.com/users/yahonda/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-12-06T00:32:24Z","label":{"name":"activerecord","color":"0b02e1"},"performed_via_github_app":null},{"id":15552797867,"node_id":"LE_lADNIULOojqtNM8AAAADnwTcqw","url":"https://api.github.com/repos/rails/rails/issues/events/15552797867","actor":{"login":"yahonda","id":73684,"node_id":"MDQ6VXNlcjczNjg0","avatar_url":"https://avatars.githubusercontent.com/u/73684?v=4","gravatar_id":"","url":"https://api.github.com/users/yahonda","html_url":"https://github.com/yahonda","followers_url":"https://api.github.com/users/yahonda/followers","following_url":"https://api.github.com/users/yahonda/following{/other_user}","gists_url":"https://api.github.com/users/yahonda/gists{/gist_id}","starred_url":"https://api.github.com/users/yahonda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yahonda/subscriptions","organizations_url":"https://api.github.com/users/yahonda/orgs","repos_url":"https://api.github.com/users/yahonda/repos","events_url":"https://api.github.com/users/yahonda/events{/privacy}","received_events_url":"https://api.github.com/users/yahonda/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-12-06T00:32:24Z","label":{"name":"PostgreSQL","color":"fbca04"},"performed_via_github_app":null},{"id":15552797871,"node_id":"LE_lADNIULOojqtNM8AAAADnwTcrw","url":"https://api.github.com/repos/rails/rails/issues/events/15552797871","actor":{"login":"yahonda","id":73684,"node_id":"MDQ6VXNlcjczNjg0","avatar_url":"https://avatars.githubusercontent.com/u/73684?v=4","gravatar_id":"","url":"https://api.github.com/users/yahonda","html_url":"https://github.com/yahonda","followers_url":"https://api.github.com/users/yahonda/followers","following_url":"https://api.github.com/users/yahonda/following{/other_user}","gists_url":"https://api.github.com/users/yahonda/gists{/gist_id}","starred_url":"https://api.github.com/users/yahonda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yahonda/subscriptions","organizations_url":"https://api.github.com/users/yahonda/orgs","repos_url":"https://api.github.com/users/yahonda/repos","events_url":"https://api.github.com/users/yahonda/events{/privacy}","received_events_url":"https://api.github.com/users/yahonda/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-12-06T00:32:25Z","label":{"name":"ci issues","color":"aaafff"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rails/rails/issues/comments/2522179241","html_url":"https://github.com/rails/rails/issues/53858#issuecomment-2522179241","issue_url":"https://api.github.com/repos/rails/rails/issues/53858","id":2522179241,"node_id":"IC_kwDNIULOllVmqQ","user":{"login":"yahonda","id":73684,"node_id":"MDQ6VXNlcjczNjg0","avatar_url":"https://avatars.githubusercontent.com/u/73684?v=4","gravatar_id":"","url":"https://api.github.com/users/yahonda","html_url":"https://github.com/yahonda","followers_url":"https://api.github.com/users/yahonda/followers","following_url":"https://api.github.com/users/yahonda/following{/other_user}","gists_url":"https://api.github.com/users/yahonda/gists{/gist_id}","starred_url":"https://api.github.com/users/yahonda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yahonda/subscriptions","organizations_url":"https://api.github.com/users/yahonda/orgs","repos_url":"https://api.github.com/users/yahonda/repos","events_url":"https://api.github.com/users/yahonda/events{/privacy}","received_events_url":"https://api.github.com/users/yahonda/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-12-06T05:33:45Z","updated_at":"2024-12-06T05:33:45Z","body":"I've found that `SHOW search_path` adds a notification that is executed via `sql_key` method with `postgresql` adapter. It is not executed by other database adapters.\r\n\r\nhttps://github.com/rails/rails/blob/cd8ecdbf54030772698e4f8269e34095b7479ec0/activerecord/lib/active_record/connection_adapters/postgresql_adapter.rb#L911\r\n\r\n\r\n- Show all of notifications\r\n```ruby\r\n$ git diff\r\ndiff --git a/activesupport/lib/active_support/testing/notification_assertions.rb b/activesupport/lib/active_support/testing/notification_assertions.rb\r\nindex 3667d5c410..383f7f567f 100644\r\n--- a/activesupport/lib/active_support/testing/notification_assertions.rb\r\n+++ b/activesupport/lib/active_support/testing/notification_assertions.rb\r\n@@ -71,6 +71,7 @@ def assert_no_notifications(pattern = nil, &block)\r\n       def capture_notifications(pattern = nil, &block)\r\n         notifications = []\r\n         ActiveSupport::Notifications.subscribed(->(n) { notifications << n }, pattern, &block)\r\n+        pp notifications\r\n         notifications\r\n       end\r\n     end\r\n$\r\n```\r\n\r\n\r\n- How to reproduce\r\n\r\n```ruby\r\n$ ARCONN=postgresql bin/test test/cases/instrumentation_test.rb -n test_payload_connection_with_query_cache_enabled\r\nUsing postgresql\r\nRun options: -n test_payload_connection_with_query_cache_enabled --seed 15694\r\n\r\n# Running:\r\n\r\n[#<ActiveSupport::Notifications::Event:0x00007d62a08aa838\r\n  @allocation_count_finish=932052,\r\n  @allocation_count_start=932043,\r\n  @cpu_time_finish=1833.702734,\r\n  @cpu_time_start=1833.620227,\r\n  @end=469237591.150221,\r\n  @gc_time_finish=145333631,\r\n  @gc_time_start=145333631,\r\n  @name=\"sql.active_record\",\r\n  @payload=\r\n   {:sql=>\"SHOW search_path\",\r\n    :name=>\"SCHEMA\",\r\n    :binds=>[],\r\n    :type_casted_binds=>[],\r\n    :async=>false,\r\n    :connection=>#<ActiveRecord::ConnectionAdapters::PostgreSQLAdapter:0x00000000003408 env_name=\"arunit\" role=:writing>,\r\n    :transaction=>nil,\r\n    :affected_rows=>0,\r\n    :row_count=>1},\r\n  @time=469237590.979109,\r\n  @transaction_id=\"8ad8a672376303343e8e\">,\r\n #<ActiveSupport::Notifications::Event:0x00007d62a08aaab8\r\n  @allocation_count_finish=932072,\r\n  @allocation_count_start=932022,\r\n  @cpu_time_finish=1833.825554,\r\n  @cpu_time_start=1833.588357,\r\n  @end=469237591.82077,\r\n  @gc_time_finish=145333631,\r\n  @gc_time_start=145333631,\r\n  @name=\"sql.active_record\",\r\n  @payload=\r\n   {:sql=>\"SELECT \\\"books\\\".* FROM \\\"books\\\" ORDER BY \\\"books\\\".\\\"id\\\" ASC LIMIT $1\",\r\n    :name=>\"Book Load\",\r\n    :binds=>\r\n     [#<ActiveModel::Attribute::WithCastValue:0x00007d62a0933d90\r\n       @name=\"LIMIT\",\r\n       @original_attribute=nil,\r\n       @type=#<ActiveModel::Type::Value:0x00007d62a1320470 @limit=nil, @precision=nil, @scale=nil>,\r\n       @value=1,\r\n       @value_before_type_cast=1,\r\n       @value_for_database=1>],\r\n    :type_casted_binds=>[1],\r\n    :async=>false,\r\n    :connection=>#<ActiveRecord::ConnectionAdapters::PostgreSQLAdapter:0x00000000003408 env_name=\"arunit\" role=:writing>,\r\n    :transaction=>nil,\r\n    :affected_rows=>0,\r\n    :row_count=>0,\r\n    :statement_name=>\"a1\"},\r\n  @time=469237590.945515,\r\n  @transaction_id=\"8ad8a672376303343e8e\">,\r\n #<ActiveSupport::Notifications::Event:0x00007d62a08a8998\r\n  @allocation_count_finish=932354,\r\n  @allocation_count_start=932353,\r\n  @cpu_time_finish=1834.824431,\r\n  @cpu_time_start=1834.815654,\r\n  @end=469237592.819785,\r\n  @gc_time_finish=145753335,\r\n  @gc_time_start=145753335,\r\n  @name=\"sql.active_record\",\r\n  @payload=\r\n   {:sql=>\"SELECT \\\"books\\\".* FROM \\\"books\\\" ORDER BY \\\"books\\\".\\\"id\\\" ASC LIMIT $1\",\r\n    :binds=>\r\n     [#<ActiveModel::Attribute::WithCastValue:0x00007d62a0933340\r\n       @name=\"LIMIT\",\r\n       @original_attribute=nil,\r\n       @type=#<ActiveModel::Type::Value:0x00007d62a1320470 @limit=nil, @precision=nil, @scale=nil>,\r\n       @value=1,\r\n       @value_before_type_cast=1,\r\n       @value_for_database=1>],\r\n    :type_casted_binds=>#<Proc:0x00007d62a089e358 /home/yahonda/src/github.com/rails/rails/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb:312 (lambda)>,\r\n    :name=>\"Book Load\",\r\n    :connection=>#<ActiveRecord::ConnectionAdapters::PostgreSQLAdapter:0x00000000003408 env_name=\"arunit\" role=:writing>,\r\n    :transaction=>nil,\r\n    :cached=>true,\r\n    :row_count=>0},\r\n  @time=469237592.807423,\r\n  @transaction_id=\"8ad8a672376303343e8e\">]\r\nF\r\n\r\nFailure:\r\nActiveRecord::InstrumentationTest#test_payload_connection_with_query_cache_enabled [test/cases/instrumentation_test.rb:142]:\r\nExpected 2 instead of 3 notifications for sql.active_record.\r\nExpected: 2\r\n  Actual: 3\r\n\r\n\r\nbin/test test/cases/instrumentation_test.rb:138\r\n\r\n\r\n\r\nFinished in 0.039283s, 25.4560 runs/s, 25.4560 assertions/s.\r\n1 runs, 1 assertions, 1 failures, 0 errors, 0 skips\r\n$\r\n```","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/comments/2522179241/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"yahonda","id":73684,"node_id":"MDQ6VXNlcjczNjg0","avatar_url":"https://avatars.githubusercontent.com/u/73684?v=4","gravatar_id":"","url":"https://api.github.com/users/yahonda","html_url":"https://github.com/yahonda","followers_url":"https://api.github.com/users/yahonda/followers","following_url":"https://api.github.com/users/yahonda/following{/other_user}","gists_url":"https://api.github.com/users/yahonda/gists{/gist_id}","starred_url":"https://api.github.com/users/yahonda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yahonda/subscriptions","organizations_url":"https://api.github.com/users/yahonda/orgs","repos_url":"https://api.github.com/users/yahonda/repos","events_url":"https://api.github.com/users/yahonda/events{/privacy}","received_events_url":"https://api.github.com/users/yahonda/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":15554849994,"node_id":"REFE_lADNIULOojqtNM8AAAADnyQsyg","url":"https://api.github.com/repos/rails/rails/issues/events/15554849994","actor":{"login":"yahonda","id":73684,"node_id":"MDQ6VXNlcjczNjg0","avatar_url":"https://avatars.githubusercontent.com/u/73684?v=4","gravatar_id":"","url":"https://api.github.com/users/yahonda","html_url":"https://github.com/yahonda","followers_url":"https://api.github.com/users/yahonda/followers","following_url":"https://api.github.com/users/yahonda/following{/other_user}","gists_url":"https://api.github.com/users/yahonda/gists{/gist_id}","starred_url":"https://api.github.com/users/yahonda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yahonda/subscriptions","organizations_url":"https://api.github.com/users/yahonda/orgs","repos_url":"https://api.github.com/users/yahonda/repos","events_url":"https://api.github.com/users/yahonda/events{/privacy}","received_events_url":"https://api.github.com/users/yahonda/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"71f10a5637d4fd2932c3139be3fd9b99cc446044","commit_url":"https://api.github.com/repos/yahonda/rails/commits/71f10a5637d4fd2932c3139be3fd9b99cc446044","created_at":"2024-12-06T05:38:09Z","performed_via_github_app":null},{"id":15554878799,"node_id":"REFE_lADNIULOojqtNM8AAAADnySdTw","url":"https://api.github.com/repos/rails/rails/issues/events/15554878799","actor":{"login":"yahonda","id":73684,"node_id":"MDQ6VXNlcjczNjg0","avatar_url":"https://avatars.githubusercontent.com/u/73684?v=4","gravatar_id":"","url":"https://api.github.com/users/yahonda","html_url":"https://github.com/yahonda","followers_url":"https://api.github.com/users/yahonda/followers","following_url":"https://api.github.com/users/yahonda/following{/other_user}","gists_url":"https://api.github.com/users/yahonda/gists{/gist_id}","starred_url":"https://api.github.com/users/yahonda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yahonda/subscriptions","organizations_url":"https://api.github.com/users/yahonda/orgs","repos_url":"https://api.github.com/users/yahonda/repos","events_url":"https://api.github.com/users/yahonda/events{/privacy}","received_events_url":"https://api.github.com/users/yahonda/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"2566083b9931c6466e494430738f867074b85450","commit_url":"https://api.github.com/repos/yahonda/rails/commits/2566083b9931c6466e494430738f867074b85450","created_at":"2024-12-06T05:43:06Z","performed_via_github_app":null},{"actor":{"login":"yahonda","id":73684,"node_id":"MDQ6VXNlcjczNjg0","avatar_url":"https://avatars.githubusercontent.com/u/73684?v=4","gravatar_id":"","url":"https://api.github.com/users/yahonda","html_url":"https://github.com/yahonda","followers_url":"https://api.github.com/users/yahonda/followers","following_url":"https://api.github.com/users/yahonda/following{/other_user}","gists_url":"https://api.github.com/users/yahonda/gists{/gist_id}","starred_url":"https://api.github.com/users/yahonda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yahonda/subscriptions","organizations_url":"https://api.github.com/users/yahonda/orgs","repos_url":"https://api.github.com/users/yahonda/repos","events_url":"https://api.github.com/users/yahonda/events{/privacy}","received_events_url":"https://api.github.com/users/yahonda/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-12-06T05:43:50Z","updated_at":"2024-12-06T05:43:50Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rails/rails/issues/53860","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/53860/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/53860/comments","events_url":"https://api.github.com/repos/rails/rails/issues/53860/events","html_url":"https://github.com/rails/rails/pull/53860","id":2722122795,"node_id":"PR_kwDNIULOhEa48Q","number":53860,"title":"Address `ActiveRecord::InstrumentationTest#test_payload_connection_with_query_cache_enabled` failure","user":{"login":"yahonda","id":73684,"node_id":"MDQ6VXNlcjczNjg0","avatar_url":"https://avatars.githubusercontent.com/u/73684?v=4","gravatar_id":"","url":"https://api.github.com/users/yahonda","html_url":"https://github.com/yahonda","followers_url":"https://api.github.com/users/yahonda/followers","following_url":"https://api.github.com/users/yahonda/following{/other_user}","gists_url":"https://api.github.com/users/yahonda/gists{/gist_id}","starred_url":"https://api.github.com/users/yahonda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yahonda/subscriptions","organizations_url":"https://api.github.com/users/yahonda/orgs","repos_url":"https://api.github.com/users/yahonda/repos","events_url":"https://api.github.com/users/yahonda/events{/privacy}","received_events_url":"https://api.github.com/users/yahonda/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":107191,"node_id":"MDU6TGFiZWwxMDcxOTE=","url":"https://api.github.com/repos/rails/rails/labels/activerecord","name":"activerecord","color":"0b02e1","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2024-12-06T05:43:49Z","updated_at":"2024-12-06T07:01:27Z","closed_at":"2024-12-06T07:01:18Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":8514,"node_id":"MDEwOlJlcG9zaXRvcnk4NTE0","name":"rails","full_name":"rails/rails","private":false,"owner":{"login":"rails","id":4223,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQyMjM=","avatar_url":"https://avatars.githubusercontent.com/u/4223?v=4","gravatar_id":"","url":"https://api.github.com/users/rails","html_url":"https://github.com/rails","followers_url":"https://api.github.com/users/rails/followers","following_url":"https://api.github.com/users/rails/following{/other_user}","gists_url":"https://api.github.com/users/rails/gists{/gist_id}","starred_url":"https://api.github.com/users/rails/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rails/subscriptions","organizations_url":"https://api.github.com/users/rails/orgs","repos_url":"https://api.github.com/users/rails/repos","events_url":"https://api.github.com/users/rails/events{/privacy}","received_events_url":"https://api.github.com/users/rails/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rails/rails","description":"Ruby on Rails","fork":false,"url":"https://api.github.com/repos/rails/rails","forks_url":"https://api.github.com/repos/rails/rails/forks","keys_url":"https://api.github.com/repos/rails/rails/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rails/rails/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rails/rails/teams","hooks_url":"https://api.github.com/repos/rails/rails/hooks","issue_events_url":"https://api.github.com/repos/rails/rails/issues/events{/number}","events_url":"https://api.github.com/repos/rails/rails/events","assignees_url":"https://api.github.com/repos/rails/rails/assignees{/user}","branches_url":"https://api.github.com/repos/rails/rails/branches{/branch}","tags_url":"https://api.github.com/repos/rails/rails/tags","blobs_url":"https://api.github.com/repos/rails/rails/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rails/rails/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rails/rails/git/refs{/sha}","trees_url":"https://api.github.com/repos/rails/rails/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rails/rails/statuses/{sha}","languages_url":"https://api.github.com/repos/rails/rails/languages","stargazers_url":"https://api.github.com/repos/rails/rails/stargazers","contributors_url":"https://api.github.com/repos/rails/rails/contributors","subscribers_url":"https://api.github.com/repos/rails/rails/subscribers","subscription_url":"https://api.github.com/repos/rails/rails/subscription","commits_url":"https://api.github.com/repos/rails/rails/commits{/sha}","git_commits_url":"https://api.github.com/repos/rails/rails/git/commits{/sha}","comments_url":"https://api.github.com/repos/rails/rails/comments{/number}","issue_comment_url":"https://api.github.com/repos/rails/rails/issues/comments{/number}","contents_url":"https://api.github.com/repos/rails/rails/contents/{+path}","compare_url":"https://api.github.com/repos/rails/rails/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rails/rails/merges","archive_url":"https://api.github.com/repos/rails/rails/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rails/rails/downloads","issues_url":"https://api.github.com/repos/rails/rails/issues{/number}","pulls_url":"https://api.github.com/repos/rails/rails/pulls{/number}","milestones_url":"https://api.github.com/repos/rails/rails/milestones{/number}","notifications_url":"https://api.github.com/repos/rails/rails/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rails/rails/labels{/name}","releases_url":"https://api.github.com/repos/rails/rails/releases{/id}","deployments_url":"https://api.github.com/repos/rails/rails/deployments","created_at":"2008-04-11T02:19:47Z","updated_at":"2025-11-10T02:03:47Z","pushed_at":"2025-11-10T00:33:52Z","git_url":"git://github.com/rails/rails.git","ssh_url":"git@github.com:rails/rails.git","clone_url":"https://github.com/rails/rails.git","svn_url":"https://github.com/rails/rails","homepage":"https://rubyonrails.org","size":271619,"stargazers_count":57840,"watchers_count":57840,"language":"Ruby","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":22025,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1341,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["activejob","activerecord","framework","html","mvc","rails","ruby"],"visibility":"public","forks":22025,"open_issues":1341,"watchers":57840,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/rails/rails/pulls/53860","html_url":"https://github.com/rails/rails/pull/53860","diff_url":"https://github.com/rails/rails/pull/53860.diff","patch_url":"https://github.com/rails/rails/pull/53860.patch","merged_at":"2024-12-06T07:01:18Z"},"body":"### Motivation / Background\r\n\r\nThis commit addresses `ActiveRecord::InstrumentationTest#test_payload_connection_with_query_cache_enabled` failure with `postgresql` adapter because it executes `SHOW search_path` adds another notification that is executed via `sql_key`. This statements is not executed by other database adapters.\r\n\r\n### Detail\r\n\r\n- Failures fixed by this commit\r\n\r\n```ruby\r\n$ ARCONN=postgresql bin/test test/cases/instrumentation_test.rb -n test_payload_connection_with_query_cache_enabled\r\nUsing postgresql\r\nRun options: -n test_payload_connection_with_query_cache_enabled --seed 65179\r\n\r\nF\r\n\r\nFailure:\r\nActiveRecord::InstrumentationTest#test_payload_connection_with_query_cache_enabled [test/cases/instrumentation_test.rb:142]:\r\nExpected 2 instead of 3 notifications for sql.active_record.\r\nExpected: 2\r\n  Actual: 3\r\n\r\nbin/test test/cases/instrumentation_test.rb:138\r\n\r\nFinished in 0.029114s, 34.3482 runs/s, 34.3482 assertions/s.\r\n1 runs, 1 assertions, 1 failures, 0 errors, 0 skips\r\n$\r\n```\r\n\r\n### Additional information\r\nFix #53858\r\nRelated to #53822\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/53860/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/rails/issues/53860/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":15555416322,"node_id":"CE_lADNIULOojqtNM8AAAADnyzRAg","url":"https://api.github.com/repos/rails/rails/issues/events/15555416322","actor":{"login":"yahonda","id":73684,"node_id":"MDQ6VXNlcjczNjg0","avatar_url":"https://avatars.githubusercontent.com/u/73684?v=4","gravatar_id":"","url":"https://api.github.com/users/yahonda","html_url":"https://github.com/yahonda","followers_url":"https://api.github.com/users/yahonda/followers","following_url":"https://api.github.com/users/yahonda/following{/other_user}","gists_url":"https://api.github.com/users/yahonda/gists{/gist_id}","starred_url":"https://api.github.com/users/yahonda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yahonda/subscriptions","organizations_url":"https://api.github.com/users/yahonda/orgs","repos_url":"https://api.github.com/users/yahonda/repos","events_url":"https://api.github.com/users/yahonda/events{/privacy}","received_events_url":"https://api.github.com/users/yahonda/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2024-12-06T07:01:20Z","state_reason":null,"performed_via_github_app":null}]