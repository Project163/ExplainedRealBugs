{"url":"https://api.github.com/repos/rails/rails/issues/48664","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/48664/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/48664/comments","events_url":"https://api.github.com/repos/rails/rails/issues/48664/events","html_url":"https://github.com/rails/rails/issues/48664","id":1789794051,"node_id":"I_kwDNIULOaq4XAw","number":48664,"title":"`ActiveRecord::Type::TimeTest#test_default_year_is_correct` gets failed","user":{"login":"yahonda","id":73684,"node_id":"MDQ6VXNlcjczNjg0","avatar_url":"https://avatars.githubusercontent.com/u/73684?v=4","gravatar_id":"","url":"https://api.github.com/users/yahonda","html_url":"https://github.com/yahonda","followers_url":"https://api.github.com/users/yahonda/followers","following_url":"https://api.github.com/users/yahonda/following{/other_user}","gists_url":"https://api.github.com/users/yahonda/gists{/gist_id}","starred_url":"https://api.github.com/users/yahonda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yahonda/subscriptions","organizations_url":"https://api.github.com/users/yahonda/orgs","repos_url":"https://api.github.com/users/yahonda/repos","events_url":"https://api.github.com/users/yahonda/events{/privacy}","received_events_url":"https://api.github.com/users/yahonda/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2023-07-05T15:23:44Z","updated_at":"2023-07-05T20:06:33Z","closed_at":"2023-07-05T20:06:33Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Managed to reproduce CI failure https://buildkite.com/rails/rails/builds/97816#01892608-a43f-4b21-b269-583051fb425e\r\n\r\n\r\n### Steps to reproduce\r\n\r\n```ruby\r\ngit clone https://github.com/rails/rails\r\ncd rails\r\nrm Gemfile.lock\r\nbundle install\r\ncd activerecord\r\nARCONN=mysql2 bin/test test/cases/attribute_methods_test.rb test/cases/yaml_serialization_test.rb test/cases/type/time_test.rb --seed 34223 -n \"/^(?:AttributeMethodsTest#(?:test_YAML_dumping_a_record_with_time_zone-aware_attribute)|YamlSerializationTest#(?:test_to_yaml_with_time_with_zone_should_not_raise_exception)|ActiveRecord::Type::TimeTest#(?:test_default_year_is_correct))$/\"\r\n```\r\n\r\n### Expected behavior\r\nIt should pass.\r\n\r\n### Actual behavior\r\nIt gets NoMethodError: undefined method `local_to_utc' for nil:NilClass\r\n\r\n```ruby\r\n$ ARCONN=mysql2 bin/test test/cases/attribute_methods_test.rb test/cases/yaml_serialization_test.rb test/cases/type/time_test.rb --seed 34223 -n \"/^(?:AttributeMethodsTest#(?:test_YAML_dumping_a_record_with_time_zone-aware_attribute)|YamlSerializationTest#(?:test_to_yaml_with_time_with_zone_should_not_raise_exception)|ActiveRecord::Type::TimeTest#(?:test_default_year_is_correct))$/\"\r\nUsing mysql2\r\nRun options: --seed 34223 -n \"/^(?:AttributeMethodsTest#(?:test_YAML_dumping_a_record_with_time_zone-aware_attribute)|YamlSerializationTest#(?:test_to_yaml_with_time_with_zone_should_not_raise_exception)|ActiveRecord::Type::TimeTest#(?:test_default_year_is_correct))$/\"\r\n\r\n# Running:\r\n\r\n..E\r\n\r\nError:\r\nActiveRecord::Type::TimeTest#test_default_year_is_correct:\r\nNoMethodError: undefined method `local_to_utc' for nil:NilClass\r\n    /home/yahonda/src/github.com/rails/rails/activerecord/lib/active_record/attribute_methods/time_zone_conversion.rb:49:in `set_time_zone_without_conversion'\r\n    /home/yahonda/src/github.com/rails/rails/activerecord/lib/active_record/attribute_methods/time_zone_conversion.rb:21:in `cast'\r\n    /home/yahonda/src/github.com/rails/rails/activemodel/lib/active_model/attribute.rb:199:in `type_cast'\r\n    /home/yahonda/src/github.com/rails/rails/activemodel/lib/active_model/attribute.rb:43:in `value'\r\n    /home/yahonda/src/github.com/rails/rails/activemodel/lib/active_model/attribute_set.rb:51:in `fetch_value'\r\n    /home/yahonda/src/github.com/rails/rails/activerecord/lib/active_record/attribute_methods/read.rb:45:in `_read_attribute'\r\n    /home/yahonda/src/github.com/rails/rails/activemodel/lib/active_model/attribute_methods.rb:271:in `bonus_time'\r\n    /home/yahonda/src/github.com/rails/rails/activerecord/test/cases/type/time_test.rb:13:in `test_default_year_is_correct'\r\n\r\n\r\nbin/test test/cases/type/time_test.rb:9\r\n\r\n\r\n\r\nFinished in 0.076464s, 39.2341 runs/s, 26.1561 assertions/s.\r\n3 runs, 2 assertions, 0 failures, 1 errors, 0 skips\r\n$\r\n```\r\n\r\n### System configuration\r\n**Rails version**: main branch\r\n\r\n**Ruby version**: ruby 3.2.2 (2023-03-30 revision e51014f9c0) [x86_64-linux]\r\n","closed_by":{"login":"eileencodes","id":1080678,"node_id":"MDQ6VXNlcjEwODA2Nzg=","avatar_url":"https://avatars.githubusercontent.com/u/1080678?v=4","gravatar_id":"","url":"https://api.github.com/users/eileencodes","html_url":"https://github.com/eileencodes","followers_url":"https://api.github.com/users/eileencodes/followers","following_url":"https://api.github.com/users/eileencodes/following{/other_user}","gists_url":"https://api.github.com/users/eileencodes/gists{/gist_id}","starred_url":"https://api.github.com/users/eileencodes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eileencodes/subscriptions","organizations_url":"https://api.github.com/users/eileencodes/orgs","repos_url":"https://api.github.com/users/eileencodes/repos","events_url":"https://api.github.com/users/eileencodes/events{/privacy}","received_events_url":"https://api.github.com/users/eileencodes/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rails/rails/issues/48664/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/rails/issues/48664/timeline","performed_via_github_app":null,"state_reason":"completed"}