{"url":"https://api.github.com/repos/rails/rails/issues/53348","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/53348/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/53348/comments","events_url":"https://api.github.com/repos/rails/rails/issues/53348/events","html_url":"https://github.com/rails/rails/issues/53348","id":2593365975,"node_id":"I_kwDNIULOmpOf1w","number":53348,"title":"Rails 8: db:prepare re-run seeds when SolidCache is added","user":{"login":"MaxLap","id":894561,"node_id":"MDQ6VXNlcjg5NDU2MQ==","avatar_url":"https://avatars.githubusercontent.com/u/894561?v=4","gravatar_id":"","url":"https://api.github.com/users/MaxLap","html_url":"https://github.com/MaxLap","followers_url":"https://api.github.com/users/MaxLap/followers","following_url":"https://api.github.com/users/MaxLap/following{/other_user}","gists_url":"https://api.github.com/users/MaxLap/gists{/gist_id}","starred_url":"https://api.github.com/users/MaxLap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MaxLap/subscriptions","organizations_url":"https://api.github.com/users/MaxLap/orgs","repos_url":"https://api.github.com/users/MaxLap/repos","events_url":"https://api.github.com/users/MaxLap/events{/privacy}","received_events_url":"https://api.github.com/users/MaxLap/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2024-10-17T01:16:46Z","updated_at":"2024-10-25T19:16:10Z","closed_at":"2024-10-25T19:16:10Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When running `rails db:prepare`, if a DB is created, then the seeds will be run.\r\n\r\nThis is a problem when the DB being created is for something such as SolidCache (and likely SolidQueue, but I don't use that). A production environment that is functionnal can end up having its seed run again, which can cause all kind of issues, just because SolidCache was added.\r\n\r\nIf things are configured right, then re-running the whole thing will then work, because then no DB will be created so the seed will not be run... If things are not configured right, then the now existing DB might not contain a schema_migrations table, which means the seed will be run again.\r\n\r\nThis later case happens to me right now because of this issue: https://github.com/rails/solid_cache/issues/228. But if I change my schema config temporarily, I confirmed that it worked the 2nd time I ran `rails db:prepare`.\r\n\r\nI believe the problem comes from https://github.com/rails/rails/blame/main/activerecord/lib/active_record/tasks/database_tasks.rb#L183, since any database being initialized means running the seed, which is likely not desired.\r\n\r\n**Rails version**: 8.0.0.beta1\r\n**Ruby version**: 3.3.5\r\n**SolidCache version**: 1.0.6\r\n\r\nThe same problem would likely happen with SolidQueue and SolidCable too.\r\n","closed_by":{"login":"rafaelfranca","id":47848,"node_id":"MDQ6VXNlcjQ3ODQ4","avatar_url":"https://avatars.githubusercontent.com/u/47848?v=4","gravatar_id":"","url":"https://api.github.com/users/rafaelfranca","html_url":"https://github.com/rafaelfranca","followers_url":"https://api.github.com/users/rafaelfranca/followers","following_url":"https://api.github.com/users/rafaelfranca/following{/other_user}","gists_url":"https://api.github.com/users/rafaelfranca/gists{/gist_id}","starred_url":"https://api.github.com/users/rafaelfranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rafaelfranca/subscriptions","organizations_url":"https://api.github.com/users/rafaelfranca/orgs","repos_url":"https://api.github.com/users/rafaelfranca/repos","events_url":"https://api.github.com/users/rafaelfranca/events{/privacy}","received_events_url":"https://api.github.com/users/rafaelfranca/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rails/rails/issues/53348/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/rails/issues/53348/timeline","performed_via_github_app":null,"state_reason":"completed"}