{"url":"https://api.github.com/repos/rails/rails/issues/55126","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/55126/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/55126/comments","events_url":"https://api.github.com/repos/rails/rails/issues/55126/events","html_url":"https://github.com/rails/rails/issues/55126","id":3097747952,"node_id":"I_kwDNIULOuKPh8A","number":55126,"title":"Trilogy::SSLError should be translated to ActiveRecord::ConnectionFailed","user":{"login":"fhoeben","id":5467859,"node_id":"MDQ6VXNlcjU0Njc4NTk=","avatar_url":"https://avatars.githubusercontent.com/u/5467859?v=4","gravatar_id":"","url":"https://api.github.com/users/fhoeben","html_url":"https://github.com/fhoeben","followers_url":"https://api.github.com/users/fhoeben/followers","following_url":"https://api.github.com/users/fhoeben/following{/other_user}","gists_url":"https://api.github.com/users/fhoeben/gists{/gist_id}","starred_url":"https://api.github.com/users/fhoeben/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fhoeben/subscriptions","organizations_url":"https://api.github.com/users/fhoeben/orgs","repos_url":"https://api.github.com/users/fhoeben/repos","events_url":"https://api.github.com/users/fhoeben/events{/privacy}","received_events_url":"https://api.github.com/users/fhoeben/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":107191,"node_id":"MDU6TGFiZWwxMDcxOTE=","url":"https://api.github.com/repos/rails/rails/labels/activerecord","name":"activerecord","color":"0b02e1","default":false,"description":null},{"id":41328116,"node_id":"MDU6TGFiZWw0MTMyODExNg==","url":"https://api.github.com/repos/rails/rails/labels/attached%20PR","name":"attached PR","color":"006b75","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2025-05-28T15:19:08Z","updated_at":"2025-06-17T20:01:59Z","closed_at":"2025-06-17T20:01:59Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"We encounter an issue in our Ruby environments that handle very low volumes of traffic. The first query after the worker has been idle for a long time raises 'Trilogy::SSLError: trilogy_query_recv: SSL Error: unexpected eof while reading'. After reconnecting subsequent queries work without issue.\n\nWe currently have some custom code to catch these exceptions, reconnect and try the work again. But similar code is already present in rails.\n\nI believe this logic in rails is not used at the moment because the exception is not recognized as indicating a 'retryable connection error'.\nIn the Trilogy Ruby bindings there is some logic to translate Trilogy exceptions to standard active record exceptions. These translated values are then checked in the calling (rails) code to see whether a database statement can be retried if it raised the exception.\n\nLooking at the code in [ActiveRecord::ConnectionAdapters::TrilogyAdapter.translate_exception()](https://github.com/rails/rails/blob/b7520a13adda46c0cc5f3fb4a4c1726633af2bba/activerecord/lib/active_record/connection_adapters/trilogy_adapter.rb#L178) I believe this error should also be translated to a ActiveRecord::ConnectionFailed exception (similar to a Trilogy::EOFError).\nThis would probably remove the need for our custom rescue/reconnect logic.\n\nIs this analysis correct, would it make sense to also translate SSLErrors that way or am I misunderstanding the meaning/logic here?\n\n\n### Expected behavior\n\nThat exception should be seen as a 'retryable connection error' (e.g. an ActiveRecord::ConnectionFailed) allowing the query to be retried\n\n[ActiveRecord::ConnectionAdapters::TrilogyAdapter.translate_exception()](https://github.com/rails/rails/blob/b7520a13adda46c0cc5f3fb4a4c1726633af2bba/activerecord/lib/active_record/connection_adapters/trilogy_adapter.rb#L178) is aware of 'Trilogy::SSLError: trilogy_query_recv: SSL Error' and translates it to an `ActiveRecord::ConnectionFailed` exception\n\n### Actual behavior\n\nError is not seen as a connection error and propagates to our application logic. \n\n### System configuration\n\n**Rails version**: 8.0.2\n\n**Ruby version**: 3.3.7\n","closed_by":{"login":"kamipo","id":12642,"node_id":"MDQ6VXNlcjEyNjQy","avatar_url":"https://avatars.githubusercontent.com/u/12642?v=4","gravatar_id":"","url":"https://api.github.com/users/kamipo","html_url":"https://github.com/kamipo","followers_url":"https://api.github.com/users/kamipo/followers","following_url":"https://api.github.com/users/kamipo/following{/other_user}","gists_url":"https://api.github.com/users/kamipo/gists{/gist_id}","starred_url":"https://api.github.com/users/kamipo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kamipo/subscriptions","organizations_url":"https://api.github.com/users/kamipo/orgs","repos_url":"https://api.github.com/users/kamipo/repos","events_url":"https://api.github.com/users/kamipo/events{/privacy}","received_events_url":"https://api.github.com/users/kamipo/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rails/rails/issues/55126/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/rails/issues/55126/timeline","performed_via_github_app":null,"state_reason":"completed"}