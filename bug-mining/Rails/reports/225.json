{"url":"https://api.github.com/repos/rails/rails/issues/53683","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/53683/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/53683/comments","events_url":"https://api.github.com/repos/rails/rails/issues/53683/events","html_url":"https://github.com/rails/rails/issues/53683","id":2676793662,"node_id":"I_kwDNIULOn4yhPg","number":53683,"title":"robot.txt, favicons cached for 1 year by default in production","user":{"login":"zarqman","id":22556,"node_id":"MDQ6VXNlcjIyNTU2","avatar_url":"https://avatars.githubusercontent.com/u/22556?v=4","gravatar_id":"","url":"https://api.github.com/users/zarqman","html_url":"https://github.com/zarqman","followers_url":"https://api.github.com/users/zarqman/followers","following_url":"https://api.github.com/users/zarqman/following{/other_user}","gists_url":"https://api.github.com/users/zarqman/gists{/gist_id}","starred_url":"https://api.github.com/users/zarqman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zarqman/subscriptions","organizations_url":"https://api.github.com/users/zarqman/orgs","repos_url":"https://api.github.com/users/zarqman/repos","events_url":"https://api.github.com/users/zarqman/events{/privacy}","received_events_url":"https://api.github.com/users/zarqman/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":126910270,"node_id":"MDU6TGFiZWwxMjY5MTAyNzA=","url":"https://api.github.com/repos/rails/rails/labels/With%20reproduction%20steps","name":"With reproduction steps","color":"009800","default":false,"description":null}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2024-11-20T18:41:13Z","updated_at":"2025-09-09T01:26:30Z","closed_at":null,"author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Summary**: Non-digested assets (including those _outside_ `/public/assets`) default to the same 1 year cache period in cache-control as digested assets. Since non-digested assets are mutable, a 1 year cache period is inappropriate.\r\n\r\n### Background\r\n\r\nThe built-in public file server's current default cache-control specifies a 1 year cache period in `production.rb`. While this is fine for digested assets, it also applies to non-digested assets such as robots.txt, favicons, and anything else in `/public`, even if not in `/public/assets`.\r\n\r\nhttps://github.com/rails/rails/blob/a8709e6ea26eca73a652af4fdd0a9f7db5352af4/railties/lib/rails/generators/rails/app/templates/config/environments/production.rb.tt#L20-L21\r\n\r\nThe comment notes that \"they are all digest stamped\", but indeed this is not the case.\r\n\r\nTo make Rails friendly to folks who are not well versed in HTTP caching semantics, I believe the default period in production.rb should be radically shorter. I would suggest 1 day maximum, and perhaps just 6 to 12 hours. This would be substantially more forgiving to mistakes than being stuck with something cached in a remote system for days or weeks.\r\n\r\nFavicons in particular can be cached for extended periods. Crawlers are unlikely to honor a cached robots.txt for a full year, but are likely to honor the cache period for several days into weeks.\r\n\r\nChanging this would affect digested assets too, but I suggest that there's little practical difference in overhead for the server between 1 day and 1 year. I'd suggest dropping the default period in development and test as well, to match, but those aren't particularly critical in practice.\r\n\r\nWould there be any openness to such a change? I'm happy to create a PR if so (or someone else can--either way).\r\n\r\n\r\n### Steps to reproduce\r\n\r\nIn production: \r\n```bash\r\ncurl -I http://some-production-app.com/robots.txt\r\n```\r\n\r\nIn development:\r\n```bash\r\n# Enable caching\r\nrails dev:cache\r\ncurl -I http://localhost:3000/icon.svg\r\n```\r\nNote that the default in development is 2 days, so that's what will be returned. \r\n\r\n### Expected behavior\r\n\r\nThe default cache period for non-digested static files should be forgiving to changes and mistakes.\r\n\r\nI'd suggest a default cache period of something between 6 and 24 hours.\r\n\r\n### Actual behavior\r\n\r\nMax age is 1 year for a non-digested URL. Note that both `robots.txt` and `icon.svg` are default, stock files that are generated by a newly generated Rails app.\r\n\r\nProduction:\r\n```bash\r\n$ curl -i http://some-production-app.com/robots.txt\r\nHTTP/1.1 200 OK\r\nCache-Control: public, max-age=31556952\r\nContent-Length: 99\r\nContent-Type: text/plain\r\nLast-Modified: Tue, 19 Nov 2024 21:53:41 GMT\r\nDate: Wed, 20 Nov 2024 18:08:41 GMT\r\n```\r\n\r\nDevelopment (with `rails dev:cache`):\r\n```bash\r\n$ curl -I http://localhost:3000/icon.svg\r\nHTTP/1.1 200 OK\r\nlast-modified: Wed, 20 Nov 2024 01:56:36 GMT\r\ncontent-type: image/svg+xml\r\ncache-control: public, max-age=172800\r\nContent-Length: 122\r\n```\r\n\r\n### System configuration\r\n**Rails version**: 8.0.0\r\n\r\n**Ruby version**: 3.3.6\r\n","closed_by":{"login":"byroot","id":44640,"node_id":"MDQ6VXNlcjQ0NjQw","avatar_url":"https://avatars.githubusercontent.com/u/44640?v=4","gravatar_id":"","url":"https://api.github.com/users/byroot","html_url":"https://github.com/byroot","followers_url":"https://api.github.com/users/byroot/followers","following_url":"https://api.github.com/users/byroot/following{/other_user}","gists_url":"https://api.github.com/users/byroot/gists{/gist_id}","starred_url":"https://api.github.com/users/byroot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/byroot/subscriptions","organizations_url":"https://api.github.com/users/byroot/orgs","repos_url":"https://api.github.com/users/byroot/repos","events_url":"https://api.github.com/users/byroot/events{/privacy}","received_events_url":"https://api.github.com/users/byroot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rails/rails/issues/53683/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/rails/issues/53683/timeline","performed_via_github_app":null,"state_reason":"reopened"}