[{"id":8526716649,"node_id":"MEE_lADNIULOXofg_88AAAAB_Dte6Q","url":"https://api.github.com/repos/rails/rails/issues/events/8526716649","actor":{"login":"peterkovacs","id":275681,"node_id":"MDQ6VXNlcjI3NTY4MQ==","avatar_url":"https://avatars.githubusercontent.com/u/275681?v=4","gravatar_id":"","url":"https://api.github.com/users/peterkovacs","html_url":"https://github.com/peterkovacs","followers_url":"https://api.github.com/users/peterkovacs/followers","following_url":"https://api.github.com/users/peterkovacs/following{/other_user}","gists_url":"https://api.github.com/users/peterkovacs/gists{/gist_id}","starred_url":"https://api.github.com/users/peterkovacs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/peterkovacs/subscriptions","organizations_url":"https://api.github.com/users/peterkovacs/orgs","repos_url":"https://api.github.com/users/peterkovacs/repos","events_url":"https://api.github.com/users/peterkovacs/events{/privacy}","received_events_url":"https://api.github.com/users/peterkovacs/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-02-15T14:31:40Z","performed_via_github_app":null},{"id":8526716675,"node_id":"SE_lADNIULOXofg_88AAAAB_DtfAw","url":"https://api.github.com/repos/rails/rails/issues/events/8526716675","actor":{"login":"peterkovacs","id":275681,"node_id":"MDQ6VXNlcjI3NTY4MQ==","avatar_url":"https://avatars.githubusercontent.com/u/275681?v=4","gravatar_id":"","url":"https://api.github.com/users/peterkovacs","html_url":"https://github.com/peterkovacs","followers_url":"https://api.github.com/users/peterkovacs/followers","following_url":"https://api.github.com/users/peterkovacs/following{/other_user}","gists_url":"https://api.github.com/users/peterkovacs/gists{/gist_id}","starred_url":"https://api.github.com/users/peterkovacs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/peterkovacs/subscriptions","organizations_url":"https://api.github.com/users/peterkovacs/orgs","repos_url":"https://api.github.com/users/peterkovacs/repos","events_url":"https://api.github.com/users/peterkovacs/events{/privacy}","received_events_url":"https://api.github.com/users/peterkovacs/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-02-15T14:31:40Z","performed_via_github_app":null},{"actor":{"login":"andsip","id":1520552,"node_id":"MDQ6VXNlcjE1MjA1NTI=","avatar_url":"https://avatars.githubusercontent.com/u/1520552?v=4","gravatar_id":"","url":"https://api.github.com/users/andsip","html_url":"https://github.com/andsip","followers_url":"https://api.github.com/users/andsip/followers","following_url":"https://api.github.com/users/andsip/following{/other_user}","gists_url":"https://api.github.com/users/andsip/gists{/gist_id}","starred_url":"https://api.github.com/users/andsip/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andsip/subscriptions","organizations_url":"https://api.github.com/users/andsip/orgs","repos_url":"https://api.github.com/users/andsip/repos","events_url":"https://api.github.com/users/andsip/events{/privacy}","received_events_url":"https://api.github.com/users/andsip/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-15T14:32:01Z","updated_at":"2023-02-15T14:32:01Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rails/rails/issues/37722","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/37722/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/37722/comments","events_url":"https://api.github.com/repos/rails/rails/issues/37722/events","html_url":"https://github.com/rails/rails/issues/37722","id":523170955,"node_id":"MDU6SXNzdWU1MjMxNzA5NTU=","number":37722,"title":"SQLite3Adapter#copy_table should not include `default` for primary keys","user":{"login":"peterkovacs","id":275681,"node_id":"MDQ6VXNlcjI3NTY4MQ==","avatar_url":"https://avatars.githubusercontent.com/u/275681?v=4","gravatar_id":"","url":"https://api.github.com/users/peterkovacs","html_url":"https://github.com/peterkovacs","followers_url":"https://api.github.com/users/peterkovacs/followers","following_url":"https://api.github.com/users/peterkovacs/following{/other_user}","gists_url":"https://api.github.com/users/peterkovacs/gists{/gist_id}","starred_url":"https://api.github.com/users/peterkovacs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/peterkovacs/subscriptions","organizations_url":"https://api.github.com/users/peterkovacs/orgs","repos_url":"https://api.github.com/users/peterkovacs/repos","events_url":"https://api.github.com/users/peterkovacs/events{/privacy}","received_events_url":"https://api.github.com/users/peterkovacs/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":12449438,"node_id":"MDU6TGFiZWwxMjQ0OTQzOA==","url":"https://api.github.com/repos/rails/rails/labels/stale","name":"stale","color":"444444","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2019-11-14T23:50:42Z","updated_at":"2023-02-15T20:33:37Z","closed_at":"2020-02-20T01:18:28Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":8514,"node_id":"MDEwOlJlcG9zaXRvcnk4NTE0","name":"rails","full_name":"rails/rails","private":false,"owner":{"login":"rails","id":4223,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQyMjM=","avatar_url":"https://avatars.githubusercontent.com/u/4223?v=4","gravatar_id":"","url":"https://api.github.com/users/rails","html_url":"https://github.com/rails","followers_url":"https://api.github.com/users/rails/followers","following_url":"https://api.github.com/users/rails/following{/other_user}","gists_url":"https://api.github.com/users/rails/gists{/gist_id}","starred_url":"https://api.github.com/users/rails/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rails/subscriptions","organizations_url":"https://api.github.com/users/rails/orgs","repos_url":"https://api.github.com/users/rails/repos","events_url":"https://api.github.com/users/rails/events{/privacy}","received_events_url":"https://api.github.com/users/rails/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rails/rails","description":"Ruby on Rails","fork":false,"url":"https://api.github.com/repos/rails/rails","forks_url":"https://api.github.com/repos/rails/rails/forks","keys_url":"https://api.github.com/repos/rails/rails/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rails/rails/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rails/rails/teams","hooks_url":"https://api.github.com/repos/rails/rails/hooks","issue_events_url":"https://api.github.com/repos/rails/rails/issues/events{/number}","events_url":"https://api.github.com/repos/rails/rails/events","assignees_url":"https://api.github.com/repos/rails/rails/assignees{/user}","branches_url":"https://api.github.com/repos/rails/rails/branches{/branch}","tags_url":"https://api.github.com/repos/rails/rails/tags","blobs_url":"https://api.github.com/repos/rails/rails/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rails/rails/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rails/rails/git/refs{/sha}","trees_url":"https://api.github.com/repos/rails/rails/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rails/rails/statuses/{sha}","languages_url":"https://api.github.com/repos/rails/rails/languages","stargazers_url":"https://api.github.com/repos/rails/rails/stargazers","contributors_url":"https://api.github.com/repos/rails/rails/contributors","subscribers_url":"https://api.github.com/repos/rails/rails/subscribers","subscription_url":"https://api.github.com/repos/rails/rails/subscription","commits_url":"https://api.github.com/repos/rails/rails/commits{/sha}","git_commits_url":"https://api.github.com/repos/rails/rails/git/commits{/sha}","comments_url":"https://api.github.com/repos/rails/rails/comments{/number}","issue_comment_url":"https://api.github.com/repos/rails/rails/issues/comments{/number}","contents_url":"https://api.github.com/repos/rails/rails/contents/{+path}","compare_url":"https://api.github.com/repos/rails/rails/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rails/rails/merges","archive_url":"https://api.github.com/repos/rails/rails/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rails/rails/downloads","issues_url":"https://api.github.com/repos/rails/rails/issues{/number}","pulls_url":"https://api.github.com/repos/rails/rails/pulls{/number}","milestones_url":"https://api.github.com/repos/rails/rails/milestones{/number}","notifications_url":"https://api.github.com/repos/rails/rails/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rails/rails/labels{/name}","releases_url":"https://api.github.com/repos/rails/rails/releases{/id}","deployments_url":"https://api.github.com/repos/rails/rails/deployments","created_at":"2008-04-11T02:19:47Z","updated_at":"2025-11-10T02:03:47Z","pushed_at":"2025-11-10T00:33:52Z","git_url":"git://github.com/rails/rails.git","ssh_url":"git@github.com:rails/rails.git","clone_url":"https://github.com/rails/rails.git","svn_url":"https://github.com/rails/rails","homepage":"https://rubyonrails.org","size":271619,"stargazers_count":57840,"watchers_count":57840,"language":"Ruby","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":22025,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1341,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["activejob","activerecord","framework","html","mvc","rails","ruby"],"visibility":"public","forks":22025,"open_issues":1341,"watchers":57840,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"### Steps to reproduce\r\n\r\nThe method `copy_table` includes this column definition:\r\n\r\n```ruby\r\n        def copy_table(from, to, options = {})\r\n          create_table(to, **options) do |definition|\r\n            columns(from).each do |column|\r\n              @definition.column(column_name, column.type,\r\n                limit: column.limit, default: column.default,\r\n                precision: column.precision, scale: column.scale,\r\n                null: column.null, collation: column.collation,\r\n                primary_key: column_name == from_primary_key\r\n              )\r\n            end\r\n        end\r\n```\r\n\r\nHowever, `ActiveRecord::ConnectionAdapters::TableDefinition#integer_like_primary_key?` tests the *presence* of `:default` in the options has to determine if the *type* of the column should be `primary_key` or `integer`. By including `:default` in this options hash, the generated primary key no longer has the `AUTOINCREMENT` attribute.\r\n\r\nI suggest an edit such as:\r\n\r\n```ruby\r\n            column_options = {\r\n              limit: column.limit,\r\n              precision: column.precision,\r\n              scale: column.scale,\r\n              null: column.null,\r\n              collation: column.collation,\r\n              primary_key: column_name == from_primary_key\r\n            }\r\n\r\n            unless column_options[:primary_key]\r\n              column_options[:default] = column.default\r\n            end\r\n\r\n            @definition.column(column_name, column.type, column_options)\r\n```\r\n\r\nHowever, I'm not sure how this would interact with tables with multiple primary keys.\r\n\r\n### Expected behavior\r\n\r\nThe primary key on the copied table should include the AUTOINCREMENT attribute.\r\n\r\n### Actual behavior\r\n\r\nThe primary key is created without the AUTOINCREMENT attribute.\r\n\r\n### System configuration\r\n**Rails version**: 6.0\r\n\r\n**Ruby version**: 2.4.6\r\n","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/37722/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/rails/issues/37722/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":8529449606,"node_id":"LE_lADNIULOXofg_88AAAAB_GUShg","url":"https://api.github.com/repos/rails/rails/issues/events/8529449606","actor":{"login":"adrianna-chang-shopify","id":22918438,"node_id":"MDQ6VXNlcjIyOTE4NDM4","avatar_url":"https://avatars.githubusercontent.com/u/22918438?v=4","gravatar_id":"","url":"https://api.github.com/users/adrianna-chang-shopify","html_url":"https://github.com/adrianna-chang-shopify","followers_url":"https://api.github.com/users/adrianna-chang-shopify/followers","following_url":"https://api.github.com/users/adrianna-chang-shopify/following{/other_user}","gists_url":"https://api.github.com/users/adrianna-chang-shopify/gists{/gist_id}","starred_url":"https://api.github.com/users/adrianna-chang-shopify/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adrianna-chang-shopify/subscriptions","organizations_url":"https://api.github.com/users/adrianna-chang-shopify/orgs","repos_url":"https://api.github.com/users/adrianna-chang-shopify/repos","events_url":"https://api.github.com/users/adrianna-chang-shopify/events{/privacy}","received_events_url":"https://api.github.com/users/adrianna-chang-shopify/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-02-15T19:16:05Z","label":{"name":"activerecord","color":"0b02e1"},"performed_via_github_app":null},{"id":8530336101,"node_id":"AE_lADNIULOXofg_88AAAAB_HKZZQ","url":"https://api.github.com/repos/rails/rails/issues/events/8530336101","actor":{"login":"adrianna-chang-shopify","id":22918438,"node_id":"MDQ6VXNlcjIyOTE4NDM4","avatar_url":"https://avatars.githubusercontent.com/u/22918438?v=4","gravatar_id":"","url":"https://api.github.com/users/adrianna-chang-shopify","html_url":"https://github.com/adrianna-chang-shopify","followers_url":"https://api.github.com/users/adrianna-chang-shopify/followers","following_url":"https://api.github.com/users/adrianna-chang-shopify/following{/other_user}","gists_url":"https://api.github.com/users/adrianna-chang-shopify/gists{/gist_id}","starred_url":"https://api.github.com/users/adrianna-chang-shopify/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adrianna-chang-shopify/subscriptions","organizations_url":"https://api.github.com/users/adrianna-chang-shopify/orgs","repos_url":"https://api.github.com/users/adrianna-chang-shopify/repos","events_url":"https://api.github.com/users/adrianna-chang-shopify/events{/privacy}","received_events_url":"https://api.github.com/users/adrianna-chang-shopify/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2023-02-15T20:53:38Z","assignee":{"login":"adrianna-chang-shopify","id":22918438,"node_id":"MDQ6VXNlcjIyOTE4NDM4","avatar_url":"https://avatars.githubusercontent.com/u/22918438?v=4","gravatar_id":"","url":"https://api.github.com/users/adrianna-chang-shopify","html_url":"https://github.com/adrianna-chang-shopify","followers_url":"https://api.github.com/users/adrianna-chang-shopify/followers","following_url":"https://api.github.com/users/adrianna-chang-shopify/following{/other_user}","gists_url":"https://api.github.com/users/adrianna-chang-shopify/gists{/gist_id}","starred_url":"https://api.github.com/users/adrianna-chang-shopify/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adrianna-chang-shopify/subscriptions","organizations_url":"https://api.github.com/users/adrianna-chang-shopify/orgs","repos_url":"https://api.github.com/users/adrianna-chang-shopify/repos","events_url":"https://api.github.com/users/adrianna-chang-shopify/events{/privacy}","received_events_url":"https://api.github.com/users/adrianna-chang-shopify/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rails/rails/issues/comments/1432379480","html_url":"https://github.com/rails/rails/issues/47400#issuecomment-1432379480","issue_url":"https://api.github.com/repos/rails/rails/issues/47400","id":1432379480,"node_id":"IC_kwDNIULOVWBgWA","user":{"login":"fatkodima","id":5657035,"node_id":"MDQ6VXNlcjU2NTcwMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5657035?v=4","gravatar_id":"","url":"https://api.github.com/users/fatkodima","html_url":"https://github.com/fatkodima","followers_url":"https://api.github.com/users/fatkodima/followers","following_url":"https://api.github.com/users/fatkodima/following{/other_user}","gists_url":"https://api.github.com/users/fatkodima/gists{/gist_id}","starred_url":"https://api.github.com/users/fatkodima/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fatkodima/subscriptions","organizations_url":"https://api.github.com/users/fatkodima/orgs","repos_url":"https://api.github.com/users/fatkodima/repos","events_url":"https://api.github.com/users/fatkodima/events{/privacy}","received_events_url":"https://api.github.com/users/fatkodima/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-16T02:22:42Z","updated_at":"2023-02-16T02:22:42Z","body":"Sqlite's `ALTER TABLE` is very limited (allows only to rename a table, adding and removing a column), so in rails it is implemented through a new temporary table creation, copying foreign keys, indexes, data, etc to it from the old table. Then recreating the table again, adding required modifications and copying data and structure from the temporary table.\r\n\r\nWhen coping columns, `default` is always passed (for primary keys including) - https://github.com/rails/rails/blob/fa746dab43ec24045409033189d3d5abe49400b1/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L532\r\nThen it is used to determine the column type - https://github.com/rails/rails/blob/fa746dab43ec24045409033189d3d5abe49400b1/activerecord/lib/active_record/connection_adapters/abstract/schema_definitions.rb#L554-L556 https://github.com/rails/rails/blob/fa746dab43ec24045409033189d3d5abe49400b1/activerecord/lib/active_record/connection_adapters/abstract/schema_definitions.rb#L600-L602\r\nand since we have a `default`, it is not declared as of `primary_key` type - https://github.com/rails/rails/blob/fa746dab43ec24045409033189d3d5abe49400b1/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L74\r\nand so `AUTOINCREMENT` is lost.\r\n\r\nWe cannot simply remove that `!options.key?(:default)` check from the `integer_like_primary_key?` because `default` option is also used (as a hacky way) to avoid creating `AUTOINCREMENT` primary keys in older migrations - https://github.com/rails/rails/blob/fa746dab43ec24045409033189d3d5abe49400b1/activerecord/lib/active_record/migration/compatibility.rb#L365-L367\r\n\r\nI think, we can avoid passing that `:default` in `copy_table` if the column is already `AUTOINCREMENT`. \r\n```diff\r\ndiff --git a/activerecord/lib/active_record/connection_adapters/sqlite3/column.rb b/activerecord/lib/active_record/connection_adapters/sqlite3/column.rb\r\nnew file mode 100644\r\nindex 0000000000..005ee76449\r\n--- /dev/null\r\n+++ b/activerecord/lib/active_record/connection_adapters/sqlite3/column.rb\r\n@@ -0,0 +1,41 @@\r\n+# frozen_string_literal: true\r\n+\r\n+module ActiveRecord\r\n+  module ConnectionAdapters\r\n+    module SQLite3\r\n+      class Column < ConnectionAdapters::Column # :nodoc:\r\n+        def initialize(*, auto_increment: nil, **)\r\n+          super\r\n+          @auto_increment = auto_increment\r\n+        end\r\n+\r\n+        def auto_increment?\r\n+          @auto_increment\r\n+        end\r\n+\r\n+        def init_with(coder)\r\n+          @auto_increment = coder[\"auto_increment\"]\r\n+          super\r\n+        end\r\n+\r\n+        def encode_with(coder)\r\n+          coder[\"auto_increment\"] = @auto_increment\r\n+          super\r\n+        end\r\n+\r\n+        def ==(other)\r\n+          other.is_a?(Column) &&\r\n+            super &&\r\n+            auto_increment? == other.auto_increment?\r\n+        end\r\n+        alias :eql? :==\r\n+\r\n+        def hash\r\n+          Column.hash ^\r\n+            super.hash ^\r\n+            auto_increment?.hash\r\n+        end\r\n+      end\r\n+    end\r\n+  end\r\n+end\r\ndiff --git a/activerecord/lib/active_record/connection_adapters/sqlite3/schema_statements.rb b/activerecord/lib/active_record/connection_adapters/sqlite3/sche\r\nma_statements.rb\r\nindex fdd8216268..fac82d3c28 100644\r\n--- a/activerecord/lib/active_record/connection_adapters/sqlite3/schema_statements.rb\r\n+++ b/activerecord/lib/active_record/connection_adapters/sqlite3/schema_statements.rb\r\n@@ -145,7 +145,8 @@ def new_column_from_field(table_name, field)\r\n               type_metadata,\r\n               field[\"notnull\"].to_i == 0,\r\n               default_function,\r\n-              collation: field[\"collation\"]\r\n+              collation: field[\"collation\"],\r\n+              auto_increment: field[\"auto_increment\"]\r\n             )\r\n           end\r\n\r\ndiff --git a/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb b/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb\r\nindex bc19b3026c..46f71f4a95 100644\r\n--- a/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb\r\n+++ b/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb\r\n@@ -2,6 +2,7 @@\r\n\r\n require \"active_record/connection_adapters/abstract_adapter\"\r\n require \"active_record/connection_adapters/statement_pool\"\r\n+require \"active_record/connection_adapters/sqlite3/column\"\r\n require \"active_record/connection_adapters/sqlite3/explain_pretty_printer\"\r\n require \"active_record/connection_adapters/sqlite3/quoting\"\r\n require \"active_record/connection_adapters/sqlite3/database_statements\"\r\n@@ -527,13 +528,19 @@ def copy_table(from, to, options = {})\r\n                 default = type.deserialize(column.default)\r\n               end\r\n\r\n-              column_type = column.bigint? ? :bigint : column.type\r\n-              @definition.column(column_name, column_type,\r\n-                limit: column.limit, default: default,\r\n+              column_options = {\r\n+                limit: column.limit,\r\n                 precision: column.precision, scale: column.scale,\r\n                 null: column.null, collation: column.collation,\r\n                 primary_key: column_name == from_primary_key\r\n-              )\r\n+              }\r\n+\r\n+              unless column.auto_increment?\r\n+                column_options[:default] = default\r\n+              end\r\n+\r\n+              column_type = column.bigint? ? :bigint : column.type\r\n+              @definition.column(column_name, column_type, **column_options)\r\n             end\r\n\r\n             yield @definition if block_given?\r\n@@ -603,10 +610,12 @@ def translate_exception(exception, message:, sql:, binds:)\r\n           end\r\n         end\r\n\r\n-        COLLATE_REGEX = /.*\"(\\w+)\".*collate\\s+\"(\\w+)\".*/i.freeze\r\n+        COLLATE_REGEX = /.*\"(\\w+)\".*collate\\s+\"(\\w+)\".*/i\r\n+        PRIMARY_KEY_REGEX = /.*\"(\\w+)\".+PRIMARY KEY AUTOINCREMENT/i\r\n\r\n         def table_structure_with_collation(table_name, basic_structure)\r\n           collation_hash = {}\r\n+          autoincrements = {}\r\n           sql = <<~SQL\r\n             SELECT sql FROM\r\n               (SELECT * FROM sqlite_master UNION ALL\r\n@@ -628,6 +637,7 @@ def table_structure_with_collation(table_name, basic_structure)\r\n               # This regex will match the column name and collation type and will save\r\n               # the value in $1 and $2 respectively.\r\n               collation_hash[$1] = $2 if COLLATE_REGEX =~ column_string\r\n+              autoincrements[$1] = true if PRIMARY_KEY_REGEX =~ column_string\r\n             end\r\n\r\n             basic_structure.map do |column|\r\n@@ -637,6 +647,10 @@ def table_structure_with_collation(table_name, basic_structure)\r\n                 column[\"collation\"] = collation_hash[column_name]\r\n               end\r\n\r\n+              if autoincrements.has_key?(column_name)\r\n+                column[\"auto_increment\"] = true\r\n+              end\r\n+\r\n               column\r\n             end\r\n           else\r\n```","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/comments/1432379480/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"fatkodima","id":5657035,"node_id":"MDQ6VXNlcjU2NTcwMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5657035?v=4","gravatar_id":"","url":"https://api.github.com/users/fatkodima","html_url":"https://github.com/fatkodima","followers_url":"https://api.github.com/users/fatkodima/followers","following_url":"https://api.github.com/users/fatkodima/following{/other_user}","gists_url":"https://api.github.com/users/fatkodima/gists{/gist_id}","starred_url":"https://api.github.com/users/fatkodima/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fatkodima/subscriptions","organizations_url":"https://api.github.com/users/fatkodima/orgs","repos_url":"https://api.github.com/users/fatkodima/repos","events_url":"https://api.github.com/users/fatkodima/events{/privacy}","received_events_url":"https://api.github.com/users/fatkodima/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rails/rails/issues/comments/1433338724","html_url":"https://github.com/rails/rails/issues/47400#issuecomment-1433338724","issue_url":"https://api.github.com/repos/rails/rails/issues/47400","id":1433338724,"node_id":"IC_kwDNIULOVW8DZA","user":{"login":"adrianna-chang-shopify","id":22918438,"node_id":"MDQ6VXNlcjIyOTE4NDM4","avatar_url":"https://avatars.githubusercontent.com/u/22918438?v=4","gravatar_id":"","url":"https://api.github.com/users/adrianna-chang-shopify","html_url":"https://github.com/adrianna-chang-shopify","followers_url":"https://api.github.com/users/adrianna-chang-shopify/followers","following_url":"https://api.github.com/users/adrianna-chang-shopify/following{/other_user}","gists_url":"https://api.github.com/users/adrianna-chang-shopify/gists{/gist_id}","starred_url":"https://api.github.com/users/adrianna-chang-shopify/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adrianna-chang-shopify/subscriptions","organizations_url":"https://api.github.com/users/adrianna-chang-shopify/orgs","repos_url":"https://api.github.com/users/adrianna-chang-shopify/repos","events_url":"https://api.github.com/users/adrianna-chang-shopify/events{/privacy}","received_events_url":"https://api.github.com/users/adrianna-chang-shopify/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-16T16:12:44Z","updated_at":"2023-02-16T16:12:44Z","body":"üëã Hey @fatkodima ! Yup, I'd arrived at pretty much the same conclusion.\r\n\r\n> We cannot simply remove that !options.key?(:default) check from the integer_like_primary_key? because default option is also used (as a hacky way) to avoid creating AUTOINCREMENT primary keys in older migrations -\r\n\r\nYeah, even for newer migrations, if you specify `default: nil` on the PK definition, the expected behaviour (AFAICT from https://github.com/rails/rails/pull/27389) is to avoid adding AUTOINCREMENT to the column. Which, I agree, seems to indicate that the only way to solve this is to keep track of whether a column should be `autoincrement` or not, as a separate concern from the value of `:default`. \r\n\r\nI can go ahead and open a PR with some tests and add you as a co-author, or I can leave that to you if you've already got a branch started. Let me know! üòÑ ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/comments/1433338724/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"adrianna-chang-shopify","id":22918438,"node_id":"MDQ6VXNlcjIyOTE4NDM4","avatar_url":"https://avatars.githubusercontent.com/u/22918438?v=4","gravatar_id":"","url":"https://api.github.com/users/adrianna-chang-shopify","html_url":"https://github.com/adrianna-chang-shopify","followers_url":"https://api.github.com/users/adrianna-chang-shopify/followers","following_url":"https://api.github.com/users/adrianna-chang-shopify/following{/other_user}","gists_url":"https://api.github.com/users/adrianna-chang-shopify/gists{/gist_id}","starred_url":"https://api.github.com/users/adrianna-chang-shopify/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adrianna-chang-shopify/subscriptions","organizations_url":"https://api.github.com/users/adrianna-chang-shopify/orgs","repos_url":"https://api.github.com/users/adrianna-chang-shopify/repos","events_url":"https://api.github.com/users/adrianna-chang-shopify/events{/privacy}","received_events_url":"https://api.github.com/users/adrianna-chang-shopify/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":8538751989,"node_id":"MEE_lADNIULOXofg_88AAAAB_PMD9Q","url":"https://api.github.com/repos/rails/rails/issues/events/8538751989","actor":{"login":"fatkodima","id":5657035,"node_id":"MDQ6VXNlcjU2NTcwMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5657035?v=4","gravatar_id":"","url":"https://api.github.com/users/fatkodima","html_url":"https://github.com/fatkodima","followers_url":"https://api.github.com/users/fatkodima/followers","following_url":"https://api.github.com/users/fatkodima/following{/other_user}","gists_url":"https://api.github.com/users/fatkodima/gists{/gist_id}","starred_url":"https://api.github.com/users/fatkodima/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fatkodima/subscriptions","organizations_url":"https://api.github.com/users/fatkodima/orgs","repos_url":"https://api.github.com/users/fatkodima/repos","events_url":"https://api.github.com/users/fatkodima/events{/privacy}","received_events_url":"https://api.github.com/users/fatkodima/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-02-16T16:12:45Z","performed_via_github_app":null},{"id":8538752010,"node_id":"SE_lADNIULOXofg_88AAAAB_PMECg","url":"https://api.github.com/repos/rails/rails/issues/events/8538752010","actor":{"login":"fatkodima","id":5657035,"node_id":"MDQ6VXNlcjU2NTcwMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5657035?v=4","gravatar_id":"","url":"https://api.github.com/users/fatkodima","html_url":"https://github.com/fatkodima","followers_url":"https://api.github.com/users/fatkodima/followers","following_url":"https://api.github.com/users/fatkodima/following{/other_user}","gists_url":"https://api.github.com/users/fatkodima/gists{/gist_id}","starred_url":"https://api.github.com/users/fatkodima/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fatkodima/subscriptions","organizations_url":"https://api.github.com/users/fatkodima/orgs","repos_url":"https://api.github.com/users/fatkodima/repos","events_url":"https://api.github.com/users/fatkodima/events{/privacy}","received_events_url":"https://api.github.com/users/fatkodima/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-02-16T16:12:45Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rails/rails/issues/comments/1433342700","html_url":"https://github.com/rails/rails/issues/47400#issuecomment-1433342700","issue_url":"https://api.github.com/repos/rails/rails/issues/47400","id":1433342700,"node_id":"IC_kwDNIULOVW8S7A","user":{"login":"fatkodima","id":5657035,"node_id":"MDQ6VXNlcjU2NTcwMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5657035?v=4","gravatar_id":"","url":"https://api.github.com/users/fatkodima","html_url":"https://github.com/fatkodima","followers_url":"https://api.github.com/users/fatkodima/followers","following_url":"https://api.github.com/users/fatkodima/following{/other_user}","gists_url":"https://api.github.com/users/fatkodima/gists{/gist_id}","starred_url":"https://api.github.com/users/fatkodima/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fatkodima/subscriptions","organizations_url":"https://api.github.com/users/fatkodima/orgs","repos_url":"https://api.github.com/users/fatkodima/repos","events_url":"https://api.github.com/users/fatkodima/events{/privacy}","received_events_url":"https://api.github.com/users/fatkodima/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-16T16:15:26Z","updated_at":"2023-02-16T16:15:26Z","body":"Hey üëã\r\n\r\n> I can go ahead and open a PR\r\n\r\nWorks for me üëç ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/comments/1433342700/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"fatkodima","id":5657035,"node_id":"MDQ6VXNlcjU2NTcwMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5657035?v=4","gravatar_id":"","url":"https://api.github.com/users/fatkodima","html_url":"https://github.com/fatkodima","followers_url":"https://api.github.com/users/fatkodima/followers","following_url":"https://api.github.com/users/fatkodima/following{/other_user}","gists_url":"https://api.github.com/users/fatkodima/gists{/gist_id}","starred_url":"https://api.github.com/users/fatkodima/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fatkodima/subscriptions","organizations_url":"https://api.github.com/users/fatkodima/orgs","repos_url":"https://api.github.com/users/fatkodima/repos","events_url":"https://api.github.com/users/fatkodima/events{/privacy}","received_events_url":"https://api.github.com/users/fatkodima/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":8538791116,"node_id":"UNE_lADNIULOXofg_88AAAAB_POczA","url":"https://api.github.com/repos/rails/rails/issues/events/8538791116","actor":{"login":"adrianna-chang-shopify","id":22918438,"node_id":"MDQ6VXNlcjIyOTE4NDM4","avatar_url":"https://avatars.githubusercontent.com/u/22918438?v=4","gravatar_id":"","url":"https://api.github.com/users/adrianna-chang-shopify","html_url":"https://github.com/adrianna-chang-shopify","followers_url":"https://api.github.com/users/adrianna-chang-shopify/followers","following_url":"https://api.github.com/users/adrianna-chang-shopify/following{/other_user}","gists_url":"https://api.github.com/users/adrianna-chang-shopify/gists{/gist_id}","starred_url":"https://api.github.com/users/adrianna-chang-shopify/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adrianna-chang-shopify/subscriptions","organizations_url":"https://api.github.com/users/adrianna-chang-shopify/orgs","repos_url":"https://api.github.com/users/adrianna-chang-shopify/repos","events_url":"https://api.github.com/users/adrianna-chang-shopify/events{/privacy}","received_events_url":"https://api.github.com/users/adrianna-chang-shopify/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"unassigned","commit_id":null,"commit_url":null,"created_at":"2023-02-16T16:16:18Z","assignee":{"login":"adrianna-chang-shopify","id":22918438,"node_id":"MDQ6VXNlcjIyOTE4NDM4","avatar_url":"https://avatars.githubusercontent.com/u/22918438?v=4","gravatar_id":"","url":"https://api.github.com/users/adrianna-chang-shopify","html_url":"https://github.com/adrianna-chang-shopify","followers_url":"https://api.github.com/users/adrianna-chang-shopify/followers","following_url":"https://api.github.com/users/adrianna-chang-shopify/following{/other_user}","gists_url":"https://api.github.com/users/adrianna-chang-shopify/gists{/gist_id}","starred_url":"https://api.github.com/users/adrianna-chang-shopify/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adrianna-chang-shopify/subscriptions","organizations_url":"https://api.github.com/users/adrianna-chang-shopify/orgs","repos_url":"https://api.github.com/users/adrianna-chang-shopify/repos","events_url":"https://api.github.com/users/adrianna-chang-shopify/events{/privacy}","received_events_url":"https://api.github.com/users/adrianna-chang-shopify/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"id":8538792720,"node_id":"AE_lADNIULOXofg_88AAAAB_POjEA","url":"https://api.github.com/repos/rails/rails/issues/events/8538792720","actor":{"login":"adrianna-chang-shopify","id":22918438,"node_id":"MDQ6VXNlcjIyOTE4NDM4","avatar_url":"https://avatars.githubusercontent.com/u/22918438?v=4","gravatar_id":"","url":"https://api.github.com/users/adrianna-chang-shopify","html_url":"https://github.com/adrianna-chang-shopify","followers_url":"https://api.github.com/users/adrianna-chang-shopify/followers","following_url":"https://api.github.com/users/adrianna-chang-shopify/following{/other_user}","gists_url":"https://api.github.com/users/adrianna-chang-shopify/gists{/gist_id}","starred_url":"https://api.github.com/users/adrianna-chang-shopify/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adrianna-chang-shopify/subscriptions","organizations_url":"https://api.github.com/users/adrianna-chang-shopify/orgs","repos_url":"https://api.github.com/users/adrianna-chang-shopify/repos","events_url":"https://api.github.com/users/adrianna-chang-shopify/events{/privacy}","received_events_url":"https://api.github.com/users/adrianna-chang-shopify/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2023-02-16T16:16:28Z","assignee":{"login":"adrianna-chang-shopify","id":22918438,"node_id":"MDQ6VXNlcjIyOTE4NDM4","avatar_url":"https://avatars.githubusercontent.com/u/22918438?v=4","gravatar_id":"","url":"https://api.github.com/users/adrianna-chang-shopify","html_url":"https://github.com/adrianna-chang-shopify","followers_url":"https://api.github.com/users/adrianna-chang-shopify/followers","following_url":"https://api.github.com/users/adrianna-chang-shopify/following{/other_user}","gists_url":"https://api.github.com/users/adrianna-chang-shopify/gists{/gist_id}","starred_url":"https://api.github.com/users/adrianna-chang-shopify/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adrianna-chang-shopify/subscriptions","organizations_url":"https://api.github.com/users/adrianna-chang-shopify/orgs","repos_url":"https://api.github.com/users/adrianna-chang-shopify/repos","events_url":"https://api.github.com/users/adrianna-chang-shopify/events{/privacy}","received_events_url":"https://api.github.com/users/adrianna-chang-shopify/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"id":8548534524,"node_id":"REFE_lADNIULOXofg_88AAAAB_YhI_A","url":"https://api.github.com/repos/rails/rails/issues/events/8548534524","actor":{"login":"adrianna-chang-shopify","id":22918438,"node_id":"MDQ6VXNlcjIyOTE4NDM4","avatar_url":"https://avatars.githubusercontent.com/u/22918438?v=4","gravatar_id":"","url":"https://api.github.com/users/adrianna-chang-shopify","html_url":"https://github.com/adrianna-chang-shopify","followers_url":"https://api.github.com/users/adrianna-chang-shopify/followers","following_url":"https://api.github.com/users/adrianna-chang-shopify/following{/other_user}","gists_url":"https://api.github.com/users/adrianna-chang-shopify/gists{/gist_id}","starred_url":"https://api.github.com/users/adrianna-chang-shopify/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adrianna-chang-shopify/subscriptions","organizations_url":"https://api.github.com/users/adrianna-chang-shopify/orgs","repos_url":"https://api.github.com/users/adrianna-chang-shopify/repos","events_url":"https://api.github.com/users/adrianna-chang-shopify/events{/privacy}","received_events_url":"https://api.github.com/users/adrianna-chang-shopify/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"bc0996562f576b5d26c82cec4a01523f3fa7934c","commit_url":"https://api.github.com/repos/adrianna-chang-shopify/rails/commits/bc0996562f576b5d26c82cec4a01523f3fa7934c","created_at":"2023-02-17T15:53:24Z","performed_via_github_app":null},{"actor":{"login":"adrianna-chang-shopify","id":22918438,"node_id":"MDQ6VXNlcjIyOTE4NDM4","avatar_url":"https://avatars.githubusercontent.com/u/22918438?v=4","gravatar_id":"","url":"https://api.github.com/users/adrianna-chang-shopify","html_url":"https://github.com/adrianna-chang-shopify","followers_url":"https://api.github.com/users/adrianna-chang-shopify/followers","following_url":"https://api.github.com/users/adrianna-chang-shopify/following{/other_user}","gists_url":"https://api.github.com/users/adrianna-chang-shopify/gists{/gist_id}","starred_url":"https://api.github.com/users/adrianna-chang-shopify/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adrianna-chang-shopify/subscriptions","organizations_url":"https://api.github.com/users/adrianna-chang-shopify/orgs","repos_url":"https://api.github.com/users/adrianna-chang-shopify/repos","events_url":"https://api.github.com/users/adrianna-chang-shopify/events{/privacy}","received_events_url":"https://api.github.com/users/adrianna-chang-shopify/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-17T15:54:14Z","updated_at":"2023-02-17T15:54:14Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rails/rails/issues/47425","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/47425/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/47425/comments","events_url":"https://api.github.com/repos/rails/rails/issues/47425/events","html_url":"https://github.com/rails/rails/pull/47425","id":1589569957,"node_id":"PR_kwDNIULOSjrSPA","number":47425,"title":"Ensure `AUTOINCREMENT` declaration is preserved when altering SQLite tables","user":{"login":"adrianna-chang-shopify","id":22918438,"node_id":"MDQ6VXNlcjIyOTE4NDM4","avatar_url":"https://avatars.githubusercontent.com/u/22918438?v=4","gravatar_id":"","url":"https://api.github.com/users/adrianna-chang-shopify","html_url":"https://github.com/adrianna-chang-shopify","followers_url":"https://api.github.com/users/adrianna-chang-shopify/followers","following_url":"https://api.github.com/users/adrianna-chang-shopify/following{/other_user}","gists_url":"https://api.github.com/users/adrianna-chang-shopify/gists{/gist_id}","starred_url":"https://api.github.com/users/adrianna-chang-shopify/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adrianna-chang-shopify/subscriptions","organizations_url":"https://api.github.com/users/adrianna-chang-shopify/orgs","repos_url":"https://api.github.com/users/adrianna-chang-shopify/repos","events_url":"https://api.github.com/users/adrianna-chang-shopify/events{/privacy}","received_events_url":"https://api.github.com/users/adrianna-chang-shopify/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":107191,"node_id":"MDU6TGFiZWwxMDcxOTE=","url":"https://api.github.com/repos/rails/rails/labels/activerecord","name":"activerecord","color":"0b02e1","default":false,"description":null},{"id":107195,"node_id":"MDU6TGFiZWwxMDcxOTU=","url":"https://api.github.com/repos/rails/rails/labels/railties","name":"railties","color":"8BE06E","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2023-02-17T15:54:14Z","updated_at":"2023-02-27T16:11:08Z","closed_at":"2023-02-27T16:11:08Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":8514,"node_id":"MDEwOlJlcG9zaXRvcnk4NTE0","name":"rails","full_name":"rails/rails","private":false,"owner":{"login":"rails","id":4223,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQyMjM=","avatar_url":"https://avatars.githubusercontent.com/u/4223?v=4","gravatar_id":"","url":"https://api.github.com/users/rails","html_url":"https://github.com/rails","followers_url":"https://api.github.com/users/rails/followers","following_url":"https://api.github.com/users/rails/following{/other_user}","gists_url":"https://api.github.com/users/rails/gists{/gist_id}","starred_url":"https://api.github.com/users/rails/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rails/subscriptions","organizations_url":"https://api.github.com/users/rails/orgs","repos_url":"https://api.github.com/users/rails/repos","events_url":"https://api.github.com/users/rails/events{/privacy}","received_events_url":"https://api.github.com/users/rails/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rails/rails","description":"Ruby on Rails","fork":false,"url":"https://api.github.com/repos/rails/rails","forks_url":"https://api.github.com/repos/rails/rails/forks","keys_url":"https://api.github.com/repos/rails/rails/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rails/rails/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rails/rails/teams","hooks_url":"https://api.github.com/repos/rails/rails/hooks","issue_events_url":"https://api.github.com/repos/rails/rails/issues/events{/number}","events_url":"https://api.github.com/repos/rails/rails/events","assignees_url":"https://api.github.com/repos/rails/rails/assignees{/user}","branches_url":"https://api.github.com/repos/rails/rails/branches{/branch}","tags_url":"https://api.github.com/repos/rails/rails/tags","blobs_url":"https://api.github.com/repos/rails/rails/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rails/rails/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rails/rails/git/refs{/sha}","trees_url":"https://api.github.com/repos/rails/rails/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rails/rails/statuses/{sha}","languages_url":"https://api.github.com/repos/rails/rails/languages","stargazers_url":"https://api.github.com/repos/rails/rails/stargazers","contributors_url":"https://api.github.com/repos/rails/rails/contributors","subscribers_url":"https://api.github.com/repos/rails/rails/subscribers","subscription_url":"https://api.github.com/repos/rails/rails/subscription","commits_url":"https://api.github.com/repos/rails/rails/commits{/sha}","git_commits_url":"https://api.github.com/repos/rails/rails/git/commits{/sha}","comments_url":"https://api.github.com/repos/rails/rails/comments{/number}","issue_comment_url":"https://api.github.com/repos/rails/rails/issues/comments{/number}","contents_url":"https://api.github.com/repos/rails/rails/contents/{+path}","compare_url":"https://api.github.com/repos/rails/rails/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rails/rails/merges","archive_url":"https://api.github.com/repos/rails/rails/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rails/rails/downloads","issues_url":"https://api.github.com/repos/rails/rails/issues{/number}","pulls_url":"https://api.github.com/repos/rails/rails/pulls{/number}","milestones_url":"https://api.github.com/repos/rails/rails/milestones{/number}","notifications_url":"https://api.github.com/repos/rails/rails/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rails/rails/labels{/name}","releases_url":"https://api.github.com/repos/rails/rails/releases{/id}","deployments_url":"https://api.github.com/repos/rails/rails/deployments","created_at":"2008-04-11T02:19:47Z","updated_at":"2025-11-10T02:03:47Z","pushed_at":"2025-11-10T00:33:52Z","git_url":"git://github.com/rails/rails.git","ssh_url":"git@github.com:rails/rails.git","clone_url":"https://github.com/rails/rails.git","svn_url":"https://github.com/rails/rails","homepage":"https://rubyonrails.org","size":271619,"stargazers_count":57840,"watchers_count":57840,"language":"Ruby","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":22025,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1341,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["activejob","activerecord","framework","html","mvc","rails","ruby"],"visibility":"public","forks":22025,"open_issues":1341,"watchers":57840,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/rails/rails/pulls/47425","html_url":"https://github.com/rails/rails/pull/47425","diff_url":"https://github.com/rails/rails/pull/47425.diff","patch_url":"https://github.com/rails/rails/pull/47425.patch","merged_at":"2023-02-27T16:11:07Z"},"body":"### Motivation / Background\r\n\r\nCloses: https://github.com/rails/rails/issues/47400\r\n\r\nPreviously, when copying a table as a result of an `ALTER TABLE` statement, the `AUTOINCREMENT` declaration on the PK column was dictated by the absence of a `:default` option on that column. However, we were always passing `default` when copying the columns to the new table, regardless of whether the column originally had a default. This led to the `AUTOINCREMENT` declaration being lost.\r\n\r\n### Detail\r\n\r\nThis commit fixes the issue by tracking a column's `auto_increment` value, and only passing the `default` option in `#copy_table` when the column does not have the `auto_increment` option set.\r\n\r\nI've added a test that ensure that both storing `auto_increment` on `SQLite3::Column` works as intended, and that the `AUTOINCREMENT` declaration is preserved on the table itself.\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [X] Tests are added or updated if you fix a bug or add a feature.\r\n* [X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/47425/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/rails/issues/47425/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":8552713757,"node_id":"LE_lADNIULOXofg_88AAAAB_cgOHQ","url":"https://api.github.com/repos/rails/rails/issues/events/8552713757","actor":{"login":"zzak","id":277819,"node_id":"MDQ6VXNlcjI3NzgxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/277819?v=4","gravatar_id":"","url":"https://api.github.com/users/zzak","html_url":"https://github.com/zzak","followers_url":"https://api.github.com/users/zzak/followers","following_url":"https://api.github.com/users/zzak/following{/other_user}","gists_url":"https://api.github.com/users/zzak/gists{/gist_id}","starred_url":"https://api.github.com/users/zzak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zzak/subscriptions","organizations_url":"https://api.github.com/users/zzak/orgs","repos_url":"https://api.github.com/users/zzak/repos","events_url":"https://api.github.com/users/zzak/events{/privacy}","received_events_url":"https://api.github.com/users/zzak/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-02-18T09:58:57Z","label":{"name":"attached PR","color":"006b75"},"performed_via_github_app":null},{"id":8617530361,"node_id":"CE_lADNIULOXofg_88AAAACAaUT-Q","url":"https://api.github.com/repos/rails/rails/issues/events/8617530361","actor":{"login":"eileencodes","id":1080678,"node_id":"MDQ6VXNlcjEwODA2Nzg=","avatar_url":"https://avatars.githubusercontent.com/u/1080678?v=4","gravatar_id":"","url":"https://api.github.com/users/eileencodes","html_url":"https://github.com/eileencodes","followers_url":"https://api.github.com/users/eileencodes/followers","following_url":"https://api.github.com/users/eileencodes/following{/other_user}","gists_url":"https://api.github.com/users/eileencodes/gists{/gist_id}","starred_url":"https://api.github.com/users/eileencodes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eileencodes/subscriptions","organizations_url":"https://api.github.com/users/eileencodes/orgs","repos_url":"https://api.github.com/users/eileencodes/repos","events_url":"https://api.github.com/users/eileencodes/events{/privacy}","received_events_url":"https://api.github.com/users/eileencodes/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2023-02-27T16:11:09Z","state_reason":null,"performed_via_github_app":null}]