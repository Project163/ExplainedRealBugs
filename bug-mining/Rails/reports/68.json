{"url":"https://api.github.com/repos/rails/rails/issues/49494","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/49494/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/49494/comments","events_url":"https://api.github.com/repos/rails/rails/issues/49494/events","html_url":"https://github.com/rails/rails/issues/49494","id":1927900439,"node_id":"I_kwDNIULOcultFw","number":49494,"title":"Indicate in the changelog/release notes for 7.1, that `Rails.logger` is now a `BroadcastLogger`","user":{"login":"mensfeld","id":392754,"node_id":"MDQ6VXNlcjM5Mjc1NA==","avatar_url":"https://avatars.githubusercontent.com/u/392754?v=4","gravatar_id":"","url":"https://api.github.com/users/mensfeld","html_url":"https://github.com/mensfeld","followers_url":"https://api.github.com/users/mensfeld/followers","following_url":"https://api.github.com/users/mensfeld/following{/other_user}","gists_url":"https://api.github.com/users/mensfeld/gists{/gist_id}","starred_url":"https://api.github.com/users/mensfeld/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mensfeld/subscriptions","organizations_url":"https://api.github.com/users/mensfeld/orgs","repos_url":"https://api.github.com/users/mensfeld/repos","events_url":"https://api.github.com/users/mensfeld/events{/privacy}","received_events_url":"https://api.github.com/users/mensfeld/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":107195,"node_id":"MDU6TGFiZWwxMDcxOTU=","url":"https://api.github.com/repos/rails/rails/labels/railties","name":"railties","color":"8BE06E","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"rafaelfranca","id":47848,"node_id":"MDQ6VXNlcjQ3ODQ4","avatar_url":"https://avatars.githubusercontent.com/u/47848?v=4","gravatar_id":"","url":"https://api.github.com/users/rafaelfranca","html_url":"https://github.com/rafaelfranca","followers_url":"https://api.github.com/users/rafaelfranca/followers","following_url":"https://api.github.com/users/rafaelfranca/following{/other_user}","gists_url":"https://api.github.com/users/rafaelfranca/gists{/gist_id}","starred_url":"https://api.github.com/users/rafaelfranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rafaelfranca/subscriptions","organizations_url":"https://api.github.com/users/rafaelfranca/orgs","repos_url":"https://api.github.com/users/rafaelfranca/repos","events_url":"https://api.github.com/users/rafaelfranca/events{/privacy}","received_events_url":"https://api.github.com/users/rafaelfranca/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"rafaelfranca","id":47848,"node_id":"MDQ6VXNlcjQ3ODQ4","avatar_url":"https://avatars.githubusercontent.com/u/47848?v=4","gravatar_id":"","url":"https://api.github.com/users/rafaelfranca","html_url":"https://github.com/rafaelfranca","followers_url":"https://api.github.com/users/rafaelfranca/followers","following_url":"https://api.github.com/users/rafaelfranca/following{/other_user}","gists_url":"https://api.github.com/users/rafaelfranca/gists{/gist_id}","starred_url":"https://api.github.com/users/rafaelfranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rafaelfranca/subscriptions","organizations_url":"https://api.github.com/users/rafaelfranca/orgs","repos_url":"https://api.github.com/users/rafaelfranca/repos","events_url":"https://api.github.com/users/rafaelfranca/events{/privacy}","received_events_url":"https://api.github.com/users/rafaelfranca/received_events","type":"User","user_view_type":"public","site_admin":false},{"login":"Edouard-chin","id":8122246,"node_id":"MDQ6VXNlcjgxMjIyNDY=","avatar_url":"https://avatars.githubusercontent.com/u/8122246?v=4","gravatar_id":"","url":"https://api.github.com/users/Edouard-chin","html_url":"https://github.com/Edouard-chin","followers_url":"https://api.github.com/users/Edouard-chin/followers","following_url":"https://api.github.com/users/Edouard-chin/following{/other_user}","gists_url":"https://api.github.com/users/Edouard-chin/gists{/gist_id}","starred_url":"https://api.github.com/users/Edouard-chin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Edouard-chin/subscriptions","organizations_url":"https://api.github.com/users/Edouard-chin/orgs","repos_url":"https://api.github.com/users/Edouard-chin/repos","events_url":"https://api.github.com/users/Edouard-chin/events{/privacy}","received_events_url":"https://api.github.com/users/Edouard-chin/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/rails/rails/milestones/84","html_url":"https://github.com/rails/rails/milestone/84","labels_url":"https://api.github.com/repos/rails/rails/milestones/84/labels","id":10007455,"node_id":"MI_kwDNIULOAJiznw","number":84,"title":"7.1.1","description":"","creator":{"login":"rafaelfranca","id":47848,"node_id":"MDQ6VXNlcjQ3ODQ4","avatar_url":"https://avatars.githubusercontent.com/u/47848?v=4","gravatar_id":"","url":"https://api.github.com/users/rafaelfranca","html_url":"https://github.com/rafaelfranca","followers_url":"https://api.github.com/users/rafaelfranca/followers","following_url":"https://api.github.com/users/rafaelfranca/following{/other_user}","gists_url":"https://api.github.com/users/rafaelfranca/gists{/gist_id}","starred_url":"https://api.github.com/users/rafaelfranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rafaelfranca/subscriptions","organizations_url":"https://api.github.com/users/rafaelfranca/orgs","repos_url":"https://api.github.com/users/rafaelfranca/repos","events_url":"https://api.github.com/users/rafaelfranca/events{/privacy}","received_events_url":"https://api.github.com/users/rafaelfranca/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":4,"state":"closed","created_at":"2023-10-05T15:14:29Z","updated_at":"2023-10-11T22:36:02Z","due_on":null,"closed_at":"2023-10-11T22:36:02Z"},"comments":2,"created_at":"2023-10-05T10:09:12Z","updated_at":"2023-10-09T12:16:42Z","closed_at":"2023-10-07T12:56:09Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Following on my discussion with @rafaelfranca:\r\n\r\nMy gem [karafka](https://github.com/karafka/karafka) integrates with the Rails logger via a Railtie using the \"unofficial\" broadcast  API as follows:\r\n\r\nhttps://github.com/karafka/karafka/blob/b32be801a9a81853d81bbe249a76388acfd5876b/lib/karafka/railtie.rb#L49\r\n\r\nRails 7.1 has replaced the `#broadcast` module with a `BroadcastLogger` and because of that I wanted to upgrade my integration. After reading the docs what I did was that (in railtie:\r\n\r\n```ruby\r\nrails_logger = Rails.logger\r\n\r\nstdout_logger = ActiveSupport::Logger.new($stdout)\r\nstdout_logger.level = Rails.logger.level\r\n\r\nRails.logger = ActiveSupport::BroadcastLogger.new(\r\n  rails_logger,\r\n  stdout_logger\r\n)\r\n```\r\nbasically wrapping the native Rails logger and my logger with a broadcast and using this as a Rails logger.\r\n\r\nWhile it worked for my case, it caused following issue for any ActiveJobs:\r\n\r\n```\r\n/gems/3.1.0/gems/activejob-7.1.0/lib/active_job/logging.rb:32:in `logger_tagged_by_active_job?': undefined method `current_tags' for nil:NilClass (NoMethodError)\r\n\r\n        logger.formatter.current_tags.include?(\"ActiveJob\")\r\n```\r\n\r\nthat is because BroadcastLogger is proxying only the logger API (which makes sense).\r\n\r\nMy approach was based on the docs as they did not clearly state that `Rails.logger` is now a broadcast logger itself with the extra APIs needed and that instead of wrapping it with a BroadcastLogger the upgrade path is to use a `broadcast_to` delegator on the Rails logger itself effectively replacing the above code with:\r\n\r\n```ruby\r\nstdout_logger = ActiveSupport::Logger.new($stdout)\r\n\r\nRails.logger.broadcast_to(stdout_logger)\r\n```\r\n\r\nit is not stated in the [release notes](https://edgeguides.rubyonrails.org/7_1_release_notes.html) or at least it was not exactly clear to me how to upgrade my integration to achieve the pre 7.1 behaviour without any errors.\r\n","closed_by":{"login":"Edouard-chin","id":8122246,"node_id":"MDQ6VXNlcjgxMjIyNDY=","avatar_url":"https://avatars.githubusercontent.com/u/8122246?v=4","gravatar_id":"","url":"https://api.github.com/users/Edouard-chin","html_url":"https://github.com/Edouard-chin","followers_url":"https://api.github.com/users/Edouard-chin/followers","following_url":"https://api.github.com/users/Edouard-chin/following{/other_user}","gists_url":"https://api.github.com/users/Edouard-chin/gists{/gist_id}","starred_url":"https://api.github.com/users/Edouard-chin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Edouard-chin/subscriptions","organizations_url":"https://api.github.com/users/Edouard-chin/orgs","repos_url":"https://api.github.com/users/Edouard-chin/repos","events_url":"https://api.github.com/users/Edouard-chin/events{/privacy}","received_events_url":"https://api.github.com/users/Edouard-chin/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rails/rails/issues/49494/reactions","total_count":4,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":2},"timeline_url":"https://api.github.com/repos/rails/rails/issues/49494/timeline","performed_via_github_app":null,"state_reason":"completed"}