[{"id":16059920433,"node_id":"REFE_lADNIULOp3eM-c8AAAADvT7wMQ","url":"https://api.github.com/repos/rails/rails/issues/events/16059920433","actor":{"login":"djmb","id":1734607,"node_id":"MDQ6VXNlcjE3MzQ2MDc=","avatar_url":"https://avatars.githubusercontent.com/u/1734607?v=4","gravatar_id":"","url":"https://api.github.com/users/djmb","html_url":"https://github.com/djmb","followers_url":"https://api.github.com/users/djmb/followers","following_url":"https://api.github.com/users/djmb/following{/other_user}","gists_url":"https://api.github.com/users/djmb/gists{/gist_id}","starred_url":"https://api.github.com/users/djmb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djmb/subscriptions","organizations_url":"https://api.github.com/users/djmb/orgs","repos_url":"https://api.github.com/users/djmb/repos","events_url":"https://api.github.com/users/djmb/events{/privacy}","received_events_url":"https://api.github.com/users/djmb/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"d449be7fc8496b64ee8fbf47e3633735e20806e6","commit_url":"https://api.github.com/repos/rails/solid_cache/commits/d449be7fc8496b64ee8fbf47e3633735e20806e6","created_at":"2025-01-24T14:58:27Z","performed_via_github_app":null},{"actor":{"login":"djmb","id":1734607,"node_id":"MDQ6VXNlcjE3MzQ2MDc=","avatar_url":"https://avatars.githubusercontent.com/u/1734607?v=4","gravatar_id":"","url":"https://api.github.com/users/djmb","html_url":"https://github.com/djmb","followers_url":"https://api.github.com/users/djmb/followers","following_url":"https://api.github.com/users/djmb/following{/other_user}","gists_url":"https://api.github.com/users/djmb/gists{/gist_id}","starred_url":"https://api.github.com/users/djmb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djmb/subscriptions","organizations_url":"https://api.github.com/users/djmb/orgs","repos_url":"https://api.github.com/users/djmb/repos","events_url":"https://api.github.com/users/djmb/events{/privacy}","received_events_url":"https://api.github.com/users/djmb/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-01-24T15:07:37Z","updated_at":"2025-01-24T15:07:37Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rails/solid_cache/issues/251","repository_url":"https://api.github.com/repos/rails/solid_cache","labels_url":"https://api.github.com/repos/rails/solid_cache/issues/251/labels{/name}","comments_url":"https://api.github.com/repos/rails/solid_cache/issues/251/comments","events_url":"https://api.github.com/repos/rails/solid_cache/issues/251/events","html_url":"https://github.com/rails/solid_cache/pull/251","id":2809681516,"node_id":"PR_kwDOIc-H7M6I6UuP","number":251,"title":"Avoid reloading the app directory","user":{"login":"djmb","id":1734607,"node_id":"MDQ6VXNlcjE3MzQ2MDc=","avatar_url":"https://avatars.githubusercontent.com/u/1734607?v=4","gravatar_id":"","url":"https://api.github.com/users/djmb","html_url":"https://github.com/djmb","followers_url":"https://api.github.com/users/djmb/followers","following_url":"https://api.github.com/users/djmb/following{/other_user}","gists_url":"https://api.github.com/users/djmb/gists{/gist_id}","starred_url":"https://api.github.com/users/djmb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djmb/subscriptions","organizations_url":"https://api.github.com/users/djmb/orgs","repos_url":"https://api.github.com/users/djmb/repos","events_url":"https://api.github.com/users/djmb/events{/privacy}","received_events_url":"https://api.github.com/users/djmb/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2025-01-24T15:07:36Z","updated_at":"2025-02-04T14:32:11Z","closed_at":"2025-02-04T14:32:11Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":567248876,"node_id":"R_kgDOIc-H7A","name":"solid_cache","full_name":"rails/solid_cache","private":false,"owner":{"login":"rails","id":4223,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQyMjM=","avatar_url":"https://avatars.githubusercontent.com/u/4223?v=4","gravatar_id":"","url":"https://api.github.com/users/rails","html_url":"https://github.com/rails","followers_url":"https://api.github.com/users/rails/followers","following_url":"https://api.github.com/users/rails/following{/other_user}","gists_url":"https://api.github.com/users/rails/gists{/gist_id}","starred_url":"https://api.github.com/users/rails/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rails/subscriptions","organizations_url":"https://api.github.com/users/rails/orgs","repos_url":"https://api.github.com/users/rails/repos","events_url":"https://api.github.com/users/rails/events{/privacy}","received_events_url":"https://api.github.com/users/rails/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rails/solid_cache","description":"A database-backed ActiveSupport::Cache::Store","fork":false,"url":"https://api.github.com/repos/rails/solid_cache","forks_url":"https://api.github.com/repos/rails/solid_cache/forks","keys_url":"https://api.github.com/repos/rails/solid_cache/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rails/solid_cache/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rails/solid_cache/teams","hooks_url":"https://api.github.com/repos/rails/solid_cache/hooks","issue_events_url":"https://api.github.com/repos/rails/solid_cache/issues/events{/number}","events_url":"https://api.github.com/repos/rails/solid_cache/events","assignees_url":"https://api.github.com/repos/rails/solid_cache/assignees{/user}","branches_url":"https://api.github.com/repos/rails/solid_cache/branches{/branch}","tags_url":"https://api.github.com/repos/rails/solid_cache/tags","blobs_url":"https://api.github.com/repos/rails/solid_cache/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rails/solid_cache/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rails/solid_cache/git/refs{/sha}","trees_url":"https://api.github.com/repos/rails/solid_cache/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rails/solid_cache/statuses/{sha}","languages_url":"https://api.github.com/repos/rails/solid_cache/languages","stargazers_url":"https://api.github.com/repos/rails/solid_cache/stargazers","contributors_url":"https://api.github.com/repos/rails/solid_cache/contributors","subscribers_url":"https://api.github.com/repos/rails/solid_cache/subscribers","subscription_url":"https://api.github.com/repos/rails/solid_cache/subscription","commits_url":"https://api.github.com/repos/rails/solid_cache/commits{/sha}","git_commits_url":"https://api.github.com/repos/rails/solid_cache/git/commits{/sha}","comments_url":"https://api.github.com/repos/rails/solid_cache/comments{/number}","issue_comment_url":"https://api.github.com/repos/rails/solid_cache/issues/comments{/number}","contents_url":"https://api.github.com/repos/rails/solid_cache/contents/{+path}","compare_url":"https://api.github.com/repos/rails/solid_cache/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rails/solid_cache/merges","archive_url":"https://api.github.com/repos/rails/solid_cache/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rails/solid_cache/downloads","issues_url":"https://api.github.com/repos/rails/solid_cache/issues{/number}","pulls_url":"https://api.github.com/repos/rails/solid_cache/pulls{/number}","milestones_url":"https://api.github.com/repos/rails/solid_cache/milestones{/number}","notifications_url":"https://api.github.com/repos/rails/solid_cache/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rails/solid_cache/labels{/name}","releases_url":"https://api.github.com/repos/rails/solid_cache/releases{/id}","deployments_url":"https://api.github.com/repos/rails/solid_cache/deployments","created_at":"2022-11-17T11:49:24Z","updated_at":"2025-11-08T19:56:11Z","pushed_at":"2025-11-08T19:56:08Z","git_url":"git://github.com/rails/solid_cache.git","ssh_url":"git@github.com:rails/solid_cache.git","clone_url":"https://github.com/rails/solid_cache.git","svn_url":"https://github.com/rails/solid_cache","homepage":"","size":583,"stargazers_count":979,"watchers_count":979,"language":"Ruby","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":76,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":5,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":76,"open_issues":5,"watchers":979,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/rails/solid_cache/pulls/251","html_url":"https://github.com/rails/solid_cache/pull/251","diff_url":"https://github.com/rails/solid_cache/pull/251.diff","patch_url":"https://github.com/rails/solid_cache/pull/251.patch","merged_at":null},"body":"It's not currently safe to reload connection classes in Rails as the old class is cached in the pool config.\r\n\r\nSee: https://github.com/rails/rails/issues/54343\r\n\r\nThis can lead to issues like:\r\nhttps://github.com/rails/solid_cache/issues/238","reactions":{"url":"https://api.github.com/repos/rails/solid_cache/issues/251/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/solid_cache/issues/251/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":16062814974,"node_id":"LE_lADNIULOp3eM-c8AAAADvWsa_g","url":"https://api.github.com/repos/rails/rails/issues/events/16062814974","actor":{"login":"rafaelfranca","id":47848,"node_id":"MDQ6VXNlcjQ3ODQ4","avatar_url":"https://avatars.githubusercontent.com/u/47848?v=4","gravatar_id":"","url":"https://api.github.com/users/rafaelfranca","html_url":"https://github.com/rafaelfranca","followers_url":"https://api.github.com/users/rafaelfranca/followers","following_url":"https://api.github.com/users/rafaelfranca/following{/other_user}","gists_url":"https://api.github.com/users/rafaelfranca/gists{/gist_id}","starred_url":"https://api.github.com/users/rafaelfranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rafaelfranca/subscriptions","organizations_url":"https://api.github.com/users/rafaelfranca/orgs","repos_url":"https://api.github.com/users/rafaelfranca/repos","events_url":"https://api.github.com/users/rafaelfranca/events{/privacy}","received_events_url":"https://api.github.com/users/rafaelfranca/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2025-01-24T18:43:59Z","label":{"name":"activerecord","color":"0b02e1"},"performed_via_github_app":null},{"id":16062814984,"node_id":"LE_lADNIULOp3eM-c8AAAADvWsbCA","url":"https://api.github.com/repos/rails/rails/issues/events/16062814984","actor":{"login":"rafaelfranca","id":47848,"node_id":"MDQ6VXNlcjQ3ODQ4","avatar_url":"https://avatars.githubusercontent.com/u/47848?v=4","gravatar_id":"","url":"https://api.github.com/users/rafaelfranca","html_url":"https://github.com/rafaelfranca","followers_url":"https://api.github.com/users/rafaelfranca/followers","following_url":"https://api.github.com/users/rafaelfranca/following{/other_user}","gists_url":"https://api.github.com/users/rafaelfranca/gists{/gist_id}","starred_url":"https://api.github.com/users/rafaelfranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rafaelfranca/subscriptions","organizations_url":"https://api.github.com/users/rafaelfranca/orgs","repos_url":"https://api.github.com/users/rafaelfranca/repos","events_url":"https://api.github.com/users/rafaelfranca/events{/privacy}","received_events_url":"https://api.github.com/users/rafaelfranca/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2025-01-24T18:43:59Z","label":{"name":"pinned","color":"f7c6c7"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rails/rails/issues/comments/2613181340","html_url":"https://github.com/rails/rails/issues/54343#issuecomment-2613181340","issue_url":"https://api.github.com/repos/rails/rails/issues/54343","id":2613181340,"node_id":"IC_kwDNIULOm8H7nA","user":{"login":"rafaelfranca","id":47848,"node_id":"MDQ6VXNlcjQ3ODQ4","avatar_url":"https://avatars.githubusercontent.com/u/47848?v=4","gravatar_id":"","url":"https://api.github.com/users/rafaelfranca","html_url":"https://github.com/rafaelfranca","followers_url":"https://api.github.com/users/rafaelfranca/followers","following_url":"https://api.github.com/users/rafaelfranca/following{/other_user}","gists_url":"https://api.github.com/users/rafaelfranca/gists{/gist_id}","starred_url":"https://api.github.com/users/rafaelfranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rafaelfranca/subscriptions","organizations_url":"https://api.github.com/users/rafaelfranca/orgs","repos_url":"https://api.github.com/users/rafaelfranca/repos","events_url":"https://api.github.com/users/rafaelfranca/events{/privacy}","received_events_url":"https://api.github.com/users/rafaelfranca/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-01-24T18:52:07Z","updated_at":"2025-01-24T18:52:07Z","body":"Yeah, that is a real problem. This can affect many apps that have no choice to not reload the connection classes. I looked why we need to hold the class (we generally avoid that exactly because of reload), and it is since https://github.com/rails/rails/commit/05821c6c649079a63e3af0d2b3b4fa3ae2056801.\n\n@eileencodes any idea on how to fix this problem?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/comments/2613181340/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"rafaelfranca","id":47848,"node_id":"MDQ6VXNlcjQ3ODQ4","avatar_url":"https://avatars.githubusercontent.com/u/47848?v=4","gravatar_id":"","url":"https://api.github.com/users/rafaelfranca","html_url":"https://github.com/rafaelfranca","followers_url":"https://api.github.com/users/rafaelfranca/followers","following_url":"https://api.github.com/users/rafaelfranca/following{/other_user}","gists_url":"https://api.github.com/users/rafaelfranca/gists{/gist_id}","starred_url":"https://api.github.com/users/rafaelfranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rafaelfranca/subscriptions","organizations_url":"https://api.github.com/users/rafaelfranca/orgs","repos_url":"https://api.github.com/users/rafaelfranca/repos","events_url":"https://api.github.com/users/rafaelfranca/events{/privacy}","received_events_url":"https://api.github.com/users/rafaelfranca/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":16062915254,"node_id":"MEE_lADNIULOp3eM-c8AAAADvWyitg","url":"https://api.github.com/repos/rails/rails/issues/events/16062915254","actor":{"login":"eileencodes","id":1080678,"node_id":"MDQ6VXNlcjEwODA2Nzg=","avatar_url":"https://avatars.githubusercontent.com/u/1080678?v=4","gravatar_id":"","url":"https://api.github.com/users/eileencodes","html_url":"https://github.com/eileencodes","followers_url":"https://api.github.com/users/eileencodes/followers","following_url":"https://api.github.com/users/eileencodes/following{/other_user}","gists_url":"https://api.github.com/users/eileencodes/gists{/gist_id}","starred_url":"https://api.github.com/users/eileencodes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eileencodes/subscriptions","organizations_url":"https://api.github.com/users/eileencodes/orgs","repos_url":"https://api.github.com/users/eileencodes/repos","events_url":"https://api.github.com/users/eileencodes/events{/privacy}","received_events_url":"https://api.github.com/users/eileencodes/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2025-01-24T18:52:09Z","performed_via_github_app":null},{"id":16062915263,"node_id":"SE_lADNIULOp3eM-c8AAAADvWyivw","url":"https://api.github.com/repos/rails/rails/issues/events/16062915263","actor":{"login":"eileencodes","id":1080678,"node_id":"MDQ6VXNlcjEwODA2Nzg=","avatar_url":"https://avatars.githubusercontent.com/u/1080678?v=4","gravatar_id":"","url":"https://api.github.com/users/eileencodes","html_url":"https://github.com/eileencodes","followers_url":"https://api.github.com/users/eileencodes/followers","following_url":"https://api.github.com/users/eileencodes/following{/other_user}","gists_url":"https://api.github.com/users/eileencodes/gists{/gist_id}","starred_url":"https://api.github.com/users/eileencodes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eileencodes/subscriptions","organizations_url":"https://api.github.com/users/eileencodes/orgs","repos_url":"https://api.github.com/users/eileencodes/repos","events_url":"https://api.github.com/users/eileencodes/events{/privacy}","received_events_url":"https://api.github.com/users/eileencodes/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2025-01-24T18:52:09Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rails/rails/issues/comments/2613271285","html_url":"https://github.com/rails/rails/issues/54343#issuecomment-2613271285","issue_url":"https://api.github.com/repos/rails/rails/issues/54343","id":2613271285,"node_id":"IC_kwDNIULOm8Na9Q","user":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-01-24T19:51:06Z","updated_at":"2025-01-24T19:51:06Z","body":"Would it be acceptable to cache the name and its primary-ness, rather than caching the class?\n\n```patch\ncommit e901ce1c (HEAD -> flavorjones-dont-cache-class-in-pool-config)\nAuthor: Mike Dalessio <mike.dalessio@gmail.com>\nDate:   2025-01-24 14:32:09 -0500\n\n    Avoid caching the connection class in the PoolConfig\n    \n    Instead, cache the name and whether it's primary.\n\ndiff --git a/activerecord/lib/active_record/connection_adapters/pool_config.rb b/activerecord/lib/active_record/connection_adapters/pool_config.rb\nindex 0010a48a..1a3ad417 100644\n--- a/activerecord/lib/active_record/connection_adapters/pool_config.rb\n+++ b/activerecord/lib/active_record/connection_adapters/pool_config.rb\n@@ -7,7 +7,6 @@ class PoolConfig # :nodoc:\n \n       attr_reader :db_config, :role, :shard\n       attr_writer :schema_reflection, :server_version\n-      attr_accessor :connection_class\n \n       def schema_reflection\n         @schema_reflection ||= SchemaReflection.new(db_config.lazy_schema_cache_path)\n@@ -29,7 +28,7 @@ def disconnect_all!\n       def initialize(connection_class, db_config, role, shard)\n         super()\n         @server_version = nil\n-        @connection_class = connection_class\n+        self.connection_class = connection_class\n         @db_config = db_config\n         @role = role\n         @shard = shard\n@@ -41,11 +40,20 @@ def server_version(connection)\n         @server_version || synchronize { @server_version ||= connection.get_database_version }\n       end\n \n+      def connection_class=(connection_class)\n+        @connection_class_name = connection_class.name\n+        @connection_class_primary_p = connection_class.primary_class?\n+      end\n+\n+      def connection_class\n+        @connection_class_name.constantize\n+      end\n+\n       def connection_name\n-        if connection_class.primary_class?\n+        if @connection_class_primary_p\n           \"ActiveRecord::Base\"\n         else\n-          connection_class.name\n+          @connection_class_name\n         end\n       end\n```\n\nThe downside, I guess, is doing unnecessary `constantize` in production code.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/comments/2613271285/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rails/rails/issues/comments/2613278687","html_url":"https://github.com/rails/rails/issues/54343#issuecomment-2613278687","issue_url":"https://api.github.com/repos/rails/rails/issues/54343","id":2613278687,"node_id":"IC_kwDNIULOm8N33w","user":{"login":"rafaelfranca","id":47848,"node_id":"MDQ6VXNlcjQ3ODQ4","avatar_url":"https://avatars.githubusercontent.com/u/47848?v=4","gravatar_id":"","url":"https://api.github.com/users/rafaelfranca","html_url":"https://github.com/rafaelfranca","followers_url":"https://api.github.com/users/rafaelfranca/followers","following_url":"https://api.github.com/users/rafaelfranca/following{/other_user}","gists_url":"https://api.github.com/users/rafaelfranca/gists{/gist_id}","starred_url":"https://api.github.com/users/rafaelfranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rafaelfranca/subscriptions","organizations_url":"https://api.github.com/users/rafaelfranca/orgs","repos_url":"https://api.github.com/users/rafaelfranca/repos","events_url":"https://api.github.com/users/rafaelfranca/events{/privacy}","received_events_url":"https://api.github.com/users/rafaelfranca/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-01-24T19:55:53Z","updated_at":"2025-01-24T19:55:53Z","body":"I think that is the way forward. I'm not concerned about the constantize in production code","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/comments/2613278687/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"rafaelfranca","id":47848,"node_id":"MDQ6VXNlcjQ3ODQ4","avatar_url":"https://avatars.githubusercontent.com/u/47848?v=4","gravatar_id":"","url":"https://api.github.com/users/rafaelfranca","html_url":"https://github.com/rafaelfranca","followers_url":"https://api.github.com/users/rafaelfranca/followers","following_url":"https://api.github.com/users/rafaelfranca/following{/other_user}","gists_url":"https://api.github.com/users/rafaelfranca/gists{/gist_id}","starred_url":"https://api.github.com/users/rafaelfranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rafaelfranca/subscriptions","organizations_url":"https://api.github.com/users/rafaelfranca/orgs","repos_url":"https://api.github.com/users/rafaelfranca/repos","events_url":"https://api.github.com/users/rafaelfranca/events{/privacy}","received_events_url":"https://api.github.com/users/rafaelfranca/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":16064193746,"node_id":"REFE_lADNIULOp3eM-c8AAAADvYAk0g","url":"https://api.github.com/repos/rails/rails/issues/events/16064193746","actor":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"bbd4afeac5053f24dacc3e593fcff631f0650470","commit_url":"https://api.github.com/repos/flavorjones/rails/commits/bbd4afeac5053f24dacc3e593fcff631f0650470","created_at":"2025-01-24T21:11:12Z","performed_via_github_app":null},{"actor":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-01-24T21:14:13Z","updated_at":"2025-01-24T21:14:13Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rails/rails/issues/54349","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/54349/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/54349/comments","events_url":"https://api.github.com/repos/rails/rails/issues/54349/events","html_url":"https://github.com/rails/rails/pull/54349","id":2810385631,"node_id":"PR_kwDNIULOiPL8LA","number":54349,"title":"`PoolConfig` should not keep a reference to the connection class.","user":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":107191,"node_id":"MDU6TGFiZWwxMDcxOTE=","url":"https://api.github.com/repos/rails/rails/labels/activerecord","name":"activerecord","color":"0b02e1","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2025-01-24T21:14:12Z","updated_at":"2025-01-26T22:16:54Z","closed_at":"2025-01-26T22:16:54Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":8514,"node_id":"MDEwOlJlcG9zaXRvcnk4NTE0","name":"rails","full_name":"rails/rails","private":false,"owner":{"login":"rails","id":4223,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQyMjM=","avatar_url":"https://avatars.githubusercontent.com/u/4223?v=4","gravatar_id":"","url":"https://api.github.com/users/rails","html_url":"https://github.com/rails","followers_url":"https://api.github.com/users/rails/followers","following_url":"https://api.github.com/users/rails/following{/other_user}","gists_url":"https://api.github.com/users/rails/gists{/gist_id}","starred_url":"https://api.github.com/users/rails/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rails/subscriptions","organizations_url":"https://api.github.com/users/rails/orgs","repos_url":"https://api.github.com/users/rails/repos","events_url":"https://api.github.com/users/rails/events{/privacy}","received_events_url":"https://api.github.com/users/rails/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rails/rails","description":"Ruby on Rails","fork":false,"url":"https://api.github.com/repos/rails/rails","forks_url":"https://api.github.com/repos/rails/rails/forks","keys_url":"https://api.github.com/repos/rails/rails/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rails/rails/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rails/rails/teams","hooks_url":"https://api.github.com/repos/rails/rails/hooks","issue_events_url":"https://api.github.com/repos/rails/rails/issues/events{/number}","events_url":"https://api.github.com/repos/rails/rails/events","assignees_url":"https://api.github.com/repos/rails/rails/assignees{/user}","branches_url":"https://api.github.com/repos/rails/rails/branches{/branch}","tags_url":"https://api.github.com/repos/rails/rails/tags","blobs_url":"https://api.github.com/repos/rails/rails/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rails/rails/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rails/rails/git/refs{/sha}","trees_url":"https://api.github.com/repos/rails/rails/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rails/rails/statuses/{sha}","languages_url":"https://api.github.com/repos/rails/rails/languages","stargazers_url":"https://api.github.com/repos/rails/rails/stargazers","contributors_url":"https://api.github.com/repos/rails/rails/contributors","subscribers_url":"https://api.github.com/repos/rails/rails/subscribers","subscription_url":"https://api.github.com/repos/rails/rails/subscription","commits_url":"https://api.github.com/repos/rails/rails/commits{/sha}","git_commits_url":"https://api.github.com/repos/rails/rails/git/commits{/sha}","comments_url":"https://api.github.com/repos/rails/rails/comments{/number}","issue_comment_url":"https://api.github.com/repos/rails/rails/issues/comments{/number}","contents_url":"https://api.github.com/repos/rails/rails/contents/{+path}","compare_url":"https://api.github.com/repos/rails/rails/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rails/rails/merges","archive_url":"https://api.github.com/repos/rails/rails/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rails/rails/downloads","issues_url":"https://api.github.com/repos/rails/rails/issues{/number}","pulls_url":"https://api.github.com/repos/rails/rails/pulls{/number}","milestones_url":"https://api.github.com/repos/rails/rails/milestones{/number}","notifications_url":"https://api.github.com/repos/rails/rails/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rails/rails/labels{/name}","releases_url":"https://api.github.com/repos/rails/rails/releases{/id}","deployments_url":"https://api.github.com/repos/rails/rails/deployments","created_at":"2008-04-11T02:19:47Z","updated_at":"2025-11-10T02:03:47Z","pushed_at":"2025-11-10T00:33:52Z","git_url":"git://github.com/rails/rails.git","ssh_url":"git@github.com:rails/rails.git","clone_url":"https://github.com/rails/rails.git","svn_url":"https://github.com/rails/rails","homepage":"https://rubyonrails.org","size":271619,"stargazers_count":57840,"watchers_count":57840,"language":"Ruby","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":22025,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1341,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["activejob","activerecord","framework","html","mvc","rails","ruby"],"visibility":"public","forks":22025,"open_issues":1341,"watchers":57840,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/rails/rails/pulls/54349","html_url":"https://github.com/rails/rails/pull/54349","diff_url":"https://github.com/rails/rails/pull/54349.diff","patch_url":"https://github.com/rails/rails/pull/54349.patch","merged_at":null},"body":"### Motivation / Background\r\n\r\nIssue #54343 describes a problem wherein the Active Record `PoolConfig` class keeps a reference to a connection class that has been reloaded in development, leading to issues like https://github.com/rails/solid_cache/issues/238\r\n\r\n\r\n### Detail\r\n\r\nThis PR modifies `PoolConfig` to store in instance variables:\r\n\r\n- the connection class name\r\n- whether the connection class is the primary abstract connection class\r\n\r\nand drops the reference to the class itself.\r\n\r\nIt also implements accessors for `connection_class` which will set the two values mentioned above, but also retrieve the class by name using `constantize`.\r\n\r\n\r\n### Additional information\r\n\r\nI don't feel great about there not being unit tests for `PoolConfig#connection_class` and `#connection_class=`. My optimistic assumption is that these accessors are being exercised indirectly through other parts of the test suite, and that may be adequate, but let me know if you want me to add some tests.\r\n\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/54349/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/rails/issues/54349/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/rails/rails/issues/comments/2613390089","html_url":"https://github.com/rails/rails/issues/54343#issuecomment-2613390089","issue_url":"https://api.github.com/repos/rails/rails/issues/54343","id":2613390089,"node_id":"IC_kwDNIULOm8UrCQ","user":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-01-24T21:14:35Z","updated_at":"2025-01-27T16:36:26Z","body":"Drafted ~https://github.com/rails/rails/pull/54349~ https://github.com/rails/rails/pull/54366","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/comments/2613390089/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":16064651759,"node_id":"REFE_lADNIULOp3eM-c8AAAADvYch7w","url":"https://api.github.com/repos/rails/rails/issues/events/16064651759","actor":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"c883a3f9d0b484b8c3fc1c334fdcea7428c81381","commit_url":"https://api.github.com/repos/flavorjones/rails/commits/c883a3f9d0b484b8c3fc1c334fdcea7428c81381","created_at":"2025-01-24T22:01:15Z","performed_via_github_app":null},{"id":16065134921,"node_id":"REFE_lADNIULOp3eM-c8AAAADvY6BSQ","url":"https://api.github.com/repos/rails/rails/issues/events/16065134921","actor":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"15d25086c31121968e35669b5df7f6ae2dd6951a","commit_url":"https://api.github.com/repos/flavorjones/rails/commits/15d25086c31121968e35669b5df7f6ae2dd6951a","created_at":"2025-01-24T22:54:57Z","performed_via_github_app":null},{"actor":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-01-24T22:57:47Z","updated_at":"2025-01-24T22:57:47Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rails/rails/issues/54350","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/54350/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/54350/comments","events_url":"https://api.github.com/repos/rails/rails/issues/54350/events","html_url":"https://github.com/rails/rails/pull/54350","id":2810524296,"node_id":"PR_kwDNIULOiPTkdg","number":54350,"title":"`PoolConfig` double-checks its connection class reference for reloading","user":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":107191,"node_id":"MDU6TGFiZWwxMDcxOTE=","url":"https://api.github.com/repos/rails/rails/labels/activerecord","name":"activerecord","color":"0b02e1","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2025-01-24T22:57:46Z","updated_at":"2025-01-26T22:17:15Z","closed_at":"2025-01-26T22:17:15Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":8514,"node_id":"MDEwOlJlcG9zaXRvcnk4NTE0","name":"rails","full_name":"rails/rails","private":false,"owner":{"login":"rails","id":4223,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQyMjM=","avatar_url":"https://avatars.githubusercontent.com/u/4223?v=4","gravatar_id":"","url":"https://api.github.com/users/rails","html_url":"https://github.com/rails","followers_url":"https://api.github.com/users/rails/followers","following_url":"https://api.github.com/users/rails/following{/other_user}","gists_url":"https://api.github.com/users/rails/gists{/gist_id}","starred_url":"https://api.github.com/users/rails/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rails/subscriptions","organizations_url":"https://api.github.com/users/rails/orgs","repos_url":"https://api.github.com/users/rails/repos","events_url":"https://api.github.com/users/rails/events{/privacy}","received_events_url":"https://api.github.com/users/rails/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rails/rails","description":"Ruby on Rails","fork":false,"url":"https://api.github.com/repos/rails/rails","forks_url":"https://api.github.com/repos/rails/rails/forks","keys_url":"https://api.github.com/repos/rails/rails/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rails/rails/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rails/rails/teams","hooks_url":"https://api.github.com/repos/rails/rails/hooks","issue_events_url":"https://api.github.com/repos/rails/rails/issues/events{/number}","events_url":"https://api.github.com/repos/rails/rails/events","assignees_url":"https://api.github.com/repos/rails/rails/assignees{/user}","branches_url":"https://api.github.com/repos/rails/rails/branches{/branch}","tags_url":"https://api.github.com/repos/rails/rails/tags","blobs_url":"https://api.github.com/repos/rails/rails/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rails/rails/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rails/rails/git/refs{/sha}","trees_url":"https://api.github.com/repos/rails/rails/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rails/rails/statuses/{sha}","languages_url":"https://api.github.com/repos/rails/rails/languages","stargazers_url":"https://api.github.com/repos/rails/rails/stargazers","contributors_url":"https://api.github.com/repos/rails/rails/contributors","subscribers_url":"https://api.github.com/repos/rails/rails/subscribers","subscription_url":"https://api.github.com/repos/rails/rails/subscription","commits_url":"https://api.github.com/repos/rails/rails/commits{/sha}","git_commits_url":"https://api.github.com/repos/rails/rails/git/commits{/sha}","comments_url":"https://api.github.com/repos/rails/rails/comments{/number}","issue_comment_url":"https://api.github.com/repos/rails/rails/issues/comments{/number}","contents_url":"https://api.github.com/repos/rails/rails/contents/{+path}","compare_url":"https://api.github.com/repos/rails/rails/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rails/rails/merges","archive_url":"https://api.github.com/repos/rails/rails/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rails/rails/downloads","issues_url":"https://api.github.com/repos/rails/rails/issues{/number}","pulls_url":"https://api.github.com/repos/rails/rails/pulls{/number}","milestones_url":"https://api.github.com/repos/rails/rails/milestones{/number}","notifications_url":"https://api.github.com/repos/rails/rails/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rails/rails/labels{/name}","releases_url":"https://api.github.com/repos/rails/rails/releases{/id}","deployments_url":"https://api.github.com/repos/rails/rails/deployments","created_at":"2008-04-11T02:19:47Z","updated_at":"2025-11-10T02:03:47Z","pushed_at":"2025-11-10T00:33:52Z","git_url":"git://github.com/rails/rails.git","ssh_url":"git@github.com:rails/rails.git","clone_url":"https://github.com/rails/rails.git","svn_url":"https://github.com/rails/rails","homepage":"https://rubyonrails.org","size":271619,"stargazers_count":57840,"watchers_count":57840,"language":"Ruby","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":22025,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1341,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["activejob","activerecord","framework","html","mvc","rails","ruby"],"visibility":"public","forks":22025,"open_issues":1341,"watchers":57840,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/rails/rails/pulls/54350","html_url":"https://github.com/rails/rails/pull/54350","diff_url":"https://github.com/rails/rails/pull/54350.diff","patch_url":"https://github.com/rails/rails/pull/54350.patch","merged_at":null},"body":"### Motivation / Background\r\n\r\nIssue #54343 describes a problem wherein the Active Record `PoolConfig` class keeps a reference to a connection class that has been reloaded in development, leading to issues like https://github.com/rails/solid_cache/issues/238\r\n\r\n### Detail\r\n\r\nThis is attempt number 2 to address this problem, see #54349 for comparison.\r\n\r\nThis pull request simply does a lookup of the constant when `#connection_class` is called, in case the class has been reloaded.\r\n\r\nThat lookup may fail in scenarios where classes are given names but are not assigned to a constant. In that case, the class can't/won't be reloaded, so we're not worried about it.\r\n\r\n### Additional information\r\n\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [-] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/54350/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/rails/issues/54350/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":16071021556,"node_id":"REFE_lADNIULOp3eM-c8AAAADvehT9A","url":"https://api.github.com/repos/rails/rails/issues/events/16071021556","actor":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"3fa64fffbbbcba085aeafb3b44a983fec092732d","commit_url":"https://api.github.com/repos/flavorjones/rails/commits/3fa64fffbbbcba085aeafb3b44a983fec092732d","created_at":"2025-01-26T20:39:10Z","performed_via_github_app":null},{"id":16071052761,"node_id":"REFE_lADNIULOp3eM-c8AAAADvejN2Q","url":"https://api.github.com/repos/rails/rails/issues/events/16071052761","actor":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"f985f78c5a1ca8c378908b802417d64d68d28f9d","commit_url":"https://api.github.com/repos/flavorjones/rails/commits/f985f78c5a1ca8c378908b802417d64d68d28f9d","created_at":"2025-01-26T20:55:14Z","performed_via_github_app":null},{"id":16071200371,"node_id":"REFE_lADNIULOp3eM-c8AAAADvesOcw","url":"https://api.github.com/repos/rails/rails/issues/events/16071200371","actor":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"3d0c70cb460b866891c98a27a75f43fd823b3af2","commit_url":"https://api.github.com/repos/flavorjones/rails/commits/3d0c70cb460b866891c98a27a75f43fd823b3af2","created_at":"2025-01-26T22:12:03Z","performed_via_github_app":null},{"actor":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-01-26T22:16:14Z","updated_at":"2025-01-26T22:16:14Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rails/rails/issues/54366","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/54366/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/54366/comments","events_url":"https://api.github.com/repos/rails/rails/issues/54366/events","html_url":"https://github.com/rails/rails/pull/54366","id":2811816457,"node_id":"PR_kwDNIULOiQVq6Q","number":54366,"title":"`PoolConfig` no longer keeps a reference to the connection class (attempt 3)","user":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":107191,"node_id":"MDU6TGFiZWwxMDcxOTE=","url":"https://api.github.com/repos/rails/rails/labels/activerecord","name":"activerecord","color":"0b02e1","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2025-01-26T22:16:13Z","updated_at":"2025-01-27T18:09:40Z","closed_at":"2025-01-27T17:23:01Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":8514,"node_id":"MDEwOlJlcG9zaXRvcnk4NTE0","name":"rails","full_name":"rails/rails","private":false,"owner":{"login":"rails","id":4223,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQyMjM=","avatar_url":"https://avatars.githubusercontent.com/u/4223?v=4","gravatar_id":"","url":"https://api.github.com/users/rails","html_url":"https://github.com/rails","followers_url":"https://api.github.com/users/rails/followers","following_url":"https://api.github.com/users/rails/following{/other_user}","gists_url":"https://api.github.com/users/rails/gists{/gist_id}","starred_url":"https://api.github.com/users/rails/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rails/subscriptions","organizations_url":"https://api.github.com/users/rails/orgs","repos_url":"https://api.github.com/users/rails/repos","events_url":"https://api.github.com/users/rails/events{/privacy}","received_events_url":"https://api.github.com/users/rails/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rails/rails","description":"Ruby on Rails","fork":false,"url":"https://api.github.com/repos/rails/rails","forks_url":"https://api.github.com/repos/rails/rails/forks","keys_url":"https://api.github.com/repos/rails/rails/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rails/rails/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rails/rails/teams","hooks_url":"https://api.github.com/repos/rails/rails/hooks","issue_events_url":"https://api.github.com/repos/rails/rails/issues/events{/number}","events_url":"https://api.github.com/repos/rails/rails/events","assignees_url":"https://api.github.com/repos/rails/rails/assignees{/user}","branches_url":"https://api.github.com/repos/rails/rails/branches{/branch}","tags_url":"https://api.github.com/repos/rails/rails/tags","blobs_url":"https://api.github.com/repos/rails/rails/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rails/rails/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rails/rails/git/refs{/sha}","trees_url":"https://api.github.com/repos/rails/rails/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rails/rails/statuses/{sha}","languages_url":"https://api.github.com/repos/rails/rails/languages","stargazers_url":"https://api.github.com/repos/rails/rails/stargazers","contributors_url":"https://api.github.com/repos/rails/rails/contributors","subscribers_url":"https://api.github.com/repos/rails/rails/subscribers","subscription_url":"https://api.github.com/repos/rails/rails/subscription","commits_url":"https://api.github.com/repos/rails/rails/commits{/sha}","git_commits_url":"https://api.github.com/repos/rails/rails/git/commits{/sha}","comments_url":"https://api.github.com/repos/rails/rails/comments{/number}","issue_comment_url":"https://api.github.com/repos/rails/rails/issues/comments{/number}","contents_url":"https://api.github.com/repos/rails/rails/contents/{+path}","compare_url":"https://api.github.com/repos/rails/rails/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rails/rails/merges","archive_url":"https://api.github.com/repos/rails/rails/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rails/rails/downloads","issues_url":"https://api.github.com/repos/rails/rails/issues{/number}","pulls_url":"https://api.github.com/repos/rails/rails/pulls{/number}","milestones_url":"https://api.github.com/repos/rails/rails/milestones{/number}","notifications_url":"https://api.github.com/repos/rails/rails/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rails/rails/labels{/name}","releases_url":"https://api.github.com/repos/rails/rails/releases{/id}","deployments_url":"https://api.github.com/repos/rails/rails/deployments","created_at":"2008-04-11T02:19:47Z","updated_at":"2025-11-10T02:03:47Z","pushed_at":"2025-11-10T00:33:52Z","git_url":"git://github.com/rails/rails.git","ssh_url":"git@github.com:rails/rails.git","clone_url":"https://github.com/rails/rails.git","svn_url":"https://github.com/rails/rails","homepage":"https://rubyonrails.org","size":271619,"stargazers_count":57840,"watchers_count":57840,"language":"Ruby","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":22025,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1341,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["activejob","activerecord","framework","html","mvc","rails","ruby"],"visibility":"public","forks":22025,"open_issues":1341,"watchers":57840,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/rails/rails/pulls/54366","html_url":"https://github.com/rails/rails/pull/54366","diff_url":"https://github.com/rails/rails/pull/54366.diff","patch_url":"https://github.com/rails/rails/pull/54366.patch","merged_at":"2025-01-27T17:23:01Z"},"body":"### Motivation / Background\r\n\r\nAlt to https://github.com/rails/rails/pull/54350 and https://github.com/rails/rails/pull/54349, fixes https://github.com/rails/rails/issues/54343\r\n\r\n\r\n### Detail\r\n\r\nThis is variation on #54349 that extends `ConnectionHandler::StringConnectionName` to track `primary_class?`, and introduces `ActiveRecord::Base.preventing_writes?` that will accept a connection name and do the same thing that `current_preventing_writes` does on a record class.\r\n\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [-] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/54366/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/rails/issues/54366/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":16071223535,"node_id":"REFE_lADNIULOp3eM-c8AAAADveto7w","url":"https://api.github.com/repos/rails/rails/issues/events/16071223535","actor":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"b1364977d35137586b504113bc0c5c8852556875","commit_url":"https://api.github.com/repos/flavorjones/rails/commits/b1364977d35137586b504113bc0c5c8852556875","created_at":"2025-01-26T22:24:50Z","performed_via_github_app":null},{"id":16078445008,"node_id":"REFE_lADNIULOp3eM-c8AAAADvlmZ0A","url":"https://api.github.com/repos/rails/rails/issues/events/16078445008","actor":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"75263120665eff3132e6d1f085487d5b063676ec","commit_url":"https://api.github.com/repos/flavorjones/rails/commits/75263120665eff3132e6d1f085487d5b063676ec","created_at":"2025-01-27T14:01:49Z","performed_via_github_app":null},{"id":16080667710,"node_id":"REFE_lADNIULOp3eM-c8AAAADvnuEPg","url":"https://api.github.com/repos/rails/rails/issues/events/16080667710","actor":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"4cf92a5a2c04cd71acfbe02461c93b338e63bb6e","commit_url":"https://api.github.com/repos/flavorjones/rails/commits/4cf92a5a2c04cd71acfbe02461c93b338e63bb6e","created_at":"2025-01-27T16:29:16Z","performed_via_github_app":null},{"id":16080701121,"node_id":"REFE_lADNIULOp3eM-c8AAAADvnwGwQ","url":"https://api.github.com/repos/rails/rails/issues/events/16080701121","actor":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"f6c3b68c4d1cb539ede53ea39ea6d1d37dc1f335","commit_url":"https://api.github.com/repos/flavorjones/rails/commits/f6c3b68c4d1cb539ede53ea39ea6d1d37dc1f335","created_at":"2025-01-27T16:31:28Z","performed_via_github_app":null},{"id":16080766079,"node_id":"REFE_lADNIULOp3eM-c8AAAADvn0Efw","url":"https://api.github.com/repos/rails/rails/issues/events/16080766079","actor":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"9ebeda0770e1bb983639bf98450a94e024a55573","commit_url":"https://api.github.com/repos/flavorjones/rails/commits/9ebeda0770e1bb983639bf98450a94e024a55573","created_at":"2025-01-27T16:35:57Z","performed_via_github_app":null},{"id":16080856412,"node_id":"REFE_lADNIULOp3eM-c8AAAADvn5lXA","url":"https://api.github.com/repos/rails/rails/issues/events/16080856412","actor":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"2a90dbcdf6738a544bc2062823c56040feadabe0","commit_url":"https://api.github.com/repos/flavorjones/rails/commits/2a90dbcdf6738a544bc2062823c56040feadabe0","created_at":"2025-01-27T16:42:09Z","performed_via_github_app":null},{"id":16081442235,"node_id":"CE_lADNIULOp3eM-c8AAAADvodVuw","url":"https://api.github.com/repos/rails/rails/issues/events/16081442235","actor":{"login":"byroot","id":44640,"node_id":"MDQ6VXNlcjQ0NjQw","avatar_url":"https://avatars.githubusercontent.com/u/44640?v=4","gravatar_id":"","url":"https://api.github.com/users/byroot","html_url":"https://github.com/byroot","followers_url":"https://api.github.com/users/byroot/followers","following_url":"https://api.github.com/users/byroot/following{/other_user}","gists_url":"https://api.github.com/users/byroot/gists{/gist_id}","starred_url":"https://api.github.com/users/byroot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/byroot/subscriptions","organizations_url":"https://api.github.com/users/byroot/orgs","repos_url":"https://api.github.com/users/byroot/repos","events_url":"https://api.github.com/users/byroot/events{/privacy}","received_events_url":"https://api.github.com/users/byroot/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2025-01-27T17:23:03Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/rails/rails/issues/comments/3432129141","html_url":"https://github.com/rails/rails/issues/54343#issuecomment-3432129141","issue_url":"https://api.github.com/repos/rails/rails/issues/54343","id":3432129141,"node_id":"IC_kwDNIULOzJIidQ","user":{"login":"ThomasF34","id":32480223,"node_id":"MDQ6VXNlcjMyNDgwMjIz","avatar_url":"https://avatars.githubusercontent.com/u/32480223?v=4","gravatar_id":"","url":"https://api.github.com/users/ThomasF34","html_url":"https://github.com/ThomasF34","followers_url":"https://api.github.com/users/ThomasF34/followers","following_url":"https://api.github.com/users/ThomasF34/following{/other_user}","gists_url":"https://api.github.com/users/ThomasF34/gists{/gist_id}","starred_url":"https://api.github.com/users/ThomasF34/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ThomasF34/subscriptions","organizations_url":"https://api.github.com/users/ThomasF34/orgs","repos_url":"https://api.github.com/users/ThomasF34/repos","events_url":"https://api.github.com/users/ThomasF34/events{/privacy}","received_events_url":"https://api.github.com/users/ThomasF34/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-10-22T12:31:07Z","updated_at":"2025-10-22T13:04:01Z","body":"Hey @flavorjones, thanks for your fix in #54366\nI have an issue that is very similar to yours and would appreciate your input. \n\nIt seems that with a primary abstract class, the name of the ConnectorDescription (which has been bypassed to `\"ActiveRecord::Base\"`) is compared to the _real_ name of the class, which, in my case, is `ApplicationRecord`. It leads to an incorrect value of `ActiveRecord::Base.preventing_writes?`\n\nHere are more details. \n\nThe test case that reproduces the issue is \n```ruby\n    context 'issue test' do\n      it 'prevent writes with ActiveRecord::Base' do\n        ActiveRecord::Base.transaction do\n          ActiveRecord::Base.connected_to(role: :reading) do\n            ActiveRecord::Base.with_connection do |c|\n              c.exec_query(\"UPDATE users SET first_name = 'Jean'\")\n            end\n          end\n        end\n      end\n\n      it 'prevent writes with ApplicationRecord' do\n        ApplicationRecord.transaction do\n          ApplicationRecord.connected_to(role: :reading) do\n            ApplicationRecord.with_connection do |c|\n              c.exec_query(\"UPDATE users SET first_name = 'Jean'\")\n            end\n          end\n        end\n      end\n    end\n```\n**The first spec raises an error (expected) but not the second, though ApplicationRecord is my primary class**\n\nI have been able to dig the following:\n```\npreventing_writes? [core.rb:208]\ncurrent_preventing_writes [connection_handler.rb:72]\npreventing_writes? [abstract_adapter.rb:233]\ncheck_if_write_query [abstract_adapter.rb:196]\npreprocess_query [database_statements.rb:575]\ninternal_execute [database_statements.rb:590]\ninternal_exec_query [database_statements.rb:547]\nexec_query [database_statements.rb:148]\nexec_query [query_cache.rb:27]\n```\n\nin `preventing_writes? [core.rb:208]` I have the following connection stack.\nThe `klasses` here is my primary class, which is compared to the name `ActiveRecord::Base`, hence the issue. \n```\nconnected_to_stack\n=> [{role: :reading, shard: nil, prevent_writes: true, klasses: [ApplicationRecord(abstract)]}]\n```\n\nMy first impression here is that the comparison with `klasses` is missing the same bypass logic as in the `name` you added in your fix, or am I missing something else? \n\nThanks for your help on this \n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/comments/3432129141/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ThomasF34","id":32480223,"node_id":"MDQ6VXNlcjMyNDgwMjIz","avatar_url":"https://avatars.githubusercontent.com/u/32480223?v=4","gravatar_id":"","url":"https://api.github.com/users/ThomasF34","html_url":"https://github.com/ThomasF34","followers_url":"https://api.github.com/users/ThomasF34/followers","following_url":"https://api.github.com/users/ThomasF34/following{/other_user}","gists_url":"https://api.github.com/users/ThomasF34/gists{/gist_id}","starred_url":"https://api.github.com/users/ThomasF34/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ThomasF34/subscriptions","organizations_url":"https://api.github.com/users/ThomasF34/orgs","repos_url":"https://api.github.com/users/ThomasF34/repos","events_url":"https://api.github.com/users/ThomasF34/events{/privacy}","received_events_url":"https://api.github.com/users/ThomasF34/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":20430107428,"node_id":"MEE_lADNIULOp3eM-c8AAAAEwbqzJA","url":"https://api.github.com/repos/rails/rails/issues/events/20430107428","actor":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2025-10-22T12:31:08Z","performed_via_github_app":null},{"id":20430107461,"node_id":"SE_lADNIULOp3eM-c8AAAAEwbqzRQ","url":"https://api.github.com/repos/rails/rails/issues/events/20430107461","actor":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2025-10-22T12:31:08Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rails/rails/issues/comments/3438374021","html_url":"https://github.com/rails/rails/issues/54343#issuecomment-3438374021","issue_url":"https://api.github.com/repos/rails/rails/issues/54343","id":3438374021,"node_id":"IC_kwDNIULOzPFshQ","user":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-10-23T17:54:51Z","updated_at":"2025-10-23T17:54:51Z","body":"@ThomasF34 Thanks for posting the clear test case. I think you're right, and I'll take a look.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/comments/3438374021/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"flavorjones","id":8207,"node_id":"MDQ6VXNlcjgyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/8207?v=4","gravatar_id":"","url":"https://api.github.com/users/flavorjones","html_url":"https://github.com/flavorjones","followers_url":"https://api.github.com/users/flavorjones/followers","following_url":"https://api.github.com/users/flavorjones/following{/other_user}","gists_url":"https://api.github.com/users/flavorjones/gists{/gist_id}","starred_url":"https://api.github.com/users/flavorjones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flavorjones/subscriptions","organizations_url":"https://api.github.com/users/flavorjones/orgs","repos_url":"https://api.github.com/users/flavorjones/repos","events_url":"https://api.github.com/users/flavorjones/events{/privacy}","received_events_url":"https://api.github.com/users/flavorjones/received_events","type":"User","user_view_type":"public","site_admin":false}}]