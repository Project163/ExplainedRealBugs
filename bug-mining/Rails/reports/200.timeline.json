[{"url":"https://api.github.com/repos/rails/rails/issues/comments/1883414291","html_url":"https://github.com/rails/rails/issues/50672#issuecomment-1883414291","issue_url":"https://api.github.com/repos/rails/rails/issues/50672","id":1883414291,"node_id":"IC_kwDNIULOcEKfEw","user":{"login":"bparanj","id":12740,"node_id":"MDQ6VXNlcjEyNzQw","avatar_url":"https://avatars.githubusercontent.com/u/12740?v=4","gravatar_id":"","url":"https://api.github.com/users/bparanj","html_url":"https://github.com/bparanj","followers_url":"https://api.github.com/users/bparanj/followers","following_url":"https://api.github.com/users/bparanj/following{/other_user}","gists_url":"https://api.github.com/users/bparanj/gists{/gist_id}","starred_url":"https://api.github.com/users/bparanj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bparanj/subscriptions","organizations_url":"https://api.github.com/users/bparanj/orgs","repos_url":"https://api.github.com/users/bparanj/repos","events_url":"https://api.github.com/users/bparanj/events{/privacy}","received_events_url":"https://api.github.com/users/bparanj/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-09T16:49:35Z","updated_at":"2024-01-09T16:49:35Z","body":"I reproduced the problem.\r\n\r\n```\r\n$ bin/rails db:schema:load:one --trace\r\n** Invoke db:schema:load:one (first_time)\r\n** Invoke db:test:purge:one (first_time)\r\n** Invoke db:load_config (first_time)\r\n** Invoke environment (first_time)\r\n** Execute environment\r\n** Execute db:load_config\r\n** Invoke db:check_protected_environments (first_time)\r\n** Invoke db:load_config \r\n** Execute db:check_protected_environments\r\n** Execute db:test:purge:one\r\nbin/rails aborted!\r\nTypeError: Invalid type for configuration. Expected Symbol, String, or Hash. Got nil (TypeError)\r\n\r\n        raise TypeError, \"Invalid type for configuration. Expected Symbol, String, or Hash. Got #{config.inspect}\"\r\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/activerecord-7.1.2/lib/active_record/database_configurations.rb:183:in `resolve'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/activerecord-7.1.2/lib/active_record/connection_adapters/abstract/connection_handler.rb:324:in `resolve_pool_config'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/activerecord-7.1.2/lib/active_record/connection_adapters/abstract/connection_handler.rb:134:in `establish_connection'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/activerecord-7.1.2/lib/active_record/tasks/database_tasks.rb:516:in `with_temporary_pool'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/activerecord-7.1.2/lib/active_record/tasks/database_tasks.rb:500:in `with_temporary_connection'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/activerecord-7.1.2/lib/active_record/tasks/database_tasks.rb:491:in `with_temporary_connection_for_each'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/activerecord-7.1.2/lib/active_record/railties/databases.rake:588:in `block (5 levels) in <main>'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/rake-13.1.0/lib/rake/task.rb:281:in `block in execute'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/rake-13.1.0/lib/rake/task.rb:281:in `each'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/rake-13.1.0/lib/rake/task.rb:281:in `execute'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/rake-13.1.0/lib/rake/task.rb:219:in `block in invoke_with_call_chain'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/rake-13.1.0/lib/rake/task.rb:199:in `synchronize'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/rake-13.1.0/lib/rake/task.rb:199:in `invoke_with_call_chain'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/rake-13.1.0/lib/rake/task.rb:243:in `block in invoke_prerequisites'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/rake-13.1.0/lib/rake/task.rb:241:in `each'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/rake-13.1.0/lib/rake/task.rb:241:in `invoke_prerequisites'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/rake-13.1.0/lib/rake/task.rb:218:in `block in invoke_with_call_chain'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/rake-13.1.0/lib/rake/task.rb:199:in `synchronize'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/rake-13.1.0/lib/rake/task.rb:199:in `invoke_with_call_chain'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/rake-13.1.0/lib/rake/task.rb:188:in `invoke'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/rake-13.1.0/lib/rake/application.rb:182:in `invoke_task'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/rake-13.1.0/lib/rake/application.rb:138:in `block (2 levels) in top_level'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/rake-13.1.0/lib/rake/application.rb:138:in `each'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/rake-13.1.0/lib/rake/application.rb:138:in `block in top_level'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/rake-13.1.0/lib/rake/application.rb:147:in `run_with_threads'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/rake-13.1.0/lib/rake/application.rb:132:in `top_level'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/railties-7.1.2/lib/rails/commands/rake/rake_command.rb:27:in `block (2 levels) in perform'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/rake-13.1.0/lib/rake/application.rb:208:in `standard_exception_handling'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/railties-7.1.2/lib/rails/commands/rake/rake_command.rb:27:in `block in perform'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/railties-7.1.2/lib/rails/commands/rake/rake_command.rb:44:in `block in with_rake'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/rake-13.1.0/lib/rake/rake_module.rb:59:in `with_application'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/railties-7.1.2/lib/rails/commands/rake/rake_command.rb:41:in `with_rake'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/railties-7.1.2/lib/rails/commands/rake/rake_command.rb:20:in `perform'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/railties-7.1.2/lib/rails/command.rb:156:in `invoke_rake'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/railties-7.1.2/lib/rails/command.rb:73:in `block in invoke'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/railties-7.1.2/lib/rails/command.rb:149:in `with_argv'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/railties-7.1.2/lib/rails/command.rb:69:in `invoke'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/railties-7.1.2/lib/rails/commands.rb:18:in `<main>'\r\n<internal:/Users/bparanj/.rvm/rubies/ruby-3.2.2/lib/ruby/site_ruby/3.2.0/rubygems/core_ext/kernel_require.rb>:37:in `require'\r\n<internal:/Users/bparanj/.rvm/rubies/ruby-3.2.2/lib/ruby/site_ruby/3.2.0/rubygems/core_ext/kernel_require.rb>:37:in `require'\r\n/Users/bparanj/.rvm/gems/ruby-3.2.2@50672/gems/bootsnap-1.17.0/lib/bootsnap/load_path_cache/core_ext/kernel_require.rb:32:in `require'\r\nbin/rails:4:in `<main>'\r\nTasks: TOP => db:schema:load:one => db:test:purge:one\r\n```","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/comments/1883414291/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bparanj","id":12740,"node_id":"MDQ6VXNlcjEyNzQw","avatar_url":"https://avatars.githubusercontent.com/u/12740?v=4","gravatar_id":"","url":"https://api.github.com/users/bparanj","html_url":"https://github.com/bparanj","followers_url":"https://api.github.com/users/bparanj/followers","following_url":"https://api.github.com/users/bparanj/following{/other_user}","gists_url":"https://api.github.com/users/bparanj/gists{/gist_id}","starred_url":"https://api.github.com/users/bparanj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bparanj/subscriptions","organizations_url":"https://api.github.com/users/bparanj/orgs","repos_url":"https://api.github.com/users/bparanj/repos","events_url":"https://api.github.com/users/bparanj/events{/privacy}","received_events_url":"https://api.github.com/users/bparanj/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":11437079419,"node_id":"LE_lADNIULOe4ZCgM8AAAACqbP7ew","url":"https://api.github.com/repos/rails/rails/issues/events/11437079419","actor":{"login":"rafaelfranca","id":47848,"node_id":"MDQ6VXNlcjQ3ODQ4","avatar_url":"https://avatars.githubusercontent.com/u/47848?v=4","gravatar_id":"","url":"https://api.github.com/users/rafaelfranca","html_url":"https://github.com/rafaelfranca","followers_url":"https://api.github.com/users/rafaelfranca/followers","following_url":"https://api.github.com/users/rafaelfranca/following{/other_user}","gists_url":"https://api.github.com/users/rafaelfranca/gists{/gist_id}","starred_url":"https://api.github.com/users/rafaelfranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rafaelfranca/subscriptions","organizations_url":"https://api.github.com/users/rafaelfranca/orgs","repos_url":"https://api.github.com/users/rafaelfranca/repos","events_url":"https://api.github.com/users/rafaelfranca/events{/privacy}","received_events_url":"https://api.github.com/users/rafaelfranca/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-01-10T00:14:47Z","label":{"name":"activerecord","color":"0b02e1"},"performed_via_github_app":null},{"id":11437079422,"node_id":"LE_lADNIULOe4ZCgM8AAAACqbP7fg","url":"https://api.github.com/repos/rails/rails/issues/events/11437079422","actor":{"login":"rafaelfranca","id":47848,"node_id":"MDQ6VXNlcjQ3ODQ4","avatar_url":"https://avatars.githubusercontent.com/u/47848?v=4","gravatar_id":"","url":"https://api.github.com/users/rafaelfranca","html_url":"https://github.com/rafaelfranca","followers_url":"https://api.github.com/users/rafaelfranca/followers","following_url":"https://api.github.com/users/rafaelfranca/following{/other_user}","gists_url":"https://api.github.com/users/rafaelfranca/gists{/gist_id}","starred_url":"https://api.github.com/users/rafaelfranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rafaelfranca/subscriptions","organizations_url":"https://api.github.com/users/rafaelfranca/orgs","repos_url":"https://api.github.com/users/rafaelfranca/repos","events_url":"https://api.github.com/users/rafaelfranca/events{/privacy}","received_events_url":"https://api.github.com/users/rafaelfranca/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-01-10T00:14:47Z","label":{"name":"With reproduction steps","color":"009800"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rails/rails/issues/comments/1884151541","html_url":"https://github.com/rails/rails/issues/50672#issuecomment-1884151541","issue_url":"https://api.github.com/repos/rails/rails/issues/50672","id":1884151541,"node_id":"IC_kwDNIULOcE3e9Q","user":{"login":"ricardotk002","id":3733470,"node_id":"MDQ6VXNlcjM3MzM0NzA=","avatar_url":"https://avatars.githubusercontent.com/u/3733470?v=4","gravatar_id":"","url":"https://api.github.com/users/ricardotk002","html_url":"https://github.com/ricardotk002","followers_url":"https://api.github.com/users/ricardotk002/followers","following_url":"https://api.github.com/users/ricardotk002/following{/other_user}","gists_url":"https://api.github.com/users/ricardotk002/gists{/gist_id}","starred_url":"https://api.github.com/users/ricardotk002/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ricardotk002/subscriptions","organizations_url":"https://api.github.com/users/ricardotk002/orgs","repos_url":"https://api.github.com/users/ricardotk002/repos","events_url":"https://api.github.com/users/ricardotk002/events{/privacy}","received_events_url":"https://api.github.com/users/ricardotk002/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-10T03:53:33Z","updated_at":"2024-01-10T03:53:33Z","body":"I've been digging into and it seems `db:test:purge:#{name}` expects a config entry for test databases otherwise it will fail. The task `db:schema:load:#{name}` depends on it and will fail too if that config is missing.\r\n\r\nI kind of understand the dependency between `db:schema:load:#{name}` and `db:test:purge:#{name}` tasks, but it seems that`db:schema:load` should be updated to depend on `db:test:purge` too, so everything stays consistent.\r\n\r\nI prepared this patch that should fix the issue but I'm not so sure if it's a definitive solution. I'm happy to open a PR if this is ok.\r\n\r\n```diff\r\ndiff --git a/activerecord/lib/active_record/railties/databases.rake b/activerecord/lib/active_record/railties/databases.rake\r\nindex 08c45c8fba..1a5a1a1694 100644\r\n--- a/activerecord/lib/active_record/railties/databases.rake\r\n+++ b/activerecord/lib/active_record/railties/databases.rake\r\n@@ -472,7 +472,7 @@ db_namespace = namespace :db do\r\n     end\r\n \r\n     desc \"Load a database schema file (either db/schema.rb or db/structure.sql, depending on `ENV['SCHEMA_FORMAT']` or `config.active_record.schema_format`) into the database\"\r\n-    task load: [:load_config, :check_protected_environments] do\r\n+    task load: [\"db:test:purge\"] do\r\n       ActiveRecord::Tasks::DatabaseTasks.load_schema_current(ActiveRecord.schema_format, ENV[\"SCHEMA\"])\r\n     end\r\n \r\n@@ -587,7 +587,7 @@ db_namespace = namespace :db do\r\n         task name => %w(load_config check_protected_environments) do\r\n           ActiveRecord::Tasks::DatabaseTasks.with_temporary_connection_for_each(env: \"test\", name: name) do |conn|\r\n             db_config = conn.pool.db_config\r\n-            ActiveRecord::Tasks::DatabaseTasks.purge(db_config)\r\n+            ActiveRecord::Tasks::DatabaseTasks.purge(db_config) if db_config\r\n           end\r\n         end\r\n       end\r\ndiff --git a/activerecord/lib/active_record/tasks/database_tasks.rb b/activerecord/lib/active_record/tasks/database_tasks.rb\r\nindex 0683e5862f..b72da4d401 100644\r\n--- a/activerecord/lib/active_record/tasks/database_tasks.rb\r\n+++ b/activerecord/lib/active_record/tasks/database_tasks.rb\r\n@@ -488,6 +488,7 @@ def clear_schema_cache(filename)\r\n       def with_temporary_connection_for_each(env: ActiveRecord::Tasks::DatabaseTasks.env, name: nil, clobber: false, &block) # :nodoc:\r\n         if name\r\n           db_config = ActiveRecord::Base.configurations.configs_for(env_name: env, name: name)\r\n+          return unless db_config\r\n           with_temporary_connection(db_config, clobber: clobber, &block)\r\n         else\r\n           ActiveRecord::Base.configurations.configs_for(env_name: env, name: name).each do |db_config|\r\n```\r\n\r\nAfter this change the sequence of tasks for both cases is the following:\r\n\r\n```\r\n$ bin/rails db:schema:load --trace\r\n** Invoke db:schema:load (first_time)\r\n** Invoke db:test:purge (first_time)\r\n** Invoke db:load_config (first_time)\r\n** Invoke environment (first_time)\r\n** Execute environment\r\n** Execute db:load_config\r\n** Invoke db:check_protected_environments (first_time)\r\n** Invoke db:load_config\r\n** Execute db:check_protected_environments\r\n** Execute db:test:purge\r\n** Execute db:schema:load\r\n```\r\n\r\n```\r\n$ bin/rails db:schema:load:one --trace\r\n** Invoke db:schema:load:one (first_time)\r\n** Invoke db:test:purge:one (first_time)\r\n** Invoke db:load_config (first_time)\r\n** Invoke environment (first_time)\r\n** Execute environment\r\n** Execute db:load_config\r\n** Invoke db:check_protected_environments (first_time)\r\n** Invoke db:load_config\r\n** Execute db:check_protected_environments\r\n** Execute db:test:purge:one\r\n** Execute db:schema:load:one\r\n```","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/comments/1884151541/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ricardotk002","id":3733470,"node_id":"MDQ6VXNlcjM3MzM0NzA=","avatar_url":"https://avatars.githubusercontent.com/u/3733470?v=4","gravatar_id":"","url":"https://api.github.com/users/ricardotk002","html_url":"https://github.com/ricardotk002","followers_url":"https://api.github.com/users/ricardotk002/followers","following_url":"https://api.github.com/users/ricardotk002/following{/other_user}","gists_url":"https://api.github.com/users/ricardotk002/gists{/gist_id}","starred_url":"https://api.github.com/users/ricardotk002/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ricardotk002/subscriptions","organizations_url":"https://api.github.com/users/ricardotk002/orgs","repos_url":"https://api.github.com/users/ricardotk002/repos","events_url":"https://api.github.com/users/ricardotk002/events{/privacy}","received_events_url":"https://api.github.com/users/ricardotk002/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"ricardotk002","id":3733470,"node_id":"MDQ6VXNlcjM3MzM0NzA=","avatar_url":"https://avatars.githubusercontent.com/u/3733470?v=4","gravatar_id":"","url":"https://api.github.com/users/ricardotk002","html_url":"https://github.com/ricardotk002","followers_url":"https://api.github.com/users/ricardotk002/followers","following_url":"https://api.github.com/users/ricardotk002/following{/other_user}","gists_url":"https://api.github.com/users/ricardotk002/gists{/gist_id}","starred_url":"https://api.github.com/users/ricardotk002/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ricardotk002/subscriptions","organizations_url":"https://api.github.com/users/ricardotk002/orgs","repos_url":"https://api.github.com/users/ricardotk002/repos","events_url":"https://api.github.com/users/ricardotk002/events{/privacy}","received_events_url":"https://api.github.com/users/ricardotk002/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-02T03:17:31Z","updated_at":"2024-02-02T03:17:31Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rails/rails/issues/50946","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/50946/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/50946/comments","events_url":"https://api.github.com/repos/rails/rails/issues/50946/events","html_url":"https://github.com/rails/rails/pull/50946","id":2113959017,"node_id":"PR_kwDNIULOZceF3g","number":50946,"title":"Fix error raised when running `db:schema:load:#{name}` and test DB config is missing","user":{"login":"ricardotk002","id":3733470,"node_id":"MDQ6VXNlcjM3MzM0NzA=","avatar_url":"https://avatars.githubusercontent.com/u/3733470?v=4","gravatar_id":"","url":"https://api.github.com/users/ricardotk002","html_url":"https://github.com/ricardotk002","followers_url":"https://api.github.com/users/ricardotk002/followers","following_url":"https://api.github.com/users/ricardotk002/following{/other_user}","gists_url":"https://api.github.com/users/ricardotk002/gists{/gist_id}","starred_url":"https://api.github.com/users/ricardotk002/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ricardotk002/subscriptions","organizations_url":"https://api.github.com/users/ricardotk002/orgs","repos_url":"https://api.github.com/users/ricardotk002/repos","events_url":"https://api.github.com/users/ricardotk002/events{/privacy}","received_events_url":"https://api.github.com/users/ricardotk002/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":107191,"node_id":"MDU6TGFiZWwxMDcxOTE=","url":"https://api.github.com/repos/rails/rails/labels/activerecord","name":"activerecord","color":"0b02e1","default":false,"description":null},{"id":107195,"node_id":"MDU6TGFiZWwxMDcxOTU=","url":"https://api.github.com/repos/rails/rails/labels/railties","name":"railties","color":"8BE06E","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2024-02-02T03:17:31Z","updated_at":"2025-07-21T11:01:39Z","closed_at":"2025-07-21T11:01:39Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":8514,"node_id":"MDEwOlJlcG9zaXRvcnk4NTE0","name":"rails","full_name":"rails/rails","private":false,"owner":{"login":"rails","id":4223,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQyMjM=","avatar_url":"https://avatars.githubusercontent.com/u/4223?v=4","gravatar_id":"","url":"https://api.github.com/users/rails","html_url":"https://github.com/rails","followers_url":"https://api.github.com/users/rails/followers","following_url":"https://api.github.com/users/rails/following{/other_user}","gists_url":"https://api.github.com/users/rails/gists{/gist_id}","starred_url":"https://api.github.com/users/rails/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rails/subscriptions","organizations_url":"https://api.github.com/users/rails/orgs","repos_url":"https://api.github.com/users/rails/repos","events_url":"https://api.github.com/users/rails/events{/privacy}","received_events_url":"https://api.github.com/users/rails/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rails/rails","description":"Ruby on Rails","fork":false,"url":"https://api.github.com/repos/rails/rails","forks_url":"https://api.github.com/repos/rails/rails/forks","keys_url":"https://api.github.com/repos/rails/rails/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rails/rails/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rails/rails/teams","hooks_url":"https://api.github.com/repos/rails/rails/hooks","issue_events_url":"https://api.github.com/repos/rails/rails/issues/events{/number}","events_url":"https://api.github.com/repos/rails/rails/events","assignees_url":"https://api.github.com/repos/rails/rails/assignees{/user}","branches_url":"https://api.github.com/repos/rails/rails/branches{/branch}","tags_url":"https://api.github.com/repos/rails/rails/tags","blobs_url":"https://api.github.com/repos/rails/rails/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rails/rails/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rails/rails/git/refs{/sha}","trees_url":"https://api.github.com/repos/rails/rails/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rails/rails/statuses/{sha}","languages_url":"https://api.github.com/repos/rails/rails/languages","stargazers_url":"https://api.github.com/repos/rails/rails/stargazers","contributors_url":"https://api.github.com/repos/rails/rails/contributors","subscribers_url":"https://api.github.com/repos/rails/rails/subscribers","subscription_url":"https://api.github.com/repos/rails/rails/subscription","commits_url":"https://api.github.com/repos/rails/rails/commits{/sha}","git_commits_url":"https://api.github.com/repos/rails/rails/git/commits{/sha}","comments_url":"https://api.github.com/repos/rails/rails/comments{/number}","issue_comment_url":"https://api.github.com/repos/rails/rails/issues/comments{/number}","contents_url":"https://api.github.com/repos/rails/rails/contents/{+path}","compare_url":"https://api.github.com/repos/rails/rails/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rails/rails/merges","archive_url":"https://api.github.com/repos/rails/rails/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rails/rails/downloads","issues_url":"https://api.github.com/repos/rails/rails/issues{/number}","pulls_url":"https://api.github.com/repos/rails/rails/pulls{/number}","milestones_url":"https://api.github.com/repos/rails/rails/milestones{/number}","notifications_url":"https://api.github.com/repos/rails/rails/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rails/rails/labels{/name}","releases_url":"https://api.github.com/repos/rails/rails/releases{/id}","deployments_url":"https://api.github.com/repos/rails/rails/deployments","created_at":"2008-04-11T02:19:47Z","updated_at":"2025-11-10T02:03:47Z","pushed_at":"2025-11-10T00:33:52Z","git_url":"git://github.com/rails/rails.git","ssh_url":"git@github.com:rails/rails.git","clone_url":"https://github.com/rails/rails.git","svn_url":"https://github.com/rails/rails","homepage":"https://rubyonrails.org","size":271619,"stargazers_count":57840,"watchers_count":57840,"language":"Ruby","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":22025,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1341,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["activejob","activerecord","framework","html","mvc","rails","ruby"],"visibility":"public","forks":22025,"open_issues":1341,"watchers":57840,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/rails/rails/pulls/50946","html_url":"https://github.com/rails/rails/pull/50946","diff_url":"https://github.com/rails/rails/pull/50946.diff","patch_url":"https://github.com/rails/rails/pull/50946.patch","merged_at":null},"body":"### Motivation / Background\r\n\r\nFixes #50672\r\n\r\n### Detail\r\n\r\nThe task `db:schema:load:#{name}` depends on `db:test:purge:#{name}` since adb64db which requires the DB config to be present, otherwise an error is raised.\r\n\r\n```\r\n$ bin/rails db:schema:load:one --trace\r\n** Invoke db:schema:load:one (first_time)\r\n** Invoke db:test:purge:one (first_time)\r\n** Invoke db:load_config (first_time)\r\n** Invoke environment (first_time)\r\n** Execute environment\r\n** Execute db:load_config\r\n** Invoke db:check_protected_environments (first_time) ** Invoke db:load_config\r\n** Execute db:check_protected_environments\r\n** Execute db:test:purge:one\r\n** Execute db:schema:load:one\r\n```\r\n\r\nThis commit fixes the problem by returning early when the DB config is indeed missing.\r\n\r\n### Additional information\r\n\r\nThe task `db:schema:load` may need to be updated to depend on `db:test:purge` too, to keep it consistent with `db:schema:load:#{name}`.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/50946/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/rails/issues/50946/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"actor":{"login":"cjamison","id":72361,"node_id":"MDQ6VXNlcjcyMzYx","avatar_url":"https://avatars.githubusercontent.com/u/72361?v=4","gravatar_id":"","url":"https://api.github.com/users/cjamison","html_url":"https://github.com/cjamison","followers_url":"https://api.github.com/users/cjamison/followers","following_url":"https://api.github.com/users/cjamison/following{/other_user}","gists_url":"https://api.github.com/users/cjamison/gists{/gist_id}","starred_url":"https://api.github.com/users/cjamison/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cjamison/subscriptions","organizations_url":"https://api.github.com/users/cjamison/orgs","repos_url":"https://api.github.com/users/cjamison/repos","events_url":"https://api.github.com/users/cjamison/events{/privacy}","received_events_url":"https://api.github.com/users/cjamison/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-09-28T02:03:24Z","updated_at":"2024-09-28T02:03:24Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rails/solid_queue/issues/365","repository_url":"https://api.github.com/repos/rails/solid_queue","labels_url":"https://api.github.com/repos/rails/solid_queue/issues/365/labels{/name}","comments_url":"https://api.github.com/repos/rails/solid_queue/issues/365/comments","events_url":"https://api.github.com/repos/rails/solid_queue/issues/365/events","html_url":"https://github.com/rails/solid_queue/issues/365","id":2553951762,"node_id":"I_kwDOIxPuuM6YOjYS","number":365,"title":"Loading schema in production?","user":{"login":"cjamison","id":72361,"node_id":"MDQ6VXNlcjcyMzYx","avatar_url":"https://avatars.githubusercontent.com/u/72361?v=4","gravatar_id":"","url":"https://api.github.com/users/cjamison","html_url":"https://github.com/cjamison","followers_url":"https://api.github.com/users/cjamison/followers","following_url":"https://api.github.com/users/cjamison/following{/other_user}","gists_url":"https://api.github.com/users/cjamison/gists{/gist_id}","starred_url":"https://api.github.com/users/cjamison/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cjamison/subscriptions","organizations_url":"https://api.github.com/users/cjamison/orgs","repos_url":"https://api.github.com/users/cjamison/repos","events_url":"https://api.github.com/users/cjamison/events{/privacy}","received_events_url":"https://api.github.com/users/cjamison/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":16,"created_at":"2024-09-28T02:03:23Z","updated_at":"2025-06-07T01:42:30Z","closed_at":"2024-12-27T09:51:29Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":588508856,"node_id":"R_kgDOIxPuuA","name":"solid_queue","full_name":"rails/solid_queue","private":false,"owner":{"login":"rails","id":4223,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQyMjM=","avatar_url":"https://avatars.githubusercontent.com/u/4223?v=4","gravatar_id":"","url":"https://api.github.com/users/rails","html_url":"https://github.com/rails","followers_url":"https://api.github.com/users/rails/followers","following_url":"https://api.github.com/users/rails/following{/other_user}","gists_url":"https://api.github.com/users/rails/gists{/gist_id}","starred_url":"https://api.github.com/users/rails/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rails/subscriptions","organizations_url":"https://api.github.com/users/rails/orgs","repos_url":"https://api.github.com/users/rails/repos","events_url":"https://api.github.com/users/rails/events{/privacy}","received_events_url":"https://api.github.com/users/rails/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rails/solid_queue","description":"Database-backed Active Job backend","fork":false,"url":"https://api.github.com/repos/rails/solid_queue","forks_url":"https://api.github.com/repos/rails/solid_queue/forks","keys_url":"https://api.github.com/repos/rails/solid_queue/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rails/solid_queue/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rails/solid_queue/teams","hooks_url":"https://api.github.com/repos/rails/solid_queue/hooks","issue_events_url":"https://api.github.com/repos/rails/solid_queue/issues/events{/number}","events_url":"https://api.github.com/repos/rails/solid_queue/events","assignees_url":"https://api.github.com/repos/rails/solid_queue/assignees{/user}","branches_url":"https://api.github.com/repos/rails/solid_queue/branches{/branch}","tags_url":"https://api.github.com/repos/rails/solid_queue/tags","blobs_url":"https://api.github.com/repos/rails/solid_queue/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rails/solid_queue/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rails/solid_queue/git/refs{/sha}","trees_url":"https://api.github.com/repos/rails/solid_queue/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rails/solid_queue/statuses/{sha}","languages_url":"https://api.github.com/repos/rails/solid_queue/languages","stargazers_url":"https://api.github.com/repos/rails/solid_queue/stargazers","contributors_url":"https://api.github.com/repos/rails/solid_queue/contributors","subscribers_url":"https://api.github.com/repos/rails/solid_queue/subscribers","subscription_url":"https://api.github.com/repos/rails/solid_queue/subscription","commits_url":"https://api.github.com/repos/rails/solid_queue/commits{/sha}","git_commits_url":"https://api.github.com/repos/rails/solid_queue/git/commits{/sha}","comments_url":"https://api.github.com/repos/rails/solid_queue/comments{/number}","issue_comment_url":"https://api.github.com/repos/rails/solid_queue/issues/comments{/number}","contents_url":"https://api.github.com/repos/rails/solid_queue/contents/{+path}","compare_url":"https://api.github.com/repos/rails/solid_queue/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rails/solid_queue/merges","archive_url":"https://api.github.com/repos/rails/solid_queue/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rails/solid_queue/downloads","issues_url":"https://api.github.com/repos/rails/solid_queue/issues{/number}","pulls_url":"https://api.github.com/repos/rails/solid_queue/pulls{/number}","milestones_url":"https://api.github.com/repos/rails/solid_queue/milestones{/number}","notifications_url":"https://api.github.com/repos/rails/solid_queue/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rails/solid_queue/labels{/name}","releases_url":"https://api.github.com/repos/rails/solid_queue/releases{/id}","deployments_url":"https://api.github.com/repos/rails/solid_queue/deployments","created_at":"2023-01-13T09:41:21Z","updated_at":"2025-11-08T19:46:28Z","pushed_at":"2025-11-05T21:50:30Z","git_url":"git://github.com/rails/solid_queue.git","ssh_url":"git@github.com:rails/solid_queue.git","clone_url":"https://github.com/rails/solid_queue.git","svn_url":"https://github.com/rails/solid_queue","homepage":null,"size":883,"stargazers_count":2266,"watchers_count":2266,"language":"Ruby","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":206,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":59,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":206,"open_issues":59,"watchers":2266,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"I hope there is a better way to do this that I am not seeing.\r\n\r\nAccording to the read me:\r\n\r\n> Then run db:prepare in production to ensure the database is created and the schema is loaded.\r\n\r\nI am testing this out in staging first. So I ran the following on the server:\r\n```\r\nRAILS_ENV=staging bin/rails db:prepare\r\n```\r\n\r\nThis did nothing to the queue database. Maybe because the queue database already existed? Our deployment process sets up the databases ahead of time. So running this command resulted in zero tables in the queue DB. Plus, db:prepare is not listed as a command for multiple databases. However, db:setup is. So, I ran:\r\n```\r\nRAILS_ENV=staging bin/rails db:setup:queue\r\n```\r\nThis might have worked. However, it tried connecting to the postgres database. Presumably to drop and recreate the database. However, connecting as postgres is not allowed on our staging and production systems.\r\n\r\nSo, I tried db:schema:load:queue (I actually tried this first):\r\n```\r\nRAILS_ENV=staging bin/rails db:schema:load:queue\r\n```\r\nThis resulted in this error:\r\n```\r\nbin/rails aborted!\r\nTypeError: Invalid type for configuration. Expected Symbol, String, or Hash. Got nil (TypeError)\r\n        raise TypeError, \"Invalid type for configuration. Expected Symbol, String, or Hash. Got #{config.inspect}\"\r\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\nTasks: TOP => db:schema:load:queue => db:test:purge:queue\r\n```\r\nIt looks like it is doing something with regard to a test DB that does not exist? There is actually an open PR about this: https://github.com/rails/rails/issues/50672.\r\n\r\nThen I started a console in the Staging environment on the server and ran these commands to load the schema in the queue database:\r\n```\r\nActiveRecord::Base.establish_connection(:queue)\r\nload Rails.root.join('db','queue_schema.rb')\r\n```\r\nThis successfully loaded the queue database.\r\n\r\nIs there a better way to do this? I don't remember having to load a schema in Staging or Production before. It seems like an anti-pattern? I started using Solid Queue with version 0.3 and the migrations sure seemed easier. Would it be easier to place the contents of the queue_schema.rb in a single migration file?\r\n","reactions":{"url":"https://api.github.com/repos/rails/solid_queue/issues/365/reactions","total_count":20,"+1":20,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/solid_queue/issues/365/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/rails/rails/issues/comments/2469831177","html_url":"https://github.com/rails/rails/issues/50672#issuecomment-2469831177","issue_url":"https://api.github.com/repos/rails/rails/issues/50672","id":2469831177,"node_id":"IC_kwDNIULOkzaiCQ","user":{"login":"PNixx","id":1117351,"node_id":"MDQ6VXNlcjExMTczNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1117351?v=4","gravatar_id":"","url":"https://api.github.com/users/PNixx","html_url":"https://github.com/PNixx","followers_url":"https://api.github.com/users/PNixx/followers","following_url":"https://api.github.com/users/PNixx/following{/other_user}","gists_url":"https://api.github.com/users/PNixx/gists{/gist_id}","starred_url":"https://api.github.com/users/PNixx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PNixx/subscriptions","organizations_url":"https://api.github.com/users/PNixx/orgs","repos_url":"https://api.github.com/users/PNixx/repos","events_url":"https://api.github.com/users/PNixx/events{/privacy}","received_events_url":"https://api.github.com/users/PNixx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-11-12T07:58:39Z","updated_at":"2024-11-12T07:58:39Z","body":"Same problem for schema load production without `test` config.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/comments/2469831177/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"PNixx","id":1117351,"node_id":"MDQ6VXNlcjExMTczNTE=","avatar_url":"https://avatars.githubusercontent.com/u/1117351?v=4","gravatar_id":"","url":"https://api.github.com/users/PNixx","html_url":"https://github.com/PNixx","followers_url":"https://api.github.com/users/PNixx/followers","following_url":"https://api.github.com/users/PNixx/following{/other_user}","gists_url":"https://api.github.com/users/PNixx/gists{/gist_id}","starred_url":"https://api.github.com/users/PNixx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PNixx/subscriptions","organizations_url":"https://api.github.com/users/PNixx/orgs","repos_url":"https://api.github.com/users/PNixx/repos","events_url":"https://api.github.com/users/PNixx/events{/privacy}","received_events_url":"https://api.github.com/users/PNixx/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rails/rails/issues/comments/2548647791","html_url":"https://github.com/rails/rails/issues/50672#issuecomment-2548647791","issue_url":"https://api.github.com/repos/rails/rails/issues/50672","id":2548647791,"node_id":"IC_kwDNIULOl-lHbw","user":{"login":"theoo","id":390145,"node_id":"MDQ6VXNlcjM5MDE0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/390145?v=4","gravatar_id":"","url":"https://api.github.com/users/theoo","html_url":"https://github.com/theoo","followers_url":"https://api.github.com/users/theoo/followers","following_url":"https://api.github.com/users/theoo/following{/other_user}","gists_url":"https://api.github.com/users/theoo/gists{/gist_id}","starred_url":"https://api.github.com/users/theoo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/theoo/subscriptions","organizations_url":"https://api.github.com/users/theoo/orgs","repos_url":"https://api.github.com/users/theoo/repos","events_url":"https://api.github.com/users/theoo/events{/privacy}","received_events_url":"https://api.github.com/users/theoo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-12-17T14:45:57Z","updated_at":"2024-12-17T14:45:57Z","body":"That's the [temporarily solution](https://github.com/rails/solid_queue/issues/365#issuecomment-2548639056) we use.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/comments/2548647791/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"theoo","id":390145,"node_id":"MDQ6VXNlcjM5MDE0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/390145?v=4","gravatar_id":"","url":"https://api.github.com/users/theoo","html_url":"https://github.com/theoo","followers_url":"https://api.github.com/users/theoo/followers","following_url":"https://api.github.com/users/theoo/following{/other_user}","gists_url":"https://api.github.com/users/theoo/gists{/gist_id}","starred_url":"https://api.github.com/users/theoo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/theoo/subscriptions","organizations_url":"https://api.github.com/users/theoo/orgs","repos_url":"https://api.github.com/users/theoo/repos","events_url":"https://api.github.com/users/theoo/events{/privacy}","received_events_url":"https://api.github.com/users/theoo/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":15697154204,"node_id":"UE_lADNIULOe4ZCgM8AAAADp5-QnA","url":"https://api.github.com/repos/rails/rails/issues/events/15697154204","actor":{"login":"codealchemy","id":4504083,"node_id":"MDQ6VXNlcjQ1MDQwODM=","avatar_url":"https://avatars.githubusercontent.com/u/4504083?v=4","gravatar_id":"","url":"https://api.github.com/users/codealchemy","html_url":"https://github.com/codealchemy","followers_url":"https://api.github.com/users/codealchemy/followers","following_url":"https://api.github.com/users/codealchemy/following{/other_user}","gists_url":"https://api.github.com/users/codealchemy/gists{/gist_id}","starred_url":"https://api.github.com/users/codealchemy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codealchemy/subscriptions","organizations_url":"https://api.github.com/users/codealchemy/orgs","repos_url":"https://api.github.com/users/codealchemy/repos","events_url":"https://api.github.com/users/codealchemy/events{/privacy}","received_events_url":"https://api.github.com/users/codealchemy/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"unsubscribed","commit_id":null,"commit_url":null,"created_at":"2024-12-18T04:14:31Z","performed_via_github_app":null},{"id":15980745304,"node_id":"SE_lADNIULOe4ZCgM8AAAADuIbSWA","url":"https://api.github.com/repos/rails/rails/issues/events/15980745304","actor":{"login":"dapi","id":31139,"node_id":"MDQ6VXNlcjMxMTM5","avatar_url":"https://avatars.githubusercontent.com/u/31139?v=4","gravatar_id":"","url":"https://api.github.com/users/dapi","html_url":"https://github.com/dapi","followers_url":"https://api.github.com/users/dapi/followers","following_url":"https://api.github.com/users/dapi/following{/other_user}","gists_url":"https://api.github.com/users/dapi/gists{/gist_id}","starred_url":"https://api.github.com/users/dapi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dapi/subscriptions","organizations_url":"https://api.github.com/users/dapi/orgs","repos_url":"https://api.github.com/users/dapi/repos","events_url":"https://api.github.com/users/dapi/events{/privacy}","received_events_url":"https://api.github.com/users/dapi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2025-01-17T18:02:14Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rails/rails/issues/comments/2749341947","html_url":"https://github.com/rails/rails/issues/50672#issuecomment-2749341947","issue_url":"https://api.github.com/repos/rails/rails/issues/50672","id":2749341947,"node_id":"IC_kwDNIULOo9-g-w","user":{"login":"mateuscruz","id":8962842,"node_id":"MDQ6VXNlcjg5NjI4NDI=","avatar_url":"https://avatars.githubusercontent.com/u/8962842?v=4","gravatar_id":"","url":"https://api.github.com/users/mateuscruz","html_url":"https://github.com/mateuscruz","followers_url":"https://api.github.com/users/mateuscruz/followers","following_url":"https://api.github.com/users/mateuscruz/following{/other_user}","gists_url":"https://api.github.com/users/mateuscruz/gists{/gist_id}","starred_url":"https://api.github.com/users/mateuscruz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mateuscruz/subscriptions","organizations_url":"https://api.github.com/users/mateuscruz/orgs","repos_url":"https://api.github.com/users/mateuscruz/repos","events_url":"https://api.github.com/users/mateuscruz/events{/privacy}","received_events_url":"https://api.github.com/users/mateuscruz/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-03-24T20:40:07Z","updated_at":"2025-03-24T20:40:07Z","body":"Why is calling `purge` after `schema:load` even necessary?","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/comments/2749341947/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mateuscruz","id":8962842,"node_id":"MDQ6VXNlcjg5NjI4NDI=","avatar_url":"https://avatars.githubusercontent.com/u/8962842?v=4","gravatar_id":"","url":"https://api.github.com/users/mateuscruz","html_url":"https://github.com/mateuscruz","followers_url":"https://api.github.com/users/mateuscruz/followers","following_url":"https://api.github.com/users/mateuscruz/following{/other_user}","gists_url":"https://api.github.com/users/mateuscruz/gists{/gist_id}","starred_url":"https://api.github.com/users/mateuscruz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mateuscruz/subscriptions","organizations_url":"https://api.github.com/users/mateuscruz/orgs","repos_url":"https://api.github.com/users/mateuscruz/repos","events_url":"https://api.github.com/users/mateuscruz/events{/privacy}","received_events_url":"https://api.github.com/users/mateuscruz/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":17076501481,"node_id":"MADE_lADNIULOe4ZCgM8AAAAD-da76Q","url":"https://api.github.com/repos/rails/rails/issues/events/17076501481","actor":{"login":"Edouard-chin","id":8122246,"node_id":"MDQ6VXNlcjgxMjIyNDY=","avatar_url":"https://avatars.githubusercontent.com/u/8122246?v=4","gravatar_id":"","url":"https://api.github.com/users/Edouard-chin","html_url":"https://github.com/Edouard-chin","followers_url":"https://api.github.com/users/Edouard-chin/followers","following_url":"https://api.github.com/users/Edouard-chin/following{/other_user}","gists_url":"https://api.github.com/users/Edouard-chin/gists{/gist_id}","starred_url":"https://api.github.com/users/Edouard-chin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Edouard-chin/subscriptions","organizations_url":"https://api.github.com/users/Edouard-chin/orgs","repos_url":"https://api.github.com/users/Edouard-chin/repos","events_url":"https://api.github.com/users/Edouard-chin/events{/privacy}","received_events_url":"https://api.github.com/users/Edouard-chin/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"marked_as_duplicate","commit_id":null,"commit_url":null,"created_at":"2025-04-01T14:20:01Z","performed_via_github_app":null},{"actor":{"login":"Edouard-chin","id":8122246,"node_id":"MDQ6VXNlcjgxMjIyNDY=","avatar_url":"https://avatars.githubusercontent.com/u/8122246?v=4","gravatar_id":"","url":"https://api.github.com/users/Edouard-chin","html_url":"https://github.com/Edouard-chin","followers_url":"https://api.github.com/users/Edouard-chin/followers","following_url":"https://api.github.com/users/Edouard-chin/following{/other_user}","gists_url":"https://api.github.com/users/Edouard-chin/gists{/gist_id}","starred_url":"https://api.github.com/users/Edouard-chin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Edouard-chin/subscriptions","organizations_url":"https://api.github.com/users/Edouard-chin/orgs","repos_url":"https://api.github.com/users/Edouard-chin/repos","events_url":"https://api.github.com/users/Edouard-chin/events{/privacy}","received_events_url":"https://api.github.com/users/Edouard-chin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-04-01T14:20:04Z","updated_at":"2025-04-01T14:20:04Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rails/rails/issues/54847","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/54847/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/54847/comments","events_url":"https://api.github.com/repos/rails/rails/issues/54847/events","html_url":"https://github.com/rails/rails/issues/54847","id":2962774195,"node_id":"I_kwDNIULOsJhYsw","number":54847,"title":"db:schema:load rake task depends on db:test:purge which has hardcoded 'test' env_name","user":{"login":"thomasnemer","id":80506610,"node_id":"MDQ6VXNlcjgwNTA2NjEw","avatar_url":"https://avatars.githubusercontent.com/u/80506610?v=4","gravatar_id":"","url":"https://api.github.com/users/thomasnemer","html_url":"https://github.com/thomasnemer","followers_url":"https://api.github.com/users/thomasnemer/followers","following_url":"https://api.github.com/users/thomasnemer/following{/other_user}","gists_url":"https://api.github.com/users/thomasnemer/gists{/gist_id}","starred_url":"https://api.github.com/users/thomasnemer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thomasnemer/subscriptions","organizations_url":"https://api.github.com/users/thomasnemer/orgs","repos_url":"https://api.github.com/users/thomasnemer/repos","events_url":"https://api.github.com/users/thomasnemer/events{/privacy}","received_events_url":"https://api.github.com/users/thomasnemer/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2025-04-01T08:56:55Z","updated_at":"2025-04-01T14:20:02Z","closed_at":"2025-04-01T14:20:01Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":8514,"node_id":"MDEwOlJlcG9zaXRvcnk4NTE0","name":"rails","full_name":"rails/rails","private":false,"owner":{"login":"rails","id":4223,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQyMjM=","avatar_url":"https://avatars.githubusercontent.com/u/4223?v=4","gravatar_id":"","url":"https://api.github.com/users/rails","html_url":"https://github.com/rails","followers_url":"https://api.github.com/users/rails/followers","following_url":"https://api.github.com/users/rails/following{/other_user}","gists_url":"https://api.github.com/users/rails/gists{/gist_id}","starred_url":"https://api.github.com/users/rails/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rails/subscriptions","organizations_url":"https://api.github.com/users/rails/orgs","repos_url":"https://api.github.com/users/rails/repos","events_url":"https://api.github.com/users/rails/events{/privacy}","received_events_url":"https://api.github.com/users/rails/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rails/rails","description":"Ruby on Rails","fork":false,"url":"https://api.github.com/repos/rails/rails","forks_url":"https://api.github.com/repos/rails/rails/forks","keys_url":"https://api.github.com/repos/rails/rails/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rails/rails/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rails/rails/teams","hooks_url":"https://api.github.com/repos/rails/rails/hooks","issue_events_url":"https://api.github.com/repos/rails/rails/issues/events{/number}","events_url":"https://api.github.com/repos/rails/rails/events","assignees_url":"https://api.github.com/repos/rails/rails/assignees{/user}","branches_url":"https://api.github.com/repos/rails/rails/branches{/branch}","tags_url":"https://api.github.com/repos/rails/rails/tags","blobs_url":"https://api.github.com/repos/rails/rails/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rails/rails/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rails/rails/git/refs{/sha}","trees_url":"https://api.github.com/repos/rails/rails/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rails/rails/statuses/{sha}","languages_url":"https://api.github.com/repos/rails/rails/languages","stargazers_url":"https://api.github.com/repos/rails/rails/stargazers","contributors_url":"https://api.github.com/repos/rails/rails/contributors","subscribers_url":"https://api.github.com/repos/rails/rails/subscribers","subscription_url":"https://api.github.com/repos/rails/rails/subscription","commits_url":"https://api.github.com/repos/rails/rails/commits{/sha}","git_commits_url":"https://api.github.com/repos/rails/rails/git/commits{/sha}","comments_url":"https://api.github.com/repos/rails/rails/comments{/number}","issue_comment_url":"https://api.github.com/repos/rails/rails/issues/comments{/number}","contents_url":"https://api.github.com/repos/rails/rails/contents/{+path}","compare_url":"https://api.github.com/repos/rails/rails/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rails/rails/merges","archive_url":"https://api.github.com/repos/rails/rails/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rails/rails/downloads","issues_url":"https://api.github.com/repos/rails/rails/issues{/number}","pulls_url":"https://api.github.com/repos/rails/rails/pulls{/number}","milestones_url":"https://api.github.com/repos/rails/rails/milestones{/number}","notifications_url":"https://api.github.com/repos/rails/rails/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rails/rails/labels{/name}","releases_url":"https://api.github.com/repos/rails/rails/releases{/id}","deployments_url":"https://api.github.com/repos/rails/rails/deployments","created_at":"2008-04-11T02:19:47Z","updated_at":"2025-11-10T02:03:47Z","pushed_at":"2025-11-10T00:33:52Z","git_url":"git://github.com/rails/rails.git","ssh_url":"git@github.com:rails/rails.git","clone_url":"https://github.com/rails/rails.git","svn_url":"https://github.com/rails/rails","homepage":"https://rubyonrails.org","size":271619,"stargazers_count":57840,"watchers_count":57840,"language":"Ruby","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":22025,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1341,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["activejob","activerecord","framework","html","mvc","rails","ruby"],"visibility":"public","forks":22025,"open_issues":1341,"watchers":57840,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"### Steps to reproduce\n* Create a new rails application, replace `sqlite3` gem with `pg` in Gemfile.\n* edit `config/database.yml` so that `test` environment database points to localhost:1234 and production database points to localhost:5432 : \n```yaml\ndefault: &default\n  adapter: postgresql\n  encoding: unicode\n  pool: 5\n  timeout: 5000\ntest:\n  <<: *default\n  url: postgres://user:password@localhost:1234/test_db\nproduction:\n  <<: *default\n  url: postgres://user:password@localhost:5432/prod_db\n```\n* run a postgresql container exposing port 5432 but do not run a container exposing port 1234 (you want 'production' database only, no 'test' database) : `docker run -e POSTGRES_USER=user -e POSTGRES_PASSWORD=password -p 5432:5432 postgres`\n* init production database and run `db:schema:load` rake task\n\n```shell\nexport DISABLE_DATABASE_ENVIRONMENT_CHECK=1\nexport RAILS_ENV=production\nbin/rails db:migrate\nbin/rails db:schema:load\n```\n\n### Expected behavior\n\n<!-- Tell us what should happen -->\n`db:schema:load` rake task should run successfully against the 'production' database\n\n### Actual behavior\n`db:schema:load` rake task fails because it tries to connect to 'test' database and tells to create it first, or fails trying to connect to it if you created it before.\n\n<!-- Tell us what happens instead -->\n\n### System configuration\n\n**Rails version**: 8 (also 7)\n\n**Ruby version**: any\n\n### Details\nThe task fails because it depends on another one : `db:test:purge` which has an hardcoded `test` environment name. This dependency was introduced in [this commit](https://github.com/rails/rails/commit/adb64db43dba5cad1007ce57e25df67f8b3e91f8#diff-4a42b5efdab725af0936f94b4a84dcf6a8be8738e28ed265e0a3e74f275f5048R491).\n","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/54847/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/rails/issues/54847/timeline","performed_via_github_app":null,"state_reason":"duplicate"}},"event":"cross-referenced"},{"id":17082018621,"node_id":"REFE_lADNIULOe4ZCgM8AAAAD-irrPQ","url":"https://api.github.com/repos/rails/rails/issues/events/17082018621","actor":{"login":"Edouard-chin","id":8122246,"node_id":"MDQ6VXNlcjgxMjIyNDY=","avatar_url":"https://avatars.githubusercontent.com/u/8122246?v=4","gravatar_id":"","url":"https://api.github.com/users/Edouard-chin","html_url":"https://github.com/Edouard-chin","followers_url":"https://api.github.com/users/Edouard-chin/followers","following_url":"https://api.github.com/users/Edouard-chin/following{/other_user}","gists_url":"https://api.github.com/users/Edouard-chin/gists{/gist_id}","starred_url":"https://api.github.com/users/Edouard-chin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Edouard-chin/subscriptions","organizations_url":"https://api.github.com/users/Edouard-chin/orgs","repos_url":"https://api.github.com/users/Edouard-chin/repos","events_url":"https://api.github.com/users/Edouard-chin/events{/privacy}","received_events_url":"https://api.github.com/users/Edouard-chin/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"ef1ccde0d8825a5d0dc784e3185b206d5bd8d56c","commit_url":"https://api.github.com/repos/Edouard-chin/rails/commits/ef1ccde0d8825a5d0dc784e3185b206d5bd8d56c","created_at":"2025-04-01T20:15:03Z","performed_via_github_app":null},{"actor":{"login":"Edouard-chin","id":8122246,"node_id":"MDQ6VXNlcjgxMjIyNDY=","avatar_url":"https://avatars.githubusercontent.com/u/8122246?v=4","gravatar_id":"","url":"https://api.github.com/users/Edouard-chin","html_url":"https://github.com/Edouard-chin","followers_url":"https://api.github.com/users/Edouard-chin/followers","following_url":"https://api.github.com/users/Edouard-chin/following{/other_user}","gists_url":"https://api.github.com/users/Edouard-chin/gists{/gist_id}","starred_url":"https://api.github.com/users/Edouard-chin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Edouard-chin/subscriptions","organizations_url":"https://api.github.com/users/Edouard-chin/orgs","repos_url":"https://api.github.com/users/Edouard-chin/repos","events_url":"https://api.github.com/users/Edouard-chin/events{/privacy}","received_events_url":"https://api.github.com/users/Edouard-chin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-04-01T20:18:09Z","updated_at":"2025-04-01T20:18:09Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rails/rails/issues/54853","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/54853/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/54853/comments","events_url":"https://api.github.com/repos/rails/rails/issues/54853/events","html_url":"https://github.com/rails/rails/pull/54853","id":2964487460,"node_id":"PR_kwDNIULOkP1fsA","number":54853,"title":"Avoid purging the test database when loading a schema:","user":{"login":"Edouard-chin","id":8122246,"node_id":"MDQ6VXNlcjgxMjIyNDY=","avatar_url":"https://avatars.githubusercontent.com/u/8122246?v=4","gravatar_id":"","url":"https://api.github.com/users/Edouard-chin","html_url":"https://github.com/Edouard-chin","followers_url":"https://api.github.com/users/Edouard-chin/followers","following_url":"https://api.github.com/users/Edouard-chin/following{/other_user}","gists_url":"https://api.github.com/users/Edouard-chin/gists{/gist_id}","starred_url":"https://api.github.com/users/Edouard-chin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Edouard-chin/subscriptions","organizations_url":"https://api.github.com/users/Edouard-chin/orgs","repos_url":"https://api.github.com/users/Edouard-chin/repos","events_url":"https://api.github.com/users/Edouard-chin/events{/privacy}","received_events_url":"https://api.github.com/users/Edouard-chin/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":107191,"node_id":"MDU6TGFiZWwxMDcxOTE=","url":"https://api.github.com/repos/rails/rails/labels/activerecord","name":"activerecord","color":"0b02e1","default":false,"description":null},{"id":107195,"node_id":"MDU6TGFiZWwxMDcxOTU=","url":"https://api.github.com/repos/rails/rails/labels/railties","name":"railties","color":"8BE06E","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2025-04-01T20:18:08Z","updated_at":"2025-09-19T11:35:03Z","closed_at":"2025-07-21T11:01:38Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":8514,"node_id":"MDEwOlJlcG9zaXRvcnk4NTE0","name":"rails","full_name":"rails/rails","private":false,"owner":{"login":"rails","id":4223,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQyMjM=","avatar_url":"https://avatars.githubusercontent.com/u/4223?v=4","gravatar_id":"","url":"https://api.github.com/users/rails","html_url":"https://github.com/rails","followers_url":"https://api.github.com/users/rails/followers","following_url":"https://api.github.com/users/rails/following{/other_user}","gists_url":"https://api.github.com/users/rails/gists{/gist_id}","starred_url":"https://api.github.com/users/rails/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rails/subscriptions","organizations_url":"https://api.github.com/users/rails/orgs","repos_url":"https://api.github.com/users/rails/repos","events_url":"https://api.github.com/users/rails/events{/privacy}","received_events_url":"https://api.github.com/users/rails/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rails/rails","description":"Ruby on Rails","fork":false,"url":"https://api.github.com/repos/rails/rails","forks_url":"https://api.github.com/repos/rails/rails/forks","keys_url":"https://api.github.com/repos/rails/rails/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rails/rails/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rails/rails/teams","hooks_url":"https://api.github.com/repos/rails/rails/hooks","issue_events_url":"https://api.github.com/repos/rails/rails/issues/events{/number}","events_url":"https://api.github.com/repos/rails/rails/events","assignees_url":"https://api.github.com/repos/rails/rails/assignees{/user}","branches_url":"https://api.github.com/repos/rails/rails/branches{/branch}","tags_url":"https://api.github.com/repos/rails/rails/tags","blobs_url":"https://api.github.com/repos/rails/rails/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rails/rails/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rails/rails/git/refs{/sha}","trees_url":"https://api.github.com/repos/rails/rails/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rails/rails/statuses/{sha}","languages_url":"https://api.github.com/repos/rails/rails/languages","stargazers_url":"https://api.github.com/repos/rails/rails/stargazers","contributors_url":"https://api.github.com/repos/rails/rails/contributors","subscribers_url":"https://api.github.com/repos/rails/rails/subscribers","subscription_url":"https://api.github.com/repos/rails/rails/subscription","commits_url":"https://api.github.com/repos/rails/rails/commits{/sha}","git_commits_url":"https://api.github.com/repos/rails/rails/git/commits{/sha}","comments_url":"https://api.github.com/repos/rails/rails/comments{/number}","issue_comment_url":"https://api.github.com/repos/rails/rails/issues/comments{/number}","contents_url":"https://api.github.com/repos/rails/rails/contents/{+path}","compare_url":"https://api.github.com/repos/rails/rails/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rails/rails/merges","archive_url":"https://api.github.com/repos/rails/rails/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rails/rails/downloads","issues_url":"https://api.github.com/repos/rails/rails/issues{/number}","pulls_url":"https://api.github.com/repos/rails/rails/pulls{/number}","milestones_url":"https://api.github.com/repos/rails/rails/milestones{/number}","notifications_url":"https://api.github.com/repos/rails/rails/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rails/rails/labels{/name}","releases_url":"https://api.github.com/repos/rails/rails/releases{/id}","deployments_url":"https://api.github.com/repos/rails/rails/deployments","created_at":"2008-04-11T02:19:47Z","updated_at":"2025-11-10T02:03:47Z","pushed_at":"2025-11-10T00:33:52Z","git_url":"git://github.com/rails/rails.git","ssh_url":"git@github.com:rails/rails.git","clone_url":"https://github.com/rails/rails.git","svn_url":"https://github.com/rails/rails","homepage":"https://rubyonrails.org","size":271619,"stargazers_count":57840,"watchers_count":57840,"language":"Ruby","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":22025,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1341,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["activejob","activerecord","framework","html","mvc","rails","ruby"],"visibility":"public","forks":22025,"open_issues":1341,"watchers":57840,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/rails/rails/pulls/54853","html_url":"https://github.com/rails/rails/pull/54853","diff_url":"https://github.com/rails/rails/pull/54853.diff","patch_url":"https://github.com/rails/rails/pull/54853.patch","merged_at":"2025-07-21T11:01:38Z"},"body":"### Motivation / Background\r\n\r\nFix #50672\r\nCloses #50946\r\n\r\n### Detail\r\n\r\n#### Problem\r\n\r\nIn adb64db, we added a change to purge the test database whenever the `load:schema:<name>` was run. This change meant that in order for the schema to load:\r\n1) the test database configuration needs to be setup\r\n2) can be connected to.\r\n\r\nThis creates some issues for users if either of both conditions aren't met. (For 1. it can be argued that it's a user error, but for 2., it's likely that a production environment can't connect to the test database).\r\n\r\n#### Details\r\n\r\nI dug to understand why loading a specific schema requires purging the test database (whereas loading all schema doesn't), but couldn't really see anything obvious, so I concluded that it may just be some overly defensive code.\r\n\r\n#### Solution\r\n\r\nWhenever we run a test, Rails maintains all test databases schema, and if a schema changes, the equivalent of a purge will be executed on all test databases. https://github.com/rails/rails/blob/b132744e22de64eb530d6ac407fa4b6b4a926143/railties/lib/rails/testing/maintain_test_schema.rb#L5\r\n\r\nI couldn't really think of a negative behaviour difference between purging the test database eagerly when we load the schema and lazily when we run the tests, so I simply removed the `purge` rake task dependency on `schema:load:<name>`.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/54853/reactions","total_count":2,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":2,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/rails/issues/54853/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":18058709021,"node_id":"SE_lADNIULOe4ZCgM8AAAAENGIIHQ","url":"https://api.github.com/repos/rails/rails/issues/events/18058709021","actor":{"login":"wagner","id":5348,"node_id":"MDQ6VXNlcjUzNDg=","avatar_url":"https://avatars.githubusercontent.com/u/5348?v=4","gravatar_id":"","url":"https://api.github.com/users/wagner","html_url":"https://github.com/wagner","followers_url":"https://api.github.com/users/wagner/followers","following_url":"https://api.github.com/users/wagner/following{/other_user}","gists_url":"https://api.github.com/users/wagner/gists{/gist_id}","starred_url":"https://api.github.com/users/wagner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wagner/subscriptions","organizations_url":"https://api.github.com/users/wagner/orgs","repos_url":"https://api.github.com/users/wagner/repos","events_url":"https://api.github.com/users/wagner/events{/privacy}","received_events_url":"https://api.github.com/users/wagner/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2025-06-09T16:34:36Z","performed_via_github_app":null},{"id":18726182893,"node_id":"CE_lADNIULOe4ZCgM8AAAAEXCrf7Q","url":"https://api.github.com/repos/rails/rails/issues/events/18726182893","actor":{"login":"byroot","id":44640,"node_id":"MDQ6VXNlcjQ0NjQw","avatar_url":"https://avatars.githubusercontent.com/u/44640?v=4","gravatar_id":"","url":"https://api.github.com/users/byroot","html_url":"https://github.com/byroot","followers_url":"https://api.github.com/users/byroot/followers","following_url":"https://api.github.com/users/byroot/following{/other_user}","gists_url":"https://api.github.com/users/byroot/gists{/gist_id}","starred_url":"https://api.github.com/users/byroot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/byroot/subscriptions","organizations_url":"https://api.github.com/users/byroot/orgs","repos_url":"https://api.github.com/users/byroot/repos","events_url":"https://api.github.com/users/byroot/events{/privacy}","received_events_url":"https://api.github.com/users/byroot/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2025-07-21T11:01:39Z","state_reason":null,"performed_via_github_app":null}]