diff --git a/activerecord/lib/active_record/tasks/database_tasks.rb b/activerecord/lib/active_record/tasks/database_tasks.rb
index 8f7c1af933..9fadc7184b 100644
--- a/activerecord/lib/active_record/tasks/database_tasks.rb
+++ b/activerecord/lib/active_record/tasks/database_tasks.rb
@@ -211,7 +211,9 @@ def prepare_all
         # Dump schema for databases that were migrated.
         if ActiveRecord.dump_schema_after_migration
           dump_db_configs.each do |db_config|
-            dump_schema(db_config)
+            with_temporary_pool(db_config) do
+              dump_schema(db_config)
+            end
           end
         end
 
diff --git a/railties/test/application/rake/multi_dbs_test.rb b/railties/test/application/rake/multi_dbs_test.rb
index 59373deb5e..fdc0f9f649 100644
--- a/railties/test/application/rake/multi_dbs_test.rb
+++ b/railties/test/application/rake/multi_dbs_test.rb
@@ -598,11 +598,17 @@ class ThreeMigration < ActiveRecord::Migration::Current
         require "#{app_path}/config/environment"
         app_file "db/migrate/01_one_migration.rb", <<-MIGRATION
           class OneMigration < ActiveRecord::Migration::Current
+            def change
+              create_table :posts
+            end
           end
         MIGRATION
 
         app_file "db/animals_migrate/02_two_migration.rb", <<-MIGRATION
           class TwoMigration < ActiveRecord::Migration::Current
+            def change
+              create_table :dogs
+            end
           end
         MIGRATION
 
@@ -616,6 +622,8 @@ class TwoMigration < ActiveRecord::Migration::Current
           assert File.exist?("db/schema.rb")
           assert File.exist?("db/animals_schema.rb")
 
+          assert_not_equal File.read("db/schema.rb"), File.read("db/animals_schema.rb")
+
           primary_mtime = File.mtime("db/schema.rb")
           animals_mtime = File.mtime("db/animals_schema.rb")
         end
