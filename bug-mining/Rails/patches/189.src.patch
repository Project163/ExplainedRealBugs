diff --git a/activerecord/CHANGELOG.md b/activerecord/CHANGELOG.md
index 4b0acdafca..739805e504 100644
--- a/activerecord/CHANGELOG.md
+++ b/activerecord/CHANGELOG.md
@@ -1,3 +1,7 @@
+*   Raise `ActiveRecord::ReadOnlyError` when pessimistically locking with a readonly role.
+
+    *Joshua Young*
+
 *   Fix using the `SQLite3Adapter`'s `dbconsole` method outside of a Rails application.
 
     *Hartley McGuire*
diff --git a/activerecord/lib/active_record/locking/pessimistic.rb b/activerecord/lib/active_record/locking/pessimistic.rb
index 8ad312ac01..4f2381cd57 100644
--- a/activerecord/lib/active_record/locking/pessimistic.rb
+++ b/activerecord/lib/active_record/locking/pessimistic.rb
@@ -67,6 +67,10 @@ module Pessimistic
       # or pass true for "FOR UPDATE" (the default, an exclusive row lock). Returns
       # the locked record.
       def lock!(lock = true)
+        if self.class.current_preventing_writes
+          raise ActiveRecord::ReadOnlyError, "Lock query attempted while in readonly mode"
+        end
+
         if persisted?
           if has_changes_to_save?
             raise(<<-MSG.squish)
@@ -79,6 +83,7 @@ def lock!(lock = true)
 
           reload(lock: lock)
         end
+
         self
       end
 
diff --git a/activerecord/lib/active_record/relation.rb b/activerecord/lib/active_record/relation.rb
index 70c5a5bdff..4fd30c3ef2 100644
--- a/activerecord/lib/active_record/relation.rb
+++ b/activerecord/lib/active_record/relation.rb
@@ -1413,6 +1413,10 @@ def _increment_attribute(attribute, value = 1)
       end
 
       def exec_queries(&block)
+        if lock_value && model.current_preventing_writes
+          raise ActiveRecord::ReadOnlyError, "Lock query attempted while in readonly mode"
+        end
+
         skip_query_cache_if_necessary do
           rows = if scheduled?
             future = @future_result
diff --git a/activerecord/test/cases/locking_test.rb b/activerecord/test/cases/locking_test.rb
index f044225cb0..ba231a430b 100644
--- a/activerecord/test/cases/locking_test.rb
+++ b/activerecord/test/cases/locking_test.rb
@@ -856,3 +856,121 @@ def duel(&block)
       end
   end
 end
+
+class PessimisticLockingWhilePreventingWritesTest < ActiveRecord::TestCase
+  CUSTOM_LOCK = if current_adapter?(:SQLite3Adapter)
+    true # no-op
+  else
+    "FOR SHARE"
+  end
+
+  fixtures :people
+
+  def test_lock_when_not_preventing_writes
+    person = Person.last!
+    assert_nothing_raised do
+      person.lock!
+    end
+  end
+
+  def test_lock_when_preventing_writes
+    person = Person.last!
+    ActiveRecord::Base.while_preventing_writes do
+      assert_raises(ActiveRecord::ReadOnlyError) do
+        person.lock!
+      end
+    end
+  end
+
+  def test_lock_when_not_preventing_writes_nested
+    person = Person.last!
+    ActiveRecord::Base.while_preventing_writes do
+      ActiveRecord::Base.while_preventing_writes(false) do
+        assert_nothing_raised do
+          person.lock!
+        end
+      end
+    end
+  end
+
+  def test_custom_lock_when_preventing_writes
+    person = Person.last!
+    ActiveRecord::Base.while_preventing_writes do
+      assert_raises(ActiveRecord::ReadOnlyError) do
+        person.lock!(CUSTOM_LOCK)
+      end
+    end
+  end
+
+  def test_with_lock_when_not_preventing_writes
+    person = Person.last!
+    assert_nothing_raised do
+      person.with_lock do
+      end
+    end
+  end
+
+  def test_with_lock_when_preventing_writes
+    person = Person.last!
+    ActiveRecord::Base.while_preventing_writes do
+      assert_raises(ActiveRecord::ReadOnlyError) do
+        person.with_lock do
+        end
+      end
+    end
+  end
+
+  def test_with_lock_when_not_preventing_writes_nested
+    person = Person.last!
+    ActiveRecord::Base.while_preventing_writes do
+      ActiveRecord::Base.while_preventing_writes(false) do
+        assert_nothing_raised do
+          person.with_lock do
+          end
+        end
+      end
+    end
+  end
+
+  def test_custom_with_lock_when_preventing_writes
+    person = Person.last!
+    ActiveRecord::Base.while_preventing_writes do
+      assert_raises(ActiveRecord::ReadOnlyError) do
+        person.with_lock(CUSTOM_LOCK) do
+        end
+      end
+    end
+  end
+
+  def test_relation_lock_when_not_preventing_writes
+    assert_nothing_raised do
+      Person.lock.find_by id: 1
+    end
+  end
+
+  def test_relation_lock_when_preventing_writes
+    ActiveRecord::Base.while_preventing_writes do
+      assert_raises(ActiveRecord::ReadOnlyError) do
+        Person.lock.find_by id: 1
+      end
+    end
+  end
+
+  def test_relation_lock_when_not_preventing_writes_nested
+    ActiveRecord::Base.while_preventing_writes do
+      ActiveRecord::Base.while_preventing_writes(false) do
+        assert_nothing_raised do
+          Person.lock.find_by id: 1
+        end
+      end
+    end
+  end
+
+  def test_custom_relation_lock_when_preventing_writes
+    ActiveRecord::Base.while_preventing_writes do
+      assert_raises(ActiveRecord::ReadOnlyError) do
+        Person.lock(CUSTOM_LOCK).find_by id: 1
+      end
+    end
+  end
+end
