diff --git a/activerecord/lib/arel/visitors/postgresql.rb b/activerecord/lib/arel/visitors/postgresql.rb
index 4db8fab055..a7f999a9b7 100644
--- a/activerecord/lib/arel/visitors/postgresql.rb
+++ b/activerecord/lib/arel/visitors/postgresql.rb
@@ -29,7 +29,12 @@ def visit_Arel_Nodes_UpdateStatement(o, collector)
             collect_nodes_for o.values, collector, " SET "
             collector << " FROM "
             first_join, *remaining_joins = o.relation.right
-            visit first_join.left, collector
+            from_items = remaining_joins.extract! do |join|
+              join.right.expr.right.relation == o.relation.left
+            end
+
+            from_where = [first_join.left] + from_items.map(&:left)
+            collect_nodes_for from_where, collector, " ", ", "
 
             if remaining_joins && !remaining_joins.empty?
               collector << " "
@@ -39,7 +44,8 @@ def visit_Arel_Nodes_UpdateStatement(o, collector)
               end
             end
 
-            collect_nodes_for [first_join.right.expr] + o.wheres, collector, " WHERE ", " AND "
+            from_where = [first_join.right.expr] + from_items.map { |i| i.right.expr }
+            collect_nodes_for from_where + o.wheres, collector, " WHERE ", " AND "
           else
             collector = visit o.relation, collector
             collect_nodes_for o.values, collector, " SET "
diff --git a/activerecord/lib/arel/visitors/sqlite.rb b/activerecord/lib/arel/visitors/sqlite.rb
index 98a8c234f7..b14982411d 100644
--- a/activerecord/lib/arel/visitors/sqlite.rb
+++ b/activerecord/lib/arel/visitors/sqlite.rb
@@ -30,7 +30,12 @@ def visit_Arel_Nodes_UpdateStatement(o, collector)
 
             collector << " FROM "
             first_join, *remaining_joins = o.relation.right
-            visit first_join.left, collector
+            from_items = remaining_joins.extract! do |join|
+              join.right.expr.right.relation == o.relation.left
+            end
+
+            from_where = [first_join.left] + from_items.map(&:left)
+            collect_nodes_for from_where, collector, " ", ", "
 
             if remaining_joins && !remaining_joins.empty?
               collector << " "
@@ -40,7 +45,8 @@ def visit_Arel_Nodes_UpdateStatement(o, collector)
               end
             end
 
-            collect_nodes_for [first_join.right.expr] + o.wheres, collector, " WHERE ", " AND "
+            from_where = [first_join.right.expr] + from_items.map { |i| i.right.expr }
+            collect_nodes_for from_where + o.wheres, collector, " WHERE ", " AND "
           else
             collector = visit o.relation, collector
             collect_nodes_for o.values, collector, " SET "
diff --git a/activerecord/test/cases/relation/update_all_test.rb b/activerecord/test/cases/relation/update_all_test.rb
index c141982ba5..794a0a1f88 100644
--- a/activerecord/test/cases/relation/update_all_test.rb
+++ b/activerecord/test/cases/relation/update_all_test.rb
@@ -4,8 +4,11 @@
 require "models/author"
 require "models/category"
 require "models/comment"
+require "models/company"
 require "models/computer"
+require "models/contract"
 require "models/developer"
+require "models/mentor"
 require "models/owner"
 require "models/post"
 require "models/person"
@@ -18,7 +21,7 @@
 require "models/cpk"
 
 class UpdateAllTest < ActiveRecord::TestCase
-  fixtures :authors, :author_addresses, :comments, :developers, :owners, :posts, :people, :pets, :toys, :tags,
+  fixtures :authors, :author_addresses, :comments, :companies, :developers, :owners, :posts, :people, :pets, :toys, :tags,
     :taggings, "warehouse-things", :cpk_orders, :cpk_order_agreements
 
   class TopicWithCallbacks < ActiveRecord::Base
@@ -102,7 +105,7 @@ def test_dynamic_update_all_with_one_joined_table
     end
   end
 
-  def test_dynamic_update_all_with_two_joined_table
+  def test_dynamic_update_all_with_one_join_on_the_target_and_one_indirect_join
     update_fragment = if current_adapter?(:TrilogyAdapter, :Mysql2Adapter)
       "toys.name = owners.name"
     else # PostgreSQLAdapter, SQLite3Adapter
@@ -118,6 +121,36 @@ def test_dynamic_update_all_with_two_joined_table
     end
   end
 
+  def test_dynamic_update_all_with_two_joins_on_the_target
+    update_fragment = if current_adapter?(:TrilogyAdapter, :Mysql2Adapter)
+      "developers.name = mentors.name"
+    else # PostgreSQLAdapter, SQLite3Adapter
+      "name = mentors.name"
+    end
+
+    jamis, david, poor_jamis = developers(:jamis, :david, :poor_jamis)
+    jamis.update_columns(
+      firm_id: companies(:first_firm).id,
+      mentor_id: Mentor.create!(name: "John").id,
+    )
+    david.update_columns(
+      firm_id: companies(:another_firm).id,
+      mentor_id: Mentor.create!(name: "Goliath").id,
+    )
+    poor_jamis.update_columns(
+      firm_id: companies(:another_firm).id,
+      mentor_id: Mentor.create!(name: "Doe").id,
+    )
+
+    developers = Developer.joins(:firm, :mentor)
+    assert_equal 3, developers.count
+    assert_equal 3, developers.update_all(update_fragment)
+
+    developers.each do |developer|
+      assert_equal developer.name, developer.mentor.name
+    end
+  end
+
   def test_update_all_with_left_joins
     pets = Pet.left_joins(:toys).where(toys: { name: "Bone" })
 
