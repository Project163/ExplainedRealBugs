diff --git a/activerecord/lib/active_record/connection_adapters/abstract/connection_handler.rb b/activerecord/lib/active_record/connection_adapters/abstract/connection_handler.rb
index 055ad0c206..192fed6549 100644
--- a/activerecord/lib/active_record/connection_adapters/abstract/connection_handler.rb
+++ b/activerecord/lib/active_record/connection_adapters/abstract/connection_handler.rb
@@ -128,7 +128,7 @@ def each_connection_pool(role = nil, &block) # :nodoc:
         end
       end
 
-      def establish_connection(config, owner_name: Base, role: ActiveRecord::Base.current_role, shard: Base.current_shard)
+      def establish_connection(config, owner_name: Base, role: Base.current_role, shard: Base.current_shard, clobber: false)
         owner_name = determine_owner_name(owner_name, config)
 
         pool_config = resolve_pool_config(config, owner_name, role, shard)
@@ -142,7 +142,7 @@ def establish_connection(config, owner_name: Base, role: ActiveRecord::Base.curr
         # configuration.
         existing_pool_config = pool_manager.get_pool_config(role, shard)
 
-        if existing_pool_config && existing_pool_config.db_config == db_config
+        if !clobber && existing_pool_config && existing_pool_config.db_config == db_config
           # Update the pool_config's connection class if it differs. This is used
           # for ensuring that ActiveRecord::Base and the primary_abstract_class use
           # the same pool. Without this granular swapping will not work correctly.
diff --git a/activerecord/lib/active_record/tasks/database_tasks.rb b/activerecord/lib/active_record/tasks/database_tasks.rb
index eee903092b..a9fa52e7b8 100644
--- a/activerecord/lib/active_record/tasks/database_tasks.rb
+++ b/activerecord/lib/active_record/tasks/database_tasks.rb
@@ -387,7 +387,7 @@ def reconstruct_from_schema(db_config, format = ActiveRecord.schema_format, file
 
         check_schema_file(file) if file
 
-        with_temporary_pool(db_config) do
+        with_temporary_pool(db_config, clobber: true) do
           if schema_up_to_date?(db_config, format, file)
             truncate_tables(db_config)
           else
@@ -485,19 +485,19 @@ def clear_schema_cache(filename)
         FileUtils.rm_f filename, verbose: false
       end
 
-      def with_temporary_connection_for_each(env: ActiveRecord::Tasks::DatabaseTasks.env, name: nil, &block) # :nodoc:
+      def with_temporary_connection_for_each(env: ActiveRecord::Tasks::DatabaseTasks.env, name: nil, clobber: false, &block) # :nodoc:
         if name
           db_config = ActiveRecord::Base.configurations.configs_for(env_name: env, name: name)
-          with_temporary_connection(db_config, &block)
+          with_temporary_connection(db_config, clobber: clobber, &block)
         else
           ActiveRecord::Base.configurations.configs_for(env_name: env, name: name).each do |db_config|
-            with_temporary_connection(db_config, &block)
+            with_temporary_connection(db_config, clobber: clobber, &block)
           end
         end
       end
 
-      def with_temporary_connection(db_config) # :nodoc:
-        with_temporary_pool(db_config) do |pool|
+      def with_temporary_connection(db_config, clobber: false) # :nodoc:
+        with_temporary_pool(db_config, clobber: clobber) do |pool|
           yield pool.connection
         end
       end
@@ -511,13 +511,13 @@ def migration_connection # :nodoc:
       end
 
       private
-        def with_temporary_pool(db_config)
+        def with_temporary_pool(db_config, clobber: false)
           original_db_config = migration_class.connection_db_config
-          pool = migration_class.establish_connection(db_config)
+          pool = migration_class.connection_handler.establish_connection(db_config, clobber: clobber)
 
           yield pool
         ensure
-          migration_class.establish_connection(original_db_config)
+          migration_class.connection_handler.establish_connection(original_db_config, clobber: clobber)
         end
 
         def configs_for(**options)
diff --git a/activerecord/lib/active_record/tasks/mysql_database_tasks.rb b/activerecord/lib/active_record/tasks/mysql_database_tasks.rb
index 2e37d5e7f8..64c1952970 100644
--- a/activerecord/lib/active_record/tasks/mysql_database_tasks.rb
+++ b/activerecord/lib/active_record/tasks/mysql_database_tasks.rb
@@ -28,6 +28,7 @@ def drop
       def purge
         establish_connection(configuration_hash_without_database)
         connection.recreate_database(db_config.database, creation_options)
+        establish_connection
       end
 
       def charset
diff --git a/activerecord/test/cases/adapters/mysql2/mysql2_rake_test.rb b/activerecord/test/cases/adapters/mysql2/mysql2_rake_test.rb
index 38793403b1..2fd1cfd029 100644
--- a/activerecord/test/cases/adapters/mysql2/mysql2_rake_test.rb
+++ b/activerecord/test/cases/adapters/mysql2/mysql2_rake_test.rb
@@ -187,11 +187,7 @@ def test_establishes_connection_without_database
       db_config = ActiveRecord::DatabaseConfigurations::HashConfig.new("default_env", "primary", @configuration)
 
       ActiveRecord::Base.stub(:connection, @connection) do
-        assert_called_with(
-          ActiveRecord::Base,
-          :establish_connection,
-          [adapter: "mysql2", database: nil]
-        ) do
+        assert_called(ActiveRecord::Base, :establish_connection, times: 2) do
           ActiveRecord::Tasks::DatabaseTasks.purge(db_config)
         end
       end
diff --git a/activerecord/test/cases/adapters/trilogy/trilogy_rake_test.rb b/activerecord/test/cases/adapters/trilogy/trilogy_rake_test.rb
index 50e8a29db2..1658325300 100644
--- a/activerecord/test/cases/adapters/trilogy/trilogy_rake_test.rb
+++ b/activerecord/test/cases/adapters/trilogy/trilogy_rake_test.rb
@@ -187,11 +187,7 @@ def test_establishes_connection_without_database
       db_config = ActiveRecord::DatabaseConfigurations::HashConfig.new("default_env", "primary", @configuration)
 
       ActiveRecord::Base.stub(:connection, @connection) do
-        assert_called_with(
-          ActiveRecord::Base,
-          :establish_connection,
-          [adapter: "trilogy", database: nil]
-        ) do
+        assert_called(ActiveRecord::Base, :establish_connection, times: 2) do
           ActiveRecord::Tasks::DatabaseTasks.purge(db_config)
         end
       end
diff --git a/activerecord/test/cases/tasks/database_tasks_test.rb b/activerecord/test/cases/tasks/database_tasks_test.rb
index ab095fd9b2..c62d5dec58 100644
--- a/activerecord/test/cases/tasks/database_tasks_test.rb
+++ b/activerecord/test/cases/tasks/database_tasks_test.rb
@@ -58,87 +58,88 @@ def assert_called_for_configs(method_name, configs, &block)
   }
 
   class DatabaseTasksCheckProtectedEnvironmentsTest < ActiveRecord::TestCase
-    self.use_transactional_tests = false
+    if current_adapter?(:SQLite3Adapter) && !in_memory_db?
+      self.use_transactional_tests = false
 
-    def setup
-      recreate_metadata_tables
-    end
+      def setup
+        recreate_metadata_tables
+      end
 
-    def teardown
-      recreate_metadata_tables
-    end
+      def teardown
+        recreate_metadata_tables
+      end
 
-    def test_raises_an_error_when_called_with_protected_environment
-      protected_environments = ActiveRecord::Base.protected_environments
-      current_env            = ActiveRecord::Base.connection.migration_context.current_environment
+      def test_raises_an_error_when_called_with_protected_environment
+        protected_environments = ActiveRecord::Base.protected_environments
+        current_env            = ActiveRecord::Base.connection.migration_context.current_environment
 
-      ActiveRecord::Base.connection.internal_metadata[:environment] = current_env
+        ActiveRecord::Base.connection.internal_metadata[:environment] = current_env
 
-      assert_called_on_instance_of(
-        ActiveRecord::MigrationContext,
-        :current_version,
-        times: 6,
-        returns: 1
-      ) do
-        assert_not_includes protected_environments, current_env
-        # Assert no error
-        ActiveRecord::Tasks::DatabaseTasks.check_protected_environments!("arunit")
+        assert_called_on_instance_of(
+          ActiveRecord::MigrationContext,
+          :current_version,
+          times: 6,
+          returns: 1
+        ) do
+          assert_not_includes protected_environments, current_env
+          # Assert no error
+          ActiveRecord::Tasks::DatabaseTasks.check_protected_environments!("arunit")
 
-        ActiveRecord::Base.protected_environments = [current_env]
+          ActiveRecord::Base.protected_environments = [current_env]
 
-        assert_raise(ActiveRecord::ProtectedEnvironmentError) do
-          ActiveRecord::Tasks::DatabaseTasks.check_protected_environments!("arunit")
+          assert_raise(ActiveRecord::ProtectedEnvironmentError) do
+            ActiveRecord::Tasks::DatabaseTasks.check_protected_environments!("arunit")
+          end
         end
+      ensure
+        ActiveRecord::Base.protected_environments = protected_environments
       end
-    ensure
-      ActiveRecord::Base.protected_environments = protected_environments
-    end
 
-    def test_raises_an_error_when_called_with_protected_environment_which_name_is_a_symbol
-      protected_environments = ActiveRecord::Base.protected_environments
-      current_env            = ActiveRecord::Base.connection.migration_context.current_environment
+      def test_raises_an_error_when_called_with_protected_environment_which_name_is_a_symbol
+        protected_environments = ActiveRecord::Base.protected_environments
+        current_env            = ActiveRecord::Base.connection.migration_context.current_environment
 
-      ActiveRecord::Base.connection.internal_metadata[:environment] = current_env
+        ActiveRecord::Base.connection.internal_metadata[:environment] = current_env
 
-      assert_called_on_instance_of(
-        ActiveRecord::MigrationContext,
-        :current_version,
-        times: 6,
-        returns: 1
-      ) do
-        assert_not_includes protected_environments, current_env
-        # Assert no error
-        ActiveRecord::Tasks::DatabaseTasks.check_protected_environments!("arunit")
-
-        ActiveRecord::Base.protected_environments = [current_env.to_sym]
-        assert_raise(ActiveRecord::ProtectedEnvironmentError) do
+        assert_called_on_instance_of(
+          ActiveRecord::MigrationContext,
+          :current_version,
+          times: 6,
+          returns: 1
+        ) do
+          assert_not_includes protected_environments, current_env
+          # Assert no error
           ActiveRecord::Tasks::DatabaseTasks.check_protected_environments!("arunit")
+
+          ActiveRecord::Base.protected_environments = [current_env.to_sym]
+          assert_raise(ActiveRecord::ProtectedEnvironmentError) do
+            ActiveRecord::Tasks::DatabaseTasks.check_protected_environments!("arunit")
+          end
         end
+      ensure
+        ActiveRecord::Base.protected_environments = protected_environments
       end
-    ensure
-      ActiveRecord::Base.protected_environments = protected_environments
-    end
 
-    def test_raises_an_error_if_no_migrations_have_been_made
-      connection = ActiveRecord::Base.connection
-      internal_metadata = connection.internal_metadata
-      schema_migration = connection.schema_migration
-      schema_migration.create_table
-      schema_migration.create_version("1")
+      def test_raises_an_error_if_no_migrations_have_been_made
+        connection = ActiveRecord::Base.connection
+        internal_metadata = connection.internal_metadata
+        schema_migration = connection.schema_migration
+        schema_migration.create_table
+        schema_migration.create_version("1")
 
-      assert_predicate internal_metadata, :table_exists?
-      internal_metadata.drop_table
-      assert_not_predicate internal_metadata, :table_exists?
+        assert_predicate internal_metadata, :table_exists?
+        internal_metadata.drop_table
+        assert_not_predicate internal_metadata, :table_exists?
 
-      assert_raises(ActiveRecord::NoEnvironmentInSchemaError) do
-        ActiveRecord::Tasks::DatabaseTasks.check_protected_environments!("arunit")
+        assert_raises(ActiveRecord::NoEnvironmentInSchemaError) do
+          ActiveRecord::Tasks::DatabaseTasks.check_protected_environments!("arunit")
+        end
+      ensure
+        schema_migration.delete_version("1")
+        internal_metadata.create_table
       end
-    ensure
-      schema_migration.delete_version("1")
-      internal_metadata.create_table
-    end
 
-    private
+      private
       def recreate_metadata_tables
         schema_migration = ActiveRecord::Base.connection.schema_migration
         schema_migration.drop_table
@@ -148,6 +149,7 @@ def recreate_metadata_tables
         internal_metadata.drop_table
         internal_metadata.create_table
       end
+    end
   end
 
   class DatabaseTasksCheckProtectedEnvironmentsMultiDatabaseTest < ActiveRecord::TestCase
diff --git a/railties/test/application/test_runner_test.rb b/railties/test/application/test_runner_test.rb
index c61260dd2a..53bc642931 100644
--- a/railties/test/application/test_runner_test.rb
+++ b/railties/test/application/test_runner_test.rb
@@ -769,6 +769,24 @@ def test_run_in_parallel_with_processes
       assert_no_match "create_table(:users)", output
     end
 
+    def test_parallel_testing_when_schema_is_not_up_to_date
+      require "#{app_path}/config/environment"
+      Dir.chdir(app_path) do
+        use_mysql2
+
+        exercise_parallelization_regardless_of_machine_core_count(with: :processes)
+
+        rails "generate", "scaffold", "User", "name:string"
+        rails "db:create"
+        rails "db:migrate"
+
+        output = rails "test"
+
+        assert_match(/Finished in.*7 runs, 11 assertions, 0 failures, 0 errors, 0 skips/m, output)
+        assert_match %r{Running \d+ tests in parallel using \d+ processes}, output
+      end
+    end
+
     def test_parallelization_is_disabled_when_number_of_tests_is_below_threshold
       exercise_parallelization_regardless_of_machine_core_count(with: :processes, threshold: 100)
 
diff --git a/railties/test/isolation/abstract_unit.rb b/railties/test/isolation/abstract_unit.rb
index e4d91e8d7a..9e0a26536e 100644
--- a/railties/test/isolation/abstract_unit.rb
+++ b/railties/test/isolation/abstract_unit.rb
@@ -517,6 +517,56 @@ def use_postgresql(multi_db: false)
       end
       database_name
     end
+
+    def use_mysql2(multi_db: false)
+      database_name = "railties_#{Process.pid}"
+      if multi_db
+        File.open("#{app_path}/config/database.yml", "w") do |f|
+          f.puts <<-YAML
+          default: &default
+            adapter: mysql2
+            pool: 5
+            username: root
+          <% if ENV['MYSQL_HOST'] %>
+            host: <%= ENV['MYSQL_HOST'] %>
+          <% end %>
+          <% if ENV['MYSQL_SOCK'] %>
+            socket: "<%= ENV['MYSQL_SOCK'] %>"
+          <% end %>
+          development:
+            primary:
+              <<: *default
+              database: #{database_name}_test
+            animals:
+              <<: *default
+              database: #{database_name}_animals_test
+              migrations_paths: db/animals_migrate
+          YAML
+        end
+      else
+        File.open("#{app_path}/config/database.yml", "w") do |f|
+          f.puts <<-YAML
+          default: &default
+            adapter: mysql2
+            pool: 5
+            username: root
+          <% if ENV['MYSQL_HOST'] %>
+            host: <%= ENV['MYSQL_HOST'] %>
+          <% end %>
+          <% if ENV['MYSQL_SOCK'] %>
+            socket: "<%= ENV['MYSQL_SOCK'] %>"
+          <% end %>
+          development:
+            <<: *default
+            database: #{database_name}_development
+          test:
+            <<: *default
+            database: #{database_name}_test
+          YAML
+        end
+      end
+      database_name
+    end
   end
 
   module Reload
