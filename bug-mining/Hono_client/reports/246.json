{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/2064","repository_url":"https://api.github.com/repos/eclipse-hono/hono","labels_url":"https://api.github.com/repos/eclipse-hono/hono/issues/2064/labels{/name}","comments_url":"https://api.github.com/repos/eclipse-hono/hono/issues/2064/comments","events_url":"https://api.github.com/repos/eclipse-hono/hono/issues/2064/events","html_url":"https://github.com/eclipse-hono/hono/issues/2064","id":650450681,"node_id":"MDU6SXNzdWU2NTA0NTA2ODE=","number":2064,"title":"MQTT Adapter \"Close behavior\" in case of hono internal errors","user":{"login":"Christian-Schmid","id":19150354,"node_id":"MDQ6VXNlcjE5MTUwMzU0","avatar_url":"https://avatars.githubusercontent.com/u/19150354?v=4","gravatar_id":"","url":"https://api.github.com/users/Christian-Schmid","html_url":"https://github.com/Christian-Schmid","followers_url":"https://api.github.com/users/Christian-Schmid/followers","following_url":"https://api.github.com/users/Christian-Schmid/following{/other_user}","gists_url":"https://api.github.com/users/Christian-Schmid/gists{/gist_id}","starred_url":"https://api.github.com/users/Christian-Schmid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Christian-Schmid/subscriptions","organizations_url":"https://api.github.com/users/Christian-Schmid/orgs","repos_url":"https://api.github.com/users/Christian-Schmid/repos","events_url":"https://api.github.com/users/Christian-Schmid/events{/privacy}","received_events_url":"https://api.github.com/users/Christian-Schmid/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":525773890,"node_id":"MDU6TGFiZWw1MjU3NzM4OTA=","url":"https://api.github.com/repos/eclipse-hono/hono/labels/MQTT%20Adapter","name":"MQTT Adapter","color":"e99695","default":false,"description":null},{"id":1413288337,"node_id":"MDU6TGFiZWwxNDEzMjg4MzM3","url":"https://api.github.com/repos/eclipse-hono/hono/labels/Feature%20Request","name":"Feature Request","color":"1d76db","default":false,"description":"A request for adding new functionality to Hono"}],"state":"closed","locked":false,"assignee":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false},{"login":"kaniyan","id":18659982,"node_id":"MDQ6VXNlcjE4NjU5OTgy","avatar_url":"https://avatars.githubusercontent.com/u/18659982?v=4","gravatar_id":"","url":"https://api.github.com/users/kaniyan","html_url":"https://github.com/kaniyan","followers_url":"https://api.github.com/users/kaniyan/followers","following_url":"https://api.github.com/users/kaniyan/following{/other_user}","gists_url":"https://api.github.com/users/kaniyan/gists{/gist_id}","starred_url":"https://api.github.com/users/kaniyan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kaniyan/subscriptions","organizations_url":"https://api.github.com/users/kaniyan/orgs","repos_url":"https://api.github.com/users/kaniyan/repos","events_url":"https://api.github.com/users/kaniyan/events{/privacy}","received_events_url":"https://api.github.com/users/kaniyan/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/eclipse-hono/hono/milestones/28","html_url":"https://github.com/eclipse-hono/hono/milestone/28","labels_url":"https://api.github.com/repos/eclipse-hono/hono/milestones/28/labels","id":6375144,"node_id":"MDk6TWlsZXN0b25lNjM3NTE0NA==","number":28,"title":"1.7.0","description":"","creator":{"login":"sophokles73","id":5682135,"node_id":"MDQ6VXNlcjU2ODIxMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5682135?v=4","gravatar_id":"","url":"https://api.github.com/users/sophokles73","html_url":"https://github.com/sophokles73","followers_url":"https://api.github.com/users/sophokles73/followers","following_url":"https://api.github.com/users/sophokles73/following{/other_user}","gists_url":"https://api.github.com/users/sophokles73/gists{/gist_id}","starred_url":"https://api.github.com/users/sophokles73/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophokles73/subscriptions","organizations_url":"https://api.github.com/users/sophokles73/orgs","repos_url":"https://api.github.com/users/sophokles73/repos","events_url":"https://api.github.com/users/sophokles73/events{/privacy}","received_events_url":"https://api.github.com/users/sophokles73/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":108,"state":"closed","created_at":"2021-02-01T07:15:43Z","updated_at":"2021-05-18T11:57:41Z","due_on":"2021-04-08T07:00:00Z","closed_at":"2021-04-09T11:00:11Z"},"comments":28,"created_at":"2020-07-03T08:54:57Z","updated_at":"2021-03-16T10:31:33Z","closed_at":"2021-03-16T10:31:33Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The MQTT adapter closes the MQTT connection to the device in case of any errors during publishing telemetry / events / answering commands. This includes also more internal errors, e.g. timeouts on getting the assertion. \r\n \r\nAs the initial connection establishment with a client is somehow resources intense (SSL Handshake, resource allocation, initial get, assert of device and tenant). Does it really make sense to close the mqtt connection in such error cases? I saw the discussion in [1262](https://github.com/eclipse/hono/issues/1262) and the following [PR](https://github.com/eclipse/hono/pull/1263) to close the connection. \r\n\r\nI'm aware that the specifications says with \"[MQTT-4.8.0-2]\", that the server should close the connection in case of transient errors, but in scenarios where you have a very large number of devices connected, a short issue e.g. in the registration service could have some cascade effect resulting in the disconnect of a large number of devices. \r\n\r\nIn the issue [1262](https://github.com/eclipse/hono/issues/1262) there was a discussion ongoing regarding if this could be configurable per tenant. I think such option would be very nice. \r\n\r\nIf the clients of the tenant are implemented in a way where they rely on the PubAck and not only on the client disconnect we still would fulfill the QoS guarantees towards the client:\r\n\r\n- **Telemetry with QoS 0**: It could leave the connection open and just drop the telemetry message, which would be in line with the guarantees towards the client.\r\n\r\n- **Telemetry with QoS 1**: It could leave the connection open and don't pub ack the message. Client would / could try to resend the message.\r\n\r\n- **Event**: Same as Telemetry QoS 1 \r\n\r\nFor cases in which the cause of the failure is a well-known final cause and the cause is successfully received by the adapter (e.g. device is disabled in registry), the adapter should still close the connection. But for other cases such as timeouts, status codes 500) I would like to have the option to not close the connection.\r\n\r\nThanks\r\nChris\r\n","closed_by":{"login":"kaniyan","id":18659982,"node_id":"MDQ6VXNlcjE4NjU5OTgy","avatar_url":"https://avatars.githubusercontent.com/u/18659982?v=4","gravatar_id":"","url":"https://api.github.com/users/kaniyan","html_url":"https://github.com/kaniyan","followers_url":"https://api.github.com/users/kaniyan/followers","following_url":"https://api.github.com/users/kaniyan/following{/other_user}","gists_url":"https://api.github.com/users/kaniyan/gists{/gist_id}","starred_url":"https://api.github.com/users/kaniyan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kaniyan/subscriptions","organizations_url":"https://api.github.com/users/kaniyan/orgs","repos_url":"https://api.github.com/users/kaniyan/repos","events_url":"https://api.github.com/users/kaniyan/events{/privacy}","received_events_url":"https://api.github.com/users/kaniyan/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/2064/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/eclipse-hono/hono/issues/2064/timeline","performed_via_github_app":null,"state_reason":"completed"}