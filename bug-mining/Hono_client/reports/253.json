{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/2661","repository_url":"https://api.github.com/repos/eclipse-hono/hono","labels_url":"https://api.github.com/repos/eclipse-hono/hono/issues/2661/labels{/name}","comments_url":"https://api.github.com/repos/eclipse-hono/hono/issues/2661/comments","events_url":"https://api.github.com/repos/eclipse-hono/hono/issues/2661/events","html_url":"https://github.com/eclipse-hono/hono/issues/2661","id":893573965,"node_id":"MDU6SXNzdWU4OTM1NzM5NjU=","number":2661,"title":"Kafka: Provide feedback on failed Command messages","user":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":947051526,"node_id":"MDU6TGFiZWw5NDcwNTE1MjY=","url":"https://api.github.com/repos/eclipse-hono/hono/labels/C&C","name":"C&C","color":"2dbc83","default":false,"description":"Command and Control"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/eclipse-hono/hono/milestones/30","html_url":"https://github.com/eclipse-hono/hono/milestone/30","labels_url":"https://api.github.com/repos/eclipse-hono/hono/milestones/30/labels","id":6776674,"node_id":"MDk6TWlsZXN0b25lNjc3NjY3NA==","number":30,"title":"1.9.0","description":"","creator":{"login":"sophokles73","id":5682135,"node_id":"MDQ6VXNlcjU2ODIxMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5682135?v=4","gravatar_id":"","url":"https://api.github.com/users/sophokles73","html_url":"https://github.com/sophokles73","followers_url":"https://api.github.com/users/sophokles73/followers","following_url":"https://api.github.com/users/sophokles73/following{/other_user}","gists_url":"https://api.github.com/users/sophokles73/gists{/gist_id}","starred_url":"https://api.github.com/users/sophokles73/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophokles73/subscriptions","organizations_url":"https://api.github.com/users/sophokles73/orgs","repos_url":"https://api.github.com/users/sophokles73/repos","events_url":"https://api.github.com/users/sophokles73/events{/privacy}","received_events_url":"https://api.github.com/users/sophokles73/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":88,"state":"closed","created_at":"2021-05-20T09:10:01Z","updated_at":"2021-07-16T10:47:00Z","due_on":"2021-07-15T07:00:00Z","closed_at":"2021-07-16T10:47:00Z"},"comments":4,"created_at":"2021-05-17T18:05:40Z","updated_at":"2021-06-15T12:28:06Z","closed_at":"2021-06-15T11:12:16Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"One main difference between the Kafka and AMQP Command & Control implementations is that with Kafka, there is no protocol-provided way to inform the northbound application about a failed delivery, like there is with AMQP using the delivery disposition update mechanism (using a `rejected`, `modified` or `released` outcome).\r\n\r\nA failure to forward a command message to the device could for example be caused by\r\n- the command message being invalid\r\n- the command target device or its tenant being disabled/deleted\r\n- there being no currently subscribed command consumer for the target device\r\n- some network error when forwarding the message\r\n- etc.\r\n\r\n### Proposal\r\n\r\n## Request/response command messages\r\n\r\nWhen there is an error forwarding a request/response command message, a command response message with the corresponding error could be published on the command-response topic.\r\nThat means either the Command Router component or the Protocol Adapter will publish such a message.\r\nThe message should have some special header so that it can be distinguished from a command response coming from the device.\r\n\r\n## One-way command messages\r\n\r\nFor one-way command messages, using the command-response topic for reporting errors doesn't seem appropriate, \"one way\" and \"response\" being mutually exclusive.\r\nHowever, having a backchannel for an error notification in a scenario where only one-way commands can be used because the device can't send responses still looks like a useful feature. \r\n\r\nOne-way and request-response commands are currently distinguished via the `response-required` header.\r\nFor a scenario of sending commands to a device that doesn't support sending response messages, we could use an additional header - `use-delivery-status-response` (or `only-delivery-status-response`). \r\nWith `response-required` and `use-delivery-status-response` set to `true`, the command will be forwarded like a one-way command to the device. But any error during command processing in the command router or the adapter will be reported on the command-response topic and a successful delivery will result in a \"status 202\" command-response message. Such a response would be equivalent to an `accepted` delivery outcome returned in the AMQP one-way command case - with the same caveat, that a northbound application can't be certain that the device has actually received the command message in that case. Nonetheless, being able to quickly get an error response makes the overall feature worthwhile FMPOV.","closed_by":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/2661/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/eclipse-hono/hono/issues/2661/timeline","performed_via_github_app":null,"state_reason":"completed"}