[{"id":1995195031,"node_id":"MDEyOkxhYmVsZWRFdmVudDE5OTUxOTUwMzE=","url":"https://api.github.com/repos/eclipse-hono/hono/issues/events/1995195031","actor":{"login":"sysexcontrol","id":24588266,"node_id":"MDQ6VXNlcjI0NTg4MjY2","avatar_url":"https://avatars.githubusercontent.com/u/24588266?v=4","gravatar_id":"","url":"https://api.github.com/users/sysexcontrol","html_url":"https://github.com/sysexcontrol","followers_url":"https://api.github.com/users/sysexcontrol/followers","following_url":"https://api.github.com/users/sysexcontrol/following{/other_user}","gists_url":"https://api.github.com/users/sysexcontrol/gists{/gist_id}","starred_url":"https://api.github.com/users/sysexcontrol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sysexcontrol/subscriptions","organizations_url":"https://api.github.com/users/sysexcontrol/orgs","repos_url":"https://api.github.com/users/sysexcontrol/repos","events_url":"https://api.github.com/users/sysexcontrol/events{/privacy}","received_events_url":"https://api.github.com/users/sysexcontrol/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2018-11-29T13:14:18Z","label":{"name":"C&C","color":"2dbc83"},"performed_via_github_app":null},{"id":1995195037,"node_id":"MDE1Ok1pbGVzdG9uZWRFdmVudDE5OTUxOTUwMzc=","url":"https://api.github.com/repos/eclipse-hono/hono/issues/events/1995195037","actor":{"login":"sysexcontrol","id":24588266,"node_id":"MDQ6VXNlcjI0NTg4MjY2","avatar_url":"https://avatars.githubusercontent.com/u/24588266?v=4","gravatar_id":"","url":"https://api.github.com/users/sysexcontrol","html_url":"https://github.com/sysexcontrol","followers_url":"https://api.github.com/users/sysexcontrol/followers","following_url":"https://api.github.com/users/sysexcontrol/following{/other_user}","gists_url":"https://api.github.com/users/sysexcontrol/gists{/gist_id}","starred_url":"https://api.github.com/users/sysexcontrol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sysexcontrol/subscriptions","organizations_url":"https://api.github.com/users/sysexcontrol/orgs","repos_url":"https://api.github.com/users/sysexcontrol/repos","events_url":"https://api.github.com/users/sysexcontrol/events{/privacy}","received_events_url":"https://api.github.com/users/sysexcontrol/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2018-11-29T13:14:18Z","milestone":{"title":"0.9"},"performed_via_github_app":null},{"actor":{"login":"sophokles73","id":5682135,"node_id":"MDQ6VXNlcjU2ODIxMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5682135?v=4","gravatar_id":"","url":"https://api.github.com/users/sophokles73","html_url":"https://github.com/sophokles73","followers_url":"https://api.github.com/users/sophokles73/followers","following_url":"https://api.github.com/users/sophokles73/following{/other_user}","gists_url":"https://api.github.com/users/sophokles73/gists{/gist_id}","starred_url":"https://api.github.com/users/sophokles73/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophokles73/subscriptions","organizations_url":"https://api.github.com/users/sophokles73/orgs","repos_url":"https://api.github.com/users/sophokles73/repos","events_url":"https://api.github.com/users/sophokles73/events{/privacy}","received_events_url":"https://api.github.com/users/sophokles73/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-02-18T08:46:48Z","updated_at":"2019-02-18T08:46:48Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/1047","repository_url":"https://api.github.com/repos/eclipse-hono/hono","labels_url":"https://api.github.com/repos/eclipse-hono/hono/issues/1047/labels{/name}","comments_url":"https://api.github.com/repos/eclipse-hono/hono/issues/1047/comments","events_url":"https://api.github.com/repos/eclipse-hono/hono/issues/1047/events","html_url":"https://github.com/eclipse-hono/hono/pull/1047","id":411346379,"node_id":"MDExOlB1bGxSZXF1ZXN0MjUzODE2Mzky","number":1047,"title":"[#926] Support authorization of multiple gateways per device.","user":{"login":"sophokles73","id":5682135,"node_id":"MDQ6VXNlcjU2ODIxMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5682135?v=4","gravatar_id":"","url":"https://api.github.com/users/sophokles73","html_url":"https://github.com/sophokles73","followers_url":"https://api.github.com/users/sophokles73/followers","following_url":"https://api.github.com/users/sophokles73/following{/other_user}","gists_url":"https://api.github.com/users/sophokles73/gists{/gist_id}","starred_url":"https://api.github.com/users/sophokles73/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophokles73/subscriptions","organizations_url":"https://api.github.com/users/sophokles73/orgs","repos_url":"https://api.github.com/users/sophokles73/repos","events_url":"https://api.github.com/users/sophokles73/events{/privacy}","received_events_url":"https://api.github.com/users/sophokles73/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":323160608,"node_id":"MDU6TGFiZWwzMjMxNjA2MDg=","url":"https://api.github.com/repos/eclipse-hono/hono/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null},{"id":691341461,"node_id":"MDU6TGFiZWw2OTEzNDE0NjE=","url":"https://api.github.com/repos/eclipse-hono/hono/labels/Device%20Registry","name":"Device Registry","color":"1d76db","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/eclipse-hono/hono/milestones/18","html_url":"https://github.com/eclipse-hono/hono/milestone/18","labels_url":"https://api.github.com/repos/eclipse-hono/hono/milestones/18/labels","id":3781949,"node_id":"MDk6TWlsZXN0b25lMzc4MTk0OQ==","number":18,"title":"0.9","description":"https://projects.eclipse.org/projects/iot.hono/releases/0.9","creator":{"login":"sophokles73","id":5682135,"node_id":"MDQ6VXNlcjU2ODIxMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5682135?v=4","gravatar_id":"","url":"https://api.github.com/users/sophokles73","html_url":"https://github.com/sophokles73","followers_url":"https://api.github.com/users/sophokles73/followers","following_url":"https://api.github.com/users/sophokles73/following{/other_user}","gists_url":"https://api.github.com/users/sophokles73/gists{/gist_id}","starred_url":"https://api.github.com/users/sophokles73/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophokles73/subscriptions","organizations_url":"https://api.github.com/users/sophokles73/orgs","repos_url":"https://api.github.com/users/sophokles73/repos","events_url":"https://api.github.com/users/sophokles73/events{/privacy}","received_events_url":"https://api.github.com/users/sophokles73/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":119,"state":"closed","created_at":"2018-10-30T13:36:24Z","updated_at":"2019-03-05T17:17:31Z","due_on":"2019-02-25T08:00:00Z","closed_at":"2019-02-26T15:07:37Z"},"comments":5,"created_at":"2019-02-18T08:03:08Z","updated_at":"2019-02-21T08:09:56Z","closed_at":"2019-02-21T08:09:47Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":51307016,"node_id":"MDEwOlJlcG9zaXRvcnk1MTMwNzAxNg==","name":"hono","full_name":"eclipse-hono/hono","private":false,"owner":{"login":"eclipse-hono","id":112081701,"node_id":"O_kgDOBq47JQ","avatar_url":"https://avatars.githubusercontent.com/u/112081701?v=4","gravatar_id":"","url":"https://api.github.com/users/eclipse-hono","html_url":"https://github.com/eclipse-hono","followers_url":"https://api.github.com/users/eclipse-hono/followers","following_url":"https://api.github.com/users/eclipse-hono/following{/other_user}","gists_url":"https://api.github.com/users/eclipse-hono/gists{/gist_id}","starred_url":"https://api.github.com/users/eclipse-hono/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eclipse-hono/subscriptions","organizations_url":"https://api.github.com/users/eclipse-hono/orgs","repos_url":"https://api.github.com/users/eclipse-hono/repos","events_url":"https://api.github.com/users/eclipse-hono/events{/privacy}","received_events_url":"https://api.github.com/users/eclipse-hono/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/eclipse-hono/hono","description":"Eclipse Honoâ„¢ Project","fork":false,"url":"https://api.github.com/repos/eclipse-hono/hono","forks_url":"https://api.github.com/repos/eclipse-hono/hono/forks","keys_url":"https://api.github.com/repos/eclipse-hono/hono/keys{/key_id}","collaborators_url":"https://api.github.com/repos/eclipse-hono/hono/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/eclipse-hono/hono/teams","hooks_url":"https://api.github.com/repos/eclipse-hono/hono/hooks","issue_events_url":"https://api.github.com/repos/eclipse-hono/hono/issues/events{/number}","events_url":"https://api.github.com/repos/eclipse-hono/hono/events","assignees_url":"https://api.github.com/repos/eclipse-hono/hono/assignees{/user}","branches_url":"https://api.github.com/repos/eclipse-hono/hono/branches{/branch}","tags_url":"https://api.github.com/repos/eclipse-hono/hono/tags","blobs_url":"https://api.github.com/repos/eclipse-hono/hono/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/eclipse-hono/hono/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/eclipse-hono/hono/git/refs{/sha}","trees_url":"https://api.github.com/repos/eclipse-hono/hono/git/trees{/sha}","statuses_url":"https://api.github.com/repos/eclipse-hono/hono/statuses/{sha}","languages_url":"https://api.github.com/repos/eclipse-hono/hono/languages","stargazers_url":"https://api.github.com/repos/eclipse-hono/hono/stargazers","contributors_url":"https://api.github.com/repos/eclipse-hono/hono/contributors","subscribers_url":"https://api.github.com/repos/eclipse-hono/hono/subscribers","subscription_url":"https://api.github.com/repos/eclipse-hono/hono/subscription","commits_url":"https://api.github.com/repos/eclipse-hono/hono/commits{/sha}","git_commits_url":"https://api.github.com/repos/eclipse-hono/hono/git/commits{/sha}","comments_url":"https://api.github.com/repos/eclipse-hono/hono/comments{/number}","issue_comment_url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments{/number}","contents_url":"https://api.github.com/repos/eclipse-hono/hono/contents/{+path}","compare_url":"https://api.github.com/repos/eclipse-hono/hono/compare/{base}...{head}","merges_url":"https://api.github.com/repos/eclipse-hono/hono/merges","archive_url":"https://api.github.com/repos/eclipse-hono/hono/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/eclipse-hono/hono/downloads","issues_url":"https://api.github.com/repos/eclipse-hono/hono/issues{/number}","pulls_url":"https://api.github.com/repos/eclipse-hono/hono/pulls{/number}","milestones_url":"https://api.github.com/repos/eclipse-hono/hono/milestones{/number}","notifications_url":"https://api.github.com/repos/eclipse-hono/hono/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/eclipse-hono/hono/labels{/name}","releases_url":"https://api.github.com/repos/eclipse-hono/hono/releases{/id}","deployments_url":"https://api.github.com/repos/eclipse-hono/hono/deployments","created_at":"2016-02-08T15:45:28Z","updated_at":"2025-11-04T15:48:55Z","pushed_at":"2025-11-07T14:00:09Z","git_url":"git://github.com/eclipse-hono/hono.git","ssh_url":"git@github.com:eclipse-hono/hono.git","clone_url":"https://github.com/eclipse-hono/hono.git","svn_url":"https://github.com/eclipse-hono/hono","homepage":"https://eclipse.dev/hono","size":51799,"stargazers_count":476,"watchers_count":476,"language":"Java","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":139,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":115,"license":{"key":"epl-2.0","name":"Eclipse Public License 2.0","spdx_id":"EPL-2.0","url":"https://api.github.com/licenses/epl-2.0","node_id":"MDc6TGljZW5zZTMy"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["eclipseiot","internet-of-things","messaging"],"visibility":"public","forks":139,"open_issues":115,"watchers":476,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/eclipse-hono/hono/pulls/1047","html_url":"https://github.com/eclipse-hono/hono/pull/1047","diff_url":"https://github.com/eclipse-hono/hono/pull/1047.diff","patch_url":"https://github.com/eclipse-hono/hono/pull/1047.patch","merged_at":"2019-02-21T08:09:47Z"},"body":"Device registration service now supports multiple gateway identifiers to\r\nbe specified in a device's registration information's \"via\" property.\r\nThe \"via\" property can be set to either a string or a JSON array of\r\nstrings.\r\n","reactions":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/1047/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/eclipse-hono/hono/issues/1047/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/465999575","html_url":"https://github.com/eclipse-hono/hono/issues/930#issuecomment-465999575","issue_url":"https://api.github.com/repos/eclipse-hono/hono/issues/930","id":465999575,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NTk5OTU3NQ==","user":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-02-21T13:29:31Z","updated_at":"2019-02-21T13:29:31Z","body":"To be achieved here is that the consumer application can send the command message only knowing the device id, not the gateway id.\r\nHowever, on the side of the protocol adapter, the receiver link for receiving such commands may have been created with the gateway id in the address (\"control/tenantId/gatewayId\"), not the device id.\r\nThat means that either in the consumer application or somewhere between consumer application and protocol adapter, a mapping from device id to corresponding gateway id has to be applied.\r\n\r\nThe place, where such mapping data is kept (the \"mapper component\"), could be a new component or in the device registry for example. Whenever there is a new request from a device via a gateway, this mapping data could be updated.\r\n\r\n\r\nAs to the way this mapping can get applied so that the command request reaches the right protocol adapter, I see these alternatives:\r\n\r\n1. Mapping applied in the consumer application:\r\nThe consumer app first makes a request to the new mapping data component (via qpid) to get the current gateway id for the device and then uses that gateway id in the command request.\r\nThis functionality could be encapsulated in the HonoClient and therefore be mostly transparent to the consumer app.\r\n\r\n2. Define Qpid waypoint that applies mapping and redirects the request:\r\nUsing the router feature of waypoints and auto-links, the command request with the device id from the consumer application is first handled by the \"waypoint mapper\" component (i.e. \"mapper component\", could be the same as the device registry). In this component the mapping is applied and the request gets redirected to the \"control/tenantId/gatewayId\" address to be consumed by the protocol adapter.\r\nWhether this approach is actually feasible and whether it would work together with EnMasse or a non-Qpid based AMQP messaging network remains to be seen.\r\n\r\n3. Use an intermediate \"control/tenantId\" dispatcher component:\r\nWith this approach, there is a new \"Command dispatcher\" (or \"Gateway-to-device Mapper\") component in between the protocol adapter and Qpid.\r\nThis new component creates an AMQP receiver on \"control/tenantId\" addresses in connection with Qpid, so that it will receive the command requests from the consumer application.\r\nThe device id of the received requests is mapped to the gateway id and the command request is sent to the protocol adapter.\r\nThis means the protocol adapters create the receiver link on the \"control/tenantId/gatewayId\" address not with Qpid but with the new \"Command dispatcher\" component.\r\n\r\nOption 1 is probably the most straightforward to implement but introduces further complexity on non-HonoClient based consumer applications.\r\nWith Option 2 it is unclear, how this could work exactly and how support would look like with EnMasse or a non-Qpid based messaging network.\r\nOption 3 seems the most flexible to me. (I'm not sure yet about all the implications, though.)\r\n\r\nThoughts on this?","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/465999575/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":2165136833,"node_id":"MDE3OkRlbWlsZXN0b25lZEV2ZW50MjE2NTEzNjgzMw==","url":"https://api.github.com/repos/eclipse-hono/hono/issues/events/2165136833","actor":{"login":"sophokles73","id":5682135,"node_id":"MDQ6VXNlcjU2ODIxMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5682135?v=4","gravatar_id":"","url":"https://api.github.com/users/sophokles73","html_url":"https://github.com/sophokles73","followers_url":"https://api.github.com/users/sophokles73/followers","following_url":"https://api.github.com/users/sophokles73/following{/other_user}","gists_url":"https://api.github.com/users/sophokles73/gists{/gist_id}","starred_url":"https://api.github.com/users/sophokles73/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophokles73/subscriptions","organizations_url":"https://api.github.com/users/sophokles73/orgs","repos_url":"https://api.github.com/users/sophokles73/repos","events_url":"https://api.github.com/users/sophokles73/events{/privacy}","received_events_url":"https://api.github.com/users/sophokles73/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"demilestoned","commit_id":null,"commit_url":null,"created_at":"2019-02-26T15:07:08Z","milestone":{"title":"0.9"},"performed_via_github_app":null},{"id":2165136834,"node_id":"MDE1Ok1pbGVzdG9uZWRFdmVudDIxNjUxMzY4MzQ=","url":"https://api.github.com/repos/eclipse-hono/hono/issues/events/2165136834","actor":{"login":"sophokles73","id":5682135,"node_id":"MDQ6VXNlcjU2ODIxMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5682135?v=4","gravatar_id":"","url":"https://api.github.com/users/sophokles73","html_url":"https://github.com/sophokles73","followers_url":"https://api.github.com/users/sophokles73/followers","following_url":"https://api.github.com/users/sophokles73/following{/other_user}","gists_url":"https://api.github.com/users/sophokles73/gists{/gist_id}","starred_url":"https://api.github.com/users/sophokles73/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophokles73/subscriptions","organizations_url":"https://api.github.com/users/sophokles73/orgs","repos_url":"https://api.github.com/users/sophokles73/repos","events_url":"https://api.github.com/users/sophokles73/events{/privacy}","received_events_url":"https://api.github.com/users/sophokles73/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2019-02-26T15:07:08Z","milestone":{"title":"1.0.0"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/467886874","html_url":"https://github.com/eclipse-hono/hono/issues/930#issuecomment-467886874","issue_url":"https://api.github.com/repos/eclipse-hono/hono/issues/930","id":467886874,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2Nzg4Njg3NA==","user":{"login":"sophokles73","id":5682135,"node_id":"MDQ6VXNlcjU2ODIxMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5682135?v=4","gravatar_id":"","url":"https://api.github.com/users/sophokles73","html_url":"https://github.com/sophokles73","followers_url":"https://api.github.com/users/sophokles73/followers","following_url":"https://api.github.com/users/sophokles73/following{/other_user}","gists_url":"https://api.github.com/users/sophokles73/gists{/gist_id}","starred_url":"https://api.github.com/users/sophokles73/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophokles73/subscriptions","organizations_url":"https://api.github.com/users/sophokles73/orgs","repos_url":"https://api.github.com/users/sophokles73/repos","events_url":"https://api.github.com/users/sophokles73/events{/privacy}","received_events_url":"https://api.github.com/users/sophokles73/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-02-27T14:41:15Z","updated_at":"2019-02-27T14:41:15Z","body":"> Option 1 is probably the most straightforward to implement but introduces further complexity on non-HonoClient based consumer applications.\r\n\r\nI agree, this might prove useful as a fallback solution if do not come up with something more convenient.\r\n\r\n> With Option 2 it is unclear, how this could work exactly and how support would look like with EnMasse or a non-Qpid based messaging network.\r\n\r\nbased on the personal discussion I had with @calohmn, it looks as if this is not reasonable to do based on auto links and waypoints because we would need to create auto links for at least each tenant. However, we could still use the concept of the *mapper* component but connect it in a different way to the existing infrastructure. The mapper component instances could connect to the AMQP Messaging Network using a receiver link with a source address of, say, `control/requests`. The applications would then send their one-way commands and command request messages to the AMQP network over a sender link with target addess `control/requests` (regardless of the tenant and/or device) but would need to set the message's *to* property to the proper device address, i.e. `control/$tenant/$deviceId`.\r\nThe mapper instances would then compete for the command messages and whenever one of them gets a command message, it replaces the deviceId in the *to* property with the device ID of the gateway, if necessary, and sends the command to a Hono internal Qpid Dispatch Router network over a link using the message's mapped address as the target address. \r\nThe protocol adapter instances would work as the did before, i.e. they would still open consumer links with a source address of `control/$tenant/$deviceId`. The only difference would be that they no longer connect to the AMQP Network but to the internal Dispatch Router network.\r\n\r\n> Option 3 seems the most flexible to me. (I'm not sure yet about all the implications, though\r\n\r\nIMHO this will require us to implement a lot of the functionality that is already present in the Dispatch Router. In particular, we would need to implement routing between the multiple instances of this *Command Dispatcher* component because you do not know to which of the instances the protocol adapter instances will connect.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/467886874/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sophokles73","id":5682135,"node_id":"MDQ6VXNlcjU2ODIxMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5682135?v=4","gravatar_id":"","url":"https://api.github.com/users/sophokles73","html_url":"https://github.com/sophokles73","followers_url":"https://api.github.com/users/sophokles73/followers","following_url":"https://api.github.com/users/sophokles73/following{/other_user}","gists_url":"https://api.github.com/users/sophokles73/gists{/gist_id}","starred_url":"https://api.github.com/users/sophokles73/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophokles73/subscriptions","organizations_url":"https://api.github.com/users/sophokles73/orgs","repos_url":"https://api.github.com/users/sophokles73/repos","events_url":"https://api.github.com/users/sophokles73/events{/privacy}","received_events_url":"https://api.github.com/users/sophokles73/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":2168178442,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjE2ODE3ODQ0Mg==","url":"https://api.github.com/repos/eclipse-hono/hono/issues/events/2168178442","actor":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-02-27T14:41:15Z","performed_via_github_app":null},{"id":2168178443,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIxNjgxNzg0NDM=","url":"https://api.github.com/repos/eclipse-hono/hono/issues/events/2168178443","actor":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-02-27T14:41:15Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/468020773","html_url":"https://github.com/eclipse-hono/hono/issues/930#issuecomment-468020773","issue_url":"https://api.github.com/repos/eclipse-hono/hono/issues/930","id":468020773,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2ODAyMDc3Mw==","user":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-02-27T20:37:57Z","updated_at":"2019-02-27T20:37:57Z","body":"> The applications would then send their one-way commands and command request messages to the AMQP network over a sender link with target addess control/requests (regardless of the tenant and/or device) but would need to set the message's to property to the proper device address, i.e. control/$tenant/$deviceId.\r\n\r\nThinking about a scenario where Hono is used with EnMasse, usage of the `control/requests` target address would cause authorization issues on the side of the senders here. When a non-empty target address is used, Qpid will check that address against the address permissions map received via the Keycloak auth service plugin. The `to` property of the message won't be checked in that case. That would mean, we can't define tenant-specific permissions here - the applications would be able to send commands to all devices of all tenants (of course provided the devices are actually listening).\r\n\r\nThe alternative would be to let the application use a sender with an empty target address and the proper address in the `to` property of the message. \r\nBut that would require Hono to open receiver links on all kinds of tenant id / device id combinations. So that's not an option.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/468020773/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/468155161","html_url":"https://github.com/eclipse-hono/hono/issues/930#issuecomment-468155161","issue_url":"https://api.github.com/repos/eclipse-hono/hono/issues/930","id":468155161,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2ODE1NTE2MQ==","user":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-02-28T06:33:18Z","updated_at":"2019-02-28T09:21:44Z","body":"To mitigate this, we could let the application open the sender link on the `control/requests/$tenant` address and use the `control/requests/$tenant/$device` address in the `To` property.\r\n\r\nIn Hono, we would create the receiver link on the `control/requests/$tenant` address in the protocol adapter instance, that has gotten the subscription request by the gateway device. Over time, multiple protocol adapter instances could possibly open such a link for the same tenant, but it doesn't matter which instance actually receives the command message.\r\nThe reason is that the protocol adapter then applies the `device -> gateway` mapping to the address in the `To` property and forwards the message to a new Qpid instance in Hono itself.\r\nAnd with this Qpid instance, the _actual_ protocol adapter to which the target gateway is subscribed has opened a `control/requests/$tenant/$gateway` receiver link. \r\n\r\nThat means, the difference to the above approach is using `control/requests/$tenant` instead of just `control/requests` for the application sender link address and integrating the mapper component logic in the protocol adapters.\r\n\r\n--\r\nTo a previous concern towards combining protocol adapter and mapper components, that was based on custom protocol adapters then having the ability to open receiver links on _all_ command messages: With the `control/requests/$tenant` address pattern, the user used for authorizing access from the custom protocol adapter to the AMQP network (e.g. EnMasse) should only be given `read` permissions on the `control/requests/$tenant` addresses with the tenant that the custom protocol adapter should have rights on.\r\nTo be resolved still in this respect: How to authorize access to the new Hono Qpid? Possibly with the Qpid auth plugin in connection with the Hono Auth component.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/468155161/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/468193647","html_url":"https://github.com/eclipse-hono/hono/issues/930#issuecomment-468193647","issue_url":"https://api.github.com/repos/eclipse-hono/hono/issues/930","id":468193647,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2ODE5MzY0Nw==","user":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-02-28T09:05:26Z","updated_at":"2019-02-28T09:06:34Z","body":"Actually, I think we don't necessarily need the new extra Hono-internal Qpid. It would be beneficial from a performance point of view if the AMQP network is in another VPC.\r\nBut as long as the new gateway mapping logic sends the mapped message on an address, that the command-sending application doesn't have permissions on (e.g `control/internal_requests/$tenant/$gateway`), it should also work sending it to the AMQP network again and letting the protocol adapter receive it from there.\r\nIt would be much easier to start out with this approach.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/468193647/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/468272103","html_url":"https://github.com/eclipse-hono/hono/issues/930#issuecomment-468272103","issue_url":"https://api.github.com/repos/eclipse-hono/hono/issues/930","id":468272103,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2ODI3MjEwMw==","user":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-02-28T13:28:15Z","updated_at":"2019-03-11T09:22:10Z","body":"The architecture and the steps towards setting up the links as well as the command flow is illustrated here:\r\n\r\n![gateway-device-mapping](https://user-images.githubusercontent.com/891931/53569578-c5094c00-3b64-11e9-9eb5-dc58bf0243dd.png)\r\n\r\nSteps that happen here are (yellow circles):\r\n\r\n(1) A gateway device subscribes to command messages. The request ends up at protocol adapter instance `1`.\r\n\r\n(2) The protocol adapter instance will create\r\n- receiver link on `control/requests/$tenant` (could be already there)\r\n- receiver link on `control/internal_requests/$tenant/$gateway` \r\n  (in the case that a directly connected device is involved here with no gateway, $gateway would be the device id here)\r\n\r\nwith the AMQP network.\r\nIf the subscription from the gateway is done on behalf of an actual device, getting the registration assertion from the device registry will trigger an update of the `device->gateway` mapping in the device registry.\r\n\r\n(3) To send commands, the application in the solution tier opens a sender link on `control/requests/$tenant`\r\nand sends the command message with a `To` address `control/requests/$tenant/$device`.\r\n\r\n(4) All the protocol adapters that have a receiver link on `control/requests/$tenant` compete for receiving the message.\r\nIn this example, let's say protocol adapter instance `2` gets the message.\r\n\r\n(5) Applying `device->gateway` mapping information provided from the device registry, the protocol adapter finds the gateway id corresponding to the device id from the `To` property of the message.\r\n(If there is no gateway found, meaning thate the device is connected directly, the device id from the `To` property is used as $gateway from here on).\r\nThe protocol adapter checks whether it already has a command receiver on the mapped `control/internal_requests/$tenant/$gateway` address. \r\nIf yes (as would be the case if adapter `1` had gotten the message), the adapter can send the message to the gateway device.\r\nIf no (as illustrated above), the adapter sends the message on a sender link (with the anonymous relay as target) with the `To` property `control/internal_requests/$tenant/$gateway` to the AMQP network.\r\n\r\n(6) From there, the protocol adapter `1`, having a receiver on that address, gets the message and can send the message to the gateway device.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/468272103/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/468323373","html_url":"https://github.com/eclipse-hono/hono/issues/930#issuecomment-468323373","issue_url":"https://api.github.com/repos/eclipse-hono/hono/issues/930","id":468323373,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2ODMyMzM3Mw==","user":{"login":"BobClaerhout","id":3315222,"node_id":"MDQ6VXNlcjMzMTUyMjI=","avatar_url":"https://avatars.githubusercontent.com/u/3315222?v=4","gravatar_id":"","url":"https://api.github.com/users/BobClaerhout","html_url":"https://github.com/BobClaerhout","followers_url":"https://api.github.com/users/BobClaerhout/followers","following_url":"https://api.github.com/users/BobClaerhout/following{/other_user}","gists_url":"https://api.github.com/users/BobClaerhout/gists{/gist_id}","starred_url":"https://api.github.com/users/BobClaerhout/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BobClaerhout/subscriptions","organizations_url":"https://api.github.com/users/BobClaerhout/orgs","repos_url":"https://api.github.com/users/BobClaerhout/repos","events_url":"https://api.github.com/users/BobClaerhout/events{/privacy}","received_events_url":"https://api.github.com/users/BobClaerhout/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-02-28T15:48:27Z","updated_at":"2019-02-28T15:48:57Z","body":"As discussed in the call, the address to post commands on will probably change. This is fine by me. However I have a concern on the address. Is following assumption correct?\r\nTo send a command to the device I'm using `\r\ncontrol/requests/$tenant/$device` as the `To` property on the message. This is used for sending a message directly to the device as well as for sending a message through the gateway. This surely is what we want because we do not want the business application to know whether the device is behind a gateway or not.\r\nIf this is correct, it is possible that the \"wrong\" protocol adapter receives the message when I want to send directly to a device. Is this addressed somewhere in the solution?","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/468323373/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"BobClaerhout","id":3315222,"node_id":"MDQ6VXNlcjMzMTUyMjI=","avatar_url":"https://avatars.githubusercontent.com/u/3315222?v=4","gravatar_id":"","url":"https://api.github.com/users/BobClaerhout","html_url":"https://github.com/BobClaerhout","followers_url":"https://api.github.com/users/BobClaerhout/followers","following_url":"https://api.github.com/users/BobClaerhout/following{/other_user}","gists_url":"https://api.github.com/users/BobClaerhout/gists{/gist_id}","starred_url":"https://api.github.com/users/BobClaerhout/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BobClaerhout/subscriptions","organizations_url":"https://api.github.com/users/BobClaerhout/orgs","repos_url":"https://api.github.com/users/BobClaerhout/repos","events_url":"https://api.github.com/users/BobClaerhout/events{/privacy}","received_events_url":"https://api.github.com/users/BobClaerhout/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/468332536","html_url":"https://github.com/eclipse-hono/hono/issues/930#issuecomment-468332536","issue_url":"https://api.github.com/repos/eclipse-hono/hono/issues/930","id":468332536,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2ODMzMjUzNg==","user":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-02-28T16:11:36Z","updated_at":"2019-02-28T16:11:36Z","body":"Yes, the `To` property value of `control/requests/$tenant/$device` is the same if the target device is behind a gateway or if it is directly connected to the protocol adapter.\r\nIn case it is directly connected, i.e. there is no `device->gateway` mapping, the receiving protocol adapter should forward the message to the `control/internal_requests/$tenant/$device` address (ie. $gateway is $device from the `To` property here).\r\nOn that `control/internal_requests/$tenant/$device` address, the actual protocol adapter instance (that the device is connected to) will have a receiver link.\r\nI've updated the text above to reflect that.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/468332536/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"sophokles73","id":5682135,"node_id":"MDQ6VXNlcjU2ODIxMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5682135?v=4","gravatar_id":"","url":"https://api.github.com/users/sophokles73","html_url":"https://github.com/sophokles73","followers_url":"https://api.github.com/users/sophokles73/followers","following_url":"https://api.github.com/users/sophokles73/following{/other_user}","gists_url":"https://api.github.com/users/sophokles73/gists{/gist_id}","starred_url":"https://api.github.com/users/sophokles73/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophokles73/subscriptions","organizations_url":"https://api.github.com/users/sophokles73/orgs","repos_url":"https://api.github.com/users/sophokles73/repos","events_url":"https://api.github.com/users/sophokles73/events{/privacy}","received_events_url":"https://api.github.com/users/sophokles73/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-04T08:51:14Z","updated_at":"2019-03-04T08:51:14Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/1073","repository_url":"https://api.github.com/repos/eclipse-hono/hono","labels_url":"https://api.github.com/repos/eclipse-hono/hono/issues/1073/labels{/name}","comments_url":"https://api.github.com/repos/eclipse-hono/hono/issues/1073/comments","events_url":"https://api.github.com/repos/eclipse-hono/hono/issues/1073/events","html_url":"https://github.com/eclipse-hono/hono/issues/1073","id":415979642,"node_id":"MDU6SXNzdWU0MTU5Nzk2NDI=","number":1073,"title":"Potentially competing receiver links when using command and control API","user":{"login":"DanielMaier-BSI","id":9269795,"node_id":"MDQ6VXNlcjkyNjk3OTU=","avatar_url":"https://avatars.githubusercontent.com/u/9269795?v=4","gravatar_id":"","url":"https://api.github.com/users/DanielMaier-BSI","html_url":"https://github.com/DanielMaier-BSI","followers_url":"https://api.github.com/users/DanielMaier-BSI/followers","following_url":"https://api.github.com/users/DanielMaier-BSI/following{/other_user}","gists_url":"https://api.github.com/users/DanielMaier-BSI/gists{/gist_id}","starred_url":"https://api.github.com/users/DanielMaier-BSI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DanielMaier-BSI/subscriptions","organizations_url":"https://api.github.com/users/DanielMaier-BSI/orgs","repos_url":"https://api.github.com/users/DanielMaier-BSI/repos","events_url":"https://api.github.com/users/DanielMaier-BSI/events{/privacy}","received_events_url":"https://api.github.com/users/DanielMaier-BSI/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":947051526,"node_id":"MDU6TGFiZWw5NDcwNTE1MjY=","url":"https://api.github.com/repos/eclipse-hono/hono/labels/C&C","name":"C&C","color":"2dbc83","default":false,"description":"Command and Control"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/eclipse-hono/hono/milestones/19","html_url":"https://github.com/eclipse-hono/hono/milestone/19","labels_url":"https://api.github.com/repos/eclipse-hono/hono/milestones/19/labels","id":4065065,"node_id":"MDk6TWlsZXN0b25lNDA2NTA2NQ==","number":19,"title":"1.0.0","description":"https://projects.eclipse.org/projects/iot.hono/releases/1.0.0","creator":{"login":"sophokles73","id":5682135,"node_id":"MDQ6VXNlcjU2ODIxMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5682135?v=4","gravatar_id":"","url":"https://api.github.com/users/sophokles73","html_url":"https://github.com/sophokles73","followers_url":"https://api.github.com/users/sophokles73/followers","following_url":"https://api.github.com/users/sophokles73/following{/other_user}","gists_url":"https://api.github.com/users/sophokles73/gists{/gist_id}","starred_url":"https://api.github.com/users/sophokles73/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophokles73/subscriptions","organizations_url":"https://api.github.com/users/sophokles73/orgs","repos_url":"https://api.github.com/users/sophokles73/repos","events_url":"https://api.github.com/users/sophokles73/events{/privacy}","received_events_url":"https://api.github.com/users/sophokles73/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":2,"closed_issues":414,"state":"closed","created_at":"2019-02-18T08:14:59Z","updated_at":"2022-11-30T09:51:53Z","due_on":"2019-10-14T07:00:00Z","closed_at":"2019-10-18T13:28:58Z"},"comments":22,"created_at":"2019-03-01T07:42:22Z","updated_at":"2019-06-25T06:47:21Z","closed_at":"2019-06-25T06:47:21Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":51307016,"node_id":"MDEwOlJlcG9zaXRvcnk1MTMwNzAxNg==","name":"hono","full_name":"eclipse-hono/hono","private":false,"owner":{"login":"eclipse-hono","id":112081701,"node_id":"O_kgDOBq47JQ","avatar_url":"https://avatars.githubusercontent.com/u/112081701?v=4","gravatar_id":"","url":"https://api.github.com/users/eclipse-hono","html_url":"https://github.com/eclipse-hono","followers_url":"https://api.github.com/users/eclipse-hono/followers","following_url":"https://api.github.com/users/eclipse-hono/following{/other_user}","gists_url":"https://api.github.com/users/eclipse-hono/gists{/gist_id}","starred_url":"https://api.github.com/users/eclipse-hono/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eclipse-hono/subscriptions","organizations_url":"https://api.github.com/users/eclipse-hono/orgs","repos_url":"https://api.github.com/users/eclipse-hono/repos","events_url":"https://api.github.com/users/eclipse-hono/events{/privacy}","received_events_url":"https://api.github.com/users/eclipse-hono/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/eclipse-hono/hono","description":"Eclipse Honoâ„¢ Project","fork":false,"url":"https://api.github.com/repos/eclipse-hono/hono","forks_url":"https://api.github.com/repos/eclipse-hono/hono/forks","keys_url":"https://api.github.com/repos/eclipse-hono/hono/keys{/key_id}","collaborators_url":"https://api.github.com/repos/eclipse-hono/hono/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/eclipse-hono/hono/teams","hooks_url":"https://api.github.com/repos/eclipse-hono/hono/hooks","issue_events_url":"https://api.github.com/repos/eclipse-hono/hono/issues/events{/number}","events_url":"https://api.github.com/repos/eclipse-hono/hono/events","assignees_url":"https://api.github.com/repos/eclipse-hono/hono/assignees{/user}","branches_url":"https://api.github.com/repos/eclipse-hono/hono/branches{/branch}","tags_url":"https://api.github.com/repos/eclipse-hono/hono/tags","blobs_url":"https://api.github.com/repos/eclipse-hono/hono/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/eclipse-hono/hono/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/eclipse-hono/hono/git/refs{/sha}","trees_url":"https://api.github.com/repos/eclipse-hono/hono/git/trees{/sha}","statuses_url":"https://api.github.com/repos/eclipse-hono/hono/statuses/{sha}","languages_url":"https://api.github.com/repos/eclipse-hono/hono/languages","stargazers_url":"https://api.github.com/repos/eclipse-hono/hono/stargazers","contributors_url":"https://api.github.com/repos/eclipse-hono/hono/contributors","subscribers_url":"https://api.github.com/repos/eclipse-hono/hono/subscribers","subscription_url":"https://api.github.com/repos/eclipse-hono/hono/subscription","commits_url":"https://api.github.com/repos/eclipse-hono/hono/commits{/sha}","git_commits_url":"https://api.github.com/repos/eclipse-hono/hono/git/commits{/sha}","comments_url":"https://api.github.com/repos/eclipse-hono/hono/comments{/number}","issue_comment_url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments{/number}","contents_url":"https://api.github.com/repos/eclipse-hono/hono/contents/{+path}","compare_url":"https://api.github.com/repos/eclipse-hono/hono/compare/{base}...{head}","merges_url":"https://api.github.com/repos/eclipse-hono/hono/merges","archive_url":"https://api.github.com/repos/eclipse-hono/hono/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/eclipse-hono/hono/downloads","issues_url":"https://api.github.com/repos/eclipse-hono/hono/issues{/number}","pulls_url":"https://api.github.com/repos/eclipse-hono/hono/pulls{/number}","milestones_url":"https://api.github.com/repos/eclipse-hono/hono/milestones{/number}","notifications_url":"https://api.github.com/repos/eclipse-hono/hono/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/eclipse-hono/hono/labels{/name}","releases_url":"https://api.github.com/repos/eclipse-hono/hono/releases{/id}","deployments_url":"https://api.github.com/repos/eclipse-hono/hono/deployments","created_at":"2016-02-08T15:45:28Z","updated_at":"2025-11-04T15:48:55Z","pushed_at":"2025-11-07T14:00:09Z","git_url":"git://github.com/eclipse-hono/hono.git","ssh_url":"git@github.com:eclipse-hono/hono.git","clone_url":"https://github.com/eclipse-hono/hono.git","svn_url":"https://github.com/eclipse-hono/hono","homepage":"https://eclipse.dev/hono","size":51799,"stargazers_count":476,"watchers_count":476,"language":"Java","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":139,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":115,"license":{"key":"epl-2.0","name":"Eclipse Public License 2.0","spdx_id":"EPL-2.0","url":"https://api.github.com/licenses/epl-2.0","node_id":"MDc6TGljZW5zZTMy"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["eclipseiot","internet-of-things","messaging"],"visibility":"public","forks":139,"open_issues":115,"watchers":476,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Command and control API uses address `control/${tenant_id}/${reply_id}` for receiving responses in consumer applications. Users are free to choose `${reply_id}`. If an application wants to receive all responses of one tenant, hono docs recommend to use an arbitrary (short) string as `${reply_id}` without `${device_id}` and to keep the receiver link open. \r\n\r\nHowever, protocol adapters use a very similar addressing scheme to receive commands from applications in the form of `control/${tenant_id}/${device_id}`. If `${device_id}` == `${reply_id}` we now have two competing receiver links and messaging network can not distinguish if a message should be sent to protocol adapter or to the application.\r\n\r\nOne possible solution would be to change addressing scheme for responses to \r\n`response/${tenant_id}/${reply_id}`. Of course this would require an API change.\r\n\r\nWDYT?","reactions":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/1073/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/eclipse-hono/hono/issues/1073/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/469271216","html_url":"https://github.com/eclipse-hono/hono/issues/930#issuecomment-469271216","issue_url":"https://api.github.com/repos/eclipse-hono/hono/issues/930","id":469271216,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTI3MTIxNg==","user":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-04T14:26:57Z","updated_at":"2019-03-05T08:51:31Z","body":"The solution above relies on the fact that protocol adapters open receiver links on `control/requests/$tenant` and `control/internal_requests/$tenant/$gateway`.\r\nIn the cases of MQTT and HTTP protocol adapters this would be triggered by incoming requests/subscriptions on that tenant and gateway.\r\n\r\nBut what about a protocol adapter like a LoRaWAN adapter where there is _no such trigger_ (at least not necessarily)?\r\nThis kind of adapter should be able to receive commands without having gotten requests from gateways/devices before. That means, such an adapter actively forwards the commands as _requests_ to the gateways/devices, not as a response to an incoming request from the gateways/devices.\r\n\r\nTo receive the commands, the protocol adapter would have to open receiver links for _all_ tenants and _all_ gateways relevant for this adapter. \r\nThis would mean that the adapter would have to be pre-configured with these tenant ids (or there would be a new method to query these in the device registry) so that corresponding links can be initialized on adapter startup. That doesn't look very practical.\r\n\r\nIn the case of the LoRaWAN adapter for example, it would be preferable for the adapter to be preconfigured just with the gateways (ie. the LoRa Network Server Gateways of the network providers).\r\nThese gateway ids could be handled/registered as pseudo tenants, so that the adapter opens receiver links on addresses like `control/requests/$gateway_pseudo_tenant` and `control/internal_requests/$gateway_pseudo_tenant/$gateway`.\r\n\r\nFor such a setup, the `device->gateway` mapping mechanism would also have to map from the actual customer tenant to the pseudo gateway tenant. That is because the application in the solution tier still sends the command using the _actual_ customer tenant (sender link on address `control/requests/$tenant`).\r\n\r\nHow to receive these commands without opening receiver links on _all_ the actual tenants, having no triggers from the gateways/devices?\r\n\r\n**Idea**:\r\nWe could let the applications in the solution tier open the sender links directly with the Hono protocol adapters via a Qpid dispatch router that forwards the link attachment frame (as configured by an outgoing `linkRoute` definition with the \"control/requests/\" prefix). This Qpid dispatch router is either the one already used as part of the AMQP network or it is a new separate router instance.\r\nWith this approach, the protocol adapters get all \"control/requests/\" messages - without having to open tenant-specific receivers.\r\n\r\nThis leads to the following architecture (applicable for an AMQP network with a Qpid dispatch router with an appropriate linkRoute config):\r\n![gateway-mapper6](https://user-images.githubusercontent.com/891931/53738773-6576ad80-3e90-11e9-9643-d30d3554740c.png)\r\n\r\nSteps that happen here are (yellow circles):\r\n\r\n(1) A gateway device subscribes to command messages. The request ends up at protocol adapter instance `1`.\r\n\r\n(2) The protocol adapter instance will create\r\n- a receiver link on `control/internal_requests/$tenant/$gateway` \r\n  (in the case that a directly connected device is involved here with no gateway, $gateway would be the device id here)\r\n\r\nwith the Qpid dispatch router of the AMQP network.\r\nIf the subscription from the gateway is done on behalf of an actual device, getting the registration assertion from the device registry will trigger an update of the `device->gateway` mapping in the device registry.\r\nIn case of a LoRaWAN (or similar) adapter, such a link (with $tenant set to the network/gateway id) will be created for all preconfigured networks/gateways on adapter startup.\r\n\r\n(3) To send commands, the application in the solution tier opens a sender link on `control/requests/$tenant/$device` with the Qpid dispatch ruoter and sends the command message.\r\n\r\n(4) All the (non-custom) protocol adapters are potential receivers of command messages.\r\nIn this example, let's say protocol adapter instance `2` gets the message.\r\n\r\n(5) Applying `device->gateway` mapping information provided from the device registry, the protocol adapter finds the gateway id (and tenant id) corresponding to the device id from the command request.\r\n(If there is no gateway found, meaning that the the device is connected directly, the device id from the `To` property is used as $gateway from here on).\r\nThe protocol adapter checks whether it already has a command receiver on the mapped `control/internal_requests/$tenant/$gateway` address. \r\nIf yes (as would be the case if adapter `1` had gotten the message), the adapter can send the message to the gateway device.\r\nIf no (as illustrated above), the adapter sends the message on a sender link (with the anonymous relay as target) with the `To` property `control/internal_requests/$tenant/$gateway` to the AMQP network.\r\n\r\n(6) From there, the protocol adapter `1`, having a receiver on that address, gets the message and can send the message to the gateway device.\r\n\r\n----\r\n\r\nIn case the AMQP network doesn't contain a Qpid dispatch router whose config can be adapted with the appropriate linkRoute definition, the setup would include a new Qpid instance.\r\n![gateway-mapper7](https://user-images.githubusercontent.com/891931/53738792-6d365200-3e90-11e9-8e12-804971dfd48f.png)\r\nThis Qpid instance instance would be the one that the application in the solution tier has to target (would mean a separate target endpoint for the command messages).\r\nThe challenge here would be to adopt the corresponding authentication and authorization rules from the AMQP network messaging endpoint.\r\nOr the specific AMQP network can be configured to do the same kind of forwarding of command messages as Qpid, whereas the application would again use the AMQP network endpoint as target.\r\n\r\nOr: The introduction of the extra Qpid here is motivated by the wish for providing _one_ command&control endpoint for the application in the solution tier, i.e. the same endpoint for sending the commands as for receiving the command replies.\r\nIf we deviate from that, we could declare two endpoints to be used by the applications like:\r\n- `messaging_in` for sending command requests\r\n- `messaging_out` for consuming telemetry/event and command responses.\r\n\r\nThen we could skip the extra Qpid instance and let the `messaging_in` endpoint be directly provided by the protocol adapters. Authentication and authorization could be done by the protocol adapters via creating a corresponding link to the AMQP network with the received SASL handshake credentials (if link creation succeeds, authorization is successful).\r\n![gateway-mapper8](https://user-images.githubusercontent.com/891931/53792219-70325080-3f2b-11e9-889b-3f728211759a.png)","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/469271216/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/469285708","html_url":"https://github.com/eclipse-hono/hono/issues/930#issuecomment-469285708","issue_url":"https://api.github.com/repos/eclipse-hono/hono/issues/930","id":469285708,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTI4NTcwOA==","user":{"login":"BobClaerhout","id":3315222,"node_id":"MDQ6VXNlcjMzMTUyMjI=","avatar_url":"https://avatars.githubusercontent.com/u/3315222?v=4","gravatar_id":"","url":"https://api.github.com/users/BobClaerhout","html_url":"https://github.com/BobClaerhout","followers_url":"https://api.github.com/users/BobClaerhout/followers","following_url":"https://api.github.com/users/BobClaerhout/following{/other_user}","gists_url":"https://api.github.com/users/BobClaerhout/gists{/gist_id}","starred_url":"https://api.github.com/users/BobClaerhout/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BobClaerhout/subscriptions","organizations_url":"https://api.github.com/users/BobClaerhout/orgs","repos_url":"https://api.github.com/users/BobClaerhout/repos","events_url":"https://api.github.com/users/BobClaerhout/events{/privacy}","received_events_url":"https://api.github.com/users/BobClaerhout/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-04T15:06:38Z","updated_at":"2019-03-04T15:06:38Z","body":"I like the proposed solution concerning the internal_requests. I think it doesn't have any downsides. I do have some remarks/questions:\r\n- Isn't hono always depending on an external AMQP network? Is it really necessary to have the ability to include an own Qpid instance? Is somebody deploying hono without an external AMQP network?\r\n- I think you are adding a requirement which is not needed. According to the documentation of actility/LoRaWAN (https://dx-api.thingpark.com/dataflow/v021/product/Processor-Documentation/Connectors/GenericMQTT/remarks.html) the mqtt address looks like `accountPrefix/things/deviceEUI/uplink`. This is also the case for AMQP connections, maybe this is not the case for HTTP publishers? I can't find any information on the messages published there and I do not have any experience with it. However, for AMQP and MQTT, the address contains both the tenant (account) and the device. This allows the adapter to extract both paramaters from the address and thus enabling to subscribe to the correct address and saving the gateway-device mapping as described in your proposal. \r\n- Concerning the devices which haven't send any messages yet: this isn't any different from other adapters. If a device from a certain tenant has never sent a message to the MQTT adapter or the HTTP adapter, you do not know through which gateway the device will connect to hono. FMPOV I think you're adding a requirement which has nothing to do with the core of this issue. Therefore I suggest to not take this extra requirment into account. This will complicate the implementation a lot.\r\n- A small remark which may not be forgotten during implementation (although I think you've probably already thought about this): a device should be able to roam between gateways. This means that specific mapping should be overwritable.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/469285708/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"BobClaerhout","id":3315222,"node_id":"MDQ6VXNlcjMzMTUyMjI=","avatar_url":"https://avatars.githubusercontent.com/u/3315222?v=4","gravatar_id":"","url":"https://api.github.com/users/BobClaerhout","html_url":"https://github.com/BobClaerhout","followers_url":"https://api.github.com/users/BobClaerhout/followers","following_url":"https://api.github.com/users/BobClaerhout/following{/other_user}","gists_url":"https://api.github.com/users/BobClaerhout/gists{/gist_id}","starred_url":"https://api.github.com/users/BobClaerhout/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BobClaerhout/subscriptions","organizations_url":"https://api.github.com/users/BobClaerhout/orgs","repos_url":"https://api.github.com/users/BobClaerhout/repos","events_url":"https://api.github.com/users/BobClaerhout/events{/privacy}","received_events_url":"https://api.github.com/users/BobClaerhout/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/469664535","html_url":"https://github.com/eclipse-hono/hono/issues/930#issuecomment-469664535","issue_url":"https://api.github.com/repos/eclipse-hono/hono/issues/930","id":469664535,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTY2NDUzNQ==","user":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-05T12:37:32Z","updated_at":"2019-03-11T11:52:08Z","body":"> Isn't hono always depending on an external AMQP network? Is it really necessary to have the ability to include an own Qpid instance? Is somebody deploying hono without an external AMQP network?\r\n\r\nYes, the architecture of Hono explicitly states the AMQP network to be external to Hono, so that one is flexible to attach Hono to a preferred messaging solution (be it a self-managed Qpid+Artemis, EnMasse or e.g. an Azure based messaging solution).\r\nIn that sense the first illustration in the comment above with the AMQP network consisting of a Qpid specially configured to connect to the Hono Protocol Adapters could be rather an unusual one (albeit the easiest to show the idea). Indeed, the main point of the above idea would be to find the solution for the case where we see the AMQP network as a black box (I've added another illustration for that).\r\n\r\n\r\n> I think you are adding a requirement which is not needed. According to the documentation of actility/LoRaWAN (https://dx-api.thingpark.com/dataflow/v021/product/Processor-Documentation/Connectors/GenericMQTT/remarks.html) the mqtt address looks like accountPrefix/things/deviceEUI/uplink. This is also the case for AMQP connections, maybe this is not the case for HTTP publishers?\r\n\r\nI was indeed looking at the scenario, where the LoRaWAN adapter is doing HTTP requests to the gateways (e.g. a Kerlink gateway). That would be a case where there was no preceding info coming from the gateways. With AMQP / MQTT indeed that would be different probably.\r\n\r\nSo, the main question is here: Do we want/need to add support for such protocol adapter scenarios, not requiring prior triggers from the gateways?\r\nIf not, we could choose the first approach above.\r\n\r\n> Concerning the devices which haven't send any messages yet: this isn't any different from other adapters. If a device from a certain tenant has never sent a message to the MQTT adapter or the HTTP adapter, you do not know through which gateway the device will connect to hono.\r\n\r\nThe difference would be the case of a LoRaWAN adapter, sending commands via HTTP to the gateways. There, the knowledge of to which gateway the device is connected to could potentially be configured in the device registry, not requiring the devices to have sent a messages to the gateway yet.\r\n\r\n>  a device should be able to roam between gateways. This means that specific mapping should be overwritable.\r\n\r\nYes.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/469664535/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/472032079","html_url":"https://github.com/eclipse-hono/hono/issues/930#issuecomment-472032079","issue_url":"https://api.github.com/repos/eclipse-hono/hono/issues/930","id":472032079,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MjAzMjA3OQ==","user":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-12T14:48:14Z","updated_at":"2019-03-12T14:48:14Z","body":"> So, the main question is here: Do we want/need to add support for such protocol adapter scenarios, not requiring prior triggers from the gateways?\r\nIf not, we could choose the first approach above.\r\n\r\nAny opinions on this?\r\n\r\nThe new HTTP based LoRa adapter (see PR #1078) currently only supports a preconfigured list of `commandEnabledTenants`. \r\nWith the above 2nd approach (not requiring triggers by the gateways), this limitation could be removed.\r\n\r\n\r\nTherefore, I would rather opt for that approach with the following setup as shown above:\r\n\r\n![gateway-mapper8](https://user-images.githubusercontent.com/891931/53792219-70325080-3f2b-11e9-889b-3f728211759a.png)\r\n\r\nIf the AMQP network is able to forward command requests to the protocol adapters, the command&control endpoints for the solution tier applications can remain in the AMQP network (the protocol adapters don't have to forward SASL credentials to the AMQP network in this case).","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/472032079/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/472364470","html_url":"https://github.com/eclipse-hono/hono/issues/930#issuecomment-472364470","issue_url":"https://api.github.com/repos/eclipse-hono/hono/issues/930","id":472364470,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MjM2NDQ3MA==","user":{"login":"BobClaerhout","id":3315222,"node_id":"MDQ6VXNlcjMzMTUyMjI=","avatar_url":"https://avatars.githubusercontent.com/u/3315222?v=4","gravatar_id":"","url":"https://api.github.com/users/BobClaerhout","html_url":"https://github.com/BobClaerhout","followers_url":"https://api.github.com/users/BobClaerhout/followers","following_url":"https://api.github.com/users/BobClaerhout/following{/other_user}","gists_url":"https://api.github.com/users/BobClaerhout/gists{/gist_id}","starred_url":"https://api.github.com/users/BobClaerhout/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BobClaerhout/subscriptions","organizations_url":"https://api.github.com/users/BobClaerhout/orgs","repos_url":"https://api.github.com/users/BobClaerhout/repos","events_url":"https://api.github.com/users/BobClaerhout/events{/privacy}","received_events_url":"https://api.github.com/users/BobClaerhout/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-13T10:25:02Z","updated_at":"2019-03-13T10:25:33Z","body":"> The difference would be the case of a LoRaWAN adapter, sending commands via HTTP to the gateways. There, the knowledge of to which gateway the device is connected to could potentially be configured in the device registry, not requiring the devices to have sent a messages to the gateway yet.  \r\n\r\nIf the HTTP LoRaWAN is able to retrieve the tenant, gateway and deviceId from the messages being sent to that adapter, I would implement the predefined list in another iteration. IMO this is not needed for a first version to address the problem discussed here.\r\n\r\n> With the above 2nd approach (not requiring triggers by the gateways), this limitation could be removed.  \r\n\r\nCan you clarify this? What are the exact triggers by the gateways you are talking about? Are those triggers devices message flowing through the gateways to the adapter?  \r\n\r\nI think my opinion was already clear to use an external AMQP network and without a pre-configured list mapping of devices/gateways. The part of your thoughts about those triggers is not entirely clear to me so I might be missing your request for input on that one.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/472364470/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"BobClaerhout","id":3315222,"node_id":"MDQ6VXNlcjMzMTUyMjI=","avatar_url":"https://avatars.githubusercontent.com/u/3315222?v=4","gravatar_id":"","url":"https://api.github.com/users/BobClaerhout","html_url":"https://github.com/BobClaerhout","followers_url":"https://api.github.com/users/BobClaerhout/followers","following_url":"https://api.github.com/users/BobClaerhout/following{/other_user}","gists_url":"https://api.github.com/users/BobClaerhout/gists{/gist_id}","starred_url":"https://api.github.com/users/BobClaerhout/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BobClaerhout/subscriptions","organizations_url":"https://api.github.com/users/BobClaerhout/orgs","repos_url":"https://api.github.com/users/BobClaerhout/repos","events_url":"https://api.github.com/users/BobClaerhout/events{/privacy}","received_events_url":"https://api.github.com/users/BobClaerhout/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/472410856","html_url":"https://github.com/eclipse-hono/hono/issues/930#issuecomment-472410856","issue_url":"https://api.github.com/repos/eclipse-hono/hono/issues/930","id":472410856,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MjQxMDg1Ng==","user":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-13T12:57:22Z","updated_at":"2019-03-13T12:57:22Z","body":"> > With the above 2nd approach (not requiring triggers by the gateways), this limitation could be removed.\r\n\r\n> Can you clarify this? What are the exact triggers by the gateways you are talking about? Are those triggers devices message flowing through the gateways to the adapter?\r\n\r\n\r\nWith the 1st approach (the very first illustration image above), the current command&control scenarios with the HTTP and MQTT adapters can be realized.\r\nThese adapter either receive a \"subscription\" request (MQTT) or a request with a `ttd` param (`time til disconnect` - the device waits that long for a command) (HTTP) from the devices (or gateways).\r\nThat would be the trigger that I meant, enabling the adapter to create a receiver link on the corresponding tenant.\r\n\r\nIn the case of a HTTP LoRaWAN adapter, devices/gateways don't necessarily signal their intent to receive commands in such a way.\r\nI mean we theoretically *could* create the command receiver link on the corresponding tenant in the adapter when telemetry/event messages are received.\r\nBut what if a device didn't send such a message, _or what if the adapter was restarted at some point after that (the receiver link being gone after that)_.\r\nIn these cases commands should still reach the devices.\r\n\r\nIn the LoRa adapter implementation given in PR #1078, the adapter is ready to receive commands directly after startup (without device requests) by means of having a preconfigured list of `commandEnabledTenants`.\r\nFor these tenants, the command receiver links are created on startup.\r\n\r\nTo mitigate this limitation of the LoRa adapter, not requiring the fixed list of tenants, the 2nd approach above can be used.\r\n\r\nSee this paragraph above:\r\n> In the case of the LoRaWAN adapter for example, it would be preferable for the adapter to be preconfigured just with the gateways (ie. the LoRa Network Server Gateways of the network providers).\r\nThese gateway ids could be handled/registered as pseudo tenants, so that the adapter opens receiver links on addresses like control/requests/$gateway_pseudo_tenant and control/internal_requests/$gateway_pseudo_tenant/$gateway.\r\n\r\n> For such a setup, the device->gateway mapping mechanism would also have to map from the actual customer tenant to the pseudo gateway tenant. That is because the application in the solution tier still sends the command using the actual customer tenant (sender link on address control/requests/$tenant).\r\n\r\nThis leads to the 2nd approach above where the main point is that Hono introduces a command endpoint for **all** command messages, not requiring the establishment of the receiver links for all actual customer tenants.\r\n\r\n> I think my opinion was already clear to use an external AMQP network and without a pre-configured list mapping of devices/gateways.\r\n\r\nMy thoughts here also included devices that don't need to send messages before potentially receiving commands. For these devices, a pre-configured mapping is needed.\r\nIn any case, we could update the device/gateway mapping whenever a message from a device is received.\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/472410856/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"sophokles73","id":5682135,"node_id":"MDQ6VXNlcjU2ODIxMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5682135?v=4","gravatar_id":"","url":"https://api.github.com/users/sophokles73","html_url":"https://github.com/sophokles73","followers_url":"https://api.github.com/users/sophokles73/followers","following_url":"https://api.github.com/users/sophokles73/following{/other_user}","gists_url":"https://api.github.com/users/sophokles73/gists{/gist_id}","starred_url":"https://api.github.com/users/sophokles73/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophokles73/subscriptions","organizations_url":"https://api.github.com/users/sophokles73/orgs","repos_url":"https://api.github.com/users/sophokles73/repos","events_url":"https://api.github.com/users/sophokles73/events{/privacy}","received_events_url":"https://api.github.com/users/sophokles73/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-14T07:17:25Z","updated_at":"2019-03-14T07:17:25Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/1085","repository_url":"https://api.github.com/repos/eclipse-hono/hono","labels_url":"https://api.github.com/repos/eclipse-hono/hono/issues/1085/labels{/name}","comments_url":"https://api.github.com/repos/eclipse-hono/hono/issues/1085/comments","events_url":"https://api.github.com/repos/eclipse-hono/hono/issues/1085/events","html_url":"https://github.com/eclipse-hono/hono/pull/1085","id":420665407,"node_id":"MDExOlB1bGxSZXF1ZXN0MjYwODk2ODE1","number":1085,"title":"[#780] Extract methods out of HonoClient into new HonoApplicationClient","user":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-03-13T18:54:14Z","updated_at":"2019-04-30T07:01:41Z","closed_at":"2019-03-14T08:28:33Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":51307016,"node_id":"MDEwOlJlcG9zaXRvcnk1MTMwNzAxNg==","name":"hono","full_name":"eclipse-hono/hono","private":false,"owner":{"login":"eclipse-hono","id":112081701,"node_id":"O_kgDOBq47JQ","avatar_url":"https://avatars.githubusercontent.com/u/112081701?v=4","gravatar_id":"","url":"https://api.github.com/users/eclipse-hono","html_url":"https://github.com/eclipse-hono","followers_url":"https://api.github.com/users/eclipse-hono/followers","following_url":"https://api.github.com/users/eclipse-hono/following{/other_user}","gists_url":"https://api.github.com/users/eclipse-hono/gists{/gist_id}","starred_url":"https://api.github.com/users/eclipse-hono/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eclipse-hono/subscriptions","organizations_url":"https://api.github.com/users/eclipse-hono/orgs","repos_url":"https://api.github.com/users/eclipse-hono/repos","events_url":"https://api.github.com/users/eclipse-hono/events{/privacy}","received_events_url":"https://api.github.com/users/eclipse-hono/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/eclipse-hono/hono","description":"Eclipse Honoâ„¢ Project","fork":false,"url":"https://api.github.com/repos/eclipse-hono/hono","forks_url":"https://api.github.com/repos/eclipse-hono/hono/forks","keys_url":"https://api.github.com/repos/eclipse-hono/hono/keys{/key_id}","collaborators_url":"https://api.github.com/repos/eclipse-hono/hono/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/eclipse-hono/hono/teams","hooks_url":"https://api.github.com/repos/eclipse-hono/hono/hooks","issue_events_url":"https://api.github.com/repos/eclipse-hono/hono/issues/events{/number}","events_url":"https://api.github.com/repos/eclipse-hono/hono/events","assignees_url":"https://api.github.com/repos/eclipse-hono/hono/assignees{/user}","branches_url":"https://api.github.com/repos/eclipse-hono/hono/branches{/branch}","tags_url":"https://api.github.com/repos/eclipse-hono/hono/tags","blobs_url":"https://api.github.com/repos/eclipse-hono/hono/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/eclipse-hono/hono/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/eclipse-hono/hono/git/refs{/sha}","trees_url":"https://api.github.com/repos/eclipse-hono/hono/git/trees{/sha}","statuses_url":"https://api.github.com/repos/eclipse-hono/hono/statuses/{sha}","languages_url":"https://api.github.com/repos/eclipse-hono/hono/languages","stargazers_url":"https://api.github.com/repos/eclipse-hono/hono/stargazers","contributors_url":"https://api.github.com/repos/eclipse-hono/hono/contributors","subscribers_url":"https://api.github.com/repos/eclipse-hono/hono/subscribers","subscription_url":"https://api.github.com/repos/eclipse-hono/hono/subscription","commits_url":"https://api.github.com/repos/eclipse-hono/hono/commits{/sha}","git_commits_url":"https://api.github.com/repos/eclipse-hono/hono/git/commits{/sha}","comments_url":"https://api.github.com/repos/eclipse-hono/hono/comments{/number}","issue_comment_url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments{/number}","contents_url":"https://api.github.com/repos/eclipse-hono/hono/contents/{+path}","compare_url":"https://api.github.com/repos/eclipse-hono/hono/compare/{base}...{head}","merges_url":"https://api.github.com/repos/eclipse-hono/hono/merges","archive_url":"https://api.github.com/repos/eclipse-hono/hono/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/eclipse-hono/hono/downloads","issues_url":"https://api.github.com/repos/eclipse-hono/hono/issues{/number}","pulls_url":"https://api.github.com/repos/eclipse-hono/hono/pulls{/number}","milestones_url":"https://api.github.com/repos/eclipse-hono/hono/milestones{/number}","notifications_url":"https://api.github.com/repos/eclipse-hono/hono/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/eclipse-hono/hono/labels{/name}","releases_url":"https://api.github.com/repos/eclipse-hono/hono/releases{/id}","deployments_url":"https://api.github.com/repos/eclipse-hono/hono/deployments","created_at":"2016-02-08T15:45:28Z","updated_at":"2025-11-04T15:48:55Z","pushed_at":"2025-11-07T14:00:09Z","git_url":"git://github.com/eclipse-hono/hono.git","ssh_url":"git@github.com:eclipse-hono/hono.git","clone_url":"https://github.com/eclipse-hono/hono.git","svn_url":"https://github.com/eclipse-hono/hono","homepage":"https://eclipse.dev/hono","size":51799,"stargazers_count":476,"watchers_count":476,"language":"Java","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":139,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":115,"license":{"key":"epl-2.0","name":"Eclipse Public License 2.0","spdx_id":"EPL-2.0","url":"https://api.github.com/licenses/epl-2.0","node_id":"MDc6TGljZW5zZTMy"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["eclipseiot","internet-of-things","messaging"],"visibility":"public","forks":139,"open_issues":115,"watchers":476,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/eclipse-hono/hono/pulls/1085","html_url":"https://github.com/eclipse-hono/hono/pull/1085","diff_url":"https://github.com/eclipse-hono/hono/pull/1085.diff","patch_url":"https://github.com/eclipse-hono/hono/pull/1085.patch","merged_at":null},"body":"This is the first part of the solution for #780.\r\n\r\n(Javadoc for the new classes adopted from the base classes for now; will be adapted once split of HonoClient is complete.)","reactions":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/1085/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/eclipse-hono/hono/issues/1085/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/473207873","html_url":"https://github.com/eclipse-hono/hono/issues/930#issuecomment-473207873","issue_url":"https://api.github.com/repos/eclipse-hono/hono/issues/930","id":473207873,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MzIwNzg3Mw==","user":{"login":"sophokles73","id":5682135,"node_id":"MDQ6VXNlcjU2ODIxMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5682135?v=4","gravatar_id":"","url":"https://api.github.com/users/sophokles73","html_url":"https://github.com/sophokles73","followers_url":"https://api.github.com/users/sophokles73/followers","following_url":"https://api.github.com/users/sophokles73/following{/other_user}","gists_url":"https://api.github.com/users/sophokles73/gists{/gist_id}","starred_url":"https://api.github.com/users/sophokles73/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophokles73/subscriptions","organizations_url":"https://api.github.com/users/sophokles73/orgs","repos_url":"https://api.github.com/users/sophokles73/repos","events_url":"https://api.github.com/users/sophokles73/events{/privacy}","received_events_url":"https://api.github.com/users/sophokles73/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-15T08:58:34Z","updated_at":"2019-03-15T08:58:34Z","body":"@calohmn @BobClaerhout \r\nThanks for the great discussion of the subject so far :+1: \r\nOf course, teach of the proposed/discussed approaches have their pros and cons. However, I do have to admit that I would rather not rely on Qpid being part of the AMQP Messaging Network nor introducing it to Hono as a required component. The reason for that simply is that the former assumption would drastically restrict the choice for AMQP Messaging Network implementations while the latter would add another component to the already complex system landscape that we would need to configure, operate and scale. That said, I do like the initially proposed approach, where all (standard) protocol adapter instances compete for outbound command messages and participate in the mapping of the message address.\r\n\r\nMy understanding is that we can already use this approach for those cases where a gateway/device triggers the establishment of the device specific receiver link. The only open issue seems to be, if, and if so, how we would support cases where there is no such trigger.\r\n\r\nThe only occurrence of this pattern currently seems to be LoRa network providers acting as gateways for LoRa devices which use HTTP to forward telemetry to our adapter and which expose an HTTP endpoint for receiving upstream commands for devices.\r\n\r\nAs @BobClaerhout pointed out, many (if not all) of these network providers also support (or prefer?) connecting to clouds via MQTT (or AMQP) instead of using HTTP. May be we can simply restrict Hono's support for LoRa to such providers? Then we would not have the problem outlined by @calohmn  at all, right?\r\n\r\nIf we do need to support this use case, then we might also be able to use the initial approach proposed by @calohmn with a small addition being made. In all such cases, it is not important which protocol adapter instance forwards the command to the network provider endpoint. So, all instances of the corresponding adapter type could open an additional, type specific receiver link for outbound commands. The HTTP adapters could use e.g. `hono-http/control/out`.\r\n\r\nWhen doing the mapping of the message address, all the protocol adapter instances would then determine the type of protocol adapter that the device uses based on information contained in the Device Registration service. If a specific adapter type is registered, then the address is mapped to the corresponding address pattern, e.g. `${adapter-type}/control/out` and forwarded via the anonymous sender link as outlined in @calohmn initial proposal. If no specific adapter type is registered, then the standard mapping is done, i.e. just mapping the device ID to the gateway ID.\r\n\r\nIn both cases, the mapped command message would need to contain the tenant and device ID of the device that is the subject of the command, so that the protocol adapter can use this information when forwarding the command to the network adapter.\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/473207873/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sophokles73","id":5682135,"node_id":"MDQ6VXNlcjU2ODIxMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5682135?v=4","gravatar_id":"","url":"https://api.github.com/users/sophokles73","html_url":"https://github.com/sophokles73","followers_url":"https://api.github.com/users/sophokles73/followers","following_url":"https://api.github.com/users/sophokles73/following{/other_user}","gists_url":"https://api.github.com/users/sophokles73/gists{/gist_id}","starred_url":"https://api.github.com/users/sophokles73/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophokles73/subscriptions","organizations_url":"https://api.github.com/users/sophokles73/orgs","repos_url":"https://api.github.com/users/sophokles73/repos","events_url":"https://api.github.com/users/sophokles73/events{/privacy}","received_events_url":"https://api.github.com/users/sophokles73/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":2205825302,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjIwNTgyNTMwMg==","url":"https://api.github.com/repos/eclipse-hono/hono/issues/events/2205825302","actor":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-03-15T08:58:38Z","performed_via_github_app":null},{"id":2205825306,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIyMDU4MjUzMDY=","url":"https://api.github.com/repos/eclipse-hono/hono/issues/events/2205825306","actor":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-03-15T08:58:38Z","performed_via_github_app":null},{"id":2205825309,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjIwNTgyNTMwOQ==","url":"https://api.github.com/repos/eclipse-hono/hono/issues/events/2205825309","actor":{"login":"BobClaerhout","id":3315222,"node_id":"MDQ6VXNlcjMzMTUyMjI=","avatar_url":"https://avatars.githubusercontent.com/u/3315222?v=4","gravatar_id":"","url":"https://api.github.com/users/BobClaerhout","html_url":"https://github.com/BobClaerhout","followers_url":"https://api.github.com/users/BobClaerhout/followers","following_url":"https://api.github.com/users/BobClaerhout/following{/other_user}","gists_url":"https://api.github.com/users/BobClaerhout/gists{/gist_id}","starred_url":"https://api.github.com/users/BobClaerhout/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BobClaerhout/subscriptions","organizations_url":"https://api.github.com/users/BobClaerhout/orgs","repos_url":"https://api.github.com/users/BobClaerhout/repos","events_url":"https://api.github.com/users/BobClaerhout/events{/privacy}","received_events_url":"https://api.github.com/users/BobClaerhout/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-03-15T08:58:38Z","performed_via_github_app":null},{"id":2205825313,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIyMDU4MjUzMTM=","url":"https://api.github.com/repos/eclipse-hono/hono/issues/events/2205825313","actor":{"login":"BobClaerhout","id":3315222,"node_id":"MDQ6VXNlcjMzMTUyMjI=","avatar_url":"https://avatars.githubusercontent.com/u/3315222?v=4","gravatar_id":"","url":"https://api.github.com/users/BobClaerhout","html_url":"https://github.com/BobClaerhout","followers_url":"https://api.github.com/users/BobClaerhout/followers","following_url":"https://api.github.com/users/BobClaerhout/following{/other_user}","gists_url":"https://api.github.com/users/BobClaerhout/gists{/gist_id}","starred_url":"https://api.github.com/users/BobClaerhout/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BobClaerhout/subscriptions","organizations_url":"https://api.github.com/users/BobClaerhout/orgs","repos_url":"https://api.github.com/users/BobClaerhout/repos","events_url":"https://api.github.com/users/BobClaerhout/events{/privacy}","received_events_url":"https://api.github.com/users/BobClaerhout/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-03-15T08:58:38Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/473223342","html_url":"https://github.com/eclipse-hono/hono/issues/930#issuecomment-473223342","issue_url":"https://api.github.com/repos/eclipse-hono/hono/issues/930","id":473223342,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MzIyMzM0Mg==","user":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-15T09:50:14Z","updated_at":"2019-03-15T09:50:14Z","body":"> When doing the mapping of the message address, all the protocol adapter instances would [...]\r\n\r\nThe question would be here, how the protocol adapter instances would be able to receive the command messages from the applications in the first place (before doing the mapping).\r\nIn my initial proposal, the trigger (ie. subscription/ttd request) from the gateways/devices contains the tenant id for which the protocol adapter instance will open the `control/request/$tenant` receiver link.\r\n\r\nWith no such trigger, there is no certainty that such a receiver link has been created (we can't practically create such links for *all* tenants).\r\nOn the other hand, applications are *required* to use a tenant specific address like `control/request/$tenant` for sending the commands because the whole authorization mechanism in the AMQP network relies on that.\r\n\r\nA solution for that was a main point of my 2nd approach, allowing the protocol adapters to receive *all* commands, like doing a wildcard match on all tenants, by letting the applications connect directly to the protocol adapters (or letting them connect to a Qpid instance that does link-routing of all such requests to the protocol adapters). ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/473223342/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/473241647","html_url":"https://github.com/eclipse-hono/hono/issues/930#issuecomment-473241647","issue_url":"https://api.github.com/repos/eclipse-hono/hono/issues/930","id":473241647,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MzI0MTY0Nw==","user":{"login":"sophokles73","id":5682135,"node_id":"MDQ6VXNlcjU2ODIxMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5682135?v=4","gravatar_id":"","url":"https://api.github.com/users/sophokles73","html_url":"https://github.com/sophokles73","followers_url":"https://api.github.com/users/sophokles73/followers","following_url":"https://api.github.com/users/sophokles73/following{/other_user}","gists_url":"https://api.github.com/users/sophokles73/gists{/gist_id}","starred_url":"https://api.github.com/users/sophokles73/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophokles73/subscriptions","organizations_url":"https://api.github.com/users/sophokles73/orgs","repos_url":"https://api.github.com/users/sophokles73/repos","events_url":"https://api.github.com/users/sophokles73/events{/privacy}","received_events_url":"https://api.github.com/users/sophokles73/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-15T10:51:13Z","updated_at":"2019-03-15T10:51:13Z","body":"right, I totally forgot about that ...","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/comments/473241647/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sophokles73","id":5682135,"node_id":"MDQ6VXNlcjU2ODIxMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5682135?v=4","gravatar_id":"","url":"https://api.github.com/users/sophokles73","html_url":"https://github.com/sophokles73","followers_url":"https://api.github.com/users/sophokles73/followers","following_url":"https://api.github.com/users/sophokles73/following{/other_user}","gists_url":"https://api.github.com/users/sophokles73/gists{/gist_id}","starred_url":"https://api.github.com/users/sophokles73/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophokles73/subscriptions","organizations_url":"https://api.github.com/users/sophokles73/orgs","repos_url":"https://api.github.com/users/sophokles73/repos","events_url":"https://api.github.com/users/sophokles73/events{/privacy}","received_events_url":"https://api.github.com/users/sophokles73/received_events","type":"User","user_view_type":"public","site_admin":false}}]