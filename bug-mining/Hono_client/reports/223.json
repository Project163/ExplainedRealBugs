{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/2074","repository_url":"https://api.github.com/repos/eclipse-hono/hono","labels_url":"https://api.github.com/repos/eclipse-hono/hono/issues/2074/labels{/name}","comments_url":"https://api.github.com/repos/eclipse-hono/hono/issues/2074/comments","events_url":"https://api.github.com/repos/eclipse-hono/hono/issues/2074/events","html_url":"https://github.com/eclipse-hono/hono/issues/2074","id":653030639,"node_id":"MDU6SXNzdWU2NTMwMzA2Mzk=","number":2074,"title":"IllegalStateException in AbstractRequestResponseClient","user":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":323160606,"node_id":"MDU6TGFiZWwzMjMxNjA2MDY=","url":"https://api.github.com/repos/eclipse-hono/hono/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":643682479,"node_id":"MDU6TGFiZWw2NDM2ODI0Nzk=","url":"https://api.github.com/repos/eclipse-hono/hono/labels/Client","name":"Client","color":"0e8a16","default":false,"description":null},{"id":2161239242,"node_id":"MDU6TGFiZWwyMTYxMjM5MjQy","url":"https://api.github.com/repos/eclipse-hono/hono/labels/build%20system","name":"build system","color":"0e8a16","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/eclipse-hono/hono/milestones/23","html_url":"https://github.com/eclipse-hono/hono/milestone/23","labels_url":"https://api.github.com/repos/eclipse-hono/hono/milestones/23/labels","id":5232802,"node_id":"MDk6TWlsZXN0b25lNTIzMjgwMg==","number":23,"title":"1.3.0","description":"https://projects.eclipse.org/projects/iot.hono/releases/1.3.0","creator":{"login":"sophokles73","id":5682135,"node_id":"MDQ6VXNlcjU2ODIxMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5682135?v=4","gravatar_id":"","url":"https://api.github.com/users/sophokles73","html_url":"https://github.com/sophokles73","followers_url":"https://api.github.com/users/sophokles73/followers","following_url":"https://api.github.com/users/sophokles73/following{/other_user}","gists_url":"https://api.github.com/users/sophokles73/gists{/gist_id}","starred_url":"https://api.github.com/users/sophokles73/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophokles73/subscriptions","organizations_url":"https://api.github.com/users/sophokles73/orgs","repos_url":"https://api.github.com/users/sophokles73/repos","events_url":"https://api.github.com/users/sophokles73/events{/privacy}","received_events_url":"https://api.github.com/users/sophokles73/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":176,"state":"closed","created_at":"2020-03-24T14:28:34Z","updated_at":"2020-08-03T13:27:48Z","due_on":"2020-07-15T07:00:00Z","closed_at":"2020-08-03T13:27:48Z"},"comments":2,"created_at":"2020-07-08T06:38:14Z","updated_at":"2020-07-09T08:14:31Z","closed_at":"2020-07-09T08:14:31Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"During some recent failed integration test runs in Travis, there were such kind of exceptions in the log:\r\n````\r\n13:23:04.633 [vert.x-eventloop-thread-2] ERROR io.vertx.core.impl.ContextImpl - Unhandled exception\r\njava.lang.IllegalStateException: Result is already complete: failed\r\n\tat io.vertx.core.impl.FutureImpl.complete(FutureImpl.java:112)\r\n\tat io.vertx.core.impl.FutureImpl.handle(FutureImpl.java:176)\r\n\tat io.vertx.core.impl.FutureImpl.handle(FutureImpl.java:21)\r\n\tat org.eclipse.hono.client.impl.AbstractRequestResponseClient.lambda$sendRequest$4(AbstractRequestResponseClient.java:881)\r\n\tat io.vertx.proton.impl.ProtonDeliveryImpl.fireUpdate(ProtonDeliveryImpl.java:158)\r\n\tat io.vertx.proton.impl.ProtonTransport.handleSocketBuffer(ProtonTransport.java:161)\r\n\tat io.vertx.core.net.impl.NetSocketImpl$DataMessageHandler.handle(NetSocketImpl.java:379)\r\n\tat io.vertx.core.net.impl.NetSocketImpl.lambda$new$2(NetSocketImpl.java:101)\r\n\tat io.vertx.core.streams.impl.InboundBuffer.handleEvent(InboundBuffer.java:237)\r\n\tat io.vertx.core.streams.impl.InboundBuffer.write(InboundBuffer.java:127)\r\n\tat io.vertx.core.net.impl.NetSocketImpl.handleMessage(NetSocketImpl.java:357)\r\n\tat io.vertx.core.impl.ContextImpl.executeTask(ContextImpl.java:366)\r\n\tat io.vertx.core.impl.EventLoopContext.execute(EventLoopContext.java:43)\r\n\tat io.vertx.core.impl.ContextImpl.executeFromIO(ContextImpl.java:229)\r\n\tat io.vertx.core.net.impl.VertxHandler.channelRead(VertxHandler.java:173)\r\n[...]\r\n13:23:07.134 [vert.x-eventloop-thread-2] ERROR o.e.h.t.amqp.CommandAndControlAmqpIT - failed to establish connection to AMQP adapter [host: localhost, port: 32785]\r\norg.eclipse.hono.client.ServerErrorException: connection to server lost\r\n\tat org.eclipse.hono.client.impl.ClientFactory.lambda$createClient$0(ClientFactory.java:91)\r\n\tat org.eclipse.hono.client.impl.ClientFactory.failAllCreationRequests(ClientFactory.java:69)\r\n\tat org.eclipse.hono.client.impl.ClientFactory.clearState(ClientFactory.java:62)\r\n\tat org.eclipse.hono.client.impl.ClientFactory.clearState(ClientFactory.java:50)\r\n\tat org.eclipse.hono.client.impl.ApplicationClientFactoryImpl.onDisconnect(ApplicationClientFactoryImpl.java:224)\r\n\tat org.eclipse.hono.client.impl.AbstractHonoClientFactory.lambda$new$0(AbstractHonoClientFactory.java:52)\r\n\tat org.eclipse.hono.client.impl.HonoConnectionImpl.notifyDisconnectHandler(HonoConnectionImpl.java:533)\r\n\tat org.eclipse.hono.client.impl.HonoConnectionImpl.notifyDisconnectHandlers(HonoConnectionImpl.java:523)\r\n\tat org.eclipse.hono.client.impl.HonoConnectionImpl.clearState(HonoConnectionImpl.java:516)\r\n\tat org.eclipse.hono.client.impl.HonoConnectionImpl.lambda$closeConnection$29(HonoConnectionImpl.java:1111)\r\n\tat org.eclipse.hono.client.impl.HonoConnectionImpl.lambda$closeConnection$30(HonoConnectionImpl.java:1117)\r\n\tat io.vertx.core.impl.VertxImpl$InternalTimerHandler.handle(VertxImpl.java:923)\r\n\tat io.vertx.core.impl.VertxImpl$InternalTimerHandler.handle(VertxImpl.java:887)\r\n\tat io.vertx.core.impl.ContextImpl.executeTask(ContextImpl.java:366)\r\n\tat io.vertx.core.impl.EventLoopContext.execute(EventLoopContext.java:43)\r\n\tat io.vertx.core.impl.ContextImpl.executeFromIO(ContextImpl.java:229)\r\n\tat io.vertx.core.impl.ContextImpl.executeFromIO(ContextImpl.java:221)\r\n\tat io.vertx.core.impl.VertxImpl$InternalTimerHandler.run(VertxImpl.java:913)\r\n````\r\nThat means that closing the connection while a request/response is being handled via the `AbstractRequestResponseClient` seems to produce such an unhandled exception.\r\n\r\n\r\n(These errors occurred mostly in the `CommandAndControlAmqpIT` tests but also in `CommandAndControlMqttIT`. The reason why the connection from the test client to the adapter got closed during the test run is still unclear.)","closed_by":{"login":"calohmn","id":891931,"node_id":"MDQ6VXNlcjg5MTkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/891931?v=4","gravatar_id":"","url":"https://api.github.com/users/calohmn","html_url":"https://github.com/calohmn","followers_url":"https://api.github.com/users/calohmn/followers","following_url":"https://api.github.com/users/calohmn/following{/other_user}","gists_url":"https://api.github.com/users/calohmn/gists{/gist_id}","starred_url":"https://api.github.com/users/calohmn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calohmn/subscriptions","organizations_url":"https://api.github.com/users/calohmn/orgs","repos_url":"https://api.github.com/users/calohmn/repos","events_url":"https://api.github.com/users/calohmn/events{/privacy}","received_events_url":"https://api.github.com/users/calohmn/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/eclipse-hono/hono/issues/2074/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/eclipse-hono/hono/issues/2074/timeline","performed_via_github_app":null,"state_reason":"completed"}