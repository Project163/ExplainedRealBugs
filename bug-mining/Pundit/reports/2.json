{"url":"https://api.github.com/repos/varvet/pundit/issues/12","repository_url":"https://api.github.com/repos/varvet/pundit","labels_url":"https://api.github.com/repos/varvet/pundit/issues/12/labels{/name}","comments_url":"https://api.github.com/repos/varvet/pundit/issues/12/comments","events_url":"https://api.github.com/repos/varvet/pundit/issues/12/events","html_url":"https://github.com/varvet/pundit/issues/12","id":10122823,"node_id":"MDU6SXNzdWUxMDEyMjgyMw==","number":12,"title":"Namespaced policies","user":{"login":"assembler","id":178890,"node_id":"MDQ6VXNlcjE3ODg5MA==","avatar_url":"https://avatars.githubusercontent.com/u/178890?v=4","gravatar_id":"","url":"https://api.github.com/users/assembler","html_url":"https://github.com/assembler","followers_url":"https://api.github.com/users/assembler/followers","following_url":"https://api.github.com/users/assembler/following{/other_user}","gists_url":"https://api.github.com/users/assembler/gists{/gist_id}","starred_url":"https://api.github.com/users/assembler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/assembler/subscriptions","organizations_url":"https://api.github.com/users/assembler/orgs","repos_url":"https://api.github.com/users/assembler/repos","events_url":"https://api.github.com/users/assembler/events{/privacy}","received_events_url":"https://api.github.com/users/assembler/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":45,"created_at":"2013-01-19T08:38:50Z","updated_at":"2025-01-06T15:43:31Z","closed_at":"2014-07-13T08:37:59Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The app I'm working on has two sections: user and admin. There are multiple types of users and multiple types of admins, and different authentication solutions are used for each of them.\n\nAlthough all the application models are used by both admins and users, policies are very different. Handling both users and admins and all distinct types within single policy was not so clear and full of `if`s. \n\nThe way I handled this was to dynamically define `policy_class` on every `ActiveRecord` descendant in before filter. Something like this:\n\n``` ruby\ndef set_policy_namespace\n  m = self.class.name.split(\"::\").first\n  active_record_descendants.each do |ar|\n    ar.class.instance_eval do\n      define_method(:policy_class) do\n        \"::Policies::#{m}::#{self.name}Policy\"\n      end\n    end\n  end\nend\n\ndef active_record_descendants\n  Rails.application.eager_load! unless Rails.application.config.cache_classes\n  ActiveRecord::Base.descendants\nend\n```\n\nSo, if I'm in `Admin::HomeController`, `Project` model will have `policy_class` redefined to return `::Policies::Admin::ProjectPolicy`. \n\nI've tried to demonstrate valid use case for this. Do you have any thoughts on how can this be made easier? I'm not sure whether or not it should be a part of gem (since it is somewhat rare).. I'm just asking for opinion.\n\nthanks\n","closed_by":{"login":"thomasklemm","id":1100176,"node_id":"MDQ6VXNlcjExMDAxNzY=","avatar_url":"https://avatars.githubusercontent.com/u/1100176?v=4","gravatar_id":"","url":"https://api.github.com/users/thomasklemm","html_url":"https://github.com/thomasklemm","followers_url":"https://api.github.com/users/thomasklemm/followers","following_url":"https://api.github.com/users/thomasklemm/following{/other_user}","gists_url":"https://api.github.com/users/thomasklemm/gists{/gist_id}","starred_url":"https://api.github.com/users/thomasklemm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thomasklemm/subscriptions","organizations_url":"https://api.github.com/users/thomasklemm/orgs","repos_url":"https://api.github.com/users/thomasklemm/repos","events_url":"https://api.github.com/users/thomasklemm/events{/privacy}","received_events_url":"https://api.github.com/users/thomasklemm/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/varvet/pundit/issues/12/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/varvet/pundit/issues/12/timeline","performed_via_github_app":null,"state_reason":"completed"}