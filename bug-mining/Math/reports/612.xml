<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:25:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-1381] BinomialTest P-value &gt; 1</title>
                <link>https://issues.apache.org/jira/browse/MATH-1381</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;When I use the Binomial Test, I got p-value &amp;gt; 1 for two sided check.&lt;/p&gt;

&lt;p&gt;Example:&lt;br/&gt;
(new BinomialTest()).binomialTest(200, 200, 0.9950429, AlternativeHypothesis.TWO_SIDED) == 1.3701357550780435&lt;/p&gt;

&lt;p&gt;In my case, if the expected p-value is 1 (calculated by package in other language, scipy in this case), the p-value returned could be &amp;gt; 1&lt;/p&gt;</description>
                <environment></environment>
        <key id="12989690">MATH-1381</key>
            <summary>BinomialTest P-value &gt; 1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kinow">Bruno P. Kinoshita</assignee>
                                    <reporter username="wangqiang8511">Wang Qiang</reporter>
                        <labels>
                    </labels>
                <created>Fri, 15 Jul 2016 06:28:52 +0000</created>
                <updated>Tue, 9 May 2017 03:08:50 +0000</updated>
                            <resolved>Tue, 9 May 2017 03:08:25 +0000</resolved>
                                                    <fixVersion>4.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15450960" author="kexinxie" created="Wed, 31 Aug 2016 03:38:59 +0000"  >&lt;p&gt;I have a fix in &lt;a href=&quot;https://github.com/apache/commons-math/pull/43&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-math/pull/43&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15451537" author="erans" created="Wed, 31 Aug 2016 08:10:47 +0000"  >&lt;p&gt;Having just looked at your proposed, I can&apos;t be sure that it fixes a potential bug in the computation.&lt;br/&gt;
The wrong value being so much larger than the expected 1, it seems quite possible that wrong results&lt;br/&gt;
could also be lower than 1, which your fix wouldn&apos;t fix.&lt;/p&gt;

&lt;p&gt;At first sight, it would be useful to test a whole range of values against the results provided by another implementation.&lt;/p&gt;</comment>
                            <comment id="15453154" author="kexinxie" created="Wed, 31 Aug 2016 19:33:45 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erans&quot; class=&quot;user-hover&quot; rel=&quot;erans&quot;&gt;erans&lt;/a&gt;, thanks for looking at the PR. I agree with you that this does seems like it&apos;s a dirty fix and mask a potential bug in the computation.&lt;/p&gt;

&lt;p&gt;However, the main problem here is that there is one corner case that the current algorithm did not consider. Which is that if the probability is large enough and the success is the same as the number of trials and both numbers are small enough, it will cause the &lt;tt&gt;criticalValueLow&lt;/tt&gt; to rise too quickly and be the same as &lt;tt&gt;criticalValueHigh&lt;/tt&gt;. The if condition in L138 is suppose to check the symmetry case when &lt;tt&gt;pLow == pHigh&lt;/tt&gt;, but is not for the case when &lt;tt&gt;criticalValueLow == criticalValueHigh&lt;/tt&gt;. At that point the probability will always jump to above 1, but it should really be 1 because &lt;tt&gt;criticalLow&lt;/tt&gt; is the same as &lt;tt&gt;criticalHigh&lt;/tt&gt; already (maybe I should return 1 there?).&lt;/p&gt;

&lt;p&gt;It may seem like a dirty fix, but I have checked against results in R, and Python&apos;s scipy equivalent, and they produce the same value. I implemented this way because it actually works in handling this boundary condition, and it&apos;s the least change to the original implementation. Note that Python&apos;s scipy also uses a similar approach to deal with estimated value rising above 1 &lt;a href=&quot;https://github.com/scipy/scipy/blob/v0.14.0/scipy/stats/morestats.py#L1661&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/scipy/scipy/blob/v0.14.0/scipy/stats/morestats.py#L1661&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve also updated the PR with more exhaustive test cases (with results cross checked with R and scipy), please have a look again. Also I think the current implementation is correct as explained above, but I&apos;m happy to change the estimation algorithm if that&apos;s required.&lt;/p&gt;</comment>
                            <comment id="15999737" author="kinow" created="Sun, 7 May 2017 08:47:17 +0000"  >&lt;p&gt;Agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erans&quot; class=&quot;user-hover&quot; rel=&quot;erans&quot;&gt;erans&lt;/a&gt; on spending some more time reviewing the current implementation.&lt;/p&gt;

&lt;p&gt;Today I spent some time reviewing distributions, binomial, and tests. Then looked at our BinomialTest, but still couldn&apos;t tell what was wrong. Then looked at other Java implementations, until stumbled across &lt;a href=&quot;https://github.com/Hipparchus-Math/hipparchus&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;hipparchus&lt;/a&gt;. Their BinomialTest implementation has an extra if, to check when both extreme values are equals.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/Hipparchus-Math/hipparchus/blob/ff26617bd14472fa84d70e8efe66c1177f952145/hipparchus-stat/src/main/java/org/hipparchus/stat/inference/BinomialTest.java#L131&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/Hipparchus-Math/hipparchus/blob/ff26617bd14472fa84d70e8efe66c1177f952145/hipparchus-stat/src/main/java/org/hipparchus/stat/inference/BinomialTest.java#L131&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The comment next to it says&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;One side can&apos;t move&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;And from our Javadocs:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The lower value is added to the p-Value (if both values are equal, both are added). Then we continue with the next extreme value, until we added the value for the actual observed sample.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Nothing obvious for me, but with that check, we get precisely 1.0 as p-value for the example reported in this issue.&lt;/p&gt;

&lt;p&gt;Added the pull request here: &lt;a href=&quot;https://github.com/apache/commons-math/pull/59&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-math/pull/59&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;But probably worth combining with the tests from &lt;a href=&quot;https://github.com/apache/commons-math/pull/43&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-math/pull/43&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Hope that helps&lt;br/&gt;
Bruno&lt;/p&gt;</comment>
                            <comment id="15999795" author="erans" created="Sun, 7 May 2017 11:26:25 +0000"  >&lt;p&gt;Hi Bruno.&lt;/p&gt;

&lt;p&gt;Thanks for your help.&lt;br/&gt;
But it&apos;s so sad that you had to spend time looking for clues about an &lt;a href=&quot;https://github.com/Hipparchus-Math/hipparchus/issues/9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;issue that was solved 9 months ago in the CM fork&lt;/a&gt;. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15999838" author="kinow" created="Sun, 7 May 2017 13:12:28 +0000"  >&lt;p&gt;Ooohh, makes sense, should have thought about looking at the issues. Nice catch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erans&quot; class=&quot;user-hover&quot; rel=&quot;erans&quot;&gt;erans&lt;/a&gt;. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kexinxie&quot; class=&quot;user-hover&quot; rel=&quot;kexinxie&quot;&gt;kexinxie&lt;/a&gt;, let&apos;s merge our pull requests? I think mine has the solution applied to that fork project. Yours has more test cases.&lt;/p&gt;

&lt;p&gt;Let me know if you prefer to update your pull request or mine in the next days. Feel free to copy the code changed and simply apply to yours if you&apos;d like &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Then we merge it and fix this issue.&lt;/p&gt;

&lt;p&gt;Cheers&lt;br/&gt;
Bruno&lt;/p&gt;</comment>
                            <comment id="15999938" author="kexinxie" created="Sun, 7 May 2017 16:49:34 +0000"  >&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kinow&quot; class=&quot;user-hover&quot; rel=&quot;kinow&quot;&gt;kinow&lt;/a&gt;! I&apos;ve updated &lt;a href=&quot;https://github.com/apache/commons-math/pull/43&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-math/pull/43&lt;/a&gt; to contain your changes.&lt;/p&gt;</comment>
                            <comment id="16000422" author="kinow" created="Mon, 8 May 2017 08:18:37 +0000"  >&lt;p&gt;Pull request looks good. Planning to merge the PR tomorrow. WDYT &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erans&quot; class=&quot;user-hover&quot; rel=&quot;erans&quot;&gt;erans&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="16000664" author="erans" created="Mon, 8 May 2017 12:26:28 +0000"  >&lt;p&gt;Please do! Thanks to both for your work on this.&lt;/p&gt;

&lt;p&gt;Refactoring/modularizing the &lt;tt&gt;o.a.c.m.stat&lt;/tt&gt; package would be a worthy goal IMHO.&lt;br/&gt;
A lot of work... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Unless I&apos;m mistaken, the bulk of the original CM code was comprised of the statistical utilities. It should have been named &quot;Commons Stat&quot; (to avoid open-ended extensions).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 27 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i310lb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>