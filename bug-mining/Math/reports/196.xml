<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:22:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-519] GaussianFitter Unexpectedly Throws NotStrictlyPositiveException</title>
                <link>https://issues.apache.org/jira/browse/MATH-519</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;Running the following:&lt;/p&gt;

&lt;p&gt;    	double[] observations = &lt;br/&gt;
    	&lt;/p&gt;
{ 
    			1.1143831578403364E-29, 
    			 4.95281403484594E-28, 
    			 1.1171347211930288E-26, 
    			 1.7044813962636277E-25, 
    			 1.9784716574832164E-24, 
    			 1.8630236407866774E-23, 
    			 1.4820532905097742E-22, 
    			 1.0241963854632831E-21, 
    			 6.275077366673128E-21, 
    			 3.461808994532493E-20, 
    			 1.7407124684715706E-19, 
    			 8.056687953553974E-19, 
    			 3.460193945992071E-18, 
    			 1.3883326374011525E-17, 
    			 5.233894983671116E-17, 
    			 1.8630791465263745E-16, 
    			 6.288759227922111E-16, 
    			 2.0204433920597856E-15, 
    			 6.198768938576155E-15, 
    			 1.821419346860626E-14, 
    			 5.139176445538471E-14, 
    			 1.3956427429045787E-13, 
    			 3.655705706448139E-13, 
    			 9.253753324779779E-13, 
    			 2.267636001476696E-12, 
    			 5.3880460095836855E-12, 
    			 1.2431632654852931E-11 
    	}
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;    	GaussianFitter g = &lt;br/&gt;
    		new GaussianFitter(new LevenbergMarquardtOptimizer());&lt;/p&gt;

&lt;p&gt;    	for (int index = 0; index &amp;lt; 27; index++)&lt;/p&gt;
    	{
    		g.addObservedPoint(index, observations[index]);
    	}
&lt;p&gt;       	g.fit();&lt;/p&gt;

&lt;p&gt;Results in:&lt;/p&gt;

&lt;p&gt;org.apache.commons.math.exception.NotStrictlyPositiveException: -1.277 is smaller than, or equal to, the minimum (0)&lt;br/&gt;
	at org.apache.commons.math.analysis.function.Gaussian$Parametric.validateParameters(Gaussian.java:184)&lt;br/&gt;
	at org.apache.commons.math.analysis.function.Gaussian$Parametric.value(Gaussian.java:129)&lt;/p&gt;


&lt;p&gt;I&apos;m guessing the initial guess for sigma is off.  &lt;/p&gt;</description>
                <environment></environment>
        <key id="12499105">MATH-519</key>
            <summary>GaussianFitter Unexpectedly Throws NotStrictlyPositiveException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ole">Ole Solberg</reporter>
                        <labels>
                    </labels>
                <created>Sat, 19 Feb 2011 04:37:44 +0000</created>
                <updated>Sat, 24 Mar 2012 16:16:27 +0000</updated>
                            <resolved>Tue, 22 Feb 2011 23:51:58 +0000</resolved>
                                    <version>3.0</version>
                                    <fixVersion>3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="14400">4h</timeoriginalestimate>
                            <timeestimate seconds="14400">4h</timeestimate>
                                        <comments>
                            <comment id="12996769" author="erans" created="Sat, 19 Feb 2011 12:28:41 +0000"  >&lt;p&gt;Will you investigate?&lt;br/&gt;
A good starting point would be to prepare a unit test.&lt;/p&gt;

&lt;p&gt;If it&apos;s indeed the guesser, we should add a check that the guessed sigma is positive (and, if not, return the opposite value).&lt;/p&gt;</comment>
                            <comment id="12996778" author="ole" created="Sat, 19 Feb 2011 13:48:45 +0000"  >&lt;p&gt;Yes I&apos;m going to start looking at it this weekend.&lt;/p&gt;</comment>
                            <comment id="12996822" author="ole" created="Sat, 19 Feb 2011 17:38:12 +0000"  >&lt;p&gt;Gilles - BTW - Did you ever figure out what was happening with this test in the ParametricGaussianFunction test:&lt;/p&gt;

&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The parameters d is 0.&lt;br/&gt;
     *&lt;/li&gt;
	&lt;li&gt;@throws MathUserException in the event of a test case error&lt;br/&gt;
     */&lt;br/&gt;
    @Test(expected=ZeroException.class)&lt;br/&gt;
    public void testValue03() throws MathUserException 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {        Gaussian.Parametric f = new Gaussian.Parametric();        f.value(0.0, new double[] {1.0, 1.0, 0.0});    }&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="12996826" author="ole" created="Sat, 19 Feb 2011 18:13:36 +0000"  >&lt;p&gt;It seems the optimizer is producing a negative value for sigma...&lt;/p&gt;</comment>
                            <comment id="12996833" author="ole" created="Sat, 19 Feb 2011 18:38:11 +0000"  >&lt;p&gt;I tried commenting out the validateParameters(param) line in Gaussian.value() and now it converges:&lt;/p&gt;

&lt;p&gt;Mean: 53.15727927329495&lt;br/&gt;
Sigma: 5.752146229144571&lt;/p&gt;</comment>
                            <comment id="12996900" author="erans" created="Sat, 19 Feb 2011 22:12:12 +0000"  >&lt;p&gt;I guess that the clean solution would be to be able to specify constraints such that the optimizer won&apos;t try invalid parameters.&lt;/p&gt;

&lt;p&gt;An ugly workaround would be that the &quot;CurveFitter&quot; internally catches all &quot;RuntimeException&quot;s generated by the function, and consider the residuals to be infinite. But this would violate the stated policy that CM does not catch &quot;MathUserException&quot;s (and could have nasty side-effects when the exception is really unexpected).&lt;/p&gt;

&lt;p&gt;I&apos;ve tried another workaround in &quot;GaussianFitter&quot; (see attached file) whereby an invalid parameter is turned into the function returning &quot;NaN&quot; (&quot;POSITIVE_INFINITY&quot; also works).&lt;br/&gt;
Let me know if you see any issues with this solution or if would be an adequate solution for this problem.&lt;/p&gt;</comment>
                            <comment id="12996933" author="ole" created="Sat, 19 Feb 2011 23:52:01 +0000"  >&lt;p&gt;I like the last option the best.  I&apos;m wondering though whether we are placing constraints on variables that are not supposed to be constrained?&lt;/p&gt;

&lt;p&gt;Perhaps the optimizer should be allowed to call a method on Gaussian that does not effectively constrain the valid values of sigma?&lt;/p&gt;
</comment>
                            <comment id="12997189" author="erans" created="Sun, 20 Feb 2011 18:42:40 +0000"  >&lt;p&gt;In the case of the Gaussian, that parameter (&quot;sigma&quot;) is used squared, so negative values don&apos;t really matter; however, the semantics of &quot;sigma&quot; calls for it to be non-negative.&lt;br/&gt;
But it certainly cannot be zero, so that&apos;s a constraint that cannot be removed.&lt;/p&gt;</comment>
                            <comment id="12997257" author="ole" created="Mon, 21 Feb 2011 01:53:47 +0000"  >&lt;p&gt;I think that while the optimizer is searching for a solution, it should be able to pass parameters that are not necessarily valid, but enable it to proceed.  If it finds a solution that is not valid, then an exception should be thrown. &lt;/p&gt;
</comment>
                            <comment id="12997260" author="erans" created="Mon, 21 Feb 2011 02:25:21 +0000"  >&lt;blockquote&gt;
&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt; pass parameters that are not necessarily valid &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What would that mean?&lt;br/&gt;
To direct its search, the optimizer needs feedback from the objective function; in case of invalid parameters, the objective function cannot provide feedback (i.e. compute the theoretical curve)!&lt;/p&gt;

&lt;p&gt;The only issue is how to &quot;tell&quot; the optimizer that it should discard invalid parameters (i.e. make it consider that they are far away from a solution).&lt;/p&gt;</comment>
                            <comment id="12997271" author="ole" created="Mon, 21 Feb 2011 04:01:13 +0000"  >&lt;p&gt;I&apos;m assuming that the value that results from passing in a negative sigma is closer to the optimal than POSITIVE infinity or NaN, and that this will result in faster convergence.  How about only returning Nan or POSITIVE_INFINITY if the optimizer passes in zero for sigma, but letting it proceed otherwise?&lt;/p&gt;

</comment>
                            <comment id="12997299" author="luc" created="Mon, 21 Feb 2011 08:27:20 +0000"  >&lt;p&gt;Maybe this discussion should be held on the dev list since it becomes long.&lt;br/&gt;
Anyway, returning NaN or POSITIVE_INFINITY would work only with some optimizers.&lt;br/&gt;
I guess a proper solution would be to have constrained optimization available (see &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-196&quot; title=&quot;add support to constrained parameter estimation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MATH-196&quot;&gt;&lt;del&gt;MATH-196&lt;/del&gt;&lt;/a&gt;).&lt;br/&gt;
For simple bounds on estimated parameters, this can be done using intermediate variables and mapping functions, but for general non-linear constraints, we need Lagrangian multipliers and all this stuff.&lt;/p&gt;</comment>
                            <comment id="12997370" author="erans" created="Mon, 21 Feb 2011 12:18:05 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I&apos;m assuming that the value that results from passing in a negative sigma is closer to the optimal than POSITIVE infinity or NaN &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;POSITIVE_INFINITY or NaN are the returned values of the objective function and its gradient, specially chosen because they are quite likely to be different from the actual values of the function and its gradient; it&apos;s not &quot;sigma&quot; that is assumed to infinity or NaN.&lt;/p&gt;

&lt;p&gt;If you think is that we can accept a negative sigma as the result of the fitting, I don&apos;t agree. In the case of the Gaussian, it&apos;s by &quot;chance&quot; that a semantically invalid parameter (negative sigma) would still be usable (as it is being squared before use).&lt;br/&gt;
In most case you cannot expect such a forgiving situation. For example, if you want to fit &quot;a&quot; in the following function:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  log(a * x)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;no invalid values for &quot;a&quot; are usable.&lt;br/&gt;
The &quot;Gaussian&quot; class should not be unsafe (no validation of sigma) just because of its particular use here.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;Moreover the workaround is useful in showing users how to setup a fitting of a function that can raise an exception.&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt; and that this will result in faster convergence.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Did you try?&lt;/p&gt;</comment>
                            <comment id="12997555" author="ole" created="Mon, 21 Feb 2011 20:21:13 +0000"  >&lt;p&gt;Yes!  I figured out how to quote!&lt;/p&gt;

&lt;p&gt;First of all I hope we are talking about this function:&lt;br/&gt;
&lt;a href=&quot;http://en.wikipedia.org/wiki/Gaussian_function&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://en.wikipedia.org/wiki/Gaussian_function&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As the objective function right?  If I got that wrong then ignore the below.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Anyway, returning NaN or POSITIVE_INFINITY would work only with some optimizers.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Seems to me that if the optimizer does not understand POSITIVE_INFINITY then that&apos;s a bug.  &lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;If you think is that we can accept a negative sigma as the result of the fitting...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No no no - Not at all.  I&apos;m saying that we should let the optimizer try negative values for sigma if it wants to while it&apos;s in the middle of trying to find the optimal sigma.  If it returns a negative sigma as a result, then we need to throw a NotStrictlyPositiveException.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Did you try?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I could give it a whirl, but it does not necessarily prove anything.  Even it it converges quicker, does that mean it will do so in all cases?  It just seems to me like POSITIVE_INFINITE is as far from the optimal as you can get, and therefore it will take longer to get to the optimal.&lt;/p&gt;

&lt;p&gt;Also, I changed my mind about an earlier comment.  If sigma is zero then the gaussian function is zero, so we should probably just return zero.&lt;/p&gt;</comment>
                            <comment id="12997586" author="erans" created="Mon, 21 Feb 2011 22:14:29 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I&apos;m saying that we should let the optimizer try negative values for sigma if it wants to while it&apos;s in the middle of trying to find the optimal sigma.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The point is that we cannot allow invalid parameters because, for those values (of the parameters), the objective function is, by definition of &quot;invalid&quot;, undefined.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt; Even it it converges quicker &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, actually it doesn&apos;t (cf. my mail on the &quot;dev&quot; ML).&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;It just seems to me like POSITIVE_INFINITE is as far from the optimal as you can get, &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Indeed, that&apos;s exactly the intention: it tells the optimizer to step back from this wrong value for sigma.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;Note that POSITIVE_INFINITY is not a value of sigma, it is the value of the objective function for any negative sigma.&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;If sigma is zero then the gaussian function is zero, &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No, when sigma is strictly zero, there is no Gaussian anymore: the value at &quot;b&quot; (mean) is undefined.&lt;br/&gt;
Also, cf. &lt;a href=&quot;http://en.wikipedia.org/wiki/Dirac_delta&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://en.wikipedia.org/wiki/Dirac_delta&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="12997595" author="ole" created="Mon, 21 Feb 2011 23:04:24 +0000"  >&lt;p&gt;OK - I see what you mean - I also get 17009 iterations with just the validate line commented out.  I&apos;m on board with POSITIVE_INFINITY.    &lt;/p&gt;</comment>
                            <comment id="12997699" author="luc" created="Tue, 22 Feb 2011 08:56:08 +0000"  >&lt;p&gt;If this works, go for it.&lt;/p&gt;</comment>
                            <comment id="12998107" author="erans" created="Tue, 22 Feb 2011 23:51:58 +0000"  >&lt;p&gt;Workaround in revision 1073554.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12471493" name="GaussianFitter.java" size="13211" author="erans" created="Sat, 19 Feb 2011 22:12:12 +0000"/>
                            <attachment id="12471478" name="GaussianFitter2Test.java" size="2900" author="ole" created="Sat, 19 Feb 2011 18:03:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>150635</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 39 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ru0f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160506</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>