<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:21:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-296] LoessInterpolator.smooth() not working correctly</title>
                <link>https://issues.apache.org/jira/browse/MATH-296</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;I have been comparing LoessInterpolator.smooth output with the loessFit output from R (R-project.org, probably the most widely used loess implementation) and have had strangely different numbers. I have created a small set to test the difference and something seems to be wrong with the smooth method but I do no know what and I do not understand the code.&lt;br/&gt;
&lt;b&gt;Example 1&lt;/b&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;x-input: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 3.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 6&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 8&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 12&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;13&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 22&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 24&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;28&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;31&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;y-input: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6.1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.4&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5.1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5.1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6.1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7.1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7.2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Output LoessInterpolator.smooth():&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;NaN&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;NaN&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;NaN&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;NaN&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;NaN&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;NaN&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;NaN&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;NaN&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;NaN&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;NaN&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Output from loessFit() from R: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.191178027520974&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.0407201231474037&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.7089538903778636&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.7450823274490297&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.388011000549519&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.60078952381848&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5.2988217587114805&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5.867536388457898&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6.7797794777879705&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7.444888598397342&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&lt;b&gt;Example 2 (same x-values, y-values just floored)&lt;/b&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;x-input: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 3.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 6&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 8&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 12&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;13&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 22&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 24&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;28&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;31&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;y-input: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Output LoessInterpolator.smooth(): &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.9999999999999005&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5.0000000000001705&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5.999999999999972&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6.999999999999967&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Output from loessFit() from R: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.091423927353068&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.9411521572524237&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.60967950675505&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.7421759322272248&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.382996912300442&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4.646774316632562&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5.225153658563424&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5.768301917477015&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6.637079139313073&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7.270482144410326&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;As you see the output is practically the replicated y-input.&lt;br/&gt;
At this point this funtionality is critical for us but I could not find any other suitable java-implementation. Help. Maybe this strange behaviour gives someone a clue?&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Java 1.6 on Vista&lt;/p&gt;</environment>
        <key id="12435875">MATH-296</key>
            <summary>LoessInterpolator.smooth() not working correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="romeop">Romeo P</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Sep 2009 21:14:20 +0000</created>
                <updated>Wed, 14 Apr 2010 00:18:11 +0000</updated>
                            <resolved>Tue, 26 Jan 2010 21:54:45 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12757189" author="luc" created="Fri, 18 Sep 2009 14:52:52 +0000"  >&lt;p&gt;What are your settings for bandwidth and robustness iterations ?&lt;br/&gt;
I have tried your examples and the first one doesn&apos;t lead to NaN with the default settings for me.&lt;/p&gt;</comment>
                            <comment id="12757216" author="romeop" created="Fri, 18 Sep 2009 15:54:31 +0000"  >&lt;p&gt;My settings are 0.3 and 4 (these are used as defaults in R). &lt;br/&gt;
If I use the standard values I still get:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.100000000000003&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6.099999999999999&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.0999999999999996&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;NaN&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;NaN&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;NaN&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;NaN&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;NaN&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7.1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7.85&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;Here is my test code for a quick look:&lt;/p&gt;

&lt;p&gt;public void testLoessInterpolator() throws MathException{&lt;br/&gt;
		dataX = new double&lt;span class=&quot;error&quot;&gt;&amp;#91;10&amp;#93;&lt;/span&gt;;&lt;br/&gt;
		dataX&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; = 1.5;&lt;br/&gt;
		dataX&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; = 3.0;&lt;br/&gt;
		dataX&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; = 6;&lt;br/&gt;
		dataX&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt; = 8;&lt;br/&gt;
		dataX&lt;span class=&quot;error&quot;&gt;&amp;#91;4&amp;#93;&lt;/span&gt; = 12;		&lt;br/&gt;
		dataX&lt;span class=&quot;error&quot;&gt;&amp;#91;5&amp;#93;&lt;/span&gt; = 13;&lt;br/&gt;
		dataX&lt;span class=&quot;error&quot;&gt;&amp;#91;6&amp;#93;&lt;/span&gt; = 22;&lt;br/&gt;
		dataX&lt;span class=&quot;error&quot;&gt;&amp;#91;7&amp;#93;&lt;/span&gt; = 24;&lt;br/&gt;
		dataX&lt;span class=&quot;error&quot;&gt;&amp;#91;8&amp;#93;&lt;/span&gt; = 28;&lt;br/&gt;
		dataX&lt;span class=&quot;error&quot;&gt;&amp;#91;9&amp;#93;&lt;/span&gt; = 31;&lt;/p&gt;


&lt;p&gt;		dataY = new double&lt;span class=&quot;error&quot;&gt;&amp;#91;10&amp;#93;&lt;/span&gt;;&lt;br/&gt;
		dataY&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; = 3.1;&lt;br/&gt;
		dataY&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; = 6.1;&lt;br/&gt;
		dataY&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; = 3.1;&lt;br/&gt;
		dataY&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt; = 2.1;&lt;br/&gt;
		dataY&lt;span class=&quot;error&quot;&gt;&amp;#91;4&amp;#93;&lt;/span&gt; = 1.4;		&lt;br/&gt;
		dataY&lt;span class=&quot;error&quot;&gt;&amp;#91;5&amp;#93;&lt;/span&gt; = 5.1;&lt;br/&gt;
		dataY&lt;span class=&quot;error&quot;&gt;&amp;#91;6&amp;#93;&lt;/span&gt; = 5.1;&lt;br/&gt;
		dataY&lt;span class=&quot;error&quot;&gt;&amp;#91;7&amp;#93;&lt;/span&gt; = 6.1;&lt;br/&gt;
		dataY&lt;span class=&quot;error&quot;&gt;&amp;#91;8&amp;#93;&lt;/span&gt; = 7.1;&lt;br/&gt;
		dataY&lt;span class=&quot;error&quot;&gt;&amp;#91;9&amp;#93;&lt;/span&gt; = 7.2;&lt;/p&gt;

&lt;p&gt;		LoessInterpolator li = new LoessInterpolator();&lt;br/&gt;
		double[] ly = li.smooth(dataX, dataY);&lt;/p&gt;

&lt;p&gt;		for (int i = 0; i &amp;lt; ly.length; i++) &lt;/p&gt;
{
			System.out.println(ly[i]);
		}
&lt;p&gt;		&lt;br/&gt;
	}&lt;/p&gt;

&lt;p&gt;Is there any obvious error which I do not see? Is it possible (although highely unlikely) that some java floating point operations are broken on Vista64 (which I am using)?&lt;br/&gt;
Can you show your results?&lt;/p&gt;</comment>
                            <comment id="12757338" author="luc" created="Fri, 18 Sep 2009 18:45:17 +0000"  >&lt;p&gt;OK. I reproduce exactly your results on a Linux computer with openJDK 1.6 on an AMD64 processor.&lt;br/&gt;
I&apos;ll have a look at this issue.&lt;/p&gt;</comment>
                            <comment id="12757396" author="luc" created="Fri, 18 Sep 2009 20:31:12 +0000"  >&lt;p&gt;The math-296-test.patch is a set of two test cases that reproduce the problem.&lt;/p&gt;

&lt;p&gt;Running the first test shows that at the end of iteration 0, the weights for points at indices 4 and 5 are set to 0. At iteration 1, when computing point i=4, the bandwidth is such that ileft=3 and iright=4. For k=3, we get w=0 because dist=4 and denom=1/4. For k=4 and k=5, we get w=0 because robustness&lt;span class=&quot;error&quot;&gt;&amp;#91;k&amp;#93;&lt;/span&gt;=0. So all w are 0, sumWeights=0 and since it is used in some divisions, NaN appears.&lt;/p&gt;

&lt;p&gt;I think their should be some protection against this case somewhere. I&apos;ll ask the author of the original contribution about this.&lt;/p&gt;</comment>
                            <comment id="12758165" author="jkff" created="Tue, 22 Sep 2009 07:49:22 +0000"  >&lt;p&gt;Thanks for reporting the problem, Romeo. Actually, I did not compare the results of my implementation with those of R&apos;s: I purely implemented the algorithm described in the paper, and checked that the results are sensible. Unfortunately I will most probably not have time to debug the issue until weekend, but I can provide explanations to you about the code in case the issue is so critical for you that you urge to fix it yourself &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12759203" author="romeop" created="Thu, 24 Sep 2009 18:22:55 +0000"  >&lt;p&gt;Eugene, that is great news. I already tried to fix it but did not get very far. &lt;br/&gt;
First of all, please ignore the sample values that are supposed to be from loessFit in the example above, they are not. I have reviewed my code and I can not reproduce those values. Sorry for that. When I try the examples again I get hardly any changes except for the NaN values (perhaps due to the fact that the values are not very close together?). The testcases should be deleted/changed to reflect this  I have compiled a more appropriate testcase:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;xval&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.3&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.4&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.5&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.6&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.7&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.8&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.9&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.3&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.4&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.5&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.6&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.7&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.8&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.9&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;yval&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.47&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.48&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.55&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.56&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.08&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.04&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.07&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.07&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.56&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.46&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.56&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.52&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-3.03&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-3.08&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-3.09&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-3.04&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.54&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.46&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.36&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.35&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;result&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.46076343001050907&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.49997135715509317&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.5429801876574236&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.3191000440696382&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.17824135321363765&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.03999999999999973&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.0699999999999999&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.21301261447145203&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.3260295715150817&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.45999999999999996&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.560000000000002&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-1.4961752602921834&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-2.1317826106042093&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-3.0799999999999965&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-3.089999999999987&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.6229499113916326&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.9970283360414918&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.450011252797152&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.3907474604481567&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.336774229999947&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;loessFit&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.4609008580907899&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.4985267031275769&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.5408291873645029&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.308077939113221&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.1754074466314782&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.0419929152622151&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.07205683451999362&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.19661654144034335&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.31073415047540565&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.44615854234427305&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.5567051673879394&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-1.4972970376332615&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-2.1330233520442317&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-3.08&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-3.0900000000000043&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.6208045742447532&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.9823842010251099&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.449395357814414&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.389793487936696&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.3359749840089385&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;weight(see below)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;loessFit with weights&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.4780117093745368&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.4924876444111407&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.48398021996388496&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.3201446090891406&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.17880078999161195&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.003305611690841502&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.08829472923805592&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.20902549447499932&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.3267558674057103&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.45542226638134214&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.518369970805548&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-0.5365908808969353&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-1.492628917733731&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-2.1151751796193703&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-3.09&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-3.0400000000000005&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-2.9899999999999998&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.15500000000000005&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.7524999999999986&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.3499999999999996&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;The results do not differ very much and there are no NaN, if the values are close together. Can this be explained by a slightly different algorithm in R?&lt;/p&gt;

&lt;p&gt;For easy copy and paste:&lt;br/&gt;
double[] yval=&lt;/p&gt;
{0.47, 0.48, 0.55, 0.56,-0.08,-0.04,-0.07,-0.07,-0.56,-0.46,-0.56,-0.52,-3.03,-3.08,-3.09,-3.04, 3.54, 3.46, 3.36, 3.35}
&lt;p&gt;;&lt;br/&gt;
double[] xval=&lt;/p&gt;
{0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 2.0}
&lt;p&gt;;&lt;br/&gt;
double[] weights = &lt;/p&gt;
{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1}
&lt;p&gt;;&lt;br/&gt;
LoessInterpolator li = new LoessInterpolator(0.3,4);&lt;br/&gt;
result = li.smooth(xval, yval);&lt;/p&gt;


&lt;p&gt;Another related thing. A very common use of the R-function is with weights (that is how we use it as well): &lt;br/&gt;
&lt;b&gt;loessFit(yValues, xValues, weights)&lt;/b&gt;&lt;br/&gt;
where weights are the values 0 or 1, I dont know if some are using weights between 0 and 1 &lt;br/&gt;
If a spot has weight 0 it still gets loessfitted but does not affect his neighbours. This way you can specifiy more relevant points and have the complete data set interpolate around these.&lt;/p&gt;

&lt;p&gt;In your implementation you use robustnessWeights and set them initially to 1. Do I understand this correctly that these are actually the same weights as the ones mentioned above?&lt;br/&gt;
Would it be possible to add a function with a third parameter and have the weights provided by the user? I tried just passing them trough as a parameter instead of initializing with 1 but it did not do the trick.&lt;/p&gt;</comment>
                            <comment id="12759623" author="jkff" created="Fri, 25 Sep 2009 16:56:11 +0000"  >&lt;p&gt;Romeo,&lt;br/&gt;
Here is a patch that implements the weighted loess fit (the results agree reasonably with R&apos;s implementation).&lt;br/&gt;
Also, the patch fixes some numeric instability by introducing an &apos;accuracy&apos; parameter.&lt;/p&gt;

&lt;p&gt;Luc,&lt;br/&gt;
Could you please review the patch and probably apply it?&lt;/p&gt;</comment>
                            <comment id="12759682" author="luc" created="Fri, 25 Sep 2009 18:35:08 +0000"  >&lt;p&gt;solved in subversion repository as of r818942.&lt;br/&gt;
patch applied with slight changes&lt;br/&gt;
thanks for the report and thanks for the patch&lt;/p&gt;</comment>
                            <comment id="12760030" author="romeop" created="Sun, 27 Sep 2009 14:12:39 +0000"  >&lt;p&gt;Eugene, Luc, thanks. Great news. I have been testing this with some bigger real-life datasets (~800 points) and the results seem to be very close to R).&lt;br/&gt;
There is one more problem though but I think I have already found the fix. You can still get NaN-results. &lt;br/&gt;
The reason is that sumWeights can become 0 and there are a couple of divisions with sumWeights. This multiplies to the degree that the complete result set is an array of NaN.&lt;br/&gt;
I think (but am not sure) that this happens if you have a long series of 0-weights which is bigger then the amount of points you get through the bandwidth.&lt;/p&gt;

&lt;p&gt;I have just added the following lines after these sumWeights divisions:&lt;br/&gt;
after: &lt;b&gt;double meanXSquared = sumXSquared / sumWeights;&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;                if(sumWeights==0)&lt;/p&gt;
{
                	meanX=0;
                	meanY=0;
                	meanXY=0;
                	meanXSquared=0;
                }
&lt;p&gt;That did the trick for me and the results seem accurate. I will test more during the next week with even more datasets. I hope I do not make any fundamental thinking error.&lt;/p&gt;

&lt;p&gt;If you think this is correct please add it to the code.&lt;/p&gt;</comment>
                            <comment id="12760921" author="jkff" created="Wed, 30 Sep 2009 14:25:04 +0000"  >&lt;p&gt;Romeo, I am not sure about whether this behavior should be considered correct. &lt;br/&gt;
It essentially means that there is no data inside an approximation window at all, so why should we make the data appear to be zero? &lt;br/&gt;
How about a variant &quot;express the approximation window in terms of the number of points with non-zero weights&quot;?&lt;/p&gt;</comment>
                            <comment id="12761022" author="romeop" created="Wed, 30 Sep 2009 22:13:24 +0000"  >&lt;p&gt;Sorry, maybe I was a little unclear in my explanation. &lt;br/&gt;
Actually there is data, there are just no weights in the approximation window. Lets say we have 300 point and the first 100 are weighted 0, the others are weighted 1, they are still valid data points. Being weighted 0 does not mean the data point can be deleted, it just means it does not affect his neighbours in terms of normalization (that is how the concept of normalization weights was explained to me)&lt;br/&gt;
What happens currently is the first ones become NaN and their neighbours become NaN to the point that &lt;b&gt;all&lt;/b&gt; points become NaN. This shouldn&apos;t happen.&lt;br/&gt;
But do not misunderstand me, I am just assuming that the reason is because of the bandwidth as my dataset has this structure, I am not really sure about it. &lt;br/&gt;
I have done some debugging on the code but there are really a lot of loops so I could not pinpoint when and why exactly this is starting to happen as it is not right from the beginning.&lt;/p&gt;</comment>
                            <comment id="12761237" author="jkff" created="Thu, 1 Oct 2009 15:00:27 +0000"  >&lt;p&gt;Romeo, have I understood you correctly that you&apos;d like the data points with zero weights to not influence the approximation &lt;b&gt;coefficients&lt;/b&gt; at all, but to still have computed approximation &lt;b&gt;values&lt;/b&gt; for them?&lt;/p&gt;</comment>
                            <comment id="12763126" author="romeop" created="Wed, 7 Oct 2009 16:58:56 +0000"  >&lt;p&gt;Yes. I think that is correct. No influence on the approximation coefficients but still getting normalized (getting approximation values). &lt;/p&gt;

&lt;p&gt;Here is an except from the userguide for the R-limma package, which uses the loessFit function for some operations:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Any spot quality weights found in RG will be used in the normalization by default. This means for example that spots with zero weight (flagged out) will not influence the normalization of other spots. The use of spot quality weights will not however result in any spots being removed from the data object. Even spots with zero weight will be normalized and will appear in the output object, such spots will simply not have any influence on the other spots.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;However I am not sure how to handle the bandwidth. Example: if you have a bandwidth of 0.3, how do you compute the relevant points?&lt;br/&gt;
1. Find the 30% in the complete set and the use only the weighted ones inside this set&lt;br/&gt;
2. Look at all weighted ones and use 30% of them&lt;/p&gt;

&lt;p&gt;To me the first one sounds like the logical one but I am not sure.&lt;/p&gt;</comment>
                            <comment id="12767886" author="jkff" created="Tue, 20 Oct 2009 17:45:19 +0000"  >&lt;p&gt;Sorry for the delay again: I just forgot about the issue. Don&apos;t hesitate to ping me, I am not a very organized person.&lt;/p&gt;

&lt;p&gt;Adding zero-weighted points &lt;b&gt;must not&lt;/b&gt; change the result in non-zero-weighted points and the approximation coefficients.&lt;br/&gt;
Thus, zero-weighted points must not participate in computing the bandwidth, and generally in computing anything at all: that is the &lt;b&gt;second&lt;/b&gt; approach.&lt;/p&gt;

&lt;p&gt;However, seems like R takes the &lt;b&gt;first&lt;/b&gt; one, because I&apos;ve implemented the second one and results disagreed with R on the testcase above.&lt;/p&gt;

&lt;p&gt;Are you OK with having a more logical implementation that disagrees with R? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12793869" author="psteitz" created="Wed, 23 Dec 2009 01:19:41 +0000"  >&lt;p&gt;Eugene&apos;s reasoning sounds correct to me.  I am inclined to say we document carefully and resolve this issue.  Any objections?&lt;/p&gt;</comment>
                            <comment id="12794171" author="luc" created="Wed, 23 Dec 2009 19:21:29 +0000"  >&lt;p&gt;I agree, but would like to know what R produces when a large (read larger than bandwidth) chunk of zero weights occurs.&lt;/p&gt;</comment>
                            <comment id="12804620" author="luc" created="Mon, 25 Jan 2010 18:07:44 +0000"  >&lt;p&gt;Coming back to this issue.&lt;br/&gt;
Eugene, as you said you implemented the second approach and people agree with your reasoning,&lt;br/&gt;
could you provide a patch using this second approach so we can apply it ?&lt;/p&gt;</comment>
                            <comment id="12805039" author="jkff" created="Tue, 26 Jan 2010 14:27:21 +0000"  >&lt;p&gt;Here is the patch.&lt;/p&gt;</comment>
                            <comment id="12805227" author="luc" created="Tue, 26 Jan 2010 21:54:45 +0000"  >&lt;p&gt;second patch applied as of r903440&lt;br/&gt;
thanks for the patch&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12431424" name="MATH-296.2.patch" size="7096" author="jkff" created="Tue, 26 Jan 2010 14:27:21 +0000"/>
                            <attachment id="12420070" name="math-296-test.patch" size="2192" author="luc" created="Fri, 18 Sep 2009 20:31:12 +0000"/>
                            <attachment id="12420572" name="math-296.patch" size="12945" author="jkff" created="Fri, 25 Sep 2009 16:56:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34191</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 43 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rvbz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160720</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>