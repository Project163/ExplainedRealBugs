<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:24:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-1092] NonLinearConjugateGradientOptimizer&apos;s Line search is a gradient search returns obviously suboptimal point.</title>
                <link>https://issues.apache.org/jira/browse/MATH-1092</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;In package : org.apache.commons.math3.optim.nonlinear.scalar.gradient&lt;/p&gt;

&lt;p&gt;In a minimization problem, a line search should not return a point where the value is greater than the values at the edges of the interval. The line search violates this obvious requirement by focusing solely on solving for gradient=0 and ignoring the value.&lt;/p&gt;

&lt;p&gt;Moreover LineSearchFunction is something that can be used in other contexts, so perhaps this should be a standalone class.&lt;/p&gt;


</description>
                <environment></environment>
        <key id="12690284">MATH-1092</key>
            <summary>NonLinearConjugateGradientOptimizer&apos;s Line search is a gradient search returns obviously suboptimal point.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ajo.fod">Ajo Fod</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Jan 2014 14:50:46 +0000</created>
                <updated>Mon, 19 May 2014 15:13:26 +0000</updated>
                            <resolved>Wed, 30 Apr 2014 22:18:42 +0000</resolved>
                                                    <fixVersion>3.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13914659" author="erans" created="Thu, 27 Feb 2014 15:37:56 +0000"  >&lt;p&gt;Here is a proposal to factor out the &quot;LineSearch&quot; defined in &quot;PowellOptimizer&quot;&lt;br/&gt;
(which uses &quot;BrentOptimizer&quot;).&lt;br/&gt;
When replacing what needed be in &quot;NonlinearConjugateGradientOptimizer&quot;, a series of unit test started to fail.&lt;br/&gt;
I&apos;ve performed some checks that the convergence criterion is indeed met even though the result found is now farther from the expected optimum.&lt;/p&gt;

&lt;p&gt;The change also uncovered that by using the root solver, the optimizer could not correctly count the evaluations (cf. &quot;MultiStartMultivariateOptimizerTest&quot;).&lt;/p&gt;</comment>
                            <comment id="13914671" author="luc" created="Thu, 27 Feb 2014 15:49:31 +0000"  >&lt;p&gt;LineSearch seems to be missing in the patch.&lt;/p&gt;</comment>
                            <comment id="13914689" author="erans" created="Thu, 27 Feb 2014 16:08:19 +0000"  >&lt;p&gt;Oops...&lt;/p&gt;</comment>
                            <comment id="13914704" author="luc" created="Thu, 27 Feb 2014 16:29:51 +0000"  >&lt;p&gt;This seems good to me.&lt;/p&gt;

&lt;p&gt;The missing function evaluations count is probably due to the GradientMultivariateOptimizer.computeObjectiveGradient method,&lt;br/&gt;
which lacks a call to incrementEvaluationCount() which is used for example in MultivariateOptimizer.computeObjectiveValue.&lt;/p&gt;

&lt;p&gt;I don&apos;t remember if this was intentional or not. Both computeObjectiveValue and computeObjectiveGradient are called in NonLinearConjugateGradientOptimizer.doOptimize, and computeObjectiveGradient was also called (and was the only function called)&lt;br/&gt;
for the initial gradient-based line search. So we should probably also call incrementEvaluationCount for computeObjectiveGradient, and&lt;br/&gt;
this will probably increase even more the total number of calls.&lt;/p&gt;</comment>
                            <comment id="13914723" author="erans" created="Thu, 27 Feb 2014 16:49:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;The missing function evaluations count is probably due to the GradientMultivariateOptimizer.computeObjectiveGradient method, &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Oh, yes, you are right; I overlooked the &quot;Gradient&quot; part of the name...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I don&apos;t remember if this was intentional or not.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I recall that we indeed decided not to count the calls to that method.&lt;/p&gt;

&lt;p&gt;Anyway the &quot;computeObjectiveGradient&quot; is not called anymore in the new line search.&lt;br/&gt;
Is that OK?  I mean: Can the class still be considered a &quot;standard&quot; implementation of the algorithm?&lt;/p&gt;</comment>
                            <comment id="13914763" author="bjohnson" created="Thu, 27 Feb 2014 17:28:34 +0000"  >&lt;p&gt;There is a good discussion in Numerical Recipes on using gradients in a line minimization (the conclusion being basically to use them very judiciously, for example to figure out what side of the interval to search in).  Since we have gradients available there might be some advantage in optionally using them in the line minimization).  For now, I&apos;m quite happy that with your fix the line minimizer should never return a point with a higher value than the starting point (assuming we&apos;re doing minimization rather than maximization).&lt;/p&gt;
</comment>
                            <comment id="13915970" author="erans" created="Fri, 28 Feb 2014 16:45:33 +0000"  >&lt;p&gt;Code updated in revision 1572988.&lt;br/&gt;
Could please check that it fixes your issue?&lt;/p&gt;</comment>
                            <comment id="13915998" author="bjohnson" created="Fri, 28 Feb 2014 16:58:43 +0000"  >&lt;p&gt;I&apos;ve downloaded 3.3 snapshot with svn and switched my code to use it.  Right now there seems to be a change elsewhere in 3.3 that is causing a problem before I get to my use of NonLinearConjugateGradientOptimizer.  Trying to figure out now what the problem is.&lt;/p&gt;</comment>
                            <comment id="13917206" author="bjohnson" created="Sat, 1 Mar 2014 22:08:34 +0000"  >&lt;p&gt;The new line search works, but I think it needs one change.  The old version used a BracketingStep parameter to set the initial search size.  That is not used in the new LineSearch code, which has a hard-coded an upper limit of 1:&lt;br/&gt;
        bracket.search(f, goal, 0, 1);&lt;/p&gt;

&lt;p&gt;For my optimization problem I find (with both the old and new code) I need a much smaller upper limit (1.0e-5 for example).  Otherwise the minimum found isn&apos;t as good.  So I think it would be important to pass the BracketingStep parameter into the new new LineSearch code.&lt;/p&gt;</comment>
                            <comment id="13917536" author="erans" created="Sun, 2 Mar 2014 19:39:01 +0000"  >&lt;p&gt;Parameter added (revision 1573316).&lt;/p&gt;

&lt;p&gt;However, I&apos;m worried that some unit tests for &quot;PowellOptimizer&quot; fail when this parameter is set to a small value (1e-8). Thus, for &quot;PowellOptimizer&quot;, I&apos;ve hard-coded the value to 1 so that the previous behaviour is retained.&lt;br/&gt;
Maybe there is an interpendence between this value and the other parameters of &quot;BracketFinder&quot;.&lt;/p&gt;

&lt;p&gt;In your problem, are there oscillations in the vicinity of the optimum?&lt;br/&gt;
It is difficult for me to figure out to the appropriate improvements without a unit test.&lt;/p&gt;</comment>
                            <comment id="13917559" author="bjohnson" created="Sun, 2 Mar 2014 21:11:24 +0000"  >&lt;p&gt;Couldn&apos;t we have another constructor that takes a fourth argument (the initial upper limit for the bracket search).  The current constructor could default to 1.0 for that value so existing tests would pass.&lt;/p&gt;

&lt;p&gt;The problem I&apos;m working on is the energy minimization of a complex molecule.  I&apos;m sure there are many local minima and if the bracket is too large it finds a minimum that is not as good as one near the origin of the search.  So it seems essential to be able to specify the size of the search region. (As an aside, I use the CMAESOptimizer to initially search in this complex landscape, but (when I can use gradients) the ConjugateGradientOptimizer is useful to quickly refine the solution. &lt;/p&gt;</comment>
                            <comment id="13917563" author="bjohnson" created="Sun, 2 Mar 2014 21:14:09 +0000"  >&lt;p&gt;I&apos;m referring to the constructor for the new LineSearch class.&lt;/p&gt;</comment>
                            <comment id="13917592" author="erans" created="Sun, 2 Mar 2014 22:42:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;Couldn&apos;t we have another constructor &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt; &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Why another constructor?&lt;br/&gt;
&quot;PowellOptimizer&quot; does use 1 for the parameter.&lt;/p&gt;

&lt;p&gt;We should have units tests for &quot;LineSearch&quot;. It could help to understand what is going on as the initial step gets smaller.&lt;/p&gt;</comment>
                            <comment id="13917636" author="bjohnson" created="Mon, 3 Mar 2014 00:13:09 +0000"  >&lt;p&gt;Another constructor so one could do:&lt;/p&gt;

&lt;p&gt;        line = new LineSearch(this, relativeTolerance,  absoluteTolerance,initialStep);&lt;/p&gt;

&lt;p&gt;where initialStep is the value set with BracketingStep in NonLinearConjugateGradientOptimizer&lt;/p&gt;

&lt;p&gt;I presume the BracketingStep parameter was added for a reason to NonLinearConjugateGradientOptimizer, but we&apos;ve lost this capability in the new code.  Setting a smaller initial step (than 1.0) is clearly necessary for actual use of my application, but I&apos;m not sure I can easily represent this need in a unit test case.&lt;/p&gt;</comment>
                            <comment id="13917701" author="erans" created="Mon, 3 Mar 2014 02:45:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;line = new LineSearch(this, relativeTolerance, absoluteTolerance,initialStep);&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;But this is indeed what I did in revision 1573316 (as advertized a couple comments above)...&lt;/p&gt;</comment>
                            <comment id="13917702" author="bjohnson" created="Mon, 3 Mar 2014 02:54:28 +0000"  >&lt;p&gt;Aaaah, I missed that you actually added this.  Thanks!.&lt;/p&gt;</comment>
                            <comment id="14001813" author="luc" created="Mon, 19 May 2014 15:13:26 +0000"  >&lt;p&gt;Closing all resolved issue now available in released 3.3 version.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12631553" name="MATH-1092.patch" size="23569" author="erans" created="Thu, 27 Feb 2014 16:08:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>369237</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 26 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1rn33:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>369542</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>