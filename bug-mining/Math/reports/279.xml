<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:22:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-724] RandomDataImpl.nextInt does not distribute uniformly for negative lower bound</title>
                <link>https://issues.apache.org/jira/browse/MATH-724</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;When using the RandomDataImpl.nextInt function to get a uniform sample in a &lt;span class=&quot;error&quot;&gt;&amp;#91;lower, upper&amp;#93;&lt;/span&gt; interval, when the lower value is less than zero, the output is not uniformly distributed, as the lowest value is practically never returned.&lt;/p&gt;

&lt;p&gt;See the attached NextIntUniformTest.java file. It uses a &lt;span class=&quot;error&quot;&gt;&amp;#91;-3, 5&amp;#93;&lt;/span&gt; interval. For several values between 0 and 1, testNextIntUniform1 prints the return value of RandomDataImpl.nextInt (as double and as int). We see that -2 through 5 are returned several times. The -3 value however, is only returned for 0.0, and is thus under-respresented in the integer samples. The output of test method testNextIntUniform2 also clearly shows that value -3 is never sampled.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12534797">MATH-724</key>
            <summary>RandomDataImpl.nextInt does not distribute uniformly for negative lower bound</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dhendriks">Dennis Hendriks</reporter>
                        <labels>
                    </labels>
                <created>Mon, 12 Dec 2011 15:03:41 +0000</created>
                <updated>Sat, 24 Mar 2012 16:16:27 +0000</updated>
                            <resolved>Tue, 20 Dec 2011 21:14:16 +0000</resolved>
                                    <version>1.0</version>
                    <version>1.1</version>
                    <version>1.2</version>
                    <version>2.0</version>
                    <version>2.1</version>
                    <version>2.2</version>
                                    <fixVersion>3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13167518" author="dhendriks" created="Mon, 12 Dec 2011 15:04:41 +0000"  >&lt;p&gt;NextIntUniformTest.java: see issue description&lt;/p&gt;</comment>
                            <comment id="13167594" author="psteitz" created="Mon, 12 Dec 2011 16:49:17 +0000"  >&lt;p&gt;Thanks for reporting this. The problem is in the rounding, which does not work correctly for negative values.  My first inclination is to test for negative lower bound and just shift the interval in that case.  Any better ideas?&lt;/p&gt;</comment>
                            <comment id="13168218" author="dhendriks" created="Tue, 13 Dec 2011 08:23:11 +0000"  >&lt;p&gt;math-724.patch: it first scales the [0..1) interval to [0..length), then discretizes it, and finally shifts it to &lt;span class=&quot;error&quot;&gt;&amp;#91;lower, upper&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;It may be a good idea to also add some tests for cases such as &lt;span class=&quot;error&quot;&gt;&amp;#91;0,3&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;3,5&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;-3,5&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;-5, -3&amp;#93;&lt;/span&gt;, and see if the distribution of sampled values is uniform. It seems RandomDataTest.testNextInt does this using chiSquare, but since I&apos;m not familiar with that, I&apos;m not sure how to add more tests for the other lower/upper bound pairs...&lt;/p&gt;</comment>
                            <comment id="13168225" author="dhendriks" created="Tue, 13 Dec 2011 08:33:52 +0000"  >&lt;p&gt;I just ran the unit tests with my patch applied, an the following test, in RandomDataTest:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testNextIntExtremeValues() {
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; x = randomData.nextInt(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.MIN_VALUE, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.MAX_VALUE);
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; y = randomData.nextInt(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.MIN_VALUE, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.MAX_VALUE);
        Assert.assertFalse(x == y);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;fails, as does testNextLongExtremeValues. Both x and y become equal to Integer.MIN_VALUE, making x == y to become true, causing the assertion to fail...&lt;/p&gt;</comment>
                            <comment id="13168249" author="dhendriks" created="Tue, 13 Dec 2011 09:14:05 +0000"  >&lt;p&gt;Also note that RandomDataImpl.nextUniform uses a similar scale/shift method to transform the range. It may thus suffer from the same failure in case of extreme values...&lt;/p&gt;</comment>
                            <comment id="13169384" author="dhendriks" created="Wed, 14 Dec 2011 14:16:39 +0000"  >&lt;p&gt;math-724-v2.patch: 2nd patch.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I think all unit tests work now, including the ones for the Integer.MIN_VALUE to Integer.MAX_VALUE interval.&lt;/li&gt;
	&lt;li&gt;The original problem was that negative values were rounded up by the conversion from double to int, while positive numbers were rounded down. By using floor, we first round the numbers down, and then convert to integer, thus ensuring a proper uniform distribution.&lt;/li&gt;
	&lt;li&gt;Test cases for negative values are still missing... Could someone else add them?&lt;/li&gt;
	&lt;li&gt;RandomDataImpl.nextUniform: I haven&apos;t changed this, as the change that I used for integers does not have the desired effect for doubles... This may be caused by the fact that Double.MIN_VALUE is more negative than Double.MAX_VALUE is positive, but I&apos;m not really sure. Maybe it is not even an issue for the nextUniform method?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13169406" author="erans" created="Wed, 14 Dec 2011 14:41:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt; the fact that Double.MIN_VALUE is more negative &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;http://docs.oracle.com/javase/6/docs/api/java/lang/Double.html#MIN_VALUE&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Double.Min_VALUE&lt;/a&gt; is a &lt;em&gt;positive&lt;/em&gt; number.&lt;/p&gt;</comment>
                            <comment id="13170025" author="dhendriks" created="Thu, 15 Dec 2011 08:23:17 +0000"  >&lt;blockquote&gt;&lt;p&gt;Double.Min_VALUE is a positive number.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Oops...&lt;/p&gt;

&lt;p&gt;OK, I uploaded a third version of the patch (math-724-v3.patch), which also applies the new formula for nextUniform. I included two test files (NextUniformTest3.java and NextIntTest3.java), that show the results for nextInt and nextUniform, for both the old and new formulas. As for as I can see, the new formula works equally well or better in all cases. Also, all existing unit tests pass.&lt;/p&gt;</comment>
                            <comment id="13173508" author="psteitz" created="Tue, 20 Dec 2011 21:14:16 +0000"  >&lt;p&gt;Thanks for reporting and diagnosing this, Dennis.&lt;/p&gt;

&lt;p&gt;Slightly modified version of the third patch (just removing unecessary parens), along with tests, committed in r1221490.  The &quot;negativeToPositiveRange&quot; tests fail before the fix.  The change to nextUniform is also needed to prevent overflows. I changed the relevant test cases to use the TestUtils chisquare test, which is more straightforward and has better output.  This was added after the original versions of these tests were written.  Others in this class should be similarly updated.  Patches welcome to further tidy the tests, but this issue can be resolved.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12507485" name="NextIntTest3.java" size="5847" author="dhendriks" created="Thu, 15 Dec 2011 08:23:17 +0000"/>
                            <attachment id="12507005" name="NextIntUniformTest.java" size="2779" author="dhendriks" created="Mon, 12 Dec 2011 15:04:41 +0000"/>
                            <attachment id="12507486" name="NextUniformTest3.java" size="5778" author="dhendriks" created="Thu, 15 Dec 2011 08:23:17 +0000"/>
                            <attachment id="12507355" name="math-724-v2.patch" size="1754" author="dhendriks" created="Wed, 14 Dec 2011 14:16:39 +0000"/>
                            <attachment id="12507487" name="math-724-v3.patch" size="1942" author="dhendriks" created="Thu, 15 Dec 2011 08:23:17 +0000"/>
                            <attachment id="12507147" name="math-724.patch" size="1532" author="dhendriks" created="Tue, 13 Dec 2011 08:23:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>220481</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 48 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0aopj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>60276</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>