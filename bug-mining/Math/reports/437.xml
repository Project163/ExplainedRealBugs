<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:24:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-1056] Small error in PoissonDistribution.nextPoisson() algorithm</title>
                <link>https://issues.apache.org/jira/browse/MATH-1056</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;Here&apos;s a tiny bug I noticed via static inspection, since it flagged the integer division. PoissonDistribution.java:325 says:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; a1 = FastMath.sqrt(FastMath.PI * twolpd) * FastMath.exp(1 / 8 * lambda);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &quot;1 / 8 * lambda&quot; is evidently incorrect, since this will always evaluate to 0. I rechecked the original algorithm (&lt;a href=&quot;http://luc.devroye.org/devroye-poisson.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://luc.devroye.org/devroye-poisson.pdf&lt;/a&gt;) and it should instead be:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; a1 = FastMath.sqrt(FastMath.PI * twolpd) * FastMath.exp(1 / (8 * lambda));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(lambda is a double so there is no int division issue.) This matches a later expression.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure how to evaluate the effect of the bug. Better to be correct of course; it may never have made much practical difference.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12677275">MATH-1056</key>
            <summary>Small error in PoissonDistribution.nextPoisson() algorithm</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="srowen">Sean R. Owen</reporter>
                        <labels>
                    </labels>
                <created>Sun, 3 Nov 2013 14:19:18 +0000</created>
                <updated>Mon, 19 May 2014 15:13:23 +0000</updated>
                            <resolved>Fri, 8 Nov 2013 23:31:45 +0000</resolved>
                                    <version>3.2</version>
                                    <fixVersion>3.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13812501" author="psteitz" created="Sun, 3 Nov 2013 21:37:53 +0000"  >&lt;p&gt;Good catch, Sean!   I played a little with this today to see if fixing it allowed me to increase sensitivity in the nextPossionConsistency test in RandomDataGeneratorTest.  I did not succeed, which is unfortunate as this definitely looks like a bug.  I am +1 for committing the patch, but would really like to get a test that fails before and succeeds after.&lt;/p&gt;

&lt;p&gt;The nextPossionConsistency test is a ChiSquare-based test that looks at the binned distribution of values generated by nextPoission (which is now implemented in the distribution class itself).  When the test was developed, we had not yet implemented the G test, which may work better for homogeneity testing in this kind of setting.  It might be interesting to experiment with G tests to get a pre/post fail/fix here.  Another thing to dig into is exactly what generated values for what means will be materially impacted by the bug.  That might allow us to set up a specific G or Chi-square test that will consistently fail.&lt;/p&gt;</comment>
                            <comment id="13817394" author="tn" created="Fri, 8 Nov 2013 16:13:37 +0000"  >&lt;p&gt;I did take a look at this myself, and the introduced error is so small that it is very difficult to make a reasonable test that outlines this.&lt;/p&gt;

&lt;p&gt;Due to the fact that the wrong code is only executed when a PoissonDistribution with mean &amp;gt;= 40 is used, the error is &amp;lt;= 3e-3. Now when looking at the iteration that constructs the sample, it looks at random numbers [0, 1) and does different things dependent on whether the random number is smaller or larger than some of these pre-computed values. I did not do further analysis of the expected failure from such a small difference, but it must be &lt;b&gt;very&lt;/b&gt; small compared to an ideal poisson distribution.&lt;/p&gt;

&lt;p&gt;btw. we have there several variables that are calculated each time nextPoisson() is called, although they are fixed with the given mean (which is immutable for the distribution), thus could be cached to improve performance.&lt;/p&gt;</comment>
                            <comment id="13817842" author="psteitz" created="Fri, 8 Nov 2013 23:31:45 +0000"  >&lt;p&gt;Patch applied in r1540217.  I have still not been able to produce a test case showing real impact; but the pre-patch code clearly departs from the intent of the algorithm, so best to fix.&lt;/p&gt;</comment>
                            <comment id="13817864" author="psteitz" created="Fri, 8 Nov 2013 23:49:34 +0000"  >&lt;p&gt;Forgot to respond to Thomas&apos; observation about repeat computations.  The problem is that the actual parameter to nextPoisson can&apos;t be eliminated, i.e., it is not always the mean. nextPoisson is (conditionally) called recursively by itself when computing y2 with actual parameter lambdaFractional.  That means all of the variables set at the beginning need to be recomputed in that case.  I guess we could test the actual parameter value against the mean and used cached values in that case, but that would make the code a little harder to follow.&lt;/p&gt;</comment>
                            <comment id="13818061" author="tn" created="Sat, 9 Nov 2013 07:35:34 +0000"  >&lt;p&gt;But lambdaFractional is always in the range [0, 1) thus your recursive call will just once the other part of the conditional.&lt;/p&gt;

&lt;p&gt;nextPoisson(mean) is only called from the sample method, and we could make a nextPoisson() method that decides to call either nextPoissonSmallMean or LargeMean depending on the actual mean value. nextPoissonLargeMean itself calls SmallMean for the fractional part.&lt;/p&gt;</comment>
                            <comment id="13818278" author="psteitz" created="Sat, 9 Nov 2013 21:37:45 +0000"  >&lt;p&gt;I see.  Would slightly complicate the code for I am not sure how much benefit, but might be worth doing.  Probably best to open a separate ticket for this.&lt;/p&gt;</comment>
                            <comment id="14001794" author="luc" created="Mon, 19 May 2014 15:13:23 +0000"  >&lt;p&gt;Closing all resolved issue now available in released 3.3 version.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12611822" name="MATH-1056.patch" size="1365" author="srowen" created="Sun, 3 Nov 2013 14:20:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>356650</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 26 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1phfz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>356940</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>