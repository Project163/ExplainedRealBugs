<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:25:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-1549] Simplex solver report unbounded solution when solvable constraints scaling up</title>
                <link>https://issues.apache.org/jira/browse/MATH-1549</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;&lt;b&gt;scenario 1:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
min: x + y
x, y &amp;gt;= 0
9000x + y &amp;gt;= 0
10000x + y &amp;gt;= 2000
x &amp;gt;= 2&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;scenario 2:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
min: x + y
x, y &amp;gt;= 0
9.0E15x + 1.0E12y &amp;gt;= 0
1.1e16x + 1.0e12y &amp;gt;= 2.0e15
1.0e12x &amp;gt;= 2e12&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;for scenario 1, it works out. but for scenario 2 whose constrains are just scaled up by 1e12, the solver reports unbounded solution.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;macOS catalina&lt;/p&gt;</environment>
        <key id="13316606">MATH-1549</key>
            <summary>Simplex solver report unbounded solution when solvable constraints scaling up</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="fanfzzhang">Fan Zhang</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Jul 2020 04:12:24 +0000</created>
                <updated>Tue, 21 Jul 2020 20:19:21 +0000</updated>
                            <resolved>Tue, 21 Jul 2020 18:26:49 +0000</resolved>
                                    <version>3.6.1</version>
                                    <fixVersion>4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4200">1h 10m</timespent>
                                <comments>
                            <comment id="17157342" author="erans" created="Tue, 14 Jul 2020 12:55:56 +0000"  >&lt;p&gt;Thanks for the report.&lt;br/&gt;
Test added in &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=commons-math.git;a=commit;h=4108f5f35e22db3401a11fbbf93f85be21394f5c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;commit 4108f5f35e22db3401a11fbbf93f85be21394f5c&lt;/a&gt;.&lt;br/&gt;
By adapting the test to figure out when the bug shows up, it appeared that a different type of exception is raised for smaller values of the scaling factor.&lt;/p&gt;

&lt;p&gt;Help is welcome in order to determine the cause of the issue. &lt;br/&gt;
It seems it could be a usage issue: Can the argument to the &lt;tt&gt;SimplexSolver&lt;/tt&gt; instance remain the same, whatever the scale of the numbers involved in the definition of the problem to solve?&lt;br/&gt;
The bug could then be in the code or in the failing to document some limitation of the algorithm (e.g. due to floating-point inaccuracies in parts of the computation).&lt;/p&gt;</comment>
                            <comment id="17157801" author="fanfzzhang" created="Wed, 15 Jul 2020 01:41:48 +0000"  >&lt;p&gt;We use the default arguments to the solver. This is a reasonably simple problem with a solution at a corner: x = 2, y = 0. More specifically, for the test the value of x is expected to be between 2*scale/scale and 2*scale/scale+ epsilon. where 2*scale/scale should take care of any floating point issues and the epsilon argument of the solver should be respected.&lt;/p&gt;</comment>
                            <comment id="17157831" author="erans" created="Wed, 15 Jul 2020 02:55:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;solution at a corner: x = 2, y = 0&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The unit test shows that this solution is found when the &quot;scale&quot; parameter is smaller than 1e5.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;value of x is expected to be between 2*scale/scale and 2*scale/scale+ epsilon&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t understand the bounds referred to above (since 2*scale/scale = 2).&lt;/p&gt;</comment>
                            <comment id="17160719" author="erans" created="Sun, 19 Jul 2020 15:31:55 +0000"  >&lt;p&gt;There is a &lt;a href=&quot;https://github.com/apache/commons-math/pull/155&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt; that fixes the issue but it misses Javadoc on some of the methods.&lt;br/&gt;
I stress again that I cannot interact/comment on GitHub in order to converge to a set of modifications that I feel confident to commit.&lt;/p&gt;</comment>
                            <comment id="17160726" author="erans" created="Sun, 19 Jul 2020 16:18:35 +0000"  >&lt;p&gt;Thanks for confirming that the problem stems from floating-point accuracy!&lt;/p&gt;

&lt;p&gt;However, among the possible improvements (see &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-1550&quot; title=&quot;SimplexTableau (linear programming)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MATH-1550&quot;&gt;MATH-1550&lt;/a&gt;), could we perhaps redesign the representation of the input data (to &lt;tt&gt;SimplexTableau&lt;/tt&gt; and &lt;tt&gt;SimplexSolver&lt;/tt&gt;) so that the scaling can be performed on that,&#160;&lt;b&gt;prior&lt;/b&gt; to the solving itself?&#160; &lt;span class=&quot;error&quot;&gt;&amp;#91;IMHO, that would prevent making the code even more complex than it is already.&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17160875" author="mohrezaei" created="Mon, 20 Jul 2020 04:06:11 +0000"  >&lt;p&gt;(Sorry, I didn&apos;t realize Github was not part of your workflow). Can we discuss the changes here?&lt;/p&gt;

&lt;p&gt;I replied on &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-1550&quot; title=&quot;SimplexTableau (linear programming)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MATH-1550&quot;&gt;MATH-1550&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Let me explain the rationale for the placing of the code changes:&lt;/p&gt;

&lt;p&gt;I initially tried to just deal with LinearConstraint. It was difficult and ultimately futile because we also need the objective coefficients. The whole setup with constraints is very copy heavy. On typical usage, this happens:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Application code creates a double array for each constraint.&lt;/li&gt;
	&lt;li&gt;The constraint copies that array into a vector. (My personal impression is that these vectors are hard to work with.)&lt;/li&gt;
	&lt;li&gt;The tableau setup code copies the vector back out into an array.&lt;/li&gt;
	&lt;li&gt;The tableau then copies the array into its own matrix (another array).&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;So I figured I&apos;d rather not add another copy into that. Many realistic problems have 1000&apos;s even 100&apos;s of thousands of variables and copying all this stuff around is not good for anything.&lt;/p&gt;

&lt;p&gt;I chose to insert the work between steps 3 and 4 for two reasons:&lt;/p&gt;

&lt;p&gt;a. I had all the data I needed (all constraints and the objective coefficients) in one place.&lt;/p&gt;

&lt;p&gt;b. I could do the work without an extra copy.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;m not quite sure how you see SimplexTableau changing. If there is anything I can do to the PR to make it acceptable, I&apos;ll be happy to do it.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17161106" author="erans" created="Mon, 20 Jul 2020 10:11:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;My personal impression is that these vectors are hard to work with.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Could you elaborate? &lt;span class=&quot;error&quot;&gt;&amp;#91;Maybe that&amp;#39;s something we could/should fix.&amp;#93;&lt;/span&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I figured I&apos;d rather not add another copy into that.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I understand. However, in-place changes should be especially well documented and, IMO, we should avoid them by default (i.e. until proven necessary).&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;copying all this stuff around is not good for anything.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sure. There is a balance to be found (copying in Java is not nearly as bad as in C and sometimes an extra copy even provides a performance boost!).&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I&apos;m not quite sure how you see SimplexTableau changing.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The basic idea would be to perform the tasks that need mutability within the constructor (or in private methods that return the final values to be assigned to the instance fields).&lt;br/&gt;
 If/when the tableau must be changed, a new instance would be created (e.g. as is done at &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=commons-math.git;a=blob;f=src/main/java/org/apache/commons/math4/optim/linear/SimplexTableau.java;h=15a84819b2eb8ede0914d939d89c2f79bdb7caf3;hb=HEAD#l433&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this line&lt;/a&gt; anyways), from current input. IMHO, this would greatly simplify the code, allowing further improvements to be safely implemented.&lt;/p&gt;</comment>
                            <comment id="17161119" author="erans" created="Mon, 20 Jul 2020 10:24:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;If there is anything I can do to the PR to make it acceptable, I&apos;ll be happy to do it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks a lot for fixing the issue.&lt;br/&gt;
Could you please add the missing Javadoc: All methods (including &quot;private&quot; ones) must be fully documented.  &lt;span class=&quot;error&quot;&gt;&amp;#91;Unless I&amp;#39;m mistaken, I think that newer &amp;quot;Commons&amp;quot; components would even fail the build when that&amp;#39;s not the case.&amp;#93;&lt;/span&gt;&lt;br/&gt;
There are also a few nits with the code style:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;space after &quot;for&quot; (in &quot;for&quot; loops),&lt;/li&gt;
	&lt;li&gt;one condition per line (in condition checks),&lt;/li&gt;
	&lt;li&gt;no &quot;magic&quot; numbers within the methods: &quot;1023&quot; and &quot;10000&quot; must be declared as &quot;final static&quot; fields,&lt;/li&gt;
	&lt;li&gt;opening brace (of method body) on the same line (as the closing parenthesis of the argument list).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Also the new &lt;tt&gt;standardize&lt;/tt&gt; method should probably be renamed to better reflect what it is doing: &lt;tt&gt;scale&lt;/tt&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="17161378" author="mohrezaei" created="Mon, 20 Jul 2020 17:00:11 +0000"  >&lt;p&gt;Thanks for the feedback. I&apos;ve pushed a commit with the requested changes. Please let me know if there is more that you&apos;d like to see.&lt;/p&gt;

&lt;p&gt;I added a simple note about the tableau usage in the javadoc. The current code design looks sound to me from both a safety and efficacy perspective. I&apos;ll comment more in 1550.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17162061" author="erans" created="Tue, 21 Jul 2020 13:59:19 +0000"  >&lt;p&gt;PR merged in commit 3ed7faba1b108b8614bcdbb9e1946ee9c17c3bdc (&quot;master&quot; branch).&lt;/p&gt;

&lt;p&gt;Remaining nit: Could please you provide a PR that puts the &quot;52&quot; magic number in a declared constant? Thanks.&lt;/p&gt;</comment>
                            <comment id="17162075" author="mohrezaei" created="Tue, 21 Jul 2020 14:38:51 +0000"  >&lt;p&gt;Sorry about that. PR 156 &lt;a href=&quot;https://github.com/apache/commons-math/pull/156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-math/pull/156&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17162221" author="mohrezaei" created="Tue, 21 Jul 2020 17:58:16 +0000"  >&lt;p&gt;Thanks for style/javadoc fixes. I think this issue can be closed now.&lt;/p&gt;</comment>
                            <comment id="17162255" author="erans" created="Tue, 21 Jul 2020 18:10:54 +0000"  >&lt;p&gt;Would you be willing to provide the code of the &quot;scaling&quot; utility for inclusion in &lt;a href=&quot;http://commons.apache.org/proper/commons-numbers/modules.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&quot;Commons Numbers&quot;&lt;/a&gt;?&lt;br/&gt;
I&apos;d think that the &lt;a href=&quot;http://commons.apache.org/proper/commons-numbers/commons-numbers-core/apidocs/org/apache/commons/numbers/core/Precision.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;Precision&lt;/tt&gt;&lt;/a&gt; class in the &quot;core&quot; module, would be a nice fit.&lt;/p&gt;</comment>
                            <comment id="17162256" author="mohrezaei" created="Tue, 21 Jul 2020 18:12:18 +0000"  >&lt;p&gt;Sure, I&apos;ll take a look.&lt;/p&gt;</comment>
                            <comment id="17162270" author="erans" created="Tue, 21 Jul 2020 18:26:11 +0000"  >&lt;p&gt;Thanks!&lt;br/&gt;
 Please file a &quot;new feature&quot; report in the JIRA project for &lt;a href=&quot;https://issues.apache.org/jira/projects/NUMBERS&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;&quot;Numbers&quot;&lt;/a&gt;.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt; Precision class in the &quot;core&quot; module &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Correction: Perhaps the code should be spread between the &quot;core&quot; and &quot;array&quot; modules.&lt;/p&gt;</comment>
                            <comment id="17162286" author="mohrezaei" created="Tue, 21 Jul 2020 19:01:17 +0000"  >&lt;p&gt;I added the exponent routines to Precision (&lt;a href=&quot;https://issues.apache.org/jira/browse/NUMBERS-148&quot; title=&quot;Extract double exponent manipulation routines from commons-math to numbers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NUMBERS-148&quot;&gt;&lt;del&gt;NUMBERS-148&lt;/del&gt;&lt;/a&gt;). I&apos;m not sure how I feel about the overall scaling though. It seems very specific to the linear solver, and as I was researching this, I came across other scaling algorithms, so I&apos;m not sure it would be of general interest/use.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13318120">MATH-1550</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="13318538">NUMBERS-148</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13007590" name="CommonsMathSimplexSolverTest.java" size="2609" author="fanfzzhang" created="Tue, 14 Jul 2020 04:08:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 16 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0gq9s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>