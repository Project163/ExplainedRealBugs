<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:24:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-1118] Complex: semantics of equals != Double equals, mismatch with hashCode</title>
                <link>https://issues.apache.org/jira/browse/MATH-1118</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;Two complex numbers with real/imaginary parts 0.0d but different signs compare as equal numbers. This is according to their mathematical value; the comparison is done via &lt;/p&gt;

&lt;p&gt;                return (real == c.real) &amp;amp;&amp;amp; (imaginary == c.imaginary);&lt;/p&gt;

&lt;p&gt;Unfortunately, two Double values do NOT compare as equal in that case, so real.equals(c.real) would return false if the signs differ.&lt;/p&gt;

&lt;p&gt;This becomes a problem because for the hashCode, MathUtils.hash is used on the real and imaginary parts, which in turn uses Double.hash.&lt;/p&gt;

&lt;p&gt;This violates the contract on equals/hashCode, so Complex numbers cannot be used in a hashtable or similar data structure:&lt;/p&gt;

&lt;p&gt;    Complex c1 = new Complex(0.0, 0.0);&lt;br/&gt;
    Complex c2 = new Complex(0.0, -0.0);&lt;br/&gt;
    // Checks the contract:  equals-hashcode on c1 and c2&lt;br/&gt;
    assertTrue(&quot;Contract failed: equals-hashcode on c1 and c2&quot;, c1.equals(c2) ? c1.hashCode() == c2.hashCode() : true);&lt;/p&gt;</description>
                <environment>&lt;p&gt;Mac OS 10.9, Java 6, 7&lt;/p&gt;</environment>
        <key id="12708189">MATH-1118</key>
            <summary>Complex: semantics of equals != Double equals, mismatch with hashCode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="Telcontar">Cyrille Artho</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Apr 2014 06:04:42 +0000</created>
                <updated>Mon, 25 Jan 2016 20:28:01 +0000</updated>
                            <resolved>Thu, 7 May 2015 14:47:35 +0000</resolved>
                                    <version>3.2</version>
                                    <fixVersion>4.0</fixVersion>
                    <fixVersion>3.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13968144" author="telcontar" created="Mon, 14 Apr 2014 07:42:53 +0000"  >&lt;p&gt;Dfp instances are affected in the same way (-0.0 == 0.0 but their hash code differs).&lt;/p&gt;</comment>
                            <comment id="13968316" author="erans" created="Mon, 14 Apr 2014 12:53:23 +0000"  >&lt;p&gt;When introducing the &quot;correct&quot; (according to JDK for use with &quot;Map&quot;) semantics, other unit test fails, especially one that was introduced to ensure the &lt;em&gt;other&lt;/em&gt; semantics: &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-221&quot; title=&quot;Result of multiplying and equals for complex numbers is wrong&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MATH-221&quot;&gt;&lt;del&gt;MATH-221&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Could you please raise this issue on the &quot;dev&quot; ML? Thanks.&lt;/p&gt;</comment>
                            <comment id="13968333" author="erans" created="Mon, 14 Apr 2014 13:12:43 +0000"  >&lt;p&gt;Patch: proposed change (with one failing test).&lt;/p&gt;</comment>
                            <comment id="13968963" author="telcontar" created="Mon, 14 Apr 2014 22:55:18 +0000"  >&lt;p&gt;It is indeed not clear which way this bug should be fixed.&lt;br/&gt;
Another option (assuming the problem only occurs due to the sign with value 0.0) is to override hashCode such that hashCode(-0.0d) returns hashCode(0.0d), and works as is in the other cases.&lt;/p&gt;</comment>
                            <comment id="13968973" author="psteitz" created="Mon, 14 Apr 2014 23:05:26 +0000"  >&lt;p&gt;Given the decision in &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-221&quot; title=&quot;Result of multiplying and equals for complex numbers is wrong&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MATH-221&quot;&gt;&lt;del&gt;MATH-221&lt;/del&gt;&lt;/a&gt;, I am inclined to agree that the better approach is to just fix the hashcode impl.&lt;/p&gt;</comment>
                            <comment id="13968979" author="telcontar" created="Mon, 14 Apr 2014 23:08:15 +0000"  >&lt;p&gt;I&apos;ve posted a message on the mailing list. While writing that message, it occurred to me that unnormalized floating point values may break the idea of overriding hashCode for special cases, as there are too many possible cases of unnormalized floats with equal values but different internal representations.&lt;br/&gt;
Therefore, I think Gilles&apos; suggestion is the safest, even though people expecting a mathematical comparison in equals() may be surprised. The update should make it clear in the Javadoc that for a mathematical comparison, &quot;==&quot; must be used.&lt;/p&gt;</comment>
                            <comment id="13968989" author="telcontar" created="Mon, 14 Apr 2014 23:18:00 +0000"  >&lt;p&gt;It seems my previous message overlapped with Phil&apos;s. A fix in hashCode would be the most intuitive behavior, but what about unnormalized floats? Does anyone know how that works in Java?&lt;br/&gt;
For example, can we get different representations of two Double numbers with the same value? For example, 1 * 2^1 or 2 * 2^0, which are both 2? In that case, fixing hashCode is hopeless.&lt;/p&gt;</comment>
                            <comment id="13969482" author="erans" created="Tue, 15 Apr 2014 12:23:26 +0000"  >&lt;p&gt;In revision 1587548, I&apos;ve added the utility method &quot;equals(double, double)&quot; in &quot;MathUtils&quot;.&lt;/p&gt;</comment>
                            <comment id="13972842" author="erans" created="Thu, 17 Apr 2014 11:13:14 +0000"  >&lt;p&gt;Uploaded patch for making &quot;equals&quot; compatible with &quot;hashCode&quot; and adding new &quot;equals&quot; methods for testing floating-point equality (using implementations in &quot;o.a.c.m.util.Precision&quot;).&lt;/p&gt;

&lt;p&gt;OK to commit?&lt;/p&gt;</comment>
                            <comment id="13974183" author="erans" created="Fri, 18 Apr 2014 16:00:56 +0000"  >&lt;p&gt;Committed in revision 1588500.&lt;br/&gt;
Thanks for the report.&lt;/p&gt;</comment>
                            <comment id="14001835" author="luc" created="Mon, 19 May 2014 15:13:29 +0000"  >&lt;p&gt;Closing all resolved issue now available in released 3.3 version.&lt;/p&gt;</comment>
                            <comment id="14532105" author="telcontar" created="Thu, 7 May 2015 06:35:08 +0000"  >&lt;p&gt;The bug has been fixed for class Complex, but not for Dfp. The code in &quot;Report5a.java&quot; still fails. The nature of the problem is exactly the same as in &quot;Report5.java&quot;, so I have reported the bug in the same place.&lt;/p&gt;

&lt;p&gt;If you would prefer a new issue on this instead, I can file &quot;Report5a.java&quot; as a new bug.&lt;/p&gt;</comment>
                            <comment id="14532792" author="luc" created="Thu, 7 May 2015 14:47:35 +0000"  >&lt;p&gt;Fixed in git repository on both the master branch and the 3.X branch.&lt;/p&gt;

&lt;p&gt;Thanks for the reminding.&lt;/p&gt;</comment>
                            <comment id="15115966" author="luc" created="Mon, 25 Jan 2016 20:28:01 +0000"  >&lt;p&gt;Closing all resolved issues that were included in 3.6 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12640615" name="MATH-1118.patch" size="10529" author="erans" created="Thu, 17 Apr 2014 11:13:14 +0000"/>
                            <attachment id="12640066" name="MATH-1118.patch" size="4214" author="erans" created="Mon, 14 Apr 2014 13:12:43 +0000"/>
                            <attachment id="12640028" name="Report5.java" size="424" author="Telcontar" created="Mon, 14 Apr 2014 06:04:55 +0000"/>
                            <attachment id="12640036" name="Report5a.java" size="534" author="Telcontar" created="Mon, 14 Apr 2014 07:42:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>386512</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 42 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ul1b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>386776</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>