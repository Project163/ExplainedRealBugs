<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:25:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-1535] MathInternalError in KolmogorovSmirnovTest in case of many ties</title>
                <link>https://issues.apache.org/jira/browse/MATH-1535</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;I encounter a math internal error with some very ugly data that has lots of ties. The code below triggers the exception. I could try to build in a detection in my code that identifies this strange case where the generated data has many ties, to avoid this. But I guess the MathInternalError in commons-math should still be avoided.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// works
&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] sample1 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] {0.8767630865438496, 0.9998809418147052, 0.9999999715463531, 0.9999985849345421};
&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] sample2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] {1.0, 1.0, 1.0, 1.0};
ksTest.kolmogorovSmirnovTest(sample1, sample2);
&lt;span class=&quot;code-comment&quot;&gt;// fails with illegal state
&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] sample3 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] {0.8767630865438496, 0.9998809418147052, 0.9999999715463531, 0.9999985849345421, 0.973584315883326, 0.9999999875782982, 0.999999999999994, 0.9999999999908233, 1.0, 0.9999999890925574, 0.9999998345734327, 0.9999999350772448, 0.999999999999426, 0.9999147040688201, 0.9999999999999922, 1.0, 1.0, 0.9919050954798272, 0.8649014770687263, 0.9990869497973084, 0.9993222540990464, 0.999999999998189, 0.9999999999999365, 0.9790934801762917, 0.9999578695006303, 0.9999999999999998, 0.999999999996166, 0.9999999999995546, 0.9999999999908036, 0.99999999999744, 0.9999998802655555, 0.9079334221214075, 0.9794398308007372, 0.9999044231134367, 0.9999999999999813, 0.9999957841707683, 0.9277678892094009, 0.999948269893843, 0.9999999886132888, 0.9999998909699096, 0.9999099536620326, 0.9999999962217623, 0.9138936987350447, 0.9999999999779976, 0.999999999998822, 0.999979247207911, 0.9926904388316407, 1.0, 0.9999999999998814, 1.0, 0.9892505696426215, 0.9999996514123723, 0.9999999999999429, 0.9999999995399116, 0.999999999948221, 0.7358264887843119, 0.9999999994098534, 1.0, 0.9999986456748472, 1.0, 0.9999999999921501, 0.9999999999999996, 0.9999999999999944, 0.9473070068606853, 0.9993714060209042, 0.9999999409098718, 0.9999999592791519, 0.9999999999999805};
&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] sample4 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] {1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0};
ksTest.kolmogorovSmirnovTest(sample3, sample4);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;commons-math 3.6.1, oracle jdk11 for windows&lt;/p&gt;</environment>
        <key id="13308106">MATH-1535</key>
            <summary>MathInternalError in KolmogorovSmirnovTest in case of many ties</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sherbold">Steffen Herbold</reporter>
                        <labels>
                    </labels>
                <created>Thu, 28 May 2020 17:08:53 +0000</created>
                <updated>Sat, 4 Sep 2021 01:16:49 +0000</updated>
                                            <version>3.6.1</version>
                                    <fixVersion>4.X</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17118915" author="erans" created="Thu, 28 May 2020 17:17:14 +0000"  >&lt;p&gt;Please check whether the issue is still present in the development version.&lt;/p&gt;</comment>
                            <comment id="17118925" author="sherbold" created="Thu, 28 May 2020 17:33:24 +0000"  >&lt;p&gt;Yes, fails in current master. Or should I use the develop branch?&lt;/p&gt;</comment>
                            <comment id="17118940" author="sherbold" created="Thu, 28 May 2020 17:48:08 +0000"  >&lt;p&gt;Here is the stacktrace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.commons.math4.exception.MathInternalError: illegal state: internal error, please fill a bug report at https:&lt;span class=&quot;code-comment&quot;&gt;//issues.apache.org/jira/browse/MATHorg.apache.commons.math4.exception.MathInternalError: illegal state: internal error, please fill a bug report at https://issues.apache.org/jira/browse/MATH at org.apache.commons.math4.stat.inference.KolmogorovSmirnovTest.fixTies(KolmogorovSmirnovTest.java:1099) at org.apache.commons.math4.stat.inference.KolmogorovSmirnovTest.kolmogorovSmirnovTest(KolmogorovSmirnovTest.java:211) at org.apache.commons.math4.stat.inference.KolmogorovSmirnovTest.kolmogorovSmirnovTest(KolmogorovSmirnovTest.java:238) at org.apache.commons.math4.stat.inference.KolmogorovSmirnovTestTest.testMath1535(KolmogorovSmirnovTestTest.java:813) at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.base/java.lang.reflect.Method.invoke(Method.java:566) at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47) at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12) at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44) at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17) at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50) at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238) at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63) at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236) at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53) at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229) at org.junit.runners.ParentRunner.run(ParentRunner.java:309) at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:89) at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:41) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:541) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:763) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:463) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:209)&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17119131" author="erans" created="Thu, 28 May 2020 22:35:26 +0000"  >&lt;p&gt;The issue is in the &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=commons-math.git;a=blob;f=src/main/java/org/apache/commons/math4/stat/inference/KolmogorovSmirnovTest.java;h=e85cc0986a3ccc78aa8e17d98c2c73b854741459;hb=HEAD#l1082&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;fixTies&lt;/a&gt; method.&lt;br/&gt;
I think that it is caused by the hard-coded maximal count (10) and/or the allowed &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=commons-math.git;a=blob;f=src/main/java/org/apache/commons/math4/stat/inference/KolmogorovSmirnovTest.java;h=e85cc0986a3ccc78aa8e17d98c2c73b854741459;hb=HEAD#l1139&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;jitter&lt;/a&gt; range.&lt;br/&gt;
It is conceivable that unexpectedly &quot;ugly data&quot; would hit the safeguards that assume &quot;nice&quot; data.  In the latter case, one would rarely &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; resort to the above workaround, so I&apos;d guess that any hack would be fine.  For example, we could increase the jitter range and redo the loop for as long as there are ties (perhaps at the risk of changing the data too much).&lt;br/&gt;
What do you think?&lt;/p&gt;</comment>
                            <comment id="17119332" author="sherbold" created="Fri, 29 May 2020 07:09:01 +0000"  >&lt;p&gt;Yes, that could work. I checked how R handles this data. Seems to work fine, except the usual tie-warning.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;gt; x = c(0.8767630865438496, 0.9998809418147052, 0.9999999715463531, 0.9999985849345421, 0.973584315883326, 0.9999999875782982, 0.999999999999994, 0.9999999999908233, 1.0, 0.9999999890925574, 0.9999998345734327, 0.9999999350772448, 0.999999999999426, 0.9999147040688201, 0.9999999999999922, 1.0, 1.0, 0.9919050954798272, 0.8649014770687263, 0.9990869497973084, 0.9993222540990464, 0.999999999998189, 0.9999999999999365, 0.9790934801762917, 0.9999578695006303, 0.9999999999999998, 0.999999999996166, 0.9999999999995546, 0.9999999999908036, 0.99999999999744, 0.9999998802655555, 0.9079334221214075, 0.9794398308007372, 0.9999044231134367, 0.9999999999999813, 0.9999957841707683, 0.9277678892094009, 0.999948269893843, 0.9999999886132888, 0.9999998909699096, 0.9999099536620326, 0.9999999962217623, 0.9138936987350447, 0.9999999999779976, 0.999999999998822, 0.999979247207911, 0.9926904388316407, 1.0, 0.9999999999998814, 1.0, 0.9892505696426215, 0.9999996514123723, 0.9999999999999429, 0.9999999995399116, 0.999999999948221, 0.7358264887843119, 0.9999999994098534, 1.0, 0.9999986456748472, 1.0, 0.9999999999921501, 0.9999999999999996, 0.9999999999999944, 0.9473070068606853, 0.9993714060209042, 0.9999999409098718, 0.9999999592791519, 0.9999999999999805)
&amp;gt; y = c(1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0)
&amp;gt; ks.test(x,y)
Two-sample Kolmogorov-Smirnov test
data:&#160; x and y
D = 0.89706, p-value &amp;lt; 2.2e-16
alternative hypothesis: two-sided
Warning message:In ks.test(x, y) : cannot compute exact p-value with ties
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I also looked up the source code in R for the KS test.&lt;/p&gt;

&lt;p&gt;Here is the R code &lt;a href=&quot;https://github.com/wch/r-source/blob/5ddd903da06ad1493582dcc754677d1bd992ca1f/src/library/stats/R/ks.test.R&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/wch/r-source/blob/5ddd903da06ad1493582dcc754677d1bd992ca1f/src/library/stats/R/ks.test.R&lt;/a&gt;&#160;and the underlying C code(&lt;a href=&quot;https://github.com/wch/r-source/blob/5a156a0865362bb8381dcd69ac335f5174a4f60c/src/library/stats/src/ks.c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/wch/r-source/blob/5a156a0865362bb8381dcd69ac335f5174a4f60c/src/library/stats/src/ks.c&lt;/a&gt;, starts in line 92).&#160;&#160;&lt;/p&gt;

&lt;p&gt;There does not seem to be any tiebreaking. Instead, it looks like the tied data is removed before this goes into the C code (line 51 in the R code).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Scipy stats seems to use this approach as well (&lt;a href=&quot;https://github.com/scipy/scipy/blob/master/scipy/stats/stats.py&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/scipy/scipy/blob/master/scipy/stats/stats.py&lt;/a&gt;, line 6700).&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The code below fails at i=16. So the current code and already handle more than 10 ties.&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] sampleX = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] {0.8767630865438496, 0.9998809418147052, 0.9999999715463531, 0.9999985849345421, 0.973584315883326, 0.9999999875782982, 0.999999999999994, 0.9999999999908233, 1.0, 0.9999999890925574, 0.9999998345734327, 0.9999999350772448, 0.999999999999426, 0.9999147040688201, 0.9999999999999922, 1.0, 1.0, 0.9919050954798272, 0.8649014770687263, 0.9990869497973084, 0.9993222540990464, 0.999999999998189, 0.9999999999999365, 0.9790934801762917, 0.9999578695006303, 0.9999999999999998, 0.999999999996166, 0.9999999999995546, 0.9999999999908036, 0.99999999999744, 0.9999998802655555, 0.9079334221214075, 0.9794398308007372, 0.9999044231134367, 0.9999999999999813, 0.9999957841707683, 0.9277678892094009, 0.999948269893843, 0.9999999886132888, 0.9999998909699096, 0.9999099536620326, 0.9999999962217623, 0.9138936987350447, 0.9999999999779976, 0.999999999998822, 0.999979247207911, 0.9926904388316407, 1.0, 0.9999999999998814, 1.0, 0.9892505696426215, 0.9999996514123723, 0.9999999999999429, 0.9999999995399116, 0.999999999948221, 0.7358264887843119, 0.9999999994098534, 1.0, 0.9999986456748472, 1.0, 0.9999999999921501, 0.9999999999999996, 0.9999999999999944, 0.9473070068606853, 0.9993714060209042, 0.9999999409098718, 0.9999999592791519, 0.9999999999999805};
&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] sampleY = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] {1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0};
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;( &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i=5; i&amp;lt;sampleX.length; i++) {
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(i);
    ksTest.kolmogorovSmirnovTest(Arrays.copyOf(sampleX, i), Arrays.copyOf(sampleY, i));
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I honestly do not know the KS test well enough to understand the difference between adding jitter to remove ties or removing tied instances from the data. I would suggest to see what happens if the tiebreaking would be extended beyond 10 instances. Alternatively, you could just throw an exception and document that at most 10 ties can be handled.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17119492" author="sherbold" created="Fri, 29 May 2020 11:05:28 +0000"  >&lt;p&gt;Some more investigation: increasing the number of loops does indeed increase the risk of modifying the results, because the sample order may be broken. I ran the following after increasing the number of loops in fixTies to 10000.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testMath1535() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    KolmogorovSmirnovTest ksTest = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; KolmogorovSmirnovTest();

    &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] sampleX = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] {0.8767630865438496, 0.9998809418147052, 0.9999999715463531, 0.9999985849345421, 0.973584315883326, 0.9999999875782982, 0.999999999999994, 0.9999999999908233, 1.0, 0.9999999890925574, 0.9999998345734327, 0.9999999350772448, 0.999999999999426, 0.9999147040688201, 0.9999999999999922, 1.0, 1.0, 0.9919050954798272, 0.8649014770687263, 0.9990869497973084, 0.9993222540990464, 0.999999999998189, 0.9999999999999365, 0.9790934801762917, 0.9999578695006303, 0.9999999999999998, 0.999999999996166, 0.9999999999995546, 0.9999999999908036, 0.99999999999744, 0.9999998802655555, 0.9079334221214075, 0.9794398308007372, 0.9999044231134367, 0.9999999999999813, 0.9999957841707683, 0.9277678892094009, 0.999948269893843, 0.9999999886132888, 0.9999998909699096, 0.9999099536620326, 0.9999999962217623, 0.9138936987350447, 0.9999999999779976, 0.999999999998822, 0.999979247207911, 0.9926904388316407, 1.0, 0.9999999999998814, 1.0, 0.9892505696426215, 0.9999996514123723, 0.9999999999999429, 0.9999999995399116, 0.999999999948221, 0.7358264887843119, 0.9999999994098534, 1.0, 0.9999986456748472, 1.0, 0.9999999999921501, 0.9999999999999996, 0.9999999999999944, 0.9473070068606853, 0.9993714060209042, 0.9999999409098718, 0.9999999592791519, 0.9999999999999805};
    &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] sampleY = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[]	{1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0};

    ksTest.kolmogorovSmirnovTest(sampleX, sampleY); &lt;span class=&quot;code-comment&quot;&gt;// passes
&lt;/span&gt;    checkFixTies(sampleX, sampleY); &lt;span class=&quot;code-comment&quot;&gt;// fails
&lt;/span&gt;}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17119580" author="erans" created="Fri, 29 May 2020 13:06:01 +0000"  >&lt;p&gt;I also did some testing.&lt;br/&gt;
 Increasing the range is dangerous: In a unit test, it overflowed (triggering an exception by the RNG), meaning that in some cases (that do not raise an exception), the return value will just be nonsense.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt; increasing the number of loops in fixTies to 10000.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Does that seem a reasonable value?&lt;br/&gt;
 I don&apos;t know what the impact is (on the returned value) when the ordering is changed to the jitter; in case it is important, perhaps a &lt;tt&gt;checkFixTies&lt;/tt&gt; should be enforced in the main code &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;I noticed that one of the current unit tests would fail with another value of the RNG seed in the &lt;tt&gt;jitter&lt;/tt&gt; method.&lt;br/&gt;
 The test is insanely sensitive to the seed: 100000 loops are not sufficient! While for that other value, your test above passes with less than 1000 loops!&lt;/p&gt;

&lt;p&gt;This seems another sign that this approach is flawed &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;br/&gt;
 Perhaps we should do the same as in &quot;R&quot; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. If you&apos;d like to provide a patch...&lt;/p&gt;</comment>
                            <comment id="17119772" author="sherbold" created="Fri, 29 May 2020 17:11:33 +0000"  >&lt;p&gt;I agree, the jitter approach seems to work if there are few ties. But if there are many ties, as in this case, this does not work. Reimplementation same as R/scipy seems to be the better option.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I currently do not have the time to produce such a larger patch, as I would have to fully understand the R and/or Scipy code, as well as the exactP method of the commons-math implementation. Once my working hours are normal again, I should be able to do that. But when that is, depends on the pandemic...&lt;/p&gt;</comment>
                            <comment id="17119947" author="erans" created="Fri, 29 May 2020 21:22:09 +0000"  >&lt;p&gt;Commit 67aea22b0882675886b78a296d7055e66bd5a2e6 makes some small changes and adds unit tests (that fail with the current code).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13308403">MATH-1536</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 24 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0fa3c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>