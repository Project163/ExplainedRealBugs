<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:22:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-596] GraggBulirschStoerIntegrator output too low</title>
                <link>https://issues.apache.org/jira/browse/MATH-596</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;I have the following problem:&lt;br/&gt;
x(3.0) = 4.0&lt;br/&gt;
x&apos; = 3.0&lt;br/&gt;
t0 = 3.0&lt;br/&gt;
tend = 10.0&lt;/p&gt;

&lt;p&gt;ODE solving using the GraggBulirschStoerIntegrator(1e-10, 100.0, 1e-7, 1e-7) integrator, gives me:&lt;/p&gt;

&lt;p&gt;t, x, x&apos;&lt;br/&gt;
3.0, 4.0, 3.0&lt;br/&gt;
3.105840007284127, 4.0, 3.0&lt;br/&gt;
3.829973288493221, 4.31752002185238, 3.0&lt;br/&gt;
8.784328663271161, 6.489919865479664, 3.0&lt;br/&gt;
10.0, 21.35298598981348, 3.0&lt;/p&gt;

&lt;p&gt;Clearly, the value of x at time 3.10... should be something like 4.30... and not 4.0. Also, the value of x at time 10.0 should be around 25.0 and not be 21.35...&lt;/p&gt;

&lt;p&gt;If we switch to the DormandPrince853Integrator(1e-10, 100.0, 1e-7, 1e-7), it gives me:&lt;/p&gt;

&lt;p&gt;3.0, 4.0, 3.0&lt;br/&gt;
3.079933916721644, 4.239801750164932, 3.0&lt;br/&gt;
3.8792730839380845, 6.637819251814253, 3.0&lt;br/&gt;
10.0, 24.999999999999996, 3.0&lt;/p&gt;

&lt;p&gt;as expected.&lt;/p&gt;

&lt;p&gt;This seems to me like the GraggBulirschStoerIntegrator has a bug...&lt;/p&gt;</description>
                <environment></environment>
        <key id="12510666">MATH-596</key>
            <summary>GraggBulirschStoerIntegrator output too low</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dhendriks">Dennis Hendriks</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Jun 2011 14:44:50 +0000</created>
                <updated>Sat, 24 Mar 2012 16:16:52 +0000</updated>
                            <resolved>Sun, 26 Jun 2011 16:28:07 +0000</resolved>
                                    <version>3.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13051106" author="dhendriks" created="Fri, 17 Jun 2011 14:46:32 +0000"  >&lt;p&gt;This is the file I used to test this. Running it gives the output as given in de issue description.&lt;/p&gt;</comment>
                            <comment id="13053278" author="luc" created="Wed, 22 Jun 2011 14:12:57 +0000"  >&lt;p&gt;It seems to me the problem is related to the interpolator the integrator sends to the step handler.&lt;br/&gt;
If I change the implementation of requiresDenseOutput to return true instead of false in the step handle, the error becomes about 9e-16.&lt;/p&gt;

&lt;p&gt;Could you check this change completely solves the problem for you.&lt;/p&gt;

&lt;p&gt;This requiresDenseOutput was added long ago (even before this code was included in Apache Commons Math) as an optimization to avoid calling computeDerivatives too many times for some integrators. In fact, only Dormand-Prince 8 (5,3) needs it because if the interpolator is not used, we can save 3 calls per step.&lt;/p&gt;

&lt;p&gt;Now I think this feature brings more problems than it solves:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;it forces users to implement this method despite its purpose is not clear,&lt;/li&gt;
	&lt;li&gt;obviously it creates problems with at least Gragg-Bulirsch-Stoer since this&lt;br/&gt;
   integrator really needs interpolation&lt;/li&gt;
	&lt;li&gt;it will create the same problems for Adams integrators (they also need interpolation)&lt;/li&gt;
	&lt;li&gt;this &quot;optimization&quot; is useful only for one integrator&lt;/li&gt;
	&lt;li&gt;in many cases, even for this integrator it does not optimize anything since&lt;br/&gt;
   people will need interpolation&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So I would like to completely remove this.&lt;br/&gt;
I&apos;m switching to the developers mailing list to discuss about it. It is a better place for discussion than&lt;br/&gt;
this JIRA issue. Please join the discussion here, and we will post the conclusion to complete this report.&lt;/p&gt;</comment>
                            <comment id="13053729" author="dhendriks" created="Thu, 23 Jun 2011 09:08:12 +0000"  >&lt;p&gt;New test, with output for both dense and non-dense step handler.&lt;/p&gt;

&lt;p&gt;Note how for the non-dense step handler, the derivatives are computed for 10.0, and the result is 24.999999999999996. It then continues to call the step handler for time 10.0 with value 21.35298598981348, which is the value calculated for time 8.784328663271161, from before the previous time the step handler was called. It seems the compute derivative method is called for the appropriate times, only the output is not correctly used to set the interpolator values.&lt;/p&gt;

&lt;p&gt;If you think this is indeed &lt;b&gt;only&lt;/b&gt; caused by the optionality of dense output, or it is no longer relevant if non-dense output is removed, then removing the non-dense option would indeed fix this issue.&lt;/p&gt;

&lt;p&gt;It would probably be better to create a separate issue for the removal of non-dense output. I have no objections to the removal of non-dense output.&lt;/p&gt;</comment>
                            <comment id="13055094" author="luc" created="Sun, 26 Jun 2011 14:57:10 +0000"  >&lt;p&gt;Yes, I think the optional dense output feature is the only problem here.&lt;br/&gt;
When the step handler doesn&apos;t requirs dense output and there are no events, a dummy step interpolator is used. This is due to the following statements in the integrator:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (denseOutput) {
  interpolator = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GraggBulirschStoerStepInterpolator(y, yDot0,
                                                        y1, yDot1,
                                                        yMidDots, forward);
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
  interpolator = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DummyStepInterpolator(y, yDot1, forward);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So in your case, you get a DummyStepInterpolator which simply copies some intermediate states computed earlier.&lt;/p&gt;

&lt;p&gt;I will open a separate issue for removing optional dense output, solve the new issue and solve this one afterwards.&lt;/p&gt;</comment>
                            <comment id="13055112" author="luc" created="Sun, 26 Jun 2011 16:28:07 +0000"  >&lt;p&gt;Fixed in subversion repository as of r1139831.&lt;/p&gt;

&lt;p&gt;Thanks for the report&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                                                <inwardlinks description="is superceded by">
                                        <issuelink>
            <issuekey id="12511565">MATH-604</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12482939" name="MyTest.java" size="1590" author="dhendriks" created="Fri, 17 Jun 2011 14:46:32 +0000"/>
                            <attachment id="12483564" name="MyTest2.java" size="4935" author="dhendriks" created="Thu, 23 Jun 2011 09:08:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>69988</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 21 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rtkn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160435</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>