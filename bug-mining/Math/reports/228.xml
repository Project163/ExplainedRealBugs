<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:22:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-639] numerical problems in rotation creation</title>
                <link>https://issues.apache.org/jira/browse/MATH-639</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;building a rotation from the following vector pairs leads to NaN:&lt;br/&gt;
u1 = -4921140.837095533, -2.1512094250440013E7, -890093.279426377&lt;br/&gt;
u2 = -2.7238580938724895E9, -2.169664921341876E9, 6.749688708885301E10&lt;br/&gt;
v1 = 1, 0, 0&lt;br/&gt;
v2 = 0, 0, 1&lt;/p&gt;

&lt;p&gt;The constructor first changes the (v1, v2) pair into (v1&apos;, v2&apos;) ensuring the following scalar products hold:&lt;br/&gt;
 &amp;lt;v1&apos;|v1&apos;&amp;gt; == &amp;lt;u1|u1&amp;gt;&lt;br/&gt;
 &amp;lt;v2&apos;|v2&apos;&amp;gt; == &amp;lt;u2|u2&amp;gt;&lt;br/&gt;
 &amp;lt;u1 |u2&amp;gt;  == &amp;lt;v1&apos;|v2&apos;&amp;gt;&lt;/p&gt;

&lt;p&gt;Once the (v1&apos;, v2&apos;) pair has been computed, we compute the cross product:&lt;br/&gt;
  k = (v1&apos; - u1)^(v2&apos; - u2)&lt;/p&gt;

&lt;p&gt;and the scalar product:&lt;br/&gt;
  c = &amp;lt;k | (u1^u2)&amp;gt;&lt;/p&gt;

&lt;p&gt;By construction, c is positive or null and the quaternion axis we want to build is q = k/&lt;span class=&quot;error&quot;&gt;&amp;#91;2*sqrt(c)&amp;#93;&lt;/span&gt;.&lt;br/&gt;
c should be null only if some of the vectors are aligned, and this is dealt with later in the algorithm.&lt;/p&gt;

&lt;p&gt;However, there are numerical problems with the vector above with the way these computations are done, as shown&lt;br/&gt;
by the following comparisons, showing the result we get from our Java code and the result we get from manual&lt;br/&gt;
computation with the same formulas but with enhanced precision:&lt;/p&gt;

&lt;p&gt;commons math:   k = 38514476.5,            -84.,                           -1168590144&lt;br/&gt;
high precision: k = 38514410.36093388...,  -0.374075245201180409222711..., -1168590152.10599715208...&lt;/p&gt;

&lt;p&gt;and it becomes worse when computing c because the vectors are almost orthogonal to each other, hence inducing additional cancellations. We get:&lt;br/&gt;
commons math    c = -1.2397173627587605E20&lt;br/&gt;
high precision: c =  558382746168463196.7079627...&lt;/p&gt;

&lt;p&gt;We have lost ALL significant digits in cancellations, and even the sign is wrong!&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux&lt;/p&gt;</environment>
        <key id="12515920">MATH-639</key>
            <summary>numerical problems in rotation creation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="luc">Luc Maisonobe</assignee>
                                    <reporter username="luc">Luc Maisonobe</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Aug 2011 14:12:13 +0000</created>
                <updated>Sat, 24 Mar 2012 16:16:36 +0000</updated>
                            <resolved>Fri, 5 Aug 2011 15:06:09 +0000</resolved>
                                    <version>2.2</version>
                                    <fixVersion>3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13073554" author="luc" created="Mon, 1 Aug 2011 14:27:07 +0000"  >&lt;p&gt;The expected result quaternion computed to high precision manually and checked afterwards is:&lt;br/&gt;
q0 =  0.62283703596082005783621150&lt;br/&gt;
q1 =  0.02577076214564987845778149&lt;br/&gt;
q2 = -0.00000000025030122695149900&lt;br/&gt;
q3 = -0.78192703908611094998656730&lt;/p&gt;</comment>
                            <comment id="13079989" author="luc" created="Fri, 5 Aug 2011 14:17:46 +0000"  >&lt;p&gt;The fact that c = &amp;lt;k | (u1^u2)&amp;gt; is really wrong is due to the fact the rotation axis is almost exactly in the (u1, u2) plane. In fact it is only 1.833e-8 degrees (i.e. 3.199e-10 radians) out of the plane!&lt;/p&gt;</comment>
                            <comment id="13080003" author="luc" created="Fri, 5 Aug 2011 15:06:09 +0000"  >&lt;p&gt;Fixed in subversion repository as of r1154257.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>65996</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 16 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ap2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>60334</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>