<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:20:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-175] chiSquare(double[] expected, long[] observed) is returning incorrect test statistic</title>
                <link>https://issues.apache.org/jira/browse/MATH-175</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;ChiSquareTestImpl is returning incorrect chi-squared value. An implicit assumption of public double chiSquare(double[] expected, long[] observed) is that the sum of expected and observed are equal. That is, in the code:&lt;br/&gt;
for (int i = 0; i &amp;lt; observed.length; i++) &lt;/p&gt;
{
            dev = ((double) observed[i] - expected[i]);
            sumSq += dev * dev / expected[i];
        }
&lt;p&gt;this calculation is only correct if sum(observed)==sum(expected). When they are not equal then one must rescale the expected value by sum(observed) / sum(expected) so that they are.&lt;br/&gt;
Ironically, it is an example in the unit test ChiSquareTestTest that highlights the error:&lt;/p&gt;

&lt;p&gt;long[] observed1 = &lt;/p&gt;
{ 500, 623, 72, 70, 31 }
&lt;p&gt;;&lt;br/&gt;
        double[] expected1 = &lt;/p&gt;
{ 485, 541, 82, 61, 37 }
&lt;p&gt;;&lt;br/&gt;
        assertEquals( &quot;chi-square test statistic&quot;, 16.4131070362, testStatistic.chiSquare(expected1, observed1), 1E-10);&lt;br/&gt;
        assertEquals(&quot;chi-square p-value&quot;, 0.002512096, testStatistic.chiSquareTest(expected1, observed1), 1E-9);&lt;/p&gt;

&lt;p&gt;16.413 is not correct because the expected values do not make sense, they should be: 521.19403 581.37313  88.11940  65.55224  39.76119 so that the sum of expected equals 1296 which is the sum of observed.&lt;/p&gt;

&lt;p&gt;Here is some R code (r-project.org) which proves it:&lt;br/&gt;
&amp;gt; o1&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; 500 623  72  70  31&lt;br/&gt;
&amp;gt; e1&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; 485 541  82  61  37&lt;br/&gt;
&amp;gt; chisq.test(o1,p=e1,rescale.p=TRUE)&lt;/p&gt;

&lt;p&gt;        Chi-squared test for given probabilities&lt;/p&gt;

&lt;p&gt;data:  o1 &lt;br/&gt;
X-squared = 9.0233, df = 4, p-value = 0.06052&lt;/p&gt;

&lt;p&gt;&amp;gt; chisq.test(o1,p=e1,rescale.p=TRUE)$observed&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; 500 623  72  70  31&lt;br/&gt;
&amp;gt; chisq.test(o1,p=e1,rescale.p=TRUE)$expected&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; 521.19403 581.37313  88.11940  65.55224  39.76119&lt;/p&gt;





</description>
                <environment>&lt;p&gt;windows xp&lt;/p&gt;</environment>
        <key id="12383845">MATH-175</key>
            <summary>chiSquare(double[] expected, long[] observed) is returning incorrect test statistic</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="carlanderson">carl anderson</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Dec 2007 02:31:53 +0000</created>
                <updated>Thu, 23 Apr 2009 02:26:16 +0000</updated>
                            <resolved>Wed, 9 Jan 2008 05:17:45 +0000</resolved>
                                    <version>1.1</version>
                                    <fixVersion>1.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12548094" author="carlanderson" created="Tue, 4 Dec 2007 02:33:23 +0000"  >&lt;p&gt;here is the calculations currently in the code, and below the correct calculations&lt;/p&gt;</comment>
                            <comment id="12548526" author="psteitz" created="Wed, 5 Dec 2007 03:58:31 +0000"  >&lt;p&gt;Thank you for reporting this.  I agree that if the count sums are unequal, the test is not meaningful (at least I can&apos;t see a meaningful interpretation).  So the question is, do we throw IllegalArgumentException in this case or assume expected should be rescaled? &lt;/p&gt;</comment>
                            <comment id="12548743" author="carlanderson" created="Wed, 5 Dec 2007 17:43:48 +0000"  >&lt;p&gt;Hi Phil,&lt;/p&gt;

&lt;p&gt;I coded a rescaling, as below, but I have to admit that I spent a long&lt;br/&gt;
time puzzling over why results from Java differed from those with R&lt;br/&gt;
because neither threw an exception or any warning that the argument sums&lt;br/&gt;
differed. It just didn&apos;t occur to me at first that this was an issue.&lt;/p&gt;

&lt;p&gt;Carl&lt;/p&gt;


&lt;p&gt;package com.archimedesmodel.automation.stats;&lt;/p&gt;

&lt;p&gt;import org.apache.commons.math.stat.inference.ChiSquareTestImpl;&lt;/p&gt;

&lt;p&gt;public class ArchiChiSquared extends ChiSquareTestImpl {&lt;/p&gt;

&lt;p&gt;	public double chiSquare(double[] expected, long[] observed)&lt;br/&gt;
			throws IllegalArgumentException {&lt;br/&gt;
		double sumSq = 0.0d;&lt;br/&gt;
		double dev = 0.0d;&lt;br/&gt;
		if ((expected.length &amp;lt; 2) || (expected.length !=&lt;br/&gt;
observed.length)) &lt;/p&gt;
{
			throw new IllegalArgumentException(
					&quot;observed, expected array
lengths incorrect&quot;);
		}

&lt;p&gt;		double sumObs = 0;&lt;br/&gt;
		for (int i = 0; i &amp;lt; observed.length; i++) {&lt;br/&gt;
			sumObs += observed&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;;&lt;br/&gt;
			if (observed&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt; &amp;lt; 0) &lt;/p&gt;
{
				throw new IllegalArgumentException(
						&quot;observed counts must be
non-negative&quot;);
			}
&lt;p&gt;		}&lt;/p&gt;

&lt;p&gt;		double sumExp = 0;&lt;br/&gt;
		for (int i = 0; i &amp;lt; expected.length; i++) {&lt;br/&gt;
			sumExp += expected&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;;&lt;br/&gt;
			if (expected&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt; &amp;lt;= 0) &lt;/p&gt;
{
				throw new IllegalArgumentException(
						&quot;expected counts must be
postive&quot;);
			}
&lt;p&gt;		}&lt;/p&gt;

&lt;p&gt;		double ratio = 1.0;&lt;br/&gt;
		if (Double.compare(sumObs, sumExp) != 0) &lt;/p&gt;
{
			//log some warning?
			ratio = sumObs / sumExp;
		}

&lt;p&gt;		for (int i = 0; i &amp;lt; observed.length; i++) &lt;/p&gt;
{
			dev = ((double) observed[i] - ratio *
expected[i]);
			sumSq += dev * dev / (ratio * expected[i]);
		}
&lt;p&gt;		return sumSq;&lt;br/&gt;
	}&lt;/p&gt;

&lt;p&gt;}&lt;/p&gt;






</comment>
                            <comment id="12557135" author="psteitz" created="Wed, 9 Jan 2008 05:17:45 +0000"  >&lt;p&gt;Automatic rescaling fix committed in r610274. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12370901" name="chi.xls" size="14336" author="carlanderson" created="Tue, 4 Dec 2007 02:33:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34211</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 46 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rw2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160839</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>