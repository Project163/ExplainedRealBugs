<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:25:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-1681] ComplexFormat.parse(String) returns null instead of throwing MathParseException for invalid complex number strings</title>
                <link>https://issues.apache.org/jira/browse/MATH-1681</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;The &lt;tt&gt;ComplexFormat.parse(String source)&lt;/tt&gt; method violates its documented contract by returning &lt;tt&gt;null&lt;/tt&gt; instead of throwing &lt;tt&gt;MathParseException&lt;/tt&gt; for certain malformed complex number strings. According to the JavaDoc, the method should &quot;throw MathParseException if the beginning of the specified string cannot be parsed,&quot; but it fails to do so in several cases.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Test Case to Demonstrate the Bug:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testParseShouldThrowExceptionForInvalidComplexMissingImaginaryCharacter() {
&#160; &#160; ComplexFormat format = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ComplexFormat();
&#160; &#160; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; invalidComplex = &lt;span class=&quot;code-quote&quot;&gt;&quot;3 + 5&quot;&lt;/span&gt;;
&#160; &#160;&#160;
&#160; &#160; assertThrows(MathParseException.class, () -&amp;gt; {
&#160; &#160; &#160; &#160; format.parse(invalidComplex);
&#160; &#160; }, &lt;span class=&quot;code-quote&quot;&gt;&quot;Parsing &lt;span class=&quot;code-quote&quot;&gt;&apos;3 + 5&apos;&lt;/span&gt; should &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; MathParseException due to missing imaginary character &lt;span class=&quot;code-quote&quot;&gt;&apos;i&apos;&lt;/span&gt;&quot;&lt;/span&gt;);
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;Test Result:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.opentest4j.AssertionFailedError: Expected org.apache.commons.math4.legacy.exception.MathParseException to be thrown, but nothing was thrown.&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;Root Cause Analysis:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;The bug occurs due to incomplete error handling in the interaction between &lt;tt&gt;parse(String)&lt;/tt&gt; and &lt;tt&gt;parse(String, ParsePosition)&lt;/tt&gt; methods.&lt;/p&gt;

&lt;p&gt;When parsing &quot;3 + 5&quot;:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The parser successfully reads &quot;3&quot; (real part), advancing the index from 0 to 1&lt;/li&gt;
	&lt;li&gt;It reads &quot;+&quot; (operator), advancing the index further&lt;/li&gt;
	&lt;li&gt;It reads &quot;5&quot; (imaginary coefficient), advancing the index to 5&lt;/li&gt;
	&lt;li&gt;It fails to find the imaginary character &apos;i&apos;&lt;/li&gt;
	&lt;li&gt;At this point, &lt;tt&gt;parse(String, ParsePosition)&lt;/tt&gt; returns &lt;tt&gt;null&lt;/tt&gt; BUT does not reset the position index&lt;/li&gt;
&lt;/ol&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// In parse(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; source, ParsePosition pos)
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// parse imaginary character
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!CompositeFormat.parseFixedstring(source, getImaginaryCharacter(), pos)) {
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;; &#160;&lt;span class=&quot;code-comment&quot;&gt;// Bug: position index is not reset to initialIndex
&lt;/span&gt;}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160; &#160; &#160; 6. Back in &lt;tt&gt;parse(String)&lt;/tt&gt;, the check &lt;tt&gt;if (parsePosition.getIndex() == 0)&lt;/tt&gt; evaluates to false (index is 5)&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; 7. The method returns &lt;tt&gt;null&lt;/tt&gt; without throwing an exception&lt;/p&gt;</description>
                <environment></environment>
        <key id="13623100">MATH-1681</key>
            <summary>ComplexFormat.parse(String) returns null instead of throwing MathParseException for invalid complex number strings</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rickydong">Ruiqi Dong</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Jul 2025 01:58:46 +0000</created>
                <updated>Fri, 25 Jul 2025 07:49:18 +0000</updated>
                            <resolved>Fri, 25 Jul 2025 07:49:18 +0000</resolved>
                                    <version>4.0-beta1</version>
                                    <fixVersion>4.0-beta2</fixVersion>
                                    <component>legacy</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="1800">0.5h</timeoriginalestimate>
                            <timeestimate seconds="1800">0.5h</timeestimate>
                                        <comments>
                            <comment id="18004749" author="erans" created="Fri, 11 Jul 2025 17:15:00 +0000"  >&lt;p&gt;Class &lt;tt&gt;ComplexFormat&lt;/tt&gt; is not used within &quot;Commons Math&quot;.&lt;br/&gt;
IMHO, we should drop it because &quot;Commons Math&quot; should not be a mixed bag of (mostly unsupported) utilities such as this one.&lt;br/&gt;
At the minimum, parsing utilities should be defined in a separate module (on which the math functionality should &lt;em&gt;not&lt;/em&gt; depend).&lt;/p&gt;</comment>
                            <comment id="18004750" author="erans" created="Fri, 11 Jul 2025 17:16:19 +0000"  >&lt;p&gt;That said, thanks for the unit test.&lt;br/&gt;
If you have the fix, I&apos;ll add it.&lt;/p&gt;</comment>
                            <comment id="18004843" author="JIRAUSER310071" created="Sat, 12 Jul 2025 10:10:08 +0000"  >&lt;p&gt;Thank you for the feedback. Here&apos;s the fix for the current version:&lt;/p&gt;

&lt;p&gt;1. In &lt;tt&gt;parse(String source)&lt;/tt&gt; method, check for null result&#65306;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Complex parse(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; source) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; MathParseException {
&#160; &#160; ParsePosition parsePosition = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ParsePosition(0);
&#160; &#160; Complex result = parse(source, parsePosition);
&#160; &#160;&#160;
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (result == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MathParseException(source,
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;parsePosition.getErrorIndex(),
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;Complex.class);
&#160; &#160; }
&#160; &#160;&#160;
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; result;
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;2. Optionally, ensure position is reset in &lt;tt&gt;parse(String, ParsePosition)&lt;/tt&gt; when imaginary character parsing fails:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// parse imaginary character
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!CompositeFormat.parseFixedstring(source, getImaginaryCharacter(), pos)) {
&#160; &#160; pos.setIndex(initialIndex); &#160;&lt;span class=&quot;code-comment&quot;&gt;// Add &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; line &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; consistency
&lt;/span&gt;&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This ensures the API contract is honored while the class remains in the library.&lt;/p&gt;</comment>
                            <comment id="18009478" author="erans" created="Thu, 24 Jul 2025 07:22:49 +0000"  >&lt;p&gt;Actually, the fix is not yet committed.&lt;/p&gt;</comment>
                            <comment id="18009480" author="erans" created="Thu, 24 Jul 2025 07:30:52 +0000"  >&lt;p&gt;Lowering &quot;priority&quot;.&lt;br/&gt;
This bug makes an application fail in a way different from what is documented (ultimately NPE will be raised); however malformed input isn&apos;t accepted and thus cannot lead to incorrect computation (IIUC).&lt;/p&gt;</comment>
                            <comment id="18009876" author="erans" created="Fri, 25 Jul 2025 07:49:18 +0000"  >&lt;p&gt;Fixed in commit 04fc9f46bb2c3b8a0f14ed36691d7ff8d7b832a9 (&quot;master&quot; branch).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1wpfk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314621" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>difficulty-level</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="14062"><![CDATA[Easy]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>