<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:25:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-1313] Wrong tolerance in some unit tests of &quot;RandomGeneratorAbstractTest&quot;</title>
                <link>https://issues.apache.org/jira/browse/MATH-1313</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;I doubt that the mean check in the unit test below is ever going to trigger an assertion failure...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    @Test
    public void testDoubleDirect() {
        SummaryStatistics sample = new SummaryStatistics();
        final int N = 10000;
        for (int i = 0; i &amp;lt; N; ++i) {
            sample.addValue(generator.nextDouble());
        }
        Assert.assertEquals(&quot;Note: This test will fail randomly about 1 in 100 times.&quot;,
                0.5, sample.getMean(), FastMath.sqrt(N/12.0) * 2.576);
        Assert.assertEquals(1.0 / (2.0 * FastMath.sqrt(3.0)),
                     sample.getStandardDeviation(), 0.01);
    }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And similar in &quot;testFloatDirect()&quot;.&lt;/p&gt;

&lt;p&gt;I propose the following replacement:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    @Test
    public void testDoubleDirect() {
        SummaryStatistics sample = new SummaryStatistics();
        final int N = 100000;
        for (int i = 0; i &amp;lt; N; ++i) {
            sample.addValue(generator.nextDouble());
        }
        assertUniformInUnitInterval(sample, 0.99);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;where &quot;assertUniformInUnitInterval&quot; is defined as:&lt;/p&gt;
   &lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    /**                                                                                                                                                                                    
     * Check that the sample follows a uniform distribution on the {@code [0, 1)} interval.                                                                                                
     *                                                                                                                                                                                     
     * @param sample Data summary.                                                                                                                                                         
     * @param confidenceIntervalLevel Confidence level. Must be in {@code (0, 1)} interval.                                                                                                
     */
    private void assertUniformInUnitInterval(SummaryStatistics sample,
                                             double confidenceIntervalLevel) {
        final int numSamples = (int) sample.getN();
        final double mean = sample.getMean();
        final double stddev = sample.getStandardDeviation() / FastMath.sqrt(numSamples);
        final TDistribution t = new TDistribution(numSamples - 1);
        final double criticalValue = t.inverseCumulativeProbability(1 - 0.5 * (1 - confidenceIntervalLevel));
        final double tol = stddev * criticalValue;
        Assert.assertEquals(&quot;mean=&quot; + mean + &quot; tol=&quot; + tol + &quot; (note: This test will fail randomly about &quot; +
                            (100 * (1 - confidenceIntervalLevel)) + &quot; in 100 times).&quot;,
                            0.5, mean, tol);
        Assert.assertEquals(FastMath.sqrt(1d / 12), sample.getStandardDeviation(), 0.01);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Please correct if this new test is not what was intended.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12929009">MATH-1313</key>
            <summary>Wrong tolerance in some unit tests of &quot;RandomGeneratorAbstractTest&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erans">Gilles Sadowski</assignee>
                                    <reporter username="erans">Gilles Sadowski</reporter>
                        <labels>
                            <label>unit-test</label>
                    </labels>
                <created>Sun, 10 Jan 2016 15:18:36 +0000</created>
                <updated>Mon, 11 Jan 2016 11:10:31 +0000</updated>
                            <resolved>Mon, 11 Jan 2016 11:10:31 +0000</resolved>
                                                    <fixVersion>4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15091108" author="luc" created="Sun, 10 Jan 2016 16:37:42 +0000"  >&lt;p&gt;Testing uniformity seems better than what we currently have, so +1 for changing the test.&lt;/p&gt;</comment>
                            <comment id="15091236" author="psteitz" created="Sun, 10 Jan 2016 21:02:51 +0000"  >&lt;p&gt;The current test is definitely weak and the proposal above is better, but it could be made better still by looking not just at the mean, but the distribution itself.  I suspect the test was implemented before we had ChiSquare or Kolmogorov-Smirnov tests available, either of which could be used to evaluate conformity of the distribution.   The most direct would be to do a one-sample KS test with a Uniform distribution instance as the RealDistribution.  If the p-value returned is small, say less than .001, you fail the test.  Alternatively, you could set up equal-sized bins and do a ChiSquare test with expected bin counts all equal to the sample size / number of bins (this is what RealDistributionAbstractTest#testSampling does).&lt;/p&gt;</comment>
                            <comment id="15091294" author="erans" created="Sun, 10 Jan 2016 23:54:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;Testing uniformity seems better than what we currently have&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I thought that the current was testing uniformity (unless out of bad luck, the sample follows another distribution that also happens to have a 0.5 mean).&lt;br/&gt;
The problem with the current tolerance is that it is wrong: it is proportional to sqrt(N) instead of being proportional to sqrt(1/N).&lt;/p&gt;</comment>
                            <comment id="15091318" author="psteitz" created="Mon, 11 Jan 2016 01:31:19 +0000"  >&lt;p&gt;The current test checks only the mean and standard deviation of the sample.  It does not actually test that the deviates follow a uniform distribution.  I think it was likely implemented before we had tests that could test that the sample deviates actually follow the distribution.  That is what the various tests of distribution samplers do.  That is what we should do here.&lt;/p&gt;</comment>
                            <comment id="15091342" author="erans" created="Mon, 11 Jan 2016 02:28:28 +0000"  >&lt;p&gt;This issue is about a &lt;b&gt;bug&lt;/b&gt; in the current test code.&lt;/p&gt;

&lt;p&gt;In the description, I&apos;m asking for confirmation about&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;whether it is a bug or not,&lt;/li&gt;
	&lt;li&gt;whether the proposed fix does what was &lt;em&gt;originally&lt;/em&gt; intended (i.e. test that, if the distribution is uniform, then the mean must be 0.5 within some confidence interval).&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;That the unit test can be &lt;em&gt;changed&lt;/em&gt; to do something else should be discussed in another report.&lt;/p&gt;</comment>
                            <comment id="15091445" author="psteitz" created="Mon, 11 Jan 2016 05:01:35 +0000"  >&lt;p&gt;The test &lt;b&gt;should&lt;/b&gt; be changed to do something else.  The &quot;improvement&quot; effectively performs a t-test for equality of the mean to the expected mean and a non-statistical test of the standard deviation.  It does not test anything other than systematic bias of the mean and variance close (no actual statistical test) to expected.  The use of a t-test is questionable since we know (hope, actually) that the distribution being sampled is &lt;b&gt;not&lt;/b&gt; Gaussian, but that is not the point.  The point is we should be testing that the values are in fact uniformly distributed, which the above does little to confirm.  I see now that testNextFloat correctly does a chisquare test.  I  recommend that we drop this test and the one for floats and create one for doubles that does what testNextFloat does, which actually does confirm uniformity.  Now that we have KS tests, it might actually be even better to use that for the double test, which would give us two kinds of actual statistical tests of distribution conformance.&lt;/p&gt;</comment>
                            <comment id="15091773" author="erans" created="Mon, 11 Jan 2016 11:10:31 +0000"  >&lt;p&gt;Commit 2df0a3be66f6fa1067d976d7a05500beff7eda53 fixes the bug in a way similar to what is done for sigma in the same unit test.&lt;/p&gt;

&lt;p&gt;New issue was opened to eventually change the tests.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                                                <inwardlinks description="is superceded by">
                                        <issuelink>
            <issuekey id="12929148">MATH-1317</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 44 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2r3pb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>