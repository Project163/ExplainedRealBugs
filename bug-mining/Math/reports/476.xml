<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:24:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-1129] Percentile Computation errs</title>
                <link>https://issues.apache.org/jira/browse/MATH-1129</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;In the following test, the 75th percentile is &lt;em&gt;smaller&lt;/em&gt; than the 25th percentile, leaving me with a negative interquartile range.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;Bar.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Test &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void negativePercentiles(){

        &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] data = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[]{
                -0.012086732064244697, 
                -0.24975668704012527, 
                0.5706168483164684, 
                -0.322111769955327, 
                0.24166759508327315, 
                &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;.NaN, 
                0.16698443218942854, 
                -0.10427763937565114, 
                -0.15595963093172435, 
                -0.028075857595882995, 
                -0.24137994506058857, 
                0.47543170476574426, 
                -0.07495595384947631, 
                0.37445697625436497, 
                -0.09944199541668033
        };
        DescriptiveStatistics descriptiveStatistics = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DescriptiveStatistics(data);

        &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; threeQuarters = descriptiveStatistics.getPercentile(75);
        &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; oneQuarter = descriptiveStatistics.getPercentile(25);

        &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; IQR = threeQuarters - oneQuarter;
        
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;25th percentile %s 75th percentile %s&quot;&lt;/span&gt;, oneQuarter, threeQuarters ));
        
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; IQR &amp;gt;= 0;
        
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Java 1.8.0&lt;/p&gt;</environment>
        <key id="12721640">MATH-1129</key>
            <summary>Percentile Computation errs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="carlwitt">Carl Witt</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Jun 2014 09:22:55 +0000</created>
                <updated>Fri, 26 Dec 2014 19:50:27 +0000</updated>
                            <resolved>Sun, 5 Oct 2014 18:44:26 +0000</resolved>
                                    <version>3.2</version>
                                    <fixVersion>3.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14033601" author="carlwitt" created="Tue, 17 Jun 2014 09:25:12 +0000"  >&lt;p&gt;It&apos;s the NaN value, but there&apos;s no note in the percentile documentation that this is not allowed.&lt;br/&gt;
Adding a NaNStrategy like in rank conversions might be a solution. &lt;br/&gt;
This also creates doubts that the other methods handle NaN values correctly.&lt;/p&gt;</comment>
                            <comment id="14033967" author="erans" created="Tue, 17 Jun 2014 16:13:25 +0000"  >&lt;p&gt;The &lt;a href=&quot;http://commons.apache.org/proper/commons-math/apidocs/org/apache/commons/math3/stat/descriptive/rank/Percentile.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Javadoc&lt;/a&gt; for &lt;tt&gt;Percentile&lt;/tt&gt; does provide some warning about NaN within data:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;To compute percentiles, the data must be at least partially ordered. Input arrays are copied and recursively partitioned using an ordering definition. The ordering used by Arrays.sort(double[]) is the one determined by Double.compareTo(Double). This ordering makes Double.NaN larger than any other value (including Double.POSITIVE_INFINITY). Therefore, for example, the median (50th percentile) of {0, 1, 2, 3, 4, Double.NaN} evaluates to 2.5.

Since percentile estimation usually involves interpolation between array elements, arrays containing NaN or infinite values will often result in NaN or infinite values returned.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but the caveat does not appear in &lt;tt&gt;DescriptiveStatistics&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Even when no NaN is returned, the result varies with the position of the NaN value in the data array. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
It looks like the sorting is wrong in the presence of NaN. See below.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This also creates doubts that the other methods handle NaN values correctly.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t know whether the intention was that the result should always be considered undefined in the presence of NaN.&lt;/p&gt;

&lt;p&gt;Local sort&lt;br/&gt;
Without NaN: 25th percentile -0.1773147094639404 75th percentile 0.2748649403760461&lt;br/&gt;
With NaN: 25th percentile 0.24166759508327315 75th percentile -0.028075857595882995&lt;br/&gt;
With +inf: 25th percentile -0.15595963093172435 75th percentile 0.37445697625436497&lt;/p&gt;

&lt;p&gt;java.util.Arrays.sort (sorting the whole data array)&lt;br/&gt;
Without NaN: 25th percentile -0.1773147094639404 75th percentile 0.2748649403760461&lt;br/&gt;
With NaN: 25th percentile -0.15595963093172435 75th percentile 0.37445697625436497&lt;br/&gt;
With +inf: 25th percentile -0.15595963093172435 75th percentile 0.37445697625436497&lt;/p&gt;

&lt;p&gt;I&apos;ve attempted to fix the local sort:&lt;br/&gt;
Without NaN: 25th percentile -0.1773147094639404 75th percentile 0.2748649403760461&lt;br/&gt;
With NaN: 25th percentile -0.15595963093172435 75th percentile 0.37445697625436497&lt;br/&gt;
With +inf: 25th percentile -0.15595963093172435 75th percentile 0.37445697625436497&lt;/p&gt;

&lt;p&gt;If nobody objects, I&apos;ll commit this modification, and further tests can be devised to ensure that it works correctly for other inputs.&lt;/p&gt;</comment>
                            <comment id="14033980" author="erans" created="Tue, 17 Jun 2014 16:20:00 +0000"  >&lt;p&gt;Actually, the standard &lt;tt&gt;java.util.Arrays&lt;/tt&gt; class has the needed functionality (a method for sorting part of an array in place).&lt;br/&gt;
The Javadoc indicates that it is a tuned quicksort, while the function in CM is called &quot;insertionSort&quot;.&lt;br/&gt;
I&apos;d rather use the JDK one, and remove the &quot;local&quot; sort. Any objection?&lt;/p&gt;</comment>
                            <comment id="14034001" author="erans" created="Tue, 17 Jun 2014 16:32:00 +0000"  >&lt;p&gt;Fixed &quot;insertionSort&quot; method in revision 1603217.&lt;/p&gt;

&lt;p&gt;Waiting for comment about removing it in favour of JDK&apos;s implementation.&lt;/p&gt;</comment>
                            <comment id="14034013" author="erans" created="Tue, 17 Jun 2014 16:43:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;Adding a NaNStrategy like in rank conversions might be a solution. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This suggestion is also to be discussed for &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-1120&quot; title=&quot;Need Percentile computations that can be matched with standard spreadsheet formula&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MATH-1120&quot;&gt;&lt;del&gt;MATH-1120&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
Could you please raise the issue on the &quot;dev&quot; ML?&lt;/p&gt;</comment>
                            <comment id="14034038" author="carlwitt" created="Tue, 17 Jun 2014 16:57:33 +0000"  >&lt;p&gt;Me? This was my first post here, so I&apos;m not sure what to do.&lt;/p&gt;</comment>
                            <comment id="14034064" author="erans" created="Tue, 17 Jun 2014 17:21:30 +0000"  >&lt;p&gt;Whenever you submit a report here, a discussion might ensue about how to best fix the problem, or to properly implement a feature request, so it is quite useful to be subscribed to the project&apos;s development mailing list (&quot;dev@commons.apache.org&quot;):&lt;br/&gt;
&lt;a href=&quot;http://commons.apache.org/proper/commons-math/mail-lists.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://commons.apache.org/proper/commons-math/mail-lists.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Then when you post there, you should prefix the &quot;subject&quot; line with &quot;[Math]&quot; (because the list is shared with many other projects under the &quot;Commons&quot; common &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; umbrella).&lt;/p&gt;
</comment>
                            <comment id="14034073" author="carlwitt" created="Tue, 17 Jun 2014 17:30:17 +0000"  >&lt;p&gt;Gilles, would you mind doing that for me? I&apos;m not what you would call a power user of the commons math library, so I&apos;d rather like to stay out of development issues.&lt;/p&gt;

&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                            <comment id="14035524" author="erans" created="Wed, 18 Jun 2014 09:46:34 +0000"  >&lt;blockquote&gt;&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt; so I&apos;d rather like to stay out of development issues.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Development is also driven by user needs.&lt;/p&gt;

&lt;p&gt;If you are satisfied with the current status of this issue, I&apos;m fine to leave it at that. Thanks for the report.&lt;/p&gt;</comment>
                            <comment id="14035635" author="carlwitt" created="Wed, 18 Jun 2014 12:21:38 +0000"  >&lt;p&gt;I think I expressed my needs. You&apos;re welcome!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>399836</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 22 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1wtxb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>399944</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>