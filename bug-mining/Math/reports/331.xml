<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:23:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-836] Fraction(double, int) constructor strange behaviour</title>
                <link>https://issues.apache.org/jira/browse/MATH-836</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;The Fraction constructor Fraction(double, int) takes a double value and a int maximal denominator, and approximates a fraction. When the double value is a large, negative number with many digits in the fractional part, and the maximal denominator is a big, positive integer (in the 100&apos;000s), two distinct bugs can manifest:&lt;/p&gt;

&lt;p&gt;1: the constructor returns a positive Fraction. Calling Fraction(-33655.1677817278, 371880) returns the fraction 410517235/243036, which both has the wrong sign, and is far away from the absolute value of the given value&lt;/p&gt;

&lt;p&gt;2: the constructor does not manage to reduce the Fraction properly. Calling Fraction(-43979.60679604749, 366081) returns the fraction -1651878166/256677, which should have* been reduced to -24654898/3831.&lt;/p&gt;

&lt;p&gt;I have, as of yet, not found a solution. The constructor looks like this:&lt;/p&gt;

&lt;p&gt;public Fraction(double value, int maxDenominator)&lt;br/&gt;
        throws FractionConversionException&lt;/p&gt;
    {
       this(value, 0, maxDenominator, 100);
    }

&lt;p&gt;Increasing the 100 value (max iterations) does not fix the problem for all cases. Changing the 0-value (the epsilon, maximum allowed error) to something small does not work either, as this breaks the tests in FractionTest. &lt;/p&gt;

&lt;p&gt;The problem is not neccissarily that the algorithm is unable to approximate a fraction correctly. A solution where a FractionConversionException had been thrown in each of these examples would probably be the best solution if an improvement on the approximation algorithm turns out to be hard to find.&lt;/p&gt;

&lt;p&gt;This bug has been found when trying to explore the idea of axiom-based testing (&lt;a href=&quot;http://bldl.ii.uib.no/testing.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bldl.ii.uib.no/testing.html&lt;/a&gt;). Attached is a java test class FractionTestByAxiom (junit, goes into org.apache.commons.math3.fraction) which shows these bugs through a simplified approach to this kind of testing, and a text file describing some of the value/maxDenominator combinations which causes one of these failures.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;It is never specified in the documentation that the Fraction class guarantees that completely reduced rational numbers are constructed, but a comment inside the equals method claims that &quot;since fractions are always in lowest terms, numerators and can be compared directly for equality&quot;, so it seems like this is the intention.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12600886">MATH-836</key>
            <summary>Fraction(double, int) constructor strange behaviour</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="snalin">Baste Nesse Buanes</reporter>
                        <labels>
                            <label>Fraction</label>
                    </labels>
                <created>Tue, 31 Jul 2012 17:04:25 +0000</created>
                <updated>Mon, 4 Mar 2013 18:53:29 +0000</updated>
                            <resolved>Sat, 4 Aug 2012 16:27:26 +0000</resolved>
                                    <version>3.0</version>
                                    <fixVersion>3.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13425925" author="snalin" created="Tue, 31 Jul 2012 17:05:57 +0000"  >&lt;p&gt;FractionTestByAxiom.java added: Tests the Fraction class through axioms. Not intended to be a part of a finished product, but to explore the class, looking for bugs.&lt;/p&gt;</comment>
                            <comment id="13425926" author="snalin" created="Tue, 31 Jul 2012 17:06:57 +0000"  >&lt;p&gt;value-maxDenominator_pairs_that_fails added: pairs of doubles and ints that makes the constructor Fraction(double, int) return faulty Fractions.&lt;/p&gt;</comment>
                            <comment id="13426902" author="tn" created="Wed, 1 Aug 2012 21:14:45 +0000"  >&lt;p&gt;The overflow check in Fraction does not take negative values into account, it has to be changed to the following:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  if (FastMath.abs(a0) &amp;gt; overflow) {
      throw new FractionConversionException(value, a0, 1l);
  }

...

  if ((FastMath.abs(p2) &amp;gt; overflow) || (FastMath.abs(q2) &amp;gt; overflow)) {
      throw new FractionConversionException(value, p2, q2);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In that case your examples fail correctly with a FractionConversionException and all unit tests run through successfully.&lt;/p&gt;

&lt;p&gt;I would be interested how you generated the test cases. Are these auto-generated?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Thomas&lt;/p&gt;</comment>
                            <comment id="13426914" author="tn" created="Wed, 1 Aug 2012 21:25:26 +0000"  >&lt;p&gt;Committed the changes in r1368253.&lt;/p&gt;</comment>
                            <comment id="13426943" author="tn" created="Wed, 1 Aug 2012 21:52:48 +0000"  >&lt;p&gt;While looking into this issue, I realized that there is a very similar class in commons-lang, which also does a reduction when creating a Fraction object from a double value. We should consider also doing this for commons-math.&lt;/p&gt;</comment>
                            <comment id="13427212" author="snalin" created="Thu, 2 Aug 2012 09:50:10 +0000"  >&lt;p&gt;Thomas - the test cases are not auto-generated, they are hand-written. We&apos;re working on a tool - JaxT2 -  that interprets axioms for classes and auto-generates unit tests through reflection, to improve on the old JaxT tool (&lt;a href=&quot;http://www.ii.uib.no/mouldable/testing/jaxt/index.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.ii.uib.no/mouldable/testing/jaxt/index.html&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Good job with the overflow.&lt;/p&gt;</comment>
                            <comment id="13428627" author="tn" created="Sat, 4 Aug 2012 16:27:26 +0000"  >&lt;p&gt;Thanks for the info. This work looks really interested. If you need any support in further testing commons-math or any other commons component, do not hesitate to ask.&lt;/p&gt;

&lt;p&gt;I resolve this issue now, as it seems to fix your problems.&lt;/p&gt;

&lt;p&gt;Thomas&lt;/p&gt;</comment>
                            <comment id="13428906" author="psteitz" created="Sun, 5 Aug 2012 20:14:29 +0000"  >&lt;p&gt;JaxT definitely looks very interesting and broadly useful for us.  Looking forward to more applications to commons math and other commons components.  &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12538573" name="FractionTestByAxiom.java" size="30813" author="snalin" created="Tue, 31 Jul 2012 17:05:57 +0000"/>
                            <attachment id="12538574" name="value-maxDenominator_pairs_that_fails" size="506" author="snalin" created="Tue, 31 Jul 2012 17:06:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>292283</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 15 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rt13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160347</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>