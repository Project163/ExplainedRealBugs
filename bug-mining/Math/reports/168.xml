<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:22:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-471] MathUtils.equals(double, double) does not work properly for floats</title>
                <link>https://issues.apache.org/jira/browse/MATH-471</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;MathUtils.equals(double, double) does not work properly for floats.&lt;/p&gt;

&lt;p&gt;There is no equals(float,float) so float parameters are automatically promoted to double. However, that is not necessarily appropriate, given that the ULP for a double is much smaller than the ULP for a float.&lt;/p&gt;

&lt;p&gt;So for example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; oneDouble = 1.0d;
assertTrue(MathUtils.equals(oneDouble, &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;.longBitsToDouble(1 + &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;.doubleToLongBits(oneDouble)))); &lt;span class=&quot;code-comment&quot;&gt;// OK
&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; oneFloat = 1.0f;
assertTrue(MathUtils.equals(oneFloat, &lt;span class=&quot;code-object&quot;&gt;Float&lt;/span&gt;.intBitsToFloat(1 + &lt;span class=&quot;code-object&quot;&gt;Float&lt;/span&gt;.floatToIntBits(oneFloat)))); &lt;span class=&quot;code-comment&quot;&gt;// FAILS
&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;  f1 = 333.33334f;
&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; d1 = 333.33334d;
assertTrue(MathUtils.equals(d1, f1)); &lt;span class=&quot;code-comment&quot;&gt;// FAILS&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think the equals() methods need to be duplicated with the appropriate changes for floats to avoid any problems with the promotion of floats.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12495437">MATH-471</key>
            <summary>MathUtils.equals(double, double) does not work properly for floats</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Jan 2011 23:30:29 +0000</created>
                <updated>Wed, 23 Mar 2011 20:31:27 +0000</updated>
                            <resolved>Mon, 17 Jan 2011 20:33:45 +0000</resolved>
                                                    <fixVersion>2.2</fixVersion>
                    <fixVersion>3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12981018" author="sebb@apache.org" created="Wed, 12 Jan 2011 23:51:07 +0000"  >&lt;p&gt;Implementation of equals(float...) methods&lt;/p&gt;</comment>
                            <comment id="12981020" author="sebb@apache.org" created="Wed, 12 Jan 2011 23:54:21 +0000"  >&lt;p&gt;I now realise that the 3rd example above may not be easy - or even possible - to fix, but it does offer a good example of the difficulties of comparing floating point numbers!&lt;/p&gt;</comment>
                            <comment id="12981049" author="psteitz" created="Thu, 13 Jan 2011 00:49:05 +0000"  >&lt;p&gt;Ouch!&lt;/p&gt;

&lt;p&gt;Thanks for reporting and patching this. Sebb.  &lt;/p&gt;

&lt;p&gt;+1 for applying the patch to both 2_X and trunk, with unit tests.&lt;/p&gt;</comment>
                            <comment id="12981074" author="psteitz" created="Thu, 13 Jan 2011 01:34:44 +0000"  >&lt;p&gt;It is not obvious to me that the third example should succeed.  An argument could be made that the existing code does the right thing when passed a double and a float, which is to convert the float according to the value set conversion rules and then compare the result to the double.  &lt;/p&gt;</comment>
                            <comment id="12981091" author="sebb@apache.org" created="Thu, 13 Jan 2011 02:27:30 +0000"  >&lt;p&gt;Yes, I think the 3rd example is not relevant to the immediate problem (although indirectly it was what alerted me to the problem).&lt;/p&gt;

&lt;p&gt;Though it may perhaps be worthwhile noting the conversion issue somewhere in the Javadoc - perhaps at class level?&lt;/p&gt;</comment>
                            <comment id="12981107" author="sebb@apache.org" created="Thu, 13 Jan 2011 03:04:06 +0000"  >&lt;p&gt;Just had a thought:&lt;/p&gt;

&lt;p&gt;I don&apos;t think the exactly same code can be added to 2.x, because the semantics of some of the double methods has changed.&lt;br/&gt;
It would be confusing if floats behaved differently from doubles!&lt;/p&gt;

&lt;p&gt;So I propose to rework the fix for 2.x to preserve the deprecated behaviour and deprecated tags.&lt;/p&gt;

&lt;p&gt;OK?&lt;/p&gt;</comment>
                            <comment id="12981108" author="psteitz" created="Thu, 13 Jan 2011 03:10:51 +0000"  >&lt;p&gt;Yes, you are right.  Needs to be reworked slightly for 2.x.&lt;/p&gt;</comment>
                            <comment id="12981216" author="erans" created="Thu, 13 Jan 2011 11:05:48 +0000"  >&lt;blockquote&gt;
&lt;p&gt;MathUtils.equals(double, double) does not work properly for floats.&lt;/p&gt;

&lt;p&gt;There is no equals(float,float) so float parameters are automatically promoted to double. However, that is not necessarily appropriate, given that the ULP for a double is much smaller than the ULP for a float.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is not a bug, but expected behaviour. But I certainly agree that it does not hurt to mention the conversion issue for the unwary.&lt;/p&gt;

&lt;p&gt;However, shouldn&apos;t there be emphasis, in the user guide, that CM is a &quot;double&quot; precision library? A quick poll of the code gives the following numbers:&lt;br/&gt;
Occurrences of the string &quot;float &quot;: &lt;b&gt;41&lt;/b&gt; (roughly half of which were introduced with this patch)&lt;br/&gt;
Occurrences of the string &quot;double &quot;: &lt;b&gt;4061&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Also, I&apos;m curious as to what use case you were having that requires comparing &lt;tt&gt;float&lt;/tt&gt; numbers.&lt;/p&gt;

&lt;p&gt;Finally if we want to help users avoid such pitfalls, I think that we should consider refactoring &lt;tt&gt;MathUtils&lt;/tt&gt; so that similar methods that should behave differently for different types are in &lt;em&gt;different&lt;/em&gt; classes (exactly as with classes &lt;tt&gt;Float&lt;/tt&gt; and &lt;tt&gt;Double&lt;/tt&gt;). Thus, we should create &lt;tt&gt;MathUtilsDouble&lt;/tt&gt; (or assume that the current &lt;tt&gt;MathUtils&lt;/tt&gt; is for &lt;tt&gt;double&lt;/tt&gt; utilities) and &lt;tt&gt;MathUtilsFloat&lt;/tt&gt;.&lt;/p&gt;
</comment>
                            <comment id="12981807" author="sebb@apache.org" created="Fri, 14 Jan 2011 16:09:49 +0000"  >&lt;p&gt;Many of the double-only methods work OK with widened float parameters.&lt;/p&gt;

&lt;p&gt;Where this is not the case, we either need to fix the discrepancy (as per this JIRA) or document the restriction.&lt;/p&gt;

&lt;p&gt;I don&apos;t see the point of separating the utilities into two different classes, but if the consensus is that we should, then we need to make sure that the same methods are present in both, even if the double method works perfectly well, otherwise it would be even more confusing for users (where do I find the method?).&lt;/p&gt;

&lt;p&gt;But I think the main issue is that having a separate class would force users to &lt;b&gt;edit and recompile&lt;/b&gt; to take advantage of any fixes such as this one.&lt;/p&gt;</comment>
                            <comment id="12982136" author="psteitz" created="Sat, 15 Jan 2011 17:11:54 +0000"  >&lt;p&gt;I agree with Sebb on this one.  I think it is a bug (the second example).  The promotion separates the values that are indistinguishable as floats.  Consistently with comments on &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-474&quot; title=&quot;Frequency: new method: merge(Frequency)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MATH-474&quot;&gt;&lt;del&gt;MATH-474&lt;/del&gt;&lt;/a&gt;, equals(&lt;del&gt;,&lt;/del&gt;) should identify indiscernibles.  I also agree that it is better to just add the methods to MathUtils.&lt;/p&gt;</comment>
                            <comment id="12982853" author="sebb@apache.org" created="Mon, 17 Jan 2011 20:33:44 +0000"  >&lt;p&gt;Patches now applied.&lt;/p&gt;</comment>
                            <comment id="13010393" author="luc" created="Wed, 23 Mar 2011 20:31:27 +0000"  >&lt;p&gt;Closing issue as it was included in version 2.2, which has been released&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12468189" name="Math471.patch" size="6693" author="sebb" created="Wed, 12 Jan 2011 23:51:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34185</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 35 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ruaf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160551</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>