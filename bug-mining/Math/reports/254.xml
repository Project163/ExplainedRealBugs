<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:22:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-413] Miscellaneous issues concerning the &quot;optimization&quot; package</title>
                <link>https://issues.apache.org/jira/browse/MATH-413</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;Revision 990792 contains changes triggered the following issues:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-394&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;MATH-394&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-397&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;MATH-397&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-404&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;MATH-404&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This issue collects the currently still unsatisfactory code (not necessarily sorted in order of annoyance):&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&quot;BrentOptimizer&quot;: a specific convergence checker must be used. &quot;LevenbergMarquardtOptimizer&quot; also has specific convergence checks.&lt;/li&gt;
	&lt;li&gt;Trying to make convergence checking independent of the optimization algorithm creates problems (conceptual and practical):
	&lt;ul&gt;
		&lt;li&gt;See &quot;BrentOptimizer&quot; and &quot;LevenbergMarquardtOptimizer&quot;, the algorithm passes &quot;points&quot; to the convergence checker, but the actual meaning of the points can very well be different in the caller (optimization algorithm) and the callee (convergence checker).&lt;/li&gt;
		&lt;li&gt;In &quot;PowellOptimizer&quot; the line search (&quot;BrentOptimizer&quot;) tolerances depend on the tolerances within the main algorithm. Since tolerances come with &quot;ConvergenceChecker&quot; and so can be changed at any time, it is awkward to adapt the values within the line search optimizer without exposing its internals (&quot;BrentOptimizer&quot; field) to the enclosing class (&quot;PowellOptimizer&quot;).&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Given the numerous changes, some Javadoc comments might be out-of-sync, although I did try to update them all.&lt;/li&gt;
	&lt;li&gt;Class &quot;DirectSearchOptimizer&quot; (in package &quot;optimization.direct&quot;) inherits from class &quot;AbstractScalarOptimizer&quot; (in package &quot;optimization.general&quot;).&lt;/li&gt;
	&lt;li&gt;Some interfaces are defined in package &quot;optimization&quot; but their base implementations (abstract class that contain the boiler-plate code) are in package &quot;optimization.general&quot; (e.g. &quot;DifferentiableMultivariateVectorialOptimizer&quot; and &quot;BaseAbstractVectorialOptimizer&quot;).&lt;/li&gt;
	&lt;li&gt;No check is performed to ensure the the convergence checker has been set (see e.g. &quot;BrentOptimizer&quot; and &quot;PowellOptimizer&quot;); if it hasn&apos;t there will be a NPE. The alternative is to initialize a default checker that will never be used in case the user had intended to explicitly sets the checker.&lt;/li&gt;
	&lt;li&gt;&quot;NonLinearConjugateGradientOptimizer&quot;: Ugly workaround for the checked &quot;ConvergenceException&quot;.&lt;/li&gt;
	&lt;li&gt;Everywhere, we trail the checked &quot;FunctionEvaluationException&quot; although it is never used.&lt;/li&gt;
	&lt;li&gt;There remains some duplicate code (such as the &quot;multi-start loop&quot; in the various &quot;MultiStart...&quot; implementations).&lt;/li&gt;
	&lt;li&gt;The &quot;ConvergenceChecker&quot; interface is very general (the &quot;converged&quot; method can take any number of &quot;...PointValuePair&quot;). However there remains a &quot;semantic&quot; problem: One cannot be sure that the list of points means the same thing for the caller of &quot;converged&quot; and within the implementation of the &quot;ConvergenceChecker&quot; that was independently set.&lt;/li&gt;
	&lt;li&gt;It is not clear whether it is wise to aggregate the counter of gradient evaluations to the function evaluation counter. In &quot;LevenbergMarquartdOptimizer&quot; for example, it would be unfair to do so. Currently I had to remove all tests referring to gradient and Jacobian evaluations.&lt;/li&gt;
	&lt;li&gt;In &quot;AbstractLeastSquaresOptimizer&quot; and &quot;LevenbergMarquardtOptimizer&quot;, occurences of &quot;OptimizationException&quot; were replaced by the unchecked &quot;ConvergenceException&quot; but in some cases it might not be the most appropriate one.&lt;/li&gt;
	&lt;li&gt;&quot;MultiStartUnivariateRealOptimizer&quot;: in the other classes (&quot;MultiStartMultivariate...&quot;) similar to this one, the randomization is on the firts-guess value while in this class, it is on the search interval. I think that here also we should randomly choose the start value (within the user-selected interval).&lt;/li&gt;
	&lt;li&gt;The Javadoc utility raises warnings (see output of &quot;mvn site&quot;) which I couldn&apos;t figure out how to correct.&lt;/li&gt;
	&lt;li&gt;Some previously existing classes and interfaces have become no more than a specialisation of new &quot;generics&quot; classes; it might be interesting to remove them in order to reduce the number of classes and thus limit the potential for confusion.&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment></environment>
        <key id="12472850">MATH-413</key>
            <summary>Miscellaneous issues concerning the &quot;optimization&quot; package</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="erans">Gilles Sadowski</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 Aug 2010 13:19:08 +0000</created>
                <updated>Sat, 24 Mar 2012 16:16:42 +0000</updated>
                            <resolved>Mon, 13 Feb 2012 10:46:26 +0000</resolved>
                                                    <fixVersion>3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12904592" author="erans" created="Tue, 31 Aug 2010 10:44:09 +0000"  >&lt;p&gt;IMO, the most urgent issue to be dealt with is the design decision to make the convergence checking criteria independent from the optimization algorithm. &lt;span class=&quot;error&quot;&gt;&amp;#91;This has a direct influence on the API and should be stabilized in v3.0.&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Points 1, 2, 6, 10 in the issue description indicate the problems with this approach.&lt;/p&gt;

&lt;p&gt;IMO, while modularization is often a good thing, the attempt produces several drawbacks in this case:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The user interface is more difficult than it could be: the user has to specify a &quot;complex&quot; &lt;tt&gt;ConvergenceChecker&lt;/tt&gt; object, instead of just {{double}}s (relative and/or absolute threshold/tolerance/accuracy).&lt;/li&gt;
	&lt;li&gt;At the CM level, there is no single implementation of &lt;tt&gt;ConvergenceChecker&lt;/tt&gt; that is applicable for every algorithm (see &lt;tt&gt;BrentOptimizer&lt;/tt&gt; and &lt;tt&gt;LevenbergMarquardtOptimizer&lt;/tt&gt;).&lt;/li&gt;
	&lt;li&gt;If we don&apos;t set a default, the user will get a NPE.&lt;/li&gt;
	&lt;li&gt;If we set a default convergence checker, in an attempt to make usage easier, it will still not be very useful because the user will have to set a new checker as soon as he needs to change the algorithm accuracy.&lt;/li&gt;
	&lt;li&gt;The user cannot rely on the description of convergence given by a &lt;tt&gt;ConvergenceChecker&lt;/tt&gt;&apos;s implementation because if he chooses a checker that is &quot;incompatible&quot; with the optimization algorithm, the behaviour is &quot;undefined&quot;. I have overridden &lt;tt&gt;setConvergenceChecker&lt;/tt&gt; to forbid the setting of anything other than a &lt;tt&gt;BrentConvergenceChecker&lt;/tt&gt; but this completely voids the intended flexibility of having a separate convergence checking procedure.&lt;/li&gt;
	&lt;li&gt;If we want to enforce the strict separation between optimization and convergence checking, we&apos;ll have to &lt;em&gt;modify&lt;/em&gt; standard algorithm so that they fit into the mold (i.e. we must ensure that &quot;convergence checking&quot; and &quot;optimization&quot; parts are indeed independent). This may not even be possible without removing features of some algorithms (e.g. specific tolerance definitions in &quot;Levenberg-Marquardt&quot;). And if it is done, then the resulting algorithm will not be standard anymore!&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In light of all these problems, we should seriously re-examine whether the &lt;tt&gt;ConvergenceChecker&lt;/tt&gt; approach is the right way to go.&lt;/p&gt;

&lt;p&gt;In the end, it is very well possible the best that can be done is to pass appropriate arguments to the constructor of each optimizer&apos;s implementation. &lt;span class=&quot;error&quot;&gt;&amp;#91;With the consequence that if one wants to change the convergence checking behaviour, one has to create a new instance. (Side note: this is consistent with going towards instances&amp;#39; immutability.)&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="12904963" author="dimpbx" created="Wed, 1 Sep 2010 07:49:58 +0000"  >&lt;p&gt;&amp;gt; In light of all these problems, we should seriously re-examine whether the&lt;br/&gt;
&amp;gt;  ConvergenceChecker approach is the right way to go.&lt;/p&gt;

&lt;p&gt;Even without these problems, I am very sceptical about the usefulness of so much flexibility.  What users of numerical libraries have been used to is to pass some kind of precision (absolute or relative) to a solver, minimizer ... and to get the anser which matches the criterion.&lt;br/&gt;
Why would CM&apos;s users expect more?  I do see why some CM developers would like to give more, simply because it is fun to design such a general abstract checker but do the users care?  If we put the most flexible checker, the users will have to fill it  which might be a good reason to switch to a simpler (less flexible) library.&lt;/p&gt;

&lt;p&gt;As long as the documentation describes how the precision (argument) is used by the class, the user knows what to expect. &lt;/p&gt;</comment>
                            <comment id="12904971" author="luc" created="Wed, 1 Sep 2010 08:40:36 +0000"  >&lt;p&gt;The ConvergenceChecker principle is inherited from the mantissa library that was merged with commons-math in 2006-2007.&lt;br/&gt;
I introduced it in mantissa because it leveraged very simply the two most important cases I encountered : sometimes one wants to check convergence on the free variable (i.e. the input) and sometimes one wants to check convergence on the cost (i.e. the output). I think even one time I add to check on both input and output using a custom checker but am not really sure. These two cases are real one and depend on the user problem.&lt;/p&gt;

&lt;p&gt;I don&apos;t agree with the word &quot;complex&quot; about the interface, even if quoted. Furthermore, the user is not forced to implement it by himself, there are two implementations that fits the two cases above: the SimpleXxxChecker. So a user typically has to call:&lt;/p&gt;

&lt;p&gt;  optimizer.setConvergenceChecker(new SimpleVectorialValueChecker(epsilon1, epsilon2));&lt;/p&gt;

&lt;p&gt;This is a separate call from the optimize call, but it could be merged if needed. However, I still consider being able to check convergence either in x or in y is important and should be kept.&lt;/p&gt;</comment>
                            <comment id="12905010" author="erans" created="Wed, 1 Sep 2010 12:43:22 +0000"  >&lt;p&gt;The main problem is not whether it is deemed complicated or not to initialize the checker.&lt;br/&gt;
The fact is that the convergence checker procedure is &lt;em&gt;not&lt;/em&gt; (always) independent of the algorithm (as in the cases of &lt;tt&gt;BrentOptimizer&lt;/tt&gt; and &lt;tt&gt;LevenbergMarquardtOptimizer&lt;/tt&gt;).&lt;br/&gt;
Currently it is very dangerous to assume that convergence check is independent and will always work correctly. This severely impacts the robustness of CM; thus it is a big problem, and it seems that the current approach cannot solve it.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;As I have suggested, we could try to &lt;em&gt;modify&lt;/em&gt; the algorithms in such a way that an independent checking procedure is always valid. The drawback is that we&apos;ll have non-standard behaviour of otherwise well-known algorithms and some users won&apos;t like it (cf. request by the reporter of issue &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-362&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;MATH-362&lt;/a&gt;).&lt;/li&gt;
	&lt;li&gt;An alternative is to go back to a &quot;simple&quot;, algorithm-specific convergence check (i.e. what most users are already used to), with tolerances parameters passed through the constructor.&lt;/li&gt;
	&lt;li&gt;To enhance the checking (in effect, trying to recover the flexibility of &lt;tt&gt;ConvergenceChecker&lt;/tt&gt; functionality), I&apos;d propose to optionally enable a &quot;callback&quot; to be called after each iteration with two arguments (the previous and current best point/value pairs) and that should return &quot;SUCCESS&quot; (an &lt;tt&gt;enum&lt;/tt&gt;) if the current best point is good enough and &quot;CONTINUE&quot; if it is not.&lt;br/&gt;
It is indeed very much like the existing &lt;tt&gt;converged&lt;/tt&gt; method but the main idea is that the default convergence check (the one tied with the optimization algorithm) will always have a higher priority: if it passes, we exit from the iteration loop. The callback is a &lt;em&gt;second&lt;/em&gt; check that gives the opportunity to exit earlier if some additional, user-defined, criteria are met.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Combining the last two points, we&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;always provide a self-consistent behaviour in the simple use-cases&lt;/li&gt;
	&lt;li&gt;make it clear that the user can optionally define an &quot;out-of-band&quot; checking criterion: it is clearly independent in that any parameter (apart from the previous and current points) used to check convergence must be separately collected and passed to the constructor of the callback.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="12905071" author="luc" created="Wed, 1 Sep 2010 16:08:11 +0000"  >&lt;p&gt;Your two-step feature seems fine to me.&lt;br/&gt;
The callback can even be exactly the existing convergence checker we already have as its sole method returns a boolean which is basically equivalent to a SUCCESS/CONTINUE alternative and it would be simpler for users to upgrade to the new design.&lt;br/&gt;
Documentation should state that first level double threshold must always be passed and only the checker is optional and used if not null.&lt;/p&gt;</comment>
                            <comment id="12906465" author="erans" created="Mon, 6 Sep 2010 09:13:18 +0000"  >&lt;p&gt;Revision 992976 resolves the problems indicated in point 1, 2 and 10  for &lt;tt&gt;BrentOptimizer&lt;/tt&gt;, &lt;tt&gt;PowellOptimizer&lt;/tt&gt; and &lt;tt&gt;LevenbergMarquardtOptimizer&lt;/tt&gt;: there is a default (always applied) convergence check and a additional (optional) one defined with a sub-class of &lt;tt&gt;ConvergenceChecker&lt;/tt&gt;.&lt;br/&gt;
The other optimizer classes must still be upgraded to this 2-level check.&lt;/p&gt;</comment>
                            <comment id="12913995" author="erans" created="Thu, 23 Sep 2010 12:12:49 +0000"  >&lt;p&gt;Point 13 resolved in revision 1000422.&lt;/p&gt;</comment>
                            <comment id="12935350" author="erans" created="Wed, 24 Nov 2010 15:08:02 +0000"  >&lt;p&gt;About point 6 (initialization of the &lt;tt&gt;ConvergenceChecker&lt;/tt&gt;):&lt;/p&gt;

&lt;p&gt;I think the safest would be to pass it as argument to the constructor(s). So, we would have, on the one hand, constructors that take the arguments for the &quot;standard&quot; convergence criterion of the algorithm and, on the other, constructors that take a &lt;tt&gt;ConvergenceChecker&lt;/tt&gt; argument. That way, the same kind of information (how to stop) is passed at the same place (the constructors).&lt;br/&gt;
And I&apos;d remove the &lt;tt&gt;setConvergenceChecker&lt;/tt&gt; (another step towards immutability).&lt;/p&gt;

&lt;p&gt;This procedure will also &quot;force&quot; implementations that use &quot;line search&quot; to take the necessary precaution of syncing the tolerances of the internal optimizer or solver. It is a problem for &lt;tt&gt;PowellOptimizer&lt;/tt&gt; and, I just noticed, for &lt;tt&gt;NonLinearConjugateGradientOptimizer&lt;/tt&gt;: A user unaware of the workings of the algorithm might use unnecessarily low tolerances thresholds for the line search, so that the line search computation will be take a needlessly high number iterations.&lt;br/&gt;
When given the &quot;main&quot; algorithm&apos;s tolerance levels, the constructor should adapt the tolerance of its internal optimizer.&lt;/p&gt;

&lt;p&gt;The would also entail the removal of the &lt;tt&gt;setLineSearchSolver&lt;/tt&gt; method in &lt;tt&gt;NonLinearConjugateGradientOptimizer&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="13068356" author="luc" created="Wed, 20 Jul 2011 13:17:18 +0000"  >&lt;p&gt;Coming back to this old issue.&lt;/p&gt;

&lt;p&gt;I&apos;m fine with previous Gilles comment about passing the checker as argument to constructor.&lt;/p&gt;</comment>
                            <comment id="13087026" author="erans" created="Thu, 18 Aug 2011 14:12:22 +0000"  >&lt;p&gt;&lt;tt&gt;GaussNewtonOptimizer&lt;/tt&gt; updated in revision 1159233.&lt;/p&gt;</comment>
                            <comment id="13090885" author="erans" created="Thu, 25 Aug 2011 09:29:12 +0000"  >&lt;p&gt;&lt;tt&gt;LevenbergMarquardtOptimizer&lt;/tt&gt; updated in revision 1161463.&lt;/p&gt;</comment>
                            <comment id="13095264" author="erans" created="Thu, 1 Sep 2011 12:32:44 +0000"  >&lt;p&gt;&lt;tt&gt;NonLinearConjugateGradientOptimizer&lt;/tt&gt; updated in revision 1164044.&lt;/p&gt;</comment>
                            <comment id="13095677" author="erans" created="Thu, 1 Sep 2011 23:38:10 +0000"  >&lt;p&gt;&lt;tt&gt;SimplexOptimizer&lt;/tt&gt; updated in revision 1164300.&lt;/p&gt;</comment>
                            <comment id="13095682" author="erans" created="Fri, 2 Sep 2011 00:07:57 +0000"  >&lt;p&gt;&lt;tt&gt;PowellOptimizer&lt;/tt&gt; updated in revision 1164303.&lt;/p&gt;</comment>
                            <comment id="13206798" author="erans" created="Mon, 13 Feb 2012 10:46:26 +0000"  >&lt;p&gt;No comments for a long time; remaining issues, if any, probably have their own ticket. Thus, resolving.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12471107">MATH-404</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12470105">MATH-394</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12470266">MATH-397</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2242</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 40 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rumf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160605</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>