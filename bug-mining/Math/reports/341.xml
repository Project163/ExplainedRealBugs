<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:23:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-789] Correlated random vector generator fails (silently) when faced with zero rows in covariance matrix</title>
                <link>https://issues.apache.org/jira/browse/MATH-789</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;The following three matrices (which are basically permutations of each other) produce different results when sampling a multi-variate Gaussian with the help of CorrelatedRandomVectorGenerator (sample covariances calculated in R, based on 10,000 samples):&lt;/p&gt;

&lt;p&gt;Array2DRowRealMatrix&lt;/p&gt;
{
{0.0,0.0,0.0,0.0,0.0}
&lt;p&gt;,&lt;/p&gt;
{0.0,0.013445532,0.01039469,0.009881156,0.010499559}
&lt;p&gt;,&lt;/p&gt;
{0.0,0.01039469,0.023006616,0.008196856,0.010732709}
&lt;p&gt;,&lt;/p&gt;
{0.0,0.009881156,0.008196856,0.019023866,0.009210099}
&lt;p&gt;,&lt;br/&gt;
{0.0,0.010499559,0.010732709,0.009210099,0.019107243}}&lt;/p&gt;

&lt;p&gt;&amp;gt; cov(data1)&lt;br/&gt;
   V1 V2 V3 V4 V5&lt;br/&gt;
V1 0 0.000000000 0.00000000 0.000000000 0.000000000&lt;br/&gt;
V2 0 0.013383931 0.01034401 0.009913271 0.010506733&lt;br/&gt;
V3 0 0.010344006 0.02309479 0.008374730 0.010759306&lt;br/&gt;
V4 0 0.009913271 0.00837473 0.019005488 0.009187287&lt;br/&gt;
V5 0 0.010506733 0.01075931 0.009187287 0.019021483&lt;/p&gt;

&lt;p&gt;Array2DRowRealMatrix&lt;/p&gt;
{
{0.013445532,0.01039469,0.0,0.009881156,0.010499559}
&lt;p&gt;,&lt;/p&gt;
{0.01039469,0.023006616,0.0,0.008196856,0.010732709}
&lt;p&gt;,&lt;/p&gt;
{0.0,0.0,0.0,0.0,0.0},
{0.009881156,0.008196856,0.0,0.019023866,0.009210099},&lt;br/&gt;
{0.010499559,0.010732709,0.0,0.009210099,0.019107243}}&lt;br/&gt;
&lt;br/&gt;
&amp;gt; cov(data2)&lt;br/&gt;
            V1 V2 V3 V4 V5&lt;br/&gt;
V1 0.006922905 0.010507692 0 0.005817399 0.010330529&lt;br/&gt;
V2 0.010507692 0.023428918 0 0.008273152 0.010735568&lt;br/&gt;
V3 0.000000000 0.000000000 0 0.000000000 0.000000000&lt;br/&gt;
V4 0.005817399 0.008273152 0 0.004929843 0.009048759&lt;br/&gt;
V5 0.010330529 0.010735568 0 0.009048759 0.018683544 &lt;br/&gt;
&lt;br/&gt;
Array2DRowRealMatrix{
{0.013445532,0.01039469,0.009881156,0.010499559},
{0.01039469,0.023006616,0.008196856,0.010732709},
{0.009881156,0.008196856,0.019023866,0.009210099},&lt;br/&gt;
{0.010499559,0.010732709,0.009210099,0.019107243}}&lt;br/&gt;
&lt;br/&gt;
&amp;gt; cov(data3)&lt;br/&gt;
            V1          V2          V3          V4&lt;br/&gt;
V1 0.013445047 0.010478862 0.009955904 0.010529542&lt;br/&gt;
V2 0.010478862 0.022910522 0.008610113 0.011046353&lt;br/&gt;
V3 0.009955904 0.008610113 0.019250975 0.009464442&lt;br/&gt;
V4 0.010529542 0.011046353 0.009464442 0.019260317&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
I&apos;ve traced this back to the RectangularCholeskyDecomposition, which does not seem to handle the second matrix very well (decompositions in the same order as the matrices above):&lt;br/&gt;
&lt;br/&gt;
CorrelatedRandomVectorGenerator.getRootMatrix() = &lt;br/&gt;
Array2DRowRealMatrix{{0.0,0.0,0.0,0.0,0.0}
&lt;p&gt;,&lt;/p&gt;
{0.0759577418122063,0.0876125188474239,0.0,0.0,0.0}
&lt;p&gt;,&lt;/p&gt;
{0.07764443622513505,0.05132821221460752,0.11976381821791235,0.0,0.0}
&lt;p&gt;,&lt;/p&gt;
{0.06662930527909404,0.05501661744114585,0.0016662506519307997,0.10749324207653632,0.0}
&lt;p&gt;,{0.13822895138139477,0.0,0.0,0.0,0.0}}&lt;br/&gt;
CorrelatedRandomVectorGenerator.getRank() = 5&lt;/p&gt;

&lt;p&gt;CorrelatedRandomVectorGenerator.getRootMatrix() = &lt;br/&gt;
Array2DRowRealMatrix{{0.0759577418122063,0.034512751379448724,0.0},&lt;/p&gt;
{0.07764443622513505,0.13029949164628746,0.0}
&lt;p&gt;,&lt;/p&gt;
{0.0,0.0,0.0}
&lt;p&gt;,&lt;/p&gt;
{0.06662930527909404,0.023203936694855674,0.0}
&lt;p&gt;,{0.13822895138139477,0.0,0.0}}&lt;br/&gt;
CorrelatedRandomVectorGenerator.getRank() = 3&lt;/p&gt;

&lt;p&gt;CorrelatedRandomVectorGenerator.getRootMatrix() = &lt;br/&gt;
Array2DRowRealMatrix{{0.0759577418122063,0.034512751379448724,0.033913748226348225,0.07303890149947785},&lt;/p&gt;
{0.07764443622513505,0.13029949164628746,0.0,0.0}
&lt;p&gt;,&lt;/p&gt;
{0.06662930527909404,0.023203936694855674,0.11851573313229945,0.0}
&lt;p&gt;,{0.13822895138139477,0.0,0.0,0.0}}&lt;br/&gt;
CorrelatedRandomVectorGenerator.getRank() = 4&lt;/p&gt;

&lt;p&gt;Clearly, the rank of each of these matrices should be 4. The first matrix does not lead to incorrect results, but the second one does. Unfortunately, I don&apos;t know enough about the Cholesky decomposition to find the flaw in the implementation, and I could not find documentation for the &quot;rectangular&quot; variant (also not at the links provided in the javadoc).&lt;/p&gt;</description>
                <environment>&lt;p&gt;JDK 1.6 / Eclipse Indigo on Ubuntu 10.04&lt;/p&gt;</environment>
        <key id="12554463">MATH-789</key>
            <summary>Correlated random vector generator fails (silently) when faced with zero rows in covariance matrix</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="gertvv">Gert van Valkenhoef</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 May 2012 10:47:59 +0000</created>
                <updated>Mon, 4 Mar 2013 18:53:23 +0000</updated>
                            <resolved>Thu, 13 Sep 2012 15:19:07 +0000</resolved>
                                    <version>3.0</version>
                                    <fixVersion>3.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13272820" author="tn" created="Thu, 10 May 2012 22:02:51 +0000"  >&lt;p&gt;Hi Gert,&lt;/p&gt;

&lt;p&gt;thanks for the report. Could you please attach a test case for the described problem. This would really help investigating the problem.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Thomas&lt;/p&gt;</comment>
                            <comment id="13273263" author="gertvv" created="Fri, 11 May 2012 13:54:44 +0000"  >&lt;p&gt;Failing test case to reproduce bug (fails for covMatrix3).&lt;/p&gt;</comment>
                            <comment id="13273620" author="tn" created="Fri, 11 May 2012 21:11:56 +0000"  >&lt;p&gt;Thanks for the test.&lt;/p&gt;

&lt;p&gt;My first investigation is as follows:&lt;/p&gt;

&lt;p&gt;in the RectangularCholeskyDecomposition class, the following code does not actually produce the maximal diagonal element:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   // find maximal diagonal element
   swap[r] = r;
   for (int i = r + 1; i &amp;lt; order; ++i) {
       int ii = index[i];
       int isi = index[swap[i]];
       if (c[ii][ii] &amp;gt; c[isi][isi]) {
         swap[r] = i;
       }
   }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;thus the rank of the matrix is computed wrongly as the ordering of the columns is wrong and as a consequence the loop finishes too early. This can be fixed quite easily by changing index[swap&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;] to index[swap&lt;span class=&quot;error&quot;&gt;&amp;#91;r&amp;#93;&lt;/span&gt;].&lt;/p&gt;

&lt;p&gt;The increment of r seems also to be wrong in the case the diagonal element is smaller than the user-defined limit.&lt;/p&gt;

&lt;p&gt;When making the changes, the rank is correct, but the resulting root matrix is not very good (root * root.transpose() != covariance), thus the transformation of the matrix has to be further reviewed (I did not figure it out yet).&lt;/p&gt;

&lt;p&gt;Unfortunately there is no unit test for the RectangularCholeskyDecomposition yet, so this should be added in the process of fixing this issue. &lt;/p&gt;</comment>
                            <comment id="13454946" author="luc" created="Thu, 13 Sep 2012 15:19:07 +0000"  >&lt;p&gt;Fixed in subversion repository as of r1384363.&lt;/p&gt;

&lt;p&gt;The problem was due to some missing permutations in the root matrix. It seems the old fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-226&quot; title=&quot;CorrelatedRandomVectorGenerator generates invariant samples&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MATH-226&quot;&gt;&lt;del&gt;MATH-226&lt;/del&gt;&lt;/a&gt; was not good.&lt;/p&gt;

&lt;p&gt;Thanks for the report, and thanks to Thomas for the identification of the wrong maximum element detection.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12526521" name="MultivariateGaussianGeneratorTest.java" size="2847" author="gertvv" created="Fri, 11 May 2012 13:54:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>238705</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 10 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rt7j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160376</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>