<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:22:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-728] Errors in BOBYQAOptimizer when numberOfInterpolationPoints is greater than 2*dim+1</title>
                <link>https://issues.apache.org/jira/browse/MATH-728</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;I&apos;ve been having trouble getting BOBYQA to minimize a function (actually a non-linear least squares fit) so as one change I increased the number of interpolation points.  It seems that anything larger than 2*dim+1 causes an error (typically at&lt;/p&gt;

&lt;p&gt;line 1662&lt;br/&gt;
                   interpolationPoints.setEntry(nfm, ipt, interpolationPoints.getEntry(ipt, ipt));&lt;/p&gt;

&lt;p&gt;I&apos;m guessing there is an off by one error in the translation from FORTRAN.  Changing the BOBYQAOptimizerTest as follows (increasing number of interpolation points by one) will cause failures.&lt;/p&gt;

&lt;p&gt;Bruce&lt;/p&gt;



&lt;p&gt;Index: src/test/java/org/apache/commons/math/optimization/direct/BOBYQAOptimizerTest.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; src/test/java/org/apache/commons/math/optimization/direct/BOBYQAOptimizerTest.java	(revision 1221065)&lt;br/&gt;
+++ src/test/java/org/apache/commons/math/optimization/direct/BOBYQAOptimizerTest.java	(working copy)&lt;br/&gt;
@@ -258,7 +258,7 @@&lt;br/&gt;
 //        RealPointValuePair result = optim.optimize(100000, func, goal, startPoint);&lt;br/&gt;
         final double[] lB = boundaries == null ? null : boundaries&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;;&lt;br/&gt;
         final double[] uB = boundaries == null ? null : boundaries&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;BOBYQAOptimizer optim = new BOBYQAOptimizer(2 * dim + 1);&lt;br/&gt;
+        BOBYQAOptimizer optim = new BOBYQAOptimizer(2 * dim + 2);&lt;br/&gt;
         RealPointValuePair result = optim.optimize(maxEvaluations, func, goal, startPoint, lB, uB);&lt;br/&gt;
 //        System.out.println(func.getClass().getName() + &quot; = &quot; &lt;br/&gt;
 //              + optim.getEvaluations() + &quot; f(&quot;);&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>&lt;p&gt;Mac Java(TM) SE Runtime Environment (build 1.6.0_29-b11-402-11M3527)&lt;/p&gt;</environment>
        <key id="12535776">MATH-728</key>
            <summary>Errors in BOBYQAOptimizer when numberOfInterpolationPoints is greater than 2*dim+1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="bjohnson">Brady Allen Johnson</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Dec 2011 02:05:20 +0000</created>
                <updated>Sat, 24 Mar 2012 16:16:28 +0000</updated>
                            <resolved>Sat, 11 Feb 2012 23:15:55 +0000</resolved>
                                    <version>3.0</version>
                                    <fixVersion>3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13172888" author="bjohnson" created="Tue, 20 Dec 2011 03:22:04 +0000"  >&lt;p&gt;Making this change fixes the problem and seems reasonable, but one of the original translators (from FORTRAN to Java) should look this section of code over.&lt;/p&gt;


&lt;p&gt;@@ -1657,10 +1657,10 @@&lt;br/&gt;
                     final int tmp2 = jpt;&lt;br/&gt;
                     jpt = ipt - n;&lt;br/&gt;
                     ipt = tmp2;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;throw new PathIsExploredException(); // XXX&lt;br/&gt;
+                    //throw new PathIsExploredException(); // XXX&lt;br/&gt;
                 }&lt;/li&gt;
	&lt;li&gt;interpolationPoints.setEntry(nfm, ipt, interpolationPoints.getEntry(ipt, ipt));&lt;/li&gt;
	&lt;li&gt;interpolationPoints.setEntry(nfm, jpt, interpolationPoints.getEntry(jpt, jpt));&lt;br/&gt;
+                interpolationPoints.setEntry(nfm, ipt-1, interpolationPoints.getEntry(ipt, ipt-1));&lt;br/&gt;
+                interpolationPoints.setEntry(nfm, jpt-1, interpolationPoints.getEntry(jpt, jpt-1));&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="13173194" author="erans" created="Tue, 20 Dec 2011 13:47:18 +0000"  >&lt;p&gt;Thanks for spotting this. Revision 1221253 contains your fix, together with a unit test that exercises the setting of more interpolation points.&lt;/p&gt;</comment>
                            <comment id="13173238" author="bjohnson" created="Tue, 20 Dec 2011 15:15:25 +0000"  >&lt;p&gt;Thanks for checking this in, and it&apos;s worth noting that my function now minimizes properly.  It seems that with a large number of interpolation points there was an out of bounds error, but even where that out of bounds error wasn&apos;t thrown, the interpolation was set up wrong for the last few points, causing a failure to converge.  Others who have had trouble with convergence would do well to recheck with this fix.&lt;/p&gt;</comment>
                            <comment id="13173259" author="erans" created="Tue, 20 Dec 2011 15:43:35 +0000"  >&lt;p&gt;Anyone who wishes to use the &quot;BOBYQAOptimizer&quot; class should have a look at the &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-621&quot; title=&quot;BOBYQA is missing in optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MATH-621&quot;&gt;MATH-621&lt;/a&gt; issue.&lt;br/&gt;
As you have figured out, the code is really not ready yet. Unfortunately, the implementation being not &quot;natural&quot; in Java, it is not easy to separate algorithm complexity from Fortran-driven optimizations (which should be removed).&lt;br/&gt;
The problem is all compounded by the fall-through switch-cases which should also be recoded properly.&lt;/p&gt;

&lt;p&gt;We are still in the middle of the river: Many things have been improved structure-wise but bugs could have crept in while doing so. Bugs like the one you discovered.&lt;br/&gt;
And we don&apos;t have a thorough test suite to ensure that every code path works as in the original Fortran.&lt;/p&gt;

&lt;p&gt;The code was checked in under the assumption that it would be converted into &quot;natural&quot; Java, so that people can maintain it.&lt;br/&gt;
I wonder whether it should not be removed for the upcoming release...&lt;/p&gt;</comment>
                            <comment id="13173266" author="bjohnson" created="Tue, 20 Dec 2011 15:55:42 +0000"  >&lt;p&gt;I, for one, am very happy to see BOBYQA in CM and will continue with &quot;real world&quot; testing.  If I find more issues I&apos;ll certainly report them, but so far it&apos;s looking very promising with my applications.&lt;/p&gt;</comment>
                            <comment id="13175424" author="erans" created="Fri, 23 Dec 2011 13:40:59 +0000"  >&lt;p&gt;It would be very useful if you could provide unit tests that cover the still unexplored code paths (cf. lines containing &quot;throw new PathIsExploredException();&quot;).&lt;br/&gt;
Thanks in advance for your contributions.&lt;/p&gt;</comment>
                            <comment id="13203505" author="erans" created="Wed, 8 Feb 2012 12:14:27 +0000"  >&lt;p&gt;Hi Bruce.&lt;/p&gt;

&lt;p&gt;Would you be interested in testing your code with a large number of &quot;additional&quot; interpolation points?&lt;br/&gt;
I&apos;m referring to the unit test &quot;testConstrainedRosenWithMoreInterpolationPoints&quot; in &quot;BOBYQAOptimizerTest&quot;, at lines 236-256. It would be nice to know whether the failures, for some values of the number of points, reveal yet other bugs. (Or whether they are expected; in which case, the reason would be a welcome addition to the documentation...)&lt;/p&gt;</comment>
                            <comment id="13203540" author="bjohnson" created="Wed, 8 Feb 2012 12:46:26 +0000"  >&lt;p&gt;Hi Giles,&lt;/p&gt;

&lt;p&gt;I&apos;ll try to do so over the next couple days.&lt;/p&gt;

&lt;p&gt;cheers,&lt;/p&gt;

&lt;p&gt;Bruce&lt;/p&gt;</comment>
                            <comment id="13206281" author="bjohnson" created="Sat, 11 Feb 2012 22:11:55 +0000"  >&lt;p&gt;I&apos;ve been playing with BOBYQA (downloaded from svn repository today, and commenting out the PathNotExplored exceptions).  A couple observations.&lt;br/&gt;
1) I can&apos;t make it fail with large number of interpolation points (as long as you stay under the (2n+1)*(2n+2)/2 recommended max. So this issue is resolved.&lt;br/&gt;
2) With large number of interpolation points the algorithm is significantly slower.  I&apos;m minimizing a function  with a 169 parameters.  The function evaluation takes ~50 msec.  With n+2 interpolation points, the additional time for each step is about 10 msec.  With 2*n+1 points, the additional time is about 50 msec, and with about 6*n, the additional time is 250 msec.  So with larger nInterpolation points a lot of time is spent in the algorithm, besides evaluating the function.   At some point I&apos;ll try to do some profiling of the code.&lt;br/&gt;
3) It makes a big difference to normalize the parameters as the initial search region is dependent on the point with the smallest boundary difference.  So it seems one shouldn&apos;t directly fit the &quot;natural&quot; parameters but normalized values.&lt;/p&gt;</comment>
                            <comment id="13206296" author="erans" created="Sat, 11 Feb 2012 23:15:55 +0000"  >&lt;p&gt;Although the bug that triggered this issue is fixed, failures of the unit test still miss an explanation...&lt;/p&gt;

&lt;p&gt;The poor performance is to be expected given the current state of the code (e.g. many matrix calculations are done explicitly, with getters and setters, instead of calling methods of the matrix objects).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>221460</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 40 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0aop3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>60274</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>