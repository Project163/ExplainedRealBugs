<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:21:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-241] MathUtils.binomialCoefficient(n,k) fails for large results</title>
                <link>https://issues.apache.org/jira/browse/MATH-241</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;Probably due to rounding errors, MathUtils.binomialCoefficient(n,k) fails for results near Long.MAX_VALUE.&lt;/p&gt;

&lt;p&gt;The existence of failures can be demonstrated by testing the recursive property:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;         assertEquals(MathUtils.binomialCoefficient(65,32) + MathUtils.binomialCoefficient(65,33),
                 MathUtils.binomialCoefficient(66,33));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Or by directly using the (externally calculated and hopefully correct) expected value:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;         assertEquals(7219428434016265740L, MathUtils.binomialCoefficient(66,33));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I suggest a nonrecursive test implementation along the lines of&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;MathUtilsTest.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    /**
     * Exact implementation using BigInteger and the explicit formula
     * (n, k) == ((k-1)*...*n) / (1*...*(n-k))
     */
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; binomialCoefficient(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; n, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; k) {
		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (k == 0 || k == n)
			&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 1;
		BigInteger result = BigInteger.ONE;
		&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = k + 1; i &amp;lt;= n; i++) {
			result = result.multiply(BigInteger.valueOf(i));
		}
		&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 1; i &amp;lt;= n - k; i++) {
			result = result.divide(BigInteger.valueOf(i));
		}
		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (result.compareTo(BigInteger.valueOf(&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;.MAX_VALUE)) &amp;gt; 0) {
			&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArithmeticException(
                                &lt;span class=&quot;code-quote&quot;&gt;&quot;Binomial coefficient overflow: &quot;&lt;/span&gt; + n + &lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt; + k);
		}
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; result.longValue();
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;Which would allow you to test the expected values directly:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;         assertEquals(binomialCoefficient(66,33), MathUtils.binomialCoefficient(66,33));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12412642">MATH-241</key>
            <summary>MathUtils.binomialCoefficient(n,k) fails for large results</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="psteitz">Phil Steitz</assignee>
                                    <reporter username="chsemrau">Christian Semrau</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Jan 2009 23:34:23 +0000</created>
                <updated>Thu, 23 Apr 2009 02:26:20 +0000</updated>
                            <resolved>Mon, 19 Jan 2009 23:53:48 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12665187" author="psteitz" created="Mon, 19 Jan 2009 18:40:57 +0000"  >&lt;p&gt;First, thanks for reporting this.  Due to log/exp rounding and double/long conversion, the current code returns bad values for many long-representable values, starting as low as n = 48.  The returned value can be off by as much as 200,000.  The error in binomial(66, 29) is 214,880.  All b(n,k) for n &amp;lt; 48 are exact.&lt;/p&gt;

&lt;p&gt;Attached is a patch that ensures accuracy up to n = 200 (specified as a constant) and allows the user to force exact computation for values beyond this if desired.  For n &amp;lt;= 200, the implementation works like an unwound recursive implementation.   I also improved the accuracy of the double-valued and log versions.   The latter perform better than the current implementations, but the long-valued version is approximately 8x slower than the current version.  I did not benchmark the BigInteger version, but suspect that would be slower still.  The most accurate (for n &amp;lt;= 200) non-recursive formula that I could find is the one that I implemented in the double version.&lt;/p&gt;

&lt;p&gt;I also investigated overflow behavior and added tests to confirm correctness.  As stated in the API doc, overflows start at n = 67.  For n = 200,  values of k less than 14 or greater than 186 can still be computed without overflow; but all others throw ArithmeticException.&lt;/p&gt;

&lt;p&gt;I would appreciate feedback on the patch and any better ideas on how to fix the problem.&lt;/p&gt;</comment>
                            <comment id="12665249" author="chsemrau" created="Mon, 19 Jan 2009 22:05:59 +0000"  >&lt;p&gt;Attached is my version of a new binomialCoefficient function.&lt;/p&gt;</comment>
                            <comment id="12665253" author="chsemrau" created="Mon, 19 Jan 2009 22:16:06 +0000"  >&lt;p&gt;I think the recursive computation of Pascal&apos;s triangle (even with caching or dynamic programming) is unnecessarily complicated except to ensure correct values.&lt;/p&gt;

&lt;p&gt;The attached patch ensures accuracy for all values that can be represented as a long integer, with a running time proportional to k*log(k) (assuming gcd(i,j) takes log(j) steps). It should be faster than the current version for n &amp;lt;= 61, but for n &amp;gt; 61 my version computes as much as k different gcd values, which might be slower.&lt;/p&gt;

&lt;p&gt;I did not modify the double and log version, but your patch can be applied to these.&lt;/p&gt;</comment>
                            <comment id="12665284" author="psteitz" created="Mon, 19 Jan 2009 23:53:48 +0000"  >&lt;p&gt;Applied second patch along with changes to double, log versions from first patch in r735879.  Many thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12398252" name="binomialPatch.txt" size="15426" author="psteitz" created="Mon, 19 Jan 2009 18:40:57 +0000"/>
                            <attachment id="12398265" name="binomialPatch_cs.txt" size="7965" author="chsemrau" created="Mon, 19 Jan 2009 22:05:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34152</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 44 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rvnz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160774</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>