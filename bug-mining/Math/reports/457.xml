<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:24:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-1101] QR and Rank-revealing QR fail to find a least-squares solution</title>
                <link>https://issues.apache.org/jira/browse/MATH-1101</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;QR and RRQR (rank-revealing) algorithms fail to find a least-squares solution in some cases.&lt;/p&gt;

&lt;p&gt;The following code:&lt;/p&gt;

&lt;p&gt;final RealMatrix A = new BlockRealMatrix(3, 3);&lt;br/&gt;
        A.setEntry(0, 0, 1);&lt;br/&gt;
        A.setEntry(0, 1, 6);&lt;br/&gt;
        A.setEntry(0, 2, 4);&lt;br/&gt;
        A.setEntry(1, 0, 2);&lt;br/&gt;
        A.setEntry(1, 1, 4);&lt;br/&gt;
        A.setEntry(1, 2, -1);&lt;br/&gt;
        A.setEntry(2, 0, -1);&lt;br/&gt;
        A.setEntry(2, 1, 2);&lt;br/&gt;
        A.setEntry(2, 2, 5);&lt;br/&gt;
        final RealVector b = new ArrayRealVector(new double[]&lt;/p&gt;
{5, 6, 1}
&lt;p&gt;);&lt;br/&gt;
        final QRDecomposition qrDecomposition = new QRDecomposition(A);&lt;br/&gt;
        final RRQRDecomposition rrqrDecomposition = new RRQRDecomposition(A);&lt;br/&gt;
        final SingularValueDecomposition svd = new SingularValueDecomposition(A);&lt;br/&gt;
        final RealVector xQR = qrDecomposition.getSolver().solve(b);&lt;br/&gt;
        System.out.printf(&quot;QR solution: %s\n&quot;, xQR.toString());&lt;br/&gt;
        final RealVector xRRQR = rrqrDecomposition.getSolver().solve(b);&lt;br/&gt;
        System.out.printf(&quot;RRSQ solution: %s\n&quot;, xRRQR.toString());&lt;br/&gt;
        final RealVector xSVD = svd.getSolver().solve(b);&lt;br/&gt;
        System.out.printf(&quot;SVD solution: %s\n&quot;, xSVD.toString());&lt;/p&gt;

&lt;p&gt;produces&lt;/p&gt;

&lt;p&gt;QR solution: {-3,575,212,378,628,897; 1,462,586,882,166,368; -1,300,077,228,592,326.5}&lt;br/&gt;
RRSQ solution: &lt;/p&gt;
{5,200,308,914,369,308; -2,127,399,101,332,898; 1,891,021,423,407,021}
&lt;p&gt;SVD solution: &lt;/p&gt;
{0.5050344462; 1.0206677266; -0.2405935347}

&lt;p&gt;Showing that QR and RRQR algorithms fail to find the least-squares solution. This can also be verified by calculating the dot product between columns of A and A*x - b:&lt;/p&gt;

&lt;p&gt;// x = xQR, xRRQR or xSVD&lt;br/&gt;
final RealVector r = A.operate&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.subtract(b);&lt;br/&gt;
        for (int i = 0; i &amp;lt; x.getDimension(); ++i) &lt;/p&gt;
{
            final RealVector columnVector = A.getColumnVector(i);
            assertEquals(name, 0.0, r.dotProduct(columnVector), tolerance);
        }

&lt;p&gt;Only SVD method passes this test with decent tolerance (1E-14 or so).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12696499">MATH-1101</key>
            <summary>QR and Rank-revealing QR fail to find a least-squares solution</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="roman.werpachowski">Roman Werpachowski</reporter>
                        <labels>
                            <label>solver</label>
                    </labels>
                <created>Fri, 21 Feb 2014 11:39:16 +0000</created>
                <updated>Mon, 19 May 2014 15:13:24 +0000</updated>
                            <resolved>Sun, 23 Feb 2014 11:15:32 +0000</resolved>
                                    <version>3.2</version>
                                    <fixVersion>3.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13908199" author="roman.werpachowski" created="Fri, 21 Feb 2014 11:41:48 +0000"  >&lt;p&gt;Attached test code for convenience.&lt;/p&gt;</comment>
                            <comment id="13908324" author="luc" created="Fri, 21 Feb 2014 13:50:56 +0000"  >&lt;p&gt;I am not sure to understand. The matrix is exactly singular here, which is correctly identified if you pass a threshold of about 2e-16 to the QRDecomposition constructor (without passing it, the default threshold is an exact 0). With the default 0 threshold, the last diagonal element is really small (8.88e-16) and using it implies computing big values.&lt;/p&gt;

&lt;p&gt;As all dimensions are 3, I don&apos;t understand were you intend to have a least squares solution. What is attempted here seems to be computing a full linear solution of a singular problem.&lt;/p&gt;</comment>
                            <comment id="13908980" author="roman.werpachowski" created="Fri, 21 Feb 2014 23:19:49 +0000"  >&lt;p&gt;In this case the description of QRDecomposition.getSolver() is misleading, since it says:&lt;/p&gt;

&lt;p&gt;&quot;Get a solver for finding the A &#215; X = B solution in least square sense.&quot; (same for RRQRDecomposition).&lt;/p&gt;

&lt;p&gt;Also the documentation in &lt;a href=&quot;http://commons.apache.org/proper/commons-math/userguide/linear.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://commons.apache.org/proper/commons-math/userguide/linear.html&lt;/a&gt; says that the QR decomposition method can handle any matrix and return a least squares solution.&lt;/p&gt;

&lt;p&gt;If the QRDecomposition works better with non-zero threshold, then it may be worth considering changing the default threshold value from zero, since the current default behaviour is not what the user might expect based on the documentation.&lt;/p&gt;

&lt;p&gt;Finally, it is always possible to have a least squares solution of || A * x - b ||^2, because the norm is bounded from below by zero and diverges to infinity as the norm of x goes to infinity. The solution may not be unique though. Also note that the SVD solver returns a much more sensible solution, which minimizes || A * x - b ||^2.&lt;/p&gt;</comment>
                            <comment id="13909750" author="luc" created="Sun, 23 Feb 2014 11:15:32 +0000"  >&lt;p&gt;Documentation has been improved as of r1570994, both in the javadoc and in the user guide.&lt;/p&gt;

&lt;p&gt;Concerning the default threshold to 0, the decision to keep this value was taken when discussing issue &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-664&quot; title=&quot;Replace &amp;quot;LUDecompostionImpl&amp;quot; with &amp;quot;QRDecompositionImpl&amp;quot; in &amp;quot;AbstractLeastSquaresOptimizer&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MATH-664&quot;&gt;&lt;del&gt;MATH-664&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Our implementation of QR decomposition does not try to circumvent singular matrices by itself. I am not sure about this feature as it may fool the user into thinking everything is OK when in fact the matrix was singular and an approximate solution was found when the user expected an exact one.&lt;/p&gt;</comment>
                            <comment id="14001803" author="luc" created="Mon, 19 May 2014 15:13:24 +0000"  >&lt;p&gt;Closing all resolved issue now available in released 3.3 version.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12630290" name="math-1101-bug.java" size="1737" author="roman.werpachowski" created="Fri, 21 Feb 2014 11:41:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>374975</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 26 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1sm8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>375274</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>