<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:24:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-1205] AbstractStorelessUnivariateStatistic should not extend AbstractUnivariateStatistic</title>
                <link>https://issues.apache.org/jira/browse/MATH-1205</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;For a storeless statistic it is wrong to extend AbstractUnivariateStatistic as various fields and methods are inherited that do not make sense in case of a storeless statistic.&lt;/p&gt;

&lt;p&gt;This means a user can accidentially use a storeless statistic in a wrong way:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        Mean mean = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Mean();
        
        mean.increment(1);
        mean.increment(2);
        
        mean.setData(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] { 1, 2, 3});
        
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(mean.getResult());
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(mean.evaluate());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;will output&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;1.5
2.0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12776430">MATH-1205</key>
            <summary>AbstractStorelessUnivariateStatistic should not extend AbstractUnivariateStatistic</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tn">Thomas Neidhart</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Feb 2015 12:44:56 +0000</created>
                <updated>Mon, 13 Apr 2015 20:17:48 +0000</updated>
                            <resolved>Mon, 13 Apr 2015 20:17:48 +0000</resolved>
                                    <version>3.4.1</version>
                                    <fixVersion>4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14329170" author="psteitz" created="Fri, 20 Feb 2015 17:04:41 +0000"  >&lt;p&gt;+1 to fix this for 4.x&lt;/p&gt;</comment>
                            <comment id="14330465" author="tn" created="Sat, 21 Feb 2015 22:45:14 +0000"  >&lt;p&gt;I am working on  a patch, but there are at least two other odd things that I have seen wrt storeless statistics:&lt;/p&gt;

&lt;p&gt;a) default implementation of equals / hashCode that compares solely on getResult() and getN(): I fail to see a use-case for this and it means that two different types of storeless statistics are considered to be equal if their current state is equal:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Mean m = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Mean();
Variance v = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Variance();        
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(m.equals(v)); &lt;span class=&quot;code-comment&quot;&gt;// outputs &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I find this very strange, especially as a default.&lt;/p&gt;

&lt;p&gt;b) evaluate(double[], ...): the default implementation in AbstractStorelessUnivariateStatistic does the following:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;clear the internal result&lt;/li&gt;
	&lt;li&gt;call increment for all input values in the array&lt;/li&gt;
	&lt;li&gt;return the result&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;thus the method alters the internal state, which is different for non-storeless statistics.&lt;br/&gt;
Some storeless statistics override this method, e.g. Mean to do something else: calculate the result using an intermediate object and then return the result without altering state. This is quite confusing imho.&lt;/p&gt;</comment>
                            <comment id="14330470" author="psteitz" created="Sat, 21 Feb 2015 23:05:35 +0000"  >&lt;p&gt;+1 to drop the default equals override&lt;/p&gt;

&lt;p&gt;On the second point, I think it would be best to modify the default evaluate to clear after it computes the result.  Alternatively, implementations could be required to addAll in overrides.  I think the first is a little better, as it conforms to what the current impls generally do and the contract is simpler. &lt;/p&gt;
</comment>
                            <comment id="14491622" author="tn" created="Sun, 12 Apr 2015 18:07:23 +0000"  >&lt;p&gt;Attached a patch with the following changes:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;added class AbstractCachingUnivariateStatistic which extends AbstractUnivariateStatistic and contains the storedData field and corresponding methods&lt;/li&gt;
	&lt;li&gt;Percentile extends now AbstractCachingUnivariateStatistic&lt;/li&gt;
	&lt;li&gt;fix AbstractStorelessUnivariateStatistic#evaluate(double[], int, int) method to be consistent with the other implementations: it does not alter the internal state anymore, but instead creates first a copy of the current statistic and the calls clear() and incrementAll() on the copy instead.&lt;/li&gt;
	&lt;li&gt;fix AbstractStorelessUnivariateStatistic#equals(Object): the equality check will only succeed for statistics of the same class. This might be useful, although I am not 100% sure, we might also just remove the default equals/hashCode.&lt;/li&gt;
	&lt;li&gt;fix Variance#evaluate(...) methods: they altered the internal state by calling clear(), although the javadoc stated the opposite.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If preferred, I can also make separate issues for the bullets, currently the changes.xml contains separate entries for all of them, but without a ticket number.&lt;/p&gt;

&lt;p&gt;btw. the storedData fields and methods have been introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-417&quot; title=&quot;improve performance of Percentile&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MATH-417&quot;&gt;&lt;del&gt;MATH-417&lt;/del&gt;&lt;/a&gt; to improve the performance of the Percentile class, but have not been used for any other class.&lt;/p&gt;</comment>
                            <comment id="14491662" author="tn" created="Sun, 12 Apr 2015 19:11:23 +0000"  >&lt;p&gt;Updated patch as it was missing a file.&lt;/p&gt;</comment>
                            <comment id="14491663" author="psteitz" created="Sun, 12 Apr 2015 19:13:23 +0000"  >&lt;p&gt;The storedData field was introduced in 2.2 because in Percentile we needed to sort and just working on the actual parameter was, well, dubious.  It may not be depended on by other impls; but the fact that the impl gets a copy instead of a reference to the actual parameter is a &lt;b&gt;good thing&lt;/b&gt;, so +1 to keeping it and in fact just renaming (if necessary) AbstractUnivariateStatistic instead of extending it. There is no need for this excess hierarchy now that the storeless classes no longer extend AUS.  I would be +0 to just leaving things alone (leave AUS as is, but break the inheritance of ASUS).  &lt;/p&gt;

&lt;p&gt;I am +0 on just dropping the equals/hc impls.&lt;/p&gt;

&lt;p&gt;Otherwise, +1 for  the proposed changes.&lt;/p&gt;

&lt;p&gt;I like the changelog style you have, but I would reference this ticket on each entry.&lt;/p&gt;</comment>
                            <comment id="14491664" author="tn" created="Sun, 12 Apr 2015 19:17:00 +0000"  >&lt;p&gt;Added missing file: newly added files are not part of a git diff command.&lt;/p&gt;</comment>
                            <comment id="14491666" author="tn" created="Sun, 12 Apr 2015 19:21:37 +0000"  >&lt;p&gt;I wanted to keep AbstractUnivariateStatistic for the following reasons:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;javadoc states that it is the base class for all UnivariateStatistic implementations, so I did not want to change that&lt;/li&gt;
	&lt;li&gt;there are various test(...) methods which are used by the storeless statistics, so this would have to be copied somewhere else or duplicated&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;That&apos;s the reason why I created the AbstractCachingUnivariateStatistic. btw the AbstractStorelessUnivariateStatistic still inherits from AUS for the reason mentioned above.&lt;/p&gt;</comment>
                            <comment id="14491678" author="psteitz" created="Sun, 12 Apr 2015 19:43:54 +0000"  >&lt;p&gt;The way I see it is that with this change, AUS is the base class for univariate stats that store data.  I don&apos;t see the need for the totem pole there.  The test methods could be moved to MathArrays (which is not a bad idea in itself - they are really just array validation methods).&lt;/p&gt;</comment>
                            <comment id="14491685" author="tn" created="Sun, 12 Apr 2015 20:03:07 +0000"  >&lt;p&gt;ok agreed, but there is still the special case of the SemiVariance which is not storeless, but also does not use the stored data in some way.&lt;/p&gt;</comment>
                            <comment id="14491707" author="psteitz" created="Sun, 12 Apr 2015 20:42:06 +0000"  >&lt;p&gt;It does use storedData, like all of the Storeless impls do, via its evaluate() method.&lt;/p&gt;</comment>
                            <comment id="14493000" author="tn" created="Mon, 13 Apr 2015 20:17:48 +0000"  >&lt;p&gt;Committed patch with discussed changes in commit 845e1d54231d3ff3fb04bdbf5dc5f6b631d9b01e.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12724840" name="AbstractCachingUnivariateStatistic.java" size="4133" author="tn" created="Sun, 12 Apr 2015 19:17:00 +0000"/>
                            <attachment id="12724839" name="MATH-1205_v2.patch" size="91387" author="tn" created="Sun, 12 Apr 2015 19:11:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 31 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25urz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>