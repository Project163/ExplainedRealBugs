{"url":"https://api.github.com/repos/glfw/glfw/issues/1225","repository_url":"https://api.github.com/repos/glfw/glfw","labels_url":"https://api.github.com/repos/glfw/glfw/issues/1225/labels{/name}","comments_url":"https://api.github.com/repos/glfw/glfw/issues/1225/comments","events_url":"https://api.github.com/repos/glfw/glfw/issues/1225/events","html_url":"https://github.com/glfw/glfw/issues/1225","id":301600950,"node_id":"MDU6SXNzdWUzMDE2MDA5NTA=","number":1225,"title":"glfwPlatformPollEvents can hang, assumes other code won't pull XEvents","user":{"login":"johnjosephorr","id":5215421,"node_id":"MDQ6VXNlcjUyMTU0MjE=","avatar_url":"https://avatars.githubusercontent.com/u/5215421?v=4","gravatar_id":"","url":"https://api.github.com/users/johnjosephorr","html_url":"https://github.com/johnjosephorr","followers_url":"https://api.github.com/users/johnjosephorr/followers","following_url":"https://api.github.com/users/johnjosephorr/following{/other_user}","gists_url":"https://api.github.com/users/johnjosephorr/gists{/gist_id}","starred_url":"https://api.github.com/users/johnjosephorr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/johnjosephorr/subscriptions","organizations_url":"https://api.github.com/users/johnjosephorr/orgs","repos_url":"https://api.github.com/users/johnjosephorr/repos","events_url":"https://api.github.com/users/johnjosephorr/events{/privacy}","received_events_url":"https://api.github.com/users/johnjosephorr/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":36425440,"node_id":"MDU6TGFiZWwzNjQyNTQ0MA==","url":"https://api.github.com/repos/glfw/glfw/labels/bug","name":"bug","color":"b60205","default":true,"description":"Bug reports and bugfix pull requests"},{"id":37361231,"node_id":"MDU6TGFiZWwzNzM2MTIzMQ==","url":"https://api.github.com/repos/glfw/glfw/labels/X11","name":"X11","color":"3b80ae","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"elmindreda","id":133714,"node_id":"MDQ6VXNlcjEzMzcxNA==","avatar_url":"https://avatars.githubusercontent.com/u/133714?v=4","gravatar_id":"","url":"https://api.github.com/users/elmindreda","html_url":"https://github.com/elmindreda","followers_url":"https://api.github.com/users/elmindreda/followers","following_url":"https://api.github.com/users/elmindreda/following{/other_user}","gists_url":"https://api.github.com/users/elmindreda/gists{/gist_id}","starred_url":"https://api.github.com/users/elmindreda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elmindreda/subscriptions","organizations_url":"https://api.github.com/users/elmindreda/orgs","repos_url":"https://api.github.com/users/elmindreda/repos","events_url":"https://api.github.com/users/elmindreda/events{/privacy}","received_events_url":"https://api.github.com/users/elmindreda/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"elmindreda","id":133714,"node_id":"MDQ6VXNlcjEzMzcxNA==","avatar_url":"https://avatars.githubusercontent.com/u/133714?v=4","gravatar_id":"","url":"https://api.github.com/users/elmindreda","html_url":"https://github.com/elmindreda","followers_url":"https://api.github.com/users/elmindreda/followers","following_url":"https://api.github.com/users/elmindreda/following{/other_user}","gists_url":"https://api.github.com/users/elmindreda/gists{/gist_id}","starred_url":"https://api.github.com/users/elmindreda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elmindreda/subscriptions","organizations_url":"https://api.github.com/users/elmindreda/orgs","repos_url":"https://api.github.com/users/elmindreda/repos","events_url":"https://api.github.com/users/elmindreda/events{/privacy}","received_events_url":"https://api.github.com/users/elmindreda/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/glfw/glfw/milestones/12","html_url":"https://github.com/glfw/glfw/milestone/12","labels_url":"https://api.github.com/repos/glfw/glfw/milestones/12/labels","id":1586124,"node_id":"MDk6TWlsZXN0b25lMTU4NjEyNA==","number":12,"title":"3.3","description":"","creator":{"login":"elmindreda","id":133714,"node_id":"MDQ6VXNlcjEzMzcxNA==","avatar_url":"https://avatars.githubusercontent.com/u/133714?v=4","gravatar_id":"","url":"https://api.github.com/users/elmindreda","html_url":"https://github.com/elmindreda","followers_url":"https://api.github.com/users/elmindreda/followers","following_url":"https://api.github.com/users/elmindreda/following{/other_user}","gists_url":"https://api.github.com/users/elmindreda/gists{/gist_id}","starred_url":"https://api.github.com/users/elmindreda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elmindreda/subscriptions","organizations_url":"https://api.github.com/users/elmindreda/orgs","repos_url":"https://api.github.com/users/elmindreda/repos","events_url":"https://api.github.com/users/elmindreda/events{/privacy}","received_events_url":"https://api.github.com/users/elmindreda/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":266,"state":"closed","created_at":"2016-02-16T16:04:47Z","updated_at":"2019-07-21T23:55:22Z","due_on":null,"closed_at":"2019-04-16T00:42:23Z"},"comments":7,"created_at":"2018-03-01T23:38:29Z","updated_at":"2018-05-29T13:54:29Z","closed_at":"2018-05-18T10:03:06Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"from master/src/x11_window.c:\r\n\r\n```c++\r\nvoid _glfwPlatformPollEvents(void)\r\n{\r\n    _GLFWwindow* window;\r\n\r\n#if defined(__linux__)\r\n    _glfwDetectJoystickConnectionLinux();\r\n#endif\r\n    int count = XPending(_glfw.x11.display);\r\n    while (count--)\r\n    {\r\n        XEvent event;\r\n        XNextEvent(_glfw.x11.display, &event);\r\n        processEvent(&event);\r\n    }\r\n```\r\nThis code assumes that it will be the only code removing the \"count\" number of XEvent's from the queue (it assumes it can call XNextEvent \"count\" number of times and it will not block waiting for input).  If something else should pull an XEvent off the queue (or perhaps Xlib will cancel events or coalesce multiple events that are currently on the queue?) this code will call XNextEvent more times than it should to process the events that are currently on the queue and will block inside XNextEvent until something generates new events.\r\n\r\nOn a normal computer there is a person with a mouse and keyboard who will typically generate more events, but on a system driving a non-interactive display of some kind, there is no one at the keyboard or mouse, so this code can hang.\r\n\r\nIn my case, I modified this loop to check XPending before calling XNextEvent:\r\n\r\n```c++\r\n    while (count--)\r\n    {\r\n        if ( XPending(_glfw.x11.display) > 0 )\r\n        {\r\n            XEvent event;\r\n            XNextEvent(_glfw.x11.display, &event);\r\n            processEvent(&event);\r\n        }\r\n    }\r\n```\r\n\r\nI intentionally left the cap in here on \"count\" number of loops so it does not process more than the original set of events, which matches the original behavior.  \r\n\r\nIf it matters, I ran into this while using Cinder which uses glfw in Linux only.  \r\n","closed_by":{"login":"elmindreda","id":133714,"node_id":"MDQ6VXNlcjEzMzcxNA==","avatar_url":"https://avatars.githubusercontent.com/u/133714?v=4","gravatar_id":"","url":"https://api.github.com/users/elmindreda","html_url":"https://github.com/elmindreda","followers_url":"https://api.github.com/users/elmindreda/followers","following_url":"https://api.github.com/users/elmindreda/following{/other_user}","gists_url":"https://api.github.com/users/elmindreda/gists{/gist_id}","starred_url":"https://api.github.com/users/elmindreda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elmindreda/subscriptions","organizations_url":"https://api.github.com/users/elmindreda/orgs","repos_url":"https://api.github.com/users/elmindreda/repos","events_url":"https://api.github.com/users/elmindreda/events{/privacy}","received_events_url":"https://api.github.com/users/elmindreda/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/glfw/glfw/issues/1225/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/glfw/glfw/issues/1225/timeline","performed_via_github_app":null,"state_reason":"completed"}