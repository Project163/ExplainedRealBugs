{"url":"https://api.github.com/repos/glfw/glfw/issues/2365","repository_url":"https://api.github.com/repos/glfw/glfw","labels_url":"https://api.github.com/repos/glfw/glfw/issues/2365/labels{/name}","comments_url":"https://api.github.com/repos/glfw/glfw/issues/2365/comments","events_url":"https://api.github.com/repos/glfw/glfw/issues/2365/events","html_url":"https://github.com/glfw/glfw/issues/2365","id":1803254482,"node_id":"I_kwDOAJFXBc5re3rS","number":2365,"title":"EGL_EXT_present_opaque attribute causes eglCreateWindowSurface to fail","user":{"login":"mosra","id":344828,"node_id":"MDQ6VXNlcjM0NDgyOA==","avatar_url":"https://avatars.githubusercontent.com/u/344828?v=4","gravatar_id":"","url":"https://api.github.com/users/mosra","html_url":"https://github.com/mosra","followers_url":"https://api.github.com/users/mosra/followers","following_url":"https://api.github.com/users/mosra/following{/other_user}","gists_url":"https://api.github.com/users/mosra/gists{/gist_id}","starred_url":"https://api.github.com/users/mosra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mosra/subscriptions","organizations_url":"https://api.github.com/users/mosra/orgs","repos_url":"https://api.github.com/users/mosra/repos","events_url":"https://api.github.com/users/mosra/events{/privacy}","received_events_url":"https://api.github.com/users/mosra/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":36425440,"node_id":"MDU6TGFiZWwzNjQyNTQ0MA==","url":"https://api.github.com/repos/glfw/glfw/labels/bug","name":"bug","color":"b60205","default":true,"description":"Bug reports and bugfix pull requests"},{"id":37361231,"node_id":"MDU6TGFiZWwzNzM2MTIzMQ==","url":"https://api.github.com/repos/glfw/glfw/labels/X11","name":"X11","color":"3b80ae","default":false,"description":null},{"id":37364584,"node_id":"MDU6TGFiZWwzNzM2NDU4NA==","url":"https://api.github.com/repos/glfw/glfw/labels/verified","name":"verified","color":"0e8a16","default":false,"description":"Reproduced or otherwise verified bugs"},{"id":258215373,"node_id":"MDU6TGFiZWwyNTgyMTUzNzM=","url":"https://api.github.com/repos/glfw/glfw/labels/Nvidia","name":"Nvidia","color":"CCFF00","default":false,"description":"Nvidia GPU specific (any OS or driver)"},{"id":1318696347,"node_id":"MDU6TGFiZWwxMzE4Njk2MzQ3","url":"https://api.github.com/repos/glfw/glfw/labels/EGL","name":"EGL","color":"AE1116","default":false,"description":"EGL API specific"}],"state":"closed","locked":false,"assignee":{"login":"elmindreda","id":133714,"node_id":"MDQ6VXNlcjEzMzcxNA==","avatar_url":"https://avatars.githubusercontent.com/u/133714?v=4","gravatar_id":"","url":"https://api.github.com/users/elmindreda","html_url":"https://github.com/elmindreda","followers_url":"https://api.github.com/users/elmindreda/followers","following_url":"https://api.github.com/users/elmindreda/following{/other_user}","gists_url":"https://api.github.com/users/elmindreda/gists{/gist_id}","starred_url":"https://api.github.com/users/elmindreda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elmindreda/subscriptions","organizations_url":"https://api.github.com/users/elmindreda/orgs","repos_url":"https://api.github.com/users/elmindreda/repos","events_url":"https://api.github.com/users/elmindreda/events{/privacy}","received_events_url":"https://api.github.com/users/elmindreda/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"elmindreda","id":133714,"node_id":"MDQ6VXNlcjEzMzcxNA==","avatar_url":"https://avatars.githubusercontent.com/u/133714?v=4","gravatar_id":"","url":"https://api.github.com/users/elmindreda","html_url":"https://github.com/elmindreda","followers_url":"https://api.github.com/users/elmindreda/followers","following_url":"https://api.github.com/users/elmindreda/following{/other_user}","gists_url":"https://api.github.com/users/elmindreda/gists{/gist_id}","starred_url":"https://api.github.com/users/elmindreda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elmindreda/subscriptions","organizations_url":"https://api.github.com/users/elmindreda/orgs","repos_url":"https://api.github.com/users/elmindreda/repos","events_url":"https://api.github.com/users/elmindreda/events{/privacy}","received_events_url":"https://api.github.com/users/elmindreda/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/glfw/glfw/milestones/23","html_url":"https://github.com/glfw/glfw/milestone/23","labels_url":"https://api.github.com/repos/glfw/glfw/milestones/23/labels","id":8185249,"node_id":"MI_kwDOAJFXBc4AfOWh","number":23,"title":"3.3.9","description":"","creator":{"login":"elmindreda","id":133714,"node_id":"MDQ6VXNlcjEzMzcxNA==","avatar_url":"https://avatars.githubusercontent.com/u/133714?v=4","gravatar_id":"","url":"https://api.github.com/users/elmindreda","html_url":"https://github.com/elmindreda","followers_url":"https://api.github.com/users/elmindreda/followers","following_url":"https://api.github.com/users/elmindreda/following{/other_user}","gists_url":"https://api.github.com/users/elmindreda/gists{/gist_id}","starred_url":"https://api.github.com/users/elmindreda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elmindreda/subscriptions","organizations_url":"https://api.github.com/users/elmindreda/orgs","repos_url":"https://api.github.com/users/elmindreda/repos","events_url":"https://api.github.com/users/elmindreda/events{/privacy}","received_events_url":"https://api.github.com/users/elmindreda/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":29,"state":"closed","created_at":"2022-07-11T18:36:03Z","updated_at":"2024-02-05T16:21:00Z","due_on":null,"closed_at":"2023-12-12T17:59:26Z"},"comments":1,"created_at":"2023-07-13T15:18:23Z","updated_at":"2023-12-07T16:04:15Z","closed_at":"2023-12-07T16:02:30Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hello, \r\n\r\nwith https://github.com/glfw/glfw/commit/6281f498c875f49d8ac5c5a02d968fb1792fd9f5 that's included in GLFW 3.3.7+, the `EGL_PRESENT_OPAQUE_EXT` attribute is unconditionally used in the `eglCreateWindowSurface()` call (assuming the client code sets `glfwWindowHint(GLFW_CONTEXT_CREATION_API, GLFW_EGL_CONTEXT_API)` to pick EGL over GLX). When using GLFW built for X11 (in my case the [glfw-x11](https://archlinux.org/packages/extra/x86_64/glfw-x11/) ArchLinux package), with NVidia drivers (in particular 535.54.03, other versions probably have the same problem) I get the following error:\r\n\r\n```\r\nEGL: Failed to create window surface: An unrecognized attribute or attribute value was passed in the attribute list\r\n```\r\n\r\nI checked with `apitrace trace --api=egl`, the `EGL_PRESENT_OPAQUE_EXT` was the only attribute passed in the attribute list, and using GLFW 3.3.6 (which doesn't set this attribute yet) worked. As far as I could tell, `EGL_EXT_present_opaque` is reported as supported by NVidia, it's just that the driver doesn't seem to recognize it correctly on X11. With Mesa (where `eglinfo` reports the extension as supported as well), everything works. In other words, this doesn't seem to be a bug in GLFW, but -- as far as I can tell -- in NVidia drivers.\r\n\r\nOn Wayland, from what I could gather in https://github.com/glfw/glfw/issues/1434 and https://github.com/glfw/glfw/issues/1803, this is essential to do there to prevent the window from being transparent by accident, and there I assume the NVidia driver works correctly (relevant changes being in https://github.com/NVIDIA/egl-wayland/commit/e1165add0492e7b4b2c7c0ce76011e6f31067642 I think). However, there's also this: https://github.com/kovidgoyal/kitty/issues/5479\r\n\r\nApart from waiting for NVidia to fix this (if it gets fixed at all), I'm not sure what would be the best workaround. Some ideas:\r\n\r\n- Don't set `EGL_EXT_present_opaque` attributes at all on an X11 build. As far as I could tell, using GLFW 3.3.6 (which doesn't set this attribute) wasn't causing any rendering artifacts or accidental transparency on X11. To me this seems like the easiest path to success.\r\n- Treat `EGL_EXT_present_opaque` as not supported on NVidia + X11, even if it reports it as being supported. Depending on whether you have any scaffolding for driver-specific workarounds in GLFW.\r\n- I saw there's `GLFW_TRANSPARENT_FRAMEBUFFER`, maybe it could be (ab)used in some way to control whether the `EGL_EXT_present_opaque` attribute gets used or not? Seems a bit messy though, and it'd move the responsibility of working around driver bugs to unsuspecting users.\r\n- Or maybe there's some way to \"fake\" the EGL extension list GLFW uses, so I could convince it that `EGL_EXT_present_opaque` isn't supported? Which is again moving the responsibility of working around driver bugs to the user, but at least something.\r\n\r\nThank you!","closed_by":{"login":"elmindreda","id":133714,"node_id":"MDQ6VXNlcjEzMzcxNA==","avatar_url":"https://avatars.githubusercontent.com/u/133714?v=4","gravatar_id":"","url":"https://api.github.com/users/elmindreda","html_url":"https://github.com/elmindreda","followers_url":"https://api.github.com/users/elmindreda/followers","following_url":"https://api.github.com/users/elmindreda/following{/other_user}","gists_url":"https://api.github.com/users/elmindreda/gists{/gist_id}","starred_url":"https://api.github.com/users/elmindreda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elmindreda/subscriptions","organizations_url":"https://api.github.com/users/elmindreda/orgs","repos_url":"https://api.github.com/users/elmindreda/repos","events_url":"https://api.github.com/users/elmindreda/events{/privacy}","received_events_url":"https://api.github.com/users/elmindreda/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/glfw/glfw/issues/2365/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/glfw/glfw/issues/2365/timeline","performed_via_github_app":null,"state_reason":"completed"}