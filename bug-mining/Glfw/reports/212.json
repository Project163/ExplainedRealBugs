{"url":"https://api.github.com/repos/glfw/glfw/issues/1150","repository_url":"https://api.github.com/repos/glfw/glfw","labels_url":"https://api.github.com/repos/glfw/glfw/issues/1150/labels{/name}","comments_url":"https://api.github.com/repos/glfw/glfw/issues/1150/comments","events_url":"https://api.github.com/repos/glfw/glfw/issues/1150/events","html_url":"https://github.com/glfw/glfw/issues/1150","id":278157500,"node_id":"MDU6SXNzdWUyNzgxNTc1MDA=","number":1150,"title":"segfault during startup in sway/wayland","user":{"login":"Spotlight0xff","id":3098388,"node_id":"MDQ6VXNlcjMwOTgzODg=","avatar_url":"https://avatars.githubusercontent.com/u/3098388?v=4","gravatar_id":"","url":"https://api.github.com/users/Spotlight0xff","html_url":"https://github.com/Spotlight0xff","followers_url":"https://api.github.com/users/Spotlight0xff/followers","following_url":"https://api.github.com/users/Spotlight0xff/following{/other_user}","gists_url":"https://api.github.com/users/Spotlight0xff/gists{/gist_id}","starred_url":"https://api.github.com/users/Spotlight0xff/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Spotlight0xff/subscriptions","organizations_url":"https://api.github.com/users/Spotlight0xff/orgs","repos_url":"https://api.github.com/users/Spotlight0xff/repos","events_url":"https://api.github.com/users/Spotlight0xff/events{/privacy}","received_events_url":"https://api.github.com/users/Spotlight0xff/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":36425440,"node_id":"MDU6TGFiZWwzNjQyNTQ0MA==","url":"https://api.github.com/repos/glfw/glfw/labels/bug","name":"bug","color":"b60205","default":true,"description":"Bug reports and bugfix pull requests"},{"id":89092389,"node_id":"MDU6TGFiZWw4OTA5MjM4OQ==","url":"https://api.github.com/repos/glfw/glfw/labels/Wayland","name":"Wayland","color":"ffbc00","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/glfw/glfw/milestones/12","html_url":"https://github.com/glfw/glfw/milestone/12","labels_url":"https://api.github.com/repos/glfw/glfw/milestones/12/labels","id":1586124,"node_id":"MDk6TWlsZXN0b25lMTU4NjEyNA==","number":12,"title":"3.3","description":"","creator":{"login":"elmindreda","id":133714,"node_id":"MDQ6VXNlcjEzMzcxNA==","avatar_url":"https://avatars.githubusercontent.com/u/133714?v=4","gravatar_id":"","url":"https://api.github.com/users/elmindreda","html_url":"https://github.com/elmindreda","followers_url":"https://api.github.com/users/elmindreda/followers","following_url":"https://api.github.com/users/elmindreda/following{/other_user}","gists_url":"https://api.github.com/users/elmindreda/gists{/gist_id}","starred_url":"https://api.github.com/users/elmindreda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elmindreda/subscriptions","organizations_url":"https://api.github.com/users/elmindreda/orgs","repos_url":"https://api.github.com/users/elmindreda/repos","events_url":"https://api.github.com/users/elmindreda/events{/privacy}","received_events_url":"https://api.github.com/users/elmindreda/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":266,"state":"closed","created_at":"2016-02-16T16:04:47Z","updated_at":"2019-07-21T23:55:22Z","due_on":null,"closed_at":"2019-04-16T00:42:23Z"},"comments":7,"created_at":"2017-11-30T15:17:55Z","updated_at":"2018-02-22T11:54:55Z","closed_at":"2018-01-29T01:03:25Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"GLFW @ `3.2.1` crashes for me under sway (0.15.0) and libwayland (`wayland-git` in arch linux (`1.14.90.2028.5d201df-1`).\r\n\r\nThis segfault happens during startup and is _probably_ due to some not yet initialized structs.\r\nI could fix this when I added a simple check for `surface == NULL` in `keyboardHandleEnter` (src/wl_init.c).\r\nBut I don't know if this is the preferred way to fix this properly, I have no prior experience in GLFW (except for using it, thanks for the awesome library btw!)\r\n\r\nOS and version:\r\nArch Linux 4.13.12-1-ARCH #1 SMP PREEMPT Wed Nov 8 11:54:06 CET 2017 x86_64 GNU/Linux\r\n\r\nSee backtrace and output below.\r\n\r\n```\r\nProgram received signal SIGSEGV, Segmentation fault.\r\nwl_proxy_get_user_data (proxy=0x0) at src/wayland-client.c:1905\r\n1905\t\treturn proxy->user_data;\r\n(gdb) bt\r\n#0  wl_proxy_get_user_data (proxy=0x0) at src/wayland-client.c:1905\r\n#1  0x00007ffff79b9582 in wl_surface_get_user_data (wl_surface=0x0) at /usr/include/wayland-client-protocol.h:3377\r\n#2  0x00007ffff79b9c23 in keyboardHandleEnter (data=0x0, keyboard=0x5555555b76c0, serial=2482, surface=0x0, keys=0x555555d6ca40)\r\n    at [..]/libs/glfw/src/wl_init.c:233\r\n#3  0x00007ffff5ba91c8 in ffi_call_unix64 () from /usr/lib/libffi.so.6\r\n#4  0x00007ffff5ba8c2a in ffi_call () from /usr/lib/libffi.so.6\r\n#5  0x00007ffff7bd1d1b in wl_closure_invoke (closure=closure@entry=0x555555d6c970, flags=flags@entry=1, target=<optimized out>, target@entry=0x5555555b76c0, opcode=opcode@entry=1, \r\n    data=<optimized out>) at src/connection.c:935\r\n#6  0x00007ffff7bce898 in dispatch_event (display=<optimized out>, queue=<optimized out>) at src/wayland-client.c:1310\r\n#7  0x00007ffff7bcfb44 in dispatch_queue (queue=0x5555555b1178, display=0x5555555b10b0) at src/wayland-client.c:1456\r\n#8  wl_display_dispatch_queue_pending (display=0x5555555b10b0, queue=0x5555555b1178) at src/wayland-client.c:1698\r\n#9  0x00007ffff79bc5fd in handleEvents (timeout=0) at [..]/libs/glfw/src/wl_window.c:296\r\n#10 0x00007ffff79bceed in _glfwPlatformPollEvents () at [..]/libs/glfw/src/wl_window.c:639\r\n#11 0x00007ffff79b9305 in glfwPollEvents () at [..]/libs/glfw/src/window.c:869\r\n#12 0x00007ffff7f724d7 in glow::glfw::GlfwApp::updateInput (this=0x7fffffffd810) at [..]/GlfwApp.cc:448\r\n#13 0x00007ffff7f71b4c in glow::glfw::GlfwApp::mainLoop (this=0x7fffffffd810) at [..]/GlfwApp.cc:335\r\n#14 0x00007ffff7f731b4 in glow::glfw::GlfwApp::run (this=0x7fffffffd810, argc=1, argv=0x7fffffffdc98)\r\n    at [..]/GlfwApp.cc:622\r\n#15 0x00005555555739e5 in main (argc=1, argv=0x7fffffffdc98) at [..]/main.cc:6\r\n```\r\n\r\nThe relevant wayland-client output (using the debug variable) is here:\r\n```\r\n[1254455.434]  -> wl_display@1.get_registry(new id wl_registry@2)\r\n[1254455.489]  -> wl_display@1.sync(new id wl_callback@3)\r\n[1254455.544] wl_display@1.delete_id(3)\r\n[1254455.555] wl_registry@2.global(1, \"wl_shm\", 1)\r\n[1254455.566]  -> wl_registry@2.bind(1, \"wl_shm\", 1, new id [unknown]@4)\r\n[1254455.574] wl_registry@2.global(2, \"wl_compositor\", 3)\r\n[1254455.580]  -> wl_registry@2.bind(2, \"wl_compositor\", 3, new id [unknown]@5)\r\n[1254455.587] wl_registry@2.global(3, \"wl_subcompositor\", 1)\r\n[1254455.592] wl_registry@2.global(4, \"wl_data_device_manager\", 3)\r\n[1254455.598] wl_registry@2.global(5, \"wl_seat\", 4)\r\n[1254455.607]  -> wl_registry@2.bind(5, \"wl_seat\", 1, new id [unknown]@6)\r\n[1254455.617] wl_registry@2.global(6, \"wl_shell\", 1)\r\n[1254455.623]  -> wl_registry@2.bind(6, \"wl_shell\", 1, new id [unknown]@7)\r\n[1254455.633] wl_registry@2.global(7, \"zxdg_shell_v6\", 1)\r\n[1254455.639] wl_registry@2.global(8, \"desktop_shell\", 3)\r\n[1254455.645] wl_registry@2.global(9, \"lock\", 1)\r\n[1254455.654] wl_registry@2.global(10, \"gamma_control_manager\", 1)\r\n[1254455.663] wl_registry@2.global(11, \"org_kde_kwin_server_decoration_manager\", 1)\r\n[1254455.672] wl_registry@2.global(12, \"wl_output\", 2)\r\n[1254455.689]  -> wl_registry@2.bind(12, \"wl_output\", 2, new id [unknown]@8)\r\n[1254455.699] wl_registry@2.global(13, \"wl_drm\", 2)\r\n[1254455.709] wl_callback@3.done(2479)\r\n[1254455.715]  -> wl_display@1.sync(new id wl_callback@3)\r\n[1254455.752] wl_display@1.delete_id(3)\r\n[1254455.757] wl_seat@6.capabilities(7)\r\n[1254455.761]  -> wl_seat@6.get_pointer(new id wl_pointer@9)\r\n[1254455.765]  -> wl_seat@6.get_keyboard(new id wl_keyboard@10)\r\n[1254455.769] wl_output@8.geometry(0, 0, 340, 190, 1, \"drm\", \"unknown\", 0)\r\n[1254455.782] wl_output@8.scale(1)\r\n[1254455.785] wl_output@8.mode(3, 1920, 1080, 60000)\r\n[1254455.791] wl_output@8.mode(0, 1920, 1080, 48000)\r\n[1254455.798] wl_output@8.done()\r\n[1254455.801] wl_callback@3.done(2479)\r\n[1254455.897]  -> wl_shm@4.create_pool(new id wl_shm_pool@3, fd 6, 4096)\r\n[1254456.070]  -> wl_shm_pool@3.resize(12288)\r\n[1254456.141]  -> wl_shm_pool@3.resize(28672)\r\n[1254456.259]  -> wl_shm_pool@3.resize(61440)\r\n[1254457.837]  -> wl_shm_pool@3.resize(126976)\r\n[1254457.881]  -> wl_shm_pool@3.resize(258048)\r\n[1254457.959]  -> wl_shm_pool@3.resize(520192)\r\n[1254460.315]  -> wl_shm_pool@3.resize(1044480)\r\n[1254463.386]  -> wl_shm_pool@3.resize(2093056)\r\n[1254476.964]  -> wl_compositor@5.create_surface(new id wl_surface@11)\r\n[1254476.984]  -> wl_compositor@5.create_surface(new id wl_surface@12)\r\n[1254476.991]  -> wl_compositor@5.create_region(new id wl_region@13)\r\n[1254476.995]  -> wl_region@13.add(0, 0, 1280, 720)\r\n[1254477.001]  -> wl_surface@12.set_opaque_region(wl_region@13)\r\n[1254477.005]  -> wl_surface@12.commit()\r\n[1254477.007]  -> wl_region@13.destroy()\r\n[1254488.844]  -> wl_display@1.get_registry(new id wl_registry@14)\r\n[1254488.865]  -> wl_display@1.sync(new id wl_callback@15)\r\n[1254489.924] wl_display@1.delete_id(13)\r\n[1254489.933] wl_display@1.delete_id(15)\r\n[1254489.936] wl_registry@14.global(1, \"wl_shm\", 1)\r\n[1254489.941] wl_registry@14.global(2, \"wl_compositor\", 3)\r\n[1254489.945] wl_registry@14.global(3, \"wl_subcompositor\", 1)\r\n[1254489.950] wl_registry@14.global(4, \"wl_data_device_manager\", 3)\r\n[1254489.954] wl_registry@14.global(5, \"wl_seat\", 4)\r\n[1254489.959] wl_registry@14.global(6, \"wl_shell\", 1)\r\n[1254489.963] wl_registry@14.global(7, \"zxdg_shell_v6\", 1)\r\n[1254489.968] wl_registry@14.global(8, \"desktop_shell\", 3)\r\n[1254489.976] wl_registry@14.global(9, \"lock\", 1)\r\n[1254489.983] wl_registry@14.global(10, \"gamma_control_manager\", 1)\r\n[1254489.989] wl_registry@14.global(11, \"org_kde_kwin_server_decoration_manager\", 1)\r\n[1254489.995] wl_registry@14.global(12, \"wl_output\", 2)\r\n[1254490.004] wl_registry@14.global(13, \"wl_drm\", 2)\r\n[1254490.012]  -> wl_registry@14.bind(13, \"wl_drm\", 2, new id [unknown]@13)\r\n[1254490.020] wl_callback@15.done(2479)\r\n[1254490.025]  -> wl_display@1.sync(new id wl_callback@15)\r\n[1254490.051] wl_display@1.delete_id(15)\r\n[1254490.056] wl_drm@13.device(\"/dev/dri/card0\")\r\n[1254490.082]  -> wl_drm@13.authenticate(2)\r\n[1254490.087] wl_drm@13.format(875713089)\r\n[1254490.092] wl_drm@13.format(875713112)\r\n[1254490.095] wl_drm@13.format(909199186)\r\n[1254490.098] wl_drm@13.format(961959257)\r\n[1254490.101] wl_drm@13.format(825316697)\r\n[1254490.105] wl_drm@13.format(842093913)\r\n[1254490.108] wl_drm@13.format(909202777)\r\n[1254490.112] wl_drm@13.format(875713881)\r\n[1254490.116] wl_drm@13.format(842094158)\r\n[1254490.120] wl_drm@13.format(909203022)\r\n[1254490.124] wl_drm@13.format(1448695129)\r\n[1254490.128] wl_drm@13.capabilities(1)\r\n[1254490.134] wl_callback@15.done(2479)\r\n[1254490.140]  -> wl_display@1.sync(new id wl_callback@15)\r\n[1254490.163] wl_display@1.delete_id(15)\r\n[1254490.168] wl_drm@13.authenticated()\r\n[1254490.171] wl_callback@15.done(2479)\r\n[1254506.501]  -> wl_shell@7.get_shell_surface(new id wl_shell_surface@15, wl_surface@12)\r\n[1254506.519]  -> wl_shell_surface@15.set_title(\"GLFW/GLOW Application\")\r\n[1254506.523]  -> wl_shell_surface@15.set_toplevel()\r\n[1254513.498]  -> wl_surface@12.frame(new id wl_callback@16)\r\n[1254513.539]  -> wl_drm@13.create_prime_buffer(new id wl_buffer@17, fd 9, 1280, 720, 875713089, 0, 5120, 0, 0, 0, 0)\r\n[1254513.557]  -> wl_surface@12.attach(wl_buffer@17, 0, 0)\r\n[1254513.565]  -> wl_surface@12.damage(0, 0, 2147483647, 2147483647)\r\n[1254513.787]  -> wl_surface@12.commit()\r\n[1254513.865]  -> wl_buffer@17.destroy()\r\n[1254514.806]  -> wl_surface@12.destroy()\r\n[1254514.875]  -> wl_compositor@5.create_surface(new id wl_surface@18)\r\n[1254514.887]  -> wl_compositor@5.create_region(new id wl_region@19)\r\n[1254514.903]  -> wl_region@19.add(0, 0, 1280, 720)\r\n[1254514.922]  -> wl_surface@18.set_opaque_region(wl_region@19)\r\n[1254514.930]  -> wl_surface@18.commit()\r\n[1254514.935]  -> wl_region@19.destroy()\r\n[1254515.661]  -> wl_shell@7.get_shell_surface(new id wl_shell_surface@20, wl_surface@18)\r\n[1254515.685]  -> wl_shell_surface@20.set_title(\"GLFW/GLOW Application\")\r\n[1254515.689]  -> wl_shell_surface@20.set_toplevel()\r\n[1254519.720]  -> wl_surface@18.frame(new id wl_callback@21)\r\n[1254519.752]  -> wl_drm@13.create_prime_buffer(new id wl_buffer@22, fd 9, 1280, 720, 875713089, 0, 5120, 0, 0, 0, 0)\r\n[1254519.769]  -> wl_surface@18.attach(wl_buffer@22, 0, 0)\r\n[1254519.780]  -> wl_surface@18.damage(0, 0, 2147483647, 2147483647)\r\n[1254519.983]  -> wl_surface@18.commit()\r\n[1254645.798] wl_keyboard@10.keymap(1, fd 6, 48091)\r\n[1254647.530] wl_display@1.delete_id(17)\r\n[1254647.537] wl_display@1.delete_id(15)\r\n[1254647.540] wl_display@1.delete_id(16)\r\n[1254647.543] wl_display@1.delete_id(12)\r\n[1254647.545] wl_display@1.delete_id(19)\r\n[1254647.548] wl_display@1.delete_id(21)\r\n[1254647.550] wl_keyboard@10.modifiers(2481, 0, 0, 0, 0)\r\n[1254647.562] wl_keyboard@10.enter(2482, nil, array)\r\n```\r\n(then it crashes)","closed_by":{"login":"linkmauve","id":7755816,"node_id":"MDQ6VXNlcjc3NTU4MTY=","avatar_url":"https://avatars.githubusercontent.com/u/7755816?v=4","gravatar_id":"","url":"https://api.github.com/users/linkmauve","html_url":"https://github.com/linkmauve","followers_url":"https://api.github.com/users/linkmauve/followers","following_url":"https://api.github.com/users/linkmauve/following{/other_user}","gists_url":"https://api.github.com/users/linkmauve/gists{/gist_id}","starred_url":"https://api.github.com/users/linkmauve/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/linkmauve/subscriptions","organizations_url":"https://api.github.com/users/linkmauve/orgs","repos_url":"https://api.github.com/users/linkmauve/repos","events_url":"https://api.github.com/users/linkmauve/events{/privacy}","received_events_url":"https://api.github.com/users/linkmauve/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/glfw/glfw/issues/1150/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/glfw/glfw/issues/1150/timeline","performed_via_github_app":null,"state_reason":"completed"}