diff --git a/lib/CompatibilityPlugin.js b/lib/CompatibilityPlugin.js
index 529e7f71b..b86a64ea5 100644
--- a/lib/CompatibilityPlugin.js
+++ b/lib/CompatibilityPlugin.js
@@ -77,14 +77,14 @@ class CompatibilityPlugin {
 							statement.id.name === "__webpack_require__"
 						) {
 							const newName = `__nested_webpack_require_${statement.range[0]}__`;
-							const dep = new ConstDependency(newName, statement.id.range);
-							dep.loc = statement.id.loc;
-							parser.state.module.addPresentationalDependency(dep);
-							parser.tagVariable(
-								statement.id.name,
-								nestedWebpackRequireTag,
-								newName
-							);
+							parser.tagVariable(statement.id.name, nestedWebpackRequireTag, {
+								name: newName,
+								declaration: {
+									updated: false,
+									loc: statement.id.loc,
+									range: statement.id.range
+								}
+							});
 							return true;
 						}
 					});
@@ -92,21 +92,27 @@ class CompatibilityPlugin {
 						.for("__webpack_require__")
 						.tap("CompatibilityPlugin", pattern => {
 							const newName = `__nested_webpack_require_${pattern.range[0]}__`;
-							const dep = new ConstDependency(newName, pattern.range);
-							dep.loc = pattern.loc;
-							parser.state.module.addPresentationalDependency(dep);
-							parser.tagVariable(
-								pattern.name,
-								nestedWebpackRequireTag,
-								newName
-							);
+							parser.tagVariable(pattern.name, nestedWebpackRequireTag, {
+								name: newName,
+								declaration: {
+									updated: false,
+									loc: pattern.loc,
+									range: pattern.range
+								}
+							});
 							return true;
 						});
 					parser.hooks.expression
 						.for(nestedWebpackRequireTag)
 						.tap("CompatibilityPlugin", expr => {
-							const newName = parser.currentTagData;
-							const dep = new ConstDependency(newName, expr.range);
+							const { name, declaration } = parser.currentTagData;
+							if (!declaration.updated) {
+								const dep = new ConstDependency(name, declaration.range);
+								dep.loc = declaration.loc;
+								parser.state.module.addPresentationalDependency(dep);
+								declaration.updated = true;
+							}
+							const dep = new ConstDependency(name, expr.range);
 							dep.loc = expr.loc;
 							parser.state.module.addPresentationalDependency(dep);
 							return true;
diff --git a/lib/EvalDevToolModulePlugin.js b/lib/EvalDevToolModulePlugin.js
index dd625f754..089547aa6 100644
--- a/lib/EvalDevToolModulePlugin.js
+++ b/lib/EvalDevToolModulePlugin.js
@@ -6,6 +6,7 @@
 "use strict";
 
 const { ConcatSource, RawSource } = require("webpack-sources");
+const ExternalModule = require("./ExternalModule");
 const ModuleFilenameHelpers = require("./ModuleFilenameHelpers");
 const JavascriptModulesPlugin = require("./javascript/JavascriptModulesPlugin");
 
@@ -47,6 +48,10 @@ class EvalDevToolModulePlugin {
 				(source, module, { runtimeTemplate, chunkGraph }) => {
 					const cacheEntry = cache.get(source);
 					if (cacheEntry !== undefined) return cacheEntry;
+					if (module instanceof ExternalModule) {
+						cache.set(source, source);
+						return source;
+					}
 					const content = source.source();
 					const str = ModuleFilenameHelpers.createFilename(
 						module,
diff --git a/test/configCases/library/0-create-library/webpack.config.js b/test/configCases/library/0-create-library/webpack.config.js
index ae13a75e8..e19a7bca3 100644
--- a/test/configCases/library/0-create-library/webpack.config.js
+++ b/test/configCases/library/0-create-library/webpack.config.js
@@ -71,6 +71,14 @@ module.exports = (env, { testPath }) => [
 		},
 		externals: ["external"]
 	},
+	{
+		mode: "development",
+		output: {
+			filename: "commonjs2-external-eval.js",
+			libraryTarget: "commonjs2"
+		},
+		externals: ["external"]
+	},
 	{
 		output: {
 			filename: "index.js",
diff --git a/test/configCases/library/1-use-library/webpack.config.js b/test/configCases/library/1-use-library/webpack.config.js
index 749684820..a5b40d5eb 100644
--- a/test/configCases/library/1-use-library/webpack.config.js
+++ b/test/configCases/library/1-use-library/webpack.config.js
@@ -69,6 +69,23 @@ module.exports = (env, { testPath }) => [
 			})
 		]
 	},
+	{
+		resolve: {
+			alias: {
+				library: path.resolve(
+					testPath,
+					"../0-create-library/commonjs2-external-eval.js"
+				),
+				external: path.resolve(__dirname, "node_modules/external.js")
+			}
+		},
+		plugins: [
+			new webpack.DefinePlugin({
+				NAME: JSON.stringify("commonjs2 with external and eval devtool"),
+				TEST_EXTERNAL: true
+			})
+		]
+	},
 	{
 		resolve: {
 			alias: {
