diff --git a/lib/DllPlugin.js b/lib/DllPlugin.js
index 3795af124..0d6d03753 100644
--- a/lib/DllPlugin.js
+++ b/lib/DllPlugin.js
@@ -6,7 +6,7 @@
 "use strict";
 
 const DllEntryPlugin = require("./DllEntryPlugin");
-const FlagInitialModulesAsUsedPlugin = require("./FlagInitialModulesAsUsedPlugin");
+const FlagAllModulesAsUsedPlugin = require("./FlagAllModulesAsUsedPlugin");
 const LibManifestPlugin = require("./LibManifestPlugin");
 
 const validateOptions = require("schema-utils");
@@ -45,7 +45,7 @@ class DllPlugin {
 		});
 		new LibManifestPlugin(this.options).apply(compiler);
 		if (!this.options.entryOnly) {
-			new FlagInitialModulesAsUsedPlugin("DllPlugin").apply(compiler);
+			new FlagAllModulesAsUsedPlugin("DllPlugin").apply(compiler);
 		}
 	}
 }
diff --git a/lib/FlagAllModulesAsUsedPlugin.js b/lib/FlagAllModulesAsUsedPlugin.js
new file mode 100644
index 000000000..1c5641ee5
--- /dev/null
+++ b/lib/FlagAllModulesAsUsedPlugin.js
@@ -0,0 +1,38 @@
+/*
+	MIT License http://www.opensource.org/licenses/mit-license.php
+	Author Tobias Koppers @sokra
+*/
+
+"use strict";
+
+/** @typedef {import("./Compiler")} Compiler */
+
+class FlagAllModulesAsUsedPlugin {
+	constructor(explanation) {
+		this.explanation = explanation;
+	}
+
+	/**
+	 * @param {Compiler} compiler webpack compiler
+	 * @returns {void}
+	 */
+	apply(compiler) {
+		compiler.hooks.compilation.tap(
+			"FlagAllModulesAsUsedPlugin",
+			compilation => {
+				const moduleGraph = compilation.moduleGraph;
+				compilation.hooks.optimizeDependencies.tap(
+					"FlagAllModulesAsUsedPlugin",
+					modules => {
+						for (const module of modules) {
+							moduleGraph.getExportsInfo(module).setUsedInUnknownWay();
+							moduleGraph.addExtraReason(module, this.explanation);
+						}
+					}
+				);
+			}
+		);
+	}
+}
+
+module.exports = FlagAllModulesAsUsedPlugin;
diff --git a/lib/FlagInitialModulesAsUsedPlugin.js b/lib/FlagInitialModulesAsUsedPlugin.js
deleted file mode 100644
index e79f5a8bd..000000000
--- a/lib/FlagInitialModulesAsUsedPlugin.js
+++ /dev/null
@@ -1,44 +0,0 @@
-/*
-	MIT License http://www.opensource.org/licenses/mit-license.php
-	Author Tobias Koppers @sokra
-*/
-
-"use strict";
-
-/** @typedef {import("./Compiler")} Compiler */
-
-class FlagInitialModulesAsUsedPlugin {
-	constructor(explanation) {
-		this.explanation = explanation;
-	}
-
-	/**
-	 * @param {Compiler} compiler webpack compiler
-	 * @returns {void}
-	 */
-	apply(compiler) {
-		compiler.hooks.compilation.tap(
-			"FlagInitialModulesAsUsedPlugin",
-			compilation => {
-				const moduleGraph = compilation.moduleGraph;
-				compilation.hooks.afterOptimizeChunks.tap(
-					"FlagInitialModulesAsUsedPlugin",
-					chunks => {
-						const chunkGraph = compilation.chunkGraph;
-						for (const chunk of chunks) {
-							if (!chunk.isOnlyInitial()) {
-								return;
-							}
-							for (const module of chunkGraph.getChunkModulesIterable(chunk)) {
-								moduleGraph.getExportsInfo(module).setUsedInUnknownWay();
-								moduleGraph.addExtraReason(module, this.explanation);
-							}
-						}
-					}
-				);
-			}
-		);
-	}
-}
-
-module.exports = FlagInitialModulesAsUsedPlugin;
diff --git a/test/configCases/dll-plugin-side-effects/0-create-dll/dependency.js b/test/configCases/dll-plugin-side-effects/0-create-dll/dependency.js
new file mode 100644
index 000000000..1946cd07c
--- /dev/null
+++ b/test/configCases/dll-plugin-side-effects/0-create-dll/dependency.js
@@ -0,0 +1,3 @@
+export default function createB() {
+	return "b";
+}
diff --git a/test/configCases/dll-plugin-side-effects/0-create-dll/dependency2.js b/test/configCases/dll-plugin-side-effects/0-create-dll/dependency2.js
new file mode 100644
index 000000000..0809fdd01
--- /dev/null
+++ b/test/configCases/dll-plugin-side-effects/0-create-dll/dependency2.js
@@ -0,0 +1,3 @@
+export default function createC() {
+	return "c";
+}
diff --git a/test/configCases/dll-plugin-side-effects/0-create-dll/index.js b/test/configCases/dll-plugin-side-effects/0-create-dll/index.js
new file mode 100644
index 000000000..3a02fe46b
--- /dev/null
+++ b/test/configCases/dll-plugin-side-effects/0-create-dll/index.js
@@ -0,0 +1,3 @@
+import { a } from "./module";
+
+export default a();
diff --git a/test/configCases/dll-plugin-side-effects/0-create-dll/module.js b/test/configCases/dll-plugin-side-effects/0-create-dll/module.js
new file mode 100644
index 000000000..257c5b97d
--- /dev/null
+++ b/test/configCases/dll-plugin-side-effects/0-create-dll/module.js
@@ -0,0 +1,12 @@
+import createB from "./dependency";
+import createC from "./dependency2";
+
+export function a() {
+	return "a";
+}
+
+export { createB as b };
+
+export function c() {
+	return createC();
+}
diff --git a/test/configCases/dll-plugin-side-effects/0-create-dll/test.config.js b/test/configCases/dll-plugin-side-effects/0-create-dll/test.config.js
new file mode 100644
index 000000000..08ea6c319
--- /dev/null
+++ b/test/configCases/dll-plugin-side-effects/0-create-dll/test.config.js
@@ -0,0 +1 @@
+exports.noTests = true;
diff --git a/test/configCases/dll-plugin-side-effects/0-create-dll/webpack.config.js b/test/configCases/dll-plugin-side-effects/0-create-dll/webpack.config.js
new file mode 100644
index 000000000..390ae2422
--- /dev/null
+++ b/test/configCases/dll-plugin-side-effects/0-create-dll/webpack.config.js
@@ -0,0 +1,31 @@
+var path = require("path");
+var webpack = require("../../../../");
+
+module.exports = {
+	entry: ["./index"],
+	output: {
+		filename: "dll.js",
+		chunkFilename: "[id].dll.js",
+		libraryTarget: "commonjs2"
+	},
+	module: {
+		rules: [
+			{
+				test: /0-create-dll.(module|dependency)/,
+				sideEffects: false
+			}
+		]
+	},
+	optimization: {
+		usedExports: true,
+		sideEffects: true
+	},
+	plugins: [
+		new webpack.DllPlugin({
+			path: path.resolve(
+				__dirname,
+				"../../../js/config/dll-plugin-side-effects/manifest0.json"
+			)
+		})
+	]
+};
diff --git a/test/configCases/dll-plugin-side-effects/1-use-dll/index.js b/test/configCases/dll-plugin-side-effects/1-use-dll/index.js
new file mode 100644
index 000000000..db354f9f5
--- /dev/null
+++ b/test/configCases/dll-plugin-side-effects/1-use-dll/index.js
@@ -0,0 +1,9 @@
+it("should include all exports and modules in the dll", function() {
+	const { a, b, c } = require("dll/module");
+	expect(typeof a).toBe("function");
+	expect(a()).toBe("a");
+	expect(typeof b).toBe("function");
+	expect(b()).toBe("b");
+	expect(typeof c).toBe("function");
+	expect(c()).toBe("c");
+});
diff --git a/test/configCases/dll-plugin-side-effects/1-use-dll/webpack.config.js b/test/configCases/dll-plugin-side-effects/1-use-dll/webpack.config.js
new file mode 100644
index 000000000..8d1738807
--- /dev/null
+++ b/test/configCases/dll-plugin-side-effects/1-use-dll/webpack.config.js
@@ -0,0 +1,12 @@
+var webpack = require("../../../../");
+
+module.exports = {
+	plugins: [
+		new webpack.DllReferencePlugin({
+			manifest: require("../../../js/config/dll-plugin-side-effects/manifest0.json"), // eslint-disable-line node/no-missing-require
+			name: "../0-create-dll/dll.js",
+			scope: "dll",
+			sourceType: "commonjs2"
+		})
+	]
+};
diff --git a/test/configCases/dll-plugin/0-create-dll/webpack.config.js b/test/configCases/dll-plugin/0-create-dll/webpack.config.js
index 527195e32..00d9ddb4f 100644
--- a/test/configCases/dll-plugin/0-create-dll/webpack.config.js
+++ b/test/configCases/dll-plugin/0-create-dll/webpack.config.js
@@ -27,6 +27,7 @@ module.exports = {
 		]
 	},
 	optimization: {
+		usedExports: true,
 		sideEffects: true
 	},
 	plugins: [
