diff --git a/lib/dependencies/WorkerPlugin.js b/lib/dependencies/WorkerPlugin.js
index a52835d71..351f5e92b 100644
--- a/lib/dependencies/WorkerPlugin.js
+++ b/lib/dependencies/WorkerPlugin.js
@@ -9,9 +9,9 @@ const { pathToFileURL } = require("url");
 const AsyncDependenciesBlock = require("../AsyncDependenciesBlock");
 const CommentCompilationWarning = require("../CommentCompilationWarning");
 const UnsupportedFeatureWarning = require("../UnsupportedFeatureWarning");
-const formatLocation = require("../formatLocation");
 const EnableChunkLoadingPlugin = require("../javascript/EnableChunkLoadingPlugin");
 const { equals } = require("../util/ArrayHelpers");
+const createHash = require("../util/createHash");
 const { contextify } = require("../util/identifier");
 const EnableWasmLoadingPlugin = require("../wasm/EnableWasmLoadingPlugin");
 const ConstDependency = require("./ConstDependency");
@@ -27,6 +27,7 @@ const WorkerDependency = require("./WorkerDependency");
 /** @typedef {import("estree").SpreadElement} SpreadElement */
 /** @typedef {import("../Compiler")} Compiler */
 /** @typedef {import("../Entrypoint").EntryOptions} EntryOptions */
+/** @typedef {import("../Parser").ParserState} ParserState */
 /** @typedef {import("../javascript/BasicEvaluatedExpression")} BasicEvaluatedExpression */
 /** @typedef {import("../javascript/JavascriptParser")} JavascriptParser */
 /** @typedef {import("./HarmonyImportDependencyParserPlugin").HarmonySettings} HarmonySettings */
@@ -42,6 +43,9 @@ const DEFAULT_SYNTAX = [
 	"Worker from worker_threads"
 ];
 
+/** @type {WeakMap<ParserState, number>} */
+const workerIndexMap = new WeakMap();
+
 class WorkerPlugin {
 	constructor(chunkLoading, wasmLoading) {
 		this._chunkLoading = chunkLoading;
@@ -264,9 +268,20 @@ class WorkerPlugin {
 						}
 
 						if (!entryOptions.runtime) {
-							entryOptions.runtime = `${cachedContextify(
+							let i = workerIndexMap.get(parser.state) || 0;
+							workerIndexMap.set(parser.state, i + 1);
+							let name = `${cachedContextify(
 								parser.state.module.identifier()
-							)}|${formatLocation(expr.loc)}`;
+							)}|${i}`;
+							const hash = createHash(compilation.outputOptions.hashFunction);
+							hash.update(name);
+							const digest = /** @type {string} */ (hash.digest(
+								compilation.outputOptions.hashDigest
+							));
+							entryOptions.runtime = digest.slice(
+								0,
+								compilation.outputOptions.hashDigestLength
+							);
 						}
 
 						const block = new AsyncDependenciesBlock({
