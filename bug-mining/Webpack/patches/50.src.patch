diff --git a/lib/optimize/ConcatenatedModule.js b/lib/optimize/ConcatenatedModule.js
index 75cf806cd..4ee1177d5 100644
--- a/lib/optimize/ConcatenatedModule.js
+++ b/lib/optimize/ConcatenatedModule.js
@@ -461,19 +461,7 @@ const getFinalName = (
 	}
 };
 
-const addScopeSymbols1 = (s, nameSet, scopeSet) => {
-	let scope = s;
-	while (scope) {
-		if (scopeSet.has(scope)) break;
-		scopeSet.add(scope);
-		for (const variable of scope.variables) {
-			nameSet.add(variable.name);
-		}
-		scope = scope.upper;
-	}
-};
-
-const addScopeSymbols2 = (s, nameSet, scopeSet1, scopeSet2) => {
+const addScopeSymbols = (s, nameSet, scopeSet1, scopeSet2) => {
 	let scope = s;
 	while (scope) {
 		if (scopeSet1.has(scope)) break;
@@ -971,19 +959,28 @@ class ConcatenatedModule extends Module {
 		const allUsedNames = new Set(RESERVED_NAMES);
 
 		// List of additional names in scope for module references
-		const usedNamesInScope = new Map();
-		const getUsedNamesInScopeSet = (module, id) => {
+		/** @type {Map<string, { usedNames: Set<string>, alreadyCheckedScopes: Set<TODO> }>} */
+		const usedNamesInScopeInfo = new Map();
+		/**
+		 * @param {string} module module identifier
+		 * @param {string} id export id
+		 * @returns {{ usedNames: Set<string>, alreadyCheckedScopes: Set<TODO> }} info
+		 */
+		const getUsedNamesInScopeInfo = (module, id) => {
 			const key = `${module}-${id}`;
-			let set = usedNamesInScope.get(key);
-			if (set === undefined) {
-				set = new Set();
-				usedNamesInScope.set(key, set);
+			let info = usedNamesInScopeInfo.get(key);
+			if (info === undefined) {
+				info = {
+					usedNames: new Set(),
+					alreadyCheckedScopes: new Set()
+				};
+				usedNamesInScopeInfo.set(key, info);
 			}
-			return set;
+			return info;
 		};
 
 		// Set of already checked scopes
-		const alreadyCheckedScopes = new Set();
+		const ignoredScopes = new Set();
 
 		// get all global names
 		for (const info of modulesWithInfo) {
@@ -992,7 +989,7 @@ class ConcatenatedModule extends Module {
 
 				// ignore symbols from moduleScope
 				if (info.moduleScope) {
-					alreadyCheckedScopes.add(info.moduleScope);
+					ignoredScopes.add(info.moduleScope);
 
 					// The super class expression in class scopes behaves weird
 					// We store ranges of all super class expressions to make
@@ -1021,7 +1018,10 @@ class ConcatenatedModule extends Module {
 								requestShortener
 							);
 							if (!binding.ids) continue;
-							const usedNames = getUsedNamesInScopeSet(
+							const {
+								usedNames,
+								alreadyCheckedScopes
+							} = getUsedNamesInScopeInfo(
 								binding.info.module.identifier(),
 								binding.info.type === "external"
 									? "external"
@@ -1039,7 +1039,12 @@ class ConcatenatedModule extends Module {
 									}
 								}
 							}
-							addScopeSymbols1(reference.from, usedNames, alreadyCheckedScopes);
+							addScopeSymbols(
+								reference.from,
+								usedNames,
+								alreadyCheckedScopes,
+								ignoredScopes
+							);
 						} else {
 							allUsedNames.add(name);
 						}
@@ -1052,10 +1057,9 @@ class ConcatenatedModule extends Module {
 		for (const info of modulesWithInfo) {
 			switch (info.type) {
 				case "concatenated": {
-					const namespaceObjectUsedNames = getUsedNamesInScopeSet(
-						info.module.identifier(),
-						""
-					);
+					const {
+						usedNames: namespaceObjectUsedNames
+					} = getUsedNamesInScopeInfo(info.module.identifier(), "");
 					const namespaceObjectName = this.findNewName(
 						"namespaceObject",
 						allUsedNames,
@@ -1066,19 +1070,18 @@ class ConcatenatedModule extends Module {
 					info.namespaceObjectName = namespaceObjectName;
 					for (const variable of info.moduleScope.variables) {
 						const name = variable.name;
-						const usedNames = getUsedNamesInScopeSet(
+						const { usedNames, alreadyCheckedScopes } = getUsedNamesInScopeInfo(
 							info.module.identifier(),
 							name
 						);
 						if (allUsedNames.has(name) || usedNames.has(name)) {
 							const references = getAllReferences(variable);
-							const alreadyCheckedInnerScopes = new Set();
 							for (const ref of references) {
-								addScopeSymbols2(
+								addScopeSymbols(
 									ref.from,
 									usedNames,
-									alreadyCheckedInnerScopes,
-									alreadyCheckedScopes
+									alreadyCheckedScopes,
+									ignoredScopes
 								);
 							}
 							const newName = this.findNewName(
@@ -1115,14 +1118,14 @@ class ConcatenatedModule extends Module {
 					break;
 				}
 				case "external": {
-					const externalUsedNames = getUsedNamesInScopeSet(
+					const { usedNames } = getUsedNamesInScopeInfo(
 						info.module.identifier(),
 						"external"
 					);
 					const externalName = this.findNewName(
 						"",
 						allUsedNames,
-						externalUsedNames,
+						usedNames,
 						info.module.readableIdentifier(requestShortener)
 					);
 					allUsedNames.add(externalName);
@@ -1135,7 +1138,7 @@ class ConcatenatedModule extends Module {
 						const externalNameInterop = this.findNewName(
 							"namespaceObject",
 							allUsedNames,
-							externalUsedNames,
+							usedNames,
 							info.module.readableIdentifier(requestShortener)
 						);
 						allUsedNames.add(externalNameInterop);
@@ -1145,7 +1148,7 @@ class ConcatenatedModule extends Module {
 						const externalNameInterop = this.findNewName(
 							"default",
 							allUsedNames,
-							externalUsedNames,
+							usedNames,
 							info.module.readableIdentifier(requestShortener)
 						);
 						allUsedNames.add(externalNameInterop);
diff --git a/test/cases/scope-hoisting/issue-10308/commonjs.js b/test/cases/scope-hoisting/issue-10308/commonjs.js
new file mode 100644
index 000000000..888cae37a
--- /dev/null
+++ b/test/cases/scope-hoisting/issue-10308/commonjs.js
@@ -0,0 +1 @@
+module.exports = 42;
diff --git a/test/cases/scope-hoisting/issue-10308/external.js b/test/cases/scope-hoisting/issue-10308/external.js
new file mode 100644
index 000000000..47cee2d7b
--- /dev/null
+++ b/test/cases/scope-hoisting/issue-10308/external.js
@@ -0,0 +1,3 @@
+export function test(base) {
+	return base + 2;
+}
diff --git a/test/cases/scope-hoisting/issue-10308/index.js b/test/cases/scope-hoisting/issue-10308/index.js
new file mode 100644
index 000000000..b390c3568
--- /dev/null
+++ b/test/cases/scope-hoisting/issue-10308/index.js
@@ -0,0 +1,6 @@
+import { fn } from "./root";
+import(/* webpackMode: "eager" */ "./external");
+
+it("should use the correct names", () => {
+	expect(fn()).toBe(42);
+});
diff --git a/test/cases/scope-hoisting/issue-10308/root.js b/test/cases/scope-hoisting/issue-10308/root.js
new file mode 100644
index 000000000..d417c38e4
--- /dev/null
+++ b/test/cases/scope-hoisting/issue-10308/root.js
@@ -0,0 +1,14 @@
+import CommonJs from "./commonjs";
+import { test } from "./external";
+
+function fn() {
+	CommonJs;
+
+	var external = 40;
+
+	var externalValue = test(external);
+
+	return externalValue;
+}
+
+export { fn };
