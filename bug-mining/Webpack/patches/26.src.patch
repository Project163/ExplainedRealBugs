diff --git a/lib/CompatibilityPlugin.js b/lib/CompatibilityPlugin.js
index 909ca200a..fd436bcee 100644
--- a/lib/CompatibilityPlugin.js
+++ b/lib/CompatibilityPlugin.js
@@ -10,6 +10,7 @@ const ConstDependency = require("./dependencies/ConstDependency");
 const NullFactory = require("./NullFactory");
 
 /** @typedef {import("./Compiler")} Compiler */
+/** @typedef {import("./JavascriptParser")} JavascriptParser */
 
 class CompatibilityPlugin {
 	/**
@@ -64,6 +65,52 @@ class CompatibilityPlugin {
 								return true;
 							});
 					});
+
+				/**
+				 * @param {JavascriptParser} parser the parser
+				 * @returns {void}
+				 */
+				const nestedWebpackRequireHandler = parser => {
+					parser.hooks.pattern
+						.for("__webpack_require__")
+						.tap("CompatibilityPlugin", pattern => {
+							const newName = `__nested_webpack_require_${pattern.range[0]}__`;
+							const dep = new ConstDependency(newName, pattern.range);
+							dep.loc = pattern.loc;
+							parser.state.current.addDependency(dep);
+							parser.scope.renames.set(
+								pattern.name,
+								"nested __webpack_require__"
+							);
+							parser.scope.renames.set(
+								"nested __webpack_require__ name",
+								newName
+							);
+							parser.scope.definitions.delete(pattern.name);
+							return true;
+						});
+					parser.hooks.expression
+						.for("nested __webpack_require__")
+						.tap("CompatibilityPlugin", expr => {
+							const newName = parser.scope.renames.get(
+								"nested __webpack_require__ name"
+							);
+							const dep = new ConstDependency(newName, expr.range);
+							dep.loc = expr.loc;
+							parser.state.current.addDependency(dep);
+							return true;
+						});
+				};
+
+				normalModuleFactory.hooks.parser
+					.for("javascript/auto")
+					.tap("CompatibilityPlugin", nestedWebpackRequireHandler);
+				normalModuleFactory.hooks.parser
+					.for("javascript/dynamic")
+					.tap("CompatibilityPlugin", nestedWebpackRequireHandler);
+				normalModuleFactory.hooks.parser
+					.for("javascript/esm")
+					.tap("CompatibilityPlugin", nestedWebpackRequireHandler);
 			}
 		);
 	}
diff --git a/lib/JavascriptParser.js b/lib/JavascriptParser.js
index e586beecc..2daf9c6cf 100644
--- a/lib/JavascriptParser.js
+++ b/lib/JavascriptParser.js
@@ -83,6 +83,7 @@ class JavascriptParser {
 			varDeclarationLet: new HookMap(() => new SyncBailHook(["declaration"])),
 			varDeclarationConst: new HookMap(() => new SyncBailHook(["declaration"])),
 			varDeclarationVar: new HookMap(() => new SyncBailHook(["declaration"])),
+			pattern: new HookMap(() => new SyncBailHook(["pattern"])),
 			canRename: new HookMap(() => new SyncBailHook(["initExpression"])),
 			rename: new HookMap(() => new SyncBailHook(["initExpression"])),
 			assigned: new HookMap(() => new SyncBailHook(["expression"])),
@@ -1900,9 +1901,12 @@ class JavascriptParser {
 
 		for (const param of params) {
 			if (typeof param !== "string") {
-				this.enterPattern(param, param => {
-					this.scope.renames.set(param, null);
-					this.scope.definitions.add(param);
+				this.enterPattern(param, (param, pattern) => {
+					const hook = this.hooks.pattern.get(param);
+					if (!hook || hook.call(pattern) !== true) {
+						this.scope.renames.set(param, null);
+						this.scope.definitions.add(param);
+					}
 				});
 			} else if (param) {
 				this.scope.renames.set(param, null);
diff --git a/lib/WebpackOptionsApply.js b/lib/WebpackOptionsApply.js
index 562a5f357..8a51ede86 100644
--- a/lib/WebpackOptionsApply.js
+++ b/lib/WebpackOptionsApply.js
@@ -95,7 +95,9 @@ class WebpackOptionsApply extends OptionsApply {
 					new FunctionModulePlugin().apply(compiler);
 					new NodeSourcePlugin(options.node).apply(compiler);
 					new LoaderTargetPlugin(options.target).apply(compiler);
-					new StartupChunkDependenciesPlugin().apply(compiler);
+					new StartupChunkDependenciesPlugin({
+						asyncChunkLoading: true
+					}).apply(compiler);
 					break;
 				}
 				case "node":
@@ -113,7 +115,9 @@ class WebpackOptionsApply extends OptionsApply {
 					new FunctionModulePlugin().apply(compiler);
 					new NodeTargetPlugin().apply(compiler);
 					new LoaderTargetPlugin("node").apply(compiler);
-					new StartupChunkDependenciesPlugin().apply(compiler);
+					new StartupChunkDependenciesPlugin({
+						asyncChunkLoading: options.target === "async-node"
+					}).apply(compiler);
 					break;
 				}
 				case "node-webkit": {
@@ -126,7 +130,9 @@ class WebpackOptionsApply extends OptionsApply {
 					new NodeTargetPlugin().apply(compiler);
 					new ExternalsPlugin("commonjs", "nw.gui").apply(compiler);
 					new LoaderTargetPlugin(options.target).apply(compiler);
-					new StartupChunkDependenciesPlugin().apply(compiler);
+					new StartupChunkDependenciesPlugin({
+						asyncChunkLoading: true
+					}).apply(compiler);
 					break;
 				}
 				case "electron-main": {
@@ -165,7 +171,9 @@ class WebpackOptionsApply extends OptionsApply {
 						"web-contents"
 					]).apply(compiler);
 					new LoaderTargetPlugin(options.target).apply(compiler);
-					new StartupChunkDependenciesPlugin().apply(compiler);
+					new StartupChunkDependenciesPlugin({
+						asyncChunkLoading: true
+					}).apply(compiler);
 					break;
 				}
 				case "electron-renderer": {
diff --git a/lib/runtime/StartupChunkDependenciesPlugin.js b/lib/runtime/StartupChunkDependenciesPlugin.js
index 44acd8a2a..a4bc058d3 100644
--- a/lib/runtime/StartupChunkDependenciesPlugin.js
+++ b/lib/runtime/StartupChunkDependenciesPlugin.js
@@ -11,6 +11,13 @@ const Template = require("../Template");
 /** @typedef {import("../Compiler")} Compiler */
 
 class StartupChunkDependenciesPlugin {
+	constructor(options) {
+		this.asyncChunkLoading =
+			options && typeof options.asyncChunkLoading === "boolean"
+				? options.asyncChunkLoading
+				: true;
+	}
+
 	/**
 	 * @param {Compiler} compiler the compiler instance
 	 * @returns {void}
@@ -30,7 +37,8 @@ class StartupChunkDependenciesPlugin {
 								chunk,
 								new StartupChunkDependenciesRuntimeModule(
 									chunk,
-									compilation.chunkGraph
+									compilation.chunkGraph,
+									this.asyncChunkLoading
 								)
 							);
 						}
@@ -42,10 +50,11 @@ class StartupChunkDependenciesPlugin {
 }
 
 class StartupChunkDependenciesRuntimeModule extends RuntimeModule {
-	constructor(chunk, chunkGraph) {
+	constructor(chunk, chunkGraph, asyncChunkLoading) {
 		super("startup chunk dependencies");
 		this.chunk = chunk;
 		this.chunkGraph = chunkGraph;
+		this.asyncChunkLoading = asyncChunkLoading;
 	}
 
 	/**
@@ -61,19 +70,25 @@ class StartupChunkDependenciesRuntimeModule extends RuntimeModule {
 		return Template.asString([
 			`var next = ${RuntimeGlobals.startup};`,
 			`${RuntimeGlobals.startup} = function() {`,
-			Template.indent([
-				chunkIds.length === 1
+			Template.indent(
+				!this.asyncChunkLoading
+					? chunkIds
+							.map(
+								id => `${RuntimeGlobals.ensureChunk}(${JSON.stringify(id)});`
+							)
+							.concat("return next();")
+					: chunkIds.length === 1
 					? `return ${RuntimeGlobals.ensureChunk}(${JSON.stringify(
 							chunkIds[0]
 					  )}).then(next);`
 					: chunkIds.length > 2
-					? Template.asString([
+					? [
 							// using map is shorter for 3 or more chunks
 							`return Promise.all(${JSON.stringify(chunkIds)}.map(${
 								RuntimeGlobals.ensureChunk
 							}, __webpack_require__)).then(next);`
-					  ])
-					: Template.asString([
+					  ]
+					: [
 							// calling ensureChunk directly is shorter for 0 - 2 chunks
 							"return Promise.all([",
 							Template.indent(
@@ -84,8 +99,8 @@ class StartupChunkDependenciesRuntimeModule extends RuntimeModule {
 									.join(",\n")
 							),
 							"]).then(next);"
-					  ])
-			]),
+					  ]
+			),
 			"}"
 		]);
 	}
diff --git a/test/configCases/library/0-create-library/webpack.config.js b/test/configCases/library/0-create-library/webpack.config.js
index a2e200769..a05d67afe 100644
--- a/test/configCases/library/0-create-library/webpack.config.js
+++ b/test/configCases/library/0-create-library/webpack.config.js
@@ -1,3 +1,4 @@
+const path = require("path");
 module.exports = [
 	{
 		output: {
@@ -61,5 +62,33 @@ module.exports = [
 			libraryTarget: "commonjs2"
 		},
 		externals: ["external"]
+	},
+	{
+		output: {
+			filename: "index.js",
+			path: path.resolve(
+				__dirname,
+				"../../../js/config/library/0-create-library/commonjs2-split-chunks"
+			),
+			libraryTarget: "commonjs2"
+		},
+		target: "node",
+		optimization: {
+			splitChunks: {
+				cacheGroups: {
+					test: {
+						enforce: true,
+						chunks: "all",
+						test: /a\.js$/,
+						filename: "part.js"
+					}
+				}
+			}
+		},
+		resolve: {
+			alias: {
+				external: "./non-external"
+			}
+		}
 	}
 ];
diff --git a/test/configCases/library/1-use-library/webpack.config.js b/test/configCases/library/1-use-library/webpack.config.js
index 05624691f..18df119c4 100644
--- a/test/configCases/library/1-use-library/webpack.config.js
+++ b/test/configCases/library/1-use-library/webpack.config.js
@@ -64,6 +64,22 @@ module.exports = [
 			})
 		]
 	},
+	{
+		resolve: {
+			alias: {
+				library: path.resolve(
+					__dirname,
+					"../../../js/config/library/0-create-library/commonjs2-split-chunks/"
+				),
+				external: path.resolve(__dirname, "node_modules/external.js")
+			}
+		},
+		plugins: [
+			new webpack.DefinePlugin({
+				NAME: JSON.stringify("commonjs2 with splitChunks")
+			})
+		]
+	},
 	{
 		entry: "./default-test.js",
 		resolve: {
