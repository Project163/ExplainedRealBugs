diff --git a/lib/Compilation.js b/lib/Compilation.js
index e59b3f9be..013e98a36 100644
--- a/lib/Compilation.js
+++ b/lib/Compilation.js
@@ -1002,6 +1002,25 @@ class Compilation {
 		this.processDependenciesQueue.add(module, callback);
 	}
 
+	/**
+	 * @param {Module} module to be processed for deps
+	 * @returns {void}
+	 */
+	processModuleDependenciesNonRecursive(module) {
+		const processDependenciesBlock = block => {
+			if (block.dependencies) {
+				for (const dep of block.dependencies) {
+					this.moduleGraph.setParents(dep, block, module);
+				}
+			}
+			if (block.blocks) {
+				for (const b of block.blocks) processDependenciesBlock(b);
+			}
+		};
+
+		processDependenciesBlock(module);
+	}
+
 	/**
 	 * @param {Module} module to be processed for deps
 	 * @param {ModuleCallback} callback callback to be triggered
@@ -1232,6 +1251,7 @@ class Compilation {
 						}
 
 						if (!recursive) {
+							this.processModuleDependenciesNonRecursive(module);
 							callback(null, module);
 							return;
 						}
