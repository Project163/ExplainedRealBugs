{"url":"https://api.github.com/repos/webpack/webpack/issues/8259","repository_url":"https://api.github.com/repos/webpack/webpack","labels_url":"https://api.github.com/repos/webpack/webpack/issues/8259/labels{/name}","comments_url":"https://api.github.com/repos/webpack/webpack/issues/8259/comments","events_url":"https://api.github.com/repos/webpack/webpack/issues/8259/events","html_url":"https://github.com/webpack/webpack/issues/8259","id":373105986,"node_id":"MDU6SXNzdWUzNzMxMDU5ODY=","number":8259,"title":"Allow specifying runtime asset path post-processor for web target.","user":{"login":"dtinth","id":193136,"node_id":"MDQ6VXNlcjE5MzEzNg==","avatar_url":"https://avatars.githubusercontent.com/u/193136?v=4","gravatar_id":"","url":"https://api.github.com/users/dtinth","html_url":"https://github.com/dtinth","followers_url":"https://api.github.com/users/dtinth/followers","following_url":"https://api.github.com/users/dtinth/following{/other_user}","gists_url":"https://api.github.com/users/dtinth/gists{/gist_id}","starred_url":"https://api.github.com/users/dtinth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dtinth/subscriptions","organizations_url":"https://api.github.com/users/dtinth/orgs","repos_url":"https://api.github.com/users/dtinth/repos","events_url":"https://api.github.com/users/dtinth/events{/privacy}","received_events_url":"https://api.github.com/users/dtinth/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":665191202,"node_id":"MDU6TGFiZWw2NjUxOTEyMDI=","url":"https://api.github.com/repos/webpack/webpack/labels/inactive","name":"inactive","color":"000000","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-10-23T17:11:16Z","updated_at":"2019-06-09T14:22:19Z","closed_at":"2019-06-09T12:16:09Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!-- Please don't delete this template or we'll close your issue -->\r\n\r\n## Feature request\r\n\r\n<!-- Issues which contain questions or support requests will be closed. -->\r\n<!-- Before creating an issue please make sure you are using the latest version of webpack. -->\r\n<!-- Check if this feature need to be implemented in a plugin or loader instead -->\r\n<!-- If yes: file the issue on the plugin/loader repo -->\r\n<!-- Features related to the development server should be filed on this repo instead -->\r\n\r\n**What is the expected behavior?**\r\nI would like to be able to specify a runtime post-processor for asset path. If specified, the post-processor should be used to determine the final path when loading chunks.\r\n\r\n**What is motivation or use case for adding/changing the behavior?**\r\nRight now the logic for determining asset path is currently hardcoded as `__webpack_require__.p + assetPath` in these places:\r\n- webpack core: [JsonpMainTemplatePlugin, in the generated `jsonpScriptSrc` function](https://github.com/webpack/webpack/blob/8a7597aa6eb2eef66a8f9db3a0c49bcb96022a94/lib/web/JsonpMainTemplatePlugin.js#L127-L131)\r\n- MiniCssExtractPlugin: [Inside the `requireEnsure` hook](https://github.com/webpack-contrib/mini-css-extract-plugin/blob/eb218ccd5ce07b880e55833f9b9a9084ba03e68f/src/index.js#L336)\r\n- file-loader: [In the code generation function](https://github.com/webpack-contrib/file-loader/blob/85230c9a34ea78a7c55265577417f2303b4d01a0/src/index.js#L63)\r\n\r\nThis means the output asset path must be predetermined at compile-time. By being able to post-process the loaded asset path at runtime, these issues can be more easily solved:\r\n\r\n- #7787 — Support for long-term caching based on generated content, not source files for chunkhash.\r\n\r\n  This is the main reason I open this issue. I would like to be able to address asset files via the asset’s content hash. This allows for safer long-term caching (since in some cases, the content of a chunk can change without affecting `[chunkhash]`, which may cause the webpack runtime to crash in a scenario I previously reported in #5684).\r\n\r\n  It also allows easy validation of assets integrity. For example, after compilation, I may prepend the name of each file with the SHA256 hash of its contents. This allows checking the integrity of each asset by verifying the contents against its name. Then at runtime, I can inject an assets post-processor that inserts the SHA1 hash into the filename.\r\n\r\n  I will work on a proof-of-concept, which I will comment on this issue later.\r\n\r\n- #8115 — Ability to override `jsonpScriptSrc`.\r\n\r\n  Note that the link issue has been closed since the opener solved this by manually editing the generated file.\r\n\r\n**How should this be implemented in your opinion?**\r\nI would add an option, `output.assetPathPostProcessor` (string) which will be the name of the function that can be used to post-process the asset URL. The function will receive the asset URL (`publicPath + assetPath`) and it should return a function. Then I will modify [`jsonpScriptSrc`](https://github.com/webpack/webpack/blob/8a7597aa6eb2eef66a8f9db3a0c49bcb96022a94/lib/web/JsonpMainTemplatePlugin.js#L125) so that it calls the function at `output.assetPathPostProcessor` if it is specified. I will also have to make contributions to `file-loader` and `mini-css-extract-plugin` to become aware of this option.\r\n\r\n**Are you willing to work on this yourself?**\r\nyes\r\n","closed_by":{"login":"sokra","id":1365881,"node_id":"MDQ6VXNlcjEzNjU4ODE=","avatar_url":"https://avatars.githubusercontent.com/u/1365881?v=4","gravatar_id":"","url":"https://api.github.com/users/sokra","html_url":"https://github.com/sokra","followers_url":"https://api.github.com/users/sokra/followers","following_url":"https://api.github.com/users/sokra/following{/other_user}","gists_url":"https://api.github.com/users/sokra/gists{/gist_id}","starred_url":"https://api.github.com/users/sokra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sokra/subscriptions","organizations_url":"https://api.github.com/users/sokra/orgs","repos_url":"https://api.github.com/users/sokra/repos","events_url":"https://api.github.com/users/sokra/events{/privacy}","received_events_url":"https://api.github.com/users/sokra/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/webpack/webpack/issues/8259/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/webpack/webpack/issues/8259/timeline","performed_via_github_app":null,"state_reason":"completed"}