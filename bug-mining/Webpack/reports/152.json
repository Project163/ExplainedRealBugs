{"url":"https://api.github.com/repos/webpack/webpack/issues/19731","repository_url":"https://api.github.com/repos/webpack/webpack","labels_url":"https://api.github.com/repos/webpack/webpack/issues/19731/labels{/name}","comments_url":"https://api.github.com/repos/webpack/webpack/issues/19731/comments","events_url":"https://api.github.com/repos/webpack/webpack/issues/19731/events","html_url":"https://github.com/webpack/webpack/issues/19731","id":3259177674,"node_id":"I_kwDOADgiC87CQxrK","number":19731,"title":"Top level await leaves imported module wrapped in a Promise on HMR","user":{"login":"faergeek","id":3524621,"node_id":"MDQ6VXNlcjM1MjQ2MjE=","avatar_url":"https://avatars.githubusercontent.com/u/3524621?v=4","gravatar_id":"","url":"https://api.github.com/users/faergeek","html_url":"https://github.com/faergeek","followers_url":"https://api.github.com/users/faergeek/followers","following_url":"https://api.github.com/users/faergeek/following{/other_user}","gists_url":"https://api.github.com/users/faergeek/gists{/gist_id}","starred_url":"https://api.github.com/users/faergeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/faergeek/subscriptions","organizations_url":"https://api.github.com/users/faergeek/orgs","repos_url":"https://api.github.com/users/faergeek/repos","events_url":"https://api.github.com/users/faergeek/events{/privacy}","received_events_url":"https://api.github.com/users/faergeek/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1089820,"node_id":"MDU6TGFiZWwxMDg5ODIw","url":"https://api.github.com/repos/webpack/webpack/labels/bug","name":"bug","color":"fbca04","default":true,"description":null},{"id":841723323,"node_id":"MDU6TGFiZWw4NDE3MjMzMjM=","url":"https://api.github.com/repos/webpack/webpack/labels/Send%20a%20PR","name":"Send a PR","color":"0054d3","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"xiaoxiaojx","id":23253540,"node_id":"MDQ6VXNlcjIzMjUzNTQw","avatar_url":"https://avatars.githubusercontent.com/u/23253540?v=4","gravatar_id":"","url":"https://api.github.com/users/xiaoxiaojx","html_url":"https://github.com/xiaoxiaojx","followers_url":"https://api.github.com/users/xiaoxiaojx/followers","following_url":"https://api.github.com/users/xiaoxiaojx/following{/other_user}","gists_url":"https://api.github.com/users/xiaoxiaojx/gists{/gist_id}","starred_url":"https://api.github.com/users/xiaoxiaojx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiaoxiaojx/subscriptions","organizations_url":"https://api.github.com/users/xiaoxiaojx/orgs","repos_url":"https://api.github.com/users/xiaoxiaojx/repos","events_url":"https://api.github.com/users/xiaoxiaojx/events{/privacy}","received_events_url":"https://api.github.com/users/xiaoxiaojx/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"xiaoxiaojx","id":23253540,"node_id":"MDQ6VXNlcjIzMjUzNTQw","avatar_url":"https://avatars.githubusercontent.com/u/23253540?v=4","gravatar_id":"","url":"https://api.github.com/users/xiaoxiaojx","html_url":"https://github.com/xiaoxiaojx","followers_url":"https://api.github.com/users/xiaoxiaojx/followers","following_url":"https://api.github.com/users/xiaoxiaojx/following{/other_user}","gists_url":"https://api.github.com/users/xiaoxiaojx/gists{/gist_id}","starred_url":"https://api.github.com/users/xiaoxiaojx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiaoxiaojx/subscriptions","organizations_url":"https://api.github.com/users/xiaoxiaojx/orgs","repos_url":"https://api.github.com/users/xiaoxiaojx/repos","events_url":"https://api.github.com/users/xiaoxiaojx/events{/privacy}","received_events_url":"https://api.github.com/users/xiaoxiaojx/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":6,"created_at":"2025-07-24T09:24:57Z","updated_at":"2025-07-28T13:12:37Z","closed_at":"2025-07-28T12:17:21Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!-- Please don't delete this template because we'll close your issue -->\n<!-- Before creating an issue please make sure you are using the latest version of webpack. -->\n\n# Bug report\n\n**What is the current behavior?**\n\nA module with a top-level await is left wrapped in a Promise.\n\nSteps to reproduce:\n\n1. Clone the repo: https://github.com/faergeek/webpack-top-level-await-hmr\n2. Install dependencies: `npm install`\n3. Start watch mode: `npm start`\n4. Edit `src/add.js` file.\n5. Observe a console log showing `{ add: undefined, addNs: Promise(...) }`.\n6. Comment out line 1 in `src/add.js`, uncomment line 2. This results in an update bubbling up to `src/index.js`, which might be a separate issue as well.\n7. Edit `src/add.js` again. This time log shows `{ add: [Function: add], addNs: Object [Module] { .... } }`, which is a normal behavior.\n\n**What is the expected behavior?**\n\nA module should not be left wrapped in a Promise. Parent module should see a result of a Promise resolution instead.\n\n**Other relevant information:**\nwebpack version: 5.100.2\nNode.js version: v24.4.1\nOperating System: Arch Linux\nAdditional tools: webpack-cli\n","closed_by":{"login":"alexander-akait","id":4567934,"node_id":"MDQ6VXNlcjQ1Njc5MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/4567934?v=4","gravatar_id":"","url":"https://api.github.com/users/alexander-akait","html_url":"https://github.com/alexander-akait","followers_url":"https://api.github.com/users/alexander-akait/followers","following_url":"https://api.github.com/users/alexander-akait/following{/other_user}","gists_url":"https://api.github.com/users/alexander-akait/gists{/gist_id}","starred_url":"https://api.github.com/users/alexander-akait/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexander-akait/subscriptions","organizations_url":"https://api.github.com/users/alexander-akait/orgs","repos_url":"https://api.github.com/users/alexander-akait/repos","events_url":"https://api.github.com/users/alexander-akait/events{/privacy}","received_events_url":"https://api.github.com/users/alexander-akait/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/webpack/webpack/issues/19731/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/webpack/webpack/issues/19731/timeline","performed_via_github_app":null,"state_reason":"completed"}