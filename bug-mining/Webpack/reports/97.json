{"url":"https://api.github.com/repos/webpack/webpack/issues/12232","repository_url":"https://api.github.com/repos/webpack/webpack","labels_url":"https://api.github.com/repos/webpack/webpack/issues/12232/labels{/name}","comments_url":"https://api.github.com/repos/webpack/webpack/issues/12232/comments","events_url":"https://api.github.com/repos/webpack/webpack/issues/12232/events","html_url":"https://github.com/webpack/webpack/issues/12232","id":771073898,"node_id":"MDU6SXNzdWU3NzEwNzM4OTg=","number":12232,"title":"bracket notation string converting to invalid dot notation identifier","user":{"login":"cmloegcmluin","id":4460669,"node_id":"MDQ6VXNlcjQ0NjA2Njk=","avatar_url":"https://avatars.githubusercontent.com/u/4460669?v=4","gravatar_id":"","url":"https://api.github.com/users/cmloegcmluin","html_url":"https://github.com/cmloegcmluin","followers_url":"https://api.github.com/users/cmloegcmluin/followers","following_url":"https://api.github.com/users/cmloegcmluin/following{/other_user}","gists_url":"https://api.github.com/users/cmloegcmluin/gists{/gist_id}","starred_url":"https://api.github.com/users/cmloegcmluin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cmloegcmluin/subscriptions","organizations_url":"https://api.github.com/users/cmloegcmluin/orgs","repos_url":"https://api.github.com/users/cmloegcmluin/repos","events_url":"https://api.github.com/users/cmloegcmluin/events{/privacy}","received_events_url":"https://api.github.com/users/cmloegcmluin/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-12-18T18:07:55Z","updated_at":"2020-12-19T07:10:55Z","closed_at":"2020-12-19T07:10:55Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"# Bug report\r\n\r\n**What is the current behavior?**\r\n\r\nWebpack creates a syntax error in my bundle by converting some bracket access notation strings to dot access notation identifiers when the strings are not valid identifiers.\r\n\r\n\r\n**If the current behavior is a bug, please provide the steps to reproduce.**\r\n\r\nMinimal repro: https://github.com/cmloegcmluin/bad-bracket-to-dot\r\n\r\n```sh\r\ngit clone git@github.com:cmloegcmluin/bad-bracket-to-dot.git\r\ncd bad-bracket-to-dot\r\nnpm i\r\nwebpack\r\n```\r\n\r\nThe `dist/main.js` is already checked in, though so you can see how:\r\n\r\n```js\r\n// index.js\r\n\r\nimport {b} from \"./b\"\r\n\r\nconst a = {\r\n    [b[\"\\\\k\"]]: 0,\r\n    [b[\"k\\\\\"]]: 0,\r\n}\r\n```\r\n\r\n```js\r\n// b.js\r\n\r\nexport const b = {}\r\n```\r\n\r\nis bundled to:\r\n\r\n```js\r\n// dist/main.js\r\n\r\n/******/ (() => { // webpackBootstrap\r\n/******/ \t\"use strict\";\r\n\r\n;// CONCATENATED MODULE: ./src/b.js\r\nconst b = {}\r\n\r\n;// CONCATENATED MODULE: ./src/index.js\r\n\r\n\r\nconst a = {\r\n    [b[\"\\\\k\"]]: 0,\r\n    [b.k\\]: 0,\r\n}\r\n\r\n/******/ })()\r\n;\r\n```\r\n\r\nusing config:\r\n\r\n```js\r\n// webpack.config.js\r\n\r\nmodule.exports = {\r\n    optimization: {\r\n        minimize: false,\r\n    },\r\n}\r\n```\r\n\r\n\r\n**What is the expected behavior?**\r\n\r\nThe minimal repro contains an example of very similar syntax which works as expected. The first key stays in bracket notation, as it should.\r\n\r\nI believe the second key fails because it contains a character sequence which begins like a valid identifier, tricking webpack into thinking it can safely convert it from bracket to dot notation. The same problem happens if the key begins and ends with a valid identifier character, but has the backlash sandwiched inside.\r\n\r\nBundling works fine on some special characters, like `*?#%!()+-/` but also fails on some special characters, like `$`.\r\n\r\nYou may be wondering why I even separated `b` into its own module. The syntax error is only created if the object `b` is imported from another module. If it is in the same file as `a`, the problem does not occur.\r\n\r\nIf `webpack.config.js` is deleted and all default configuration is used (i.e., minification is turned back on), then compilation instead fails with this error:\r\n\r\n```\r\nERROR in main.js from Terser\r\nExpecting UnicodeEscapeSequence -- uXXXX or u{XXXX} [main.js:16,7]\r\n    at js_error (~\\bad-bracket-to-dot\\node_modules\\terser\\dist\\bundle.min.js:546:11)\r\n    at parse_error (~\\bad-bracket-to-dot\\node_modules\\terser\\dist\\bundle.min.js:682:9)\r\n    at read_escaped_identifier_char (~\\bad-bracket-to-dot\\node_modules\\terser\\dist\\bundle.min.js:913:17)\r\n    at ~\\bad-bracket-to-dot\\node_modules\\terser\\dist\\bundle.min.js:935:22\r\n    at ~\\bad-bracket-to-dot\\node_modules\\terser\\dist\\bundle.min.js:1041:24\r\n    at read_word (~\\bad-bracket-to-dot\\node_modules\\terser\\dist\\bundle.min.js:1030:20)\r\n    at Object.next_token [as input] (~\\bad-bracket-to-dot\\node_modules\\terser\\dist\\bundle.min.js:1106:63)\r\n    at peek (~\\bad-bracket-to-dot\\node_modules\\terser\\dist\\bundle.min.js:1244:56)\r\n    at next (~\\bad-bracket-to-dot\\node_modules\\terser\\dist\\bundle.min.js:1249:24)\r\n    at subscripts (~\\bad-bracket-to-dot\\node_modules\\terser\\dist\\bundle.min.js:3112:13)\r\n\r\nwebpack 5.11.0 compiled with 1 error in 224 ms\r\n```\r\n\r\nI expect that webpack should be able to bundle my code written in this syntax without creating a syntax error.\r\n\r\n**Other relevant information:**\r\nwebpack version:  5.11.0\r\nNode.js version: v14.5.0\r\nOperating System: Windows 10\r\n","closed_by":{"login":"sokra","id":1365881,"node_id":"MDQ6VXNlcjEzNjU4ODE=","avatar_url":"https://avatars.githubusercontent.com/u/1365881?v=4","gravatar_id":"","url":"https://api.github.com/users/sokra","html_url":"https://github.com/sokra","followers_url":"https://api.github.com/users/sokra/followers","following_url":"https://api.github.com/users/sokra/following{/other_user}","gists_url":"https://api.github.com/users/sokra/gists{/gist_id}","starred_url":"https://api.github.com/users/sokra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sokra/subscriptions","organizations_url":"https://api.github.com/users/sokra/orgs","repos_url":"https://api.github.com/users/sokra/repos","events_url":"https://api.github.com/users/sokra/events{/privacy}","received_events_url":"https://api.github.com/users/sokra/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/webpack/webpack/issues/12232/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/webpack/webpack/issues/12232/timeline","performed_via_github_app":null,"state_reason":"completed"}