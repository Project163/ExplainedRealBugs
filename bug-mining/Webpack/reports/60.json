{"url":"https://api.github.com/repos/webpack/webpack/issues/10870","repository_url":"https://api.github.com/repos/webpack/webpack","labels_url":"https://api.github.com/repos/webpack/webpack/issues/10870/labels{/name}","comments_url":"https://api.github.com/repos/webpack/webpack/issues/10870/comments","events_url":"https://api.github.com/repos/webpack/webpack/issues/10870/events","html_url":"https://github.com/webpack/webpack/issues/10870","id":615971616,"node_id":"MDU6SXNzdWU2MTU5NzE2MTY=","number":10870,"title":"Runtime error in case of circular dependency between ES Modules with a re-export","user":{"login":"bregenspan","id":237410,"node_id":"MDQ6VXNlcjIzNzQxMA==","avatar_url":"https://avatars.githubusercontent.com/u/237410?v=4","gravatar_id":"","url":"https://api.github.com/users/bregenspan","html_url":"https://github.com/bregenspan","followers_url":"https://api.github.com/users/bregenspan/followers","following_url":"https://api.github.com/users/bregenspan/following{/other_user}","gists_url":"https://api.github.com/users/bregenspan/gists{/gist_id}","starred_url":"https://api.github.com/users/bregenspan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bregenspan/subscriptions","organizations_url":"https://api.github.com/users/bregenspan/orgs","repos_url":"https://api.github.com/users/bregenspan/repos","events_url":"https://api.github.com/users/bregenspan/events{/privacy}","received_events_url":"https://api.github.com/users/bregenspan/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2020-05-11T15:24:23Z","updated_at":"2024-01-23T18:11:04Z","closed_at":"2020-05-12T22:03:36Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!-- Please don't delete this template because we'll close your issue -->\r\n<!-- Before creating an issue please make sure you are using the latest version of webpack. -->\r\n\r\n# Bug report\r\n\r\nI'm seeing a runtime error in a cyclic dependency case where:\r\n\r\n * module A imports and re-exports a reference to a function from module C and also imports module B\r\n * module B depends on the function from module C via module A's re-export of it\r\n\r\nIn the minimal reproduction in https://github.com/bregenspan/webpack-circular-import-issue, this manifests as the runtime error: \"Uncaught TypeError: n is not a function\".\r\n\r\nThis issue seems different from https://github.com/webpack/webpack/issues/9060, as it involves an exported function declaration and so as I understand it shouldn't involve the temporal dead zone in the same way; also Rollup and native ES module support in Chrome and Node.js execute the code as expected, unlike in that case.\r\n  \r\n<!-- Please ask questions on StackOverflow or the webpack Gitter. -->\r\n<!-- https://stackoverflow.com/questions/ask?tags=webpack -->\r\n<!-- https://gitter.im/webpack/webpack -->\r\n<!-- Issues which contain questions or support requests will be closed. -->\r\n\r\n### **What is the current behavior?**\r\n\r\nIn the example in https://github.com/bregenspan/webpack-circular-import-issue, there is a runtime error with the message: `Uncaught TypeError: n is not a function` when the bundled code is run in a browser. This is because the definition of the default export of the \"shared.js\" module used in this example is bundled following the first reference to it.\r\n\r\n### **If the current behavior is a bug, please provide the steps to reproduce.**\r\n\r\nClone the minimal reproduction in https://github.com/bregenspan/webpack-circular-import-issue, run `npm install && npm run start`. You should now see a browser window and can click \"webpack.html\" and open your browser's developer console to see the noted behavior.\r\n\r\n<!-- A great way to do this is to provide your configuration via a GitHub repository -->\r\n<!-- The most helpful is a minimal reproduction with instructions on how to reproduce -->\r\n<!-- Repositories with too many files or large `webpack.config.js` files are not suitable -->\r\n<!-- Please only add small code snippets directly into this issue -->\r\n<!-- https://gist.github.com is a good place for longer code snippets -->\r\n<!-- If your issue is caused by a plugin or loader, please create an issue on the loader/plugin repository instead -->\r\n\r\n### **What is the expected behavior?**\r\n\r\nThere should be no runtime error, and the console output in the browser should match that shown in the other examples (rollup.html and native.html):\r\n\r\n```\r\nshared import\r\n\"shared import\" should be logged twice, once above this log line, once below\r\nshared import\r\n```\r\n\r\nWhile Rollup operates differently from Webpack, I would expect the outputted code in the bundle here to be functionally similar, such that the function declaration imported from the shared import is hoisted and accessible in both of the modules that reference it. (See example of Rollup's output in dist/rollup/bundle.js in the repo linked above after running `npm run build`).\r\n\r\n<!-- \"It should work\" is not a helpful explanation -->\r\n<!-- Explain exactly how it should behave -->\r\n\r\n### **Other relevant information:**\r\nwebpack version:  4.43.0 / 5.0.0-beta.16\r\nNode.js version: v12.16.3\r\nOperating System: MacOS 10.15.4\r\nAdditional tools: Chrome 81.0.4044.138\r\n\r\nOther notes:\r\n\r\n * Reordering imports like this: https://github.com/bregenspan/webpack-circular-import-issue/commit/c4a9f00e1e2b5a9aefa84f3bf526d2f88429f305 works around the issue, but I did not expect this to be necessary.\r\n * This is a somewhat strange pathological case, but I did encounter it in the wild in a production application (after upgrading Babel, which had apparently been masking the issue in this particular code). I definitely intend to rewrite the relevant code to not have this cyclic dependency for readability and maintainability reasons, but it seems like a case where the code as written should work as expected and not produce a runtime error.\r\n * If this behavior is to spec and is a wontfix, it could be nice if there was a warning in this case, possibly by including something like [circular-dependency-plugin](https://github.com/aackerman/circular-dependency-plugin) by default.","closed_by":{"login":"sokra","id":1365881,"node_id":"MDQ6VXNlcjEzNjU4ODE=","avatar_url":"https://avatars.githubusercontent.com/u/1365881?v=4","gravatar_id":"","url":"https://api.github.com/users/sokra","html_url":"https://github.com/sokra","followers_url":"https://api.github.com/users/sokra/followers","following_url":"https://api.github.com/users/sokra/following{/other_user}","gists_url":"https://api.github.com/users/sokra/gists{/gist_id}","starred_url":"https://api.github.com/users/sokra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sokra/subscriptions","organizations_url":"https://api.github.com/users/sokra/orgs","repos_url":"https://api.github.com/users/sokra/repos","events_url":"https://api.github.com/users/sokra/events{/privacy}","received_events_url":"https://api.github.com/users/sokra/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/webpack/webpack/issues/10870/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/webpack/webpack/issues/10870/timeline","performed_via_github_app":null,"state_reason":"completed"}