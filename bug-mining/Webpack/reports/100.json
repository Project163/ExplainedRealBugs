{"url":"https://api.github.com/repos/webpack/webpack/issues/11277","repository_url":"https://api.github.com/repos/webpack/webpack","labels_url":"https://api.github.com/repos/webpack/webpack/issues/11277/labels{/name}","comments_url":"https://api.github.com/repos/webpack/webpack/issues/11277/comments","events_url":"https://api.github.com/repos/webpack/webpack/issues/11277/events","html_url":"https://github.com/webpack/webpack/issues/11277","id":673147522,"node_id":"MDU6SXNzdWU2NzMxNDc1MjI=","number":11277,"title":"[Webpack 5] (minimal repro included!) __webpack_modules__[moduleId] is undefined","user":{"login":"Birch-san","id":6141784,"node_id":"MDQ6VXNlcjYxNDE3ODQ=","avatar_url":"https://avatars.githubusercontent.com/u/6141784?v=4","gravatar_id":"","url":"https://api.github.com/users/Birch-san","html_url":"https://github.com/Birch-san","followers_url":"https://api.github.com/users/Birch-san/followers","following_url":"https://api.github.com/users/Birch-san/following{/other_user}","gists_url":"https://api.github.com/users/Birch-san/gists{/gist_id}","starred_url":"https://api.github.com/users/Birch-san/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Birch-san/subscriptions","organizations_url":"https://api.github.com/users/Birch-san/orgs","repos_url":"https://api.github.com/users/Birch-san/repos","events_url":"https://api.github.com/users/Birch-san/events{/privacy}","received_events_url":"https://api.github.com/users/Birch-san/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":816832417,"node_id":"MDU6TGFiZWw4MTY4MzI0MTc=","url":"https://api.github.com/repos/webpack/webpack/labels/webpack-5","name":"webpack-5","color":"c5def5","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":108,"created_at":"2020-08-04T23:33:35Z","updated_at":"2023-11-14T10:18:21Z","closed_at":"2021-03-01T12:12:51Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!-- Please don't delete this template because we'll close your issue -->\r\n<!-- Before creating an issue please make sure you are using the latest version of webpack. -->\r\n\r\n# Bug report\r\n\r\n<!-- Please ask questions on StackOverflow or the webpack Gitter. -->\r\n<!-- https://stackoverflow.com/questions/ask?tags=webpack -->\r\n<!-- https://gitter.im/webpack/webpack -->\r\n<!-- Issues which contain questions or support requests will be closed. -->\r\n\r\n**What is the current behavior?**\r\n\r\n`__webpack_require__` goes bang attempting to import a library local to our project (i.e. a sibling package in the same lerna monorepo).\r\n\r\nWe did not experience this problem in webpack 4.25.1, but we do experience the problem in webpack 5.0.0-beta.23.\r\n\r\nDepending on how modern your browser is, you will encounter one of the following error messages:\r\n\r\n```\r\nUncaught TypeError: __webpack_modules__[moduleId] is undefined\r\n    __webpack_require__ http://localhost:8080/main.js:455\r\n```\r\n\r\n```\r\nUncaught TypeError: Cannot read property 'call' of undefined\r\n    at __webpack_require__ (main.js:455)\r\n```\r\n\r\nYou'll recognise the latter from existing issues such as https://github.com/webpack/webpack/issues/6094. I think what I've found is just one of many ways to encounter this problem. I tried a lot of existing suggestions, but to no avail. Fortunately we have a repro this time. ðŸ™‚ \r\n\r\n**If the current behavior is a bug, please provide the steps to reproduce.**\r\n\r\nMinimal repro repository here:  \r\nhttps://github.com/Birch-san/webpack-repro\r\n\r\nRepository layout (`*` indicates a file output by build/installation):\r\n\r\n```\r\n  webpack-repro\r\n* â”œâ”€â”€ node_modules\r\n  â”œâ”€â”€ README.md\r\n  â”œâ”€â”€ package-lock.json\r\n  â”œâ”€â”€ package.json\r\n  â””â”€â”€ packages\r\n      â”œâ”€â”€ lib\r\n*     â”‚Â Â  â”œâ”€â”€ dist\r\n*     â”‚Â Â  â”‚Â Â  â””â”€â”€ main.js\r\n      â”‚Â Â  â”œâ”€â”€ package.json\r\n      â”‚Â Â  â”œâ”€â”€ src\r\n      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index.js\r\n      â”‚Â Â  â”‚Â Â  â””â”€â”€ utils.js\r\n      â”‚Â Â  â””â”€â”€ webpack.config.js\r\n      â””â”€â”€ web\r\n          â”œâ”€â”€ dist\r\n          â”‚Â Â  â”œâ”€â”€ index.html\r\n*         â”‚Â Â  â””â”€â”€ main.js\r\n          â”œâ”€â”€ node_modules\r\n          â”‚Â Â  â””â”€â”€ @my-cool-project\r\n          â”‚Â Â      â””â”€â”€ lib -> ../../../lib\r\n          â”œâ”€â”€ src\r\n          â”‚Â Â  â””â”€â”€ index.js\r\n          â””â”€â”€ webpack.config.js\r\n```\r\n\r\nFull file contents available in the linked repository, but for convenience I'll show some excerpts here.\r\n\r\nThere are two packages in this monorepo: `web` and `lib`.\r\n\r\n- `lib` is a library that exports one function, leftPad.\r\n- `web` is a webpage that `console.log()` a left-padded hello world.\r\n\r\n`packages/lib/webpack.config.js`:\r\n\r\n```js\r\nconst path = require('path')\r\n\r\nmodule.exports = {\r\n  entry: path.resolve(__dirname, 'src/index.js'),\r\n  output: {\r\n    path: path.resolve(__dirname, 'dist'),\r\n    filename: '[name].js',\r\n    library: 'lib',\r\n    libraryTarget: 'umd'\r\n  },\r\n  mode: 'development'\r\n};\r\n```\r\n\r\n`packages/web/webpack.config.js`:\r\n\r\n```js\r\nconst path = require('path')\r\n\r\nmodule.exports = {\r\n  entry: path.resolve(__dirname, 'src/index.js'),\r\n  output: {\r\n    filename: '[name].js',\r\n    publicPath: '/'\r\n  },\r\n  devServer: {\r\n    contentBase: './dist'\r\n  },\r\n  mode: 'development',\r\n  watch: true\r\n};\r\n```\r\n\r\n`packages/web/src/index.js`:\r\n\r\n```js\r\nimport { leftPad } from '@my-cool-project/lib'\r\nconsole.log(leftPad('hello world', 20));\r\n```\r\n\r\nI've tried to replicate the important behaviours of a lerna monorepo in a minimalist way.\r\n\r\n- every package has its own directory inside `packages`\r\n- `lib` gets imported, so I've given it a `package.json`\r\n- all dependencies are hoisted to root-level\r\n  - the only dependency is webpack so this doesn't really matter\r\n- `web` depends on `lib` via `@my-cool-project/lib`\r\n  - `web` has a package-local node_modules with a symlink `@my-cool-project/lib` that leads to the `lib` folder\r\n  - _it'd be more realistic if I'd hoisted this symlink to root-level, but making it package-local was an easy way to prevent its being clobbered by the npm install_\r\n\r\nSetup instructions:\r\n\r\n```bash\r\n# root-level npm install. our only dependencies are the webpack toolchain\r\nnpm i\r\n# build lib\r\ncd packages/lib\r\nnode ../../node_modules/.bin/webpack\r\n# run the website\r\ncd ../web\r\nnode ../../node_modules/.bin/webpack-dev-server\r\n```\r\n\r\nNavigate to http://localhost:8080\r\n\r\nIn Firefox 80.0b3, you should expect to see the following error when `web` attempts to import `lib`:\r\n\r\n```\r\nUncaught TypeError: __webpack_modules__[moduleId] is undefined\r\n    __webpack_require__ http://localhost:8080/main.js:455\r\n    <anonymous> webpack://lib/./src/index.js?:5\r\n    js webpack:///./node_modules/@my-cool-project/lib/dist/main.js?:28\r\n    __nested_webpack_require_3026__ webpack:///./node_modules/@my-cool-project/lib/dist/main.js?:65\r\n    <anonymous> webpack:///./node_modules/@my-cool-project/lib/dist/main.js?:104\r\n    <anonymous> webpack:///./node_modules/@my-cool-project/lib/dist/main.js?:105\r\n    webpackUniversalModuleDefinition webpack:///./node_modules/@my-cool-project/lib/dist/main.js?:11\r\n    <anonymous> webpack:///./node_modules/@my-cool-project/lib/dist/main.js?:13\r\n    node_modules my-cool-project/lib/dist/main.js@http://localhost:8080/main.js:418\r\n    __webpack_require__ http://localhost:8080/main.js:455\r\n    <anonymous> webpack:///./src/index.js?:2\r\n    js http://localhost:8080/main.js:432\r\n    __webpack_require__ http://localhost:8080/main.js:455\r\n    <anonymous> http://localhost:8080/main.js:529\r\n    <anonymous> http://localhost:8080/main.js:532\r\n```\r\n\r\nIn Chrome 84, you'll get a slightly vaguer message:\r\n\r\n```\r\nUncaught TypeError: Cannot read property 'call' of undefined\r\n    at __webpack_require__ (main.js:455)\r\n    at eval (index.js:5)\r\n    at Object../src/index.js (main.js:28)\r\n    at __nested_webpack_require_3026__ (main.js:65)\r\n    at eval (main.js:104)\r\n    at eval (main.js:105)\r\n    at webpackUniversalModuleDefinition (main.js:11)\r\n    at eval (main.js:13)\r\n    at Object../node_modules/@my-cool-project/lib/dist/main.js (main.js:418)\r\n    at __webpack_require__ (main.js:455)\r\n```\r\n\r\n<!-- A great way to do this is to provide your configuration via a GitHub repository -->\r\n<!-- The most helpful is a minimal reproduction with instructions on how to reproduce -->\r\n<!-- Repositories with too many files or large `webpack.config.js` files are not suitable -->\r\n<!-- Please only add small code snippets directly into this issue -->\r\n<!-- https://gist.github.com is a good place for longer code snippets -->\r\n<!-- If your issue is caused by a plugin or loader, please create an issue on the loader/plugin repository instead -->\r\n\r\n**What is the expected behavior?**\r\n\r\nNavigating to http://localhost:8080 should output the following message to the console:\r\n\r\n```\r\n         hello world\r\n```\r\n\r\nI think this may be to do with module federation? `lib` fails to find its own module, `./src/utils.js`. I think it's looking in the wrong place; it needs to look among _its own modules_, but it's looking for them in the top-level `__webpack_modules__`.\r\n\r\nThanks for any assistance you can provide! ðŸ˜„ \r\n\r\n<!-- \"It should work\" is not a helpful explanation -->\r\n<!-- Explain exactly how it should behave -->\r\n\r\n**Other relevant information:**\r\nwebpack version: 5.0.0-beta.23\r\nNode.js version: v12.12.0\r\nOperating System: macOS Mojave 10.14.6","closed_by":{"login":"sokra","id":1365881,"node_id":"MDQ6VXNlcjEzNjU4ODE=","avatar_url":"https://avatars.githubusercontent.com/u/1365881?v=4","gravatar_id":"","url":"https://api.github.com/users/sokra","html_url":"https://github.com/sokra","followers_url":"https://api.github.com/users/sokra/followers","following_url":"https://api.github.com/users/sokra/following{/other_user}","gists_url":"https://api.github.com/users/sokra/gists{/gist_id}","starred_url":"https://api.github.com/users/sokra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sokra/subscriptions","organizations_url":"https://api.github.com/users/sokra/orgs","repos_url":"https://api.github.com/users/sokra/repos","events_url":"https://api.github.com/users/sokra/events{/privacy}","received_events_url":"https://api.github.com/users/sokra/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/webpack/webpack/issues/11277/reactions","total_count":23,"+1":23,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/webpack/webpack/issues/11277/timeline","performed_via_github_app":null,"state_reason":"completed"}