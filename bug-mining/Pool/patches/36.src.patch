diff --git a/src/java/org/apache/commons/pool/impl/GenericKeyedObjectPool.java b/src/java/org/apache/commons/pool/impl/GenericKeyedObjectPool.java
index 333c8c01..b3d46b97 100644
--- a/src/java/org/apache/commons/pool/impl/GenericKeyedObjectPool.java
+++ b/src/java/org/apache/commons/pool/impl/GenericKeyedObjectPool.java
@@ -1106,12 +1106,21 @@ public class GenericKeyedObjectPool extends BaseKeyedObjectPool implements Keyed
                         case WHEN_EXHAUSTED_GROW:
                             // allow new object to be created
                             synchronized (this) {
-                                _allocationQueue.remove(latch);
-                                latch.getPool().incrementInternalProcessingCount();
+                                // Make sure allocate hasn't already assigned an object
+                                // in a different thread
+                                if (latch.getPair() == null) {
+                                    _allocationQueue.remove(latch);
+                                    latch.getPool().incrementInternalProcessingCount();
+                                }
                             }
                         break;
                         case WHEN_EXHAUSTED_FAIL:
                             synchronized (this) {
+                                // Make sure allocate hasn't already assigned an object
+                                // in a different thread
+                                if (latch.getPair() != null) {
+                                    break;
+                                }
                                 _allocationQueue.remove(latch);
                             }
                             throw new NoSuchElementException("Pool exhausted");
@@ -1136,6 +1145,15 @@ public class GenericKeyedObjectPool extends BaseKeyedObjectPool implements Keyed
                                 throw e;
                                 }
                             if (maxWait > 0 && ((System.currentTimeMillis() - starttime) >= maxWait)) {
+                                synchronized (this) {
+                                    // Make sure allocate hasn't already assigned an object
+                                    // in a different thread
+                                    if (latch.getPair() == null) {
+                                        _allocationQueue.remove(latch);
+                                    } else {
+                                        break;
+                                    }
+                                }
                                 throw new NoSuchElementException("Timeout waiting for idle object");
                             } else {
                                 continue; // keep looping
diff --git a/src/java/org/apache/commons/pool/impl/GenericObjectPool.java b/src/java/org/apache/commons/pool/impl/GenericObjectPool.java
index 9291fe2b..bb45fc55 100644
--- a/src/java/org/apache/commons/pool/impl/GenericObjectPool.java
+++ b/src/java/org/apache/commons/pool/impl/GenericObjectPool.java
@@ -1074,12 +1074,21 @@ public class GenericObjectPool extends BaseObjectPool implements ObjectPool {
                         case WHEN_EXHAUSTED_GROW:
                             // allow new object to be created
                             synchronized (this) {
-                                _allocationQueue.remove(latch);
-                                _numInternalProcessing++;
+                                // Make sure allocate hasn't already assigned an object
+                                // in a different thread
+                                if (latch.getPair() == null) {
+                                    _allocationQueue.remove(latch);
+                                    _numInternalProcessing++;
+                                }
                             }
                             break;
                         case WHEN_EXHAUSTED_FAIL:
                             synchronized (this) {
+                                // Make sure allocate hasn't already assigned an object
+                                // in a different thread
+                                if (latch.getPair() != null) {
+                                    break;
+                                }
                                 _allocationQueue.remove(latch);
                             }
                             throw new NoSuchElementException("Pool exhausted");
@@ -1104,6 +1113,16 @@ public class GenericObjectPool extends BaseObjectPool implements ObjectPool {
                                 throw e;
                             }
                             if(maxWait > 0 && ((System.currentTimeMillis() - starttime) >= maxWait)) {
+                                synchronized(this) {
+                                    // Make sure allocate hasn't already assigned an object
+                                    // in a different thread
+                                    if (latch.getPair() == null) {
+                                        // Remove latch from the allocation queue
+                                        _allocationQueue.remove(latch);
+                                    } else {
+                                        break;
+                                    }
+                                }
                                 throw new NoSuchElementException("Timeout waiting for idle object");
                             } else {
                                 continue; // keep looping
