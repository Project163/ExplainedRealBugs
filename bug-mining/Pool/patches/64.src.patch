diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index fef71990..880f0436 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -54,6 +54,10 @@
     <action dev="markt" type="update">
       Guard against multiple returns of the same object to the pool.
     </action>
+    <action dev="markt" type="fix" issue="POOL-150">
+      Ensure GKOP.preparePool() throws an exception if no factory has been
+      defined.
+    </action>
   </release>
   <release version="1.5.6" date="2011-04-03" description="This is a patch release, including bugfixes only.">
     <action dev="markt" type="fix" issue="POOL-179" due-to="Axel Grossmann">
diff --git a/src/test/org/apache/commons/pool2/impl/TestGenericKeyedObjectPool.java b/src/test/org/apache/commons/pool2/impl/TestGenericKeyedObjectPool.java
index 407dacf1..ff302b46 100644
--- a/src/test/org/apache/commons/pool2/impl/TestGenericKeyedObjectPool.java
+++ b/src/test/org/apache/commons/pool2/impl/TestGenericKeyedObjectPool.java
@@ -1317,6 +1317,23 @@ public class TestGenericKeyedObjectPool extends TestBaseKeyedObjectPool {
         pool.returnObject("1", waiter);  // Will throw IllegalStateException if dead
     }
     
+    /**
+     * Test case for POOL-150.
+     */
+    @Test
+    public void testPreparePoolNullFactory() throws Exception {
+        GenericKeyedObjectPool<Object, Object> gkop =
+            new GenericKeyedObjectPool<Object, Object>();
+        gkop.setMinIdlePerKey(1);
+        Exception e = null;
+        try {
+            gkop.preparePool("foo");
+        } catch (IllegalStateException ise) {
+            e = ise;
+        }
+        assertNotNull(e);
+    }
+
     /*
      * Very simple test thread that just tries to borrow an object from
      * the provided pool with the specified key and returns it
