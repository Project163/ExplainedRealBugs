diff --git a/src/java/org/apache/commons/pool/impl/GenericKeyedObjectPool.java b/src/java/org/apache/commons/pool/impl/GenericKeyedObjectPool.java
index 67ad76be..de67d63f 100644
--- a/src/java/org/apache/commons/pool/impl/GenericKeyedObjectPool.java
+++ b/src/java/org/apache/commons/pool/impl/GenericKeyedObjectPool.java
@@ -1108,9 +1108,9 @@ public class GenericKeyedObjectPool extends BaseKeyedObjectPool implements Keyed
                         case WHEN_EXHAUSTED_GROW:
                             // allow new object to be created
                             synchronized (this) {
-                                // Make sure allocate hasn't already assigned an object
-                                // in a different thread
-                                if (latch.getPair() == null) {
+                                // Make sure another thread didn't allocate us an object
+                                // or permit a new object to be created
+                                if (latch.getPair() == null && !latch.mayCreate()) {
                                     _allocationQueue.remove(latch);
                                     latch.getPool().incrementInternalProcessingCount();
                                 }
@@ -1119,8 +1119,8 @@ public class GenericKeyedObjectPool extends BaseKeyedObjectPool implements Keyed
                         case WHEN_EXHAUSTED_FAIL:
                             synchronized (this) {
                                 // Make sure allocate hasn't already assigned an object
-                                // in a different thread
-                                if (latch.getPair() != null) {
+                                // in a different thread or permitted a new object to be created
+                                if (latch.getPair() != null || latch.mayCreate()) {
                                     break;
                                 }
                                 _allocationQueue.remove(latch);
@@ -1130,7 +1130,8 @@ public class GenericKeyedObjectPool extends BaseKeyedObjectPool implements Keyed
                             try {
                                 synchronized (latch) {
                                     // Before we wait, make sure another thread didn't allocate us an object
-                                    if (latch.getPair() == null) {
+                                    // or permit a new object to be created
+                                    if (latch.getPair() == null && !latch.mayCreate()) {
                                         if (maxWait <= 0) {
                                             latch.wait();
                                         } else {
@@ -1154,8 +1155,8 @@ public class GenericKeyedObjectPool extends BaseKeyedObjectPool implements Keyed
                             if (maxWait > 0 && ((System.currentTimeMillis() - starttime) >= maxWait)) {
                                 synchronized (this) {
                                     // Make sure allocate hasn't already assigned an object
-                                    // in a different thread
-                                    if (latch.getPair() == null) {
+                                    // in a different thread or permitted a new object to be created
+                                    if (latch.getPair() == null && !latch.mayCreate()) {
                                         _allocationQueue.remove(latch);
                                     } else {
                                         break;
diff --git a/src/java/org/apache/commons/pool/impl/GenericObjectPool.java b/src/java/org/apache/commons/pool/impl/GenericObjectPool.java
index eb7c110e..1d1b7c61 100644
--- a/src/java/org/apache/commons/pool/impl/GenericObjectPool.java
+++ b/src/java/org/apache/commons/pool/impl/GenericObjectPool.java
@@ -1076,9 +1076,9 @@ public class GenericObjectPool extends BaseObjectPool implements ObjectPool {
                         case WHEN_EXHAUSTED_GROW:
                             // allow new object to be created
                             synchronized (this) {
-                                // Make sure allocate hasn't already assigned an object
-                                // in a different thread
-                                if (latch.getPair() == null) {
+                                // Make sure another thread didn't allocate us an object
+                                // or permit a new object to be created
+                                if (latch.getPair() == null && !latch.mayCreate()) {
                                     _allocationQueue.remove(latch);
                                     _numInternalProcessing++;
                                 }
@@ -1087,8 +1087,8 @@ public class GenericObjectPool extends BaseObjectPool implements ObjectPool {
                         case WHEN_EXHAUSTED_FAIL:
                             synchronized (this) {
                                 // Make sure allocate hasn't already assigned an object
-                                // in a different thread
-                                if (latch.getPair() != null) {
+                                // in a different thread or permitted a new object to be created
+                                if (latch.getPair() != null || latch.mayCreate()) {
                                     break;
                                 }
                                 _allocationQueue.remove(latch);
@@ -1098,7 +1098,8 @@ public class GenericObjectPool extends BaseObjectPool implements ObjectPool {
                             try {
                                 synchronized (latch) {
                                     // Before we wait, make sure another thread didn't allocate us an object
-                                    if (latch.getPair() == null) {
+                                    // or permit a new object to be created
+                                    if (latch.getPair() == null && !latch.mayCreate()) {
                                         if(maxWait <= 0) {
                                             latch.wait();
                                         } else {
@@ -1122,8 +1123,8 @@ public class GenericObjectPool extends BaseObjectPool implements ObjectPool {
                             if(maxWait > 0 && ((System.currentTimeMillis() - starttime) >= maxWait)) {
                                 synchronized(this) {
                                     // Make sure allocate hasn't already assigned an object
-                                    // in a different thread
-                                    if (latch.getPair() == null) {
+                                    // in a different thread or permitted a new object to be created
+                                    if (latch.getPair() == null && !latch.mayCreate()) {
                                         // Remove latch from the allocation queue
                                         _allocationQueue.remove(latch);
                                     } else {
diff --git a/xdocs/changes.xml b/xdocs/changes.xml
index f66da77d..6c123e97 100644
--- a/xdocs/changes.xml
+++ b/xdocs/changes.xml
@@ -22,7 +22,14 @@
   </properties>
   <body>
 
-  <release version="1.5.3" date="TBD">
+  <release version="1.5.3" date="TBD" description=
+"This is a patch release containing a fix for POOL-149, a regression
+introduced in version 1.5.">
+    <action dev="markt" type="fix" issue="POOL-149" due-to="Shuyang Zhou">
+      Fix case where a thread could end up waiting indefinitely even if objects
+      were available. Also fixes a couple of leaks in the internal processing
+      object count that could lead to pool exhaustion.
+    </action>
   </release>
   <release version="1.5.2" date="2009-07-12" description=
 "This is a patch release containing fixes for POOL-146 and POOL-147, regressions
