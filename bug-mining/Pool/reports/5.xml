<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:16:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[POOL-91] StackObjectPool.borrowObject infinate loop when makeObject returns null</title>
                <link>https://issues.apache.org/jira/browse/POOL-91</link>
                <project id="12310488" key="POOL">Commons Pool</project>
                    <description>&lt;p&gt;StackObjectPool.borrowObject has a infinate loop when makeObject returns null.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12356295">POOL-91</key>
            <summary>StackObjectPool.borrowObject infinate loop when makeObject returns null</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sandymac">Sandy McArthur Jr</assignee>
                                    <reporter username="sandymac">Sandy McArthur Jr</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Nov 2006 19:40:20 +0000</created>
                <updated>Sun, 12 Sep 2010 17:43:28 +0000</updated>
                            <resolved>Fri, 15 Dec 2006 21:20:10 +0000</resolved>
                                                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12451983" author="bayard" created="Wed, 22 Nov 2006 16:25:14 +0000"  >&lt;p&gt;Is there any reason for null to be a legal makeObject return? ie) could we throw a RuntimeException of some kind when null is returned?&lt;/p&gt;</comment>
                            <comment id="12452008" author="sandymac" created="Wed, 22 Nov 2006 18:25:02 +0000"  >&lt;p&gt;makeObject returning null is definitely bogus behavior, but in older version of Pool (1.2 and before) StackObjectPool would return null if makeObject returned null. The question is: do we want to go with older behavior or do we want to go with what is less backwards compatible behavior but IMO better?&lt;/p&gt;</comment>
                            <comment id="12456578" author="bayard" created="Thu, 7 Dec 2006 20:16:40 +0000"  >&lt;p&gt;What would be bad about returning null again?&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Sorry for the dumb question - I&amp;#39;ve not done much Pool dev in the past so new to a lot of  it&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="12456609" author="sandymac" created="Thu, 7 Dec 2006 21:45:31 +0000"  >&lt;p&gt;For me it&apos;s an issue of usability. I view a pool as a source of reusable heavyweight objects. If the pool is unable to provide one, then it&apos;s a problem and thus an Exception. If the pool returns null then you have two ways of expressing a problem and now the client code has to deal with two ways of identifying a problem.:&lt;/p&gt;

&lt;p&gt;try {&lt;br/&gt;
  SomeObject o = pool.borrowObject();&lt;br/&gt;
  // do work&lt;br/&gt;
} catch (Exception e) {&lt;br/&gt;
  // abort, the pool couldn&apos;t provide an instance&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;versus:&lt;/p&gt;

&lt;p&gt;try {&lt;br/&gt;
  SomeObject o = pool.borrowObject();&lt;br/&gt;
  if (o == null) &lt;/p&gt;
{
    // abort, the pool couldn&apos;t provide an instance
  }
&lt;p&gt;  // do work&lt;br/&gt;
} catch (Exception e) {&lt;br/&gt;
  // also abort, the pool couldn&apos;t provide an instance&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;What initially got me involved with Pool was that I was duplicating code both in the PoolableObjectFactory and after check the result of pool.borrowObject() because the pool either didn&apos;t do all it could to succeed and only throw an exception when there was a real problem. The Pool roadmap is a reflection of my frustrations: &lt;a href=&quot;http://wiki.apache.org/jakarta-commons/PoolRoadMap&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/jakarta-commons/PoolRoadMap&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12456971" author="bens" created="Fri, 8 Dec 2006 20:31:45 +0000"  >&lt;p&gt;I&apos;m not sure I like throwing the exception either. I can think of situations where I might want borrowings to fail silently or even have the borrower create its own instance of the object if it can&apos;t get one from the pool.&lt;/p&gt;

&lt;p&gt;This is admittedly a major change, but I think it would be neat to take exceptions out of the borrowObject() signature and allow users to specify a handler for when borrow() fails. Imagine an interface like:&lt;/p&gt;

&lt;p&gt;public interface FailedBorrowHandler() {&lt;br/&gt;
    void failedBorrow(ObjectPool pool);&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;and a method in ObjectPool:&lt;/p&gt;

&lt;p&gt;void setFailedBorrowHandler(FailedBorrowHandler handler);&lt;/p&gt;

&lt;p&gt;Clients can then implement this interface to do whatever they want when a borrow fails. Maybe the objects in the pool aren&apos;t expected to be readily available and so borrowObject() is expected to fail half the time; in that case, requiring the caller to handle a checked exception is a pain, not a gain. If you&apos;re pooling threads, you may want to wait a few seconds and then try to borrow again, or even kill a currently engaged low-priority thread and replace it with your high-priority task.&lt;/p&gt;

&lt;p&gt;As I said, this is a huge change, but after having used this approach in JDK 1.5&apos;s java.util.concurrent.ThreadPoolExecutor, I&apos;ve become a big fan of handling pools like this.&lt;/p&gt;</comment>
                            <comment id="12456990" author="bens" created="Fri, 8 Dec 2006 22:05:30 +0000"  >&lt;p&gt;Also, I&apos;d be happy to come up with some sample policies that implement such an interface. I&apos;ll put together an example that does it for one of the pools.&lt;/p&gt;</comment>
                            <comment id="12457527" author="bens" created="Tue, 12 Dec 2006 00:41:50 +0000"  >&lt;p&gt;As promised, a quick thrown-together example of what the API would be like with the policy I&apos;ve suggested.&lt;/p&gt;</comment>
                            <comment id="12458821" author="h2o" created="Fri, 15 Dec 2006 15:14:11 +0000"  >&lt;p&gt;Hi - I&apos;ve been following this thread for a while and understand the pros and cons of both the lenient and strict approaches for borrowObject, though I&apos;m undecded about the null vs. exception behaviour. Anyway, my question is: wouldn&apos;t this be better handled by a decorated factory instead of pluggable strategies, which will only make things more complicated? After all this behaviour is very much a one-time/configuration thing.&lt;/p&gt;</comment>
                            <comment id="12458847" author="sandymac" created="Fri, 15 Dec 2006 16:56:20 +0000"  >&lt;p&gt;I think there is a fundamental difference between a ThreadPoolExecutor and ObjectPool. Mainly that with a Executor your client code hands it a Runnable to execute and forget about it but with a Pool your client code keeps interacting with the pool many times. Also the Executor has it&apos;s own Threads and is asynchronous to the client code; you never know when the submitted Runnable may throw an exception. Pools are synchronous and you know that borrowObject is not going to fail except for when it&apos;s called by your client code. My point is the only way to be notified or deal with errors for an Executor is via callbacks (or sub-classing) but since there is direct interaction with the pool, error handling callbacks aren&apos;t needed.&lt;/p&gt;</comment>
                            <comment id="12458919" author="bens" created="Fri, 15 Dec 2006 20:32:51 +0000"  >&lt;p&gt;I&apos;m interested in the decorated factory approach &amp;#8211; how would you see that API working?&lt;/p&gt;

&lt;p&gt;Sandy, your point about the concurrent library being fundamentally different in approach from commons-pool is well taken; perhaps it would be helpful if I explained how I&apos;ve seen pool. I thought of pool as a general-purpose pool including support for threads as well as POJOs, and under that assumption the ThreadPoolExecutor approach made good sense. Of course when you&apos;re pooling heavyweight objects that don&apos;t implement Runnable, the thread-based approach doesn&apos;t really apply, and the callback is overkill. &lt;/p&gt;

&lt;p&gt;If pool isn&apos;t about threads, and the answer to someone who wants thread pooling is to either use JDK 5 or util.concurrent, then I&apos;m perfectly happy with that. However, on a purely API basis, I&apos;d still like to entertain the idea of not forcing the client to catch a checked exception when borrowing an object. A factory approach could lead that way, and I&apos;d be interested to see where that leads.&lt;/p&gt;</comment>
                            <comment id="12458935" author="sandymac" created="Fri, 15 Dec 2006 21:09:46 +0000"  >&lt;p&gt;Ben, a pool can pool any &quot;Poolable Object&quot;. That could be a Thread or just about any other reusable object. There is a difference between a Pool of pooled Threads and Threads that are part of the Pool but not the pooled objects themselves. The PoolableObjectFactory is sufficient to manage the former but Executor needs a policy because it is the latter. &lt;/p&gt;

&lt;p&gt;I&apos;m all for moving away from forcing the client code to deal with exceptions but sometimes exceptions make sense. The Pool road map explains what I&apos;m trying to do about that: &lt;a href=&quot;http://wiki.apache.org/jakarta-commons/PoolRoadMap&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/jakarta-commons/PoolRoadMap&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12458939" author="sandymac" created="Fri, 15 Dec 2006 21:20:10 +0000"  >&lt;p&gt;Committed a fix to throw a NoSuchElementException when makeObject returns a null.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12384998">POOL-117</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12346951" name="sample-borrow-fail-pool-policy.tar.bz2" size="1717" author="bens" created="Tue, 12 Dec 2006 00:41:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>166684</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 years, 50 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0zfof:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204842</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>