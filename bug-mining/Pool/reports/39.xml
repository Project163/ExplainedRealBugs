<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:16:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[POOL-146] Thread deadlock issue in GenericKeyedObjectPool borrowObject()</title>
                <link>https://issues.apache.org/jira/browse/POOL-146</link>
                <project id="12310488" key="POOL">Commons Pool</project>
                    <description>&lt;p&gt;I am a new user of common-pools and I was having some weird behavior with GenericKeyedObjectPool&lt;/p&gt;

&lt;p&gt;GenericKeyedObjectPool: 1074:1077&lt;/p&gt;

&lt;p&gt;     public Object borrowObject(Object key) throws Exception {&lt;br/&gt;
        long starttime = System.currentTimeMillis();&lt;br/&gt;
        Latch latch = new Latch(key);     ---&amp;gt; This object is tried to be used for managing pool size by calling wait()/notify() &lt;/p&gt;

&lt;p&gt;My thinking is this should be a shared/global object and not created new for each call ?? &lt;/p&gt;
</description>
                <environment></environment>
        <key id="12429133">POOL-146</key>
            <summary>Thread deadlock issue in GenericKeyedObjectPool borrowObject()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="bbansal">bhupesh bansal</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Jun 2009 23:32:56 +0000</created>
                <updated>Tue, 14 Jul 2009 01:13:25 +0000</updated>
                            <resolved>Sun, 5 Jul 2009 18:16:34 +0000</resolved>
                                    <version>1.5</version>
                    <version>1.5.1</version>
                                    <fixVersion>1.5.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12725396" author="psteitz" created="Mon, 29 Jun 2009 23:46:02 +0000"  >&lt;p&gt;Can you be more specific on the &quot;weird behavior&quot; you are observing? &lt;/p&gt;</comment>
                            <comment id="12725400" author="bbansal" created="Tue, 30 Jun 2009 00:07:28 +0000"  >&lt;p&gt;sure, &lt;/p&gt;

&lt;p&gt;I am using it as a Socket pool with the KeyedPoolableObjectFactory as a  socketFactory which returns a socket for each makeObject() call&lt;br/&gt;
and close the socket in destroyObject() &lt;/p&gt;

&lt;p&gt;The Test scenario which causes issue is this: &lt;br/&gt;
  Client --&amp;gt; socket call to server A and B (B is slow in freeing up resource where  A is fast to free)&lt;/p&gt;

&lt;p&gt;  Common-Pools-1.5.1 : both A and B start throwing NoSuchElementException&lt;br/&gt;
  Common-Pools-1.4 :  only A throws NoSuchElementException and B keeps allocating resource. &lt;/p&gt;

&lt;p&gt;I am trying to write a test case for the same will attach it once m done. &lt;/p&gt;

&lt;p&gt;Best&lt;br/&gt;
Bhupesh&lt;/p&gt;
</comment>
                            <comment id="12725401" author="bbansal" created="Tue, 30 Jun 2009 00:08:55 +0000"  >&lt;p&gt;Correction : A is slow in freeing up resource where B is  fast  (not vice-versa as mentioned last time)&lt;/p&gt;</comment>
                            <comment id="12726465" author="markt" created="Thu, 2 Jul 2009 12:53:16 +0000"  >&lt;p&gt;Am I correct in thinking that your have a single pool of sockets that clients use to connect to either Server A or Server B?&lt;/p&gt;</comment>
                            <comment id="12727109" author="bbansal" created="Fri, 3 Jul 2009 19:46:21 +0000"  >&lt;p&gt;Yes... &lt;/p&gt;

&lt;p&gt;they share the same socket pool (GenericKeyedObjectPool) keyed on nodeId for server A /B. &lt;/p&gt;

&lt;p&gt; my understanding is threads blocked on Key A (slow server) should not cause thread blocking for Key B ?? Is this assumption correct. &lt;/p&gt;</comment>
                            <comment id="12727351" author="markt" created="Sun, 5 Jul 2009 17:06:25 +0000"  >&lt;p&gt;OK, now I understand.&lt;/p&gt;

&lt;p&gt;That is a bug although making the Latch object global is not the way to address this. I have added a test case and am working on a patch.&lt;/p&gt;</comment>
                            <comment id="12727353" author="markt" created="Sun, 5 Jul 2009 18:16:34 +0000"  >&lt;p&gt;This has now been fixed. Many thanks for the report.&lt;/p&gt;</comment>
                            <comment id="12727363" author="bbansal" created="Sun, 5 Jul 2009 21:15:01 +0000"  >&lt;p&gt;Many Thanks Mark, &lt;/p&gt;

&lt;p&gt;Can you attach the patch to this bug ?? I would like to see the fix I spent considerable time looking into the commons-pools code base and couldn&apos;t find the issue and yes global Latch was not a solution I understood after looking into the code later. &lt;/p&gt;

&lt;p&gt;BTW have you looked into ArrayBlockingQueue from java 1.5.0 onwards in their concurrent package ?? I was thinking using that would clean up the code a lot ?&lt;/p&gt;</comment>
                            <comment id="12727365" author="markt" created="Sun, 5 Jul 2009 21:31:43 +0000"  >&lt;p&gt;Use the &quot;Subversion commits&quot; tab to see the changes related to this bug.&lt;/p&gt;

&lt;p&gt;Utilising JDK 1.5 features is one of the considerations for the Pool 2.x series. There was a thread on the commons dev list about this not that long ago.&lt;/p&gt;</comment>
                            <comment id="12727388" author="plindner" created="Mon, 6 Jul 2009 04:37:58 +0000"  >&lt;p&gt;Regarding ArrayBlockingQueue there is always backport-util-concurrent, seems like a logical step to me if 1.4 compatibility is desired..&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>166721</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 20 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0zepr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204686</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>