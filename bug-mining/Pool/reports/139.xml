<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:16:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[POOL-336] GenericObjectPool&apos;s borrowObject lock if create() fails with Error</title>
                <link>https://issues.apache.org/jira/browse/POOL-336</link>
                <project id="12310488" key="POOL">Commons Pool</project>
                    <description>&lt;p&gt;We&apos;ve spotted exactly the same problem as described in &lt;a href=&quot;https://issues.apache.org/jira/browse/POOL-303&quot; title=&quot;GenericObjectPool&amp;#39;s borrowObject may stuck if create() always fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;POOL-303&quot;&gt;&lt;del&gt;POOL-303&lt;/del&gt;&lt;/a&gt; for a pool using mariadb-connector-j-2.1.2 with a pool configured to a size, which exactly reflects the normal quantity of used DB connections. &lt;br/&gt;
After weeks of monitoring the situation, we were able to see the same problem as described in &lt;a href=&quot;https://issues.apache.org/jira/browse/POOL-303&quot; title=&quot;GenericObjectPool&amp;#39;s borrowObject may stuck if create() always fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;POOL-303&quot;&gt;&lt;del&gt;POOL-303&lt;/del&gt;&lt;/a&gt;. After some more drilldown efforts we concluded, that the problem is triggered, because mariadb-connector-j throws instances of Throwables derived from &lt;tt&gt;java.lang.Error&lt;/tt&gt;, which are not instances of &lt;tt&gt;java.lang.Execption&lt;/tt&gt;.&lt;br/&gt;
This leads to a leak of &lt;tt&gt;makeCount&lt;/tt&gt; in GenericObjectPool.create(), because &lt;tt&gt;makeCount&lt;/tt&gt; is only decremented, when an instance of &lt;tt&gt;java.lang.Exception&lt;/tt&gt; is thrown and not when an instance of &lt;tt&gt;java.langError&lt;/tt&gt; is thrown.&lt;/p&gt;</description>
                <environment>&lt;p&gt;mariadb-connector-j&lt;/p&gt;</environment>
        <key id="13127775">POOL-336</key>
            <summary>GenericObjectPool&apos;s borrowObject lock if create() fails with Error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="wolfgang.glas@ev-i.at">Wolfgang Glas</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Sat, 30 Dec 2017 20:11:56 +0000</created>
                <updated>Thu, 11 Jan 2018 13:08:17 +0000</updated>
                            <resolved>Sun, 31 Dec 2017 06:30:31 +0000</resolved>
                                    <version>2.4.3</version>
                    <version>2.5.0</version>
                                    <fixVersion>2.6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16306929" author="wolfgang.glas@ev-i.at" created="Sat, 30 Dec 2017 20:15:05 +0000"  >&lt;p&gt;Add a test case failing with commons-pool-2.5.0, when create() throws an instance of java.lang.Error&lt;/p&gt;</comment>
                            <comment id="16306930" author="wolfgang.glas@ev-i.at" created="Sat, 30 Dec 2017 20:17:39 +0000"  >&lt;p&gt;Add a fix by decrementing createCount on all throwables.&lt;/p&gt;</comment>
                            <comment id="16306932" author="wolfgang.glas@ev-i.at" created="Sat, 30 Dec 2017 20:25:34 +0000"  >&lt;p&gt;Please note, that the situation, that &lt;tt&gt;ObjectFactory.create()&lt;/tt&gt; throws an instance of &lt;tt&gt;java.lang.Error&lt;/tt&gt; is not unlikely, because &lt;tt&gt;java.lang.OutOfMemoryError&lt;/tt&gt; and other error thrown by the JVM will for sure happen under various circumstances...&lt;/p&gt;</comment>
                            <comment id="16307110" author="garydgregory" created="Sun, 31 Dec 2017 06:28:51 +0000"  >&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;Thank you for your report and patch.&lt;/p&gt;

&lt;p&gt;There are a lot of other places where we catch an &lt;tt&gt;Exception&lt;/tt&gt;. Do you see other instances where the catch should be for a &lt;tt&gt;Throwable&lt;/tt&gt;?&lt;/p&gt;

&lt;p&gt;Thank you,&lt;br/&gt;
Gary&lt;/p&gt;</comment>
                            <comment id="16307111" author="garydgregory" created="Sun, 31 Dec 2017 06:30:31 +0000"  >&lt;p&gt;In Git master now. Please verify and close. Or, continue based on my question &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16307164" author="wolfgang.glas@ev-i.at" created="Sun, 31 Dec 2017 09:47:44 +0000"  >&lt;p&gt;Hello Gary, Thanks for applying my patch!&lt;br/&gt;
I already started spotting other occurrences of &lt;tt&gt;catch(Exception)&lt;/tt&gt;, most notably in GenericObjectPool and GenericKeyedObjectPool.&lt;br/&gt;
However, it might get very tedious to write test cases for each and every code point catching an Exception.&lt;br/&gt;
Before starting this effort, we should get clear on a concise policy for the catchers.&lt;br/&gt;
From my point of view, catching &lt;tt&gt;Throwable&lt;/tt&gt; should be the default pattern, but I&apos;d like to hear the opinion of the original author of the code, whether there was a specific reason for sticking to &lt;tt&gt;catch(Exception)&lt;/tt&gt; rather than &lt;tt&gt;catch(Throwable)&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16307251" author="garydgregory" created="Sun, 31 Dec 2017 16:34:48 +0000"  >&lt;p&gt;Agreed on getting more input.&lt;/p&gt;</comment>
                            <comment id="16307291" author="wolfgang.glas@ev-i.at" created="Sun, 31 Dec 2017 20:21:27 +0000"  >&lt;p&gt;Maybe we should raise a separate issue and discuss the details of the catcher policy there?&lt;/p&gt;</comment>
                            <comment id="16307386" author="markt" created="Mon, 1 Jan 2018 07:44:03 +0000"  >&lt;p&gt;Catching Throwable is generally a bad idea. The current code is written on the basis that if a Throwable is thrown then that represents a fatal error so there is no point catching it. The view was that if object factories (or the code they call) are routinely throwing java.lang.Error then that is a bug and should be fixed at source.&lt;/p&gt;

&lt;p&gt;In the JDBC driver case the options are: a) raise a bug against the driver, b) add protection in DBCP or c) add protection in POOL. My slight preference remains for a) but I don&apos;t object to adding protection if that is the way the community wants to go.&lt;/p&gt;

&lt;p&gt;If we are going to go the protection route then I think it makes more sense in POOL than in DBCP since that would be a more general fix. I don&apos;t see an argument for providing the protection only in DBCP.&lt;/p&gt;

&lt;p&gt;If Throwable protection is added then it needs to be added consistently - i.e. to all locations that call external code.&lt;/p&gt;

&lt;p&gt;Throwable protection also needs to include code along these lines:&lt;br/&gt;
&lt;a href=&quot;https://svn.apache.org/viewvc/tomcat/trunk/java/org/apache/tomcat/util/ExceptionUtils.java?view=annotate#l28&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/viewvc/tomcat/trunk/java/org/apache/tomcat/util/ExceptionUtils.java?view=annotate#l28&lt;/a&gt;&lt;br/&gt;
to ensure that Throwables that are truly fatal are handled as such and that Throwables that are recoverable are treated more like Exception.&lt;/p&gt;</comment>
                            <comment id="16307502" author="wolfgang.glas@ev-i.at" created="Mon, 1 Jan 2018 17:20:17 +0000"  >&lt;p&gt;OK, I raised an issue against mariadb-connector-j, see&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://jira.mariadb.org/browse/CONJ-564&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jira.mariadb.org/browse/CONJ-564&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/MariaDB/mariadb-connector-j/pull/119&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/MariaDB/mariadb-connector-j/pull/119&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I also found an instance of &lt;tt&gt;throw Error()&lt;/tt&gt; inside &lt;tt&gt;sun.nio.ch.DatagramChannelImpl.connect(SocketAddress)&lt;/tt&gt;, which might be the original cause of a &lt;tt&gt;java.lang.Error&lt;/tt&gt; instance being raised. (This might be a bug in the native parts of openjdk8 on Linux...)&lt;/p&gt;

&lt;p&gt;For the commons-pool2 part I think we are finished here, because my patch only corrects &lt;tt&gt;makeCount&lt;/tt&gt; in &lt;tt&gt;GenericObjectPool.create()&lt;/tt&gt; upon a catched Throwable an does nothing more.&lt;/p&gt;

&lt;p&gt;So, I tend to close this issue at this point.&lt;/p&gt;

&lt;p&gt;Is this OK for you, Gary and Mark?&lt;/p&gt;

&lt;p&gt;Regards, Wolfgang&lt;/p&gt;</comment>
                            <comment id="16322180" author="wolfgang.glas@ev-i.at" created="Thu, 11 Jan 2018 13:08:17 +0000"  >&lt;p&gt;Closing issue, because the original problem is solved and other problems are raised against mariadb-connector-j&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12904079" name="0001-Add-a-test-case-for-POOL-336.patch" size="3945" author="wolfgang.glas@ev-i.at" created="Sat, 30 Dec 2017 20:14:30 +0000"/>
                            <attachment id="12904080" name="0002-Fix-POOL-336.patch" size="1010" author="wolfgang.glas@ev-i.at" created="Sat, 30 Dec 2017 20:17:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 44 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3odx3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>