<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:16:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[POOL-240] GKOP: invalidateObject does not unblock threads waiting in borrowObject</title>
                <link>https://issues.apache.org/jira/browse/POOL-240</link>
                <project id="12310488" key="POOL">Commons Pool</project>
                    <description>&lt;p&gt;It appears that when threads are blocked in GKOP.borrowObject due to max object limits being reached and another thread calls invalidateObject, the threads blocked in GKOP.borrowObject are not woken up to attempt to create a new object.&lt;/p&gt;

&lt;p&gt;Have the semantics changed for invalidate in 2.0?&lt;/p&gt;

&lt;p&gt;Attached is a unit test that demonstrates this issue. I should note that this test passed against POOL 1.5, after making the appropriate changes due to the API changes in 2.0.&lt;/p&gt;

&lt;p&gt;After a cursory glance through the source for GenericObjectPool, it looks like it might be affected by the same issue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12680057">POOL-240</key>
            <summary>GKOP: invalidateObject does not unblock threads waiting in borrowObject</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dan.mcnulty">Dan McNulty</reporter>
                        <labels>
                    </labels>
                <created>Tue, 19 Nov 2013 23:02:16 +0000</created>
                <updated>Wed, 31 Dec 2014 16:19:20 +0000</updated>
                            <resolved>Tue, 26 Nov 2013 21:53:57 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13827063" author="dan.mcnulty" created="Tue, 19 Nov 2013 23:04:27 +0000"  >&lt;p&gt;Attached unit test mentioned in the description.&lt;/p&gt;</comment>
                            <comment id="13827853" author="psteitz" created="Wed, 20 Nov 2013 17:07:19 +0000"  >&lt;p&gt;Thanks for reporting this.  This looks like a bug.  Unless I am missing something, looks like validation failures on return (both GOP / GKOP) will behave similarly - blocked threads waiting on depleted pool will stay blocked.  The change in behavior is due to move away from wait/notify setup in pool 1.x.&lt;/p&gt;

&lt;p&gt;I suspect what is going to be needed is a call to create() added to destroy() or some kind of notification engineered into the queue.&lt;/p&gt;</comment>
                            <comment id="13828310" author="markt" created="Wed, 20 Nov 2013 23:45:48 +0000"  >&lt;p&gt;I agree that this is a bug. I&apos;ve taken a quick look at how this might be fixed in GOP. My current thoughts are to extract the majority of the ensureMinIdle() code to a separate method that takes a parameter of how many idle objects to ensure and then call that new method with a parameter of 1 when an object is destroyed because it failed validation / passivation on return. It looks like GKOP will be able to just call addObject(K) in the same situation.&lt;/p&gt;

&lt;p&gt;I&apos;m busy fixing some WebSocket issues over in Tomcat land at the moment so I&apos;m unlikely to get to this in the next few days. This is next on my TODO list after that, but if someone beats me to it I&apos;m not going to complain.&lt;/p&gt;</comment>
                            <comment id="13831031" author="psteitz" created="Sun, 24 Nov 2013 20:13:44 +0000"  >&lt;p&gt;I committed Dan&apos;s test case (thanks!) disabled in r1545063.  I also committed (disabled, failing) tests for both invalidateObject and validation failures on return for GOP in r1544948.  In r1544942, I added similar tests for GOP in the 1.5 branch, demonstrating that this bug is not present in 1.x (at least for GOP, but GKOP should be the same).&lt;/p&gt;</comment>
                            <comment id="13831055" author="psteitz" created="Sun, 24 Nov 2013 21:11:43 +0000"  >&lt;p&gt;I can think of two, both pretty ugly, workarounds for this issue until we get 2.0.1 with a fix out.&lt;/p&gt;

&lt;p&gt;1.  For the specific issue in the report (invaliateObject not freeing capacity), follow invalidateObject with addObject.&lt;br/&gt;
2.  Enable the evictor (set timeBetweenEvictionRuns to a positive value) and set minIdle to 1.  This will handle both the invalidateObject and failed validation on return cases.  Unfortunately, relief for blocked threads will only come when the evictor runs.&lt;/p&gt;</comment>
                            <comment id="13832046" author="psteitz" created="Mon, 25 Nov 2013 23:11:41 +0000"  >&lt;p&gt;Fix for GOP along the lines of what Mark suggested committed in r1545347.  &lt;/p&gt;</comment>
                            <comment id="13832720" author="psteitz" created="Tue, 26 Nov 2013 16:11:11 +0000"  >&lt;p&gt;GKOP fix commited in r1545705.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12614725" name="InvalidateObjectTest.java" size="3395" author="dan.mcnulty" created="Tue, 19 Nov 2013 23:04:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>359414</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 51 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1pyjz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>359713</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>