<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:16:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[POOL-283] &apos;Object has already been returned to this pool or is invalid&apos; for collections</title>
                <link>https://issues.apache.org/jira/browse/POOL-283</link>
                <project id="12310488" key="POOL">Commons Pool</project>
                    <description>&lt;p&gt;This test throws exception:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; GenericObjectPoolConfig config = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericObjectPoolConfig ();
        config.setMaxTotal ( 2 );

        GenericObjectPool&amp;lt;Set&amp;gt; setsPool = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericObjectPool&amp;lt;&amp;gt; ( &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BasePooledObjectFactory&amp;lt;Set&amp;gt; ()
        {
            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Set create () &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception
            {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet();
            }

            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; PooledObject&amp;lt;Set&amp;gt; wrap ( Set o )
            {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultPooledObject&amp;lt;&amp;gt; ( o );
            }

            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void passivateObject ( PooledObject&amp;lt;Set&amp;gt; p ) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception
            {
                p.getObject ().clear ();
                &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.passivateObject ( p );
            }
        }, config );

        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Set set1 = setsPool.borrowObject ();

        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Set set2 = setsPool.borrowObject ();


        setsPool.returnObject ( set1 );
        setsPool.returnObject ( set2 ); &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; java.lang.IllegalStateException: &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; has already been retured to &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; pool or is invalid&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12769730">POOL-283</key>
            <summary>&apos;Object has already been returned to this pool or is invalid&apos; for collections</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="yavalek">Valentin Mayamsin</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Jan 2015 19:29:57 +0000</created>
                <updated>Mon, 1 Jun 2015 15:28:34 +0000</updated>
                            <resolved>Tue, 12 May 2015 13:35:00 +0000</resolved>
                                    <version>2.2</version>
                                    <fixVersion>2.4.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14290027" author="psteitz" created="Fri, 23 Jan 2015 21:39:46 +0000"  >&lt;p&gt;The two empty sets created by your factory are equal.  Distinct instances managed by v. 2.0 pools have to be discernible by equals.&lt;/p&gt;</comment>
                            <comment id="14290211" author="sebb@apache.org" created="Fri, 23 Jan 2015 23:32:57 +0000"  >&lt;p&gt;Perhaps I&apos;m blind, but I could not find this requirement documented anywhere in the Javadoc. There is a brief mention on the website in the Pool Overview.&lt;/p&gt;

&lt;p&gt;I think it would be worth making the requirements for the factory clear in the Javadoc.&lt;/p&gt;</comment>
                            <comment id="14307617" author="tn" created="Thu, 5 Feb 2015 17:34:07 +0000"  >&lt;p&gt;I just ran into the same issue with a custom pool and solved it by using System.identityHashcode instead of Object.hashCode. The idea is basically that a pool can only handle unique objects but we can not rely on the impl of equals and hashcode for this purpose. I wonder if this would also make sense here.&lt;/p&gt;</comment>
                            <comment id="14307624" author="sebb@apache.org" created="Thu, 5 Feb 2015 17:37:56 +0000"  >&lt;p&gt;As mentioned in another JIRA issue, System.identityHashcode is not guaranteed unique. Two different objects may have the same hash code. This is fairly rare, but it does happen.&lt;/p&gt;</comment>
                            <comment id="14307637" author="yavalek" created="Thu, 5 Feb 2015 17:49:55 +0000"  >&lt;p&gt;I resolved this issue in my project by switching to 1.6, it doesn&apos;t have this issue since it&apos;s implemented differently. For 2.x let me suggest wrapping objects into a wrapper similar to this (pseudo-code):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;IdentityWrapper {
    &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; obj;
    IdentityWrapper(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; obj) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.obj=obj;
    }
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; equals(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; that) {
         &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; that==obj;
    }
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; hashCode() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.identityHashcode(obj);
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The drawback is it will create extra object for each returnObject(Object obj) call. I&apos;m not sure how significant is it.&lt;/p&gt;</comment>
                            <comment id="14307819" author="tn" created="Thu, 5 Feb 2015 19:28:02 +0000"  >&lt;p&gt;Using an IdentityHashMap would not require such wrapper objects.&lt;/p&gt;

&lt;p&gt;Edit: currently a ConcurrentHashMap is used, so I guess this will not change, but maybe the idea with the wrapper objects would be worth to consider.&lt;/p&gt;</comment>
                            <comment id="14307868" author="psteitz" created="Thu, 5 Feb 2015 19:52:55 +0000"  >&lt;p&gt;See comments on &lt;a href=&quot;https://issues.apache.org/jira/browse/POOL-284&quot; title=&quot;&amp;quot;Returned object not currently part of this pool&amp;quot; when using mutable objects&quot; class=&quot;issue-link&quot; data-issue-key=&quot;POOL-284&quot;&gt;&lt;del&gt;POOL-284&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14307875" author="tn" created="Thu, 5 Feb 2015 19:57:58 +0000"  >&lt;p&gt;oh I missed this other issue.&lt;/p&gt;</comment>
                            <comment id="14539831" author="psteitz" created="Tue, 12 May 2015 13:35:00 +0000"  >&lt;p&gt;Fixed in r1678941&lt;br/&gt;
See resolution comments on &lt;a href=&quot;https://issues.apache.org/jira/browse/POOL-284&quot; title=&quot;&amp;quot;Returned object not currently part of this pool&amp;quot; when using mutable objects&quot; class=&quot;issue-link&quot; data-issue-key=&quot;POOL-284&quot;&gt;&lt;del&gt;POOL-284&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14567432" author="psteitz" created="Mon, 1 Jun 2015 15:28:34 +0000"  >&lt;p&gt;Fix released in 2.4.1&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 24 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i24qmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>