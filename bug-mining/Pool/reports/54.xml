<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:16:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[POOL-179] GenericObjectPool.borrowObject() incorrectly swallows InterruptedException</title>
                <link>https://issues.apache.org/jira/browse/POOL-179</link>
                <project id="12310488" key="POOL">Commons Pool</project>
                    <description>&lt;p&gt;I just updated from commpons-pool 1.5.4 to 1.5.5 and suddenly some of my tests crash with threads hanging.&lt;/p&gt;

&lt;p&gt;After some inspection is appears that GenericObjectPool.borrowObject() no longer handles InterruptedException correctly. I made a file diff and found that there has been a modification in that area that contains the bug. See attached image.&lt;/p&gt;

&lt;p&gt;I have created a patched version absed on 1.5.4 source which works correctly in my use case. The important part is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; InterruptedException e)
{
   &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;)
   {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (latch.getPair() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
      {
         _allocationQueue.remove(latch);
      }
      &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
      {
         _numInternalProcessing--;
         _numActive++;
         _allocationQueue.remove(latch);
         returnObject(latch.getPair().value);
      }
   }
   &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().interrupt();
   &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; e;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; </description>
                <environment>&lt;p&gt;mac osx 10.5.8 jdk 1.6.0_22&lt;/p&gt;</environment>
        <key id="12494175">POOL-179</key>
            <summary>GenericObjectPool.borrowObject() incorrectly swallows InterruptedException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markt">Mark Thomas</assignee>
                                    <reporter username="axelgr74">Axel Gro&#223;mann</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Dec 2010 14:24:45 +0000</created>
                <updated>Fri, 8 Apr 2011 13:55:04 +0000</updated>
                            <resolved>Wed, 23 Mar 2011 12:13:36 +0000</resolved>
                                    <version>1.5.5</version>
                                    <fixVersion>1.5.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12975688" author="psteitz" created="Wed, 29 Dec 2010 00:28:09 +0000"  >&lt;p&gt;Thanks for reporting this.  I think what is going on is that threads are being interrupted after they have been allocated objects by the pool.   See the comments in &lt;a href=&quot;https://issues.apache.org/jira/browse/POOL-162&quot; title=&quot;When waiting threads are interrupted, pool can leak capacity&quot; class=&quot;issue-link&quot; data-issue-key=&quot;POOL-162&quot;&gt;&lt;del&gt;POOL-162&lt;/del&gt;&lt;/a&gt;.  Perhaps we should change the logic to &quot;undo&quot; allocation in this case.&lt;/p&gt;</comment>
                            <comment id="12977215" author="axelgr74" created="Tue, 4 Jan 2011 10:33:34 +0000"  >&lt;p&gt;I think the important bit is that a &lt;tt&gt;InterruptedException&lt;/tt&gt; must never be swallowed but passed on to the calling code. And when the pool is doing so of course any allocated element must be put back into the pool. &lt;/p&gt;

&lt;p&gt;The code that did not work with 1.5.5 looks somewhat like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
{
   &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;( !&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread.isInterrupted())
   {
      element = pool.borrowObject();
      ...
    }
}
&lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;( InterruptedException e)
{
   &lt;span class=&quot;code-comment&quot;&gt;// ok, someone wants me to stop
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If &lt;tt&gt;borrowObject()&lt;/tt&gt; would swallow the exception my thread would never notice that it has been interrupted and therefore would wrongly continue to work forever. Note that the sample is probably overdoing things a bit since it catches &lt;tt&gt;InterruptedException&lt;/tt&gt; and checks whether the current thread is being interrupted, but the general idea should be clear. &lt;/p&gt;</comment>
                            <comment id="13008955" author="psteitz" created="Sun, 20 Mar 2011 20:10:21 +0000"  >&lt;p&gt;The patch in the first comment looks correct to me.  Unless others disagree, I will commit it.&lt;/p&gt;</comment>
                            <comment id="13009370" author="simone.tripodi" created="Mon, 21 Mar 2011 20:51:34 +0000"  >&lt;p&gt;no objections from my side. does this issue affects the 2.0 too?&lt;/p&gt;</comment>
                            <comment id="13009490" author="psteitz" created="Tue, 22 Mar 2011 00:37:50 +0000"  >&lt;p&gt;The current code in the 2.0 branch contains this same bug.  I will port the fix to the 2.0 code for the time being (we have talked about replacing the core implementation in 2.0).&lt;/p&gt;</comment>
                            <comment id="13009866" author="markt" created="Tue, 22 Mar 2011 22:09:36 +0000"  >&lt;p&gt;I think there are three cases we need to handle:&lt;br/&gt;
a) latch has been allocated an object&lt;br/&gt;
b) latch has been given permission to create an object&lt;br/&gt;
c) latch is still in queue&lt;/p&gt;

&lt;p&gt;I think there are a couple of issues with the patch above:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;it tries to remove the latch from the queue in cases a) &amp;amp; b) but the latch will already have been removed (should just be a no-op but still makes sense not to make the call)&lt;/li&gt;
	&lt;li&gt;it doesn&apos;t handle case c)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I have a patch in mind based on the patch above but I&apos;d really like a test case for this but cases a) &amp;amp; b) look like they are going to be tricky to test.&lt;/p&gt;

&lt;p&gt;There is also the fact that this code is rather tricky and it has been a while since I last looked at it. I may be completely wrong in my analysis so an extra pair of eyes would be good here.&lt;/p&gt;</comment>
                            <comment id="13009925" author="psteitz" created="Wed, 23 Mar 2011 00:20:29 +0000"  >&lt;p&gt;I agree with you on the three cases, Mark and in a) and b) the latch will have already been removed.  I think the first part of the patch tries to handle c), but is not quite right now that I think more about it because the if test will also succeed if the latch has been removed and mayCreate.  I think the patch tries to do the right thing if the latch has been served. I will work on a test case and review whatever you come up with.  Seems to me we need to do the following in your cases&lt;br/&gt;
a) return the object to the queue and decrement the internal processing count&lt;br/&gt;
b) decrement internal processing count&lt;br/&gt;
c) remove the latch from the queue&lt;/p&gt;</comment>
                            <comment id="13010087" author="markt" created="Wed, 23 Mar 2011 12:13:36 +0000"  >&lt;p&gt;Fixed for 1.5.6 and the current trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12467040" name="FileDiff154-155.jpg" size="74009" author="axelgr74" created="Tue, 28 Dec 2010 14:29:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>166739</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 35 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0zfnr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204839</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>