<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:16:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[POOL-97] EVICTION_TIMER is never cancelled.</title>
                <link>https://issues.apache.org/jira/browse/POOL-97</link>
                <project id="12310488" key="POOL">Commons Pool</project>
                    <description>&lt;p&gt;The static EVICTION_TIMER (java.util.Timer) used in GenericObjectPool is never cancelled (even after closing the pool). The GenericObjectPool.close() method just cancels the _evictor (TimerTask). I agree this behaviour is ideal if EVICTION_TIMER is to be used across multiple pools.&lt;/p&gt;

&lt;p&gt;But, In my case, the resources (i.e. jars) are dynamically deployed and undeployed on remote grid-servers. If EVICTION_TIMER thread doesn&apos;t stop, the grid-servers fails to undeploy (i.e. delete) the jars. The grid-server doesn&apos;t restart during resource deployment/undeployment, so, setting EVICTION_TIMER to daemon doesn&apos;t help me.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12365981">POOL-97</key>
            <summary>EVICTION_TIMER is never cancelled.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="devendra_patil">Devendra Patil</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Mar 2007 07:24:16 +0000</created>
                <updated>Sun, 12 Sep 2010 17:43:30 +0000</updated>
                            <resolved>Mon, 10 Dec 2007 00:56:13 +0000</resolved>
                                    <version>1.3</version>
                                    <fixVersion>1.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12484747" author="henning" created="Wed, 28 Mar 2007 07:34:21 +0000"  >&lt;p&gt;Ah, that would explain some strange behaviour that I have seen in a project using commons-pool inside WebLogic 8.1.&lt;/p&gt;

&lt;p&gt;Undeploy/deploy does not work unless I restart the server. Exactly the same phenomenon...&lt;/p&gt;</comment>
                            <comment id="12507629" author="psteitz" created="Sat, 23 Jun 2007 20:01:33 +0000"  >&lt;p&gt;Attaching a patch (timer.patch) that makes the eviction timer a (lazy initialized) instance variable in GOP, GKOP and cancels it in close.   Questions:&lt;/p&gt;

&lt;p&gt;1. Will this resolve the issue fully? &lt;br/&gt;
2. Other than additional overhead in multi-pool settings, are there other negatives to this? How &quot;bad&quot; is the overhead issue?&lt;br/&gt;
3. Does the fix introduce any other problems?&lt;/p&gt;
</comment>
                            <comment id="12514495" author="robertburrelldonkin" created="Sun, 22 Jul 2007 18:39:49 +0000"  >&lt;p&gt;This fix breaks binary compatibility but only at package private level. &lt;/p&gt;

&lt;p&gt;One question which may need to investigated is whether any subtle concurrency issues are prevent by using a static instance. I&apos;ve taken a look at the code and i can only see it being used to set up eviction timings. Not sure whether these are ever cleared out. So, the instance will ensure the pool remains in memory until the server is restarted. More eyes would be good since it&apos;s very easy to miss subtle concurrency issues.&lt;/p&gt;

&lt;p&gt;I suppose that some benchmarks would be the right way to assess the performance impact of this patch. &lt;/p&gt;

&lt;p&gt;A more complex solution would be to create a private subclass of timer that does knows when to unschedule eviction tasks. The evictor would need to implement a package interface (unschedulable?) and then test for the pool being closed (or something like that). This would be quite a bit more effort with more to go wrong. &lt;/p&gt;</comment>
                            <comment id="12514497" author="psteitz" created="Sun, 22 Jul 2007 19:03:04 +0000"  >&lt;p&gt;A more conservative solution would be to revert to the pool 1.2 setup where the Evictor is a thread.  This would also break backward compatibility at the package private level, but would revert to a well-tested solution with essentially the same scaling / perfornance challenges as the per instance Timer in the patch.  See &lt;a href=&quot;https://issues.apache.org/jira/browse/POOL-56&quot; title=&quot;[pool] GenericObjectPool Evictor should be a TimerTask, not a Thread&quot; class=&quot;issue-link&quot; data-issue-key=&quot;POOL-56&quot;&gt;&lt;del&gt;POOL-56&lt;/del&gt;&lt;/a&gt; or 1.2 sources for changes to revert.&lt;/p&gt;</comment>
                            <comment id="12549674" author="bayard" created="Sat, 8 Dec 2007 08:53:23 +0000"  >&lt;p&gt;I don&apos;t see the package private as an issue.&lt;/p&gt;</comment>
                            <comment id="12549675" author="markt" created="Sat, 8 Dec 2007 08:57:17 +0000"  >&lt;p&gt;I can reproduce this. I have been thinking about a solution that would fix this and &lt;a href=&quot;https://issues.apache.org/jira/browse/POOL-56&quot; title=&quot;[pool] GenericObjectPool Evictor should be a TimerTask, not a Thread&quot; class=&quot;issue-link&quot; data-issue-key=&quot;POOL-56&quot;&gt;&lt;del&gt;POOL-56&lt;/del&gt;&lt;/a&gt;. I am not quite there yet. I&apos;ll post some patches here when I have something concrete. Being able to break binary compatibility at the package private level should make a solution easier.&lt;/p&gt;</comment>
                            <comment id="12549711" author="psteitz" created="Sat, 8 Dec 2007 13:35:50 +0000"  >&lt;p&gt;A fix that would not re-open &lt;a href=&quot;https://issues.apache.org/jira/browse/POOL-56&quot; title=&quot;[pool] GenericObjectPool Evictor should be a TimerTask, not a Thread&quot; class=&quot;issue-link&quot; data-issue-key=&quot;POOL-56&quot;&gt;&lt;del&gt;POOL-56&lt;/del&gt;&lt;/a&gt; would be ideal here and I would not worry about the package private compat. issue.&lt;/p&gt;</comment>
                            <comment id="12549838" author="markt" created="Sun, 9 Dec 2007 16:50:58 +0000"  >&lt;p&gt;This patch fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/POOL-97&quot; title=&quot;EVICTION_TIMER is never cancelled.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;POOL-97&quot;&gt;&lt;del&gt;POOL-97&lt;/del&gt;&lt;/a&gt;, keeps the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/POOL-56&quot; title=&quot;[pool] GenericObjectPool Evictor should be a TimerTask, not a Thread&quot; class=&quot;issue-link&quot; data-issue-key=&quot;POOL-56&quot;&gt;&lt;del&gt;POOL-56&lt;/del&gt;&lt;/a&gt; and passes all the unit tests. It does break the package private compatibility but I couldn&apos;t see an easy way around that. The patch also removes some unused code and imports in the two pool classes.&lt;/p&gt;

&lt;p&gt;I have tested this with the latest Tomcat 5.5.x and the problem described in &lt;a href=&quot;http://issues.apache.org/bugzilla/show_bug.cgi?id=43552&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://issues.apache.org/bugzilla/show_bug.cgi?id=43552&lt;/a&gt; (which I believe is a symptom of this issue) is also fixed.&lt;/p&gt;

&lt;p&gt;My aim was to stick to the commons-pool coding conventions but if this patch is viewed as not doing things in the commons-pool way then I won&apos;t be offended if you ask me to re-write it or if it is committed in a completely different form.&lt;/p&gt;</comment>
                            <comment id="12549847" author="markt" created="Sun, 9 Dec 2007 18:07:55 +0000"  >&lt;p&gt;Updated patch. I missed a call to _evictor.cancel() in GKOP&lt;/p&gt;</comment>
                            <comment id="12549875" author="psteitz" created="Mon, 10 Dec 2007 00:56:13 +0000"  >&lt;p&gt;Patch (v2) applied in r602765.  Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12371313" name="pool-97-markt-v2.patch" size="6494" author="markt" created="Sun, 9 Dec 2007 18:07:55 +0000"/>
                            <attachment id="12360406" name="timer.patch" size="2944" author="psteitz" created="Sat, 23 Jun 2007 22:27:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>166690</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 50 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0zfqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204851</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>