<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:16:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[POOL-125] Insufficient control over concurrent access to pooled objects by Evictor, client threads</title>
                <link>https://issues.apache.org/jira/browse/POOL-125</link>
                <project id="12310488" key="POOL">Commons Pool</project>
                    <description>&lt;p&gt;In pool 1.2, 1.4, borrowObject, returnObject, invalidateObject are not fully synchronized.  This creates the potential for race conditions vis a vis the Evictor and/or client object lock contention.  Factory methods on pooled objects should not be allowed to be invoked concurrently by client threads and the Evictor.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12390600">POOL-125</key>
            <summary>Insufficient control over concurrent access to pooled objects by Evictor, client threads</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="psteitz">Phil Steitz</reporter>
                        <labels>
                    </labels>
                <created>Sun, 9 Mar 2008 17:18:21 +0000</created>
                <updated>Fri, 19 Jun 2009 16:13:26 +0000</updated>
                            <resolved>Tue, 12 May 2009 18:08:35 +0000</resolved>
                                    <version>1.2</version>
                    <version>1.4</version>
                                    <fixVersion>1.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12699909" author="jcbollinger" created="Thu, 16 Apr 2009 22:35:17 +0000"  >&lt;p&gt;I&apos;ve been looking at this in the version 1.x source, and I&apos;m not sure I see the problem.  The Evicter operates by invoking the synchronized GenericObjectPool.evict() method, which touches only objects currently idle in the pool (_pool).  None of borrowObject(), returnObject(), and invalidateObject() access the pool without synchronization, and none of them invoke factory methods on idle pooled objects.  The only opportunities I see for factory methods to be concurrently invoked on the same object are&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if a client thread returns or invalidates an object that is already idle in the pool then that thread and the Evicter thread might concurrently invoke factory methods on it&lt;/li&gt;
	&lt;li&gt;if two client threads attempt to return / invalidate the same object at the same time then those threads might concurrently invoke factory methods on it&lt;/li&gt;
	&lt;li&gt;(or if the client holds references to the factory and an idle pooled object, and directly passes the object to a factory method while the Evicter is running)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Those scenarios appear to arise from client errors, and they are likely to cause problems even if the concurrency can be prevented.  (For example, it may be a problem to invoke destroyObject() twice &lt;b&gt;sequentially&lt;/b&gt; with the same argument.)  What am I missing here?&lt;/p&gt;</comment>
                            <comment id="12700062" author="markt" created="Fri, 17 Apr 2009 08:09:53 +0000"  >&lt;p&gt;Take a look at &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-44&quot; title=&quot;[dbcp] Evictor thread in GenericObjectPool has potential for deadlock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-44&quot;&gt;&lt;del&gt;DBCP-44&lt;/del&gt;&lt;/a&gt;. There is at least one use case described in that bug that, despite correct usage by the user, can result in a deadlock.&lt;/p&gt;

&lt;p&gt;As an aside, I have a patch for this for GOP and am in the process of porting similar changes to GKOP.&lt;/p&gt;</comment>
                            <comment id="12700182" author="jcbollinger" created="Fri, 17 Apr 2009 13:52:33 +0000"  >&lt;p&gt;Aha.  I misunderstood the nature of the problem.  I thought it was about two or more factory methods being invoked concurrently &lt;b&gt;on the same pooled object&lt;/b&gt;, but it&apos;s really about issues that can arise in general if the client-provided object factory is not thread safe. (Right?)  I think it&apos;s rather accommodating of you to handle it with a code fix.  Indeed, I cannot imagine how a comprehensive fix could avoid unnecessarily reducing performance in cases where the object factory in use is already thread safe.  I also don&apos;t see how Pool can protect against non-thread-safe object factories being used concurrently by the Pool and by another client (which is, in a sense, what happened in &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-44&quot; title=&quot;[dbcp] Evictor thread in GenericObjectPool has potential for deadlock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-44&quot;&gt;&lt;del&gt;DBCP-44&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;You said you already have a patch for GOP, but are you sure it wouldn&apos;t be better to document that users must provide a thread-safe object factory?  They can always use one of the PoolUtil.synchronizedPoolableFactory() methods to get one if they need to do, though it would be better to use a factory that does not require synchronization for thread safety.&lt;/p&gt;</comment>
                            <comment id="12721854" author="psteitz" created="Fri, 19 Jun 2009 16:13:26 +0000"  >&lt;p&gt;Fixed in 1.5 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12342100">DBCP-44</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>166708</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 23 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0zfr3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204854</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>