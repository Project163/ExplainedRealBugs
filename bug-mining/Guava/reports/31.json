{"url":"https://api.github.com/repos/google/guava/issues/6217","repository_url":"https://api.github.com/repos/google/guava","labels_url":"https://api.github.com/repos/google/guava/issues/6217/labels{/name}","comments_url":"https://api.github.com/repos/google/guava/issues/6217/comments","events_url":"https://api.github.com/repos/google/guava/issues/6217/events","html_url":"https://github.com/google/guava/issues/6217","id":1410355953,"node_id":"I_kwDOATXBkc5UEFLx","number":6217,"title":"Testlib: Add test that putIfAbsent replaces a null value ","user":{"login":"ben-manes","id":378614,"node_id":"MDQ6VXNlcjM3ODYxNA==","avatar_url":"https://avatars.githubusercontent.com/u/378614?v=4","gravatar_id":"","url":"https://api.github.com/users/ben-manes","html_url":"https://github.com/ben-manes","followers_url":"https://api.github.com/users/ben-manes/followers","following_url":"https://api.github.com/users/ben-manes/following{/other_user}","gists_url":"https://api.github.com/users/ben-manes/gists{/gist_id}","starred_url":"https://api.github.com/users/ben-manes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ben-manes/subscriptions","organizations_url":"https://api.github.com/users/ben-manes/orgs","repos_url":"https://api.github.com/users/ben-manes/repos","events_url":"https://api.github.com/users/ben-manes/events{/privacy}","received_events_url":"https://api.github.com/users/ben-manes/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":143504641,"node_id":"MDU6TGFiZWwxNDM1MDQ2NDE=","url":"https://api.github.com/repos/google/guava/labels/package=testing","name":"package=testing","color":"62a0e5","default":false,"description":""},{"id":143505258,"node_id":"MDU6TGFiZWwxNDM1MDUyNTg=","url":"https://api.github.com/repos/google/guava/labels/type=addition","name":"type=addition","color":"f4d75f","default":false,"description":"A new feature"},{"id":143505671,"node_id":"MDU6TGFiZWwxNDM1MDU2NzE=","url":"https://api.github.com/repos/google/guava/labels/status=triaged","name":"status=triaged","color":"bfe5bf","default":false,"description":null},{"id":691862394,"node_id":"MDU6TGFiZWw2OTE4NjIzOTQ=","url":"https://api.github.com/repos/google/guava/labels/P3","name":"P3","color":"c5c5c5","default":false,"description":"no SLO"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/google/guava/milestones/44","html_url":"https://github.com/google/guava/milestone/44","labels_url":"https://api.github.com/repos/google/guava/milestones/44/labels","id":13704788,"node_id":"MI_kwDOATXBkc4A0R5U","number":44,"title":"33.5.0","description":"","creator":{"login":"cpovirk","id":1703908,"node_id":"MDQ6VXNlcjE3MDM5MDg=","avatar_url":"https://avatars.githubusercontent.com/u/1703908?v=4","gravatar_id":"","url":"https://api.github.com/users/cpovirk","html_url":"https://github.com/cpovirk","followers_url":"https://api.github.com/users/cpovirk/followers","following_url":"https://api.github.com/users/cpovirk/following{/other_user}","gists_url":"https://api.github.com/users/cpovirk/gists{/gist_id}","starred_url":"https://api.github.com/users/cpovirk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cpovirk/subscriptions","organizations_url":"https://api.github.com/users/cpovirk/orgs","repos_url":"https://api.github.com/users/cpovirk/repos","events_url":"https://api.github.com/users/cpovirk/events{/privacy}","received_events_url":"https://api.github.com/users/cpovirk/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":7,"state":"open","created_at":"2025-09-16T13:55:43Z","updated_at":"2025-09-16T13:55:54Z","due_on":null,"closed_at":null},"comments":23,"created_at":"2022-10-16T03:05:14Z","updated_at":"2025-09-17T05:00:03Z","closed_at":"2025-09-16T02:17:07Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"This was shown in a recent [Java Collections Puzzlers](https://youtu.be/w6hhjg_gt_M?t=1380). The JavaDoc for `Map.putIfAbsent` states the following.\r\n\r\n> If the specified key is not already associated with a value (or is mapped to {@code null}) associates it with the given value and returns {@code null}, else returns the current value.\r\n\r\n```java\r\n@Test\r\npublic void putIfAbsent_nullExistingValue() {\r\n  var map = new HashMap<Object, Object>();\r\n  map.put(\"a\", null);\r\n  map.putIfAbsent(\"a\", \"b\");\r\n  assertThat(map).containsEntry(\"a\", \"b\");\r\n}\r\n```\r\n\r\nI found that multiple custom maps which permit null values do not honor this peculiarity (and similar for `computeIfAbsent`). For example fastutils' adopted the testlib and  `Object2ObjectOpenHashMap` passes its suite, but it mistakenly [does not](https://github.com/vigna/fastutil/issues/280) replace the value as shown above.","closed_by":{"login":"cpovirk","id":1703908,"node_id":"MDQ6VXNlcjE3MDM5MDg=","avatar_url":"https://avatars.githubusercontent.com/u/1703908?v=4","gravatar_id":"","url":"https://api.github.com/users/cpovirk","html_url":"https://github.com/cpovirk","followers_url":"https://api.github.com/users/cpovirk/followers","following_url":"https://api.github.com/users/cpovirk/following{/other_user}","gists_url":"https://api.github.com/users/cpovirk/gists{/gist_id}","starred_url":"https://api.github.com/users/cpovirk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cpovirk/subscriptions","organizations_url":"https://api.github.com/users/cpovirk/orgs","repos_url":"https://api.github.com/users/cpovirk/repos","events_url":"https://api.github.com/users/cpovirk/events{/privacy}","received_events_url":"https://api.github.com/users/cpovirk/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/google/guava/issues/6217/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/google/guava/issues/6217/timeline","performed_via_github_app":null,"state_reason":"completed"}