{"url":"https://api.github.com/repos/google/guava/issues/7957","repository_url":"https://api.github.com/repos/google/guava","labels_url":"https://api.github.com/repos/google/guava/issues/7957/labels{/name}","comments_url":"https://api.github.com/repos/google/guava/issues/7957/comments","events_url":"https://api.github.com/repos/google/guava/issues/7957/events","html_url":"https://github.com/google/guava/issues/7957","id":3368298324,"node_id":"I_kwDOATXBkc7IxCdU","number":7957,"title":"TypeToken#getRawType allocates a lot","user":{"login":"kilink","id":835139,"node_id":"MDQ6VXNlcjgzNTEzOQ==","avatar_url":"https://avatars.githubusercontent.com/u/835139?v=4","gravatar_id":"","url":"https://api.github.com/users/kilink","html_url":"https://github.com/kilink","followers_url":"https://api.github.com/users/kilink/followers","following_url":"https://api.github.com/users/kilink/following{/other_user}","gists_url":"https://api.github.com/users/kilink/gists{/gist_id}","starred_url":"https://api.github.com/users/kilink/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kilink/subscriptions","organizations_url":"https://api.github.com/users/kilink/orgs","repos_url":"https://api.github.com/users/kilink/repos","events_url":"https://api.github.com/users/kilink/events{/privacy}","received_events_url":"https://api.github.com/users/kilink/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":143507384,"node_id":"MDU6TGFiZWwxNDM1MDczODQ=","url":"https://api.github.com/repos/google/guava/labels/package=reflect","name":"package=reflect","color":"62a0e5","default":false,"description":""},{"id":143507427,"node_id":"MDU6TGFiZWwxNDM1MDc0Mjc=","url":"https://api.github.com/repos/google/guava/labels/type=performance","name":"type=performance","color":"f4d75f","default":false,"description":"Related to performance"},{"id":691862394,"node_id":"MDU6TGFiZWw2OTE4NjIzOTQ=","url":"https://api.github.com/repos/google/guava/labels/P3","name":"P3","color":"c5c5c5","default":false,"description":"no SLO"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/google/guava/milestones/44","html_url":"https://github.com/google/guava/milestone/44","labels_url":"https://api.github.com/repos/google/guava/milestones/44/labels","id":13704788,"node_id":"MI_kwDOATXBkc4A0R5U","number":44,"title":"33.5.0","description":"","creator":{"login":"cpovirk","id":1703908,"node_id":"MDQ6VXNlcjE3MDM5MDg=","avatar_url":"https://avatars.githubusercontent.com/u/1703908?v=4","gravatar_id":"","url":"https://api.github.com/users/cpovirk","html_url":"https://github.com/cpovirk","followers_url":"https://api.github.com/users/cpovirk/followers","following_url":"https://api.github.com/users/cpovirk/following{/other_user}","gists_url":"https://api.github.com/users/cpovirk/gists{/gist_id}","starred_url":"https://api.github.com/users/cpovirk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cpovirk/subscriptions","organizations_url":"https://api.github.com/users/cpovirk/orgs","repos_url":"https://api.github.com/users/cpovirk/repos","events_url":"https://api.github.com/users/cpovirk/events{/privacy}","received_events_url":"https://api.github.com/users/cpovirk/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":7,"state":"open","created_at":"2025-09-16T13:55:43Z","updated_at":"2025-09-16T13:55:54Z","due_on":null,"closed_at":null},"comments":4,"created_at":"2025-08-29T21:54:31Z","updated_at":"2025-10-03T13:50:55Z","closed_at":"2025-09-03T18:39:32Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Guava Version\n\n33.4.8-jre\n\n### Description\n\nTypeToken#getRawType is needlessly expensive for TypeToken instances where the runtime type is already a Class; it allocates an ImmutableSet builder, a TypeVisitor. Ideally for Class / ParameterizedType, no allocations would occur.\n\n### Example\n\n```java\nTypeToken.of(Object.class).getRawType(); // ideally shouldn't allocate\nnew TypeToken<List<Object>>(){}.getRawType(); // ideally shouldn't allocate, or should allocate less\n```\n\n### Expected Behavior\n\nI would not expect `getRawType` to allocate so heavily for trivial TypeTokens.\n\n### Actual Behavior\n\nSeveral GBs of allocations observed in a 3 minute profile from a production application, or 1% of allocations.\n\n### Packages\n\ncom.google.common.reflect\n\n### Platforms\n\n_No response_\n\n### Checklist\n\n- [x] I agree to follow the [code of conduct](https://github.com/google/.github/blob/master/CODE_OF_CONDUCT.md).\n\n- [x] I can reproduce the bug with the [latest](https://github.com/google/guava/releases/latest) version of Guava available.\n","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/google/guava/issues/7957/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/google/guava/issues/7957/timeline","performed_via_github_app":null,"state_reason":"completed"}