<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:37:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SLING-1571] Scheduler must use AtomicBoolean instead of volatile boolean for job-is-running check</title>
                <link>https://issues.apache.org/jira/browse/SLING-1571</link>
                <project id="12310710" key="SLING">Sling</project>
                    <description>&lt;p&gt;QuartzJobExecutor &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; implements a check whether a job is already running if a job is not allowed to run concurrently:&lt;/p&gt;

&lt;p&gt;    if (!canRunConcurrently) {&lt;br/&gt;
        if ( handler.isRunning ) &lt;/p&gt;
{
            return;
        }&lt;br/&gt;
        handler.isRunning = true;&lt;br/&gt;
    }&lt;br/&gt;
&lt;br/&gt;
handler.isRunning is declared as &quot;public volatile boolean&quot;.&lt;br/&gt;
&lt;br/&gt;
This will fail if isRunning is false and two jobs start at exactly the same time - both will see a value of false and start. The problem is that &quot;volatile&quot; doesn&apos;t make the two commands &quot;isRunning + set to true&quot; atomic. It just makes sure that updates can be read immediately by all threads, ie. it would only help to see a &lt;em&gt;change&lt;/em&gt; of the variable, done by another thread, more quickly. It doesn&apos;t help in this situation. See also &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; (the first reply).&lt;br/&gt;
&lt;br/&gt;
Fortunately Java 5 comes with java.util.concurrent.atomic.AtomicBoolean, which has an atomic operation compareAndSet &lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt;. Code would probably look like this:&lt;br/&gt;
&lt;br/&gt;
    public AtomicBoolean isRunning;&lt;br/&gt;
&lt;br/&gt;
    ....&lt;br/&gt;
&lt;br/&gt;
    if (!canRunConcurrently) {&lt;br/&gt;
        if ( !handler.isRunning.compareAndSet(false, true) ) {            return;        }
&lt;p&gt;    }&lt;/p&gt;

&lt;p&gt;This is probably not so critical, since I guess it&apos;s very unlikely that the scheduler triggers a job execution twice at the same time in the first place, but you&apos;ll never know.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://svn.apache.org/repos/asf/sling/trunk/bundles/commons/scheduler/src/main/java/org/apache/sling/commons/scheduler/impl/QuartzJobExecutor.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/repos/asf/sling/trunk/bundles/commons/scheduler/src/main/java/org/apache/sling/commons/scheduler/impl/QuartzJobExecutor.java&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://www.coderanch.com/t/233792/threads/java/Volatile-boolean-versus-AtomicBoolean&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.coderanch.com/t/233792/threads/java/Volatile-boolean-versus-AtomicBoolean&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/atomic/AtomicBoolean.html#compareAndSet(boolean,%20boolean&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/atomic/AtomicBoolean.html#compareAndSet(boolean,%20boolean&lt;/a&gt;)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12467683">SLING-1571</key>
            <summary>Scheduler must use AtomicBoolean instead of volatile boolean for job-is-running check</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cziegeler">Carsten Ziegeler</assignee>
                                    <reporter username="alexander.klimetschek">Alexander Klimetschek</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Jun 2010 11:34:43 +0000</created>
                <updated>Tue, 16 Aug 2011 06:07:55 +0000</updated>
                            <resolved>Mon, 5 Jul 2010 06:04:49 +0000</resolved>
                                    <version>Commons Scheduler 2.2.0</version>
                                    <fixVersion>Commons Scheduler 2.3.0</fixVersion>
                                    <component>Commons</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12885114" author="cziegeler" created="Mon, 5 Jul 2010 06:04:49 +0000"  >&lt;p&gt;Thanks for reporting this - it&apos;s fixed now in revision 960452&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>64958</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 20 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i10o6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>212053</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>