<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:31:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[METAMODEL-1161] Max rows doesn&apos;t work on Oracle without offset and ORDER BY</title>
                <link>https://issues.apache.org/jira/browse/METAMODEL-1161</link>
                <project id="12314523" key="METAMODEL">Apache MetaModel (Retired)</project>
                    <description>&lt;p&gt;On Oracle, the query rewriting is completely broken for max rows, unless an offset and ORDER BY clause is also specified, and the version is 12.1.&lt;/p&gt;

&lt;p&gt;This seems to stem from the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/METAMODEL-1132&quot; title=&quot;Metamodel doesn&amp;#39;t support a native paging on SQL Server and Oracle database&quot; class=&quot;issue-link&quot; data-issue-key=&quot;METAMODEL-1132&quot;&gt;&lt;del&gt;METAMODEL-1132&lt;/del&gt;&lt;/a&gt;, which made a new OffsetFetchQueryRewriter and then extended OracleQueryRewriter and SQLServerQueryRewriter on top, but is unfortunately missing quite a bit of checks before concluding that `isMaxRowsSupported` should return true: no version check, and no checking that the query actually has the needed clauses set.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;SQLServerQueryRewriter&lt;/tt&gt; is not affected, since it  has code to rewrite the SELECT clause.&lt;/p&gt;

&lt;h5&gt;&lt;a name=&quot;Reproduction&quot;&gt;&lt;/a&gt;Reproduction&lt;/h5&gt;
&lt;p&gt;Query an Oracle datastore with e.g.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;context.query().from(&lt;span class=&quot;code-quote&quot;&gt;&quot;tablename&quot;&lt;/span&gt;).selectAll().maxRows(10).execute()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and print the resulting dataset.&lt;/p&gt;

&lt;h5&gt;&lt;a name=&quot;Expectedresult&quot;&gt;&lt;/a&gt;Expected result&lt;/h5&gt;
&lt;p&gt;Only 10 records in the dataset&lt;/p&gt;

&lt;h5&gt;&lt;a name=&quot;Actualresult&quot;&gt;&lt;/a&gt;Actual result&lt;/h5&gt;
&lt;p&gt;All records are in the dataset&lt;/p&gt;</description>
                <environment></environment>
        <key id="13096774">METAMODEL-1161</key>
            <summary>Max rows doesn&apos;t work on Oracle without offset and ORDER BY</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="losd">Dennis Du Kr&#248;ger</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Aug 2017 14:39:34 +0000</created>
                <updated>Thu, 24 Aug 2017 19:39:29 +0000</updated>
                                            <version>4.5.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16139875" author="githubbot" created="Thu, 24 Aug 2017 10:41:44 +0000"  >&lt;p&gt;GitHub user LosD opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/158&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/METAMODEL-1161&quot; title=&quot;Max rows doesn&amp;#39;t work on Oracle without offset and ORDER BY&quot; class=&quot;issue-link&quot; data-issue-key=&quot;METAMODEL-1161&quot;&gt;METAMODEL-1161&lt;/a&gt;: Max rows without offset and order by&lt;/p&gt;

&lt;p&gt;    This fixes Oracle and SQL Server max rows and offset to work properly in all viable situations, and to use post processing otherwise.&lt;/p&gt;

&lt;p&gt;    Please note that Oracle supports offset without order by, but that it is too inconsistent to use for much.&lt;/p&gt;

&lt;p&gt;    Also fixes Oracle and (jTDS) SQL Server tests, which had bit-rotted quite a bit. For SQL Server, I had to ignore the timestamp test to avoid changing `JdbcTestTemplates.timestampValueInsertSelect`, which makes assumptions about how database engines rounds, and due to the use of `toString()` more tests how the database reacts than how MetaModel does. If someone wants to fix that particular mess, be my guest, but I&apos;m not touching that with a 10-foot logic probe. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;    // rant begin&lt;br/&gt;
    In general, all the integration tests are &lt;em&gt;very&lt;/em&gt; prone to bitrot due to over-assuming, e.g. orders and types. Unfortunately, the heavy use of `toString()` makes it much worse. Other problems is assuming certain versions of DB manufacturer&apos;s test databases without stressing which actual version was used, and of course that the integration tests are barely ever run. Unfortunately, I don&apos;t think we can do much about how often they are run, but at least we should ensure that the tests only tests MetaModel-related things, to keep them immune from breakage due to database changes and internal MetaModel refactorings, i.e.; NO specific count of schemas, tables or rows unless absolutely needed, NO assuming order of schemas, NO assuming existance og non-existance of unrelated schemas, NO assuming order of unordered queries, ABSOLUTELY NO use of toString on overall types or (especially) arrays.&lt;/p&gt;

&lt;p&gt;    In short: Test that the query worked and that MetaModel-specific things are as expected, nothing more. Creating our own schemas, tables and data is probably also a good move, then at least we can make assumptions on that without going under for every new version (as long as we don&apos;t assume the non-presence of other schemas and tables)&lt;br/&gt;
    // rant end &lt;/p&gt;

&lt;p&gt;    Fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/METAMODEL-1161&quot; title=&quot;Max rows doesn&amp;#39;t work on Oracle without offset and ORDER BY&quot; class=&quot;issue-link&quot; data-issue-key=&quot;METAMODEL-1161&quot;&gt;METAMODEL-1161&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/LosD/metamodel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/LosD/metamodel&lt;/a&gt; bug/&lt;a href=&quot;https://issues.apache.org/jira/browse/METAMODEL-1161&quot; title=&quot;Max rows doesn&amp;#39;t work on Oracle without offset and ORDER BY&quot; class=&quot;issue-link&quot; data-issue-key=&quot;METAMODEL-1161&quot;&gt;METAMODEL-1161&lt;/a&gt;-max-rows-oracle&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/158.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/158.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #158&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 86cd2b305e15128ae2a71718547e72ff0a1d674f&lt;br/&gt;
Author: Dennis Du Kr&#248;ger &amp;lt;losd@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-08-24T08:31:31Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/METAMODEL-1161&quot; title=&quot;Max rows doesn&amp;#39;t work on Oracle without offset and ORDER BY&quot; class=&quot;issue-link&quot; data-issue-key=&quot;METAMODEL-1161&quot;&gt;METAMODEL-1161&lt;/a&gt;: Max rows without offset and order by&lt;/p&gt;

&lt;p&gt;    This fixes Oracle and SQL Server max rows and offset to work properly&lt;br/&gt;
    in all viable situations, and to use post processing otherwise.&lt;/p&gt;

&lt;p&gt;    Please note that Oracle supports offset without order by, but that it&lt;br/&gt;
    is too inconsistent to use for much.&lt;/p&gt;

&lt;p&gt;    Also fixes Oracle and SQL Server tests.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16139897" author="githubbot" created="Thu, 24 Aug 2017 11:15:44 +0000"  >&lt;p&gt;Github user LosD commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/158&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Whoops, missed the query rewriter tests. Will fix.&lt;/p&gt;</comment>
                            <comment id="16140019" author="githubbot" created="Thu, 24 Aug 2017 13:18:02 +0000"  >&lt;p&gt;Github user LosD commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/158&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    BTW, any chance that we could also add this to a 4.x bugfix release? In DataCleaner we&apos;ll soon make a bugfix release, and moving to 5.x for that seems like a quite a change&lt;/p&gt;</comment>
                            <comment id="16140072" author="githubbot" created="Thu, 24 Aug 2017 14:22:11 +0000"  >&lt;p&gt;Github user kaspersorensen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/158&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Code LGTM. So we can merge.&lt;/p&gt;

&lt;p&gt;    As for a release, I looked at DataCleaner and haven&apos;t you actually upgraded to some 5.0 RC version? Not the latest with the big arrays-to-collections change though.&lt;/p&gt;</comment>
                            <comment id="16140076" author="githubbot" created="Thu, 24 Aug 2017 14:23:41 +0000"  >&lt;p&gt;Github user LosD commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/158&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Nope, only the version you&apos;re maintaining. We have no update plans until next major release&lt;/p&gt;</comment>
                            <comment id="16140151" author="githubbot" created="Thu, 24 Aug 2017 15:14:24 +0000"  >&lt;p&gt;Github user kaspersorensen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/158&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Ok, I think you have committer rights to prepare a 4.6.1 release branch with the fix then.&lt;/p&gt;</comment>
                            <comment id="16140218" author="githubbot" created="Thu, 24 Aug 2017 15:55:39 +0000"  >&lt;p&gt;Github user kaspersorensen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/158&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Btw. probably contrary to what you think, I agree with your rant &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I do think &quot;toString tests&quot; can sometimes have value, but they are being way over-used in the integration tests and certainly assert waaaay too much. I do like &quot;toString tests&quot; for something simple such as asserting the contents of a string list or so, like this:&lt;br/&gt;
    ```&lt;br/&gt;
    assertEquals(&quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;id, name, foo, bar&amp;#93;&lt;/span&gt;&quot;, table.getColumnNames().toString());&lt;br/&gt;
    ```&lt;/p&gt;</comment>
                            <comment id="16140220" author="githubbot" created="Thu, 24 Aug 2017 15:56:40 +0000"  >&lt;p&gt;Github user kaspersorensen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/158&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Please merge, but also remember to add an entry in CHANGES.md&lt;/p&gt;</comment>
                            <comment id="16140228" author="githubbot" created="Thu, 24 Aug 2017 16:01:29 +0000"  >&lt;p&gt;Github user LosD commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/158&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Actually, that&apos;s one of the worst kind for me (in general, but especially in this context), since they assume order, and often lead to unfocused tests (e.g. testing the whole list instead of that the element you added is present). Unfocused tests fails if you look at the code a bit too hard &#9786;&#65039;&lt;/p&gt;</comment>
                            <comment id="16140236" author="githubbot" created="Thu, 24 Aug 2017 16:14:17 +0000"  >&lt;p&gt;Github user LosD commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/158&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Unfocused tests also has the problem that it&apos;s often unclear what it intends to test, it makes it harder to understand  what the purpose of the code it is testing was, making its value as part of the documentation lower, and harder to conclude if a change was actually breaking stuff, or if the test was just a casualty of something unrelated. &lt;/p&gt;</comment>
                            <comment id="16140256" author="githubbot" created="Thu, 24 Aug 2017 16:25:43 +0000"  >&lt;p&gt;Github user tomatophantastico commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/158&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I found those &quot;toString&quot; test to be quite problematic too, even in small tests and i  encountered a lot of them during the arrays-&amp;gt;collection conversion and i would be happy to see them phased out, even the small ones.&lt;/p&gt;

&lt;p&gt;    The schema uses a lot of  interfaces but tests against the string serialisation, which is meant for human consumption. &lt;/p&gt;

&lt;p&gt;    `assertTrue(Lists.newArrayList(&quot;a&quot;,&quot;b&quot;).equals(table.getColumnNames()))`&lt;/p&gt;

&lt;p&gt;    is short, but does not depend on the toString() of the implementing List. &lt;/p&gt;



</comment>
                            <comment id="16140579" author="githubbot" created="Thu, 24 Aug 2017 19:39:29 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/158&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 12 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3j5d3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>