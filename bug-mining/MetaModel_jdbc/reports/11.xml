<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:31:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[METAMODEL-198] Where clauses on timestamp loses the nanoseconds</title>
                <link>https://issues.apache.org/jira/browse/METAMODEL-198</link>
                <project id="12314523" key="METAMODEL">Apache MetaModel (Retired)</project>
                    <description>&lt;p&gt;Queries having where clause on timestamp column in databases loses the nanoseconds. &lt;/p&gt;

&lt;p&gt;This is happening because the Timestamp values are converted to Date object using the new Date(long timeInMilliseconds).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12905630">METAMODEL-198</key>
            <summary>Where clauses on timestamp loses the nanoseconds</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ak.ankitkumar">Ankit Kumar</assignee>
                                    <reporter username="ak.ankitkumar">Ankit Kumar</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Oct 2015 20:20:39 +0000</created>
                <updated>Mon, 19 Oct 2015 09:20:35 +0000</updated>
                            <resolved>Mon, 19 Oct 2015 09:20:35 +0000</resolved>
                                                    <fixVersion>4.4.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14961363" author="githubbot" created="Fri, 16 Oct 2015 21:08:44 +0000"  >&lt;p&gt;GitHub user ankit2711 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/58&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/58&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Fix &lt;a href=&quot;https://issues.apache.org/jira/browse/METAMODEL-198&quot; title=&quot;Where clauses on timestamp loses the nanoseconds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;METAMODEL-198&quot;&gt;&lt;del&gt;METAMODEL-198&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;     This fixes the issue but the changes are done in the FormatHelper. Few more test cases added for Timestamp values. &lt;br/&gt;
    Trying to apply a fix for Timestamp operand in the DefaultQueryRewriter&lt;br/&gt;
    does get overriden by the logic written in the FormatHelper which is&lt;br/&gt;
    called by super.rewriteFilterItems(FilterItem). &lt;br/&gt;
    The FormatHelper again detects based on the columnType and changes the&lt;br/&gt;
    values to be Date losing the nanoseconds.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/ankit2711/metamodel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ankit2711/metamodel&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/58.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/58.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #58&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit ac10d56e18c0a51cc57e6e8da1694aacf6a28f56&lt;br/&gt;
Author: ankit2711 &amp;lt;ak.ankitkumar@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-10-16T21:06:41Z&lt;/p&gt;

&lt;p&gt;    Fix &lt;a href=&quot;https://issues.apache.org/jira/browse/METAMODEL-198&quot; title=&quot;Where clauses on timestamp loses the nanoseconds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;METAMODEL-198&quot;&gt;&lt;del&gt;METAMODEL-198&lt;/del&gt;&lt;/a&gt;. This fixes the issue but the changes are done in the&lt;br/&gt;
    FormatHelper. &lt;br/&gt;
    Trying to apply a fix for Timestamp operand in the DefaultQueryRewriter&lt;br/&gt;
    does get overriden by the logic written in the FormatHelper which is&lt;br/&gt;
    called by super.rewriteFilterItems(FilterItem). &lt;br/&gt;
    The FormatHelper again detects based on the columnType and changes the&lt;br/&gt;
    values to be Date losing the nanoseconds.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14961851" author="githubbot" created="Sat, 17 Oct 2015 11:23:38 +0000"  >&lt;p&gt;Github user kaspersorensen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/58#issuecomment-148908260&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/58#issuecomment-148908260&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The build is failing so I doubt this is a good approach, but I&apos;d like to give some input and thoughts... I was trying to read up on JDBC spec to understand what can be done here.&lt;/p&gt;

&lt;p&gt;    In section 13.4.2 of the JDBC 4.1 spec &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; it shows that proper SQL statement escape would be&lt;/p&gt;

&lt;p&gt;    date:  ```{d &apos;yyyy-mm-dd&apos;```&lt;br/&gt;
    time: ```&lt;/p&gt;
{t &apos;hh:mm:ss&apos;}
&lt;p&gt;```&lt;br/&gt;
    timestamp: ```&lt;/p&gt;
{ts &apos;yyyy-mm-dd hh:mm:ss.f . . .&apos;}
&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;    I&apos;m always quite skeptical to see if the JDBC drivers out there &lt;em&gt;actually&lt;/em&gt; implement such details of the JDBC spec. Often I have found that implementations are not spot on in that regard. But I think the above could form the basis of a good default. We could override the default in case of deviating JDBC drivers.&lt;/p&gt;

&lt;p&gt;    Our normal way of handling such deviations is to not rely on the FormatHelper (because it is generic and context-free) but rather rely on the ```IQueryRewriter``` interface, which actually has the method ```rewriteFilterItem(...)``` method. There&apos;s a hierarchy of classes that implement the interface and the default implementation (which most deviating implementations extend from) does delegate eventually to FormatHelper. But that&apos;s what we should change IMO. So instead of changing FormatHelper I would change ```DefaultQueryRewriter```.&lt;/p&gt;

&lt;p&gt;    I would also want to cover this in all of our JDBC integration tests. Those aren&apos;t part of the Travis build but once we have a good implementation going then I am happy to test at least on the usual suspect databases such as PostgreSQL, MySQL, MS SQL Server, DB2 and Oracle.&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://download.oracle.com/otn-pub/jcp/jdbc-4_1-mrel-spec/jdbc4.1-fr-spec.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://download.oracle.com/otn-pub/jcp/jdbc-4_1-mrel-spec/jdbc4.1-fr-spec.pdf&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14961882" author="githubbot" created="Sat, 17 Oct 2015 12:35:09 +0000"  >&lt;p&gt;Github user ankit2711 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/58#issuecomment-148913788&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/58#issuecomment-148913788&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The build was failing because some tests were added with the use of the below constructor &lt;br/&gt;
    new Timestamp(long milliseconds) and then assertion were applied on the Timestamp in string. The constructor use with long milliseconds involves timeszone and hence the assertions failed. &lt;/p&gt;

&lt;p&gt;    Have tested on Postgres and Oracle when using &lt;span class=&quot;error&quot;&gt;&amp;#91;TIMESTAMP &amp;#39;yyyy-mm-dd hh:mm:ss.nnnnnn&amp;#39;&amp;#93;&lt;/span&gt; in the query then the database does the conversion with respect to the format used in the timestamp column of that DB. The format of the timestamp column in Oracle had the storage of timestamp value in a format like this 16-OCT-15 04.33.34.646685000 PM.&lt;/p&gt;</comment>
                            <comment id="14961885" author="githubbot" created="Sat, 17 Oct 2015 12:43:15 +0000"  >&lt;p&gt;Github user kaspersorensen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/58#issuecomment-148914106&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/58#issuecomment-148914106&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Yes but I would love to have it solved in as generically possible way as we can. If the JDBC spec says that JDBC drivers should take into account the format of ```&lt;/p&gt;
{ts &apos;yyyy-mm-dd hh:mm:ss.f . . .&apos;}
&lt;p&gt;``` then that is probably the sanest to go for as the default. I would expect (but need to verify) that then the Oracle and PostgreSQL drivers can convert that expression to whatever is needed in the physical query fired from within the driver.&lt;/p&gt;</comment>
                            <comment id="14961934" author="githubbot" created="Sat, 17 Oct 2015 15:01:32 +0000"  >&lt;p&gt;Github user kaspersorensen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/58#issuecomment-148921871&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/58#issuecomment-148921871&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Also a note on testing - if we add it as a scenario in JdbcTestTemplates then we can immediately verify it with all the automatic tests that can run for Derby, H2, HSQLDB, SQLite. If it works for those then I always feel a lot more comforted that we have something with a certain broader applicability.&lt;/p&gt;</comment>
                            <comment id="14962114" author="githubbot" created="Sat, 17 Oct 2015 23:25:35 +0000"  >&lt;p&gt;Github user ankit2711 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/58#issuecomment-148960339&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/58#issuecomment-148960339&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Modified the fix to be now in DefaultQueryRewriter, added tests which work for Derby, H2 and HSQL. For SQLLite the timestamp insertions also do not store the milliseconds so skipped for now. Nothing is done in FormatHelper specific to Timestamp now.&lt;/p&gt;</comment>
                            <comment id="14962215" author="githubbot" created="Sun, 18 Oct 2015 08:10:26 +0000"  >&lt;p&gt;Github user kaspersorensen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/58#discussion_r42318399&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/58#discussion_r42318399&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: jdbc/src/main/java/org/apache/metamodel/jdbc/dialects/DerbyQueryRewriter.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,50 @@&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing,&lt;br/&gt;
    + * software distributed under the License is distributed on an&lt;br/&gt;
    + * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY&lt;br/&gt;
    + * KIND, either express or implied.  See the License for the&lt;br/&gt;
    + * specific language governing permissions and limitations&lt;br/&gt;
    + * under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +package org.apache.metamodel.jdbc.dialects;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.sql.Timestamp;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.metamodel.jdbc.JdbcDataContext;&lt;br/&gt;
    +import org.apache.metamodel.query.FilterItem;&lt;br/&gt;
    +import org.apache.metamodel.query.OperatorType;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Query rewriter for Derby&lt;br/&gt;
    + */&lt;br/&gt;
    +public class DerbyQueryRewriter extends DefaultQueryRewriter {&lt;br/&gt;
    +&lt;br/&gt;
    +    public DerbyQueryRewriter(JdbcDataContext dataContext) &lt;/p&gt;
{
    +        super(dataContext);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    @Override&lt;br/&gt;
    +    public String rewriteFilterItem(FilterItem item) {&lt;br/&gt;
    +        final Object operand = item.getOperand();&lt;br/&gt;
    +        if (operand instanceof Timestamp) {&lt;br/&gt;
    +            final OperatorType operator = item.getOperator();&lt;br/&gt;
    +            StringBuilder sb = new StringBuilder();&lt;br/&gt;
    +            sb.append(item.getSelectItem().getSameQueryAlias(false));&lt;br/&gt;
    +            FilterItem.appendOperator(sb, operand, operator);&lt;br/&gt;
    +            sb.append(&quot;TIMESTAMP ( \&apos;&quot; + operand.toString() + &quot;\&apos;) &quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Is this different from the parent somehow? I can&apos;t see a difference, but may be missing a detail somewhere?&lt;/p&gt;</comment>
                            <comment id="14962216" author="githubbot" created="Sun, 18 Oct 2015 08:11:00 +0000"  >&lt;p&gt;Github user kaspersorensen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/58#discussion_r42318408&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/58#discussion_r42318408&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: jdbc/src/main/java/org/apache/metamodel/jdbc/dialects/DefaultQueryRewriter.java &amp;#8212;&lt;br/&gt;
    @@ -106,14 +107,22 @@ private boolean needsQuoting(String alias, String identifierQuoteString) {&lt;br/&gt;
         public String rewriteFilterItem(FilterItem item) {&lt;br/&gt;
             Object operand = item.getOperand();&lt;br/&gt;
             if (operand != null) {&lt;br/&gt;
    +            final SelectItem selectItem = item.getSelectItem();&lt;br/&gt;
                 if (operand instanceof String) {&lt;br/&gt;
                     String str = (String) operand;&lt;br/&gt;
                     // escape single quotes&lt;br/&gt;
                     if (str.indexOf(&apos;\&apos;&apos;) != -1) &lt;/p&gt;
{
                         str = escapeQuotes(str);
    -                    FilterItem replacementFilterItem = new FilterItem(item.getSelectItem(), item.getOperator(), str);
    +                    FilterItem replacementFilterItem = new FilterItem(selectItem, item.getOperator(), str);
                         return super.rewriteFilterItem(replacementFilterItem);
                     }
&lt;p&gt;    +            } else if (operand instanceof Timestamp) {&lt;br/&gt;
    +                final OperatorType operator = item.getOperator();&lt;br/&gt;
    +                StringBuilder sb = new StringBuilder();&lt;br/&gt;
    +                sb.append(selectItem.getSameQueryAlias(false));&lt;br/&gt;
    +                FilterItem.appendOperator(sb, operand, operator);&lt;br/&gt;
    +                sb.append(&quot;TIMESTAMP \&apos;&quot; + operand.toString() + &quot;\&apos;&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Would probably be a good idea to make a protected method &quot;rewriteTimestamp(Timestamp)&quot; so that we can easily overwrite just that in any deviating dialects.&lt;/p&gt;</comment>
                            <comment id="14962217" author="githubbot" created="Sun, 18 Oct 2015 08:11:44 +0000"  >&lt;p&gt;Github user kaspersorensen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/58#discussion_r42318415&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/58#discussion_r42318415&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: jdbc/src/test/java/org/apache/metamodel/jdbc/JdbcTestTemplates.java &amp;#8212;&lt;br/&gt;
    @@ -633,4 +634,84 @@ public void run(UpdateCallback callback) &lt;/p&gt;
{
                 dataContext.executeUpdate(new DropTable(defaultSchema, testTableName));
             }
&lt;p&gt;         }&lt;br/&gt;
    +&lt;br/&gt;
    +    public static void timestampValueInsertSelect(Connection conn) throws Exception {&lt;br/&gt;
    +        assertNotNull(conn);&lt;br/&gt;
    +&lt;br/&gt;
    +        try &lt;/p&gt;
{
    +            // clean up, if nescesary
    +            conn.createStatement().execute(&quot;DROP TABLE test_table&quot;);
    +        }
&lt;p&gt; catch (SQLException e) &lt;/p&gt;
{
    +            // do nothing
    +        }
&lt;p&gt;    +&lt;br/&gt;
    +        assertFalse(conn.isReadOnly());&lt;br/&gt;
    +&lt;br/&gt;
    +        JdbcDataContext dc = new JdbcDataContext(conn);&lt;br/&gt;
    +        final Schema schema = dc.getDefaultSchema();&lt;br/&gt;
    +        final Timestamp timestamp1 = Timestamp.valueOf(&quot;2015-10-16 16:33:33.456&quot;);&lt;br/&gt;
    +        final Timestamp timestamp2 = Timestamp.valueOf(&quot;2015-10-16 16:33:34.683&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    These are just milliseconds I think? Shouldn&apos;t we be adding nanoseconds to the test, or else we&apos;re not getting into the real precision gotchas here?&lt;/p&gt;</comment>
                            <comment id="14962266" author="githubbot" created="Sun, 18 Oct 2015 10:24:49 +0000"  >&lt;p&gt;Github user ankit2711 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/58#discussion_r42319497&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/58#discussion_r42319497&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: jdbc/src/main/java/org/apache/metamodel/jdbc/dialects/DerbyQueryRewriter.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,50 @@&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing,&lt;br/&gt;
    + * software distributed under the License is distributed on an&lt;br/&gt;
    + * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY&lt;br/&gt;
    + * KIND, either express or implied.  See the License for the&lt;br/&gt;
    + * specific language governing permissions and limitations&lt;br/&gt;
    + * under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +package org.apache.metamodel.jdbc.dialects;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.sql.Timestamp;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.metamodel.jdbc.JdbcDataContext;&lt;br/&gt;
    +import org.apache.metamodel.query.FilterItem;&lt;br/&gt;
    +import org.apache.metamodel.query.OperatorType;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Query rewriter for Derby&lt;br/&gt;
    + */&lt;br/&gt;
    +public class DerbyQueryRewriter extends DefaultQueryRewriter {&lt;br/&gt;
    +&lt;br/&gt;
    +    public DerbyQueryRewriter(JdbcDataContext dataContext) &lt;/p&gt;
{
    +        super(dataContext);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    @Override&lt;br/&gt;
    +    public String rewriteFilterItem(FilterItem item) {&lt;br/&gt;
    +        final Object operand = item.getOperand();&lt;br/&gt;
    +        if (operand instanceof Timestamp) {&lt;br/&gt;
    +            final OperatorType operator = item.getOperator();&lt;br/&gt;
    +            StringBuilder sb = new StringBuilder();&lt;br/&gt;
    +            sb.append(item.getSelectItem().getSameQueryAlias(false));&lt;br/&gt;
    +            FilterItem.appendOperator(sb, operand, operator);&lt;br/&gt;
    +            sb.append(&quot;TIMESTAMP ( \&apos;&quot; + operand.toString() + &quot;\&apos;) &quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Yes it expects the format like TIMESTAMP ( &apos; operand value &apos; ), so the round braces are needed else it does not work. I guess timestamp queries on Derby might be broken on master.&lt;/p&gt;</comment>
                            <comment id="14962275" author="githubbot" created="Sun, 18 Oct 2015 10:38:27 +0000"  >&lt;p&gt;Github user ankit2711 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/58#discussion_r42319638&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/58#discussion_r42319638&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: jdbc/src/main/java/org/apache/metamodel/jdbc/dialects/DefaultQueryRewriter.java &amp;#8212;&lt;br/&gt;
    @@ -106,14 +107,22 @@ private boolean needsQuoting(String alias, String identifierQuoteString) {&lt;br/&gt;
         public String rewriteFilterItem(FilterItem item) {&lt;br/&gt;
             Object operand = item.getOperand();&lt;br/&gt;
             if (operand != null) {&lt;br/&gt;
    +            final SelectItem selectItem = item.getSelectItem();&lt;br/&gt;
                 if (operand instanceof String) {&lt;br/&gt;
                     String str = (String) operand;&lt;br/&gt;
                     // escape single quotes&lt;br/&gt;
                     if (str.indexOf(&apos;\&apos;&apos;) != -1) &lt;/p&gt;
{
                         str = escapeQuotes(str);
    -                    FilterItem replacementFilterItem = new FilterItem(item.getSelectItem(), item.getOperator(), str);
    +                    FilterItem replacementFilterItem = new FilterItem(selectItem, item.getOperator(), str);
                         return super.rewriteFilterItem(replacementFilterItem);
                     }
&lt;p&gt;    +            } else if (operand instanceof Timestamp) {&lt;br/&gt;
    +                final OperatorType operator = item.getOperator();&lt;br/&gt;
    +                StringBuilder sb = new StringBuilder();&lt;br/&gt;
    +                sb.append(selectItem.getSameQueryAlias(false));&lt;br/&gt;
    +                FilterItem.appendOperator(sb, operand, operator);&lt;br/&gt;
    +                sb.append(&quot;TIMESTAMP \&apos;&quot; + operand.toString() + &quot;\&apos;&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Done.&lt;/p&gt;</comment>
                            <comment id="14962277" author="githubbot" created="Sun, 18 Oct 2015 10:39:56 +0000"  >&lt;p&gt;Github user ankit2711 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/58#discussion_r42319647&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/58#discussion_r42319647&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: jdbc/src/test/java/org/apache/metamodel/jdbc/JdbcTestTemplates.java &amp;#8212;&lt;br/&gt;
    @@ -633,4 +634,84 @@ public void run(UpdateCallback callback) &lt;/p&gt;
{
                 dataContext.executeUpdate(new DropTable(defaultSchema, testTableName));
             }
&lt;p&gt;         }&lt;br/&gt;
    +&lt;br/&gt;
    +    public static void timestampValueInsertSelect(Connection conn) throws Exception {&lt;br/&gt;
    +        assertNotNull(conn);&lt;br/&gt;
    +&lt;br/&gt;
    +        try &lt;/p&gt;
{
    +            // clean up, if nescesary
    +            conn.createStatement().execute(&quot;DROP TABLE test_table&quot;);
    +        }
&lt;p&gt; catch (SQLException e) &lt;/p&gt;
{
    +            // do nothing
    +        }
&lt;p&gt;    +&lt;br/&gt;
    +        assertFalse(conn.isReadOnly());&lt;br/&gt;
    +&lt;br/&gt;
    +        JdbcDataContext dc = new JdbcDataContext(conn);&lt;br/&gt;
    +        final Schema schema = dc.getDefaultSchema();&lt;br/&gt;
    +        final Timestamp timestamp1 = Timestamp.valueOf(&quot;2015-10-16 16:33:33.456&quot;);&lt;br/&gt;
    +        final Timestamp timestamp2 = Timestamp.valueOf(&quot;2015-10-16 16:33:34.683&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    This is hard because not all DB drivers claim to have the complete fractions parts. If the 6 digit number is placed for the nanos then in Derby. H2 and HSQL only first 3 digits are stored. &lt;/p&gt;</comment>
                            <comment id="14962438" author="githubbot" created="Sun, 18 Oct 2015 15:24:32 +0000"  >&lt;p&gt;Github user kaspersorensen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/58#discussion_r42322079&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/58#discussion_r42322079&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: jdbc/src/main/java/org/apache/metamodel/jdbc/dialects/DefaultQueryRewriter.java &amp;#8212;&lt;br/&gt;
    @@ -139,13 +143,24 @@ public String rewriteFilterItem(FilterItem item) {&lt;br/&gt;
                         }&lt;br/&gt;
                     }&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;FilterItem replacementFilterItem = new FilterItem(item.getSelectItem(), item.getOperator(), elements);&lt;br/&gt;
    +                FilterItem replacementFilterItem = new FilterItem(selectItem, item.getOperator(), elements);&lt;br/&gt;
                     return super.rewriteFilterItem(replacementFilterItem);&lt;br/&gt;
                 }&lt;br/&gt;
             }&lt;br/&gt;
             return super.rewriteFilterItem(item);&lt;br/&gt;
         }&lt;/li&gt;
	&lt;li&gt;&lt;p&gt;    +&lt;br/&gt;
    +    protected String rewriteTimestamp(FilterItem item) {&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Now this method does a rewrite of a whole filter item and not just the timestamp literal. I was suggesting to make something that would make the burden of overriding as little as possible, so that you would only need to do like this:&lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    protected String rewriteTimestamp(Timestamp timestamp) &lt;/p&gt;
{
      return MyStrangeTimestampFormat.format(timestamp);
    }
&lt;p&gt; &lt;br/&gt;
    ```&lt;/p&gt;</comment>
                            <comment id="14962439" author="githubbot" created="Sun, 18 Oct 2015 15:25:24 +0000"  >&lt;p&gt;Github user kaspersorensen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/58#discussion_r42322087&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/58#discussion_r42322087&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: jdbc/src/main/java/org/apache/metamodel/jdbc/dialects/DefaultQueryRewriter.java &amp;#8212;&lt;br/&gt;
    @@ -139,13 +143,24 @@ public String rewriteFilterItem(FilterItem item) {&lt;br/&gt;
                         }&lt;br/&gt;
                     }&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;FilterItem replacementFilterItem = new FilterItem(item.getSelectItem(), item.getOperator(), elements);&lt;br/&gt;
    +                FilterItem replacementFilterItem = new FilterItem(selectItem, item.getOperator(), elements);&lt;br/&gt;
                     return super.rewriteFilterItem(replacementFilterItem);&lt;br/&gt;
                 }&lt;br/&gt;
             }&lt;br/&gt;
             return super.rewriteFilterItem(item);&lt;br/&gt;
         }&lt;/li&gt;
	&lt;li&gt;&lt;p&gt;    +&lt;br/&gt;
    +    protected String rewriteTimestamp(FilterItem item) {&lt;br/&gt;
    +        final OperatorType operator = item.getOperator();&lt;br/&gt;
    +        final SelectItem selectItem = item.getSelectItem();&lt;br/&gt;
    +        final Object operand = item.getOperand();&lt;br/&gt;
    +        StringBuilder sb = new StringBuilder();&lt;br/&gt;
    +        sb.append(selectItem.getSameQueryAlias(false));&lt;br/&gt;
    +        FilterItem.appendOperator(sb, operand, operator);&lt;br/&gt;
    +        sb.append(&quot;TIMESTAMP \&apos;&quot; + operand.toString() + &quot;\&apos;&quot;);&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Did you try with the official JDBC escape syntax? I bet that has a lot better general applicability than this format...&lt;/p&gt;</comment>
                            <comment id="14962440" author="githubbot" created="Sun, 18 Oct 2015 15:26:21 +0000"  >&lt;p&gt;Github user kaspersorensen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/58#discussion_r42322102&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/58#discussion_r42322102&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: jdbc/src/main/java/org/apache/metamodel/jdbc/dialects/DefaultQueryRewriter.java &amp;#8212;&lt;br/&gt;
    @@ -139,13 +143,24 @@ public String rewriteFilterItem(FilterItem item) {&lt;br/&gt;
                         }&lt;br/&gt;
                     }&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;FilterItem replacementFilterItem = new FilterItem(item.getSelectItem(), item.getOperator(), elements);&lt;br/&gt;
    +                FilterItem replacementFilterItem = new FilterItem(selectItem, item.getOperator(), elements);&lt;br/&gt;
                     return super.rewriteFilterItem(replacementFilterItem);&lt;br/&gt;
                 }&lt;br/&gt;
             }&lt;br/&gt;
             return super.rewriteFilterItem(item);&lt;br/&gt;
         }&lt;/li&gt;
	&lt;li&gt;&lt;p&gt;    +&lt;br/&gt;
    +    protected String rewriteTimestamp(FilterItem item) {&lt;br/&gt;
    +        final OperatorType operator = item.getOperator();&lt;br/&gt;
    +        final SelectItem selectItem = item.getSelectItem();&lt;br/&gt;
    +        final Object operand = item.getOperand();&lt;br/&gt;
    +        StringBuilder sb = new StringBuilder();&lt;br/&gt;
    +        sb.append(selectItem.getSameQueryAlias(false));&lt;br/&gt;
    +        FilterItem.appendOperator(sb, operand, operator);&lt;br/&gt;
    +        sb.append(&quot;TIMESTAMP \&apos;&quot; + operand.toString() + &quot;\&apos;&quot;);&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    To be specific, I would change this line to:&lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    sb.append(&quot;&lt;/p&gt;
{ts &apos;&quot; +  operand.toString() + &quot;&apos;}
&lt;p&gt;&quot;);&lt;br/&gt;
    ```&lt;/p&gt;</comment>
                            <comment id="14962443" author="githubbot" created="Sun, 18 Oct 2015 15:28:32 +0000"  >&lt;p&gt;Github user kaspersorensen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/58#discussion_r42322120&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/58#discussion_r42322120&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: jdbc/src/test/java/org/apache/metamodel/jdbc/JdbcTestTemplates.java &amp;#8212;&lt;br/&gt;
    @@ -633,4 +634,84 @@ public void run(UpdateCallback callback) &lt;/p&gt;
{
                 dataContext.executeUpdate(new DropTable(defaultSchema, testTableName));
             }
&lt;p&gt;         }&lt;br/&gt;
    +&lt;br/&gt;
    +    public static void timestampValueInsertSelect(Connection conn) throws Exception {&lt;br/&gt;
    +        assertNotNull(conn);&lt;br/&gt;
    +&lt;br/&gt;
    +        try &lt;/p&gt;
{
    +            // clean up, if nescesary
    +            conn.createStatement().execute(&quot;DROP TABLE test_table&quot;);
    +        }
&lt;p&gt; catch (SQLException e) &lt;/p&gt;
{
    +            // do nothing
    +        }
&lt;p&gt;    +&lt;br/&gt;
    +        assertFalse(conn.isReadOnly());&lt;br/&gt;
    +&lt;br/&gt;
    +        JdbcDataContext dc = new JdbcDataContext(conn);&lt;br/&gt;
    +        final Schema schema = dc.getDefaultSchema();&lt;br/&gt;
    +        final Timestamp timestamp1 = Timestamp.valueOf(&quot;2015-10-16 16:33:33.456&quot;);&lt;br/&gt;
    +        final Timestamp timestamp2 = Timestamp.valueOf(&quot;2015-10-16 16:33:34.683&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    That&apos;s exactly why I want to use the JDBC escape syntax so the DB can make such conversions itself.&lt;/p&gt;</comment>
                            <comment id="14962512" author="githubbot" created="Sun, 18 Oct 2015 17:15:42 +0000"  >&lt;p&gt;GitHub user kaspersorensen opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/59&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/59&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/METAMODEL-198&quot; title=&quot;Where clauses on timestamp loses the nanoseconds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;METAMODEL-198&quot;&gt;&lt;del&gt;METAMODEL-198&lt;/del&gt;&lt;/a&gt;: Implemented timestamp literal based on JDBC spec&lt;/p&gt;

&lt;p&gt;    Inspired by #58 I decided to make this PR to show what I had in mind as an alternative patch which aligns closer to the JDBC spec instead of taking the literalization of timestamps into MetaModel&apos;s codebase.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/kaspersorensen/metamodel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/kaspersorensen/metamodel&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/METAMODEL-198&quot; title=&quot;Where clauses on timestamp loses the nanoseconds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;METAMODEL-198&quot;&gt;&lt;del&gt;METAMODEL-198&lt;/del&gt;&lt;/a&gt;/timestamp-jdbc&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/59.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/59.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #59&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit f70eb7f54c0a715314b4315beca99819209857c2&lt;br/&gt;
Author: Kasper S&#248;rensen &amp;lt;i.am.kasper.sorensen@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-10-18T17:14:12Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/METAMODEL-198&quot; title=&quot;Where clauses on timestamp loses the nanoseconds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;METAMODEL-198&quot;&gt;&lt;del&gt;METAMODEL-198&lt;/del&gt;&lt;/a&gt;: Implemented timestamp literal based on JDBC spec&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14962515" author="githubbot" created="Sun, 18 Oct 2015 17:16:04 +0000"  >&lt;p&gt;Github user kaspersorensen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/59#issuecomment-149031371&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/59#issuecomment-149031371&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @ankit2711 please take a look and let me know if this makes sense to you.&lt;/p&gt;</comment>
                            <comment id="14962522" author="githubbot" created="Sun, 18 Oct 2015 17:28:40 +0000"  >&lt;p&gt;Github user kaspersorensen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/59#issuecomment-149032002&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/59#issuecomment-149032002&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hmm seems it doesn&apos;t work for SQLite ... It seems to return a String and not a Timestamp! Strange. Will work a bit more on this, but I see that also #58 has no test on SQLite, so that&apos;s probably the same issue.&lt;/p&gt;</comment>
                            <comment id="14962564" author="githubbot" created="Sun, 18 Oct 2015 19:01:13 +0000"  >&lt;p&gt;Github user kaspersorensen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/59#issuecomment-149039177&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/59#issuecomment-149039177&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    OK a bit more research and coding done ...&lt;/p&gt;

&lt;p&gt;    FIrst of all, we still missed one half of the problem, so I did that: The timestamps that are inserted where wrongly re-created and that made them loose their nano-second precision. So I&apos;ve changed that in JdbcUtils.setStatementValue(...)&lt;/p&gt;

&lt;p&gt;    The other thing I would want to report is that since I know you faced this issue in PostgreSQL, I wanted to test specifically on that database - hence the update to PostgresqlTest. BUT I must say that my finding was a bit dissapointing. It seems that the PostgreSQL driver has sub-nanosecond precision. To be precise it &quot;only&quot; has precision of a 1000th of a millisecond. Several sources explain that this is an issue with how the database formats the output when sending it to JDBC &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; and I couldn&apos;t find any solutions to the problem that didn&apos;t involve compiling PostgreSQL yourself&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/warning.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. Apparently the microsecond precision that they claim to have is only in the storage layer. The issue can also be seen in simple pgAdmin usage:&lt;/p&gt;

&lt;p&gt;    !&lt;span class=&quot;error&quot;&gt;&amp;#91;image&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github-cloud.s3.amazonaws.com/assets/291450/10565850/2977bda0-75db-11e5-9fd6-d8c6e90b845d.png&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github-cloud.s3.amazonaws.com/assets/291450/10565850/2977bda0-75db-11e5-9fd6-d8c6e90b845d.png&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;    The above fraction-of-second numbers are only 6 digit while a nano would be 9 digit.&lt;/p&gt;

&lt;p&gt;    As a result, the PostgresqlTest only does assertions on millisecond-precision.&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://www.postgresql.org/message-id/3A370254.44C55482@alumni.caltech.edu&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.postgresql.org/message-id/3A370254.44C55482@alumni.caltech.edu&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14962597" author="githubbot" created="Sun, 18 Oct 2015 20:01:48 +0000"  >&lt;p&gt;Github user ankit2711 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/58#issuecomment-149042383&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/58#issuecomment-149042383&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Done all. &lt;/p&gt;</comment>
                            <comment id="14962912" author="githubbot" created="Mon, 19 Oct 2015 06:34:38 +0000"  >&lt;p&gt;Github user LosD commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/59#issuecomment-149116429&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/59#issuecomment-149116429&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &apos;To be precise it &quot;only&quot; has precision of a 1000th of a millisecond.&apos;&lt;br/&gt;
    &apos;Apparently the microsecond precision that they claim to have is only in the storage layer.&apos;&lt;br/&gt;
    One thousandth of a millisecond is a microsecond... Doesn&apos;t that make the microsecond precision claim correct? Or did you mean nanosecond precision?&lt;/p&gt;</comment>
                            <comment id="14962925" author="githubbot" created="Mon, 19 Oct 2015 06:46:17 +0000"  >&lt;p&gt;Github user LosD commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/59#issuecomment-149117882&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/59#issuecomment-149117882&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The message you refer to is from 2000, and is not representative of 2015 (it talks about 10th of a seoncd).&lt;/p&gt;

&lt;p&gt;    Your example seems to show microsecond precision in the output.&lt;/p&gt;</comment>
                            <comment id="14962955" author="githubbot" created="Mon, 19 Oct 2015 07:22:18 +0000"  >&lt;p&gt;Github user kaspersorensen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/59#issuecomment-149125641&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/59#issuecomment-149125641&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I made a mistake in my research! Somehow got the impression that 1 nanosecond = 1000 microsecond. But it&apos;s in deed the other way around! Then the strange rounding issue that I saw makes absolute sense because PostgreSQL&apos;s rounding to the nearest 1000 nanos is exactly 1 microsecond! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;    I guess I just need to then update the JdbcTestTemplates class to also support Microsecond precision.&lt;/p&gt;</comment>
                            <comment id="14963007" author="githubbot" created="Mon, 19 Oct 2015 08:56:12 +0000"  >&lt;p&gt;Github user ankit2711 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/59#issuecomment-149150447&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/59#issuecomment-149150447&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1 wil fix this issue for now.&lt;/p&gt;</comment>
                            <comment id="14963026" author="githubbot" created="Mon, 19 Oct 2015 09:13:36 +0000"  >&lt;p&gt;Github user ankit2711 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/58#issuecomment-149153838&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/58#issuecomment-149153838&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The fixes are also done in another pull request from Kasper. That pull request also fixes some issues with Timestamp while insertion time. Closing this PR then.&lt;/p&gt;</comment>
                            <comment id="14963027" author="githubbot" created="Mon, 19 Oct 2015 09:13:37 +0000"  >&lt;p&gt;Github user ankit2711 closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/58&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/58&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14963032" author="githubbot" created="Mon, 19 Oct 2015 09:16:38 +0000"  >&lt;p&gt;Github user kaspersorensen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/59#issuecomment-149154399&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/59#issuecomment-149154399&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    OK I will merge this in ... I also now tested it on the major databases; MySQL, Oracle, DB2 and MS SQL Server.&lt;/p&gt;</comment>
                            <comment id="14963037" author="githubbot" created="Mon, 19 Oct 2015 09:20:00 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/59&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/59&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14963039" author="kaspersor" created="Mon, 19 Oct 2015 09:20:35 +0000"  >&lt;p&gt;Fixed with &lt;a href=&quot;https://github.com/apache/metamodel/pull/59&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/59&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 4 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2n4wn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>