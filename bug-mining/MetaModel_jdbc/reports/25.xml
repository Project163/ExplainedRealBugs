<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:31:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[METAMODEL-1143] Column names not quoted on insert </title>
                <link>https://issues.apache.org/jira/browse/METAMODEL-1143</link>
                <project id="12314523" key="METAMODEL">Apache MetaModel (Retired)</project>
                    <description>&lt;p&gt;Looks like method JdbcUpdateCallback.quoteIfNecessary() only quotes column names in these cases:&lt;/p&gt;

&lt;p&gt;        if (identifier.indexOf(&apos; &apos;) != &lt;del&gt;1 || identifier.indexOf(&apos;&lt;/del&gt;&apos;) != -1) {&lt;/p&gt;

&lt;p&gt;So that if we have a table with a column named &#8220;ASmallInt&#8221; in Postgres (for example), this results in an error because of its mixed case (Postgres treats unquoted identifiers as lower-case):&lt;/p&gt;

&lt;p&gt;Seems like these column names should always be quoted according to the policy of the database (seems like queries are treated this way).&lt;/p&gt;

&lt;p&gt;Error code=0, SQL state=42703&lt;br/&gt;
Exception details: request: /rest/documents, parameters: &lt;br/&gt;
Could not execute insert statement: INSERT INTO &quot;x&quot;.&quot;y&quot; (id,first_name,last_name,ASmallInt)) VALUES (?,?,?,?): ERROR: column &quot;asmallint&quot; of relation &quot;y&quot; does not exist&lt;/p&gt;

&lt;p&gt;. . .&lt;/p&gt;

&lt;p&gt;        at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2458)&lt;br/&gt;
        at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2158)&lt;br/&gt;
        at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:291)&lt;br/&gt;
        at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:432)&lt;br/&gt;
        at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:358)&lt;br/&gt;
        at org.postgresql.jdbc.PgPreparedStatement.executeWithFlags(PgPreparedStatement.java:171)&lt;br/&gt;
        at org.postgresql.jdbc.PgPreparedStatement.executeUpdate(PgPreparedStatement.java:138)&lt;br/&gt;
        at org.apache.metamodel.jdbc.JdbcSimpleUpdateCallback.executePreparedStatement(JdbcSimpleUpdateCallback.java:45)&lt;br/&gt;
        at org.apache.metamodel.jdbc.JdbcUpdateCallbcutePreparedStatement(JdbcUpdateCallback.java:57)&lt;br/&gt;
        at org.apache.metamodel.jdbc.JdbcInsertBuilder.execute(JdbcInsertBuilder.java:84)&lt;/p&gt;

</description>
                <environment></environment>
        <key id="13089055">METAMODEL-1143</key>
            <summary>Column names not quoted on insert </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dana.borger@gmail.com">Dana Borger</reporter>
                        <labels>
                    </labels>
                <created>Fri, 21 Jul 2017 14:31:59 +0000</created>
                <updated>Thu, 27 Jul 2017 19:32:27 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16096953" author="tomatophantastico" created="Fri, 21 Jul 2017 22:41:33 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;i encountered a similar problem with SELECT queries for HSQLDB, which is also lacking quotes.&lt;/p&gt;

&lt;p&gt;I started working on it, but am not finished.&lt;/p&gt;

&lt;p&gt;Maybe we can synchronize efforts on fixing this, so i&apos;ll open a pull request with stuff i already got.&lt;/p&gt;</comment>
                            <comment id="16096957" author="githubbot" created="Fri, 21 Jul 2017 22:44:27 +0000"  >&lt;p&gt;GitHub user tomatophantastico opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/150&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/150&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Feature/quote columns&lt;/p&gt;

&lt;p&gt;    Working on a problem similar to  &lt;a href=&quot;https://issues.apache.org/jira/browse/METAMODEL-1143&quot; title=&quot;Column names not quoted on insert &quot; class=&quot;issue-link&quot; data-issue-key=&quot;METAMODEL-1143&quot;&gt;METAMODEL-1143&lt;/a&gt; ,this is my solution for HSQLDB and select queries.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tomatophantastico/metamodel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tomatophantastico/metamodel&lt;/a&gt; feature/quoteColumns&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/150.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/150.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #150&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit ea4cf2df161d103a6f32d39e58d6aadc341f3695&lt;br/&gt;
Author: Jo&#776;rg Unbehauen &amp;lt;joerg@unbehauen.net&amp;gt;&lt;br/&gt;
Date:   2016-10-17T03:07:31Z&lt;/p&gt;

&lt;p&gt;    test with different capitalizations of tables and columns&lt;/p&gt;

&lt;p&gt;commit 1c51bfe840296d1a3cc1a0485db90d277da089ff&lt;br/&gt;
Author: Jo&#776;rg Unbehauen &amp;lt;joerg@unbehauen.net&amp;gt;&lt;br/&gt;
Date:   2016-11-13T19:57:00Z&lt;/p&gt;

&lt;p&gt;    update testcase&lt;/p&gt;

&lt;p&gt;commit a6b6f7b9bf8f7c3e33f6609f5e257f379281501f&lt;br/&gt;
Author: Jo&#776;rg Unbehauen &amp;lt;joerg@unbehauen.net&amp;gt;&lt;br/&gt;
Date:   2016-11-16T13:41:31Z&lt;/p&gt;

&lt;p&gt;    uncommented tests that need clarification&lt;/p&gt;

&lt;p&gt;commit 891fcfddb89c774332d75aa66f9e49e948d7990d&lt;br/&gt;
Author: Jo&#776;rg Unbehauen &amp;lt;joerg@unbehauen.net&amp;gt;&lt;br/&gt;
Date:   2017-03-16T16:47:14Z&lt;/p&gt;

&lt;p&gt;    escape identifiers on hsqldb&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16097394" author="dana.borger@gmail.com" created="Sat, 22 Jul 2017 18:06:32 +0000"  >&lt;p&gt;I think for the purpose of this specific problem the change needs to be made in JdbcUpdateCallback which is used for table create/insert/update (JdbcCreateTableBuilder, JdbcInsertBuilder, JdbcUpdateBuilder)?&lt;/p&gt;

&lt;p&gt;My original inclination was to change this method to this:&lt;/p&gt;

&lt;p&gt;    protected String quoteIfNescesary(String identifier) {&lt;br/&gt;
        if (identifier == null) &lt;/p&gt;
{
            return null;
        }
&lt;p&gt;        final String quote = _dataContext.getIdentifierQuoteString();&lt;br/&gt;
        if (quote == null) &lt;/p&gt;
{
            return identifier;
        }
&lt;p&gt;        return quote + identifier + quote;&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;and then rename it to fix the misspelling in its name: &lt;em&gt;&lt;b&gt;quoteIfNecessary&lt;/b&gt;&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;and update the relevant tests.&lt;/p&gt;

&lt;p&gt;Are there reasons not to always quote in the JDBC context?&lt;/p&gt;</comment>
                            <comment id="16097499" author="kaspersor" created="Sun, 23 Jul 2017 04:33:15 +0000"  >&lt;p&gt;We could try and change it always, but my experience tells me that there are so many quirks in SQL dialects that it probably won&apos;t work. I bet there are some databases that don&apos;t supports quotes at all. The quality of MetaModel is much easier to ensure if we change these things on a case-by-case basis.&lt;/p&gt;</comment>
                            <comment id="16097504" author="githubbot" created="Sun, 23 Jul 2017 04:41:44 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/metamodel/pull/150&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/150&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16097726" author="dana.borger@gmail.com" created="Sun, 23 Jul 2017 17:42:00 +0000"  >
&lt;p&gt;If &#8220;always&#8221; isn&#8217;t the best (eg, I think Hive quoting is non-standard), shouldn&#8217;t we at least follow the pattern used by the query classes? They appear to know how and when to quote identifiers based on the vendor/version.&lt;/p&gt;


</comment>
                            <comment id="16097822" author="kaspersor" created="Sun, 23 Jul 2017 23:20:28 +0000"  >&lt;p&gt;You mean to let the IQueryRewriter do all the quoting? I would be for that.&lt;/p&gt;</comment>
                            <comment id="16100313" author="dana.borger@gmail.com" created="Tue, 25 Jul 2017 16:29:00 +0000"  >
&lt;p&gt;I was looking at this a little closer today. It appears that when we build the queries the logic takes us into the&lt;/p&gt;

&lt;p&gt;    SelectItem.toStringNoAlias(boolean)&lt;/p&gt;

&lt;p&gt;method, which if the column is set, it always uses: column.getQuotedName() (on or about SelectItem.java : 463).&lt;/p&gt;

&lt;p&gt;I&#8217;m not clear when queries would &lt;em&gt;not&lt;/em&gt; quote the column names? The query rewriting takes into account only the aliases (eg beforeRewrite()) so it doesn&#8217;t seem like the query re-writers override the quoting anyway.&lt;/p&gt;


&lt;p&gt;Furthermore, for updates it looks like the &#8220;where&#8221; conditions pass through the SelectItem code which also always uses the quoted column name (by way of getSameQueryAlias()).&lt;/p&gt;

&lt;p&gt;db&lt;/p&gt;



</comment>
                            <comment id="16103772" author="kaspersor" created="Thu, 27 Jul 2017 19:32:27 +0000"  >&lt;p&gt;Yeah so I would make the change here in JdbcUpdateCallback  and JdbcInsertBuilder. I believe the fix can be done entirely in those two classes (and unit test classes that relate to it). Basically they should be calling upon the query rewriter to properly write column names and where items.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 16 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3humn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>