<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:31:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[METAMODEL-142] Create JDBC table within an UpdateScript and with connection pool returns a null table</title>
                <link>https://issues.apache.org/jira/browse/METAMODEL-142</link>
                <project id="12314523" key="METAMODEL">Apache MetaModel (Retired)</project>
                    <description>&lt;p&gt;If you execute an update on a JdbcDataContext based on a connection pool in which BOTH creates a new table and starts inserting records to it, then it may fail.&lt;/p&gt;

&lt;p&gt;To be specific, a table returned by the TableCreationBuilder will return null:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Table table = tableBuilder.execute();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Our JdbcMetadataLoader is loading tables from the schema like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void loadTables(JdbcSchema schema) {
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Connection connection = _dataContext.getConnection();
    ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But since a new connection will be used here, and the other connection is still in an active transaction, then the isolation criterium of the transaction will cause this to NOT include the newly created table in the metadata&lt;/p&gt;</description>
                <environment></environment>
        <key id="12830693">METAMODEL-142</key>
            <summary>Create JDBC table within an UpdateScript and with connection pool returns a null table</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kaspersor">Kasper S&#248;rensen</assignee>
                                    <reporter username="kaspersor">Kasper S&#248;rensen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 May 2015 14:00:21 +0000</created>
                <updated>Thu, 12 May 2016 10:09:40 +0000</updated>
                            <resolved>Tue, 19 May 2015 17:10:59 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14550091" author="kaspersor" created="Tue, 19 May 2015 09:14:00 +0000"  >&lt;p&gt;Review request made:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/34401/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/34401/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14550783" author="kaspersor" created="Tue, 19 May 2015 17:10:59 +0000"  >&lt;p&gt;Fixed, thanks for the review and accept.&lt;/p&gt;</comment>
                            <comment id="15280091" author="losd" created="Wed, 11 May 2016 13:14:58 +0000"  >&lt;p&gt;I&apos;m not sure why, but the fix for this issue causes slowdowns when doing a table copy by . In some cases massive slowdowns (&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=h.drexler&quot; class=&quot;user-hover&quot; rel=&quot;h.drexler&quot;&gt;h.drexler&lt;/a&gt; reported ~10 -&amp;gt; ~40 seconds for a 50 column table), in others more modest (I saw ~45 seconds -&amp;gt; ~67 seconds for a 135 column table).&lt;/p&gt;

&lt;p&gt;In my case the table already existed, so it doesn&apos;t seem related at all, but a git bisect identified the exact commit for this: &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;f9ba2470a2593bb24ac599c30f21b94622036548 is the first bad commit
commit f9ba2470a2593bb24ac599c30f21b94622036548
Author: Kasper S&#248;rensen &amp;lt;i.am.kasper.sorensen@gmail.com&amp;gt;
Date:   Tue May 19 18:51:25 2015 +0200

    METAMODEL-142: Fixed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Please note that the reproduction is through DataCleaner, but testing was done by simply overwriting the MetaModel-JDBC JAR file with the one from each build and then rerunning the job. This leaves a small chance that it is because of some interaction between DC and the change.&lt;/p&gt;

&lt;p&gt;Trying to look into the change to see if I can find the reason for the slowdown.&lt;/p&gt;</comment>
                            <comment id="15280123" author="losd" created="Wed, 11 May 2016 13:41:01 +0000"  >&lt;p&gt;Hmmm... The more I look at it, the less sense it makes. All changes should only affect creation, deletion and reading the schema, I don&apos;t really see anything that would slow down neither selecting or inserting.&lt;/p&gt;

&lt;p&gt;Manual tests confirms it, though; Using test test database (135 columns, almost all nvarchar(max)):&lt;br/&gt;
commit 3b7c4fc execution times are around 45 seconds: 0m45.685s, 0m43.682s, 0m49.847s&lt;br/&gt;
commit f9ba247 execution times are around 67 seconds: 1m6.786s 1m7.020s 1m4.880s&lt;/p&gt;

&lt;p&gt;BTW, I should mention that it is on SQL Server (2014 in my case, not sure about &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=h.drexler&quot; class=&quot;user-hover&quot; rel=&quot;h.drexler&quot;&gt;h.drexler&lt;/a&gt;&apos;s).&lt;/p&gt;</comment>
                            <comment id="15280130" author="losd" created="Wed, 11 May 2016 13:42:35 +0000"  >&lt;p&gt;Commit changes: &lt;a href=&quot;https://github.com/apache/metamodel/commit/f9ba2470a2593bb24ac599c30f21b94622036548?w=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/commit/f9ba2470a2593bb24ac599c30f21b94622036548?w=1&lt;/a&gt; (Ignoring whitespace since this commit also has a lot of unrelated whitespace changes)&lt;/p&gt;</comment>
                            <comment id="15280200" author="losd" created="Wed, 11 May 2016 14:23:41 +0000"  >&lt;p&gt;Ah. It seems like insert into table constanly calls convertToColumns which in turn calls loadColumns...&lt;/p&gt;

&lt;p&gt;The slowdown probably comes from the fact that we&apos;re getting and releasing a connection even though we&apos;re not going to need it, because the columns are cached.&lt;/p&gt;</comment>
                            <comment id="15280300" author="kaspersor" created="Wed, 11 May 2016 15:40:41 +0000"  >&lt;p&gt;Which sounds like an issue only in DataCleaner then? We keep this issue resolved?&lt;/p&gt;</comment>
                            <comment id="15280362" author="losd" created="Wed, 11 May 2016 16:20:39 +0000"  >&lt;p&gt;Not really. It&apos;s a general failing in the refactoring part  that means  new connections even for cached values. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12967537">METAMODEL-252</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 27 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2evf3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>