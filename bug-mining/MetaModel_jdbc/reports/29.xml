<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:32:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[METAMODEL-156] JdbcDataContext.getDefaultSchemaName  return SchemaName error</title>
                <link>https://issues.apache.org/jira/browse/METAMODEL-156</link>
                <project id="12314523" key="METAMODEL">Apache MetaModel (Retired)</project>
                    <description>&lt;p&gt;my database has three mysql databases, for example, baseFW, baseFW_test, test. when my mysql url is : &lt;a href=&quot;http:///3306?baseFW_test&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http:///3306?baseFW_test&lt;/a&gt;, and i want get baseFW_test jdbccontext,but i will get baseFW jdbccontext. because indexOf(&quot;baseFW&quot;) &amp;gt;0 ,so return first baseFW.&lt;/p&gt;</description>
                <environment>windows 7 64  bit eclipse 4.2 luna</environment>
        <key id="12841518">METAMODEL-156</key>
            <summary>JdbcDataContext.getDefaultSchemaName  return SchemaName error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="zhaoweijing2003">zhaoweijing</reporter>
                        <labels>
                            <label>starter</label>
                    </labels>
                <created>Tue, 30 Jun 2015 01:43:11 +0000</created>
                <updated>Mon, 4 Feb 2019 19:44:13 +0000</updated>
                            <resolved>Mon, 4 Feb 2019 19:44:13 +0000</resolved>
                                    <version>4.2.0-incubating</version>
                    <version>4.3.0-incubating</version>
                    <version>4.3.2</version>
                                    <fixVersion>5.2.1</fixVersion>
                                        <due>Tue, 30 Jun 2015 00:00:00 +0000</due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14613619" author="kaspersor" created="Sat, 4 Jul 2015 09:15:33 +0000"  >&lt;p&gt;Thank you for the bug report. Any chance you could also work on a patch for this?&lt;/p&gt;</comment>
                            <comment id="14614542" author="zhaoweijing2003" created="Mon, 6 Jul 2015 05:04:30 +0000"  >&lt;p&gt;I solve this problem by schema length, the code is as follows. If you have a better solution, it is wonderful.&lt;/p&gt;


&lt;p&gt;    public String getDefaultSchemaName() {&lt;br/&gt;
        // Use a boolean to check if the result has been&lt;br/&gt;
        // found, because a schema name can actually be&lt;br/&gt;
        // null (for example in the case of Firebird&lt;br/&gt;
        // databases).&lt;br/&gt;
        boolean found = false;&lt;br/&gt;
        String result = null;&lt;br/&gt;
        List&amp;lt;String&amp;gt; result2 = new ArrayList&amp;lt;String&amp;gt;();&lt;br/&gt;
        String[] schemaNames = getSchemaNames();&lt;/p&gt;

&lt;p&gt;        // First strategy: If there&apos;s only one schema available, that must&lt;br/&gt;
        // be it&lt;br/&gt;
        if (schemaNames.length == 1) &lt;/p&gt;
{
            result = schemaNames[0];
            found = true;
        }

&lt;p&gt;        if (!found) {&lt;br/&gt;
            Connection connection = getConnection();&lt;br/&gt;
            try {&lt;br/&gt;
                DatabaseMetaData metaData = connection.getMetaData();&lt;/p&gt;

&lt;p&gt;                // Second strategy: Find default schema name by examining the&lt;br/&gt;
                // URL&lt;br/&gt;
                if (!found) {&lt;br/&gt;
                    String url = metaData.getURL();&lt;br/&gt;
                    if (url != null &amp;amp;&amp;amp; url.length() &amp;gt; 0) {&lt;br/&gt;
                        if (schemaNames.length &amp;gt; 0) {&lt;br/&gt;
                            StringTokenizer st = new StringTokenizer(url, &quot;/&lt;br class=&quot;atl-forced-newline&quot; /&gt;:&quot;);&lt;br/&gt;
                            int tokenCount = st.countTokens();&lt;br/&gt;
                            if (tokenCount &amp;gt; 0) {&lt;br/&gt;
                                for (int i = 1; i &amp;lt; tokenCount; i++) &lt;/p&gt;
{
                                    st.nextToken();
                                }
&lt;p&gt;                                String lastToken = st.nextToken();&lt;/p&gt;

&lt;p&gt;                                for (int i = 0; i &amp;lt; schemaNames.length ; i++) {&lt;br/&gt;
                                    String schemaName = schemaNames&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;;&lt;br/&gt;
                                    if (lastToken.indexOf(schemaName) != -1) &lt;/p&gt;
{
                                        result = schemaName;
                                        result2.add(result);
                                        found = true;
                                    }
&lt;p&gt;                                }&lt;br/&gt;
                                //bug: baseFW   baseFWTest  solve base name is the same &lt;br/&gt;
                                if(result2.size()&amp;gt;1)&lt;br/&gt;
                                {&lt;br/&gt;
                                	result = &quot;&quot;;&lt;br/&gt;
                                	for (String str : result2) {&lt;br/&gt;
										if(str.length()&amp;gt;result.length())&lt;/p&gt;
										{
											result = str;
										}
&lt;p&gt;									}&lt;br/&gt;
                                }&lt;br/&gt;
                                //bug solve end&lt;br/&gt;
                            }&lt;br/&gt;
                        }&lt;br/&gt;
                    }&lt;br/&gt;
                }&lt;/p&gt;

&lt;p&gt;                // Third strategy: Check for schema equal to username&lt;br/&gt;
                if (!found) {&lt;br/&gt;
                    String username = metaData.getUserName();&lt;br/&gt;
                    if (username != null) {&lt;br/&gt;
                        for (int i = 0; i &amp;lt; schemaNames.length &amp;amp;&amp;amp; !found; i++) {&lt;br/&gt;
                            if (username.equalsIgnoreCase(schemaNames&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;)) &lt;/p&gt;
{
                                result = schemaNames[i];
                                found = true;
                            }
&lt;p&gt;                        }&lt;br/&gt;
                    }&lt;br/&gt;
                }&lt;/p&gt;

&lt;p&gt;            } catch (SQLException e) &lt;/p&gt;
{
                throw JdbcUtils.wrapException(e, &quot;determine default schema name&quot;);
            }
&lt;p&gt; finally &lt;/p&gt;
{
                closeIfNescesary(connection);
            }

&lt;p&gt;            // Fourth strategy: Find default schema name by vendor-specific&lt;br/&gt;
            // hacks&lt;br/&gt;
            if (!found) {&lt;br/&gt;
                if (DATABASE_PRODUCT_POSTGRESQL.equalsIgnoreCase(_databaseProductName)) {&lt;br/&gt;
                    if (_catalogName == null) &lt;/p&gt;
{
                        result = &quot;public&quot;;
                    }
&lt;p&gt; else &lt;/p&gt;
{
                        result = _catalogName;
                    }
&lt;p&gt;                    found = true;&lt;br/&gt;
                }&lt;br/&gt;
                if (DATABASE_PRODUCT_HSQLDB.equalsIgnoreCase(_databaseProductName)) {&lt;br/&gt;
                    for (int i = 0; i &amp;lt; schemaNames.length &amp;amp;&amp;amp; !found; i++) {&lt;br/&gt;
                        String schemaName = schemaNames&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;;&lt;br/&gt;
                        if (&quot;PUBLIC&quot;.equals(schemaName)) &lt;/p&gt;
{
                            result = schemaName;
                            found = true;
                            break;
                        }&lt;br/&gt;
                    }&lt;br/&gt;
                }&lt;br/&gt;
                if (DATABASE_PRODUCT_SQLSERVER.equals(_databaseProductName)) {&lt;br/&gt;
                    for (int i = 0; i &amp;lt; schemaNames.length &amp;amp;&amp;amp; !found; i++) {&lt;br/&gt;
                        String schemaName = schemaNames&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;;&lt;br/&gt;
                        if (&quot;dbo&quot;.equals(schemaName)) {                            result = schemaName;                            found = true;                            break;                        }
&lt;p&gt;                    }&lt;br/&gt;
                }&lt;br/&gt;
            }&lt;br/&gt;
        }&lt;br/&gt;
        return result;&lt;br/&gt;
    }&lt;/p&gt;
</comment>
                            <comment id="14624049" author="kaspersor" created="Sun, 12 Jul 2015 22:32:03 +0000"  >&lt;p&gt;Hi again,&lt;/p&gt;

&lt;p&gt;A jira comment is not really an ideal place to do code review. Could you post either on our review board or as a github pull request? And from the bit I understand from the code: It would probably be good to break up the method so that we can unittest the relevant part here - I imagine a method called something like &quot;determineDefaultSchemaFromJdbcUrl(String[] schemaNames, String url)&quot; - and then we could unittest it without needing to do integration tests.&lt;/p&gt;</comment>
                            <comment id="16760149" author="kaspersor" created="Mon, 4 Feb 2019 19:44:13 +0000"  >&lt;p&gt;Fixed as of &lt;a href=&quot;https://github.com/apache/metamodel/pull/207&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/metamodel/pull/207&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 40 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2gnnz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>