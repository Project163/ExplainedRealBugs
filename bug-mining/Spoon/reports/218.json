{"url":"https://api.github.com/repos/INRIA/spoon/issues/4021","repository_url":"https://api.github.com/repos/INRIA/spoon","labels_url":"https://api.github.com/repos/INRIA/spoon/issues/4021/labels{/name}","comments_url":"https://api.github.com/repos/INRIA/spoon/issues/4021/comments","events_url":"https://api.github.com/repos/INRIA/spoon/issues/4021/events","html_url":"https://github.com/INRIA/spoon/issues/4021","id":934653899,"node_id":"MDU6SXNzdWU5MzQ2NTM4OTk=","number":4021,"title":"bug: Combining CtSuperAccess and CtUnaryOperator lead to SpoonException with Sniper","user":{"login":"gtoison","id":86775455,"node_id":"MDQ6VXNlcjg2Nzc1NDU1","avatar_url":"https://avatars.githubusercontent.com/u/86775455?v=4","gravatar_id":"","url":"https://api.github.com/users/gtoison","html_url":"https://github.com/gtoison","followers_url":"https://api.github.com/users/gtoison/followers","following_url":"https://api.github.com/users/gtoison/following{/other_user}","gists_url":"https://api.github.com/users/gtoison/gists{/gist_id}","starred_url":"https://api.github.com/users/gtoison/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gtoison/subscriptions","organizations_url":"https://api.github.com/users/gtoison/orgs","repos_url":"https://api.github.com/users/gtoison/repos","events_url":"https://api.github.com/users/gtoison/events{/privacy}","received_events_url":"https://api.github.com/users/gtoison/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":64529851,"node_id":"MDU6TGFiZWw2NDUyOTg1MQ==","url":"https://api.github.com/repos/INRIA/spoon/labels/bug","name":"bug","color":"fef2c0","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2021-07-01T09:57:13Z","updated_at":"2021-08-13T05:40:46Z","closed_at":"2021-08-13T05:40:46Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hello,\r\n\r\nI'm trying to analyze and refactor some code containing the following line (note that is has a \"super\" access and an unary \"minus\" operator) :\r\n\r\n`Date limitTradeDateBeforeIssue = super.computeSettleDate(getIssueDate(), -days);`\r\n\r\nWhen pretty printing the code with Sniper I get an exception which seems to be coming from this specific line of code:\r\n\r\n```\r\nException in thread \"main\" spoon.SpoonException: Cannot compare this: [151, 192] with other: [\"191\", \"196\"]\r\n\tat spoon.support.sniper.internal.ElementSourceFragment.compare(ElementSourceFragment.java:371)\r\n\tat spoon.support.sniper.internal.ElementSourceFragment.add(ElementSourceFragment.java:285)\r\n\tat spoon.support.sniper.internal.ElementSourceFragment.addChild(ElementSourceFragment.java:317)\r\n\tat spoon.support.sniper.internal.ElementSourceFragment.addChild(ElementSourceFragment.java:243)\r\n\tat spoon.support.sniper.internal.ElementSourceFragment.access$000(ElementSourceFragment.java:51)\r\n\tat spoon.support.sniper.internal.ElementSourceFragment$1.enter(ElementSourceFragment.java:200)\r\n\tat spoon.reflect.visitor.CtScanner.visitCtUnaryOperator(CtScanner.java:808)\r\n\tat spoon.support.reflect.code.CtUnaryOperatorImpl.accept(CtUnaryOperatorImpl.java:36)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.doScan(EarlyTerminatingScanner.java:145)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.scan(EarlyTerminatingScanner.java:121)\r\n\tat spoon.reflect.visitor.CtScanner.scan(CtScanner.java:170)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.scan(EarlyTerminatingScanner.java:106)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.scan(EarlyTerminatingScanner.java:83)\r\n\tat spoon.reflect.visitor.CtScanner.visitCtInvocation(CtScanner.java:505)\r\n\tat spoon.support.reflect.code.CtInvocationImpl.accept(CtInvocationImpl.java:46)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.doScan(EarlyTerminatingScanner.java:145)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.scan(EarlyTerminatingScanner.java:121)\r\n\tat spoon.reflect.visitor.CtScanner.scan(CtScanner.java:170)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.scan(EarlyTerminatingScanner.java:106)\r\n\tat spoon.reflect.visitor.CtScanner.visitCtLocalVariable(CtScanner.java:532)\r\n\tat spoon.support.sniper.internal.ElementSourceFragment$1.visitCtLocalVariable(ElementSourceFragment.java:181)\r\n\tat spoon.support.reflect.code.CtLocalVariableImpl.accept(CtLocalVariableImpl.java:51)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.doScan(EarlyTerminatingScanner.java:145)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.scan(EarlyTerminatingScanner.java:121)\r\n\tat spoon.reflect.visitor.CtScanner.scan(CtScanner.java:170)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.scan(EarlyTerminatingScanner.java:106)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.scan(EarlyTerminatingScanner.java:83)\r\n\tat spoon.reflect.visitor.CtScanner.visitCtBlock(CtScanner.java:300)\r\n\tat spoon.support.reflect.code.CtBlockImpl.accept(CtBlockImpl.java:58)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.doScan(EarlyTerminatingScanner.java:145)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.scan(EarlyTerminatingScanner.java:121)\r\n\tat spoon.reflect.visitor.CtScanner.scan(CtScanner.java:170)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.scan(EarlyTerminatingScanner.java:106)\r\n\tat spoon.reflect.visitor.CtScanner.visitCtMethod(CtScanner.java:566)\r\n\tat spoon.support.reflect.declaration.CtMethodImpl.accept(CtMethodImpl.java:58)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.doScan(EarlyTerminatingScanner.java:145)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.scan(EarlyTerminatingScanner.java:121)\r\n\tat spoon.reflect.visitor.CtScanner.scan(CtScanner.java:170)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.scan(EarlyTerminatingScanner.java:106)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.scan(EarlyTerminatingScanner.java:83)\r\n\tat spoon.reflect.visitor.CtScanner.visitCtClass(CtScanner.java:336)\r\n\tat spoon.support.reflect.declaration.CtClassImpl.accept(CtClassImpl.java:58)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.doScan(EarlyTerminatingScanner.java:145)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.scan(EarlyTerminatingScanner.java:121)\r\n\tat spoon.reflect.visitor.CtScanner.scan(CtScanner.java:170)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.scan(EarlyTerminatingScanner.java:106)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.scan(EarlyTerminatingScanner.java:83)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.visitCtCompilationUnit(EarlyTerminatingScanner.java:160)\r\n\tat spoon.support.reflect.declaration.CtCompilationUnitImpl.accept(CtCompilationUnitImpl.java:407)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.doScan(EarlyTerminatingScanner.java:145)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.scan(EarlyTerminatingScanner.java:121)\r\n\tat spoon.reflect.visitor.CtScanner.scan(CtScanner.java:170)\r\n\tat spoon.reflect.visitor.EarlyTerminatingScanner.scan(EarlyTerminatingScanner.java:106)\r\n\tat spoon.support.sniper.internal.ElementSourceFragment.createSourceFragmentsFrom(ElementSourceFragment.java:228)\r\n\tat spoon.support.reflect.declaration.CtCompilationUnitImpl.getOriginalSourceFragment(CtCompilationUnitImpl.java:359)\r\n\tat spoon.support.sniper.internal.IndentationDetector.detectIndentation(IndentationDetector.java:34)\r\n\tat spoon.support.sniper.SniperJavaPrettyPrinter.calculate(SniperJavaPrettyPrinter.java:150)\r\n\tat spoon.support.compiler.jdt.JDTBasedSpoonCompiler.getCompilationUnitInputStream(JDTBasedSpoonCompiler.java:683)\r\n\tat spoon.support.compiler.jdt.JDTBasedSpoonCompiler.generateProcessedSourceFilesUsingCUs(JDTBasedSpoonCompiler.java:565)\r\n\tat spoon.support.compiler.jdt.JDTBasedSpoonCompiler.generateProcessedSourceFiles(JDTBasedSpoonCompiler.java:211)\r\n\tat spoon.Launcher.prettyprint(Launcher.java:789)\r\n\tat fr.tobam.SpoonRefactor.main(SpoonRefactor.java:45)\r\n```\r\n\r\nThe input is a fairly large codebase but I was able to reproduce the exception with that input:\r\n```\r\n\r\npublic class Aaa {\r\n\r\n\tpublic static void main(String[] args) {\r\n\t\tDate limitTradeDateBeforeIssue = super.computeSettleDate(getIssueDate(), -days);\r\n\t}\r\n}\r\n```\r\n\r\nThe code I'm using to reproduce the error is:\r\n```\r\n\r\n\tpublic static void main(String[] args) throws IOException {\r\n\t\tfinal Launcher launcher = new Launcher();\r\n\r\n\t\tlauncher.addInputResource(\"./src/main/resources/source\");\r\n\t\tlauncher.setSourceOutputDirectory(\"./target/main/java/\");\r\n\r\n\t\tlauncher.getEnvironment().setAutoImports(true);\r\n\t\tlauncher.getEnvironment().setPreserveLineNumbers(true);\r\n\r\n\t\tlauncher.getEnvironment().setPrettyPrinterCreator(() -> {\r\n\t\t\treturn new SniperJavaPrettyPrinter(launcher.getEnvironment());\r\n\t\t});\r\n\r\n\t\tlauncher.buildModel();\r\n\r\n\t\tfinal Factory factory = launcher.getFactory();\r\n\t\tfinal ProcessingManager processingManager = new QueueProcessingManager(factory);\r\n\t\tprocessingManager.process(factory.Class().getAll());\r\n\r\n\t\tlauncher.prettyprint();\r\n\t}\r\n```\r\n\r\nCan you please advise if there's something I'm doing incorrectly or if that's an issue in Spoon?","closed_by":{"login":"monperrus","id":803666,"node_id":"MDQ6VXNlcjgwMzY2Ng==","avatar_url":"https://avatars.githubusercontent.com/u/803666?v=4","gravatar_id":"","url":"https://api.github.com/users/monperrus","html_url":"https://github.com/monperrus","followers_url":"https://api.github.com/users/monperrus/followers","following_url":"https://api.github.com/users/monperrus/following{/other_user}","gists_url":"https://api.github.com/users/monperrus/gists{/gist_id}","starred_url":"https://api.github.com/users/monperrus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/monperrus/subscriptions","organizations_url":"https://api.github.com/users/monperrus/orgs","repos_url":"https://api.github.com/users/monperrus/repos","events_url":"https://api.github.com/users/monperrus/events{/privacy}","received_events_url":"https://api.github.com/users/monperrus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/INRIA/spoon/issues/4021/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/INRIA/spoon/issues/4021/timeline","performed_via_github_app":null,"state_reason":"completed"}