{"url":"https://api.github.com/repos/INRIA/spoon/issues/1306","repository_url":"https://api.github.com/repos/INRIA/spoon","labels_url":"https://api.github.com/repos/INRIA/spoon/issues/1306/labels{/name}","comments_url":"https://api.github.com/repos/INRIA/spoon/issues/1306/comments","events_url":"https://api.github.com/repos/INRIA/spoon/issues/1306/events","html_url":"https://github.com/INRIA/spoon/issues/1306","id":229639204,"node_id":"MDU6SXNzdWUyMjk2MzkyMDQ=","number":1306,"title":"Exception at compilation due to a constructor with private visibility","user":{"login":"tbezierslafosse","id":6909730,"node_id":"MDQ6VXNlcjY5MDk3MzA=","avatar_url":"https://avatars.githubusercontent.com/u/6909730?v=4","gravatar_id":"","url":"https://api.github.com/users/tbezierslafosse","html_url":"https://github.com/tbezierslafosse","followers_url":"https://api.github.com/users/tbezierslafosse/followers","following_url":"https://api.github.com/users/tbezierslafosse/following{/other_user}","gists_url":"https://api.github.com/users/tbezierslafosse/gists{/gist_id}","starred_url":"https://api.github.com/users/tbezierslafosse/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbezierslafosse/subscriptions","organizations_url":"https://api.github.com/users/tbezierslafosse/orgs","repos_url":"https://api.github.com/users/tbezierslafosse/repos","events_url":"https://api.github.com/users/tbezierslafosse/events{/privacy}","received_events_url":"https://api.github.com/users/tbezierslafosse/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":64529851,"node_id":"MDU6TGFiZWw2NDUyOTg1MQ==","url":"https://api.github.com/repos/INRIA/spoon/labels/bug","name":"bug","color":"fef2c0","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":12,"created_at":"2017-05-18T11:32:52Z","updated_at":"2017-05-19T18:14:45Z","closed_at":"2017-05-19T18:14:45Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hello,\r\n\r\nI'm having an issue while instrumenting the source code of [AssertJ](https://github.com/joel-costigliola/assertj-core) with Spoon. \r\nThe instrumentation part will work, but the compilation part will fail due to the following error:\r\n```\r\nspoon.compiler.ModelBuildingException: The constructor BooleanArrays() is not visible at C:\\Users\\...\\eclipse\\BooleanArraysBaseTest.java:44\r\n\tat spoon.support.compiler.jdt.JDTBasedSpoonCompiler.report(JDTBasedSpoonCompiler.java:578)\r\n\tat spoon.support.compiler.jdt.JDTBasedSpoonCompiler.reportProblems(JDTBasedSpoonCompiler.java:559)\r\n\tat spoon.support.compiler.jdt.JDTBasedSpoonCompiler.compile(JDTBasedSpoonCompiler.java:158)\r\n\tat spoon.Launcher.run(Launcher.java:658)\r\n```\r\n\r\nI created a small Maven project with the part of the AssertJ source code that I cannot instrument/compile with Spoon. \r\n\r\nThe project architecture is the following: \r\n\r\n```\r\nTheProject\r\n|\r\n|\r\n|__ pom.xml\r\n|\r\n|\r\n\\__ src\r\n        |\r\n        |\r\n        \\__ main\r\n        :       |\r\n        :       |\r\n        :       \\__ java\r\n        :               |\r\n        :               |\r\n        :               \\__ internal\r\n        :                       |\r\n        :                       |\r\n        :                       |__ BooleanArrays.java\r\n        :                       |\r\n        :                       |\r\n        :                       |__ Failures.java\r\n        |\r\n        |\r\n        \\__ test\r\n                |\r\n                |\r\n                \\__ java\r\n                        |\r\n                        |\r\n                        \\__ internal\r\n                        :       |\r\n                        :       |\r\n                        :       |__ BooleanArraysBaseTest.java\r\n                        |\r\n                        |\r\n                        \\__ test\r\n                                |\r\n                                |\r\n                                |__ BooleanArrays.java\r\n```\r\n\r\nAccording to the Exception message, the problems comes from the class `BooleanArraysBaseTest`, which contains the following code: \r\n\r\n```\r\npublic class BooleanArraysBaseTest {\r\n\r\n  protected boolean[] actual;\r\n  protected Failures failures;\r\n  protected BooleanArrays arrays;\r\n\r\n  @Before\r\n  public void setUp() {\r\n    actual = test.BooleanArrays.arrayOf(true, false);\r\n    failures = spy(new Failures());\r\n    arrays = new BooleanArrays();\r\n    arrays.failures = failures;\r\n  }\r\n}\r\n```\r\n\r\nThe statement `arrays = new BooleanArrays();` refers to the BooleanArrays class contained in the same package ('internal'), which is a Singleton, having a constructor with the package visibility: \r\n\r\n```\r\n  @VisibleForTesting\r\n  BooleanArrays() {\r\n  }\r\n```\r\n\r\nThe other class also called `BooleanArrays`, but contained in the other package ('test') has a private constructor. \r\n \r\nMy Launcher configuration is the following:\r\n```\r\nlauncher.getEnvironment().setShouldCompile(true);\r\nlauncher.getEnvironment().setAutoImports(true);\r\nlauncher.getEnvironment().setNoClasspath(false);\t\t\r\n\r\nlauncher.getEnvironment().setSourceClasspath(/* an array with jars */);\t\t\r\n\r\nlauncher.addInputResource(/* src/main/java folder*/);\r\nlauncher.addInputResource(/* src/test/java folder */);\r\n\r\nlauncher.setBinaryOutputDirectory(/* a folder in the project spooned*/); \r\nlauncher.setSourceOutputDirectory(/* an other folder in the project spooned*/);\r\n\r\nlauncher.addProcessor(/* a processor */);\r\nlauncher.run()\r\n\r\n```\r\n\r\nIs there something wrong with my configuration ? I managed to instrument several other projects, but not this one.\r\nTell me if you need any other information.\r\n\r\nAn archive containing this project is available [here](http://ovh.to/tq4oPt9).\r\n\r\nThank you,\r\n\r\nThibault\r\n","closed_by":{"login":"monperrus","id":803666,"node_id":"MDQ6VXNlcjgwMzY2Ng==","avatar_url":"https://avatars.githubusercontent.com/u/803666?v=4","gravatar_id":"","url":"https://api.github.com/users/monperrus","html_url":"https://github.com/monperrus","followers_url":"https://api.github.com/users/monperrus/followers","following_url":"https://api.github.com/users/monperrus/following{/other_user}","gists_url":"https://api.github.com/users/monperrus/gists{/gist_id}","starred_url":"https://api.github.com/users/monperrus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/monperrus/subscriptions","organizations_url":"https://api.github.com/users/monperrus/orgs","repos_url":"https://api.github.com/users/monperrus/repos","events_url":"https://api.github.com/users/monperrus/events{/privacy}","received_events_url":"https://api.github.com/users/monperrus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/INRIA/spoon/issues/1306/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/INRIA/spoon/issues/1306/timeline","performed_via_github_app":null,"state_reason":"completed"}