diff --git a/src/main/java/spoon/Launcher.java b/src/main/java/spoon/Launcher.java
index 592602d70..9587fb365 100644
--- a/src/main/java/spoon/Launcher.java
+++ b/src/main/java/spoon/Launcher.java
@@ -48,6 +48,7 @@ import java.io.FileNotFoundException;
 import java.io.IOException;
 import java.lang.invoke.MethodHandles;
 import java.nio.charset.Charset;
+import java.nio.file.Path;
 import java.util.ArrayList;
 import java.util.Arrays;
 import java.util.Collection;
@@ -807,16 +808,18 @@ public class Launcher implements SpoonAPI {
 			}
 		}
 
+		final Path outputPath = getEnvironment().getDefaultFileGenerator().getOutputDirectory().toPath();
 		if (!getEnvironment().getOutputType().equals(OutputType.NO_OUTPUT) && getEnvironment().isCopyResources()) {
 			for (File dirInputSource : modelBuilder.getInputSources()) {
 				if (dirInputSource.isDirectory()) {
+					final Path dirInputSourceAsPath = dirInputSource.toPath();
 					final Collection<?> resources = FileUtils.listFiles(dirInputSource, RESOURCES_FILE_FILTER, ALL_DIR_FILTER);
 					for (Object resource : resources) {
-						final String resourceParentPath = ((File) resource).getParent();
-						final String packageDir = resourceParentPath.substring(dirInputSource.getPath().length());
-						final String targetDirectory = getEnvironment().getDefaultFileGenerator().getOutputDirectory() + packageDir;
+						final Path resourcePath = ((File) resource).toPath();
+						final Path relativePath = dirInputSourceAsPath.relativize(resourcePath);
+						final Path targetPath = outputPath.resolve(relativePath).getParent();
 						try {
-							FileUtils.copyFileToDirectory((File) resource, new File(targetDirectory));
+							FileUtils.copyFileToDirectory((File) resource, targetPath.toFile());
 						} catch (IOException e) {
 							throw new SpoonException(e);
 						}
diff --git a/src/test/java/spoon/LauncherTest.java b/src/test/java/spoon/LauncherTest.java
index 4f5217cd9..7c36843ed 100644
--- a/src/test/java/spoon/LauncherTest.java
+++ b/src/test/java/spoon/LauncherTest.java
@@ -22,6 +22,7 @@ import spoon.compiler.Environment;
 import spoon.reflect.CtModel;
 import spoon.reflect.visitor.DefaultJavaPrettyPrinter;
 import spoon.support.JavaOutputProcessor;
+import spoon.support.compiler.VirtualFile;
 
 import java.io.File;
 import java.nio.file.Files;
@@ -33,6 +34,7 @@ import static org.junit.Assert.assertEquals;
 import static org.junit.Assert.assertFalse;
 import static org.junit.Assert.assertNotNull;
 import static org.junit.Assert.assertTrue;
+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;
 
 public class LauncherTest {
 
@@ -119,4 +121,22 @@ public class LauncherTest {
 
 		assertEquals(2, model.getAllTypes().size());
 	}
+	
+	@Test
+	public void testPrettyPrintWithVirtualFileInput() throws Exception {
+		// contract: prettyPrint() should not throw an exception when used with input from VirtualFile
+		String code = "package foo;\nclass Bar {}\n";
+
+		Launcher launcher = new Launcher();
+		launcher.addInputResource(new VirtualFile(code));
+		launcher.getEnvironment().setNoClasspath(true);
+		launcher.getEnvironment().setAutoImports(true);
+		launcher.getEnvironment().setPreserveLineNumbers(true);
+
+		File tmpDir = Files.createTempDirectory("spoonTestPrettyPrintWithVirtualFileInput").toFile();
+		tmpDir.deleteOnExit();
+		launcher.setSourceOutputDirectory(tmpDir);
+		
+		assertDoesNotThrow(() -> launcher.prettyprint());
+	}
 }
