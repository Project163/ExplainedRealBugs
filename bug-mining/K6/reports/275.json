{"url":"https://api.github.com/repos/grafana/k6/issues/4566","repository_url":"https://api.github.com/repos/grafana/k6","labels_url":"https://api.github.com/repos/grafana/k6/issues/4566/labels{/name}","comments_url":"https://api.github.com/repos/grafana/k6/issues/4566/comments","events_url":"https://api.github.com/repos/grafana/k6/issues/4566/events","html_url":"https://github.com/grafana/k6/issues/4566","id":2863596044,"node_id":"I_kwDOAz4Wr86qrwIM","number":4566,"title":"concurrent map iteration and map write: `FrameSession.attachWorkerToTarget`","user":{"login":"inancgumus","id":621232,"node_id":"MDQ6VXNlcjYyMTIzMg==","avatar_url":"https://avatars.githubusercontent.com/u/621232?v=4","gravatar_id":"","url":"https://api.github.com/users/inancgumus","html_url":"https://github.com/inancgumus","followers_url":"https://api.github.com/users/inancgumus/followers","following_url":"https://api.github.com/users/inancgumus/following{/other_user}","gists_url":"https://api.github.com/users/inancgumus/gists{/gist_id}","starred_url":"https://api.github.com/users/inancgumus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/inancgumus/subscriptions","organizations_url":"https://api.github.com/users/inancgumus/orgs","repos_url":"https://api.github.com/users/inancgumus/repos","events_url":"https://api.github.com/users/inancgumus/events{/privacy}","received_events_url":"https://api.github.com/users/inancgumus/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":6004839752,"node_id":"LA_kwDOAz4Wr88AAAABZeqVSA","url":"https://api.github.com/repos/grafana/k6/labels/area:%20browser","name":"area: browser","color":"FFCD46","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2025-02-19T14:54:03Z","updated_at":"2025-04-25T07:18:47Z","closed_at":"2025-04-25T07:18:47Z","author_association":"CONTRIBUTOR","type":{"id":738484,"node_id":"IT_kwDOAG3Mbc4AC0S0","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T10:33:25Z","updated_at":"2024-07-26T10:14:36Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"parent_issue_url":"https://api.github.com/repos/grafana/k6/issues/4126","issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Summary\n\n<details>\n <summary>Test run ID: 3459317 (Browser version: 1.8.5)</summary>\n\n```\nfatal error: concurrent map writes\n\ngoroutine 2289755 [running]:\ngithub.com/grafana/xk6-browser/common.(*FrameSession).attachWorkerToTarget(0xc0008a1bc0, 0xc0007d2bd0, {0xc001c789c0, 0x20})\ngithub.com/grafana/xk6-browser@v1.9.1/common/frame_session.go:1056 +0x19b\ngithub.com/grafana/xk6-browser/common.(*FrameSession).onAttachedToTarget(0xc0008a1bc0, 0xc00901c220)\ngithub.com/grafana/xk6-browser@v1.9.1/common/frame_session.go:969 +0x2a6\ngithub.com/grafana/xk6-browser/common.(*FrameSession).initEvents.func1()\ngithub.com/grafana/xk6-browser@v1.9.1/common/frame_session.go:303 +0x233\ncreated by github.com/grafana/xk6-browser/common.(*FrameSession).initEvents in goroutine 2278207\ngithub.com/grafana/xk6-browser@v1.9.1/common/frame_session.go:239 +0x19b\n\ngoroutine 1 [chan receive, 3 minutes]:\ngo.k6.io/k6/execution.(*Scheduler).Run(0xc000190f80, {0x1f91908, 0xc0002e01e0}, {0x1f918d0, 0xc0003d8360}, 0xc000270850)\ngo.k6.io/k6/execution/scheduler.go:508 +0xcb4\ngo.k6.io/k6/cmd.(*cmdRun).run(0xc0003c9bc0, 0xc000330588, {0xc000227508, 0x1, 0x2d})\ngo.k6.io/k6/cmd/run.go:397 +0x1545\ngithub.com/spf13/cobra.(*Command).execute(0xc000330588, {0xc000227208, 0x2d, 0x2f})\ngithub.com/spf13/cobra@v1.4.0/command.go:856 +0x68a\ngithub.com/spf13/cobra.(*Command).ExecuteC(0xc00026d608)\ngithub.com/spf13/cobra@v1.4.0/command.go:974 +0x38d\ngithub.com/spf13/cobra.(*Command).Execute(...)\ngithub.com/spf13/cobra@v1.4.0/command.go:902\ngo.k6.io/k6/cmd.(*rootCommand).execute(0xc000032810)\ngo.k6.io/k6/cmd/root.go:108 +0xfb\ngo.k6.io/k6/cmd.Execute()\ngo.k6.io/k6/cmd/root.go:130 +0x2f\nmain.main()\ngo.k6.io/k6/main.go:9 +0xf\n\ngoroutine 21 [select]:\ngo.k6.io/k6/log.(*lokiHook).Listen(0xc000323e10, {0x1f91908, 0xc0002e0190})\ngo.k6.io/k6/log/loki.go:220 +0x3dc\ngo.k6.io/k6/cmd.(*rootCommand).setLoggerHook.func1()\ngo.k6.io/k6/cmd/root.go:287 +0x2d\ncreated by go.k6.io/k6/cmd.(*rootCommand).setLoggerHook in goroutine 1\ngo.k6.io/k6/cmd/root.go:286 +0xb0\n\ngoroutine 22 [select, 3 minutes]:\nio.(*pipe).read(0xc000230d20, {0xc000476000, 0x10000, 0xc0000b8fc0?})\nio/pipe.go:57 +0xa5\nio.(*PipeReader).Read(0xc00043ae90?, {0xc000476000?, 0x4?, 0x10000?})\nio/pipe.go:134 +0x1a\nbufio.(*Scanner).Scan(0xc000457f28)\nbufio/scan.go:219 +0x81e\ngithub.com/sirupsen/logrus.(*Entry).writerScanner(0xc0002ccd90, 0xc000230d20, 0xc0001224c0)\ngithub.com/sirupsen/logrus@v1.9.3/writer.go:86 +0x11d\ncreated by github.com/sirupsen/logrus.(*Entry).WriterLevel in goroutine 1\ngithub.com/sirupsen/logrus@v1.9.3/writer.go:57 +0x31f\n\ngoroutine 23 [chan receive, 3 minutes]:\ngo.k6.io/k6/cmd.(*rootCommand).setupLoggers.func2()\ngo.k6.io/k6/cmd/root.go:276 +0x34\ncreated by go.k6.io/k6/cmd.(*rootCommand).setupLoggers in goroutine 1\ngo.k6.io/k6/cmd/root.go:275 +0x637\n\ngoroutine 7 [chan receive]:\ngo.k6.io/k6/log.(*lokiHook).Listen.func2()\ngo.k6.io/k6/log/loki.go:168 +0x10f\ncreated by go.k6.io/k6/log.(*lokiHook).Listen in goroutine 21\ngo.k6.io/k6/log/loki.go:165 +0x2f9\n\ngoroutine 68 [chan receive, 3 minutes]:\ngithub.com/grafana/xk6-browser/browser.(*browserRegistry).handleExitEvent(0xc0000acd20, 0x422d2d2d2d2d0a0a?, 0x524543204e494745?)\ngithub.com/grafana/xk6-browser@v1.9.1/browser/registry.go:333 +0x45\ncreated by github.com/grafana/xk6-browser/browser.newBrowserRegistry in goroutine 14\ngithub.com/grafana/xk6-browser@v1.9.1/browser/registry.go:250 +0x2b2\n\ngoroutine 25 [chan receive, 3 minutes]:\ngithub.com/grafana/xk6-browser/browser.(*browserRegistry).handleExitEvent(0xc000140780, 0x0?, 0x0?)\ngithub.com/grafana/xk6-browser@v1.9.1/browser/registry.go:333 +0x45\ncreated by github.com/grafana/xk6-browser/browser.newBrowserRegistry in goroutine 1\ngithub.com/grafana/xk6-browser@v1.9.1/browser/registry.go:250 +0x2b2\n\ngoroutine 26 [chan receive, 3 minutes]:\ngithub.com/grafana/xk6-browser/browser.(*browserRegistry).handleIterEvents(0xc000140780, {0x1f91718, 0x2fc9fa0}, 0xc00026bf10, 0xc000296330)\ngithub.com/grafana/xk6-browser@v1.9.1/browser/registry.go:264 +0x85\ncreated by github.com/grafana/xk6-browser/browser.newBrowserRegistry in goroutine 1\ngithub.com/grafana/xk6-browser@v1.9.1/browser/registry.go:251 +0x336\n\ngoroutine 27 [select]:\ngo.opentelemetry.io/otel/sdk/trace.(*batchSpanProcessor).processQueue(0xc0001c9ea0)\ngo.opentelemetry.io/otel/sdk@v1.29.0/trace/batch_span_processor.go:301 +0x114\ngo.opentelemetry.io/otel/sdk/trace.NewBatchSpanProcessor.func1()\ngo.opentelemetry.io/otel/sdk@v1.29.0/trace/batch_span_processor.go:117 +0x4e\ncreated by go.opentelemetry.io/otel/sdk/trace.NewBatchSpanProcessor in goroutine 1\ngo.opentelemetry.io/otel/sdk@v1.29.0/trace/batch_span_processor.go:115 +0x2e5\n\ngoroutine 69 [chan receive]:\ngithub.com/grafana/xk6-browser/browser.(*browserRegistry).handleIterEvents(0xc0000acd20, {0x1f91718, 0x2fc9fa0}, 0xc00029c5b0, 0xc0006351d0)\ngithub.com/grafana/xk6-browser@v1.9.1/browser/registry.go:264 +0x85\ncreated by github.com/grafana/xk6-browser/browser.newBrowserRegistry in goroutine 14\ngithub.com/grafana/xk6-browser@v1.9.1/browser/registry.go:251 +0x336\n\ngoroutine 212 [chan receive, 3 minutes]:\ngo.k6.io/k6/lib/executor.trackProgress({0x1f91908, 0xc000a9e320}, {0x1f918d0, 0xc000a\n```\n\n</details>\n\n### k6 version\n\nv0.57","closed_by":{"login":"mstoykov","id":312246,"node_id":"MDQ6VXNlcjMxMjI0Ng==","avatar_url":"https://avatars.githubusercontent.com/u/312246?v=4","gravatar_id":"","url":"https://api.github.com/users/mstoykov","html_url":"https://github.com/mstoykov","followers_url":"https://api.github.com/users/mstoykov/followers","following_url":"https://api.github.com/users/mstoykov/following{/other_user}","gists_url":"https://api.github.com/users/mstoykov/gists{/gist_id}","starred_url":"https://api.github.com/users/mstoykov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mstoykov/subscriptions","organizations_url":"https://api.github.com/users/mstoykov/orgs","repos_url":"https://api.github.com/users/mstoykov/repos","events_url":"https://api.github.com/users/mstoykov/events{/privacy}","received_events_url":"https://api.github.com/users/mstoykov/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/grafana/k6/issues/4566/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/grafana/k6/issues/4566/timeline","performed_via_github_app":null,"state_reason":"completed"}