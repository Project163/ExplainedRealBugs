{"url":"https://api.github.com/repos/grafana/k6/issues/220","repository_url":"https://api.github.com/repos/grafana/k6","labels_url":"https://api.github.com/repos/grafana/k6/issues/220/labels{/name}","comments_url":"https://api.github.com/repos/grafana/k6/issues/220/comments","events_url":"https://api.github.com/repos/grafana/k6/issues/220/events","html_url":"https://github.com/grafana/k6/issues/220","id":228726576,"node_id":"MDU6SXNzdWUyMjg3MjY1NzY=","number":220,"title":"Making request with proxy","user":{"login":"tommysitu","id":7671879,"node_id":"MDQ6VXNlcjc2NzE4Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/7671879?v=4","gravatar_id":"","url":"https://api.github.com/users/tommysitu","html_url":"https://github.com/tommysitu","followers_url":"https://api.github.com/users/tommysitu/followers","following_url":"https://api.github.com/users/tommysitu/following{/other_user}","gists_url":"https://api.github.com/users/tommysitu/gists{/gist_id}","starred_url":"https://api.github.com/users/tommysitu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tommysitu/subscriptions","organizations_url":"https://api.github.com/users/tommysitu/orgs","repos_url":"https://api.github.com/users/tommysitu/repos","events_url":"https://api.github.com/users/tommysitu/events{/privacy}","received_events_url":"https://api.github.com/users/tommysitu/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-05-15T14:06:40Z","updated_at":"2020-05-25T15:47:45Z","closed_at":"2017-05-18T16:43:53Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I would like to use K6 to fire HTTPS requests via a proxy server. \r\nThis is what I've tried and didn't work: \r\n\r\n```\r\n$ export HTTP_PROXY=junior-tennis-tommysitu.hoverfly.io:8500\r\n$ export HTTPS_PROXY=junior-tennis-tommysitu.hoverfly.io:8500\r\n$ k6 run --insecure-skip-tls-verify hfc.js\r\n\r\n          /\\      |‾‾|  /‾‾/  /‾/\r\n     /\\  /  \\     |  |_/  /  / /\r\n    /  \\/    \\    |      |  /  ‾‾\\\r\n   /          \\   |  |‾\\  \\ | (_) |\r\n  / __________ \\  |__|  \\__\\ \\___/  Welcome to k6 v0.14.0!\r\n\r\n  execution: local\r\n     output: -\r\n     script: /Users/tommysitu/playground/k6/hfc.js (js)\r\n\r\n   duration: 0s, iterations: 1\r\n        vus: 1, max: 1\r\n\r\n    web ui: http://127.0.0.1:6565/\r\n\r\nERRO[0000] GoError: Get https://www.my-test.com/api/bookings/1: dial tcp 5.22.149.135:443: getsockopt: connection refused\r\n\tat native\r\n\tat /Users/tommysitu/playground/k6/hfc.js:8:77(13)\r\n\r\n      done [==========================================================]      100ms / 100ms\r\n\r\n    data_received.........: 0 B\r\n    data_sent.............: 0 B\r\n    errors................: 1\r\n    http_req_blocked......: avg=175.2ms max=175.2ms med=175.2ms min=175.2ms p90=175.2ms p95=175.2ms\r\n    http_req_connecting...: avg=50.6ms max=50.6ms med=50.6ms min=50.6ms p90=50.6ms p95=50.6ms\r\n    http_req_duration.....: avg=0s max=0s med=0s min=0s p90=0s p95=0s\r\n    http_req_receiving....: avg=0s max=0s med=0s min=0s p90=0s p95=0s\r\n    http_req_sending......: avg=0s max=0s med=0s min=0s p90=0s p95=0s\r\n    http_req_waiting......: avg=0s max=0s med=0s min=0s p90=0s p95=0s\r\n    http_reqs.............: 1\r\n    iterations............: 1\r\n    vus...................: 1\r\n    vus_max...............: 1\r\n```\r\n\r\nThe js file looks like this:\r\n```\r\nimport http from \"k6/http\";\r\n\r\nexport default function() {\r\n\r\nlet params = {\r\n\t\theaders: { \"Proxy-Authorization\": \"Bearer sometoken\" }\r\n\t};\r\n  let result =  http.get(\"https://www.my-test.com/api/bookings/1\", params);\r\n};\r\n```\r\n\r\nTried adding the protocol as well: \r\n```\r\n$ export HTTP_PROXY=http://junior-tennis-tommysitu.hoverfly.io:8500\r\n$ export HTTPS_PROXY=http://junior-tennis-tommysitu.hoverfly.io:8500\r\n```\r\nAlso tried setting proxy in system preference. Nothing is working.\r\n\r\nUsing `curl` is fine: \r\n```\r\n$ curl --header \"Proxy-Authorization: Bearer $HFC_AUTH_TOKEN\" --proxy junior-tennis-tommysitu.hoverfly.io:8500 https://www.my-test.com/api/bookings/1 --insecure | jq\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n100   148    0   148    0     0    252      0 --:--:-- --:--:-- --:--:--   252\r\n{\r\n  \"bookingId\": \"1\",\r\n  \"origin\": \"London\",\r\n  \"destination\": \"New York\",\r\n  \"time\": \"2011-09-01T12:30\",\r\n  \"_links\": {\r\n    \"self\": {\r\n      \"href\": \"http://localhost/api/bookings/1\"\r\n    }\r\n  }\r\n}\r\n```","closed_by":{"login":"liclac","id":428026,"node_id":"MDQ6VXNlcjQyODAyNg==","avatar_url":"https://avatars.githubusercontent.com/u/428026?v=4","gravatar_id":"","url":"https://api.github.com/users/liclac","html_url":"https://github.com/liclac","followers_url":"https://api.github.com/users/liclac/followers","following_url":"https://api.github.com/users/liclac/following{/other_user}","gists_url":"https://api.github.com/users/liclac/gists{/gist_id}","starred_url":"https://api.github.com/users/liclac/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liclac/subscriptions","organizations_url":"https://api.github.com/users/liclac/orgs","repos_url":"https://api.github.com/users/liclac/repos","events_url":"https://api.github.com/users/liclac/events{/privacy}","received_events_url":"https://api.github.com/users/liclac/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/grafana/k6/issues/220/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/grafana/k6/issues/220/timeline","performed_via_github_app":null,"state_reason":"completed"}