{"url":"https://api.github.com/repos/grafana/k6/issues/2766","repository_url":"https://api.github.com/repos/grafana/k6","labels_url":"https://api.github.com/repos/grafana/k6/issues/2766/labels{/name}","comments_url":"https://api.github.com/repos/grafana/k6/issues/2766/comments","events_url":"https://api.github.com/repos/grafana/k6/issues/2766/events","html_url":"https://github.com/grafana/k6/issues/2766","id":1443876569,"node_id":"I_kwDOAz4Wr85WD87Z","number":2766,"title":"JS API for user-specified high-cardinality metrics metadata","user":{"login":"na--","id":3336773,"node_id":"MDQ6VXNlcjMzMzY3NzM=","avatar_url":"https://avatars.githubusercontent.com/u/3336773?v=4","gravatar_id":"","url":"https://api.github.com/users/na--","html_url":"https://github.com/na--","followers_url":"https://api.github.com/users/na--/followers","following_url":"https://api.github.com/users/na--/following{/other_user}","gists_url":"https://api.github.com/users/na--/gists{/gist_id}","starred_url":"https://api.github.com/users/na--/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/na--/subscriptions","organizations_url":"https://api.github.com/users/na--/orgs","repos_url":"https://api.github.com/users/na--/repos","events_url":"https://api.github.com/users/na--/events{/privacy}","received_events_url":"https://api.github.com/users/na--/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":869282130,"node_id":"MDU6TGFiZWw4NjkyODIxMzA=","url":"https://api.github.com/repos/grafana/k6/labels/feature","name":"feature","color":"5319E7","default":false,"description":""},{"id":1079102926,"node_id":"MDU6TGFiZWwxMDc5MTAyOTI2","url":"https://api.github.com/repos/grafana/k6/labels/evaluation%20needed","name":"evaluation needed","color":"006B75","default":false,"description":"proposal needs to be validated or tested before fully implementing it in k6"}],"state":"closed","locked":false,"assignee":null,"assignees":[{"login":"mstoykov","id":312246,"node_id":"MDQ6VXNlcjMxMjI0Ng==","avatar_url":"https://avatars.githubusercontent.com/u/312246?v=4","gravatar_id":"","url":"https://api.github.com/users/mstoykov","html_url":"https://github.com/mstoykov","followers_url":"https://api.github.com/users/mstoykov/followers","following_url":"https://api.github.com/users/mstoykov/following{/other_user}","gists_url":"https://api.github.com/users/mstoykov/gists{/gist_id}","starred_url":"https://api.github.com/users/mstoykov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mstoykov/subscriptions","organizations_url":"https://api.github.com/users/mstoykov/orgs","repos_url":"https://api.github.com/users/mstoykov/repos","events_url":"https://api.github.com/users/mstoykov/events{/privacy}","received_events_url":"https://api.github.com/users/mstoykov/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/grafana/k6/milestones/33","html_url":"https://github.com/grafana/k6/milestone/33","labels_url":"https://api.github.com/repos/grafana/k6/milestones/33/labels","id":9066820,"node_id":"MI_kwDOAz4Wr84AillE","number":33,"title":"v0.45.0","description":"","creator":{"login":"na--","id":3336773,"node_id":"MDQ6VXNlcjMzMzY3NzM=","avatar_url":"https://avatars.githubusercontent.com/u/3336773?v=4","gravatar_id":"","url":"https://api.github.com/users/na--","html_url":"https://github.com/na--","followers_url":"https://api.github.com/users/na--/followers","following_url":"https://api.github.com/users/na--/following{/other_user}","gists_url":"https://api.github.com/users/na--/gists{/gist_id}","starred_url":"https://api.github.com/users/na--/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/na--/subscriptions","organizations_url":"https://api.github.com/users/na--/orgs","repos_url":"https://api.github.com/users/na--/repos","events_url":"https://api.github.com/users/na--/events{/privacy}","received_events_url":"https://api.github.com/users/na--/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":55,"state":"closed","created_at":"2023-02-20T12:57:10Z","updated_at":"2023-06-19T11:52:39Z","due_on":"2023-06-19T07:00:00Z","closed_at":"2023-06-19T11:52:39Z"},"comments":1,"created_at":"2022-11-10T13:05:38Z","updated_at":"2023-05-09T15:03:23Z","closed_at":"2023-05-09T15:03:23Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Feature Description\r\n\r\nk6 v0.41.0 added a `Metadata` property for storing high-cardinality metadata to all `metric.Sample` values that is not part of the `Sample`'s `TimeSeries`: https://github.com/grafana/k6/blob/e14f14d416b0af4e495e6f565a2a9787a73ade54/metrics/sample.go#L19-L33\r\n\r\nHowever, we decided (https://github.com/grafana/k6/issues/2584#issuecomment-1269775631) to not merge the originally proposed JS APIs from https://github.com/grafana/k6/pull/2654 that allowed users to set whatever metadata values they wanted from their scripts, since they presented a somewhat confusing UX. The `Sample.Metadata` property is currently only accessible from Go code, either the built-in k6 modules and outputs or from [xk6](https://github.com/grafana/xk6) extensions.\r\n\r\nI am adding this issue as a placeholder, so it can be referenced by other issues. We still haven't reached a consensus how (and even if) the `Metadata` should be made accessible from user scripts. \r\n\r\nA major use case for this feature is distributed tracing (https://github.com/grafana/k6/issues/2128), though it doesn't necessarily need JS code to be able to access and set custom metrics metadata. If anyone has another use cases that will benefit from this feature, please share them here.\r\n\r\n### Suggested Solution (optional)\r\n\r\nNo consensus and firm proposals yet. There are various ideas with different pros and cons, and this deserves a broader discussion. Some of them:\r\n- at this point the original API with non-indexed tags (https://github.com/grafana/k6/pull/2654) is probably out of the running, though it still has its benefits\r\n- a promising idea is to have a `metrics.withMetadata(metaObj, callback)` API similar to `group()`, though that has its own problems with async APIs (https://github.com/grafana/k6/issues/2728)\r\n- a `metadata` property in all of the calls where we currently support `tags` has the problem that it's yet another custom thing that needs to be implemented in every protocol, it is ambiguous (is the \"metadata\" property about the call and not its metrics?) and it conflicts with the already existing `metadata` property in gRPC calls.\r\n\r\nWe are discussing this internally, but if someone has API proposals or ideas, please share them here.\r\n\r\n### Already existing or connected issues / PRs (optional)\r\n\r\n- https://github.com/grafana/k6/issues/2584\r\n- https://github.com/grafana/k6/issues/2580\r\n- https://github.com/grafana/k6/pull/2726\r\n- https://github.com/grafana/k6/issues/2128\r\n- https://github.com/grafana/k6/issues/2762","closed_by":{"login":"mstoykov","id":312246,"node_id":"MDQ6VXNlcjMxMjI0Ng==","avatar_url":"https://avatars.githubusercontent.com/u/312246?v=4","gravatar_id":"","url":"https://api.github.com/users/mstoykov","html_url":"https://github.com/mstoykov","followers_url":"https://api.github.com/users/mstoykov/followers","following_url":"https://api.github.com/users/mstoykov/following{/other_user}","gists_url":"https://api.github.com/users/mstoykov/gists{/gist_id}","starred_url":"https://api.github.com/users/mstoykov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mstoykov/subscriptions","organizations_url":"https://api.github.com/users/mstoykov/orgs","repos_url":"https://api.github.com/users/mstoykov/repos","events_url":"https://api.github.com/users/mstoykov/events{/privacy}","received_events_url":"https://api.github.com/users/mstoykov/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/grafana/k6/issues/2766/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/grafana/k6/issues/2766/timeline","performed_via_github_app":null,"state_reason":"completed"}