{"url":"https://api.github.com/repos/grafana/k6/issues/1116","repository_url":"https://api.github.com/repos/grafana/k6","labels_url":"https://api.github.com/repos/grafana/k6/issues/1116/labels{/name}","comments_url":"https://api.github.com/repos/grafana/k6/issues/1116/comments","events_url":"https://api.github.com/repos/grafana/k6/issues/1116/events","html_url":"https://github.com/grafana/k6/issues/1116","id":481476208,"node_id":"MDU6SXNzdWU0ODE0NzYyMDg=","number":1116,"title":"Panic in websocket handling","user":{"login":"na--","id":3336773,"node_id":"MDQ6VXNlcjMzMzY3NzM=","avatar_url":"https://avatars.githubusercontent.com/u/3336773?v=4","gravatar_id":"","url":"https://api.github.com/users/na--","html_url":"https://github.com/na--","followers_url":"https://api.github.com/users/na--/followers","following_url":"https://api.github.com/users/na--/following{/other_user}","gists_url":"https://api.github.com/users/na--/gists{/gist_id}","starred_url":"https://api.github.com/users/na--/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/na--/subscriptions","organizations_url":"https://api.github.com/users/na--/orgs","repos_url":"https://api.github.com/users/na--/repos","events_url":"https://api.github.com/users/na--/events{/privacy}","received_events_url":"https://api.github.com/users/na--/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":345191758,"node_id":"MDU6TGFiZWwzNDUxOTE3NTg=","url":"https://api.github.com/repos/grafana/k6/labels/bug","name":"bug","color":"b60205","default":true,"description":""},{"id":874927263,"node_id":"MDU6TGFiZWw4NzQ5MjcyNjM=","url":"https://api.github.com/repos/grafana/k6/labels/high%20prio","name":"high prio","color":"D93F0B","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"imiric","id":1009277,"node_id":"MDQ6VXNlcjEwMDkyNzc=","avatar_url":"https://avatars.githubusercontent.com/u/1009277?v=4","gravatar_id":"","url":"https://api.github.com/users/imiric","html_url":"https://github.com/imiric","followers_url":"https://api.github.com/users/imiric/followers","following_url":"https://api.github.com/users/imiric/following{/other_user}","gists_url":"https://api.github.com/users/imiric/gists{/gist_id}","starred_url":"https://api.github.com/users/imiric/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imiric/subscriptions","organizations_url":"https://api.github.com/users/imiric/orgs","repos_url":"https://api.github.com/users/imiric/repos","events_url":"https://api.github.com/users/imiric/events{/privacy}","received_events_url":"https://api.github.com/users/imiric/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"imiric","id":1009277,"node_id":"MDQ6VXNlcjEwMDkyNzc=","avatar_url":"https://avatars.githubusercontent.com/u/1009277?v=4","gravatar_id":"","url":"https://api.github.com/users/imiric","html_url":"https://github.com/imiric","followers_url":"https://api.github.com/users/imiric/followers","following_url":"https://api.github.com/users/imiric/following{/other_user}","gists_url":"https://api.github.com/users/imiric/gists{/gist_id}","starred_url":"https://api.github.com/users/imiric/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imiric/subscriptions","organizations_url":"https://api.github.com/users/imiric/orgs","repos_url":"https://api.github.com/users/imiric/repos","events_url":"https://api.github.com/users/imiric/events{/privacy}","received_events_url":"https://api.github.com/users/imiric/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/grafana/k6/milestones/7","html_url":"https://github.com/grafana/k6/milestone/7","labels_url":"https://api.github.com/repos/grafana/k6/milestones/7/labels","id":4536026,"node_id":"MDk6TWlsZXN0b25lNDUzNjAyNg==","number":7,"title":"v0.26.0","description":"","creator":{"login":"na--","id":3336773,"node_id":"MDQ6VXNlcjMzMzY3NzM=","avatar_url":"https://avatars.githubusercontent.com/u/3336773?v=4","gravatar_id":"","url":"https://api.github.com/users/na--","html_url":"https://github.com/na--","followers_url":"https://api.github.com/users/na--/followers","following_url":"https://api.github.com/users/na--/following{/other_user}","gists_url":"https://api.github.com/users/na--/gists{/gist_id}","starred_url":"https://api.github.com/users/na--/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/na--/subscriptions","organizations_url":"https://api.github.com/users/na--/orgs","repos_url":"https://api.github.com/users/na--/repos","events_url":"https://api.github.com/users/na--/events{/privacy}","received_events_url":"https://api.github.com/users/na--/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":109,"state":"closed","created_at":"2019-07-31T08:43:47Z","updated_at":"2022-10-03T09:45:50Z","due_on":null,"closed_at":"2020-04-22T12:31:51Z"},"comments":2,"created_at":"2019-08-16T07:13:38Z","updated_at":"2019-08-29T08:27:46Z","closed_at":"2019-08-29T08:27:46Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"We saw this panic in a very complicated websocket script:\r\n```\r\n*errors.errorString: panic: runtime error: invalid memory address or nil pointer dereference [recovered]\r\n\tpanic: Panic at 28: runtime error: invalid memory address or nil pointer dereference [recovered]\r\n\tpanic: Panic at 28: runtime error: invalid memory address or nil pointer dereference [recovered]\r\n\tpanic: Panic at 106: Panic at 28: runtime error: invalid memory address or nil pointer dereference [recovered]\r\n\tpanic: Panic at 35: Panic at 106: Panic at 28: runtime error: invalid memory address or nil pointer dereference [recovered]\r\n\tpanic: Panic at 35: Panic at 106: Panic at 28: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x10 pc=0xc21917]\r\n\r\ngoroutine 472 [running]:\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.AssertFunction.func1.1(0xc08e027d68)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/runtime.go:1407 +0x9b\r\npanic(0xd3ab80, 0xc085e41490)\r\n\t/usr/lib/go/src/runtime/panic.go:522 +0x1b5\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*vm).try.func1(0xc00f314750, 0x0, 0xc08e027c70, 0x0, 0x0, 0x0, 0xc08e027cc8)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:364 +0x48e\r\npanic(0xd3ab80, 0xc085dd0d40)\r\n\t/usr/lib/go/src/runtime/panic.go:522 +0x1b5\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*vm).try.func1(0xc00f314750, 0x1, 0xc08e027958, 0xa, 0x0, 0x0, 0xc08e0279b0)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:364 +0x48e\r\npanic(0xd3ab80, 0xc085dd0d30)\r\n\t/usr/lib/go/src/runtime/panic.go:522 +0x1b5\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.AssertFunction.func1.1(0xc08e026cf8)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/runtime.go:1407 +0x9b\r\npanic(0xd3ab80, 0xc085dd0d30)\r\n\t/usr/lib/go/src/runtime/panic.go:522 +0x1b5\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*vm).try.func1(0xc00f314750, 0x3, 0xc08e026c00, 0x11, 0x0, 0x0, 0xc08e026c58)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:364 +0x48e\r\npanic(0xd4f720, 0x19d2580)\r\n\t/usr/lib/go/src/runtime/panic.go:522 +0x1b5\r\ngithub.com/loadimpact/k6/vendor/github.com/gorilla/websocket.(*Conn).WriteMessage(0x0, 0x1, 0xc0428e4d80, 0xba, 0xc0, 0xc0, 0x18)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/gorilla/websocket/conn.go:732 +0x37\r\ngithub.com/loadimpact/k6/js/modules/k6/ws.(*Socket).Send(0xc084e49b80, 0xc0428e4cc0, 0xba)\r\n\t/home/go/src/github.com/loadimpact/k6/js/modules/k6/ws/ws.go:349 +0xde\r\nreflect.callMethod(0xc081abde40, 0xc08e026508, 0xc08e0264f0)\r\n\t/usr/lib/go/src/reflect/value.go:690 +0x182\r\nreflect.methodValueCall(0xc0428e4cc0, 0xba, 0xc07759a750, 0xc085dd0d20, 0xc08e026748, 0x4bb8e1, 0xc0720b6a50, 0xc081abde40, 0xc07759a750, 0x1000000010, ...)\r\n\t/usr/lib/go/src/reflect/asm_amd64.s:35 +0x42\r\nreflect.Value.call(0xcfd6c0, 0xc081abde40, 0x13, 0xe6d4ff, 0x4, 0xc0850b7380, 0x1, 0x1, 0xe65740, 0x1098601, ...)\r\n\t/usr/lib/go/src/reflect/value.go:447 +0x461\r\nreflect.Value.Call(0xcfd6c0, 0xc081abde40, 0x13, 0xc0850b7380, 0x1, 0x1, 0xc085dd0d20, 0x98, 0x0)\r\n\t/usr/lib/go/src/reflect/value.go:308 +0xa4\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*Runtime).wrapReflectFunc.func1(0x1098680, 0xc0850b6c40, 0xc08c1e0750, 0x1, 0x19, 0x1098860, 0xc085dd0d10)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/runtime.go:1153 +0x791\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*vm)._nativeCall(0xc00f314750, 0xc0800a8210, 0x1)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:1826 +0x29a\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.call.exec(0x1, 0xc00f314750)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:1810 +0x4a4\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*vm).run(0xc00f314750)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:288 +0x51\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*funcObject).Call(0xc0887926c0, 0x1098cc0, 0x1a08120, 0xc085dd0a20, 0x1, 0x1, 0xc08e026b50, 0xc08befd980)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/func.go:130 +0x2c4\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.AssertFunction.func1.2()\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/runtime.go:1412 +0x96\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*vm).try(0xc00f314750, 0xc08e026c70, 0x0)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:370 +0x10d\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.AssertFunction.func1(0x1098cc0, 0x1a08120, 0xc085dd0a20, 0x1, 0x1, 0x0, 0x0, 0x0, 0x0)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/runtime.go:1411 +0x10d\r\ngithub.com/loadimpact/k6/js/modules/k6/ws.(*WS).Connect(0x1a08450, 0x108b5e0, 0xc088217e30, 0xc00049c300, 0x3c, 0xc085080f40, 0x2, 0x2, 0x0, 0x0, ...)\r\n\t/home/go/src/github.com/loadimpact/k6/js/modules/k6/ws/ws.go:196 +0x7af\r\nreflect.Value.call(0xd3aee0, 0x1a08450, 0x213, 0xe7288b, 0x9, 0xc0878fcc80, 0x3, 0x3, 0xde3e80, 0xc085d92b60, ...)\r\n\t/usr/lib/go/src/reflect/value.go:447 +0x461\r\nreflect.Value.CallSlice(0xd3aee0, 0x1a08450, 0x213, 0xc0878fcc80, 0x3, 0x3, 0x194, 0xc08e027628, 0x8b5d26)\r\n\t/usr/lib/go/src/reflect/value.go:321 +0xa4\r\ngithub.com/loadimpact/k6/js/common.Bind.func1(0x1098680, 0xc0104e9200, 0xc08c1e06e0, 0x3, 0x20, 0xc0882498c0, 0xc08e027840)\r\n\t/home/go/src/github.com/loadimpact/k6/js/common/bridge.go:239 +0x78a\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*vm)._nativeCall(0xc00f314750, 0xc088ae2dc0, 0x3)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:1826 +0x29a\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.call.exec(0x3, 0xc00f314750)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:1810 +0x4a4\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*vm).run(0xc00f314750)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:288 +0x51\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*vm).try(0xc00f314750, 0xc08e0279b8, 0x0)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:370 +0x10d\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*vm).runTry(0xc00f314750, 0xd35a40)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:375 +0x4e\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.try.exec(0x13, 0x0, 0xc00f314750)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:2245 +0x51\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*vm).run(0xc00f314750)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:288 +0x51\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*funcObject).Call(0xc0105752c0, 0x1098cc0, 0x1a08120, 0xc085d929a0, 0x1, 0x1, 0xc00fcc5728, 0xc08befd980)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/func.go:130 +0x2c4\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.AssertFunction.func1.2()\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/runtime.go:1412 +0x96\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*vm).try(0xc00f314750, 0xc08e027ce0, 0x0)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:370 +0x10d\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.AssertFunction.func1(0x1098cc0, 0x1a08120, 0xc085d929a0, 0x1, 0x1, 0x0, 0x0, 0x0, 0x0)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/runtime.go:1411 +0x10d\r\ngithub.com/loadimpact/k6/js.(*VU).runFn(0xc01058c2d0, 0x108b520, 0xc0653b7bc0, 0xc0036ae300, 0xc010578a00, 0xc085d929a0, 0x1, 0x1, 0x1098cc0, 0xc08e027f30, ...)\r\n\t/home/go/src/github.com/loadimpact/k6/js/runner.go:443 +0x394\r\ngithub.com/loadimpact/k6/js.(*VU).RunOnce(0xc01058c2d0, 0x108b520, 0xc0653b7bc0, 0x0, 0x0)\r\n\t/home/go/src/github.com/loadimpact/k6/js/runner.go:403 +0x1f0\r\ngithub.com/loadimpact/k6/core/local.(*vuHandle).run(0xc00f530ec0, 0xc00007a240, 0xc0026dc8a0, 0xc00050cba0)\r\n\t/home/go/src/github.com/loadimpact/k6/core/local/local.go:70 +0x145\r\n```\r\n\r\nI can't reproduce it with a simple test script, and I can't paste the original script, since it's very complex and has private data in it... :disappointed:  Potentially connected: https://github.com/loadimpact/k6/issues/581#issuecomment-468579199","closed_by":{"login":"imiric","id":1009277,"node_id":"MDQ6VXNlcjEwMDkyNzc=","avatar_url":"https://avatars.githubusercontent.com/u/1009277?v=4","gravatar_id":"","url":"https://api.github.com/users/imiric","html_url":"https://github.com/imiric","followers_url":"https://api.github.com/users/imiric/followers","following_url":"https://api.github.com/users/imiric/following{/other_user}","gists_url":"https://api.github.com/users/imiric/gists{/gist_id}","starred_url":"https://api.github.com/users/imiric/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imiric/subscriptions","organizations_url":"https://api.github.com/users/imiric/orgs","repos_url":"https://api.github.com/users/imiric/repos","events_url":"https://api.github.com/users/imiric/events{/privacy}","received_events_url":"https://api.github.com/users/imiric/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/grafana/k6/issues/1116/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/grafana/k6/issues/1116/timeline","performed_via_github_app":null,"state_reason":"completed"}