{"url":"https://api.github.com/repos/grafana/k6/issues/4564","repository_url":"https://api.github.com/repos/grafana/k6","labels_url":"https://api.github.com/repos/grafana/k6/issues/4564/labels{/name}","comments_url":"https://api.github.com/repos/grafana/k6/issues/4564/comments","events_url":"https://api.github.com/repos/grafana/k6/issues/4564/events","html_url":"https://github.com/grafana/k6/issues/4564","id":2863585772,"node_id":"I_kwDOAz4Wr86qrtns","number":4564,"title":"concurrent map iteration and map write: `ExecutionContext.eval`","user":{"login":"inancgumus","id":621232,"node_id":"MDQ6VXNlcjYyMTIzMg==","avatar_url":"https://avatars.githubusercontent.com/u/621232?v=4","gravatar_id":"","url":"https://api.github.com/users/inancgumus","html_url":"https://github.com/inancgumus","followers_url":"https://api.github.com/users/inancgumus/followers","following_url":"https://api.github.com/users/inancgumus/following{/other_user}","gists_url":"https://api.github.com/users/inancgumus/gists{/gist_id}","starred_url":"https://api.github.com/users/inancgumus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/inancgumus/subscriptions","organizations_url":"https://api.github.com/users/inancgumus/orgs","repos_url":"https://api.github.com/users/inancgumus/repos","events_url":"https://api.github.com/users/inancgumus/events{/privacy}","received_events_url":"https://api.github.com/users/inancgumus/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":345191758,"node_id":"MDU6TGFiZWwzNDUxOTE3NTg=","url":"https://api.github.com/repos/grafana/k6/labels/bug","name":"bug","color":"b60205","default":true,"description":""},{"id":6004839752,"node_id":"LA_kwDOAz4Wr88AAAABZeqVSA","url":"https://api.github.com/repos/grafana/k6/labels/area:%20browser","name":"area: browser","color":"FFCD46","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2025-02-19T14:50:17Z","updated_at":"2025-05-19T08:35:26Z","closed_at":"2025-05-19T08:35:26Z","author_association":"CONTRIBUTOR","type":{"id":738484,"node_id":"IT_kwDOAG3Mbc4AC0S0","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T10:33:25Z","updated_at":"2024-07-26T10:14:36Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"parent_issue_url":"https://api.github.com/repos/grafana/k6/issues/4126","issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Summary\n\n<details>\n <summary>Test run ID: 2760298 (Browser version: 1.5.1) and 3412683, 3414418 (Browser version: 1.8.5)</summary>\n\n```\nfatal error: concurrent map iteration and map write\n\ngoroutine 94 [running]:\nreflect.mapiternext(0x4b6aa9?)\nruntime/map.go:1392 +0x13\nreflect.(*MapIter).Next(0xc018d88680?)\nreflect/value.go:2005 +0x74\ninternal/fmtsort.Sort({0x15a7760?, 0xc002cd2b60?, 0xc0012d1690?})\ninternal/fmtsort/sort.go:62 +0x1d3\nfmt.(*pp).printValue(0xc000f94000, {0x15a7760?, 0xc002cd2b60?, 0x1?}, 0x76, 0x3)\nfmt/print.go:816 +0x988\nfmt.(*pp).printValue(0xc000f94000, {0x16f8d20?, 0xc002cd2b40?, 0xc018d88b28?}, 0x76, 0x2)\nfmt/print.go:853 +0x11be\nfmt.(*pp).printValue(0xc000f94000, {0x1750940?, 0xc002cd2b40?, 0xc01ae76000?}, 0x76, 0x1)\nfmt/print.go:853 +0x11be\nfmt.(*pp).printValue(0xc000f94000, {0x173a740?, 0xc002cd2b40?, 0x0?}, 0x76, 0x0)\nfmt/print.go:921 +0xaf4\nfmt.(*pp).badVerb(0xc000f94000, 0x71)\nfmt/print.go:394 +0x47f\nfmt.(*pp).fmtPointer(0xc000f94000, {0x173a740?, 0xc002cd2b40?, 0x50aa70?}, 0x71)\nfmt/print.go:583 +0x414\nfmt.(*pp).printValue(0xc000f94000, {0x173a740?, 0xc002cd2b40?, 0x50aa70?}, 0x71, 0x3)\nfmt/print.go:927 +0x1165\nfmt.(*pp).printValue(0xc000f94000, {0x17135e0?, 0xc014fefb80?, 0x0?}, 0x71, 0x2)\nfmt/print.go:853 +0x11be\nfmt.(*pp).printValue(0xc000f94000, {0x1646fa0?, 0xc014fefb80?, 0x50aa70?}, 0x71, 0x1)\nfmt/print.go:853 +0x11be\nfmt.(*pp).printValue(0xc000f94000, {0x17cb4c0?, 0xc014fefb80?, 0xc018d89970?}, 0x71, 0x0)\nfmt/print.go:921 +0xaf4\nfmt.(*pp).printArg(0xc000f94000, {0x17cb4c0, 0xc014fefb80}, 0x71)\nfmt/print.go:759 +0x4bc\nfmt.(*pp).doPrintf(0xc000f94000, {0x184d1e5, 0x45}, {0xc018d89de0, 0x4, 0x4})\nfmt/print.go:1075 +0x37e\nfmt.Errorf({0x184d1e5, 0x45}, {0xc018d89de0, 0x4, 0x4})\nfmt/errors.go:25 +0x85\ngithub.com/grafana/xk6-browser/common.(*ExecutionContext).eval(0xc018c3cfd0, {0x1bb8208, 0xc000ece730}, {0x1, 0x0}, {0x185895c, 0xa5}, {0xc0194d8a20, 0x6, 0x6})\ngithub.com/grafana/xk6-browser@v1.5.1/common/execution_context.go:189 +0xd65\ngithub.com/grafana/xk6-browser/common.(*ElementHandle).eval(...)\ngithub.com/grafana/xk6-browser@v1.5.1/common/element_handle.go:1401\ngithub.com/grafana/xk6-browser/common.(*ElementHandle).evalWithScript(0xc014fefb80, {0x1bb8208, 0xc000ece730}, {0x0?, 0x0?}, {0x185895c, 0xa5}, {0xc018d89f40, 0x4, 0x4})\ngithub.com/grafana/xk6-browser@v1.5.1/common/element_handle.go:1392 +0x25d\ngithub.com/grafana/xk6-browser/common.(*ElementHandle).waitForSelector(0xc014fefb80, {0x1bb8208, 0xc000ece730}, {0xc00258e3a8?, 0x1808d81?}, 0xc018d8a158)\ngithub.com/grafana/xk6-browser@v1.5.1/common/element_handle.go:681 +0x188\ngithub.com/grafana/xk6-browser/common.(*Frame).waitForSelector(0xc000a92540, {0xc00258e3a8, 0x11}, 0xc018d8a158)\ngithub.com/grafana/xk6-browser@v1.5.1/common/frame.go:527 +0x1bb\ngithub.com/grafana/xk6-browser/common.(*Frame).waitForSelectorRetry(0xc000a92540, {0xc00258e3a8, 0x11}, 0xc018d8a158, 0xc001b4a780?)\ngithub.com/grafana/xk6-browser@v1.5.1/common/frame.go:511 +0x5a\ngithub.com/grafana/xk6-browser/common.(*Frame).WaitForSelector(0xc000a92540, {0xc00258e3a8, 0x11}, {0x1bc9d18, 0xc001b4a780})\ngithub.com/grafana/xk6-browser@v1.5.1/common/frame.go:1930 +0x165\ngithub.com/grafana/xk6-browser/browser.mapFrame.func14({0xc00258e3a8?, 0x2?}, {0x1bc9d18?, 0xc001b4a780?})\ngithub.com/grafana/xk6-browser@v1.5.1/browser/mapping.go:491 +0x45\nreflect.Value.call({0x15a34a0?, 0xc000a87080?, 0x8?}, {0x17ec3d9, 0x4}, {0xc001b4a7e0, 0x2, 0xc0149663e0?})\nreflect/value.go:596 +0xca6\nreflect.Value.Call({0x15a34a0?, 0xc000a87080?, 0xc001b4a780?}, {0xc001b4a7e0?, 0xc00164ea10?, 0x7fcfca223bd8?})\nreflect/value.go:380 +0xb9\ngithub.com/dop251/goja.(*Runtime).newWrappedFunc.(*Runtime).wrapReflectFunc.func1({{0x1bc9d18, 0xc003544210}, {0xc0159497b8, 0x2, 0x2d}})\ngithub.com/dop251/goja@v0.0.0-20240220182346-e401ed450204/runtime.go:1982 +0x3bd\ngithub.com/dop251/goja.(*nativeFuncObject).vmCall(0xc0017be840, 0xc0034905a0, 0x2)\ngithub.com/dop251/goja@v0.0.0-20240220182346-e401ed450204/func.go:563 +0x184\ngithub.com/dop251/goja.call.exec(0x5?, 0xc0034905a0)\ngithub.com/dop251/goja@v0.0.0-20240220182346-e401ed450204/vm.go:3375 +0x66\ngithub.com/dop251/goja.(*vm).run(0xc0034905a0)\ngithub.com/dop251/goja@v0.0.0-20240220182346-e401ed450204/vm.go:582 +0x5b\ngithub.com/dop251/goja.(*vm).runTryInner(0xc018d8ac18?)\ngithub.com/dop251/goja@v0.0.0-20240220182346-e401ed450204/vm.go:834 +0x65\ngithub.com/dop251/goja.(*generator).step(0xc0009287e0)\ngithub.com/dop251/goja@v0.0.0-20240220182346-e401ed450204/func.go:762 +0x2b\ngithub.com/dop251/goja.(*asyncRunner).start(0xc0009287e0, 0x1)\ngithub.com/dop251/goja@v0.0.0-20240220182346-e401ed450204/func.go:733 +0xfd\ngithub.com/dop251/goja.(*baseJsFuncObject).asyncVmCall(0xc0032a5a40, 0xc0034905a0, 0x1, 0xc00164e990)\ngithub.com/dop251/goja@v0.0.0-20240220182346-e401ed450204/func.go:664 +0x79\ngithub.com/dop251/goja.(*asyncFuncObject).vmCall(0xc0032a5a40, 0xc0034905a0, 0x1)\ngithub.com/dop251/goja@v0.0.0-20240220182346-e401ed450204/func.go:670 +0x65\ngithub.com/dop251/goja.call.exec(0xd988e5?, 0xc0034905a0)\ngithub.com/dop251/goja@v0.0.0-20240220182346-e401ed450204/vm.go:3375 +0x66\ngithub.com/dop251/goja.(*vm).run(0xc0034905a0)\ngithub.com/dop251/goja@v0.0.0-20240220182346-e401ed4502\n```\n\n</details>\n\n### k6 version\n\nv0.57","closed_by":{"login":"mstoykov","id":312246,"node_id":"MDQ6VXNlcjMxMjI0Ng==","avatar_url":"https://avatars.githubusercontent.com/u/312246?v=4","gravatar_id":"","url":"https://api.github.com/users/mstoykov","html_url":"https://github.com/mstoykov","followers_url":"https://api.github.com/users/mstoykov/followers","following_url":"https://api.github.com/users/mstoykov/following{/other_user}","gists_url":"https://api.github.com/users/mstoykov/gists{/gist_id}","starred_url":"https://api.github.com/users/mstoykov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mstoykov/subscriptions","organizations_url":"https://api.github.com/users/mstoykov/orgs","repos_url":"https://api.github.com/users/mstoykov/repos","events_url":"https://api.github.com/users/mstoykov/events{/privacy}","received_events_url":"https://api.github.com/users/mstoykov/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/grafana/k6/issues/4564/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/grafana/k6/issues/4564/timeline","performed_via_github_app":null,"state_reason":"completed"}