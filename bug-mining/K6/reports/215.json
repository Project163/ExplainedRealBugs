{"url":"https://api.github.com/repos/grafana/k6/issues/2531","repository_url":"https://api.github.com/repos/grafana/k6","labels_url":"https://api.github.com/repos/grafana/k6/issues/2531/labels{/name}","comments_url":"https://api.github.com/repos/grafana/k6/issues/2531/comments","events_url":"https://api.github.com/repos/grafana/k6/issues/2531/events","html_url":"https://github.com/grafana/k6/issues/2531","id":1233848511,"node_id":"I_kwDOAz4Wr85Jiwi_","number":2531,"title":"Ramping vus/stages drops 0 target stages at the end.  ","user":{"login":"mstoykov","id":312246,"node_id":"MDQ6VXNlcjMxMjI0Ng==","avatar_url":"https://avatars.githubusercontent.com/u/312246?v=4","gravatar_id":"","url":"https://api.github.com/users/mstoykov","html_url":"https://github.com/mstoykov","followers_url":"https://api.github.com/users/mstoykov/followers","following_url":"https://api.github.com/users/mstoykov/following{/other_user}","gists_url":"https://api.github.com/users/mstoykov/gists{/gist_id}","starred_url":"https://api.github.com/users/mstoykov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mstoykov/subscriptions","organizations_url":"https://api.github.com/users/mstoykov/orgs","repos_url":"https://api.github.com/users/mstoykov/repos","events_url":"https://api.github.com/users/mstoykov/events{/privacy}","received_events_url":"https://api.github.com/users/mstoykov/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":345191758,"node_id":"MDU6TGFiZWwzNDUxOTE3NTg=","url":"https://api.github.com/repos/grafana/k6/labels/bug","name":"bug","color":"b60205","default":true,"description":""},{"id":865562676,"node_id":"MDU6TGFiZWw4NjU1NjI2NzY=","url":"https://api.github.com/repos/grafana/k6/labels/ux","name":"ux","color":"5319e7","default":false,"description":""},{"id":1079102926,"node_id":"MDU6TGFiZWwxMDc5MTAyOTI2","url":"https://api.github.com/repos/grafana/k6/labels/evaluation%20needed","name":"evaluation needed","color":"006B75","default":false,"description":"proposal needs to be validated or tested before fully implementing it in k6"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-05-12T11:33:40Z","updated_at":"2024-02-21T09:23:24Z","closed_at":null,"author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Brief summary\n\nRelated to #2527. \r\n\r\nIf you have stages at the end with target 0, they will be dropped\r\n```\r\nexport let options = {\r\n  stages: [\r\n    {duration: \"1s\", target 2},\r\n    {duration: \"1s\", target 0},\r\n    {duration: \"1h\", target 0},\r\n  ]\r\n}\r\n```\r\nwill run for only 2s instead of 1h and 2s. \r\n\r\n\r\nThe usefulness of this behaviour is questionable but it's somewhat strange that we have stages (even with target 0) and we do not take them into account. Arguably this should at least print a warning or something.\r\n\r\nThe main usecase I can find is like in the case of #2527 trying to make certain that `vus` and `vus_max` gets zeroed out before the test exits.\n\n### k6 version\n\nv0.38.2 and all before AFAIK\n\n### OS\n\nall\n\n### Docker version and image (if applicable)\n\n_No response_\n\n### Steps to reproduce the problem\n\nRun a script which has more than one sequential stage with target 0 at the end like\r\n```\r\nexport let options = {\r\n  stages: [\r\n    {duration: \"1s\", target 2},\r\n    {duration: \"1s\", target 0},\r\n    {duration: \"1h\", target 0},\r\n  ]\r\n}\r\n```\r\n\n\n### Expected behaviour\n\nThe test runs *at least* for the sum of all the stages durations\n\n### Actual behaviour\n\nIt stops after the first stage with target 0 at the end","closed_by":{"login":"mstoykov","id":312246,"node_id":"MDQ6VXNlcjMxMjI0Ng==","avatar_url":"https://avatars.githubusercontent.com/u/312246?v=4","gravatar_id":"","url":"https://api.github.com/users/mstoykov","html_url":"https://github.com/mstoykov","followers_url":"https://api.github.com/users/mstoykov/followers","following_url":"https://api.github.com/users/mstoykov/following{/other_user}","gists_url":"https://api.github.com/users/mstoykov/gists{/gist_id}","starred_url":"https://api.github.com/users/mstoykov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mstoykov/subscriptions","organizations_url":"https://api.github.com/users/mstoykov/orgs","repos_url":"https://api.github.com/users/mstoykov/repos","events_url":"https://api.github.com/users/mstoykov/events{/privacy}","received_events_url":"https://api.github.com/users/mstoykov/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/grafana/k6/issues/2531/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/grafana/k6/issues/2531/timeline","performed_via_github_app":null,"state_reason":"reopened"}