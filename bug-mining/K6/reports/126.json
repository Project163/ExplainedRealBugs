{"url":"https://api.github.com/repos/grafana/k6/issues/867","repository_url":"https://api.github.com/repos/grafana/k6","labels_url":"https://api.github.com/repos/grafana/k6/issues/867/labels{/name}","comments_url":"https://api.github.com/repos/grafana/k6/issues/867/comments","events_url":"https://api.github.com/repos/grafana/k6/issues/867/events","html_url":"https://github.com/grafana/k6/issues/867","id":391106558,"node_id":"MDU6SXNzdWUzOTExMDY1NTg=","number":867,"title":"Rare panic(s) in goja","user":{"login":"na--","id":3336773,"node_id":"MDQ6VXNlcjMzMzY3NzM=","avatar_url":"https://avatars.githubusercontent.com/u/3336773?v=4","gravatar_id":"","url":"https://api.github.com/users/na--","html_url":"https://github.com/na--","followers_url":"https://api.github.com/users/na--/followers","following_url":"https://api.github.com/users/na--/following{/other_user}","gists_url":"https://api.github.com/users/na--/gists{/gist_id}","starred_url":"https://api.github.com/users/na--/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/na--/subscriptions","organizations_url":"https://api.github.com/users/na--/orgs","repos_url":"https://api.github.com/users/na--/repos","events_url":"https://api.github.com/users/na--/events{/privacy}","received_events_url":"https://api.github.com/users/na--/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":345191758,"node_id":"MDU6TGFiZWwzNDUxOTE3NTg=","url":"https://api.github.com/repos/grafana/k6/labels/bug","name":"bug","color":"b60205","default":true,"description":""},{"id":874927263,"node_id":"MDU6TGFiZWw4NzQ5MjcyNjM=","url":"https://api.github.com/repos/grafana/k6/labels/high%20prio","name":"high prio","color":"D93F0B","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"na--","id":3336773,"node_id":"MDQ6VXNlcjMzMzY3NzM=","avatar_url":"https://avatars.githubusercontent.com/u/3336773?v=4","gravatar_id":"","url":"https://api.github.com/users/na--","html_url":"https://github.com/na--","followers_url":"https://api.github.com/users/na--/followers","following_url":"https://api.github.com/users/na--/following{/other_user}","gists_url":"https://api.github.com/users/na--/gists{/gist_id}","starred_url":"https://api.github.com/users/na--/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/na--/subscriptions","organizations_url":"https://api.github.com/users/na--/orgs","repos_url":"https://api.github.com/users/na--/repos","events_url":"https://api.github.com/users/na--/events{/privacy}","received_events_url":"https://api.github.com/users/na--/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"na--","id":3336773,"node_id":"MDQ6VXNlcjMzMzY3NzM=","avatar_url":"https://avatars.githubusercontent.com/u/3336773?v=4","gravatar_id":"","url":"https://api.github.com/users/na--","html_url":"https://github.com/na--","followers_url":"https://api.github.com/users/na--/followers","following_url":"https://api.github.com/users/na--/following{/other_user}","gists_url":"https://api.github.com/users/na--/gists{/gist_id}","starred_url":"https://api.github.com/users/na--/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/na--/subscriptions","organizations_url":"https://api.github.com/users/na--/orgs","repos_url":"https://api.github.com/users/na--/repos","events_url":"https://api.github.com/users/na--/events{/privacy}","received_events_url":"https://api.github.com/users/na--/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/grafana/k6/milestones/8","html_url":"https://github.com/grafana/k6/milestone/8","labels_url":"https://api.github.com/repos/grafana/k6/milestones/8/labels","id":4738802,"node_id":"MDk6TWlsZXN0b25lNDczODgwMg==","number":8,"title":"v0.27.0","description":"","creator":{"login":"na--","id":3336773,"node_id":"MDQ6VXNlcjMzMzY3NzM=","avatar_url":"https://avatars.githubusercontent.com/u/3336773?v=4","gravatar_id":"","url":"https://api.github.com/users/na--","html_url":"https://github.com/na--","followers_url":"https://api.github.com/users/na--/followers","following_url":"https://api.github.com/users/na--/following{/other_user}","gists_url":"https://api.github.com/users/na--/gists{/gist_id}","starred_url":"https://api.github.com/users/na--/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/na--/subscriptions","organizations_url":"https://api.github.com/users/na--/orgs","repos_url":"https://api.github.com/users/na--/repos","events_url":"https://api.github.com/users/na--/events{/privacy}","received_events_url":"https://api.github.com/users/na--/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":76,"state":"closed","created_at":"2019-10-10T07:45:28Z","updated_at":"2021-01-19T11:52:02Z","due_on":null,"closed_at":"2020-07-15T13:58:19Z"},"comments":3,"created_at":"2018-12-14T13:14:40Z","updated_at":"2020-05-21T12:17:52Z","closed_at":"2019-11-25T15:01:53Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Very rarely, k6 panics for an unknown reason, deep in the [goja runtime](https://github.com/dop251/goja). The cause of the panics seems to be that we've somehow concurrently executed 2 different things in the same goja runtime and one of them overwrote the stack of the other... Or maybe it's just a bug in goja? \r\n\r\nStack traces that we've seen (likely the same issue, but maybe not):\r\n```\r\npanic: runtime error: slice bounds out of range [recovered]\r\n\tpanic: runtime error: slice bounds out of range\r\n\r\ngoroutine 74315 [running]:\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.AssertFunction.func1.1(0xc01f48dd30)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/runtime.go:1407 +0x9b\r\npanic(0xc41680, 0x171b310)\r\n\t/usr/lib/go/src/runtime/panic.go:513 +0x1b9\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*vm).clearStack(0xc005b81a00)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:1843 +0x98\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.AssertFunction.func1(0xf0e2e0, 0x1750020, 0xc004075650, 0x1, 0x1, 0x0, 0x0, 0xefe4c0, 0xc0049da0f0)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/runtime.go:1420 +0x146\r\ngithub.com/loadimpact/k6/js.(*VU).runFn(0xc004045560, 0xf07080, 0xc00a065a40, 0xc00249c420, 0xc0044ecc40, 0xc004075650, 0x1, 0x1, 0xc2bea0, 0xc017268780, ...)\r\n\t/home/go/src/github.com/loadimpact/k6/js/runner.go:415 +0x35a\r\ngithub.com/loadimpact/k6/js.(*VU).RunOnce(0xc004045560, 0xf07080, 0xc00a065a40, 0x0, 0x0)\r\n\t/home/go/src/github.com/loadimpact/k6/js/runner.go:377 +0x1ef\r\ngithub.com/loadimpact/k6/core/local.(*vuHandle).run(0xc00228c400, 0xc0000b8a00, 0xc000083260, 0xc000082480)\r\n\t/home/go/src/github.com/loadimpact/k6/core/local/local.go:70 +0x152\r\ngithub.com/loadimpact/k6/core/local.(*Executor).scale.func1(0xc00228c400, 0xc005fd6120, 0xc000083260, 0xc000082480)\r\n\t/home/go/src/github.com/loadimpact/k6/core/local/local.go:360 +0x4d\r\ncreated by github.com/loadimpact/k6/core/local.(*Executor).scale\r\n\t/home/go/src/github.com/loadimpact/k6/core/local/local.go:359 +0x32b\r\n```\r\n\r\nand \r\n\r\n```\r\npanic: runtime error: index out of range [recovered]\r\n\tpanic: Panic at 105: runtime error: index out of range [recovered]\r\n\tpanic: Panic at 105: runtime error: index out of range [recovered]\r\n\tpanic: Panic at 6: Panic at 105: runtime error: index out of range [recovered]\r\n\tpanic: Panic at 6: Panic at 105: runtime error: index out of range\r\n\r\ngoroutine 138455 [running]:\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.AssertFunction.func1.1(0xc02c291d30)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/runtime.go:1407 +0x9b\r\npanic(0xc31660, 0xc00a260b90)\r\n\t/usr/lib/go/src/runtime/panic.go:513 +0x1b9\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*vm).try.func1(0xc011811450, 0x4, 0xc02c291c38, 0xd, 0x0, 0x0, 0xc02c291c90)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:364 +0x459\r\npanic(0xc31660, 0xc00a260b70)\r\n\t/usr/lib/go/src/runtime/panic.go:513 +0x1b9\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.AssertFunction.func1.1(0xc02c291298)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/runtime.go:1407 +0x9b\r\npanic(0xc31660, 0xc00a260b70)\r\n\t/usr/lib/go/src/runtime/panic.go:513 +0x1b9\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*vm).try.func1(0xc011811450, 0x6, 0xc02c2911a0, 0x13, 0x0, 0x0, 0xc02c2911f8)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:364 +0x459\r\npanic(0xc448c0, 0x1721310)\r\n\t/usr/lib/go/src/runtime/panic.go:513 +0x1b9\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*vm)._nativeCall(0xc011811450, 0xc00a7414a0, 0x1)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:1833 +0x627\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.call.exec(0x1, 0xc011811450)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:1810 +0x4e3\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*vm).run(0xc011811450)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:288 +0x5d\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*funcObject).Call(0xc00f343380, 0xf11f20, 0x1756000, 0x0, 0x0, 0x0, 0xc056e1f0e8, 0xa2eabbace7836145)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/func.go:130 +0x2be\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*funcObject).Call-fm(0xf11f20, 0x1756000, 0x0, 0x0, 0x0, 0xef833d, 0xfe)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/builtin_function.go:120 +0x48\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.AssertFunction.func1.2()\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/runtime.go:1412 +0x96\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*vm).try(0xc011811450, 0xc056e1f210, 0x0)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:370 +0x10c\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.AssertFunction.func1(0xf11f20, 0x1756000, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/runtime.go:1411 +0x10d\r\ngithub.com/loadimpact/k6/js/modules/k6.(*K6).Group(0x1756308, 0xf0ad80, 0xc00ca17da0, 0xc004a480c6, 0x25, 0xc064cb7fa0, 0x0, 0x0, 0x0, 0x0)\r\n\t/home/go/src/github.com/loadimpact/k6/js/modules/k6/k6.go:89 +0x17e\r\nreflect.Value.call(0xc83fa0, 0x1756308, 0xa13, 0xd4bd5b, 0x4, 0xc0064a8e10, 0x3, 0x3, 0xc064cb7fa0, 0xef8311, ...)\r\n\t/usr/lib/go/src/reflect/value.go:447 +0x449\r\nreflect.Value.Call(0xc83fa0, 0x1756308, 0xa13, 0xc0064a8e10, 0x3, 0x3, 0x0, 0x8, 0xd10380)\r\n\t/usr/lib/go/src/reflect/value.go:308 +0xa4\r\ngithub.com/loadimpact/k6/js/common.Bind.func1(0xf11f20, 0x1756000, 0xc0471a2350, 0x2, 0x11, 0x0, 0x0)\r\n\t/home/go/src/github.com/loadimpact/k6/js/common/bridge.go:212 +0xc5c\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*vm)._nativeCall(0xc011811450, 0xc00a740fd0, 0x2)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:1826 +0x284\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.call.exec(0x2, 0xc011811450)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:1810 +0x4e3\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*vm).run(0xc011811450)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:288 +0x5d\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*funcObject).Call(0xc00a5f6a80, 0xf11f20, 0x1756000, 0xc00d785df0, 0x1, 0x1, 0xc020d07b80, 0x203003)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/func.go:130 +0x2be\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*funcObject).Call-fm(0xf11f20, 0x1756000, 0xc00d785df0, 0x1, 0x1, 0xef833d, 0x33)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/builtin_function.go:120 +0x48\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.AssertFunction.func1.2()\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/runtime.go:1412 +0x96\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.(*vm).try(0xc011811450, 0xc020d07ca8, 0x0)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/vm.go:370 +0x10c\r\ngithub.com/loadimpact/k6/vendor/github.com/dop251/goja.AssertFunction.func1(0xf11f20, 0x1756000, 0xc00d785df0, 0x1, 0x1, 0x0, 0x0, 0x0, 0x0)\r\n\t/home/go/src/github.com/loadimpact/k6/vendor/github.com/dop251/goja/runtime.go:1411 +0x10d\r\ngithub.com/loadimpact/k6/js.(*VU).runFn(0xc00ddf4750, 0xf0acc0, 0xc00e8aeac0, 0xc001b61bc0, 0xc00df1fa60, 0xc00d785df0, 0x1, 0x1, 0x1a, 0x1b, ...)\r\n\t/home/go/src/github.com/loadimpact/k6/js/runner.go:415 +0x35a\r\ngithub.com/loadimpact/k6/js.(*VU).RunOnce(0xc00ddf4750, 0xf0acc0, 0xc00e8aeac0, 0x0, 0x0)\r\n\t/home/go/src/github.com/loadimpact/k6/js/runner.go:377 +0x1ef\r\ngithub.com/loadimpact/k6/core/local.(*vuHandle).run(0xc0124806c0, 0xc00009ea00, 0xc000082d80, 0xc0000821e0)\r\n\t/home/go/src/github.com/loadimpact/k6/core/local/local.go:70 +0x152\r\ngithub.com/loadimpact/k6/core/local.(*Executor).scale.func1(0xc0124806c0, 0xc0041c8360, 0xc000082d80, 0xc0000821e0)\r\n\t/home/go/src/github.com/loadimpact/k6/core/local/local.go:360 +0x4d\r\ncreated by github.com/loadimpact/k6/core/local.(*Executor).scale\r\n\t/home/go/src/github.com/loadimpact/k6/core/local/local.go:359 +0x32b\r\n```","closed_by":{"login":"mstoykov","id":312246,"node_id":"MDQ6VXNlcjMxMjI0Ng==","avatar_url":"https://avatars.githubusercontent.com/u/312246?v=4","gravatar_id":"","url":"https://api.github.com/users/mstoykov","html_url":"https://github.com/mstoykov","followers_url":"https://api.github.com/users/mstoykov/followers","following_url":"https://api.github.com/users/mstoykov/following{/other_user}","gists_url":"https://api.github.com/users/mstoykov/gists{/gist_id}","starred_url":"https://api.github.com/users/mstoykov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mstoykov/subscriptions","organizations_url":"https://api.github.com/users/mstoykov/orgs","repos_url":"https://api.github.com/users/mstoykov/repos","events_url":"https://api.github.com/users/mstoykov/events{/privacy}","received_events_url":"https://api.github.com/users/mstoykov/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/grafana/k6/issues/867/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/grafana/k6/issues/867/timeline","performed_via_github_app":null,"state_reason":"completed"}