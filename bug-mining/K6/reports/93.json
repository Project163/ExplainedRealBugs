{"url":"https://api.github.com/repos/grafana/k6/issues/895","repository_url":"https://api.github.com/repos/grafana/k6","labels_url":"https://api.github.com/repos/grafana/k6/issues/895/labels{/name}","comments_url":"https://api.github.com/repos/grafana/k6/issues/895/comments","events_url":"https://api.github.com/repos/grafana/k6/issues/895/events","html_url":"https://github.com/grafana/k6/issues/895","id":399430029,"node_id":"MDU6SXNzdWUzOTk0MzAwMjk=","number":895,"title":"Non-application-protocol error codes","user":{"login":"robingustafsson","id":1792533,"node_id":"MDQ6VXNlcjE3OTI1MzM=","avatar_url":"https://avatars.githubusercontent.com/u/1792533?v=4","gravatar_id":"","url":"https://api.github.com/users/robingustafsson","html_url":"https://github.com/robingustafsson","followers_url":"https://api.github.com/users/robingustafsson/followers","following_url":"https://api.github.com/users/robingustafsson/following{/other_user}","gists_url":"https://api.github.com/users/robingustafsson/gists{/gist_id}","starred_url":"https://api.github.com/users/robingustafsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robingustafsson/subscriptions","organizations_url":"https://api.github.com/users/robingustafsson/orgs","repos_url":"https://api.github.com/users/robingustafsson/repos","events_url":"https://api.github.com/users/robingustafsson/events{/privacy}","received_events_url":"https://api.github.com/users/robingustafsson/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":345191760,"node_id":"MDU6TGFiZWwzNDUxOTE3NjA=","url":"https://api.github.com/repos/grafana/k6/labels/enhancement","name":"enhancement","color":"5319E7","default":true,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-01-15T16:34:47Z","updated_at":"2020-07-13T10:47:08Z","closed_at":"2019-03-11T11:06:40Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When there's a non-application-protocol error for a HTTP request or WebSocket connection today k6 sets a status of 0 (property `status` in response object and metric output tags) and adds a Go stdlib message to the `error` property in the response object as well as the metrics output tags.\r\n\r\nThis presents a number of problems when trying to analyze the data, whether manually or computer-aided:\r\n\r\n- You need to parse text to find the actual type of error (DNS? TCP? connect fail? recv/send fail? etc.)\r\n    - If you're not familiar with the Go stdlib error messages (most won't be) it can be difficult to understand what the error actually is\r\n- There's no straightforward way to aggregate the errors as some of the `error` messages contain randomly selected src and dest TCP port numbers, meaning each message is unique although reporting the same issue\r\n\r\nI therefore propose we introduce a new property `error_code`. A pre-defined numeric value that we map to the list of possible errors that k6 can run into. This solves the problems mentioned above; it will make it much easier to aggregate and present error stats and we can provide much more end-user digestible error messages.\r\n\r\nI think we should also define ranges of values for different categories/layers of errors like: DNS, TCP, TLS, HTTP etc.\r\n\r\nThe gist of the proposal:\r\n- Introduce a `error_code` property to the Response object [1].\r\n- Introduce a `error_code` tag in the metrics output\r\n- Use the following ranges of codes for specific categories/layers:\r\n    - 0: no error, everything's OK!\r\n    - 1...99: Reserved\r\n    - 100-199: DNS (needs to be broken down into specific DNS error codes that k6 can report)\r\n    - 200-299: TCP (needs to be broken down into specific TCP error codes that k6 can report)\r\n    - 300-399: TLS (needs to be broken down into specific TLS error codes that k6 can report)\r\n    - 400-499: HTTP client side errors (simple maps to HTTP 4xx status codes)\r\n    - 500-599: HTTP server side errors (simple maps to HTTP 5xx status codes)\r\n    - 600-699: WebSocket\r\n- Set the `error` Response property and metrics tag to a new, user friendlier error message written by us for each of the possible error codes\r\n\r\n[1] - https://docs.k6.io/docs/response-k6http\r\n[2] - https://github.com/loadimpact/k6/issues/66 (the original issue regarding this topic, with the discussion that resulted in the current solution with `status: 0` and `error: message`)","closed_by":{"login":"mstoykov","id":312246,"node_id":"MDQ6VXNlcjMxMjI0Ng==","avatar_url":"https://avatars.githubusercontent.com/u/312246?v=4","gravatar_id":"","url":"https://api.github.com/users/mstoykov","html_url":"https://github.com/mstoykov","followers_url":"https://api.github.com/users/mstoykov/followers","following_url":"https://api.github.com/users/mstoykov/following{/other_user}","gists_url":"https://api.github.com/users/mstoykov/gists{/gist_id}","starred_url":"https://api.github.com/users/mstoykov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mstoykov/subscriptions","organizations_url":"https://api.github.com/users/mstoykov/orgs","repos_url":"https://api.github.com/users/mstoykov/repos","events_url":"https://api.github.com/users/mstoykov/events{/privacy}","received_events_url":"https://api.github.com/users/mstoykov/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/grafana/k6/issues/895/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/grafana/k6/issues/895/timeline","performed_via_github_app":null,"state_reason":"completed"}