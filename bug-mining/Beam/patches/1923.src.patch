diff --git a/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/WindowingStrategyTranslation.java b/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/WindowingStrategyTranslation.java
index f8a864884ab..0125a8d0387 100644
--- a/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/WindowingStrategyTranslation.java
+++ b/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/WindowingStrategyTranslation.java
@@ -45,6 +45,7 @@ import org.apache.beam.vendor.grpc.v1p26p0.com.google.protobuf.ByteString;
 import org.apache.beam.vendor.grpc.v1p26p0.com.google.protobuf.InvalidProtocolBufferException;
 import org.apache.beam.vendor.grpc.v1p26p0.com.google.protobuf.util.Durations;
 import org.apache.beam.vendor.grpc.v1p26p0.com.google.protobuf.util.Timestamps;
+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.base.Strings;
 import org.joda.time.Duration;
 
 /** Utilities for working with {@link WindowingStrategy WindowingStrategies}. */
@@ -281,6 +282,10 @@ public class WindowingStrategyTranslation implements Serializable {
   public static RunnerApi.WindowingStrategy toProto(
       WindowingStrategy<?, ?> windowingStrategy, SdkComponents components) throws IOException {
     FunctionSpec windowFnSpec = toProto(windowingStrategy.getWindowFn(), components);
+    String environmentId =
+        Strings.isNullOrEmpty(windowingStrategy.getEnvironmentId())
+            ? components.getOnlyEnvironmentId()
+            : windowingStrategy.getEnvironmentId();
 
     RunnerApi.WindowingStrategy.Builder windowingStrategyProto =
         RunnerApi.WindowingStrategy.newBuilder()
@@ -294,7 +299,7 @@ public class WindowingStrategyTranslation implements Serializable {
             .setOnTimeBehavior(toProto(windowingStrategy.getOnTimeBehavior()))
             .setWindowCoderId(
                 components.registerCoder(windowingStrategy.getWindowFn().windowCoder()))
-            .setEnvironmentId(components.getOnlyEnvironmentId());
+            .setEnvironmentId(environmentId);
 
     return windowingStrategyProto.build();
   }
@@ -334,6 +339,7 @@ public class WindowingStrategyTranslation implements Serializable {
     ClosingBehavior closingBehavior = fromProto(proto.getClosingBehavior());
     Duration allowedLateness = Duration.millis(proto.getAllowedLateness());
     OnTimeBehavior onTimeBehavior = fromProto(proto.getOnTimeBehavior());
+    String environmentId = proto.getEnvironmentId();
 
     return WindowingStrategy.of(windowFn)
         .withAllowedLateness(allowedLateness)
@@ -341,7 +347,8 @@ public class WindowingStrategyTranslation implements Serializable {
         .withTrigger(trigger)
         .withTimestampCombiner(timestampCombiner)
         .withClosingBehavior(closingBehavior)
-        .withOnTimeBehavior(onTimeBehavior);
+        .withOnTimeBehavior(onTimeBehavior)
+        .withEnvironmentId(environmentId);
   }
 
   public static WindowFn<?, ?> windowFnFromProto(FunctionSpec windowFnSpec) {
diff --git a/runners/core-construction-java/src/test/java/org/apache/beam/runners/core/construction/PCollectionTranslationTest.java b/runners/core-construction-java/src/test/java/org/apache/beam/runners/core/construction/PCollectionTranslationTest.java
index 3ff1b67b35d..73d93baf56e 100644
--- a/runners/core-construction-java/src/test/java/org/apache/beam/runners/core/construction/PCollectionTranslationTest.java
+++ b/runners/core-construction-java/src/test/java/org/apache/beam/runners/core/construction/PCollectionTranslationTest.java
@@ -123,7 +123,11 @@ public class PCollectionTranslationTest {
     assertThat(decodedCollection.getCoder(), equalTo(testCollection.getCoder()));
     assertThat(
         decodedCollection.getWindowingStrategy(),
-        equalTo(testCollection.getWindowingStrategy().fixDefaults()));
+        equalTo(
+            testCollection
+                .getWindowingStrategy()
+                .withEnvironmentId(sdkComponents.getOnlyEnvironmentId())
+                .fixDefaults()));
     assertThat(decodedCollection.isBounded(), equalTo(testCollection.isBounded()));
   }
 
@@ -141,7 +145,13 @@ public class PCollectionTranslationTest {
     IsBounded decodedIsBounded = PCollectionTranslation.isBounded(protoCollection);
 
     assertThat(decodedCoder, equalTo(testCollection.getCoder()));
-    assertThat(decodedStrategy, equalTo(testCollection.getWindowingStrategy().fixDefaults()));
+    assertThat(
+        decodedStrategy,
+        equalTo(
+            testCollection
+                .getWindowingStrategy()
+                .withEnvironmentId(sdkComponents.getOnlyEnvironmentId())
+                .fixDefaults()));
     assertThat(decodedIsBounded, equalTo(testCollection.isBounded()));
   }
 
diff --git a/runners/core-construction-java/src/test/java/org/apache/beam/runners/core/construction/RehydratedComponentsTest.java b/runners/core-construction-java/src/test/java/org/apache/beam/runners/core/construction/RehydratedComponentsTest.java
index 7954b1a3497..82aa2e9c0fa 100644
--- a/runners/core-construction-java/src/test/java/org/apache/beam/runners/core/construction/RehydratedComponentsTest.java
+++ b/runners/core-construction-java/src/test/java/org/apache/beam/runners/core/construction/RehydratedComponentsTest.java
@@ -91,7 +91,13 @@ public class RehydratedComponentsTest {
         RehydratedComponents.forComponents(sdkComponents.toComponents());
 
     WindowingStrategy<?, ?> rehydratedStrategy = rehydratedComponents.getWindowingStrategy(id);
-    assertThat(rehydratedStrategy, equalTo((WindowingStrategy) windowingStrategy.fixDefaults()));
+    assertThat(
+        rehydratedStrategy,
+        equalTo(
+            (WindowingStrategy)
+                windowingStrategy
+                    .withEnvironmentId(sdkComponents.getOnlyEnvironmentId())
+                    .fixDefaults()));
     assertThat(
         rehydratedComponents.getWindowingStrategy(id),
         theInstance((WindowingStrategy) rehydratedStrategy));
diff --git a/runners/core-construction-java/src/test/java/org/apache/beam/runners/core/construction/WindowingStrategyTranslationTest.java b/runners/core-construction-java/src/test/java/org/apache/beam/runners/core/construction/WindowingStrategyTranslationTest.java
index 9f50c0b79ce..a58860738a5 100644
--- a/runners/core-construction-java/src/test/java/org/apache/beam/runners/core/construction/WindowingStrategyTranslationTest.java
+++ b/runners/core-construction-java/src/test/java/org/apache/beam/runners/core/construction/WindowingStrategyTranslationTest.java
@@ -109,7 +109,11 @@ public class WindowingStrategyTranslationTest {
 
     assertThat(
         toProtoAndBackWindowingStrategy,
-        equalTo((WindowingStrategy) windowingStrategy.fixDefaults()));
+        equalTo(
+            (WindowingStrategy)
+                windowingStrategy
+                    .withEnvironmentId(components.getOnlyEnvironmentId())
+                    .fixDefaults()));
   }
 
   @Test
@@ -124,7 +128,8 @@ public class WindowingStrategyTranslationTest {
 
     assertThat(
         WindowingStrategyTranslation.fromProto(proto, protoComponents).fixDefaults(),
-        equalTo(windowingStrategy.fixDefaults()));
+        equalTo(
+            windowingStrategy.withEnvironmentId(components.getOnlyEnvironmentId()).fixDefaults()));
 
     protoComponents.getCoder(
         components.registerCoder(windowingStrategy.getWindowFn().windowCoder()));
diff --git a/sdks/java/core/src/main/java/org/apache/beam/sdk/values/WindowingStrategy.java b/sdks/java/core/src/main/java/org/apache/beam/sdk/values/WindowingStrategy.java
index 9caee83dc01..b82dc0925cd 100644
--- a/sdks/java/core/src/main/java/org/apache/beam/sdk/values/WindowingStrategy.java
+++ b/sdks/java/core/src/main/java/org/apache/beam/sdk/values/WindowingStrategy.java
@@ -71,6 +71,7 @@ public class WindowingStrategy<T, W extends BoundedWindow> implements Serializab
   private final ClosingBehavior closingBehavior;
   private final OnTimeBehavior onTimeBehavior;
   private final TimestampCombiner timestampCombiner;
+  private final String environmentId;
   private final boolean triggerSpecified;
   private final boolean modeSpecified;
   private final boolean allowedLatenessSpecified;
@@ -87,7 +88,8 @@ public class WindowingStrategy<T, W extends BoundedWindow> implements Serializab
       TimestampCombiner timestampCombiner,
       boolean timestampCombinerSpecified,
       ClosingBehavior closingBehavior,
-      OnTimeBehavior onTimeBehavior) {
+      OnTimeBehavior onTimeBehavior,
+      String environmentId) {
     this.windowFn = windowFn;
     this.trigger = trigger;
     this.triggerSpecified = triggerSpecified;
@@ -99,6 +101,7 @@ public class WindowingStrategy<T, W extends BoundedWindow> implements Serializab
     this.onTimeBehavior = onTimeBehavior;
     this.timestampCombiner = timestampCombiner;
     this.timestampCombinerSpecified = timestampCombinerSpecified;
+    this.environmentId = environmentId;
   }
 
   /** Return a fully specified, default windowing strategy. */
@@ -118,7 +121,8 @@ public class WindowingStrategy<T, W extends BoundedWindow> implements Serializab
         TimestampCombiner.END_OF_WINDOW,
         false,
         ClosingBehavior.FIRE_IF_NON_EMPTY,
-        OnTimeBehavior.FIRE_ALWAYS);
+        OnTimeBehavior.FIRE_ALWAYS,
+        "");
   }
 
   public WindowFn<T, W> getWindowFn() {
@@ -165,6 +169,10 @@ public class WindowingStrategy<T, W extends BoundedWindow> implements Serializab
     return timestampCombinerSpecified;
   }
 
+  public String getEnvironmentId() {
+    return environmentId;
+  }
+
   /**
    * Returns a {@link WindowingStrategy} identical to {@code this} but with the trigger set to
    * {@code wildcardTrigger}.
@@ -181,7 +189,8 @@ public class WindowingStrategy<T, W extends BoundedWindow> implements Serializab
         timestampCombiner,
         timestampCombinerSpecified,
         closingBehavior,
-        onTimeBehavior);
+        onTimeBehavior,
+        environmentId);
   }
 
   /**
@@ -200,7 +209,8 @@ public class WindowingStrategy<T, W extends BoundedWindow> implements Serializab
         timestampCombiner,
         timestampCombinerSpecified,
         closingBehavior,
-        onTimeBehavior);
+        onTimeBehavior,
+        environmentId);
   }
 
   /**
@@ -222,7 +232,8 @@ public class WindowingStrategy<T, W extends BoundedWindow> implements Serializab
         timestampCombiner,
         timestampCombinerSpecified,
         closingBehavior,
-        onTimeBehavior);
+        onTimeBehavior,
+        environmentId);
   }
 
   /**
@@ -241,7 +252,8 @@ public class WindowingStrategy<T, W extends BoundedWindow> implements Serializab
         timestampCombiner,
         timestampCombinerSpecified,
         closingBehavior,
-        onTimeBehavior);
+        onTimeBehavior,
+        environmentId);
   }
 
   public WindowingStrategy<T, W> withClosingBehavior(ClosingBehavior closingBehavior) {
@@ -256,7 +268,8 @@ public class WindowingStrategy<T, W extends BoundedWindow> implements Serializab
         timestampCombiner,
         timestampCombinerSpecified,
         closingBehavior,
-        onTimeBehavior);
+        onTimeBehavior,
+        environmentId);
   }
 
   public WindowingStrategy<T, W> withOnTimeBehavior(OnTimeBehavior onTimeBehavior) {
@@ -271,7 +284,8 @@ public class WindowingStrategy<T, W extends BoundedWindow> implements Serializab
         timestampCombiner,
         timestampCombinerSpecified,
         closingBehavior,
-        onTimeBehavior);
+        onTimeBehavior,
+        environmentId);
   }
 
   @Experimental(Kind.OUTPUT_TIME)
@@ -288,7 +302,24 @@ public class WindowingStrategy<T, W extends BoundedWindow> implements Serializab
         timestampCombiner,
         true,
         closingBehavior,
-        onTimeBehavior);
+        onTimeBehavior,
+        environmentId);
+  }
+
+  public WindowingStrategy<T, W> withEnvironmentId(String environmentId) {
+    return new WindowingStrategy<>(
+        windowFn,
+        trigger,
+        triggerSpecified,
+        mode,
+        modeSpecified,
+        allowedLateness,
+        allowedLatenessSpecified,
+        timestampCombiner,
+        timestampCombinerSpecified,
+        closingBehavior,
+        onTimeBehavior,
+        environmentId);
   }
 
   @Override
@@ -299,6 +330,7 @@ public class WindowingStrategy<T, W extends BoundedWindow> implements Serializab
         .add("trigger", trigger)
         .add("accumulationMode", mode)
         .add("timestampCombiner", timestampCombiner)
+        .add("environmentId", environmentId)
         .toString();
   }
 
@@ -317,7 +349,8 @@ public class WindowingStrategy<T, W extends BoundedWindow> implements Serializab
         && getOnTimeBehavior().equals(other.getOnTimeBehavior())
         && getTrigger().equals(other.getTrigger())
         && getTimestampCombiner().equals(other.getTimestampCombiner())
-        && getWindowFn().equals(other.getWindowFn());
+        && getWindowFn().equals(other.getWindowFn())
+        && getEnvironmentId().equals(other.getEnvironmentId());
   }
 
   @Override
@@ -331,7 +364,8 @@ public class WindowingStrategy<T, W extends BoundedWindow> implements Serializab
         closingBehavior,
         trigger,
         timestampCombiner,
-        windowFn);
+        windowFn,
+        environmentId);
   }
 
   /**
@@ -351,6 +385,7 @@ public class WindowingStrategy<T, W extends BoundedWindow> implements Serializab
         timestampCombiner,
         true,
         closingBehavior,
-        onTimeBehavior);
+        onTimeBehavior,
+        environmentId);
   }
 }
diff --git a/sdks/python/apache_beam/runners/dataflow/dataflow_runner.py b/sdks/python/apache_beam/runners/dataflow/dataflow_runner.py
index 38e66384b1a..8f2a9cfd303 100644
--- a/sdks/python/apache_beam/runners/dataflow/dataflow_runner.py
+++ b/sdks/python/apache_beam/runners/dataflow/dataflow_runner.py
@@ -143,6 +143,7 @@ class DataflowRunner(PipelineRunner):
     # "executes" a pipeline.
     self._cache = cache if cache is not None else PValueCache()
     self._unique_step_id = 0
+    self._default_environment = None
 
   def is_fnapi_compatible(self):
     return False
@@ -472,13 +473,14 @@ class DataflowRunner(PipelineRunner):
 
     use_fnapi = apiclient._use_fnapi(options)
     from apache_beam.transforms import environments
-    default_environment = environments.DockerEnvironment.from_container_image(
-        apiclient.get_container_image_from_options(options),
-        artifacts=environments.python_sdk_dependencies(options))
+    self._default_environment = (
+        environments.DockerEnvironment.from_container_image(
+            apiclient.get_container_image_from_options(options),
+            artifacts=environments.python_sdk_dependencies(options)))
 
     # Snapshot the pipeline in a portable proto.
     self.proto_pipeline, self.proto_context = pipeline.to_runner_api(
-        return_context=True, default_environment=default_environment)
+        return_context=True, default_environment=self._default_environment)
 
     if use_fnapi:
       self._check_for_unsupported_fnapi_features(self.proto_pipeline)
@@ -499,7 +501,7 @@ class DataflowRunner(PipelineRunner):
 
       # We need to generate a new context that maps to the new pipeline object.
       self.proto_pipeline, self.proto_context = pipeline.to_runner_api(
-          return_context=True, default_environment=default_environment)
+          return_context=True, default_environment=self._default_environment)
 
     else:
       # Performing configured PTransform overrides which should not be reflected
@@ -740,7 +742,8 @@ class DataflowRunner(PipelineRunner):
 
     step.add_property(
         PropertyNames.WINDOWING_STRATEGY,
-        self.serialize_windowing_strategy(windowing_strategy))
+        self.serialize_windowing_strategy(
+            windowing_strategy, self._default_environment))
     return step
 
   def run_Impulse(self, transform_node, options):
@@ -864,7 +867,7 @@ class DataflowRunner(PipelineRunner):
     windowing = transform_node.transform.get_windowing(transform_node.inputs)
     step.add_property(
         PropertyNames.SERIALIZED_FN,
-        self.serialize_windowing_strategy(windowing))
+        self.serialize_windowing_strategy(windowing, self._default_environment))
 
   def run_RunnerAPIPTransformHolder(self, transform_node, options):
     """Adding Dataflow runner job description for transform holder objects.
@@ -1403,9 +1406,10 @@ class DataflowRunner(PipelineRunner):
   run_TestStream.__test__ = False  # type: ignore[attr-defined]
 
   @classmethod
-  def serialize_windowing_strategy(cls, windowing):
+  def serialize_windowing_strategy(cls, windowing, default_environment):
     from apache_beam.runners import pipeline_context
-    context = pipeline_context.PipelineContext()
+    context = pipeline_context.PipelineContext(
+        default_environment=default_environment)
     windowing_proto = windowing.to_runner_api(context)
     return cls.byte_array_to_json_string(
         beam_runner_api_pb2.MessageWithComponents(
diff --git a/sdks/python/apache_beam/runners/dataflow/dataflow_runner_test.py b/sdks/python/apache_beam/runners/dataflow/dataflow_runner_test.py
index 6adffb34379..1e4f6f9eff6 100644
--- a/sdks/python/apache_beam/runners/dataflow/dataflow_runner_test.py
+++ b/sdks/python/apache_beam/runners/dataflow/dataflow_runner_test.py
@@ -417,7 +417,7 @@ class DataflowRunnerTest(unittest.TestCase, ExtraAssertionsMixin):
     self.assertEqual(
         strategy,
         DataflowRunner.deserialize_windowing_strategy(
-            DataflowRunner.serialize_windowing_strategy(strategy)))
+            DataflowRunner.serialize_windowing_strategy(strategy, None)))
 
   def test_side_input_visitor(self):
     p = TestPipeline()
diff --git a/sdks/python/apache_beam/transforms/core.py b/sdks/python/apache_beam/transforms/core.py
index 119aeb1a859..f1d6dce2b00 100644
--- a/sdks/python/apache_beam/transforms/core.py
+++ b/sdks/python/apache_beam/transforms/core.py
@@ -2289,14 +2289,14 @@ class Partition(PTransformWithSideInputs):
 
 
 class Windowing(object):
-  def __init__(
-      self,
-      windowfn,  # type: WindowFn
-      triggerfn=None,  # type: typing.Optional[TriggerFn]
-      accumulation_mode=None,  # type: typing.Optional[beam_runner_api_pb2.AccumulationMode.Enum]
-      timestamp_combiner=None,  # type: typing.Optional[beam_runner_api_pb2.OutputTime.Enum]
-      allowed_lateness=0,  # type: typing.Union[int, float]
-  ):
+  def __init__(self,
+               windowfn,  # type: WindowFn
+               triggerfn=None,  # type: typing.Optional[TriggerFn]
+               accumulation_mode=None,  # type: typing.Optional[beam_runner_api_pb2.AccumulationMode.Enum]
+               timestamp_combiner=None,  # type: typing.Optional[beam_runner_api_pb2.OutputTime.Enum]
+               allowed_lateness=0, # type: typing.Union[int, float]
+               environment_id=None, # type: str
+               ):
     """Class representing the window strategy.
 
     Args:
@@ -2309,6 +2309,8 @@ class Windowing(object):
       allowed_lateness: Maximum delay in seconds after end of window
         allowed for any late data to be processed without being discarded
         directly.
+      environment_id: Environment where the current window_fn should be
+        applied in.
     """
     global AccumulationMode, DefaultTrigger  # pylint: disable=global-variable-not-assigned
     # pylint: disable=wrong-import-order, wrong-import-position
@@ -2330,6 +2332,7 @@ class Windowing(object):
     self.triggerfn = triggerfn
     self.accumulation_mode = accumulation_mode
     self.allowed_lateness = Duration.of(allowed_lateness)
+    self.environment_id = environment_id
     self.timestamp_combiner = (
         timestamp_combiner or TimestampCombiner.OUTPUT_AT_EOW)
     self._is_default = (
@@ -2340,11 +2343,12 @@ class Windowing(object):
         self.allowed_lateness == 0)
 
   def __repr__(self):
-    return "Windowing(%s, %s, %s, %s)" % (
+    return "Windowing(%s, %s, %s, %s, %s)" % (
         self.windowfn,
         self.triggerfn,
         self.accumulation_mode,
-        self.timestamp_combiner)
+        self.timestamp_combiner,
+        self.environment_id)
 
   def __eq__(self, other):
     if type(self) == type(other):
@@ -2355,7 +2359,8 @@ class Windowing(object):
           self.triggerfn == other.triggerfn and
           self.accumulation_mode == other.accumulation_mode and
           self.timestamp_combiner == other.timestamp_combiner and
-          self.allowed_lateness == other.allowed_lateness)
+          self.allowed_lateness == other.allowed_lateness and
+          self.environment_id == self.environment_id)
     return False
 
   def __ne__(self, other):
@@ -2368,13 +2373,15 @@ class Windowing(object):
         self.triggerfn,
         self.accumulation_mode,
         self.allowed_lateness,
-        self.timestamp_combiner))
+        self.timestamp_combiner,
+        self.environment_id))
 
   def is_default(self):
     return self._is_default
 
   def to_runner_api(self, context):
     # type: (PipelineContext) -> beam_runner_api_pb2.WindowingStrategy
+    environment_id = self.environment_id or context.default_environment_id()
     return beam_runner_api_pb2.WindowingStrategy(
         window_fn=self.windowfn.to_runner_api(context),
         # TODO(robertwb): Prohibit implicit multi-level merging.
@@ -2390,7 +2397,7 @@ class Windowing(object):
         closing_behavior=beam_runner_api_pb2.ClosingBehavior.EMIT_ALWAYS,
         OnTimeBehavior=beam_runner_api_pb2.OnTimeBehavior.FIRE_ALWAYS,
         allowed_lateness=self.allowed_lateness.micros // 1000,
-        environment_id=context.default_environment_id())
+        environment_id=environment_id)
 
   @staticmethod
   def from_runner_api(proto, context):
@@ -2401,7 +2408,8 @@ class Windowing(object):
         triggerfn=TriggerFn.from_runner_api(proto.trigger, context),
         accumulation_mode=proto.accumulation_mode,
         timestamp_combiner=proto.output_time,
-        allowed_lateness=Duration(micros=proto.allowed_lateness * 1000))
+        allowed_lateness=Duration(micros=proto.allowed_lateness * 1000),
+        environment_id=proto.environment_id)
 
 
 @typehints.with_input_types(T)
