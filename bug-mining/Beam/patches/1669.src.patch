diff --git a/sdks/java/testing/expansion-service/build.gradle b/sdks/java/testing/expansion-service/build.gradle
index 635280f2348..8203d0d9561 100644
--- a/sdks/java/testing/expansion-service/build.gradle
+++ b/sdks/java/testing/expansion-service/build.gradle
@@ -48,8 +48,13 @@ task buildTestExpansionServiceJar(type: ShadowJar) {
             'Main-Class': 'org.apache.beam.sdk.expansion.service.ExpansionService'
     )
   }
-  exclude 'META-INF/*.RSA', 'META-INF/*.SF','META-INF/*.DSA'
-  from { project.configurations.testRuntime.collect { it.isDirectory() ? it : zipTree(it) }}
+          exclude "META-INF/INDEX.LIST"
+          exclude "META-INF/*.SF"
+          exclude "META-INF/*.DSA"
+          exclude "META-INF/*.RSA"
+configurations = [
+            project.configurations.testRuntime
+          ]
   from sourceSets.main.output
   from sourceSets.test.output
 }
