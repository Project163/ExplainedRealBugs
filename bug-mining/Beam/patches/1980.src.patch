diff --git a/sdks/java/core/src/main/java/org/apache/beam/sdk/io/DefaultFilenamePolicy.java b/sdks/java/core/src/main/java/org/apache/beam/sdk/io/DefaultFilenamePolicy.java
index 15934b1fb6b..74d556a3fee 100644
--- a/sdks/java/core/src/main/java/org/apache/beam/sdk/io/DefaultFilenamePolicy.java
+++ b/sdks/java/core/src/main/java/org/apache/beam/sdk/io/DefaultFilenamePolicy.java
@@ -171,7 +171,7 @@ public final class DefaultFilenamePolicy extends FilenamePolicy {
   /** A Coder for {@link Params}. */
   public static class ParamsCoder extends AtomicCoder<Params> {
     private static final ParamsCoder INSTANCE = new ParamsCoder();
-    private Coder<String> stringCoder = StringUtf8Coder.of();
+    private static final Coder<String> STRING_CODER = StringUtf8Coder.of();
 
     public static ParamsCoder of() {
       return INSTANCE;
@@ -182,17 +182,17 @@ public final class DefaultFilenamePolicy extends FilenamePolicy {
       if (value == null) {
         throw new CoderException("cannot encode a null value");
       }
-      stringCoder.encode(value.baseFilename.get().toString(), outStream);
-      stringCoder.encode(value.shardTemplate, outStream);
-      stringCoder.encode(value.suffix, outStream);
+      STRING_CODER.encode(value.baseFilename.get().toString(), outStream);
+      STRING_CODER.encode(value.shardTemplate, outStream);
+      STRING_CODER.encode(value.suffix, outStream);
     }
 
     @Override
     public Params decode(InputStream inStream) throws IOException {
       ResourceId prefix =
-          FileBasedSink.convertToFileResourceIfPossible(stringCoder.decode(inStream));
-      String shardTemplate = stringCoder.decode(inStream);
-      String suffix = stringCoder.decode(inStream);
+          FileBasedSink.convertToFileResourceIfPossible(STRING_CODER.decode(inStream));
+      String shardTemplate = STRING_CODER.decode(inStream);
+      String suffix = STRING_CODER.decode(inStream);
       return new Params()
           .withBaseFilename(prefix)
           .withShardTemplate(shardTemplate)
diff --git a/sdks/java/core/src/main/java/org/apache/beam/sdk/io/LocalFileSystem.java b/sdks/java/core/src/main/java/org/apache/beam/sdk/io/LocalFileSystem.java
index 7de18a86a66..026f64f455f 100644
--- a/sdks/java/core/src/main/java/org/apache/beam/sdk/io/LocalFileSystem.java
+++ b/sdks/java/core/src/main/java/org/apache/beam/sdk/io/LocalFileSystem.java
@@ -202,6 +202,10 @@ class LocalFileSystem extends FileSystem<LocalResourceId> {
 
   @Override
   protected LocalResourceId matchNewResource(String singleResourceSpec, boolean isDirectory) {
+    if (singleResourceSpec.endsWith(File.separator) && !isDirectory) {
+      throw new IllegalArgumentException(
+          String.format("Expected file path but received directory path %s", singleResourceSpec));
+    }
     Path path = Paths.get(singleResourceSpec);
     return LocalResourceId.fromPath(path, isDirectory);
   }
diff --git a/sdks/java/core/src/test/java/org/apache/beam/sdk/io/DefaultFilenamePolicyTest.java b/sdks/java/core/src/test/java/org/apache/beam/sdk/io/DefaultFilenamePolicyTest.java
index 97d2bf80465..5ed6cad4223 100644
--- a/sdks/java/core/src/test/java/org/apache/beam/sdk/io/DefaultFilenamePolicyTest.java
+++ b/sdks/java/core/src/test/java/org/apache/beam/sdk/io/DefaultFilenamePolicyTest.java
@@ -19,6 +19,9 @@ package org.apache.beam.sdk.io;
 
 import static org.junit.Assert.assertEquals;
 
+import java.io.ByteArrayInputStream;
+import java.io.ByteArrayOutputStream;
+import java.io.IOException;
 import org.apache.beam.sdk.io.fs.ResourceId;
 import org.junit.Test;
 import org.junit.runner.RunWith;
@@ -48,6 +51,26 @@ public class DefaultFilenamePolicyTest {
     return constructed.toString();
   }
 
+  private static DefaultFilenamePolicy.Params encodeDecodeParams(
+      DefaultFilenamePolicy.Params params) throws IOException {
+    return decodeParams(encodeParams(params));
+  }
+
+  private static byte[] encodeParams(DefaultFilenamePolicy.Params params) throws IOException {
+    try (ByteArrayOutputStream outputStream = new ByteArrayOutputStream()) {
+      DefaultFilenamePolicy.ParamsCoder.of().encode(params, outputStream);
+      outputStream.flush();
+      return outputStream.toByteArray();
+    }
+  }
+
+  private static DefaultFilenamePolicy.Params decodeParams(byte[] encodedParams)
+      throws IOException {
+    try (ByteArrayInputStream inputStream = new ByteArrayInputStream(encodedParams)) {
+      return DefaultFilenamePolicy.ParamsCoder.of().decode(inputStream);
+    }
+  }
+
   @Test
   public void testConstructName() {
     assertEquals(
@@ -131,4 +154,52 @@ public class DefaultFilenamePolicyTest {
         constructName(
             "/path/to/out", "-N/S.part-S-of-N-W-winW-pP", ".txt", 1, 2, "paneL", "sWindow1"));
   }
+
+  @Test
+  public void testParamsCoder() throws IOException {
+    assertEquals(
+        new DefaultFilenamePolicy.Params()
+            .withBaseFilename(FileSystems.matchNewResource("/tmp/file1", false)),
+        encodeDecodeParams(
+            new DefaultFilenamePolicy.Params()
+                .withBaseFilename(FileSystems.matchNewResource("/tmp/file1", false))));
+    assertEquals(
+        new DefaultFilenamePolicy.Params()
+            .withBaseFilename(FileSystems.matchNewResource("/tmp/file2", false))
+            .withSuffix(".json"),
+        encodeDecodeParams(
+            new DefaultFilenamePolicy.Params()
+                .withBaseFilename(FileSystems.matchNewResource("/tmp/file2", false))
+                .withSuffix(".json")));
+
+    assertEquals(
+        new DefaultFilenamePolicy.Params()
+            .withBaseFilename(FileSystems.matchNewResource("/tmp/dir1/", true)),
+        encodeDecodeParams(
+            new DefaultFilenamePolicy.Params()
+                .withBaseFilename(FileSystems.matchNewResource("/tmp/dir1/", true))));
+    assertEquals(
+        new DefaultFilenamePolicy.Params()
+            .withBaseFilename(FileSystems.matchNewResource("/tmp/dir2/", true))
+            .withSuffix(".json"),
+        encodeDecodeParams(
+            new DefaultFilenamePolicy.Params()
+                .withBaseFilename(FileSystems.matchNewResource("/tmp/dir2/", true))
+                .withSuffix(".json")));
+
+    assertEquals(
+        new DefaultFilenamePolicy.Params()
+            .withBaseFilename(FileSystems.matchNewResource("/tmp/dir3", true)),
+        encodeDecodeParams(
+            new DefaultFilenamePolicy.Params()
+                .withBaseFilename(FileSystems.matchNewResource("/tmp/dir3", true))));
+    assertEquals(
+        new DefaultFilenamePolicy.Params()
+            .withBaseFilename(FileSystems.matchNewResource("/tmp/dir4", true))
+            .withSuffix(".json"),
+        encodeDecodeParams(
+            new DefaultFilenamePolicy.Params()
+                .withBaseFilename(FileSystems.matchNewResource("/tmp/dir4", true))
+                .withSuffix(".json")));
+  }
 }
diff --git a/sdks/java/core/src/test/java/org/apache/beam/sdk/io/LocalFileSystemTest.java b/sdks/java/core/src/test/java/org/apache/beam/sdk/io/LocalFileSystemTest.java
index 0dedc0cf343..c846daa9fb9 100644
--- a/sdks/java/core/src/test/java/org/apache/beam/sdk/io/LocalFileSystemTest.java
+++ b/sdks/java/core/src/test/java/org/apache/beam/sdk/io/LocalFileSystemTest.java
@@ -23,6 +23,7 @@ import static org.junit.Assert.assertEquals;
 import static org.junit.Assert.assertFalse;
 import static org.junit.Assert.assertNotEquals;
 import static org.junit.Assert.assertThat;
+import static org.junit.Assert.assertThrows;
 import static org.junit.Assert.assertTrue;
 
 import java.io.File;
@@ -415,7 +416,7 @@ public class LocalFileSystemTest {
   }
 
   @Test
-  public void testMatchNewResource() throws Exception {
+  public void testMatchNewResource() {
     LocalResourceId fileResource =
         localFileSystem.matchNewResource("/some/test/resource/path", false /* isDirectory */);
     LocalResourceId dirResource =
@@ -432,6 +433,12 @@ public class LocalFileSystemTest {
             .resolve("path", StandardResolveOptions.RESOLVE_DIRECTORY),
         equalTo(dirResource.getCurrentDirectory()));
     assertThat(dirResource.toString(), equalTo("/some/test/resource/path/"));
+
+    IllegalArgumentException exception =
+        assertThrows(
+            IllegalArgumentException.class,
+            () -> localFileSystem.matchNewResource("/some/test/resource/path/", false));
+    assertTrue(exception.getMessage().startsWith("Expected file path but received directory path"));
   }
 
   private void createFileWithContent(Path path, String content) throws Exception {
