diff --git a/build.gradle b/build.gradle
index ca311655f07..e526580becc 100644
--- a/build.gradle
+++ b/build.gradle
@@ -65,6 +65,7 @@ buildscript {
     classpath "com.github.ben-manes:gradle-versions-plugin:0.17.0"                                      // Enable dependency checks
     classpath "org.ajoberstar.grgit:grgit-gradle:3.0.0"                                                 // Enable website git publish to asf-site branch
     classpath "com.avast.gradle:gradle-docker-compose-plugin:0.8.8"                                     // Enable docker compose tasks
+    classpath "ca.cutterslade.gradle:gradle-dependency-analyze:1.3.0"                                   // Enable dep analysis
 
     // Plugins which require online access should not be enabled when running in offline mode.
     if (!gradle.startParameter.isOffline()) {
diff --git a/buildSrc/src/main/groovy/org/apache/beam/gradle/BeamModulePlugin.groovy b/buildSrc/src/main/groovy/org/apache/beam/gradle/BeamModulePlugin.groovy
index 396b7aaccb6..3c49a6ee7e3 100644
--- a/buildSrc/src/main/groovy/org/apache/beam/gradle/BeamModulePlugin.groovy
+++ b/buildSrc/src/main/groovy/org/apache/beam/gradle/BeamModulePlugin.groovy
@@ -82,6 +82,9 @@ class BeamModulePlugin implements Plugin<Project> {
     /** Controls whether the findbugs plugin is enabled and configured. */
     boolean enableFindbugs = true
 
+    /** Controls whether the dependency analysis plugin is enabled. */
+    boolean enableStrictDependencies = false
+
     /**
      * List of additional lint warnings to disable.
      * In addition, defaultLintSuppressions defined below
@@ -310,6 +313,15 @@ class BeamModulePlugin implements Plugin<Project> {
     // when attempting to resolve dependency issues.
     project.apply plugin: "project-report"
 
+    // Apply a plugin which fails the build if there is a dependency on a transitive
+    // non-declared dependency, since these can break users (as in BEAM-6558)
+    //
+    // Though this is Java-specific, it is required to be applied to the root
+    // project due to implemeentation-details of the plugin. It can be enabled/disabled
+    // via JavaNatureConfiguration per project. It is disabled by default until we can
+    // make all of our deps good.
+    project.apply plugin: "ca.cutterslade.analyze"
+
     // Adds a taskTree task that prints task dependency tree report to the console.
     // Useful for investigating build issues.
     // See: https://github.com/dorongold/gradle-task-tree
@@ -769,6 +781,16 @@ class BeamModulePlugin implements Plugin<Project> {
         }
       }
 
+      if (configuration.enableStrictDependencies) {
+        project.tasks.analyzeClassesDependencies.enabled = true
+        project.tasks.analyzeDependencies.enabled = true
+        project.tasks.analyzeTestClassesDependencies.enabled = false
+      } else {
+        project.tasks.analyzeClassesDependencies.enabled = false
+        project.tasks.analyzeTestClassesDependencies.enabled = false
+        project.tasks.analyzeDependencies.enabled = false
+      }
+
       // Enable errorprone static analysis
       project.apply plugin: 'net.ltgt.errorprone'
 
diff --git a/sdks/java/extensions/sql/shell/build.gradle b/sdks/java/extensions/sql/shell/build.gradle
index 825a19ec2aa..7a1aa94f7ed 100644
--- a/sdks/java/extensions/sql/shell/build.gradle
+++ b/sdks/java/extensions/sql/shell/build.gradle
@@ -22,10 +22,13 @@ apply plugin: "application"
 
 dependencies {
   compile project(path: ":beam-sdks-java-extensions-sql-jdbc", configuration: "shadow")
+  permitUnusedDeclared project(path: ":beam-sdks-java-extensions-sql-jdbc", configuration: "shadow")
 
   if (project.hasProperty("beam.sql.shell.bundled")) {
     project.getProperty("beam.sql.shell.bundled").tokenize(",").each {
-      subproject -> compile project(path: subproject, configuration: "shadow")
+      subproject ->
+          compile project(path: subproject, configuration: "shadow")
+          permitUnusedDeclared project(path: subproject, configuration: "shadow")
     }
   }
 }
