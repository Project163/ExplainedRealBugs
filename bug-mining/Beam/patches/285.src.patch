diff --git a/runners/direct-java/src/test/java/org/apache/beam/runners/direct/DirectRunnerTest.java b/runners/direct-java/src/test/java/org/apache/beam/runners/direct/DirectRunnerTest.java
index 6f9adc4de95..83881fc46f2 100644
--- a/runners/direct-java/src/test/java/org/apache/beam/runners/direct/DirectRunnerTest.java
+++ b/runners/direct-java/src/test/java/org/apache/beam/runners/direct/DirectRunnerTest.java
@@ -578,4 +578,14 @@ public class DirectRunnerTest implements Serializable {
       return underlying.getDefaultOutputCoder();
     }
   }
+
+  @Test
+  public void fallbackCoderProviderAllowsInference() {
+    // See https://issues.apache.org/jira/browse/BEAM-1642
+    Pipeline p = getPipeline();
+    p.getCoderRegistry().setFallbackCoderProvider(
+        org.apache.beam.sdk.coders.AvroCoder.PROVIDER);
+    p.apply(Create.of(Arrays.asList(100, 200))).apply(Count.<Integer>globally());
+    p.run().waitUntilFinish();
+  }
 }
diff --git a/sdks/java/core/src/main/java/org/apache/beam/sdk/values/TypedPValue.java b/sdks/java/core/src/main/java/org/apache/beam/sdk/values/TypedPValue.java
index 54af7471b29..f47377636db 100644
--- a/sdks/java/core/src/main/java/org/apache/beam/sdk/values/TypedPValue.java
+++ b/sdks/java/core/src/main/java/org/apache/beam/sdk/values/TypedPValue.java
@@ -140,7 +140,16 @@ public abstract class TypedPValue<T> extends PValueBase implements PValue {
       return coderOrFailure;
     }
 
-    // Second option for a coder: Look in the coder registry.
+    // Second option for a coder: use the default Coder from the producing PTransform.
+    CannotProvideCoderException inputCoderException;
+    try {
+      return new CoderOrFailure<>(
+          ((PTransform) transform).getDefaultOutputCoder(input, this), null);
+    } catch (CannotProvideCoderException exc) {
+      inputCoderException = exc;
+    }
+
+    // Third option for a coder: Look in the coder registry.
     TypeDescriptor<T> token = getTypeDescriptor();
     CannotProvideCoderException inferFromTokenException = null;
     if (token != null) {
@@ -162,15 +171,6 @@ public abstract class TypedPValue<T> extends PValueBase implements PValue {
       }
     }
 
-    // Third option for a coder: use the default Coder from the producing PTransform.
-    CannotProvideCoderException inputCoderException;
-    try {
-      return new CoderOrFailure<>(
-          ((PTransform) transform).getDefaultOutputCoder(input, this), null);
-    } catch (CannotProvideCoderException exc) {
-      inputCoderException = exc;
-    }
-
     // Build up the error message and list of causes.
     StringBuilder messageBuilder = new StringBuilder()
         .append("Unable to return a default Coder for ").append(this)
