diff --git a/sdks/go/pkg/beam/core/runtime/exec/translate.go b/sdks/go/pkg/beam/core/runtime/exec/translate.go
index ac80fc3c07b..8b2dd8c8b1f 100644
--- a/sdks/go/pkg/beam/core/runtime/exec/translate.go
+++ b/sdks/go/pkg/beam/core/runtime/exec/translate.go
@@ -563,7 +563,7 @@ func (b *builder) makeLink(from string, id linkID) (Node, error) {
 				// strip unexpected length prefix coder.
 				valCoder = valCoder.Components[0]
 			}
-			u = &Inject{UID: b.idgen.New(), N: (int)(tp.Inject.N), ValueEncoder: MakeElementEncoder(valCoder), Out: out[0]}
+			u = &Inject{UID: b.idgen.New(), N: (int)(tp.GetInject().GetN()), ValueEncoder: MakeElementEncoder(valCoder), Out: out[0]}
 
 		case graphx.URNExpand:
 			var pid string
@@ -589,11 +589,16 @@ func (b *builder) makeLink(from string, id linkID) (Node, error) {
 			u = &Expand{UID: b.idgen.New(), ValueDecoders: decoders, Out: trueOut}
 
 		case graphx.URNReshuffleInput:
-			c, w, err := b.makeCoderForPCollection(from)
+			_, w, err := b.makeCoderForPCollection(from)
 			if err != nil {
 				return nil, err
 			}
-			u = &ReshuffleInput{UID: b.idgen.New(), Seed: rand.Int63(), Coder: coder.NewW(c, w), Out: out[0]}
+			preservedCoderID := tp.GetReshuffle().GetCoderId()
+			pc, err := unmarshalReshuffleCoders(preservedCoderID, tp.GetReshuffle().GetCoderPayloads())
+			if err != nil {
+				return nil, err
+			}
+			u = &ReshuffleInput{UID: b.idgen.New(), Seed: rand.Int63(), Coder: coder.NewW(pc, w), Out: out[0]}
 
 		case graphx.URNReshuffleOutput:
 			var pid string
@@ -602,11 +607,16 @@ func (b *builder) makeLink(from string, id linkID) (Node, error) {
 			for _, id := range transform.GetOutputs() {
 				pid = id
 			}
-			c, w, err := b.makeCoderForPCollection(pid)
+			_, w, err := b.makeCoderForPCollection(pid)
+			if err != nil {
+				return nil, err
+			}
+			preservedCoderID := tp.GetReshuffle().GetCoderId()
+			pc, err := unmarshalReshuffleCoders(preservedCoderID, tp.GetReshuffle().GetCoderPayloads())
 			if err != nil {
 				return nil, err
 			}
-			u = &ReshuffleOutput{UID: b.idgen.New(), Coder: coder.NewW(c, w), Out: out[0]}
+			u = &ReshuffleOutput{UID: b.idgen.New(), Coder: coder.NewW(pc, w), Out: out[0]}
 
 		default:
 			return nil, errors.Errorf("unexpected payload: %v", &tp)
@@ -657,6 +667,19 @@ func (b *builder) makeLink(from string, id linkID) (Node, error) {
 	return u, nil
 }
 
+func unmarshalReshuffleCoders(mainID string, payloads map[string][]byte) (*coder.Coder, error) {
+	m := map[string]*pipepb.Coder{}
+	for id, v := range payloads {
+		pc := &pipepb.Coder{}
+		if err := proto.Unmarshal(v, pc); err != nil {
+			return nil, err
+		}
+		m[id] = pc
+	}
+	um := graphx.NewCoderUnmarshaller(m)
+	return um.Coder(mainID)
+}
+
 // unmarshalKeyedValues converts a map {"i1": "b", ""i0": "a"} into an ordered list of
 // of values: {"a", "b"}. If the keys are not in the expected format, the returned
 // list does not guarantee any order, but will respect ordered values.
diff --git a/sdks/go/pkg/beam/core/runtime/exec/translate_test.go b/sdks/go/pkg/beam/core/runtime/exec/translate_test.go
index 981a2c51c97..8cffe1ad61c 100644
--- a/sdks/go/pkg/beam/core/runtime/exec/translate_test.go
+++ b/sdks/go/pkg/beam/core/runtime/exec/translate_test.go
@@ -18,6 +18,10 @@ package exec
 import (
 	"reflect"
 	"testing"
+
+	"github.com/apache/beam/sdks/v2/go/pkg/beam/core/graph/coder"
+	"github.com/apache/beam/sdks/v2/go/pkg/beam/core/util/protox"
+	pipepb "github.com/apache/beam/sdks/v2/go/pkg/beam/model/pipeline_v1"
 )
 
 func TestUnmarshalKeyedValues(t *testing.T) {
@@ -54,3 +58,28 @@ func TestUnmarshalKeyedValues(t *testing.T) {
 		}
 	}
 }
+
+func TestUnmarshalReshuffleCoders(t *testing.T) {
+	payloads := map[string][]byte{}
+	encode := func(id, urn string, comps ...string) {
+		payloads[id] = protox.MustEncode(&pipepb.Coder{
+			Spec: &pipepb.FunctionSpec{
+				Urn: urn,
+			},
+			ComponentCoderIds: comps,
+		})
+	}
+	encode("a", "beam:coder:bytes:v1")
+	encode("b", "beam:coder:string_utf8:v1")
+	encode("c", "beam:coder:kv:v1", "b", "a")
+
+	got, err := unmarshalReshuffleCoders("c", payloads)
+	if err != nil {
+		t.Fatalf("unmarshalReshuffleCoders() err: %v", err)
+	}
+
+	want := coder.NewKV([]*coder.Coder{coder.NewString(), coder.NewBytes()})
+	if !want.Equals(got) {
+		t.Errorf("got %v, want != %v", got, want)
+	}
+}
diff --git a/sdks/go/pkg/beam/core/runtime/graphx/translate.go b/sdks/go/pkg/beam/core/runtime/graphx/translate.go
index f456f2a0b6d..f88d31d9228 100644
--- a/sdks/go/pkg/beam/core/runtime/graphx/translate.go
+++ b/sdks/go/pkg/beam/core/runtime/graphx/translate.go
@@ -783,6 +783,7 @@ func (m *marshaller) expandReshuffle(edge NamedEdge) (string, error) {
 	// We need to preserve the old windowing/triggering here
 	// for re-instatement after the GBK.
 	preservedWSId := m.pcollections[origInput].GetWindowingStrategyId()
+	preservedCoderId, coderPayloads := m.marshalReshuffleCodersForPCollection(origInput)
 
 	// Get the windowing strategy from before:
 	postReify := fmt.Sprintf("%v_%v_reifyts", nodeID(in.From), id)
@@ -840,6 +841,10 @@ func (m *marshaller) expandReshuffle(edge NamedEdge) (string, error) {
 			Urn: URNReshuffleInput,
 			Payload: []byte(protox.MustEncodeBase64(&v1pb.TransformPayload{
 				Urn: URNReshuffleInput,
+				Reshuffle: &v1pb.ReshufflePayload{
+					CoderId:       preservedCoderId,
+					CoderPayloads: coderPayloads,
+				},
 			})),
 		},
 	}
@@ -889,6 +894,10 @@ func (m *marshaller) expandReshuffle(edge NamedEdge) (string, error) {
 			Urn: URNReshuffleOutput,
 			Payload: []byte(protox.MustEncodeBase64(&v1pb.TransformPayload{
 				Urn: URNReshuffleOutput,
+				Reshuffle: &v1pb.ReshufflePayload{
+					CoderId:       preservedCoderId,
+					CoderPayloads: coderPayloads,
+				},
 			})),
 		},
 	}
@@ -918,6 +927,28 @@ func (m *marshaller) expandReshuffle(edge NamedEdge) (string, error) {
 	return reshuffleID, nil
 }
 
+func (m *marshaller) marshalReshuffleCodersForPCollection(pcolID string) (string, map[string][]byte) {
+	preservedCoderId := m.pcollections[pcolID].GetCoderId()
+
+	cps := map[string][]byte{}
+	cs := []string{preservedCoderId}
+	for cs != nil {
+		var next []string
+		for _, cid := range cs {
+			c := m.coders.coders[cid]
+			cps[cid] = protox.MustEncode(c)
+			for _, newCid := range c.GetComponentCoderIds() {
+				if _, ok := cps[newCid]; !ok {
+					next = append(next, c.GetComponentCoderIds()...)
+				}
+			}
+		}
+		cs = next
+	}
+
+	return preservedCoderId, cps
+}
+
 func (m *marshaller) addNode(n *graph.Node) (string, error) {
 	id := nodeID(n)
 	if _, exists := m.pcollections[id]; exists {
diff --git a/sdks/go/pkg/beam/core/runtime/graphx/translate_test.go b/sdks/go/pkg/beam/core/runtime/graphx/translate_test.go
index 1ce405a1ea4..de481856aba 100644
--- a/sdks/go/pkg/beam/core/runtime/graphx/translate_test.go
+++ b/sdks/go/pkg/beam/core/runtime/graphx/translate_test.go
@@ -143,6 +143,15 @@ func TestMarshal(t *testing.T) {
 			edges:      1,
 			transforms: 2,
 			roots:      1,
+		}, {
+			name: "Reshuffle",
+			makeGraph: func(t *testing.T, g *graph.Graph) {
+				in := newIntInput(g)
+				graph.NewReshuffle(g, g.Root(), in)
+			},
+			edges:      1,
+			transforms: 4,
+			roots:      1,
 		},
 	}
 	for _, test := range tests {
diff --git a/sdks/go/pkg/beam/core/runtime/graphx/v1/v1.pb.go b/sdks/go/pkg/beam/core/runtime/graphx/v1/v1.pb.go
index 22fceace16d..d06b6b308e0 100644
--- a/sdks/go/pkg/beam/core/runtime/graphx/v1/v1.pb.go
+++ b/sdks/go/pkg/beam/core/runtime/graphx/v1/v1.pb.go
@@ -23,8 +23,8 @@
 
 // Code generated by protoc-gen-go. DO NOT EDIT.
 // versions:
-// 	protoc-gen-go v1.27.1
-// 	protoc        v3.14.0
+// 	protoc-gen-go v1.28.0
+// 	protoc        v3.6.1
 // source: v1.proto
 
 package v1
@@ -1032,6 +1032,64 @@ func (x *InjectPayload) GetN() int32 {
 	return 0
 }
 
+// ReshufflePayload is the payload for the built-in reshuffle function.
+type ReshufflePayload struct {
+	state         protoimpl.MessageState
+	sizeCache     protoimpl.SizeCache
+	unknownFields protoimpl.UnknownFields
+
+	// the root id for the reshuffle element
+	CoderId string `protobuf:"bytes,1,opt,name=coder_id,json=coderId,proto3" json:"coder_id,omitempty"`
+	// local coder ids to their serialized pipeline_v1.Coder messages.
+	CoderPayloads map[string][]byte `protobuf:"bytes,2,rep,name=coder_payloads,json=coderPayloads,proto3" json:"coder_payloads,omitempty" protobuf_key:"bytes,1,opt,name=key,proto3" protobuf_val:"bytes,2,opt,name=value,proto3"`
+}
+
+func (x *ReshufflePayload) Reset() {
+	*x = ReshufflePayload{}
+	if protoimpl.UnsafeEnabled {
+		mi := &file_v1_proto_msgTypes[9]
+		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
+		ms.StoreMessageInfo(mi)
+	}
+}
+
+func (x *ReshufflePayload) String() string {
+	return protoimpl.X.MessageStringOf(x)
+}
+
+func (*ReshufflePayload) ProtoMessage() {}
+
+func (x *ReshufflePayload) ProtoReflect() protoreflect.Message {
+	mi := &file_v1_proto_msgTypes[9]
+	if protoimpl.UnsafeEnabled && x != nil {
+		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
+		if ms.LoadMessageInfo() == nil {
+			ms.StoreMessageInfo(mi)
+		}
+		return ms
+	}
+	return mi.MessageOf(x)
+}
+
+// Deprecated: Use ReshufflePayload.ProtoReflect.Descriptor instead.
+func (*ReshufflePayload) Descriptor() ([]byte, []int) {
+	return file_v1_proto_rawDescGZIP(), []int{9}
+}
+
+func (x *ReshufflePayload) GetCoderId() string {
+	if x != nil {
+		return x.CoderId
+	}
+	return ""
+}
+
+func (x *ReshufflePayload) GetCoderPayloads() map[string][]byte {
+	if x != nil {
+		return x.CoderPayloads
+	}
+	return nil
+}
+
 // TransformPayload represents the full payload for transforms, both
 // user defined and built-in.
 type TransformPayload struct {
@@ -1041,15 +1099,16 @@ type TransformPayload struct {
 
 	// urn is included here. It is also present in the model pipeline, but
 	// not when submitting through Dataflow yet.
-	Urn    string         `protobuf:"bytes,1,opt,name=urn,proto3" json:"urn,omitempty"`
-	Edge   *MultiEdge     `protobuf:"bytes,2,opt,name=edge,proto3" json:"edge,omitempty"`
-	Inject *InjectPayload `protobuf:"bytes,3,opt,name=inject,proto3" json:"inject,omitempty"`
+	Urn       string            `protobuf:"bytes,1,opt,name=urn,proto3" json:"urn,omitempty"`
+	Edge      *MultiEdge        `protobuf:"bytes,2,opt,name=edge,proto3" json:"edge,omitempty"`
+	Inject    *InjectPayload    `protobuf:"bytes,3,opt,name=inject,proto3" json:"inject,omitempty"`
+	Reshuffle *ReshufflePayload `protobuf:"bytes,4,opt,name=reshuffle,proto3" json:"reshuffle,omitempty"`
 }
 
 func (x *TransformPayload) Reset() {
 	*x = TransformPayload{}
 	if protoimpl.UnsafeEnabled {
-		mi := &file_v1_proto_msgTypes[9]
+		mi := &file_v1_proto_msgTypes[10]
 		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
 		ms.StoreMessageInfo(mi)
 	}
@@ -1062,7 +1121,7 @@ func (x *TransformPayload) String() string {
 func (*TransformPayload) ProtoMessage() {}
 
 func (x *TransformPayload) ProtoReflect() protoreflect.Message {
-	mi := &file_v1_proto_msgTypes[9]
+	mi := &file_v1_proto_msgTypes[10]
 	if protoimpl.UnsafeEnabled && x != nil {
 		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
 		if ms.LoadMessageInfo() == nil {
@@ -1075,7 +1134,7 @@ func (x *TransformPayload) ProtoReflect() protoreflect.Message {
 
 // Deprecated: Use TransformPayload.ProtoReflect.Descriptor instead.
 func (*TransformPayload) Descriptor() ([]byte, []int) {
-	return file_v1_proto_rawDescGZIP(), []int{9}
+	return file_v1_proto_rawDescGZIP(), []int{10}
 }
 
 func (x *TransformPayload) GetUrn() string {
@@ -1099,6 +1158,13 @@ func (x *TransformPayload) GetInject() *InjectPayload {
 	return nil
 }
 
+func (x *TransformPayload) GetReshuffle() *ReshufflePayload {
+	if x != nil {
+		return x.Reshuffle
+	}
+	return nil
+}
+
 // StructField matches reflect.StructField.
 type Type_StructField struct {
 	state         protoimpl.MessageState
@@ -1117,7 +1183,7 @@ type Type_StructField struct {
 func (x *Type_StructField) Reset() {
 	*x = Type_StructField{}
 	if protoimpl.UnsafeEnabled {
-		mi := &file_v1_proto_msgTypes[10]
+		mi := &file_v1_proto_msgTypes[11]
 		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
 		ms.StoreMessageInfo(mi)
 	}
@@ -1130,7 +1196,7 @@ func (x *Type_StructField) String() string {
 func (*Type_StructField) ProtoMessage() {}
 
 func (x *Type_StructField) ProtoReflect() protoreflect.Message {
-	mi := &file_v1_proto_msgTypes[10]
+	mi := &file_v1_proto_msgTypes[11]
 	if protoimpl.UnsafeEnabled && x != nil {
 		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
 		if ms.LoadMessageInfo() == nil {
@@ -1207,7 +1273,7 @@ type MultiEdge_Inbound struct {
 func (x *MultiEdge_Inbound) Reset() {
 	*x = MultiEdge_Inbound{}
 	if protoimpl.UnsafeEnabled {
-		mi := &file_v1_proto_msgTypes[11]
+		mi := &file_v1_proto_msgTypes[12]
 		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
 		ms.StoreMessageInfo(mi)
 	}
@@ -1220,7 +1286,7 @@ func (x *MultiEdge_Inbound) String() string {
 func (*MultiEdge_Inbound) ProtoMessage() {}
 
 func (x *MultiEdge_Inbound) ProtoReflect() protoreflect.Message {
-	mi := &file_v1_proto_msgTypes[11]
+	mi := &file_v1_proto_msgTypes[12]
 	if protoimpl.UnsafeEnabled && x != nil {
 		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
 		if ms.LoadMessageInfo() == nil {
@@ -1261,7 +1327,7 @@ type MultiEdge_Outbound struct {
 func (x *MultiEdge_Outbound) Reset() {
 	*x = MultiEdge_Outbound{}
 	if protoimpl.UnsafeEnabled {
-		mi := &file_v1_proto_msgTypes[12]
+		mi := &file_v1_proto_msgTypes[13]
 		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
 		ms.StoreMessageInfo(mi)
 	}
@@ -1274,7 +1340,7 @@ func (x *MultiEdge_Outbound) String() string {
 func (*MultiEdge_Outbound) ProtoMessage() {}
 
 func (x *MultiEdge_Outbound) ProtoReflect() protoreflect.Message {
-	mi := &file_v1_proto_msgTypes[12]
+	mi := &file_v1_proto_msgTypes[13]
 	if protoimpl.UnsafeEnabled && x != nil {
 		ms := protoimpl.X.MessageStateOf(protoimpl.Pointer(x))
 		if ms.LoadMessageInfo() == nil {
@@ -1521,26 +1587,48 @@ var file_v1_proto_rawDesc = []byte{
 	0x61, 0x70, 0x68, 0x78, 0x2e, 0x76, 0x31, 0x2e, 0x46, 0x75, 0x6c, 0x6c, 0x54, 0x79, 0x70, 0x65,
 	0x52, 0x04, 0x74, 0x79, 0x70, 0x65, 0x22, 0x1d, 0x0a, 0x0d, 0x49, 0x6e, 0x6a, 0x65, 0x63, 0x74,
 	0x50, 0x61, 0x79, 0x6c, 0x6f, 0x61, 0x64, 0x12, 0x0c, 0x0a, 0x01, 0x6e, 0x18, 0x01, 0x20, 0x01,
-	0x28, 0x05, 0x52, 0x01, 0x6e, 0x22, 0xdc, 0x01, 0x0a, 0x10, 0x54, 0x72, 0x61, 0x6e, 0x73, 0x66,
-	0x6f, 0x72, 0x6d, 0x50, 0x61, 0x79, 0x6c, 0x6f, 0x61, 0x64, 0x12, 0x10, 0x0a, 0x03, 0x75, 0x72,
-	0x6e, 0x18, 0x01, 0x20, 0x01, 0x28, 0x09, 0x52, 0x03, 0x75, 0x72, 0x6e, 0x12, 0x56, 0x0a, 0x04,
-	0x65, 0x64, 0x67, 0x65, 0x18, 0x02, 0x20, 0x01, 0x28, 0x0b, 0x32, 0x42, 0x2e, 0x6f, 0x72, 0x67,
-	0x2e, 0x61, 0x70, 0x61, 0x63, 0x68, 0x65, 0x2e, 0x62, 0x65, 0x61, 0x6d, 0x2e, 0x73, 0x64, 0x6b,
-	0x73, 0x2e, 0x67, 0x6f, 0x2e, 0x70, 0x6b, 0x67, 0x2e, 0x62, 0x65, 0x61, 0x6d, 0x2e, 0x63, 0x6f,
-	0x72, 0x65, 0x2e, 0x72, 0x75, 0x6e, 0x74, 0x69, 0x6d, 0x65, 0x2e, 0x67, 0x72, 0x61, 0x70, 0x68,
-	0x78, 0x2e, 0x76, 0x31, 0x2e, 0x4d, 0x75, 0x6c, 0x74, 0x69, 0x45, 0x64, 0x67, 0x65, 0x52, 0x04,
-	0x65, 0x64, 0x67, 0x65, 0x12, 0x5e, 0x0a, 0x06, 0x69, 0x6e, 0x6a, 0x65, 0x63, 0x74, 0x18, 0x03,
-	0x20, 0x01, 0x28, 0x0b, 0x32, 0x46, 0x2e, 0x6f, 0x72, 0x67, 0x2e, 0x61, 0x70, 0x61, 0x63, 0x68,
-	0x65, 0x2e, 0x62, 0x65, 0x61, 0x6d, 0x2e, 0x73, 0x64, 0x6b, 0x73, 0x2e, 0x67, 0x6f, 0x2e, 0x70,
-	0x6b, 0x67, 0x2e, 0x62, 0x65, 0x61, 0x6d, 0x2e, 0x63, 0x6f, 0x72, 0x65, 0x2e, 0x72, 0x75, 0x6e,
-	0x74, 0x69, 0x6d, 0x65, 0x2e, 0x67, 0x72, 0x61, 0x70, 0x68, 0x78, 0x2e, 0x76, 0x31, 0x2e, 0x49,
-	0x6e, 0x6a, 0x65, 0x63, 0x74, 0x50, 0x61, 0x79, 0x6c, 0x6f, 0x61, 0x64, 0x52, 0x06, 0x69, 0x6e,
-	0x6a, 0x65, 0x63, 0x74, 0x42, 0x46, 0x5a, 0x44, 0x67, 0x69, 0x74, 0x68, 0x75, 0x62, 0x2e, 0x63,
-	0x6f, 0x6d, 0x2f, 0x61, 0x70, 0x61, 0x63, 0x68, 0x65, 0x2f, 0x62, 0x65, 0x61, 0x6d, 0x2f, 0x73,
-	0x64, 0x6b, 0x73, 0x2f, 0x76, 0x32, 0x2f, 0x67, 0x6f, 0x2f, 0x70, 0x6b, 0x67, 0x2f, 0x62, 0x65,
-	0x61, 0x6d, 0x2f, 0x63, 0x6f, 0x72, 0x65, 0x2f, 0x72, 0x75, 0x6e, 0x74, 0x69, 0x6d, 0x65, 0x2f,
-	0x67, 0x72, 0x61, 0x70, 0x68, 0x78, 0x2f, 0x76, 0x31, 0x3b, 0x76, 0x31, 0x62, 0x06, 0x70, 0x72,
-	0x6f, 0x74, 0x6f, 0x33,
+	0x28, 0x05, 0x52, 0x01, 0x6e, 0x22, 0xf5, 0x01, 0x0a, 0x10, 0x52, 0x65, 0x73, 0x68, 0x75, 0x66,
+	0x66, 0x6c, 0x65, 0x50, 0x61, 0x79, 0x6c, 0x6f, 0x61, 0x64, 0x12, 0x19, 0x0a, 0x08, 0x63, 0x6f,
+	0x64, 0x65, 0x72, 0x5f, 0x69, 0x64, 0x18, 0x01, 0x20, 0x01, 0x28, 0x09, 0x52, 0x07, 0x63, 0x6f,
+	0x64, 0x65, 0x72, 0x49, 0x64, 0x12, 0x83, 0x01, 0x0a, 0x0e, 0x63, 0x6f, 0x64, 0x65, 0x72, 0x5f,
+	0x70, 0x61, 0x79, 0x6c, 0x6f, 0x61, 0x64, 0x73, 0x18, 0x02, 0x20, 0x03, 0x28, 0x0b, 0x32, 0x5c,
+	0x2e, 0x6f, 0x72, 0x67, 0x2e, 0x61, 0x70, 0x61, 0x63, 0x68, 0x65, 0x2e, 0x62, 0x65, 0x61, 0x6d,
+	0x2e, 0x73, 0x64, 0x6b, 0x73, 0x2e, 0x67, 0x6f, 0x2e, 0x70, 0x6b, 0x67, 0x2e, 0x62, 0x65, 0x61,
+	0x6d, 0x2e, 0x63, 0x6f, 0x72, 0x65, 0x2e, 0x72, 0x75, 0x6e, 0x74, 0x69, 0x6d, 0x65, 0x2e, 0x67,
+	0x72, 0x61, 0x70, 0x68, 0x78, 0x2e, 0x76, 0x31, 0x2e, 0x52, 0x65, 0x73, 0x68, 0x75, 0x66, 0x66,
+	0x6c, 0x65, 0x50, 0x61, 0x79, 0x6c, 0x6f, 0x61, 0x64, 0x2e, 0x43, 0x6f, 0x64, 0x65, 0x72, 0x50,
+	0x61, 0x79, 0x6c, 0x6f, 0x61, 0x64, 0x73, 0x45, 0x6e, 0x74, 0x72, 0x79, 0x52, 0x0d, 0x63, 0x6f,
+	0x64, 0x65, 0x72, 0x50, 0x61, 0x79, 0x6c, 0x6f, 0x61, 0x64, 0x73, 0x1a, 0x40, 0x0a, 0x12, 0x43,
+	0x6f, 0x64, 0x65, 0x72, 0x50, 0x61, 0x79, 0x6c, 0x6f, 0x61, 0x64, 0x73, 0x45, 0x6e, 0x74, 0x72,
+	0x79, 0x12, 0x10, 0x0a, 0x03, 0x6b, 0x65, 0x79, 0x18, 0x01, 0x20, 0x01, 0x28, 0x09, 0x52, 0x03,
+	0x6b, 0x65, 0x79, 0x12, 0x14, 0x0a, 0x05, 0x76, 0x61, 0x6c, 0x75, 0x65, 0x18, 0x02, 0x20, 0x01,
+	0x28, 0x0c, 0x52, 0x05, 0x76, 0x61, 0x6c, 0x75, 0x65, 0x3a, 0x02, 0x38, 0x01, 0x22, 0xc5, 0x02,
+	0x0a, 0x10, 0x54, 0x72, 0x61, 0x6e, 0x73, 0x66, 0x6f, 0x72, 0x6d, 0x50, 0x61, 0x79, 0x6c, 0x6f,
+	0x61, 0x64, 0x12, 0x10, 0x0a, 0x03, 0x75, 0x72, 0x6e, 0x18, 0x01, 0x20, 0x01, 0x28, 0x09, 0x52,
+	0x03, 0x75, 0x72, 0x6e, 0x12, 0x56, 0x0a, 0x04, 0x65, 0x64, 0x67, 0x65, 0x18, 0x02, 0x20, 0x01,
+	0x28, 0x0b, 0x32, 0x42, 0x2e, 0x6f, 0x72, 0x67, 0x2e, 0x61, 0x70, 0x61, 0x63, 0x68, 0x65, 0x2e,
+	0x62, 0x65, 0x61, 0x6d, 0x2e, 0x73, 0x64, 0x6b, 0x73, 0x2e, 0x67, 0x6f, 0x2e, 0x70, 0x6b, 0x67,
+	0x2e, 0x62, 0x65, 0x61, 0x6d, 0x2e, 0x63, 0x6f, 0x72, 0x65, 0x2e, 0x72, 0x75, 0x6e, 0x74, 0x69,
+	0x6d, 0x65, 0x2e, 0x67, 0x72, 0x61, 0x70, 0x68, 0x78, 0x2e, 0x76, 0x31, 0x2e, 0x4d, 0x75, 0x6c,
+	0x74, 0x69, 0x45, 0x64, 0x67, 0x65, 0x52, 0x04, 0x65, 0x64, 0x67, 0x65, 0x12, 0x5e, 0x0a, 0x06,
+	0x69, 0x6e, 0x6a, 0x65, 0x63, 0x74, 0x18, 0x03, 0x20, 0x01, 0x28, 0x0b, 0x32, 0x46, 0x2e, 0x6f,
+	0x72, 0x67, 0x2e, 0x61, 0x70, 0x61, 0x63, 0x68, 0x65, 0x2e, 0x62, 0x65, 0x61, 0x6d, 0x2e, 0x73,
+	0x64, 0x6b, 0x73, 0x2e, 0x67, 0x6f, 0x2e, 0x70, 0x6b, 0x67, 0x2e, 0x62, 0x65, 0x61, 0x6d, 0x2e,
+	0x63, 0x6f, 0x72, 0x65, 0x2e, 0x72, 0x75, 0x6e, 0x74, 0x69, 0x6d, 0x65, 0x2e, 0x67, 0x72, 0x61,
+	0x70, 0x68, 0x78, 0x2e, 0x76, 0x31, 0x2e, 0x49, 0x6e, 0x6a, 0x65, 0x63, 0x74, 0x50, 0x61, 0x79,
+	0x6c, 0x6f, 0x61, 0x64, 0x52, 0x06, 0x69, 0x6e, 0x6a, 0x65, 0x63, 0x74, 0x12, 0x67, 0x0a, 0x09,
+	0x72, 0x65, 0x73, 0x68, 0x75, 0x66, 0x66, 0x6c, 0x65, 0x18, 0x04, 0x20, 0x01, 0x28, 0x0b, 0x32,
+	0x49, 0x2e, 0x6f, 0x72, 0x67, 0x2e, 0x61, 0x70, 0x61, 0x63, 0x68, 0x65, 0x2e, 0x62, 0x65, 0x61,
+	0x6d, 0x2e, 0x73, 0x64, 0x6b, 0x73, 0x2e, 0x67, 0x6f, 0x2e, 0x70, 0x6b, 0x67, 0x2e, 0x62, 0x65,
+	0x61, 0x6d, 0x2e, 0x63, 0x6f, 0x72, 0x65, 0x2e, 0x72, 0x75, 0x6e, 0x74, 0x69, 0x6d, 0x65, 0x2e,
+	0x67, 0x72, 0x61, 0x70, 0x68, 0x78, 0x2e, 0x76, 0x31, 0x2e, 0x52, 0x65, 0x73, 0x68, 0x75, 0x66,
+	0x66, 0x6c, 0x65, 0x50, 0x61, 0x79, 0x6c, 0x6f, 0x61, 0x64, 0x52, 0x09, 0x72, 0x65, 0x73, 0x68,
+	0x75, 0x66, 0x66, 0x6c, 0x65, 0x42, 0x46, 0x5a, 0x44, 0x67, 0x69, 0x74, 0x68, 0x75, 0x62, 0x2e,
+	0x63, 0x6f, 0x6d, 0x2f, 0x61, 0x70, 0x61, 0x63, 0x68, 0x65, 0x2f, 0x62, 0x65, 0x61, 0x6d, 0x2f,
+	0x73, 0x64, 0x6b, 0x73, 0x2f, 0x76, 0x32, 0x2f, 0x67, 0x6f, 0x2f, 0x70, 0x6b, 0x67, 0x2f, 0x62,
+	0x65, 0x61, 0x6d, 0x2f, 0x63, 0x6f, 0x72, 0x65, 0x2f, 0x72, 0x75, 0x6e, 0x74, 0x69, 0x6d, 0x65,
+	0x2f, 0x67, 0x72, 0x61, 0x70, 0x68, 0x78, 0x2f, 0x76, 0x31, 0x3b, 0x76, 0x31, 0x62, 0x06, 0x70,
+	0x72, 0x6f, 0x74, 0x6f, 0x33,
 }
 
 var (
@@ -1556,7 +1644,7 @@ func file_v1_proto_rawDescGZIP() []byte {
 }
 
 var file_v1_proto_enumTypes = make([]protoimpl.EnumInfo, 4)
-var file_v1_proto_msgTypes = make([]protoimpl.MessageInfo, 13)
+var file_v1_proto_msgTypes = make([]protoimpl.MessageInfo, 15)
 var file_v1_proto_goTypes = []interface{}{
 	(Type_Kind)(0),                   // 0: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.Type.Kind
 	(Type_ChanDir)(0),                // 1: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.Type.ChanDir
@@ -1571,15 +1659,17 @@ var file_v1_proto_goTypes = []interface{}{
 	(*CustomCoder)(nil),              // 10: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.CustomCoder
 	(*MultiEdge)(nil),                // 11: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge
 	(*InjectPayload)(nil),            // 12: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.InjectPayload
-	(*TransformPayload)(nil),         // 13: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.TransformPayload
-	(*Type_StructField)(nil),         // 14: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.Type.StructField
-	(*MultiEdge_Inbound)(nil),        // 15: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge.Inbound
-	(*MultiEdge_Outbound)(nil),       // 16: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge.Outbound
+	(*ReshufflePayload)(nil),         // 13: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.ReshufflePayload
+	(*TransformPayload)(nil),         // 14: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.TransformPayload
+	(*Type_StructField)(nil),         // 15: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.Type.StructField
+	(*MultiEdge_Inbound)(nil),        // 16: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge.Inbound
+	(*MultiEdge_Outbound)(nil),       // 17: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge.Outbound
+	nil,                              // 18: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.ReshufflePayload.CoderPayloadsEntry
 }
 var file_v1_proto_depIdxs = []int32{
 	0,  // 0: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.Type.kind:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.Type.Kind
 	4,  // 1: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.Type.element:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.Type
-	14, // 2: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.Type.fields:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.Type.StructField
+	15, // 2: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.Type.fields:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.Type.StructField
 	4,  // 3: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.Type.parameter_types:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.Type
 	4,  // 4: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.Type.return_types:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.Type
 	1,  // 5: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.Type.chan_dir:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.Type.ChanDir
@@ -1596,19 +1686,21 @@ var file_v1_proto_depIdxs = []int32{
 	6,  // 16: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.CustomCoder.dec:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.UserFn
 	8,  // 17: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge.fn:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.Fn
 	9,  // 18: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge.window_fn:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.WindowFn
-	15, // 19: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge.inbound:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge.Inbound
-	16, // 20: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge.outbound:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge.Outbound
-	11, // 21: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.TransformPayload.edge:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge
-	12, // 22: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.TransformPayload.inject:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.InjectPayload
-	4,  // 23: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.Type.StructField.type:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.Type
-	3,  // 24: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge.Inbound.kind:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge.Inbound.InputKind
-	5,  // 25: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge.Inbound.type:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.FullType
-	5,  // 26: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge.Outbound.type:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.FullType
-	27, // [27:27] is the sub-list for method output_type
-	27, // [27:27] is the sub-list for method input_type
-	27, // [27:27] is the sub-list for extension type_name
-	27, // [27:27] is the sub-list for extension extendee
-	0,  // [0:27] is the sub-list for field type_name
+	16, // 19: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge.inbound:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge.Inbound
+	17, // 20: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge.outbound:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge.Outbound
+	18, // 21: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.ReshufflePayload.coder_payloads:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.ReshufflePayload.CoderPayloadsEntry
+	11, // 22: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.TransformPayload.edge:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge
+	12, // 23: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.TransformPayload.inject:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.InjectPayload
+	13, // 24: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.TransformPayload.reshuffle:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.ReshufflePayload
+	4,  // 25: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.Type.StructField.type:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.Type
+	3,  // 26: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge.Inbound.kind:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge.Inbound.InputKind
+	5,  // 27: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge.Inbound.type:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.FullType
+	5,  // 28: org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.MultiEdge.Outbound.type:type_name -> org.apache.beam.sdks.go.pkg.beam.core.runtime.graphx.v1.FullType
+	29, // [29:29] is the sub-list for method output_type
+	29, // [29:29] is the sub-list for method input_type
+	29, // [29:29] is the sub-list for extension type_name
+	29, // [29:29] is the sub-list for extension extendee
+	0,  // [0:29] is the sub-list for field type_name
 }
 
 func init() { file_v1_proto_init() }
@@ -1726,7 +1818,7 @@ func file_v1_proto_init() {
 			}
 		}
 		file_v1_proto_msgTypes[9].Exporter = func(v interface{}, i int) interface{} {
-			switch v := v.(*TransformPayload); i {
+			switch v := v.(*ReshufflePayload); i {
 			case 0:
 				return &v.state
 			case 1:
@@ -1738,7 +1830,7 @@ func file_v1_proto_init() {
 			}
 		}
 		file_v1_proto_msgTypes[10].Exporter = func(v interface{}, i int) interface{} {
-			switch v := v.(*Type_StructField); i {
+			switch v := v.(*TransformPayload); i {
 			case 0:
 				return &v.state
 			case 1:
@@ -1750,7 +1842,7 @@ func file_v1_proto_init() {
 			}
 		}
 		file_v1_proto_msgTypes[11].Exporter = func(v interface{}, i int) interface{} {
-			switch v := v.(*MultiEdge_Inbound); i {
+			switch v := v.(*Type_StructField); i {
 			case 0:
 				return &v.state
 			case 1:
@@ -1762,6 +1854,18 @@ func file_v1_proto_init() {
 			}
 		}
 		file_v1_proto_msgTypes[12].Exporter = func(v interface{}, i int) interface{} {
+			switch v := v.(*MultiEdge_Inbound); i {
+			case 0:
+				return &v.state
+			case 1:
+				return &v.sizeCache
+			case 2:
+				return &v.unknownFields
+			default:
+				return nil
+			}
+		}
+		file_v1_proto_msgTypes[13].Exporter = func(v interface{}, i int) interface{} {
 			switch v := v.(*MultiEdge_Outbound); i {
 			case 0:
 				return &v.state
@@ -1780,7 +1884,7 @@ func file_v1_proto_init() {
 			GoPackagePath: reflect.TypeOf(x{}).PkgPath(),
 			RawDescriptor: file_v1_proto_rawDesc,
 			NumEnums:      4,
-			NumMessages:   13,
+			NumMessages:   15,
 			NumExtensions: 0,
 			NumServices:   0,
 		},
diff --git a/sdks/go/pkg/beam/core/runtime/graphx/v1/v1.proto b/sdks/go/pkg/beam/core/runtime/graphx/v1/v1.proto
index 2349a20922c..ef84c20887a 100644
--- a/sdks/go/pkg/beam/core/runtime/graphx/v1/v1.proto
+++ b/sdks/go/pkg/beam/core/runtime/graphx/v1/v1.proto
@@ -236,6 +236,14 @@ message InjectPayload {
     int32 n = 1;
 }
 
+// ReshufflePayload is the payload for the built-in reshuffle function.
+message ReshufflePayload {
+    // the root coder id for the reshuffle element
+    string coder_id = 1;
+    // local coder ids to their serialized pipeline_v1.Coder messages.
+    map<string, bytes> coder_payloads = 2;
+}
+
 // TransformPayload represents the full payload for transforms, both
 // user defined and built-in.
 message TransformPayload {
@@ -245,4 +253,5 @@ message TransformPayload {
 
     MultiEdge edge = 2;
     InjectPayload inject = 3;
+    ReshufflePayload reshuffle = 4;
 }
diff --git a/sdks/go/test/regression/lperror.go b/sdks/go/test/regression/lperror.go
index 4555e503683..4e6e22f3eb4 100644
--- a/sdks/go/test/regression/lperror.go
+++ b/sdks/go/test/regression/lperror.go
@@ -16,6 +16,11 @@
 package regression
 
 import (
+	"context"
+	"fmt"
+	"reflect"
+	"sort"
+
 	"github.com/apache/beam/sdks/v2/go/pkg/beam"
 )
 
@@ -61,3 +66,66 @@ func LPErrorPipeline(s beam.Scope) beam.PCollection {
 	// [0]
 	return beam.ParDo(s, toID, fruitsFooCoGBK)
 }
+
+const (
+	// MetricNamespace is the namespace for regression test metrics.
+	MetricNamespace = string("regression")
+	// FruitCounterName is the name of the fruit counter metric.
+	FruitCounterName = string("fruitCount")
+)
+
+func sendFruit(_ []byte, emit func(fruit)) {
+	emit(fruit{"Apple"})
+	emit(fruit{"Banana"})
+	emit(fruit{"Cherry"})
+}
+
+// countFruit counts the fruit that pass through.
+func countFruit(ctx context.Context, v fruit) fruit {
+	beam.NewCounter(MetricNamespace, FruitCounterName).Inc(ctx, 1)
+	return v
+}
+
+type iterSideStrings struct {
+	Wants []string
+}
+
+func (fn *iterSideStrings) ProcessElement(_ []byte, iter func(*fruit) bool) error {
+	var val fruit
+	var gots []string
+	for iter(&val) {
+		gots = append(gots, val.Name)
+	}
+	sort.Strings(gots)
+	sort.Strings(fn.Wants)
+
+	if got, want := len(gots), len(fn.Wants); got != want {
+		return fmt.Errorf("len mismatch between lists. got %v, want %v; \n\t got: %v \n\twant: %v", got, want, gots, fn.Wants)
+	}
+
+	for i := range fn.Wants {
+		if got, want := gots[i], fn.Wants[i]; got != want {
+			return fmt.Errorf("mismatch value in sorted list at index %d: got %v, want %v", i, got, want)
+		}
+	}
+	return nil
+}
+
+func init() {
+	beam.RegisterFunction(countFruit)
+	beam.RegisterFunction(sendFruit)
+	beam.RegisterType(reflect.TypeOf((*iterSideStrings)(nil)))
+	beam.RegisterType(reflect.TypeOf((*fruit)(nil)).Elem())
+}
+
+// LPErrorReshufflePipeline checks a Row type with reshuffle transforms.
+// It's intentionally just a prefix with validation done in the specific
+// test cases, as the success/failure is dependent on subsequent pipeline
+// use of data.
+//
+// This pipeline will output a pcollection containing 3 fruit.
+func LPErrorReshufflePipeline(s beam.Scope) beam.PCollection {
+	sf := s.Scope("Basket")
+	fruits := beam.ParDo(sf, sendFruit, beam.Impulse(sf))
+	return beam.Reshuffle(sf, fruits)
+}
diff --git a/sdks/go/test/regression/lperror_test.go b/sdks/go/test/regression/lperror_test.go
index a638dbeb47d..7e99e73c9f8 100644
--- a/sdks/go/test/regression/lperror_test.go
+++ b/sdks/go/test/regression/lperror_test.go
@@ -19,6 +19,7 @@ import (
 	"testing"
 
 	"github.com/apache/beam/sdks/v2/go/pkg/beam"
+	"github.com/apache/beam/sdks/v2/go/pkg/beam/core/metrics"
 	"github.com/apache/beam/sdks/v2/go/pkg/beam/testing/passert"
 	"github.com/apache/beam/sdks/v2/go/pkg/beam/testing/ptest"
 	"github.com/apache/beam/sdks/v2/go/test/integration"
@@ -39,3 +40,85 @@ func TestLPErrorPipeline(t *testing.T) {
 
 	ptest.RunAndValidate(t, pipeline)
 }
+
+func TestLPErrorReshufflePipeline(t *testing.T) {
+	integration.CheckFilters(t)
+
+	pipeline, s := beam.NewPipelineWithRoot()
+	LPErrorReshufflePipeline(s)
+
+	ptest.RunAndValidate(t, pipeline)
+}
+
+func TestLPErrorReshufflePipeline_PAssert(t *testing.T) {
+	integration.CheckFilters(t)
+
+	pipeline, s := beam.NewPipelineWithRoot()
+	got := LPErrorReshufflePipeline(s)
+	passert.Equals(s, got, fruit{"Apple"}, fruit{"Banana"}, fruit{"Cherry"})
+
+	ptest.RunAndValidate(t, pipeline)
+}
+
+func TestLPErrorReshufflePipeline_SideInput(t *testing.T) {
+	integration.CheckFilters(t)
+
+	pipeline, s := beam.NewPipelineWithRoot()
+	got := LPErrorReshufflePipeline(s)
+	beam.ParDo0(s, &iterSideStrings{
+		Wants: []string{"Apple", "Banana", "Cherry"},
+	}, beam.Impulse(s), beam.SideInput{Input: got})
+
+	ptest.RunAndValidate(t, pipeline)
+}
+
+func checkFruitCount(t *testing.T, pr beam.PipelineResult) {
+	t.Helper()
+	fcr := pr.Metrics().Query(func(sr metrics.SingleResult) bool {
+		return sr.Namespace() == MetricNamespace && sr.Name() == FruitCounterName
+	})
+	if len(fcr.Counters()) == 0 {
+		t.Logf("no counters found: check if %v supports counters", *ptest.Runner)
+		return
+	}
+	if got, want := fcr.Counters()[0].Result(), int64(3); got != want {
+		t.Errorf("unexpected fruit count: got %v, want %v", got, want)
+	}
+}
+
+func TestLPErrorReshufflePipeline_DoFn(t *testing.T) {
+	integration.CheckFilters(t)
+
+	pipeline, s := beam.NewPipelineWithRoot()
+	got := LPErrorReshufflePipeline(s)
+	beam.ParDo(s, countFruit, got)
+
+	pr := ptest.RunAndValidate(t, pipeline)
+	checkFruitCount(t, pr)
+}
+
+func TestLPErrorReshufflePipeline_DoFnPAssert(t *testing.T) {
+	integration.CheckFilters(t)
+
+	pipeline, s := beam.NewPipelineWithRoot()
+	got := LPErrorReshufflePipeline(s)
+	counted := beam.ParDo(s, countFruit, got)
+	passert.Equals(s, counted, fruit{"Apple"}, fruit{"Banana"}, fruit{"Cherry"})
+
+	pr := ptest.RunAndValidate(t, pipeline)
+	checkFruitCount(t, pr)
+}
+
+func TestLPErrorReshufflePipeline_DoFnSideInput(t *testing.T) {
+	integration.CheckFilters(t)
+
+	pipeline, s := beam.NewPipelineWithRoot()
+	got := LPErrorReshufflePipeline(s)
+	counted := beam.ParDo(s, countFruit, got)
+	beam.ParDo0(s, &iterSideStrings{
+		Wants: []string{"Apple", "Banana", "Cherry"},
+	}, beam.Impulse(s), beam.SideInput{Input: counted})
+
+	pr := ptest.RunAndValidate(t, pipeline)
+	checkFruitCount(t, pr)
+}
