diff --git a/runners/direct-java/src/main/java/org/apache/beam/runners/direct/DirectRunner.java b/runners/direct-java/src/main/java/org/apache/beam/runners/direct/DirectRunner.java
index 43147a02564..45a04a74b7b 100644
--- a/runners/direct-java/src/main/java/org/apache/beam/runners/direct/DirectRunner.java
+++ b/runners/direct-java/src/main/java/org/apache/beam/runners/direct/DirectRunner.java
@@ -383,12 +383,14 @@ public class DirectRunner extends PipelineRunner<DirectPipelineResult> {
       AggregatorContainer aggregators = evaluationContext.getAggregatorContainer();
       Collection<PTransform<?, ?>> steps = aggregatorSteps.get(aggregator);
       final Map<String, T> stepValues = new HashMap<>();
-      for (AppliedPTransform<?, ?, ?> transform : evaluationContext.getSteps()) {
-        if (steps.contains(transform.getTransform())) {
-          T aggregate = aggregators.getAggregate(
-              evaluationContext.getStepName(transform), aggregator.getName());
-          if (aggregate != null) {
-            stepValues.put(transform.getFullName(), aggregate);
+      if (steps != null) {
+        for (AppliedPTransform<?, ?, ?> transform : evaluationContext.getSteps()) {
+          if (steps.contains(transform.getTransform())) {
+            T aggregate = aggregators
+                .getAggregate(evaluationContext.getStepName(transform), aggregator.getName());
+            if (aggregate != null) {
+              stepValues.put(transform.getFullName(), aggregate);
+            }
           }
         }
       }
diff --git a/runners/direct-java/src/test/java/org/apache/beam/runners/direct/DirectRunnerTest.java b/runners/direct-java/src/test/java/org/apache/beam/runners/direct/DirectRunnerTest.java
index ed19be28769..246c1118844 100644
--- a/runners/direct-java/src/test/java/org/apache/beam/runners/direct/DirectRunnerTest.java
+++ b/runners/direct-java/src/test/java/org/apache/beam/runners/direct/DirectRunnerTest.java
@@ -40,6 +40,7 @@ import java.util.concurrent.Executors;
 import java.util.concurrent.Future;
 import java.util.concurrent.atomic.AtomicInteger;
 import org.apache.beam.runners.direct.DirectRunner.DirectPipelineResult;
+import org.apache.beam.sdk.AggregatorRetrievalException;
 import org.apache.beam.sdk.Pipeline;
 import org.apache.beam.sdk.PipelineResult;
 import org.apache.beam.sdk.PipelineResult.State;
@@ -47,6 +48,7 @@ import org.apache.beam.sdk.coders.AtomicCoder;
 import org.apache.beam.sdk.coders.Coder;
 import org.apache.beam.sdk.coders.CoderException;
 import org.apache.beam.sdk.coders.ListCoder;
+import org.apache.beam.sdk.coders.StringUtf8Coder;
 import org.apache.beam.sdk.coders.VarIntCoder;
 import org.apache.beam.sdk.coders.VarLongCoder;
 import org.apache.beam.sdk.io.BoundedSource;
@@ -58,6 +60,7 @@ import org.apache.beam.sdk.options.PipelineOptionsFactory;
 import org.apache.beam.sdk.runners.PipelineRunner;
 import org.apache.beam.sdk.testing.PAssert;
 import org.apache.beam.sdk.testing.TestPipeline;
+import org.apache.beam.sdk.transforms.Aggregator;
 import org.apache.beam.sdk.transforms.Count;
 import org.apache.beam.sdk.transforms.Create;
 import org.apache.beam.sdk.transforms.DoFn;
@@ -66,9 +69,13 @@ import org.apache.beam.sdk.transforms.MapElements;
 import org.apache.beam.sdk.transforms.ParDo;
 import org.apache.beam.sdk.transforms.SerializableFunction;
 import org.apache.beam.sdk.transforms.SimpleFunction;
+import org.apache.beam.sdk.transforms.Sum;
 import org.apache.beam.sdk.transforms.display.DisplayData;
 import org.apache.beam.sdk.util.CoderUtils;
 import org.apache.beam.sdk.util.IllegalMutationException;
+import org.apache.beam.sdk.util.state.StateSpec;
+import org.apache.beam.sdk.util.state.StateSpecs;
+import org.apache.beam.sdk.util.state.ValueState;
 import org.apache.beam.sdk.values.KV;
 import org.apache.beam.sdk.values.PCollection;
 import org.apache.beam.sdk.values.PCollectionList;
@@ -525,6 +532,36 @@ public class DirectRunnerTest implements Serializable {
     p.run();
   }
 
+
+  @Test
+  public void testAggregatorNotPresentInGraph() throws AggregatorRetrievalException {
+    Pipeline p = getPipeline();
+    IdentityDoFn identityDoFn = new IdentityDoFn();
+    p.apply(Create.of(KV.of("key", "element1"), KV.of("key", "element2"), KV.of("key", "element3")))
+        .apply(ParDo.of(identityDoFn));
+    PipelineResult pipelineResult = p.run();
+    pipelineResult.getAggregatorValues(identityDoFn.getCounter()).getValues();
+  }
+
+  private static class IdentityDoFn extends DoFn<KV<String, String>, String> {
+    private final Aggregator<Long, Long> counter = createAggregator("counter", Sum.ofLongs());
+    private static final String STATE_ID = "state";
+    @StateId(STATE_ID)
+    private static final StateSpec<Object, ValueState<String>> stateSpec =
+        StateSpecs.value(StringUtf8Coder.of());
+
+    @ProcessElement
+    public void processElement(ProcessContext context, @StateId(STATE_ID) ValueState<String> state){
+      state.write("state content");
+      counter.addValue(1L);
+      context.output(context.element().getValue());
+    }
+
+    public Aggregator<Long, Long> getCounter() {
+      return counter;
+    }
+  }
+
   private static class LongNoDecodeCoder extends AtomicCoder<Long> {
     @Override
     public void encode(
