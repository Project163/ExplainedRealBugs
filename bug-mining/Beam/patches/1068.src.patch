diff --git a/sdks/java/io/elasticsearch-tests/elasticsearch-tests-common/src/test/java/org/apache/beam/sdk/io/elasticsearch/ElasticSearchIOTestUtils.java b/sdks/java/io/elasticsearch-tests/elasticsearch-tests-common/src/test/java/org/apache/beam/sdk/io/elasticsearch/ElasticSearchIOTestUtils.java
index 9ca60f9f55c..eacbbc5bfac 100644
--- a/sdks/java/io/elasticsearch-tests/elasticsearch-tests-common/src/test/java/org/apache/beam/sdk/io/elasticsearch/ElasticSearchIOTestUtils.java
+++ b/sdks/java/io/elasticsearch-tests/elasticsearch-tests-common/src/test/java/org/apache/beam/sdk/io/elasticsearch/ElasticSearchIOTestUtils.java
@@ -18,6 +18,7 @@
 package org.apache.beam.sdk.io.elasticsearch;
 
 import static org.apache.beam.sdk.io.elasticsearch.ElasticsearchIO.ConnectionConfiguration;
+import static org.apache.beam.sdk.io.elasticsearch.ElasticsearchIO.getBackendVersion;
 import static org.apache.beam.sdk.io.elasticsearch.ElasticsearchIO.parseResponse;
 
 import com.fasterxml.jackson.databind.JsonNode;
@@ -244,12 +245,15 @@ class ElasticSearchIOTestUtils {
     return searchResult.path("hits").path("total").asInt();
   }
 
-  public static void setIndexMapping(RestClient restClient, String index, String type) throws IOException {
-    String endpoint = String.format("/%s", index);
+  public static void setIndexMapping(
+      ConnectionConfiguration connectionConfiguration, RestClient restClient) throws IOException {
+    String endpoint = String.format("/%s", connectionConfiguration.getIndex());
     String requestString =
         String.format(
             "{\"mappings\":{\"%s\":{\"properties\":{\"age\":{\"type\":\"long\"},"
-                + " \"scientist\":{\"type\":\"text\"}, \"id\":{\"type\":\"long\"}}}}}", type);
+                + " \"scientist\":{\"type\":\"%s\"}, \"id\":{\"type\":\"long\"}}}}}",
+            connectionConfiguration.getType(),
+            getBackendVersion(connectionConfiguration) == 2 ? "string" : "text");
     HttpEntity requestBody = new NStringEntity(requestString, ContentType.APPLICATION_JSON);
     Request request = new Request("PUT", endpoint);
     request.setEntity(requestBody);
diff --git a/sdks/java/io/elasticsearch-tests/elasticsearch-tests-common/src/test/java/org/apache/beam/sdk/io/elasticsearch/ElasticsearchIOTestCommon.java b/sdks/java/io/elasticsearch-tests/elasticsearch-tests-common/src/test/java/org/apache/beam/sdk/io/elasticsearch/ElasticsearchIOTestCommon.java
index f8629444db8..112e0e2c0f1 100644
--- a/sdks/java/io/elasticsearch-tests/elasticsearch-tests-common/src/test/java/org/apache/beam/sdk/io/elasticsearch/ElasticsearchIOTestCommon.java
+++ b/sdks/java/io/elasticsearch-tests/elasticsearch-tests-common/src/test/java/org/apache/beam/sdk/io/elasticsearch/ElasticsearchIOTestCommon.java
@@ -553,15 +553,17 @@ class ElasticsearchIOTestCommon implements Serializable {
   /** Tests partial updates with errors by adding some invalid info to test set. */
   void testWritePartialUpdateWithErrors() throws Exception {
     // put a mapping to simulate error of insertion
-    ElasticSearchIOTestUtils.setIndexMapping(restClient, connectionConfiguration.getIndex(),
-        connectionConfiguration.getType());
+    ElasticSearchIOTestUtils.setIndexMapping(connectionConfiguration, restClient);
 
-    // partial documents containing the ID and age only
-    List<String> data = new ArrayList<>();
-    for (int i = 0; i < numDocs; i++) {
-      data.add(String.format("{\"id\" : %s, \"age\" : \"%s\"}", i, "2018-08-10:00:00"));
+    if (!useAsITests) {
+      ElasticSearchIOTestUtils.insertTestDocuments(connectionConfiguration, numDocs, restClient);
     }
 
+    // try to partial update a document with an incompatible date format for the age to generate
+    // an update error
+    List<String> data = new ArrayList<>();
+    data.add("{\"id\" : 1, \"age\" : \"2018-08-10:00:00\"}");
+
     try {
       pipeline
           .apply(Create.of(data))
@@ -577,7 +579,8 @@ class ElasticsearchIOTestCommon implements Serializable {
               .matches(
                   "(?is).*Error writing to Elasticsearch, some elements could not be inserted:"
                       + ".*Document id .+: failed to parse .*Caused by: .*"
-                      + ".*Document id .+: failed to parse .*Caused by: .*");
+                      + ".*For input string: \"2018-08-10:00:00\".*");
+
       assertTrue(matches);
     }
   }
