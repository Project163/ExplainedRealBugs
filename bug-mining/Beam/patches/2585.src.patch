diff --git a/runners/google-cloud-dataflow-java/worker/src/test/java/org/apache/beam/runners/dataflow/worker/fn/BeamFnControlServiceTest.java b/runners/google-cloud-dataflow-java/worker/src/test/java/org/apache/beam/runners/dataflow/worker/fn/BeamFnControlServiceTest.java
index b5135f84b18..e5611bba8b1 100644
--- a/runners/google-cloud-dataflow-java/worker/src/test/java/org/apache/beam/runners/dataflow/worker/fn/BeamFnControlServiceTest.java
+++ b/runners/google-cloud-dataflow-java/worker/src/test/java/org/apache/beam/runners/dataflow/worker/fn/BeamFnControlServiceTest.java
@@ -24,6 +24,7 @@ import static org.mockito.Mockito.verifyNoMoreInteractions;
 
 import java.net.InetAddress;
 import java.net.ServerSocket;
+import java.util.Arrays;
 import java.util.concurrent.CountDownLatch;
 import java.util.concurrent.TimeUnit;
 import org.apache.beam.model.fnexecution.v1.BeamFnApi;
@@ -31,11 +32,12 @@ import org.apache.beam.model.fnexecution.v1.BeamFnControlGrpc;
 import org.apache.beam.model.pipeline.v1.Endpoints;
 import org.apache.beam.runners.dataflow.worker.fn.stream.ServerStreamObserverFactory;
 import org.apache.beam.runners.fnexecution.control.FnApiControlClient;
+import org.apache.beam.sdk.fn.channel.AddHarnessIdInterceptor;
+import org.apache.beam.sdk.fn.channel.ManagedChannelFactory;
 import org.apache.beam.sdk.fn.server.GrpcContextHeaderAccessorProvider;
 import org.apache.beam.sdk.fn.server.ServerFactory;
 import org.apache.beam.sdk.options.PipelineOptions;
 import org.apache.beam.sdk.options.PipelineOptionsFactory;
-import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.ManagedChannelBuilder;
 import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.stub.StreamObserver;
 import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.testing.GrpcCleanupRule;
 import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableList;
@@ -51,6 +53,8 @@ import org.mockito.MockitoAnnotations;
 /** Tests for {@link BeamFnControlService}. */
 @RunWith(JUnit4.class)
 public class BeamFnControlServiceTest {
+  private static final String WORKER_ID = "testWorker";
+
   @Rule
   public GrpcCleanupRule grpcCleanupRule = new GrpcCleanupRule().setTimeout(10, TimeUnit.SECONDS);
 
@@ -91,10 +95,12 @@ public class BeamFnControlServiceTest {
             GrpcContextHeaderAccessorProvider.getHeaderAccessor());
     grpcCleanupRule.register(
         ServerFactory.createDefault().create(ImmutableList.of(service), descriptor));
-    String url = service.getApiServiceDescriptor().getUrl();
-    BeamFnControlGrpc.BeamFnControlStub clientStub =
-        BeamFnControlGrpc.newStub(ManagedChannelBuilder.forTarget(url).usePlaintext().build());
 
+    BeamFnControlGrpc.BeamFnControlStub clientStub =
+        BeamFnControlGrpc.newStub(
+            ManagedChannelFactory.createDefault()
+                .withInterceptors(Arrays.asList(AddHarnessIdInterceptor.create(WORKER_ID)))
+                .forDescriptor(service.getApiServiceDescriptor()));
     // Connect from the client.
     clientStub.control(requestObserver);
     try (FnApiControlClient client = service.get()) {
@@ -135,11 +141,16 @@ public class BeamFnControlServiceTest {
     grpcCleanupRule.register(
         ServerFactory.createDefault().create(ImmutableList.of(service), descriptor));
 
-    String url = service.getApiServiceDescriptor().getUrl();
     BeamFnControlGrpc.BeamFnControlStub clientStub =
-        BeamFnControlGrpc.newStub(ManagedChannelBuilder.forTarget(url).usePlaintext().build());
+        BeamFnControlGrpc.newStub(
+            ManagedChannelFactory.createDefault()
+                .withInterceptors(Arrays.asList(AddHarnessIdInterceptor.create(WORKER_ID + 1)))
+                .forDescriptor(service.getApiServiceDescriptor()));
     BeamFnControlGrpc.BeamFnControlStub anotherClientStub =
-        BeamFnControlGrpc.newStub(ManagedChannelBuilder.forTarget(url).usePlaintext().build());
+        BeamFnControlGrpc.newStub(
+            ManagedChannelFactory.createDefault()
+                .withInterceptors(Arrays.asList(AddHarnessIdInterceptor.create(WORKER_ID + 2)))
+                .forDescriptor(service.getApiServiceDescriptor()));
 
     // Connect from the client.
     clientStub.control(requestObserver);
diff --git a/runners/google-cloud-dataflow-java/worker/src/test/java/org/apache/beam/runners/dataflow/worker/fn/data/BeamFnDataGrpcServiceTest.java b/runners/google-cloud-dataflow-java/worker/src/test/java/org/apache/beam/runners/dataflow/worker/fn/data/BeamFnDataGrpcServiceTest.java
index 43a2d17bf09..dd68f0caaa7 100644
--- a/runners/google-cloud-dataflow-java/worker/src/test/java/org/apache/beam/runners/dataflow/worker/fn/data/BeamFnDataGrpcServiceTest.java
+++ b/runners/google-cloud-dataflow-java/worker/src/test/java/org/apache/beam/runners/dataflow/worker/fn/data/BeamFnDataGrpcServiceTest.java
@@ -24,10 +24,12 @@ import static org.hamcrest.Matchers.contains;
 import static org.hamcrest.Matchers.containsInAnyOrder;
 import static org.hamcrest.Matchers.empty;
 
+import java.net.InetAddress;
+import java.net.ServerSocket;
 import java.util.ArrayList;
+import java.util.Arrays;
 import java.util.Collection;
 import java.util.List;
-import java.util.UUID;
 import java.util.concurrent.BlockingQueue;
 import java.util.concurrent.ConcurrentHashMap;
 import java.util.concurrent.CountDownLatch;
@@ -44,29 +46,21 @@ import org.apache.beam.sdk.coders.Coder;
 import org.apache.beam.sdk.coders.CoderException;
 import org.apache.beam.sdk.coders.LengthPrefixCoder;
 import org.apache.beam.sdk.coders.StringUtf8Coder;
+import org.apache.beam.sdk.fn.channel.AddHarnessIdInterceptor;
+import org.apache.beam.sdk.fn.channel.ManagedChannelFactory;
 import org.apache.beam.sdk.fn.data.CloseableFnDataReceiver;
 import org.apache.beam.sdk.fn.data.InboundDataClient;
 import org.apache.beam.sdk.fn.data.LogicalEndpoint;
 import org.apache.beam.sdk.fn.server.GrpcContextHeaderAccessorProvider;
+import org.apache.beam.sdk.fn.server.ServerFactory;
 import org.apache.beam.sdk.options.PipelineOptions;
 import org.apache.beam.sdk.options.PipelineOptionsFactory;
 import org.apache.beam.sdk.util.WindowedValue;
 import org.apache.beam.vendor.grpc.v1p36p0.com.google.protobuf.ByteString;
-import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.BindableService;
-import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.CallOptions;
-import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.Channel;
-import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.ClientCall;
-import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.ClientInterceptor;
-import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.ForwardingClientCall.SimpleForwardingClientCall;
 import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.ManagedChannel;
-import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.Metadata;
-import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.Metadata.Key;
-import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.MethodDescriptor;
 import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.Server;
-import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.ServerInterceptors;
-import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.inprocess.InProcessChannelBuilder;
-import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.inprocess.InProcessServerBuilder;
 import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.stub.StreamObserver;
+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.net.HostAndPort;
 import org.junit.After;
 import org.junit.Before;
 import org.junit.Test;
@@ -82,15 +76,23 @@ public class BeamFnDataGrpcServiceTest {
   private static final String TRANSFORM_ID = "888";
   private static final Coder<WindowedValue<String>> CODER =
       LengthPrefixCoder.of(WindowedValue.getValueOnlyCoder(StringUtf8Coder.of()));
-  private static final String DEFAULT_CLIENT = "";
+  private static final String WORKER_ID = "testWorker";
 
   private Server server;
   private BeamFnDataGrpcService service;
 
+  private Endpoints.ApiServiceDescriptor findOpenPort() throws Exception {
+    InetAddress address = InetAddress.getLoopbackAddress();
+    try (ServerSocket socket = new ServerSocket(0, -1, address)) {
+      return Endpoints.ApiServiceDescriptor.newBuilder()
+          .setUrl(HostAndPort.fromParts(address.getHostAddress(), socket.getLocalPort()).toString())
+          .build();
+    }
+  }
+
   @Before
   public void setUp() throws Exception {
-    Endpoints.ApiServiceDescriptor descriptor =
-        Endpoints.ApiServiceDescriptor.newBuilder().setUrl(UUID.randomUUID().toString()).build();
+    Endpoints.ApiServiceDescriptor descriptor = findOpenPort();
     PipelineOptions options = PipelineOptionsFactory.create();
     service =
         new BeamFnDataGrpcService(
@@ -98,7 +100,7 @@ public class BeamFnDataGrpcServiceTest {
             descriptor,
             ServerStreamObserverFactory.fromOptions(options)::from,
             GrpcContextHeaderAccessorProvider.getHeaderAccessor());
-    server = createServer(service, descriptor);
+    server = ServerFactory.createDefault().create(Arrays.asList(service), descriptor);
   }
 
   @After
@@ -114,10 +116,13 @@ public class BeamFnDataGrpcServiceTest {
     int numberOfClients = 3;
 
     for (int client = 0; client < numberOfClients; ++client) {
+      final int workerSuffix = client;
       executorService.submit(
           () -> {
             ManagedChannel channel =
-                InProcessChannelBuilder.forName(service.getApiServiceDescriptor().getUrl()).build();
+                ManagedChannelFactory.createDefault()
+                    .withInterceptors(Arrays.asList(AddHarnessIdInterceptor.create(WORKER_ID)))
+                    .forDescriptor(service.getApiServiceDescriptor());
             StreamObserver<BeamFnApi.Elements> outboundObserver =
                 BeamFnDataGrpc.newStub(channel)
                     .data(TestStreams.withOnNext(clientInboundElements::add).build());
@@ -130,7 +135,7 @@ public class BeamFnDataGrpcServiceTest {
     for (int i = 0; i < 3; ++i) {
       CloseableFnDataReceiver<WindowedValue<String>> consumer =
           service
-              .getDataService(DEFAULT_CLIENT)
+              .getDataService(WORKER_ID)
               .send(LogicalEndpoint.data(Integer.toString(i), TRANSFORM_ID), CODER);
 
       consumer.accept(valueInGlobalWindow("A" + i));
@@ -167,28 +172,9 @@ public class BeamFnDataGrpcServiceTest {
       executorService.submit(
           () -> {
             ManagedChannel channel =
-                InProcessChannelBuilder.forName(service.getApiServiceDescriptor().getUrl())
-                    .intercept(
-                        new ClientInterceptor() {
-                          @Override
-                          public <ReqT, RespT> ClientCall<ReqT, RespT> interceptCall(
-                              MethodDescriptor<ReqT, RespT> method,
-                              CallOptions callOptions,
-                              Channel next) {
-                            return new SimpleForwardingClientCall<ReqT, RespT>(
-                                next.newCall(method, callOptions)) {
-                              @Override
-                              public void start(
-                                  Listener<RespT> responseListener, Metadata headers) {
-                                headers.put(
-                                    Key.of("worker_id", Metadata.ASCII_STRING_MARSHALLER),
-                                    clientId);
-                                super.start(responseListener, headers);
-                              }
-                            };
-                          }
-                        })
-                    .build();
+                ManagedChannelFactory.createDefault()
+                    .withInterceptors(Arrays.asList(AddHarnessIdInterceptor.create(clientId)))
+                    .forDescriptor(service.getApiServiceDescriptor());
             StreamObserver<BeamFnApi.Elements> outboundObserver =
                 BeamFnDataGrpc.newStub(channel)
                     .data(TestStreams.withOnNext(clientInboundElements.get(clientId)::add).build());
@@ -241,7 +227,9 @@ public class BeamFnDataGrpcServiceTest {
       executorService.submit(
           () -> {
             ManagedChannel channel =
-                InProcessChannelBuilder.forName(service.getApiServiceDescriptor().getUrl()).build();
+                ManagedChannelFactory.createDefault()
+                    .withInterceptors(Arrays.asList(AddHarnessIdInterceptor.create(WORKER_ID)))
+                    .forDescriptor(service.getApiServiceDescriptor());
             StreamObserver<BeamFnApi.Elements> outboundObserver =
                 BeamFnDataGrpc.newStub(channel)
                     .data(TestStreams.withOnNext(clientInboundElements::add).build());
@@ -259,7 +247,7 @@ public class BeamFnDataGrpcServiceTest {
       serverInboundValues.add(serverInboundValue);
       inboundDataClients.add(
           service
-              .getDataService(DEFAULT_CLIENT)
+              .getDataService(WORKER_ID)
               .receive(
                   LogicalEndpoint.data(Integer.toString(i), TRANSFORM_ID),
                   CODER,
@@ -303,17 +291,4 @@ public class BeamFnDataGrpcServiceTest {
                 .setIsLast(true))
         .build();
   }
-
-  private Server createServer(BindableService service, Endpoints.ApiServiceDescriptor descriptor)
-      throws Exception {
-    String serverName = descriptor.getUrl();
-    Server server =
-        InProcessServerBuilder.forName(serverName)
-            .addService(
-                ServerInterceptors.intercept(
-                    service, GrpcContextHeaderAccessorProvider.interceptor()))
-            .build();
-    server.start();
-    return server;
-  }
 }
diff --git a/runners/google-cloud-dataflow-java/worker/src/test/java/org/apache/beam/runners/dataflow/worker/fn/logging/BeamFnLoggingServiceTest.java b/runners/google-cloud-dataflow-java/worker/src/test/java/org/apache/beam/runners/dataflow/worker/fn/logging/BeamFnLoggingServiceTest.java
index 84faff91da9..40bdfee7025 100644
--- a/runners/google-cloud-dataflow-java/worker/src/test/java/org/apache/beam/runners/dataflow/worker/fn/logging/BeamFnLoggingServiceTest.java
+++ b/runners/google-cloud-dataflow-java/worker/src/test/java/org/apache/beam/runners/dataflow/worker/fn/logging/BeamFnLoggingServiceTest.java
@@ -23,6 +23,7 @@ import static org.hamcrest.Matchers.containsInAnyOrder;
 import java.net.InetAddress;
 import java.net.ServerSocket;
 import java.util.ArrayList;
+import java.util.Arrays;
 import java.util.Collection;
 import java.util.concurrent.BlockingQueue;
 import java.util.concurrent.Callable;
@@ -38,13 +39,13 @@ import org.apache.beam.model.fnexecution.v1.BeamFnLoggingGrpc;
 import org.apache.beam.model.pipeline.v1.Endpoints;
 import org.apache.beam.runners.dataflow.harness.test.TestStreams;
 import org.apache.beam.runners.dataflow.worker.fn.stream.ServerStreamObserverFactory;
+import org.apache.beam.sdk.fn.channel.AddHarnessIdInterceptor;
+import org.apache.beam.sdk.fn.channel.ManagedChannelFactory;
 import org.apache.beam.sdk.fn.server.GrpcContextHeaderAccessorProvider;
+import org.apache.beam.sdk.fn.server.ServerFactory;
 import org.apache.beam.sdk.options.PipelineOptionsFactory;
-import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.BindableService;
 import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.ManagedChannel;
 import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.Server;
-import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.inprocess.InProcessChannelBuilder;
-import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.inprocess.InProcessServerBuilder;
 import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.stub.StreamObserver;
 import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.net.HostAndPort;
 import org.junit.After;
@@ -55,6 +56,7 @@ import org.junit.runners.JUnit4;
 /** Tests for {@link BeamFnLoggingService}. */
 @RunWith(JUnit4.class)
 public class BeamFnLoggingServiceTest {
+  private static final String WORKER_ID = "testWorker";
   private Server server;
 
   private Endpoints.ApiServiceDescriptor findOpenPort() throws Exception {
@@ -80,7 +82,9 @@ public class BeamFnLoggingServiceTest {
             logs::add,
             ServerStreamObserverFactory.fromOptions(PipelineOptionsFactory.create())::from,
             GrpcContextHeaderAccessorProvider.getHeaderAccessor())) {
-      server = createServer(service, service.getApiServiceDescriptor());
+      server =
+          ServerFactory.createDefault()
+              .create(Arrays.asList(service), service.getApiServiceDescriptor());
 
       Collection<Callable<Void>> tasks = new ArrayList<>();
       for (int i = 1; i <= 3; ++i) {
@@ -89,8 +93,10 @@ public class BeamFnLoggingServiceTest {
             () -> {
               CountDownLatch waitForServerHangup = new CountDownLatch(1);
               ManagedChannel channel =
-                  InProcessChannelBuilder.forName(service.getApiServiceDescriptor().getUrl())
-                      .build();
+                  ManagedChannelFactory.createDefault()
+                      .withInterceptors(
+                          Arrays.asList(AddHarnessIdInterceptor.create(WORKER_ID + instructionId)))
+                      .forDescriptor(service.getApiServiceDescriptor());
               StreamObserver<BeamFnApi.LogEntry.List> outboundObserver =
                   BeamFnLoggingGrpc.newStub(channel)
                       .logging(
@@ -127,7 +133,10 @@ public class BeamFnLoggingServiceTest {
             logs::add,
             ServerStreamObserverFactory.fromOptions(PipelineOptionsFactory.create())::from,
             GrpcContextHeaderAccessorProvider.getHeaderAccessor())) {
-      server = createServer(service, service.getApiServiceDescriptor());
+      server =
+          ServerFactory.createDefault()
+              .create(Arrays.asList(service), service.getApiServiceDescriptor());
+
       CountDownLatch waitForTermination = new CountDownLatch(3);
       final BlockingQueue<StreamObserver<List>> outboundObservers = new LinkedBlockingQueue<>();
       for (int i = 1; i <= 3; ++i) {
@@ -135,8 +144,10 @@ public class BeamFnLoggingServiceTest {
         tasks.add(
             () -> {
               ManagedChannel channel =
-                  InProcessChannelBuilder.forName(service.getApiServiceDescriptor().getUrl())
-                      .build();
+                  ManagedChannelFactory.createDefault()
+                      .withInterceptors(
+                          Arrays.asList(AddHarnessIdInterceptor.create(WORKER_ID + instructionId)))
+                      .forDescriptor(service.getApiServiceDescriptor());
               StreamObserver<BeamFnApi.LogEntry.List> outboundObserver =
                   BeamFnLoggingGrpc.newStub(channel)
                       .logging(
@@ -168,7 +179,9 @@ public class BeamFnLoggingServiceTest {
             logs::add,
             ServerStreamObserverFactory.fromOptions(PipelineOptionsFactory.create())::from,
             GrpcContextHeaderAccessorProvider.getHeaderAccessor())) {
-      server = createServer(service, service.getApiServiceDescriptor());
+      server =
+          ServerFactory.createDefault()
+              .create(Arrays.asList(service), service.getApiServiceDescriptor());
 
       for (int i = 1; i <= 3; ++i) {
         long instructionId = i;
@@ -177,8 +190,11 @@ public class BeamFnLoggingServiceTest {
                 () -> {
                   CountDownLatch waitForServerHangup = new CountDownLatch(1);
                   ManagedChannel channel =
-                      InProcessChannelBuilder.forName(service.getApiServiceDescriptor().getUrl())
-                          .build();
+                      ManagedChannelFactory.createDefault()
+                          .withInterceptors(
+                              Arrays.asList(
+                                  AddHarnessIdInterceptor.create(WORKER_ID + instructionId)))
+                          .forDescriptor(service.getApiServiceDescriptor());
                   StreamObserver<BeamFnApi.LogEntry.List> outboundObserver =
                       BeamFnLoggingGrpc.newStub(channel)
                           .logging(
@@ -216,12 +232,4 @@ public class BeamFnLoggingServiceTest {
   private BeamFnApi.LogEntry createLogWithId(long id) {
     return BeamFnApi.LogEntry.newBuilder().setInstructionId(Long.toString(id)).build();
   }
-
-  private Server createServer(
-      BindableService service, Endpoints.ApiServiceDescriptor serviceDescriptor) throws Exception {
-    Server server =
-        InProcessServerBuilder.forName(serviceDescriptor.getUrl()).addService(service).build();
-    server.start();
-    return server;
-  }
 }
diff --git a/runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/control/FnApiControlClientPoolService.java b/runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/control/FnApiControlClientPoolService.java
index b1bea3724ca..a2fe724e7c8 100644
--- a/runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/control/FnApiControlClientPoolService.java
+++ b/runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/control/FnApiControlClientPoolService.java
@@ -31,7 +31,6 @@ import org.apache.beam.sdk.fn.server.HeaderAccessor;
 import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.Status;
 import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.StatusException;
 import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.stub.StreamObserver;
-import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.base.Strings;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -82,11 +81,6 @@ public class FnApiControlClientPoolService extends BeamFnControlGrpc.BeamFnContr
   public StreamObserver<BeamFnApi.InstructionResponse> control(
       StreamObserver<BeamFnApi.InstructionRequest> requestObserver) {
     final String workerId = headerAccessor.getSdkWorkerId();
-    if (Strings.isNullOrEmpty(workerId)) {
-      // TODO(BEAM-4149): Enforce proper worker id.
-      LOG.warn("No worker_id header provided in control request");
-    }
-
     LOG.info("Beam Fn Control client connected with id {}", workerId);
     FnApiControlClient newClient =
         FnApiControlClient.forRequestObserver(workerId, requestObserver, processBundleDescriptors);
diff --git a/runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/environment/EmbeddedEnvironmentFactory.java b/runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/environment/EmbeddedEnvironmentFactory.java
index 25f248c4e17..ad402670240 100644
--- a/runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/environment/EmbeddedEnvironmentFactory.java
+++ b/runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/environment/EmbeddedEnvironmentFactory.java
@@ -139,8 +139,7 @@ public class EmbeddedEnvironmentFactory implements EnvironmentFactory {
         if (executor.isShutdown()) {
           throw new IllegalStateException("FnHarness startup failed");
         }
-        // TODO: find some way to populate the actual ID in FnHarness.main()
-        handler = clientSource.take("", Duration.ofSeconds(5L));
+        handler = clientSource.take(workerId, Duration.ofSeconds(5L));
       } catch (TimeoutException timeoutEx) {
         LOG.info("Still waiting for startup of FnHarness");
       } catch (InterruptedException interruptEx) {
diff --git a/runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/provisioning/StaticGrpcProvisionService.java b/runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/provisioning/StaticGrpcProvisionService.java
index 2b0650c7c9c..3aebebe13c4 100644
--- a/runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/provisioning/StaticGrpcProvisionService.java
+++ b/runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/provisioning/StaticGrpcProvisionService.java
@@ -58,8 +58,7 @@ public class StaticGrpcProvisionService extends ProvisionServiceGrpc.ProvisionSe
   public void getProvisionInfo(
       ProvisionApi.GetProvisionInfoRequest request,
       StreamObserver<GetProvisionInfoResponse> responseObserver) {
-    if (headerAccessor.getSdkWorkerId() == null
-        || !environments.containsKey(headerAccessor.getSdkWorkerId())) {
+    if (!environments.containsKey(headerAccessor.getSdkWorkerId())) {
       // TODO(BEAM-9818): Remove once the JRH is gone.
       responseObserver.onNext(GetProvisionInfoResponse.newBuilder().setInfo(info).build());
       responseObserver.onCompleted();
diff --git a/runners/java-fn-execution/src/test/java/org/apache/beam/runners/fnexecution/EmbeddedSdkHarness.java b/runners/java-fn-execution/src/test/java/org/apache/beam/runners/fnexecution/EmbeddedSdkHarness.java
index 417f8ed458d..172863930da 100644
--- a/runners/java-fn-execution/src/test/java/org/apache/beam/runners/fnexecution/EmbeddedSdkHarness.java
+++ b/runners/java-fn-execution/src/test/java/org/apache/beam/runners/fnexecution/EmbeddedSdkHarness.java
@@ -95,11 +95,9 @@ public class EmbeddedSdkHarness extends ExternalResource implements TestRule {
                 clientPool.getSource())
             // The EmbeddedEnvironmentFactory can only create Java environments, regardless of the
             // Environment that's passed to it.
-            .createEnvironment(Environment.getDefaultInstance(), "unusedWorkerId")
+            .createEnvironment(Environment.getDefaultInstance(), "embedded_worker")
             .getInstructionRequestHandler();
 
-    // TODO: https://issues.apache.org/jira/browse/BEAM-4149 Worker ids cannot currently be set by
-    // the harness. All clients have the implicit empty id for now.
     client = SdkHarnessClient.usingFnApiClient(requestHandler, dataServer.getService());
   }
 
diff --git a/runners/java-fn-execution/src/test/java/org/apache/beam/runners/fnexecution/control/FnApiControlClientPoolServiceTest.java b/runners/java-fn-execution/src/test/java/org/apache/beam/runners/fnexecution/control/FnApiControlClientPoolServiceTest.java
index f6f99b0dc58..89b76d2a9bf 100644
--- a/runners/java-fn-execution/src/test/java/org/apache/beam/runners/fnexecution/control/FnApiControlClientPoolServiceTest.java
+++ b/runners/java-fn-execution/src/test/java/org/apache/beam/runners/fnexecution/control/FnApiControlClientPoolServiceTest.java
@@ -19,22 +19,27 @@ package org.apache.beam.runners.fnexecution.control;
 
 import static org.hamcrest.MatcherAssert.assertThat;
 import static org.hamcrest.Matchers.is;
-import static org.mockito.Matchers.any;
+import static org.junit.Assert.assertEquals;
+import static org.junit.Assert.fail;
 import static org.mockito.Matchers.argThat;
 import static org.mockito.Mockito.mock;
 import static org.mockito.Mockito.verify;
 
 import java.io.IOException;
 import java.time.Duration;
+import java.util.concurrent.CompletableFuture;
 import java.util.concurrent.CompletionStage;
 import java.util.concurrent.CountDownLatch;
 import java.util.concurrent.atomic.AtomicBoolean;
 import org.apache.beam.model.fnexecution.v1.BeamFnApi;
 import org.apache.beam.model.fnexecution.v1.BeamFnApi.InstructionRequest;
+import org.apache.beam.model.fnexecution.v1.BeamFnApi.InstructionResponse;
 import org.apache.beam.model.fnexecution.v1.BeamFnControlGrpc;
+import org.apache.beam.sdk.fn.channel.AddHarnessIdInterceptor;
 import org.apache.beam.sdk.fn.server.GrpcContextHeaderAccessorProvider;
 import org.apache.beam.sdk.fn.server.GrpcFnServer;
 import org.apache.beam.sdk.fn.server.InProcessServerFactory;
+import org.apache.beam.sdk.fn.test.TestStreams;
 import org.apache.beam.sdk.util.MoreFutures;
 import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.Status;
 import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.StatusException;
@@ -50,7 +55,7 @@ import org.junit.runners.JUnit4;
 /** Unit tests for {@link FnApiControlClientPoolService}. */
 @RunWith(JUnit4.class)
 public class FnApiControlClientPoolServiceTest {
-
+  private static final String WORKER_ID = "test_worker_id";
   private final ControlClientPool pool = MapControlClientPool.create();
   private final FnApiControlClientPoolService controlService =
       FnApiControlClientPoolService.offeringClientsToPool(
@@ -63,7 +68,9 @@ public class FnApiControlClientPoolServiceTest {
     server = GrpcFnServer.allocatePortAndCreateFor(controlService, InProcessServerFactory.create());
     stub =
         BeamFnControlGrpc.newStub(
-            InProcessChannelBuilder.forName(server.getApiServiceDescriptor().getUrl()).build());
+            InProcessChannelBuilder.forName(server.getApiServiceDescriptor().getUrl())
+                .intercept(AddHarnessIdInterceptor.create(WORKER_ID))
+                .build());
   }
 
   @After
@@ -73,24 +80,32 @@ public class FnApiControlClientPoolServiceTest {
 
   @Test
   public void testIncomingConnection() throws Exception {
-    StreamObserver<BeamFnApi.InstructionRequest> requestObserver = mock(StreamObserver.class);
-    StreamObserver<BeamFnApi.InstructionResponse> responseObserver =
-        controlService.control(requestObserver);
-
-    // TODO: https://issues.apache.org/jira/browse/BEAM-4149 Use proper worker id.
-    InstructionRequestHandler client = pool.getSource().take("", Duration.ofSeconds(2));
-
-    // Check that the client is wired up to the request channel
     String id = "fakeInstruction";
+    CompletableFuture<StreamObserver<InstructionResponse>> clientResponseStream =
+        new CompletableFuture<>();
+    clientResponseStream.complete(
+        stub.control(
+            TestStreams.<InstructionRequest>withOnNext(
+                    (request) -> {
+                      try {
+                        clientResponseStream
+                            .get()
+                            .onNext(
+                                InstructionResponse.newBuilder()
+                                    .setInstructionId(request.getInstructionId())
+                                    .build());
+                      } catch (Exception e) {
+                        fail("Unexpected failure");
+                        throw new RuntimeException(e);
+                      }
+                    })
+                .build()));
+
+    InstructionRequestHandler client = pool.getSource().take(WORKER_ID, Duration.ofSeconds(2));
+    // Check that the client is wired up to the request channel
     CompletionStage<BeamFnApi.InstructionResponse> responseFuture =
         client.handle(BeamFnApi.InstructionRequest.newBuilder().setInstructionId(id).build());
-    verify(requestObserver).onNext(any(BeamFnApi.InstructionRequest.class));
-    assertThat(MoreFutures.isDone(responseFuture), is(false));
-
-    // Check that the response channel really came from the client
-    responseObserver.onNext(
-        BeamFnApi.InstructionResponse.newBuilder().setInstructionId(id).build());
-    MoreFutures.get(responseFuture);
+    assertEquals(id, MoreFutures.get(responseFuture).getInstructionId());
   }
 
   @Test
@@ -116,8 +131,7 @@ public class FnApiControlClientPoolServiceTest {
           }
         });
 
-    // TODO: https://issues.apache.org/jira/browse/BEAM-4149 Use proper worker id.
-    pool.getSource().take("", Duration.ofSeconds(2));
+    pool.getSource().take(WORKER_ID, Duration.ofSeconds(2));
     server.close();
 
     latch.await();
diff --git a/runners/java-fn-execution/src/test/java/org/apache/beam/runners/fnexecution/control/RemoteExecutionTest.java b/runners/java-fn-execution/src/test/java/org/apache/beam/runners/fnexecution/control/RemoteExecutionTest.java
index 4a6609dfd5a..d361257b223 100644
--- a/runners/java-fn-execution/src/test/java/org/apache/beam/runners/fnexecution/control/RemoteExecutionTest.java
+++ b/runners/java-fn-execution/src/test/java/org/apache/beam/runners/fnexecution/control/RemoteExecutionTest.java
@@ -166,8 +166,10 @@ import org.slf4j.LoggerFactory;
   "keyfor"
 })
 public class RemoteExecutionTest implements Serializable {
+
   @Rule public transient ResetDateTimeProvider resetDateTimeProvider = new ResetDateTimeProvider();
 
+  private static final String WORKER_ID = "remote_test";
   private static final Logger LOG = LoggerFactory.getLogger(RemoteExecutionTest.class);
 
   private transient GrpcFnServer<FnApiControlClientPoolService> controlServer;
@@ -213,7 +215,7 @@ public class RemoteExecutionTest implements Serializable {
             () -> {
               try {
                 FnHarness.main(
-                    "id",
+                    WORKER_ID,
                     options,
                     Collections.emptySet(), // Runner capabilities.
                     loggingServer.getApiServiceDescriptor(),
@@ -225,9 +227,8 @@ public class RemoteExecutionTest implements Serializable {
                 throw new RuntimeException(e);
               }
             });
-    // TODO: https://issues.apache.org/jira/browse/BEAM-4149 Use proper worker id.
     InstructionRequestHandler controlClient =
-        clientPool.getSource().take("", java.time.Duration.ofSeconds(2));
+        clientPool.getSource().take(WORKER_ID, java.time.Duration.ofSeconds(2));
     this.controlClient = SdkHarnessClient.usingFnApiClient(controlClient, dataServer.getService());
   }
 
diff --git a/runners/java-fn-execution/src/test/java/org/apache/beam/runners/fnexecution/provisioning/StaticGrpcProvisionServiceTest.java b/runners/java-fn-execution/src/test/java/org/apache/beam/runners/fnexecution/provisioning/StaticGrpcProvisionServiceTest.java
index ac077134e61..0c6b9bf58dc 100644
--- a/runners/java-fn-execution/src/test/java/org/apache/beam/runners/fnexecution/provisioning/StaticGrpcProvisionServiceTest.java
+++ b/runners/java-fn-execution/src/test/java/org/apache/beam/runners/fnexecution/provisioning/StaticGrpcProvisionServiceTest.java
@@ -25,6 +25,7 @@ import org.apache.beam.model.fnexecution.v1.ProvisionApi.GetProvisionInfoRespons
 import org.apache.beam.model.fnexecution.v1.ProvisionApi.ProvisionInfo;
 import org.apache.beam.model.fnexecution.v1.ProvisionServiceGrpc;
 import org.apache.beam.model.fnexecution.v1.ProvisionServiceGrpc.ProvisionServiceBlockingStub;
+import org.apache.beam.sdk.fn.channel.AddHarnessIdInterceptor;
 import org.apache.beam.sdk.fn.server.GrpcContextHeaderAccessorProvider;
 import org.apache.beam.sdk.fn.server.GrpcFnServer;
 import org.apache.beam.sdk.fn.server.InProcessServerFactory;
@@ -72,7 +73,9 @@ public class StaticGrpcProvisionServiceTest {
 
     ProvisionServiceBlockingStub stub =
         ProvisionServiceGrpc.newBlockingStub(
-            InProcessChannelBuilder.forName(server.getApiServiceDescriptor().getUrl()).build());
+            InProcessChannelBuilder.forName(server.getApiServiceDescriptor().getUrl())
+                .intercept(AddHarnessIdInterceptor.create("test_worker"))
+                .build());
 
     GetProvisionInfoResponse provisionResponse =
         stub.getProvisionInfo(GetProvisionInfoRequest.getDefaultInstance());
diff --git a/runners/java-fn-execution/src/test/java/org/apache/beam/runners/fnexecution/status/BeamWorkerStatusGrpcServiceTest.java b/runners/java-fn-execution/src/test/java/org/apache/beam/runners/fnexecution/status/BeamWorkerStatusGrpcServiceTest.java
index 9499f38c9f0..5332fd83d7e 100644
--- a/runners/java-fn-execution/src/test/java/org/apache/beam/runners/fnexecution/status/BeamWorkerStatusGrpcServiceTest.java
+++ b/runners/java-fn-execution/src/test/java/org/apache/beam/runners/fnexecution/status/BeamWorkerStatusGrpcServiceTest.java
@@ -30,12 +30,12 @@ import java.util.concurrent.CompletableFuture;
 import java.util.concurrent.ExecutionException;
 import java.util.concurrent.TimeUnit;
 import java.util.concurrent.TimeoutException;
-import org.apache.beam.fn.harness.control.AddHarnessIdInterceptor;
 import org.apache.beam.model.fnexecution.v1.BeamFnApi.WorkerStatusRequest;
 import org.apache.beam.model.fnexecution.v1.BeamFnApi.WorkerStatusResponse;
 import org.apache.beam.model.fnexecution.v1.BeamFnWorkerStatusGrpc;
 import org.apache.beam.model.fnexecution.v1.BeamFnWorkerStatusGrpc.BeamFnWorkerStatusStub;
 import org.apache.beam.model.pipeline.v1.Endpoints.ApiServiceDescriptor;
+import org.apache.beam.sdk.fn.channel.AddHarnessIdInterceptor;
 import org.apache.beam.sdk.fn.server.GrpcContextHeaderAccessorProvider;
 import org.apache.beam.sdk.fn.server.GrpcFnServer;
 import org.apache.beam.sdk.fn.server.InProcessServerFactory;
diff --git a/sdks/java/harness/src/main/java/org/apache/beam/fn/harness/control/AddHarnessIdInterceptor.java b/sdks/java/fn-execution/src/main/java/org/apache/beam/sdk/fn/channel/AddHarnessIdInterceptor.java
similarity index 97%
rename from sdks/java/harness/src/main/java/org/apache/beam/fn/harness/control/AddHarnessIdInterceptor.java
rename to sdks/java/fn-execution/src/main/java/org/apache/beam/sdk/fn/channel/AddHarnessIdInterceptor.java
index 3d1117c6369..8e4dd754f16 100644
--- a/sdks/java/harness/src/main/java/org/apache/beam/fn/harness/control/AddHarnessIdInterceptor.java
+++ b/sdks/java/fn-execution/src/main/java/org/apache/beam/sdk/fn/channel/AddHarnessIdInterceptor.java
@@ -15,7 +15,7 @@
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */
-package org.apache.beam.fn.harness.control;
+package org.apache.beam.sdk.fn.channel;
 
 import static org.apache.beam.vendor.guava.v26_0_jre.com.google.common.base.Preconditions.checkArgument;
 
diff --git a/sdks/java/fn-execution/src/main/java/org/apache/beam/sdk/fn/server/GrpcContextHeaderAccessorProvider.java b/sdks/java/fn-execution/src/main/java/org/apache/beam/sdk/fn/server/GrpcContextHeaderAccessorProvider.java
index 738f7b0eebe..3e0d60d5a12 100644
--- a/sdks/java/fn-execution/src/main/java/org/apache/beam/sdk/fn/server/GrpcContextHeaderAccessorProvider.java
+++ b/sdks/java/fn-execution/src/main/java/org/apache/beam/sdk/fn/server/GrpcContextHeaderAccessorProvider.java
@@ -25,6 +25,7 @@ import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.ServerCall;
 import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.ServerCall.Listener;
 import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.ServerCallHandler;
 import org.apache.beam.vendor.grpc.v1p36p0.io.grpc.ServerInterceptor;
+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.base.Preconditions;
 
 /**
  * A HeaderAccessorProvider which intercept the header in a GRPC request and expose the relevant
@@ -65,14 +66,8 @@ public class GrpcContextHeaderAccessorProvider {
     @Override
     /** This method should be called from the request method. */
     public String getSdkWorkerId() {
-      // TODO: https://issues.apache.org/jira/browse/BEAM-4149 Some harnesses may not set the worker
-      // id header. Remove the null check below once this is fixed.
-      String workerId = SDK_WORKER_CONTEXT_KEY.get();
-      if (workerId == null) {
-        return "";
-      } else {
-        return workerId;
-      }
+      return Preconditions.checkNotNull(
+          SDK_WORKER_CONTEXT_KEY.get(), "No worker_id header provided in client headers.");
     }
   }
 }
diff --git a/sdks/java/harness/src/jmh/java/org/apache/beam/fn/harness/ProcessBundleBenchmark.java b/sdks/java/harness/src/jmh/java/org/apache/beam/fn/harness/ProcessBundleBenchmark.java
index 16ed438160e..c15afb4ca47 100644
--- a/sdks/java/harness/src/jmh/java/org/apache/beam/fn/harness/ProcessBundleBenchmark.java
+++ b/sdks/java/harness/src/jmh/java/org/apache/beam/fn/harness/ProcessBundleBenchmark.java
@@ -82,6 +82,8 @@ import org.openjdk.jmh.annotations.Threads;
 /** Benchmarks for processing a bundle end to end. */
 public class ProcessBundleBenchmark {
 
+  private static final String WORKER_ID = "benchmark_worker";
+
   /** Sets up the {@link ExecutionStateTracker} and an execution state. */
   @State(Scope.Benchmark)
   public static class SdkHarness {
@@ -136,7 +138,7 @@ public class ProcessBundleBenchmark {
                 () -> {
                   try {
                     FnHarness.main(
-                        "id",
+                        WORKER_ID,
                         PipelineOptionsFactory.create(),
                         Collections.emptySet(), // Runner capabilities.
                         loggingServer.getApiServiceDescriptor(),
@@ -148,9 +150,8 @@ public class ProcessBundleBenchmark {
                     throw new RuntimeException(e);
                   }
                 });
-        // TODO: https://issues.apache.org/jira/browse/BEAM-4149 Use proper worker id.
         InstructionRequestHandler controlClient =
-            clientPool.getSource().take("", java.time.Duration.ofSeconds(2));
+            clientPool.getSource().take(WORKER_ID, java.time.Duration.ofSeconds(2));
         this.controlClient =
             SdkHarnessClient.usingFnApiClient(controlClient, dataServer.getService());
       } catch (Exception e) {
diff --git a/sdks/java/harness/src/main/java/org/apache/beam/fn/harness/FnHarness.java b/sdks/java/harness/src/main/java/org/apache/beam/fn/harness/FnHarness.java
index 726b64b0d4d..62a61803707 100644
--- a/sdks/java/harness/src/main/java/org/apache/beam/fn/harness/FnHarness.java
+++ b/sdks/java/harness/src/main/java/org/apache/beam/fn/harness/FnHarness.java
@@ -27,7 +27,6 @@ import java.util.function.Function;
 import java.util.stream.Collectors;
 import java.util.stream.StreamSupport;
 import javax.annotation.Nullable;
-import org.apache.beam.fn.harness.control.AddHarnessIdInterceptor;
 import org.apache.beam.fn.harness.control.BeamFnControlClient;
 import org.apache.beam.fn.harness.control.FinalizeBundleHandler;
 import org.apache.beam.fn.harness.control.HarnessMonitoringInfosInstructionHandler;
@@ -49,6 +48,7 @@ import org.apache.beam.sdk.extensions.gcp.options.GcsOptions;
 import org.apache.beam.sdk.fn.IdGenerator;
 import org.apache.beam.sdk.fn.IdGenerators;
 import org.apache.beam.sdk.fn.JvmInitializers;
+import org.apache.beam.sdk.fn.channel.AddHarnessIdInterceptor;
 import org.apache.beam.sdk.fn.channel.ManagedChannelFactory;
 import org.apache.beam.sdk.fn.stream.OutboundObserverFactory;
 import org.apache.beam.sdk.function.ThrowingFunction;
@@ -180,8 +180,6 @@ public class FnHarness {
     }
     OutboundObserverFactory outboundObserverFactory =
         HarnessStreamObserverFactories.fromOptions(options);
-    channelFactory =
-        channelFactory.withInterceptors(ImmutableList.of(AddHarnessIdInterceptor.create(id)));
     main(
         id,
         options,
@@ -217,6 +215,9 @@ public class FnHarness {
       ManagedChannelFactory channelFactory,
       OutboundObserverFactory outboundObserverFactory)
       throws Exception {
+    channelFactory =
+        channelFactory.withInterceptors(ImmutableList.of(AddHarnessIdInterceptor.create(id)));
+
     IdGenerator idGenerator = IdGenerators.decrementingLongs();
     ShortIdMap metricsShortIds = new ShortIdMap();
     ExecutorService executorService = options.as(GcsOptions.class).getExecutorService();
