diff --git a/sdks/java/fn-execution/src/main/java/org/apache/beam/sdk/fn/stream/DirectStreamObserver.java b/sdks/java/fn-execution/src/main/java/org/apache/beam/sdk/fn/stream/DirectStreamObserver.java
index f60ea4b1ff3..20e590cf066 100644
--- a/sdks/java/fn-execution/src/main/java/org/apache/beam/sdk/fn/stream/DirectStreamObserver.java
+++ b/sdks/java/fn-execution/src/main/java/org/apache/beam/sdk/fn/stream/DirectStreamObserver.java
@@ -20,6 +20,7 @@ package org.apache.beam.sdk.fn.stream;
 import java.util.concurrent.Phaser;
 import java.util.concurrent.TimeUnit;
 import java.util.concurrent.TimeoutException;
+import java.util.concurrent.atomic.AtomicInteger;
 import javax.annotation.concurrent.ThreadSafe;
 import org.apache.beam.vendor.grpc.v1p26p0.io.grpc.stub.CallStreamObserver;
 import org.apache.beam.vendor.grpc.v1p26p0.io.grpc.stub.StreamObserver;
@@ -44,7 +45,7 @@ public final class DirectStreamObserver<T> implements StreamObserver<T> {
   private final CallStreamObserver<T> outboundObserver;
   private final int maxMessagesBeforeCheck;
 
-  private int numberOfMessagesBeforeReadyCheck;
+  private AtomicInteger numMessages = new AtomicInteger();
 
   public DirectStreamObserver(Phaser phaser, CallStreamObserver<T> outboundObserver) {
     this(phaser, outboundObserver, DEFAULT_MAX_MESSAGES_BEFORE_CHECK);
@@ -59,9 +60,8 @@ public final class DirectStreamObserver<T> implements StreamObserver<T> {
 
   @Override
   public void onNext(T value) {
-    numberOfMessagesBeforeReadyCheck += 1;
-    if (numberOfMessagesBeforeReadyCheck >= maxMessagesBeforeCheck) {
-      numberOfMessagesBeforeReadyCheck = 0;
+    if (maxMessagesBeforeCheck <= 1
+        || numMessages.incrementAndGet() % maxMessagesBeforeCheck == 0) {
       int waitTime = 1;
       int totalTimeWaited = 0;
       int phase = phaser.getPhase();
