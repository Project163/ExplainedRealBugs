diff --git a/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/SplittableParDo.java b/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/SplittableParDo.java
index 8a2d88e1cec..639c1551525 100644
--- a/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/SplittableParDo.java
+++ b/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/SplittableParDo.java
@@ -506,9 +506,8 @@ public class SplittableParDo<InputT, OutputT, RestrictionT, WatermarkEstimatorSt
     }
 
     @Setup
-    public void setup() {
-      invoker = DoFnInvokers.invokerFor(fn);
-      invoker.invokeSetup();
+    public void setup(PipelineOptions options) {
+      invoker = DoFnInvokers.tryInvokeSetupFor(fn, options);
     }
 
     @ProcessElement
@@ -571,9 +570,8 @@ public class SplittableParDo<InputT, OutputT, RestrictionT, WatermarkEstimatorSt
     }
 
     @Setup
-    public void setup() {
-      invoker = DoFnInvokers.invokerFor(splittableFn);
-      invoker.invokeSetup();
+    public void setup(PipelineOptions options) {
+      invoker = DoFnInvokers.tryInvokeSetupFor(splittableFn, options);
     }
 
     @ProcessElement
diff --git a/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/SplittableParDoNaiveBounded.java b/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/SplittableParDoNaiveBounded.java
index e53c14c0d0f..4949491ee9f 100644
--- a/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/SplittableParDoNaiveBounded.java
+++ b/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/SplittableParDoNaiveBounded.java
@@ -134,9 +134,20 @@ public class SplittableParDoNaiveBounded {
     }
 
     @Setup
-    public void setup() {
+    public void setup(PipelineOptions options) {
       this.invoker = DoFnInvokers.invokerFor(fn);
-      invoker.invokeSetup();
+      invoker.invokeSetup(
+          new BaseArgumentProvider<InputT, OutputT>() {
+            @Override
+            public PipelineOptions pipelineOptions() {
+              return options;
+            }
+
+            @Override
+            public String getErrorContext() {
+              return "SplittableParDoNaiveBounded/Setup";
+            }
+          });
     }
 
     @StartBundle
@@ -574,7 +585,6 @@ public class SplittableParDoNaiveBounded {
       }
 
       // ----------- Unsupported methods --------------------
-
       @Override
       public DoFn<InputT, OutputT>.StartBundleContext startBundleContext(
           DoFn<InputT, OutputT> doFn) {
diff --git a/runners/core-java/src/main/java/org/apache/beam/runners/core/SplittableParDoViaKeyedWorkItems.java b/runners/core-java/src/main/java/org/apache/beam/runners/core/SplittableParDoViaKeyedWorkItems.java
index a9856f0f272..54561e7a34c 100644
--- a/runners/core-java/src/main/java/org/apache/beam/runners/core/SplittableParDoViaKeyedWorkItems.java
+++ b/runners/core-java/src/main/java/org/apache/beam/runners/core/SplittableParDoViaKeyedWorkItems.java
@@ -319,9 +319,9 @@ public class SplittableParDoViaKeyedWorkItems {
     }
 
     @Setup
-    public void setup() throws Exception {
+    public void setup(PipelineOptions options) throws Exception {
       invoker = DoFnInvokers.invokerFor(fn);
-      invoker.invokeSetup();
+      invoker.invokeSetup(wrapOptionsAsSetup(options));
     }
 
     @Teardown
@@ -548,6 +548,21 @@ public class SplittableParDoViaKeyedWorkItems {
               stateNamespace, wakeupTime, wakeupTime, TimeDomain.PROCESSING_TIME));
     }
 
+    private DoFnInvoker.ArgumentProvider<InputT, OutputT> wrapOptionsAsSetup(
+        final PipelineOptions options) {
+      return new BaseArgumentProvider<InputT, OutputT>() {
+        @Override
+        public PipelineOptions pipelineOptions() {
+          return options;
+        }
+
+        @Override
+        public String getErrorContext() {
+          return "SplittableParDoViaKeyedWorkItems/Setup";
+        }
+      };
+    }
+
     private DoFnInvoker.ArgumentProvider<InputT, OutputT> wrapContextAsStartBundle(
         final StartBundleContext baseContext) {
       return new BaseArgumentProvider<InputT, OutputT>() {
diff --git a/runners/direct-java/src/main/java/org/apache/beam/runners/direct/DoFnLifecycleManager.java b/runners/direct-java/src/main/java/org/apache/beam/runners/direct/DoFnLifecycleManager.java
index 788a8a0e001..fdd46673a45 100644
--- a/runners/direct-java/src/main/java/org/apache/beam/runners/direct/DoFnLifecycleManager.java
+++ b/runners/direct-java/src/main/java/org/apache/beam/runners/direct/DoFnLifecycleManager.java
@@ -21,6 +21,7 @@ import java.util.Collection;
 import java.util.concurrent.ConcurrentHashMap;
 import java.util.concurrent.ConcurrentMap;
 import org.apache.beam.sdk.PipelineRunner;
+import org.apache.beam.sdk.options.PipelineOptions;
 import org.apache.beam.sdk.transforms.DoFn;
 import org.apache.beam.sdk.transforms.DoFn.Setup;
 import org.apache.beam.sdk.transforms.DoFn.Teardown;
@@ -41,18 +42,18 @@ import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.cache.RemovalNot
  * clearing all cached {@link DoFn DoFns}.
  */
 class DoFnLifecycleManager {
-  public static DoFnLifecycleManager of(DoFn<?, ?> original) {
-    return new DoFnLifecycleManager(original);
+  public static DoFnLifecycleManager of(DoFn<?, ?> original, PipelineOptions options) {
+    return new DoFnLifecycleManager(original, options);
   }
 
   private final LoadingCache<Thread, DoFn<?, ?>> outstanding;
   private final ConcurrentMap<Thread, Exception> thrownOnTeardown;
 
-  private DoFnLifecycleManager(DoFn<?, ?> original) {
+  private DoFnLifecycleManager(DoFn<?, ?> original, PipelineOptions options) {
     this.outstanding =
         CacheBuilder.newBuilder()
             .removalListener(new TeardownRemovedFnListener())
-            .build(new DeserializingCacheLoader(original));
+            .build(new DeserializingCacheLoader(original, options));
     thrownOnTeardown = new ConcurrentHashMap<>();
   }
 
@@ -90,9 +91,11 @@ class DoFnLifecycleManager {
 
   private static class DeserializingCacheLoader extends CacheLoader<Thread, DoFn<?, ?>> {
     private final byte[] original;
+    private final PipelineOptions options;
 
-    public DeserializingCacheLoader(DoFn<?, ?> original) {
+    public DeserializingCacheLoader(DoFn<?, ?> original, PipelineOptions options) {
       this.original = SerializableUtils.serializeToByteArray(original);
+      this.options = options;
     }
 
     @Override
@@ -101,7 +104,7 @@ class DoFnLifecycleManager {
           (DoFn<?, ?>)
               SerializableUtils.deserializeFromByteArray(
                   original, "DoFn Copy in thread " + key.getName());
-      DoFnInvokers.tryInvokeSetupFor(fn);
+      DoFnInvokers.tryInvokeSetupFor(fn, options);
       return fn;
     }
   }
diff --git a/runners/direct-java/src/main/java/org/apache/beam/runners/direct/ParDoEvaluatorFactory.java b/runners/direct-java/src/main/java/org/apache/beam/runners/direct/ParDoEvaluatorFactory.java
index 80b90e6077c..1ae6c07457d 100644
--- a/runners/direct-java/src/main/java/org/apache/beam/runners/direct/ParDoEvaluatorFactory.java
+++ b/runners/direct-java/src/main/java/org/apache/beam/runners/direct/ParDoEvaluatorFactory.java
@@ -65,7 +65,8 @@ final class ParDoEvaluatorFactory<InputT, OutputT> implements TransformEvaluator
     return new CacheLoader<AppliedPTransform<?, ?, ?>, DoFnLifecycleManager>() {
       @Override
       public DoFnLifecycleManager load(AppliedPTransform<?, ?, ?> application) throws Exception {
-        return DoFnLifecycleManager.of(ParDoTranslation.getDoFn(application));
+        return DoFnLifecycleManager.of(
+            ParDoTranslation.getDoFn(application), application.getPipeline().getOptions());
       }
     };
   }
diff --git a/runners/direct-java/src/main/java/org/apache/beam/runners/direct/SplittableProcessElementsEvaluatorFactory.java b/runners/direct-java/src/main/java/org/apache/beam/runners/direct/SplittableProcessElementsEvaluatorFactory.java
index b35a34548e3..e3852f640b4 100644
--- a/runners/direct-java/src/main/java/org/apache/beam/runners/direct/SplittableProcessElementsEvaluatorFactory.java
+++ b/runners/direct-java/src/main/java/org/apache/beam/runners/direct/SplittableProcessElementsEvaluatorFactory.java
@@ -80,7 +80,7 @@ class SplittableProcessElementsEvaluatorFactory<
                         (ProcessElements<
                                 InputT, OutputT, RestrictionT, PositionT, WatermarkEstimatorStateT>)
                             application.getTransform();
-                return DoFnLifecycleManager.of(transform.newProcessFn(transform.getFn()));
+                return DoFnLifecycleManager.of(transform.newProcessFn(transform.getFn()), options);
               }
             },
             options);
diff --git a/runners/direct-java/src/main/java/org/apache/beam/runners/direct/StatefulParDoEvaluatorFactory.java b/runners/direct-java/src/main/java/org/apache/beam/runners/direct/StatefulParDoEvaluatorFactory.java
index 0fdde757326..40442521c3e 100644
--- a/runners/direct-java/src/main/java/org/apache/beam/runners/direct/StatefulParDoEvaluatorFactory.java
+++ b/runners/direct-java/src/main/java/org/apache/beam/runners/direct/StatefulParDoEvaluatorFactory.java
@@ -73,7 +73,7 @@ final class StatefulParDoEvaluatorFactory<K, InputT, OutputT> implements Transfo
                 // do not go through the portability translation layers
                 StatefulParDo<?, ?, ?> statefulParDo =
                     (StatefulParDo<?, ?, ?>) appliedStatefulParDo.getTransform();
-                return DoFnLifecycleManager.of(statefulParDo.getDoFn());
+                return DoFnLifecycleManager.of(statefulParDo.getDoFn(), options);
               }
             },
             options);
diff --git a/runners/direct-java/src/test/java/org/apache/beam/runners/direct/DoFnLifecycleManagerRemovingTransformEvaluatorTest.java b/runners/direct-java/src/test/java/org/apache/beam/runners/direct/DoFnLifecycleManagerRemovingTransformEvaluatorTest.java
index 465759b5655..e042fc7df82 100644
--- a/runners/direct-java/src/test/java/org/apache/beam/runners/direct/DoFnLifecycleManagerRemovingTransformEvaluatorTest.java
+++ b/runners/direct-java/src/test/java/org/apache/beam/runners/direct/DoFnLifecycleManagerRemovingTransformEvaluatorTest.java
@@ -28,6 +28,7 @@ import static org.mockito.Mockito.verify;
 
 import org.apache.beam.runners.core.StateNamespaces;
 import org.apache.beam.runners.core.TimerInternals.TimerData;
+import org.apache.beam.sdk.options.PipelineOptionsFactory;
 import org.apache.beam.sdk.state.TimeDomain;
 import org.apache.beam.sdk.transforms.DoFn;
 import org.apache.beam.sdk.transforms.windowing.BoundedWindow;
@@ -47,7 +48,7 @@ public class DoFnLifecycleManagerRemovingTransformEvaluatorTest {
 
   @Before
   public void setup() {
-    lifecycleManager = DoFnLifecycleManager.of(new TestFn());
+    lifecycleManager = DoFnLifecycleManager.of(new TestFn(), PipelineOptionsFactory.create());
   }
 
   @Test
diff --git a/runners/direct-java/src/test/java/org/apache/beam/runners/direct/DoFnLifecycleManagerTest.java b/runners/direct-java/src/test/java/org/apache/beam/runners/direct/DoFnLifecycleManagerTest.java
index c877bb1379a..61e62bd42e7 100644
--- a/runners/direct-java/src/test/java/org/apache/beam/runners/direct/DoFnLifecycleManagerTest.java
+++ b/runners/direct-java/src/test/java/org/apache/beam/runners/direct/DoFnLifecycleManagerTest.java
@@ -33,6 +33,7 @@ import java.util.concurrent.ExecutorService;
 import java.util.concurrent.Executors;
 import java.util.concurrent.Future;
 import java.util.concurrent.TimeUnit;
+import org.apache.beam.sdk.options.PipelineOptionsFactory;
 import org.apache.beam.sdk.transforms.DoFn;
 import org.apache.beam.sdk.util.UserCodeException;
 import org.hamcrest.Matchers;
@@ -48,7 +49,7 @@ public class DoFnLifecycleManagerTest {
   @Rule public ExpectedException thrown = ExpectedException.none();
 
   private TestFn fn = new TestFn();
-  private DoFnLifecycleManager mgr = DoFnLifecycleManager.of(fn);
+  private DoFnLifecycleManager mgr = DoFnLifecycleManager.of(fn, PipelineOptionsFactory.create());
 
   @Test
   public void setupOnGet() throws Exception {
diff --git a/runners/direct-java/src/test/java/org/apache/beam/runners/direct/DoFnLifecycleManagersTest.java b/runners/direct-java/src/test/java/org/apache/beam/runners/direct/DoFnLifecycleManagersTest.java
index dfa24af7451..a47ed55430d 100644
--- a/runners/direct-java/src/test/java/org/apache/beam/runners/direct/DoFnLifecycleManagersTest.java
+++ b/runners/direct-java/src/test/java/org/apache/beam/runners/direct/DoFnLifecycleManagersTest.java
@@ -23,6 +23,8 @@ import static org.hamcrest.Matchers.instanceOf;
 
 import java.util.ArrayList;
 import java.util.Collection;
+import org.apache.beam.sdk.options.PipelineOptions;
+import org.apache.beam.sdk.options.PipelineOptionsFactory;
 import org.apache.beam.sdk.transforms.DoFn;
 import org.apache.beam.sdk.util.UserCodeException;
 import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableList;
@@ -43,9 +45,10 @@ public class DoFnLifecycleManagersTest {
 
   @Test
   public void removeAllWhenManagersThrowSuppressesAndThrows() throws Exception {
-    DoFnLifecycleManager first = DoFnLifecycleManager.of(new ThrowsInCleanupFn("foo"));
-    DoFnLifecycleManager second = DoFnLifecycleManager.of(new ThrowsInCleanupFn("bar"));
-    DoFnLifecycleManager third = DoFnLifecycleManager.of(new ThrowsInCleanupFn("baz"));
+    PipelineOptions options = PipelineOptionsFactory.create();
+    DoFnLifecycleManager first = DoFnLifecycleManager.of(new ThrowsInCleanupFn("foo"), options);
+    DoFnLifecycleManager second = DoFnLifecycleManager.of(new ThrowsInCleanupFn("bar"), options);
+    DoFnLifecycleManager third = DoFnLifecycleManager.of(new ThrowsInCleanupFn("baz"), options);
     first.get();
     second.get();
     third.get();
@@ -89,9 +92,10 @@ public class DoFnLifecycleManagersTest {
 
   @Test
   public void whenManagersSucceedSucceeds() throws Exception {
-    DoFnLifecycleManager first = DoFnLifecycleManager.of(new EmptyFn());
-    DoFnLifecycleManager second = DoFnLifecycleManager.of(new EmptyFn());
-    DoFnLifecycleManager third = DoFnLifecycleManager.of(new EmptyFn());
+    PipelineOptions options = PipelineOptionsFactory.create();
+    DoFnLifecycleManager first = DoFnLifecycleManager.of(new EmptyFn(), options);
+    DoFnLifecycleManager second = DoFnLifecycleManager.of(new EmptyFn(), options);
+    DoFnLifecycleManager third = DoFnLifecycleManager.of(new EmptyFn(), options);
     first.get();
     second.get();
     third.get();
diff --git a/runners/flink/src/main/java/org/apache/beam/runners/flink/translation/functions/FlinkDoFnFunction.java b/runners/flink/src/main/java/org/apache/beam/runners/flink/translation/functions/FlinkDoFnFunction.java
index 1ec4620a620..cfcf2861748 100644
--- a/runners/flink/src/main/java/org/apache/beam/runners/flink/translation/functions/FlinkDoFnFunction.java
+++ b/runners/flink/src/main/java/org/apache/beam/runners/flink/translation/functions/FlinkDoFnFunction.java
@@ -131,8 +131,9 @@ public class FlinkDoFnFunction<InputT, OutputT> extends AbstractRichFunction
     // Note that the SerializablePipelineOptions already initialize FileSystems in the readObject()
     // deserialization method. However, this is a hack, and we want to properly initialize the
     // options where they are needed.
-    FileSystems.setDefaultPipelineOptions(serializedOptions.get());
-    doFnInvoker = DoFnInvokers.tryInvokeSetupFor(doFn);
+    PipelineOptions options = serializedOptions.get();
+    FileSystems.setDefaultPipelineOptions(options);
+    doFnInvoker = DoFnInvokers.tryInvokeSetupFor(doFn, options);
     metricContainer = new FlinkMetricContainer(getRuntimeContext());
 
     // setup DoFnRunner
@@ -149,7 +150,7 @@ public class FlinkDoFnFunction<InputT, OutputT> extends AbstractRichFunction
 
     DoFnRunner<InputT, OutputT> doFnRunner =
         DoFnRunners.simpleRunner(
-            serializedOptions.get(),
+            options,
             doFn,
             new FlinkSideInputReader(sideInputs, runtimeContext),
             outputManager,
diff --git a/runners/flink/src/main/java/org/apache/beam/runners/flink/translation/functions/FlinkStatefulDoFnFunction.java b/runners/flink/src/main/java/org/apache/beam/runners/flink/translation/functions/FlinkStatefulDoFnFunction.java
index 7c6453a07c7..d007ce1dc6a 100644
--- a/runners/flink/src/main/java/org/apache/beam/runners/flink/translation/functions/FlinkStatefulDoFnFunction.java
+++ b/runners/flink/src/main/java/org/apache/beam/runners/flink/translation/functions/FlinkStatefulDoFnFunction.java
@@ -236,9 +236,10 @@ public class FlinkStatefulDoFnFunction<K, V, OutputT>
     // Note that the SerializablePipelineOptions already initialize FileSystems in the readObject()
     // deserialization method. However, this is a hack, and we want to properly initialize the
     // options where they are needed.
-    FileSystems.setDefaultPipelineOptions(serializedOptions.get());
+    PipelineOptions options = serializedOptions.get();
+    FileSystems.setDefaultPipelineOptions(options);
     metricContainer = new FlinkMetricContainer(getRuntimeContext());
-    doFnInvoker = DoFnInvokers.tryInvokeSetupFor(dofn);
+    doFnInvoker = DoFnInvokers.tryInvokeSetupFor(dofn, options);
   }
 
   @Override
diff --git a/runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/DoFnOperator.java b/runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/DoFnOperator.java
index b463db26779..7f3dc0b45f6 100644
--- a/runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/DoFnOperator.java
+++ b/runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/DoFnOperator.java
@@ -465,10 +465,10 @@ public class DoFnOperator<InputT, OutputT>
     // So must wait StateInternals and TimerInternals ready.
     // This will be called after initializeState()
     this.doFn = getDoFn();
-    doFnInvoker = DoFnInvokers.invokerFor(doFn);
-    doFnInvoker.invokeSetup();
 
     FlinkPipelineOptions options = serializedOptions.get().as(FlinkPipelineOptions.class);
+    doFnInvoker = DoFnInvokers.tryInvokeSetupFor(doFn, options);
+
     StepContext stepContext = new FlinkStepContext();
     doFnRunner =
         DoFnRunners.simpleRunner(
diff --git a/runners/google-cloud-dataflow-java/src/main/java/org/apache/beam/runners/dataflow/BatchStatefulParDoOverrides.java b/runners/google-cloud-dataflow-java/src/main/java/org/apache/beam/runners/dataflow/BatchStatefulParDoOverrides.java
index 26774b7abdf..2b3ff50224e 100644
--- a/runners/google-cloud-dataflow-java/src/main/java/org/apache/beam/runners/dataflow/BatchStatefulParDoOverrides.java
+++ b/runners/google-cloud-dataflow-java/src/main/java/org/apache/beam/runners/dataflow/BatchStatefulParDoOverrides.java
@@ -27,6 +27,7 @@ import org.apache.beam.runners.dataflow.options.DataflowPipelineOptions;
 import org.apache.beam.sdk.coders.Coder;
 import org.apache.beam.sdk.coders.InstantCoder;
 import org.apache.beam.sdk.coders.KvCoder;
+import org.apache.beam.sdk.options.PipelineOptions;
 import org.apache.beam.sdk.runners.AppliedPTransform;
 import org.apache.beam.sdk.runners.PTransformOverrideFactory;
 import org.apache.beam.sdk.transforms.DoFn;
@@ -310,8 +311,8 @@ public class BatchStatefulParDoOverrides {
     }
 
     @Setup
-    public void setup() {
-      DoFnInvokers.invokerFor(underlyingDoFn).invokeSetup();
+    public void setup(final PipelineOptions options) {
+      DoFnInvokers.tryInvokeSetupFor(underlyingDoFn, options);
     }
 
     @ProcessElement
diff --git a/runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/DoFnInstanceManagers.java b/runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/DoFnInstanceManagers.java
index 6570a464231..175bcefd46b 100644
--- a/runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/DoFnInstanceManagers.java
+++ b/runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/DoFnInstanceManagers.java
@@ -18,6 +18,7 @@
 package org.apache.beam.runners.dataflow.worker;
 
 import java.util.concurrent.ConcurrentLinkedQueue;
+import org.apache.beam.sdk.options.PipelineOptions;
 import org.apache.beam.sdk.transforms.DoFn;
 import org.apache.beam.sdk.transforms.reflect.DoFnInvokers;
 import org.apache.beam.sdk.util.DoFnInfo;
@@ -33,8 +34,8 @@ public class DoFnInstanceManagers {
    * deserializing the provided bytes. {@link DoFnInstanceManager} will call {@link DoFn.Setup} as
    * required before returning the {@link DoFnInfo}, and {@link DoFn.Teardown} as appropriate.
    */
-  public static DoFnInstanceManager cloningPool(DoFnInfo<?, ?> info) {
-    return new ConcurrentQueueInstanceManager(info);
+  public static DoFnInstanceManager cloningPool(DoFnInfo<?, ?> info, PipelineOptions options) {
+    return new ConcurrentQueueInstanceManager(info, options);
   }
 
   /**
@@ -52,10 +53,12 @@ public class DoFnInstanceManagers {
   private static class ConcurrentQueueInstanceManager implements DoFnInstanceManager {
     private final byte[] serializedFnInfo;
     private final ConcurrentLinkedQueue<DoFnInfo<?, ?>> fns;
+    private final PipelineOptions options;
 
-    private ConcurrentQueueInstanceManager(DoFnInfo<?, ?> info) {
+    private ConcurrentQueueInstanceManager(DoFnInfo<?, ?> info, PipelineOptions options) {
       this.serializedFnInfo = SerializableUtils.serializeToByteArray(info);
-      fns = new ConcurrentLinkedQueue<>();
+      this.fns = new ConcurrentLinkedQueue<>();
+      this.options = options;
     }
 
     @Override
@@ -80,7 +83,7 @@ public class DoFnInstanceManagers {
     private DoFnInfo<?, ?> deserializeCopy() throws Exception {
       DoFnInfo<?, ?> fn;
       fn = (DoFnInfo<?, ?>) SerializableUtils.deserializeFromByteArray(serializedFnInfo, null);
-      DoFnInvokers.invokerFor(fn.getDoFn()).invokeSetup();
+      DoFnInvokers.tryInvokeSetupFor(fn.getDoFn(), options);
       return fn;
     }
 
diff --git a/runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/UserParDoFnFactory.java b/runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/UserParDoFnFactory.java
index 600bec642db..58760ac3595 100644
--- a/runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/UserParDoFnFactory.java
+++ b/runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/UserParDoFnFactory.java
@@ -94,7 +94,8 @@ class UserParDoFnFactory implements ParDoFnFactory {
     DoFnInstanceManager instanceManager =
         fnCache.get(
             operationContext.nameContext().systemName(),
-            () -> DoFnInstanceManagers.cloningPool(doFnExtractor.getDoFnInfo(cloudUserFn)));
+            () ->
+                DoFnInstanceManagers.cloningPool(doFnExtractor.getDoFnInfo(cloudUserFn), options));
 
     DoFnInfo<?, ?> doFnInfo = instanceManager.peek();
 
diff --git a/runners/google-cloud-dataflow-java/worker/src/test/java/org/apache/beam/runners/dataflow/worker/DoFnInstanceManagersTest.java b/runners/google-cloud-dataflow-java/worker/src/test/java/org/apache/beam/runners/dataflow/worker/DoFnInstanceManagersTest.java
index 990219e8ee1..7e53b155026 100644
--- a/runners/google-cloud-dataflow-java/worker/src/test/java/org/apache/beam/runners/dataflow/worker/DoFnInstanceManagersTest.java
+++ b/runners/google-cloud-dataflow-java/worker/src/test/java/org/apache/beam/runners/dataflow/worker/DoFnInstanceManagersTest.java
@@ -25,6 +25,8 @@ import static org.junit.Assert.fail;
 
 import java.util.Collections;
 import org.apache.beam.runners.dataflow.util.PropertyNames;
+import org.apache.beam.sdk.options.PipelineOptions;
+import org.apache.beam.sdk.options.PipelineOptionsFactory;
 import org.apache.beam.sdk.transforms.DoFn;
 import org.apache.beam.sdk.transforms.DoFnSchemaInformation;
 import org.apache.beam.sdk.util.DoFnInfo;
@@ -58,6 +60,7 @@ public class DoFnInstanceManagersTest {
   }
 
   private DoFn<?, ?> initialFn = new TestFn();
+  private PipelineOptions options = PipelineOptionsFactory.create();
 
   @Test
   public void testInstanceReturnsInstance() throws Exception {
@@ -114,7 +117,7 @@ public class DoFnInstanceManagersTest {
             DoFnSchemaInformation.create(),
             Collections.emptyMap());
 
-    DoFnInstanceManager mgr = DoFnInstanceManagers.cloningPool(info);
+    DoFnInstanceManager mgr = DoFnInstanceManagers.cloningPool(info, options);
     DoFnInfo<?, ?> retrievedInfo = mgr.get();
     assertThat(retrievedInfo, not(Matchers.<DoFnInfo<?, ?>>theInstance(info)));
     assertThat(retrievedInfo.getDoFn(), not(theInstance(info.getDoFn())));
@@ -137,7 +140,7 @@ public class DoFnInstanceManagersTest {
             DoFnSchemaInformation.create(),
             Collections.emptyMap());
 
-    DoFnInstanceManager mgr = DoFnInstanceManagers.cloningPool(info);
+    DoFnInstanceManager mgr = DoFnInstanceManagers.cloningPool(info, options);
     DoFnInfo<?, ?> retrievedInfo = mgr.get();
 
     mgr.abort(retrievedInfo);
@@ -162,7 +165,7 @@ public class DoFnInstanceManagersTest {
             DoFnSchemaInformation.create(),
             Collections.emptyMap());
 
-    DoFnInstanceManager mgr = DoFnInstanceManagers.cloningPool(info);
+    DoFnInstanceManager mgr = DoFnInstanceManagers.cloningPool(info, options);
 
     DoFnInfo<?, ?> firstInfo = mgr.get();
     DoFnInfo<?, ?> secondInfo = mgr.get();
diff --git a/runners/google-cloud-dataflow-java/worker/src/test/java/org/apache/beam/runners/dataflow/worker/SimpleParDoFnTest.java b/runners/google-cloud-dataflow-java/worker/src/test/java/org/apache/beam/runners/dataflow/worker/SimpleParDoFnTest.java
index 6c7ab4331ed..d798bd71864 100644
--- a/runners/google-cloud-dataflow-java/worker/src/test/java/org/apache/beam/runners/dataflow/worker/SimpleParDoFnTest.java
+++ b/runners/google-cloud-dataflow-java/worker/src/test/java/org/apache/beam/runners/dataflow/worker/SimpleParDoFnTest.java
@@ -215,7 +215,7 @@ public class SimpleParDoFnTest {
     ParDoFn userParDoFn =
         new SimpleParDoFn<>(
             options,
-            DoFnInstanceManagers.cloningPool(fnInfo),
+            DoFnInstanceManagers.cloningPool(fnInfo, options),
             new EmptySideInputReader(),
             MAIN_OUTPUT,
             ImmutableMap.of(
@@ -437,7 +437,7 @@ public class SimpleParDoFnTest {
     ParDoFn userParDoFn =
         new SimpleParDoFn<>(
             options,
-            DoFnInstanceManagers.cloningPool(fnInfo),
+            DoFnInstanceManagers.cloningPool(fnInfo, options),
             NullSideInputReader.empty(),
             MAIN_OUTPUT,
             ImmutableMap.of(MAIN_OUTPUT, 0, new TupleTag<String>("declared"), 1),
diff --git a/runners/jet/src/main/java/org/apache/beam/runners/jet/processors/AbstractParDoP.java b/runners/jet/src/main/java/org/apache/beam/runners/jet/processors/AbstractParDoP.java
index 92b4449f677..c5df5a6fa3b 100644
--- a/runners/jet/src/main/java/org/apache/beam/runners/jet/processors/AbstractParDoP.java
+++ b/runners/jet/src/main/java/org/apache/beam/runners/jet/processors/AbstractParDoP.java
@@ -148,8 +148,7 @@ abstract class AbstractParDoP<InputT, OutputT> implements Processor {
     this.outbox = outbox;
     this.metricsContainer = new JetMetricsContainer(stepId, ownerId, context);
 
-    doFnInvoker = DoFnInvokers.invokerFor(doFn);
-    doFnInvoker.invokeSetup();
+    doFnInvoker = DoFnInvokers.tryInvokeSetupFor(doFn, pipelineOptions.get());
 
     if (ordinalToSideInput.isEmpty()) {
       sideInputReader = NullSideInputReader.of(Collections.emptyList());
diff --git a/runners/samza/src/main/java/org/apache/beam/runners/samza/runtime/DoFnOp.java b/runners/samza/src/main/java/org/apache/beam/runners/samza/runtime/DoFnOp.java
index 6565218db8d..ac8212111e7 100644
--- a/runners/samza/src/main/java/org/apache/beam/runners/samza/runtime/DoFnOp.java
+++ b/runners/samza/src/main/java/org/apache/beam/runners/samza/runtime/DoFnOp.java
@@ -257,12 +257,11 @@ public class DoFnOp<InT, FnOutT, OutT> implements Op<InT, OutT, Void> {
         ServiceLoader.load(SamzaDoFnInvokerRegistrar.class).iterator();
     if (!invokerReg.hasNext()) {
       // use the default invoker here
-      doFnInvoker = DoFnInvokers.invokerFor(doFn);
+      doFnInvoker = DoFnInvokers.tryInvokeSetupFor(doFn, samzaPipelineOptions);
     } else {
-      doFnInvoker = Iterators.getOnlyElement(invokerReg).invokerFor(doFn, context);
+      doFnInvoker =
+          Iterators.getOnlyElement(invokerReg).invokerSetupFor(doFn, samzaPipelineOptions, context);
     }
-
-    doFnInvoker.invokeSetup();
   }
 
   /*package private*/ FutureCollector<OutT> createFutureCollector() {
diff --git a/runners/samza/src/main/java/org/apache/beam/runners/samza/runtime/SamzaDoFnInvokerRegistrar.java b/runners/samza/src/main/java/org/apache/beam/runners/samza/runtime/SamzaDoFnInvokerRegistrar.java
index ebb01b0e610..c0536161cb7 100644
--- a/runners/samza/src/main/java/org/apache/beam/runners/samza/runtime/SamzaDoFnInvokerRegistrar.java
+++ b/runners/samza/src/main/java/org/apache/beam/runners/samza/runtime/SamzaDoFnInvokerRegistrar.java
@@ -18,6 +18,7 @@
 package org.apache.beam.runners.samza.runtime;
 
 import java.util.Map;
+import org.apache.beam.sdk.options.PipelineOptions;
 import org.apache.beam.sdk.transforms.DoFn;
 import org.apache.beam.sdk.transforms.reflect.DoFnInvoker;
 import org.apache.samza.context.Context;
@@ -26,8 +27,8 @@ import org.apache.samza.context.Context;
 public interface SamzaDoFnInvokerRegistrar {
 
   /** Returns the invoker for a {@link DoFn}. */
-  <InputT, OutputT> DoFnInvoker<InputT, OutputT> invokerFor(
-      DoFn<InputT, OutputT> fn, Context context);
+  <InputT, OutputT> DoFnInvoker<InputT, OutputT> invokerSetupFor(
+      DoFn<InputT, OutputT> fn, PipelineOptions options, Context context);
 
   /** Returns the configs for a {@link DoFn}. */
   <InputT, OutputT> Map<String, String> configFor(DoFn<InputT, OutputT> fn);
diff --git a/runners/samza/src/main/java/org/apache/beam/runners/samza/runtime/SplittableParDoProcessKeyedElementsOp.java b/runners/samza/src/main/java/org/apache/beam/runners/samza/runtime/SplittableParDoProcessKeyedElementsOp.java
index a09693f91f2..cb926ef8620 100644
--- a/runners/samza/src/main/java/org/apache/beam/runners/samza/runtime/SplittableParDoProcessKeyedElementsOp.java
+++ b/runners/samza/src/main/java/org/apache/beam/runners/samza/runtime/SplittableParDoProcessKeyedElementsOp.java
@@ -145,7 +145,7 @@ public class SplittableParDoProcessKeyedElementsOp<
     SplittableParDoViaKeyedWorkItems.ProcessFn<
             InputT, OutputT, RestrictionT, PositionT, WatermarkEstimatorStateT>
         processFn = processElements.newProcessFn(processElements.getFn());
-    DoFnInvokers.tryInvokeSetupFor(processFn);
+    DoFnInvokers.tryInvokeSetupFor(processFn, pipelineOptions);
     processFn.setStateInternalsFactory(stateInternalsFactory);
     processFn.setTimerInternalsFactory(timerInternalsFactory);
     processFn.setProcessElementInvoker(
diff --git a/runners/spark/2/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/DoFnFunction.java b/runners/spark/2/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/DoFnFunction.java
index 0e2a40f8f9f..ccddf62cf46 100644
--- a/runners/spark/2/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/DoFnFunction.java
+++ b/runners/spark/2/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/DoFnFunction.java
@@ -106,7 +106,7 @@ public class DoFnFunction<InputT, OutputT>
   public Iterator<Tuple2<TupleTag<?>, WindowedValue<?>>> call(Iterator<WindowedValue<InputT>> iter)
       throws Exception {
     if (!wasSetupCalled && iter.hasNext()) {
-      DoFnInvokers.tryInvokeSetupFor(doFn);
+      DoFnInvokers.tryInvokeSetupFor(doFn, serializableOptions.get());
       wasSetupCalled = true;
     }
 
diff --git a/runners/spark/src/main/java/org/apache/beam/runners/spark/translation/MultiDoFnFunction.java b/runners/spark/src/main/java/org/apache/beam/runners/spark/translation/MultiDoFnFunction.java
index c9c7c8321be..f19369cc4de 100644
--- a/runners/spark/src/main/java/org/apache/beam/runners/spark/translation/MultiDoFnFunction.java
+++ b/runners/spark/src/main/java/org/apache/beam/runners/spark/translation/MultiDoFnFunction.java
@@ -126,7 +126,7 @@ public class MultiDoFnFunction<InputT, OutputT>
   public Iterator<Tuple2<TupleTag<?>, WindowedValue<?>>> call(Iterator<WindowedValue<InputT>> iter)
       throws Exception {
     if (!wasSetupCalled && iter.hasNext()) {
-      DoFnInvokers.tryInvokeSetupFor(doFn);
+      DoFnInvokers.tryInvokeSetupFor(doFn, options.get());
       wasSetupCalled = true;
     }
 
diff --git a/runners/twister2/src/main/java/org/apache/beam/runners/twister2/translators/functions/DoFnFunction.java b/runners/twister2/src/main/java/org/apache/beam/runners/twister2/translators/functions/DoFnFunction.java
index 9488399a7f6..12577450a78 100644
--- a/runners/twister2/src/main/java/org/apache/beam/runners/twister2/translators/functions/DoFnFunction.java
+++ b/runners/twister2/src/main/java/org/apache/beam/runners/twister2/translators/functions/DoFnFunction.java
@@ -163,7 +163,7 @@ public class DoFnFunction<OutputT, InputT>
     initTransient();
     sideInputReader = new Twister2SideInputReader(sideInputs, context);
     outputManager.setup(mainOutput, sideOutputs);
-    doFnInvoker = DoFnInvokers.tryInvokeSetupFor(doFn);
+    doFnInvoker = DoFnInvokers.tryInvokeSetupFor(doFn, pipelineOptions);
 
     doFnRunner =
         DoFnRunners.simpleRunner(
diff --git a/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/DoFnTester.java b/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/DoFnTester.java
index a06d5c53a23..e1acb0dba0a 100644
--- a/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/DoFnTester.java
+++ b/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/DoFnTester.java
@@ -723,7 +723,19 @@ public class DoFnTester<InputT, OutputT> implements AutoCloseable {
                   SerializableUtils.serializeToByteArray(origFn), origFn.toString());
     }
     fnInvoker = DoFnInvokers.invokerFor(fn);
-    fnInvoker.invokeSetup();
+    fnInvoker.invokeSetup(new TestSetupArgumentProvider());
+  }
+
+  private class TestSetupArgumentProvider extends BaseArgumentProvider<InputT, OutputT> {
+    @Override
+    public PipelineOptions pipelineOptions() {
+      return options;
+    }
+
+    @Override
+    public String getErrorContext() {
+      return "DoFnTester/Setup";
+    }
   }
 
   private Map getOutputs() {
diff --git a/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/ByteBuddyDoFnInvokerFactory.java b/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/ByteBuddyDoFnInvokerFactory.java
index 6de6bc4f6fe..8c77254e539 100644
--- a/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/ByteBuddyDoFnInvokerFactory.java
+++ b/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/ByteBuddyDoFnInvokerFactory.java
@@ -115,6 +115,7 @@ import org.joda.time.Instant;
 })
 class ByteBuddyDoFnInvokerFactory implements DoFnInvokerFactory {
 
+  public static final String SETUP_CONTEXT_PARAMETER_METHOD = "setupContext";
   public static final String START_BUNDLE_CONTEXT_PARAMETER_METHOD = "startBundleContext";
   public static final String FINISH_BUNDLE_CONTEXT_PARAMETER_METHOD = "finishBundleContext";
   public static final String PROCESS_CONTEXT_PARAMETER_METHOD = "processContext";
@@ -468,7 +469,7 @@ class ByteBuddyDoFnInvokerFactory implements DoFnInvokerFactory {
             .intercept(
                 delegateMethodWithExtraParametersOrNoop(clazzDescription, signature.finishBundle()))
             .method(ElementMatchers.named("invokeSetup"))
-            .intercept(delegateOrNoop(clazzDescription, signature.setup()))
+            .intercept(delegateMethodWithExtraParametersOrNoop(clazzDescription, signature.setup()))
             .method(ElementMatchers.named("invokeTeardown"))
             .intercept(delegateOrNoop(clazzDescription, signature.teardown()))
             .method(ElementMatchers.named("invokeOnWindowExpiration"))
@@ -861,7 +862,6 @@ class ByteBuddyDoFnInvokerFactory implements DoFnInvokerFactory {
 
     return parameter.match(
         new Cases<StackManipulation>() {
-
           @Override
           public StackManipulation dispatch(StartBundleContextParameter p) {
             return new StackManipulation.Compound(
diff --git a/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/DoFnInvoker.java b/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/DoFnInvoker.java
index a877303a1b6..a1ab7762791 100644
--- a/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/DoFnInvoker.java
+++ b/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/DoFnInvoker.java
@@ -54,7 +54,7 @@ import org.joda.time.Instant;
 @Internal
 public interface DoFnInvoker<InputT, OutputT> {
   /** Invoke the {@link DoFn.Setup} method on the bound {@link DoFn}. */
-  void invokeSetup();
+  void invokeSetup(ArgumentProvider<InputT, OutputT> arguments);
 
   /** Invoke the {@link DoFn.StartBundle} method on the bound {@link DoFn}. */
   void invokeStartBundle(ArgumentProvider<InputT, OutputT> arguments);
diff --git a/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/DoFnInvokers.java b/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/DoFnInvokers.java
index 31fa13e0543..bd82db3a040 100644
--- a/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/DoFnInvokers.java
+++ b/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/DoFnInvokers.java
@@ -18,6 +18,7 @@
 package org.apache.beam.sdk.transforms.reflect;
 
 import org.apache.beam.sdk.annotations.Internal;
+import org.apache.beam.sdk.options.PipelineOptions;
 import org.apache.beam.sdk.transforms.DoFn;
 
 /** Static utilities for working with {@link DoFnInvoker}. */
@@ -46,10 +47,10 @@ public class DoFnInvokers {
    * <p>On success returns an {@link DoFnInvoker} for the given {@link DoFn}.
    */
   public static <InputT, OutputT> DoFnInvoker<InputT, OutputT> tryInvokeSetupFor(
-      DoFn<InputT, OutputT> fn) {
+      DoFn<InputT, OutputT> fn, PipelineOptions options) {
     DoFnInvoker<InputT, OutputT> doFnInvoker = invokerFor(fn);
     try {
-      doFnInvoker.invokeSetup();
+      doFnInvoker.invokeSetup(new DoFnSetupArgumentProvider<>(fn, options));
     } catch (Exception e) {
       try {
         doFnInvoker.invokeTeardown();
@@ -60,4 +61,26 @@ public class DoFnInvokers {
     }
     return doFnInvoker;
   }
+
+  /** An {@link DoFnInvoker.ArgumentProvider} for {@link DoFn.Setup @Setup}. */
+  private static class DoFnSetupArgumentProvider<InputT, OutputT>
+      extends DoFnInvoker.BaseArgumentProvider<InputT, OutputT> {
+    private final DoFn fn;
+    private final PipelineOptions options;
+
+    private DoFnSetupArgumentProvider(DoFn fn, PipelineOptions options) {
+      this.fn = fn;
+      this.options = options;
+    }
+
+    @Override
+    public PipelineOptions pipelineOptions() {
+      return options;
+    }
+
+    @Override
+    public String getErrorContext() {
+      return "SimpleDoFnRunner/Setup";
+    }
+  }
 }
diff --git a/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/DoFnSignature.java b/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/DoFnSignature.java
index 3846ab2d2e9..6b59fa223d9 100644
--- a/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/DoFnSignature.java
+++ b/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/DoFnSignature.java
@@ -1248,13 +1248,17 @@ public abstract class DoFnSignature {
 
   /** Describes a {@link DoFn.Setup} or {@link DoFn.Teardown} method. */
   @AutoValue
-  public abstract static class LifecycleMethod implements DoFnMethod {
+  public abstract static class LifecycleMethod implements MethodWithExtraParameters {
     /** The annotated method itself. */
     @Override
     public abstract Method targetMethod();
 
-    static LifecycleMethod create(Method targetMethod) {
-      return new AutoValue_DoFnSignature_LifecycleMethod(targetMethod);
+    /** Types of optional parameters of the annotated method, in the order they appear. */
+    @Override
+    public abstract List<Parameter> extraParameters();
+
+    static LifecycleMethod create(Method targetMethod, List<Parameter> extraParameters) {
+      return new AutoValue_DoFnSignature_LifecycleMethod(null, targetMethod, extraParameters);
     }
   }
 
diff --git a/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/DoFnSignatures.java b/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/DoFnSignatures.java
index e730e8ab844..73a76e5cf01 100644
--- a/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/DoFnSignatures.java
+++ b/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/DoFnSignatures.java
@@ -146,6 +146,9 @@ public class DoFnSignatures {
               Parameter.SideInputParameter.class,
               Parameter.BundleFinalizerParameter.class);
 
+  private static final ImmutableList<Class<? extends Parameter>> ALLOWED_SETUP_PARAMETERS =
+      ImmutableList.of(Parameter.PipelineOptionsParameter.class);
+
   private static final ImmutableList<Class<? extends Parameter>> ALLOWED_START_BUNDLE_PARAMETERS =
       ImmutableList.of(
           Parameter.PipelineOptionsParameter.class,
@@ -640,13 +643,14 @@ public class DoFnSignatures {
     }
 
     if (setupMethod != null) {
+      ErrorReporter setupErrors = errors.forMethod(DoFn.Setup.class, setupMethod);
       signatureBuilder.setSetup(
-          analyzeLifecycleMethod(errors.forMethod(DoFn.Setup.class, setupMethod), setupMethod));
+          analyzeSetupMethod(setupErrors, fnT, setupMethod, inputT, outputT, fnContext));
     }
 
     if (teardownMethod != null) {
       signatureBuilder.setTeardown(
-          analyzeLifecycleMethod(
+          analyzeShutdownMethod(
               errors.forMethod(DoFn.Teardown.class, teardownMethod), teardownMethod));
     }
 
@@ -1646,11 +1650,43 @@ public class DoFnSignatures {
     return DoFnSignature.BundleMethod.create(m, methodContext.extraParameters);
   }
 
-  private static DoFnSignature.LifecycleMethod analyzeLifecycleMethod(
+  @VisibleForTesting
+  static DoFnSignature.LifecycleMethod analyzeSetupMethod(
+      ErrorReporter errors,
+      TypeDescriptor<? extends DoFn<?, ?>> fnT,
+      Method m,
+      TypeDescriptor<?> inputT,
+      TypeDescriptor<?> outputT,
+      FnAnalysisContext fnContext) {
+    errors.checkArgument(void.class.equals(m.getReturnType()), "Must return void");
+    Type[] params = m.getGenericParameterTypes();
+    MethodAnalysisContext methodContext = MethodAnalysisContext.create();
+    for (int i = 0; i < params.length; ++i) {
+      Parameter extraParam =
+          analyzeExtraParameter(
+              errors,
+              fnContext,
+              methodContext,
+              fnT,
+              ParameterDescription.of(
+                  m, i, fnT.resolveType(params[i]), Arrays.asList(m.getParameterAnnotations()[i])),
+              inputT,
+              outputT);
+      methodContext.addParameter(extraParam);
+    }
+
+    for (Parameter parameter : methodContext.getExtraParameters()) {
+      checkParameterOneOf(errors, parameter, ALLOWED_SETUP_PARAMETERS);
+    }
+
+    return DoFnSignature.LifecycleMethod.create(m, methodContext.extraParameters);
+  }
+
+  private static DoFnSignature.LifecycleMethod analyzeShutdownMethod(
       ErrorReporter errors, Method m) {
     errors.checkArgument(void.class.equals(m.getReturnType()), "Must return void");
     errors.checkArgument(m.getGenericParameterTypes().length == 0, "Must take zero arguments");
-    return DoFnSignature.LifecycleMethod.create(m);
+    return DoFnSignature.LifecycleMethod.create(m, Collections.emptyList());
   }
 
   @VisibleForTesting
diff --git a/sdks/java/core/src/test/java/org/apache/beam/sdk/transforms/ParDoTest.java b/sdks/java/core/src/test/java/org/apache/beam/sdk/transforms/ParDoTest.java
index 0198c4bf42f..c363fc763c4 100644
--- a/sdks/java/core/src/test/java/org/apache/beam/sdk/transforms/ParDoTest.java
+++ b/sdks/java/core/src/test/java/org/apache/beam/sdk/transforms/ParDoTest.java
@@ -623,6 +623,35 @@ public class ParDoTest implements Serializable {
 
       pipeline.run();
     }
+
+    @Test
+    @Category(ValidatesRunner.class)
+    public void testSetupParameter() {
+      PCollection<String> results =
+          pipeline
+              .apply(Create.of(1))
+              .apply(
+                  ParDo.of(
+                      new DoFn<Integer, String>() {
+                        transient String myOptionValue;
+
+                        @Setup
+                        public void setup(PipelineOptions options) {
+                          myOptionValue = options.as(MyOptions.class).getFakeOption();
+                        }
+
+                        @ProcessElement
+                        public void process(OutputReceiver<String> r) {
+                          r.output(myOptionValue);
+                        }
+                      }));
+
+      String testOptionValue = "my value";
+      pipeline.getOptions().as(MyOptions.class).setFakeOption(testOptionValue);
+      PAssert.that(results).containsInAnyOrder("my value");
+
+      pipeline.run();
+    }
   }
 
   /** Tests to validate behaviors around multiple inputs or outputs. */
diff --git a/sdks/java/core/src/test/java/org/apache/beam/sdk/transforms/reflect/DoFnInvokersTest.java b/sdks/java/core/src/test/java/org/apache/beam/sdk/transforms/reflect/DoFnInvokersTest.java
index 99ba0185024..285cab5e178 100644
--- a/sdks/java/core/src/test/java/org/apache/beam/sdk/transforms/reflect/DoFnInvokersTest.java
+++ b/sdks/java/core/src/test/java/org/apache/beam/sdk/transforms/reflect/DoFnInvokersTest.java
@@ -48,6 +48,7 @@ import org.apache.beam.sdk.coders.CoderRegistry;
 import org.apache.beam.sdk.coders.InstantCoder;
 import org.apache.beam.sdk.coders.VarIntCoder;
 import org.apache.beam.sdk.coders.VoidCoder;
+import org.apache.beam.sdk.options.PipelineOptions;
 import org.apache.beam.sdk.state.StateSpec;
 import org.apache.beam.sdk.state.StateSpecs;
 import org.apache.beam.sdk.state.TimeDomain;
@@ -102,6 +103,7 @@ public class DoFnInvokersTest {
   @Mock private IntervalWindow mockWindow;
   // @Mock private PaneInfo mockPaneInfo;
   @Mock private DoFnInvoker.ArgumentProvider<String, String> mockArgumentProvider;
+  @Mock private PipelineOptions mockOptions;
 
   @Before
   public void setUp() {
@@ -116,6 +118,7 @@ public class DoFnInvokersTest {
     when(mockArgumentProvider.outputReceiver(Matchers.<DoFn>any())).thenReturn(mockOutputReceiver);
     when(mockArgumentProvider.taggedOutputReceiver(Matchers.<DoFn>any()))
         .thenReturn(mockMultiOutputReceiver);
+    when(mockArgumentProvider.pipelineOptions()).thenReturn(mockOptions);
     when(mockArgumentProvider.startBundleContext(Matchers.<DoFn>any()))
         .thenReturn(mockStartBundleContext);
     when(mockArgumentProvider.finishBundleContext(Matchers.<DoFn>any()))
@@ -357,6 +360,7 @@ public class DoFnInvokersTest {
 
   @Test
   public void testDoFnWithStartBundleSetupTeardown() throws Exception {
+    when(mockArgumentProvider.pipelineOptions()).thenReturn(mockOptions);
     when(mockArgumentProvider.startBundleContext(any(DoFn.class)))
         .thenReturn(mockStartBundleContext);
     when(mockArgumentProvider.finishBundleContext(any(DoFn.class)))
@@ -372,19 +376,20 @@ public class DoFnInvokersTest {
       public void finishBundle(FinishBundleContext c) {}
 
       @Setup
-      public void before() {}
+      public void before(PipelineOptions options) {}
 
       @Teardown
       public void after() {}
     }
 
     MockFn fn = mock(MockFn.class);
+
     DoFnInvoker<String, String> invoker = DoFnInvokers.invokerFor(fn);
-    invoker.invokeSetup();
+    invoker.invokeSetup(mockArgumentProvider);
     invoker.invokeStartBundle(mockArgumentProvider);
     invoker.invokeFinishBundle(mockArgumentProvider);
     invoker.invokeTeardown();
-    verify(fn).before();
+    verify(fn).before(mockOptions);
     verify(fn).startBundle(mockStartBundleContext);
     verify(fn).finishBundle(mockFinishBundleContext);
     verify(fn).after();
diff --git a/sdks/java/harness/src/main/java/org/apache/beam/fn/harness/FnApiDoFnRunner.java b/sdks/java/harness/src/main/java/org/apache/beam/fn/harness/FnApiDoFnRunner.java
index fb3259494c6..69b8f2fb3ef 100644
--- a/sdks/java/harness/src/main/java/org/apache/beam/fn/harness/FnApiDoFnRunner.java
+++ b/sdks/java/harness/src/main/java/org/apache/beam/fn/harness/FnApiDoFnRunner.java
@@ -469,8 +469,7 @@ public class FnApiDoFnRunner<InputT, RestrictionT, PositionT, WatermarkEstimator
             (Collection) localNameToConsumer.get(mainOutputTag.getId());
     this.doFnSchemaInformation = ParDoTranslation.getSchemaInformation(parDoPayload);
     this.sideInputMapping = ParDoTranslation.getSideInputMapping(parDoPayload);
-    this.doFnInvoker = DoFnInvokers.invokerFor(doFn);
-    this.doFnInvoker.invokeSetup();
+    this.doFnInvoker = DoFnInvokers.tryInvokeSetupFor(doFn, pipelineOptions);
 
     this.startBundleArgumentProvider = new StartBundleArgumentProvider();
     // Register the appropriate handlers.
