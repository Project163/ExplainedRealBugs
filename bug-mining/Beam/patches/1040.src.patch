diff --git a/runners/flink/1.6/build.gradle b/runners/flink/1.6/build.gradle
index 1fdbca9838c..1792389e7db 100644
--- a/runners/flink/1.6/build.gradle
+++ b/runners/flink/1.6/build.gradle
@@ -23,7 +23,7 @@ project.ext {
   // Set the version of all Flink-related dependencies here.
   flink_version = '1.6.2'
   // Look for the source code in the parent module
-  main_source_dirs = ["$basePath/src/main/java", './src/main/java']
+  main_source_dirs = ["$basePath/src/main/java"]
   test_source_dirs = ["$basePath/src/test/java"]
   main_resources_dirs = ["$basePath/src/main/resources"]
   test_resources_dirs = ["$basePath/src/test/resources"]
diff --git a/runners/flink/1.6/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/custom/AllKeyStateFunction.java b/runners/flink/1.6/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/custom/AllKeyStateFunction.java
deleted file mode 100644
index 870573911c3..00000000000
--- a/runners/flink/1.6/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/custom/AllKeyStateFunction.java
+++ /dev/null
@@ -1,42 +0,0 @@
-/*
- * Licensed to the Apache Software Foundation (ASF) under one
- * or more contributor license agreements.  See the NOTICE file
- * distributed with this work for additional information
- * regarding copyright ownership.  The ASF licenses this file
- * to you under the Apache License, Version 2.0 (the
- * "License"); you may not use this file except in compliance
- * with the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.apache.beam.runners.flink.translation.wrappers.streaming.state.custom;
-
-import org.apache.flink.api.common.state.ListState;
-import org.apache.flink.runtime.state.KeyedStateFunction;
-
-/** Flink 1.6 specific KeyedStateFunction which extracts all BagState values for all keys. */
-public class AllKeyStateFunction<K, StateT extends ListState>
-    implements KeyedStateFunction<K, StateT> {
-
-  private final StateConsumer<StateT> stateConsumer;
-
-  public AllKeyStateFunction(StateConsumer<StateT> stateConsumer) {
-    this.stateConsumer = stateConsumer;
-  }
-
-  @Override
-  public void process(K key, StateT state) throws Exception {
-    stateConsumer.consume(state);
-  }
-
-  /** A consumer of state which may throw an exception. */
-  public interface StateConsumer<StateT> {
-    void consume(StateT state) throws Exception;
-  }
-}
diff --git a/runners/flink/1.6/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/custom/package-info.java b/runners/flink/1.6/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/custom/package-info.java
deleted file mode 100644
index 326e66c06f4..00000000000
--- a/runners/flink/1.6/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/custom/package-info.java
+++ /dev/null
@@ -1,20 +0,0 @@
-/*
- * Licensed to the Apache Software Foundation (ASF) under one
- * or more contributor license agreements.  See the NOTICE file
- * distributed with this work for additional information
- * regarding copyright ownership.  The ASF licenses this file
- * to you under the Apache License, Version 2.0 (the
- * "License"); you may not use this file except in compliance
- * with the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-/** Flink version-specific state implementations. */
-package org.apache.beam.runners.flink.translation.wrappers.streaming.state.custom;
diff --git a/runners/flink/1.7/build.gradle b/runners/flink/1.7/build.gradle
index c7680626962..5982c1b2f84 100644
--- a/runners/flink/1.7/build.gradle
+++ b/runners/flink/1.7/build.gradle
@@ -23,7 +23,7 @@ project.ext {
   // Set the version of all Flink-related dependencies here.
   flink_version = '1.7.1'
   // Look for the source code in the parent module
-  main_source_dirs = ["$basePath/src/main/java", './src/main/java']
+  main_source_dirs = ["$basePath/src/main/java"]
   test_source_dirs = ["$basePath/src/test/java"]
   main_resources_dirs = ["$basePath/src/main/resources"]
   test_resources_dirs = ["$basePath/src/test/resources"]
diff --git a/runners/flink/1.7/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/custom/AllKeyStateFunction.java b/runners/flink/1.7/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/custom/AllKeyStateFunction.java
deleted file mode 100644
index d3c7dd93d74..00000000000
--- a/runners/flink/1.7/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/custom/AllKeyStateFunction.java
+++ /dev/null
@@ -1,42 +0,0 @@
-/*
- * Licensed to the Apache Software Foundation (ASF) under one
- * or more contributor license agreements.  See the NOTICE file
- * distributed with this work for additional information
- * regarding copyright ownership.  The ASF licenses this file
- * to you under the Apache License, Version 2.0 (the
- * "License"); you may not use this file except in compliance
- * with the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.apache.beam.runners.flink.translation.wrappers.streaming.state.custom;
-
-import org.apache.flink.api.common.state.ListState;
-import org.apache.flink.runtime.state.KeyedStateFunction;
-
-/** Flink 1.7 specific KeyedStateFunction. */
-public class AllKeyStateFunction<K, StateT extends ListState>
-    implements KeyedStateFunction<K, StateT> {
-
-  private final StateConsumer<StateT> stateConsumer;
-
-  public AllKeyStateFunction(StateConsumer<StateT> stateConsumer) {
-    this.stateConsumer = stateConsumer;
-  }
-
-  @Override
-  public void process(K key, StateT state) throws Exception {
-    stateConsumer.consume(state);
-  }
-
-  /** A consumer of state which may throw an exception. */
-  public interface StateConsumer<StateT> {
-    void consume(StateT state) throws Exception;
-  }
-}
diff --git a/runners/flink/1.7/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/custom/package-info.java b/runners/flink/1.7/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/custom/package-info.java
deleted file mode 100644
index ea7757a2700..00000000000
--- a/runners/flink/1.7/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/custom/package-info.java
+++ /dev/null
@@ -1,21 +0,0 @@
-/*
- * Licensed to the Apache Software Foundation (ASF) under one
- * or more contributor license agreements.  See the NOTICE file
- * distributed with this work for additional information
- * regarding copyright ownership.  The ASF licenses this file
- * to you under the Apache License, Version 2.0 (the
- * "License"); you may not use this file except in compliance
- * with the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-/** Internal state implementation of the Beam runner for Apache Flink. */
-/** Flink version-specific state implementations. */
-package org.apache.beam.runners.flink.translation.wrappers.streaming.state.custom;
diff --git a/runners/flink/build.gradle b/runners/flink/build.gradle
index d290d201c04..39addc39840 100644
--- a/runners/flink/build.gradle
+++ b/runners/flink/build.gradle
@@ -21,7 +21,7 @@ project.ext {
   // Set the version of all Flink-related dependencies here.
   flink_version = '1.5.6'
   // Look for the source code in the current module
-  main_source_dirs = ['./src/main/java', './src/1.5/main/java']
+  main_source_dirs = ['./src/main/java']
   test_source_dirs = ['./src/test/java']
   main_resources_dirs = ['./src/main/resources']
   test_resources_dirs = ['./src/test/resources']
diff --git a/runners/flink/src/1.5/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/custom/AllKeyStateFunction.java b/runners/flink/src/1.5/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/custom/AllKeyStateFunction.java
deleted file mode 100644
index 8d58580b633..00000000000
--- a/runners/flink/src/1.5/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/custom/AllKeyStateFunction.java
+++ /dev/null
@@ -1,42 +0,0 @@
-/*
- * Licensed to the Apache Software Foundation (ASF) under one
- * or more contributor license agreements.  See the NOTICE file
- * distributed with this work for additional information
- * regarding copyright ownership.  The ASF licenses this file
- * to you under the Apache License, Version 2.0 (the
- * "License"); you may not use this file except in compliance
- * with the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.apache.beam.runners.flink.translation.wrappers.streaming.state.custom;
-
-import org.apache.flink.api.common.state.ListState;
-import org.apache.flink.runtime.state.KeyedStateFunction;
-
-/** Flink 1.5 specific KeyedStateFunction. */
-public class AllKeyStateFunction<K, StateT extends ListState>
-    extends KeyedStateFunction<K, StateT> {
-
-  private final StateConsumer<StateT> stateConsumer;
-
-  public AllKeyStateFunction(StateConsumer<StateT> stateConsumer) {
-    this.stateConsumer = stateConsumer;
-  }
-
-  @Override
-  public void process(K key, StateT state) throws Exception {
-    stateConsumer.consume(state);
-  }
-
-  /** A consumer of state which may throw an exception. */
-  public interface StateConsumer<StateT> {
-    void consume(StateT state) throws Exception;
-  }
-}
diff --git a/runners/flink/src/1.5/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/custom/package-info.java b/runners/flink/src/1.5/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/custom/package-info.java
deleted file mode 100644
index ea7757a2700..00000000000
--- a/runners/flink/src/1.5/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/custom/package-info.java
+++ /dev/null
@@ -1,21 +0,0 @@
-/*
- * Licensed to the Apache Software Foundation (ASF) under one
- * or more contributor license agreements.  See the NOTICE file
- * distributed with this work for additional information
- * regarding copyright ownership.  The ASF licenses this file
- * to you under the Apache License, Version 2.0 (the
- * "License"); you may not use this file except in compliance
- * with the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-/** Internal state implementation of the Beam runner for Apache Flink. */
-/** Flink version-specific state implementations. */
-package org.apache.beam.runners.flink.translation.wrappers.streaming.state.custom;
diff --git a/runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/DoFnOperator.java b/runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/DoFnOperator.java
index 9e5d06cdf97..670d69ac511 100644
--- a/runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/DoFnOperator.java
+++ b/runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/DoFnOperator.java
@@ -59,7 +59,6 @@ import org.apache.beam.runners.flink.metrics.DoFnRunnerWithMetricsUpdate;
 import org.apache.beam.runners.flink.translation.types.CoderTypeSerializer;
 import org.apache.beam.runners.flink.translation.utils.FlinkClassloading;
 import org.apache.beam.runners.flink.translation.wrappers.streaming.state.FlinkBroadcastStateInternals;
-import org.apache.beam.runners.flink.translation.wrappers.streaming.state.FlinkKeyGroupStateInternals;
 import org.apache.beam.runners.flink.translation.wrappers.streaming.state.FlinkSplitStateInternals;
 import org.apache.beam.runners.flink.translation.wrappers.streaming.state.FlinkStateInternals;
 import org.apache.beam.sdk.coders.Coder;
@@ -315,14 +314,9 @@ public class DoFnOperator<InputT, OutputT> extends AbstractStreamOperator<Window
       setPushedBackWatermark(Long.MAX_VALUE);
     }
 
-    final StateInternals outputManagerStateInternals;
-    if (keyCoder != null) {
-      outputManagerStateInternals =
-          new FlinkKeyGroupStateInternals<>(keyCoder, getKeyedStateBackend());
-    } else {
-      outputManagerStateInternals = new FlinkSplitStateInternals<>(getOperatorStateBackend());
-    }
-    outputManager = outputManagerFactory.create(output, outputManagerStateInternals);
+    outputManager =
+        outputManagerFactory.create(
+            output, new FlinkSplitStateInternals<>(getOperatorStateBackend()));
 
     // StatefulPardo or WindowDoFn
     if (keyCoder != null) {
@@ -684,18 +678,13 @@ public class DoFnOperator<InputT, OutputT> extends AbstractStreamOperator<Window
 
   @Override
   public void snapshotState(StateSnapshotContext context) throws Exception {
+
     // Forced finish a bundle in checkpoint barrier otherwise may lose data.
     // Careful, it use OperatorState or KeyGroupState to store outputs, So it
     // must be called before their snapshot.
-    // If keyed state is used, must only be done if a key has already been set
-    // by a previous element. If there are no previous elements the active key
-    // is null and we can't buffer elements in finalizeBundle.
-    // TODO Move this to prepareSnapshotPreBarrier when we drop Flink 1.5 support
-    if (getKeyedStateBackend() == null || getKeyedStateBackend().getCurrentKey() != null) {
-      outputManager.openBuffer();
-      invokeFinishBundle();
-      outputManager.closeBuffer();
-    }
+    outputManager.openBuffer();
+    invokeFinishBundle();
+    outputManager.closeBuffer();
 
     super.snapshotState(context);
   }
@@ -744,8 +733,8 @@ public class DoFnOperator<InputT, OutputT> extends AbstractStreamOperator<Window
   }
 
   /**
-   * A {@link DoFnRunners.OutputManager} that can buffer its outputs. Use {@link
-   * FlinkSplitStateInternals} or {@link FlinkKeyGroupStateInternals} to keep buffer data.
+   * A {@link DoFnRunners.OutputManager} that can buffer its outputs. Uses {@link
+   * FlinkSplitStateInternals} to buffer the data.
    */
   public static class BufferedOutputManager<OutputT> implements DoFnRunners.OutputManager {
 
diff --git a/runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/FlinkKeyGroupStateInternals.java b/runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/FlinkKeyGroupStateInternals.java
deleted file mode 100644
index f73d4e336a7..00000000000
--- a/runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/FlinkKeyGroupStateInternals.java
+++ /dev/null
@@ -1,252 +0,0 @@
-/*
- * Licensed to the Apache Software Foundation (ASF) under one
- * or more contributor license agreements.  See the NOTICE file
- * distributed with this work for additional information
- * regarding copyright ownership.  The ASF licenses this file
- * to you under the Apache License, Version 2.0 (the
- * "License"); you may not use this file except in compliance
- * with the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.apache.beam.runners.flink.translation.wrappers.streaming.state;
-
-import java.nio.ByteBuffer;
-import java.util.ArrayDeque;
-import java.util.Deque;
-import java.util.Iterator;
-import javax.annotation.Nonnull;
-import org.apache.beam.runners.core.StateInternals;
-import org.apache.beam.runners.core.StateNamespace;
-import org.apache.beam.runners.core.StateTag;
-import org.apache.beam.runners.flink.translation.types.CoderTypeSerializer;
-import org.apache.beam.runners.flink.translation.wrappers.streaming.state.custom.AllKeyStateFunction;
-import org.apache.beam.runners.flink.translation.wrappers.streaming.state.custom.AllKeyStateFunction.StateConsumer;
-import org.apache.beam.sdk.coders.Coder;
-import org.apache.beam.sdk.coders.CoderException;
-import org.apache.beam.sdk.state.BagState;
-import org.apache.beam.sdk.state.CombiningState;
-import org.apache.beam.sdk.state.MapState;
-import org.apache.beam.sdk.state.ReadableState;
-import org.apache.beam.sdk.state.SetState;
-import org.apache.beam.sdk.state.State;
-import org.apache.beam.sdk.state.StateBinder;
-import org.apache.beam.sdk.state.StateContext;
-import org.apache.beam.sdk.state.StateSpec;
-import org.apache.beam.sdk.state.ValueState;
-import org.apache.beam.sdk.state.WatermarkHoldState;
-import org.apache.beam.sdk.transforms.Combine;
-import org.apache.beam.sdk.transforms.CombineWithContext;
-import org.apache.beam.sdk.transforms.windowing.TimestampCombiner;
-import org.apache.beam.sdk.util.CoderUtils;
-import org.apache.flink.api.common.state.ListState;
-import org.apache.flink.api.common.state.ListStateDescriptor;
-import org.apache.flink.api.common.typeutils.base.StringSerializer;
-import org.apache.flink.runtime.state.KeyedStateBackend;
-import org.apache.flink.util.Preconditions;
-
-/**
- * {@link StateInternals} which uses Flink's KeyedStateBackend to store BagState which retrieves and
- * clears state for _all_ of its keys when using the read method.
- */
-public class FlinkKeyGroupStateInternals<K> implements StateInternals {
-
-  private final Coder<K> keyCoder;
-  private KeyedStateBackend keyedStateBackend;
-
-  public FlinkKeyGroupStateInternals(Coder<K> keyCoder, KeyedStateBackend keyedStateBackend) {
-    this.keyCoder = Preconditions.checkNotNull(keyCoder, "Coder for key must be provided.");
-    this.keyedStateBackend =
-        Preconditions.checkNotNull(
-            keyedStateBackend, "KeyedStateBackend must not be null. Missing keyBy call?");
-  }
-
-  @Override
-  public K getKey() {
-    ByteBuffer keyBytes = (ByteBuffer) keyedStateBackend.getCurrentKey();
-    try {
-      byte[] bytes = new byte[keyBytes.remaining()];
-      keyBytes.get(bytes);
-      keyBytes.position(keyBytes.position() - bytes.length);
-      return CoderUtils.decodeFromByteArray(keyCoder, bytes);
-    } catch (CoderException e) {
-      throw new RuntimeException("Error decoding key.", e);
-    }
-  }
-
-  @Override
-  public <T extends State> T state(
-      final StateNamespace namespace, StateTag<T> address, final StateContext<?> context) {
-    return address
-        .getSpec()
-        .bind(
-            address.getId(),
-            new StateBinder() {
-              @Override
-              public <T2> ValueState<T2> bindValue(
-                  String id, StateSpec<ValueState<T2>> spec, Coder<T2> coder) {
-                throw new UnsupportedOperationException(
-                    String.format("%s is not supported", ValueState.class.getSimpleName()));
-              }
-
-              @Override
-              public <T2> BagState<T2> bindBag(
-                  String id, StateSpec<BagState<T2>> spec, Coder<T2> elemCoder) {
-                // Only implement bag state
-                return new FlinkKeyGroupBagState<>(keyedStateBackend, id, namespace, elemCoder);
-              }
-
-              @Override
-              public <T2> SetState<T2> bindSet(
-                  String id, StateSpec<SetState<T2>> spec, Coder<T2> elemCoder) {
-                throw new UnsupportedOperationException(
-                    String.format("%s is not supported", SetState.class.getSimpleName()));
-              }
-
-              @Override
-              public <KeyT, ValueT> MapState<KeyT, ValueT> bindMap(
-                  String id,
-                  StateSpec<MapState<KeyT, ValueT>> spec,
-                  Coder<KeyT> mapKeyCoder,
-                  Coder<ValueT> mapValueCoder) {
-                throw new UnsupportedOperationException(
-                    String.format("%s is not supported", MapState.class.getSimpleName()));
-              }
-
-              @Override
-              public <InputT, AccumT, OutputT>
-                  CombiningState<InputT, AccumT, OutputT> bindCombining(
-                      String id,
-                      StateSpec<CombiningState<InputT, AccumT, OutputT>> spec,
-                      Coder<AccumT> accumCoder,
-                      Combine.CombineFn<InputT, AccumT, OutputT> combineFn) {
-                throw new UnsupportedOperationException("bindCombiningValue is not supported.");
-              }
-
-              @Override
-              public <InputT, AccumT, OutputT>
-                  CombiningState<InputT, AccumT, OutputT> bindCombiningWithContext(
-                      String id,
-                      StateSpec<CombiningState<InputT, AccumT, OutputT>> spec,
-                      Coder<AccumT> accumCoder,
-                      CombineWithContext.CombineFnWithContext<InputT, AccumT, OutputT> combineFn) {
-                throw new UnsupportedOperationException(
-                    "bindCombiningValueWithContext is not supported.");
-              }
-
-              @Override
-              public WatermarkHoldState bindWatermark(
-                  String id,
-                  StateSpec<WatermarkHoldState> spec,
-                  TimestampCombiner timestampCombiner) {
-                throw new UnsupportedOperationException(
-                    String.format("%s is not supported", CombiningState.class.getSimpleName()));
-              }
-            });
-  }
-
-  private static class FlinkKeyGroupBagState<K, T> implements BagState<T> {
-
-    private final StateNamespace namespace;
-    private final CoderTypeSerializer namespaceSerializer;
-    private final ListStateDescriptor<T> flinkStateDescriptor;
-    private final KeyedStateBackend<ByteBuffer> flinkStateBackend;
-
-    FlinkKeyGroupBagState(
-        KeyedStateBackend<ByteBuffer> flinkStateBackend,
-        String stateId,
-        StateNamespace namespace,
-        Coder<T> coder) {
-
-      this.namespace = namespace;
-      this.flinkStateBackend = flinkStateBackend;
-      this.namespaceSerializer = new CoderTypeSerializer<>(coder);
-      this.flinkStateDescriptor = new ListStateDescriptor<>(stateId, namespaceSerializer);
-    }
-
-    @Override
-    public void add(T input) {
-      try {
-        ListState<T> partitionedState =
-            flinkStateBackend.getPartitionedState(
-                namespace.stringKey(), StringSerializer.INSTANCE, flinkStateDescriptor);
-        partitionedState.add(input);
-      } catch (Exception e) {
-        throw new RuntimeException("Error adding to bag state.", e);
-      }
-    }
-
-    @Override
-    public BagState<T> readLater() {
-      return this;
-    }
-
-    /** Reads the state of _all_ keys and combines it. */
-    @Override
-    @Nonnull
-    public Iterable<T> read() {
-      final Deque<T> state = new ArrayDeque<>();
-      // Load specific implementation for Flink 1.5/1.6/1.7
-      final AllKeyStateFunction allKeyStateFunction =
-          new AllKeyStateFunction(
-              (StateConsumer<ListState>)
-                  listState -> {
-                    for (T item : (Iterable<T>) listState.get()) {
-                      state.add(item);
-                    }
-                  });
-      try {
-        flinkStateBackend.applyToAllKeys(
-            namespace.stringKey(),
-            StringSerializer.INSTANCE,
-            flinkStateDescriptor,
-            allKeyStateFunction);
-      } catch (Exception e) {
-        throw new RuntimeException(
-            String.format(
-                "Failed to iterate over all key state for giving namespace %s", namespace));
-      }
-      return () ->
-          new Iterator<T>() {
-            @Override
-            public boolean hasNext() {
-              return state.size() > 0;
-            }
-
-            @Override
-            public T next() {
-              return state.pop();
-            }
-          };
-    }
-
-    @Override
-    public ReadableState<Boolean> isEmpty() {
-      throw new UnsupportedOperationException("isEmpty is not implemented and should not be used.");
-    }
-
-    @Override
-    public void clear() {
-      // Load specific implementation for Flink 1.5/1.6/1.7
-      final AllKeyStateFunction allKeyStateFunction =
-          new AllKeyStateFunction((StateConsumer<ListState>) listState -> listState.clear());
-      try {
-        flinkStateBackend.applyToAllKeys(
-            namespace.stringKey(),
-            StringSerializer.INSTANCE,
-            flinkStateDescriptor,
-            allKeyStateFunction);
-      } catch (Exception e) {
-        throw new RuntimeException(
-            String.format(
-                "Failed to iterate over all key state for giving namespace %s", namespace));
-      }
-    }
-  }
-}
diff --git a/runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/FlinkSplitStateInternals.java b/runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/FlinkSplitStateInternals.java
index 72da34df498..07088276fef 100644
--- a/runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/FlinkSplitStateInternals.java
+++ b/runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/state/FlinkSplitStateInternals.java
@@ -61,7 +61,7 @@ public class FlinkSplitStateInternals<K> implements StateInternals {
   @Override
   @Nullable
   public K getKey() {
-    return null;
+    throw new UnsupportedOperationException("This should not be called");
   }
 
   @Override
@@ -169,7 +169,7 @@ public class FlinkSplitStateInternals<K> implements StateInternals {
         Iterable<T> result = flinkStateBackend.getListState(descriptor).get();
         return result != null ? result : Collections.emptyList();
       } catch (Exception e) {
-        throw new RuntimeException("Error reading state.", e);
+        throw new RuntimeException("Error updating state.", e);
       }
     }
 
@@ -200,7 +200,7 @@ public class FlinkSplitStateInternals<K> implements StateInternals {
       try {
         flinkStateBackend.getListState(descriptor).clear();
       } catch (Exception e) {
-        throw new RuntimeException("Error clearing state.", e);
+        throw new RuntimeException("Error reading state.", e);
       }
     }
 
diff --git a/runners/flink/src/test/java/org/apache/beam/runners/flink/streaming/FlinkKeyGroupStateInternalsTest.java b/runners/flink/src/test/java/org/apache/beam/runners/flink/streaming/FlinkKeyGroupStateInternalsTest.java
deleted file mode 100644
index d646f98ef20..00000000000
--- a/runners/flink/src/test/java/org/apache/beam/runners/flink/streaming/FlinkKeyGroupStateInternalsTest.java
+++ /dev/null
@@ -1,133 +0,0 @@
-/*
- * Licensed to the Apache Software Foundation (ASF) under one
- * or more contributor license agreements.  See the NOTICE file
- * distributed with this work for additional information
- * regarding copyright ownership.  The ASF licenses this file
- * to you under the Apache License, Version 2.0 (the
- * "License"); you may not use this file except in compliance
- * with the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.apache.beam.runners.flink.streaming;
-
-import static org.hamcrest.MatcherAssert.assertThat;
-import static org.hamcrest.Matchers.containsInAnyOrder;
-
-import java.nio.ByteBuffer;
-import java.util.UUID;
-import org.apache.beam.runners.core.StateInternals;
-import org.apache.beam.runners.core.StateNamespace;
-import org.apache.beam.runners.core.StateNamespaceForTest;
-import org.apache.beam.runners.core.StateTag;
-import org.apache.beam.runners.core.StateTags;
-import org.apache.beam.runners.flink.translation.wrappers.streaming.state.FlinkKeyGroupStateInternals;
-import org.apache.beam.sdk.coders.CoderException;
-import org.apache.beam.sdk.coders.StringUtf8Coder;
-import org.apache.beam.sdk.state.BagState;
-import org.apache.beam.sdk.util.CoderUtils;
-import org.apache.flink.api.common.ExecutionConfig;
-import org.apache.flink.api.common.JobID;
-import org.apache.flink.api.java.typeutils.GenericTypeInfo;
-import org.apache.flink.runtime.jobgraph.JobVertexID;
-import org.apache.flink.runtime.operators.testutils.DummyEnvironment;
-import org.apache.flink.runtime.query.KvStateRegistry;
-import org.apache.flink.runtime.state.AbstractKeyedStateBackend;
-import org.apache.flink.runtime.state.KeyGroupRange;
-import org.apache.flink.runtime.state.KeyedStateBackend;
-import org.apache.flink.runtime.state.memory.MemoryStateBackend;
-import org.hamcrest.Matchers;
-import org.junit.Before;
-import org.junit.Test;
-
-/** Tests for {@link FlinkKeyGroupStateInternals}. */
-public class FlinkKeyGroupStateInternalsTest {
-
-  private static final StateNamespace NAMESPACE_1 = new StateNamespaceForTest("ns1");
-  private static final StateNamespace NAMESPACE_2 = new StateNamespaceForTest("ns2");
-
-  private static final StateTag<BagState<String>> STRING_BAG_ADDR =
-      StateTags.bag("stringBag", StringUtf8Coder.of());
-
-  private AbstractKeyedStateBackend<ByteBuffer> keyedStateBackend;
-  private StateInternals stateInternals;
-
-  @Before
-  public void createStateInternals() {
-    initStateBackend(2, new KeyGroupRange(0, 1));
-    stateInternals = new FlinkKeyGroupStateInternals<>(StringUtf8Coder.of(), keyedStateBackend);
-  }
-
-  @Test
-  public void testBag() throws Exception {
-    BagState<String> bagState1 = stateInternals.state(NAMESPACE_1, STRING_BAG_ADDR);
-    BagState<String> bagState2 = stateInternals.state(NAMESPACE_2, STRING_BAG_ADDR);
-
-    assertThat(bagState1.read(), Matchers.emptyIterable());
-    assertThat(bagState2.read(), Matchers.emptyIterable());
-
-    bagState1.add("hello");
-    bagState1.add("world");
-    bagState2.add("hallo");
-    bagState2.add("welt");
-
-    assertThat(bagState1.read(), containsInAnyOrder("hello", "world"));
-    assertThat(bagState2.read(), containsInAnyOrder("hallo", "welt"));
-
-    changeStateBackendKey();
-    bagState1.add("hey");
-    bagState1.add("joe");
-    bagState2.add("hey");
-    bagState2.add("jane");
-
-    assertThat(bagState1.read(), containsInAnyOrder("hello", "world", "hey", "joe"));
-    assertThat(bagState2.read(), containsInAnyOrder("hallo", "welt", "hey", "jane"));
-
-    bagState1.clear();
-    bagState2.clear();
-    assertThat(bagState1.read(), Matchers.emptyIterable());
-    assertThat(bagState2.read(), Matchers.emptyIterable());
-  }
-
-  @Test
-  public void testBagIsEmpty() throws Exception {
-    BagState<String> value = stateInternals.state(NAMESPACE_1, STRING_BAG_ADDR);
-    try {
-      value.isEmpty();
-    } catch (UnsupportedOperationException e) {
-      // this is what we want
-    }
-  }
-
-  private void changeStateBackendKey() throws CoderException {
-    keyedStateBackend.setCurrentKey(
-        ByteBuffer.wrap(
-            CoderUtils.encodeToByteArray(StringUtf8Coder.of(), UUID.randomUUID().toString())));
-  }
-
-  private KeyedStateBackend<ByteBuffer> initStateBackend(
-      int numberOfKeyGroups, KeyGroupRange keyGroupRange) {
-    MemoryStateBackend backend = new MemoryStateBackend();
-    try {
-      keyedStateBackend =
-          backend.createKeyedStateBackend(
-              new DummyEnvironment("test", 1, 0),
-              new JobID(),
-              "test_op",
-              new GenericTypeInfo<>(ByteBuffer.class).createSerializer(new ExecutionConfig()),
-              numberOfKeyGroups,
-              keyGroupRange,
-              new KvStateRegistry().createTaskRegistry(new JobID(), new JobVertexID()));
-      changeStateBackendKey();
-      return keyedStateBackend;
-    } catch (Exception e) {
-      throw new RuntimeException(e);
-    }
-  }
-}
