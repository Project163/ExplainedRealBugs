<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:15:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-11815] Fail to read more than 1M of items with DynamoDBIO</title>
                <link>https://issues.apache.org/jira/browse/BEAM-11815</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;In processElement:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ReadFn&amp;lt;T&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; DoFn&amp;lt;Read&amp;lt;T&amp;gt;, T&amp;gt; {
  @ProcessElement
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void processElement(@Element Read&amp;lt;T&amp;gt; spec, OutputReceiver&amp;lt;T&amp;gt; out) {
    AmazonDynamoDB client = spec.getAwsClientsProvider().createDynamoDB();
    ScanRequest scanRequest = spec.getScanRequestFn().apply(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
    scanRequest.setSegment(spec.getSegmentId());
    ScanResult scanResult = client.scan(scanRequest);
    out.output(spec.getScanResultMapperFn().apply(scanResult));
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
&#160;&lt;/p&gt;

&lt;p&gt;if total requested items &amp;gt; 1M dynamodb will only send upto 1M of data&#160; and expects client to read remaining items through LastEvaluatedKey (see &lt;a href=&quot;https://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/dynamodbv2/model/ScanRequest.html#setLimit-java.lang.Integer-&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13358734">BEAM-11815</key>
            <summary>Fail to read more than 1M of items with DynamoDBIO</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10101" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">P1</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aromanenko">Alexey Romanenko</assignee>
                                    <reporter username="Safari">Mohammad</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Feb 2021 00:25:54 +0000</created>
                <updated>Tue, 30 Mar 2021 23:48:34 +0000</updated>
                            <resolved>Thu, 25 Mar 2021 14:17:03 +0000</resolved>
                                                    <fixVersion>2.29.0</fixVersion>
                                    <component>io-java-aws</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="17301874" author="kenn" created="Mon, 15 Mar 2021 18:42:04 +0000"  >&lt;p&gt;Are you saying that DynamoDBIO is corrupting data? Pinging &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dennisyung&quot; class=&quot;user-hover&quot; rel=&quot;dennisyung&quot;&gt;dennisyung&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iemejia&quot; class=&quot;user-hover&quot; rel=&quot;iemejia&quot;&gt;iemejia&lt;/a&gt; who may have some expertise in the connector.&lt;/p&gt;</comment>
                            <comment id="17301879" author="safari" created="Mon, 15 Mar 2021 18:46:46 +0000"  >&lt;p&gt;no. it just doesn&apos;t read all the data.&lt;/p&gt;</comment>
                            <comment id="17302017" author="kenn" created="Mon, 15 Mar 2021 21:35:01 +0000"  >&lt;p&gt;Well, if the result is wrong and written to output, then this is a data correctness issue for sure.&lt;/p&gt;</comment>
                            <comment id="17302018" author="kenn" created="Mon, 15 Mar 2021 21:35:30 +0000"  >&lt;p&gt;If it is not a regression then we may not block the 2.29.0 release on it.&lt;/p&gt;</comment>
                            <comment id="17302334" author="iemejia" created="Tue, 16 Mar 2021 08:49:17 +0000"  >&lt;p&gt;We need to dig deeper into why this is not working (if it is the case), but since the code has not been changed in months I think this should not be a release blocker.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Safari&quot; class=&quot;user-hover&quot; rel=&quot;Safari&quot;&gt;Safari&lt;/a&gt; were you using the AWSv1 or AWSv2 connector?&lt;/p&gt;

&lt;p&gt;CC &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aromanenko&quot; class=&quot;user-hover&quot; rel=&quot;aromanenko&quot;&gt;aromanenko&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17303639" author="aromanenko" created="Wed, 17 Mar 2021 18:22:30 +0000"  >&lt;p&gt;Good catch, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Safari&quot; class=&quot;user-hover&quot; rel=&quot;Safari&quot;&gt;Safari&lt;/a&gt;!&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;If DynamoDB processes the number of items up to the limit while processing the results, it stops the operation and returns the matching values up to that point, and a key in LastEvaluatedKey to apply in a subsequent operation, so that you can pick up where you left off. Also, if the processed dataset size exceeds 1 MB before DynamoDB reaches this limit, it stops the operation and returns the matching values up to the limit, and a key in LastEvaluatedKey to apply in a subsequent operation to continue the operation.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So, the fix looks pretty simple on the first sight - we need to check the value of returned &lt;tt&gt;LastEvaluatedKey&lt;/tt&gt; in the loop until everything was read. Though, I&apos;m wondering if we need (and we can) to split it in advance to read in parallel despite the the Read is already split by &lt;tt&gt;SegmentId&lt;/tt&gt; .&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iemejia&quot; class=&quot;user-hover&quot; rel=&quot;iemejia&quot;&gt;iemejia&lt;/a&gt; I think we have a similar code for both versions of SDK and the fix will be similar too.&lt;/p&gt;</comment>
                            <comment id="17308767" author="aromanenko" created="Thu, 25 Mar 2021 15:39:35 +0000"  >&lt;p&gt;FYI: Fix was merged (for AWS v1 and v2 connectors) and it will be available in the next shapshot build (tomorrow). Thanks&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iemejia&quot; class=&quot;user-hover&quot; rel=&quot;iemejia&quot;&gt;iemejia&lt;/a&gt;&#160;for quick review!&#160;&lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 33 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0np3k:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>