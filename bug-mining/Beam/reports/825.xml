<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:53:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-308] PipelineOptions throws when using package-private PipelineOptions interfaces from multiple packages</title>
                <link>https://issues.apache.org/jira/browse/BEAM-308</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;If a PipelineOptions instance is used as multiple PipelineOptions package-private interfaces from different packages, &lt;tt&gt;PipelineOptions.as&lt;/tt&gt; will throw an exception:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;java.lang.IllegalArgumentException: non-public interfaces from different packages&lt;/p&gt;

&lt;p&gt;	at java.lang.reflect.Proxy$ProxyClassFactory.apply(Proxy.java:652)&lt;br/&gt;
	at java.lang.reflect.Proxy$ProxyClassFactory.apply(Proxy.java:592)&lt;br/&gt;
	at java.lang.reflect.WeakCache$Factory.get(WeakCache.java:244)&lt;br/&gt;
	at java.lang.reflect.WeakCache.get(WeakCache.java:141)&lt;br/&gt;
	at java.lang.reflect.Proxy.getProxyClass0(Proxy.java:455)&lt;br/&gt;
	at java.lang.reflect.Proxy.getProxyClass(Proxy.java:405)&lt;br/&gt;
	at org.apache.beam.sdk.options.PipelineOptionsFactory.validateWellFormed(PipelineOptionsFactory.java:620)&lt;br/&gt;
	at org.apache.beam.sdk.options.ProxyInvocationHandler.as(ProxyInvocationHandler.java:209)&lt;br/&gt;
	at org.apache.beam.sdk.options.ProxyInvocationHandler.invoke(ProxyInvocationHandler.java:135)&lt;br/&gt;
	at com.sun.proxy.$Proxy6.as(Unknown Source)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This fails because ProxyInvocationHandler attempts to create a Java Proxy object implementing the full set of interfaces, which has the &lt;a href=&quot;https://docs.oracle.com/javase/7/docs/api/java/lang/reflect/Proxy.html#getProxyClass(java.lang.ClassLoader,%20java.lang.Class...)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;restriction&lt;/a&gt;: &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;All non-public interfaces must be in the same package; otherwise, it would not be possible for the proxy class to implement all of the interfaces, regardless of what package it is defined in.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This can be triggered in a couple edge-case scenarios:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;&lt;tt&gt;PipelineOptions.as&lt;/tt&gt; is called on the same PipelineOptions instance with multiple package-private interfaces.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;PipelineOptionsFactory.register&lt;/tt&gt; is called with a package-private interface, and then &lt;tt&gt;PipelineOptions.as&lt;/tt&gt; is called with a different package-private instance.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;We hit the second scenario in &lt;a href=&quot;https://github.com/GoogleCloudPlatform/DataflowJavaSDK/pull/286#issuecomment-221438063&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;DataflowSDK unit tests&lt;/a&gt;. It&apos;s hard to trigger, but possible.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;I propose we make the behavior for package-private options explicit:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Give a better exception message if we hit this issue in &lt;tt&gt;PipelineOptions.as&lt;/tt&gt; listing the non-public interfaces and what packages they&apos;re in.&lt;/li&gt;
	&lt;li&gt;Explicitly reject non-public interfaces from &lt;tt&gt;PipelineOptionsFactory.register&lt;/tt&gt;, since this state is global and is easier to cause issues.&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment></environment>
        <key id="12972795">BEAM-308</key>
            <summary>PipelineOptions throws when using package-private PipelineOptions interfaces from multiple packages</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10103" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">P3</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lcwik">Luke Cwik</assignee>
                                    <reporter username="swegner">Scott Wegner</reporter>
                        <labels>
                            <label>Done</label>
                            <label>backwards-incompatible</label>
                    </labels>
                <created>Wed, 25 May 2016 18:07:56 +0000</created>
                <updated>Tue, 6 Oct 2020 21:58:58 +0000</updated>
                            <resolved>Wed, 3 Apr 2019 23:52:21 +0000</resolved>
                                                    <fixVersion>2.13.0</fixVersion>
                                    <component>sdk-java-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="5400">1.5h</timespent>
                                <comments>
                            <comment id="15300563" author="swegner" created="Wed, 25 May 2016 18:12:07 +0000"  >&lt;p&gt;PR with failing test cases: &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/389/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-beam/pull/389/files&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;/cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bchambers&quot; class=&quot;user-hover&quot; rel=&quot;bchambers&quot;&gt;bchambers&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lcwik&quot; class=&quot;user-hover&quot; rel=&quot;lcwik&quot;&gt;lcwik&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15300644" author="githubbot" created="Wed, 25 May 2016 18:51:54 +0000"  >&lt;p&gt;GitHub user swegner opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/390&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-beam/pull/390&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-308&quot; title=&quot;PipelineOptions throws when using package-private PipelineOptions interfaces from multiple packages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-308&quot;&gt;&lt;del&gt;BEAM-308&lt;/del&gt;&lt;/a&gt; Mark test PipelineOptions interface public&lt;/p&gt;

&lt;p&gt;    Be sure to do all of the following to help us incorporate your contribution&lt;br/&gt;
    quickly and easily:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Make sure the PR title is formatted like:&lt;br/&gt;
       `&lt;a href=&quot;#&amp;gt;&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;BEAM-&amp;lt;Jira issue #&amp;gt;&lt;/a&gt; Description of pull request`&lt;/li&gt;
	&lt;li&gt;[ ] Make sure tests pass via `mvn clean verify`. (Even better, enable&lt;br/&gt;
           Travis-CI on your fork and ensure the whole test matrix passes).&lt;/li&gt;
	&lt;li&gt;[ ] Replace `&amp;lt;Jira issue #&amp;gt;` in the title with the actual Jira issue&lt;br/&gt;
           number, if there is one.&lt;/li&gt;
	&lt;li&gt;[ ] If this contribution is large, please file an Apache&lt;br/&gt;
           &lt;span class=&quot;error&quot;&gt;&amp;#91;Individual Contributor License Agreement&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.apache.org/licenses/icla.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.apache.org/licenses/icla.txt&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    &amp;#8212;&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/swegner/incubator-beam&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/swegner/incubator-beam&lt;/a&gt; pipelineoptions-public&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/390.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-beam/pull/390.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #390&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 7abedfae13319c8e85bfc6a7f3fef4c7edeae9dd&lt;br/&gt;
Author: Scott Wegner &amp;lt;swegner@google.com&amp;gt;&lt;br/&gt;
Date:   2016-05-25T18:40:45Z&lt;/p&gt;

&lt;p&gt;    Mark test PipelineOptions interface public&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15300778" author="githubbot" created="Wed, 25 May 2016 20:18:52 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/390&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-beam/pull/390&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15456510" author="githubbot" created="Thu, 1 Sep 2016 20:25:19 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/862&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-beam/pull/862&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16016222" author="dhalperi@google.com" created="Thu, 18 May 2017 18:36:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=swegner&quot; class=&quot;user-hover&quot; rel=&quot;swegner&quot;&gt;swegner&lt;/a&gt;: Is this issue resolved? If not, are still you working on it? Or should you unassign?&lt;/p&gt;

&lt;p&gt;cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lcwik&quot; class=&quot;user-hover&quot; rel=&quot;lcwik&quot;&gt;lcwik&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16019616" author="swegner" created="Mon, 22 May 2017 14:15:22 +0000"  >&lt;p&gt;AFAIK, this is still an issue. We didn&apos;t move forward initially with the fix because it was low priority-- we only encountered it in test scenarios.&lt;/p&gt;

&lt;p&gt;Unassigning from myself. Anybody can pick this up.&lt;/p&gt;</comment>
                            <comment id="16667591" author="lcwik" created="Mon, 29 Oct 2018 18:45:35 +0000"  >&lt;p&gt;The fix will break users pipelines. Instead I have gone with making this a warning and telling people that this will become an error in a future version of Apache Beam.&lt;/p&gt;</comment>
                            <comment id="16795637" author="kenn" created="Tue, 19 Mar 2019 03:46:28 +0000"  >&lt;p&gt;I actually think that since the state is global it is a spec bug that we allowed non-public pipeline options ever. It is a gray area where I think the change is OK to make, as long as the error message is extremely clear about the action they need to take.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 35 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2yhsn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>