<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:06:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-9319] ResourceExhausted: topics-per-project</title>
                <link>https://issues.apache.org/jira/browse/BEAM-9319</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;Tests are failing due to quota issues. Do we need to clean up topics after tests or set a shorter TTL?&lt;/p&gt;

&lt;p&gt;Log: &lt;a href=&quot;https://builds.apache.org/job/beam_PreCommit_Python_Commit/11178/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/beam_PreCommit_Python_Commit/11178/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Error: &lt;br/&gt;
08:24:40 ======================================================================&lt;br/&gt;
08:24:40 ERROR: test_streaming_wordcount_it (apache_beam.examples.streaming_wordcount_it_test.StreamingWordCountIT)&lt;br/&gt;
08:24:40 ----------------------------------------------------------------------&lt;br/&gt;
08:24:40 Traceback (most recent call last):&lt;br/&gt;
08:24:40   File &quot;/home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Commit/src/sdks/python/apache_beam/examples/streaming_wordcount_it_test.py&quot;, line 58, in setUp&lt;br/&gt;
08:24:40     self.pub_client.topic_path(self.project, INPUT_TOPIC + self.uuid))&lt;br/&gt;
08:24:40   File &quot;/home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Commit/src/build/gradleenv/-194514014/local/lib/python2.7/site-packages/google/cloud/pubsub_v1/_gapic.py&quot;, line 40, in &amp;lt;lambda&amp;gt;&lt;br/&gt;
08:24:40     fx = lambda self, *a, **kw: wrapped_fx(self.api, *a, **kw)  # noqa&lt;br/&gt;
08:24:40   File &quot;/home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Commit/src/build/gradleenv/-194514014/local/lib/python2.7/site-packages/google/cloud/pubsub_v1/gapic/publisher_client.py&quot;, line 332, in create_topic&lt;br/&gt;
08:24:40     request, retry=retry, timeout=timeout, metadata=metadata&lt;br/&gt;
08:24:40   File &quot;/home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Commit/src/build/gradleenv/-194514014/local/lib/python2.7/site-packages/google/api_core/gapic_v1/method.py&quot;, line 143, in _&lt;em&gt;call&lt;/em&gt;_&lt;br/&gt;
08:24:40     return wrapped_func(*args, **kwargs)&lt;br/&gt;
08:24:40   File &quot;/home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Commit/src/build/gradleenv/-194514014/local/lib/python2.7/site-packages/google/api_core/retry.py&quot;, line 286, in retry_wrapped_func&lt;br/&gt;
08:24:40     on_error=on_error,&lt;br/&gt;
08:24:40   File &quot;/home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Commit/src/build/gradleenv/-194514014/local/lib/python2.7/site-packages/google/api_core/retry.py&quot;, line 184, in retry_target&lt;br/&gt;
08:24:40     return target()&lt;br/&gt;
08:24:40   File &quot;/home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Commit/src/build/gradleenv/-194514014/local/lib/python2.7/site-packages/google/api_core/timeout.py&quot;, line 214, in func_with_timeout&lt;br/&gt;
08:24:40     return func(*args, **kwargs)&lt;br/&gt;
08:24:40   File &quot;/home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Commit/src/build/gradleenv/-194514014/local/lib/python2.7/site-packages/google/api_core/grpc_helpers.py&quot;, line 59, in error_remapped_callable&lt;br/&gt;
08:24:40     six.raise_from(exceptions.from_grpc_error(exc), exc)&lt;br/&gt;
08:24:40   File &quot;/home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Commit/src/build/gradleenv/-194514014/local/lib/python2.7/site-packages/six.py&quot;, line 738, in raise_from&lt;br/&gt;
08:24:40     raise value&lt;br/&gt;
08:24:40 ResourceExhausted: 429 Your project has exceeded a limit: (type=&quot;topics-per-project&quot;, current=10000, maximum=10000).&lt;/p&gt;</description>
                <environment></environment>
        <key id="13285390">BEAM-9319</key>
            <summary>ResourceExhausted: topics-per-project</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bhulette">Brian Hulette</assignee>
                                    <reporter username="altay">Ahmet Altay</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Feb 2020 17:45:37 +0000</created>
                <updated>Sat, 16 May 2020 13:38:25 +0000</updated>
                            <resolved>Mon, 9 Mar 2020 17:56:01 +0000</resolved>
                                                    <fixVersion>2.21.0</fixVersion>
                                    <component>test-failures</component>
                    <component>testing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="17037170" author="altay" created="Fri, 14 Feb 2020 18:22:05 +0000"  >&lt;p&gt;/cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markflyhigh&quot; class=&quot;user-hover&quot; rel=&quot;markflyhigh&quot;&gt;markflyhigh&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17037189" author="altay" created="Fri, 14 Feb 2020 18:33:48 +0000"  >&lt;p&gt;Looking at &lt;a href=&quot;https://console.cloud.google.com/cloudpubsub/topic/list?folder=&amp;amp;organizationId=&amp;amp;project=apache-beam-testing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://console.cloud.google.com/cloudpubsub/topic/list?folder=&amp;amp;organizationId=&amp;amp;project=apache-beam-testing&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;There are some leaky tests:&lt;br/&gt;
exercise_streaming_metrics_topic_input000ec192-97fe-4885-b5a4-6bfb92a9ea7e&lt;br/&gt;
integ-test-PubsubJsonIT-testSelectsPayloadContent-2019-10-03-16-11-52-408-start--2927088586724238875&lt;br/&gt;
integ-test-PubsubJsonIT-testSQLInsertJsonRowsToPubsubFlat-2020-01-16-19-41-19-267-start-7261005531427738352&lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;Particularly integ-test-PubsubJsonIT-* has leakeds 1000s of topics, should we clean those?&lt;/p&gt;</comment>
                            <comment id="17037194" author="bhulette" created="Fri, 14 Feb 2020 18:38:48 +0000"  >&lt;p&gt;it should be fine to clean those. &lt;/p&gt;

&lt;p&gt;I&apos;m pretty sure there&apos;s logic to clean up those topics.. I&apos;ll look into how they&apos;re getting leaked.&lt;/p&gt;</comment>
                            <comment id="17037207" author="yifanzou" created="Fri, 14 Feb 2020 19:00:09 +0000"  >&lt;p&gt;Looked into our pubsub topics. Seems none of them has ttl applied. I can help to delete stale topics which start with &quot;integ-test-PubsubJsonIT&quot; at this moment. And we do need to consider to have the tests release the resource usage after completion. Or, having a tool to cleanup the unused resources periodically.&lt;/p&gt;</comment>
                            <comment id="17037246" author="altay" created="Fri, 14 Feb 2020 19:44:33 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Let&apos;s start with cleaning up leaked resources.&lt;/li&gt;
	&lt;li&gt;If possible, it would be good to add TTL to all new topics. (7 days is probably a good value)&lt;/li&gt;
	&lt;li&gt;I am pretty sure tests have logic to cleanup. Leaked topics are from various different dates. If there was a leak on the normal path, this would have failed much earlier.&lt;/li&gt;
	&lt;li&gt;A test framework improvement might be needed. Is it possible that some teardowns are not executed? (Maybe jenkins stops execution?)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17037248" author="bhulette" created="Fri, 14 Feb 2020 19:47:31 +0000"  >&lt;p&gt;Can we apply a ttl on a topic? I thought we could only do that for subscriptions&lt;/p&gt;

&lt;p&gt;A tool to cleanup unused topics periodically would be good, since we&apos;ll likely have some leaked topics when there are hard failures etc. But I would like to understand what&apos;s going on here, since it seems like we&apos;re even leaking topics in the happy path. I ran locally and confirmed that TestPubsub is attempting to delete topics (and succeeded in the case I ran). Maybe sometimes the request fails and that error is getting swallowed up?&lt;/p&gt;

&lt;p&gt;I got a list of all the topics as of 30 minutes ago or so.  &lt;/p&gt;

&lt;p&gt;Many came from Java&apos;s TestPubSub. Interestingly not every class that uses TestPubSub and/or TestPubsubSignal is represented. So maybe there are some clues there. Classes&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;PubsubAvroIT&lt;/li&gt;
	&lt;li&gt;PubsubJsonIT&lt;/li&gt;
	&lt;li&gt;PubsubReadIT&lt;/li&gt;
	&lt;li&gt;PubsubToBigQueryIT&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;There are many more that seem to come from python&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;psit_topic_
{input,output}&amp;lt;uuid&amp;gt;&lt;br/&gt;
- wc_topic_{input,output}
&lt;p&gt;&amp;lt;uuid&amp;gt;&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;game_stats_it_input_topic&amp;lt;uuid&amp;gt;&lt;/li&gt;
	&lt;li&gt;exercise_streaming_metrics_topic_
{input,output}
&lt;p&gt;&amp;lt;uuid&amp;gt;&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;leader_board_it_input_topic&amp;lt;uuid&amp;gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;There&apos;s also a few like:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;testpipeline-jenkins-1210121030-5722fbf2&lt;/li&gt;
	&lt;li&gt;testpipeline-pabloem-0307235733-e7275034&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17037249" author="bhulette" created="Fri, 14 Feb 2020 19:52:32 +0000"  >&lt;p&gt;I think we must be getting leaks on the normal path. Just from PubsubJsonIT there are leaks every day, ranging from 20-100 per day.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://gist.github.com/TheNeuralBit/3bf64be189f36be2056a7d302e357178&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/TheNeuralBit/3bf64be189f36be2056a7d302e357178&lt;/a&gt; (not  exhaustive, I had already started deleting some topics when I got this dump)&lt;/p&gt;</comment>
                            <comment id="17037255" author="bhulette" created="Fri, 14 Feb 2020 19:56:36 +0000"  >&lt;p&gt;Uploaded the dump of topics here in case anyone else wants to take a look: &lt;a href=&quot;https://gist.github.com/TheNeuralBit/47a63ddabbf5f65de7c05a9851ca1d12&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/TheNeuralBit/47a63ddabbf5f65de7c05a9851ca1d12&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17037389" author="altay" created="Sat, 15 Feb 2020 01:26:16 +0000"  >&lt;p&gt;I do not know if pubsub supports TTLs for topics. Subscriptions have a 31 day default TTL.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dpcollins-google&quot; class=&quot;user-hover&quot; rel=&quot;dpcollins-google&quot;&gt;dpcollins-google&lt;/a&gt; - might actually know the answer.&lt;/p&gt;</comment>
                            <comment id="17037390" author="altay" created="Sat, 15 Feb 2020 01:27:14 +0000"  >&lt;p&gt;Brian, can you cleanup some older topics to at least enable the failing tests? We can temporarily disable pubsubio test if we think it is consistently leaking.&lt;/p&gt;</comment>
                            <comment id="17037395" author="yifanzou" created="Sat, 15 Feb 2020 01:52:04 +0000"  >&lt;p&gt;Done. 5800 old topics deleted.&lt;/p&gt;</comment>
                            <comment id="17041441" author="altay" created="Fri, 21 Feb 2020 01:52:32 +0000"  >&lt;p&gt;Thank you!&lt;/p&gt;

&lt;p&gt;Do we still need to address the leaking problem?&lt;/p&gt;</comment>
                            <comment id="17041466" author="bhulette" created="Fri, 21 Feb 2020 02:18:41 +0000"  >&lt;p&gt;Yeah, we&apos;re definitely still leaking topics. It looks like there were 131 leaked today from TestPubSub. I&apos;ll have to investigate further&lt;/p&gt;</comment>
                            <comment id="17054198" author="bhulette" created="Sat, 7 Mar 2020 20:38:32 +0000"  >&lt;p&gt;I found a culprit - TestPubSubSignal creates two topic but only cleans up one of them. PR up now: &lt;a href=&quot;https://github.com/apache/beam/pull/11072&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/11072&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I grepped through the topic list and this accounts for the vast majority of them. The&apos;re are on the order of 10 others that are probably just due to hard failures.&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 36 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0biew:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>