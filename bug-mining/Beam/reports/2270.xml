<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:15:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-11979] Can&apos;t use ReadFromMongoDB with a datetime in filter</title>
                <link>https://issues.apache.org/jira/browse/BEAM-11979</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;I&apos;m having an issue while using a filter containing a datetime.&lt;/p&gt;

&lt;p&gt;This filter works directly in pymongo but not in&#160;ReadFromMongoDB.&lt;br/&gt;
_BoundedMongoSource.display_data() seems to be the source of the issue.&lt;br/&gt;
&#160;&lt;br/&gt;
Fixing the line 267:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
res[&lt;span class=&quot;code-quote&quot;&gt;&apos;filter&apos;&lt;/span&gt;] = json.dumps(self.filter)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;by using:&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
#&#160;from bson &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; json_util
res[&lt;span class=&quot;code-quote&quot;&gt;&apos;filter&apos;&lt;/span&gt;] = json.dumps(self.filter, &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;=json_util.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here is an example of my code :&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; apache_beam as beam
from apache_beam.io &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; ReadFromMongoDB
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; datetime

inputs_query = {&lt;span class=&quot;code-quote&quot;&gt;&quot;created_at&quot;&lt;/span&gt;: { &lt;span class=&quot;code-quote&quot;&gt;&quot;$gte&quot;&lt;/span&gt;: datetime.datetime.now() } } 

with beam.Pipeline() as p:
    p_inputs = (p  | &lt;span class=&quot;code-quote&quot;&gt;&apos;Read Mongo Inputs&apos;&lt;/span&gt; &amp;gt;&amp;gt; ReadFromMongoDB(uri=mongo_db_uri, 
                                                            db=db, 
                                                            coll=input_coll, 
                                                            filter=inputs_query
                                                            )
                    | &lt;span class=&quot;code-quote&quot;&gt;&apos;Count all Inputs&apos;&lt;/span&gt; &amp;gt;&amp;gt; beam.combiners.Count.Globally()
                    | &lt;span class=&quot;code-quote&quot;&gt;&apos;Print Inputs&apos;&lt;/span&gt; &amp;gt;&amp;gt; beam.Map(print)
                )
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I get the following error :&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
mongomicrotest.py:19: FutureWarning: ReadFromMongoDB is experimental.
  | &lt;span class=&quot;code-quote&quot;&gt;&apos;Print Inputs&apos;&lt;/span&gt; &amp;gt;&amp;gt; beam.Map(print)
Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;mongomicrotest.py&quot;&lt;/span&gt;, line 19, in &amp;lt;module&amp;gt;
    | &lt;span class=&quot;code-quote&quot;&gt;&apos;Print Inputs&apos;&lt;/span&gt; &amp;gt;&amp;gt; beam.Map(print)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/gael/venv/venv36/lib/python3.6/site-packages/apache_beam/transforms/ptransform.py&quot;&lt;/span&gt;, line 1058, in __ror__
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; self.transform.__ror__(pvalueish, self.label)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/gael/venv/venv36/lib/python3.6/site-packages/apache_beam/transforms/ptransform.py&quot;&lt;/span&gt;, line 573, in __ror__
    result = p.apply(self, pvalueish, label)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/gael/venv/venv36/lib/python3.6/site-packages/apache_beam/pipeline.py&quot;&lt;/span&gt;, line 646, in apply
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; self.apply(transform, pvalueish)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/gael/venv/venv36/lib/python3.6/site-packages/apache_beam/pipeline.py&quot;&lt;/span&gt;, line 689, in apply
    pvalueish_result = self.runner.apply(transform, pvalueish, self._options)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/gael/venv/venv36/lib/python3.6/site-packages/apache_beam/runners/runner.py&quot;&lt;/span&gt;, line 188, in apply
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; m(transform, input, options)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/gael/venv/venv36/lib/python3.6/site-packages/apache_beam/runners/runner.py&quot;&lt;/span&gt;, line 218, in apply_PTransform
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; transform.expand(input)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/gael/venv/venv36/lib/python3.6/site-packages/apache_beam/io/mongodbio.py&quot;&lt;/span&gt;, line 163, in expand
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; pcoll | iobase.Read(self._mongo_source)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/gael/venv/venv36/lib/python3.6/site-packages/apache_beam/pvalue.py&quot;&lt;/span&gt;, line 141, in __or__
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; self.pipeline.apply(ptransform, self)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/gael/venv/venv36/lib/python3.6/site-packages/apache_beam/pipeline.py&quot;&lt;/span&gt;, line 689, in apply
    pvalueish_result = self.runner.apply(transform, pvalueish, self._options)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/gael/venv/venv36/lib/python3.6/site-packages/apache_beam/runners/runner.py&quot;&lt;/span&gt;, line 188, in apply
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; m(transform, input, options)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/gael/venv/venv36/lib/python3.6/site-packages/apache_beam/runners/runner.py&quot;&lt;/span&gt;, line 218, in apply_PTransform
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; transform.expand(input)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/gael/venv/venv36/lib/python3.6/site-packages/apache_beam/io/iobase.py&quot;&lt;/span&gt;, line 894, in expand
    display_data = self.source.display_data() or {}
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/gael/venv/venv36/lib/python3.6/site-packages/apache_beam/io/mongodbio.py&quot;&lt;/span&gt;, line 267, in display_data
    res[&lt;span class=&quot;code-quote&quot;&gt;&apos;filter&apos;&lt;/span&gt;] = json.dumps(self.filter)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/gael/.pyenv/versions/3.6.11/lib/python3.6/json/__init__.py&quot;&lt;/span&gt;, line 231, in dumps
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; _default_encoder.encode(obj)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/gael/.pyenv/versions/3.6.11/lib/python3.6/json/encoder.py&quot;&lt;/span&gt;, line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/gael/.pyenv/versions/3.6.11/lib/python3.6/json/encoder.py&quot;&lt;/span&gt;, line 257, in iterencode
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; _iterencode(o, 0)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/gael/.pyenv/versions/3.6.11/lib/python3.6/json/encoder.py&quot;&lt;/span&gt;, line 180, in &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
    o.__class__.__name__)
TypeError: &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; of type &lt;span class=&quot;code-quote&quot;&gt;&apos;datetime&apos;&lt;/span&gt; is not JSON serializable
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Maybe there is a way to correctly pass a datetime in the filter ?&lt;br/&gt;
This is a blocker in our company project.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13365269">BEAM-11979</key>
            <summary>Can&apos;t use ReadFromMongoDB with a datetime in filter</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yichi">Yichi Zhang</assignee>
                                    <reporter username="M&#233;riaux">Ga&#235;l</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 Mar 2021 15:42:35 +0000</created>
                <updated>Tue, 30 Mar 2021 18:54:41 +0000</updated>
                            <resolved>Fri, 19 Mar 2021 16:37:11 +0000</resolved>
                                    <version>2.28.0</version>
                                    <fixVersion>2.29.0</fixVersion>
                                    <component>io-py-mongodb</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="10800">3h</timespent>
                                <comments>
                            <comment id="17304961" author="m&#233;riaux" created="Fri, 19 Mar 2021 15:08:26 +0000"  >&lt;p&gt;I saw you merged the fix on master.&lt;/p&gt;

&lt;p&gt;Can I have an estimated time of delivery of the fix on pip ?&lt;/p&gt;</comment>
                            <comment id="17305013" author="yichi" created="Fri, 19 Mar 2021 16:36:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=M%C3%A9riaux&quot; class=&quot;user-hover&quot; rel=&quot;M&#233;riaux&quot;&gt;M&#233;riaux&lt;/a&gt;&#160;it will be in the 2.30.0 release, if you need the fix right now you can also build the sdk from head and pass the sdk tar with --sdk_location when you run your pipeline.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 34 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0osn4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>