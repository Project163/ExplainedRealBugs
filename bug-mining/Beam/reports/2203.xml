<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:14:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-11731] numpy 1.20.0 breaks dataframe io_test.test_read_write_10_parquet and mypy</title>
                <link>https://issues.apache.org/jira/browse/BEAM-11731</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;pyarrow.lib.ArrowTypeError: (&quot;Did not pass numpy.dtype object &lt;span class=&quot;error&quot;&gt;&amp;#91;while running &amp;#39;_WriteToPandas/WriteToFiles/ParDo(_WriteUnshardedRecordsFn)/ParDo(_WriteUnshardedRecordsFn)&amp;#39;&amp;#93;&lt;/span&gt;&quot;, &apos;Conversion failed for column rank with type int64&apos;)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://ci-beam.apache.org/job/beam_PreCommit_Python_Commit/17083/testReport/junit/apache_beam.dataframe.io_test/IOTest/test_read_write_10_parquet/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_PreCommit_Python_Commit/17083/testReport/junit/apache_beam.dataframe.io_test/IOTest/test_read_write_10_parquet/&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13356021">BEAM-11731</key>
            <summary>numpy 1.20.0 breaks dataframe io_test.test_read_write_10_parquet and mypy</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10101" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">P1</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bhulette">Brian Hulette</assignee>
                                    <reporter username="ibzib">Kyle Weaver</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Feb 2021 18:31:45 +0000</created>
                <updated>Wed, 28 Apr 2021 17:25:21 +0000</updated>
                            <resolved>Fri, 12 Mar 2021 17:56:25 +0000</resolved>
                                    <version>2.26.0</version>
                    <version>2.27.0</version>
                                    <fixVersion>Not applicable</fixVersion>
                                    <component>test-failures</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="19200">5h 20m</timespent>
                                <comments>
                            <comment id="17276621" author="bhulette" created="Mon, 1 Feb 2021 20:05:13 +0000"  >&lt;p&gt;Took a quick look since it looks like an issue with pandas/pyarrow/parquet. First cron failure was &lt;a href=&quot;https://ci-beam.apache.org/job/beam_PreCommit_Python_Cron/3797/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_PreCommit_Python_Cron/3797/&lt;/a&gt; which has no beam changes. Doesn&apos;t seem to be due to a pyarrow or pandas release either, we&apos;re still running with pyarrow 2.0.0 and pandas 1.1.5.&lt;/p&gt;

&lt;p&gt;I noticed that of all the various configurations we test with, only the py37-* ones are failing. py36 and py38 are ok.&lt;/p&gt;</comment>
                            <comment id="17276623" author="bhulette" created="Mon, 1 Feb 2021 20:07:54 +0000"  >&lt;p&gt;PythonLint went red at the same time (&lt;a href=&quot;https://ci-beam.apache.org/job/beam_PreCommit_PythonLint_Cron/1930/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_PreCommit_PythonLint_Cron/1930/console&lt;/a&gt;), perhaps with a more telling error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
16:09:23 apache_beam/dataframe/schemas.py:94: error: Module has no attribute &lt;span class=&quot;code-quote&quot;&gt;&quot;bool&quot;&lt;/span&gt;; maybe &lt;span class=&quot;code-quote&quot;&gt;&quot;bool_&quot;&lt;/span&gt; or &lt;span class=&quot;code-quote&quot;&gt;&quot;bool8&quot;&lt;/span&gt;?  [attr-defined]
16:09:23 apache_beam/dataframe/schemas.py:105: error: Module has no attribute &lt;span class=&quot;code-quote&quot;&gt;&quot;object&quot;&lt;/span&gt;; maybe &lt;span class=&quot;code-quote&quot;&gt;&quot;object_&quot;&lt;/span&gt; or &lt;span class=&quot;code-quote&quot;&gt;&quot;object0&quot;&lt;/span&gt;?  [attr-defined]
16:09:23 apache_beam/dataframe/schemas.py:111: error: Module has no attribute &lt;span class=&quot;code-quote&quot;&gt;&quot;bool&quot;&lt;/span&gt;; maybe &lt;span class=&quot;code-quote&quot;&gt;&quot;bool_&quot;&lt;/span&gt; or &lt;span class=&quot;code-quote&quot;&gt;&quot;bool8&quot;&lt;/span&gt;?  [attr-defined]
16:09:23 apache_beam/dataframe/schemas.py:127: error: Argument 1 to &lt;span class=&quot;code-quote&quot;&gt;&quot;append&quot;&lt;/span&gt; of &lt;span class=&quot;code-quote&quot;&gt;&quot;list&quot;&lt;/span&gt; has incompatible type &lt;span class=&quot;code-quote&quot;&gt;&quot;Type[str]&quot;&lt;/span&gt;; expected &lt;span class=&quot;code-quote&quot;&gt;&quot;Type[floating[Any]]&quot;&lt;/span&gt;  [arg-type]
16:09:23 apache_beam/dataframe/schemas.py:185: error: Module has no attribute &lt;span class=&quot;code-quote&quot;&gt;&quot;object&quot;&lt;/span&gt;; maybe &lt;span class=&quot;code-quote&quot;&gt;&quot;object_&quot;&lt;/span&gt; or &lt;span class=&quot;code-quote&quot;&gt;&quot;object0&quot;&lt;/span&gt;?  [attr-defined]
16:09:27 apache_beam/coders/row_coder_test.py:60: error: Argument &lt;span class=&quot;code-quote&quot;&gt;&quot;age&quot;&lt;/span&gt; to &lt;span class=&quot;code-quote&quot;&gt;&quot;Person&quot;&lt;/span&gt; has incompatible type &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&quot;&lt;/span&gt;; expected &lt;span class=&quot;code-quote&quot;&gt;&quot;signedinteger[_32Bit]&quot;&lt;/span&gt;  [arg-type]
16:09:27 apache_beam/coders/row_coder_test.py:72: error: Argument 2 to &lt;span class=&quot;code-quote&quot;&gt;&quot;Person&quot;&lt;/span&gt; has incompatible type &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&quot;&lt;/span&gt;; expected &lt;span class=&quot;code-quote&quot;&gt;&quot;signedinteger[_32Bit]&quot;&lt;/span&gt;  [arg-type]
16:09:27 apache_beam/coders/row_coder_test.py:82: error: Argument 2 to &lt;span class=&quot;code-quote&quot;&gt;&quot;Person&quot;&lt;/span&gt; has incompatible type &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&quot;&lt;/span&gt;; expected &lt;span class=&quot;code-quote&quot;&gt;&quot;signedinteger[_32Bit]&quot;&lt;/span&gt;  [arg-type]
16:09:27 apache_beam/testing/synthetic_pipeline_test.py:41: error: Incompatible types in assignment (expression has type &lt;span class=&quot;code-quote&quot;&gt;&quot;None&quot;&lt;/span&gt;, variable has type Module)  [assignment]
16:09:28 apache_beam/dataframe/schemas_test.py:78: error: Module has no attribute &lt;span class=&quot;code-quote&quot;&gt;&quot;bool&quot;&lt;/span&gt;; maybe &lt;span class=&quot;code-quote&quot;&gt;&quot;bool_&quot;&lt;/span&gt; or &lt;span class=&quot;code-quote&quot;&gt;&quot;bool8&quot;&lt;/span&gt;?  [attr-defined]
16:09:28 apache_beam/dataframe/schemas_test.py:79: error: Module has no attribute &lt;span class=&quot;code-quote&quot;&gt;&quot;object&quot;&lt;/span&gt;; maybe &lt;span class=&quot;code-quote&quot;&gt;&quot;object_&quot;&lt;/span&gt; or &lt;span class=&quot;code-quote&quot;&gt;&quot;object0&quot;&lt;/span&gt;?  [attr-defined]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Maybe a numpy release?&lt;/p&gt;</comment>
                            <comment id="17276625" author="bhulette" created="Mon, 1 Feb 2021 20:10:39 +0000"  >&lt;p&gt;Yes numpy 1.20.0 just came out. I&apos;ll send a PR to restrict the bound.&lt;/p&gt;</comment>
                            <comment id="17276705" author="bhulette" created="Mon, 1 Feb 2021 22:22:31 +0000"  >&lt;p&gt;To summarize, we seem to have two issues with numpy 1.2.0:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Actually a pyarrow issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/ARROW-11450&quot; title=&quot;[Python] pyarrow&amp;lt;3 incompatible with numpy&amp;gt;=1.20.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ARROW-11450&quot;&gt;&lt;del&gt;ARROW-11450&lt;/del&gt;&lt;/a&gt;), this is the cause of the test_read_write_10_parquet failure&lt;/li&gt;
	&lt;li&gt;numpy 1.20 deprecates some aliases for standard types (&lt;a href=&quot;https://numpy.org/doc/1.20/release/1.20.0-notes.html?highlight=release%20notes#using-the-aliases-of-builtin-types-like-np-int-is-deprecated&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://numpy.org/doc/1.20/release/1.20.0-notes.html?highlight=release%20notes#using-the-aliases-of-builtin-types-like-np-int-is-deprecated&lt;/a&gt;). This is the cause of the PreCommit Lint failure. We rely on these aliases in a couple of places, most notably in beam schemas. The release notes say they are deprecated, and not removed. Maybe this is just an issue with mypy warning us about using a deprecated object? The fact that this isn&apos;t accompanied by any test failures would indicate this one is not a serious problem for our users.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Actions I think we should take:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Stop using np.bool, np.int, .. aliases (easy, not urgent)&lt;/li&gt;
	&lt;li&gt;From now on use the next &lt;em&gt;minor&lt;/em&gt; version of numpy as our upper bound (i.e. &amp;lt;1.21.0) instead of the next major version. Releases aren&apos;t that frequent and we get a signal about these updates from the dependency check report.&lt;/li&gt;
	&lt;li&gt;(If possible) restrict to numpy &amp;lt;1.20.0 when pyarrow &amp;lt;3.0 is used. pyarrow 3.0 works with numpy 1.20.0, but pyarrow &amp;lt;3.0 does not, even though their numpy requirement allows it. If its possible we should make our setup.py work around this.&lt;/li&gt;
	&lt;li&gt;Cherry-pick &amp;lt;1.20.0 requirement to 2.28.0 branch.&lt;/li&gt;
	&lt;li&gt;Update 2.27.0 blog post with a known issue with numpy 1.20.0 and parquet.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17276832" author="chamikara" created="Tue, 2 Feb 2021 03:40:22 +0000"  >&lt;p&gt;Removing from the 2.28.0 blockers list since the cherry-pick was merged. Feel free to resolve if appropriate.&lt;/p&gt;</comment>
                            <comment id="17277191" author="bhulette" created="Tue, 2 Feb 2021 15:11:57 +0000"  >&lt;p&gt;Thanks Cham. I&apos;m also lowering this to P1.&lt;/p&gt;</comment>
                            <comment id="17284274" author="chamikara" created="Sat, 13 Feb 2021 18:04:45 +0000"  >&lt;p&gt;Are you able to build pydocs with these updates ? I&apos;m running into an issue in Linux (not in Mac strangely).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;tox -e py38-docs&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;WARNING: autodoc: failed to import module &apos;row_coder_test&apos; from module &apos;apache_beam.coders&apos;; the following exception was raised:&lt;br/&gt;
Traceback (most recent call last):&lt;br/&gt;
 File &quot;/usr/local/google/home/chamikara/code/beam_checkout_1/beam/sdks/python/target/.tox/py38-docs/lib/python3.8/site-packages/dateutil/parser/isoparser.py&quot;, line 208, in _parse_isodate&lt;br/&gt;
 return self._parse_isodate_common(dt_str)&lt;br/&gt;
 File &quot;/usr/local/google/home/chamikara/code/beam_checkout_1/beam/sdks/python/target/.tox/py38-docs/lib/python3.8/site-packages/dateutil/parser/isoparser.py&quot;, line 250, in _parse_isodate_common&lt;br/&gt;
 components&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; = int(dt_str&lt;span class=&quot;error&quot;&gt;&amp;#91;pos:pos + 2&amp;#93;&lt;/span&gt;)&lt;br/&gt;
ValueError: invalid literal for int() with base 10: &apos;3-&apos;&lt;/p&gt;

&lt;p&gt;....&lt;/p&gt;

&lt;p&gt;Command exited with non-zero status 1&lt;br/&gt;
51.41user 1.17system 0:52.83elapsed 99%CPU (0avgtext+0avgdata 372048maxresident)k&lt;br/&gt;
0inputs+188440outputs (0major+158785minor)pagefaults 0swaps&lt;br/&gt;
ERROR: InvocationError for command /usr/bin/time scripts/generate_pydoc.sh (exited with code 1)&lt;br/&gt;
py38-docs run-test-post: commands&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; | bash /usr/local/google/home/chamikara/code/beam_checkout_1/beam/sdks/python/scripts/run_tox_cleanup.sh&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17285343" author="bhulette" created="Tue, 16 Feb 2021 16:56:04 +0000"  >&lt;p&gt;I&apos;m not sure this is related to numpy/pandas versions. I see that error on both the master branch and the release-2.28.0 branch, which are using different versions (release-2.28.0 has more restrictive upper bounds to avoid this issue)&lt;/p&gt;</comment>
                            <comment id="17285346" author="chamikara" created="Tue, 16 Feb 2021 17:02:43 +0000"  >&lt;p&gt;OK. Feel free to close this Jira and open a new one.&lt;/p&gt;

&lt;p&gt;FWIW I could build the RC1 for 2.28.0 with PR for docs.&lt;/p&gt;</comment>
                            <comment id="17285355" author="bhulette" created="Tue, 16 Feb 2021 17:14:49 +0000"  >&lt;p&gt;I may have something strange going on with my python setup. Surprising things are happening as I go back and try py38-docs in older versions. &lt;/p&gt;

&lt;p&gt;So you only see this issue on the master branch? Regardless I think  a new jira is appropriate. Filed &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-11817&quot; title=&quot;py38-docs fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-11817&quot;&gt;&lt;del&gt;BEAM-11817&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17300473" author="kenn" created="Fri, 12 Mar 2021 17:36:08 +0000"  >&lt;p&gt;What is the status of this now? Asking on behalf of 2.29.0 since Fix Version is set.&lt;/p&gt;</comment>
                            <comment id="17300504" author="bhulette" created="Fri, 12 Mar 2021 17:56:25 +0000"  >&lt;p&gt;This is resolved, sorry about that.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 35 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0n8d4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>