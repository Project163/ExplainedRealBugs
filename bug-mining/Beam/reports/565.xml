<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:49:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-3484] HadoopInputFormatIO reads big datasets invalid</title>
                <link>https://issues.apache.org/jira/browse/BEAM-3484</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;For big datasets&#160;HadoopInputFormat sometimes skips/duplicates elements from database in resulting PCollection. This&#160;gives incorrect read result.&lt;/p&gt;

&lt;p&gt;Occurred to me while&#160;developing HadoopInputFormatIOIT and running it on dataflow. For datasets smaller&#160;or equal to 600 000 database rows I wasn&apos;t able to reproduce the issue.&#160;Bug appeared only for bigger sets, eg. 700 000, 1 000 000.&#160;&lt;/p&gt;

&lt;p&gt;Attachments:&lt;br/&gt;
 &#160;-&#160;text file with sorted HadoopInputFormat.read() result saved using TextIO.write().to().withoutSharding(). If you look carefully you&apos;ll notice duplicates or missing values that should&#160;not happen&lt;/p&gt;

&lt;p&gt;&#160;-&#160;same text file for 600 000 records&#160;not having any duplicates and missing elements&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;link to a PR&#160;with HadoopInputFormatIO integration test that allows to reproduce this issue.&#160;At the moment of writing, this code is not merged yet.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13131248">BEAM-3484</key>
            <summary>HadoopInputFormatIO reads big datasets invalid</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10103" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">P3</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aromanenko">Alexey Romanenko</assignee>
                                    <reporter username="&#321;ukaszG">Lukasz Gajowy</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Jan 2018 14:22:19 +0000</created>
                <updated>Sat, 16 May 2020 13:22:12 +0000</updated>
                            <resolved>Thu, 19 Apr 2018 20:05:34 +0000</resolved>
                                    <version>2.3.0</version>
                    <version>2.4.0</version>
                                    <fixVersion>2.5.0</fixVersion>
                                    <component>io-java-hadoop-format</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="8400">2h 20m</timespent>
                                <comments>
                            <comment id="16333005" author="chamikara" created="Fri, 19 Jan 2018 23:31:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iemejia&quot; class=&quot;user-hover&quot; rel=&quot;iemejia&quot;&gt;iemejia&lt;/a&gt; is this something you are interested in looking into ? Feel free to&#160;unassign if not.&lt;/p&gt;

&lt;p&gt;cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbonofre&quot; class=&quot;user-hover&quot; rel=&quot;jbonofre&quot;&gt;jbonofre&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16335757" author="iemejia" created="Tue, 23 Jan 2018 13:09:42 +0000"  >&lt;p&gt;Sure I will take a look, but first I will tackle &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-3432&quot; title=&quot;Merge sdks/java/io/hadoop/jdk1.8-tests into sdks/java/io/hadoop/input-format&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-3432&quot;&gt;&lt;del&gt;BEAM-3432&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16340099" author="iemejia" created="Thu, 25 Jan 2018 21:22:23 +0000"  >&lt;p&gt;I am reasigning this to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aromanenko&quot; class=&quot;user-hover&quot; rel=&quot;aromanenko&quot;&gt;aromanenko&lt;/a&gt; who is going to help me take a look on it.&lt;/p&gt;</comment>
                            <comment id="16442721" author="aromanenko" created="Wed, 18 Apr 2018 15:45:35 +0000"  >&lt;p&gt;This issue can be easily reproduced by increasing the number of splits, it can be done with this config option:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
conf.setInt(&lt;span class=&quot;code-quote&quot;&gt;&quot;mapreduce.job.maps&quot;&lt;/span&gt;, 16);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The more splits we have, the more chances that we will hit this issue.&lt;/p&gt;

&lt;p&gt;The root cause of this is the following - for every split it creates and perform a separate SQL query, like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SELECT id, name FROM TableName LIMIT Y OFFSET X
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;where X and Y depend on split and total number of rows in table.&lt;/p&gt;

&lt;p&gt;Since, RDBMS doesn&apos;t guarantee the order of results in case when &quot;ORDER BY&quot; was not used then we can have an intersection of some splits and some rows will be duplicated and others will be missed. To avoid this, SQL query should order results by one or several keys, like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SELECT id, name FROM TableName ORDER BY id LIMIT Y OFFSET X 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12906230" name="result_sorted1000000" size="13888889" author="&#321;ukaszG" created="Tue, 16 Jan 2018 14:23:34 +0000"/>
                            <attachment id="12906229" name="result_sorted600000" size="8288890" author="&#321;ukaszG" created="Tue, 16 Jan 2018 14:23:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 30 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3oyfr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>