<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:17:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-12490] Python PreCommit flaking in SdkWorkerTest.test_harness_monitoring_infos_and_metadata</title>
                <link>https://issues.apache.org/jira/browse/BEAM-12490</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;SdkWorkerTest.test_harness_monitoring_infos_and_metadata has been very flaky over the last few days.&lt;/p&gt;

&lt;p&gt;Based on &lt;a href=&quot;https://ci-beam.apache.org/job/beam_PreCommit_Python_Cron/lastCompletedBuild/testReport/junit/apache_beam.runners.worker.sdk_worker_test/SdkWorkerTest/history/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;test history&lt;/a&gt; it looks like the first flake was in &lt;a href=&quot;https://ci-beam.apache.org/job/beam_PreCommit_Python_Cron/4303/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cron build #4303&lt;/a&gt;.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
self = &amp;lt;apache_beam.runners.worker.sdk_worker_test.SdkWorkerTest testMethod=test_harness_monitoring_infos_and_metadata&amp;gt;

    def test_harness_monitoring_infos_and_metadata(self):
      # Clear the process wide metric container.
      MetricsEnvironment.process_wide_container().reset()
      # Create a process_wide metric.
      urn = &lt;span class=&quot;code-quote&quot;&gt;&apos;my.custom.urn&apos;&lt;/span&gt;
      labels = {&lt;span class=&quot;code-quote&quot;&gt;&apos;key&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;value&apos;&lt;/span&gt;}
      InternalMetrics.counter(urn=urn, labels=labels, process_wide=True).inc(10)
    
      harness_monitoring_infos_request = beam_fn_api_pb2.InstructionRequest(
          instruction_id=&lt;span class=&quot;code-quote&quot;&gt;&quot;monitoring_infos&quot;&lt;/span&gt;,
          harness_monitoring_infos=beam_fn_api_pb2.HarnessMonitoringInfosRequest(
          ))
    
&amp;gt;     responses = self.get_responses([harness_monitoring_infos_request])

apache_beam/runners/worker/sdk_worker_test.py:236: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
apache_beam/runners/worker/sdk_worker_test.py:220: in get_responses
    harness.run()
apache_beam/runners/worker/sdk_worker.py:257: in run
    work_request)
apache_beam/runners/worker/sdk_worker.py:330: in _request_harness_monitoring_infos
    ).to_runner_api_monitoring_infos(None).values()
apache_beam/metrics/execution.py:312: in to_runner_api_monitoring_infos
    cell in items
apache_beam/metrics/execution.py:312: in &amp;lt;listcomp&amp;gt;
    cell in items
apache_beam/metrics/cells.py:76: in to_runner_api_monitoring_info
    mi = self.to_runner_api_monitoring_info_impl(name, transform_id)
apache_beam/metrics/cells.py:158: in to_runner_api_monitoring_info_impl
    name.urn, self.get_cumulative(), labels=name.labels)
apache_beam/metrics/monitoring_infos.py:187: in int64_counter
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; create_monitoring_info(urn, SUM_INT64_TYPE, metric, labels)
apache_beam/metrics/monitoring_infos.py:286: in create_monitoring_info
    urn=urn, type=type_urn, labels=labels or dict(), payload=payload)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = [{&lt;span class=&quot;code-quote&quot;&gt;&apos;GCS_BUCKET&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;gcsio-test&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;GCS_PROJECT_ID&apos;&lt;/span&gt;: 1, &lt;span class=&quot;code-quote&quot;&gt;&apos;METHOD&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;Objects.insert&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;RESOURCE&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-comment&quot;&gt;//storage.googleapis.com/buckets/gcsio-test&apos;&lt;/span&gt;, ...}]
&lt;/span&gt;kwds = {}
self = {&lt;span class=&quot;code-quote&quot;&gt;&apos;GCS_BUCKET&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;gcsio-test&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;METHOD&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;Objects.insert&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;RESOURCE&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-comment&quot;&gt;//storage.googleapis.com/buckets/gcsio-test&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;GCS_PROJECT_ID&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;&apos;, &apos;&lt;/span&gt;SERVICE&lt;span class=&quot;code-quote&quot;&gt;&apos;: &apos;&lt;/span&gt;Storage&apos;}
&lt;/span&gt;other = {&lt;span class=&quot;code-quote&quot;&gt;&apos;GCS_BUCKET&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;gcsio-test&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;GCS_PROJECT_ID&apos;&lt;/span&gt;: 1, &lt;span class=&quot;code-quote&quot;&gt;&apos;METHOD&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;Objects.insert&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;RESOURCE&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-comment&quot;&gt;//storage.googleapis.com/buckets/gcsio-test&apos;&lt;/span&gt;, ...}
&lt;/span&gt;key = &lt;span class=&quot;code-quote&quot;&gt;&apos;GCS_PROJECT_ID&apos;&lt;/span&gt;

    def update(*args, **kwds):
        &apos;&apos;&apos; D.update([E, ]**F) -&amp;gt; None.  Update D from mapping/iterable E and F.
            If E present and has a .keys() method, does:     &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; k in E: D[k] = E[k]
            If E present and lacks .keys() method, does:     &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (k, v) in E: D[k] = v
            In either &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is followed by: &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; k, v in F.items(): D[k] = v
        &apos;&apos;&apos;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not args:
            raise TypeError(&lt;span class=&quot;code-quote&quot;&gt;&quot;descriptor &lt;span class=&quot;code-quote&quot;&gt;&apos;update&apos;&lt;/span&gt; of &lt;span class=&quot;code-quote&quot;&gt;&apos;MutableMapping&apos;&lt;/span&gt; object &quot;&lt;/span&gt;
                            &lt;span class=&quot;code-quote&quot;&gt;&quot;needs an argument&quot;&lt;/span&gt;)
        self, *args = args
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; len(args) &amp;gt; 1:
            raise TypeError(&lt;span class=&quot;code-quote&quot;&gt;&apos;update expected at most 1 arguments, got %d&apos;&lt;/span&gt; %
                            len(args))
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; args:
            other = args[0]
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; isinstance(other, Mapping):
                &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; key in other:
&amp;gt;                   self[key] = other[key]
E                   TypeError: 1 has type &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, but expected one of: bytes, unicode

/usr/lib/python3.7/_collections_abc.py:841: TypeError
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13383761">BEAM-12490</key>
            <summary>Python PreCommit flaking in SdkWorkerTest.test_harness_monitoring_infos_and_metadata</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10101" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">P1</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Mike Hernandez">Mike Hernandez</assignee>
                                    <reporter username="bhulette">Brian Hulette</reporter>
                        <labels>
                            <label>flake</label>
                    </labels>
                <created>Mon, 14 Jun 2021 16:01:41 +0000</created>
                <updated>Fri, 18 Jun 2021 21:22:44 +0000</updated>
                            <resolved>Fri, 18 Jun 2021 16:21:06 +0000</resolved>
                                                    <fixVersion>Not applicable</fixVersion>
                                    <component>test-failures</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="17363046" author="bhulette" created="Mon, 14 Jun 2021 16:07:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/beam/pull/14770&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/14770&lt;/a&gt; seems coincident and relevant&lt;/p&gt;</comment>
                            <comment id="17363109" author="bhulette" created="Mon, 14 Jun 2021 17:51:59 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Mike+Hernandez&quot; class=&quot;user-hover&quot; rel=&quot;Mike Hernandez&quot;&gt;Mike Hernandez&lt;/a&gt; assigning to you for now per &lt;a href=&quot;https://github.com/apache/beam/pull/14770#issuecomment-860853737&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;your comment&lt;/a&gt;. Feel free to pass back if you think there&apos;s some other root cause.&lt;/p&gt;</comment>
                            <comment id="17363195" author="bhulette" created="Mon, 14 Jun 2021 20:33:39 +0000"  >&lt;p&gt;We may want to revert #14770 if we can confirm it&apos;s the cause of the flakiness. I&apos;m seeing this failure a lot.&lt;/p&gt;</comment>
                            <comment id="17365075" author="bhulette" created="Thu, 17 Jun 2021 18:43:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Mike+Hernandez&quot; class=&quot;user-hover&quot; rel=&quot;Mike Hernandez&quot;&gt;Mike Hernandez&lt;/a&gt; any updates here? Do you need help?&lt;/p&gt;</comment>
                            <comment id="17365130" author="mike hernandez" created="Thu, 17 Jun 2021 20:44:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bhulette&quot; class=&quot;user-hover&quot; rel=&quot;bhulette&quot;&gt;bhulette&lt;/a&gt; I tried to run the test in my local but I didn&apos;t get any error. I&apos;ve been watching the builds and it seems that the last 9 haven&apos;t failed, so I&apos;m not sure if it was a temporary issue or if it needs further examination. Is there any other way to run this test and produce this error?&lt;/p&gt;</comment>
                            <comment id="17365135" author="bhulette" created="Thu, 17 Jun 2021 21:17:48 +0000"  >&lt;p&gt;I found a way to reproduce it reliably - if you run the new gcsio_test, followed by sdk_worker_test:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
python -m pytest sdks/python/apache_beam/io/gcp/gcsio_test.py sdks/python/apache_beam/runners/worker/sdk_worker_test.py
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I guess gcio_test is setting some global state that causes sdk_worker test to fail. Note it doesn&apos;t happen if you run sdk_worker_test first, that must be why this is flaky&lt;/p&gt;</comment>
                            <comment id="17365139" author="bhulette" created="Thu, 17 Jun 2021 21:32:15 +0000"  >&lt;p&gt;Left some &lt;a href=&quot;https://github.com/apache/beam/pull/14770#pullrequestreview-686835923&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;comments&lt;/a&gt; on the PR. &lt;/p&gt;

&lt;p&gt;If it&apos;s not clear how to fix this in a day or so I think we should just roll back that PR for now. You&apos;re right it hasn&apos;t happened recently on the PreCommit_Cron, but I&apos;m still seeing it a lot on precommits that are blocking PRs: &lt;a href=&quot;https://ci-beam.apache.org/job/beam_PreCommit_Python_Commit/19087/testReport/apache_beam.runners.worker.sdk_worker_test/SdkWorkerTest/history/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_PreCommit_Python_Commit/19087/testReport/apache_beam.runners.worker.sdk_worker_test/SdkWorkerTest/history/&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="17365143" author="mike hernandez" created="Thu, 17 Jun 2021 22:04:27 +0000"  >&lt;p&gt;I added some changes that solved the comments you left on the PR. Hopefully, this should work, I&apos;ll open a PR right away&lt;/p&gt;</comment>
                            <comment id="17365577" author="bhulette" created="Fri, 18 Jun 2021 16:21:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/beam/pull/15033&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/15033&lt;/a&gt; should address this. Let&apos;s re-open if we see it again though&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 21 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0rxw0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>