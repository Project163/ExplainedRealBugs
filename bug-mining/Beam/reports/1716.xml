<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:07:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-9399] Possible deadlock between DataflowWorkerLoggingHandler and overridden System.err PrintStream</title>
                <link>https://issues.apache.org/jira/browse/BEAM-9399</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;When an exception is encountered in DataflowWorkerLoggingHandler the ErrorManager is used to log the exception.  ErrorManager uses System.err which is overridden to be a PrintStream that writes back into DataflowWorkerLoggingHandler.&lt;/p&gt;

&lt;p&gt;This has the lock ordering DataflowWorkerLoggingHandler -&amp;gt; PrintStream.&lt;br/&gt;
Other logging of System.err has the inverse lock ordering PrintStream-&amp;gt;DataflowWorkerLoggingHandler so there is potential for deadlock.&lt;/p&gt;

&lt;p&gt;This is one known cause of the inversion, but any other System.err logs from inside DataflowWorkerLoggingHandler could cause the same issue.&lt;/p&gt;

&lt;p&gt;Proposed fix is to address low-hanging fruit of having ErrorManager output to the original System.err.  A full fix would be to improve our override of System.err to a PrintStream that can detect the locking inversion or possibly we could use the PrintStream mutex in both cases.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13288148">BEAM-9399</key>
            <summary>Possible deadlock between DataflowWorkerLoggingHandler and overridden System.err PrintStream</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10100" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">P0</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="scwhittle">Sam Whittle</assignee>
                                    <reporter username="scwhittle">Sam Whittle</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Feb 2020 21:10:20 +0000</created>
                <updated>Tue, 8 Dec 2020 09:34:24 +0000</updated>
                            <resolved>Tue, 8 Dec 2020 09:34:23 +0000</resolved>
                                                    <fixVersion>2.25.0</fixVersion>
                                    <component>runner-dataflow</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="43800">12h 10m</timespent>
                                <comments>
                            <comment id="17078658" author="lcwik" created="Wed, 8 Apr 2020 19:47:13 +0000"  >&lt;p&gt;Reopening to track follow-up fix in:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/beam/pull/11351&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/11351&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17194198" author="scwhittle" created="Fri, 11 Sep 2020 10:18:19 +0000"  >&lt;p&gt;Reopening to track the following exception triggered by a user logging an exception to System.stderr. This happens because the PrintStream itself is used for synchronization by other classes, in this case Throwable.printStackTrace locks the stream.&lt;/p&gt;

&lt;p&gt;Instead of using the stream itself for sychronization of the buffer, we should use the buffer or another lock so that this is not possible.&lt;/p&gt;

&lt;p&gt;java.lang.IllegalStateException: &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-9399&quot; title=&quot;Possible deadlock between DataflowWorkerLoggingHandler and overridden System.err PrintStream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-9399&quot;&gt;&lt;del&gt;BEAM-9399&lt;/del&gt;&lt;/a&gt;: publish should not be called with the lock as it may cause deadlock                                                                          &lt;br/&gt;
org.apache.beam.vendor.guava.v26_0_jre.com.google.common.base.Preconditions.checkState(Preconditions.java:507)                                                                           &lt;br/&gt;
org.apache.beam.runners.dataflow.worker.logging.JulHandlerPrintStreamAdapterFactory$JulHandlerPrintStream.publishIfNonEmpty(JulHandlerPrintStreamAdapterFactory.java:380)                &lt;br/&gt;
org.apache.beam.runners.dataflow.worker.logging.JulHandlerPrintStreamAdapterFactory$JulHandlerPrintStream.println(JulHandlerPrintStreamAdapterFactory.java:332)                          &lt;br/&gt;
java.lang.Throwable$WrappedPrintStream.println(Throwable.java:748)                                                                                                                       &lt;br/&gt;
java.lang.Throwable.printStackTrace(Throwable.java:655)                                                                                                                                  &lt;br/&gt;
java.lang.Throwable.printStackTrace(Throwable.java:643)                                                                                                                                  &lt;br/&gt;
org.slf4j.simple.SimpleLogger.writeThrowable(SimpleLogger.java:254)                                                                                                                      &lt;br/&gt;
org.slf4j.simple.SimpleLogger.write(SimpleLogger.java:248)                                                                                                                               &lt;br/&gt;
org.slf4j.simple.SimpleLogger.innerHandleNormalizedLoggingCall(SimpleLogger.java:416)                                                                                                    &lt;br/&gt;
org.slf4j.simple.SimpleLogger.handleNormalizedLoggingCall(SimpleLogger.java:359)                                                                                                         &lt;br/&gt;
org.slf4j.helpers.AbstractLogger.handle_0ArgsCall(AbstractLogger.java:382)                                                                                                               &lt;br/&gt;
org.slf4j.helpers.AbstractLogger.error(AbstractLogger.java:347)                                                                                                                          &lt;br/&gt;
org.apache.beam.runners.dataflow.worker.StreamingDataflowWorker.process(StreamingDataflowWorker.java:1441) &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 9 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0bz7c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>