<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:19:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-12603] Flaky: apache_beam.runners.portability.fn_api_runner.fn_runner_test.FnApiRunnerTestWithGrpcAndMultiWorkers</title>
                <link>https://issues.apache.org/jira/browse/BEAM-12603</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;The `apache_beam.runners.portability.fn_api_runner.fn_runner_test.FnApiRunnerTestWithGrpcAndMultiWorkers` tests are flaky and causing precommit failures that seem similar.&lt;/p&gt;

&lt;p&gt;`test_pardo_windowed_side_inputs` :&#160;&lt;a href=&quot;https://ci-beam.apache.org/job/beam_PreCommit_Python_Cron/4417/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_PreCommit_Python_Cron/4417/console&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
23:32:35 Exception in thread read_grpc_client_inputs:
23:32:35 Traceback (most recent call last):
23:32:35   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/lib/python3.8/threading.py&quot;&lt;/span&gt;, line 932, in _bootstrap_inner
23:32:35     self.run()
23:32:35   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/lib/python3.8/threading.py&quot;&lt;/span&gt;, line 870, in run
23:32:35     self._target(*self._args, **self._kwargs)
23:32:35   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Cron/src/sdks/python/test-suites/tox/py38/build/srcs/sdks/python/apache_beam/runners/worker/data_plane.py&quot;&lt;/span&gt;, line 587, in &amp;lt;lambda&amp;gt;
23:32:35     target=lambda: self._read_inputs(elements_iterator),
23:32:35   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Cron/src/sdks/python/test-suites/tox/py38/build/srcs/sdks/python/apache_beam/runners/worker/data_plane.py&quot;&lt;/span&gt;, line 570, in _read_inputs
23:32:35     &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; elements in elements_iterator:
23:32:35   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Cron/src/sdks/python/test-suites/tox/py38/build/srcs/sdks/python/target/.tox-py38-cython/py38-cython/lib/python3.8/site-packages/grpc/_channel.py&quot;&lt;/span&gt;, line 426, in __next__
23:32:35     &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; self._next()
23:32:35   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Cron/src/sdks/python/test-suites/tox/py38/build/srcs/sdks/python/target/.tox-py38-cython/py38-cython/lib/python3.8/site-packages/grpc/_channel.py&quot;&lt;/span&gt;, line 826, in _next
23:32:35     raise self
23:32:35 grpc._channel._MultiThreadedRendezvous: &amp;lt;_MultiThreadedRendezvous of RPC that terminated with:
23:32:35 	status = StatusCode.UNAVAILABLE
23:32:35 	details = &lt;span class=&quot;code-quote&quot;&gt;&quot;Broken pipe&quot;&lt;/span&gt;
23:32:35 	debug_error_string = &lt;span class=&quot;code-quote&quot;&gt;&quot;{&quot;&lt;/span&gt;created&lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;@1626071403.252458842&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;description&lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;Error received from peer ipv4:127.0.0.1:37459&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;file&lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;src/core/lib/surface/call.cc&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;file_line&lt;span class=&quot;code-quote&quot;&gt;&quot;:1066,&quot;&lt;/span&gt;grpc_message&lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;Broken pipe&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;grpc_status&lt;span class=&quot;code-quote&quot;&gt;&quot;:14}&quot;&lt;/span&gt;
23:32:35 &amp;gt;
23:32:35 Traceback (most recent call last):
23:32:35   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Cron/src/sdks/python/test-suites/tox/py38/build/srcs/sdks/python/apache_beam/runners/worker/data_plane.py&quot;&lt;/span&gt;, line 459, in input_elements
23:32:35     element = received.get(timeout=1)
23:32:35   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/lib/python3.8/queue.py&quot;&lt;/span&gt;, line 178, in get
23:32:35     raise Empty
23:32:35 _queue.Empty
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;`test_pack_combiners` :&#160;&#160;&lt;a href=&quot;https://ci-beam.apache.org/job/beam_PreCommit_Python_Cron/4415/consoleFull&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_PreCommit_Python_Cron/4415/consoleFull&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
11:41:14 Exception ignored in: &amp;lt;object repr() failed&amp;gt;
11:41:14 Traceback (most recent call last):
11:41:14   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Cron/src/sdks/python/test-suites/tox/py36/build/srcs/sdks/python/target/.tox-py36-cython/py36-cython/lib/python3.6/site-packages/grpc/_channel.py&quot;&lt;/span&gt;, line 444, in __del__
11:41:14     with self._state.condition:
11:41:14 AttributeError: &lt;span class=&quot;code-quote&quot;&gt;&apos;_MultiThreadedRendezvous&apos;&lt;/span&gt; object has no attribute &lt;span class=&quot;code-quote&quot;&gt;&apos;_state&apos;&lt;/span&gt;
11:41:14 Traceback (most recent call last):
11:41:14   File &lt;span class=&quot;code-quote&quot;&gt;&quot;apache_beam/runners/common.py&quot;&lt;/span&gt;, line 1223, in apache_beam.runners.common.DoFnRunner.process
11:41:14     &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; self.do_fn_invoker.invoke_process(windowed_value)
11:41:14   File &lt;span class=&quot;code-quote&quot;&gt;&quot;apache_beam/runners/common.py&quot;&lt;/span&gt;, line 752, in apache_beam.runners.common.PerWindowInvoker.invoke_process
11:41:14     self._invoke_process_per_window(
11:41:14   File &lt;span class=&quot;code-quote&quot;&gt;&quot;apache_beam/runners/common.py&quot;&lt;/span&gt;, line 816, in apache_beam.runners.common.PerWindowInvoker._invoke_process_per_window
11:41:14     [si[global_window] &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; si in self.side_inputs]))
11:41:14   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Cron/src/sdks/python/test-suites/tox/py36/build/srcs/sdks/python/apache_beam/runners/worker/bundle_processor.py&quot;&lt;/span&gt;, line 427, in __getitem__
11:41:14     self._cache[target_window] = self._side_input_data.view_fn(raw_view)
11:41:14   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Cron/src/sdks/python/test-suites/tox/py36/build/srcs/sdks/python/apache_beam/runners/worker/bundle_processor.py&quot;&lt;/span&gt;, line 353, in __iter__
11:41:14     self._state_handler.blocking_get(self._state_key, self._coder_impl))
11:41:14   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Cron/src/sdks/python/test-suites/tox/py36/build/srcs/sdks/python/apache_beam/runners/worker/sdk_worker.py&quot;&lt;/span&gt;, line 1184, in blocking_get
11:41:14     self._partially_cached_iterable(state_key, coder))
11:41:14   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Cron/src/sdks/python/test-suites/tox/py36/build/srcs/sdks/python/apache_beam/runners/worker/sdk_worker.py&quot;&lt;/span&gt;, line 1290, in _partially_cached_iterable
11:41:14     data, continuation_token = self._underlying.get_raw(state_key, None)
11:41:14   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Cron/src/sdks/python/test-suites/tox/py36/build/srcs/sdks/python/apache_beam/runners/worker/sdk_worker.py&quot;&lt;/span&gt;, line 1057, in get_raw
11:41:14     continuation_token=continuation_token)))
11:41:14   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Cron/src/sdks/python/test-suites/tox/py36/build/srcs/sdks/python/apache_beam/runners/worker/sdk_worker.py&quot;&lt;/span&gt;, line 1095, in _blocking_request
11:41:14     raise t(v).with_traceback(tb)
11:41:14 TypeError: __init__() missing 3 required positional arguments: &lt;span class=&quot;code-quote&quot;&gt;&apos;call&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;response_deserializer&apos;&lt;/span&gt;, and &lt;span class=&quot;code-quote&quot;&gt;&apos;deadline&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13389252">BEAM-12603</key>
            <summary>Flaky: apache_beam.runners.portability.fn_api_runner.fn_runner_test.FnApiRunnerTestWithGrpcAndMultiWorkers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tysonjh">Tyson Hamilton</reporter>
                        <labels>
                            <label>flake</label>
                    </labels>
                <created>Mon, 12 Jul 2021 22:31:17 +0000</created>
                <updated>Sat, 4 Jun 2022 21:35:19 +0000</updated>
                                                            <fixVersion>Not applicable</fixVersion>
                                    <component>sdk-py-core</component>
                    <component>test-failures</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="13800">3h 50m</timespent>
                                <comments>
                            <comment id="17379470" author="tysonjh" created="Mon, 12 Jul 2021 23:56:54 +0000"  >&lt;p&gt;It&apos;s difficult for me to tell why these jobs are failing, the logs are quite verbose.&lt;/p&gt;</comment>
                            <comment id="17380782" author="yichi" created="Wed, 14 Jul 2021 18:15:12 +0000"  >&lt;p&gt;I&apos;m trying to reproduce it locally but haven&apos;t been able to get the error.&lt;/p&gt;</comment>
                            <comment id="17399226" author="beamjirabot" created="Sat, 14 Aug 2021 17:22:11 +0000"  >&lt;p&gt;This issue is assigned but has not received an update in 30 days so it has been labeled &quot;stale-assigned&quot;. If you are still working on the issue, please give an update and remove the label. If you are no longer working on the issue, please unassign so someone else may work on it. In 7 days the issue will be automatically unassigned.&lt;/p&gt;</comment>
                            <comment id="17402663" author="beamjirabot" created="Sat, 21 Aug 2021 17:22:16 +0000"  >&lt;p&gt;This issue was marked &quot;stale-assigned&quot; and has not received a public comment in 7 days. It is now automatically unassigned. If you are still working on it, you can assign it to yourself again. Please also give an update about the status of the work.&lt;/p&gt;</comment>
                            <comment id="17412780" author="ibzib" created="Thu, 9 Sep 2021 18:54:48 +0000"  >&lt;p&gt;It looks like the error handling code is running into the same problem as &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-12794&quot; title=&quot;PortableRunnerTestWithExternalEnv.test_pardo_timers flaky&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-12794&quot;&gt;BEAM-12794&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17416222" author="altay" created="Thu, 16 Sep 2021 16:27:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yichi&quot; class=&quot;user-hover&quot; rel=&quot;yichi&quot;&gt;yichi&lt;/a&gt; - Could you look at this issue when you get a chance? Looks like an issue in the sdk_worker.&lt;/p&gt;</comment>
                            <comment id="17416273" author="yichi" created="Thu, 16 Sep 2021 17:48:43 +0000"  >&lt;p&gt;I&apos;ve looked at it before and couldn&apos;t get a repro, I think the issue is a transient failure in grpc networking on jenkins machine, as mentioned in &lt;a href=&quot;https://grpc.github.io/grpc/core/md_doc_statuscodes.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://grpc.github.io/grpc/core/md_doc_statuscodes.html&lt;/a&gt;&#160;status code 14. I guess the easy workaround is to add retry to this test suite that uses grpc.&#160;&lt;/p&gt;</comment>
                            <comment id="17529660" author="bhulette" created="Thu, 28 Apr 2022 20:59:23 +0000"  >&lt;p&gt;I think we should keep this open to identify the root cause and remove the retries. The cause of the flakes is likely a real issue that we&apos;re masking with the retries.&lt;/p&gt;</comment>
                            <comment id="17529663" author="yichi" created="Thu, 28 Apr 2022 21:19:04 +0000"  >&lt;p&gt;I agree that this is probably masking real issues currently, one possible improvement we can try is only retry on grpc networking issues. Or we somehow find out how to avoid this grpc issues.&lt;/p&gt;</comment>
                            <comment id="17530957" author="bhulette" created="Mon, 2 May 2022 22:13:42 +0000"  >&lt;p&gt;I did a little bit of investigation I&apos;ll summarize here:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Per &lt;a href=&quot;https://stackoverflow.com/questions/45668153/when-does-a-broken-pipe-occur-in-a-tcp-stream&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this SO&lt;/a&gt; broken pipe indicates the other end has closed the TCP connection. I suppose this indicates there&apos;s an issue on the runner side of this connection - for some reason closing the connection prematurely?&lt;/li&gt;
	&lt;li&gt;I&apos;m attempting to reproduce the issue locally and/or on Jenkins so we can investigate with that in mind:
	&lt;ul&gt;
		&lt;li&gt;Locally - Started exercising fn_runner_test with retries removed repeatedly until a failure occurs:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-bash&quot;&gt;
i=0; &lt;span class=&quot;code-object&quot;&gt;while&lt;/span&gt; python -m pytest apache_beam/runners/portability/fn_api_runner/fn_runner_test.py -n 12 -rFe; &lt;span class=&quot;code-object&quot;&gt;do&lt;/span&gt; i=$((i+1)); echo &lt;span class=&quot;code-quote-red&quot;&gt;&quot;FINISHED &lt;span class=&quot;code-object&quot;&gt;$i&lt;/span&gt; RUNS&quot;&lt;/span&gt;; &lt;span class=&quot;code-object&quot;&gt;done&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;On Jenkins - Put up WIP &lt;a href=&quot;https://github.com/apache/beam/pull/17528&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/17528&lt;/a&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17530959" author="bhulette" created="Mon, 2 May 2022 22:17:01 +0000"  >&lt;p&gt;After 18 local runs I got one relevant looking failure:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
------------------------------------------------ Captured log call -------------------------------------------------
WARNING  root:environments.py:371 Make sure that locally built Python SDK docker image has Python 3.8 interpreter.                                                                                                                      
ERROR    apache_beam.runners.worker.data_plane:data_plane.py:641 Failed to read inputs in the data plane.                                                                                                                               
Traceback (most recent call last):                                                                                                                                                                                                      
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/working_dir/beam/sdks/python/apache_beam/runners/worker/data_plane.py&quot;&lt;/span&gt;, line 634, in _read_inputs                                                                                               
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; elements in elements_iterator:                                                                                                                                                                                                  
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/.pyenv/versions/beam/lib/python3.8/site-packages/grpc/_channel.py&quot;&lt;/span&gt;, line 426, in __next__                                                                                                       
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; self._next()                                                                                                                                                                                                                 
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/.pyenv/versions/beam/lib/python3.8/site-packages/grpc/_channel.py&quot;&lt;/span&gt;, line 809, in _next                                                                                                          
    raise self                                                                                                                                                                                                                          
grpc._channel._MultiThreadedRendezvous: &amp;lt;_MultiThreadedRendezvous of RPC that terminated with:                                                                                                                                          
        status = StatusCode.UNAVAILABLE                                                                                                                                                                                                 
        details = &lt;span class=&quot;code-quote&quot;&gt;&quot;Broken pipe&quot;&lt;/span&gt;                                                                                     
        debug_error_string = &lt;span class=&quot;code-quote&quot;&gt;&quot;{&quot;&lt;/span&gt;created&lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;@1651529196.891387421&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;description&lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;Error received from peer ipv6:[::1]:34715&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;file&lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;src/core/lib/surface/call.cc&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;file_line&lt;span class=&quot;code-quote&quot;&gt;&quot;:903,&quot;&lt;/span&gt;grpc_message&lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;Broken pipe&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;grpc_status&lt;span class=&quot;code-quote&quot;&gt;&quot;:14}&quot;&lt;/span&gt;        
&amp;gt;                                                                                                                   
ERROR    apache_beam.runners.worker.sdk_worker:sdk_worker.py:271 Error processing instruction bundle_58. Original traceback is           
                                                                 Traceback (most recent call last):                 
                                                                   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/working_dir/beam/sdks/python/apache_beam/runners/worker/data_plane.py&quot;&lt;/span&gt;, line 487, in input_elements                            
                                                                     element = received.get(timeout=1)                                                                                                                                  
                                                                   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/.pyenv/versions/3.8.6/lib/python3.8/queue.py&quot;&lt;/span&gt;, line 178, in get                                                                
                                                                     raise Empty                                    
                                                                 _queue.Empty                                                                                                                                                           
                                                                                                                                                                                                                                        
                                                                 During handling of the above exception, another exception occurred:                                                                                                    
                                                                                                                                                                                                                                        
                                                                 Traceback (most recent call last):                 
                                                                   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/working_dir/beam/sdks/python/apache_beam/runners/worker/sdk_worker.py&quot;&lt;/span&gt;, line 267, in _execute                                  
                                                                     response = task()                                                                                                                                                  
                                                                   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/working_dir/beam/sdks/python/apache_beam/runners/worker/sdk_worker.py&quot;&lt;/span&gt;, line 340, in &amp;lt;lambda&amp;gt;                                  
                                                                     lambda: self.create_worker().do_instruction(request), request)                                                                                                     
                                                                   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/working_dir/beam/sdks/python/apache_beam/runners/worker/sdk_worker.py&quot;&lt;/span&gt;, line 580, in do_instruction                            
                                                                     &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getattr(self, request_type)(            
                                                                   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/working_dir/beam/sdks/python/apache_beam/runners/worker/sdk_worker.py&quot;&lt;/span&gt;, line 618, in process_bundle                            
                                                                     bundle_processor.process_bundle(instruction_id))                                                                                                                   
                                                                   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/working_dir/beam/sdks/python/apache_beam/runners/worker/bundle_processor.py&quot;&lt;/span&gt;, line 984, in process_bundle                      
                                                                     &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; element in data_channel.input_elements(instruction_id,                                                                                                         
                                                                   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/working_dir/beam/sdks/python/apache_beam/runners/worker/data_plane.py&quot;&lt;/span&gt;, line 490, in input_elements
                                                                     raise RuntimeError(&lt;span class=&quot;code-quote&quot;&gt;&apos;Channel closed prematurely.&apos;&lt;/span&gt;)                                                                                                                  
                                                                 RuntimeError: Channel closed prematurely.                                                                                                                              
============================================= &lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt; test summary info ==============================================
FAILED apache_beam/runners/portability/fn_api_runner/fn_runner_test.py::FnApiRunnerTestWithDisabledCaching::test_sdf_default_truncate_when_unbounded
================================ 1 failed, 336 passed, 40 skipped in 22.71 seconds =================================
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17530961" author="bhulette" created="Mon, 2 May 2022 22:28:48 +0000"  >&lt;p&gt;Got another local failure that looks like the originally posted one after 13 tries:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                                                                   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/.pyenv/versions/3.8.6/lib/python3.8/threading.py&quot;&lt;/span&gt;, line 932, in _bootstrap_inner
                                                                     self.run()
                                                                   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/.pyenv/versions/3.8.6/lib/python3.8/threading.py&quot;&lt;/span&gt;, line 870, in run
                                                                     self._target(*self._args, **self._kwargs)
                                                                   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/working_dir/beam/sdks/python/apache_beam/runners/worker/sdk_worker.py&quot;&lt;/span&gt;, line 990, in pull_responses
                                                                     &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; response in responses:
                                                                   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/.pyenv/versions/beam/lib/python3.8/site-packages/grpc/_channel.py&quot;&lt;/span&gt;, line 426, in __next__
                                                                     &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; self._next()
                                                                   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/.pyenv/versions/beam/lib/python3.8/site-packages/grpc/_channel.py&quot;&lt;/span&gt;, line 809, in _next
                                                                     raise self
                                                                 RuntimeError: grpc._channel._MultiThreadedRendezvous: &amp;lt;_MultiThreadedRendezvous of RPC that terminated with:
                                                                        status = StatusCode.UNAVAILABLE
                                                                        details = &lt;span class=&quot;code-quote&quot;&gt;&quot;Broken pipe&quot;&lt;/span&gt;
                                                                        debug_error_string = &lt;span class=&quot;code-quote&quot;&gt;&quot;{&quot;&lt;/span&gt;created&lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;@1651530177.250911467&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;description&lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;Error received from peer ipv6:[::1]:46355&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;file&lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;src/core/lib/surface/call.cc&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;file_line&lt;span class=&quot;code-quote&quot;&gt;&quot;:903,&quot;&lt;/span&gt;grpc_message&lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;Broken pipe&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;grpc_status&lt;span class=&quot;code-quote&quot;&gt;&quot;:14}&quot;&lt;/span&gt;
                                                                 &amp;gt; [&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; running &lt;span class=&quot;code-quote&quot;&gt;&apos;ParDo(TimerDoFn)&apos;&lt;/span&gt;]
============================================= &lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt; test summary info ==============================================
FAILED apache_beam/runners/portability/fn_api_runner/fn_runner_test.py::FnApiRunnerTestWithGrpcAndMultiWorkers::test_pardo_timers
================================ 1 failed, 336 passed, 40 skipped in 23.01 seconds =================================
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17530966" author="bhulette" created="Mon, 2 May 2022 23:08:56 +0000"  >&lt;p&gt;another failure, this time with debug logging enabled (&lt;tt&gt;i=0; while python -m pytest apache_beam/runners/portability/fn_api_runner/fn_runner_test.py -n 12 -rFe --log-level=DEBUG; do i=$((i+1)); echo &quot;FINISHED $i RUNS&quot;; done&lt;/tt&gt;)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
...
INFO     apache_beam.runners.portability.fn_api_runner.translations:translations.py:714 ==================== &amp;lt;function populate_data_channel_coders at 0x7f79f3c39700&amp;gt; ====================                                             
DEBUG    apache_beam.runners.portability.fn_api_runner.translations:translations.py:716 5 [6, 5, 10, 2, 5]                                                                                                                              
DEBUG    apache_beam.runners.portability.fn_api_runner.translations:translations.py:717 Stages: [&apos;(((((ref_AppliedPTransform_assert_that-Create-Impulse_17)+(ref_AppliedPTransform_assert_that-Create-FlatMap-lambda-at-core-py-3320-_18
))+(ref_AppliedPTransform_assert_that-Create-Map-decode-_20))+(ref_AppliedPTransform_assert_that-Group-CoGroupByKeyImpl-Tag-0-_25))+(assert_that/Group/CoGroupByKeyImpl/Flatten/Transcode/0))+(assert_that/Group/CoGroupByKeyImpl/Flatte
n/Write/0)\n  assert_that/Create/FlatMap(&amp;lt;lambda at core.py:3320&amp;gt;):beam:transform:pardo:v1\nassert_that/Create/Map(decode):beam:transform:pardo:v1\nassert_that/Group/CoGroupByKeyImpl/Tag[0]:beam:transform:pardo:v1\nassert_that/Group
/CoGroupByKeyImpl/Flatten/Transcode/0:beam:transform:flatten:v1\nassert_that/Group/CoGroupByKeyImpl/Flatten/Write/0:beam:runner:sink:v1\nassert_that/Create/Impulse:beam:runner:source:v1\n  must follow: \n  downstream_side_inputs: &apos;,
 &apos;((((ref_AppliedPTransform_Create-Impulse_3)+(ref_AppliedPTransform_Create-FlatMap-lambda-at-core-py-3320-_4))+(ref_AppliedPTransform_Create-MaybeReshuffle-Reshuffle-AddRandomKeys_7))+(ref_AppliedPTransform_Create-MaybeReshuffle-Re
shuffle-ReshufflePerKey-Map-reify_timestamps-_9))+(Create/MaybeReshuffle/Reshuffle/ReshufflePerKey/GroupByKey/Write)\n  Create/FlatMap(&amp;lt;lambda at core.py:3320&amp;gt;):beam:transform:pardo:v1\nCreate/MaybeReshuffle/Reshuffle/AddRandomKeys:
beam:transform:pardo:v1\nCreate/MaybeReshuffle/Reshuffle/ReshufflePerKey/Map(reify_timestamps):beam:transform:pardo:v1\nCreate/MaybeReshuffle/Reshuffle/ReshufflePerKey/GroupByKey/Write:beam:runner:sink:v1\nCreate/Impulse:beam:runner
:source:v1\n  must follow: \n  downstream_side_inputs: &lt;span class=&quot;code-quote&quot;&gt;&apos;, &apos;&lt;/span&gt;(((((((((Create/MaybeReshuffle/Reshuffle/ReshufflePerKey/GroupByKey/Read)+(ref_AppliedPTransform_Create-MaybeReshuffle-Reshuffle-ReshufflePerKey-FlatMap-restore_timestamps-_
11))+(ref_AppliedPTransform_Create-MaybeReshuffle-Reshuffle-RemoveRandomKeys_12))+(ref_AppliedPTransform_Create-Map-decode-_13))+(ref_AppliedPTransform_ParDo-DynamicTimerDoFn-_14))+(ref_AppliedPTransform_assert_that-WindowInto-Windo
wIntoFn-_21))+(ref_AppliedPTransform_assert_that-ToVoidKey_22))+(ref_AppliedPTransform_assert_that-Group-CoGroupByKeyImpl-Tag-1-_26))+(assert_that/Group/CoGroupByKeyImpl/Flatten/Transcode/1))+(assert_that/Group/CoGroupByKeyImpl/Flat
ten/Write/1)\n  Create/MaybeReshuffle/Reshuffle/ReshufflePerKey/GroupByKey/Read:beam:runner:source:v1\nCreate/MaybeReshuffle/Reshuffle/ReshufflePerKey/FlatMap(restore_timestamps):beam:transform:pardo:v1\nCreate/MaybeReshuffle/Reshuf
fle/RemoveRandomKeys:beam:transform:pardo:v1\nCreate/Map(decode):beam:transform:pardo:v1\nParDo(DynamicTimerDoFn):beam:transform:pardo:v1\nassert_that/WindowInto(WindowIntoFn):beam:transform:window_into:v1\nassert_that/ToVoidKey:bea
m:transform:pardo:v1\nassert_that/Group/CoGroupByKeyImpl/Tag[1]:beam:transform:pardo:v1\nassert_that/Group/CoGroupByKeyImpl/Flatten/Transcode/1:beam:transform:flatten:v1\nassert_that/Group/CoGroupByKeyImpl/Flatten/Write/1:beam:runne
r:sink:v1\n  must follow: ((((ref_AppliedPTransform_Create-Impulse_3)+(ref_AppliedPTransform_Create-FlatMap-lambda-at-core-py-3320-_4))+(ref_AppliedPTransform_Create-MaybeReshuffle-Reshuffle-AddRandomKeys_7))+(ref_AppliedPTransform_
Create-MaybeReshuffle-Reshuffle-ReshufflePerKey-Map-reify_timestamps-_9))+(Create/MaybeReshuffle/Reshuffle/ReshufflePerKey/GroupByKey/Write)\n  downstream_side_inputs: &lt;span class=&quot;code-quote&quot;&gt;&apos;, &apos;&lt;/span&gt;(assert_that/Group/CoGroupByKeyImpl/Flatten/Read)+(assert_th
at/Group/CoGroupByKeyImpl/GroupByKey/Write)\n  assert_that/Group/CoGroupByKeyImpl/Flatten/Read:beam:runner:source:v1\nassert_that/Group/CoGroupByKeyImpl/GroupByKey/Write:beam:runner:sink:v1\n  must follow: (((((((((Create/MaybeReshu
ffle/Reshuffle/ReshufflePerKey/GroupByKey/Read)+(ref_AppliedPTransform_Create-MaybeReshuffle-Reshuffle-ReshufflePerKey-FlatMap-restore_timestamps-_11))+(ref_AppliedPTransform_Create-MaybeReshuffle-Reshuffle-RemoveRandomKeys_12))+(re
f_AppliedPTransform_Create-Map-decode-_13))+(ref_AppliedPTransform_ParDo-DynamicTimerDoFn-_14))+(ref_AppliedPTransform_assert_that-WindowInto-WindowIntoFn-_21))+(ref_AppliedPTransform_assert_that-ToVoidKey_22))+(ref_AppliedPTransfor
m_assert_that-Group-CoGroupByKeyImpl-Tag-1-_26))+(assert_that/Group/CoGroupByKeyImpl/Flatten/Transcode/1))+(assert_that/Group/CoGroupByKeyImpl/Flatten/Write/1), (((((ref_AppliedPTransform_assert_that-Create-Impulse_17)+(ref_AppliedP
Transform_assert_that-Create-FlatMap-lambda-at-core-py-3320-_18))+(ref_AppliedPTransform_assert_that-Create-Map-decode-_20))+(ref_AppliedPTransform_assert_that-Group-CoGroupByKeyImpl-Tag-0-_25))+(assert_that/Group/CoGroupByKeyImpl/F
latten/Transcode/0))+(assert_that/Group/CoGroupByKeyImpl/Flatten/Write/0)\n  downstream_side_inputs: &lt;span class=&quot;code-quote&quot;&gt;&apos;, &apos;&lt;/span&gt;((((assert_that/Group/CoGroupByKeyImpl/GroupByKey/Read)+(ref_AppliedPTransform_assert_that-Group-CoGroupByKeyImpl-MapTuple-coll
ect_values-_29))+(ref_AppliedPTransform_assert_that-Group-RestoreTags_30))+(ref_AppliedPTransform_assert_that-Unkey_31))+(ref_AppliedPTransform_assert_that-Match_32)\n  assert_that/Group/CoGroupByKeyImpl/GroupByKey/Read:beam:runner:
source:v1\nassert_that/Group/CoGroupByKeyImpl/MapTuple(collect_values):beam:transform:pardo:v1\nassert_that/Group/RestoreTags:beam:transform:pardo:v1\nassert_that/Unkey:beam:transform:pardo:v1\nassert_that/Match:beam:transform:pardo
:v1\n  must follow: (assert_that/Group/CoGroupByKeyImpl/Flatten/Read)+(assert_that/Group/CoGroupByKeyImpl/GroupByKey/Write)\n  downstream_side_inputs: &apos;]
INFO     apache_beam.runners.portability.fn_api_runner.worker_handlers:worker_handlers.py:521 starting control server on port 38143
INFO     apache_beam.runners.portability.fn_api_runner.worker_handlers:worker_handlers.py:522 starting data server on port 36255                                                                                                        INFO     apache_beam.runners.portability.fn_api_runner.worker_handlers:worker_handlers.py:523 starting state server on port 44945
INFO     apache_beam.runners.portability.fn_api_runner.worker_handlers:worker_handlers.py:524 starting logging server on port 34943
INFO     apache_beam.runners.portability.fn_api_runner.worker_handlers:worker_handlers.py:889 Created Worker handler &amp;lt;apache_beam.runners.portability.fn_api_runner.worker_handlers.EmbeddedGrpcWorkerHandler object at 0x7f79f087d460&amp;gt; 
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; environment ref_Environment_default_environment_1 (beam:env:embedded_python_grpc:v1, b&lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;state_cache_size&quot;&lt;/span&gt;: 0, &lt;span class=&quot;code-quote&quot;&gt;&quot;data_buffer_time_limit_ms&quot;&lt;/span&gt;: 0}&apos;&lt;/span&gt;)                                                        
INFO     apache_beam.runners.worker.statecache:statecache.py:172 Creating state cache with size 100   
INFO     apache_beam.runners.worker.sdk_worker:sdk_worker.py:164 Creating insecure control channel &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; localhost:38143.                                                 
INFO     apache_beam.runners.worker.sdk_worker:sdk_worker.py:172 Control channel established.
INFO     apache_beam.runners.worker.sdk_worker:sdk_worker.py:215 Initializing SDKHarness with unbounded number of workers.
DEBUG    apache_beam.runners.portability.fn_api_runner.execution:execution.py:847 Scheduling bundle in stage &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; execution: (((((ref_AppliedPTransform_assert_that-Create-Impulse_17)+(ref_AppliedPTransform_assert_that-Create-FlatMap-
lambda-at-core-py-3320-_18))+(ref_AppliedPTransform_assert_that-Create-Map-decode-_20))+(ref_AppliedPTransform_assert_that-Group-CoGroupByKeyImpl-Tag-0-_25))+(assert_that/Group/CoGroupByKeyImpl/Flatten/Transcode/0))+(assert_that/Gro
up/CoGroupByKeyImpl/Flatten/Write/0)                                                                                
DEBUG    apache_beam.runners.portability.fn_api_runner.execution:execution.py:847 Scheduling bundle in stage &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; execution: ((((ref_AppliedPTransform_Create-Impulse_3)+(ref_AppliedPTransform_Create-FlatMap-lambda-at-core-py-3320-_4)
)+(ref_AppliedPTransform_Create-MaybeReshuffle-Reshuffle-AddRandomKeys_7))+(ref_AppliedPTransform_Create-MaybeReshuffle-Reshuffle-ReshufflePerKey-Map-reify_timestamps-_9))+(Create/MaybeReshuffle/Reshuffle/ReshufflePerKey/GroupByKey/
Write)                                                                                                              
DEBUG    apache_beam.runners.portability.fn_api_runner.fn_runner:fn_runner.py:388 Remaining ready bundles: 2                                                                                                                            
                                                                                        Watermark pending bundles: 0                                                                                                                    
                                                                                        Time pending bundles: 0                                                                                                                         
DEBUG    apache_beam.runners.portability.fn_api_runner.fn_runner.run_bundle:fn_runner.py:400 Running bundle &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; stage (((((ref_AppliedPTransform_assert_that-Create-Impulse_17)+(ref_AppliedPTransform_assert_that-Create-FlatMap-lambda
-at-core-py-3320-_18))+(ref_AppliedPTransform_assert_that-Create-Map-decode-_20))+(ref_AppliedPTransform_assert_that-Group-CoGroupByKeyImpl-Tag-0-_25))+(assert_that/Group/CoGroupByKeyImpl/Flatten/Transcode/0))+(assert_that/Group/CoG
roupByKeyImpl/Flatten/Write/0)                                                                                                                                                                                                          
                                                                                                Expected outputs: {&lt;span class=&quot;code-quote&quot;&gt;&apos;assert_that/Group/CoGroupByKeyImpl/Flatten/Write/0&apos;&lt;/span&gt;: b&lt;span class=&quot;code-quote&quot;&gt;&apos;materialize:assert_that/Group/CoGroupByKeyImpl/Flatten&apos;&lt;/span&gt;} time
rs: {}                                                                                                                                                                                                                                  
DEBUG    apache_beam.runners.worker.sdk_worker:sdk_worker.py:235 Got work bundle_98                                                                                                                                                     
DEBUG    apache_beam.runners.worker.sdk_worker:sdk_worker.py:343 Currently using 5 threads.                                                                                                                                             
INFO     apache_beam.runners.worker.sdk_worker:sdk_worker.py:840 Creating insecure state channel &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; localhost:44945.
INFO     apache_beam.runners.worker.sdk_worker:sdk_worker.py:847 State channel established.
INFO     apache_beam.runners.worker.data_plane:data_plane.py:750 Creating client data channel &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; localhost:36255
ERROR    apache_beam.runners.worker.data_plane:data_plane.py:641 Failed to read inputs in the data plane.                                                                                                                               
Traceback (most recent call last):                                                                                  
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/working_dir/beam/sdks/python/apache_beam/runners/worker/data_plane.py&quot;&lt;/span&gt;, line 634, in _read_inputs
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; elements in elements_iterator:                                                                              
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/.pyenv/versions/beam/lib/python3.8/site-packages/grpc/_channel.py&quot;&lt;/span&gt;, line 426, in __next__                
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; self._next()                                                                                             
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/.pyenv/versions/beam/lib/python3.8/site-packages/grpc/_channel.py&quot;&lt;/span&gt;, line 809, in _next      
    raise self                                                                                                      
grpc._channel._MultiThreadedRendezvous: &amp;lt;_MultiThreadedRendezvous of RPC that terminated with:
        status = StatusCode.UNAVAILABLE                                                                                                                                                                                                 
        details = &lt;span class=&quot;code-quote&quot;&gt;&quot;Broken pipe&quot;&lt;/span&gt;                                                                                                                                                                                                         
        debug_error_string = &lt;span class=&quot;code-quote&quot;&gt;&quot;{&quot;&lt;/span&gt;created&lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;@1651531867.131513924&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;description&lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;Error received from peer ipv6:[::1]:36255&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;file&lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;src/core/lib/surface/call.cc&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;file_line&lt;span class=&quot;code-quote&quot;&gt;&quot;:903,&quot;&lt;/span&gt;grpc_message&lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;Broken pipe&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;grpc_status&lt;span class=&quot;code-quote&quot;&gt;&quot;:14}&quot;&lt;/span&gt;
&amp;gt;  
DEBUG    apache_beam.runners.worker.bundle_processor:bundle_processor.py:951 start &amp;lt;DataOutputOperation assert_that/Group/CoGroupByKeyImpl/Flatten/Write/0 &amp;gt;
DEBUG    apache_beam.runners.worker.bundle_processor:bundle_processor.py:951 start &amp;lt;FlattenOperation assert_that/Group/CoGroupByKeyImpl/Flatten/Transcode/0 receivers=[SingletonConsumerSet[assert_that/Group/CoGroupByKeyImpl/Flatten/Transcode/0.out0, coder=WindowedValueCoder[TupleCoder[LengthPrefixCoder[DeterministicFastPrimitivesCoder], LengthPrefixCoder[FastPrimitivesCoder]]], len(consumers)=1]]&amp;gt;
DEBUG    apache_beam.runners.worker.bundle_processor:bundle_processor.py:951 start &amp;lt;DoOperation assert_that/Group/CoGroupByKeyImpl/Tag[0] output_tags=[&lt;span class=&quot;code-quote&quot;&gt;&apos;None&apos;&lt;/span&gt;], receivers=[SingletonConsumerSet[assert_that/Group/CoGroupByKeyImpl/Tag[0].out0, coder=WindowedValueCoder[TupleCoder[FastPrimitivesCoder, TupleCoder[StrUtf8Coder, FastPrimitivesCoder]]], len(consumers)=1]]&amp;gt;
DEBUG    apache_beam.runners.worker.bundle_processor:bundle_processor.py:951 start &amp;lt;DoOperation assert_that/Create/Map(decode) output_tags=[&lt;span class=&quot;code-quote&quot;&gt;&apos;None&apos;&lt;/span&gt;], receivers=[SingletonConsumerSet[assert_that/Create/Map(decode).out0, coder=WindowedValueCoder[TupleCoder[FastPrimitivesCoder, FastPrimitivesCoder]], len(consumers)=1]]&amp;gt;
DEBUG    apache_beam.runners.worker.bundle_processor:bundle_processor.py:951 start &amp;lt;DoOperation assert_that/Create/FlatMap(&amp;lt;lambda at core.py:3320&amp;gt;) output_tags=[&lt;span class=&quot;code-quote&quot;&gt;&apos;None&apos;&lt;/span&gt;], receivers=[SingletonConsumerSet[assert_that/Create/FlatMap(&amp;lt;lambda at core.py:3320&amp;gt;).out0, coder=WindowedValueCoder[BytesCoder], len(consumers)=1]]&amp;gt;
DEBUG    apache_beam.runners.worker.bundle_processor:bundle_processor.py:951 start &amp;lt;DataInputOperation assert_that/Create/Impulse receivers=[SingletonConsumerSet[assert_that/Create/Impulse.out0, coder=WindowedValueCoder[BytesCoder], len(consumers)=1]]&amp;gt;
ERROR    apache_beam.runners.worker.sdk_worker:sdk_worker.py:271 Error processing instruction bundle_98. Original traceback is
                                                                 Traceback (most recent call last):
                                                                   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/working_dir/beam/sdks/python/apache_beam/runners/worker/data_plane.py&quot;&lt;/span&gt;, line 487, in input_elements
                                                                     element = received.get(timeout=1)
                                                                   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/.pyenv/versions/3.8.6/lib/python3.8/queue.py&quot;&lt;/span&gt;, line 178, in get
                                                                     raise Empty
                                                                 _queue.Empty
                                                                 
                                                                 During handling of the above exception, another exception occurred:
                                                                 
                                                                 Traceback (most recent call last):
                                                                   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/working_dir/beam/sdks/python/apache_beam/runners/worker/sdk_worker.py&quot;&lt;/span&gt;, line 267, in _execute
                                                                     response = task()
                                                                   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/working_dir/beam/sdks/python/apache_beam/runners/worker/sdk_worker.py&quot;&lt;/span&gt;, line 340, in &amp;lt;lambda&amp;gt;
                                                                     lambda: self.create_worker().do_instruction(request), request)
                                                                   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/working_dir/beam/sdks/python/apache_beam/runners/worker/sdk_worker.py&quot;&lt;/span&gt;, line 580, in do_instruction
                                                                     &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getattr(self, request_type)(
                                                                   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/working_dir/beam/sdks/python/apache_beam/runners/worker/sdk_worker.py&quot;&lt;/span&gt;, line 618, in process_bundle
                                                                     bundle_processor.process_bundle(instruction_id))
                                                                   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/working_dir/beam/sdks/python/apache_beam/runners/worker/bundle_processor.py&quot;&lt;/span&gt;, line 984, in process_bundle
                                                                     &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; element in data_channel.input_elements(instruction_id,
                                                                   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/google/home/bhulette/working_dir/beam/sdks/python/apache_beam/runners/worker/data_plane.py&quot;&lt;/span&gt;, line 490, in input_elements
                                                                     raise RuntimeError(&lt;span class=&quot;code-quote&quot;&gt;&apos;Channel closed prematurely.&apos;&lt;/span&gt;)
                                                                 RuntimeError: Channel closed prematurely.
                                                                 
INFO     apache_beam.runners.worker.sdk_worker:sdk_worker.py:244 No more requests from control plane
INFO     apache_beam.runners.worker.sdk_worker:sdk_worker.py:245 SDK Harness waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; in-flight requests to complete
INFO     apache_beam.runners.worker.data_plane:data_plane.py:782 Closing all cached grpc data channels.
INFO     apache_beam.runners.worker.sdk_worker:sdk_worker.py:859 Closing all cached gRPC state handlers.
INFO     apache_beam.runners.worker.sdk_worker:sdk_worker.py:257 Done consuming work.
DEBUG    apache_beam.runners.portability.fn_api_runner.worker_handlers:worker_handlers.py:232 Runner: Requests sent by runner: [(&lt;span class=&quot;code-quote&quot;&gt;&apos;bundle_98&apos;&lt;/span&gt;, 1)]
============================================= &lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt; test summary info ==============================================
FAILED apache_beam/runners/portability/fn_api_runner/fn_runner_test.py::FnApiRunnerTestWithDisabledCaching::test_pardo_dynamic_timer
================================ 1 failed, 336 passed, 40 skipped in 24.82 seconds =================================
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17530968" author="bhulette" created="Mon, 2 May 2022 23:21:26 +0000"  >&lt;p&gt;Unfortunately I can&apos;t glean anything particularly useful from that debug log. What&apos;s interesting is that the gRPC channels were &lt;em&gt;just&lt;/em&gt; created, it seems to be one the very first bundle where the &quot;Broken Pipe&quot; occurred. &lt;/p&gt;

&lt;p&gt;For reference, I capture a portion of this sequence from a passing test:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
INFO     apache_beam.runners.portability.fn_api_runner.worker_handlers:worker_handlers.py:521 starting control server on port 46845                                                                                                     
INFO     apache_beam.runners.portability.fn_api_runner.worker_handlers:worker_handlers.py:522 starting data server on port 45973                                                                                                        
INFO     apache_beam.runners.portability.fn_api_runner.worker_handlers:worker_handlers.py:523 starting state server on port 42855                                                                                                       
INFO     apache_beam.runners.portability.fn_api_runner.worker_handlers:worker_handlers.py:524 starting logging server on port 33253                                                                                                     
INFO     apache_beam.runners.portability.fn_api_runner.worker_handlers:worker_handlers.py:889 Created Worker handler &amp;lt;apache_beam.runners.portability.fn_api_runner.worker_handlers.EmbeddedGrpcWorkerHandler object at 0x7f43757685b0&amp;gt; 
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; environment ref_Environment_default_environment_1 (beam:env:embedded_python_grpc:v1, b&lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;state_cache_size&quot;&lt;/span&gt;: 0, &lt;span class=&quot;code-quote&quot;&gt;&quot;data_buffer_time_limit_ms&quot;&lt;/span&gt;: 0}&apos;&lt;/span&gt;)                                                                                    
INFO     apache_beam.runners.worker.statecache:statecache.py:172 Creating state cache with size 100                                                                                                                                     
INFO     apache_beam.runners.worker.sdk_worker:sdk_worker.py:164 Creating insecure control channel &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; localhost:46845.                                                                                                                 INFO     apache_beam.runners.worker.sdk_worker:sdk_worker.py:172 Control channel established.                                                                                                                                           
INFO     apache_beam.runners.worker.sdk_worker:sdk_worker.py:215 Initializing SDKHarness with unbounded number of workers.                                                                                                              DEBUG    apache_beam.runners.portability.fn_api_runner.execution:execution.py:847 Scheduling bundle in stage &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; execution: ((((ref_AppliedPTransform_Create-Impulse_3)+(ref_AppliedPTransform_Create-FlatMap-lambda-at-core-py-3320-_4)
)+(ref_AppliedPTransform_Create-MaybeReshuffle-Reshuffle-AddRandomKeys_7))+(ref_AppliedPTransform_Create-MaybeReshuffle-Reshuffle-ReshufflePerKey-Map-reify_timestamps-_9))+(Create/MaybeReshuffle/Reshuffle/ReshufflePerKey/GroupByKey/Write)                                                                                                                                                                                                                                  
DEBUG    apache_beam.runners.portability.fn_api_runner.execution:execution.py:847 Scheduling bundle in stage &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; execution: (((((ref_AppliedPTransform_assert_that-Create-Impulse_17)+(ref_AppliedPTransform_assert_that-Create-FlatMap-lambda-at-core-py-3320-_18))+(ref_AppliedPTransform_assert_that-Create-Map-decode-_20))+(ref_AppliedPTransform_assert_that-Group-CoGroupByKeyImpl-Tag-0-_25))+(assert_that/Group/CoGroupByKeyImpl/Flatten/Transcode/0))+(assert_that/Gro
up/CoGroupByKeyImpl/Flatten/Write/0)                                                                                                                                                                                                    DEBUG    apache_beam.runners.portability.fn_api_runner.fn_runner:fn_runner.py:388 Remaining ready bundles: 2                                                                                                                            
                                                                                        Watermark pending bundles: 0                                                                                                                                                                                                            Time pending bundles: 0                                                                                                                         
DEBUG    apache_beam.runners.portability.fn_api_runner.fn_runner.run_bundle:fn_runner.py:400 Running bundle &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; stage ((((ref_AppliedPTransform_Create-Impulse_3)+(ref_AppliedPTransform_Create-FlatMap-lambda-at-core-py-3320-_4))+(ref
_AppliedPTransform_Create-MaybeReshuffle-Reshuffle-AddRandomKeys_7))+(ref_AppliedPTransform_Create-MaybeReshuffle-Reshuffle-ReshufflePerKey-Map-reify_timestamps-_9))+(Create/MaybeReshuffle/Reshuffle/ReshufflePerKey/GroupByKey/Write)
                                                                                                Expected outputs: {&lt;span class=&quot;code-quote&quot;&gt;&apos;Create/MaybeReshuffle/Reshuffle/ReshufflePerKey/GroupByKey/Write&apos;&lt;/span&gt;: b&apos;group:ref_AppliedPTransform_Create-MaybeReshuff
le-Reshuffle-ReshufflePerKey-GroupByKey_10&apos;} timers: {}                                                                                                                                                                                 
DEBUG    apache_beam.runners.worker.sdk_worker:sdk_worker.py:235 Got work bundle_1
DEBUG    apache_beam.runners.worker.sdk_worker:sdk_worker.py:343 Currently using 2 threads.
INFO     apache_beam.runners.worker.sdk_worker:sdk_worker.py:840 Creating insecure state channel &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; localhost:42855.
INFO     apache_beam.runners.worker.sdk_worker:sdk_worker.py:847 State channel established.
INFO     apache_beam.runners.worker.data_plane:data_plane.py:750 Creating client data channel &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; localhost:45973
DEBUG    apache_beam.runners.worker.bundle_processor:bundle_processor.py:951 start &amp;lt;DataOutputOperation Create/MaybeReshuffle/Reshuffle/ReshufflePerKey/GroupByKey/Write &amp;gt;
DEBUG    apache_beam.runners.worker.bundle_processor:bundle_processor.py:951 start &amp;lt;DoOperation Create/MaybeReshuffle/Reshuffle/ReshufflePerKey/Map(reify_timestamps) output_tags=[&lt;span class=&quot;code-quote&quot;&gt;&apos;None&apos;&lt;/span&gt;], receivers=[SingletonConsumerSet[Create/Maybe
Reshuffle/Reshuffle/ReshufflePerKey/Map(reify_timestamps).out0, coder=WindowedValueCoder[TupleCoder[LengthPrefixCoder[DeterministicFastPrimitivesCoder], LengthPrefixCoder[FastPrimitivesCoder]]], len(consumers)=1]]&amp;gt;
DEBUG    apache_beam.runners.worker.bundle_processor:bundle_processor.py:951 start &amp;lt;DoOperation Create/MaybeReshuffle/Reshuffle/AddRandomKeys output_tags=[&lt;span class=&quot;code-quote&quot;&gt;&apos;None&apos;&lt;/span&gt;], receivers=[SingletonConsumerSet[Create/MaybeReshuffle/Reshuffle/AddR
andomKeys.out0, coder=WindowedValueCoder[TupleCoder[VarIntCoder, BytesCoder]], len(consumers)=1]]&amp;gt;
DEBUG    apache_beam.runners.worker.bundle_processor:bundle_processor.py:951 start &amp;lt;DoOperation Create/FlatMap(&amp;lt;lambda at core.py:3320&amp;gt;) output_tags=[&lt;span class=&quot;code-quote&quot;&gt;&apos;None&apos;&lt;/span&gt;], receivers=[SingletonConsumerSet[Create/FlatMap(&amp;lt;lambda at core.py:3320&amp;gt;).
out0, coder=WindowedValueCoder[BytesCoder], len(consumers)=1]]&amp;gt;
DEBUG    apache_beam.runners.worker.bundle_processor:bundle_processor.py:951 start &amp;lt;DataInputOperation Create/Impulse receivers=[SingletonConsumerSet[Create/Impulse.out0, coder=WindowedValueCoder[BytesCoder], len(consumers)=1]]&amp;gt;
DEBUG    apache_beam.runners.worker.bundle_processor:bundle_processor.py:1000 finish &amp;lt;DataInputOperation Create/Impulse receivers=[SingletonConsumerSet[Create/Impulse.out0, coder=WindowedValueCoder[BytesCoder], len(consumers)=1]]&amp;gt;
DEBUG    apache_beam.runners.worker.bundle_processor:bundle_processor.py:1000 finish &amp;lt;DoOperation Create/FlatMap(&amp;lt;lambda at core.py:3320&amp;gt;) output_tags=[&lt;span class=&quot;code-quote&quot;&gt;&apos;None&apos;&lt;/span&gt;], receivers=[SingletonConsumerSet[Create/FlatMap(&amp;lt;lambda at core.py:3320&amp;gt;
).out0, coder=WindowedValueCoder[BytesCoder], len(consumers)=1]]&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17531281" author="bhulette" created="Tue, 3 May 2022 16:23:24 +0000"  >&lt;p&gt;Re-opening this. Action is to investigate the Broken Pipe failures and if possible fix them and remove the retries in fn_runner_test.py&lt;/p&gt;</comment>
                            <comment id="17549529" author="JIRAUSER282469" created="Sat, 4 Jun 2022 21:35:19 +0000"  >&lt;p&gt;This issue has been migrated to &lt;a href=&quot;https://github.com/apache/beam/issues/21104&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/issues/21104&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 23 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0svpk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>