<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:12:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-10481] MetricsAccumulator is not registering when resuming from a checkpoint</title>
                <link>https://issues.apache.org/jira/browse/BEAM-10481</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I am running in an beam application in streaming mode with jobName and checkPointDir configured. When I recover application from a planned stop, I am getting failure.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I did some investigation and noticed that the accumulator is not getting registered on recovering checkpoint scenario.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Correct me if I am wrong. If you see the code in the screenshot below from MetricsAccumulator class on beam v2.22.0, you can see new instance of MetricsContainerStepMapAccumulator is getting registered on line#64. But if a recovered value is present, it constructs a new instance with the recovered value (Line#78). But this new accumulator instance is not getting registered. This is forcing Spark Driver to throw exception: &#160;&lt;em&gt;java.lang.UnsupportedOperationException: Accumulator must be registered before send to executor&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&#160; &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13007612/13007612_image-2020-07-14-10-55-11-855.png&quot; height=&quot;351&quot; width=&quot;706&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13316661">BEAM-10481</key>
            <summary>MetricsAccumulator is not registering when resuming from a checkpoint</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tclemons">Tim Clemons</assignee>
                                    <reporter username="manikolbe">Mani Kolbe</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Jul 2020 09:53:32 +0000</created>
                <updated>Sat, 15 May 2021 18:01:17 +0000</updated>
                            <resolved>Sat, 15 May 2021 18:01:17 +0000</resolved>
                                    <version>2.22.0</version>
                                    <fixVersion>2.26.0</fixVersion>
                                    <component>runner-spark</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="17400">4h 50m</timespent>
                                <comments>
                            <comment id="17159354" author="aromanenko" created="Thu, 16 Jul 2020 17:02:13 +0000"  >&lt;p&gt;Thanks for reporting. It&apos;s strange since we have a &lt;a href=&quot;https://ci-beam.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Spark/lastCompletedBuild/testReport/org.apache.beam.runners.spark.translation.streaming/ResumeFromCheckpointStreamingTest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dedicated test &lt;/a&gt; for SparkRunner on this but it doesn&apos;t fail.&lt;/p&gt;</comment>
                            <comment id="17159390" author="aromanenko" created="Thu, 16 Jul 2020 18:16:42 +0000"  >&lt;p&gt;I guess this test could be not very correct since after the first run (it does two) it removes checkpoint directory and it still passes.&lt;/p&gt;</comment>
                            <comment id="17195718" author="tclemons" created="Mon, 14 Sep 2020 19:53:45 +0000"  >&lt;p&gt;Any workaround for this issue?&#160; We&apos;re experiencing this as well, even with setting &lt;tt&gt;--enableSparkMetricSinks=false&lt;/tt&gt;.&#160; We do need checkpoint directories for our streaming application.&lt;/p&gt;</comment>
                            <comment id="17197948" author="tclemons" created="Thu, 17 Sep 2020 20:56:20 +0000"  >&lt;p&gt;The workaround appears to be removing the &lt;tt&gt;beam-checkpoint&lt;/tt&gt; sub-directory before each launch of the application.&#160; In the meantime, I&apos;ve also submitted a pull request that should ensure registration of the accumulators occur.&lt;/p&gt;</comment>
                            <comment id="17345522" author="kenn" created="Sat, 15 May 2021 18:01:17 +0000"  >&lt;p&gt;Hello! Due to a bug in our Jira configuration, this issue had status:Resolved but resolution:Unresolved.&lt;/p&gt;

&lt;p&gt;I am bulk editing these issues to have resolution:Fixed&lt;/p&gt;

&lt;p&gt;If a different resolution is appropriate, please change it. To do this, click the &quot;Resolve&quot; button (you can do this even for closed issues) and set the Resolution field to the right value.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13007612" name="image-2020-07-14-10-55-11-855.png" size="199667" author="manikolbe" created="Tue, 14 Jul 2020 09:55:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 26 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0gqm0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>