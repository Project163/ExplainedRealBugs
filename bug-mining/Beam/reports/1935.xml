<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:10:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-7014] Flake in gcsio.py / filesystemio.py - NotImplementedError: offset: 0, whence: 0</title>
                <link>https://issues.apache.org/jira/browse/BEAM-7014</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;The flake was observed in Precommit Direct Runner IT (wordcount).&lt;br/&gt;
Full log output: &lt;a href=&quot;https://pastebin.com/raw/DP5J7Uch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://pastebin.com/raw/DP5J7Uch&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Traceback (most recent call last):
08:42:57   File &quot;/home/jenkins/jenkins-slave/workspace/beam_PostCommit_Python_Verify_PR/src/sdks/python/apache_beam/io/gcp/gcsio.py&quot;, line 583, in _start_upload
08:42:57     self._client.objects.Insert(self._insert_request, upload=self._upload)
08:42:57   File &quot;/home/jenkins/jenkins-slave/workspace/beam_PostCommit_Python_Verify_PR/src/sdks/python/apache_beam/io/gcp/internal/clients/storage/storage_v1_client.py&quot;, line 1154, in Insert
08:42:57     upload=upload, upload_config=upload_config)
08:42:57   File &quot;/home/jenkins/jenkins-slave/workspace/beam_PostCommit_Python_Verify_PR/src/build/gradleenv/1327086738/local/lib/python2.7/site-packages/apitools/base/py/base_api.py&quot;, line 715, in _RunMethod
08:42:57     http_request, client=self.client)
08:42:57   File &quot;/home/jenkins/jenkins-slave/workspace/beam_PostCommit_Python_Verify_PR/src/build/gradleenv/1327086738/local/lib/python2.7/site-packages/apitools/base/py/transfer.py&quot;, line 885, in InitializeUpload
08:42:57     return self.StreamInChunks()
08:42:57   File &quot;/home/jenkins/jenkins-slave/workspace/beam_PostCommit_Python_Verify_PR/src/build/gradleenv/1327086738/local/lib/python2.7/site-packages/apitools/base/py/transfer.py&quot;, line 997, in StreamInChunks
08:42:57     additional_headers=additional_headers)
08:42:57   File &quot;/home/jenkins/jenkins-slave/workspace/beam_PostCommit_Python_Verify_PR/src/build/gradleenv/1327086738/local/lib/python2.7/site-packages/apitools/base/py/transfer.py&quot;, line 948, in __StreamMedia
08:42:57     self.RefreshResumableUploadState()
08:42:57   File &quot;/home/jenkins/jenkins-slave/workspace/beam_PostCommit_Python_Verify_PR/src/build/gradleenv/1327086738/local/lib/python2.7/site-packages/apitools/base/py/transfer.py&quot;, line 850, in RefreshResumableUploadState
08:42:57     self.stream.seek(self.progress)
08:42:57   File &quot;/home/jenkins/jenkins-slave/workspace/beam_PostCommit_Python_Verify_PR/src/sdks/python/apache_beam/io/filesystemio.py&quot;, line 269, in seek
08:42:57     offset, whence, self.position, self.last_position))
08:42:57 NotImplementedError: offset: 0, whence: 0, position: 48944, last: 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chamikara&quot; class=&quot;user-hover&quot; rel=&quot;chamikara&quot;&gt;chamikara&lt;/a&gt; Might have context to triage this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13226411">BEAM-7014</key>
            <summary>Flake in gcsio.py / filesystemio.py - NotImplementedError: offset: 0, whence: 0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10101" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">P1</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="udim">Udi Meiri</assignee>
                                    <reporter username="tvalentyn">Valentyn Tymofieiev</reporter>
                        <labels>
                            <label>beam-fixit</label>
                            <label>flake</label>
                    </labels>
                <created>Fri, 5 Apr 2019 17:52:29 +0000</created>
                <updated>Fri, 24 Jul 2020 19:53:43 +0000</updated>
                            <resolved>Tue, 14 Jul 2020 22:31:19 +0000</resolved>
                                                    <fixVersion>2.24.0</fixVersion>
                                    <component>sdk-py-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="17122069" author="kenn" created="Tue, 2 Jun 2020 04:00:26 +0000"  >&lt;p&gt;This issue is assigned but has not received an update in 30 days so it has been labeled &quot;stale-assigned&quot;. If you are still working on the issue, please give an update and remove the label. If you are no longer working on the issue, please unassign so someone else may work on it. In 7 days the issue will be automatically unassigned.&lt;/p&gt;</comment>
                            <comment id="17123760" author="sadovnychyi" created="Tue, 2 Jun 2020 13:07:39 +0000"  >&lt;p&gt;We have slightly related issue when it hangs indefinitely at:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Operation ongoing &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; over 303.35 seconds in state finish-msecs in step Convert html-&amp;gt;docx gs:--lawinsider-data-runs-20180819-v9.parsed@128#0/html-&amp;gt;docx/CachedMap(_HTMLToType)/FlushStorage(gs:&lt;span class=&quot;code-comment&quot;&gt;//lawinsider-temp/cdn.lawinsider.com/docx/__index__)/Batch to flush/ParDo(_GlobalWindowsBatchingDoFn)-out0/Write . Current Traceback:
&lt;/span&gt;  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python3.7/runpy.py&quot;&lt;/span&gt;, line 193, in _run_module_as_main
    &lt;span class=&quot;code-quote&quot;&gt;&quot;__main__&quot;&lt;/span&gt;, mod_spec)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python3.7/runpy.py&quot;&lt;/span&gt;, line 85, in _run_code
    exec(code, run_globals)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python3.7/site-packages/dataflow_worker/start.py&quot;&lt;/span&gt;, line 144, in &amp;lt;module&amp;gt;
    main()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python3.7/site-packages/dataflow_worker/start.py&quot;&lt;/span&gt;, line 140, in main
    batchworker.BatchWorker(properties, sdk_pipeline_options).run()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python3.7/site-packages/dataflow_worker/batchworker.py&quot;&lt;/span&gt;, line 843, in run
    deferred_exception_details=deferred_exception_details)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python3.7/site-packages/dataflow_worker/batchworker.py&quot;&lt;/span&gt;, line 647, in do_work
    work_executor.execute()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python3.7/site-packages/dataflow_worker/executor.py&quot;&lt;/span&gt;, line 178, in execute
    op.finish()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python3.7/site-packages/dataflow_worker/nativeavroio.py&quot;&lt;/span&gt;, line 309, in __exit__
    self._data_file_writer.fo.close()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python3.7/site-packages/apache_beam/io/filesystemio.py&quot;&lt;/span&gt;, line 219, in close
    self._uploader.finish()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python3.7/site-packages/apache_beam/io/gcp/gcsio.py&quot;&lt;/span&gt;, line 612, in finish
    self._upload_thread.join()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python3.7/threading.py&quot;&lt;/span&gt;, line 1044, in join
    self._wait_for_tstate_lock()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python3.7/threading.py&quot;&lt;/span&gt;, line 1060, in _wait_for_tstate_lock
    elif lock.acquire(block, timeout):
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Only on dataflow, we are able to reproduce it with our specific data and code, but so far haven&apos;t been able to make a small reproducible example. It happens when dataflow tries to write something like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
gs:&lt;span class=&quot;code-comment&quot;&gt;//PROJECTID-temp/dataflow/REDACTED-20200602-1955.1591098931.320068/dax-tmp-2020-06-02_04_55_56-10640088201905907301-S02-0-a5e8dcb50cb1ab4e/tmp-a5e8dcb50cb1aa4f-shard--&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;-7f97ef4b6c397250-endshard.avro&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(that file isn&apos;t there after the hang)&lt;/p&gt;

&lt;p&gt;There&apos;s currently a &lt;a href=&quot;https://github.com/apache/beam/blob/master/sdks/python/apache_beam/io/gcp/gcsio.py#L610-L611&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;TODO&lt;/a&gt; near that piece of code that would prevent pipeline from hanging, but in this case it would fail instead (which is still better).&lt;/p&gt;

&lt;p&gt;The issue is gone once we added `multiprocessing.set_start_method(&apos;spawn&apos;, force=True)` (we spawn some child processes to isolate execution environment from memory errors or just hangs from third party code).&lt;/p&gt;</comment>
                            <comment id="17131389" author="beamjirabot" created="Wed, 10 Jun 2020 17:23:52 +0000"  >&lt;p&gt;This issue was marked &quot;stale-assigned&quot; and has not received a public comment in 7 days. It is now automatically unassigned. If you are still working on it, you can assign it to yourself again. Please also give an update about the status of the work.&lt;/p&gt;</comment>
                            <comment id="17154243" author="chamikara" created="Thu, 9 Jul 2020 06:55:57 +0000"  >&lt;p&gt;Another possible occurrence:&#160;&lt;a href=&quot;https://stackoverflow.com/questions/62805319/dataflow-job-fails-with-httperror-notimplementederror/62809015#62809015&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/62805319/dataflow-job-fails-with-httperror-notimplementederror/62809015#62809015&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=udim&quot; class=&quot;user-hover&quot; rel=&quot;udim&quot;&gt;udim&lt;/a&gt;&#160;will you able to look into this ? Possibly we need to further extend seek() implementation here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/beam/blob/master/sdks/python/apache_beam/io/filesystemio.py#L286&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/master/sdks/python/apache_beam/io/filesystemio.py#L286&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17155787" author="udim" created="Fri, 10 Jul 2020 23:16:05 +0000"  >&lt;p&gt;I think there might be another edge case:&lt;br/&gt;
1. Read 411 bytes  &amp;lt;-- self.last_block is updates to pos 0 with 411 bytes&lt;br/&gt;
2. Read 0 bytes  &amp;lt;-- self.last_block is updated to pos 411 with 0 bytes&lt;br/&gt;
3. Seek to pos 0&lt;/p&gt;

&lt;p&gt;We could skip updating self.last_block and self.last_block_position in step 2.&lt;/p&gt;</comment>
                            <comment id="17155821" author="udim" created="Sat, 11 Jul 2020 01:48:16 +0000"  >&lt;p&gt;I believe the original issue at the top has already been fixed as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-6380&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/BEAM-6380&lt;/a&gt;. The PR that fixed it was merged a couple of weeks prior to this JIRA&apos;s creation date (&lt;a href=&quot;https://github.com/apache/beam/pull/8661&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/8661&lt;/a&gt;), so perhaps some flakes still exist.&lt;/p&gt;

&lt;p&gt;The PR I just made (#12230) fixes the Stackoverflow issue Cham referenced above.&lt;/p&gt;

&lt;p&gt;Valentyn and others, have you seen the original flake recently?&lt;br/&gt;
Specifically this pattern: &quot;NotImplementedError: offset: 0, whence: 0, position: NNN, last: 0&quot;&lt;/p&gt;</comment>
                            <comment id="17155822" author="tvalentyn" created="Sat, 11 Jul 2020 01:50:32 +0000"  >&lt;p&gt;Thanks, I have not seen these recently.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 18 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z01iaw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>