<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:56:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-6566] SqlTransform does not work for beam version above 2.6.0 if RowCoder explicitly chosen</title>
                <link>https://issues.apache.org/jira/browse/BEAM-6566</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;&lt;b&gt;Issue&lt;/b&gt;:&lt;/p&gt;

&lt;p&gt;Beam versions above 2.6.0 do not work for SqlTransform. By looking at the code,&#160;those versions use PCollection.getSchema, this function never works even for 2.6.0&lt;br/&gt;
&lt;b&gt;Details:&lt;/b&gt;&lt;br/&gt;
Beam 2.6.0, class BeamPcollectionTable which is used by SqlTransform:&lt;br/&gt;
public&#160;BeamPCollectionTable(PCollection&amp;lt;Row&amp;gt; upstream) { &#160;&#160;super(((RowCoder) upstream.getCoder()).getSchema()); &#160;&#160;this.upstream&#160;= upstream; }&lt;/p&gt;

&lt;p&gt;But for Beam 2.7.0 and 2.8.0, it is changed to : &lt;a href=&quot;https://github.com/apache/beam/blob/master/sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/impl/schema/BeamPCollectionTable.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/master/sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/impl/schema/BeamPCollectionTable.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So that got below errors after upgrading beam version from 2.6.0 to 2.9.0&lt;/p&gt;

&lt;p&gt;java.lang.IllegalStateException: Cannot call getSchema when there is no schema&lt;/p&gt;

&lt;p&gt;at org.apache.beam.sdk.values.PCollection.getSchema(PCollection.java:328)&lt;br/&gt;
 at org.apache.beam.sdk.extensions.sql.impl.schema.BeamPCollectionTable.&amp;lt;init&amp;gt;(BeamPCollectionTable.java:34)&lt;br/&gt;
 at org.apache.beam.sdk.extensions.sql.SqlTransform.toTableMap(SqlTransform.java:111)&lt;br/&gt;
 at org.apache.beam.sdk.extensions.sql.SqlTransform.expand(SqlTransform.java:91)&lt;br/&gt;
 at org.apache.beam.sdk.extensions.sql.SqlTransform.expand(SqlTransform.java:76)&lt;br/&gt;
 at org.apache.beam.sdk.Pipeline.applyInternal(Pipeline.java:537)&lt;br/&gt;
 at org.apache.beam.sdk.Pipeline.applyTransform(Pipeline.java:471)&lt;br/&gt;
 at org.apache.beam.sdk.values.PCollection.apply(PCollection.java:357)&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Codes:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Schema schema =&#160;Schema.builder()&lt;br/&gt;
.addStringField(&quot;weightMarketValue&quot;)&lt;br/&gt;
.addStringField(&quot;ticker&quot;)&lt;br/&gt;
.addStringField(&quot;ratingLongTermFitchRaw&quot;)&lt;br/&gt;
.build();&lt;/p&gt;

&lt;p&gt;Row row =&#160;Row.withSchema(schema)&lt;br/&gt;
.addValues(&quot;weightMarketValue 1&quot;, &quot;ticker 1&quot;, &quot;ratingLongTermFitchRaw 1&quot;)&lt;br/&gt;
.build();&lt;/p&gt;

&lt;p&gt;Version 1:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#FF0000&quot;&gt;PCollection&amp;lt;Row&amp;gt; input = p.apply(Create.of(row)&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#FF0000&quot;&gt; .withSchema(schema, SerializableFunctions.identity(), SerializableFunctions.identity())&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#FF0000&quot;&gt; .withCoder(RowCoder.of(schema)));&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;PCollection&amp;lt;Row&amp;gt; output&#160; = input.apply(SqlTransform.query(&quot;select * from PCOLLECTION&quot;));&lt;/p&gt;

&lt;p&gt;Version 2:&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#FF0000&quot;&gt;PCollection&amp;lt;Row&amp;gt; input = p.apply(Create.of(row)&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#FF0000&quot;&gt;.withRowSchema(schema)&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#FF0000&quot;&gt;.withCoder(RowCoder.of(schema)));&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;PCollection&amp;lt;Row&amp;gt; output&#160; = input.apply(SqlTransform.query(&quot;select * from PCOLLECTION&quot;));&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13213007">BEAM-6566</key>
            <summary>SqlTransform does not work for beam version above 2.6.0 if RowCoder explicitly chosen</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10101" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">P1</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="reuvenlax">Reuven Lax</assignee>
                                    <reporter username="Xuefeng_Zhang">Xuefeng Zhang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 31 Jan 2019 07:23:33 +0000</created>
                <updated>Sat, 16 May 2020 13:30:38 +0000</updated>
                            <resolved>Wed, 29 Apr 2020 15:59:56 +0000</resolved>
                                    <version>2.7.0</version>
                    <version>2.8.0</version>
                    <version>2.9.0</version>
                    <version>2.10.0</version>
                                    <fixVersion>2.20.0</fixVersion>
                                    <component>dsl-sql</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="16756965" author="kenn" created="Thu, 31 Jan 2019 07:31:18 +0000"  >&lt;p&gt;Thanks for the report! We will look into this ASAP. There are many tests of this transform, but clearly something has gone wrong here.&lt;/p&gt;</comment>
                            <comment id="16757907" author="kenn" created="Fri, 1 Feb 2019 02:47:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Xuefeng_Zhang&quot; class=&quot;user-hover&quot; rel=&quot;Xuefeng_Zhang&quot;&gt;Xuefeng_Zhang&lt;/a&gt; can you remove the &lt;tt&gt;.setCoder&lt;/tt&gt; lines and try again? I believe the change may be that it is expected to be a &lt;tt&gt;SchemaCoder&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reuvenlax&quot; class=&quot;user-hover&quot; rel=&quot;reuvenlax&quot;&gt;reuvenlax&lt;/a&gt; do you have any insights here?&lt;/p&gt;</comment>
                            <comment id="16758493" author="reuvenlax" created="Fri, 1 Feb 2019 17:05:12 +0000"  >&lt;p&gt;Kenn is correct. RowCoder should (no longer) ever be used directly. SQL now can accept any PCollection&amp;lt;T&amp;gt; where T has a registered schema, and Row is just one example of a type that has a schema. If you remove the withCoder() line, then thing should work.&lt;/p&gt;</comment>
                            <comment id="16758496" author="reuvenlax" created="Fri, 1 Feb 2019 17:13:16 +0000"  >&lt;p&gt;Also this change should have been called out in the release notes. Backwards incompatible changes are allowed right now (since this is all marked Experimental), however we should have included this explanation in the notes. Not putting this in the release notes was an oversight.&lt;/p&gt;</comment>
                            <comment id="16758636" author="kenn" created="Fri, 1 Feb 2019 20:10:39 +0000"  >&lt;p&gt;It sounds like the solution is to put it in the release notes and to make RowCoder perhaps private since it isn&apos;t what we want users to use now.&lt;/p&gt;</comment>
                            <comment id="16758670" author="reuvenlax" created="Fri, 1 Feb 2019 21:13:04 +0000"  >&lt;p&gt;yes, I think we should make RowCoder package private. It will require a small amount of refactoring, but not too bad.&lt;/p&gt;</comment>
                            <comment id="16793998" author="iemejia" created="Fri, 15 Mar 2019 22:38:09 +0000"  >&lt;p&gt;Is this issue already fixed &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kenn&quot; class=&quot;user-hover&quot; rel=&quot;kenn&quot;&gt;kenn&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="16794003" author="kenn" created="Fri, 15 Mar 2019 22:51:59 +0000"  >&lt;p&gt;That PR of mine I accidentally associated with the wrong Jira I think.&lt;/p&gt;

&lt;p&gt;I believe there is no fix but just instruction that this has been a backwards-incompatible change.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reuvenlax&quot; class=&quot;user-hover&quot; rel=&quot;reuvenlax&quot;&gt;reuvenlax&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="16794007" author="reuvenlax" created="Fri, 15 Mar 2019 22:55:00 +0000"  >&lt;p&gt;Correct. We should make RowCoder package private to prevent this from&lt;br/&gt;
happening again.&lt;/p&gt;

&lt;p&gt;On Fri, Mar 15, 2019 at 3:52 PM Kenneth Knowles (JIRA) &amp;lt;jira@apache.org&amp;gt;&lt;/p&gt;
</comment>
                            <comment id="16795765" author="xuefengzhang" created="Tue, 19 Mar 2019 07:09:01 +0000"  >&lt;p&gt;Thank you all for looking into this. After remove line of&#160;.withCoder(RowCoder.of(schema))); I got below errors, so I guess coder must be defined when we create input. Could you please advise or provide working code example? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reuvenlax&quot; class=&quot;user-hover&quot; rel=&quot;reuvenlax&quot;&gt;reuvenlax&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kenn&quot; class=&quot;user-hover&quot; rel=&quot;kenn&quot;&gt;kenn&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;java.util.ServiceConfigurationError: org.apache.beam.sdk.extensions.sql.impl.udf.BeamBuiltinFunctionProvider: Provider org.apache.beam.sdk.extensions.sql.impl.udf.BuiltinStringFunctions could not be instantiated&lt;/p&gt;

&lt;p&gt;at java.util.ServiceLoader.fail(ServiceLoader.java:232)&lt;br/&gt;
 at java.util.ServiceLoader.access$100(ServiceLoader.java:185)&lt;br/&gt;
 at java.util.ServiceLoader$LazyIterator.nextService(ServiceLoader.java:384)&lt;br/&gt;
 at java.util.ServiceLoader$LazyIterator.next(ServiceLoader.java:404)&lt;br/&gt;
 at java.util.ServiceLoader$1.next(ServiceLoader.java:480)&lt;br/&gt;
 at org.apache.beam.sdk.extensions.sql.impl.BeamSqlEnv.loadBeamBuiltinFunctions(BeamSqlEnv.java:128)&lt;br/&gt;
 at org.apache.beam.sdk.extensions.sql.SqlTransform.expand(SqlTransform.java:94)&lt;br/&gt;
 at org.apache.beam.sdk.extensions.sql.SqlTransform.expand(SqlTransform.java:76)&lt;br/&gt;
 at org.apache.beam.sdk.Pipeline.applyInternal(Pipeline.java:537)&lt;br/&gt;
 at org.apache.beam.sdk.Pipeline.applyTransform(Pipeline.java:471)&lt;br/&gt;
 at org.apache.beam.sdk.values.PCollection.apply(PCollection.java:357)&lt;br/&gt;
 at com.gs.imd.crp.beam.transform.SelectColumnsTest.testSelectColumnsBasic(SelectColumnsTest.java:42)&lt;br/&gt;
 at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
 at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)&lt;br/&gt;
 at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
 at java.lang.reflect.Method.invoke(Method.java:497)&lt;br/&gt;
 at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)&lt;br/&gt;
 at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)&lt;br/&gt;
 at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)&lt;br/&gt;
 at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)&lt;br/&gt;
 at org.apache.beam.sdk.testing.TestPipeline$1.evaluate(TestPipeline.java:319)&lt;br/&gt;
 at org.junit.rules.RunRules.evaluate(RunRules.java:20)&lt;br/&gt;
 at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)&lt;br/&gt;
 at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)&lt;br/&gt;
 at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)&lt;br/&gt;
 at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)&lt;br/&gt;
 at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)&lt;br/&gt;
 at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)&lt;br/&gt;
 at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)&lt;br/&gt;
 at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)&lt;br/&gt;
 at org.junit.runners.ParentRunner.run(ParentRunner.java:363)&lt;br/&gt;
 at org.junit.runner.JUnitCore.run(JUnitCore.java:137)&lt;br/&gt;
 at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68)&lt;br/&gt;
 at com.intellij.rt.execution.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:51)&lt;br/&gt;
 at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:237)&lt;br/&gt;
 at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:70)&lt;br/&gt;
Caused by: java.lang.NoClassDefFoundError: org/apache/commons/codec/DecoderException&lt;br/&gt;
 at java.lang.Class.getDeclaredConstructors0(Native Method)&lt;br/&gt;
 at java.lang.Class.privateGetDeclaredConstructors(Class.java:2671)&lt;br/&gt;
 at java.lang.Class.getConstructor0(Class.java:3075)&lt;br/&gt;
 at java.lang.Class.newInstance(Class.java:412)&lt;br/&gt;
 at java.util.ServiceLoader$LazyIterator.nextService(ServiceLoader.java:380)&lt;br/&gt;
 ... 33 more&lt;br/&gt;
Caused by: java.lang.ClassNotFoundException: org.apache.commons.codec.DecoderException&lt;br/&gt;
 at java.net.URLClassLoader.findClass(URLClassLoader.java:381)&lt;br/&gt;
 at java.lang.ClassLoader.loadClass(ClassLoader.java:424)&lt;br/&gt;
 at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331)&lt;br/&gt;
 at java.lang.ClassLoader.loadClass(ClassLoader.java:357)&lt;br/&gt;
 ... 38 more&lt;/p&gt;</comment>
                            <comment id="17094665" author="kenn" created="Tue, 28 Apr 2020 16:30:55 +0000"  >&lt;p&gt;Is this still a problem? Many things have changed since the last comment.&lt;/p&gt;</comment>
                            <comment id="17094666" author="reuvenlax" created="Tue, 28 Apr 2020 16:33:24 +0000"  >&lt;p&gt;We&apos;ve redefined RowCoder to be SchemaCoder&amp;lt;Row&amp;gt;, so this should work. However it&apos;s preferable to instead use PCollection.withRowSchema(schema)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 28 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi0ikg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>