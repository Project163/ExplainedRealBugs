<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:24:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-14288] Python PreCommit flaking in test_pformat_namedtuple_with_unnamed_fields</title>
                <link>https://issues.apache.org/jira/browse/BEAM-14288</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
self = &amp;lt;apache_beam.runners.interactive.sql.utils_test.UtilsTest testMethod=test_pformat_namedtuple_with_unnamed_fields&amp;gt;

    def test_pformat_namedtuple_with_unnamed_fields(self):
&amp;gt;     self.assertEqual(
          f&lt;span class=&quot;code-quote&quot;&gt;&apos;OptionalUnionType(unnamed: {repr(Optional[Union[&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, str]])})&apos;&lt;/span&gt;,
          pformat_namedtuple(OptionalUnionType))
E     AssertionError: &lt;span class=&quot;code-quote&quot;&gt;&apos;OptionalUnionType(unnamed: typing.Union[str, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, NoneType])&apos;&lt;/span&gt; != &lt;span class=&quot;code-quote&quot;&gt;&apos;OptionalUnionType(unnamed: typing.Union[&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, str, NoneType])&apos;&lt;/span&gt;
E     - OptionalUnionType(unnamed: typing.Union[str, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, NoneType])
E     ?                                             -----
E     + OptionalUnionType(unnamed: typing.Union[&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, str, NoneType])
E     ?                                         +++++

apache_beam/runners/interactive/sql/utils_test.py:83: AssertionError
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Hard to tell if this is a flake or a hard failure. If it&apos;s a hard failure, it just started recently in cron run &lt;a href=&quot;https://ci-beam.apache.org/job/beam_PreCommit_Python_Cron/5498/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_PreCommit_Python_Cron/5498/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In the runs I&apos;ve seen since then the failure does seem consistent, but it might only be affecting certain environments (py37-cloud, py39-cloud, py38-cloudcoverage)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13439028">BEAM-14288</key>
            <summary>Python PreCommit flaking in test_pformat_namedtuple_with_unnamed_fields</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10101" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">P1</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ningk">Ning</assignee>
                                    <reporter username="bhulette">Brian Hulette</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Apr 2022 18:57:51 +0000</created>
                <updated>Tue, 19 Apr 2022 23:23:52 +0000</updated>
                            <resolved>Tue, 19 Apr 2022 23:23:52 +0000</resolved>
                                                    <fixVersion>Not applicable</fixVersion>
                                    <component>sdk-py-core</component>
                    <component>test-failures</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="8400">2h 20m</timespent>
                                <comments>
                            <comment id="17520769" author="bhulette" created="Mon, 11 Apr 2022 18:58:18 +0000"  >&lt;p&gt;FYI &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ningk&quot; class=&quot;user-hover&quot; rel=&quot;ningk&quot;&gt;ningk&lt;/a&gt; - I&apos;m going to send a PR to skip this for now.&lt;/p&gt;</comment>
                            <comment id="17520770" author="bhulette" created="Mon, 11 Apr 2022 18:59:28 +0000"  >&lt;p&gt;I&apos;ve been unable to repro this locally so far. Regardless, we may be able to fix by making this test&apos;s assertion more lenient&lt;/p&gt;</comment>
                            <comment id="17520808" author="ningk" created="Mon, 11 Apr 2022 20:58:20 +0000"  >&lt;p&gt;Got it, the root cause should be:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;repr()&lt;/tt&gt; is not deterministic if a dictionary or set type is embedded in the object you are trying to serialize.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Since here we are trying to test against _&lt;em&gt;annotations&lt;/em&gt;_ of a NamedTuple that is a dict, the expected result is non-deterministic.&lt;/p&gt;

&lt;p&gt;We could modify the test to test with assertContains.&lt;/p&gt;</comment>
                            <comment id="17521319" author="ningk" created="Tue, 12 Apr 2022 20:09:59 +0000"  >&lt;p&gt;The root cause is that when building a Union type (typing._GenericAlias), its parameters are deduplicated through a set, thus causing the built Union type having non-deterministic order of parameters.&lt;/p&gt;

&lt;p&gt;E.g., when interpreting Union&lt;span class=&quot;error&quot;&gt;&amp;#91;int, str&amp;#93;&lt;/span&gt;, it can be either &quot;Union&lt;span class=&quot;error&quot;&gt;&amp;#91;int, str&amp;#93;&lt;/span&gt;&quot; or &quot;Union&lt;span class=&quot;error&quot;&gt;&amp;#91;str, int&amp;#93;&lt;/span&gt;&quot; once it&apos;s created.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 30 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z11d34:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>