<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:53:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-5875] Nexmark perf tests fail due to NoClassDefFoundError for Iterables.</title>
                <link>https://issues.apache.org/jira/browse/BEAM-5875</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://scans.gradle.com/s/vjkiys2xc3age/console-log?task=:beam-sdks-java-nexmark:run&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://scans.gradle.com/s/vjkiys2xc3age/console-log?task=:beam-sdks-java-nexmark:run&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I see:&lt;/p&gt;

&lt;p&gt;Caused by: java.lang.NoClassDefFoundError: org/apache/beam/repackaged/beam_sdks_java_test_utils/com/google/common/collect/Iterables&lt;br/&gt;
	at org.apache.beam.sdk.testutils.metrics.MetricsReader.checkIfMetricResultIsUnique(MetricsReader.java:128)&lt;br/&gt;
	at org.apache.beam.sdk.testutils.metrics.MetricsReader.getCounterMetric(MetricsReader.java:65)&lt;br/&gt;
	at org.apache.beam.sdk.nexmark.NexmarkLauncher.currentPerf(NexmarkLauncher.java:250)&lt;br/&gt;
	at org.apache.beam.sdk.nexmark.NexmarkLauncher.monitor(NexmarkLauncher.java:435)&lt;br/&gt;
	at org.apache.beam.sdk.nexmark.NexmarkLauncher.run(NexmarkLauncher.java:1156)&lt;br/&gt;
	at org.apache.beam.sdk.nexmark.Main$Run.call(Main.java:108)&lt;br/&gt;
	at org.apache.beam.sdk.nexmark.Main$Run.call(Main.java:96)&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)&lt;br/&gt;
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:748)&lt;br/&gt;
Caused by: java.lang.ClassNotFoundException: org.apache.beam.repackaged.beam_sdks_java_test_utils.com.google.common.collect.Iterables&lt;br/&gt;
	at java.net.URLClassLoader.findClass(URLClassLoader.java:381)&lt;br/&gt;
	at java.lang.ClassLoader.loadClass(ClassLoader.java:424)&lt;br/&gt;
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:349)&lt;br/&gt;
	at java.lang.ClassLoader.loadClass(ClassLoader.java:357)&lt;br/&gt;
	... 13 more&lt;/p&gt;

&lt;p&gt;PRs for the first red run:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-5716&quot; title=&quot;Move testing utilities to a common place&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-5716&quot;&gt;&lt;del&gt;BEAM-5716&lt;/del&gt;&lt;/a&gt; Move nexmark to &quot;testing&quot; directory in java sdk (commit: 0074138) (detail / githubweb)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-5716&quot; title=&quot;Move testing utilities to a common place&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-5716&quot;&gt;&lt;del&gt;BEAM-5716&lt;/del&gt;&lt;/a&gt; Move load-tests code to &quot;testing&quot; directory in java sdk (commit: 6674c9d) (detail / githubweb)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-5716&quot; title=&quot;Move testing utilities to a common place&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-5716&quot;&gt;&lt;del&gt;BEAM-5716&lt;/del&gt;&lt;/a&gt; Create module for testing utils (commit: 0628951) (detail / githubweb)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-5716&quot; title=&quot;Move testing utilities to a common place&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-5716&quot;&gt;&lt;del&gt;BEAM-5716&lt;/del&gt;&lt;/a&gt; Extract MetricReader class, test it and use in Nexmark code (commit: 69730fc) (detail / githubweb)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-5355&quot; title=&quot;Create GroupByKey load test for Java SDK&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-5355&quot;&gt;&lt;del&gt;BEAM-5355&lt;/del&gt;&lt;/a&gt; Use MetricsReader in GroupByKeyLoadTest (commit: 7374eb6) (detail / githubweb)&lt;/p&gt;

&lt;p&gt;&#321;ukasz &amp;#8211; would you mind taking a look? Looks like a shading issue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13194513">BEAM-5875</key>
            <summary>Nexmark perf tests fail due to NoClassDefFoundError for Iterables.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10101" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">P1</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lcwik">Luke Cwik</assignee>
                                    <reporter username="herohde">Henning Rohde</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Oct 2018 20:54:13 +0000</created>
                <updated>Sat, 16 May 2020 13:29:28 +0000</updated>
                            <resolved>Wed, 31 Oct 2018 17:02:37 +0000</resolved>
                                                    <fixVersion>Not applicable</fixVersion>
                                    <component>testing-nexmark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="13200">3h 40m</timespent>
                                <comments>
                            <comment id="16665830" author="kenn" created="Sat, 27 Oct 2018 02:10:26 +0000"  >&lt;p&gt;FWIW those are commit titles not PRs &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. They are all in &lt;a href=&quot;https://github.com/apache/beam/pull/6725&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/6725&lt;/a&gt;. It seems possible that just 00741387b65b16986e46005bf83bfb1638aca946 is the problem, as it is the one that touched Nexmark.&lt;/p&gt;</comment>
                            <comment id="16665835" author="kenn" created="Sat, 27 Oct 2018 02:17:44 +0000"  >&lt;p&gt;Upon further inspection it looks like 69730fc4c66adba7cc3ea10866b340046dc5f87e, the bit that makes Nexmark use the MetricsReader, is more likely.&lt;/p&gt;</comment>
                            <comment id="16667428" author="herohde" created="Mon, 29 Oct 2018 16:44:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kenn&quot; class=&quot;user-hover&quot; rel=&quot;kenn&quot;&gt;kenn&lt;/a&gt; I simply copied the information from jenkins when I opened the bug.&lt;/p&gt;</comment>
                            <comment id="16669371" author="lcwik" created="Tue, 30 Oct 2018 21:42:24 +0000"  >&lt;p&gt;I posted this on the subsequent bug that Kenn cut (&lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-5881&quot; title=&quot;Compile did not fail when Guava dep was left out&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-5881&quot;&gt;&lt;del&gt;BEAM-5881&lt;/del&gt;&lt;/a&gt;) but relevant here:&lt;/p&gt;

&lt;p&gt;You first compile your code using a dependency such as Guava. Then you can:&lt;/p&gt;

&lt;p&gt;shade: use the shadow plugin to update your code to point to relocated code and also package the relocated dependency within your jar not exporting it as a dependency.&lt;br/&gt;
vendor: use the shadow plugin to update your code to point to relocated code but not package the relocated dependency within your jar and instead point to an artifact that already contains the relocated code&lt;/p&gt;

&lt;p&gt;In general, you can run into this situation if either you don&apos;t package the relocated dependency or declare a vendored dependency. In the case of &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-5875&quot; title=&quot;Nexmark perf tests fail due to NoClassDefFoundError for Iterables.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-5875&quot;&gt;&lt;del&gt;BEAM-5875&lt;/del&gt;&lt;/a&gt;, it looks like you don&apos;t include the relocated dependency since guava isn&apos;t part of the compile scope: &lt;a href=&quot;https://github.com/apache/beam/blob/f20e90a65874945dbbeb33270cab2a91d619af03/sdks/java/testing/test-utils/build.gradle#L26&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/f20e90a65874945dbbeb33270cab2a91d619af03/sdks/java/testing/test-utils/build.gradle#L26&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16670395" author="lcwik" created="Wed, 31 Oct 2018 17:02:37 +0000"  >&lt;p&gt;Ran smoke test using direct runner and it didn&apos;t crash:&lt;br/&gt;
./gradlew :beam-sdks-java-nexmark:run     -Pnexmark.runner=&quot;:beam-runners-direct-java&quot;     -Pnexmark.args=&quot;&lt;br/&gt;
        --runner=DirectRunner&lt;br/&gt;
        --streaming=false&lt;br/&gt;
        --suite=SMOKE&lt;br/&gt;
        --manageResources=false&lt;br/&gt;
        --monitorJobs=true&lt;br/&gt;
        --enforceEncodability=true&lt;br/&gt;
        --enforceImmutability=true&quot;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 2 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3zp47:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>