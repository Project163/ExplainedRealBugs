<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:50:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-4016] @SplitRestriction should execute after @Setup on SplittableDoFn</title>
                <link>https://issues.apache.org/jira/browse/BEAM-4016</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;The method annotated with @SplitRestriction is the method where we can define the RestrictionTrackers (splits) in advance in a SDF. It makes sense to execute this after the @Setup method given that usually connections are established at Setup and can be used to ask the different data stores about the partitioning strategy. I added a test for this in the SplittableDoFnTest.SDFWithLifecycle test.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13150307">BEAM-4016</key>
            <summary>@SplitRestriction should execute after @Setup on SplittableDoFn</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="iemejia">Isma&#235;l Mej&#237;a</assignee>
                                    <reporter username="iemejia">Isma&#235;l Mej&#237;a</reporter>
                        <labels>
                    </labels>
                <created>Thu, 5 Apr 2018 14:01:44 +0000</created>
                <updated>Fri, 24 Jul 2020 20:18:10 +0000</updated>
                            <resolved>Wed, 11 Jul 2018 07:48:43 +0000</resolved>
                                    <version>2.4.0</version>
                    <version>2.5.0</version>
                                    <fixVersion>2.6.0</fixVersion>
                                    <component>runner-direct</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="16426988" author="iemejia" created="Thu, 5 Apr 2018 14:12:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkff&quot; class=&quot;user-hover&quot; rel=&quot;jkff&quot;&gt;jkff&lt;/a&gt; Can you confirm if the lifecycle should be as I suggest?&lt;/p&gt;</comment>
                            <comment id="16435262" author="iemejia" created="Thu, 12 Apr 2018 09:45:24 +0000"  >&lt;p&gt;Since it seems you are back &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkff&quot; class=&quot;user-hover&quot; rel=&quot;jkff&quot;&gt;jkff&lt;/a&gt; can you confirm if this is the desired order so I can open the corresponding issues (if needed) for Flink and Dataflow too.&lt;/p&gt;</comment>
                            <comment id="16437961" author="jkff" created="Fri, 13 Apr 2018 21:28:52 +0000"  >&lt;p&gt;Yeah it&apos;s the desired order. The fix is runner-independent, and it is to add a call to invoker.invokeSetup() to &lt;a href=&quot;https://github.com/apache/beam/blob/6107c314e7a1af0d29b3cd865c0dee1013c2261c/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/SplittableParDo.java#L357&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/6107c314e7a1af0d29b3cd865c0dee1013c2261c/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/SplittableParDo.java#L357&lt;/a&gt; . &lt;/p&gt;</comment>
                            <comment id="16439412" author="romain.manni-bucau" created="Mon, 16 Apr 2018 13:06:00 +0000"  >&lt;p&gt;PS: don&apos;t forget the teardown mapping for any instance (or use the same caching hack direct runer has)&lt;/p&gt;</comment>
                            <comment id="16439429" author="iemejia" created="Mon, 16 Apr 2018 13:22:06 +0000"  >&lt;p&gt;I tried that workaround but it ends up calling the setup method more times than expected. Any other ideas, can you take a look? or help me reassign to someone who can (I have the impression &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tgroh&quot; class=&quot;user-hover&quot; rel=&quot;tgroh&quot;&gt;tgroh&lt;/a&gt; is not available, and I cannot take a serious look into this for now).&lt;/p&gt;</comment>
                            <comment id="16443139" author="jkff" created="Wed, 18 Apr 2018 20:19:28 +0000"  >&lt;p&gt;Can you clarify about calling it more times than expected? Do you mean that it gets called more than once on the particular in-memory Java instance of the SDF on which SplitRestriction is called?&lt;/p&gt;</comment>
                            <comment id="16443244" author="iemejia" created="Wed, 18 Apr 2018 21:55:00 +0000"  >&lt;p&gt;I printed for SDFWithLifecycle in SplittableDoFnTest every call and the id of the thread and the call to the method. Take a look at this commit&lt;br/&gt;
&lt;a href=&quot;https://github.com/iemejia/beam/commit/75d8279858f2f4f0cd35af7a117ddb7ae7eb1e3a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/iemejia/beam/commit/75d8279858f2f4f0cd35af7a117ddb7ae7eb1e3a&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This produces this output:&lt;/p&gt;

&lt;p&gt;18 GetInitialRestriction c&lt;br/&gt;
19 GetInitialRestriction b&lt;br/&gt;
15 GetInitialRestriction a&lt;br/&gt;
13 Setup&lt;br/&gt;
14 Setup&lt;br/&gt;
18 Setup&lt;br/&gt;
18 SplitRestriction a - [0, 1)&lt;br/&gt;
14 SplitRestriction c - [0, 1)&lt;br/&gt;
13 SplitRestriction b - [0, 1)&lt;br/&gt;
18 Setup&lt;br/&gt;
17 Setup&lt;br/&gt;
13 Setup&lt;br/&gt;
17 ProcessElement b - OffsetRangeTracker&lt;/p&gt;
{range=[0, 1), lastClaimedOffset=null, lastAttemptedOffset=null}&lt;br/&gt;
18 ProcessElement c - OffsetRangeTracker{range=[0, 1), lastClaimedOffset=null, lastAttemptedOffset=null}
&lt;p&gt;13 ProcessElement a - OffsetRangeTracker&lt;/p&gt;
{range=[0, 1), lastClaimedOffset=null, lastAttemptedOffset=null}
&lt;p&gt;17 Teardown&lt;br/&gt;
17 Teardown&lt;br/&gt;
17 Teardown&lt;/p&gt;
</comment>
                            <comment id="16537506" author="iemejia" created="Mon, 9 Jul 2018 20:13:35 +0000"  >&lt;p&gt;Reopened after an issue found at Dataflow. It needs to be addressed there first, for ref &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-4745&quot; title=&quot;SDF tests broken by innocent change due to Dataflow worker dependencies&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-4745&quot;&gt;&lt;del&gt;BEAM-4745&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12917706" name="sdf-splitrestriction-lifeycle-test.patch" size="1330" author="iemejia" created="Thu, 5 Apr 2018 14:02:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 19 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3s6rb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>