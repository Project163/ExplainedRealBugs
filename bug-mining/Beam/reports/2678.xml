<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:21:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-13218] apache_beam.io.gcp.pubsub_integration_test.PubSubIntegrationTest.test_streaming_with_attributes is failing</title>
                <link>https://issues.apache.org/jira/browse/BEAM-13218</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;One of the integration tests is failing in &lt;b&gt;PostCommits&lt;/b&gt;:&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://ci-beam.apache.org/job/beam_PostCommit_Python37/4496/testReport/junit/apache_beam.io.gcp.pubsub_integration_test/PubSubIntegrationTest/test_streaming_with_attributes/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_PostCommit_Python37/4496/testReport/junit/apache_beam.io.gcp.pubsub_integration_test/PubSubIntegrationTest/test_streaming_with_attributes/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://ci-beam.apache.org/job/beam_PostCommit_Python38/1893/testReport/junit/apache_beam.io.gcp.pubsub_integration_test/PubSubIntegrationTest/test_streaming_with_attributes/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_PostCommit_Python38/1893/testReport/junit/apache_beam.io.gcp.pubsub_integration_test/PubSubIntegrationTest/test_streaming_with_attributes/&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Error MessageAssertionError:  Expected: (Test pipeline expected terminated in state: RUNNING and Expected 4 messages.)      but: Expected 4 messages. Got 4 messages. Diffs (item, count):   Expected but not in actual: dict_items([(PubsubMessage(b&lt;span class=&quot;code-quote&quot;&gt;&apos;data001-seen&apos;&lt;/span&gt;, {&lt;span class=&quot;code-quote&quot;&gt;&apos;processed&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;IT&apos;&lt;/span&gt;}), 1), (PubsubMessage(b&lt;span class=&quot;code-quote&quot;&gt;&apos;data003\xab\xac-seen&apos;&lt;/span&gt;, {&lt;span class=&quot;code-quote&quot;&gt;&apos;processed&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;IT&apos;&lt;/span&gt;}), 1)])   Unexpected: dict_items([(PubsubMessage(b&lt;span class=&quot;code-quote&quot;&gt;&apos;data001-seen&apos;&lt;/span&gt;, {&lt;span class=&quot;code-quote&quot;&gt;&apos;processed&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;IT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;timestamp&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;PubSubMessageMatcher error: expected attribute not found.&apos;&lt;/span&gt;}), 1), (PubsubMessage(b&lt;span class=&quot;code-quote&quot;&gt;&apos;data003\xab\xac-seen&apos;&lt;/span&gt;, {&lt;span class=&quot;code-quote&quot;&gt;&apos;processed&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;IT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;timestamp&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;PubSubMessageMatcher error: expected attribute not found.&apos;&lt;/span&gt;}), 1)])   Stripped attributes: [&lt;span class=&quot;code-quote&quot;&gt;&apos;id&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;timestamp&apos;&lt;/span&gt;]Stacktraceself = &amp;lt;apache_beam.io.gcp.pubsub_integration_test.PubSubIntegrationTest testMethod=test_streaming_with_attributes&amp;gt;

    @pytest.mark.it_postcommit
    def test_streaming_with_attributes(self):
&amp;gt;     self._test_streaming(with_attributes=True)

apache_beam/io/gcp/pubsub_integration_test.py:213: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
apache_beam/io/gcp/pubsub_integration_test.py:205: in _test_streaming
    timestamp_attribute=self.TIMESTAMP_ATTRIBUTE)
apache_beam/io/gcp/pubsub_it_pipeline.py:93: in run_pipeline
    result = p.run()
apache_beam/pipeline.py:573: in run
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; self.runner.run_pipeline(self, self._options)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &amp;lt;apache_beam.runners.dataflow.test_dataflow_runner.TestDataflowRunner object at 0x7fa1d1561950&amp;gt;
pipeline = &amp;lt;apache_beam.pipeline.Pipeline object at 0x7fa1d1561750&amp;gt;
options = &amp;lt;apache_beam.options.pipeline_options.PipelineOptions object at 0x7fa1d15614d0&amp;gt;

    def run_pipeline(self, pipeline, options):
      &lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;&quot;Execute test pipeline and verify test matcher&quot;&lt;/span&gt;&quot;&quot;
      test_options = options.view_as(TestOptions)
      on_success_matcher = test_options.on_success_matcher
      wait_duration = test_options.wait_until_finish_duration
      is_streaming = options.view_as(StandardOptions).streaming
    
      # [BEAM-1889] Do not send &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to remote workers also, there is no need to
      # send &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; option to remote executors.
      test_options.on_success_matcher = None
    
      self.result = &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;().run_pipeline(pipeline, options)
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; self.result.has_job:
        # TODO(markflyhigh)(BEAM-1890): Use print since Nose dosen&apos;t show logs
        # in some cases.
        print(&lt;span class=&quot;code-quote&quot;&gt;&apos;Worker logs: %s&apos;&lt;/span&gt; % self.build_console_url(options))
    
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;:
        self.wait_until_in_state(PipelineState.RUNNING)
    
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; is_streaming and not wait_duration:
          _LOGGER.warning(&lt;span class=&quot;code-quote&quot;&gt;&apos;Waiting indefinitely &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; streaming job.&apos;&lt;/span&gt;)
        self.result.wait_until_finish(duration=wait_duration)
    
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; on_success_matcher:
          from hamcrest &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; assert_that as hc_assert_that
&amp;gt;         hc_assert_that(self.result, pickler.loads(on_success_matcher))
E         AssertionError: 
E         Expected: (Test pipeline expected terminated in state: RUNNING and Expected 4 messages.)
E              but: Expected 4 messages. Got 4 messages. Diffs (item, count):
E           Expected but not in actual: dict_items([(PubsubMessage(b&lt;span class=&quot;code-quote&quot;&gt;&apos;data001-seen&apos;&lt;/span&gt;, {&lt;span class=&quot;code-quote&quot;&gt;&apos;processed&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;IT&apos;&lt;/span&gt;}), 1), (PubsubMessage(b&lt;span class=&quot;code-quote&quot;&gt;&apos;data003\xab\xac-seen&apos;&lt;/span&gt;, {&lt;span class=&quot;code-quote&quot;&gt;&apos;processed&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;IT&apos;&lt;/span&gt;}), 1)])
E           Unexpected: dict_items([(PubsubMessage(b&lt;span class=&quot;code-quote&quot;&gt;&apos;data001-seen&apos;&lt;/span&gt;, {&lt;span class=&quot;code-quote&quot;&gt;&apos;processed&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;IT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;timestamp&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;PubSubMessageMatcher error: expected attribute not found.&apos;&lt;/span&gt;}), 1), (PubsubMessage(b&lt;span class=&quot;code-quote&quot;&gt;&apos;data003\xab\xac-seen&apos;&lt;/span&gt;, {&lt;span class=&quot;code-quote&quot;&gt;&apos;processed&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;IT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;timestamp&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;PubSubMessageMatcher error: expected attribute not found.&apos;&lt;/span&gt;}), 1)])
E           Stripped attributes: [&lt;span class=&quot;code-quote&quot;&gt;&apos;id&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;timestamp&apos;&lt;/span&gt;]

apache_beam/runners/dataflow/test_dataflow_runner.py:68: AssertionError &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13411110">BEAM-13218</key>
            <summary>apache_beam.io.gcp.pubsub_integration_test.PubSubIntegrationTest.test_streaming_with_attributes is failing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yeandy">Andy Ye</assignee>
                                    <reporter username="Anand Inguva">Anand Inguva</reporter>
                        <labels>
                            <label>sickbay</label>
                    </labels>
                <created>Wed, 10 Nov 2021 17:03:21 +0000</created>
                <updated>Thu, 24 Feb 2022 13:52:03 +0000</updated>
                            <resolved>Thu, 24 Feb 2022 13:52:03 +0000</resolved>
                                                    <fixVersion>2.38.0</fixVersion>
                                    <component>test-failures</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="37200">10h 20m</timespent>
                                <comments>
                            <comment id="17441849" author="bhulette" created="Wed, 10 Nov 2021 17:14:34 +0000"  >&lt;p&gt;Note this doesn&apos;t seem to be a hard failure, but it&apos;s very flaky: &lt;a href=&quot;https://ci-beam.apache.org/job/beam_PostCommit_Python38/lastCompletedBuild/testReport/junit/apache_beam.io.gcp.pubsub_integration_test/PubSubIntegrationTest/test_streaming_with_attributes/history/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_PostCommit_Python38/lastCompletedBuild/testReport/junit/apache_beam.io.gcp.pubsub_integration_test/PubSubIntegrationTest/test_streaming_with_attributes/history/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Looks like it started suddenly, somewhere around &lt;a href=&quot;https://ci-beam.apache.org/job/beam_PostCommit_Python38/1891/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_PostCommit_Python38/1891/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17441919" author="bhulette" created="Wed, 10 Nov 2021 19:41:14 +0000"  >&lt;p&gt;This error is complaining because the actual received messages don&apos;t have a timestamp attribute. Apparently PubsubMessageMatcher considers it an error if one of the attributes in listed in strip_attributes is not found, and it adds the string &quot;PubSubMessageMatcher error: expected attribute not found.&quot;: &lt;a href=&quot;https://github.com/apache/beam/blob/8da177f64d314cf72e89a51e51fb0915f706a784/sdks/python/apache_beam/io/gcp/tests/pubsub_matcher.py#L146&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/8da177f64d314cf72e89a51e51fb0915f706a784/sdks/python/apache_beam/io/gcp/tests/pubsub_matcher.py#L146&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17441939" author="bhulette" created="Wed, 10 Nov 2021 21:01:35 +0000"  >&lt;p&gt;Disregard my first comment, this seems to be a hard failure. It just looks like flake in the Jenkins UI because it doesn&apos;t differentiate between the directrunner execution and the dataflow execution. A better history view is here: &lt;a href=&quot;https://ci-beam.apache.org/job/beam_PostCommit_Python38/lastCompletedBuild/testReport/junit/apache_beam.io.gcp.pubsub_integration_test/PubSubIntegrationTest/history/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_PostCommit_Python38/lastCompletedBuild/testReport/junit/apache_beam.io.gcp.pubsub_integration_test/PubSubIntegrationTest/history/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We can see the test has failed consistently since &lt;a href=&quot;https://ci-beam.apache.org/job/beam_PostCommit_Python38/1891/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_PostCommit_Python38/1891/&lt;/a&gt;, except for executions that timed out.&lt;/p&gt;</comment>
                            <comment id="17442467" author="bhulette" created="Thu, 11 Nov 2021 22:25:55 +0000"  >&lt;p&gt;At first I couldn&apos;t make sense of this failure mode. The two messages referenced in the error don&apos;t have timestamps when they are injected in the test, so why do we expect them to have timestamp at the end?&lt;/p&gt;

&lt;p&gt;The answer is that the WriteToPubsub() transform has timestamp_attribute= set. So the WriteToPubsub transform should be adding the attribute.&lt;/p&gt;</comment>
                            <comment id="17460338" author="bhulette" created="Thu, 16 Dec 2021 00:48:25 +0000"  >&lt;p&gt;The test has been sickbayed&lt;/p&gt;</comment>
                            <comment id="17474126" author="kenn" created="Wed, 12 Jan 2022 03:50:47 +0000"  >&lt;p&gt;This Jira ticket has a pull request attached to it, but is still open. Did the pull request resolve the issue? If so, could you please mark it resolved? This will help the project have a clear view of its open issues.&lt;/p&gt;</comment>
                            <comment id="17474702" author="JIRAUSER280331" created="Wed, 12 Jan 2022 16:54:36 +0000"  >&lt;p&gt;The issue has not been fully resolved. We merged &lt;a href=&quot;https://github.com/apache/beam/pull/16251&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR16251&lt;/a&gt; to skip the flaky test while we investigate the issue. I&apos;ve downgraded it to P2 for now.&lt;/p&gt;</comment>
                            <comment id="17487284" author="JIRAUSER280331" created="Fri, 4 Feb 2022 20:03:32 +0000"  >&lt;p&gt;We have identified this issue as a bug in the Dataflow service backend. Once the fix gets deployed, we can un-skip the test.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13418035">BEAM-13480</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 40 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0wmdc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>