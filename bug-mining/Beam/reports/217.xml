<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:43:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-1802] Spark Runner does not shutdown correctly when executing multiple pipelines in sequence</title>
                <link>https://issues.apache.org/jira/browse/BEAM-1802</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;I found this while running the Nexmark queries in sequence in local mode. I had the correct configuration but it didn&apos;t seem to work.&lt;/p&gt;

&lt;p&gt;17/03/24 12:07:49 WARN org.apache.spark.SparkContext: Multiple running SparkContexts detected in the same JVM!&lt;br/&gt;
org.apache.spark.SparkException: Only one SparkContext may be running in this JVM (see &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-2243&quot; title=&quot;Support multiple SparkContexts in the same JVM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-2243&quot;&gt;&lt;del&gt;SPARK-2243&lt;/del&gt;&lt;/a&gt;). To ignore this error, set spark.driver.allowMultipleContexts = true. The currently running SparkContext was created at:&lt;br/&gt;
org.apache.spark.api.java.JavaSparkContext.&amp;lt;init&amp;gt;(JavaSparkContext.scala:59)&lt;br/&gt;
org.apache.beam.runners.spark.translation.SparkContextFactory.createSparkContext(SparkContextFactory.java:100)&lt;br/&gt;
org.apache.beam.runners.spark.translation.SparkContextFactory.getSparkContext(SparkContextFactory.java:69)&lt;br/&gt;
org.apache.beam.runners.spark.SparkRunner.run(SparkRunner.java:206)&lt;br/&gt;
org.apache.beam.runners.spark.SparkRunner.run(SparkRunner.java:91)&lt;br/&gt;
org.apache.beam.sdk.Pipeline.run(Pipeline.java:266)&lt;br/&gt;
org.apache.beam.integration.nexmark.NexmarkRunner.run(NexmarkRunner.java:1233)&lt;br/&gt;
org.apache.beam.integration.nexmark.NexmarkDriver.runAll(NexmarkDriver.java:69)&lt;br/&gt;
org.apache.beam.integration.nexmark.drivers.NexmarkSparkDriver.main(NexmarkSparkDriver.java:46)&lt;br/&gt;
	at org.apache.spark.SparkContext$$anonfun$assertNoOtherContextIsRunning$1.apply(SparkContext.scala:2257)&lt;br/&gt;
	at org.apache.spark.SparkContext$$anonfun$assertNoOtherContextIsRunning$1.apply(SparkContext.scala:2239)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13058862">BEAM-1802</key>
            <summary>Spark Runner does not shutdown correctly when executing multiple pipelines in sequence</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aviemzur">Aviem Zur</assignee>
                                    <reporter username="iemejia">Isma&#235;l Mej&#237;a</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Mar 2017 11:09:01 +0000</created>
                <updated>Fri, 24 Jul 2020 20:18:35 +0000</updated>
                            <resolved>Sat, 25 Mar 2017 18:50:33 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                                    <component>runner-spark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15940266" author="amitsela" created="Fri, 24 Mar 2017 12:56:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iemejia&quot; class=&quot;user-hover&quot; rel=&quot;iemejia&quot;&gt;iemejia&lt;/a&gt; do you stop the pipeline between executions ? &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Pipeline p = ...
p.apply().apply()..
p.waitUntilFinish()
&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; you call stop() ?&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15940274" author="githubbot" created="Fri, 24 Mar 2017 13:03:38 +0000"  >&lt;p&gt;GitHub user aviemzur opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/2313&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/2313&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-1802&quot; title=&quot;Spark Runner does not shutdown correctly when executing multiple pipelines in sequence&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-1802&quot;&gt;&lt;del&gt;BEAM-1802&lt;/del&gt;&lt;/a&gt; Call stop in SparkPipelineResult#waitUntilFinish&lt;/p&gt;

&lt;p&gt;    Be sure to do all of the following to help us incorporate your contribution&lt;br/&gt;
    quickly and easily:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Make sure the PR title is formatted like:&lt;br/&gt;
       `&lt;a href=&quot;#&amp;gt;&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;BEAM-&amp;lt;Jira issue #&amp;gt;&lt;/a&gt; Description of pull request`&lt;/li&gt;
	&lt;li&gt;[ ] Make sure tests pass via `mvn clean verify`. (Even better, enable&lt;br/&gt;
           Travis-CI on your fork and ensure the whole test matrix passes).&lt;/li&gt;
	&lt;li&gt;[ ] Replace `&amp;lt;Jira issue #&amp;gt;` in the title with the actual Jira issue&lt;br/&gt;
           number, if there is one.&lt;/li&gt;
	&lt;li&gt;[ ] If this contribution is large, please file an Apache&lt;br/&gt;
           &lt;span class=&quot;error&quot;&gt;&amp;#91;Individual Contributor License Agreement&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.apache.org/licenses/icla.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.apache.org/licenses/icla.txt&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    &amp;#8212;&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/aviemzur/beam&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/aviemzur/beam&lt;/a&gt; finally-stop-spark-pipelines&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/2313.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/2313.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2313&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit a3384206a04f327f8ca2098ac0ab078486633096&lt;br/&gt;
Author: Aviem Zur &amp;lt;aviemzur@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-03-24T12:12:52Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-1802&quot; title=&quot;Spark Runner does not shutdown correctly when executing multiple pipelines in sequence&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-1802&quot;&gt;&lt;del&gt;BEAM-1802&lt;/del&gt;&lt;/a&gt; Call stop in SparkPipelineResult#waitUntilFinish&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15940278" author="iemejia" created="Fri, 24 Mar 2017 13:06:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=amitsela&quot; class=&quot;user-hover&quot; rel=&quot;amitsela&quot;&gt;amitsela&lt;/a&gt; Nop and I don&apos;t reuse the context either (does not make sense as you explained me because it will affect the stats).&lt;/p&gt;</comment>
                            <comment id="15940344" author="githubbot" created="Fri, 24 Mar 2017 13:36:51 +0000"  >&lt;p&gt;Github user aviemzur closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/2313&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/2313&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15940346" author="aviemzur" created="Fri, 24 Mar 2017 13:37:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iemejia&quot; class=&quot;user-hover&quot; rel=&quot;iemejia&quot;&gt;iemejia&lt;/a&gt; Please call &lt;tt&gt;stop()&lt;/tt&gt; after calling &lt;tt&gt;waitUntilFinish()&lt;/tt&gt; it should stop the first context so you can run a second one after it.&lt;/p&gt;</comment>
                            <comment id="15940348" author="iemejia" created="Fri, 24 Mar 2017 13:40:57 +0000"  >&lt;p&gt;I am not providing a spark context, so I can&apos;t call stop on it. Is there a way to get it from the pipeline ?&lt;br/&gt;
Also isn&apos;t it leaking implementation details, this is not needed with any other runner.&lt;/p&gt;</comment>
                            <comment id="15940351" author="amitsela" created="Fri, 24 Mar 2017 13:44:02 +0000"  >&lt;p&gt;The only valid scenario to expect the context to terminate is in batch jobs when blocking on &lt;tt&gt;waitUntilFinish()&lt;/tt&gt; without timeout.&lt;/p&gt;</comment>
                            <comment id="15940352" author="aviemzur" created="Fri, 24 Mar 2017 13:44:14 +0000"  >&lt;p&gt;What I meant was calling &lt;tt&gt;pipelineResult.stop()&lt;/tt&gt; after you call &lt;tt&gt;pipelineResult.waitUntilFinish()&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="15940415" author="iemejia" created="Fri, 24 Mar 2017 14:10:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=amitsela&quot; class=&quot;user-hover&quot; rel=&quot;amitsela&quot;&gt;amitsela&lt;/a&gt; I am precisely talking about this case on batch jobs. But I will do as Aviem suggested. I saw your comments on his PR and I understand now, it makes sense (however I confess I am a bit lost about why I don&apos;t need to do something like this with other runners).&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aviemzur&quot; class=&quot;user-hover&quot; rel=&quot;aviemzur&quot;&gt;aviemzur&lt;/a&gt; stop is protected so I cannot use it, are you guys going to make this one public?&lt;/p&gt;</comment>
                            <comment id="15940422" author="amitsela" created="Fri, 24 Mar 2017 14:15:51 +0000"  >&lt;p&gt;&lt;tt&gt;PipelineResult#cancel()&lt;/tt&gt; should do the trick for now&lt;/p&gt;</comment>
                            <comment id="15941639" author="githubbot" created="Sat, 25 Mar 2017 08:14:17 +0000"  >&lt;p&gt;GitHub user aviemzur opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/2327&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/2327&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-1802&quot; title=&quot;Spark Runner does not shutdown correctly when executing multiple pipelines in sequence&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-1802&quot;&gt;&lt;del&gt;BEAM-1802&lt;/del&gt;&lt;/a&gt; Stop Spark context on terminal pipeline state&lt;/p&gt;

&lt;p&gt;    Be sure to do all of the following to help us incorporate your contribution&lt;br/&gt;
    quickly and easily:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Make sure the PR title is formatted like:&lt;br/&gt;
       `&lt;a href=&quot;#&amp;gt;&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;BEAM-&amp;lt;Jira issue #&amp;gt;&lt;/a&gt; Description of pull request`&lt;/li&gt;
	&lt;li&gt;[ ] Make sure tests pass via `mvn clean verify`. (Even better, enable&lt;br/&gt;
           Travis-CI on your fork and ensure the whole test matrix passes).&lt;/li&gt;
	&lt;li&gt;[ ] Replace `&amp;lt;Jira issue #&amp;gt;` in the title with the actual Jira issue&lt;br/&gt;
           number, if there is one.&lt;/li&gt;
	&lt;li&gt;[ ] If this contribution is large, please file an Apache&lt;br/&gt;
           &lt;span class=&quot;error&quot;&gt;&amp;#91;Individual Contributor License Agreement&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.apache.org/licenses/icla.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.apache.org/licenses/icla.txt&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    &amp;#8212;&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/aviemzur/beam&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/aviemzur/beam&lt;/a&gt; stop-terminal-spark-pipelines&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/2327.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/2327.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2327&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 70ba7a5a81046100d3b49a8971febcd089cc3573&lt;br/&gt;
Author: Aviem Zur &amp;lt;aviemzur@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-03-25T08:10:35Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-1802&quot; title=&quot;Spark Runner does not shutdown correctly when executing multiple pipelines in sequence&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-1802&quot;&gt;&lt;del&gt;BEAM-1802&lt;/del&gt;&lt;/a&gt; Stop Spark context on terminal pipeline state&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15941855" author="githubbot" created="Sat, 25 Mar 2017 18:49:40 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/2327&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/2327&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15942617" author="iemejia" created="Mon, 27 Mar 2017 04:23:56 +0000"  >&lt;p&gt;Works perfectly with the merged PR, thanks.&lt;/p&gt;</comment>
                            <comment id="15969068" author="echauchot" created="Fri, 14 Apr 2017 14:04:42 +0000"  >&lt;p&gt;It works in batch mode but not in streaming mode:&lt;br/&gt;
in streaming mode calling &lt;tt&gt;pipelineResult.cancel()&lt;/tt&gt; after &lt;tt&gt;pipelineResult.waitUntilFinish()&lt;/tt&gt; did an infinite loop. &lt;tt&gt;pipelineResult.waitUntilFinish()&lt;/tt&gt; seems blocking forever and &lt;tt&gt;pipelineResult.cancel()&lt;/tt&gt; never gets called. Is this the expected behavior? &lt;br/&gt;
I did a work around by calling  &lt;tt&gt;pipelineResult.waitUntilFinish(timeout)&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;In direct runner it behaves differently &lt;tt&gt;pipelineResult.waitUntilFinish()&lt;/tt&gt; returns no need for &lt;tt&gt;pipelineResult.cancel()&lt;/tt&gt; or for timeout&lt;br/&gt;
WDYT?&lt;/p&gt;</comment>
                            <comment id="15969099" author="echauchot" created="Fri, 14 Apr 2017 14:49:25 +0000"  >&lt;p&gt;It makes sense to have an infinite loop for a stream, so I will set a timeout. We also need to standardize the behavior between runners.&lt;/p&gt;</comment>
                            <comment id="15969101" author="aviemzur" created="Fri, 14 Apr 2017 14:51:30 +0000"  >&lt;p&gt;Yes, it is working as designed, there is an inconsistency regarding the semantics of pipeline termination between the runners, this should be addressed. There is an &lt;a href=&quot;https://lists.apache.org/thread.html/86831496a08fe148e3b982cdb904f828f262c0b571543a9fed7b915d@%3Cdev.beam.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ongoing thread&lt;/a&gt; in the dev list regarding this.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12954736">BEAM-160</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 31 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3cqtj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>