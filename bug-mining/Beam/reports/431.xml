<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:46:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-3130] View.asMap() causes a ClassCastException in Apex runner</title>
                <link>https://issues.apache.org/jira/browse/BEAM-3130</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;See code sample in &lt;a href=&quot;https://stackoverflow.com/questions/46982827/error-when-using-side-input-withsideinputs-method-not-accepting-kv-type-as-inp?noredirect=1#comment81040223_46982827&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/46982827/error-when-using-side-input-withsideinputs-method-not-accepting-kv-type-as-inp?noredirect=1#comment81040223_46982827&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The error does not happen in direct runner. It also does not happen if I replace View.asMap() with View.asIterable (and do the appropriate type changes)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13115279">BEAM-3130</key>
            <summary>View.asMap() causes a ClassCastException in Apex runner</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thw">Thomas Weise</assignee>
                                    <reporter username="jkff">Eugene Kirpichov</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Nov 2017 00:49:25 +0000</created>
                <updated>Sat, 16 May 2020 13:31:45 +0000</updated>
                            <resolved>Tue, 28 Nov 2017 04:44:54 +0000</resolved>
                                    <version>2.2.0</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>runner-apex</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16238079" author="githubbot" created="Fri, 3 Nov 2017 17:52:55 +0000"  >&lt;p&gt;GitHub user tweise opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/4074&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/4074&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-3130&quot; title=&quot;View.asMap() causes a ClassCastException in Apex runner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-3130&quot;&gt;&lt;del&gt;BEAM-3130&lt;/del&gt;&lt;/a&gt; View.asMap() causes a ClassCastException in Apex runner&lt;/p&gt;

&lt;p&gt;    Follow this checklist to help us incorporate your contribution quickly and easily:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Make sure there is a &lt;span class=&quot;error&quot;&gt;&amp;#91;JIRA issue&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://issues.apache.org/jira/projects/BEAM/issues/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/projects/BEAM/issues/&lt;/a&gt;) filed for the change (usually before you start working on it).  Trivial changes like typos do not require a JIRA issue.  Your pull request should address just this issue, without pulling in other changes.&lt;/li&gt;
	&lt;li&gt;[ ] Each commit in the pull request should have a meaningful subject line and body.&lt;/li&gt;
	&lt;li&gt;[ ] Format the pull request title like `&lt;span class=&quot;error&quot;&gt;&amp;#91;BEAM-XXX&amp;#93;&lt;/span&gt; Fixes bug in ApproximateQuantiles`, where you replace `BEAM-XXX` with the appropriate JIRA issue.&lt;/li&gt;
	&lt;li&gt;[ ] Write a pull request description that is detailed enough to understand what the pull request does, how, and why.&lt;/li&gt;
	&lt;li&gt;[ ] Run `mvn clean verify` to make sure basic checks pass. A more thorough check will be performed on your pull request automatically.&lt;/li&gt;
	&lt;li&gt;[ ] If this contribution is large, please file an Apache &lt;span class=&quot;error&quot;&gt;&amp;#91;Individual Contributor License Agreement&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.apache.org/licenses/icla.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.apache.org/licenses/icla.pdf&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    &amp;#8212;&lt;br/&gt;
    R: @jkff &lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tweise/beam&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tweise/beam&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-3130&quot; title=&quot;View.asMap() causes a ClassCastException in Apex runner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-3130&quot;&gt;&lt;del&gt;BEAM-3130&lt;/del&gt;&lt;/a&gt;_View.asMap&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/4074.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/4074.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4074&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 266b521b605ee6e2601af4d2f8e09562e212c942&lt;br/&gt;
Author: Thomas Weise &amp;lt;thw@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-11-03T17:49:10Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-3130&quot; title=&quot;View.asMap() causes a ClassCastException in Apex runner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-3130&quot;&gt;&lt;del&gt;BEAM-3130&lt;/del&gt;&lt;/a&gt; View.asMap() causes a ClassCastException in Apex runner&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16266329" author="githubbot" created="Mon, 27 Nov 2017 03:15:37 +0000"  >&lt;p&gt;tweise commented on issue #4074: &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-3130&quot; title=&quot;View.asMap() causes a ClassCastException in Apex runner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-3130&quot;&gt;&lt;del&gt;BEAM-3130&lt;/del&gt;&lt;/a&gt; View.asMap() causes a ClassCastException in Apex runner&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/beam/pull/4074#issuecomment-347068452&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/4074#issuecomment-347068452&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @jkff tests are added&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16267714" author="githubbot" created="Mon, 27 Nov 2017 22:34:15 +0000"  >&lt;p&gt;jkff commented on issue #4074: &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-3130&quot; title=&quot;View.asMap() causes a ClassCastException in Apex runner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-3130&quot;&gt;&lt;del&gt;BEAM-3130&lt;/del&gt;&lt;/a&gt; View.asMap() causes a ClassCastException in Apex runner&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/beam/pull/4074#issuecomment-347351587&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/4074#issuecomment-347351587&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Thank you! While trying to merge this, I noticed a much more serious issue that I believe should be resolved before this one: &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-3261&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/BEAM-3261&lt;/a&gt; - could you take a look?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16267759" author="githubbot" created="Mon, 27 Nov 2017 23:07:05 +0000"  >&lt;p&gt;tweise commented on issue #4074: &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-3130&quot; title=&quot;View.asMap() causes a ClassCastException in Apex runner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-3130&quot;&gt;&lt;del&gt;BEAM-3130&lt;/del&gt;&lt;/a&gt; View.asMap() causes a ClassCastException in Apex runner&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/beam/pull/4074#issuecomment-347359334&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/4074#issuecomment-347359334&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @jkff I&apos;m aware of that issue as well. It is certainly important, but at the same time it&apos;s not new and I don&apos;t see why it needs to be resolved in order for this change to be merged. &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16267961" author="githubbot" created="Tue, 28 Nov 2017 01:59:48 +0000"  >&lt;p&gt;asfgit closed pull request #4074: &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-3130&quot; title=&quot;View.asMap() causes a ClassCastException in Apex runner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-3130&quot;&gt;&lt;del&gt;BEAM-3130&lt;/del&gt;&lt;/a&gt; View.asMap() causes a ClassCastException in Apex runner&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/beam/pull/4074&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/4074&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/runners/apex/src/main/java/org/apache/beam/runners/apex/ApexRunner.java b/runners/apex/src/main/java/org/apache/beam/runners/apex/ApexRunner.java&lt;br/&gt;
index 57d259301b1..0483d761c26 100644&lt;br/&gt;
&amp;#8212; a/runners/apex/src/main/java/org/apache/beam/runners/apex/ApexRunner.java&lt;br/&gt;
+++ b/runners/apex/src/main/java/org/apache/beam/runners/apex/ApexRunner.java&lt;br/&gt;
@@ -100,7 +100,7 @@ public static ApexRunner fromOptions(PipelineOptions options) {&lt;br/&gt;
   }&lt;/p&gt;

&lt;p&gt;   @SuppressWarnings(&lt;/p&gt;
{&quot;rawtypes&quot;}
&lt;p&gt;)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private List&amp;lt;PTransformOverride&amp;gt; getOverrides() {&lt;br/&gt;
+  protected List&amp;lt;PTransformOverride&amp;gt; getOverrides() {&lt;br/&gt;
     return ImmutableList.&amp;lt;PTransformOverride&amp;gt;builder()&lt;br/&gt;
         .add(&lt;br/&gt;
             PTransformOverride.of(&lt;br/&gt;
@@ -110,6 +110,18 @@ public static ApexRunner fromOptions(PipelineOptions options) {&lt;br/&gt;
             PTransformOverride.of(&lt;br/&gt;
                 PTransformMatchers.createViewWithViewFn(PCollectionViews.IterableViewFn.class),&lt;br/&gt;
                 new StreamingViewAsIterable.Factory()))&lt;br/&gt;
+        .add(&lt;br/&gt;
+            PTransformOverride.of(&lt;br/&gt;
+                PTransformMatchers.createViewWithViewFn(PCollectionViews.ListViewFn.class),&lt;br/&gt;
+                new StreamingViewAsIterable.Factory()))&lt;br/&gt;
+        .add(&lt;br/&gt;
+            PTransformOverride.of(&lt;br/&gt;
+                PTransformMatchers.createViewWithViewFn(PCollectionViews.MapViewFn.class),&lt;br/&gt;
+                new StreamingViewAsIterable.Factory()))&lt;br/&gt;
+        .add(&lt;br/&gt;
+            PTransformOverride.of(&lt;br/&gt;
+                PTransformMatchers.createViewWithViewFn(PCollectionViews.MultimapViewFn.class),&lt;br/&gt;
+                new StreamingViewAsIterable.Factory()))&lt;br/&gt;
         .add(&lt;br/&gt;
             PTransformOverride.of(&lt;br/&gt;
                 PTransformMatchers.createViewWithViewFn(PCollectionViews.SingletonViewFn.class),&lt;br/&gt;
diff --git a/runners/apex/src/main/java/org/apache/beam/runners/apex/translation/utils/CoderAdapterStreamCodec.java b/runners/apex/src/main/java/org/apache/beam/runners/apex/translation/utils/CoderAdapterStreamCodec.java&lt;br/&gt;
index f6ce1d075b2..196f73e4cb9 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/runners/apex/src/main/java/org/apache/beam/runners/apex/translation/utils/CoderAdapterStreamCodec.java&lt;br/&gt;
+++ b/runners/apex/src/main/java/org/apache/beam/runners/apex/translation/utils/CoderAdapterStreamCodec.java&lt;br/&gt;
@@ -19,6 +19,7 @@&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; import com.datatorrent.api.StreamCodec;&lt;br/&gt;
 import com.datatorrent.netlet.util.Slice;&lt;br/&gt;
+import com.google.common.annotations.VisibleForTesting;&lt;br/&gt;
 import java.io.ByteArrayInputStream;&lt;br/&gt;
 import java.io.ByteArrayOutputStream;&lt;br/&gt;
 import java.io.IOException;&lt;br/&gt;
@@ -37,6 +38,11 @@ public CoderAdapterStreamCodec(Coder&amp;lt;? super Object&amp;gt; coder) &lt;/p&gt;
{
     this.coder = coder;
   }

&lt;p&gt;+  @VisibleForTesting&lt;br/&gt;
+  public Coder&amp;lt;?&amp;gt; getCoder() &lt;/p&gt;
{
+    return this.coder;
+  }
&lt;p&gt;+&lt;br/&gt;
   @Override&lt;br/&gt;
   public Object fromByteArray(Slice fragment) {&lt;br/&gt;
     ByteArrayInputStream bis = new ByteArrayInputStream(fragment.buffer, fragment.offset,&lt;br/&gt;
diff --git a/runners/apex/src/test/java/org/apache/beam/runners/apex/translation/SideInputTranslationTest.java b/runners/apex/src/test/java/org/apache/beam/runners/apex/translation/SideInputTranslationTest.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..8e050804f3c&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/runners/apex/src/test/java/org/apache/beam/runners/apex/translation/SideInputTranslationTest.java&lt;br/&gt;
@@ -0,0 +1,155 @@&lt;br/&gt;
+package org.apache.beam.runners.apex.translation;&lt;br/&gt;
+&lt;br/&gt;
+import static org.junit.Assert.assertEquals;&lt;br/&gt;
+import static org.junit.Assert.assertNotNull;&lt;br/&gt;
+import static org.junit.Assert.assertTrue;&lt;br/&gt;
+&lt;br/&gt;
+import com.datatorrent.api.DAG;&lt;br/&gt;
+import com.datatorrent.api.DAG.OperatorMeta;&lt;br/&gt;
+import com.datatorrent.stram.engine.PortContext;&lt;br/&gt;
+import java.util.List;&lt;br/&gt;
+import java.util.Map;&lt;br/&gt;
+import java.util.Map.Entry;&lt;br/&gt;
+import org.apache.beam.runners.apex.ApexPipelineOptions;&lt;br/&gt;
+import org.apache.beam.runners.apex.TestApexRunner;&lt;br/&gt;
+import org.apache.beam.runners.apex.translation.utils.CoderAdapterStreamCodec;&lt;br/&gt;
+import org.apache.beam.sdk.Pipeline;&lt;br/&gt;
+import org.apache.beam.sdk.coders.Coder;&lt;br/&gt;
+import org.apache.beam.sdk.coders.KvCoder;&lt;br/&gt;
+import org.apache.beam.sdk.coders.ListCoder;&lt;br/&gt;
+import org.apache.beam.sdk.coders.StringUtf8Coder;&lt;br/&gt;
+import org.apache.beam.sdk.coders.StructuredCoder;&lt;br/&gt;
+import org.apache.beam.sdk.coders.VarIntCoder;&lt;br/&gt;
+import org.apache.beam.sdk.coders.VoidCoder;&lt;br/&gt;
+import org.apache.beam.sdk.options.PipelineOptionsFactory;&lt;br/&gt;
+import org.apache.beam.sdk.testing.PAssert;&lt;br/&gt;
+import org.apache.beam.sdk.transforms.Create;&lt;br/&gt;
+import org.apache.beam.sdk.transforms.DoFn;&lt;br/&gt;
+import org.apache.beam.sdk.transforms.ParDo;&lt;br/&gt;
+import org.apache.beam.sdk.transforms.View;&lt;br/&gt;
+import org.apache.beam.sdk.util.WindowedValue.FullWindowedValueCoder;&lt;br/&gt;
+import org.apache.beam.sdk.values.KV;&lt;br/&gt;
+import org.apache.beam.sdk.values.PCollectionView;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+&lt;br/&gt;
+/**&lt;br/&gt;
+ * Test that view overrides are applied by checking the corresponding&lt;br/&gt;
+ * side input coders. Unlike runner validation these don&apos;t run the pipeline,&lt;br/&gt;
+ * they only check translation.&lt;br/&gt;
+ */&lt;br/&gt;
+public class SideInputTranslationTest implements java.io.Serializable {&lt;br/&gt;
+&lt;br/&gt;
+  //@Test&lt;br/&gt;
+  public void testMapAsEntrySetSideInput() {&lt;br/&gt;
+    ApexPipelineOptions options =&lt;br/&gt;
+        PipelineOptionsFactory.as(ApexPipelineOptions.class);&lt;br/&gt;
+    options.setApplicationName(&quot;GroupByKey&quot;);&lt;br/&gt;
+    options.setRunner(TestApexRunner.class);&lt;br/&gt;
+    Pipeline pipeline = Pipeline.create(options);&lt;br/&gt;
+&lt;br/&gt;
+&lt;br/&gt;
+    final PCollectionView&amp;lt;Map&amp;lt;String, Integer&amp;gt;&amp;gt; view =&lt;br/&gt;
+        pipeline.apply(&quot;CreateSideInput&quot;, Create.of(KV.of(&quot;a&quot;, 1), KV.of(&quot;b&quot;, 3)))&lt;br/&gt;
+            .apply(View.&amp;lt;String, Integer&amp;gt;asMap());&lt;br/&gt;
+&lt;br/&gt;
+    org.apache.beam.sdk.values.PCollection&amp;lt;KV&amp;lt;String, Integer&amp;gt;&amp;gt; output =&lt;br/&gt;
+        pipeline.apply(&quot;CreateMainInput&quot;, Create.of(2 /* size */))&lt;br/&gt;
+            .apply(&lt;br/&gt;
+                &quot;OutputSideInputs&quot;,&lt;br/&gt;
+                ParDo.of(new DoFn&amp;lt;Integer, KV&amp;lt;String, Integer&amp;gt;&amp;gt;() {&lt;br/&gt;
+                  @ProcessElement&lt;br/&gt;
+                  public void processElement(ProcessContext c) {&lt;br/&gt;
+                    assertEquals((int) c.element(), c.sideInput(view).size());&lt;br/&gt;
+                    assertEquals((int) c.element(), c.sideInput(view).entrySet().size());&lt;br/&gt;
+                    for (Entry&amp;lt;String, Integer&amp;gt; entry : c.sideInput(view).entrySet()) &lt;/p&gt;
{
+                      c.output(KV.of(entry.getKey(), entry.getValue()));
+                    }
&lt;p&gt;+                  }&lt;br/&gt;
+                }).withSideInputs(view));&lt;br/&gt;
+&lt;br/&gt;
+    PAssert.that(output).containsInAnyOrder(&lt;br/&gt;
+        KV.of(&quot;a&quot;, 1), KV.of(&quot;b&quot;, 3));&lt;br/&gt;
+&lt;br/&gt;
+    pipeline.run();&lt;br/&gt;
+  }&lt;br/&gt;
+&lt;br/&gt;
+  private final transient ApexPipelineOptions options = PipelineOptionsFactory.create()&lt;br/&gt;
+      .as(ApexPipelineOptions.class);&lt;br/&gt;
+&lt;br/&gt;
+  @Test&lt;br/&gt;
+  public void testListSideInputTranslation() throws Exception &lt;/p&gt;
{
+
+    Pipeline p = Pipeline.create();
+    final PCollectionView&amp;lt;List&amp;lt;Integer&amp;gt;&amp;gt; view =
+        p.apply(&quot;CreateSideInput&quot;, Create.of(11, 13, 17, 23)).apply(View.&amp;lt;Integer&amp;gt;asList());
+    ListCoder&amp;lt;?&amp;gt; expectedCoder = ListCoder.of(KvCoder.of(VoidCoder.of(), VarIntCoder.of()));
+    assertSideInputTranslation(view, expectedCoder);
+
+  }
&lt;p&gt;+&lt;br/&gt;
+  @Test&lt;br/&gt;
+  public void testMapSideInputTranslation() throws Exception &lt;/p&gt;
{
+
+    Pipeline p = Pipeline.create();
+    final PCollectionView&amp;lt;Map&amp;lt;String, Integer&amp;gt;&amp;gt; view =
+        p.apply(&quot;CreateSideInput&quot;, Create.of(KV.of(&quot;a&quot;, 1), KV.of(&quot;b&quot;, 3)))
+            .apply(View.&amp;lt;String, Integer&amp;gt;asMap());
+    ListCoder&amp;lt;?&amp;gt; expectedCoder = ListCoder.of(KvCoder.of(VoidCoder.of(),
+        KvCoder.of(StringUtf8Coder.of(), VarIntCoder.of())));
+    assertSideInputTranslation(view, expectedCoder);
+  }
&lt;p&gt;+&lt;br/&gt;
+  @Test&lt;br/&gt;
+  public void testMultimapSideInputTranslation() throws Exception &lt;/p&gt;
{
+
+    Pipeline p = Pipeline.create();
+    final PCollectionView&amp;lt;Map&amp;lt;String, Iterable&amp;lt;Integer&amp;gt;&amp;gt;&amp;gt; view =
+        p.apply(&quot;CreateSideInput&quot;, Create.of(KV.of(&quot;a&quot;, 1), KV.of(&quot;a&quot;, 2), KV.of(&quot;b&quot;, 3)))
+            .apply(View.&amp;lt;String, Integer&amp;gt;asMultimap());
+    ListCoder&amp;lt;?&amp;gt; expectedCoder = ListCoder.of(KvCoder.of(VoidCoder.of(),
+        KvCoder.of(StringUtf8Coder.of(), VarIntCoder.of())));
+    assertSideInputTranslation(view, expectedCoder);
+  }
&lt;p&gt;+&lt;br/&gt;
+  private void assertSideInputTranslation(PCollectionView&amp;lt;?&amp;gt; view, Coder&amp;lt;?&amp;gt; expectedSideInputCoder)&lt;br/&gt;
+      throws Exception {&lt;br/&gt;
+&lt;br/&gt;
+    Pipeline p = view.getPipeline();&lt;br/&gt;
+    p.apply(&quot;CreateMainInput&quot;, Create.of(1))&lt;br/&gt;
+        .apply(&quot;OutputSideInputs&quot;,&lt;br/&gt;
+            ParDo.of(new DoFn&amp;lt;Integer, KV&amp;lt;String, Integer&amp;gt;&amp;gt;() {&lt;br/&gt;
+              @ProcessElement&lt;br/&gt;
+              public void processElement(ProcessContext c) &lt;/p&gt;
{
+              }
&lt;p&gt;+            }).withSideInputs(view));&lt;br/&gt;
+&lt;br/&gt;
+    DAG dag = TestApexRunner.translate(p, options);&lt;br/&gt;
+&lt;br/&gt;
+    OperatorMeta om = dag.getOperatorMeta(&quot;OutputSideInputs/ParMultiDo(Anonymous)&quot;);&lt;br/&gt;
+    assertNotNull(om);&lt;br/&gt;
+    assertEquals(2, om.getInputStreams().size());&lt;br/&gt;
+&lt;br/&gt;
+    String fieldName = &quot;field=sideInput1&quot;;&lt;br/&gt;
+    Map.Entry&amp;lt;DAG.InputPortMeta, DAG.StreamMeta&amp;gt; sideInput = null;&lt;br/&gt;
+    for (Map.Entry&amp;lt;DAG.InputPortMeta, DAG.StreamMeta&amp;gt; input : om.getInputStreams().entrySet()) {&lt;br/&gt;
+      CoderAdapterStreamCodec sc = (CoderAdapterStreamCodec) input.getKey().getAttributes()&lt;br/&gt;
+          .get(PortContext.STREAM_CODEC);&lt;br/&gt;
+      if (input.toString().contains(fieldName)) &lt;/p&gt;
{
+        sideInput = input;
+      }
&lt;p&gt;+      System.out.println(sc.getCoder());&lt;br/&gt;
+    }&lt;br/&gt;
+    assertNotNull(&quot;could not find stream for: &quot; + fieldName, sideInput);&lt;br/&gt;
+&lt;br/&gt;
+    CoderAdapterStreamCodec sc = (CoderAdapterStreamCodec) sideInput.getKey().getAttributes()&lt;br/&gt;
+        .get(PortContext.STREAM_CODEC);&lt;br/&gt;
+    @SuppressWarnings(&quot;rawtypes&quot;)&lt;br/&gt;
+    StructuredCoder&amp;lt;?&amp;gt; coder = (StructuredCoder) sc.getCoder();&lt;br/&gt;
+    assertTrue(coder.getComponents().get(0) instanceof FullWindowedValueCoder);&lt;br/&gt;
+    @SuppressWarnings(&quot;rawtypes&quot;)&lt;br/&gt;
+    FullWindowedValueCoder&amp;lt;?&amp;gt; fwvc = (FullWindowedValueCoder) coder.getComponents().get(0);&lt;br/&gt;
+    assertEquals(expectedSideInputCoder, fwvc.getValueCoder());&lt;br/&gt;
+&lt;br/&gt;
+  }&lt;br/&gt;
+&lt;br/&gt;
+}&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16267963" author="githubbot" created="Tue, 28 Nov 2017 02:00:52 +0000"  >&lt;p&gt;jkff commented on issue #4074: &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-3130&quot; title=&quot;View.asMap() causes a ClassCastException in Apex runner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-3130&quot;&gt;&lt;del&gt;BEAM-3130&lt;/del&gt;&lt;/a&gt; View.asMap() causes a ClassCastException in Apex runner&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/beam/pull/4074#issuecomment-347389329&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/4074#issuecomment-347389329&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Fair enough, the current PR is an improvement in any case. Simplified the test a little bit and merged.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 51 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3m93z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>