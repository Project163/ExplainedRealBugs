<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:57:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-6401] NullPointerException and regression in BeamCalcRel</title>
                <link>https://issues.apache.org/jira/browse/BEAM-6401</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;Test case to reproduce:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    Schema schema =
        Schema.builder()
            .addNullableField(&lt;span class=&quot;code-quote&quot;&gt;&quot;f0&quot;&lt;/span&gt;, Schema.FieldType.BOOLEAN)
            .build();

    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; sql =
        &lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT SUM(&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; when coalesce(f0, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; then 1 &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; 0 end) &quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;FROM PCOLLECTION&quot;&lt;/span&gt;;

    List&amp;lt;Row&amp;gt; rows = ImmutableList.of(
        Row.withSchema(schema).addValue(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;).build(),
        Row.withSchema(schema).addValue(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;).build(),
        Row.withSchema(schema).addValue(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;).build());

    PCollection&amp;lt;Row&amp;gt; input = pipeline.apply(&lt;span class=&quot;code-quote&quot;&gt;&quot;rows&quot;&lt;/span&gt;, Create.of(rows).withRowSchema(schema));

    PAssert.that(input.apply(SqlTransform.query(sql))).satisfies(matchesScalar(2));

    pipeline.run();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Similar test case doesn&apos;t throw NPE, but fails:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    Schema schema =
        Schema.builder()
            .addNullableField(&lt;span class=&quot;code-quote&quot;&gt;&quot;f0&quot;&lt;/span&gt;, Schema.FieldType.BOOLEAN)
            .build();

    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; sql =
        &lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT SUM(&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; when coalesce(f0, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;) = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; then 1 &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; 0 end) &quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;FROM PCOLLECTION&quot;&lt;/span&gt;;

    List&amp;lt;Row&amp;gt; rows = ImmutableList.of(
        Row.withSchema(schema).addValue(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;).build(),
        Row.withSchema(schema).addValue(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;).build(),
        Row.withSchema(schema).addValue(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;).build());

    PCollection&amp;lt;Row&amp;gt; input = pipeline.apply(&lt;span class=&quot;code-quote&quot;&gt;&quot;rows&quot;&lt;/span&gt;, Create.of(rows).withRowSchema(schema));

    PAssert.that(input.apply(SqlTransform.query(sql))).satisfies(matchesScalar(1));

    pipeline.run();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13208607">BEAM-6401</key>
            <summary>NullPointerException and regression in BeamCalcRel</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="apilloud">Andrew Pilloud</assignee>
                                    <reporter username="kanterov">Gleb Kanterov</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Jan 2019 18:57:09 +0000</created>
                <updated>Sat, 16 May 2020 14:01:08 +0000</updated>
                            <resolved>Tue, 26 Mar 2019 20:47:32 +0000</resolved>
                                                    <fixVersion>2.12.0</fixVersion>
                                    <component>dsl-sql</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="16738571" author="apilloud" created="Wed, 9 Jan 2019 19:27:13 +0000"  >&lt;p&gt;Was able to reproduce. Investigating further.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
  &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt; inp0_ = ((org.apache.beam.sdk.values.Row) c.element()).getBoolean(0);
  c.output(org.apache.beam.sdk.values.Row.withSchema(outputSchema).addValue((org.apache.beam.repackaged.beam_sdks_java_extensions_sql.org.apache.calcite.runtime.SqlFunctions.isTrue(inp0_) || inp0_ == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;.TRUE : inp0_ == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? (&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; : &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;.FALSE) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; (org.apache.beam.repackaged.beam_sdks_java_extensions_sql.org.apache.calcite.runtime.SqlFunctions.toBoolean(inp0_) || inp0_ == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) ? 1 : 0).build());
}

	at org.apache.beam.sdk.extensions.sql.impl.rel.BeamCalcRel$CalcFn.processElement(BeamCalcRel.java:249)
Caused by: java.lang.NullPointerException
	at org.apache.beam.repackaged.beam_sdks_java_extensions_sql.org.apache.calcite.runtime.SqlFunctions.cannotConvert(SqlFunctions.java:1457)
	at org.apache.beam.repackaged.beam_sdks_java_extensions_sql.org.apache.calcite.runtime.SqlFunctions.toBoolean(SqlFunctions.java:1480)
	at SC.eval0(Unknown Source)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.beam.sdks.java.extensions.sql.repackaged.org.codehaus.janino.ScriptEvaluator.evaluate(ScriptEvaluator.java:756)
	at org.apache.beam.sdks.java.extensions.sql.repackaged.org.codehaus.janino.ScriptEvaluator.evaluate(ScriptEvaluator.java:748)
	at org.apache.beam.sdk.extensions.sql.impl.rel.BeamCalcRel$CalcFn.processElement(BeamCalcRel.java:246)
	at org.apache.beam.sdk.extensions.sql.impl.rel.BeamCalcRel$CalcFn$DoFnInvoker.invokeProcessElement(Unknown Source)
	at org.apache.beam.repackaged.beam_runners_direct_java.runners.core.SimpleDoFnRunner.invokeProcessElement(SimpleDoFnRunner.java:275)
	at org.apache.beam.repackaged.beam_runners_direct_java.runners.core.SimpleDoFnRunner.processElement(SimpleDoFnRunner.java:240)
	at org.apache.beam.repackaged.beam_runners_direct_java.runners.core.SimplePushbackSideInputDoFnRunner.processElementInReadyWindows(SimplePushbackSideInputDoFnRunner.java:78)
	at org.apache.beam.runners.direct.ParDoEvaluator.processElement(ParDoEvaluator.java:207)
	at org.apache.beam.runners.direct.DoFnLifecycleManagerRemovingTransformEvaluator.processElement(DoFnLifecycleManagerRemovingTransformEvaluator.java:54)
	at org.apache.beam.runners.direct.DirectTransformExecutor.processElements(DirectTransformExecutor.java:160)
	at org.apache.beam.runners.direct.DirectTransformExecutor.run(DirectTransformExecutor.java:124)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16738584" author="apilloud" created="Wed, 9 Jan 2019 19:38:04 +0000"  >&lt;p&gt;Looks like calcite is generating bad code here. It is generating this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SqlFunctions.toBoolean(inp0_) || inp0_ == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The block would work if it was this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
inp0_ == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || SqlFunctions.toBoolean(inp0_)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Continuing to investigate.&lt;/p&gt;</comment>
                            <comment id="16738663" author="apilloud" created="Wed, 9 Jan 2019 21:02:48 +0000"  >&lt;p&gt;Cause is&#160;&lt;a href=&quot;https://github.com/apache/calcite/pull/886&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/calcite/pull/886&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16738855" author="apilloud" created="Thu, 10 Jan 2019 00:31:11 +0000"  >&lt;p&gt;Still continuing to investigate a root cause and fix, will open a Calcite bug tomorrow. The problem goes away if I&#160;disable&#160;RexSimplfy.simplifyBooleanCase.&lt;/p&gt;</comment>
                            <comment id="16739472" author="kanterov" created="Thu, 10 Jan 2019 14:45:34 +0000"  >&lt;p&gt;Thanks for looking into this. I found a way workaround this issue by switching from `= true` to `is true`&lt;/p&gt;</comment>
                            <comment id="16739863" author="apilloud" created="Thu, 10 Jan 2019 23:32:09 +0000"  >&lt;p&gt;Opened a calcite issue:&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CALCITE-2783&quot; title=&quot;&amp;quot;COALESCE(s, TRUE) = TRUE&amp;quot; and &amp;quot;(s OR s IS UNKNOWN) = TRUE&amp;quot; causes NullPointerException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CALCITE-2783&quot;&gt;&lt;del&gt;CALCITE-2783&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Because you have a workaround I&apos;m going to stop working on this for the moment.&lt;/p&gt;</comment>
                            <comment id="16801949" author="apilloud" created="Tue, 26 Mar 2019 17:03:04 +0000"  >&lt;p&gt;This should be fixed in Calcite 1.19, which was just released. Going to pull that in today.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="13208882">CALCITE-2783</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 33 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|u00ofc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>