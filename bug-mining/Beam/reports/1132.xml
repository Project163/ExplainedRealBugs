<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:57:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-7109] Thread leaking in Portable Python Precommit </title>
                <link>https://issues.apache.org/jira/browse/BEAM-7109</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;Beam Jenkins constantly break due to some weird errors such as &quot;Unable to create new native thread&quot;. The recent build worker failure happened on &lt;span class=&quot;error&quot;&gt;&amp;#91;apache-beam-jenkins-8&amp;#93;&lt;/span&gt; (&lt;a href=&quot;https://builds.apache.org/computer/apache-beam-jenkins-8/builds&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/computer/apache-beam-jenkins-8/builds&lt;/a&gt;). Checking the thread number on that VM shows:&#160;&lt;/p&gt;

&lt;p&gt;Thread limit:&#160;kernel.pid_max = 32768&#160;&lt;/p&gt;

&lt;p&gt;Actual used: 32411&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Dumping the thread usage (see &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12966402/12966402_threadDump.txt&quot; title=&quot;threadDump.txt attached to BEAM-7109&quot;&gt;threadDump.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;) exposed thread leaking on some Python tests. And based on the execution history of the jenkins-8, the &lt;span class=&quot;error&quot;&gt;&amp;#91;beam_PreCommit_Portable_Python_Commit&amp;#93;&lt;/span&gt; (&lt;a href=&quot;https://builds.apache.org/job/beam_PreCommit_Portable_Python_Commit&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/beam_PreCommit_Portable_Python_Commit&lt;/a&gt;)&#160;is suspicious. We ran this test multiple times on a plain node and observed that some thread started by &lt;ins&gt;&lt;em&gt;apache_beam.runners.worker.sdk_worker_main&lt;/em&gt;&lt;/ins&gt; were not tear down after tests complete. The stale threads finally accumulated and ate the VM kernel thread quota.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alanmyrvold&quot; class=&quot;user-hover&quot; rel=&quot;alanmyrvold&quot;&gt;alanmyrvold&lt;/a&gt;,&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasonkuster&quot; class=&quot;user-hover&quot; rel=&quot;jasonkuster&quot;&gt;jasonkuster&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=altay&quot; class=&quot;user-hover&quot; rel=&quot;altay&quot;&gt;altay&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13228923">BEAM-7109</key>
            <summary>Thread leaking in Portable Python Precommit </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10101" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">P1</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="angoenka">Ankur Goenka</assignee>
                                    <reporter username="yifanzou">Yifan Zou</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Apr 2019 18:16:41 +0000</created>
                <updated>Sat, 16 May 2020 13:29:39 +0000</updated>
                            <resolved>Mon, 22 Apr 2019 22:03:16 +0000</resolved>
                                                    <fixVersion>2.13.0</fixVersion>
                                    <component>testing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="16821435" author="angoenka" created="Thu, 18 Apr 2019 19:38:47 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yifanzou&quot; class=&quot;user-hover&quot; rel=&quot;yifanzou&quot;&gt;yifanzou&lt;/a&gt; for reporting and investigating this issue.&lt;/p&gt;

&lt;p&gt;For the debug purpose, can I reproduce it on local machine?&lt;/p&gt;</comment>
                            <comment id="16821459" author="yifanzou" created="Thu, 18 Apr 2019 20:03:56 +0000"  >&lt;p&gt;I reproduce it on a non-deploy node: jenkins-14. You can use the commands below to ssh to the VM and run the test. I will not launch the Jenkins on that node for now for the investigation purpose.&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;gcloud auth login&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;gcloud compute --project &quot;apache-beam-testing&quot; ssh --zone &quot;us-central1-b&quot; &quot;apache-beam-jenkins-14&quot;&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;sudo su jenkins&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;cd&#160;/home/jenkins/jenkins-slave/workspace/testspace/beam&lt;/b&gt;&#160; // I already clone the git repo&lt;/p&gt;

&lt;p&gt;&lt;b&gt;./gradlew --continue --max-workers=12 -Dorg.gradle.jvmargs=-Xms2g -Dorg.gradle.jvmargs=-Xmx4g :portablePythonPreCommit&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;// Other commands I used:&lt;/p&gt;

&lt;p&gt;sysctl -a | grep kernel.pid_max (get kernel.pid_max)&lt;/p&gt;

&lt;p&gt;ps -eLf (list active threads)&lt;/p&gt;

&lt;p&gt;ps -eLf | wc -l (count active threads)&lt;/p&gt;

&lt;p&gt;top -u jenkins (list running process)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16822256" author="angoenka" created="Fri, 19 Apr 2019 23:20:41 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yifanzou&quot; class=&quot;user-hover&quot; rel=&quot;yifanzou&quot;&gt;yifanzou&lt;/a&gt; for detailed instruction.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Issue seems to be that the logging client is not terminating and tries to reconnect indefinitely. This result SDKHarness continue love and creation of new threads and eventually we run out of threads.&lt;/p&gt;

&lt;p&gt;Attached is the thread&#160;dump&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12966526/12966526_thread_dump.txt&quot; title=&quot;thread_dump.txt attached to BEAM-7109&quot;&gt;thread_dump.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; of such a process.&#160;&lt;/p&gt;

&lt;p&gt;I will be sending a PR to solve this shortly.&lt;/p&gt;</comment>
                            <comment id="16823506" author="angoenka" created="Mon, 22 Apr 2019 22:03:01 +0000"  >&lt;p&gt;Please feel free to reopen if threads are still leaking in testing.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12966402" name="threadDump.txt" size="3657936" author="yifanzou" created="Thu, 18 Apr 2019 18:17:13 +0000"/>
                            <attachment id="12966526" name="thread_dump.txt" size="597985" author="angoenka" created="Fri, 19 Apr 2019 23:20:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 30 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z01xq8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>