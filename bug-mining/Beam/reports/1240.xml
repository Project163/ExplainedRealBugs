<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:00:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-7589] Kinesis IO.write throws LimitExceededException</title>
                <link>https://issues.apache.org/jira/browse/BEAM-7589</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;Follow up from&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-7357:&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/BEAM-7357:&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;Brachi Packter added a comment -&#160;13/Jun/19 09:05&lt;br/&gt;
 &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aromanenko&quot; class=&quot;user-hover&quot; rel=&quot;aromanenko&quot;&gt;aromanenko&lt;/a&gt;&#160;I think I find&#160;what makes the shard map update now.&lt;/p&gt;

&lt;p&gt;You create a producer per bundle (in SetUp function) and if I multiply it by the number of workers, this gives huge amount of producers, I belive this make the &quot;update shard map&quot; call.&lt;/p&gt;

&lt;p&gt;If I&#160;copy your code and create&#160;&lt;b&gt;one&lt;/b&gt;&#160;producer&#160;**&#160;for every wroker, then this error disappear.&lt;/p&gt;

&lt;p&gt;Can you just&#160;remove the producer creation from setUp method, and move it to some static field in the class, that created once&#160;the class is initiated.&lt;/p&gt;

&lt;p&gt;See similar issue that was with JDBCIO, connection pool was created per setup method, and we moved it to be a static member, and then we will have one pool for JVM. ask&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iemejia&quot; class=&quot;user-hover&quot; rel=&quot;iemejia&quot;&gt;iemejia&lt;/a&gt;&#160;for more detail.&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;Alexey Romanenko added a comment &#160;&lt;del&gt;14/Jun/19 14:31&lt;/del&gt;&#160;&#160;edited&lt;br/&gt;
 &#160;&lt;br/&gt;
 &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brachi_packter&quot; class=&quot;user-hover&quot; rel=&quot;brachi_packter&quot;&gt;brachi_packter&lt;/a&gt;&#160;What kind of error do you have in this case? Could you post an error stacktrace / exception message?&#160;&lt;br/&gt;
 Also, it would be helpful (if it&apos;s possible) if you could provide more details about your environment and pipeline, like what is your pipeline topology, which runner do you use, number of workers in your cluster, etc.&#160;&lt;br/&gt;
 For now, I can&apos;t reproduce it on my side, so all additional info will be helpful.&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;Brachi Packter added a comment -&#160;16/Jun/19 06:44&lt;br/&gt;
 I get same Same error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[0x00001728][0x00007f13ed4c4700]&#160;[error]&#160;[shard_map.cc:150]&#160;Shard map update &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; stream &lt;span class=&quot;code-quote&quot;&gt;&quot;**&quot;&lt;/span&gt; failed. Code: LimitExceededException Message: Rate exceeded &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; stream poc-test under account **.; retrying in 5062 ms
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I&apos;m not seeing full stack trace, but can see in log also this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2019-06-13 08:29:09.427018]&#160;[0x000007e1][0x00007f8d508d3700]&#160;[warning]&#160;[AWS Log: WARN](AWSErrorMarshaller)Encountered AWSError Throttling Rate exceeded
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;More details:&lt;br/&gt;
 I&apos;m using DataFlow runner, java SDK 2.11.&lt;/p&gt;

&lt;p&gt;60 workers initally, (with auto scalling and also with flag &quot;enableStreamingEngine&quot;)&lt;/p&gt;

&lt;p&gt;Normally, I&apos;m producing 4-5k per second, but when I have latency, this can be even multiply by 3-4 times.&lt;/p&gt;

&lt;p&gt;When I&apos;m starting the DataFlow job I have latency, so I produce more data, and I fail immediately.&lt;/p&gt;

&lt;p&gt;Also, I have consumers, 3rd party tool, I know that they call describe stream each 30 seconds.&lt;/p&gt;

&lt;p&gt;My job pipeline, running on GCP, reading data from PubSub, it read around 20,000 record per second (in regular time, and in latency time even 100,000 records per second) ,&#160;it does many aggregation and counting base on some diamnesions (Using Beam sql) , This is done for 1 minutes window slide, and wrting the result of aggregations to Kinesis stream.&lt;/p&gt;

&lt;p&gt;My stream has 10 shards, and my partition key logic is generating UUid per each record:&#160;&lt;/p&gt;

&lt;p&gt;UUID.randomUUID().toString()&lt;/p&gt;

&lt;p&gt;Hope this gave you some more context on my problem.&lt;/p&gt;

&lt;p&gt;Another suggestion I have, can you try fix the issue as I suggest and provide me some specific version for testing? without merging it to master? (I would di it myself, but I had truobles building locally the hue repository of apache beam..)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13240317">BEAM-7589</key>
            <summary>Kinesis IO.write throws LimitExceededException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="10722" iconUrl="https://issues.apache.org/jira/images/icons/statuses/generic.png" description="">Triage Needed</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aromanenko">Alexey Romanenko</assignee>
                                    <reporter username="kedin">Anton Kedin</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Jun 2019 23:11:21 +0000</created>
                <updated>Sat, 23 Nov 2024 09:38:52 +0000</updated>
                            <resolved>Tue, 30 Jul 2019 14:16:55 +0000</resolved>
                                    <version>2.11.0</version>
                                    <fixVersion>2.15.0</fixVersion>
                                    <component>io-java-kinesis</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="19200">5h 20m</timespent>
                                <comments>
                            <comment id="16874340" author="aromanenko" created="Thu, 27 Jun 2019 16:58:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brachi_packter&quot; class=&quot;user-hover&quot; rel=&quot;brachi_packter&quot;&gt;brachi_packter&lt;/a&gt; I rewrote write part, which uses &lt;tt&gt;KinesisProducer&lt;/tt&gt; (now it creates only one instance per JVM). Feel free to take a look and review this: &lt;a href=&quot;https://github.com/apache/beam/pull/8955&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/8955&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16874353" author="brachi" created="Thu, 27 Jun 2019 17:06:00 +0000"  >&lt;p&gt;Great! Waiting it to be merged. And then I&apos;ll test it.&lt;/p&gt;

&lt;p&gt;On Thu, Jun 27, 2019, 7:59 PM Alexey Romanenko (JIRA) &amp;lt;jira@apache.org&amp;gt;&lt;/p&gt;
</comment>
                            <comment id="16875288" author="iemejia" created="Fri, 28 Jun 2019 23:08:16 +0000"  >&lt;p&gt;PR was merged, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Brachi&quot; class=&quot;user-hover&quot; rel=&quot;Brachi&quot;&gt;Brachi&lt;/a&gt; you can try with the tomorrow&apos;s SNAPSHOTS and confirm if it fixes your issue? Thanks.&lt;/p&gt;</comment>
                            <comment id="16877624" author="brachi_packter" created="Wed, 3 Jul 2019 08:22:19 +0000"  >&lt;p&gt;Had issues to check it with snapshot version (some class not found exception).&lt;/p&gt;

&lt;p&gt;I would prefer test it when the version will become RC (When will it be?)&lt;/p&gt;</comment>
                            <comment id="16877650" author="iemejia" created="Wed, 3 Jul 2019 08:55:44 +0000"  >&lt;p&gt;Can you please add the details on the exception? There were recent changes to the way the Beam artifacts are generated / shaded so this could be related (and something worth fixing if it is the case).&lt;/p&gt;</comment>
                            <comment id="16877653" author="iemejia" created="Wed, 3 Jul 2019 08:56:16 +0000"  >&lt;p&gt;Are you using the 2.15.0-SNAPSHOT version?&lt;/p&gt;</comment>
                            <comment id="16877790" author="brachi_packter" created="Wed, 3 Jul 2019 12:13:14 +0000"  >&lt;p&gt;using&#160;&#160;2.15.0-SNAPSHOT (ran it yesterday)&lt;/p&gt;

&lt;p&gt;This is the exception:&lt;/p&gt;

&lt;p&gt;org.apache.beam.runners.dataflow.worker.repackaged.org.apache.beam.runners.core.SimpleDoFnRunner$DoFnProcessContext.schemaElement(I)Ljava/lang/Object; org.apache.beam.sdk.schemas.transforms.Convert$ConvertTransform$1$DoFnInvoker.invokeProcessElement(Unknown Source) org.apache.beam.runners.dataflow.worker.repackaged.org.apache.beam.runners.core.SimpleDoFnRunner.invokeProcessElement(SimpleDoFnRunner.java:213) org.apache.beam.runners.dataflow.worker.repackaged.org.apache.beam.runners.core.SimpleDoFnRunner.processElement(SimpleDoFnRunner.java:178) org.apache.beam.runners.dataflow.worker.SimpleParDoFn.processElement(SimpleParDoFn.java:330) org.apache.beam.runners.dataflow.worker.util.common.worker.ParDoOperation.process(ParDoOperation.java:44) org.apache.beam.runners.dataflow.worker.util.common.worker.OutputReceiver.process(OutputReceiver.java:49) org.apache.beam.runners.dataflow.worker.SimpleParDoFn$1.output(SimpleParDoFn.java:276) org.apache.beam.runners.dataflow.worker.repackaged.org.apache.beam.runners.core.SimpleDoFnRunner.outputWindowedValue(SimpleDoFnRunner.java:247) org.apache.beam.runners.dataflow.worker.repackaged.org.apache.beam.runners.core.SimpleDoFnRunner.access$700(SimpleDoFnRunner.java:73) org.apache.beam.runners.dataflow.worker.repackaged.org.apache.beam.runners.core.SimpleDoFnRunner$DoFnProcessContext.output(SimpleDoFnRunner.java:559) org.apache.beam.sdk.transforms.DoFnOutputReceivers$WindowedContextOutputReceiver.output(DoFnOutputReceivers.java:71) org.apache.beam.sdk.transforms.Filter$1.processElement(Filter.java:211)&lt;/p&gt;</comment>
                            <comment id="16878423" author="iemejia" created="Thu, 4 Jul 2019 08:10:54 +0000"  >&lt;p&gt;Mmm it might be also that the Dataflow worker has not been updated yet. Maybe &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kedin&quot; class=&quot;user-hover&quot; rel=&quot;kedin&quot;&gt;kedin&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pabloem&quot; class=&quot;user-hover&quot; rel=&quot;pabloem&quot;&gt;pabloem&lt;/a&gt; may help us confirm if this is the case and if there is a way Brachi can test this in advance.&lt;/p&gt;</comment>
                            <comment id="16878643" author="aromanenko" created="Thu, 4 Jul 2019 13:13:13 +0000"  >&lt;p&gt;Agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iemejia&quot; class=&quot;user-hover&quot; rel=&quot;iemejia&quot;&gt;iemejia&lt;/a&gt; that it would be better to test it in advance if it&apos;s possible, before starting a release process.&lt;/p&gt;</comment>
                            <comment id="16887847" author="brachi_packter" created="Thu, 18 Jul 2019 10:24:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aromanenko&quot; class=&quot;user-hover&quot; rel=&quot;aromanenko&quot;&gt;aromanenko&lt;/a&gt;&#160;Still happens, can&apos;t run Data Flow with the latest snapshot.&lt;/p&gt;



&lt;p&gt;getting abstract method error: (Can it be related to this PR&#160;&lt;a href=&quot;https://github.com/apache/beam/pull/8311&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/8311&lt;/a&gt;?)&lt;/p&gt;

&lt;p&gt;Adding&#160;again the stack trace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.AbstractMethodError: org.apache.beam.runners.dataflow.worker.repackaged.org.apache.beam.runners.core.SimpleDoFnRunner$DoFnProcessContext.schemaElement(I)Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;; org.apache.beam.sdk.schemas.transforms.Convert$ConvertTransform$1$DoFnInvoker.invokeProcessElement(Unknown Source) org.apache.beam.runners.dataflow.worker.repackaged.org.apache.beam.runners.core.SimpleDoFnRunner.invokeProcessElement(SimpleDoFnRunner.java:213) org.apache.beam.runners.dataflow.worker.repackaged.org.apache.beam.runners.core.SimpleDoFnRunner.processElement(SimpleDoFnRunner.java:178) org.apache.beam.runners.dataflow.worker.SimpleParDoFn.processElement(SimpleParDoFn.java:330) org.apache.beam.runners.dataflow.worker.util.common.worker.ParDoOperation.process(ParDoOperation.java:44) org.apache.beam.runners.dataflow.worker.util.common.worker.OutputReceiver.process(OutputReceiver.java:49) org.apache.beam.runners.dataflow.worker.SimpleParDoFn$1.output(SimpleParDoFn.java:276)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16888167" author="pabloem" created="Thu, 18 Jul 2019 17:07:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brachi_packter&quot; class=&quot;user-hover&quot; rel=&quot;brachi_packter&quot;&gt;brachi_packter&lt;/a&gt; I&apos;d like to take a look at the Dataflow job, but for that you need to file a support ticket. Could you file a support ticket, and quote me on it asking to route it to engineering? Maybe link this JIRA issue. It can be assigned to Pablo Estrada or David Yan.&lt;/p&gt;</comment>
                            <comment id="16888171" author="brachi" created="Thu, 18 Jul 2019 17:10:00 +0000"  >&lt;p&gt;Do you mean to open a support ticket for GCP?&lt;/p&gt;

</comment>
                            <comment id="16888319" author="pabloem" created="Thu, 18 Jul 2019 20:42:12 +0000"  >&lt;p&gt;Yup!&lt;/p&gt;</comment>
                            <comment id="16889988" author="brachi_packter" created="Mon, 22 Jul 2019 08:07:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pabloem&quot; class=&quot;user-hover&quot; rel=&quot;pabloem&quot;&gt;pabloem&lt;/a&gt; opened a case in Google support:&#160;Case #20063529&lt;/p&gt;</comment>
                            <comment id="16890545" author="pabloem" created="Mon, 22 Jul 2019 23:32:03 +0000"  >&lt;p&gt;I&apos;ve been assigned the issue, and I&apos;m now waiting for authorization to access the job. Thanks!&lt;/p&gt;</comment>
                            <comment id="16896173" author="iemejia" created="Tue, 30 Jul 2019 14:16:55 +0000"  >&lt;p&gt;I am marking this as resolved since the required changes are already included for version 2.15.0 what is missing is validation by the end user. At that moment we can change this issue from Resolved to Closed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13234156">BEAM-7357</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 15 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z03vts:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>