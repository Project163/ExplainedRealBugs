<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:04:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-5495] PipelineResources algorithm is not working in most environments</title>
                <link>https://issues.apache.org/jira/browse/BEAM-5495</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;Issue are:&lt;br/&gt;
1. it assumes the classloader is an URLClassLoader (not always true and java &amp;gt;= 9 breaks that as well for the app loader)&lt;br/&gt;
2. it uses loader.getURLs() which leads to including the JRE itself in the staged file&lt;/p&gt;

&lt;p&gt;Looks like this detect resource algorithm can&apos;t work and should be replaced by a SPI rather than a built-in and not extensible algorithm. Another valid alternative is to just drop that &quot;guess&quot; logic and force the user to set staged files.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13187206">BEAM-5495</key>
            <summary>PipelineResources algorithm is not working in most environments</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="10722" iconUrl="https://issues.apache.org/jira/images/icons/statuses/generic.png" description="">Triage Needed</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="&#321;ukaszG">Lukasz Gajowy</assignee>
                                    <reporter username="romain.manni-bucau">Romain Manni-Bucau</reporter>
                        <labels>
                            <label>Done</label>
                    </labels>
                <created>Tue, 25 Sep 2018 07:59:06 +0000</created>
                <updated>Thu, 13 Apr 2023 11:00:03 +0000</updated>
                            <resolved>Mon, 16 Dec 2019 17:28:55 +0000</resolved>
                                                    <fixVersion>2.19.0</fixVersion>
                                    <component>runner-flink</component>
                    <component>runner-spark</component>
                    <component>sdk-java-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="58200">16h 10m</timespent>
                                <comments>
                            <comment id="16778165" author="mxm" created="Tue, 26 Feb 2019 16:37:20 +0000"  >&lt;p&gt;Just came across this. I agree, it&apos;s broken and doesn&apos;t work for Java 9 at all:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[grpc-default-executor-0] ERROR org.apache.beam.runners.fnexecution.jobsubmission.InMemoryJobService - Encountered Unexpected Exception for Preparation job_5546448a-04ae-4d94-8e68-1b692b1e35eb
java.lang.IllegalArgumentException: Unable to use ClassLoader to detect classpath elements. Current ClassLoader is jdk.internal.loader.ClassLoaders$AppClassLoader@4f8e5cde, only URLClassLoaders are supported.
        at org.apache.beam.runners.core.construction.PipelineResources.detectClassPathResourcesToStage(PipelineResources.java:57)
        at org.apache.beam.runners.flink.FlinkJobInvoker.invoke(FlinkJobInvoker.java:95)
        at org.apache.beam.runners.fnexecution.jobsubmission.InMemoryJobService.run(InMemoryJobService.java:179)
        at org.apache.beam.model.jobmanagement.v1.JobServiceGrpc$MethodHandlers.invoke(JobServiceGrpc.java:681)
        at 
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16778168" author="mxm" created="Tue, 26 Feb 2019 16:38:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=amitsela&quot; class=&quot;user-hover&quot; rel=&quot;amitsela&quot;&gt;amitsela&lt;/a&gt; I&apos;m assuming you are not working on this anymore? If not, I think we can find somebody else to address this.&lt;/p&gt;</comment>
                            <comment id="16779051" author="romain.manni-bucau" created="Wed, 27 Feb 2019 09:16:45 +0000"  >&lt;p&gt;guess &lt;a href=&quot;https://github.com/apache/beam/pull/4514&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/4514&lt;/a&gt; logic can still be used&lt;/p&gt;</comment>
                            <comment id="16779133" author="mxm" created="Wed, 27 Feb 2019 10:45:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romain.manni-bucau&quot; class=&quot;user-hover&quot; rel=&quot;romain.manni-bucau&quot;&gt;romain.manni-bucau&lt;/a&gt; Ah nice, didn&apos;t know you had already done some work. We can definitely use this code. Do you want to re-open/rebase?&lt;/p&gt;</comment>
                            <comment id="16779293" author="romain.manni-bucau" created="Wed, 27 Feb 2019 13:13:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt; no no, feel free to grab the code directly&lt;/p&gt;</comment>
                            <comment id="16915944" author="pabloem" created="Mon, 26 Aug 2019 16:57:03 +0000"  >&lt;p&gt;This has not been addressed I guess, right? &lt;/p&gt;</comment>
                            <comment id="16916740" author="mxm" created="Tue, 27 Aug 2019 13:52:35 +0000"  >&lt;p&gt;Correct.&lt;/p&gt;</comment>
                            <comment id="16970485" author="&#322;ukaszg" created="Fri, 8 Nov 2019 17:48:19 +0000"  >&lt;p&gt;I&apos;d like to push things forward here so I assigned myself. I&apos;m looking into both solutions now and trying to determine what is best for the project. I will also revieve this thread on the devlist for all devs:&#160;&lt;a href=&quot;https://lists.apache.org/thread.html/61ae8750b4ed20413c6e93ba949ddd48dd0107a0a039ef518f9d6d21@%3Cdev.beam.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread.html/61ae8750b4ed20413c6e93ba949ddd48dd0107a0a039ef518f9d6d21@%3Cdev.beam.apache.org%3E&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16997492" author="romain.manni-bucau" created="Mon, 16 Dec 2019 17:48:33 +0000"  >&lt;p&gt;Any reason to use a one man github project (io.github.classgraph:classgraph) instead of apache xbean proposal?&lt;/p&gt;</comment>
                            <comment id="16998042" author="&#322;ukaszg" created="Tue, 17 Dec 2019 10:14:17 +0000"  >&lt;p&gt;I&apos;m not sure what you are asking about - what proposal do you have in mind? Is it a better solution than the one implemented? &lt;/p&gt;</comment>
                            <comment id="16998139" author="romain.manni-bucau" created="Tue, 17 Dec 2019 12:29:29 +0000"  >&lt;p&gt;One of the prs fixing this issue was using apache xbean instead of classgraph.&lt;/p&gt;

&lt;p&gt;Wonder if there is any rational to not priviledge apache and use a single man (so more risky for asf) lib.&lt;/p&gt;</comment>
                            <comment id="16998160" author="&#322;ukaszg" created="Tue, 17 Dec 2019 12:43:24 +0000"  >&lt;p&gt;I did not consider xbean nor knew about it. Since classgraph looked the most promising from what I saw, does the job well and can be easily replaced with other libraries if needed (thanks to the way the whole PR was implemented) I decided to use it.&lt;/p&gt;</comment>
                            <comment id="16998235" author="romain.manni-bucau" created="Tue, 17 Dec 2019 13:49:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=%C5%81ukaszG&quot; class=&quot;user-hover&quot; rel=&quot;&#321;ukaszG&quot;&gt;&#321;ukaszG&lt;/a&gt;&#160;hehe, s/did not know/forgot/ ? Joke apart it is in the list you shared in the preview comment (was on the list). My main concern is to use a library which can die with a man versus giving guarantee of health for something in sdk-core. Side note: I am more than happy if this becomes a beam extension, this is always deactivated in real life anyway since the scanning is 99% of the time wrong.&lt;/p&gt;</comment>
                            <comment id="16998268" author="mxm" created="Tue, 17 Dec 2019 14:23:05 +0000"  >&lt;p&gt;Let&apos;s assume best intentions. I don&apos;t think anyone purposely ignored your proposal, but I think you have a point here. Any additional dependency comes with some risk of it becoming unmaintained. I would prefer an active Apache project, although I don&apos;t know how active xbean is. This wouldn&apos;t be hard to find out though. &lt;/p&gt;</comment>
                            <comment id="16998297" author="&#322;ukaszg" created="Tue, 17 Dec 2019 15:03:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romain.manni-bucau&quot; class=&quot;user-hover&quot; rel=&quot;romain.manni-bucau&quot;&gt;romain.manni-bucau&lt;/a&gt;&#160;well then, it seems that I was not careful enough - apologies. If you want to correct my error &lt;span class=&quot;error&quot;&gt;&amp;#91;?&amp;#93;&lt;/span&gt;&#160;always feel free to contribute your solution improving the one I proposed.&#160;&lt;/p&gt;

&lt;p&gt;Regarding your concern - as I said I don&apos;t know much about xbean so it&apos;s hard for me to compare them in terms of quality, &quot;giving guarantee of health&quot; and specifically say which one is a better option for the job. All I can say is that all the input in the PR was talked about earlier on the &lt;a href=&quot;https://lists.apache.org/thread.html/61ae8750b4ed20413c6e93ba949ddd48dd0107a0a039ef518f9d6d21%40%3Cdev.beam.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;devlist&lt;/a&gt; and classgraph seemed a sensible solution. This, of course, can be discussed further.&lt;/p&gt;

&lt;p&gt;The bright side is that changing the implementation is as easy as implementing the&#160;PipelineResourcesDetector interface so it should be a relatively easy thing to do. The default algorithm can also be changed easily.&lt;/p&gt;</comment>
                            <comment id="16998350" author="romain.manni-bucau" created="Tue, 17 Dec 2019 15:58:24 +0000"  >&lt;p&gt;Ok, really no blaming there, the rational is that xbean is not that impacting in most environment whereas classgraph will be a new dependency not yet managed and under security scan radars + the maintenance point.&lt;/p&gt;

&lt;p&gt;That said, I think dropping that feature from the core and letting it be a plugin is likely the sanest default. Scanning the classpath can only be relevant if the user is able to configure the environment explicitly (like skip parent classloader for spark) or until the runner can become aware of it and contribute to it - none of both options are there. We can indeed enhance the SPI but it makes thing complicated and at the end this is not really a submit feature compared to the job api which should handle that. So looks like a leak in the sdk-core to me.&lt;/p&gt;

&lt;p&gt;Any hope the feature is extracted in an extension or job api layer?&lt;/p&gt;</comment>
                            <comment id="16998381" author="mxm" created="Tue, 17 Dec 2019 16:41:42 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Side note: I am more than happy if this becomes a beam extension, this is always deactivated in real life anyway since the scanning is 99% of the time wrong.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Every company I&apos;ve worked with used this feature, nobody sets the staged files manually. It works fairly well in isolated environments, it might not if you use some kind of application server, but then you can always set the staged files manually. IMHO making this is a plugin of some sort would be equivalent of deleting the code.&lt;/p&gt;

&lt;p&gt;If you want to make this more extensible, e.g. via your idea to add filters, I think that would be a good addition.&lt;/p&gt;</comment>
                            <comment id="16998451" author="romain.manni-bucau" created="Tue, 17 Dec 2019 18:15:48 +0000"  >&lt;p&gt;I always had to disable it cause it was wrong and slow. Env are mainly tests and livy.&lt;/p&gt;</comment>
                            <comment id="16999026" author="mxm" created="Wed, 18 Dec 2019 10:36:55 +0000"  >&lt;p&gt;To address your other concern:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Any reason to use a one man github project (io.github.classgraph:classgraph) instead of apache xbean proposal?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;ClassGraph: 4097 commits, 33 contributors, 304 releases.&lt;br/&gt;
Xbean: 992 commits, 12 contributors, 48 releases.&lt;/p&gt;

&lt;p&gt;ClassGraph appears to be more active. I value your concern but I think ClassGraph was a valid choice, also given the that it scoped for exactly this purpose, whereas xbean seems to be written for a different purpose and its documentation does not make it obvious how to use it for detecting classloader dependencies.&lt;/p&gt;</comment>
                            <comment id="16999186" author="romain.manni-bucau" created="Wed, 18 Dec 2019 14:00:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt;think you got&#160;abused by github &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;(see&#160;&lt;a href=&quot;https://github.com/classgraph/classgraph/graphs/contributors&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/classgraph/classgraph/graphs/contributors&lt;/a&gt;&#160;vs&#160;&lt;a href=&quot;https://github.com/apache/geronimo-xbean/graphs/contributors&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/geronimo-xbean/graphs/contributors&lt;/a&gt;). Anyway, not a blocker. Guess it should be made provided/optional in the deployed pom since it is a flippable feature (at least at sdk level) and ArchUnit or equivalent can be used to ensure it is limited to the scanner and classgraph is not used outside of that class to ensure it can still be dropped.&lt;/p&gt;</comment>
                            <comment id="16999358" author="lcwik" created="Wed, 18 Dec 2019 17:12:48 +0000"  >&lt;p&gt;l would also agree that classgraph is a better choice since it has a much more narrow responsibility and is more actively developed in the past couple of years but xbean has been around for much longer. Either way the implementation that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=%C5%81ukaszG&quot; class=&quot;user-hover&quot; rel=&quot;&#321;ukaszG&quot;&gt;&#321;ukaszG&lt;/a&gt;&#160;did is extensible and replaceable. The implementation can be overridden by specifying the pipeline resources detector factory option.&lt;/p&gt;

&lt;p&gt;Adding a based pipeline resources detector factory that delegates to ServiceLoader to find an implementation seems fine as well and could be added as a future PR.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13083167">BEAM-2530</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13237210">BEAM-7478</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="13215204">BEAM-6656</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 47 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3yg9j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>