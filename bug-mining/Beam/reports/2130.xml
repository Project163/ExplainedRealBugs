<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:13:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-10986] :build task doesn&apos;t build shaded jar with shadow &gt;5.0.0</title>
                <link>https://issues.apache.org/jira/browse/BEAM-10986</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;Not 100% sure but I believe this will prevent us from releasing shaded jars.&lt;/p&gt;

&lt;p&gt;See&#160;&lt;a href=&quot;https://lists.apache.org/thread.html/r12c785c2b01017329204ad816740e80b70c19c5f2bb1ea01535a987d%40%3Cdev.beam.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread.html/r12c785c2b01017329204ad816740e80b70c19c5f2bb1ea01535a987d%40%3Cdev.beam.apache.org%3E&lt;/a&gt;&#160;for details.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13330051">BEAM-10986</key>
            <summary>:build task doesn&apos;t build shaded jar with shadow &gt;5.0.0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10100" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">P0</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bhulette">Brian Hulette</assignee>
                                    <reporter username="bhulette">Brian Hulette</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Sep 2020 22:33:41 +0000</created>
                <updated>Wed, 7 Apr 2021 15:23:16 +0000</updated>
                            <resolved>Wed, 7 Apr 2021 15:23:16 +0000</resolved>
                                                    <fixVersion>2.25.0</fixVersion>
                                    <component>build-system</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="26400">7h 20m</timespent>
                                <comments>
                            <comment id="17204335" author="bhulette" created="Tue, 29 Sep 2020 22:35:37 +0000"  >&lt;p&gt;I&apos;ll put up a PR to rollback the shadow version and cherrypick into 2.25.0&lt;/p&gt;

&lt;p&gt;CC: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=robinyqiu&quot; class=&quot;user-hover&quot; rel=&quot;robinyqiu&quot;&gt;robinyqiu&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CC: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lcwik&quot; class=&quot;user-hover&quot; rel=&quot;lcwik&quot;&gt;lcwik&lt;/a&gt;&#160;in case you have thoughts on another solution&lt;/p&gt;</comment>
                            <comment id="17204859" author="bhulette" created="Wed, 30 Sep 2020 16:23:51 +0000"  >&lt;p&gt;I went ahead and rolled back to version 4.0.3. Let&apos;s keep this jira open to figure out how to get back to 5.x though. &lt;/p&gt;

&lt;p&gt;Suggestion from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=runningcode&quot; class=&quot;user-hover&quot; rel=&quot;runningcode&quot;&gt;runningcode&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Ah, in that case perhaps in the new versions of the plugin the build task doens&apos;t depend any more on the shadowJar task.&lt;br/&gt;
To fix this, we can add the following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
tasks.named(&lt;span class=&quot;code-quote&quot;&gt;&quot;build&quot;&lt;/span&gt;).configure {
  dependsOn tasks.named(&lt;span class=&quot;code-quote&quot;&gt;&quot;shadowJar&quot;&lt;/span&gt;)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Should I do the above for just io/expansion-service/build.gradle or all shadowJar tasks?&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="17204863" author="bhulette" created="Wed, 30 Sep 2020 16:26:19 +0000"  >&lt;p&gt;FWIW I noticed that io/expansion-service/build.gradle uses the &lt;a href=&quot;https://github.com/apache/beam/blob/master/sdks/java/io/expansion-service/build.gradle#L20&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;application plugin&lt;/a&gt; which reinforces my suspicion that this has to do with the one change in shadow 4.0.4 &lt;a href=&quot;https://github.com/johnrengelman/shadow/releases/tag/4.0.4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;release notes&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;When using shadow, application, and maven plugins together, remove shadowDistZip and shadowDistTar from configurations.archives so they are not published or installed by default&lt;br/&gt;
with the uploadArchives or install tasks. #347&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="17204996" author="kenn" created="Wed, 30 Sep 2020 20:09:36 +0000"  >&lt;p&gt;Does the application plugin build a bundled jar? My recollection is that actually it builds a zip and a shell script that knows how to put the contents of the zip on the classpath. This has some advantages since each input jar retains its metadata. Worth considering a revisit here. Notably &lt;tt&gt;:sdks:java:io:expansion-service&lt;/tt&gt; ships a small and arbitrary set of IOs, which won&apos;t scale.&lt;/p&gt;</comment>
                            <comment id="17205007" author="bhulette" created="Wed, 30 Sep 2020 20:30:41 +0000"  >&lt;p&gt;Looks like you&apos;re right, it builds a zip and script(s), according to &lt;a href=&quot;https://docs.gradle.org/current/userguide/application_plugin.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;gradle docs&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The Application plugin facilitates creating an executable JVM application. It makes it easy to start the application locally during development, and to package the application as a TAR and/or ZIP including operating system specific start scripts.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m not sure why we&apos;re using both shadow and application here, maybe we&apos;re relying on application to add the Main-Class attribute in the shaded jar? For the SQL expansion service I did this in the &lt;a href=&quot;https://github.com/apache/beam/blob/master/sdks/java/extensions/sql/expansion-service/build.gradle#L26&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;shadowClosure&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Maybe &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=robertwb&quot; class=&quot;user-hover&quot; rel=&quot;robertwb&quot;&gt;robertwb&lt;/a&gt; can comment since application has been there since io/expansion-service was added in &lt;a href=&quot;https://github.com/apache/beam/commit/cf3ce65ac21603f961d95d96e82ec49590f948d7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/commit/cf3ce65ac21603f961d95d96e82ec49590f948d7&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17205013" author="bhulette" created="Wed, 30 Sep 2020 20:34:45 +0000"  >&lt;p&gt;Noting here this pattern was repeated in &lt;a href=&quot;https://github.com/apache/beam/blob/master/sdks/java/io/snowflake/expansion-service/build.gradle&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;io/snowflake/expansion-service&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/beam/blob/master/sdks/java/io/kinesis/expansion-service/build.gradle&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;io/kinesis/expansion-service&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17205062" author="robertwb" created="Wed, 30 Sep 2020 22:16:00 +0000"  >&lt;p&gt;IIRC, I just looked at what the FlinkJobServer jar did and copied that.&lt;/p&gt;

&lt;p&gt;On Wed, Sep 30, 2020 at 1:31 PM Brian Hulette (Jira) &amp;lt;jira@apache.org&amp;gt;&lt;/p&gt;
</comment>
                            <comment id="17205066" author="bhulette" created="Wed, 30 Sep 2020 22:19:26 +0000"  >&lt;p&gt;Ah yes Samza, Flink and Spark job servers all do this too.&lt;/p&gt;</comment>
                            <comment id="17205078" author="bhulette" created="Wed, 30 Sep 2020 22:37:23 +0000"  >&lt;p&gt;Found this &lt;a href=&quot;https://github.com/apache/beam/pull/5726#discussion_r197573210&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;comment&lt;/a&gt; when the flink job server was initially added.&lt;/p&gt;

&lt;p&gt;Also relevant: docs on &lt;tt&gt;shadow&lt;/tt&gt; integration with &lt;tt&gt;application&lt;/tt&gt;: &lt;a href=&quot;https://imperceptiblethoughts.com/shadow/application-plugin/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://imperceptiblethoughts.com/shadow/application-plugin/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17205097" author="kenn" created="Wed, 30 Sep 2020 23:05:07 +0000"  >&lt;p&gt;Is there a generalized plan for all of these expansion services? Like some contract on how an SDK discovers them / how a user includes them / what they should have in them? I had thought the idea was to (potentially) publish docker images for particular expansions, in which case application would be fine and/or preferable.&lt;/p&gt;</comment>
                            <comment id="17205163" author="robertwb" created="Thu, 1 Oct 2020 00:24:00 +0000"  >&lt;p&gt;Correct, the full contract for naming and starting up expansion&lt;br/&gt;
services (or job services) is not well specified, despite the protocol&lt;br/&gt;
(once you have a port) being well established.&lt;/p&gt;

&lt;p&gt;For beam java-provided, python-used expansion services, we have been naming&lt;br/&gt;
them based on gradle targets, e.g.&lt;/p&gt;


&lt;p&gt;&lt;a href=&quot;https://github.com/apache/beam/blob/v2.24.0/sdks/python/apache_beam/io/kafka.py#L107&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/v2.24.0/sdks/python/apache_beam/io/kafka.py#L107&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If &apos;dev&apos; is in the version name, we compute the relative path of the&lt;br/&gt;
gradle-build jar (and if not present, give instructions how to use it).&lt;br/&gt;
Otherwise we try to fetch the relevant artifacts from the apache beam maven&lt;br/&gt;
repository itself. We use this tactic for job services as well, e.g. when&lt;br/&gt;
running with the FlinkRunner it&apos;ll automatically download the Flink job&lt;br/&gt;
server jar and invoke it with java. (We also provide the ability to map&lt;br/&gt;
gradle tasks to manually provided jar paths as well, which can be useful&lt;br/&gt;
for testing or non-traditional setups.)&lt;/p&gt;

&lt;p&gt;This is a pragmatic solution that provides a decent development and&lt;br/&gt;
end-user experience, but of course isn&apos;t fully general. We could also&lt;br/&gt;
offer these as docker images, though that has other issues (e.g. docker is&lt;br/&gt;
harder to install and generally less widely available than Java (though&lt;br/&gt;
that might be changing) and one doesn&apos;t inherit the host&apos;s environment&lt;br/&gt;
(including the filesystem and credentials) and may be more heavy-weight,&lt;br/&gt;
but has the advantage that it is portable to arbitrary languages. We could&lt;br/&gt;
also explore using the image that provides the expansion be the same image&lt;br/&gt;
that is used as the worker (provided it can reliably name itself).&lt;/p&gt;

&lt;p&gt;Certainly room for improvement here.&lt;/p&gt;



&lt;p&gt;On Wed, Sep 30, 2020 at 4:06 PM Kenneth Knowles (Jira) &amp;lt;jira@apache.org&amp;gt;&lt;/p&gt;
</comment>
                            <comment id="17205714" author="kenn" created="Thu, 1 Oct 2020 17:52:57 +0000"  >&lt;p&gt;I will emphasize &quot;discovering and acquiring&quot; to the list of &quot;naming and starting up&quot; expansion service. The piece I was a bit curious about was stuff around here: &lt;a href=&quot;https://github.com/apache/beam/blob/ac35099e438d5fb8d471263e0485edc8c2eb6886/sdks/python/apache_beam/transforms/external.py#L522&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/ac35099e438d5fb8d471263e0485edc8c2eb6886/sdks/python/apache_beam/transforms/external.py#L522&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It eventually bottoms out at &lt;a href=&quot;https://github.com/apache/beam/blob/6612b24ada9382706373db547b5606d6e0496b02/sdks/python/apache_beam/utils/subprocess_server.py#L209&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/6612b24ada9382706373db547b5606d6e0496b02/sdks/python/apache_beam/utils/subprocess_server.py#L209&#160;&lt;/a&gt;which replaces colons with dashes to guess a maven artifact id. This is a heuristic that we super don&apos;t guarantee.&lt;/p&gt;

&lt;p&gt;I agree wholeheartedly with docker maybe being overkill for this. I&apos;m happy enough with a bundled jar as the form of executable distribution. I think the &lt;b&gt;big&lt;/b&gt; missing piece here is how you robustly acquire whatever the artifact is. Docker has the benefit of having a URL by default, while maven coords for the released bundled jar work pretty well too.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17205755" author="bhulette" created="Thu, 1 Oct 2020 18:49:51 +0000"  >&lt;p&gt;Maybe I should&apos;ve known this but I didn&apos;t. &lt;a href=&quot;https://maven.apache.org/pom.html#Maven_Coordinates&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;maven coords&lt;/a&gt; means &lt;tt&gt;groupId:artifactId:version&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I think it&apos;s worth noting that even though the heuristic isn&apos;t guaranteed, at least xlang tests will break at HEAD if the heuristic becomes false, since the artifactid is part of the local filepath for development builds: &lt;a href=&quot;https://github.com/apache/beam/blob/6612b24ada9382706373db547b5606d6e0496b02/sdks/python/apache_beam/utils/subprocess_server.py#L218&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/6612b24ada9382706373db547b5606d6e0496b02/sdks/python/apache_beam/utils/subprocess_server.py#L218&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So you&apos;re suggesting we should be using maven coords as the primary identifier if a bundled jar is the form of executable distribution? Is there a way to make that work well with development builds (other than just using the heuristic in the opposite direction)?&lt;/p&gt;</comment>
                            <comment id="17209129" author="chamikara" created="Tue, 6 Oct 2020 20:18:25 +0000"  >&lt;p&gt;Thanks for root causing and fixing this Brian.&lt;/p&gt;

&lt;p&gt;Filed &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-11026&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/BEAM-11026&lt;/a&gt;&#160;for depending on Maven coords instead of Gradle target.&lt;/p&gt;</comment>
                            <comment id="17241884" author="runningcode" created="Tue, 1 Dec 2020 21:28:22 +0000"  >&lt;p&gt;I have made a PR to update the shadow jar plugin and adding the dependency on the shadowjar task from the build task to avoid this issue: &lt;a href=&quot;https://github.com/apache/beam/pull/13453&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/13453&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 49 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0j10o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>