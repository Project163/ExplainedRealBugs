<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:50:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-2810] Consider a faster Avro library in Python</title>
                <link>https://issues.apache.org/jira/browse/BEAM-2810</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/45870789/bottleneck-on-data-source&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/45870789/bottleneck-on-data-source&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Seems like this job is reading Avro files (exported by BigQuery) at about 2 MB/s.&lt;/p&gt;

&lt;p&gt;We use the standard Python &quot;avro&quot; library which is apparently known to be very slow (10x+ slower than Java) &lt;a href=&quot;http://apache-avro.679487.n3.nabble.com/Avro-decode-very-slow-in-Python-td4034422.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://apache-avro.679487.n3.nabble.com/Avro-decode-very-slow-in-Python-td4034422.html&lt;/a&gt;, and there are alternatives e.g. &lt;a href=&quot;https://pypi.python.org/pypi/fastavro/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://pypi.python.org/pypi/fastavro/&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13097849">BEAM-2810</key>
            <summary>Consider a faster Avro library in Python</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="10722" iconUrl="https://issues.apache.org/jira/images/icons/statuses/generic.png" description="">Triage Needed</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rdub">Ryan Williams</assignee>
                                    <reporter username="jkff">Eugene Kirpichov</reporter>
                        <labels>
                    </labels>
                <created>Sun, 27 Aug 2017 22:11:37 +0000</created>
                <updated>Fri, 5 Jul 2024 10:32:51 +0000</updated>
                            <resolved>Tue, 10 Mar 2020 23:40:55 +0000</resolved>
                                                    <fixVersion>Not applicable</fixVersion>
                                    <component>sdk-py-core</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>8</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="24600">6h 50m</timespent>
                                <comments>
                            <comment id="16143293" author="chamikara" created="Mon, 28 Aug 2017 01:20:05 +0000"  >&lt;p&gt;I believe we considered fastavro but couldn&apos;t use it since it does not expose the byte position when reading. Not sure if the API has changed since.&lt;/p&gt;</comment>
                            <comment id="16143372" author="jkff" created="Mon, 28 Aug 2017 05:04:18 +0000"  >&lt;p&gt;It might be a good idea to fix fastavro then. Or to fix Avro. 10x performance difference would be a big deal considering how important are Avro files to Beam (esp. with Dataflow - BigQuery and materialized intermediate Avro files).&lt;/p&gt;</comment>
                            <comment id="16407532" author="debasish83" created="Wed, 21 Mar 2018 07:01:03 +0000"  >&lt;p&gt;our flow starts from bq-export/gcs avro files and 1 node sizable dataset (say 500 MB - 1 GB) to run multi-core (4/8) local pipelines will be needed for our use-case...Is it possible to expose java avro through py4j or some trick like that ? I should be able to take up the task...&lt;/p&gt;</comment>
                            <comment id="16407538" author="debasish83" created="Wed, 21 Mar 2018 07:07:15 +0000"  >&lt;p&gt;I will try reading bq from beam directly but during iterative processing, an intermediate format like avro can help...even better if parquet is supported but I did not see much support for parquet in GCP ecosystem...&lt;/p&gt;</comment>
                            <comment id="16407543" author="debasish83" created="Wed, 21 Mar 2018 07:17:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chamikara&quot; class=&quot;user-hover&quot; rel=&quot;chamikara&quot;&gt;chamikara&lt;/a&gt; did you try fastavro and pyavroc as well ? both of them did not satisfy the byte position...I should be able to add the byte position code if you let me know which library is preferred for beam...pyavroc claims to be 4X faster than fastavro...&#160;&lt;/p&gt;</comment>
                            <comment id="16407962" author="chamikara" created="Wed, 21 Mar 2018 14:11:31 +0000"  >&lt;p&gt;I only&#160;looked into fastavro. Basically, when reading files, we need to be able to&#160;read records between two arbitrary byte positions. For example, assume we want to read byte range &apos;[a,b)&apos; in an Avro file. We should be able to seek into position &apos;a&apos; and read all Avro blocks that start within this range. It&apos;s great if&#160;pyavroc supports this or&#160;pyavroc or fastavro can be modified to support this.&lt;/p&gt;

&lt;p&gt;Also, what are the cons of pyavro compared to fastavro ? Better performance is a big positive but we should also look into other factors, for example,&#160;stability of the code, how well maintained the code is, ease of deployment. See following code location for how we do this using the Apache Avro library.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/beam/blob/master/sdks/python/apache_beam/io/avroio.py#L362&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/master/sdks/python/apache_beam/io/avroio.py#L362&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16530287" author="rdub" created="Mon, 2 Jul 2018 18:29:26 +0000"  >&lt;p&gt;This is basically done&#160;since &lt;a href=&quot;https://github.com/apache/beam/pull/5496&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;#5496&lt;/a&gt; is merged: the various avroio &lt;tt&gt;PTransforms&lt;/tt&gt; all take a &lt;tt&gt;use_fastavro&lt;/tt&gt; param (default: &lt;tt&gt;False&lt;/tt&gt;).&lt;/p&gt;

&lt;p&gt;I&apos;m going to finish adding &lt;a href=&quot;https://github.com/apache/beam/pull/5496#issuecomment-399954425&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the integration test that I took out&lt;/a&gt;, so we can leave this open to cover that work as well if that makes the most sense.&lt;/p&gt;</comment>
                            <comment id="16539079" author="barrywhart" created="Tue, 10 Jul 2018 18:41:47 +0000"  >&lt;p&gt;I am a fairly frequent contributor to the fastavro library. I&apos;m happy to try and help if it needs some tweaks.&lt;/p&gt;

&lt;p&gt;FWIW, the library is pretty mature and works well for our project. It has several small changes from time to time, but generally nothing major. Probably the last big changes were late 2017, when we did some Cython work to make reads about 30% faster and writes about 2x faster.&#160;&lt;/p&gt;</comment>
                            <comment id="16545871" author="rdub" created="Mon, 16 Jul 2018 23:33:29 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=barrywhart&quot; class=&quot;user-hover&quot; rel=&quot;barrywhart&quot;&gt;barrywhart&lt;/a&gt;, it&apos;s been a breeze to work with fastavro, and it should be usable (behind a flag) in an upcoming Beam release quite soon! Definitely interested to keep the dialogue open as we&#160;depend on it more here.&lt;/p&gt;

&lt;p&gt;With &lt;a href=&quot;https://github.com/apache/beam/pull/5862&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the integration test merged&lt;/a&gt;, I think we&apos;re close to declaring victory here. Outstanding items:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;would be nice to get the OSX-installation story smoothed out&#160;(&lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-4749&quot; title=&quot;fastavro breaks macos tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-4749&quot;&gt;&lt;del&gt;BEAM-4749&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;after the integration test has been running successfully for a few weeks, and maybe once a Beam release has gone out and we&apos;ve seen real production use, we can talk about making fastavro the default; I&apos;m thinking I&apos;ll file a separate JIRA&#160;for that when appropriate.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Since those&#160;have or will have separate JIRAs,&#160;seems like we can mark this &quot;Resolved&quot;?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17056518" author="pabloem" created="Tue, 10 Mar 2020 23:40:55 +0000"  >&lt;p&gt;This has been fixed for a while, I believe.&lt;/p&gt;</comment>
                            <comment id="17056520" author="chamikara" created="Tue, 10 Mar 2020 23:46:16 +0000"  >&lt;p&gt;Yes, we use fastavro by default for Python 3.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 35 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3jby7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>