<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:45:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-2671] CreateStreamTest.testFirstElementLate validatesRunner test fails on Spark runner</title>
                <link>https://issues.apache.org/jira/browse/BEAM-2671</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;Error message:&lt;br/&gt;
Flatten.Iterables/FlattenIterables/FlatMap/ParMultiDo(Anonymous).out0: &lt;br/&gt;
Expected: iterable over [] in any order&lt;br/&gt;
     but: Not matched: &quot;late&quot;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13089452">BEAM-2671</key>
            <summary>CreateStreamTest.testFirstElementLate validatesRunner test fails on Spark runner</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="staslev">Stas Levin</assignee>
                                    <reporter username="echauchot">Etienne Chauchot</reporter>
                        <labels>
                            <label>flake</label>
                            <label>watermark</label>
                    </labels>
                <created>Mon, 24 Jul 2017 09:05:32 +0000</created>
                <updated>Wed, 24 Mar 2021 21:15:30 +0000</updated>
                            <resolved>Thu, 24 Aug 2017 06:45:43 +0000</resolved>
                                                    <fixVersion>2.2.0</fixVersion>
                                    <component>runner-spark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="16098110" author="jbonofre" created="Mon, 24 Jul 2017 09:08:58 +0000"  >&lt;p&gt;We saw that and IMHO, it should be fix for 2.1.0 RC3. I gonna take a look.&lt;/p&gt;</comment>
                            <comment id="16103868" author="jkff" created="Thu, 27 Jul 2017 20:39:21 +0000"  >&lt;p&gt;CreateStreamTest.testMultiOutputParDo() is failing as well.&lt;/p&gt;</comment>
                            <comment id="16103907" author="jkff" created="Thu, 27 Jul 2017 21:04:47 +0000"  >&lt;p&gt;It&apos;s interesting that testMultiOutputParDo succeeds if you comment out any &lt;em&gt;one&lt;/em&gt; of the PAssert&apos;s - on the main tag or the additional tag, but fails if you keep both.&lt;/p&gt;</comment>
                            <comment id="16103911" author="jkff" created="Thu, 27 Jul 2017 21:05:45 +0000"  >&lt;p&gt;Actually that test is &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-1868&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/BEAM-1868&lt;/a&gt; - does that mean it also should be fixed for 2.1.0 RC3?&lt;/p&gt;</comment>
                            <comment id="16104459" author="jkff" created="Fri, 28 Jul 2017 04:58:50 +0000"  >&lt;p&gt;I wonder if these tests have something to do with &lt;a href=&quot;https://github.com/apache/beam/commit/20820fa5477ffcdd4a9ef2e9340353ed3c5691a9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/commit/20820fa5477ffcdd4a9ef2e9340353ed3c5691a9&lt;/a&gt; (part of PR &lt;a href=&quot;https://github.com/apache/beam/pull/3343&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3343&lt;/a&gt; ) - it seems the last stable build of Spark ValidatesRunner was right before this commit &lt;a href=&quot;https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Spark/lastStableBuild/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/beam_PostCommit_Java_ValidatesRunner_Spark/lastStableBuild/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aviemzur&quot; class=&quot;user-hover&quot; rel=&quot;aviemzur&quot;&gt;aviemzur&lt;/a&gt; , could you take a look perhaps?&lt;/p&gt;</comment>
                            <comment id="16104590" author="jbonofre" created="Fri, 28 Jul 2017 07:37:54 +0000"  >&lt;p&gt;I don&apos;t think this one is blocker for RC3. It would be great to have it fixed but not blocker. I&apos;m waiting couple of hours and I will bump the issue for 2.2.0.&lt;/p&gt;</comment>
                            <comment id="16105124" author="jkff" created="Fri, 28 Jul 2017 15:42:24 +0000"  >&lt;p&gt;I&apos;m not sure about bumping it to 2.2.0. It looks quite dangerous and I&apos;d be hesitant to ignore it without checking how dangerous it actually is. Do we have other tests that verify that Spark runner does not incorrectly drop data in streaming pipelines?&lt;/p&gt;</comment>
                            <comment id="16105136" author="jbonofre" created="Fri, 28 Jul 2017 15:46:44 +0000"  >&lt;p&gt;I&apos;m doing a git bisect to identify where it has been broken. Update coming soon.&lt;/p&gt;</comment>
                            <comment id="16105918" author="jkff" created="Sat, 29 Jul 2017 00:38:01 +0000"  >&lt;p&gt;Any updates?&lt;/p&gt;</comment>
                            <comment id="16106176" author="jbonofre" created="Sat, 29 Jul 2017 16:49:15 +0000"  >&lt;p&gt;It seems that 3785b5baf4d3c47ea6625fff9babe5854e2e5fdb is the first bad commit.&lt;/p&gt;

&lt;p&gt;I&apos;m suspecting one of the following (especially the ones specific to the Spark runner):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;commit 3785b5baf4d3c47ea6625fff9babe5854e2e5fdb
Merge: e2ee595 4c48815
Author: Ahmet Altay &amp;lt;altay@google.com&amp;gt;
Date:   Thu Jun 22 10:47:00 2017 -0700

    This closes #3421

commit 4c488152c45ac7a6c344a21b67c968b97bf5066c
Author: Sourabh Bajaj &amp;lt;sourabhbajaj@google.com&amp;gt;
Date:   Thu Jun 22 08:33:31 2017 -0700

    [BEAM-1585] Fix the beam plugins installation

commit e2ee59557befd729e24e62a4991a76bab64f5755
Merge: b3099bb 22dbb50
Author: Aviem Zur &amp;lt;aviemzur@gmail.com&amp;gt;
Date:   Thu Jun 22 15:33:26 2017 +0300

    This closes #3343

commit 22dbb500289675fe95b6d149c8550e09dc26feac
Author: Aviem Zur &amp;lt;aviemzur@gmail.com&amp;gt;
Date:   Wed Jun 21 17:53:21 2017 +0300

    Move Spark runner streaming tests to post commit.

commit 20820fa5477ffcdd4a9ef2e9340353ed3c5691a9
Author: Aviem Zur &amp;lt;aviemzur@gmail.com&amp;gt;
Date:   Mon Jun 12 17:04:00 2017 +0300

    [BEAM-2359] Fix watermark broadcasting to executors in Spark runner
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m testing those commits.&lt;/p&gt;</comment>
                            <comment id="16106185" author="jkff" created="Sat, 29 Jul 2017 17:31:00 +0000"  >&lt;p&gt;It&apos;s overwhelmingly likely the last one as I mentioned above.&lt;/p&gt;

&lt;p&gt;On Sat, Jul 29, 2017, 9:50 AM Jean-Baptiste Onofr&#233; (JIRA) &amp;lt;jira@apache.org&amp;gt;&lt;/p&gt;
</comment>
                            <comment id="16106228" author="jbonofre" created="Sat, 29 Jul 2017 19:50:42 +0000"  >&lt;p&gt;Test is OK on this commit: 20820fa5477ffcdd4a9ef2e9340353ed3c5691a9.&lt;/p&gt;

&lt;p&gt;I&apos;m testing the next one.&lt;/p&gt;</comment>
                            <comment id="16106440" author="aviemzur" created="Sun, 30 Jul 2017 10:35:09 +0000"  >&lt;p&gt;CreateStreamTest has flakiness issues.&lt;br/&gt;
20820fa5477ffcdd4a9ef2e9340353ed3c5691a9&lt;br/&gt;
May have added to this element of flakiness and may have not, but we decided to move the flaky tests to Spark runner postcommit tests in 22dbb500289675fe95b6d149c8550e09dc26feac&lt;/p&gt;

&lt;p&gt;However, it appears that now the Spark runner tests are failing consistently, which IIRC was not the case.&lt;br/&gt;
The build history doesn&apos;t go far back enough to show when the tests started failing but it does keep the last successful build&lt;br/&gt;
which built the revision 3785b5baf4d3c47ea6625fff9babe5854e2e5fdb which happened after the commits mentioned above &lt;a href=&quot;https://builds.apache.org/view/Beam/job/beam_PostCommit_Java_ValidatesRunner_Spark/2446/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/Beam/job/beam_PostCommit_Java_ValidatesRunner_Spark/2446/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It appears that a commit has been made since then that makes the tests fail consistently (locally as well as on Jenkins).&lt;/p&gt;</comment>
                            <comment id="16106455" author="jbonofre" created="Sun, 30 Jul 2017 11:21:58 +0000"  >&lt;p&gt;I tested locally with a git bisect. Let me try another bisect after this commit.&lt;/p&gt;</comment>
                            <comment id="16110272" author="jbonofre" created="Wed, 2 Aug 2017 04:17:29 +0000"  >&lt;p&gt;I found the issue which cause the issue:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;commit 935c077341de580dddd4b29ffee3926795acf403
Author: Kenneth Knowles &amp;lt;klk@google.com&amp;gt;
Date:   Thu Jun 22 18:43:39 2017 -0700

    &lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt; timer firings &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a window together
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;tt&gt;CreateStreamTest&lt;/tt&gt;&#160;worked just before this commit and started to fail after this commit. I&apos;m digging around that.&lt;/p&gt;</comment>
                            <comment id="16110962" author="jbonofre" created="Wed, 2 Aug 2017 14:02:40 +0000"  >&lt;p&gt;Just to be clear. I checked out on commit 935c077341de580dddd4b29ffee3926795acf403 and ran a build with validate runner. Result is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[INFO] Running org.apache.beam.runners.spark.translation.streaming.CreateStreamTest
[ERROR] Tests run: 10, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 30.695 s &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.beam.runners.spark.translation.streaming.CreateStreamTest
[ERROR] testFirstElementLate(org.apache.beam.runners.spark.translation.streaming.CreateStreamTest)  Time elapsed: 3.198 s  &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError: 
Flatten.Iterables/FlattenIterables/FlatMap/ParMultiDo(Anonymous).out0: 
Expected: iterable over [] in any order
     but: Not matched: &lt;span class=&quot;code-quote&quot;&gt;&quot;late&quot;&lt;/span&gt;
        at org.apache.beam.sdk.testing.PAssert$PAssertionSite.capture(PAssert.java:170)
        at org.apache.beam.sdk.testing.PAssert.that(PAssert.java:366)
        at org.apache.beam.sdk.testing.PAssert.that(PAssert.java:358)
        at org.apache.beam.runners.spark.translation.streaming.CreateStreamTest.testFirstElementLate(CreateStreamTest.java:233)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;corresponding to the same failure we have on master.&lt;/p&gt;

&lt;p&gt;Now, if I checkout on the commit just before 935c077341de580dddd4b29ffee3926795acf403 (bd631b89a8434f0756e1596875e89013fb623ab5) and I do the same build, I have:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[INFO] Running org.apache.beam.runners.spark.translation.streaming.CreateStreamTest
[ERROR] Tests run: 10, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 55.192 s &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.beam.runners.spark.translation.streaming.CreateStreamTest
[ERROR] testMultipleStreams(org.apache.beam.runners.spark.translation.streaming.CreateStreamTest)  Time elapsed: 3.689 s  &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError:
WindowStrings/Flatten.PCollections.out:
Expected: iterable over [&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt;] in any order
     but: No item matches: &lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt; in []
        at org.apache.beam.sdk.testing.PAssert$PAssertionSite.capture(PAssert.java:170)
        at org.apache.beam.sdk.testing.PAssert.that(PAssert.java:366)
        at org.apache.beam.sdk.testing.PAssert.that(PAssert.java:358)
        at org.apache.beam.runners.spark.translation.streaming.CreateStreamTest.testMultipleStreams(CreateStreamTest.java:284)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, &lt;tt&gt;CreateStreamTest&lt;/tt&gt; also fails but with a different cause and on &lt;tt&gt;testMultipleStream&lt;/tt&gt; (whereas on master and on commit mentioned above, it fails on &lt;tt&gt;testFirstElementLate&lt;/tt&gt;).&lt;/p&gt;
</comment>
                            <comment id="16114481" author="jbonofre" created="Fri, 4 Aug 2017 15:04:17 +0000"  >&lt;p&gt;After a Apache Karaf release, I&apos;m back on this issue. Any help is welcome.&lt;/p&gt;</comment>
                            <comment id="16115164" author="jkff" created="Sat, 5 Aug 2017 00:33:09 +0000"  >&lt;p&gt;20820fa5477ffcdd4a9ef2e9340353ed3c5691a9, mentioned above, is the culprit.&lt;/p&gt;

&lt;p&gt;At 20820fa5, I ran the test 10 times and it failed 10/10.&lt;br/&gt;
At the previous commit b3099bba, it succeeds 10/10.&lt;/p&gt;

&lt;p&gt;However, I did git cherry-pick --reverse of that commit on top of current master branch, and the test still fails - so reverting the commit is not sufficient.&lt;/p&gt;

&lt;p&gt;Moreover, according to my understanding of its enclosing PR &lt;a href=&quot;https://github.com/apache/beam/pull/3343&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3343&lt;/a&gt;, reverting it is really not an option, because before that PR the Spark runner was completely unusable in streaming mode (not advancing input watermark). Unfortunately the PR does not seem to include any tests for the fix, but I presume it was tested manually, or perhaps gets some testing coverage from ValidatesRunner tests.&lt;/p&gt;

&lt;p&gt;I propose to postpone the current JIRA to 2.2.0, because:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Spark Runner currently passes all ValidatesRunner tests (this is not a ValidatesRunner test), so I presume that it was completely broken, we&apos;d have other evidence.&lt;/li&gt;
	&lt;li&gt;Release 2.0.0 does not contain &lt;a href=&quot;https://github.com/apache/beam/pull/3343&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3343&lt;/a&gt; which means that in that release Spark runner &lt;b&gt;is&lt;/b&gt; unusable in streaming mode, i.e. even if the current JIRA signals that it&apos;s still broken in some way, it can&apos;t be more broken than 2.0.0 - i.e. there is no regression, and there is most likely some improvement (albeit incomplete).&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="16115336" author="aviemzur" created="Sat, 5 Aug 2017 08:40:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkff&quot; class=&quot;user-hover&quot; rel=&quot;jkff&quot;&gt;jkff&lt;/a&gt; Please see the comments made by JB and myself which help demonstrate that that commit is not the issue.&lt;br/&gt;
I understand it fails on your local machine, please see the link to the last successful build on Jenkins, which includes this commit.&lt;/p&gt;

&lt;p&gt;JB has shared the commit at which master is failing with the current failure.&lt;br/&gt;
It also fails before that commit so it is hard to say that that specific commit introduced the issue, or rather a previous commit.&lt;/p&gt;</comment>
                            <comment id="16115338" author="jbonofre" created="Sat, 5 Aug 2017 08:43:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aviemzur&quot; class=&quot;user-hover&quot; rel=&quot;aviemzur&quot;&gt;aviemzur&lt;/a&gt; do we target to fix that for 2.1.0 or do we bump to 2.2.0 ? Up to you !&lt;/p&gt;</comment>
                            <comment id="16115339" author="aviemzur" created="Sat, 5 Aug 2017 08:45:57 +0000"  >&lt;p&gt;If we want streaming to be working in Spark runner in 2.1.0 we should fix this for 2.1.0&lt;br/&gt;
This was the goal of &lt;a href=&quot;https://github.com/apache/beam/pull/3343&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3343&lt;/a&gt;&lt;br/&gt;
There has been regression since.&lt;/p&gt;

&lt;p&gt;If there is a different, more important goal for this version, then we could release yet another version with streaming not working in Spark runner.&lt;/p&gt;</comment>
                            <comment id="16116469" author="jbonofre" created="Mon, 7 Aug 2017 11:43:23 +0000"  >&lt;p&gt;FYI, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=staslev&quot; class=&quot;user-hover&quot; rel=&quot;staslev&quot;&gt;staslev&lt;/a&gt; and I are working on the issue.&lt;/p&gt;</comment>
                            <comment id="16116860" author="jbonofre" created="Mon, 7 Aug 2017 17:01:13 +0000"  >&lt;p&gt;I did a new `git bisect` in the meaning of finding the first commit which change from Spark runner validate from success to failure. And here&apos;s the first one I found:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;1c1f239501349f5120b0d619c4eea9c435500b78 is the first bad commit
commit 1c1f239501349f5120b0d619c4eea9c435500b78
Author: Kenneth Knowles &amp;lt;klk@google.com&amp;gt;
Date:   Thu Jun 22 12:52:42 2017 -0700

    ReduceFnTester can advance clocks without firing timers

:040000 040000 888e75a5513b7171cb924d3c9b883a42ee59f045 6b6ea07557d0d57a9849afec02e1555e3f1d1334 M      runners
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16117127" author="jbonofre" created="Mon, 7 Aug 2017 19:36:55 +0000"  >&lt;p&gt;Actually, as the test is flacky, it makes &lt;tt&gt;git bisect&lt;/tt&gt; not accurate. I do a new one with several run to be sure.&lt;/p&gt;</comment>
                            <comment id="16117469" author="jkff" created="Mon, 7 Aug 2017 22:42:41 +0000"  >&lt;p&gt;Aviem - my apologies for misunderstanding previous comments on the JIRA. Could you elaborate on &quot;If we want streaming to be working in Spark runner in 2.1.0 we should fix this for 2.1.0&quot; - I&apos;d like to understand to what extent is Spark runner streaming currently broken in 2.1.0, given that it passes the other SDK ValidatesRunner tests. Are those tests insufficient / should we have more coverage there?&lt;/p&gt;

&lt;p&gt;Has anybody run any serious Spark streaming pipelines on a cluster against 2.1.0 RC2? JB - I believe you said you did; can you detail what kind of pipeline you ran, and does it potentially address Aviem&apos;s concerns?&lt;/p&gt;</comment>
                            <comment id="16117523" author="kenn" created="Mon, 7 Aug 2017 23:09:35 +0000"  >&lt;p&gt;It is entirely possible that 935c077341de580dddd4b29ffee3926795acf403 could expose existing bugs in timer handling. In particular, it changes window GC from being based on the target time of the timer to being based on the watermark. So it might turn a race condition causing flakiness into a guaranteed early GC. (I haven&apos;t looked more closely yet)&lt;/p&gt;</comment>
                            <comment id="16117853" author="jbonofre" created="Tue, 8 Aug 2017 04:50:45 +0000"  >&lt;p&gt;I bump this to 2.2.0 and I will cut RC3 as it is. Yes, I ran streaming pipelines with 2.1.0-SNAPSHOT: it&apos;s not very complex but it worked (reading from JMS, doing a ParDo(DoFn) and writing the result to sharded TextIO).&lt;/p&gt;</comment>
                            <comment id="16118355" author="echauchot" created="Tue, 8 Aug 2017 13:58:49 +0000"  >&lt;p&gt;I think Nexmark (&lt;a href=&quot;https://github.com/apache/beam/pull/3114&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3114&lt;/a&gt;) can be of great help here. It has a very comprehensive test suite in both batch and streaming modes. I&apos;ll run the Nexmark test suite for Spark streaming against v2.1.0-RC2 and keep you posted.&lt;/p&gt;</comment>
                            <comment id="16118451" author="aviemzur" created="Tue, 8 Aug 2017 15:16:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkff&quot; class=&quot;user-hover&quot; rel=&quot;jkff&quot;&gt;jkff&lt;/a&gt; we&apos;ve been running Spark runner in streaming mode using 2.0.0 &lt;br/&gt;
We&apos;ve encountered the issue with the watermarks not advancing which was a no-go for us, since results were not emitted and eventually apps failed on out of memory exceptions. This was the reason for the fix in &lt;a href=&quot;https://github.com/apache/beam/pull/3343&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3343&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;After integrating this fix (on our local fork) we were able to run applications successfully.&lt;br/&gt;
Regarding running the current state of master, we are not, so hard to comment on if the failing tests cause real applications to fail, this will have to be assessed. What we do know is the tests are failing.&lt;/p&gt;

&lt;p&gt;Regarding ValidatesRunner tests, while these do pass, IIRC the creation of the streaming tests for Spark runner were in fact due to insufficient tests for Spark runner&apos;s streaming mode. So while they are not perfect and flaky, they do provide value. Perhaps &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=amitsela&quot; class=&quot;user-hover&quot; rel=&quot;amitsela&quot;&gt;amitsela&lt;/a&gt; can elaborate on these tests.&lt;/p&gt;</comment>
                            <comment id="16124897" author="staslev" created="Sun, 13 Aug 2017 11:40:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kenn&quot; class=&quot;user-hover&quot; rel=&quot;kenn&quot;&gt;kenn&lt;/a&gt;, could you elaborate on when there might be a race, and what triggers will be involved in such a race?&lt;/p&gt;</comment>
                            <comment id="16127927" author="kenn" created="Tue, 15 Aug 2017 21:51:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=staslev&quot; class=&quot;user-hover&quot; rel=&quot;staslev&quot;&gt;staslev&lt;/a&gt; previously, timers were each processed separately. The state for a window was cleared when a timer arrived with timestamp == GC time.  This was actually wrong relative to the spec, and led to the wrong number of outputs in some situations where the end-of-window and GC timer came in the same bundle. You&apos;d get multiple outputs (which is OK but wasteful) but they would be labeled wrong about whether they are the first or final output.&lt;/p&gt;

&lt;p&gt;Now, timers for a window&apos;s lifecycle are processed all at once. In fact, the timers themselves are irrelevant. When they arrive, the window is &quot;activated&quot; and the state for the window is cleared if the watermark is far enough along that the window is expired. All the PaneInfo is automatically fixed for the corner cases about when the EOW and GC timers come together or very delayed, etc.&lt;/p&gt;

&lt;p&gt;Technically, the GC timer should only ever be delivered when the watermark is that far along, so the actual GC time is the same.&lt;/p&gt;

&lt;p&gt;If a runner was delivering the GC timer early, then it would have worked in the old logic, but won&apos;t GC in the new logic. If a timer comes in with timestamp == GC time but the watermark is actually not far enough along to safely GC, it will not cause a GC. It would be a bug to deliver that timer, and could cause other erroneous results due to early clearing of state - data would come in, would not be dropped, and would then be output. But mostly it would be rare to see the failure. Now you&apos;d see it all the time.&lt;/p&gt;</comment>
                            <comment id="16129000" author="reuvenlax" created="Wed, 16 Aug 2017 16:06:17 +0000"  >&lt;p&gt;Given how long 2.1.0 has taken to release, I suspect we&apos;ll cut 2.2.0 immediately after 2.1.0 is approved. Given that, is it reasonable to fix this for 2.2.0?&lt;/p&gt;</comment>
                            <comment id="16129014" author="staslev" created="Wed, 16 Aug 2017 16:12:34 +0000"  >&lt;p&gt;I believe I&apos;ve been able to pinpoint the problem and am working towards a fix.&lt;br/&gt;
In case my hypothesis is correct hopefully I&apos;ll be able to resolve this within a week or so time (estimations, estimations...) - I&apos;ll keep this thread updated with the findings.&lt;/p&gt;</comment>
                            <comment id="16134569" author="githubbot" created="Sun, 20 Aug 2017 21:10:07 +0000"  >&lt;p&gt;GitHub user staslev opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/3738&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3738&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-2671&quot; title=&quot;CreateStreamTest.testFirstElementLate validatesRunner test fails on Spark runner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-2671&quot;&gt;&lt;del&gt;BEAM-2671&lt;/del&gt;&lt;/a&gt; Fixing CreateStreamTest#testFirstElementLate&lt;/p&gt;

&lt;p&gt;    Follow this checklist to help us incorporate your contribution quickly and easily:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Make sure there is a &lt;span class=&quot;error&quot;&gt;&amp;#91;JIRA issue&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://issues.apache.org/jira/projects/BEAM/issues/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/projects/BEAM/issues/&lt;/a&gt;) filed for the change (usually before you start working on it).  Trivial changes like typos do not require a JIRA issue.  Your pull request should address just this issue, without pulling in other changes.&lt;/li&gt;
	&lt;li&gt;[ ] Each commit in the pull request should have a meaningful subject line and body.&lt;/li&gt;
	&lt;li&gt;[ ] Format the pull request title like `&lt;span class=&quot;error&quot;&gt;&amp;#91;BEAM-XXX&amp;#93;&lt;/span&gt; Fixes bug in ApproximateQuantiles`, where you replace `BEAM-XXX` with the appropriate JIRA issue.&lt;/li&gt;
	&lt;li&gt;[ ] Write a pull request description that is detailed enough to understand what the pull request does, how, and why.&lt;/li&gt;
	&lt;li&gt;[ ] Run `mvn clean verify` to make sure basic checks pass. A more thorough check will be performed on your pull request automatically.&lt;/li&gt;
	&lt;li&gt;[ ] If this contribution is large, please file an Apache &lt;span class=&quot;error&quot;&gt;&amp;#91;Individual Contributor License Agreement&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.apache.org/licenses/icla.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.apache.org/licenses/icla.pdf&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    &amp;#8212;&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/staslev/beam&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/staslev/beam&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-2671&quot; title=&quot;CreateStreamTest.testFirstElementLate validatesRunner test fails on Spark runner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-2671&quot;&gt;&lt;del&gt;BEAM-2671&lt;/del&gt;&lt;/a&gt;-fixing-CreateStreamTest#testFirstElementLate&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/3738.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3738.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3738&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 940e7a159428f18c40a001e34ebcf3e847329f3f&lt;br/&gt;
Author: Stas Levin &amp;lt;staslevin@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-08-20T13:48:57Z&lt;/p&gt;

&lt;p&gt;    Implemented an InputDStream that syncs up with the watermark values, this should help with streaming tests in spark-runner.&lt;/p&gt;

&lt;p&gt;commit 1571ea668dac45d3db6a59a5bdf2e3af43120870&lt;br/&gt;
Author: Stas Levin &amp;lt;staslevin@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-08-20T18:54:52Z&lt;/p&gt;

&lt;p&gt;    Fixed failing SparkPipelineStateTest tests.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16139642" author="githubbot" created="Thu, 24 Aug 2017 06:44:05 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/3738&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3738&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 12 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3hx2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>