<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:40:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-769] Spark streaming tests fail on &quot;nothing processed&quot; if runtime env. is slow because timeout is hit before processing is done.</title>
                <link>https://issues.apache.org/jira/browse/BEAM-769</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/beam_PostCommit_MavenVerify/1586/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/beam_PostCommit_MavenVerify/1586/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/beam_PostCommit_MavenVerify/1587/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/beam_PostCommit_MavenVerify/1587/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/beam_PostCommit_MavenVerify/1588/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/beam_PostCommit_MavenVerify/1588/&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.beam.runners.spark.translation.streaming.FlattenStreamingTest.testFlattenUnbounded
org.apache.beam.runners.spark.translation.streaming.KafkaStreamingTest.testRun
org.apache.beam.runners.spark.translation.streaming.SimpleStreamingWordCountTest.testFixedWindows
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The above tests use a hard-timeout (ungraceful stop) so if the runtime env. is slow enough so that the batch is not done, it&apos;ll stop anyway and assert and rightfully fail.&lt;br/&gt;
It&apos;s difficult to create locally because I never had trouble on my laptop.&lt;/p&gt;

&lt;p&gt;Since Jenkins will be slow from time to time, it is reasonable enough to have a more robust solution here :&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;don&apos;t use checkpoint (Spark) if not necessary - only really necessary for one test in &lt;tt&gt;KafkaStreamingTest&lt;/tt&gt; and &lt;tt&gt;ResumeFromCheckpointStreamingTest&lt;/tt&gt; I think.&lt;/li&gt;
	&lt;li&gt;allow for graceful stop - will take longer for each test, but should allow the test to finish even if runtime env. is slow.&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment></environment>
        <key id="13013258">BEAM-769</key>
            <summary>Spark streaming tests fail on &quot;nothing processed&quot; if runtime env. is slow because timeout is hit before processing is done.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="amitsela">Amit Sela</assignee>
                                    <reporter username="dhalperi">Dan Halperin</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Oct 2016 17:42:00 +0000</created>
                <updated>Sat, 16 May 2020 13:46:54 +0000</updated>
                            <resolved>Mon, 7 Nov 2016 15:46:38 +0000</resolved>
                                    <version>Not applicable</version>
                                    <fixVersion>0.4.0</fixVersion>
                                    <component>runner-spark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15586248" author="jasonkuster" created="Tue, 18 Oct 2016 18:26:08 +0000"  >&lt;p&gt;This also seems to have caused a postcommit failure:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/beam_PostCommit_MavenVerify/1567/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/beam_PostCommit_MavenVerify/1567/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15586335" author="amitsela" created="Tue, 18 Oct 2016 18:58:10 +0000"  >&lt;p&gt;From my experience those failures happen when a &quot;bad&quot; context is reused - since the context is reused in Spark tests, if it failed and closed for some reason, it will try to keep reusing that closed context, and that&apos;s how it manifests.&lt;br/&gt;
I fixed this while working on &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-259&quot; title=&quot;Execute selected RunnableOnService tests with Spark runner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-259&quot;&gt;&lt;del&gt;BEAM-259&lt;/del&gt;&lt;/a&gt;, this is the fix: &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/1055/files#diff-cdc52a99e44ad1b6d1950ecab0928ecd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-beam/pull/1055/files#diff-cdc52a99e44ad1b6d1950ecab0928ecd&lt;/a&gt;.&lt;br/&gt;
I could patch this up as part of this ticket, because &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-259&quot; title=&quot;Execute selected RunnableOnService tests with Spark runner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-259&quot;&gt;&lt;del&gt;BEAM-259&lt;/del&gt;&lt;/a&gt; is still in review, but it will be tomorrow morning (IDT).&lt;/p&gt;</comment>
                            <comment id="15588301" author="amitsela" created="Wed, 19 Oct 2016 10:23:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kenn&quot; class=&quot;user-hover&quot; rel=&quot;kenn&quot;&gt;kenn&lt;/a&gt; do you think PR#1055 will be ready for merge soon ?&lt;/p&gt;

&lt;p&gt;I would generally fix such issue immediately, but it&apos;s flakey, only happens if something failed (unexpectedly) and will cause a &quot;domino effect&quot; on following tests, so I might wait for PR#1055 if we can merge it soon.&lt;/p&gt;</comment>
                            <comment id="15590064" author="amitsela" created="Wed, 19 Oct 2016 22:29:22 +0000"  >&lt;p&gt;Merging &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-259&quot; title=&quot;Execute selected RunnableOnService tests with Spark runner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-259&quot;&gt;&lt;del&gt;BEAM-259&lt;/del&gt;&lt;/a&gt; which should resolve this, I&apos;ll wait a day or two to see it does and then close this ticket as duplicate.&lt;/p&gt;</comment>
                            <comment id="15592641" author="dhalperi@google.com" created="Thu, 20 Oct 2016 18:48:42 +0000"  >&lt;p&gt;Looks like it has not been resolved yet. There are 3 more flakes today that include the fix referenced in &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-259&quot; title=&quot;Execute selected RunnableOnService tests with Spark runner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-259&quot;&gt;&lt;del&gt;BEAM-259&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/beam_PostCommit_MavenVerify/1586/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/beam_PostCommit_MavenVerify/1586/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/beam_PostCommit_MavenVerify/1587/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/beam_PostCommit_MavenVerify/1587/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/beam_PostCommit_MavenVerify/1588/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/beam_PostCommit_MavenVerify/1588/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Can you take another look?&lt;/p&gt;</comment>
                            <comment id="15592682" author="amitsela" created="Thu, 20 Oct 2016 19:02:07 +0000"  >&lt;p&gt;Yeah I&apos;ve noticed, if you look closely you&apos;ll see that it&apos;s not NPE anymore.&lt;br/&gt;
The problem seems to be Jenkins being horribly slow; Spark streaming tests have a timeout, and if nothing was processed until a hard timeout was reached, it&apos;ll rightfully fail.&lt;/p&gt;

&lt;p&gt;I&apos;ll change the ticket accordingly.&lt;/p&gt;

&lt;p&gt;I can set a graceful stop - meaning that the test will finish any currently processing batches - but that&apos;ll make those tests run X2 or even X3 longer most of the time.&lt;/p&gt;

&lt;p&gt;Thoughts ?&lt;/p&gt;</comment>
                            <comment id="15593215" author="amitsela" created="Thu, 20 Oct 2016 22:23:56 +0000"  >&lt;p&gt;Got this ready: &lt;a href=&quot;https://github.com/amitsela/incubator-beam/tree/BEAM-769&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/amitsela/incubator-beam/tree/BEAM-769&lt;/a&gt; but it might require further attention after &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/1143&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-beam/pull/1143&lt;/a&gt; is merged so I&apos;ll hold off on it.&lt;/p&gt;</comment>
                            <comment id="15595461" author="lcwik" created="Fri, 21 Oct 2016 15:40:30 +0000"  >&lt;p&gt;I would prefer a bigger timeout over having flaky tests if we couldn&apos;t make it deterministic in some way. If a test never flakes, people won&apos;t have to look at it.&lt;/p&gt;</comment>
                            <comment id="15597560" author="amitsela" created="Sat, 22 Oct 2016 09:55:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lcwik&quot; class=&quot;user-hover&quot; rel=&quot;lcwik&quot;&gt;lcwik&lt;/a&gt; I agree, I&apos;ll commit and update &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/1143&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-beam/pull/1143&lt;/a&gt; accordingly.&lt;br/&gt;
Since this is hard to replicate locally, it&apos;s best to give it a try on Jenkins ASAP.&lt;/p&gt;</comment>
                            <comment id="15597565" author="githubbot" created="Sat, 22 Oct 2016 09:58:38 +0000"  >&lt;p&gt;GitHub user amitsela opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/1161&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-beam/pull/1161&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-769&quot; title=&quot;Spark streaming tests fail on &amp;quot;nothing processed&amp;quot; if runtime env. is slow because timeout is hit before processing is done.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-769&quot;&gt;&lt;del&gt;BEAM-769&lt;/del&gt;&lt;/a&gt; Spark streaming tests fail on &quot;nothing processed&quot; if runti&#8230;&lt;/p&gt;

&lt;p&gt;    Be sure to do all of the following to help us incorporate your contribution&lt;br/&gt;
    quickly and easily:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Make sure the PR title is formatted like:&lt;br/&gt;
       `&lt;a href=&quot;#&amp;gt;&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;BEAM-&amp;lt;Jira issue #&amp;gt;&lt;/a&gt; Description of pull request`&lt;/li&gt;
	&lt;li&gt;[ ] Make sure tests pass via `mvn clean verify`. (Even better, enable&lt;br/&gt;
           Travis-CI on your fork and ensure the whole test matrix passes).&lt;/li&gt;
	&lt;li&gt;[ ] Replace `&amp;lt;Jira issue #&amp;gt;` in the title with the actual Jira issue&lt;br/&gt;
           number, if there is one.&lt;/li&gt;
	&lt;li&gt;[ ] If this contribution is large, please file an Apache&lt;br/&gt;
           &lt;span class=&quot;error&quot;&gt;&amp;#91;Individual Contributor License Agreement&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.apache.org/licenses/icla.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.apache.org/licenses/icla.txt&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    &amp;#8212;&lt;/p&gt;

&lt;p&gt;    &#8230;me env. is slow because timeout&lt;/p&gt;

&lt;p&gt;    is hit before processing is done.&lt;/p&gt;

&lt;p&gt;    Make graceful stop the default.&lt;/p&gt;

&lt;p&gt;    Keep &quot;pumping-in&quot; the last batch in a mocked stream to handle overflowing batches in case of a&lt;br/&gt;
    graceful stop.&lt;/p&gt;

&lt;p&gt;    Change tests accordingly.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/amitsela/incubator-beam&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/amitsela/incubator-beam&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-769&quot; title=&quot;Spark streaming tests fail on &amp;quot;nothing processed&amp;quot; if runtime env. is slow because timeout is hit before processing is done.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-769&quot;&gt;&lt;del&gt;BEAM-769&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/1161.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-beam/pull/1161.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1161&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 43c9e57ad8c7af022ba2f46ce4b8d20731f0766e&lt;br/&gt;
Author: Sela &amp;lt;ansela@paypal.com&amp;gt;&lt;br/&gt;
Date:   2016-10-20T22:20:33Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-769&quot; title=&quot;Spark streaming tests fail on &amp;quot;nothing processed&amp;quot; if runtime env. is slow because timeout is hit before processing is done.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-769&quot;&gt;&lt;del&gt;BEAM-769&lt;/del&gt;&lt;/a&gt; Spark streaming tests fail on &quot;nothing processed&quot; if runtime env. is slow because timeout&lt;br/&gt;
    is hit before processing is done.&lt;/p&gt;

&lt;p&gt;    Make graceful stop the default.&lt;/p&gt;

&lt;p&gt;    Keep &quot;pumping-in&quot; the last batch in a mocked stream to handle overflowing batches in case of a&lt;br/&gt;
    graceful stop.&lt;/p&gt;

&lt;p&gt;    Change tests accordingly.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15602089" author="githubbot" created="Mon, 24 Oct 2016 14:08:14 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/1161&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-beam/pull/1161&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15644527" author="amitsela" created="Mon, 7 Nov 2016 15:46:38 +0000"  >&lt;p&gt;This is generally resolved.&lt;br/&gt;
Flakes in streaming tests could still occur, but providing a truly robust solution is a part of implementing triggers.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i351rz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>