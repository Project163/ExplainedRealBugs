<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:18:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-9487] GBKs on unbounded pcolls with global windows and no triggers should fail</title>
                <link>https://issues.apache.org/jira/browse/BEAM-9487</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;This, according to &quot;4.2.2.1 GroupByKey and unbounded PCollections&quot; in &lt;a href=&quot;https://beam.apache.org/documentation/programming-guide/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://beam.apache.org/documentation/programming-guide/&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If you do apply GroupByKey or CoGroupByKey to a group of unbounded PCollections without setting either a non-global windowing strategy, a trigger strategy, or both for each collection, Beam generates an IllegalStateException error at pipeline construction time.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Example where this doesn&apos;t happen in Python SDK: &lt;a href=&quot;https://stackoverflow.com/questions/60623246/merge-pcollection-with-apache-beam&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/60623246/merge-pcollection-with-apache-beam&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I also believe that this unit test should fail, since test_stream is unbounded, uses global window, and has no triggers.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  def test_global_window_gbk_fail(self):
    with TestPipeline() as p:
      test_stream = TestStream()
      _ = p | test_stream | GroupByKey()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13291133">BEAM-9487</key>
            <summary>GBKs on unbounded pcolls with global windows and no triggers should fail</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10101" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">P1</priority>
                        <status id="10722" iconUrl="https://issues.apache.org/jira/images/icons/statuses/generic.png" description="">Triage Needed</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zhoufek">Zachary Houfek</assignee>
                                    <reporter username="udim">Udi Meiri</reporter>
                        <labels>
                            <label>EaseOfUse</label>
                            <label>starter</label>
                    </labels>
                <created>Wed, 11 Mar 2020 16:55:45 +0000</created>
                <updated>Thu, 13 Apr 2023 11:05:51 +0000</updated>
                            <resolved>Tue, 19 Oct 2021 17:23:34 +0000</resolved>
                                                    <fixVersion>2.34.0</fixVersion>
                                    <component>sdk-py-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="138000">38h 20m</timespent>
                                <comments>
                            <comment id="17057217" author="udim" created="Wed, 11 Mar 2020 17:01:53 +0000"  >&lt;p&gt;Note that the above unit test doesn&apos;t hang as expected, probably due to how TestStream is implemented.&lt;/p&gt;</comment>
                            <comment id="17122364" author="beamjirabot" created="Tue, 2 Jun 2020 04:13:28 +0000"  >&lt;p&gt;This issue is P2 but has been unassigned without any comment for 60 days so it has been labeled &quot;stale-P2&quot;. If this issue is still affecting you, we care! Please comment and remove the label. Otherwise, in 14 days the issue will be moved to P3.&lt;/p&gt;

&lt;p&gt;Please see &lt;a href=&quot;https://beam.apache.org/contribute/jira-priorities/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://beam.apache.org/contribute/jira-priorities/&lt;/a&gt; for a detailed explanation of what these priorities mean.&lt;/p&gt;</comment>
                            <comment id="17136869" author="beamjirabot" created="Tue, 16 Jun 2020 17:24:18 +0000"  >&lt;p&gt;This issue was marked &quot;stale-P2&quot; and has not received a public comment in 14 days. It is now automatically moved to P3. If you are still affected by it, you can comment and move it back to P2.&lt;/p&gt;</comment>
                            <comment id="17339802" author="zhoufek" created="Wed, 5 May 2021 17:36:06 +0000"  >&lt;p&gt;I had an offline conversation with Ahmet, and he said that this would be a good starter task for me, so I&apos;ve assigned it to myself.&lt;/p&gt;</comment>
                            <comment id="17340223" author="zhoufek" created="Thu, 6 May 2021 13:50:55 +0000"  >&lt;p&gt;Comparing the Java and Python code, it seems Python is missing more checks than just the unbounded, global window, no trigger check. The Java code has various checks for things like trigger safety and making sure that the coder is deterministic,&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; whereas the Python SDK just skips to the final step without doing any validation.&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; I think it might be worth fixing all of these, not just the one that inspired this issue. I&apos;m guessing that, sooner or later, someone will encounter the other cases as well.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/beam/blob/243128a8fc52798e1b58b0cf1a271d95ee7aa241/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/GroupByKey.java#L211&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/243128a8fc52798e1b58b0cf1a271d95ee7aa241/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/GroupByKey.java#L211&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;&#160;&lt;a href=&quot;https://github.com/apache/beam/blob/87e11644c44a4c677ec2faa78f50cdffbb33605a/sdks/python/apache_beam/transforms/core.py#L2316&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/87e11644c44a4c677ec2faa78f50cdffbb33605a/sdks/python/apache_beam/transforms/core.py#L2316&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17343438" author="udim" created="Wed, 12 May 2021 18:20:47 +0000"  >&lt;p&gt;Regarding deterministic coder checking, this is done in a couple of places (or more?):&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/beam/blob/51b37d885da67b9f0fb91e61b7be2b9598c6c947/sdks/python/apache_beam/runners/dataflow/dataflow_runner.py#L838&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/51b37d885da67b9f0fb91e61b7be2b9598c6c947/sdks/python/apache_beam/runners/dataflow/dataflow_runner.py#L838&lt;/a&gt; (and in direct runner)&lt;/p&gt;

&lt;p&gt;and via the PValue.requires_deterministic_key_coder attribute.&lt;/p&gt;

&lt;p&gt;Note that the pipeline might still run with a non-deterministic coder, but the coder should fail at runtime with an error (&quot;Unable to deterministically encode ...&quot;).&lt;/p&gt;</comment>
                            <comment id="17347686" author="zhoufek" created="Wed, 19 May 2021 13:32:50 +0000"  >&lt;p&gt;Thanks for the explanation. I also now see that there are some tests in place for deterministic coders, including one where nondeterministic ones are allowed.&lt;/p&gt;

&lt;p&gt;Anyways, the initial issue has been resolved. I still want to add a check for unsafe triggers.&lt;/p&gt;</comment>
                            <comment id="17355067" author="zhoufek" created="Tue, 1 Jun 2021 12:23:11 +0000"  >&lt;p&gt;PR14857 adds a check for unsafe triggers. I think we can mark this as resolved.&lt;/p&gt;</comment>
                            <comment id="17361924" author="altay" created="Fri, 11 Jun 2021 17:41:34 +0000"  >&lt;p&gt;Folks, is this a backwards incompatible change? Should we change the default to True for a few releases with a warning?&lt;/p&gt;</comment>
                            <comment id="17361939" author="zhoufek" created="Fri, 11 Jun 2021 18:16:56 +0000"  >&lt;p&gt;Yes, PR14857 is backwards incompatible. I was thinking that would be captured in CHANGES.md whenever it was updated. However, we could set --allow_unsafe_triggers to True for the time being. Is there a particularly release where we&apos;d want to set the default back to False?&lt;/p&gt;

&lt;p&gt;As for PR14780, I don&apos;t think it will break any pipelines, as my understanding is that it is simply shifting the point of failure and making it easier to see, but considering we had some internal tests that broke from it, it might break some tests. Should we also disable it by default for the time being?&lt;/p&gt;</comment>
                            <comment id="17361945" author="altay" created="Fri, 11 Jun 2021 18:32:54 +0000"  >&lt;p&gt;&amp;gt; I was thinking that would be captured in CHANGES.md whenever it was updated.&lt;/p&gt;

&lt;p&gt;Great idea.&lt;/p&gt;

&lt;p&gt;&amp;gt; However, we could set --allow_unsafe_triggers to True for the time being.&lt;/p&gt;

&lt;p&gt;+1 to this, because I think we will break some customer using automation. It is hard for some customer to add new flags quickly because they have complicated setups. (airflow based setups usually have this complication for beam jobs.)&lt;/p&gt;

&lt;p&gt;&amp;gt; Is there a particularly release where we&apos;d want to set the default back to False?&lt;/p&gt;

&lt;p&gt;We typically allow for 2 releases after introducing the new flag. So if the flag will be first available in 2.31, we can switch the default in 2.33. What do you think?&lt;/p&gt;

&lt;p&gt;&amp;gt; As for PR14780, I don&apos;t think it will break any pipelines, as my understanding is that it is simply shifting the point of failure and making it easier to see, but considering we had some internal tests that broke from it, it might break some tests. Should we also disable it by default for the time being?&lt;/p&gt;

&lt;p&gt;It make sense to switch to default for the time being. If we caught issues in our tests, it will very likely cause some user pipelines to break. (And plenty of warnings in CHANGES.md, and in the code warning about upcoming changes.)&lt;/p&gt;</comment>
                            <comment id="17361998" author="zhoufek" created="Fri, 11 Jun 2021 19:20:09 +0000"  >&lt;p&gt;Ok, I&apos;ll get a PR in that changes the default.&lt;/p&gt;

&lt;p&gt;Another thing I remember is that the trigger safety check was implemented by adding an abstract method to TriggerFn. Would it make sense to make it non-abstract until Beam 2.33? I&apos;m not sure if custom triggers are supported.&lt;/p&gt;</comment>
                            <comment id="17363904" author="apilloud" created="Tue, 15 Jun 2021 20:31:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/beam/pull/15003&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/15003&lt;/a&gt;&#160;is a release blocker for 2.31.0.&lt;/p&gt;</comment>
                            <comment id="17425155" author="zhoufek" created="Wed, 6 Oct 2021 18:55:30 +0000"  >&lt;p&gt;Reopening until &lt;a href=&quot;https://github.com/apache/beam/pull/15603&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR15603&lt;/a&gt; is merged.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 5 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0cfiw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>