<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:05:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-9075] Join re-ordering doesn&apos;t work for ZetaSQL</title>
                <link>https://issues.apache.org/jira/browse/BEAM-9075</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;Join re-ordering can actually break queries in the ZetaSQL planner because Calcite&apos;s JoinCommuteRule doesn&apos;t work when schemas have nested fields. It only adjusts RexInputRef nodes and not RexFieldAccess.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13278343">BEAM-9075</key>
            <summary>Join re-ordering doesn&apos;t work for ZetaSQL</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10103" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">P3</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="bhulette">Brian Hulette</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Jan 2020 02:39:44 +0000</created>
                <updated>Sat, 4 Jun 2022 15:25:57 +0000</updated>
                                            <version>2.17.0</version>
                                                    <component>dsl-sql-zetasql</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="6600">1h 50m</timespent>
                                <comments>
                            <comment id="17013274" author="bhulette" created="Fri, 10 Jan 2020 23:49:33 +0000"  >&lt;p&gt;In order to disable struct flattening in Calcite we need to make this line &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; optional. According to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=amaliujia&quot; class=&quot;user-hover&quot; rel=&quot;amaliujia&quot;&gt;amaliujia&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; we can comment out that line and run calcite tests to find 25 test failures pointing us to the rules that need to be fixed.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/calcite/blob/master/core/src/main/java/org/apache/calcite/prepare/PlannerImpl.java#L257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/calcite/blob/master/core/src/main/java/org/apache/calcite/prepare/PlannerImpl.java#L257&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://lists.apache.org/thread.html/89e37ebf18aac1f1783c2affb3d2162231e10889c7c4d11cded325c7%40%3Cdev.calcite.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread.html/89e37ebf18aac1f1783c2affb3d2162231e10889c7c4d11cded325c7%40%3Cdev.calcite.apache.org%3E&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17015336" author="amaliujia" created="Tue, 14 Jan 2020 19:18:38 +0000"  >&lt;p&gt;Thanks Brian. &lt;/p&gt;

&lt;p&gt;To clarify, currently we just temporally rolled back the change that caused the break. We need to further work on it to solve the break from root.&lt;/p&gt;

&lt;p&gt;The fix will likely be related to how will we want to support struct or nested struct in ZetaSQL planner.&lt;/p&gt;</comment>
                            <comment id="17015348" author="bhulette" created="Tue, 14 Jan 2020 19:35:27 +0000"  >&lt;p&gt;Yes so we have two options to resolve this:&lt;br/&gt;
1) Make sure JoinCommuteRule (and ideally all calcite rules) work with non flattened schemas, or&lt;br/&gt;
2) Flatten schemas when using the ZetaSQL planner&lt;/p&gt;

&lt;p&gt;I provided some details on how to do (1) in my first comment, I&apos;ll defer to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=amaliujia&quot; class=&quot;user-hover&quot; rel=&quot;amaliujia&quot;&gt;amaliujia&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apilloud&quot; class=&quot;user-hover&quot; rel=&quot;apilloud&quot;&gt;apilloud&lt;/a&gt; to assess how feasible (2) is.&lt;/p&gt;</comment>
                            <comment id="17015357" author="amaliujia" created="Tue, 14 Jan 2020 19:45:25 +0000"  >&lt;p&gt;Regarding to your option 2), we can reuse Calcite&apos;s struct flattener. However, when we really want to start to support Struct, and deep nested Struct, I will expect we need submit patches about struct flattener to Calcite to handle all corner cases (or we build in-house solution to avoid slower code review process in Calcite repo). Option 2) is not a clean solution with less trouble as I am seeing it now.&lt;/p&gt;</comment>
                            <comment id="17016080" author="bhulette" created="Wed, 15 Jan 2020 15:24:40 +0000"  >&lt;p&gt;I looked into option 1). It&apos;s easy to just fix JoinCommuteRule, but I think the patch is unlikely to be accepted in Calcite unless its part of a larger change to add a flag for disabling struct flattening. To that end, I also looked into the 29 test failures that result from removing PlannerImpl:257, in order to identify the other rules that need to be updated. But as someone new to the Calcite codebase I had a hard time figuring out what needed to be fixed to resolve the failures.&lt;/p&gt;

&lt;p&gt;There is another option that we had discussed offline: 3) Fork our own JoinCommuteRule that supports non-flattened structs.&lt;/p&gt;

&lt;p&gt;Its not a great solution, but maybe something we should do anyway given that everything else will have us waiting on a Calcite release.&lt;/p&gt;</comment>
                            <comment id="17090675" author="bhulette" created="Thu, 23 Apr 2020 15:00:21 +0000"  >&lt;p&gt;Marking this as blocked by Calcite 1.22.0 upgrade since there was some indication it will be easier to resolve after that.&lt;/p&gt;</comment>
                            <comment id="17142287" author="beamjirabot" created="Mon, 22 Jun 2020 17:24:15 +0000"  >&lt;p&gt;This issue is P2 but has been unassigned without any comment for 60 days so it has been labeled &quot;stale-P2&quot;. If this issue is still affecting you, we care! Please comment and remove the label. Otherwise, in 14 days the issue will be moved to P3.&lt;/p&gt;

&lt;p&gt;Please see &lt;a href=&quot;https://beam.apache.org/contribute/jira-priorities/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://beam.apache.org/contribute/jira-priorities/&lt;/a&gt; for a detailed explanation of what these priorities mean.&lt;/p&gt;</comment>
                            <comment id="17152186" author="beamjirabot" created="Mon, 6 Jul 2020 17:24:35 +0000"  >&lt;p&gt;This issue was marked &quot;stale-P2&quot; and has not received a public comment in 14 days. It is now automatically moved to P3. If you are still affected by it, you can comment and move it back to P2.&lt;/p&gt;</comment>
                            <comment id="17473868" author="kenn" created="Wed, 12 Jan 2022 03:50:16 +0000"  >&lt;p&gt;This Jira ticket has a pull request attached to it, but is still open. Did the pull request resolve the issue? If so, could you please mark it resolved? This will help the project have a clear view of its open issues.&lt;/p&gt;</comment>
                            <comment id="17548445" author="JIRAUSER282469" created="Sat, 4 Jun 2022 15:25:57 +0000"  >&lt;p&gt;This issue has been migrated to &lt;a href=&quot;https://github.com/apache/beam/issues/20077&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/issues/20077&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="13287373">BEAM-9379</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 23 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ablk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>