<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:56:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-6545] NPE when decoding null base 64 strings</title>
                <link>https://issues.apache.org/jira/browse/BEAM-6545</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;**ByteArrayShufflePosition.fromBase64 is marked with a @Nullable argument, however it does not properly handle null inputs resulting in NPE.&lt;/p&gt;

&lt;p&gt;This seems like an unintended change we picked up from the dependency:&#160;google-http-java-client/ switched from apache commons to guava (&lt;a href=&quot;https://github.com/googleapis/google-http-java-client/commit/990c534f0e5103a142b0639c12c90cb990a00cfd#diff-97264fba16d690a26d63fbbc992af937)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/googleapis/google-http-java-client/commit/990c534f0e5103a142b0639c12c90cb990a00cfd#diff-97264fba16d690a26d63fbbc992af937)&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;and decodeBase64 behaves differently in both cases. Former can handle null by returning null, latter will throw NPE.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13212680">BEAM-6545</key>
            <summary>NPE when decoding null base 64 strings</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kenn">Kenneth Knowles</assignee>
                                    <reporter username="altay">Ahmet Altay</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Jan 2019 00:28:48 +0000</created>
                <updated>Sat, 16 May 2020 14:00:03 +0000</updated>
                            <resolved>Fri, 1 Feb 2019 01:09:36 +0000</resolved>
                                    <version>2.9.0</version>
                                    <fixVersion>2.10.0</fixVersion>
                                    <component>runner-dataflow</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="16755541" author="altay" created="Wed, 30 Jan 2019 01:12:06 +0000"  >&lt;p&gt;I do not understand why this is failing for the released version 2.9.0.&lt;/p&gt;

&lt;p&gt;Beam depends on 1.27.0 version of the google-http-library (&lt;a href=&quot;https://www.google.com/url?q=https://github.com/apache/beam/blob/release-2.9.0/buildSrc/src/main/groovy/org/apache/beam/gradle/BeamModulePlugin.groovy%23L311&amp;amp;sa=D&amp;amp;usg=AFQjCNHxtKDUbcDm57_BHZxQ3ml-Giy-7A&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/release-2.9.0/buildSrc/src/main/groovy/org/apache/beam/gradle/BeamModulePlugin.groovy#L311&lt;/a&gt;)&lt;br/&gt;
1.27.0 of the google-http-library users the null safe version of decodeBase64 from apache commons (&lt;a href=&quot;https://www.google.com/url?q=https://github.com/googleapis/google-http-java-client/blob/v1.27.0/google-http-client/src/main/java/com/google/api/client/util/Base64.java%23L101&amp;amp;sa=D&amp;amp;usg=AFQjCNEBI6RP6LoOqN6jQZoOnjKztGCTZA&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/googleapis/google-http-java-client/blob/v1.27.0/google-http-client/src/main/java/com/google/api/client/util/Base64.java#L101&lt;/a&gt;)&lt;br/&gt;
This was changed in 1.28.0 (&lt;a href=&quot;https://www.google.com/url?q=https://github.com/googleapis/google-http-java-client/blob/v1.28.0/google-http-client/src/main/java/com/google/api/client/util/Base64.java%23L91&amp;amp;sa=D&amp;amp;usg=AFQjCNGRmg9aOwpaVdI4ZbjlPa5G0IEINw&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/googleapis/google-http-java-client/blob/v1.28.0/google-http-client/src/main/java/com/google/api/client/util/Base64.java#L91&lt;/a&gt;) but Beam does not use this version.&lt;/p&gt;

&lt;p&gt;We need to update our code before upgrading the dependency. But I am not yet sure why this is failing as it is.&lt;/p&gt;</comment>
                            <comment id="16755666" author="kenn" created="Wed, 30 Jan 2019 04:31:09 +0000"  >&lt;p&gt;By the details here this seems easy to surgically fix and have a regression test. But I agree it seems very suspicious what situations could cause it.&lt;/p&gt;</comment>
                            <comment id="16755671" author="kenn" created="Wed, 30 Jan 2019 04:39:01 +0000"  >&lt;p&gt;I examined the output of &lt;tt&gt;./gradlew dependencyReport&lt;/tt&gt; with grep (it is too huge to manage explicitly) and we do have some 1.23.0 versions that are being resolved to 1.27.0 because of other overrides. We have no transitive 1.28.0 dependencies in any Beam module.&lt;/p&gt;</comment>
                            <comment id="16755672" author="kenn" created="Wed, 30 Jan 2019 04:40:14 +0000"  >&lt;p&gt;It does not make sense to ever pass a null value to a base64 routine. It is the right thing to do to avoid that anyhow.&lt;/p&gt;</comment>
                            <comment id="16756398" author="altay" created="Wed, 30 Jan 2019 18:36:47 +0000"  >&lt;p&gt;Thank you for checking. I suggest:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Removing this from the blocker list. It is possible that user in question is overriding the dependency.&lt;/li&gt;
	&lt;li&gt;Change the code to preserve the previous behavior (i.e. return null for null input instead of calling into base64 library). I did a quick search there are a few uses of this.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Hopefully there are no other similar changes in the underlying library. Could we use tooling to check whether we are passing any Nullable&#160;variables to any libraries we use that does not accept Nullable args?&lt;/p&gt;</comment>
                            <comment id="16756643" author="kenn" created="Wed, 30 Jan 2019 22:56:58 +0000"  >&lt;p&gt;Findbugs was actually fully disabled. That was tracked in &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-5658&quot; title=&quot;Enable SpotBugs in dataflow java worker code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-5658&quot;&gt;&lt;del&gt;BEAM-5658&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16756646" author="kenn" created="Wed, 30 Jan 2019 22:57:33 +0000"  >&lt;p&gt;I don&apos;t think we should restore the behavior - it was quite broken.&lt;/p&gt;</comment>
                            <comment id="16756810" author="altay" created="Thu, 31 Jan 2019 02:56:54 +0000"  >&lt;p&gt;Thank you for the proper fix Kenn!&lt;/p&gt;</comment>
                            <comment id="16757848" author="kenn" created="Fri, 1 Feb 2019 01:09:25 +0000"  >&lt;p&gt;I have done a manual audit of the remaining uses in our codebase. Relevant occurrences listed below:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ grep -r decodeBase64 *
...
runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/UngroupedShuffleReaderFactory.java:        decodeBase64(getString(spec, WorkerPropertyNames.SHUFFLE_READER_CONFIG)),
runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/GroupingShuffleReaderFactory.java:          decodeBase64(getString(spec, WorkerPropertyNames.SHUFFLE_READER_CONFIG)),
runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/GroupingShuffleReaderFactory.java:        decodeBase64(getString(spec, WorkerPropertyNames.SHUFFLE_READER_CONFIG)),
runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/ShuffleSinkFactory.java:        decodeBase64(getString(spec, WorkerPropertyNames.SHUFFLE_WRITER_CONFIG, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)),
runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/util/common/worker/ByteArrayShufflePosition.java:    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ByteArrayShufflePosition.of(decodeBase64(position));
runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/WorkerCustomSources.java:              decodeBase64(serializedSplits.get(index)), &lt;span class=&quot;code-quote&quot;&gt;&quot;UnboundedSource split&quot;&lt;/span&gt;);
runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/WorkerCustomSources.java:                Base64.decodeBase64(getString(spec, SERIALIZED_SOURCE)), &lt;span class=&quot;code-quote&quot;&gt;&quot;Source&quot;&lt;/span&gt;);
runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/PartitioningShuffleReaderFactory.java:        decodeBase64(getString(spec, WorkerPropertyNames.SHUFFLE_READER_CONFIG)),
sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/bigquery/FakeBigQueryServices.java:    ByteArrayInputStream input = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayInputStream(Base64.decodeBase64(query));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In each case, a misplaced &lt;tt&gt;null&lt;/tt&gt; would crash elsewhere so it cannot regress due to decodeBase64 enforcing it.&lt;/p&gt;</comment>
                            <comment id="16772510" author="ckchow" created="Wed, 20 Feb 2019 01:36:16 +0000"  >&lt;p&gt;how would you recommend avoiding this bug if we can&apos;t upgrade to 2.10.0?&lt;/p&gt;</comment>
                            <comment id="16772515" author="kenn" created="Wed, 20 Feb 2019 01:49:45 +0000"  >&lt;p&gt;I&apos;m not sure about compatibility, but pinning google-http-library to 1.27.0 or another version that is null-accepting might work.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13189566">BEAM-5658</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 38 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi0gk0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>