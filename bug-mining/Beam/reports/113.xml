<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:41:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-800] DoFnLifeCycleManager should hold DoFnInvoker, not DoFn/OldDoFn</title>
                <link>https://issues.apache.org/jira/browse/BEAM-800</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;The &lt;tt&gt;DirectRunner&lt;/tt&gt;&apos;s support class &lt;tt&gt;DoFnLifecycleManager&lt;/tt&gt; holds a cache of deserialized &lt;tt&gt;OldDoFn&lt;/tt&gt; s, now being ported to &lt;tt&gt;DoFn&lt;/tt&gt; s. But to execute a &lt;tt&gt;DoFn&lt;/tt&gt; there is another layer of indirection through a &lt;tt&gt;DoFnInvoker&lt;/tt&gt;, which is the best object to cache here.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13014598">BEAM-800</key>
            <summary>DoFnLifeCycleManager should hold DoFnInvoker, not DoFn/OldDoFn</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10103" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">P3</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="mauzhang">Manu Zhang</assignee>
                                    <reporter username="kenn">Kenneth Knowles</reporter>
                        <labels>
                    </labels>
                <created>Sun, 23 Oct 2016 21:33:01 +0000</created>
                <updated>Fri, 24 Jul 2020 20:53:50 +0000</updated>
                            <resolved>Mon, 3 Apr 2017 17:41:23 +0000</resolved>
                                                    <fixVersion>Not applicable</fixVersion>
                                    <component>runner-direct</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15601003" author="mauzhang" created="Mon, 24 Oct 2016 05:34:31 +0000"  >&lt;p&gt;Could you link where &lt;tt&gt;OldDoFn&lt;/tt&gt; being ported to &lt;tt&gt;DoFn&lt;/tt&gt; happens ? Is this blocked by the porting ?&lt;/p&gt;</comment>
                            <comment id="15602848" author="kenn" created="Mon, 24 Oct 2016 18:42:04 +0000"  >&lt;p&gt;The porting of the DirectRunner occured on &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/1157&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;#1157&lt;/a&gt;, with lots of little fixes to make it all ready. The commit that actually ported the runner is &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/1157/commits/1919d8b3a850bd146137652546da851ee461cd28&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;1919d8b&lt;/a&gt;. If you take a look, the &lt;tt&gt;DoFnLifecycleManager&lt;/tt&gt; caches each &lt;tt&gt;DoFn&lt;/tt&gt; instance, and tears it down, but the repeated instantiation of a &lt;tt&gt;DoFnInvoker&lt;/tt&gt; for it is redundant. It is possible that even the &lt;tt&gt;DoFnRunner&lt;/tt&gt; could be cached here (a &lt;tt&gt;DoFnRunner&lt;/tt&gt; is essentially a &lt;tt&gt;DoFnInvoker&lt;/tt&gt; fixed to one particular context).&lt;/p&gt;</comment>
                            <comment id="15613941" author="mauzhang" created="Fri, 28 Oct 2016 01:37:07 +0000"  >&lt;p&gt;&lt;tt&gt;DoFnRunner&lt;/tt&gt; is currently created by the corresponding &lt;tt&gt;TransformEvaluator&lt;/tt&gt;. Do you want to move it to &lt;tt&gt;TransformEvaluatorFactory&lt;/tt&gt; ?&lt;/p&gt;</comment>
                            <comment id="15615389" author="kenn" created="Fri, 28 Oct 2016 13:24:19 +0000"  >&lt;p&gt;Yes, I think it would have to be created sooner. But actually now that I have dug into this, the &lt;tt&gt;setup()&lt;/tt&gt; and &lt;tt&gt;teardown()&lt;/tt&gt; methods are not part of &lt;tt&gt;DoFnRunner&lt;/tt&gt; and I don&apos;t think that they should be. So I think just sticking to &lt;tt&gt;DoFnInvoker&lt;/tt&gt; is the right move here.&lt;/p&gt;</comment>
                            <comment id="15617138" author="mauzhang" created="Sat, 29 Oct 2016 01:15:57 +0000"  >&lt;p&gt;Ok. The remaining issues are that &lt;tt&gt;ParDoEvaluator&lt;/tt&gt; accepts &lt;tt&gt;DoFn&lt;/tt&gt; now (&lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-788&quot; title=&quot;Execute ReduceFn directly, not via OldDoFn wrapper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-788&quot;&gt;&lt;del&gt;BEAM-788&lt;/del&gt;&lt;/a&gt; ?) and &lt;tt&gt;DoFnInvoker&lt;/tt&gt; is not &lt;tt&gt;Serializable&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="15617139" author="mauzhang" created="Sat, 29 Oct 2016 01:16:04 +0000"  >&lt;p&gt;Ok. The remaining issues are that &lt;tt&gt;ParDoEvaluator&lt;/tt&gt; accepts &lt;tt&gt;DoFn&lt;/tt&gt; now (&lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-788&quot; title=&quot;Execute ReduceFn directly, not via OldDoFn wrapper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-788&quot;&gt;&lt;del&gt;BEAM-788&lt;/del&gt;&lt;/a&gt; ?) and &lt;tt&gt;DoFnInvoker&lt;/tt&gt; is not &lt;tt&gt;Serializable&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="15621010" author="kenn" created="Mon, 31 Oct 2016 02:33:03 +0000"  >&lt;p&gt;When a &lt;tt&gt;DoFn&lt;/tt&gt; is cloned, the &lt;tt&gt;DoFnInvoker&lt;/tt&gt; should be created and &lt;tt&gt;invokeSetup()&lt;/tt&gt; called. Today the &lt;tt&gt;DoFnInvoker&lt;/tt&gt; is discarded, and a new one created when it is time to call &lt;tt&gt;invokeTeardown()&lt;/tt&gt;, but the &lt;tt&gt;DoFn&lt;/tt&gt; is cached. Instead, the invoker might as well be cached. It doesn&apos;t need to be &lt;tt&gt;Serializable&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15621252" author="githubbot" created="Mon, 31 Oct 2016 04:58:47 +0000"  >&lt;p&gt;GitHub user manuzhang opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/1232&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-beam/pull/1232&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-800&quot; title=&quot;DoFnLifeCycleManager should hold DoFnInvoker, not DoFn/OldDoFn&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-800&quot;&gt;&lt;del&gt;BEAM-800&lt;/del&gt;&lt;/a&gt; cache DoFnInvoker in DoFnLifeCycleManager&lt;/p&gt;

&lt;p&gt;    Be sure to do all of the following to help us incorporate your contribution&lt;br/&gt;
    quickly and easily:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Make sure the PR title is formatted like:&lt;br/&gt;
       `&lt;a href=&quot;#&amp;gt;&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;BEAM-&amp;lt;Jira issue #&amp;gt;&lt;/a&gt; Description of pull request`&lt;/li&gt;
	&lt;li&gt;[ ] Make sure tests pass via `mvn clean verify`. (Even better, enable&lt;br/&gt;
           Travis-CI on your fork and ensure the whole test matrix passes).&lt;/li&gt;
	&lt;li&gt;[ ] Replace `&amp;lt;Jira issue #&amp;gt;` in the title with the actual Jira issue&lt;br/&gt;
           number, if there is one.&lt;/li&gt;
	&lt;li&gt;[ ] If this contribution is large, please file an Apache&lt;br/&gt;
           &lt;span class=&quot;error&quot;&gt;&amp;#91;Individual Contributor License Agreement&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.apache.org/licenses/icla.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.apache.org/licenses/icla.txt&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    &amp;#8212;&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/manuzhang/incubator-beam&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/manuzhang/incubator-beam&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-800&quot; title=&quot;DoFnLifeCycleManager should hold DoFnInvoker, not DoFn/OldDoFn&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-800&quot;&gt;&lt;del&gt;BEAM-800&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/1232.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-beam/pull/1232.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1232&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 2518b1760af9f9cecb37c977e7e5dab736b7d89b&lt;br/&gt;
Author: manuzhang &amp;lt;owenzhang1990@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-10-31T04:57:23Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-800&quot; title=&quot;DoFnLifeCycleManager should hold DoFnInvoker, not DoFn/OldDoFn&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-800&quot;&gt;&lt;del&gt;BEAM-800&lt;/del&gt;&lt;/a&gt; cache DoFnInvoker in DoFnLifeCycleManager&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15689394" author="githubbot" created="Wed, 23 Nov 2016 08:49:03 +0000"  >&lt;p&gt;GitHub user manuzhang opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/1428&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-beam/pull/1428&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-800&quot; title=&quot;DoFnLifeCycleManager should hold DoFnInvoker, not DoFn/OldDoFn&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-800&quot;&gt;&lt;del&gt;BEAM-800&lt;/del&gt;&lt;/a&gt; add getFn to DoFnInvoker&lt;/p&gt;

&lt;p&gt;    Be sure to do all of the following to help us incorporate your contribution&lt;br/&gt;
    quickly and easily:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Make sure the PR title is formatted like:&lt;br/&gt;
       `&lt;a href=&quot;#&amp;gt;&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;BEAM-&amp;lt;Jira issue #&amp;gt;&lt;/a&gt; Description of pull request`&lt;/li&gt;
	&lt;li&gt;[ ] Make sure tests pass via `mvn clean verify`. (Even better, enable&lt;br/&gt;
           Travis-CI on your fork and ensure the whole test matrix passes).&lt;/li&gt;
	&lt;li&gt;[ ] Replace `&amp;lt;Jira issue #&amp;gt;` in the title with the actual Jira issue&lt;br/&gt;
           number, if there is one.&lt;/li&gt;
	&lt;li&gt;[ ] If this contribution is large, please file an Apache&lt;br/&gt;
           &lt;span class=&quot;error&quot;&gt;&amp;#91;Individual Contributor License Agreement&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.apache.org/licenses/icla.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.apache.org/licenses/icla.txt&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    &amp;#8212;&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/manuzhang/incubator-beam&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/manuzhang/incubator-beam&lt;/a&gt; add-DoFn-DoFnInvoker&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/1428.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-beam/pull/1428.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1428&lt;/p&gt;

&lt;hr /&gt;

&lt;hr /&gt;</comment>
                            <comment id="15697262" author="githubbot" created="Sat, 26 Nov 2016 04:41:55 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/1428&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-beam/pull/1428&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15953846" author="dhalperi@google.com" created="Mon, 3 Apr 2017 17:15:01 +0000"  >&lt;p&gt;Can this JIRA be closed?&lt;/p&gt;</comment>
                            <comment id="15954276" author="githubbot" created="Mon, 3 Apr 2017 22:49:36 +0000"  >&lt;p&gt;Github user manuzhang closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/1232&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/1232&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 33 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35a1j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>