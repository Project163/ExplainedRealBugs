<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:11:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-10697] Python Precommit failing due to type check failure.</title>
                <link>https://issues.apache.org/jira/browse/BEAM-10697</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;Test suite: &lt;a href=&quot;https://ci-beam.apache.org/job/beam_PreCommit_Python_Cron/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_PreCommit_Python_Cron/&lt;/a&gt;&lt;br/&gt;
First failure: &lt;a href=&quot;https://ci-beam.apache.org/job/beam_PreCommit_Python_Cron/3110/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_PreCommit_Python_Cron/3110/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Looks like it&apos;s failing for about a day now.&lt;/p&gt;

&lt;p&gt;Error:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;self = &amp;lt;apache_beam.transforms.ptransform_test.PTransformTypeCheckTestCase testMethod=test_pardo_properly_type_checks_using_type_hint_decorators&amp;gt;

    def test_pardo_properly_type_checks_using_type_hint_decorators(self):
      @with_input_types(a=str)
      @with_output_types(typing.List[str])
      def to_all_upper_case(a):
        return [a.upper()]
    
      # If this type-checks than no error should be raised.
      d = (
          self.p
          | &apos;T&apos; &amp;gt;&amp;gt; beam.Create([&apos;t&apos;, &apos;e&apos;, &apos;s&apos;, &apos;t&apos;]).with_output_types(str)
          | &apos;Case&apos; &amp;gt;&amp;gt; beam.FlatMap(to_all_upper_case))
      assert_that(d, equal_to([&apos;T&apos;, &apos;E&apos;, &apos;S&apos;, &apos;T&apos;]))
      self.p.run()
    
      # Output type should have been recognized as &apos;str&apos; rather than List[str] to
      # do the flatten part of FlatMap.
&amp;gt;     self.assertEqual(str, d.element_type)
E     AssertionError: &amp;lt;type &apos;str&apos;&amp;gt; != Any

apache_beam/transforms/ptransform_test.py:1182: AssertionError
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13322383">BEAM-10697</key>
            <summary>Python Precommit failing due to type check failure.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10100" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">P0</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="udim">Udi Meiri</assignee>
                                    <reporter username="danoliveira">Daniel Oliveira</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Aug 2020 22:02:39 +0000</created>
                <updated>Fri, 19 Mar 2021 17:19:42 +0000</updated>
                            <resolved>Fri, 19 Mar 2021 17:19:42 +0000</resolved>
                                                    <fixVersion>2.24.0</fixVersion>
                                    <component>sdk-py-core</component>
                    <component>test-failures</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="6000">1h 40m</timespent>
                                <comments>
                            <comment id="17177319" author="altay" created="Thu, 13 Aug 2020 21:03:35 +0000"  >&lt;p&gt;Can we disable this test while investigating the root cause?&lt;/p&gt;</comment>
                            <comment id="17177344" author="tvalentyn" created="Thu, 13 Aug 2020 22:23:18 +0000"  >&lt;p&gt;Similar typehints error: &lt;a href=&quot;https://ci-beam.apache.org/job/beam_PreCommit_Python_Commit/14536/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_PreCommit_Python_Commit/14536/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17177414" author="udim" created="Fri, 14 Aug 2020 01:39:20 +0000"  >&lt;p&gt;Doesn&apos;t reproduce on my machine running Python 2.7.14.&lt;/p&gt;</comment>
                            <comment id="17178023" author="udim" created="Fri, 14 Aug 2020 19:11:41 +0000"  >&lt;p&gt;Okay, reproduces now after having upgraded virtualenv and tox on the virtual environment I was using.&lt;/p&gt;</comment>
                            <comment id="17178077" author="udim" created="Fri, 14 Aug 2020 21:46:25 +0000"  >&lt;p&gt;Looks like sometimes strings are typing.ByteString, and Beam doesn&apos;t support that and converts to Any.&lt;br/&gt;
Why though does typing.List&lt;span class=&quot;error&quot;&gt;&amp;#91;bytes&amp;#93;&lt;/span&gt; become typing.List&lt;span class=&quot;error&quot;&gt;&amp;#91;typing.ByteString&amp;#93;&lt;/span&gt;, and don&apos;t these always fail?&lt;/p&gt;</comment>
                            <comment id="17179149" author="udim" created="Mon, 17 Aug 2020 17:46:54 +0000"  >&lt;p&gt;I can recreate the failure pretty reliably:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; i in $(seq 100); &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; tox -e py27-cython -- apache_beam/dataframe/ apache_beam/transforms/ apache_beam/typehints/ || &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;; done
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I can&apos;t explain it though, but since it only happens on py27-cython as far as we know, I think the best option is to disable py27-cython since Python 2.7 support is going away.&lt;/p&gt;</comment>
                            <comment id="17179223" author="danoliveira" created="Mon, 17 Aug 2020 20:56:39 +0000"  >&lt;p&gt;Would this count as a regression for the 2.24.0 release? And how likely is it to happen in real user pipelines? Unfortunately 2.24.0 is still supposed to support Python 2.7, so this bug might need to get fixed regardless if it would impact users.&lt;/p&gt;

&lt;p&gt;I suppose another alternative is to just add this as a known issue and suggest python 2.7 users stick with 2.23.0.&lt;/p&gt;</comment>
                            <comment id="17180196" author="udim" created="Wed, 19 Aug 2020 01:11:55 +0000"  >&lt;p&gt;The bug title is misleading.&lt;br/&gt;
Since Beam is converting ByteString to Any, the resulting hint is less strict.&lt;br/&gt;
It will weakens type checking in certain cases, but not break existing pipelines.&lt;/p&gt;

&lt;p&gt;I wouldn&apos;t count this as a regression but put it as a known issue in the release blog.&lt;br/&gt;
No idea how likely it is (root cause is unknown).&lt;/p&gt;

&lt;p&gt;It only affects users who launch jobs from a virtualenv with cython installed.&lt;br/&gt;
One workaround would be to uninstall cython and apache-beam and reinstall only apache-beam.&lt;/p&gt;</comment>
                            <comment id="17180857" author="udim" created="Wed, 19 Aug 2020 22:20:49 +0000"  >&lt;p&gt;This error is not limited to Cython: &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-10766&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/BEAM-10766&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17180890" author="tvalentyn" created="Thu, 20 Aug 2020 00:21:29 +0000"  >&lt;p&gt;If it can be reproduced reliably, you may be able to  find a culprit via git bisect, since this seems a recent error. Also, is it limited to Py 2.7?&lt;/p&gt;</comment>
                            <comment id="17181512" author="udim" created="Fri, 21 Aug 2020 01:13:15 +0000"  >&lt;p&gt;Adding 1000 extra test cases makes the failures more likely. My assumption is that another test is affecting the results so there&apos;s a better chance that some of these will insert themselves in the correct order. (Side note: we&apos;re using pytest-xdist which seems to non-deterministically split and order the tests among subprocesses.)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  @parameterized.expand((i,) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; i in range(1000))
  def test_bytestring(self, unused_param):
    self.assertEqual(typehints.List[bytes], convert_to_beam_type(typing.List[bytes]))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17181949" author="udim" created="Fri, 21 Aug 2020 15:26:04 +0000"  >&lt;p&gt;This has been identified as an issue with new code modifying the _&lt;em&gt;args&lt;/em&gt;_ typing module types. Since these are cached, modifying List&lt;span class=&quot;error&quot;&gt;&amp;#91;str&amp;#93;&lt;/span&gt;._&lt;em&gt;args&lt;/em&gt;_ affects all current and future instances of List&lt;span class=&quot;error&quot;&gt;&amp;#91;str&amp;#93;&lt;/span&gt;.&lt;/p&gt;</comment>
                            <comment id="17181950" author="udim" created="Fri, 21 Aug 2020 15:26:59 +0000"  >&lt;p&gt;Closing this in favor of &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-10766&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/BEAM-10766&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 12 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0hps8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>