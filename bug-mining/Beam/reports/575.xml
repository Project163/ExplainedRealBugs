<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:50:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-3042] Add tracking of bytes read / time spent when reading side inputs</title>
                <link>https://issues.apache.org/jira/browse/BEAM-3042</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;It is difficult for Dataflow users to understand how modifying a pipeline or data set can affect how much inter-transform IO is used in their job. The intent of this feature request is to help users understand how side inputs behave when they are consumed.&lt;/p&gt;

&lt;p&gt;This will allow users to understand how much time and how much data their pipeline uses to read/write to inter-transform IO. Users will also be able to modify their pipelines and understand how their changes affect these IO metrics.&lt;/p&gt;

&lt;p&gt;For further information, please review the internal Google doc go/insights-transform-io-design-doc.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13108436">BEAM-3042</key>
            <summary>Add tracking of bytes read / time spent when reading side inputs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pabloem">Pablo Estrada</assignee>
                                    <reporter username="pabloem">Pablo Estrada</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 Oct 2017 22:42:18 +0000</created>
                <updated>Sat, 16 May 2020 13:47:54 +0000</updated>
                            <resolved>Thu, 2 Aug 2018 18:31:39 +0000</resolved>
                                                    <fixVersion>2.6.0</fixVersion>
                                    <component>sdk-py-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="25800">7h 10m</timespent>
                                <comments>
                            <comment id="16280916" author="githubbot" created="Wed, 6 Dec 2017 21:07:04 +0000"  >&lt;p&gt;pabloem opened a new pull request #4222: &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-3042&quot; title=&quot;Add tracking of bytes read / time spent when reading side inputs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-3042&quot;&gt;&lt;del&gt;BEAM-3042&lt;/del&gt;&lt;/a&gt; Updating Dataflow Api protos&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/beam/pull/4222&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/4222&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   This is necessary to be able to report the new Dataflow metrics.&lt;br/&gt;
   r: @chamikaramj &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16281044" author="githubbot" created="Wed, 6 Dec 2017 22:35:56 +0000"  >&lt;p&gt;chamikaramj closed pull request #4222: &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-3042&quot; title=&quot;Add tracking of bytes read / time spent when reading side inputs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-3042&quot;&gt;&lt;del&gt;BEAM-3042&lt;/del&gt;&lt;/a&gt; Updating Dataflow Api protos&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/beam/pull/4222&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/4222&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/sdks/python/apache_beam/runners/dataflow/internal/clients/dataflow/dataflow_v1b3_messages.py b/sdks/python/apache_beam/runners/dataflow/internal/clients/dataflow/dataflow_v1b3_messages.py&lt;br/&gt;
index b0d4e44816c..6c55d4e830f 100644&lt;br/&gt;
&amp;#8212; a/sdks/python/apache_beam/runners/dataflow/internal/clients/dataflow/dataflow_v1b3_messages.py&lt;br/&gt;
+++ b/sdks/python/apache_beam/runners/dataflow/internal/clients/dataflow/dataflow_v1b3_messages.py&lt;br/&gt;
@@ -16,7 +16,6 @@&lt;br/&gt;
 #&lt;/p&gt;

&lt;p&gt; &quot;&quot;&quot;Generated message classes for dataflow version v1b3.&lt;br/&gt;
-&lt;br/&gt;
 Develops and executes data processing patterns like ETL, batch computation,&lt;br/&gt;
 and continuous computation.&lt;br/&gt;
 &quot;&quot;&quot;&lt;br/&gt;
@@ -347,11 +346,19 @@ class CounterStructuredName(_messages.Message):&lt;br/&gt;
       workers.&lt;br/&gt;
     executionStepName: Name of the stage. An execution step contains multiple&lt;br/&gt;
       component steps.&lt;br/&gt;
+    inputIndex: Index of an input collection that&apos;s being read from/written to&lt;br/&gt;
+      as a side input. The index identifies a step&apos;s side inputs starting by 1&lt;br/&gt;
+      (e.g. the first side input has input_index 1, the third has input_index&lt;br/&gt;
+      3). Side inputs are identified by a pair of (original_step_name,&lt;br/&gt;
+      input_index). This field helps uniquely identify them.&lt;br/&gt;
     name: Counter name. Not necessarily globally-unique, but unique within the&lt;br/&gt;
       context of the other fields. Required.&lt;br/&gt;
     origin: One of the standard Origins defined above.&lt;br/&gt;
     originNamespace: A string containing a more specific namespace of the&lt;br/&gt;
       counter&apos;s origin.&lt;br/&gt;
+    originalRequestingStepName: The step name requesting an operation, such as&lt;br/&gt;
+      GBK. I.e. the ParDo causing a read/write from shuffle to occur, or a&lt;br/&gt;
+      read from side inputs.&lt;br/&gt;
     originalStepName: System generated name of the original step in the user&apos;s&lt;br/&gt;
       graph, before optimization.&lt;br/&gt;
     portion: Portion of this counter, either key or value.&lt;br/&gt;
@@ -382,12 +389,14 @@ class PortionValueValuesEnum(_messages.Enum):&lt;/p&gt;

&lt;p&gt;   componentStepName = _messages.StringField(1)&lt;br/&gt;
   executionStepName = _messages.StringField(2)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;name = _messages.StringField(3)&lt;/li&gt;
	&lt;li&gt;origin = _messages.EnumField(&apos;OriginValueValuesEnum&apos;, 4)&lt;/li&gt;
	&lt;li&gt;originNamespace = _messages.StringField(5)&lt;/li&gt;
	&lt;li&gt;originalStepName = _messages.StringField(6)&lt;/li&gt;
	&lt;li&gt;portion = _messages.EnumField(&apos;PortionValueValuesEnum&apos;, 7)&lt;/li&gt;
	&lt;li&gt;workerId = _messages.StringField(8)&lt;br/&gt;
+  inputIndex = _messages.IntegerField(3, variant=_messages.Variant.INT32)&lt;br/&gt;
+  name = _messages.StringField(4)&lt;br/&gt;
+  origin = _messages.EnumField(&apos;OriginValueValuesEnum&apos;, 5)&lt;br/&gt;
+  originNamespace = _messages.StringField(6)&lt;br/&gt;
+  originalRequestingStepName = _messages.StringField(7)&lt;br/&gt;
+  originalStepName = _messages.StringField(8)&lt;br/&gt;
+  portion = _messages.EnumField(&apos;PortionValueValuesEnum&apos;, 9)&lt;br/&gt;
+  workerId = _messages.StringField(10)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt; class CounterStructuredNameAndMetadata(_messages.Message):&lt;br/&gt;
@@ -1401,8 +1410,7 @@ class DistributionUpdate(_messages.Message):&lt;/p&gt;

&lt;p&gt;   Fields:&lt;br/&gt;
     count: The count of the number of elements present in the distribution.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;logBuckets: (Optional) Logarithmic histogram of values. Each log may be in&lt;/li&gt;
	&lt;li&gt;no more than one bucket. Order does not matter.&lt;br/&gt;
+    histogram: (Optional) Histogram of value counts for the distribution.&lt;br/&gt;
     max: The maximum value present in the distribution.&lt;br/&gt;
     min: The minimum value present in the distribution.&lt;br/&gt;
     sum: Use an int64 since we&apos;d prefer the added precision. If overflow is a&lt;br/&gt;
@@ -1412,7 +1420,7 @@ class DistributionUpdate(_messages.Message):&lt;br/&gt;
   &quot;&quot;&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   count = _messages.MessageField(&apos;SplitInt64&apos;, 1)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;logBuckets = _messages.MessageField(&apos;LogBucket&apos;, 2, repeated=True)&lt;br/&gt;
+  histogram = _messages.MessageField(&apos;Histogram&apos;, 2)&lt;br/&gt;
   max = _messages.MessageField(&apos;SplitInt64&apos;, 3)&lt;br/&gt;
   min = _messages.MessageField(&apos;SplitInt64&apos;, 4)&lt;br/&gt;
   sum = _messages.MessageField(&apos;SplitInt64&apos;, 5)&lt;br/&gt;
@@ -1808,6 +1816,27 @@ class GetTemplateResponse(_messages.Message):&lt;br/&gt;
   status = _messages.MessageField(&apos;Status&apos;, 2)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;+class Histogram(_messages.Message):&lt;br/&gt;
+  &quot;&quot;&quot;Histogram of value counts for a distribution.  Buckets have an inclusive&lt;br/&gt;
+  lower bound and exclusive upper bound and use &quot;1,2,5 bucketing&quot;: The first&lt;br/&gt;
+  bucket range is from [0,1) and all subsequent bucket boundaries are powers&lt;br/&gt;
+  of ten multiplied by 1, 2, or 5. Thus, bucket boundaries are 0, 1, 2, 5, 10,&lt;br/&gt;
+  20, 50, 100, 200, 500, 1000, ... Negative values are not supported.&lt;br/&gt;
+&lt;br/&gt;
+  Fields:&lt;br/&gt;
+    bucketCounts: Counts of values in each bucket. For efficiency, prefix and&lt;br/&gt;
+      trailing buckets with count = 0 are elided. Buckets can store the full&lt;br/&gt;
+      range of values of an unsigned long, with ULLONG_MAX falling into the&lt;br/&gt;
+      59th bucket with range [1e19, 2e19).&lt;br/&gt;
+    firstBucketOffset: Starting index of first stored bucket. The non-&lt;br/&gt;
+      inclusive upper-bound of the ith bucket is given by:&lt;br/&gt;
+      pow(10,(i-first_bucket_offset)/3) * (1,2,5)&lt;span class=&quot;error&quot;&gt;&amp;#91;(i-first_bucket_offset)%3&amp;#93;&lt;/span&gt;&lt;br/&gt;
+  &quot;&quot;&quot;&lt;br/&gt;
+&lt;br/&gt;
+  bucketCounts = _messages.IntegerField(1, repeated=True)&lt;br/&gt;
+  firstBucketOffset = _messages.IntegerField(2, variant=_messages.Variant.INT32)&lt;br/&gt;
+&lt;br/&gt;
+&lt;br/&gt;
 class InstructionInput(_messages.Message):&lt;br/&gt;
   &quot;&quot;&quot;An input of an instruction, as a reference to an output of a producer&lt;br/&gt;
   instruction.&lt;br/&gt;
@@ -2493,20 +2522,6 @@ class ListJobsResponse(_messages.Message):&lt;br/&gt;
   nextPageToken = _messages.StringField(3)&lt;/p&gt;


&lt;p&gt;-class LogBucket(_messages.Message):&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&quot;&quot;&quot;Bucket of values for Distribution&apos;s logarithmic histogram.&lt;br/&gt;
-&lt;/li&gt;
	&lt;li&gt;Fields:&lt;/li&gt;
	&lt;li&gt;count: Number of values in this bucket.&lt;/li&gt;
	&lt;li&gt;log: floor(log2(value)); defined to be zero for nonpositive values.&lt;/li&gt;
	&lt;li&gt;log(-1) = 0   log(0) = 0   log(1) = 0   log(2) = 1   log(3) = 1   log(4)&lt;/li&gt;
	&lt;li&gt;= 2   log(5) = 2&lt;/li&gt;
	&lt;li&gt;&quot;&quot;&quot;&lt;br/&gt;
-&lt;/li&gt;
	&lt;li&gt;count = _messages.IntegerField(1)&lt;/li&gt;
	&lt;li&gt;log = _messages.IntegerField(2, variant=_messages.Variant.INT32)&lt;br/&gt;
-&lt;br/&gt;
-&lt;br/&gt;
 class MapTask(_messages.Message):&lt;br/&gt;
   &quot;&quot;&quot;MapTask consists of an ordered set of instructions, each of which&lt;br/&gt;
   describes one particular low-level operation for the worker to perform in&lt;br/&gt;
@@ -3068,6 +3083,7 @@ class ResourceUtilizationReportResponse(_messages.Message):&lt;br/&gt;
   &quot;&quot;&quot;&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;+&lt;br/&gt;
 class RuntimeEnvironment(_messages.Message):&lt;br/&gt;
   &quot;&quot;&quot;The environment values to set at runtime.&lt;/p&gt;

&lt;p&gt;@@ -3501,11 +3517,22 @@ class SourceOperationRequest(_messages.Message):&lt;/p&gt;

&lt;p&gt;   Fields:&lt;br/&gt;
     getMetadata: Information about a request to get metadata about a source.&lt;br/&gt;
+    name: User-provided name of the Read instruction for this source.&lt;br/&gt;
+    originalName: System-defined name for the Read instruction for this source&lt;br/&gt;
+      in the original workflow graph.&lt;br/&gt;
     split: Information about a request to split a source.&lt;br/&gt;
+    stageName: System-defined name of the stage containing the source&lt;br/&gt;
+      operation. Unique across the workflow.&lt;br/&gt;
+    systemName: System-defined name of the Read instruction for this source.&lt;br/&gt;
+      Unique across the workflow.&lt;br/&gt;
   &quot;&quot;&quot;&lt;/p&gt;

&lt;p&gt;   getMetadata = _messages.MessageField(&apos;SourceGetMetadataRequest&apos;, 1)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;split = _messages.MessageField(&apos;SourceSplitRequest&apos;, 2)&lt;br/&gt;
+  name = _messages.StringField(2)&lt;br/&gt;
+  originalName = _messages.StringField(3)&lt;br/&gt;
+  split = _messages.MessageField(&apos;SourceSplitRequest&apos;, 4)&lt;br/&gt;
+  stageName = _messages.StringField(5)&lt;br/&gt;
+  systemName = _messages.StringField(6)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt; class SourceOperationResponse(_messages.Message):&lt;br/&gt;
@@ -4426,6 +4453,8 @@ class WorkItemStatus(_messages.Message):&lt;br/&gt;
       progress and proposed_stop_position should be interpreted relative to P,&lt;br/&gt;
       and in a potential subsequent dynamic_source_split into &lt;/p&gt;
{P&apos;, R&apos;}
&lt;p&gt;, P&apos; and&lt;br/&gt;
       R&apos; must be together equivalent to P, etc.&lt;br/&gt;
+    totalThrottlerWaitTimeSeconds: Total time the worker spent being throttled&lt;br/&gt;
+      by external systems.&lt;br/&gt;
     workItemId: Identifies the WorkItem.&lt;br/&gt;
   &quot;&quot;&quot;&lt;/p&gt;

&lt;p&gt;@@ -4441,7 +4470,8 @@ class WorkItemStatus(_messages.Message):&lt;br/&gt;
   sourceFork = _messages.MessageField(&apos;SourceFork&apos;, 10)&lt;br/&gt;
   sourceOperationResponse = _messages.MessageField(&apos;SourceOperationResponse&apos;, 11)&lt;br/&gt;
   stopPosition = _messages.MessageField(&apos;Position&apos;, 12)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;workItemId = _messages.StringField(13)&lt;br/&gt;
+  totalThrottlerWaitTimeSeconds = _messages.FloatField(13)&lt;br/&gt;
+  workItemId = _messages.StringField(14)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt; class WorkerHealthReport(_messages.Message):&lt;br/&gt;
@@ -4532,6 +4562,7 @@ class WorkerMessage(_messages.Message):&lt;br/&gt;
     workerHealthReport: The health of a worker.&lt;br/&gt;
     workerMessageCode: A worker message code.&lt;br/&gt;
     workerMetrics: Resource metrics reported by workers.&lt;br/&gt;
+    workerShutdownNotice: Shutdown notice by workers.&lt;br/&gt;
   &quot;&quot;&quot;&lt;/p&gt;

&lt;p&gt;   @encoding.MapUnrecognizedFields(&apos;additionalProperties&apos;)&lt;br/&gt;
@@ -4568,6 +4599,7 @@ class AdditionalProperty(_messages.Message):&lt;br/&gt;
   workerHealthReport = _messages.MessageField(&apos;WorkerHealthReport&apos;, 3)&lt;br/&gt;
   workerMessageCode = _messages.MessageField(&apos;WorkerMessageCode&apos;, 4)&lt;br/&gt;
   workerMetrics = _messages.MessageField(&apos;ResourceUtilizationReport&apos;, 5)&lt;br/&gt;
+  workerShutdownNotice = _messages.MessageField(&apos;WorkerShutdownNotice&apos;, 6)&lt;/p&gt;


&lt;p&gt; class WorkerMessageCode(_messages.Message):&lt;br/&gt;
@@ -4664,10 +4696,13 @@ class WorkerMessageResponse(_messages.Message):&lt;br/&gt;
       report.&lt;br/&gt;
     workerMetricsResponse: Service&apos;s response to reporting worker metrics&lt;br/&gt;
       (currently empty).&lt;br/&gt;
+    workerShutdownNoticeResponse: Service&apos;s response to shutdown notice&lt;br/&gt;
+      (currently empty).&lt;br/&gt;
   &quot;&quot;&quot;&lt;/p&gt;

&lt;p&gt;   workerHealthReportResponse = _messages.MessageField(&apos;WorkerHealthReportResponse&apos;, 1)&lt;br/&gt;
   workerMetricsResponse = _messages.MessageField(&apos;ResourceUtilizationReportResponse&apos;, 2)&lt;br/&gt;
+  workerShutdownNoticeResponse = _messages.MessageField(&apos;WorkerShutdownNoticeResponse&apos;, 3)&lt;/p&gt;


&lt;p&gt; class WorkerPool(_messages.Message):&lt;br/&gt;
@@ -4913,6 +4948,24 @@ class WorkerSettings(_messages.Message):&lt;br/&gt;
   workerId = _messages.StringField(6)&lt;/p&gt;


&lt;p&gt;+class WorkerShutdownNotice(_messages.Message):&lt;br/&gt;
+  &quot;&quot;&quot;Shutdown notification from workers. This is to be sent by the shutdown&lt;br/&gt;
+  script of the worker VM so that the backend knows that the VM is being shut&lt;br/&gt;
+  down.&lt;br/&gt;
+&lt;br/&gt;
+  Fields:&lt;br/&gt;
+    reason: The reason for the worker shutdown. Current possible values are:&lt;br/&gt;
+      &quot;UNKNOWN&quot;: shutdown reason is unknown.   &quot;PREEMPTION&quot;: shutdown reason&lt;br/&gt;
+      is preemption. Other possible reasons may be added in the future.&lt;br/&gt;
+  &quot;&quot;&quot;&lt;br/&gt;
+&lt;br/&gt;
+  reason = _messages.StringField(1)&lt;br/&gt;
+&lt;br/&gt;
+&lt;br/&gt;
+class WorkerShutdownNoticeResponse(_messages.Message):&lt;br/&gt;
+  &quot;&quot;&quot;Service-side response to WorkerMessage issuing shutdown notice.&quot;&quot;&quot;&lt;br/&gt;
+&lt;br/&gt;
+&lt;br/&gt;
 class WriteInstruction(_messages.Message):&lt;br/&gt;
   &quot;&quot;&quot;An instruction that writes records. Takes one input, produces no outputs.&lt;/p&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16285595" author="githubbot" created="Mon, 11 Dec 2017 07:19:09 +0000"  >&lt;p&gt;pabloem opened a new pull request #4241: &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-3042&quot; title=&quot;Add tracking of bytes read / time spent when reading side inputs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-3042&quot;&gt;&lt;del&gt;BEAM-3042&lt;/del&gt;&lt;/a&gt; Renaming properties form IO target counter name.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/beam/pull/4241&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/4241&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   These metrics will be used internally to track Bytes read and time spent reading both side inputs and shuffle. This rename is to match the internal dataflow design for these metrics.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16286601" author="githubbot" created="Mon, 11 Dec 2017 21:33:52 +0000"  >&lt;p&gt;pabloem closed pull request #3943: &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-3042&quot; title=&quot;Add tracking of bytes read / time spent when reading side inputs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-3042&quot;&gt;&lt;del&gt;BEAM-3042&lt;/del&gt;&lt;/a&gt; Add tracking of bytes read / time spent when reading side inputs&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/beam/pull/3943&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3943&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/sdks/python/apache_beam/runners/worker/opcounters.py b/sdks/python/apache_beam/runners/worker/opcounters.py&lt;br/&gt;
index f4ba6b9a9a8..c997d23a39d 100644&lt;br/&gt;
&amp;#8212; a/sdks/python/apache_beam/runners/worker/opcounters.py&lt;br/&gt;
+++ b/sdks/python/apache_beam/runners/worker/opcounters.py&lt;br/&gt;
@@ -25,6 +25,7 @@&lt;br/&gt;
 import random&lt;/p&gt;

&lt;p&gt; from apache_beam.utils.counters import Counter&lt;br/&gt;
+from apache_beam.utils.counters import CounterName&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;This module is experimental. No backwards-compatibility guarantees.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;@@ -42,6 +43,58 @@ def value(self):&lt;br/&gt;
     return self._value&lt;/p&gt;


&lt;p&gt;+class TransformIoCounter(object):&lt;br/&gt;
+&lt;br/&gt;
+  def add_bytes_read(self, n):&lt;br/&gt;
+    pass&lt;br/&gt;
+&lt;br/&gt;
+  def _&lt;em&gt;enter&lt;/em&gt;_(self):&lt;br/&gt;
+    self.enter()&lt;br/&gt;
+&lt;br/&gt;
+  def _&lt;em&gt;exit&lt;/em&gt;_(self, unused_exc_type, unused_exc_value, unused_traceback):&lt;br/&gt;
+    self.exit()&lt;br/&gt;
+&lt;br/&gt;
+  def enter(self):&lt;br/&gt;
+    pass&lt;br/&gt;
+&lt;br/&gt;
+  def exit(self):&lt;br/&gt;
+    pass&lt;br/&gt;
+&lt;br/&gt;
+  def check_step(self):&lt;br/&gt;
+    pass&lt;br/&gt;
+&lt;br/&gt;
+&lt;br/&gt;
+class SideInputReadCounter(TransformIoCounter):&lt;br/&gt;
+&lt;br/&gt;
+  def _&lt;em&gt;init&lt;/em&gt;_(self, counter_factory, state_sampler, io_target):&lt;br/&gt;
+    self._counter_factory = counter_factory&lt;br/&gt;
+    self._state_sampler = state_sampler&lt;br/&gt;
+    self._bytes_read_cache = 0&lt;br/&gt;
+    self.io_target = io_target&lt;br/&gt;
+    self.check_step()&lt;br/&gt;
+&lt;br/&gt;
+  def check_step(self):&lt;br/&gt;
+    current_state = self._state_sampler.current_state()&lt;br/&gt;
+    operation_name = current_state.name.step_name&lt;br/&gt;
+    self.scoped_state = self._state_sampler.scoped_state(&lt;br/&gt;
+        operation_name, &apos;read-sideinput&apos;, io_target=self.io_target)&lt;br/&gt;
+    self.bytes_read_counter = self._counter_factory.get_counter(&lt;br/&gt;
+        CounterName(&apos;bytes-read&apos;,&lt;br/&gt;
+                    step_name=operation_name,&lt;br/&gt;
+                    io_target=self.io_target),&lt;br/&gt;
+        Counter.SUM)&lt;br/&gt;
+&lt;br/&gt;
+  def add_bytes_read(self, n):&lt;br/&gt;
+    if n &amp;gt; 0:&lt;br/&gt;
+      self.bytes_read_counter.update&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_down.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
+&lt;br/&gt;
+  def enter(self):&lt;br/&gt;
+    self.scoped_state._&lt;em&gt;enter&lt;/em&gt;_()&lt;br/&gt;
+&lt;br/&gt;
+  def exit(self):&lt;br/&gt;
+    self.scoped_state._&lt;em&gt;exit&lt;/em&gt;_(None, None, None)&lt;br/&gt;
+&lt;br/&gt;
+&lt;br/&gt;
 class OperationCounters(object):&lt;br/&gt;
   &quot;&quot;&quot;The set of basic counters to attach to an Operation.&quot;&quot;&quot;&lt;/p&gt;

&lt;p&gt;diff --git a/sdks/python/apache_beam/runners/worker/operations.py b/sdks/python/apache_beam/runners/worker/operations.py&lt;br/&gt;
index ed3f3b8f466..132a61fb131 100644&lt;br/&gt;
&amp;#8212; a/sdks/python/apache_beam/runners/worker/operations.py&lt;br/&gt;
+++ b/sdks/python/apache_beam/runners/worker/operations.py&lt;br/&gt;
@@ -42,6 +42,7 @@&lt;br/&gt;
 from apache_beam.transforms.combiners import PhasedCombineFnExecutor&lt;br/&gt;
 from apache_beam.transforms.combiners import curry_combine_fn&lt;br/&gt;
 from apache_beam.transforms.window import GlobalWindows&lt;br/&gt;
+from apache_beam.utils import counters&lt;br/&gt;
 from apache_beam.utils.windowed_value import WindowedValue&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Allow some &quot;pure mode&quot; declarations.&lt;br/&gt;
@@ -281,7 +282,7 @@ def _read_side_inputs(self, tags_and_types):&lt;/li&gt;
	&lt;li&gt;Note that for each tag there could be several read operations in the&lt;/li&gt;
	&lt;li&gt;specification. This can happen for instance if the source has been&lt;/li&gt;
	&lt;li&gt;sharded into several files.&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;for side_tag, view_class, view_options in tags_and_types:&lt;br/&gt;
+    for i, (side_tag, view_class, view_options) in enumerate(tags_and_types):&lt;br/&gt;
       sources = []&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
	&lt;li&gt;Using the side_tag in the lambda below will trigger a pylint warning.&lt;/li&gt;
	&lt;li&gt;However in this case it is fine because the lambda is used right away&lt;br/&gt;
@@ -293,7 +294,13 @@ def _read_side_inputs(self, tags_and_types):&lt;br/&gt;
         if not isinstance(si, operation_specs.WorkerSideInputSource):&lt;br/&gt;
           raise NotImplementedError(&apos;Unknown side input type: %r&apos; % si)&lt;br/&gt;
         sources.append(si.source)&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;iterator_fn = sideinputs.get_iterator_fn_for_sources(sources)&lt;br/&gt;
+&lt;br/&gt;
+      si_counter = opcounters.SideInputReadCounter(&lt;br/&gt;
+          self.counter_factory, self.state_sampler,&lt;br/&gt;
+          # Inputs are 1-indexed, so we add 1 to i in the side input id&lt;br/&gt;
+          counters.side_input_id(self.operation_name, i+1))&lt;br/&gt;
+      iterator_fn = sideinputs.get_iterator_fn_for_sources(&lt;br/&gt;
+          sources, read_counter=si_counter)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;Backwards compatibility for pre &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-733&quot; title=&quot;Windowed side-inputs not supported in Python&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-733&quot;&gt;&lt;del&gt;BEAM-733&lt;/del&gt;&lt;/a&gt; SDKs.&lt;br/&gt;
       if isinstance(view_options, tuple):&lt;br/&gt;
diff --git a/sdks/python/apache_beam/runners/worker/sideinputs.py b/sdks/python/apache_beam/runners/worker/sideinputs.py&lt;br/&gt;
index bdf9f4e71f5..b11ab3cfba6 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/sdks/python/apache_beam/runners/worker/sideinputs.py&lt;br/&gt;
+++ b/sdks/python/apache_beam/runners/worker/sideinputs.py&lt;br/&gt;
@@ -24,6 +24,7 @@&lt;br/&gt;
 import traceback&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt; from apache_beam.io import iobase&lt;br/&gt;
+from apache_beam.runners.worker import opcounters&lt;br/&gt;
 from apache_beam.transforms import window&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;This module is experimental. No backwards-compatibility guarantees.&lt;br/&gt;
@@ -51,9 +52,12 @@ class PrefetchingSourceSetIterable(object):&lt;br/&gt;
   &quot;&quot;&quot;Value iterator that reads concurrently from a set of sources.&quot;&quot;&quot;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   def _&lt;em&gt;init&lt;/em&gt;_(self, sources,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;max_reader_threads=MAX_SOURCE_READER_THREADS):&lt;br/&gt;
+               max_reader_threads=MAX_SOURCE_READER_THREADS,&lt;br/&gt;
+               read_counter=None):&lt;br/&gt;
     self.sources = sources&lt;br/&gt;
     self.num_reader_threads = min(max_reader_threads, len(self.sources))&lt;br/&gt;
+    self.read_counter = read_counter or opcounters.TransformIoCounter()&lt;br/&gt;
+    # self.read_counter = opcounters.TransformIoCounter()&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;Queue for sources that are to be read.&lt;br/&gt;
     self.sources_queue = Queue.Queue()&lt;br/&gt;
@@ -78,6 +82,13 @@ def _start_reader_threads(self):&lt;br/&gt;
       t.start()&lt;br/&gt;
       self.reader_threads.append(t)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;+  def _get_source_position(self, range_tracker=None, reader=None):&lt;br/&gt;
+    if reader:&lt;br/&gt;
+      return reader.get_progress().position.byte_offset&lt;br/&gt;
+    else:&lt;br/&gt;
+      return range_tracker.position_at_fraction(&lt;br/&gt;
+          range_tracker.fraction_consumed()) if range_tracker else 0&lt;br/&gt;
+&lt;br/&gt;
   def _reader_thread(self):&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;pylint: disable=too-many-nested-blocks&lt;br/&gt;
     try:&lt;br/&gt;
@@ -85,22 +96,37 @@ def _reader_thread(self):&lt;br/&gt;
         try:&lt;br/&gt;
           source = self.sources_queue.get_nowait()&lt;br/&gt;
           if isinstance(source, iobase.BoundedSource):&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;for value in source.read(source.get_range_tracker(None, None)):&lt;br/&gt;
+            rt = source.get_range_tracker(None, None)&lt;br/&gt;
+            initial_position = self._get_source_position(range_tracker=rt)&lt;br/&gt;
+            for value in source.read(rt):&lt;br/&gt;
               if self.has_errored:&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
	&lt;li&gt;If any reader has errored, just return.&lt;br/&gt;
                 return&lt;br/&gt;
+&lt;br/&gt;
+              current_position = self._get_source_position(range_tracker=rt)&lt;br/&gt;
+              consumed_bytes = current_position - initial_position&lt;br/&gt;
+              self.read_counter.add_bytes_read(consumed_bytes)&lt;br/&gt;
+              initial_position = initial_position + consumed_bytes&lt;br/&gt;
+&lt;br/&gt;
               if isinstance(value, window.WindowedValue):&lt;br/&gt;
                 self.element_queue.put(value)&lt;br/&gt;
               else:&lt;br/&gt;
                 self.element_queue.put(_globally_windowed(value))&lt;br/&gt;
           else:&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;# Native dataflow source.&lt;br/&gt;
+            # Native dataflow source / testing FakeSource&lt;br/&gt;
             with source.reader() as reader:&lt;br/&gt;
+              initial_offset = self._get_source_position(reader=reader)&lt;br/&gt;
+&lt;br/&gt;
               returns_windowed_values = reader.returns_windowed_values&lt;br/&gt;
               for value in reader:&lt;br/&gt;
                 if self.has_errored:&lt;/li&gt;
	&lt;li&gt;# If any reader has errored, just return.&lt;br/&gt;
+                  # If any reader has errored, just return.`&lt;br/&gt;
                   return&lt;br/&gt;
+&lt;br/&gt;
+                new_offset = self._get_source_position(reader=reader)&lt;br/&gt;
+                self.read_counter.add_bytes_read(new_offset - initial_offset)&lt;br/&gt;
+                initial_offset = new_offset&lt;br/&gt;
+&lt;br/&gt;
                 if returns_windowed_values:&lt;br/&gt;
                   self.element_queue.put(value)&lt;br/&gt;
                 else:&lt;br/&gt;
@@ -128,7 +154,14 @@ def _&lt;em&gt;iter&lt;/em&gt;_(self):&lt;br/&gt;
     num_readers_finished = 0&lt;br/&gt;
     try:&lt;br/&gt;
       while True:&lt;/li&gt;
	&lt;li&gt;element = self.element_queue.get()&lt;br/&gt;
+        if self.element_queue.empty():&lt;br/&gt;
+          # The queue is empty. We check the current state.&lt;br/&gt;
+          self.read_counter.check_step()&lt;br/&gt;
+          with self.read_counter:&lt;br/&gt;
+            element = self.element_queue.get()&lt;br/&gt;
+        else:&lt;br/&gt;
+          element = self.element_queue.get()&lt;br/&gt;
+&lt;br/&gt;
         if element is READER_THREAD_IS_DONE_SENTINEL:&lt;br/&gt;
           num_readers_finished += 1&lt;br/&gt;
           if num_readers_finished == self.num_reader_threads:&lt;br/&gt;
@@ -150,11 +183,13 @@ def _&lt;em&gt;iter&lt;/em&gt;_(self):&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt; def get_iterator_fn_for_sources(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;sources, max_reader_threads=MAX_SOURCE_READER_THREADS):&lt;br/&gt;
+    sources, max_reader_threads=MAX_SOURCE_READER_THREADS, read_counter=None):&lt;br/&gt;
   &quot;&quot;&quot;Returns callable that returns iterator over elements for given sources.&quot;&quot;&quot;&lt;br/&gt;
   def _inner():&lt;br/&gt;
     return iter(PrefetchingSourceSetIterable(&lt;/li&gt;
	&lt;li&gt;sources, max_reader_threads=max_reader_threads))&lt;br/&gt;
+        sources,&lt;br/&gt;
+        max_reader_threads=max_reader_threads,&lt;br/&gt;
+        read_counter=read_counter))&lt;br/&gt;
   return _inner&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;diff --git a/sdks/python/apache_beam/runners/worker/sideinputs_test.py b/sdks/python/apache_beam/runners/worker/sideinputs_test.py&lt;br/&gt;
index d243bbe4e6e..296bed460d1 100644&lt;br/&gt;
&amp;#8212; a/sdks/python/apache_beam/runners/worker/sideinputs_test.py&lt;br/&gt;
+++ b/sdks/python/apache_beam/runners/worker/sideinputs_test.py&lt;br/&gt;
@@ -21,6 +21,8 @@&lt;br/&gt;
 import time&lt;br/&gt;
 import unittest&lt;/p&gt;

&lt;p&gt;+import mock&lt;br/&gt;
+&lt;br/&gt;
 from apache_beam.runners.worker import sideinputs&lt;/p&gt;


&lt;p&gt;@@ -43,6 +45,11 @@ def _&lt;em&gt;init&lt;/em&gt;_(self, items):&lt;br/&gt;
     self.items = items&lt;br/&gt;
     self.entered = False&lt;br/&gt;
     self.exited = False&lt;br/&gt;
+    self._progress = mock.MagicMock()&lt;br/&gt;
+    self._progress.position.byte_offset = 0&lt;br/&gt;
+&lt;br/&gt;
+  def get_progress(self):&lt;br/&gt;
+    return self._progress&lt;/p&gt;

&lt;p&gt;   def _&lt;em&gt;iter&lt;/em&gt;_(self):&lt;br/&gt;
     return iter(self.items)&lt;br/&gt;
diff --git a/sdks/python/apache_beam/runners/worker/statesampler.pyx b/sdks/python/apache_beam/runners/worker/statesampler.pyx&lt;br/&gt;
index f0527c6decc..2c3e3784f7b 100644&lt;br/&gt;
&amp;#8212; a/sdks/python/apache_beam/runners/worker/statesampler.pyx&lt;br/&gt;
+++ b/sdks/python/apache_beam/runners/worker/statesampler.pyx&lt;br/&gt;
@@ -174,6 +174,13 @@ cdef class StateSampler(object):&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;pythread doesn&apos;t support conditions.&lt;br/&gt;
     self.sampling_thread.join()&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;+  def current_state(self):&lt;br/&gt;
+    &quot;&quot;&quot;Returns the current ScopedState.&lt;br/&gt;
+&lt;br/&gt;
+    This operation is not thread safe, and should only be used to check, not to&lt;br/&gt;
+    update information in the current state.&quot;&quot;&quot;&lt;br/&gt;
+    return self.scoped_states_by_index&lt;span class=&quot;error&quot;&gt;&amp;#91;self.current_state_index&amp;#93;&lt;/span&gt;&lt;br/&gt;
+&lt;br/&gt;
   def stop_if_still_running(self):&lt;br/&gt;
     if self.started and not self.finished:&lt;br/&gt;
       self.stop()&lt;br/&gt;
diff --git a/sdks/python/apache_beam/runners/worker/statesampler_fake.py b/sdks/python/apache_beam/runners/worker/statesampler_fake.py&lt;br/&gt;
index bc56021520a..a106e437859 100644&lt;br/&gt;
&amp;#8212; a/sdks/python/apache_beam/runners/worker/statesampler_fake.py&lt;br/&gt;
+++ b/sdks/python/apache_beam/runners/worker/statesampler_fake.py&lt;br/&gt;
@@ -17,14 +17,19 @@&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;This module is experimental. No backwards-compatibility guarantees.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;+from apache_beam.utils.counters import CounterName&lt;br/&gt;
+&lt;/p&gt;

&lt;p&gt; class StateSampler(object):&lt;/p&gt;

&lt;p&gt;   def _&lt;em&gt;init&lt;/em&gt;_(self, *args, **kwargs):&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;pass&lt;br/&gt;
+    self._current_state = _FakeScopedState(self, &apos;unknown&apos;, &apos;unknown&apos;)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   def scoped_state(self, step_name, state_name=None, io_target=None):&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return _FakeScopedState()&lt;br/&gt;
+    return _FakeScopedState(self, step_name, state_name)&lt;br/&gt;
+&lt;br/&gt;
+  def current_state(self):&lt;br/&gt;
+    return self._current_state&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   def start(self):&lt;br/&gt;
     pass&lt;br/&gt;
@@ -41,11 +46,17 @@ def commit_counters(self):&lt;/p&gt;

&lt;p&gt; class _FakeScopedState(object):&lt;/p&gt;

&lt;p&gt;+  def _&lt;em&gt;init&lt;/em&gt;_(self, sampler, step_name, state_name):&lt;br/&gt;
+    self.name = CounterName(state_name + &apos;-msecs&apos;,&lt;br/&gt;
+                            step_name=step_name)&lt;br/&gt;
+    self.sampler = sampler&lt;br/&gt;
+&lt;br/&gt;
   def _&lt;em&gt;enter&lt;/em&gt;_(self):&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;pass&lt;br/&gt;
+    self.old_state = self.sampler.current_state()&lt;br/&gt;
+    self.sampler._current_state = self&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   def _&lt;em&gt;exit&lt;/em&gt;_(self, *unused_args):&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;pass&lt;br/&gt;
+    self.sampler._current_state = self.old_state&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   def sampled_seconds(self):&lt;br/&gt;
     return 0&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16286814" author="githubbot" created="Tue, 12 Dec 2017 00:05:32 +0000"  >&lt;p&gt;aaltay closed pull request #4241: &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-3042&quot; title=&quot;Add tracking of bytes read / time spent when reading side inputs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-3042&quot;&gt;&lt;del&gt;BEAM-3042&lt;/del&gt;&lt;/a&gt; Renaming properties form IO target counter name.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/beam/pull/4241&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/4241&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/sdks/python/apache_beam/utils/counters.py b/sdks/python/apache_beam/utils/counters.py&lt;br/&gt;
index ae974344259..e2e0a1a730b 100644&lt;br/&gt;
&amp;#8212; a/sdks/python/apache_beam/utils/counters.py&lt;br/&gt;
+++ b/sdks/python/apache_beam/utils/counters.py&lt;br/&gt;
@@ -29,19 +29,18 @@&lt;br/&gt;
 from apache_beam.transforms import cy_combiners&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Information identifying the IO being measured by a counter.&lt;br/&gt;
-IOTargetName = namedtuple(&apos;IOTargetName&apos;, [&apos;side_input_step_name&apos;,&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&apos;side_input_index&apos;,&lt;/li&gt;
	&lt;li&gt;&apos;original_shuffle_step_name&apos;])&lt;br/&gt;
+IOTargetName = namedtuple(&apos;IOTargetName&apos;, [&apos;requesting_step_name&apos;,&lt;br/&gt;
+                                           &apos;input_index&apos;])&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt; def side_input_id(step_name, input_index):&lt;br/&gt;
   &quot;&quot;&quot;Create an IOTargetName that identifies the reading of a side input.&quot;&quot;&quot;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return IOTargetName(step_name, input_index, None)&lt;br/&gt;
+  return IOTargetName(step_name, input_index)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt; def shuffle_id(step_name):&lt;br/&gt;
   &quot;&quot;&quot;Create an IOTargetName that identifies a GBK step.&quot;&quot;&quot;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return IOTargetName(None, None, step_name)&lt;br/&gt;
+  return IOTargetName(step_name, None)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt; _CounterName = namedtuple(&apos;_CounterName&apos;, [&apos;name&apos;,&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16288159" author="githubbot" created="Tue, 12 Dec 2017 19:43:13 +0000"  >&lt;p&gt;pabloem opened a new pull request #4248: &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-3042&quot; title=&quot;Add tracking of bytes read / time spent when reading side inputs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-3042&quot;&gt;&lt;del&gt;BEAM-3042&lt;/del&gt;&lt;/a&gt; Tracking of time spent reading side inputs, and bytes read in Dataflow.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/beam/pull/4248&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/4248&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   This pull request adds changes the PrefetchingSourceReader used to fetch side input data. &lt;/p&gt;

&lt;p&gt;   Specifically, this change helps it track how long was spent blocked waiting to fetch side inputs; and for the Dataflow runner (which uses NativeAvroSource), it also helps track how many bytes were read.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16567338" author="pabloem" created="Thu, 2 Aug 2018 18:31:39 +0000"  >&lt;p&gt;This has been fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 15 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3l3vb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>