<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:14:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-11614] sql_taxi examples fails on HEAD due to &quot;transform unexpectedly with no env id&quot;</title>
                <link>https://issues.apache.org/jira/browse/BEAM-11614</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;For example, &lt;a href=&quot;https://pantheon.corp.google.com/dataflow/jobs/us-central1/2021-01-11_21_50_55-8290792779966349848?project=google.com:clouddfe&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://pantheon.corp.google.com/dataflow/jobs/us-central1/2021-01-11_21_50_55-8290792779966349848?project=google.com:clouddfe&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;transform unexpectedly with no env id: external_1SqlTransform(beam:external:java:sql:v1)/BeamAggregationRel_34/Group.CombineFieldsByFields/ToKvs/toRow: spec { } inputs { key: &quot;org.apache.beam.sdk.values.PCollection.&amp;lt;init&amp;gt;:402#3d93cb799b3970be&quot; value: &quot;external_1SqlTransform(beam:external:java:sql:v1)/BeamCalcRel_33/ParDo(Calc)/ParMultiDo(Calc).output&quot; } outputs { key: &quot;org.apache.beam.sdk.values.PCollection.&amp;lt;init&amp;gt;:402#3d93cb799b3970be&quot; value: &quot;external_1SqlTransform(beam:external:java:sql:v1)/BeamCalcRel_33/ParDo(Calc)/ParMultiDo(Calc).output&quot; } unique_name: &quot;SqlTransform(beam:external:java:sql:v1)/BeamAggregationRel_34/Group.CombineFieldsByFields/ToKvs/toRow&quot;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Seems like somehow Sql expansion produces a sub-transform that does not have environment ID set.&lt;/p&gt;

&lt;p&gt;This passes for Beam 2.27.0 so should be due to a recent change.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Brian, are you aware of any recent change that could have resulted in this breakage ?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13351653">BEAM-11614</key>
            <summary>sql_taxi examples fails on HEAD due to &quot;transform unexpectedly with no env id&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10101" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">P1</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bhulette">Brian Hulette</assignee>
                                    <reporter username="chamikara">Chamikara Madhusanka Jayalath</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Jan 2021 06:22:00 +0000</created>
                <updated>Wed, 13 Jan 2021 21:00:24 +0000</updated>
                            <resolved>Wed, 13 Jan 2021 21:00:24 +0000</resolved>
                                                    <fixVersion>2.28.0</fixVersion>
                                    <component>cross-language</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="9000">2.5h</timespent>
                                <comments>
                            <comment id="17263456" author="bhulette" created="Tue, 12 Jan 2021 16:16:57 +0000"  >&lt;p&gt;It&apos;s odd that internal tests aren&apos;t having this same issue. It looks like SQL and Kafka tests are failing now, but with a different error.&lt;/p&gt;

&lt;p&gt;I don&apos;t know of anything that would cause this, I&apos;ll see if I can track it down. &lt;/p&gt;</comment>
                            <comment id="17263467" author="bhulette" created="Tue, 12 Jan 2021 16:37:45 +0000"  >&lt;p&gt;Well this will take a while to bisect.. errors don&apos;t occur until workers have started after 7 minutes&lt;/p&gt;</comment>
                            <comment id="17263494" author="chamikara" created="Tue, 12 Jan 2021 17:03:32 +0000"  >&lt;p&gt;Yeah, internal failures are unrelated (and possibly masking this). Externally, Kafka example works fine so seems like this only affects the SQL example for some reason.&lt;/p&gt;</comment>
                            <comment id="17263546" author="chamikara" created="Tue, 12 Jan 2021 17:36:20 +0000"  >&lt;p&gt;Seems like this is the culprit transform that does not have an environment ID set:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;spec &lt;/p&gt;
{

&#160; urn: &quot;beam:transform:group_by_key:v1&quot;

}

&lt;p&gt;inputs &lt;/p&gt;
{

&#160; key: &quot;org.apache.beam.sdk.values.PCollection.&amp;lt;init&amp;gt;:402#98f8ba3dc812a76d&quot;

&#160; value: &quot;external_1SqlTransform(beam:external:java:sql:v1)/BeamAggregationRel_34/Group.CombineFieldsByFields/ToKvs/selectKeys/AddKeys/Map/ParMultiDo(Anonymous).output&quot;

}

&lt;p&gt;outputs &lt;/p&gt;
{

&#160; key: &quot;org.apache.beam.sdk.values.PCollection.&amp;lt;init&amp;gt;:402#554dcd2b40b5f04b&quot;

&#160; value: &quot;external_1SqlTransform(beam:external:java:sql:v1)/BeamAggregationRel_34/Group.CombineFieldsByFields/ToKvs/GroupByKey.out&quot;

}

&lt;p&gt;unique_name: &quot;SqlTransform(beam:external:java:sql:v1)/BeamAggregationRel_34/Group.CombineFieldsByFields/ToKvs/GroupByKey&quot;&lt;/p&gt;</comment>
                            <comment id="17263597" author="chamikara" created="Tue, 12 Jan 2021 18:54:04 +0000"  >&lt;p&gt;Actually, ignore last comment. This is just a GBK which is handled by the runner (hence no need for an SDK environment). All non-composite transforms that are expected to be handled by an SDK have to have the environment set. Looking at error seems like some of the external ParDos did not have environment set.&lt;/p&gt;</comment>
                            <comment id="17263657" author="bhulette" created="Tue, 12 Jan 2021 19:57:48 +0000"  >&lt;p&gt;Finally tracked this down, with the bisect. The culprit is &lt;a href=&quot;https://github.com/apache/beam/commit/bfee1425f1ebcf8f28946254ff46c4673b4832bf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/commit/bfee1425f1ebcf8f28946254ff46c4673b4832bf&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;That commit adds a short circuit for an &quot;unnecessary&quot; Convert transform. When it&apos;s triggered, the Convert transform is a composite with no children.&lt;/p&gt;

&lt;p&gt;The problematic transforms are:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
inputs {                                                                                                                                                                            
  key: &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.beam.sdk.values.PCollection.&amp;lt;init&amp;gt;:402#bb20b45fd4d95138&quot;&lt;/span&gt;
  value: &lt;span class=&quot;code-quote&quot;&gt;&quot;ref_PCollection_PCollection_1&quot;&lt;/span&gt;                                                                                                                                                                                                
}                                                                                                                   
outputs {                                                                                                           
  key: &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.beam.sdk.values.PCollection.&amp;lt;init&amp;gt;:402#bb20b45fd4d95138&quot;&lt;/span&gt;     
  value: &lt;span class=&quot;code-quote&quot;&gt;&quot;ref_PCollection_PCollection_1&quot;&lt;/span&gt;                                                                                                                                                                                                
}                                                                                                                   
unique_name: &lt;span class=&quot;code-quote&quot;&gt;&quot;SqlTransform(beam:external:java:sql:v1)/BeamIOSourceRel_3/Convert.ConvertTransform&quot;&lt;/span&gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
inputs {                                                                                                          
  key: &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.beam.sdk.values.PCollection.&amp;lt;init&amp;gt;:402#3d93cb799b3970be&quot;&lt;/span&gt;                 
  value: &lt;span class=&quot;code-quote&quot;&gt;&quot;external_1SqlTransform(beam:external:java:sql:v1)/BeamCalcRel_33/ParDo(Calc)/ParMultiDo(Calc).output&quot;&lt;/span&gt;
}                                                                                                                                                                                                                                       
outputs {                                                                                                           
  key: &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.beam.sdk.values.PCollection.&amp;lt;init&amp;gt;:402#3d93cb799b3970be&quot;&lt;/span&gt;                                                                                                                                                             
  value: &lt;span class=&quot;code-quote&quot;&gt;&quot;external_1SqlTransform(beam:external:java:sql:v1)/BeamCalcRel_33/ParDo(Calc)/ParMultiDo(Calc).output&quot;&lt;/span&gt;                                                                                                                         
}                                                                                                                   
unique_name: &lt;span class=&quot;code-quote&quot;&gt;&quot;SqlTransform(beam:external:java:sql:v1)/BeamAggregationRel_34/Group.CombineFieldsByFields/ToKvs/toRow&quot;&lt;/span&gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17263658" author="bhulette" created="Tue, 12 Jan 2021 19:59:20 +0000"  >&lt;p&gt;Is a composite with no children a valid transform in the Beam model?&lt;/p&gt;</comment>
                            <comment id="17263662" author="chamikara" created="Tue, 12 Jan 2021 20:09:57 +0000"  >&lt;p&gt;&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iemejia&quot; class=&quot;user-hover&quot; rel=&quot;iemejia&quot;&gt;iemejia&lt;/a&gt;&#160;are composites that do not contain any children semantically correct ? Seems like this breaks Dataflow Runner v2.&lt;/p&gt;

&lt;p&gt;Composites need to have nested structures according to following.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://beam.apache.org/documentation/programming-guide/#composite-transforms&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://beam.apache.org/documentation/programming-guide/#composite-transforms&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=robertwb&quot; class=&quot;user-hover&quot; rel=&quot;robertwb&quot;&gt;robertwb&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kenn&quot; class=&quot;user-hover&quot; rel=&quot;kenn&quot;&gt;kenn&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17263681" author="kenn" created="Tue, 12 Jan 2021 20:41:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/beam/commit/b406622698f3071cc277fc7e65ed696a4617ea17&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/commit/b406622698f3071cc277fc7e65ed696a4617ea17&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17263682" author="kenn" created="Tue, 12 Jan 2021 20:43:00 +0000"  >&lt;p&gt;Environments are on DoFns, not transforms, right? I may have missed a major revision...&lt;/p&gt;</comment>
                            <comment id="17263684" author="kenn" created="Tue, 12 Jan 2021 20:44:55 +0000"  >&lt;p&gt;FWIW if Dataflow runner v2 and Beam disagree, Beam should be presumed correct.&lt;/p&gt;</comment>
                            <comment id="17263686" author="kenn" created="Tue, 12 Jan 2021 20:46:35 +0000"  >&lt;p&gt;The case of empty composites is weird, but we want to allow programmatic generation of pipelines which means let corner cases like this work.&lt;/p&gt;

&lt;p&gt;Similar things  occur when a transform returns one of its inputs directly. This is actually pretty normal. You can write a transform that takes a couple inputs in a PCollectionTuple and just pulls one out and returns it. Etc. There are a lot of ways to combine actually doing work and just passing PCollections around.  We should allow them all unless there is a reason it does not make sense.&lt;/p&gt;</comment>
                            <comment id="17263687" author="bhulette" created="Tue, 12 Jan 2021 20:47:29 +0000"  >&lt;p&gt;I&apos;m starting a dev@ thread now. The problem is the Beam model is ambiguous in this case. It&apos;s more like the Beam Java SDK and Dataflow v2 disagree.&lt;/p&gt;</comment>
                            <comment id="17263689" author="bhulette" created="Tue, 12 Jan 2021 20:48:34 +0000"  >&lt;p&gt;Well based on Kenn&apos;s latest comment maybe a dev@ thread is unnecessary&lt;/p&gt;</comment>
                            <comment id="17263698" author="bhulette" created="Tue, 12 Jan 2021 21:13:28 +0000"  >&lt;p&gt;There is logic in runner v2 that should handle this. It looks like these transforms are picking up an empty &lt;tt&gt;spec&lt;/tt&gt; somewhere along the way that is confusing it though. This is the proto thats logged by Dataflow:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
spec {
}
inputs {
  key: &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.beam.sdk.values.PCollection.&amp;lt;init&amp;gt;:402#3d93cb799b3970be&quot;&lt;/span&gt;
  value: &lt;span class=&quot;code-quote&quot;&gt;&quot;external_1SqlTransform(beam:external:java:sql:v1)/BeamCalcRel_33/ParDo(Calc)/ParMultiDo(Calc).output&quot;&lt;/span&gt;
}
outputs {
  key: &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.beam.sdk.values.PCollection.&amp;lt;init&amp;gt;:402#3d93cb799b3970be&quot;&lt;/span&gt;
  value: &lt;span class=&quot;code-quote&quot;&gt;&quot;external_1SqlTransform(beam:external:java:sql:v1)/BeamCalcRel_33/ParDo(Calc)/ParMultiDo(Calc).output&quot;&lt;/span&gt;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17263875" author="chamikara" created="Wed, 13 Jan 2021 04:04:12 +0000"  >&lt;p&gt;As Brian mentioned, runner v2 handles this but Python SDK was always setting an empty spec. &lt;a href=&quot;https://github.com/apache/beam/pull/13741&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/13741&lt;/a&gt;&#160;fixes this.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 43 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0mhfc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>