<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:43:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-1948] Null pointer exception in DirectRunner.DirectPipelineResult.getAggregatorValues()</title>
                <link>https://issues.apache.org/jira/browse/BEAM-1948</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;null pointer exception is due to an &lt;tt&gt;Aggregator&lt;/tt&gt; not being present in &lt;tt&gt;aggregatorSteps&lt;/tt&gt; (maybe because not present in the DAG).&lt;br/&gt;
We can reproduce the null pointer exception with a simple pipeline with an &lt;tt&gt;Aggregator&lt;/tt&gt; and a &lt;tt&gt;State&lt;/tt&gt; like this one:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    IdentityDoFn identityDoFn = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IdentityDoFn();
    p.apply(Create.of(KV.of(&lt;span class=&quot;code-quote&quot;&gt;&quot;key&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;element1&quot;&lt;/span&gt;), KV.of(&lt;span class=&quot;code-quote&quot;&gt;&quot;key&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;element2&quot;&lt;/span&gt;), KV.of(&lt;span class=&quot;code-quote&quot;&gt;&quot;key&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;element3&quot;&lt;/span&gt;)))
        .apply(ParDo.of(identityDoFn));
    PipelineResult pipelineResult = p.run();
    pipelineResult.getAggregatorValues(identityDoFn.getCounter()).getValues();



  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;IdentityDoFn &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; DoFn&amp;lt;KV&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; {
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Aggregator&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt; counter = createAggregator(&lt;span class=&quot;code-quote&quot;&gt;&quot;counter&quot;&lt;/span&gt;, Sum.ofLongs());
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; STATE_ID = &lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;;
    @StateId(STATE_ID)
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; StateSpec&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;, ValueState&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;&amp;gt; stateSpec =
        StateSpecs.value(StringUtf8Coder.of());

    @ProcessElement
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void processElement(ProcessContext context, @StateId(STATE_ID) ValueState&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; state){
      state.write(&lt;span class=&quot;code-quote&quot;&gt;&quot;state content&quot;&lt;/span&gt;);
      counter.addValue(1L);
      context.output(context.element().getValue());
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Aggregator&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt; getCounter() {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; counter;
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13063486">BEAM-1948</key>
            <summary>Null pointer exception in DirectRunner.DirectPipelineResult.getAggregatorValues()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10103" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">P3</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="echauchot">Etienne Chauchot</assignee>
                                    <reporter username="echauchot">Etienne Chauchot</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Apr 2017 13:36:50 +0000</created>
                <updated>Sat, 16 May 2020 13:22:41 +0000</updated>
                            <resolved>Fri, 21 Apr 2017 17:01:53 +0000</resolved>
                                                    <fixVersion>Not applicable</fixVersion>
                                    <component>runner-direct</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15965893" author="echauchot" created="Wed, 12 Apr 2017 13:49:48 +0000"  >&lt;p&gt;put priority = minor because it uses aggregators (to implement metrics) that will disappear. &lt;/p&gt;</comment>
                            <comment id="15967781" author="echauchot" created="Thu, 13 Apr 2017 15:55:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tgroh&quot; class=&quot;user-hover&quot; rel=&quot;tgroh&quot;&gt;tgroh&lt;/a&gt; I propose to do a quick fix PR just to avoid the null pointer exception in case the &lt;tt&gt;aggregator&lt;/tt&gt; key is not present in the &lt;tt&gt;aggregatorSteps&lt;/tt&gt; map. In the meantime we could figure out why this aggregator key is not in the map.&lt;br/&gt;
WDYT?&lt;/p&gt;</comment>
                            <comment id="15972757" author="githubbot" created="Tue, 18 Apr 2017 14:20:20 +0000"  >&lt;p&gt;GitHub user echauchot opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/2573&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/2573&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-1948&quot; title=&quot;Null pointer exception in DirectRunner.DirectPipelineResult.getAggregatorValues()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-1948&quot;&gt;&lt;del&gt;BEAM-1948&lt;/del&gt;&lt;/a&gt; Add protection against null pointer exception if aggregator key is not present in aggregatorSteps in DirectRunner.DirectPipelineResult.getAggregatorValues(aggregator)&lt;/p&gt;

&lt;p&gt;    Be sure to do all of the following to help us incorporate your contribution&lt;br/&gt;
    quickly and easily:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;X&amp;#93;&lt;/span&gt; Make sure the PR title is formatted like:&lt;br/&gt;
       `&lt;a href=&quot;#&amp;gt;&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;BEAM-&amp;lt;Jira issue #&amp;gt;&lt;/a&gt; Description of pull request`&lt;/li&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;X&amp;#93;&lt;/span&gt; Make sure tests pass via `mvn clean verify`. (Even better, enable&lt;br/&gt;
           Travis-CI on your fork and ensure the whole test matrix passes).&lt;/li&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;X&amp;#93;&lt;/span&gt; Replace `&amp;lt;Jira issue #&amp;gt;` in the title with the actual Jira issue&lt;br/&gt;
           number, if there is one.&lt;/li&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;X&amp;#93;&lt;/span&gt; If this contribution is large, please file an Apache&lt;br/&gt;
           &lt;span class=&quot;error&quot;&gt;&amp;#91;Individual Contributor License Agreement&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.apache.org/licenses/icla.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.apache.org/licenses/icla.pdf&lt;/a&gt;).&lt;br/&gt;
    &amp;#8212;&lt;br/&gt;
    I have run into a case in which `aggregator` key is not present in `aggregatorSteps` in `DirectRunner.DirectPipelineResult.getAggregatorValues(aggregator)` causing a null pointer exception.  It might be because, in the user code, the `aggregator` is created but the `aggregator.addValue()` is never called (aggregator is a fatal errors counter). &lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    This PR is just a simple protection against this error.&lt;/p&gt;

&lt;p&gt;    R: @tgroh &lt;br/&gt;
    CC: @jbonofre &lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/echauchot/beam&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/echauchot/beam&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-1948&quot; title=&quot;Null pointer exception in DirectRunner.DirectPipelineResult.getAggregatorValues()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-1948&quot;&gt;&lt;del&gt;BEAM-1948&lt;/del&gt;&lt;/a&gt;-Null_pointer_exception_in_DirectRunner.DirectPipelineResult.getAggregatorValues&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/2573.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/2573.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2573&lt;/p&gt;

&lt;hr /&gt;

&lt;hr /&gt;</comment>
                            <comment id="15976937" author="githubbot" created="Thu, 20 Apr 2017 15:51:50 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/2573&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/2573&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12954736">BEAM-160</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 30 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3djbr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>