<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:00:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-6740] Combine.Globally translation is not called on URN based translation</title>
                <link>https://issues.apache.org/jira/browse/BEAM-6740</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;Beam translates Combine.Globally&#160;as a composite transform composed of:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Map that assigns Void keys&lt;/li&gt;
	&lt;li&gt;Combine.PerKey&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;on spark: As Combine.Perkey uses a spark GBK inside it, the runner adds its own translation of&#160;Combine.Globally&#160;to avoid less performant GBK. This translation should be&#160;called in place of entering the composite transform translation.A pipeline like this:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
PCollection&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; input = pipeline.apply(Create.of(1, 2, 3, 4, 5, 6, 7, 8, 9, 10));
input.apply(
 Combine.globally(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IntegerCombineFn()));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;IntegerCombineFn &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Combine.CombineFn&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; {

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; createAccumulator() {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 0;
    }

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; addInput(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; accumulator, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; input) {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; accumulator + input;
    }

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; mergeAccumulators(Iterable&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; accumulators) {
      &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; result = 0;
      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; value : accumulators) {
        result += value;
      }
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; result;
    }

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; extractOutput(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; accumulator) {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; accumulator;
    }
  }


&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;is translated as the above composite.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13217785">BEAM-6740</key>
            <summary>Combine.Globally translation is not called on URN based translation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="iemejia">Isma&#235;l Mej&#237;a</assignee>
                                    <reporter username="echauchot">Etienne Chauchot</reporter>
                        <labels>
                            <label>portability</label>
                    </labels>
                <created>Mon, 25 Feb 2019 10:02:33 +0000</created>
                <updated>Sat, 16 May 2020 13:40:45 +0000</updated>
                            <resolved>Tue, 9 Jul 2019 20:13:24 +0000</resolved>
                                                    <fixVersion>2.15.0</fixVersion>
                                    <component>runner-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="19800">5.5h</timespent>
                                <comments>
                            <comment id="16776705" author="echauchot" created="Mon, 25 Feb 2019 10:04:14 +0000"  >&lt;p&gt;problem is that in runners.core.construction :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
PTransformTranslation.urnForTransformOrNull(transform) 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;returns null&#160;with&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
transform == Combine.globally(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16776742" author="echauchot" created="Mon, 25 Feb 2019 10:51:42 +0000"  >&lt;p&gt;That is because none of &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
RawPTransformTranslator
KnownTransformPayloadTranslator
ParDoTranslator
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;known transform translators can translate Combine.Globally whereas &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
KnownTransformPayloadTranslator
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;can translate Combine.PerKey&lt;/p&gt;



</comment>
                            <comment id="16776755" author="echauchot" created="Mon, 25 Feb 2019 11:00:21 +0000"  >&lt;p&gt;As it is in runner construction, it makes me wonder: is it intended that Combine.Globally never gets translated directly (without decomposing it into its primitives) ?&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kenn&quot; class=&quot;user-hover&quot; rel=&quot;kenn&quot;&gt;kenn&lt;/a&gt; WDYT ?&lt;/p&gt;</comment>
                            <comment id="16776928" author="kenn" created="Mon, 25 Feb 2019 14:24:19 +0000"  >&lt;p&gt;I think this is an oversight. Any transform that has a clear definition can have a urn.&lt;/p&gt;</comment>
                            <comment id="16777066" author="echauchot" created="Mon, 25 Feb 2019 16:24:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kenn&quot; class=&quot;user-hover&quot; rel=&quot;kenn&quot;&gt;kenn&lt;/a&gt; ok so it is indeed a bug that needs to be fixed. It might have worked in the past otherwise there would not be any special combine.globally translation. Nevertheless I cannot spot the point in history where it changed. IMHO, the way I see this is that a given composite transform should be translated to its inner primitives only if a direct translation is not registered in the runner. Do you agree?&lt;/p&gt;</comment>
                            <comment id="16777077" author="kenn" created="Mon, 25 Feb 2019 16:33:43 +0000"  >&lt;p&gt;This is part of the SparkRunner, yes? Doesn&apos;t the SparkRunner still translate based on the Java class? There wasn&apos;t really a change - some runners started to translate based on URN, but they only added URNs for primitives and special composites that they cared about. I think other runners maybe just don&apos;t care about Combine.globally as a special composite. It seems just fine to add a URN now. Or am I misunderstanding the issue? Can you point it out in the SparkRunner?&lt;/p&gt;</comment>
                            <comment id="16777945" author="echauchot" created="Tue, 26 Feb 2019 14:13:01 +0000"  >&lt;p&gt;No it was changed in this PR: &lt;a href=&quot;https://github.com/apache/beam/pull/7005/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/7005/files&lt;/a&gt; spark translation is no more based on class but on urn. Previously in spark the class was added directly in spark translators map, and the translation worked fine. &lt;/p&gt;

&lt;p&gt;The problem seems more general than only spark runner because in runner-construction, there is only Combine.perKey PayloadTranslator see  &lt;a href=&quot;https://github.com/apache/beam/blob/2fbc8c0c2db3a0798e7cca0d30c3a7eec855b375/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/CombineTranslation.java#L57&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/2fbc8c0c2db3a0798e7cca0d30c3a7eec855b375/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/CombineTranslation.java#L57&lt;/a&gt;.  I fear the impact of adding a new CombineTranslation for Combine.globally in runner-contruction side. That being said, you&apos;re right, only spark has a direct translation of combine.Globally, all the others use only Combine.perKey.&lt;/p&gt;

&lt;p&gt;I took a look at nexmark query 7 perf (that uses Combine.globally) and the perf seems the same in spark before deactivating Combine.globally special translation (with Ismael&apos;s PR) and after. IMHO, I would recommend to leave the Combine.Globally dead code in case we need it in the future (we see its need with more in depth performances tests). But What is sure is that for now I will deactivate urn lookup in the new POC spark runner for which, not having a combine.globally translation will harm performances. &lt;br/&gt;
WDYT ? &lt;/p&gt;
</comment>
                            <comment id="16805587" author="kenn" created="Sat, 30 Mar 2019 01:50:11 +0000"  >&lt;p&gt;I think you should just add a URN for Combine.globally. That seems useful. Any transform that has well-defined semantics can and should have a URN. It is valuable in many ways:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if a runner has a special implementation (like yours) it can choose that and run zero user code&lt;/li&gt;
	&lt;li&gt;if there are multiple languages in a pipeline, the runner can choose the language with the most advantageous fusion to implement the URN&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;A URN does not just apply to primitives, and there is no requirement that any SDK implement anything except the primitives SDK harness URNs. It is just a hint.&lt;/p&gt;</comment>
                            <comment id="16806472" author="echauchot" created="Mon, 1 Apr 2019 07:25:03 +0000"  >&lt;p&gt;Totally agree with what &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kenn&quot; class=&quot;user-hover&quot; rel=&quot;kenn&quot;&gt;kenn&lt;/a&gt; said.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 33 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z001l4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>