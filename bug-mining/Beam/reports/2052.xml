<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:12:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-4091] Typehint annotations don&apos;t work with @ptransform_fn annotation</title>
                <link>https://issues.apache.org/jira/browse/BEAM-4091</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;Typehint annotations don&apos;t work with functions annotated with &lt;tt&gt;@ptransform_fn&lt;/tt&gt;, but they do work&#160;with the equivalent classes.&lt;/p&gt;

&lt;p&gt;The following is a minimal example illustrating this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
@beam.typehints.with_input_types(&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;)
@beam.typehints.with_output_types(&lt;span class=&quot;code-object&quot;&gt;bytes&lt;/span&gt;)
@beam.ptransform_fn
&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; _DoStuffFn(pcoll):
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; pcoll | &lt;span class=&quot;code-quote&quot;&gt;&apos;TimesTwo&apos;&lt;/span&gt; &amp;gt;&amp;gt; beam.Map(&lt;span class=&quot;code-keyword&quot;&gt;lambda&lt;/span&gt; x: x * 2)

@beam.typehints.with_input_types(&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;)
@beam.typehints.with_output_types(&lt;span class=&quot;code-object&quot;&gt;bytes&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;_DoStuffClass(beam.PTransform):

  &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; expand(&lt;span class=&quot;code-keyword&quot;&gt;self&lt;/span&gt;, pcoll):
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; pcoll | &lt;span class=&quot;code-quote&quot;&gt;&apos;TimesTwo&apos;&lt;/span&gt; &amp;gt;&amp;gt; beam.Map(&lt;span class=&quot;code-keyword&quot;&gt;lambda&lt;/span&gt; x: x * 2)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With definitions as above, the class correctly fails the typecheck:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; class_correctly_fails():
  p = beam.Pipeline(options=PipelineOptions(runtime_type_check=&lt;span class=&quot;code-keyword&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;True&lt;/span&gt;&lt;/span&gt;))
  _ = (p
       | &lt;span class=&quot;code-quote&quot;&gt;&apos;Create&apos;&lt;/span&gt; &amp;gt;&amp;gt; beam.Create([1, 2, 3, 4, 5])
       | &lt;span class=&quot;code-quote&quot;&gt;&apos;DoStuff1&apos;&lt;/span&gt; &amp;gt;&amp;gt; _DoStuffClass()
       | &lt;span class=&quot;code-quote&quot;&gt;&apos;DoStuff2&apos;&lt;/span&gt; &amp;gt;&amp;gt; _DoStuffClass()
       | &lt;span class=&quot;code-quote&quot;&gt;&apos;Write&apos;&lt;/span&gt; &amp;gt;&amp;gt; beam.io.WriteToText(&lt;span class=&quot;code-quote&quot;&gt;&apos;/tmp/output&apos;&lt;/span&gt;))
  p.run().wait_until_finish()

&lt;span class=&quot;code-comment&quot;&gt;# apache_beam.typehints.decorators.TypeCheckError: Input &lt;span class=&quot;code-object&quot;&gt;type&lt;/span&gt; hint violation at DoStuff1: expected &amp;lt;&lt;span class=&quot;code-object&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;&apos;&lt;/span&gt;&amp;gt;, got &amp;lt;&lt;span class=&quot;code-object&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&apos;&lt;/span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But the &lt;tt&gt;ptransform_fn&lt;/tt&gt; incorrectly passes the typecheck:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; ptransform_incorrectly_passes():
  p = beam.Pipeline(options=PipelineOptions(runtime_type_check=&lt;span class=&quot;code-keyword&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;True&lt;/span&gt;&lt;/span&gt;))
  _ = (p
       | &lt;span class=&quot;code-quote&quot;&gt;&apos;Create&apos;&lt;/span&gt; &amp;gt;&amp;gt; beam.Create([1, 2, 3, 4, 5])
       | &lt;span class=&quot;code-quote&quot;&gt;&apos;DoStuff1&apos;&lt;/span&gt; &amp;gt;&amp;gt; _DoStuffFn()
       | &lt;span class=&quot;code-quote&quot;&gt;&apos;DoStuff2&apos;&lt;/span&gt; &amp;gt;&amp;gt; _DoStuffFn()
       | &lt;span class=&quot;code-quote&quot;&gt;&apos;Write&apos;&lt;/span&gt; &amp;gt;&amp;gt; beam.io.WriteToText(&lt;span class=&quot;code-quote&quot;&gt;&apos;/tmp/output&apos;&lt;/span&gt;))
  p.run().wait_until_finish()
&lt;span class=&quot;code-comment&quot;&gt;# No error&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that changing the order of the &lt;tt&gt;@ptransform_fn&lt;/tt&gt; and type hint annotations doesn&apos;t change the result, i.e. changing &lt;tt&gt;_DoStuffFn&lt;/tt&gt; to the following still results in it incorrectly passing the typecheck:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
@beam.ptransform_fn
@beam.typehints.with_input_types(&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;)
@beam.typehints.with_output_types(&lt;span class=&quot;code-object&quot;&gt;bytes&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; _DoStuffFn(pcoll):
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; pcoll | &lt;span class=&quot;code-quote&quot;&gt;&apos;TimesTwo&apos;&lt;/span&gt; &amp;gt;&amp;gt; beam.Map(&lt;span class=&quot;code-keyword&quot;&gt;lambda&lt;/span&gt; x: x * 2)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13152819">BEAM-4091</key>
            <summary>Typehint annotations don&apos;t work with @ptransform_fn annotation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="10722" iconUrl="https://issues.apache.org/jira/images/icons/statuses/generic.png" description="">Triage Needed</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="udim">Udi Meiri</assignee>
                                    <reporter username="chuanyu">Chuan Yu Foo</reporter>
                        <labels>
                            <label>types</label>
                    </labels>
                <created>Mon, 16 Apr 2018 20:32:43 +0000</created>
                <updated>Thu, 13 Apr 2023 11:02:47 +0000</updated>
                            <resolved>Fri, 19 Mar 2021 17:20:23 +0000</resolved>
                                    <version>2.4.0</version>
                                    <fixVersion>Missing</fixVersion>
                                    <component>sdk-py-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="28800">8h</timespent>
                                <comments>
                            <comment id="16497459" author="tvalentyn" created="Fri, 1 Jun 2018 01:36:23 +0000"  >&lt;p&gt;Possibly the&#160;shares the rootcause with&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-4441&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/BEAM-4441&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16969420" author="udim" created="Thu, 7 Nov 2019 17:07:50 +0000"  >&lt;p&gt;Fix in &lt;a href=&quot;https://github.com/apache/beam/pull/9907&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/9907&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17132246" author="beamjirabot" created="Wed, 10 Jun 2020 17:27:17 +0000"  >&lt;p&gt;This issue is assigned but has not received an update in 30 days so it has been labeled &quot;stale-assigned&quot;. If you are still working on the issue, please give an update and remove the label. If you are no longer working on the issue, please unassign so someone else may work on it. In 7 days the issue will be automatically unassigned.&lt;/p&gt;</comment>
                            <comment id="17139609" author="beamjirabot" created="Thu, 18 Jun 2020 17:21:45 +0000"  >&lt;p&gt;This issue was marked &quot;stale-assigned&quot; and has not received a public comment in 7 days. It is now automatically unassigned. If you are still working on it, you can assign it to yourself again. Please also give an update about the status of the work.&lt;/p&gt;</comment>
                            <comment id="17140850" author="udim" created="Fri, 19 Jun 2020 21:53:54 +0000"  >&lt;p&gt;Still working on getting 9907 merged.&lt;/p&gt;</comment>
                            <comment id="17185337" author="beamjirabot" created="Wed, 26 Aug 2020 17:06:49 +0000"  >&lt;p&gt;This issue is assigned but has not received an update in 30 days so it has been labeled &quot;stale-assigned&quot;. If you are still working on the issue, please give an update and remove the label. If you are no longer working on the issue, please unassign so someone else may work on it. In 7 days the issue will be automatically unassigned.&lt;/p&gt;</comment>
                            <comment id="17189388" author="beamjirabot" created="Wed, 2 Sep 2020 17:06:57 +0000"  >&lt;p&gt;This issue was marked &quot;stale-assigned&quot; and has not received a public comment in 7 days. It is now automatically unassigned. If you are still working on it, you can assign it to yourself again. Please also give an update about the status of the work.&lt;/p&gt;</comment>
                            <comment id="17224290" author="beamjirabot" created="Sun, 1 Nov 2020 17:10:12 +0000"  >&lt;p&gt;This issue is P2 but has been unassigned without any comment for 60 days so it has been labeled &quot;stale-P2&quot;. If this issue is still affecting you, we care! Please comment and remove the label. Otherwise, in 14 days the issue will be moved to P3.&lt;/p&gt;

&lt;p&gt;Please see &lt;a href=&quot;https://beam.apache.org/contribute/jira-priorities/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://beam.apache.org/contribute/jira-priorities/&lt;/a&gt; for a detailed explanation of what these priorities mean.&lt;/p&gt;</comment>
                            <comment id="17224927" author="udim" created="Mon, 2 Nov 2020 20:04:45 +0000"  >&lt;p&gt;This has been fixed, included in Beam 2.25. Type checking is disabled by default to avoid breaking existing uses, enabled with --type_check_additional=ptransform_fn.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13264868">BEAM-8502</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3sm6n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>