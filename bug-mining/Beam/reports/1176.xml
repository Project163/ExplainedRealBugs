<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:58:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-7230] Using JdbcIO creates huge amount of connections</title>
                <link>https://issues.apache.org/jira/browse/BEAM-7230</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;I want to write form DataFlow to GCP cloud SQL, I&apos;m using connection pool, and still I see huge amount of connections in GCP SQL (4k while I set connection pool to 300), and most of them in sleep.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13231789">BEAM-7230</key>
            <summary>Using JdbcIO creates huge amount of connections</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="iemejia">Isma&#235;l Mej&#237;a</assignee>
                                    <reporter username="brachi_packter">Brachi Packter</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 May 2019 15:23:50 +0000</created>
                <updated>Sat, 16 May 2020 14:07:30 +0000</updated>
                            <resolved>Tue, 21 May 2019 19:16:14 +0000</resolved>
                                    <version>2.11.0</version>
                                    <fixVersion>2.13.0</fixVersion>
                                    <component>runner-dataflow</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="15000">4h 10m</timespent>
                                <comments>
                            <comment id="16834464" author="iemejia" created="Tue, 7 May 2019 07:49:02 +0000"  >&lt;p&gt;Is this happening on a streaming pipeline? It may be that the resources are not correctly freed when tearing down the functions. Any extra info/logs/screenshots would be appreciated. Thx&lt;/p&gt;</comment>
                            <comment id="16834584" author="brachi_packter" created="Tue, 7 May 2019 09:46:38 +0000"  >&lt;p&gt;Yes, in streaming.&lt;/p&gt;

&lt;p&gt;I found the issue, connection&#160;pool is created per instance, and if I is created inside the DoFn, then it&apos;s created per DataFlow worker thread.&#160;&lt;br/&gt;
This cause to huge amount of connection pool, and allowed connections per pool are multiplied by the running threads* running workeres.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I was able to fix it by stop using apache beam JDBCIO library. and create a singlton DataSource per worker. and for each data source give small amount of allowed connections in pool.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Here I create a siglton data source:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ConnectionPoolProvider {

    DataSource dataSource;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; ConnectionPoolProvider instance = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; lock = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;();

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; ConnectionPoolProvider getInstance() {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (instance == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (lock) {
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (instance == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                    instance = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ConnectionPoolProvider();
                }
            }
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; instance;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; ConnectionPoolProvider() {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.dataSource = getHikariDataSource();
    }


    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; DataSource getHikariDataSource() {
        HikariConfig config = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HikariConfig();
        &lt;span class=&quot;code-comment&quot;&gt;// Configure which instance and what database user to connect with.
&lt;/span&gt;        config.setJdbcUrl(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:mysql:&lt;span class=&quot;code-comment&quot;&gt;///%s&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;some-name&quot;&lt;/span&gt;));
&lt;/span&gt;        config.setUsername(&lt;span class=&quot;code-quote&quot;&gt;&quot;some-user&quot;&lt;/span&gt;);
        config.setPassword(&lt;span class=&quot;code-quote&quot;&gt;&quot;some-password&quot;&lt;/span&gt;);

        config.addDataSourceProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;socketFactory&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;com.google.cloud.sql.mysql.SocketFactory&quot;&lt;/span&gt;);
        config.addDataSourceProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;cloudSqlInstance&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;staging-161313:us-central1:mysql-instance&quot;&lt;/span&gt;);
        config.addDataSourceProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;useSSL&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-comment&quot;&gt;// maximumPoolSize limits the total number of concurrent connections &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; pool will keep.
&lt;/span&gt;        config.setMaximumPoolSize(15);
        &lt;span class=&quot;code-comment&quot;&gt;// minimumIdle is the minimum number of idle connections Hikari maintains in the pool.
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// Additional connections will be established to meet &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; value unless the pool is full.
&lt;/span&gt;        config.setMinimumIdle(5);
        &lt;span class=&quot;code-comment&quot;&gt;// setConnectionTimeout is the maximum number of milliseconds to wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a connection checkout.
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// Any attempt to retrieve a connection from &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; pool that exceeds the set limit will &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; an
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// SQLException.
&lt;/span&gt;        config.setConnectionTimeout(10000); &lt;span class=&quot;code-comment&quot;&gt;// 10 seconds
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// idleTimeout is the maximum amount of time a connection can sit in the pool. Connections that
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// sit idle &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; many milliseconds are retried &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; minimumIdle is exceeded.
&lt;/span&gt;        config.setIdleTimeout(600000); &lt;span class=&quot;code-comment&quot;&gt;//  10 minutes
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// maxLifetime is the maximum possible lifetime of a connection in the pool. Connections that
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// live longer than &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; many milliseconds will be closed and reestablished between uses. This
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// value should be several minutes shorter than the database&apos;s timeout value to avoid unexpected
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// terminations.
&lt;/span&gt;        config.setMaxLifetime(1800000); &lt;span class=&quot;code-comment&quot;&gt;// 30 minutes
&lt;/span&gt;

        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HikariDataSource(config);
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; DataSource getDataSource() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; dataSource;
    }

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And here my Transformer&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt;  PCollection&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Void&lt;/span&gt;&amp;gt; expand(PCollection&amp;lt;Row&amp;gt; input) {


          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; input
                .apply(ParDo.of(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DoFn&amp;lt;ValueInSingleWindow&amp;lt;Row&amp;gt;, &lt;span class=&quot;code-object&quot;&gt;Void&lt;/span&gt;&amp;gt;() {
                    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; List&amp;lt;ValueInSingleWindow&amp;lt;Row&amp;gt;&amp;gt; records = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
                    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; DataSource dataSource;

                    @Setup
                    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setup(){
                        dataSource=ConnectionPoolProvider.getInstance().getDataSource();
                    }


                    @ProcessElement
                    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(ProcessContext context) {

                        records.add(context.element());
                        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (records.size() &amp;gt;= BATCH_SIZE) {
                            executeBatch();
                        }
                    }

                    @FinishBundle
                    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void finishBundle() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
                        executeBatch();

                    }

                    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void executeBatch()  {
                        logger.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;execute batch size&quot;&lt;/span&gt;+records.size());
                        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (records.isEmpty()) {
                            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
                        }
                        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;(Connection connection = dataSource.getConnection();
                            PreparedStatement preparedStatement = connection.prepareStatement(&lt;span class=&quot;code-quote&quot;&gt;&quot;insert into SOME_TABLE values(??)&quot;&lt;/span&gt;))
                        {
                            connection.setAutoCommit(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
                            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (ValueInSingleWindow&amp;lt;Row&amp;gt; record : records) {
                                preparedStatement.clearParameters();
                                prepareStatement(record, preparedStatement);
                                preparedStatement.addBatch();
                            }
                            preparedStatement.executeBatch();


                        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SQLException e) {
                            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeException(&lt;span class=&quot;code-quote&quot;&gt;&quot;failed execute&quot;&lt;/span&gt;, e);
                        }
                        records.clear();
                    }
                }));

    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16834769" author="iemejia" created="Tue, 7 May 2019 13:36:59 +0000"  >&lt;p&gt;It makes perfect sense as a fix, thanks for sharing. I created a &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-7239&quot; title=&quot;Add withDataSourceProviderFn() to JdbcIO&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-7239&quot;&gt;&lt;del&gt;BEAM-7239&lt;/del&gt;&lt;/a&gt; to allow to parametrize the DataSource creation and then we can see if we can add the singleton implementation as one of the cases.&lt;/p&gt;</comment>
                            <comment id="16835418" author="iemejia" created="Wed, 8 May 2019 08:15:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-7239&quot; title=&quot;Add withDataSourceProviderFn() to JdbcIO&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-7239&quot;&gt;&lt;del&gt;BEAM-7239&lt;/del&gt;&lt;/a&gt; is merged now. So you can parametrize the `DataSource` creation suing `withDataSourceProviderFn`. this should make your code simpler. (see the javadoc for more details)&lt;/p&gt;

&lt;p&gt;I will try to provide a default implementation to cover the case you reported in a more generic approach later on.&lt;/p&gt;

&lt;p&gt;Were you by any chance using the recently introduced poolable parameter, if so &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-7239&quot; title=&quot;Add withDataSourceProviderFn() to JdbcIO&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-7239&quot;&gt;&lt;del&gt;BEAM-7239&lt;/del&gt;&lt;/a&gt; solves the issue of multiple pool instance creation too.&lt;/p&gt;</comment>
                            <comment id="16835851" author="iemejia" created="Wed, 8 May 2019 19:42:52 +0000"  >&lt;p&gt;THinking about it, the included implementation of DataSourceProviderFn `PoolableDataSourceProvider` instantiates a Poolable DataSource per JVM so it should cover your case, if you have the chance to try if it works it would be great to know. Thanks&lt;/p&gt;</comment>
                            <comment id="16835896" author="brachi" created="Wed, 8 May 2019 20:43:00 +0000"  >&lt;p&gt;Awesome, I&apos;ll check it out.&lt;/p&gt;

</comment>
                            <comment id="16836494" author="iemejia" created="Thu, 9 May 2019 16:03:36 +0000"  >&lt;p&gt;Adding this discussion in the ML as a reference to a previous report on the issue&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://lists.apache.org/thread.html/f4b3954cb89f67125e0d3906f9fa5cb800fc6293a7d9e2ffb6bfce52@%3Cdev.beam.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread.html/f4b3954cb89f67125e0d3906f9fa5cb800fc6293a7d9e2ffb6bfce52@%3Cdev.beam.apache.org%3E&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16838018" author="brachi_packter" created="Sun, 12 May 2019 07:32:44 +0000"  >&lt;p&gt;Can you create for me a&#160; release candidate version, that I can&#160;test it without checking out all the repo and build locally? or any other registration for the new version?&#160;&lt;/p&gt;</comment>
                            <comment id="16838359" author="iemejia" created="Mon, 13 May 2019 08:19:07 +0000"  >&lt;p&gt;You can try today by using the `-SNAPSHOT` version `2.13.0-SNAPSHOT`. The release vote for 2.13.0 is starting this week so that could be another way. Only doubt I have is I am not sure if they build &apos;snapshot&apos; versions of their worker images, if that does not work we should then wait some days until the release is voted/out.&lt;/p&gt;</comment>
                            <comment id="16838373" author="brachi_packter" created="Mon, 13 May 2019 08:39:01 +0000"  >&lt;p&gt;No 2.13.0-SNAPSHOT available. maybe it isn&apos;t in the public repository?&lt;/p&gt;</comment>
                            <comment id="16838404" author="aromanenko" created="Mon, 13 May 2019 09:30:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brachi_packter&quot; class=&quot;user-hover&quot; rel=&quot;brachi_packter&quot;&gt;brachi_packter&lt;/a&gt; Do you use snapshot repository &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/&lt;/a&gt;? &lt;br/&gt;
Just in case, an example how to use it in your project is &lt;a href=&quot;https://github.com/jbonofre/beam-samples/blob/master/pom.xml&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here &lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16838410" author="brachi_packter" created="Mon, 13 May 2019 09:34:20 +0000"  >&lt;p&gt;Yes, package found, I use the snapshot repository.&lt;/p&gt;

&lt;p&gt;I will test it and let you know.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="16838451" author="brachi_packter" created="Mon, 13 May 2019 10:33:35 +0000"  >&lt;p&gt;You close the data source on @TearDown&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Teardown
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void teardown() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
	connection.close();
	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (dataSource &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; AutoCloseable) {
	  ((AutoCloseable) dataSource).close();
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So. If I want one Data source for any worker, shared between ant DoFn threads, you must not close it up.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;my code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
.apply(JdbcIO.&amp;lt;ValueInSingleWindow&amp;lt;Row&amp;gt;&amp;gt;write()
        .withDataSourceProviderFn((SerializableFunction&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Void&lt;/span&gt;, DataSource&amp;gt;)   input1 -&amp;gt; {
            ConnectionPoolProvider.init(dataBaseName, userName, project, region, instanceName);
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ConnectionPoolProvider.getInstance().getDataSource();
        })
.withStatement(sqlInsertCommand)
.withPreparedStatementSetter((JdbcIO.PreparedStatementSetter&amp;lt;ValueInSingleWindow&amp;lt;Row&amp;gt;&amp;gt;) &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;::prepareStatement
));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This leads to this exception:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.sql.SQLException: HikariDataSource HikariDataSource (HikariPool-1) has been closed. com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:96) org.apache.beam.sdk.io.jdbc.JdbcIO$WriteVoid$WriteFn.startBundle(JdbcIO.java:990)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16838510" author="iemejia" created="Mon, 13 May 2019 12:39:04 +0000"  >&lt;p&gt;Thanks for testing it and reporting working on a fix.&lt;/p&gt;</comment>
                            <comment id="16838642" author="iemejia" created="Mon, 13 May 2019 15:52:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brachi_packter&quot; class=&quot;user-hover&quot; rel=&quot;brachi_packter&quot;&gt;brachi_packter&lt;/a&gt; notice that in the provided function if you use PoolableDatasource you MUST guarantee that the DataSource is constructed as a static value, that way it will exist only once per JVM, otherwise you will be building a Pool per DoFn and in streaming it will intend to do many connections which is the core of this issue.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16838667" author="brachi_packter" created="Mon, 13 May 2019 16:16:05 +0000"  >&lt;p&gt;But I didn&apos;t use `PoolableDatasource`, because I see GCP recommend using `HikariCP`. (yes I keep it static)&lt;/p&gt;

&lt;p&gt;Do you think better use&#160;MemoizedDataSourceProvider?&lt;/p&gt;</comment>
                            <comment id="16839077" author="jbonofre" created="Tue, 14 May 2019 05:03:00 +0000"  >&lt;p&gt;It seems we are talking about lot of `Connection` which is closed in `teardown` already. I&apos;m OK to close the `DataSource` itself but I&apos;m not sure it will actually limit the connections or it&apos;s a side effect.&lt;/p&gt;</comment>
                            <comment id="16839302" author="iemejia" created="Tue, 14 May 2019 10:30:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brachi_packter&quot; class=&quot;user-hover&quot; rel=&quot;brachi_packter&quot;&gt;brachi_packter&lt;/a&gt; the fix was merged, now it does not try to close the datasource so it can be shared by multiple threads in he same VM. This is the core of the issue. However the SNAPSHOTS are generated every day so you have to wait until tomorrow to have the updated JAR.&lt;/p&gt;

&lt;p&gt;You can continue using Hikari if you prefer but you have to pay attention that the DataSource instance you provide in the function is created only once and shared by all the users of the function by making it static and a singleton, something like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;DataSourceProviderFn &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; SerializableFunction&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Void&lt;/span&gt;, DataSource&amp;gt; {
 &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; HikariDataSource ds;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; DataSourceProviderFn(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; dataBaseName, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; userName, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; project, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; region, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; instanceName) {
 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ds == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)

{ ds = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HikariDataSource( ... ); }

}

@Override
 &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; DataSource apply(&lt;span class=&quot;code-object&quot;&gt;Void&lt;/span&gt; input)

{ &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ds; }

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that `PoolableDataSourceProvider` guarantees this  I will probably improve the documentation on this in subsequent PR later on.&lt;/p&gt;</comment>
                            <comment id="16839307" author="brachi" created="Tue, 14 May 2019 10:35:00 +0000"  >&lt;p&gt;Great!&lt;br/&gt;
I&apos;ll check this tomorrow.&lt;br/&gt;
I&apos;ll try use the internal data source too.&lt;br/&gt;
Thank you for your responsivness!&lt;/p&gt;



</comment>
                            <comment id="16840666" author="brachi_packter" created="Wed, 15 May 2019 18:52:53 +0000"  >&lt;p&gt;Hi again.&lt;/p&gt;

&lt;p&gt;Checking with the new snapshot.&lt;/p&gt;

&lt;p&gt;When I configure my own data source. it works great! thanks.&lt;/p&gt;

&lt;p&gt;I tested&#160;also with this way, (the default implementation), then I get very quick &quot;too many connection&quot; error...&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
pipeline.apply(JdbcIO.&amp;lt;KV&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;&amp;gt;read() .withDataSourceProviderFn(JdbcIO.PoolableDataSourceProvider.of( JdbcIO.DataSourceConfiguration.create( &lt;span class=&quot;code-quote&quot;&gt;&quot;com.mysql.jdbc.Driver&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:mysql:&lt;span class=&quot;code-comment&quot;&gt;//hostname:3306/mydb&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;username&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;password&quot;&lt;/span&gt;)))&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;With custom data source I process 50k queries with 1000 connection, and with the default data source, I process 20k queries with 4000 connection (the limit).&lt;/p&gt;

&lt;p&gt;Do you think it can&#160;be related to another configuration I set, like connection timeout, max pool size and more?&lt;/p&gt;

&lt;p&gt;Didn&apos;t check the code, But with the default implementation (above code), do we still create data source pool for each DoFn?&lt;/p&gt;

&lt;p&gt;If yes, then we should change this too, to be statically initialized per JVM.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16841455" author="iemejia" created="Thu, 16 May 2019 15:23:51 +0000"  >&lt;p&gt;Great to know the singleton static idea works. I created a PR to improve the documentation for the case of PoolableDataSources.&lt;br/&gt;
I also double checked the implementation of `PoolableDataSourceProvider`and it is doing exactly what it should so I think it should be an issue of configuration. I think we cannot fix that without an approach that adds tons of knobs so I am going to propose to deprecate that object and remove it in the future.&lt;br/&gt;
Thanks a lot for all your help and feedback with this issue &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brachi_packter&quot; class=&quot;user-hover&quot; rel=&quot;brachi_packter&quot;&gt;brachi_packter&lt;/a&gt;. I am glad to know you don&apos;t need to fork JdbcIO now.&lt;/p&gt;</comment>
                            <comment id="16841509" author="iemejia" created="Thu, 16 May 2019 16:23:25 +0000"  >&lt;p&gt;The issue is now documented and a way to vaoid it is proposed via &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-7239&quot; title=&quot;Add withDataSourceProviderFn() to JdbcIO&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-7239&quot;&gt;&lt;del&gt;BEAM-7239&lt;/del&gt;&lt;/a&gt; so Ia marking it as fixed.&lt;/p&gt;</comment>
                            <comment id="16841646" author="brachi_packter" created="Thu, 16 May 2019 19:03:40 +0000"  >&lt;p&gt;Hi.&lt;/p&gt;

&lt;p&gt;Looked into the code, seems that like when using API&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/beam/blob/adb6d0c9f790c9cda363dd5d14f03fb11362f4d1/sdks/java/io/jdbc/src/main/java/org/apache/beam/sdk/io/jdbc/JdbcIO.java#L298&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/adb6d0c9f790c9cda363dd5d14f03fb11362f4d1/sdks/java/io/jdbc/src/main/java/org/apache/beam/sdk/io/jdbc/JdbcIO.java#L298&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;you are setting data source via:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/beam/blob/adb6d0c9f790c9cda363dd5d14f03fb11362f4d1/sdks/java/io/jdbc/src/main/java/org/apache/beam/sdk/io/jdbc/JdbcIO.java#L361&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/adb6d0c9f790c9cda363dd5d14f03fb11362f4d1/sdks/java/io/jdbc/src/main/java/org/apache/beam/sdk/io/jdbc/JdbcIO.java#L361&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;and then it is not static, and created per function...&lt;/p&gt;</comment>
                            <comment id="16841967" author="iemejia" created="Fri, 17 May 2019 07:20:07 +0000"  >&lt;p&gt;Thanks again &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brachi_packter&quot; class=&quot;user-hover&quot; rel=&quot;brachi_packter&quot;&gt;brachi_packter&lt;/a&gt; I debugged in more detail and could reproduce and see what you mean, preparing a fix soon. Hope you can help me tried in your use case.&lt;/p&gt;</comment>
                            <comment id="16841978" author="brachi" created="Fri, 17 May 2019 07:48:00 +0000"  >&lt;p&gt;Glad to hear that. I&apos;ll check it out once it ready.&lt;br/&gt;
Thanks.&lt;/p&gt;

</comment>
                            <comment id="16845019" author="iemejia" created="Tue, 21 May 2019 16:49:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brachi_packter&quot; class=&quot;user-hover&quot; rel=&quot;brachi_packter&quot;&gt;brachi_packter&lt;/a&gt; `PoolableDataSourceProvider` instatiation issue was merged into master today and I am waiting that it gets cherry picked to resolve this issue. Would you mind to give it a try again (should be in tomorrow SNAPSHOT version). Thanks.&lt;/p&gt;</comment>
                            <comment id="16845098" author="brachi" created="Tue, 21 May 2019 18:07:00 +0000"  >&lt;p&gt;Sure. Send me also a link to PR/ revision. I wish to see the code changes.&lt;br/&gt;
And understand better&lt;/p&gt;

</comment>
                            <comment id="16845163" author="iemejia" created="Tue, 21 May 2019 19:19:31 +0000"  >&lt;p&gt;This is the PR &lt;a href=&quot;https://github.com/apache/beam/pull/8635/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/8635/files&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I decided to reduce the whole wrapper hierarchy I had before because even if composable and nice it was a bit overkill and specially error-prone. So now there is a straightforward implementation of the PoolableDataSourceProvider, I also made internal values static to guarantee the single time construction, and the &apos;tricky&apos; part to tackle was to make the method that built the DataSource static and synchronized to avoid interleaving of threads because in the write case the DoFn is instantiated per thread so I was still having the DataSource built multiple times.&lt;/p&gt;</comment>
                            <comment id="16845769" author="brachi_packter" created="Wed, 22 May 2019 11:02:55 +0000"  >&lt;p&gt;When doing this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
.withDataSourceProviderFn(JdbcIO.PoolableDataSourceProvider.of( JdbcIO.DataSourceConfiguration.create( &lt;span class=&quot;code-quote&quot;&gt;&quot;com.mysql.jdbc.Driver&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:mysql:...&quot;&lt;/span&gt;)))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I get Null Pointer Exception. seems like&#160;dataSourceProviderFn is null by default.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.beam.sdk.io.jdbc.JdbcIO$PoolableDataSourceProvider.buildDataSource(JdbcIO.java:1101)
org.apache.beam.sdk.io.jdbc.JdbcIO$PoolableDataSourceProvider.apply(JdbcIO.java:1096) org.apache.beam.sdk.io.jdbc.JdbcIO$PoolableDataSourceProvider.apply(JdbcIO.java:1076) org.apache.beam.sdk.io.jdbc.JdbcIO$WriteVoid$WriteFn.setup(JdbcIO.java:959)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I use intently tested the most simple API,&#160;can you fix it?&lt;/p&gt;</comment>
                            <comment id="16848512" author="iemejia" created="Sun, 26 May 2019 19:46:45 +0000"  >&lt;p&gt;Hi, sorry I have missed your comment.&lt;/p&gt;

&lt;p&gt;I tried to reproduce this but cannot get the same error. Can you give me some more details? I tried both for a Read and a Write with success results.&lt;/p&gt;

&lt;p&gt;dataSourceProviderFn will not be null once PoolableDataSourceProvider instance is created via `of`. Only thing that I can foresee is a possible issue of serialization if you are building the DataSource eagerly, but that does not seem to be the case at least with the code pasted here.&lt;/p&gt;</comment>
                            <comment id="16939262" author="stabmeqt" created="Fri, 27 Sep 2019 09:44:52 +0000"  >&lt;p&gt;Unfortunately I came across the same behavior while executing the pipeline using the DataflowRunner.&lt;/p&gt;

&lt;p&gt;Exception in Dataflow console:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.RuntimeException: org.apache.beam.sdk.util.UserCodeException:  Caused by: 
[SKIPPED] 14 more Caused by: java.lang.NullPointerException at org.apache.beam.sdk.io.jdbc.JdbcIO$PoolableDataSourceProvider.buildDataSource(JdbcIO.java:1394) at org.apache.beam.sdk.io.jdbc.JdbcIO$PoolableDataSourceProvider.apply(JdbcIO.java:1389) at org.apache.beam.sdk.io.jdbc.JdbcIO$PoolableDataSourceProvider.apply(JdbcIO.java:1369) at org.apache.beam.sdk.io.jdbc.JdbcIO$ReadFn.setup(JdbcIO.java:862)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Testing locally with DirectRunner gives no error.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Here&apos;s my code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ReadFromJdbcFn &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; PTransform&amp;lt;PBegin, PCollection&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;&amp;gt; {

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; JdbcToCsvOptions options;

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; ReadFromJdbcFn(JdbcToCsvOptions options) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.options = options;
    }

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; PCollection&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; expand(PBegin input) {

        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; JdbcIO.DataSourceConfiguration dataSourceConfiguration = configure(options.getConnectionString(),
                options.getDriverName(), options.getUser(),
                options.getPassword(), options.getConnectionProperties());

        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; SerializableFunction&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Void&lt;/span&gt;, DataSource&amp;gt; dataSourceProviderFunction =
                JdbcIO.PoolableDataSourceProvider.of(dataSourceConfiguration);

        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; input.apply(
                JdbcIO.&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;read()
                        .withDataSourceProviderFn(dataSourceProviderFunction)
                        .withCoder(StringUtf8Coder.of())
                        .withFetchSize(options.getFetchSize())
                        .withQuery(options.getQuery())
                        .withRowMapper(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JdbcToCsvRowMapper()));
    }

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; JdbcIO.DataSourceConfiguration configure(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; connString, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; driver, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; user, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; password,
                                                            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; connProperties) {

        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; JdbcIO.DataSourceConfiguration dataSourceConfiguration = JdbcIO.DataSourceConfiguration.create(driver, connString)
                .withUsername(user)
                .withPassword(password);

        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; connProperties == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ?
                dataSourceConfiguration : dataSourceConfiguration.withConnectionProperties(connProperties);
    }
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Also, I wonder will the Dataflow autoscale it&apos;s worker&apos;s count based on the amount of data read from database?&lt;/p&gt;</comment>
                            <comment id="16962469" author="lcwik" created="Tue, 29 Oct 2019 21:12:57 +0000"  >&lt;p&gt;The issue is that PoolableDataSourceProvider stores dataSourceProviderFn as a static which means that it will never be serialized and once it is deserialized it is lost.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This means that any tests that don&apos;t include serializing and deserializing the Source/DoFns won&apos;t catch this. So remote execution will be broken.&lt;/p&gt;</comment>
                            <comment id="16962474" author="lcwik" created="Tue, 29 Oct 2019 21:26:06 +0000"  >&lt;p&gt;Also, the connection factory here assumes that only one JdbcIO connector using a PoolableDataSourceProvider and only one using a DataSourceProviderFromDataSourceConfiguration will ever be used within a pipeline since the connection pool will return the &quot;first&quot; DataSource that is initialized since those classes all share the sameinstance` static variable.&lt;/p&gt;

&lt;p&gt;The caching should really be from DataSourceConfiguration -&amp;gt; Instance&lt;/p&gt;

&lt;p&gt;The good news is that&#160;DataSourceConfiguration is an AutoValue so it implements an equals method so they are comparable.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 2 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z02fcw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>