<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:23:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-13606] bigtable io doesn&apos;t handle non-ok row mutations</title>
                <link>https://issues.apache.org/jira/browse/BEAM-13606</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;bigtable io has no logic to retry row mutations for rows with non-ok return status (this includes None return value when bigtable suppresses retryable errors, details see &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-13602&quot; title=&quot;Metrics reporting failed bigtable io&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-13602&quot;&gt;&lt;del&gt;BEAM-13602&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;To avoid data loss, the solution should be:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Retry for those retryable-failed row mutations;&lt;/li&gt;
	&lt;li&gt;Tagged output for those non-retryable-failed row mutations.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Or clarify that the I/O doesn&apos;t handle failed row mutations in docstrings.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13421182">BEAM-13606</key>
            <summary>bigtable io doesn&apos;t handle non-ok row mutations</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10101" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">P1</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chamikara">Chamikara Madhusanka Jayalath</assignee>
                                    <reporter username="ningk">Ning</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Jan 2022 00:38:24 +0000</created>
                <updated>Tue, 8 Feb 2022 15:23:32 +0000</updated>
                            <resolved>Tue, 8 Feb 2022 15:23:32 +0000</resolved>
                                                    <fixVersion>2.37.0</fixVersion>
                                    <component>io-py-gcp</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="8400">2h 20m</timespent>
                                <comments>
                            <comment id="17470324" author="altay" created="Fri, 7 Jan 2022 04:09:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chamikara&quot; class=&quot;user-hover&quot; rel=&quot;chamikara&quot;&gt;chamikara&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kerrydc&quot; class=&quot;user-hover&quot; rel=&quot;kerrydc&quot;&gt;kerrydc&lt;/a&gt; - Would it be possible to verify if there is a risk of data loss in this scenario? If that is the case, we need to fix it sooner than later. &lt;/p&gt;

&lt;p&gt;Do we have an owner for bigtable IO from the bigtable people?&lt;/p&gt;</comment>
                            <comment id="17470336" author="chamikara" created="Fri, 7 Jan 2022 05:22:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=igorbernstein2&quot; class=&quot;user-hover&quot; rel=&quot;igorbernstein2&quot;&gt;igorbernstein2&lt;/a&gt; might have an idea.&lt;/p&gt;

&lt;p&gt;Note that this connector was added by a contributor sometime back and currently in an incomplete state.&lt;/p&gt;</comment>
                            <comment id="17470812" author="chamikara" created="Fri, 7 Jan 2022 18:39:23 +0000"  >&lt;p&gt;So the code you pointe to is internal to Python BigTable client.&lt;/p&gt;

&lt;p&gt;Are you sure that client would and up returning &quot;None&quot; for retriable errors instead of the proper status ? If so this sounds like a bug in Python BigTable client not the Beam connector since it would be violating the BigTable rest API (and common patterns when it comes to returning error codes).&lt;/p&gt;

&lt;p&gt;I&apos;m not sure though since the code you pointed to &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; is a private class in BigTable Python client and &apos;None&apos; status messages seems to be handled there as well &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;. If we confirm that this is a bug in the Python BigTable client, we should file an issue against that &lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=igorbernstein2&quot; class=&quot;user-hover&quot; rel=&quot;igorbernstein2&quot;&gt;igorbernstein2&lt;/a&gt; might be able to help).&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/googleapis/python-bigtable/blob/fec06fcd28c36d0d3b347b43d1f3d264e5f5aa39/google/cloud/bigtable/table.py#L1078&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/googleapis/python-bigtable/blob/fec06fcd28c36d0d3b347b43d1f3d264e5f5aa39/google/cloud/bigtable/table.py#L1078&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/googleapis/python-bigtable/blob/fec06fcd28c36d0d3b347b43d1f3d264e5f5aa39/google/cloud/bigtable/table.py#L1089&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/googleapis/python-bigtable/blob/fec06fcd28c36d0d3b347b43d1f3d264e5f5aa39/google/cloud/bigtable/table.py#L1089&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt;&lt;a href=&quot;https://github.com/googleapis/python-bigtable&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/googleapis/python-bigtable&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17470831" author="ningk" created="Fri, 7 Jan 2022 19:08:03 +0000"  >&lt;ol&gt;
	&lt;li&gt;The Beam side never retries/handles cases when there is a valid Status that isn&apos;t OK.&lt;/li&gt;
	&lt;li&gt;The `_do_mutate_retryable_rows` function raises _BigtableRetryableError when running into RETRYABLE_MUTATION_ERRORS. In that case, responses are not populated at all and statuses remain None. &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&#160;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;A fix needs to be done on both sides to make this right:&lt;br/&gt;
Beam should retry retryable errors and handle non-retryable errors.&lt;br/&gt;
Bigtable should tell the client about retryable errors instead of suppress it.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/googleapis/python-bigtable/blob/fec06fcd28c36d0d3b347b43d1f3d264e5f5aa39/google/cloud/bigtable/table.py#L1139&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/googleapis/python-bigtable/blob/fec06fcd28c36d0d3b347b43d1f3d264e5f5aa39/google/cloud/bigtable/table.py#L1139&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17470845" author="chamikara" created="Fri, 7 Jan 2022 19:30:37 +0000"  >&lt;p&gt;I see. Agree that a Beam fix is needed as well.&lt;/p&gt;

&lt;p&gt;Does it actually set OK status for successful mutations ? If not successful mutations will&#160; be indistinguishable from failed mutations with &apos;None&apos; as the return status.&lt;/p&gt;</comment>
                            <comment id="17470854" author="ningk" created="Fri, 7 Jan 2022 19:44:20 +0000"  >&lt;p&gt;When no retryable error is raised, the client does set OK status for successful mutations and if there is any error but not retryable, they are also set.&lt;/p&gt;

&lt;p&gt;Though it seems that if rows are batched/flushed together, they will share the same None value returned by the client even if only one of the rows run into retryable error. The real row mutation happens in this RPC &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;See how the try-except skips all following codes that populates the responses from the RPC to the responses returned by the client.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/googleapis/python-bigtable/blob/fec06fcd28c36d0d3b347b43d1f3d264e5f5aa39/google/cloud/bigtable/table.py#L1126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/googleapis/python-bigtable/blob/fec06fcd28c36d0d3b347b43d1f3d264e5f5aa39/google/cloud/bigtable/table.py#L1126&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17470857" author="chamikara" created="Fri, 7 Jan 2022 19:49:02 +0000"  >&lt;p&gt;Thanks. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ningk&quot; class=&quot;user-hover&quot; rel=&quot;ningk&quot;&gt;ningk&lt;/a&gt;&#160; Would you be able to file a bug against the BigTable client library since you have the most context here ?&lt;/p&gt;</comment>
                            <comment id="17470885" author="ningk" created="Fri, 7 Jan 2022 21:08:38 +0000"  >&lt;p&gt;Filed &lt;a href=&quot;https://github.com/googleapis/python-bigtable/issues/485&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/googleapis/python-bigtable/issues/485&lt;/a&gt;. I&apos;ve input a code snippet where I manually set an extremely low timeout to exhaust retry budget and has verified this unexpected behavior. This is a legit bug.&lt;/p&gt;</comment>
                            <comment id="17470887" author="chamikara" created="Fri, 7 Jan 2022 21:15:19 +0000"  >&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                            <comment id="17488370" author="kenn" created="Mon, 7 Feb 2022 19:08:21 +0000"  >&lt;p&gt;Is &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-13376&quot; title=&quot;Missing error for nonexistent column family BigTable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-13376&quot;&gt;&lt;del&gt;BEAM-13376&lt;/del&gt;&lt;/a&gt; exactly the same, or a variation?&lt;/p&gt;</comment>
                            <comment id="17488375" author="ningk" created="Mon, 7 Feb 2022 19:13:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kenn&quot; class=&quot;user-hover&quot; rel=&quot;kenn&quot;&gt;kenn&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-13376&quot; title=&quot;Missing error for nonexistent column family BigTable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-13376&quot;&gt;&lt;del&gt;BEAM-13376&lt;/del&gt;&lt;/a&gt; is a variation.&lt;/p&gt;

&lt;p&gt;The root cause is not in Beam. The Bigtable client swallows some errors. I&apos;ve filed a ticket on Github to them: &lt;a href=&quot;https://github.com/googleapis/python-bigtable/issues/485&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/googleapis/python-bigtable/issues/485&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17488401" author="kenn" created="Mon, 7 Feb 2022 19:49:01 +0000"  >&lt;p&gt;Yea. Looks like we have an idea to workaround it so that&apos;s good.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 40 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0yby8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>