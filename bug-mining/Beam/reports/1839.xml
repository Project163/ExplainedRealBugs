<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:08:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-9522] BeamJoinRel.extractJoinRexNode RexLiteral cannot be cast to RexCall</title>
                <link>https://issues.apache.org/jira/browse/BEAM-9522</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;One failure in shard 2, One failure in shard 35&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.ClassCastException: org.apache.beam.vendor.calcite.v1_20_0.org.apache.calcite.rex.RexLiteral cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to org.apache.beam.vendor.calcite.v1_20_0.org.apache.calcite.rex.RexCall
	at org.apache.beam.sdk.extensions.sql.impl.rel.BeamJoinRel.extractJoinRexNodes(BeamJoinRel.java:304)
	at org.apache.beam.sdk.extensions.sql.impl.rel.BeamJoinRel$ExtractJoinKeys.expand(BeamJoinRel.java:194)
	at org.apache.beam.sdk.extensions.sql.impl.rel.BeamJoinRel$ExtractJoinKeys.expand(BeamJoinRel.java:177)
	at org.apache.beam.sdk.Pipeline.applyInternal(Pipeline.java:542)
	at org.apache.beam.sdk.Pipeline.applyTransform(Pipeline.java:476)
	at org.apache.beam.sdk.values.PCollectionList.apply(PCollectionList.java:178)
	at org.apache.beam.sdk.extensions.sql.impl.rel.BeamCoGBKJoinRel$StandardJoin.expand(BeamCoGBKJoinRel.java:93)
	at org.apache.beam.sdk.extensions.sql.impl.rel.BeamCoGBKJoinRel$StandardJoin.expand(BeamCoGBKJoinRel.java:86)
	at org.apache.beam.sdk.Pipeline.applyInternal(Pipeline.java:542)
	at org.apache.beam.sdk.Pipeline.applyTransform(Pipeline.java:493)
	at org.apache.beam.sdk.extensions.sql.impl.rel.BeamSqlRelUtils.toPCollection(BeamSqlRelUtils.java:69)
	at org.apache.beam.sdk.extensions.sql.impl.rel.BeamSqlRelUtils.lambda$buildPCollectionList$0(BeamSqlRelUtils.java:50)
	at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193)
	at java.util.Iterator.forEachRemaining(Iterator.java:116)
	at java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1801)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:499)
	at org.apache.beam.sdk.extensions.sql.impl.rel.BeamSqlRelUtils.buildPCollectionList(BeamSqlRelUtils.java:51)
	at org.apache.beam.sdk.extensions.sql.impl.rel.BeamSqlRelUtils.toPCollection(BeamSqlRelUtils.java:67)
	at org.apache.beam.sdk.extensions.sql.impl.rel.BeamSqlRelUtils.toPCollection(BeamSqlRelUtils.java:39)
	at cloud.dataflow.sql.ExecuteQueryServiceServer$SqlComplianceServiceImpl.executeQuery(ExecuteQueryServiceServer.java:288)
	at com.google.zetasql.testing.SqlComplianceServiceGrpc$MethodHandlers.invoke(SqlComplianceServiceGrpc.java:423)
	at com.google.zetasql.io.grpc.stub.ServerCalls$UnaryServerCallHandler$UnaryServerCallListener.onHalfClose(ServerCalls.java:171)
	at com.google.zetasql.io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.halfClosed(ServerCallImpl.java:283)
	at com.google.zetasql.io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1HalfClosed.runInContext(ServerImpl.java:711)
	at com.google.zetasql.io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)
	at com.google.zetasql.io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:123)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Apr 01, 2020 3:55:13 PM cloud.dataflow.sql.ExecuteQueryServiceServer$SqlComplianceServiceImpl executeQuery
INFO: Processing Sql statement: SELECT R_sub.id as col1, R_sub.a as col2, T_sub.string_val as col3
FROM (SELECT R.id, R.a FROM R) as R_sub
FULL JOIN (SELECT T.string_val FROM T) as T_sub on &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
Apr 01, 2020 3:54:46 PM cloud.dataflow.sql.ExecuteQueryServiceServer$SqlComplianceServiceImpl executeQuery
INFO: Processing Sql statement: SELECT r.*, s.* FROM
(SELECT x, x FROM (SELECT 2 x)) r FULL JOIN (SELECT 3) s ON &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13292061">BEAM-9522</key>
            <summary>BeamJoinRel.extractJoinRexNode RexLiteral cannot be cast to RexCall</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="apilloud">Andrew Pilloud</assignee>
                                    <reporter username="apilloud">Andrew Pilloud</reporter>
                        <labels>
                            <label>zetasql-compliance</label>
                    </labels>
                <created>Mon, 16 Mar 2020 20:41:58 +0000</created>
                <updated>Mon, 18 May 2020 18:08:37 +0000</updated>
                            <resolved>Mon, 18 May 2020 18:08:37 +0000</resolved>
                                                    <fixVersion>2.22.0</fixVersion>
                                    <component>dsl-sql-zetasql</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="17085888" author="kenn" created="Fri, 17 Apr 2020 15:55:20 +0000"  >&lt;p&gt;This one is pretty simple, conceptually, and the issue with the code is obvous: Our code checks if the join condition is &quot;true&quot; and crashes because CROSS JOIN is not supported. It misses the case where the join condition is false. The code that follows assumes that the condition is a conjunction of equalities.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;because we assume a conjunction of equalities, we can use 1=2 or false=true, etc, so that is not so bad&lt;/li&gt;
	&lt;li&gt;but building new RexLiterals requires some more plumbing to get a RexBuilder in the right spot&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The case for a FULL OUTER JOIN with a false condition is not useless - it is similar to forming a tagged union of two collections.&lt;/p&gt;</comment>
                            <comment id="17085920" author="kenn" created="Fri, 17 Apr 2020 16:42:43 +0000"  >&lt;p&gt;Ah, the above doesn&apos;t work because of another assumption that needs to be broken:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;we assume it is a conjunction of equalities between columns of the left/right tables, and do not allow literals or expressions&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So this would be made very easy by addressing &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-6112&quot; title=&quot;SQL could support equijoins on complex expressions, not just column refs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-6112&quot;&gt;BEAM-6112&lt;/a&gt; first&lt;/p&gt;</comment>
                            <comment id="17085923" author="kenn" created="Fri, 17 Apr 2020 16:45:03 +0000"  >&lt;p&gt;Have to step back to do other things. My spike of changes to diagnose this will be made obsolete by the right solution so I won&apos;t hold this ticket.&lt;/p&gt;</comment>
                            <comment id="17106667" author="apilloud" created="Wed, 13 May 2020 21:06:50 +0000"  >&lt;p&gt;My understanding is that expressions are simplified before they reach this code, so `ON 1=2` would be the same as `ON false`. There is a lot of work to get this working, so I&apos;m going to just reject it like we do with CROSS JOIN.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 26 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0cl94:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>