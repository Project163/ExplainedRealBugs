<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:45:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-2669] Kryo serialization exception when DStreams containing non-Kryo-serializable data are cached</title>
                <link>https://issues.apache.org/jira/browse/BEAM-2669</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;Today, when we detect re-use of a dataset in a pipeline in Spark runner we eagerly cache it to avoid calculating the same data multiple times.&lt;br/&gt;
(&lt;a href=&quot;https://github.com/apache/beam/blob/v2.0.0/runners/spark/src/main/java/org/apache/beam/runners/spark/translation/EvaluationContext.java#L148&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;EvaluationContext.java&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;When the dataset is bounded, which in Spark is represented by an &lt;tt&gt;RDD&lt;/tt&gt;, we call &lt;tt&gt;RDD#persist&lt;/tt&gt; and use storage level provided by the user via &lt;tt&gt;SparkPipelineOptions&lt;/tt&gt;. (&lt;a href=&quot;https://github.com/apache/beam/blob/v2.0.0/runners/spark/src/main/java/org/apache/beam/runners/spark/translation/BoundedDataset.java#L103-L103&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;BoundedDataset.java&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;When the dataset is unbounded, which in Spark is represented by a &lt;tt&gt;DStream&lt;/tt&gt; we call &lt;tt&gt;DStream.cache()&lt;/tt&gt; which defaults to persist the &lt;tt&gt;DStream&lt;/tt&gt; using storage level &lt;tt&gt;MEMORY_ONLY_SER&lt;/tt&gt; (&lt;a href=&quot;https://github.com/apache/beam/blob/v2.0.0/runners/spark/src/main/java/org/apache/beam/runners/spark/translation/streaming/UnboundedDataset.java#L61&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;UnboundedDataset.java&lt;/a&gt;)&lt;br/&gt;
 (&lt;a href=&quot;https://github.com/apache/spark/blob/v1.6.3/streaming/src/main/scala/org/apache/spark/streaming/dstream/DStream.scala#L169&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;DStream.scala&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Storage level &lt;tt&gt;MEMORY_ONLY_SER&lt;/tt&gt; means Spark will serialize the data using its configured serializer. Since we configure this to be Kryo in a hard coded fashion, this means the data will be serialized using Kryo. (&lt;a href=&quot;https://github.com/apache/beam/blob/v2.0.0/runners/spark/src/main/java/org/apache/beam/runners/spark/translation/SparkContextFactory.java#L99-L99&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;SparkContextFactory.java&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Due to this, if your &lt;tt&gt;DStream&lt;/tt&gt; contains non-Kryo-serializable data you will encounter Kryo serialization exceptions and your task will fail.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13089433">BEAM-2669</key>
            <summary>Kryo serialization exception when DStreams containing non-Kryo-serializable data are cached</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ksalant">Kobi Salant</assignee>
                                    <reporter username="aviemzur">Aviem Zur</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 Jul 2017 08:27:57 +0000</created>
                <updated>Fri, 24 Jul 2020 20:10:57 +0000</updated>
                            <resolved>Sun, 3 Sep 2017 06:26:57 +0000</resolved>
                                    <version>0.4.0</version>
                    <version>0.5.0</version>
                    <version>0.6.0</version>
                    <version>2.0.0</version>
                                    <fixVersion>2.2.0</fixVersion>
                                    <component>runner-spark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16098070" author="jbonofre" created="Mon, 24 Jul 2017 08:29:04 +0000"  >&lt;p&gt;Thanks for the details !&lt;/p&gt;</comment>
                            <comment id="16098072" author="jbonofre" created="Mon, 24 Jul 2017 08:29:59 +0000"  >&lt;p&gt;I would be in favor of 2, I don&apos;t remember the reason why we apply the user defined storage level to only &lt;tt&gt;RDDs&lt;/tt&gt; and not &lt;tt&gt;DStreams&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16138063" author="githubbot" created="Wed, 23 Aug 2017 08:27:14 +0000"  >&lt;p&gt;GitHub user kobisalant opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/3748&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3748&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-2669&quot; title=&quot;Kryo serialization exception when DStreams containing non-Kryo-serializable data are cached&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-2669&quot;&gt;&lt;del&gt;BEAM-2669&lt;/del&gt;&lt;/a&gt; Kryo serialization exception when DStreams containing non-Kryo-serializable data are cached&lt;/p&gt;

&lt;p&gt;    remove kryo Serializer hard coded settings and add Serializable implementation to window/state/timer classes&lt;/p&gt;

&lt;p&gt;    Follow this checklist to help us incorporate your contribution quickly and easily:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Make sure there is a &lt;span class=&quot;error&quot;&gt;&amp;#91;JIRA issue&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://issues.apache.org/jira/projects/BEAM/issues/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/projects/BEAM/issues/&lt;/a&gt;) filed for the change (usually before you start working on it).  Trivial changes like typos do not require a JIRA issue.  Your pull request should address just this issue, without pulling in other changes.&lt;/li&gt;
	&lt;li&gt;[ ] Each commit in the pull request should have a meaningful subject line and body.&lt;/li&gt;
	&lt;li&gt;[ ] Format the pull request title like `&lt;span class=&quot;error&quot;&gt;&amp;#91;BEAM-XXX&amp;#93;&lt;/span&gt; Fixes bug in ApproximateQuantiles`, where you replace `BEAM-XXX` with the appropriate JIRA issue.&lt;/li&gt;
	&lt;li&gt;[ ] Write a pull request description that is detailed enough to understand what the pull request does, how, and why.&lt;/li&gt;
	&lt;li&gt;[ ] Run `mvn clean verify` to make sure basic checks pass. A more thorough check will be performed on your pull request automatically.&lt;/li&gt;
	&lt;li&gt;[ ] If this contribution is large, please file an Apache &lt;span class=&quot;error&quot;&gt;&amp;#91;Individual Contributor License Agreement&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.apache.org/licenses/icla.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.apache.org/licenses/icla.pdf&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    &amp;#8212;&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/kobisalant/incubator-beam&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/kobisalant/incubator-beam&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-2669&quot; title=&quot;Kryo serialization exception when DStreams containing non-Kryo-serializable data are cached&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-2669&quot;&gt;&lt;del&gt;BEAM-2669&lt;/del&gt;&lt;/a&gt;-Kryo-serialization-exception-when-dstream-cached&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/3748.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3748.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3748&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit f3cbbdf9c43caab3b9c497a49b6aa69f564d1462&lt;br/&gt;
Author: ksalant &amp;lt;kobi.salant@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-23T08:23:11Z&lt;/p&gt;

&lt;p&gt;    remove kryo Serializer hard coded settings and add Serializable implementation to window/state/timer classes&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16138065" author="githubbot" created="Wed, 23 Aug 2017 08:30:08 +0000"  >&lt;p&gt;Github user kobisalant closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/3748&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3748&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16145266" author="ksalant" created="Tue, 29 Aug 2017 13:19:24 +0000"  >&lt;p&gt;PR  &lt;a href=&quot;https://github.com/apache/beam/pull/3749&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3749&lt;/a&gt; contains the latest changes for the kryo exception. &lt;/p&gt;

&lt;p&gt;The first step was to remove kryo Serializer hard coded settings but that opened another issue, all our RDDs/DStreams are of type WindowdValue which is not java serializable. A discussion o the dev list raised valid concerns of not using the coders and breaking our agreement with the user.&lt;/p&gt;

&lt;p&gt;So, we moved to a different direction when caching/persisting map to bytes with coders so we will not need to serialize beam and user classes. Due to this change it is impossible now to check the cached rdd which is now not the PCollection&apos;s rdd and we removed the storage level test.&lt;/p&gt;</comment>
                            <comment id="16151692" author="githubbot" created="Sun, 3 Sep 2017 06:06:44 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/3749&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3749&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13098545">BEAM-2825</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 11 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3hwy7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>