<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:48:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-3186] In-flight data loss when restoring from savepoint</title>
                <link>https://issues.apache.org/jira/browse/BEAM-3186</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;&lt;b&gt;The context:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;I want to count how many events of given type(A,B, etc) I receive every minute using 1 minute windows and AfterWatermark trigger with allowed lateness 1 min.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Data loss case&lt;/b&gt;&lt;br/&gt;
In the case below if there is at least one A element with the event time belonging to the window 14:00-14:01 read from Kinesis stream after job is restored from savepoint the data loss will not be observed for this key and this window.&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12897545/12897545_restore_no_trigger.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Not data loss case&lt;/b&gt;&lt;br/&gt;
However, if no new A element element is read from Kinesis stream than data loss is observable.&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12897544/12897544_restore_with_trigger.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;



&lt;p&gt;&lt;b&gt;Workaround&lt;/b&gt;&lt;br/&gt;
As a workaround we could configure early firings every X seconds which gives up to X seconds data loss per key on restore.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;My guess where the issue might be&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;I believe this is Beam-Flink integration layer bug. From my investigation I don&apos;t think it&apos;s KinesisReader and possibility that it couldn&apos;t advance watermark. To prove that after I restore from savepoint I sent some records for different key (B) for the same window as shown in the pictures(14:00-14:01) without seeing trigger going off for restored window and key A.&lt;/p&gt;

&lt;p&gt;My guess is that Beam after job is restored doesn&apos;t register flink event time timer for restored window unless there is a new element (key) coming for the restored window.&lt;/p&gt;

&lt;p&gt;Please refer to &lt;a href=&quot;https://gist.github.com/pbartoszek/7ab88c8b6538039db1b383358d1d1b5a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this gist&lt;/a&gt; for test job that shows this behaviour.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13118215">BEAM-3186</key>
            <summary>In-flight data loss when restoring from savepoint</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10100" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">P0</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dwysakowicz">Dawid Wysakowicz</assignee>
                                    <reporter username="pawelbartoszek">Pawel Bartoszek</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Nov 2017 11:12:33 +0000</created>
                <updated>Fri, 24 Jul 2020 20:18:41 +0000</updated>
                            <resolved>Mon, 5 Feb 2018 11:04:28 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>2.1.0</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>runner-flink</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16262874" author="pawelbartoszek" created="Wed, 22 Nov 2017 16:24:02 +0000"  >&lt;p&gt;As &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt; suggested I performed another test depicted below:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12898885/12898885_restore_with_trigger_b.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;After restore I have got 2 B events but A events are lost&lt;/p&gt;</comment>
                            <comment id="16352248" author="aljoscha" created="Mon, 5 Feb 2018 11:02:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbonofre&quot; class=&quot;user-hover&quot; rel=&quot;jbonofre&quot;&gt;jbonofre&lt;/a&gt; This was fixed on master in these commits:&lt;br/&gt;
01d74b3b8381c04ffba3879281897ea2ef6fbcc5&lt;br/&gt;
6808b8855f90f69098bd37d2353da7d3ca329eb3&lt;/p&gt;

&lt;p&gt;Should I cherry-pick them onto the 2.3.0 release branch or do you want to do that?&lt;/p&gt;</comment>
                            <comment id="16352322" author="jbonofre" created="Mon, 5 Feb 2018 12:34:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt; thanks, I cherry-pick on release-2.3.0 branch.&lt;/p&gt;</comment>
                            <comment id="16352336" author="jbonofre" created="Mon, 5 Feb 2018 12:56:01 +0000"  >&lt;p&gt;Cherry-pick done on the release-2.3.0 branch. Thanks !&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12897545" name="restore_no_trigger.png" size="9860" author="pawelbartoszek" created="Tue, 14 Nov 2017 11:53:31 +0000"/>
                            <attachment id="12897544" name="restore_with_trigger.png" size="9894" author="pawelbartoszek" created="Tue, 14 Nov 2017 11:53:31 +0000"/>
                            <attachment id="12898885" name="restore_with_trigger_b.png" size="10085" author="pawelbartoszek" created="Wed, 22 Nov 2017 16:21:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 41 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3mr67:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>