<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:06:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-9288] Conscrypt shaded dependency</title>
                <link>https://issues.apache.org/jira/browse/BEAM-9288</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;Conscrypt is not designed to be shaded properly mainly because of so files. I happened to see&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-9030&quot; title=&quot;Bump grpc to 1.26.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-9030&quot;&gt;&lt;del&gt;BEAM-9030&lt;/del&gt;&lt;/a&gt; (*1) creating a new vendored gRPC shading Conscrypt (*2) in it. I think this could make a problem when new Conscrypt is brought by new gcsio depending on gRPC-alts (*4) in a dependency chain. (*5) In this case, it may have a conflict when finding proper so files for Conscrypt.&#160;&lt;/p&gt;

&lt;p&gt;*1:&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-9030&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/BEAM-9030&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;*2:&#160; &lt;a href=&quot;https://github.com/apache/beam/blob/e24d1e51cbabe27cb3cc381fd95b334db639c45d/buildSrc/src/main/groovy/org/apache/beam/gradle/GrpcVendoring_1_26_0.groovy#L78&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/e24d1e51cbabe27cb3cc381fd95b334db639c45d/buildSrc/src/main/groovy/org/apache/beam/gradle/GrpcVendoring_1_26_0.groovy#L78&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;*3:&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-6136&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/BEAM-6136&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;*4:&#160;&lt;a href=&quot;https://mvnrepository.com/artifact/io.grpc/grpc-alts/1.27.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://mvnrepository.com/artifact/io.grpc/grpc-alts/1.27.0&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;*5:&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-8889&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/BEAM-8889&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13284427">BEAM-9288</key>
            <summary>Conscrypt shaded dependency</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10101" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">P1</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sunjincheng121">sunjincheng</assignee>
                                    <reporter username="veblush">Esun Kim</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Feb 2020 22:28:06 +0000</created>
                <updated>Sat, 16 May 2020 13:29:00 +0000</updated>
                            <resolved>Mon, 9 Mar 2020 18:21:42 +0000</resolved>
                                                    <fixVersion>2.20.0</fixVersion>
                                    <component>build-system</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="24600">6h 50m</timespent>
                                <comments>
                            <comment id="17034007" author="chamikara" created="Mon, 10 Feb 2020 23:12:23 +0000"  >&lt;p&gt;cc:&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lcwik&quot; class=&quot;user-hover&quot; rel=&quot;lcwik&quot;&gt;lcwik&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=medb&quot; class=&quot;user-hover&quot; rel=&quot;medb&quot;&gt;medb&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17034008" author="chamikara" created="Mon, 10 Feb 2020 23:16:50 +0000"  >&lt;p&gt;Is there a way we can upgrade gRPC without shading Conscrypt ?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Jincheng, can you look into this ?&lt;/p&gt;</comment>
                            <comment id="17034010" author="lcwik" created="Mon, 10 Feb 2020 23:21:17 +0000"  >&lt;p&gt;cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sunjincheng121&quot; class=&quot;user-hover&quot; rel=&quot;sunjincheng121&quot;&gt;sunjincheng121&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Conscrypt can be shaded properly by building a special version of the so file with a&#160;JNI_JARJAR_PREFIX defined. It would be best if conscrypt was updated to support auto-detection of post relocation path instead of needing everyone to build their own version.&lt;/p&gt;</comment>
                            <comment id="17034017" author="lcwik" created="Mon, 10 Feb 2020 23:27:00 +0000"  >&lt;p&gt;The idea would be to use a solution similar to tcnative where the library path can be &quot;parsed&quot; to provide the appropriate package prefix:&#160;&lt;a href=&quot;https://github.com/netty/netty-tcnative/blob/9fd38de8a07cc413b83cacf39470f2845a68e26c/openssl-dynamic/src/main/c/jnilib.c#L233&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/netty/netty-tcnative/blob/9fd38de8a07cc413b83cacf39470f2845a68e26c/openssl-dynamic/src/main/c/jnilib.c#L233&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17034021" author="lcwik" created="Mon, 10 Feb 2020 23:32:14 +0000"  >&lt;p&gt;I filed&#160;&lt;a href=&quot;https://github.com/google/conscrypt/issues/811&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/google/conscrypt/issues/811&lt;/a&gt;&#160;for &quot;auto&quot; discovery of package path.&lt;/p&gt;</comment>
                            <comment id="17034066" author="medb" created="Tue, 11 Feb 2020 01:28:27 +0000"  >&lt;p&gt;Will it be better to exclude Concrypt from shaded GCS IO jar and rely on Conscrypt installed&#160;system-wide, if any?&lt;/p&gt;</comment>
                            <comment id="17034076" author="lcwik" created="Tue, 11 Feb 2020 01:58:52 +0000"  >&lt;p&gt;If gcs io is shading conscrypt, then it should fix it&apos;s shading. It shouldn&apos;t rely on a provided conscrypt unless gcs io marks the dependency as provided.&lt;/p&gt;

&lt;p&gt;Apache beam should fix it&apos;s own usage to not interfere with others usage of it and not have users depend on it.&lt;/p&gt;</comment>
                            <comment id="17034131" author="veblush" created="Tue, 11 Feb 2020 04:41:36 +0000"  >&lt;p&gt;Gcsio starts depending on gRPC along with conscrypt and we&apos;re considering if it&apos;s feasible to shade it in gcsio. Since Conscrypt is not ready for being shaded, however, shading isn&apos;t considered as an option for now. I think it shouldn&apos;t shade it until Conscrypt becomes fully aware of shading.&#160;&lt;/p&gt;</comment>
                            <comment id="17041366" author="kenn" created="Thu, 20 Feb 2020 23:42:41 +0000"  >&lt;p&gt;In the near term, I think we can exclude it from vendor/grpc. Then vendor/grpc will have a transitive dependency that users can be aware of, instead of relocated and bundled. It still can have diamond dependency problems, but at least they are exposed and &quot;normal&quot;.&lt;/p&gt;</comment>
                            <comment id="17042601" author="sunjincheng121" created="Sat, 22 Feb 2020 15:14:24 +0000"  >&lt;p&gt;I agree that we should exclude it from the vendored grpc for now. I will submit a PR to address this issue.&lt;/p&gt;</comment>
                            <comment id="17043967" author="amaliujia" created="Mon, 24 Feb 2020 23:52:50 +0000"  >&lt;p&gt;I am going to cut 2.20.0 branch on 02/26/2020. Can this Jira be finished by that date?&lt;/p&gt;</comment>
                            <comment id="17046992" author="iemejia" created="Thu, 27 Feb 2020 21:37:36 +0000"  >&lt;p&gt;Is this a real issue or just a nice to have, because if it is the former this implies a new release of the vendored grpc dependency with the respective 3 day vote, delaying as a consequence the 2.20.0 vote/release. Is this really important or can we just wait and do it for 2.21.0 ?&lt;/p&gt;</comment>
                            <comment id="17047060" author="kenn" created="Thu, 27 Feb 2020 23:48:57 +0000"  >&lt;p&gt;I think leaving it as a residual dependency is necessary. Jincheng has the PR ready for that. After that, solving actual shading of conscrypt is more determined by whether we hit diamond dep issues, like with any Java library.&lt;/p&gt;</comment>
                            <comment id="17047061" author="kenn" created="Thu, 27 Feb 2020 23:50:11 +0000"  >&lt;p&gt;But since you filed &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-9252&quot; title=&quot;Problem shading Beam pipeline with Beam 2.20.0-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-9252&quot;&gt;&lt;del&gt;BEAM-9252&lt;/del&gt;&lt;/a&gt; (resolved) but this is not resolved even though it says it is blocking &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-9252&quot; title=&quot;Problem shading Beam pipeline with Beam 2.20.0-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-9252&quot;&gt;&lt;del&gt;BEAM-9252&lt;/del&gt;&lt;/a&gt; perhaps they are being confused.&lt;/p&gt;</comment>
                            <comment id="17047343" author="iemejia" created="Fri, 28 Feb 2020 09:08:37 +0000"  >&lt;p&gt;Oh I see that&apos;s clearly a mistake I will unlink the issues because they are not related. &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-9252&quot; title=&quot;Problem shading Beam pipeline with Beam 2.20.0-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-9252&quot;&gt;&lt;del&gt;BEAM-9252&lt;/del&gt;&lt;/a&gt; was all about users being unable to shade the Jar and this is solved. This issue is different.&lt;/p&gt;

&lt;p&gt;Conscrypt seems like a transitive dependency that gRPC uses, but that Beam&apos;s use of gRPC may not use. If that&apos;s the case we can go with it even if it is badly shaded, but well I understand if you guys prefer to do it properly, I just wanted to avoid delaying the release if we can go with it as it is.&lt;/p&gt;</comment>
                            <comment id="17047817" author="kenn" created="Fri, 28 Feb 2020 17:25:54 +0000"  >&lt;p&gt;If it is not a regression then I would not block the release. I think though that the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-9030&quot; title=&quot;Bump grpc to 1.26.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-9030&quot;&gt;&lt;del&gt;BEAM-9030&lt;/del&gt;&lt;/a&gt; &lt;em&gt;is&lt;/em&gt; a regression so it is a blocker. Jincheng already has a fix up so maybe the timing for everything will be OK?&lt;/p&gt;</comment>
                            <comment id="17047818" author="kenn" created="Fri, 28 Feb 2020 17:26:25 +0000"  >&lt;p&gt;Oh, and yea Beam definitely needs this. Performance without it is very bad.&lt;/p&gt;</comment>
                            <comment id="17049537" author="amaliujia" created="Mon, 2 Mar 2020 18:30:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sunjincheng121&quot; class=&quot;user-hover&quot; rel=&quot;sunjincheng121&quot;&gt;sunjincheng121&lt;/a&gt; will this Jira be considered finished?&lt;/p&gt;</comment>
                            <comment id="17049540" author="lukecwik@gmail.com" created="Mon, 2 Mar 2020 18:34:00 +0000"  >&lt;p&gt;A release needs to happen and the version used in Apache beam needs to be&lt;br/&gt;
updated to match.&lt;/p&gt;

</comment>
                            <comment id="17049607" author="amaliujia" created="Mon, 2 Mar 2020 20:07:09 +0000"  >&lt;p&gt;I will cherry-pick #10940 and make 2.20.0 released. After that you could update the version in Beam.&lt;/p&gt;


&lt;p&gt;Does it sounds good?&lt;/p&gt;</comment>
                            <comment id="17050052" author="iemejia" created="Tue, 3 Mar 2020 09:20:37 +0000"  >&lt;p&gt;As mentioned by Luke If we cherry-pick #10940 we still need a proper vote/release from the vendored dependency, so better start with this. Can you start to roll the ball for the vendored grpc release &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sunjincheng121&quot; class=&quot;user-hover&quot; rel=&quot;sunjincheng121&quot;&gt;sunjincheng121&lt;/a&gt;&#160; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lukecwik%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;lukecwik@gmail.com&quot;&gt;lukecwik@gmail.com&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="17050468" author="lcwik" created="Tue, 3 Mar 2020 18:35:07 +0000"  >&lt;p&gt;RC #1 vote thread:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://lists.apache.org/thread.html/r9398fd720cc2372dab5ca2598453c9163fedf05dd23eacdef4538ef4%40%3Cdev.beam.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread.html/r9398fd720cc2372dab5ca2598453c9163fedf05dd23eacdef4538ef4%40%3Cdev.beam.apache.org%3E&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17050643" author="lcwik" created="Tue, 3 Mar 2020 23:44:34 +0000"  >&lt;p&gt;It seems we still are adding the conscrypt native libraries as part in META-INF&lt;/p&gt;

&lt;p&gt;$ jar tvf beam-vendor-grpc-1_26_0-0.3.jar | grep conscrypt&lt;br/&gt;
2218176 Mon Sep 17 10:36:24 CEST 2018&lt;br/&gt;
META-INF/native/libconscrypt_openjdk_jni-linux-x86_64.so&lt;br/&gt;
1720832 Mon Sep 17 10:36:24 CEST 2018&lt;br/&gt;
META-INF/native/conscrypt_openjdk_jni-windows-x86.dll&lt;br/&gt;
2637496 Mon Sep 17 10:36:24 CEST 2018&lt;br/&gt;
META-INF/native/libconscrypt_openjdk_jni-osx-x86_64.dylib&lt;br/&gt;
2557952 Mon Sep 17 10:36:24 CEST 2018&lt;br/&gt;
META-INF/native/conscrypt_openjdk_jni-windows-x86_64.dll&lt;/p&gt;</comment>
                            <comment id="17051602" author="amaliujia" created="Wed, 4 Mar 2020 20:35:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lcwik&quot; class=&quot;user-hover&quot; rel=&quot;lcwik&quot;&gt;lcwik&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;My understanding to the follow up of this Jira is:&lt;br/&gt;
1. &quot;stop adding the conscrypt native libraries as part in META-INF&quot;&lt;br/&gt;
2. re-vote vendored grpc release, and release it if it passes votes. &lt;/p&gt;


&lt;p&gt;Is the above all needed be done to close this Jira?&lt;/p&gt;</comment>
                            <comment id="17051619" author="amaliujia" created="Wed, 4 Mar 2020 20:50:38 +0000"  >&lt;p&gt;A followup question is, &lt;/p&gt;

&lt;p&gt;is &quot;still are adding the conscrypt native libraries as part in META-INF&quot; related to &lt;a href=&quot;https://github.com/apache/beam/pull/10940?&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/10940?&lt;/a&gt; E.g. is META-INF is a separate issue or is it supposed to be fixed by #10940 but that PR didn&apos;t achieve this goal?&lt;/p&gt;</comment>
                            <comment id="17051631" author="lcwik" created="Wed, 4 Mar 2020 21:03:04 +0000"  >&lt;p&gt;Yes to your steps:&lt;/p&gt;

&lt;p&gt;My understanding to the follow up of this Jira is:&lt;br/&gt;
1. &quot;stop adding the conscrypt native libraries as part in META-INF&quot;&lt;br/&gt;
2. re-vote vendored grpc release, and release it if it passes votes.&lt;/p&gt;

&lt;p&gt;Is the above all needed be done to close this Jira?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Yes to the fact that pr/10940 did not address all the goals.&lt;/p&gt;</comment>
                            <comment id="17052431" author="lcwik" created="Thu, 5 Mar 2020 18:56:57 +0000"  >&lt;p&gt;Release vote thread for RC #3:&#160;&lt;a href=&quot;https://lists.apache.org/thread.html/rea4a27c47529a27936ab2c51162c8e532b8b625c4d70c4f7f485c7cd%40%3Cdev.beam.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread.html/rea4a27c47529a27936ab2c51162c8e532b8b625c4d70c4f7f485c7cd%40%3Cdev.beam.apache.org%3E&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 36 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0bcgw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>