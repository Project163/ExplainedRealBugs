<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:41:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-854] ReifyTimestampAndWindows explodes windows</title>
                <link>https://issues.apache.org/jira/browse/BEAM-854</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;Commit &lt;a href=&quot;https://github.com/apache/incubator-beam/commit/b2350417f73ae6c34f849ff0e93d5bd93df3088d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-beam/commit/b2350417f73ae6c34f849ff0e93d5bd93df3088d&lt;/a&gt; changed the fn from accessing the collection of windows to accessing the windows one-by-one, which causes this DoFn to explode them, which (I suppose) hurts performance, since this Fn is quite important: it&apos;s a part of GroupByKey in the Spark runner and Direct runner, part of Splittable DoFn, part of GBKViaGBKO, and part of GatherAllPanes.&lt;/p&gt;

&lt;p&gt;I can see a couple of ways to fix this:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Make this be a primitive transform, with runner-specific support to keep the windows compressed&lt;/li&gt;
	&lt;li&gt;Allow any DoFn to access the compressed representation explicitly using a Collection&amp;lt;BoundedWindow&amp;gt; parameter&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;m personally in favor of the latter because it automatically benefits all runners.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13015998">BEAM-854</key>
            <summary>ReifyTimestampAndWindows explodes windows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kenn">Kenneth Knowles</assignee>
                                    <reporter username="jkff">Eugene Kirpichov</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Oct 2016 22:47:45 +0000</created>
                <updated>Sat, 16 May 2020 13:57:40 +0000</updated>
                            <resolved>Thu, 29 Dec 2016 01:29:37 +0000</resolved>
                                                    <fixVersion>0.4.0</fixVersion>
                                    <component>runner-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15613571" author="kenn" created="Thu, 27 Oct 2016 23:03:25 +0000"  >&lt;p&gt;Ah, my mistake. You are correct. This needlessly harms performance for the first &lt;tt&gt;GBK&lt;/tt&gt; after &lt;tt&gt;Window.into(SlidingWindows)&lt;/tt&gt; (and similar).&lt;/p&gt;

&lt;p&gt;The former is the better approach.  A semantic element exists within a single window. The compressed representation is an implementation detail. We don&apos;t need a new primitive; it can be folded into the semantics of GBKO.&lt;/p&gt;

&lt;p&gt;The latter violates/alters the Beam model with broad consequences - pathological computations based on the set of windows, runner being unable to transparently explode/not explode as it pleases, elements in zero windows. And I conjecture that any DoFn that respects the model is as efficiently executed when looping over the windows is lifted outside &lt;tt&gt;@ProcessElement&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;We should talk about how and why this impacts SDF.&lt;/p&gt;</comment>
                            <comment id="15614351" author="githubbot" created="Fri, 28 Oct 2016 05:24:15 +0000"  >&lt;p&gt;GitHub user kennknowles opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/1216&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-beam/pull/1216&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-854&quot; title=&quot;ReifyTimestampAndWindows explodes windows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-854&quot;&gt;&lt;del&gt;BEAM-854&lt;/del&gt;&lt;/a&gt; Directly implement ReifyTimestampsAndWindows in SparkRunner&lt;/p&gt;

&lt;p&gt;    Be sure to do all of the following to help us incorporate your contribution&lt;br/&gt;
    quickly and easily:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;x&amp;#93;&lt;/span&gt; Make sure the PR title is formatted like:&lt;br/&gt;
       `&lt;a href=&quot;#&amp;gt;&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;BEAM-&amp;lt;Jira issue #&amp;gt;&lt;/a&gt; Description of pull request`&lt;/li&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;x&amp;#93;&lt;/span&gt; Make sure tests pass via `mvn clean verify`. (Even better, enable&lt;br/&gt;
           Travis-CI on your fork and ensure the whole test matrix passes).&lt;/li&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;x&amp;#93;&lt;/span&gt; Replace `&amp;lt;Jira issue #&amp;gt;` in the title with the actual Jira issue&lt;br/&gt;
           number, if there is one.&lt;/li&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;x&amp;#93;&lt;/span&gt; If this contribution is large, please file an Apache&lt;br/&gt;
           &lt;span class=&quot;error&quot;&gt;&amp;#91;Individual Contributor License Agreement&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.apache.org/licenses/icla.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.apache.org/licenses/icla.txt&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    &amp;#8212;&lt;/p&gt;

&lt;p&gt;    R: @amitsela &lt;/p&gt;

&lt;p&gt;    I introduced a performance issue in &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-854&quot; title=&quot;ReifyTimestampAndWindows explodes windows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-854&quot;&gt;&lt;del&gt;BEAM-854&lt;/del&gt;&lt;/a&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-854&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/BEAM-854&lt;/a&gt;) that affects the SparkRunner and DirectRunner. As per discussion there, `ReifyTimestampsAndWindows` can only use the multi-window `WindowedValue` representation if it is implemented as a primitive. The fix is pretty trivial, and actually just simpler anyhow. I ran `mvn integration-test -Plocal-runnable-on-service-tests -pl runners/spark` but feel free to pull this down and do it right if I have missed something, inline the class, etc, whatever you like.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/kennknowles/incubator-beam&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/kennknowles/incubator-beam&lt;/a&gt; Spark-Reify&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/1216.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-beam/pull/1216.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1216&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 72b634857bc660716a1ce5e8fa03b39138472652&lt;br/&gt;
Author: Kenneth Knowles &amp;lt;klk@google.com&amp;gt;&lt;br/&gt;
Date:   2016-10-28T05:18:19Z&lt;/p&gt;

&lt;p&gt;    Directly implement ReifyTimestampsAndWindows in SparkRunner&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15614724" author="githubbot" created="Fri, 28 Oct 2016 08:18:31 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/1216&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-beam/pull/1216&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15616766" author="githubbot" created="Fri, 28 Oct 2016 22:19:16 +0000"  >&lt;p&gt;GitHub user jkff opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/1225&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-beam/pull/1225&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-854&quot; title=&quot;ReifyTimestampAndWindows explodes windows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-854&quot;&gt;&lt;del&gt;BEAM-854&lt;/del&gt;&lt;/a&gt; Removes ReifyTimestampsAndWindows&lt;/p&gt;

&lt;p&gt;    It was used effectively in 2 places:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;GatherAllPanes (used in PAssert): replaced with a similar custom DoFn.&lt;/li&gt;
	&lt;li&gt;A couple of GBK-related transforms: folded into GroupByKeyOnly.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Additionally, makes DirectGroupByKeyOnly produce globally-windowed KeyedWorkItem&apos;s - we already knew this was the right thing to do in general.&lt;/p&gt;

&lt;p&gt;    R: @tgroh &lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/jkff/incubator-beam&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jkff/incubator-beam&lt;/a&gt; rm-reify&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/1225.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-beam/pull/1225.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1225&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 5382fd9b14efca03e8be1d36432bbbfb14b1a9fc&lt;br/&gt;
Author: Eugene Kirpichov &amp;lt;kirpichov@google.com&amp;gt;&lt;br/&gt;
Date:   2016-10-28T17:40:17Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-854&quot; title=&quot;ReifyTimestampAndWindows explodes windows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-854&quot;&gt;&lt;del&gt;BEAM-854&lt;/del&gt;&lt;/a&gt; Removes ReifyTimestampsAndWindows&lt;/p&gt;

&lt;p&gt;    It was used effectively in 2 places:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;GatherAllPanes (used in PAssert):&lt;br/&gt;
      replaced with a similar custom DoFn.&lt;/li&gt;
	&lt;li&gt;A couple of GBK-related transforms:&lt;br/&gt;
      folded into GroupByKeyOnly.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;commit db6dabf44a12168941a34d202adf151b8191825a&lt;br/&gt;
Author: Eugene Kirpichov &amp;lt;kirpichov@google.com&amp;gt;&lt;br/&gt;
Date:   2016-10-28T22:16:01Z&lt;/p&gt;

&lt;p&gt;    Also makes GBKO produce globally-windowed KWIs&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15629814" author="githubbot" created="Wed, 2 Nov 2016 17:51:22 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-beam/pull/1225&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-beam/pull/1225&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15629961" author="jkff" created="Wed, 2 Nov 2016 18:28:11 +0000"  >&lt;p&gt;ReifyTimestampsAndWindows no longer exists.&lt;/p&gt;</comment>
                            <comment id="15784194" author="davor" created="Thu, 29 Dec 2016 01:29:25 +0000"  >&lt;p&gt;(reopening temporarily to add the components tag to the issue)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 46 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35iof:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>