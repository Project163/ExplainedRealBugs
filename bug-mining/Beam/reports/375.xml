<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:45:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-2658] SerializableCoder has higher precedence over ProtoCoder in CoderRegistry#getCoder</title>
                <link>https://issues.apache.org/jira/browse/BEAM-2658</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.google.protobuf.Timestamp;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.beam.sdk.Pipeline;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.beam.sdk.coders.CannotProvideCoderException;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.beam.sdk.coders.Coder;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.beam.sdk.options.PipelineOptions;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.beam.sdk.options.PipelineOptionsFactory;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;CoderTest {
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; CannotProvideCoderException {
    PipelineOptions options = PipelineOptionsFactory.fromArgs(args).create();
    Pipeline pipeline = Pipeline.create(options);

    Coder&amp;lt;Timestamp&amp;gt; coder = pipeline.getCoderRegistry().getCoder(Timestamp.class);

    &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.beam.sdk.coders.SerializableCoder
&lt;/span&gt;    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(coder.getClass());
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Right now we&apos;re sorting &lt;tt&gt;CoderProviderRegistrar}}s by canonical name but {{SerializableCoderProvider&lt;/tt&gt; should be added last as a fallback if there&apos;re other {{CoderProvider}}s that support the same type.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Set&amp;lt;CoderProviderRegistrar&amp;gt; registrars = Sets.newTreeSet(ObjectsClassComparator.INSTANCE);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13089219">BEAM-2658</key>
            <summary>SerializableCoder has higher precedence over ProtoCoder in CoderRegistry#getCoder</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10103" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">P3</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sinisa_lyh">Neville Li</assignee>
                                    <reporter username="sinisa_lyh">Neville Li</reporter>
                        <labels>
                            <label>Done</label>
                    </labels>
                <created>Sat, 22 Jul 2017 06:57:12 +0000</created>
                <updated>Tue, 6 Oct 2020 21:51:54 +0000</updated>
                            <resolved>Wed, 26 Jul 2017 14:55:05 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.2.0</fixVersion>
                                    <component>sdk-java-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16097149" author="githubbot" created="Sat, 22 Jul 2017 07:21:30 +0000"  >&lt;p&gt;GitHub user nevillelyh opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/3617&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3617&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-2658&quot; title=&quot;SerializableCoder has higher precedence over ProtoCoder in CoderRegistry#getCoder&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-2658&quot;&gt;&lt;del&gt;BEAM-2658&lt;/del&gt;&lt;/a&gt; register SerializableCoder last&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/nevillelyh/beam&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/nevillelyh/beam&lt;/a&gt; neville/&lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-2658&quot; title=&quot;SerializableCoder has higher precedence over ProtoCoder in CoderRegistry#getCoder&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-2658&quot;&gt;&lt;del&gt;BEAM-2658&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/3617.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3617.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3617&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 3e92083312b7d56a7b436e927d2389dc5d50ace4&lt;br/&gt;
Author: Neville Li &amp;lt;neville@spotify.com&amp;gt;&lt;br/&gt;
Date:   2017-07-22T07:14:03Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-2658&quot; title=&quot;SerializableCoder has higher precedence over ProtoCoder in CoderRegistry#getCoder&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-2658&quot;&gt;&lt;del&gt;BEAM-2658&lt;/del&gt;&lt;/a&gt; register SerializableCoder last&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16097685" author="lcwik" created="Sun, 23 Jul 2017 15:22:12 +0000"  >&lt;p&gt;I think this issue will come up more often then this single case. Is there a more general way to solve this issue which doesn&apos;t require CoderRegistry to resolve conflicts by having them manually specified?&lt;/p&gt;</comment>
                            <comment id="16097693" author="sinisa_lyh" created="Sun, 23 Jul 2017 15:49:42 +0000"  >&lt;p&gt;Types covered by each &lt;tt&gt;CoderProvider&lt;/tt&gt; may overlap and we might want sort them based on scope and not name.&lt;/p&gt;

&lt;p&gt;2 ideas:&lt;br/&gt;
1. Add a `List&amp;lt;TypeDescriptor&amp;gt; getSupportedTypes()` and make sure that when 2 providers overlap, the one with the narrower supported types gets precedence. Won&apos;t work with `DefaultCoder` though. Also a class can implement multiple interfaces and it doesn&apos;t specify which one has higher precedence. For example `ProtoCoder` supports `Message.class` while `SerializableCoder` supports `Serializable.class` but generated Protobuf classes also implements `Serializable`.&lt;br/&gt;
2. Assign an arbitrary int precedent to each coder, similar to UNIX rc/motd files, and store registered coders in a `TreeMap&amp;lt;Integer, List&amp;lt;CoderProvider&amp;gt;&amp;gt;`. Not elegant but works.&lt;/p&gt;</comment>
                            <comment id="16097699" author="sinisa_lyh" created="Sun, 23 Jul 2017 16:27:55 +0000"  >&lt;p&gt;However I&apos;d still argue that &lt;tt&gt;DefaultCoder&lt;/tt&gt; and &lt;tt&gt;SerializableCoder&lt;/tt&gt; are 2 special cases. &lt;tt&gt;DefaultCoder&lt;/tt&gt; should have the highest precedence and overrides typed based lookup while &lt;tt&gt;SerializableCoder&lt;/tt&gt; should have the lowest as a fallback. Other coders in between don&apos;t really overlap.&lt;/p&gt;</comment>
                            <comment id="16098322" author="lcwik" created="Mon, 24 Jul 2017 12:57:17 +0000"  >&lt;p&gt;Arbitrary number based precedence orders are difficult to maintain. I agree with you that we should special case &lt;b&gt;DefaultCoder&lt;/b&gt; and &lt;b&gt;SerializableCoder&lt;/b&gt; for now and once we get the third or fourth special case, that may give us constraints on how we should structure coder provider ordering.&lt;/p&gt;</comment>
                            <comment id="16101760" author="githubbot" created="Wed, 26 Jul 2017 14:54:38 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/3617&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3617&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 16 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3hvmv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>