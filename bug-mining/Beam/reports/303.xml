<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:44:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-1283] DoFn finishBundle should be required to specify the window for output</title>
                <link>https://issues.apache.org/jira/browse/BEAM-1283</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;The spec is here in Javadoc: &lt;a href=&quot;https://github.com/apache/beam/blob/master/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/DoFn.java#L128&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/master/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/DoFn.java#L128&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&quot;If invoked from &lt;tt&gt;@StartBundle&lt;/tt&gt; or &lt;tt&gt;@FinishBundle&lt;/tt&gt;, this will attempt to use the &lt;tt&gt;WindowFn&lt;/tt&gt; of the input &lt;tt&gt;PCollection&lt;/tt&gt; to determine what windows the element should be in, throwing an exception if the &lt;tt&gt;WindowFn&lt;/tt&gt; attempts to access any information about the input element. The output element will have a timestamp of negative infinity.&quot;&lt;/p&gt;

&lt;p&gt;This is a collection of caveats that make this method not always technically wrong, but quite a mess. Ideas that reasonable folks have suggested lately:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The &lt;tt&gt;WindowFn&lt;/tt&gt; cannot actually be applied because &lt;tt&gt;WindowFn&lt;/tt&gt; is allowed to see the element type. The spec just avoids this by limiting which &lt;tt&gt;WindowFn&lt;/tt&gt; can be used.&lt;/li&gt;
	&lt;li&gt;There is no natural output timestamp, so it should always be provided. The spec avoids this by specifying an arbitrary and fairly useless timestamp.&lt;/li&gt;
	&lt;li&gt;If it is a merging &lt;tt&gt;WindowFn&lt;/tt&gt; like sessions that has already been merged then you&apos;ll just have a bogus proto window regardless of explicit timestamp or not.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The use cases for these methods are best addressed by state plus window expiry callback, so we should revisit this spec and probably just wipe it.&lt;/p&gt;

&lt;p&gt;There are some rare case where you might need to output from &lt;tt&gt;FinishBundle&lt;/tt&gt; in a way that is not &lt;em&gt;actually&lt;/em&gt; sensitive to bundling (perhaps modulo some downstream notion of equivalence) in which case you had better know what window you are outputting to. Often it should be the global window.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13036339">BEAM-1283</key>
            <summary>DoFn finishBundle should be required to specify the window for output</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sb2nov">Sourabh Bajaj</assignee>
                                    <reporter username="kenn">Kenneth Knowles</reporter>
                        <labels>
                            <label>Done</label>
                            <label>backward-incompatible</label>
                    </labels>
                <created>Thu, 19 Jan 2017 21:01:49 +0000</created>
                <updated>Tue, 6 Oct 2020 21:54:02 +0000</updated>
                            <resolved>Tue, 9 May 2017 20:22:42 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                                    <component>beam-model</component>
                    <component>sdk-java-core</component>
                    <component>sdk-py-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="15955920" author="altay" created="Tue, 4 Apr 2017 21:47:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kenn&quot; class=&quot;user-hover&quot; rel=&quot;kenn&quot;&gt;kenn&lt;/a&gt; What are the implications of this in python?&lt;/p&gt;</comment>
                            <comment id="15957361" author="kenn" created="Wed, 5 Apr 2017 18:16:16 +0000"  >&lt;p&gt;I believe this is largely a language-independent concern. I&apos;m not sure how this plays out via the Fn API.&lt;/p&gt;</comment>
                            <comment id="15957382" author="lcwik" created="Wed, 5 Apr 2017 18:23:49 +0000"  >&lt;p&gt;I don&apos;t think the Fn API really is interested in whether an SDK exposes the concept of finishBundle and whether it is allowed to perform output.&lt;/p&gt;

&lt;p&gt;The issue is being able to implement something like PGBK without support for finishBundle within an SDK.&lt;/p&gt;</comment>
                            <comment id="15973567" author="altay" created="Tue, 18 Apr 2017 21:41:07 +0000"  >&lt;p&gt;cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sb2nov&quot; class=&quot;user-hover&quot; rel=&quot;sb2nov&quot;&gt;sb2nov&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15975650" author="robertwb" created="Wed, 19 Apr 2017 22:26:58 +0000"  >&lt;p&gt;Python has the same spec. &quot;State plus window expiry callback&quot; doesn&apos;t address the keyless case. &lt;/p&gt;</comment>
                            <comment id="15983733" author="sb2nov" created="Tue, 25 Apr 2017 22:18:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kenn&quot; class=&quot;user-hover&quot; rel=&quot;kenn&quot;&gt;kenn&lt;/a&gt; have we reached a resolution on this?&lt;/p&gt;

&lt;p&gt;Currently in Python if the user doesn&apos;t return a timestamped value we assign it to -1 for the output&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;. As we don&apos;t have state and timers implemented completely yet should we just assert and that we&apos;re getting timestampedValues only.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/beam/blob/master/sdks/python/apache_beam/runners/common.py#L310&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/master/sdks/python/apache_beam/runners/common.py#L310&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15984139" author="kenn" created="Wed, 26 Apr 2017 04:14:35 +0000"  >&lt;p&gt;I believe the best course is to require value, timestamp, and window to all be specified in such cases.&lt;/p&gt;

&lt;p&gt;If someone is going to output in finishBundle, they are responsible for managing windows, so they must already have the data stored to explicitly output to the window and timestamp, or they probably wrote an incorrect DoFn.&lt;/p&gt;</comment>
                            <comment id="15985102" author="altay" created="Wed, 26 Apr 2017 16:35:16 +0000"  >&lt;p&gt;I agree with asserting in this case and documenting this behavior. &lt;/p&gt;</comment>
                            <comment id="15987893" author="githubbot" created="Thu, 27 Apr 2017 23:30:27 +0000"  >&lt;p&gt;GitHub user sb2nov opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/2753&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/2753&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-1283&quot; title=&quot;DoFn finishBundle should be required to specify the window for output&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-1283&quot;&gt;&lt;del&gt;BEAM-1283&lt;/del&gt;&lt;/a&gt; Finish bundle should only emit windowed values&lt;/p&gt;

&lt;p&gt;    Be sure to do all of the following to help us incorporate your contribution&lt;br/&gt;
    quickly and easily:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Make sure the PR title is formatted like:&lt;br/&gt;
       `&lt;a href=&quot;#&amp;gt;&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;BEAM-&amp;lt;Jira issue #&amp;gt;&lt;/a&gt; Description of pull request`&lt;/li&gt;
	&lt;li&gt;[ ] Make sure tests pass via `mvn clean verify`. (Even better, enable&lt;br/&gt;
           Travis-CI on your fork and ensure the whole test matrix passes).&lt;/li&gt;
	&lt;li&gt;[ ] Replace `&amp;lt;Jira issue #&amp;gt;` in the title with the actual Jira issue&lt;br/&gt;
           number, if there is one.&lt;/li&gt;
	&lt;li&gt;[ ] If this contribution is large, please file an Apache&lt;br/&gt;
           &lt;span class=&quot;error&quot;&gt;&amp;#91;Individual Contributor License Agreement&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.apache.org/licenses/icla.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.apache.org/licenses/icla.pdf&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    &amp;#8212;&lt;/p&gt;

&lt;p&gt;    R: @aaltay @robertwb PTAL&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/sb2nov/beam&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/sb2nov/beam&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-1283&quot; title=&quot;DoFn finishBundle should be required to specify the window for output&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-1283&quot;&gt;&lt;del&gt;BEAM-1283&lt;/del&gt;&lt;/a&gt;-finish-bundle-windowed-values&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/2753.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/2753.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2753&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit ace66e63eca538d7b5d4b9369cae63531247d6f5&lt;br/&gt;
Author: Sourabh Bajaj &amp;lt;sourabhbajaj@google.com&amp;gt;&lt;br/&gt;
Date:   2017-04-27T23:11:56Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-1283&quot; title=&quot;DoFn finishBundle should be required to specify the window for output&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-1283&quot;&gt;&lt;del&gt;BEAM-1283&lt;/del&gt;&lt;/a&gt; Finish bundle should only emit windowed values&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15993288" author="altay" created="Tue, 2 May 2017 17:05:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sb2nov&quot; class=&quot;user-hover&quot; rel=&quot;sb2nov&quot;&gt;sb2nov&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=robertwb&quot; class=&quot;user-hover&quot; rel=&quot;robertwb&quot;&gt;robertwb&lt;/a&gt; any update here? What is the plan for sdk-py?&lt;/p&gt;</comment>
                            <comment id="15997732" author="tgroh" created="Fri, 5 May 2017 02:21:58 +0000"  >&lt;p&gt;Assigning to Sourabh for the python change. This is complete within the Java SDK.&lt;/p&gt;</comment>
                            <comment id="15997734" author="kenn" created="Fri, 5 May 2017 02:25:08 +0000"  >&lt;p&gt;I think we should get in the habit of using separate tickets (perhaps subtasks) for different SDKs. Otherwise ownership is unclear and parallelism is not obvious.&lt;/p&gt;</comment>
                            <comment id="15998653" author="robertwb" created="Fri, 5 May 2017 17:48:37 +0000"  >&lt;p&gt;I think we should get in the habit of having a single owner across all SDKs to promote consistency. There may be cases were implementation is delegated across subtasks/tickets, but model changes should not be SDK-specific. &lt;/p&gt;</comment>
                            <comment id="15998671" author="kenn" created="Fri, 5 May 2017 17:55:01 +0000"  >&lt;p&gt;Both sounds good to me.&lt;/p&gt;</comment>
                            <comment id="16003021" author="githubbot" created="Tue, 9 May 2017 16:49:01 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/2753&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/2753&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16003119" author="sb2nov" created="Tue, 9 May 2017 17:30:00 +0000"  >&lt;p&gt;This can be closed now.&lt;/p&gt;</comment>
                            <comment id="16003130" author="dhalperi@google.com" created="Tue, 9 May 2017 17:34:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sb2nov&quot; class=&quot;user-hover&quot; rel=&quot;sb2nov&quot;&gt;sb2nov&lt;/a&gt; This is marked as a Fix for 2.0.0, but the PR #2753 does not appear to have been CPed to &lt;tt&gt;release-2.0.0&lt;/tt&gt; branch (from what I can tell in JIRA history).&lt;/p&gt;

&lt;p&gt;I think you need to send a CP to the release branch before we can close.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Otherwise, we need to revert as this is a backwards-incompatible change.&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="16003449" author="githubbot" created="Tue, 9 May 2017 20:13:37 +0000"  >&lt;p&gt;Github user sb2nov closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/2990&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/2990&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13037877">BEAM-1316</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13036437">BEAM-1287</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 27 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i38yd3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>