<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:54:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-6111] org.apache.beam.runners.flink.PortableTimersExecutionTest is very flakey 40/50 runs failed</title>
                <link>https://issues.apache.org/jira/browse/BEAM-6111</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;I ran this test 50 on master and it failed about 40/50 runs. I have also seen this failing in jenkins presubmit.&lt;/p&gt;

&lt;p&gt;build scan links from java presubmit&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/beam_PreCommit_Java_Commit/2654/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/beam_PreCommit_Java_Commit/2654/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;build scan links when I ran locally:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://scans.gradle.com/s/hzu3bojfdbd5s&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://scans.gradle.com/s/hzu3bojfdbd5s&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://scans.gradle.com/s/txhyj6acebkko&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://scans.gradle.com/s/txhyj6acebkko&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://scans.gradle.com/s/nhju5jthjbdds&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://scans.gradle.com/s/nhju5jthjbdds&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;org.junit.runners.model.TestTimedOutException: test timed out after 60000 milliseconds&lt;br/&gt;
at java.lang.ClassLoader.findBootstrapClass(Native Method)&lt;br/&gt;
at java.lang.ClassLoader.findBootstrapClassOrNull(ClassLoader.java:1015)&lt;br/&gt;
at java.lang.ClassLoader.loadClass(ClassLoader.java:413)&lt;br/&gt;
at java.lang.ClassLoader.loadClass(ClassLoader.java:411)&lt;br/&gt;
at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:339)&lt;br/&gt;
at java.lang.ClassLoader.loadClass(ClassLoader.java:357)&lt;br/&gt;
at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:13)&lt;br/&gt;
at org.junit.Assert.assertThat(Assert.java:956)&lt;br/&gt;
at org.junit.Assert.assertThat(Assert.java:923)&lt;br/&gt;
at org.apache.beam.runners.flink.PortableTimersExecutionTest.testTimerExecution(PortableTimersExecutionTest.java:191)&lt;br/&gt;
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)&lt;br/&gt;
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
at java.lang.reflect.Method.invoke(Method.java:498)&lt;br/&gt;
at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)&lt;br/&gt;
at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)&lt;br/&gt;
at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)&lt;br/&gt;
at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)&lt;br/&gt;
at org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:298)&lt;br/&gt;
at org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:292)&lt;br/&gt;
at java.util.concurrent.FutureTask.run(FutureTask.java:266)&lt;br/&gt;
at java.lang.Thread.run(Thread.java:748)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13199949">BEAM-6111</key>
            <summary>org.apache.beam.runners.flink.PortableTimersExecutionTest is very flakey 40/50 runs failed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mxm">Maximilian Michels</assignee>
                                    <reporter username="ajamato@google.com">Alex Amato</reporter>
                        <labels>
                            <label>flake</label>
                    </labels>
                <created>Wed, 21 Nov 2018 22:53:44 +0000</created>
                <updated>Fri, 24 Jul 2020 19:56:02 +0000</updated>
                            <resolved>Mon, 3 Dec 2018 12:15:24 +0000</resolved>
                                                    <fixVersion>2.9.0</fixVersion>
                    <fixVersion>2.10.0</fixVersion>
                                    <component>runner-flink</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="16695744" author="mxm" created="Thu, 22 Nov 2018 10:06:37 +0000"  >&lt;p&gt;Looking into this now.&lt;/p&gt;</comment>
                            <comment id="16704904" author="mxm" created="Fri, 30 Nov 2018 15:23:21 +0000"  >&lt;p&gt;This is caused by executing the state completion request in &lt;tt&gt;GrpcStateService&lt;/tt&gt; asynchronously with the default threadpool. I think this wasn&apos;t intended because &lt;tt&gt;whenCompleteAsync&lt;/tt&gt; was used instead of &lt;tt&gt;whenComplete&lt;/tt&gt;. The default thread pool in the test is Flink&apos;s thread pool which doesn&apos;t take care to log exceptions.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/beam/blob/c526f6bf62a1d63c7181eb7252c134e42d5c8677/runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/state/GrpcStateService.java#L82&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/c526f6bf62a1d63c7181eb7252c134e42d5c8677/runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/state/GrpcStateService.java#L82&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;With the current implementation the StateRequest will always be a completed CompleteableFuture anyways, so there is no need to schedule asynchronously.&lt;/p&gt;

&lt;p&gt;The following exception was thrown here: &lt;a href=&quot;https://github.com/apache/beam/blob/c526f6bf62a1d63c7181eb7252c134e42d5c8677/runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/state/GrpcStateService.java#L85&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/c526f6bf62a1d63c7181eb7252c134e42d5c8677/runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/state/GrpcStateService.java#L85&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.IllegalStateException: sendHeaders has already been called
    at org.apache.beam.vendor.grpc.v1_13_1.com.google.common.base.Preconditions.checkState(Preconditions.java:444)
    at org.apache.beam.vendor.grpc.v1_13_1.io.grpc.internal.ServerCallImpl.sendHeaders(ServerCallImpl.java:88)
    at org.apache.beam.vendor.grpc.v1_13_1.io.grpc.stub.ServerCalls$ServerCallStreamObserverImpl.onNext(ServerCalls.java:338)
    at org.apache.beam.runners.fnexecution.state.GrpcStateService$Inbound.lambda$onNext$0(GrpcStateService.java:142)
    at java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:760)
    at java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:736)
    at java.util.concurrent.CompletableFuture$Completion.exec(CompletableFuture.java:443)
    at java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:289)
    at java.util.concurrent.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1056)
    at java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1692)
    at java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:157) 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16705109" author="lcwik" created="Fri, 30 Nov 2018 18:12:48 +0000"  >&lt;p&gt;By default, gRPC provides outbound stream observers that aren&apos;t thread safe (for perf reasons) and expects people interacting with them to make them thread safe. The issue seems to be that GrpcStateService assumes that the outbound stream observer is thread safe but by default it is not.&lt;/p&gt;

&lt;p&gt;In addition to what you have added, we should also make the GrpcStateService take in an OutboundObserverFactory that allows the person constructing it to choose whether they want a &quot;buffered and thread safe outbound observer&quot; or a &quot;non thread safe (aka direct)&quot; observer and then the GrpcStateService will provide the necessary hooks for allowing runners to choose whether state requests are handled in parallel or not.&lt;/p&gt;</comment>
                            <comment id="16707101" author="mxm" created="Mon, 3 Dec 2018 12:16:32 +0000"  >&lt;p&gt;Closing this as the underlying issue for test failures are fixed. Follow-up is &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-6166&quot; title=&quot;Allow Runners to configure parallelism of GrpcStateService&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-6166&quot;&gt;BEAM-6166&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13195761">BEAM-5937</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13200756">BEAM-6129</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13201951">BEAM-6166</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 50 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s00r9k:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>