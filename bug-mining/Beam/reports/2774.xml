<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:22:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-13203] Potential data loss when using SnsIO.writeAsync</title>
                <link>https://issues.apache.org/jira/browse/BEAM-13203</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;This needs to be investigated, reading the code suggests we might be losing data under certain conditions e.g. when terminating the pipeline. The async processing model here is far too simplistic.&lt;/p&gt;

&lt;p&gt;The bundle won&apos;t ever know about pending writes and won&apos;t block to wait for any such operation. The same way exceptions are thrown into nowhere. Test cases don&apos;t capture this as they operate on completed futures only (so exceptions in the callbacks get thrown on the thread of processElement).&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
client.publish(publishRequest).whenComplete((response, ex) -&amp;gt; {
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ex == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    SnsResponse&amp;lt;T&amp;gt; snsResponse = SnsResponse.of(context.element(), response);
    context.output(snsResponse);
  } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
    LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; publishing request to SNS&quot;&lt;/span&gt;, ex);
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SnsWriteException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; publishing request to SNS&quot;&lt;/span&gt;, ex);
  }
}); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Also, this entirely removes backpressure from a stream. When used with a much faster source we will continue to accumulate more and more memory as the number of concurrent pending async operations is not limited.&lt;/p&gt;

&lt;p&gt;Spotify&apos;s scio contains a &lt;a href=&quot;https://github.com/spotify/scio/blob/main/scio-core/src/main/java/com/spotify/scio/transforms/JavaAsyncDoFn.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JavaAsyncDoFn&lt;/a&gt; that illustrates how it can be done.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13410685">BEAM-13203</key>
            <summary>Potential data loss when using SnsIO.writeAsync</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10101" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">P1</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="mosche">Moritz Mack</assignee>
                                    <reporter username="mosche">Moritz Mack</reporter>
                        <labels>
                    </labels>
                <created>Mon, 8 Nov 2021 18:44:27 +0000</created>
                <updated>Fri, 4 Feb 2022 15:14:05 +0000</updated>
                            <resolved>Fri, 4 Feb 2022 15:14:05 +0000</resolved>
                                                    <fixVersion>2.37.0</fixVersion>
                                    <component>io-java-aws</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="17440667" author="mosche" created="Mon, 8 Nov 2021 18:46:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aromanenko&quot; class=&quot;user-hover&quot; rel=&quot;aromanenko&quot;&gt;aromanenko&lt;/a&gt; Any thoughts?&lt;/p&gt;</comment>
                            <comment id="17440699" author="kenn" created="Mon, 8 Nov 2021 19:27:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mosche&quot; class=&quot;user-hover&quot; rel=&quot;mosche&quot;&gt;mosche&lt;/a&gt; would you be interested in making the suggested improvements?&lt;/p&gt;</comment>
                            <comment id="17441183" author="echauchot" created="Tue, 9 Nov 2021 14:06:12 +0000"  >&lt;p&gt;regarding data loss comment, I&apos;d raise the priority&lt;/p&gt;</comment>
                            <comment id="17441184" author="echauchot" created="Tue, 9 Nov 2021 14:06:56 +0000"  >&lt;p&gt;Thanks for identifying this &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mosche&quot; class=&quot;user-hover&quot; rel=&quot;mosche&quot;&gt;mosche&lt;/a&gt; !&lt;/p&gt;</comment>
                            <comment id="17441190" author="echauchot" created="Tue, 9 Nov 2021 14:17:44 +0000"  >&lt;p&gt;yes, proper async mechanism with retrials, limited buffered requests and timed out wait for async response seem to be necessary.&lt;/p&gt;

&lt;p&gt;If the write is backpressured, there is no way to slow down the source (because its watermark will got forward) so the records will be buffered in the write operation indeed&lt;/p&gt;</comment>
                            <comment id="17441208" author="mosche" created="Tue, 9 Nov 2021 14:52:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kenn&quot; class=&quot;user-hover&quot; rel=&quot;kenn&quot;&gt;kenn&lt;/a&gt; &#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=echauchot&quot; class=&quot;user-hover&quot; rel=&quot;echauchot&quot;&gt;echauchot&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aromanenko&quot; class=&quot;user-hover&quot; rel=&quot;aromanenko&quot;&gt;aromanenko&lt;/a&gt;&#160;&lt;br/&gt;
Based on my potentially flawed assessment SnsIO.&lt;b&gt;writeAsync&lt;/b&gt; is conceptually so broken that it will require significant work to get it into a reliable state. I can hardly imagine anyone runs this successfully in production.&#160;&lt;/p&gt;

&lt;p&gt;SnsIO.&lt;b&gt;write&lt;/b&gt; on the other hand is just fine, so I&apos;m not sure what the right thing to do is (fix it or deprecate/remove it). Most of all I wanted to raise a red flag regarding &lt;b&gt;writeAsynch.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;In terms of priorities it seems almost more important to work towards getting feature parity between SDK v1 and v2 so v1 can finally be deprecated (and eventually be dropped).&lt;/p&gt;</comment>
                            <comment id="17442350" author="kenn" created="Thu, 11 Nov 2021 16:51:26 +0000"  >&lt;p&gt;I am setting this back to P1 which is for failing tests, potential data loss, loss of functionality. P0 is for real-time outages like the website or GitHub being down, etc. (see &lt;a href=&quot;https://beam.apache.org/contribute/jira-priorities/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://beam.apache.org/contribute/jira-priorities/&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="17442353" author="kenn" created="Thu, 11 Nov 2021 16:53:05 +0000"  >&lt;p&gt;Perhaps we should deprecate the broken method if we do not have capacity to fix it.&lt;/p&gt;</comment>
                            <comment id="17443775" author="mosche" created="Mon, 15 Nov 2021 11:40:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aromanenko&quot; class=&quot;user-hover&quot; rel=&quot;aromanenko&quot;&gt;aromanenko&lt;/a&gt; What&apos;s your thoughts on SnsIO.&lt;b&gt;writeAsync&lt;/b&gt;?&lt;/p&gt;</comment>
                            <comment id="17465007" author="aromanenko" created="Fri, 24 Dec 2021 12:36:08 +0000"  >&lt;p&gt;I&apos;m sorry for &quot;ignoring&quot; this Jira for a while, but I was off for a while and it&apos;s just lost somewhere in my inbox.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mosche&quot; class=&quot;user-hover&quot; rel=&quot;mosche&quot;&gt;mosche&lt;/a&gt; Could you elaborate what do you mean by &quot;&lt;em&gt;SnsIO.writeAsync is conceptually so broken&lt;/em&gt;&quot; except that one can have  potentially a data loss in case of unexpected pipeline fail/stop and what should be done to fix/improve this? &lt;/p&gt;</comment>
                            <comment id="17465019" author="aromanenko" created="Fri, 24 Dec 2021 13:40:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=echauchot&quot; class=&quot;user-hover&quot; rel=&quot;echauchot&quot;&gt;echauchot&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;If the write is backpressured, there is no way to slow down the source (because its watermark will got forward) so the records will be buffered in the write operation indeed&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes but since there is no internal back-pressure mechanism in Beam, and, in that way, &quot;sink&quot; never knows about how fast is &quot;source&quot;, then it won&apos;t be so easy to deal with this. Well, this topic is quite complicated and out of the scope of this Jira, so here we just need to make sure that don&apos;t potentially lose the data using async client.&lt;/p&gt;</comment>
                            <comment id="17465984" author="mosche" created="Tue, 28 Dec 2021 07:40:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aromanenko&quot; class=&quot;user-hover&quot; rel=&quot;aromanenko&quot;&gt;aromanenko&lt;/a&gt; With &lt;em&gt;conceptually broken&lt;/em&gt;&#160;I mean the design (and implementation) is broken both with respect to the beam programming model as well as general async programming:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Output for a bundle may be emitted even after the bundle is finished (lack of join / waiting for pending futures), additionally output is emitted from multiple threads risking concurrent modification issues on underlying data structures&lt;/li&gt;
	&lt;li&gt;Exceptions disappear into the void (respective tests are broken as they don&apos;t throw asynchronously and could make one think this works)&lt;/li&gt;
	&lt;li&gt;Parallelism is unlimited causing the writer to instantly accumulate everything into memory&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;IMHO, the async writer should just be deprecated. I don&apos;t see much value in fixing it as there already is a working one and the backlog of critical / important issues for AWS IOs is already far too long.&lt;/p&gt;</comment>
                            <comment id="17487118" author="aromanenko" created="Fri, 4 Feb 2022 15:08:46 +0000"  >&lt;p&gt;Can we close this one once it&apos;s deprecated?&lt;/p&gt;</comment>
                            <comment id="17487120" author="mosche" created="Fri, 4 Feb 2022 15:14:05 +0000"  >&lt;p&gt;I closed it as &quot;Won&apos;t fix&quot;, &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-13824&quot; title=&quot;Migrate SnsIO.write to async implementation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-13824&quot;&gt;BEAM-13824&lt;/a&gt; is a follow up to migrate SnsIO.write into a functional &amp;amp; performant async implementation&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13265781">BEAM-8542</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13426580">BEAM-13824</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 40 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0wjr4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>