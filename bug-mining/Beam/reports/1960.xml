<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:10:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-9976] FlinkSavepointTest timeout flake</title>
                <link>https://issues.apache.org/jira/browse/BEAM-9976</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;org.apache.beam.runners.flink.FlinkSavepointTest.testSavepointRestorePortable&lt;/p&gt;

&lt;p&gt;org.junit.runners.model.TestTimedOutException: test timed out after 60 seconds&lt;br/&gt;
	at sun.misc.Unsafe.park(Native Method)&lt;br/&gt;
	at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)&lt;br/&gt;
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:836)&lt;br/&gt;
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireSharedInterruptibly(AbstractQueuedSynchronizer.java:997)&lt;br/&gt;
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(AbstractQueuedSynchronizer.java:1304)&lt;br/&gt;
	at java.util.concurrent.CountDownLatch.await(CountDownLatch.java:231)&lt;br/&gt;
	at org.apache.beam.runners.flink.FlinkSavepointTest.runSavepointAndRestore(FlinkSavepointTest.java:188)&lt;br/&gt;
	at org.apache.beam.runners.flink.FlinkSavepointTest.testSavepointRestorePortable(FlinkSavepointTest.java:154)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:498)&lt;br/&gt;
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)&lt;br/&gt;
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)&lt;br/&gt;
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)&lt;br/&gt;
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)&lt;br/&gt;
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)&lt;br/&gt;
	at org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:288)&lt;br/&gt;
	at org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:282)&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:748)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13304460">BEAM-9976</key>
            <summary>FlinkSavepointTest timeout flake</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10101" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">P1</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ibzib">Kyle Weaver</reporter>
                        <labels>
                            <label>beam-fixit</label>
                            <label>flake</label>
                    </labels>
                <created>Tue, 12 May 2020 21:14:12 +0000</created>
                <updated>Sat, 15 May 2021 18:01:48 +0000</updated>
                            <resolved>Sat, 15 May 2021 18:01:48 +0000</resolved>
                                                    <fixVersion>2.24.0</fixVersion>
                                    <component>runner-flink</component>
                    <component>test-failures</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="600">10m</timespent>
                                <comments>
                            <comment id="17106196" author="mxm" created="Wed, 13 May 2020 10:42:34 +0000"  >&lt;p&gt;Do you have a link to the full log?&lt;/p&gt;</comment>
                            <comment id="17106508" author="ibzib" created="Wed, 13 May 2020 17:33:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://scans.gradle.com/s/6cokekk7btld4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://scans.gradle.com/s/6cokekk7btld4&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17133370" author="bhulette" created="Thu, 11 Jun 2020 16:16:26 +0000"  >&lt;p&gt;Changed the priority to P1 based on &lt;a href=&quot;https://beam.apache.org/contribute/jira-priorities/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://beam.apache.org/contribute/jira-priorities/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Saw this again in &lt;a href=&quot;https://builds.apache.org/job/beam_PreCommit_Java_Commit/11730/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/beam_PreCommit_Java_Commit/11730/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17133770" author="bhulette" created="Thu, 11 Jun 2020 23:09:50 +0000"  >&lt;p&gt;I can make this test fail in the same way locally if I add a call to tempFolder.delete() here: &lt;a href=&quot;https://github.com/apache/beam/blob/db00d869060a222df730d0737a1ae48d4f3f8b26/runners/flink/src/test/java/org/apache/beam/runners/flink/FlinkSavepointTest.java#L189&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/db00d869060a222df730d0737a1ae48d4f3f8b26/runners/flink/src/test/java/org/apache/beam/runners/flink/FlinkSavepointTest.java#L189&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So it seems likely the cause of these failures is something cleaning up tempFolder. This seems like it could indicate a bug in the Flink runner - I&apos;d expect it to fail loudly when that happens, not just hang&lt;/p&gt;</comment>
                            <comment id="17134617" author="bhulette" created="Sat, 13 Jun 2020 01:44:11 +0000"  >&lt;p&gt;I looked into why we aren&apos;t getting more logging info here. The junit jenkins plugin is supposed to keep 500KB at the beginning and at the end of the log for failing tests, while it only keeps 500B for passing tests (source: &lt;a href=&quot;https://github.com/jenkinsci/junit-plugin/blob/master/src/main/java/hudson/tasks/junit/CaseResult.java#L190&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jenkinsci/junit-plugin/blob/master/src/main/java/hudson/tasks/junit/CaseResult.java#L190&lt;/a&gt;). It seems for some reason this test is being classified as passing so a lot of our log is getting thrown away. I wonder if this is because there are multiple runs of testSavepointRestorePortable, only one of which fails?&lt;/p&gt;</comment>
                            <comment id="17144918" author="mxm" created="Thu, 25 Jun 2020 13:37:28 +0000"  >&lt;p&gt;Not sure it has to do with the temp folder. The reason you might not see failures is that we are starting an embedded cluster which runs async from the main test thread. There is a synchronization though via a latch.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I wonder if this is because there are multiple runs of testSavepointRestorePortable, only one of which fails?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There is only one run of that test and another run for &lt;tt&gt;testSavepointRestoreLegacy&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17145052" author="bhulette" created="Thu, 25 Jun 2020 16:06:01 +0000"  >&lt;p&gt;I was referring to the multiple runs you can see at &lt;a href=&quot;https://builds.apache.org/job/beam_PreCommit_Java_Commit/11730/testReport/org.apache.beam.runners.flink/FlinkSavepointTest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/beam_PreCommit_Java_Commit/11730/testReport/org.apache.beam.runners.flink/FlinkSavepointTest/&lt;/a&gt;, there are three of each: &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13006447/13006447_multiple_savepoint_tests.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;</comment>
                            <comment id="17145111" author="mxm" created="Thu, 25 Jun 2020 17:07:17 +0000"  >&lt;p&gt;That is really strange because the class only contains two tests. I don&apos;t know why Jenkins triples the number of tests.&lt;/p&gt;</comment>
                            <comment id="17146554" author="kenn" created="Fri, 26 Jun 2020 18:04:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://ci-beam.apache.org/job/beam_PreCommit_Java_Cron/2922/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_PreCommit_Java_Cron/2922/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17146556" author="kenn" created="Fri, 26 Jun 2020 18:11:03 +0000"  >&lt;p&gt;Build scan seems to be missing. The issue with the multiple runs is that Jenkins test result plugin has an insufficient primary key for results. We had these problem before a lot where e.g. ParDoTest for different runners would clobber each other. And then when you click through, which page loaded was nondeterministic. At least the case here seems a little less broken...&lt;/p&gt;</comment>
                            <comment id="17146557" author="kenn" created="Fri, 26 Jun 2020 18:12:37 +0000"  >&lt;p&gt;Yup. Reading the log in this case it is&#160;&lt;tt&gt;:runners:flink:1.8:test&lt;/tt&gt; failing. The same test runs for each Flink version and they land in the same test bucket because the tests themselves do not have distinct names.&lt;/p&gt;</comment>
                            <comment id="17146560" author="bhulette" created="Fri, 26 Jun 2020 18:15:47 +0000"  >&lt;p&gt;Oh I see. They&apos;re actually (sort of) duplicates for the same runs, the stderr is exactly the same.&lt;/p&gt;

&lt;p&gt;That must be the cause of&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-10262&quot; title=&quot;Jenkins truncates logs excessively for failing tests.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-10262&quot;&gt;BEAM-10262&lt;/a&gt; then. The junit plugin checks stacktrace == null to see if a test passed when deciding how much of the log to truncate.&lt;/p&gt;</comment>
                            <comment id="17146575" author="mxm" created="Fri, 26 Jun 2020 19:02:42 +0000"  >&lt;p&gt;Good catch! Of course the tests run three times, once for each Flink version.&lt;/p&gt;

&lt;p&gt;The test hangs waiting for the latch countdown after restoring the pipeline from a savepoint.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.beam.runners.flink.FlinkSavepointTest &amp;gt; testSavepointRestorePortable FAILED
    org.junit.runners.model.TestTimedOutException at FlinkSavepointTest.java:190
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Locally, I can&apos;t get the test to fail if I continue to execute the test in a loop (Note: you need to manually call the after() method after the test method). &lt;/p&gt;

&lt;p&gt;Is there a way we could generate test names which include the Flink version?&lt;/p&gt;</comment>
                            <comment id="17146643" author="kenn" created="Fri, 26 Jun 2020 21:19:05 +0000"  >&lt;p&gt;I hadn&apos;t looked at this, so just searching. It seems the &lt;tt&gt;@DisplayName&lt;/tt&gt; is unfortunately static.&lt;/p&gt;</comment>
                            <comment id="17146645" author="kenn" created="Fri, 26 Jun 2020 21:21:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.jenkins-ci.org/browse/JENKINS-13214&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.jenkins-ci.org/browse/JENKINS-13214&lt;/a&gt; is relevant, but I think is the fix for what I was complaining about from the early days of Beam. (like maybe we upgraded past that fix some years after it was fixed)&lt;/p&gt;</comment>
                            <comment id="17163118" author="mxm" created="Wed, 22 Jul 2020 22:47:04 +0000"  >&lt;p&gt;Could be caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-10558&quot; title=&quot;Flushing of buffered elements during checkpoint can stall&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-10558&quot;&gt;&lt;del&gt;BEAM-10558&lt;/del&gt;&lt;/a&gt;. We will see after the fix is merged.&lt;/p&gt;</comment>
                            <comment id="17165784" author="mxm" created="Mon, 27 Jul 2020 15:20:27 +0000"  >&lt;p&gt;Doesn&apos;t seem to be the case because the test is still flaky: &lt;a href=&quot;https://ci-beam.apache.org/job/beam_PreCommit_Java_Cron/3042/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_PreCommit_Java_Cron/3042/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17165896" author="mxm" created="Mon, 27 Jul 2020 18:17:54 +0000"  >&lt;p&gt;This scan has the log: &lt;a href=&quot;https://scans.gradle.com/s/jb5tbdedsu5xs/tests/:runners:flink:1.8:test/org.apache.beam.runners.flink.FlinkSavepointTest/testSavepointRestorePortable#1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://scans.gradle.com/s/jb5tbdedsu5xs/tests/:runners:flink:1.8:test/org.apache.beam.runners.flink.FlinkSavepointTest/testSavepointRestorePortable#1&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The problem seems to come from the embedded cluster which does not allow the job to start from a savepoint, due to missing resources. The job vertices are still in the &lt;tt&gt;SCHEDULED&lt;/tt&gt; phase (not &lt;tt&gt;RUNNING&lt;/tt&gt;) and thus can&apos;t produce output. This may be resolvable by just increasing the timeout: &lt;a href=&quot;https://github.com/apache/beam/pull/12378&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/12378&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17172605" author="altay" created="Thu, 6 Aug 2020 18:40:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/beam/pull/12378&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/12378&lt;/a&gt;&#160;is merged. Can we close this?&lt;/p&gt;</comment>
                            <comment id="17172609" author="mxm" created="Thu, 6 Aug 2020 18:44:39 +0000"  >&lt;p&gt;If we haven&apos;t seen any new failures, I&apos;d say yes.&lt;/p&gt;</comment>
                            <comment id="17172624" author="bhulette" created="Thu, 6 Aug 2020 19:03:30 +0000"  >&lt;p&gt;History LGTM: &lt;a href=&quot;https://ci-beam.apache.org/job/beam_PreCommit_Java_Cron/lastCompletedBuild/testReport/junit/org.apache.beam.runners.flink/FlinkSavepointTest/testSavepointRestorePortable/history/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_PreCommit_Java_Cron/lastCompletedBuild/testReport/junit/org.apache.beam.runners.flink/FlinkSavepointTest/testSavepointRestorePortable/history/&lt;/a&gt;&lt;br/&gt;
Last failure was on July 26, PR merged on July 28&lt;/p&gt;</comment>
                            <comment id="17172628" author="mxm" created="Thu, 6 Aug 2020 19:11:22 +0000"  >&lt;p&gt;Oh that&apos;s neat. I didn&apos;t know this feature. Cool!&lt;/p&gt;</comment>
                            <comment id="17345553" author="kenn" created="Sat, 15 May 2021 18:01:48 +0000"  >&lt;p&gt;Hello! Due to a bug in our Jira configuration, this issue had status:Resolved but resolution:Unresolved.&lt;/p&gt;

&lt;p&gt;I am bulk editing these issues to have resolution:Fixed&lt;/p&gt;

&lt;p&gt;If a different resolution is appropriate, please change it. To do this, click the &quot;Resolve&quot; button (you can do this even for closed issues) and set the Resolution field to the right value.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13318785">BEAM-10558</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13006447" name="multiple_savepoint_tests.png" size="87524" author="bhulette" created="Thu, 25 Jun 2020 16:05:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 26 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ennk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>