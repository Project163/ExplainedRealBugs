<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:11:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-10752] [beam_PostCommit_SQL] PubsubToBigqueryIT.testSimpleInsert failed</title>
                <link>https://issues.apache.org/jira/browse/BEAM-10752</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;java.lang.AssertionError: Expected: iterable with items [&amp;lt;Row:&lt;span class=&quot;error&quot;&gt;&amp;#91;3, foo&amp;#93;&lt;/span&gt;&amp;gt;, &amp;lt;Row:&lt;span class=&quot;error&quot;&gt;&amp;#91;5, bar&amp;#93;&lt;/span&gt;&amp;gt;, &amp;lt;Row:&lt;span class=&quot;error&quot;&gt;&amp;#91;7, baz&amp;#93;&lt;/span&gt;&amp;gt;] in any order but: no item matches: &amp;lt;Row:&lt;span class=&quot;error&quot;&gt;&amp;#91;3, foo&amp;#93;&lt;/span&gt;&amp;gt;, &amp;lt;Row:&lt;span class=&quot;error&quot;&gt;&amp;#91;5, bar&amp;#93;&lt;/span&gt;&amp;gt;, &amp;lt;Row:&lt;span class=&quot;error&quot;&gt;&amp;#91;7, baz&amp;#93;&lt;/span&gt;&amp;gt; in []&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://ci-beam.apache.org/job/beam_PostCommit_SQL/5208/testReport/junit/org.apache.beam.sdk.extensions.sql/PubsubToBigqueryIT/testSimpleInsert/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_PostCommit_SQL/5208/testReport/junit/org.apache.beam.sdk.extensions.sql/PubsubToBigqueryIT/testSimpleInsert/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This happened after &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-10716&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/BEAM-10716&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Maybe the pubsub subscription is accidentally deleted? Brian could you please take a look?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13323428">BEAM-10752</key>
            <summary>[beam_PostCommit_SQL] PubsubToBigqueryIT.testSimpleInsert failed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10101" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">P1</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bhulette">Brian Hulette</assignee>
                                    <reporter username="robinyqiu">Robin Qiu</reporter>
                        <labels>
                            <label>currently-failing</label>
                    </labels>
                <created>Tue, 18 Aug 2020 19:42:32 +0000</created>
                <updated>Thu, 13 Jan 2022 21:48:50 +0000</updated>
                            <resolved>Tue, 11 May 2021 00:45:28 +0000</resolved>
                                                    <fixVersion>Missing</fixVersion>
                                    <component>dsl-sql</component>
                    <component>test-failures</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="8400">2h 20m</timespent>
                                <comments>
                            <comment id="17180035" author="robinyqiu" created="Tue, 18 Aug 2020 19:42:57 +0000"  >&lt;p&gt;cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=boyuanz&quot; class=&quot;user-hover&quot; rel=&quot;boyuanz&quot;&gt;boyuanz&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17180052" author="bhulette" created="Tue, 18 Aug 2020 20:02:15 +0000"  >&lt;p&gt;I bet this is just a result of &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-10716&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/BEAM-10716&lt;/a&gt;, as the pipeline is unable to create a subscription to the topic where test data is injected. I&apos;ll take a look&lt;/p&gt;</comment>
                            <comment id="17180064" author="bhulette" created="Tue, 18 Aug 2020 20:22:35 +0000"  >&lt;p&gt;Nevermind, looks like this is a legitimate failure. The last time the Java pubsub tests failed due to subscriptions being exhausted is &lt;a href=&quot;https://ci-beam.apache.org/job/beam_PostCommit_SQL/5207/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_PostCommit_SQL/5207/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Since &lt;a href=&quot;https://ci-beam.apache.org/job/beam_PostCommit_SQL/5208/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_PostCommit_SQL/5208/&lt;/a&gt; only testSimpleInsert and testSimpleInsertFlat are failing with the assertion error. Maybe a bad change was merged while it was failing&lt;/p&gt;</comment>
                            <comment id="17180096" author="bhulette" created="Tue, 18 Aug 2020 20:53:29 +0000"  >&lt;p&gt;It looks like this was broken by &lt;a href=&quot;https://github.com/apache/beam/pull/12519&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/12519&lt;/a&gt; (makes SDF opt-out for Java). If I opt out by adding the &quot;use_deprecated_read&quot; experiment, testSimpleInsert passes. I&apos;ll send a PR to fix the tests by doing this, but we should figure out why SDF has broken them &lt;/p&gt;

&lt;p&gt;CC: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lcwik&quot; class=&quot;user-hover&quot; rel=&quot;lcwik&quot;&gt;lcwik&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17180140" author="lcwik" created="Tue, 18 Aug 2020 22:34:29 +0000"  >&lt;p&gt;What is interesting is that in the PubsubReadIT I&apos;m seeing messages being read and that test succeeds.&lt;/p&gt;</comment>
                            <comment id="17180149" author="lcwik" created="Tue, 18 Aug 2020 22:58:32 +0000"  >&lt;p&gt;The issue is that &lt;a href=&quot;https://github.com/apache/beam/blob/0cc86673845ae0368f0920930f9745ccd8d86db2/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/pubsub/PubsubSchemaIOProvider.java#L228&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PubsubSchemaIOProvider.java&lt;/a&gt; uses a pubsub topic which means that any messages published before the topic is created won&apos;t be visible yet the tests perform&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
pipeline.run();  &lt;span class=&quot;code-comment&quot;&gt;// blockOnRun=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;/span&gt;pubsub.publish(...messages...);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which is an inherent race condition in the test.&lt;/p&gt;

&lt;p&gt;I changed the code to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
pipeline.run();  &lt;span class=&quot;code-comment&quot;&gt;// blockOnRun=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(30_000);
pubsub.publish(...messages...);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;as a test and the test passed.&lt;/p&gt;</comment>
                            <comment id="17180153" author="lcwik" created="Tue, 18 Aug 2020 23:03:12 +0000"  >&lt;p&gt;Should &lt;b&gt;PubsubSchemaIOProvider&lt;/b&gt; be using a subscription?&lt;/p&gt;</comment>
                            <comment id="17180160" author="bhulette" created="Tue, 18 Aug 2020 23:11:53 +0000"  >&lt;p&gt;It should have the option to use a subscription (I&apos;m sure there&apos;s a jira tracking this), but we want Beam SQL users to be able to reference topics. I think we should make these tests use a TestPubsubSignal, like PubsubReadIT and other SQL tests that read from pubsub by topic&lt;/p&gt;</comment>
                            <comment id="17180165" author="bhulette" created="Tue, 18 Aug 2020 23:18:40 +0000"  >&lt;p&gt;Spoke with Luke about this offline. He pointed out that with the deprecated reader, the DirectRunner would setup the unbounded reader so this race condition wasn&apos;t a problem. This is no longer the case with SDF, so we&apos;ll need to either reference pubsub subscriptions in our tests (not possible in SQL yet), or use a TestPubsubSignal to make sure the pipeline has started before injecting data.&lt;/p&gt;</comment>
                            <comment id="17180712" author="lcwik" created="Wed, 19 Aug 2020 17:25:06 +0000"  >&lt;p&gt;Brian updated the code to use a TestPubsubSignal which will work most of the time but is still flawed since there is no guarantee that the SDF will have executed once and created the subscription before the signal has been executed. Moving to a model where we only publish messages once a subscriber has been detected would solve this problem for good and simplify the implementation.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 12 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0hw7s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>