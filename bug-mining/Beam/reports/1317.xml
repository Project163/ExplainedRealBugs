<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:01:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-7420] Including the Flink runner causes exceptions unless running in a flink environment</title>
                <link>https://issues.apache.org/jira/browse/BEAM-7420</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;The &lt;tt&gt;FlinkPipelineOptions&lt;/tt&gt; imports various Flink enums which make it impossible to e.g. run the direct runner with the same classpath but without the flink runtime. The fix is potentially easy - make the arguments strings and convert them to enums at the callsites.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13235528">BEAM-7420</key>
            <summary>Including the Flink runner causes exceptions unless running in a flink environment</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mxm">Maximilian Michels</assignee>
                                    <reporter username="mikekap">Mike Kaplinskiy</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 May 2019 20:01:23 +0000</created>
                <updated>Sat, 16 May 2020 14:04:08 +0000</updated>
                            <resolved>Wed, 14 Aug 2019 10:23:17 +0000</resolved>
                                                    <fixVersion>2.16.0</fixVersion>
                                    <component>runner-flink</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="9000">2.5h</timespent>
                                <comments>
                            <comment id="16848843" author="mxm" created="Mon, 27 May 2019 11:10:15 +0000"  >&lt;p&gt;I&apos;m not sure this will work because the entire Flink Runner artifact depends on Flink itself; it&apos;s not only &lt;tt&gt;FlinkPipelineOptions&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16849262" author="mikekap" created="Tue, 28 May 2019 00:37:04 +0000"  >&lt;p&gt;Technically the artifact does depend on Flink, but the JVM loads classes lazily. That is, unless you actually use something Flink-related (e.g. &lt;tt&gt;FlinkRunner&lt;/tt&gt; itself), the classes aren&apos;t actually required. It&apos;s pretty weird, but it&apos;s part of the language spec: &lt;a href=&quot;https://docs.oracle.com/javase/specs/jls/se8/html/jls-12.html#jls-12.4.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/specs/jls/se8/html/jls-12.html#jls-12.4.1&lt;/a&gt; .&lt;/p&gt;

&lt;p&gt;Currently it looks like the &lt;tt&gt;FlinkPipelineOptions&lt;/tt&gt; are loaded eagerly by the &lt;tt&gt;PipelineOptionsFactory&lt;/tt&gt; because of the &lt;tt&gt;PipelineOptionsRegistrar&lt;/tt&gt; Flink provides. So even though you might pass &lt;tt&gt;--runner=direct&lt;/tt&gt;, the &lt;tt&gt;FlinkPipelineOptions&lt;/tt&gt; class is instantiated - even though no options are set/used.&lt;/p&gt;

&lt;p&gt;If the options class didn&apos;t use any Flink directly (as part of annotations, etc) you would be able to use the same fat jar with multiple runners - including the test runner. The Spark runner does something similar here: &lt;a href=&quot;https://github.com/apache/beam/blob/8304e9497abfd0e92337837a2bfb63bdf2178ce8/runners/spark/src/main/java/org/apache/beam/runners/spark/SparkPipelineOptions.java#L52-L54&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/8304e9497abfd0e92337837a2bfb63bdf2178ce8/runners/spark/src/main/java/org/apache/beam/runners/spark/SparkPipelineOptions.java#L52-L54&lt;/a&gt; .&lt;/p&gt;</comment>
                            <comment id="16850841" author="mxm" created="Wed, 29 May 2019 13:22:28 +0000"  >&lt;p&gt;Thanks for clarifying. That does make sense. As far as I can see there is &lt;tt&gt;StateBackend&lt;/tt&gt; and &lt;tt&gt;CheckpointingMode&lt;/tt&gt;. We can replace those with strings.&lt;/p&gt;</comment>
                            <comment id="16850851" author="mxm" created="Wed, 29 May 2019 13:38:07 +0000"  >&lt;p&gt;I&apos;m curious, how do you actually exclude the Flink runtime? As it is required to construct the Flink job, it should always be included in the Flink Runner artifact. I have the feeling that something else might be wrong.&lt;/p&gt;</comment>
                            <comment id="16859306" author="mikekap" created="Sat, 8 Jun 2019 19:50:00 +0000"  >&lt;p&gt;Sorry for the late response. I manually excluded the flink-runner bits (I&apos;m on a somewhat unorthodox build system (Buck) so I simply removed the dependencies). When the job runs in a flink cluster, the cluster includes all the necessary flink jars (as well as some others - e.g. to write checkpoints/savepoints to S3).&lt;/p&gt;

&lt;p&gt;I&apos;m curious - would it make sense to mark the flink dependencies in beam as &lt;tt&gt;provided&lt;/tt&gt;? I&apos;m not 100% sure it&apos;s possible to run a flink cluster from just the java class files - you probably need the rest of the flink distribution anyway, which definitely comes with the flink jars?&lt;/p&gt;</comment>
                            <comment id="16861043" author="mxm" created="Tue, 11 Jun 2019 13:32:49 +0000"  >&lt;p&gt;Thank you for the response. I figured that you somehow excluded the Flink runtime manually.&lt;/p&gt;

&lt;p&gt;Actually, the Runner jar is completely self-contained. You can spin up a Flink cluster and run a Beam pipeline from it. Setting the dependencies to &lt;tt&gt;provided&lt;/tt&gt; would mean this is no longer possible. We could probably work around this by 1) re-adding the runtime dependencies in the example pom and 2) only require the dependencies during testing e.g. &lt;tt&gt;testCompile&lt;/tt&gt;.&lt;/p&gt;
</comment>
                            <comment id="16861350" author="mikekap" created="Tue, 11 Jun 2019 18:49:02 +0000"  >&lt;p&gt;Ah that&apos;s pretty convenient. I was following the instructions at&#160;&lt;a href=&quot;https://ci.apache.org/projects/flink/flink-docs-release-1.8/dev/projectsetup/dependencies.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci.apache.org/projects/flink/flink-docs-release-1.8/dev/projectsetup/dependencies.html&lt;/a&gt;&#160;and saw that it was provided so I just excluded them. That said, it would definitely be nice to be able to include &quot;all of the beam I need&quot; without requiring I also run on flink &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. I&apos;m happy to submit a patch if you&apos;d like.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13239054">BEAM-7544</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 22 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z032eo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>