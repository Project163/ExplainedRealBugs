<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:59:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-6027] Slow DownloaderStream when reading from GCS</title>
                <link>https://issues.apache.org/jira/browse/BEAM-6027</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;DownloaderStream inherits&#160;io.RawIOBase, which by defaults reads io.DEFAULT_BUFFER_SIZE chunks in .readall(). This is causing extremely slow performance when invoking read() on handles returned by GcsIO().open().&lt;/p&gt;

&lt;p&gt;The following code&#160;can take&#160;~60 seconds to download a single 2MB file:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
gcs = GcsIO()
t = time.time()
path = &lt;span class=&quot;code-quote&quot;&gt;&apos;gs://my-bucket/my-2MB-&lt;span class=&quot;code-object&quot;&gt;file&lt;/span&gt;&apos;&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;with&lt;/span&gt; gcs.&lt;span class=&quot;code-object&quot;&gt;open&lt;/span&gt;(path) &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; f:
    f.read()
duration = time.time() - t
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This monkey patch makes the same download code take &amp;lt;1 second:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; apache_beam.io.gcp &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; gcsio
&lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; apache_beam.io.filesystemio &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; DownloaderStream

&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; downloader_stream_readall(&lt;span class=&quot;code-keyword&quot;&gt;self&lt;/span&gt;):
    &lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;&quot;Read until EOF, using multiple read() call.&quot;&lt;/span&gt;&quot;&quot;
    res = &lt;span class=&quot;code-object&quot;&gt;bytearray&lt;/span&gt;()
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;True&lt;/span&gt;&lt;/span&gt;:
        data = &lt;span class=&quot;code-keyword&quot;&gt;self&lt;/span&gt;.read(gcsio.DEFAULT_READ_BUFFER_SIZE)
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;not&lt;/span&gt; data:
            &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;
        res += data
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; res:
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;bytes&lt;/span&gt;(res)
    &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;:
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; data

DownloaderStream.readall = downloader_stream_readall
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13197234">BEAM-6027</key>
            <summary>Slow DownloaderStream when reading from GCS</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10103" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">P3</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="andreasjansson">Andreas Jansson</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Nov 2018 20:18:48 +0000</created>
                <updated>Fri, 3 Jun 2022 23:03:01 +0000</updated>
                                                                            <component>sdk-py-core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="10200">2h 50m</timespent>
                                <comments>
                            <comment id="17474206" author="kenn" created="Wed, 12 Jan 2022 03:50:54 +0000"  >&lt;p&gt;This Jira ticket has a pull request attached to it, but is still open. Did the pull request resolve the issue? If so, could you please mark it resolved? This will help the project have a clear view of its open issues.&lt;/p&gt;</comment>
                            <comment id="17547477" author="kenn" created="Fri, 3 Jun 2022 23:03:01 +0000"  >&lt;p&gt;This issue has been migrated to &lt;a href=&quot;https://github.com/apache/beam/issues/19238&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/issues/19238&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 23 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s00am8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>