<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:25:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-14429] SyntheticUnboundedSource(with SDF) produce duplicate records when split with DEFAULT_DESIRED_NUM_SPLITS</title>
                <link>https://issues.apache.org/jira/browse/BEAM-14429</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;With the default 20 split, the num records produced by Read.from(SyntheticUnboundedSource) is always larger than the numRecords specified. the more splits the more actual number records produced is off. And the Read step tends to take longer time with more splits.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/beam/blob/master/sdks/java/core/src/main/java/org/apache/beam/sdk/io/Read.java#L512&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/master/sdks/java/core/src/main/java/org/apache/beam/sdk/io/Read.java#L512&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The issue is manifested with java LoadTests on dataflow runner v2.&lt;/p&gt;

&lt;p&gt;Initial suspicion is that duplicate source readers for the same restriction and checkpoint were created by multiple UnboundedSourceAsSDFWrapperFns.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13443502">BEAM-14429</key>
            <summary>SyntheticUnboundedSource(with SDF) produce duplicate records when split with DEFAULT_DESIRED_NUM_SPLITS</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10101" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">P1</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yichi">Yichi Zhang</assignee>
                                    <reporter username="yichi">Yichi Zhang</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 May 2022 01:17:40 +0000</created>
                <updated>Thu, 12 May 2022 17:06:19 +0000</updated>
                            <resolved>Tue, 10 May 2022 23:10:06 +0000</resolved>
                                                    <fixVersion>2.40.0</fixVersion>
                                    <component>io-common</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="12600">3.5h</timespent>
                                <comments>
                            <comment id="17534067" author="chamikara" created="Tue, 10 May 2022 01:15:53 +0000"  >&lt;p&gt;We should fix this but seems like this source is only used by the following test ?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/beam/blob/95e9de7891593fa73d582cb6ba5ac0333b2675ff/sdks/java/testing/load-tests/src/main/java/org/apache/beam/sdk/loadtests/LoadTest.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/95e9de7891593fa73d582cb6ba5ac0333b2675ff/sdks/java/testing/load-tests/src/main/java/org/apache/beam/sdk/loadtests/LoadTest.java&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17534068" author="yichi" created="Tue, 10 May 2022 01:23:33 +0000"  >&lt;p&gt;It is probably used wherever read.unbounded is used &lt;a href=&quot;https://github.com/apache/beam/blob/bb1104a82878d5e3b48210089f6d00e9d460dfea/sdks/java/core/src/main/java/org/apache/beam/sdk/io/Read.java#L177&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/bb1104a82878d5e3b48210089f6d00e9d460dfea/sdks/java/core/src/main/java/org/apache/beam/sdk/io/Read.java#L177&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17534069" author="chamikara" created="Tue, 10 May 2022 01:28:15 +0000"  >&lt;p&gt;You mean for testing ? I don&apos;t think this source is used in the production code paths. It should be a configurable source that is primarily used for generating input for load tests.&lt;/p&gt;</comment>
                            <comment id="17534072" author="chamikara" created="Tue, 10 May 2022 01:42:46 +0000"  >&lt;p&gt;I see, you seems to suggest that this might be an issue with &quot;UnboundedSourceAsSDFWrapper&quot; not &quot;SyntheticUnboundedSource&quot;. Is there a smaller reproduction (other than the load test) ? I don&apos;t have much context on this but probably &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lcwik&quot; class=&quot;user-hover&quot; rel=&quot;lcwik&quot;&gt;lcwik&lt;/a&gt; can confirm.&lt;/p&gt;</comment>
                            <comment id="17534130" author="yichi" created="Tue, 10 May 2022 04:32:36 +0000"  >&lt;p&gt;I mainly just run one of the load test and check the the counters, the test normally run ~5 minutes&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
./gradlew -PloadTest.mainClass=org.apache.beam.sdk.loadtests.ParDoLoadTest -Prunner=:runners:google-cloud-dataflow-java &apos;-PloadTest.args=--project=apache-beam-testing --region=us-central1 --appName=load_tests_Java11_Dataflow_V2_streaming_ParDo_1 --tempLocation=gs:/
/zyichi_beam_test/temp --influxMeasurement=java_streaming_pardo_1 --influxTags={&lt;span class=&quot;code-quote&quot;&gt;&quot;runnerVersion&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;v2&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;jdk&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;java11&quot;&lt;/span&gt;} --publishToInfluxDB=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; --sourceOptions={&lt;span class=&quot;code-quote&quot;&gt;&quot;numRecords&quot;&lt;/span&gt;:20000000,&lt;span class=&quot;code-quote&quot;&gt;&quot;keySizeBytes&quot;&lt;/span&gt;:10,&lt;span class=&quot;code-quote&quot;&gt;&quot;valueSizeBytes&quot;&lt;/span&gt;:90} --iterations=10 --numberOfCounters=1 --numberOfCounterOperations=0 --numWorkers=5 --autoscalingAlgorithm=NONE --streaming=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; --inputWindowDurationSec=1200 --runner=DataflowRunner&apos; -Prunner.version=V2 -PcompileAndRunTestsWithJava11 -Pjava11Home=/usr/lib/jvm/java-11-openjdk-amd64 --&lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt; --max-workers=12 -Dorg.gradle.jvmargs=-Xms2g -Dorg.gradle.jvmargs=-Xmx4g -Dorg.gradle.vfs.watch=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; :sdks:java:testing:load-tests:run &#160; &#160; &#160; &#160; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160; &#160;&lt;/p&gt;</comment>
                            <comment id="17534410" author="lcwik" created="Tue, 10 May 2022 15:24:53 +0000"  >&lt;p&gt;Can you &lt;a href=&quot;https://github.com/apache/beam/blob/5c21fbccec5e1e831dd0040bd7f631c050865430/sdks/java/io/synthetic/src/main/java/org/apache/beam/sdk/io/synthetic/SyntheticUnboundedSource.java#L112&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;fix this log statement&lt;/a&gt; so we can see the result of the initial split. All I see right now is:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Split into 20 bundles of sizes: [org.apache.beam.sdk.io.synthetic.SyntheticUnboundedSource@1a0e6e3e, org.apache.beam.sdk.io.synthetic.SyntheticUnboundedSource@3d060183, org.apache.beam.sdk.io.synthetic.SyntheticUnboundedSource@413f3849, org.apache.beam.sdk.io.synthetic.SyntheticUnboundedSource@17e62ad8, org.apache.beam.sdk.io.synthetic.SyntheticUnboundedSource@7ef0d984, org.apache.beam.sdk.io.synthetic.SyntheticUnboundedSource@73f7d5c0, org.apache.beam.sdk.io.synthetic.SyntheticUnboundedSource@4b324687, org.apache.beam.sdk.io.synthetic.SyntheticUnboundedSource@6d2405d3, org.apache.beam.sdk.io.synthetic.SyntheticUnboundedSource@1560cd0a, org.apache.beam.sdk.io.synthetic.SyntheticUnboundedSource@587443b3, org.apache.beam.sdk.io.synthetic.SyntheticUnboundedSource@12b3044, org.apache.beam.sdk.io.synthetic.SyntheticUnboundedSource@4c6ca72f, org.apache.beam.sdk.io.synthetic.SyntheticUnboundedSource@5f773b35, org.apache.beam.sdk.io.synthetic.SyntheticUnboundedSource@25e482b3, org.apache.beam.sdk.io.synthetic.SyntheticUnboundedSource@7d152f5b, org.apache.beam.sdk.io.synthetic.SyntheticUnboundedSource@5469ba09, org.apache.beam.sdk.io.synthetic.SyntheticUnboundedSource@32219d22, org.apache.beam.sdk.io.synthetic.SyntheticUnboundedSource@335170cf, org.apache.beam.sdk.io.synthetic.SyntheticUnboundedSource@676afe09, org.apache.beam.sdk.io.synthetic.SyntheticUnboundedSource@7e4aa91f]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17534463" author="chamikara" created="Tue, 10 May 2022 16:41:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=johnjcasey&quot; class=&quot;user-hover&quot; rel=&quot;johnjcasey&quot;&gt;johnjcasey&lt;/a&gt; is looking into whether this is a release blocker.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lcwik&quot; class=&quot;user-hover&quot; rel=&quot;lcwik&quot;&gt;lcwik&lt;/a&gt; is UnboundedSourceAsSDFWrapper used by runners (for example Dataflow Runner v1 or Runner v2) currently in production for any critical sources (for example, KafkaIO) ?&lt;/p&gt;</comment>
                            <comment id="17534484" author="johnjcasey" created="Tue, 10 May 2022 17:15:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yichi&quot; class=&quot;user-hover&quot; rel=&quot;yichi&quot;&gt;yichi&lt;/a&gt; I can&apos;t get that command to run, I&apos;m getting ERROR: gcloud crashed (TypeError): a bytes-like object is required, not &apos;str&apos;. I&apos;m not sure how to proceed from here.&lt;/p&gt;</comment>
                            <comment id="17534506" author="lcwik" created="Tue, 10 May 2022 17:47:24 +0000"  >&lt;p&gt;It is used by portable runners (e.g. dataflow runner V2) for all unbounded sources (e.g. non SDF Kafka).&lt;/p&gt;</comment>
                            <comment id="17534541" author="yichi" created="Tue, 10 May 2022 19:06:41 +0000"  >&lt;p&gt;Looks like it is a problem of SyntheticUnboundedSource checkpoint, &lt;a href=&quot;https://github.com/apache/beam/pull/17600&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/17600&lt;/a&gt; to fix it.&#160;&lt;/p&gt;

&lt;p&gt;Removing from 2.39.0 blocking issue list.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1246g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>