<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:15:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-12044] JdbcIO should explicitly setAutoCommit to false</title>
                <link>https://issues.apache.org/jira/browse/BEAM-12044</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;Per &lt;a href=&quot;https://jdbc.postgresql.org/documentation/head/query.html#query-with-cursor&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PostgreSQL JDBC documentation&lt;/a&gt;, autocommit must be explicitly disabled on the connection to allow cursor streaming.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkff&quot; class=&quot;user-hover&quot; rel=&quot;jkff&quot;&gt;jkff&lt;/a&gt; mentionned it &lt;a href=&quot;https://www.mail-archive.com/dev@beam.apache.org/msg16808.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;on the mailing list&lt;/a&gt;, however even if there is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
poolableConnectionFactory.setDefaultAutoCommit(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;in JdbcIO:1555, currently, at least with JDBC driver 42.2.16, any read with JdbcIO will memoize the whole dataset (which leads to OOM), since &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
connection.getAutoCommit()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;returns true in JdbcIO#ReadFn#processElement.&lt;/p&gt;

&lt;p&gt;I can provide a PR &#8212; the patch is pretty simple (and solves the problem for us in 2.28.0):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (connection == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        connection = dataSource.getConnection();
}
connection.setAutoCommit(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;); &lt;span class=&quot;code-comment&quot;&gt;// line added&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</description>
                <environment></environment>
        <key id="13367196">BEAM-12044</key>
            <summary>JdbcIO should explicitly setAutoCommit to false</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sveyrie">Sylvain Veyri&#233;</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Mar 2021 09:41:46 +0000</created>
                <updated>Tue, 30 Mar 2021 18:54:39 +0000</updated>
                            <resolved>Sat, 27 Mar 2021 17:13:30 +0000</resolved>
                                    <version>2.28.0</version>
                                    <fixVersion>2.29.0</fixVersion>
                                    <component>sdk-java-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="10800">3h</timespent>
                                <comments>
                            <comment id="17307957" author="jkff" created="Wed, 24 Mar 2021 15:53:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sveyrie&quot; class=&quot;user-hover&quot; rel=&quot;sveyrie&quot;&gt;sveyrie&lt;/a&gt; Thanks! I no longer work on Beam, but am curious about this issue. Do I understand correctly that the Postgres driver ignores `poolableConnectionFactory.setDefaultAutoCommit(false);` and you need to explicitly `connection.setAutoCommit(false)`? That sounds like a very unlikely bug in the driver, so I suspect that something else is going on - either a bug in JdbcIO, or a bug in your pipeline.&lt;/p&gt;

&lt;p&gt;Could you give a code snippet of how you instantiate JdbcIO in your pipeline?&lt;/p&gt;</comment>
                            <comment id="17307970" author="sveyrie" created="Wed, 24 Mar 2021 16:03:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkff&quot; class=&quot;user-hover&quot; rel=&quot;jkff&quot;&gt;jkff&lt;/a&gt; it looks like it. I must admit I did not check if the block with setDefaultAutoCommit is actually executed.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We are using scio, hence the corresponding &lt;a href=&quot;https://github.com/spotify/scio/blob/2a297c055cd5d351441748f787345ddd3b34318d/scio-jdbc/src/main/scala/com/spotify/scio/jdbc/JdbcIO.scala&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JdbcIO Scala wrapper&lt;/a&gt;. If something is wrong there, I can bounce back to this project.&lt;/p&gt;</comment>
                            <comment id="17308322" author="jkff" created="Thu, 25 Mar 2021 03:16:28 +0000"  >&lt;p&gt;When glancing over the code it seems like the setDefaultAutoCommit line in beam JdbcIO actually is not executed - it&apos;s used only when you use PoolableDataSourceProvider, it&apos;s not used by default, and the scio JdbcIO isn&apos;t using it either.&lt;/p&gt;

&lt;p&gt;I think your proposed patch makes sense, please send a PR, thanks! Just please add a comment explaining why the connection must not be in autocommit mode. A link to the Postgres documentation might be good enough, as long as there are no other database engines requiring the connection to be &lt;b&gt;in&lt;/b&gt; autocommit mode to allow streaming, which seems unlikely.&lt;/p&gt;</comment>
                            <comment id="17308552" author="sveyrie" created="Thu, 25 Mar 2021 10:02:03 +0000"  >&lt;p&gt;Created &lt;a href=&quot;https://github.com/apache/beam/pull/14338&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/14338&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17308868" author="aromanenko" created="Thu, 25 Mar 2021 17:57:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sveyrie&quot; class=&quot;user-hover&quot; rel=&quot;sveyrie&quot;&gt;sveyrie&lt;/a&gt; Isn&apos;t it possible to change this property (I guess it should be something like &lt;tt&gt;autoCommit=false&lt;/tt&gt;) via connection properties for your &lt;tt&gt;DataSourceConfiguration&lt;/tt&gt; that is used to create a &lt;tt&gt;DataSource&lt;/tt&gt; further?&#160;&lt;/p&gt;</comment>
                            <comment id="17308870" author="jkff" created="Thu, 25 Mar 2021 18:05:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aromanenko&quot; class=&quot;user-hover&quot; rel=&quot;aromanenko&quot;&gt;aromanenko&lt;/a&gt; my take: it is possible, but I think Sylvain&apos;s PR improves the default behavior for all users, so we should do it by default. Because this is in JdbcIO.read(), there are no commits happening anyway, so this should be purely a performance improvement with no semantic changes.&lt;/p&gt;

&lt;p&gt;Actually there&apos;s one possible caveat that I&apos;ll mention on the PR in a moment.&lt;/p&gt;</comment>
                            <comment id="17308878" author="aromanenko" created="Thu, 25 Mar 2021 18:14:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkff&quot; class=&quot;user-hover&quot; rel=&quot;jkff&quot;&gt;jkff&lt;/a&gt;&#160;Ok, then I don&apos;t see any objectives to make it by default except if it will be potentially needed to set to &lt;tt&gt;true&lt;/tt&gt; for some reasons that are unknown for now considering that it&apos;s happening in the Read part, as you mentioned before.&lt;/p&gt;</comment>
                            <comment id="17309566" author="sveyrie" created="Fri, 26 Mar 2021 17:11:41 +0000"  >&lt;p&gt;Updated PR: &lt;a href=&quot;https://github.com/apache/beam/pull/14349&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/14349&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 33 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0p4j4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>