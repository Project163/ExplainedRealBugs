<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:08:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-9801] Setting a timer from a timer callback fails</title>
                <link>https://issues.apache.org/jira/browse/BEAM-9801</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I&apos;m trying to set a timer from a timer callback in the Python SDK:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;GenerateLoad(beam.DoFn):
  timer_spec = userstate.TimerSpec(&lt;span class=&quot;code-quote&quot;&gt;&apos;timer&apos;&lt;/span&gt;, userstate.TimeDomain.WATERMARK)

  &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; process(&lt;span class=&quot;code-keyword&quot;&gt;self&lt;/span&gt;, element, timer=beam.DoFn.TimerParam(timer_spec)):
    &lt;span class=&quot;code-keyword&quot;&gt;self&lt;/span&gt;.key = element[0]
    timer.&lt;span class=&quot;code-object&quot;&gt;set&lt;/span&gt;(0)

  @userstate.on_timer(timer_spec)
  &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; process_timer(&lt;span class=&quot;code-keyword&quot;&gt;self&lt;/span&gt;, timer=beam.DoFn.TimerParam(timer_spec)):
    timer.&lt;span class=&quot;code-object&quot;&gt;set&lt;/span&gt;(0)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This yields the following Python stack trace:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;INFO:apache_beam.utils.subprocess_server:Caused by: java.lang.RuntimeException: Error received from SDK harness for instruction 4: Traceback (most recent call last):
INFO:apache_beam.utils.subprocess_server: File &quot;apache_beam/runners/worker/sdk_worker.py&quot;, line 245, in _execute
INFO:apache_beam.utils.subprocess_server: response = task()
INFO:apache_beam.utils.subprocess_server: File &quot;apache_beam/runners/worker/sdk_worker.py&quot;, line 302, in &amp;lt;lambda&amp;gt;
INFO:apache_beam.utils.subprocess_server: lambda: self.create_worker().do_instruction(request), request)
INFO:apache_beam.utils.subprocess_server: File &quot;apache_beam/runners/worker/sdk_worker.py&quot;, line 471, in do_instruction
INFO:apache_beam.utils.subprocess_server: getattr(request, request_type), request.instruction_id)
INFO:apache_beam.utils.subprocess_server: File &quot;apache_beam/runners/worker/sdk_worker.py&quot;, line 506, in process_bundle
INFO:apache_beam.utils.subprocess_server: bundle_processor.process_bundle(instruction_id))
INFO:apache_beam.utils.subprocess_server: File &quot;apache_beam/runners/worker/bundle_processor.py&quot;, line 910, in process_bundle
INFO:apache_beam.utils.subprocess_server: element.timer_family_id, timer_data)
INFO:apache_beam.utils.subprocess_server: File &quot;apache_beam/runners/worker/operations.py&quot;, line 688, in process_timer
INFO:apache_beam.utils.subprocess_server: timer_data.fire_timestamp)
INFO:apache_beam.utils.subprocess_server: File &quot;apache_beam/runners/common.py&quot;, line 990, in process_user_timer
INFO:apache_beam.utils.subprocess_server: self._reraise_augmented(exn)
INFO:apache_beam.utils.subprocess_server: File &quot;apache_beam/runners/common.py&quot;, line 1043, in _reraise_augmented
INFO:apache_beam.utils.subprocess_server: raise_with_traceback(new_exn)
INFO:apache_beam.utils.subprocess_server: File &quot;apache_beam/runners/common.py&quot;, line 988, in process_user_timer
INFO:apache_beam.utils.subprocess_server: self.do_fn_invoker.invoke_user_timer(timer_spec, key, window, timestamp)
INFO:apache_beam.utils.subprocess_server: File &quot;apache_beam/runners/common.py&quot;, line 517, in invoke_user_timer
INFO:apache_beam.utils.subprocess_server: self.user_state_context, key, window, timestamp))
INFO:apache_beam.utils.subprocess_server: File &quot;apache_beam/runners/common.py&quot;, line 1093, in process_outputs
INFO:apache_beam.utils.subprocess_server: for result in results:
INFO:apache_beam.utils.subprocess_server: File &quot;/Users/max/Dev/beam/sdks/python/apache_beam/testing/load_tests/pardo_test.py&quot;, line 185, in process_timer
INFO:apache_beam.utils.subprocess_server: timer.set(0)
INFO:apache_beam.utils.subprocess_server: File &quot;apache_beam/runners/worker/bundle_processor.py&quot;, line 589, in set
INFO:apache_beam.utils.subprocess_server: self._timer_coder_impl.encode_to_stream(timer, self._output_stream, True)
INFO:apache_beam.utils.subprocess_server: File &quot;apache_beam/coders/coder_impl.py&quot;, line 651, in encode_to_stream
INFO:apache_beam.utils.subprocess_server: value.hold_timestamp, out, True)
INFO:apache_beam.utils.subprocess_server: File &quot;apache_beam/coders/coder_impl.py&quot;, line 608, in encode_to_stream
INFO:apache_beam.utils.subprocess_server: millis = value.micros // 1000
INFO:apache_beam.utils.subprocess_server:AttributeError: &apos;NoneType&apos; object has no attribute &apos;micros&apos; [while running &apos;GenerateLoad&apos;]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Looking at the code base, I&apos;m not sure we have tests for timer output timestamps. Am I missing something?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13300297">BEAM-9801</key>
            <summary>Setting a timer from a timer callback fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10101" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">P1</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mxm">Maximilian Michels</assignee>
                                    <reporter username="mxm">Maximilian Michels</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Apr 2020 15:12:16 +0000</created>
                <updated>Sat, 16 May 2020 13:30:40 +0000</updated>
                            <resolved>Mon, 4 May 2020 09:04:07 +0000</resolved>
                                                    <fixVersion>2.21.0</fixVersion>
                                    <component>sdk-py-harness</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="44400">12h 20m</timespent>
                                <comments>
                            <comment id="17091117" author="kenn" created="Fri, 24 Apr 2020 02:57:45 +0000"  >&lt;p&gt;This seems more severe than your usual bug, no?&lt;/p&gt;</comment>
                            <comment id="17091373" author="mxm" created="Fri, 24 Apr 2020 09:24:26 +0000"  >&lt;p&gt;Yes, I agree that this earns the &quot;critical&quot; badge.&lt;/p&gt;</comment>
                            <comment id="17091513" author="mxm" created="Fri, 24 Apr 2020 12:21:26 +0000"  >&lt;p&gt;I&apos;m also putting it up for debate whether to hold the 2.21.0 release until this is fixed. Mitigation is in the PR.&lt;/p&gt;</comment>
                            <comment id="17094725" author="robertwb" created="Tue, 28 Apr 2020 17:51:24 +0000"  >&lt;p&gt;Is this a regression, or something that never worked?&lt;/p&gt;</comment>
                            <comment id="17094864" author="mxm" created="Tue, 28 Apr 2020 20:33:32 +0000"  >&lt;p&gt;I&apos;m not sure if it was working at some point and broke due to introducing new features. It appears to be untested, so it likely never worked. It was relatively easy to fix though, see the PR.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 28 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0dya8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>