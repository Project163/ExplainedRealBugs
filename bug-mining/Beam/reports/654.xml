<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:50:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-4832] Concurrent Writes in Data channels</title>
                <link>https://issues.apache.org/jira/browse/BEAM-4832</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;A user was having issue with streaming Go pipelines on Dataflow. Investigation yeilded the panic below, which triggered concurrent modifications of the data channel maps.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The fix is properly guarding all writes to the Data channel maps, in particular:&lt;/p&gt;

&lt;p&gt;&#160;&lt;br/&gt;
func (&lt;a href=&quot;https://cs.corp.google.com/piper///depot/google3/third_party/golang/apache_beam/pkg/beam/core/runtime/harness/datamgr.go?l=212&amp;amp;gs=kythe%253A%252F%252Fgoogle3%253Flang%253Dgo%253Fpath%253Dthird_party%252Fgolang%252Fapache_beam%252Fpkg%252Fbeam%252Fcore%252Fruntime%252Fharness%252Fharness%2523param%252520DataChannel.removeReader%25253Ac&amp;amp;gsn=c&amp;amp;ct=xref_usages&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;c&lt;/a&gt; *&lt;a href=&quot;https://cs.corp.google.com/piper///depot/google3/third_party/golang/apache_beam/pkg/beam/core/runtime/harness/datamgr.go?l=87&amp;amp;ct=xref_jump_to_def&amp;amp;gsn=DataChannel&amp;amp;rcl=205012539&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;DataChannel&lt;/a&gt;) &lt;a href=&quot;https://cs.corp.google.com/piper///depot/google3/third_party/golang/apache_beam/pkg/beam/core/runtime/harness/datamgr.go?l=212&amp;amp;gs=kythe%253A%252F%252Fgoogle3%253Flang%253Dgo%253Fpath%253Dthird_party%252Fgolang%252Fapache_beam%252Fpkg%252Fbeam%252Fcore%252Fruntime%252Fharness%252Fharness%2523method%252520DataChannel.removeReader&amp;amp;gsn=removeReader&amp;amp;ct=xref_usages&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;removeReader&lt;/a&gt;([id|https://cs.corp.google.com/piper///depot/google3/third_party/golang/apache_beam/pkg/beam/core/runtime/harness/datamgr.go?l=212&amp;amp;gs=kythe%253A%252F%252Fgoogle3%253Flang%253Dgo%253Fpath%253Dthird_party%252Fgolang%252Fapache_beam%252Fpkg%252Fbeam%252Fcore%252Fruntime%252Fharness%252Fharness%2523param%252520DataChannel.removeReader%25253Aid&amp;amp;gsn=id&amp;amp;ct=xref_usages] string) &lt;/p&gt;
{	delete([c|https://cs.corp.google.com/piper///depot/google3/third_party/golang/apache_beam/pkg/beam/core/runtime/harness/datamgr.go?l=212&amp;amp;ct=xref_jump_to_def&amp;amp;gsn=c&amp;amp;rcl=205012539].[readers|https://cs.corp.google.com/piper///depot/google3/third_party/golang/apache_beam/pkg/beam/core/runtime/harness/datamgr.go?l=93&amp;amp;ct=xref_jump_to_def&amp;amp;gsn=readers&amp;amp;rcl=205012539], [id|https://cs.corp.google.com/piper///depot/google3/third_party/golang/apache_beam/pkg/beam/core/runtime/harness/datamgr.go?l=212&amp;amp;ct=xref_jump_to_def&amp;amp;gsn=id&amp;amp;rcl=205012539])}
&lt;p&gt;Should be&lt;br/&gt;
&#160;&lt;br/&gt;
func (&lt;a href=&quot;https://cs.corp.google.com/piper///depot/google3/third_party/golang/apache_beam/pkg/beam/core/runtime/harness/datamgr.go?l=212&amp;amp;gs=kythe%253A%252F%252Fgoogle3%253Flang%253Dgo%253Fpath%253Dthird_party%252Fgolang%252Fapache_beam%252Fpkg%252Fbeam%252Fcore%252Fruntime%252Fharness%252Fharness%2523param%252520DataChannel.removeReader%25253Ac&amp;amp;gsn=c&amp;amp;ct=xref_usages&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;c&lt;/a&gt; *&lt;a href=&quot;https://cs.corp.google.com/piper///depot/google3/third_party/golang/apache_beam/pkg/beam/core/runtime/harness/datamgr.go?l=87&amp;amp;ct=xref_jump_to_def&amp;amp;gsn=DataChannel&amp;amp;rcl=205012539&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;DataChannel&lt;/a&gt;) &lt;a href=&quot;https://cs.corp.google.com/piper///depot/google3/third_party/golang/apache_beam/pkg/beam/core/runtime/harness/datamgr.go?l=212&amp;amp;gs=kythe%253A%252F%252Fgoogle3%253Flang%253Dgo%253Fpath%253Dthird_party%252Fgolang%252Fapache_beam%252Fpkg%252Fbeam%252Fcore%252Fruntime%252Fharness%252Fharness%2523method%252520DataChannel.removeReader&amp;amp;gsn=removeReader&amp;amp;ct=xref_usages&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;removeReader&lt;/a&gt;([id|https://cs.corp.google.com/piper///depot/google3/third_party/golang/apache_beam/pkg/beam/core/runtime/harness/datamgr.go?l=212&amp;amp;gs=kythe%253A%252F%252Fgoogle3%253Flang%253Dgo%253Fpath%253Dthird_party%252Fgolang%252Fapache_beam%252Fpkg%252Fbeam%252Fcore%252Fruntime%252Fharness%252Fharness%2523param%252520DataChannel.removeReader%25253Aid&amp;amp;gsn=id&amp;amp;ct=xref_usages] string) &lt;/p&gt;
{  [c|https://cs.corp.google.com/piper///depot/google3/third_party/golang/apache_beam/pkg/beam/core/runtime/harness/datamgr.go?l=198&amp;amp;ct=xref_jump_to_def&amp;amp;gsn=c&amp;amp;rcl=205012539].[mu|https://cs.corp.google.com/piper///depot/google3/third_party/golang/apache_beam/pkg/beam/core/runtime/harness/datamgr.go?l=96&amp;amp;ct=xref_jump_to_def&amp;amp;gsn=mu&amp;amp;rcl=205012539].[Lock|https://cs.corp.google.com/piper///depot/google3/third_party/go/gc/src/sync/mutex.go?l=72&amp;amp;ct=xref_jump_to_def&amp;amp;gsn=Lock&amp;amp;rcl=205012539]()
  delete([c|https://cs.corp.google.com/piper///depot/google3/third_party/golang/apache_beam/pkg/beam/core/runtime/harness/datamgr.go?l=212&amp;amp;ct=xref_jump_to_def&amp;amp;gsn=c&amp;amp;rcl=205012539].[readers|https://cs.corp.google.com/piper///depot/google3/third_party/golang/apache_beam/pkg/beam/core/runtime/harness/datamgr.go?l=93&amp;amp;ct=xref_jump_to_def&amp;amp;gsn=readers&amp;amp;rcl=205012539], [id|https://cs.corp.google.com/piper///depot/google3/third_party/golang/apache_beam/pkg/beam/core/runtime/harness/datamgr.go?l=212&amp;amp;ct=xref_jump_to_def&amp;amp;gsn=id&amp;amp;rcl=205012539])
  [c|https://cs.corp.google.com/piper///depot/google3/third_party/golang/apache_beam/pkg/beam/core/runtime/harness/datamgr.go?l=198&amp;amp;ct=xref_jump_to_def&amp;amp;gsn=c&amp;amp;rcl=205012539].[mu|https://cs.corp.google.com/piper///depot/google3/third_party/golang/apache_beam/pkg/beam/core/runtime/harness/datamgr.go?l=96&amp;amp;ct=xref_jump_to_def&amp;amp;gsn=mu&amp;amp;rcl=205012539].[Unlock|https://cs.corp.google.com/piper///depot/google3/third_party/go/gc/src/sync/mutex.go?l=175&amp;amp;ct=xref_jump_to_def&amp;amp;gsn=Unlock&amp;amp;rcl=205012539]()
}
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I fatal error: concurrent map writes &lt;br/&gt;
 I &lt;br/&gt;
 I goroutine 3277 &lt;span class=&quot;error&quot;&gt;&amp;#91;running&amp;#93;&lt;/span&gt;: &lt;br/&gt;
 I runtime.throw(0xf880d0, 0x15) &lt;br/&gt;
 I GOROOT/src/runtime/panic.go:616 +0x81 fp=0xc4212eb6d8 sp=0xc4212eb6b8 pc=0x42be31 &lt;br/&gt;
 I runtime.mapdelete_faststr(0xe18160, 0xc4202ba7b0, 0xc4213dc0e0, 0x20) &lt;br/&gt;
 I GOROOT/src/runtime/hashmap_fast.go:892 +0x28d fp=0xc4212eb738 sp=0xc4212eb6d8 pc=0x40e45d &lt;br/&gt;
 I google/vendor/github.com/apache/beam/sdks/go/pkg/beam/core/runtime/harness.(*DataChannel).removeReader(...) &lt;br/&gt;
 I vendor/github.com/apache/beam/sdks/go/pkg/beam/core/runtime/harness/datamgr.go:213 &lt;br/&gt;
 I google/vendor/github.com/apache/beam/sdks/go/pkg/beam/core/runtime/harness.(*dataReader).Close(0xc420ba8c80, 0xc42031e0c0, 0xf) &lt;br/&gt;
 I vendor/github.com/apache/beam/sdks/go/pkg/beam/core/runtime/harness/datamgr.go:241 +0x6e fp=0xc4212eb768 sp=0xc4212eb738 pc=0xc5059e &lt;br/&gt;
 I google/vendor/github.com/apache/beam/sdks/go/pkg/beam/core/runtime/exec.(*DataSource).Process(0xc4203ae540, 0x10708c0, 0xc420464e70, 0x0, 0x0) &lt;br/&gt;
 I vendor/github.com/apache/beam/sdks/go/pkg/beam/core/runtime/exec/datasource.go:156 +0x1302 fp=0xc4212ebbd8 sp=0xc4212eb768 pc=0x894612 &lt;br/&gt;
 I google/vendor/github.com/apache/beam/sdks/go/pkg/beam/core/runtime/exec.(Root).Process-fm(0x10708c0, 0xc420464e70, 0xc420b7bc58, 0x0) &lt;br/&gt;
 I vendor/github.com/apache/beam/sdks/go/pkg/beam/core/runtime/exec/plan.go:112 +0x43 fp=0xc4212ebc10 sp=0xc4212ebbd8 pc=0x8a4c23 &lt;br/&gt;
 I google/vendor/github.com/apache/beam/sdks/go/pkg/beam/core/runtime/exec.callNoPanic(0x10708c0, 0xc420464e70, 0xc420b7bcc8, 0x0, 0x0) &lt;br/&gt;
 I vendor/github.com/apache/beam/sdks/go/pkg/beam/core/runtime/exec/util.go:42 +0x6c fp=0xc4212ebc40 sp=0xc4212ebc10 pc=0x8a37ac &lt;br/&gt;
 I google/vendor/github.com/apache/beam/sdks/go/pkg/beam/core/runtime/exec.(*Plan).Execute(0xc420030770, 0x10708c0, 0xc420464e70, 0xc4201a85e8, 0x5, 0x1064720, 0xc4202097e0, 0xfb5320, 0xc4206ff940) &lt;br/&gt;
 I vendor/github.com/apache/beam/sdks/go/pkg/beam/core/runtime/exec/plan.go:112 +0x3bd fp=0xc4212ebd58 sp=0xc4212ebc40 pc=0x89d4ed &lt;br/&gt;
 I google/vendor/github.com/apache/beam/sdks/go/pkg/beam/core/runtime/harness.(*control).handleInstruction(0xc4201a7820, 0x10708c0, 0xc420464e10, 0xc420d5e340, 0xc420038018) &lt;br/&gt;
 I vendor/github.com/apache/beam/sdks/go/pkg/beam/core/runtime/harness/harness.go:193 +0x729 fp=0xc4212ebf40 sp=0xc4212ebd58 pc=0xc51ef9 &lt;br/&gt;
 I google/vendor/github.com/apache/beam/sdks/go/pkg/beam/core/runtime/harness.Main.func2(0x1070840, 0xc420038018, 0xc420d5e340) &lt;br/&gt;
 I vendor/github.com/apache/beam/sdks/go/pkg/beam/core/runtime/harness/harness.go:113 +0x167 fp=0xc4212ebfc8 sp=0xc4212ebf40 pc=0xc54b17 &lt;br/&gt;
 I runtime.goexit() &lt;br/&gt;
 I bazel-out/k8-fastbuild/bin/external/io_bazel_rules_go/linux_amd64_stripped/stdlib~/src/runtime/asm_amd64.s:2361 +0x1 fp=0xc4212ebfd0 sp=0xc4212ebfc8 pc=0x45a591 &lt;br/&gt;
 I created by google/vendor/github.com/apache/beam/sdks/go/pkg/beam/core/runtime/harness.Main &lt;br/&gt;
 I vendor/github.com/apache/beam/sdks/go/pkg/beam/core/runtime/harness/harness.go:126 +0x5cc &lt;br/&gt;
 I&lt;/p&gt;</description>
                <environment></environment>
        <key id="13173294">BEAM-4832</key>
            <summary>Concurrent Writes in Data channels</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lostluck">Robert Burke</assignee>
                                    <reporter username="lostluck">Robert Burke</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Jul 2018 20:24:54 +0000</created>
                <updated>Fri, 24 Jul 2020 20:10:56 +0000</updated>
                            <resolved>Tue, 24 Jul 2018 16:01:11 +0000</resolved>
                                                    <fixVersion>Not applicable</fixVersion>
                                    <component>sdk-go</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="16550056" author="wcn3" created="Fri, 20 Jul 2018 00:19:58 +0000"  >&lt;p&gt;The comments for the mutex should indicate that it protects the readers and writers maps. That will help future reviewers maintain the locking invariants.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 17 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3w347:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>