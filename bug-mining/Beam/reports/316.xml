<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:44:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-2277] IllegalArgumentException when using Hadoop file system for WordCount example.</title>
                <link>https://issues.apache.org/jira/browse/BEAM-2277</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;IllegalArgumentException when using Hadoop file system for WordCount example.&lt;/p&gt;

&lt;p&gt;Occurred when running WordCount example using Spark runner on a YARN cluster.&lt;/p&gt;

&lt;p&gt;Command-line arguments:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-none&quot;&gt;--runner=SparkRunner --inputFile=hdfs:///user/myuser/kinglear.txt --output=hdfs:///user/myuser/wc/wc
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Stack trace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-none&quot;&gt;java.lang.IllegalArgumentException: Expect srcResourceIds and destResourceIds have the same scheme, but received file, hdfs.
	at org.apache.beam.sdk.repackaged.com.google.common.base.Preconditions.checkArgument(Preconditions.java:122)
	at org.apache.beam.sdk.io.FileSystems.validateSrcDestLists(FileSystems.java:394)
	at org.apache.beam.sdk.io.FileSystems.copy(FileSystems.java:236)
	at org.apache.beam.sdk.io.FileBasedSink$WriteOperation.copyToOutputFiles(FileBasedSink.java:626)
	at org.apache.beam.sdk.io.FileBasedSink$WriteOperation.finalize(FileBasedSink.java:516)
	at org.apache.beam.sdk.io.WriteFiles$2.processElement(WriteFiles.java:592)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13071505">BEAM-2277</key>
            <summary>IllegalArgumentException when using Hadoop file system for WordCount example.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10100" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">P0</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aviemzur">Aviem Zur</assignee>
                                    <reporter username="aviemzur">Aviem Zur</reporter>
                        <labels>
                    </labels>
                <created>Fri, 12 May 2017 11:05:06 +0000</created>
                <updated>Sat, 16 May 2020 14:21:08 +0000</updated>
                            <resolved>Fri, 24 Aug 2018 21:19:37 +0000</resolved>
                                    <version>2.6.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>2.7.0</fixVersion>
                                    <component>io-java-hadoop-file-system</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="16008091" author="githubbot" created="Fri, 12 May 2017 13:03:43 +0000"  >&lt;p&gt;GitHub user aviemzur opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/3115&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3115&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-2277&quot; title=&quot;IllegalArgumentException when using Hadoop file system for WordCount example.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-2277&quot;&gt;&lt;del&gt;BEAM-2277&lt;/del&gt;&lt;/a&gt; Fix URI_SCHEME_PATTERN in FileSystems&lt;/p&gt;

&lt;p&gt;    Be sure to do all of the following to help us incorporate your contribution&lt;br/&gt;
    quickly and easily:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Make sure the PR title is formatted like:&lt;br/&gt;
       `&lt;a href=&quot;#&amp;gt;&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;BEAM-&amp;lt;Jira issue #&amp;gt;&lt;/a&gt; Description of pull request`&lt;/li&gt;
	&lt;li&gt;[ ] Make sure tests pass via `mvn clean verify`.&lt;/li&gt;
	&lt;li&gt;[ ] Replace `&amp;lt;Jira issue #&amp;gt;` in the title with the actual Jira issue&lt;br/&gt;
           number, if there is one.&lt;/li&gt;
	&lt;li&gt;[ ] If this contribution is large, please file an Apache&lt;br/&gt;
           &lt;span class=&quot;error&quot;&gt;&amp;#91;Individual Contributor License Agreement&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.apache.org/licenses/icla.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.apache.org/licenses/icla.pdf&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    &amp;#8212;&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/aviemzur/beam&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/aviemzur/beam&lt;/a&gt; fix-uri-scheme-pattern-in-filesystems&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/3115.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3115.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3115&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit ca05ed560888a2f2a86442b89e23fb7f49e1acfd&lt;br/&gt;
Author: Aviem Zur &amp;lt;aviemzur@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-05-12T13:02:54Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-2277&quot; title=&quot;IllegalArgumentException when using Hadoop file system for WordCount example.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-2277&quot;&gt;&lt;del&gt;BEAM-2277&lt;/del&gt;&lt;/a&gt; Fix URI_SCHEME_PATTERN in FileSystems&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16008328" author="githubbot" created="Fri, 12 May 2017 16:22:38 +0000"  >&lt;p&gt;GitHub user dhalperi opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/3121&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3121&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-2277&quot; title=&quot;IllegalArgumentException when using Hadoop file system for WordCount example.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-2277&quot;&gt;&lt;del&gt;BEAM-2277&lt;/del&gt;&lt;/a&gt; Add ResourceIdTester and test existing ResourceId implementations&lt;/p&gt;

&lt;p&gt;    A first cut at some of the parts of the ResourceId spec.&lt;/p&gt;

&lt;p&gt;    Not expected to pass precommit or review, but would be good to have some eyes on it.&lt;/p&gt;

&lt;p&gt;    CC: @lukecwik @aviemzur @peihe &lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/dhalperi/beam&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dhalperi/beam&lt;/a&gt; b2277-resourceid-tester&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/3121.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3121.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3121&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit e258d553ed28f3eb8bc21ddada23c5435e723d92&lt;br/&gt;
Author: Dan Halperin &amp;lt;dhalperi@google.com&amp;gt;&lt;br/&gt;
Date:   2017-05-12T16:20:34Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-2277&quot; title=&quot;IllegalArgumentException when using Hadoop file system for WordCount example.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-2277&quot;&gt;&lt;del&gt;BEAM-2277&lt;/del&gt;&lt;/a&gt; Add ResourceIdTester and test existing ResourceId implementations&lt;/p&gt;

&lt;p&gt;    A first cut at some of the parts of the ResourceId spec.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16008367" author="lcwik" created="Fri, 12 May 2017 16:47:11 +0000"  >&lt;p&gt;The issue with the design is that internal portions of FileBasedSource/FileBasedSink expect that string equality and sorting is equivalent to the &quot;ResourceId&quot; equality and sorting which is incorrect since URIs &lt;a href=&quot;file:/my/pAth&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/my/pAth&lt;/a&gt; and &lt;a href=&quot;file:///my/pAth&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:///my/pAth&lt;/a&gt; and &lt;a href=&quot;file:///my/p%41th&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:///my/p%41th&lt;/a&gt; are all the same yet string versions would not encompass this. This would require our code that uses these strings to go through a URI normalizer.&lt;/p&gt;</comment>
                            <comment id="16008503" author="githubbot" created="Fri, 12 May 2017 18:11:17 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/3115&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3115&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16008780" author="githubbot" created="Fri, 12 May 2017 21:59:39 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/3121&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3121&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16008786" author="githubbot" created="Fri, 12 May 2017 22:03:04 +0000"  >&lt;p&gt;GitHub user dhalperi opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/3129&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3129&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-2277&quot; title=&quot;IllegalArgumentException when using Hadoop file system for WordCount example.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-2277&quot;&gt;&lt;del&gt;BEAM-2277&lt;/del&gt;&lt;/a&gt; Cherrypick #3121 to release-2.0.0&lt;/p&gt;

&lt;p&gt;    fbb0de129d Remove &apos;/&apos; entirely from determining FileSystem scheme&lt;br/&gt;
    a6a5ff7be3 &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-2277&quot; title=&quot;IllegalArgumentException when using Hadoop file system for WordCount example.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-2277&quot;&gt;&lt;del&gt;BEAM-2277&lt;/del&gt;&lt;/a&gt; Add ResourceIdTester and test existing ResourceId implementations&lt;br/&gt;
    ec956c85ef Mark FileSystem and related as Experimental&lt;br/&gt;
    15df211c75 &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-2277&quot; title=&quot;IllegalArgumentException when using Hadoop file system for WordCount example.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-2277&quot;&gt;&lt;del&gt;BEAM-2277&lt;/del&gt;&lt;/a&gt; HadoopFileSystem: normalize implementation&lt;br/&gt;
    f3540d47f1 Rename FileSystems.setDefaultConfigInWorkers&lt;br/&gt;
    3921163829 Fix shading of guava testlib&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/dhalperi/beam&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dhalperi/beam&lt;/a&gt; cp3121&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/3129.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3129.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3129&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 8aa4a8a9b06bf1c356fc0686b26c1ea5d9983ffb&lt;br/&gt;
Author: Dan Halperin &amp;lt;dhalperi@google.com&amp;gt;&lt;br/&gt;
Date:   2017-05-12T21:59:14Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-2277&quot; title=&quot;IllegalArgumentException when using Hadoop file system for WordCount example.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-2277&quot;&gt;&lt;del&gt;BEAM-2277&lt;/del&gt;&lt;/a&gt; Cherrypick #3121 to release-2.0.0&lt;/p&gt;

&lt;p&gt;    fbb0de129d Remove &apos;/&apos; entirely from determining FileSystem scheme&lt;br/&gt;
    a6a5ff7be3 &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-2277&quot; title=&quot;IllegalArgumentException when using Hadoop file system for WordCount example.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-2277&quot;&gt;&lt;del&gt;BEAM-2277&lt;/del&gt;&lt;/a&gt; Add ResourceIdTester and test existing ResourceId implementations&lt;br/&gt;
    ec956c85ef Mark FileSystem and related as Experimental&lt;br/&gt;
    15df211c75 &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-2277&quot; title=&quot;IllegalArgumentException when using Hadoop file system for WordCount example.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-2277&quot;&gt;&lt;del&gt;BEAM-2277&lt;/del&gt;&lt;/a&gt; HadoopFileSystem: normalize implementation&lt;br/&gt;
    f3540d47f1 Rename FileSystems.setDefaultConfigInWorkers&lt;br/&gt;
    3921163829 Fix shading of guava testlib&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16008787" author="githubbot" created="Fri, 12 May 2017 22:04:14 +0000"  >&lt;p&gt;Github user dhalperi closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/3129&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/3129&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16008904" author="dhalperi@google.com" created="Fri, 12 May 2017 23:30:27 +0000"  >&lt;p&gt;Using the latest version on relesae-2.0.0 branch (6931219d8725ad90f6b18b1bf8219d5adb10ff8a) after I successfully ran this using an archetype-generated copy of the examples:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;gcloud dataproc jobs submit spark --cluster jasonkuster-test1-0 --properties spark.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.parallelism=200 --&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.beam.examples.WordCount --jars ./target/java-0.1.jar -- --runner=SparkRunner --inputFile=hdfs:&lt;span class=&quot;code-comment&quot;&gt;///home/dhalperi-hdfs/words.txt --output=hdfs:///home/dhalperi-hdfs/output-&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;dhalperi@jasonkuster-test1-0-m:~$ hadoop fs -cat /home/dhalperi-hdfs/words.txt
17/05/12 23:27:47 INFO gcs.GoogleHadoopFileSystemBase: GHFS version: 1.5.5-hadoop2
a
b
c
d
e
f
dhalperi@jasonkuster-test1-0-m:~$ hadoop fs -cat /home/dhalperi-hdfs/
/home/dhalperi-hdfs/output--00000-of-00006             /home/dhalperi-hdfs/output--00004-of-00006
/home/dhalperi-hdfs/output--00001-of-00006             /home/dhalperi-hdfs/output--00005-of-00006
/home/dhalperi-hdfs/output--00002-of-00006             /home/dhalperi-hdfs/.temp-beam-2017-05-132_23-26-39-0
/home/dhalperi-hdfs/output--00003-of-00006             /home/dhalperi-hdfs/words.txt
dhalperi@jasonkuster-test1-0-m:~$ hadoop fs -cat /home/dhalperi-hdfs/output*
17/05/12 23:28:05 INFO gcs.GoogleHadoopFileSystemBase: GHFS version: 1.5.5-hadoop2
a: 1
e: 1
d: 1
b: 1
f: 1
c: 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(Notice the double &lt;tt&gt;--&lt;/tt&gt; in output file names is my fault.)&lt;/p&gt;</comment>
                            <comment id="16483997" author="jcgarciam" created="Tue, 22 May 2018 14:01:27 +0000"  >&lt;p&gt;It looks like this problem is either not 100% fixed or there is a regression in&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;beam.version&amp;gt;2.4.0&amp;lt;/beam.version&amp;gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Testing the &lt;b&gt;WindowedWordCount&lt;/b&gt;&#160;from the word-count-beam example failed with&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;18/05/22 15:53:49 ERROR executor.Executor: Exception in task 3.2 in stage 4.0 (TID 21)
org.apache.beam.sdk.util.UserCodeException: java.lang.IllegalArgumentException: Expect srcResourceIds and destResourceIds have the same scheme, but received hdfs, example-counts-windo-14.
at org.apache.beam.sdk.util.UserCodeException.wrap(UserCodeException.java:36)
at org.apache.beam.sdk.io.WriteFiles$FinalizeTempFileBundles$FinalizeFn$DoFnInvoker.invokeProcessElement(Unknown Source)
at org.apache.beam.runners.core.SimpleDoFnRunner.invokeProcessElement(SimpleDoFnRunner.java:177)
at org.apache.beam.runners.core.SimpleDoFnRunner.processElement(SimpleDoFnRunner.java:141)
at org.apache.beam.runners.spark.translation.DoFnRunnerWithMetrics.processElement(DoFnRunnerWithMetrics.java:64)
at org.apache.beam.runners.spark.translation.SparkProcessContext$ProcCtxtIterator.computeNext(SparkProcessContext.java:145)
at org.apache.beam.runners.spark.repackaged.com.google.common.collect.AbstractIterator.tryToComputeNext(AbstractIterator.java:145)
at org.apache.beam.runners.spark.repackaged.com.google.common.collect.AbstractIterator.hasNext(AbstractIterator.java:140)
at scala.collection.convert.Wrappers$JIteratorWrapper.hasNext(Wrappers.scala:42)
at scala.collection.Iterator$$anon$13.hasNext(Iterator.scala:461)
at scala.collection.Iterator$$anon$11.hasNext(Iterator.scala:408)
at scala.collection.Iterator$class.foreach(Iterator.scala:893)
at scala.collection.AbstractIterator.foreach(Iterator.scala:1336)
at org.apache.spark.rdd.RDD$$anonfun$foreach$1$$anonfun$apply$28.apply(RDD.scala:921)
at org.apache.spark.rdd.RDD$$anonfun$foreach$1$$anonfun$apply$28.apply(RDD.scala:921)
at org.apache.spark.SparkContext$$anonfun$runJob$5.apply(SparkContext.scala:2067)
at org.apache.spark.SparkContext$$anonfun$runJob$5.apply(SparkContext.scala:2067)
at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:87)
at org.apache.spark.scheduler.Task.run(Task.scala:109)
at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:345)
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
at java.lang.Thread.run(Thread.java:745)
Caused by: java.lang.IllegalArgumentException: Expect srcResourceIds and destResourceIds have the same scheme, but received hdfs, example-counts-windo-14.
at org.apache.beam.sdk.repackaged.com.google.common.base.Preconditions.checkArgument(Preconditions.java:122)
at org.apache.beam.sdk.io.FileSystems.validateSrcDestLists(FileSystems.java:436)
at org.apache.beam.sdk.io.FileSystems.copy(FileSystems.java:281)
at org.apache.beam.sdk.io.FileBasedSink$WriteOperation.moveToOutputFiles(FileBasedSink.java:755)
at org.apache.beam.sdk.io.WriteFiles$FinalizeTempFileBundles$FinalizeFn.process(WriteFiles.java:798)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16561070" author="vectorijk" created="Sun, 29 Jul 2018 10:34:19 +0000"  >&lt;p&gt;I also encountered this issue in 2.6.0.&lt;/p&gt;</comment>
                            <comment id="16585979" author="timrobertson100" created="Mon, 20 Aug 2018 14:07:11 +0000"  >&lt;p&gt;Seeing this in 2.6.0 (not word count, but my own pipeline)&lt;/p&gt;</comment>
                            <comment id="16586042" author="timrobertson100" created="Mon, 20 Aug 2018 14:51:35 +0000"  >&lt;p&gt;A workaround is to instruct the temporary files to&#160;also go on hdfs, such as:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    transform.apply(&lt;span class=&quot;code-quote&quot;&gt;&quot;Write&quot;&lt;/span&gt;,
        AvroIO.writeGenericRecords(schema)
            .to(FileSystems.matchNewResource(options.getTarget(),&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;))
            &lt;span class=&quot;code-comment&quot;&gt;// BEAM-2277 workaround
&lt;/span&gt;            .withTempDirectory(FileSystems.matchNewResource(&lt;span class=&quot;code-quote&quot;&gt;&quot;hdfs:&lt;span class=&quot;code-comment&quot;&gt;//ha-nn/tmp/beam-avro&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)));&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16586052" author="timrobertson100" created="Mon, 20 Aug 2018 15:03:00 +0000"  >&lt;p&gt;Reopening - 2 people on here and 1 on the user@ list have stumbled upon this&lt;/p&gt;</comment>
                            <comment id="16587202" author="jozovilcek" created="Tue, 21 Aug 2018 09:23:11 +0000"  >&lt;p&gt;Is anyone have this problem if it is using HDFS paths in form with vs without authority? &lt;b&gt;hdfs:///path/to/dir&lt;/b&gt;&#160; &#160; vs&#160; &#160;&lt;b&gt;hdfs://ha-nn/path/to/dir&lt;/b&gt; ?&lt;/p&gt;

&lt;p&gt;I suspect the problem could be drop empty authority here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/beam/blob/master/sdks/java/io/hadoop-file-system/src/main/java/org/apache/beam/sdk/io/hdfs/HadoopFileSystem.java#L260&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/master/sdks/java/io/hadoop-file-system/src/main/java/org/apache/beam/sdk/io/hdfs/HadoopFileSystem.java#L260&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Which does for&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
FileSystems.matchNewResource(&lt;span class=&quot;code-quote&quot;&gt;&quot;hdfs:&lt;span class=&quot;code-comment&quot;&gt;///path/to/dir&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;produce&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hdfs:/path/to/dir
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Reading back such path via&#160; FileSystems.matchNewResource()&#160; produce a ResourceId with &quot;file&quot; schema because of the chance in &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-5180&quot; title=&quot;Broken FileResultCoder via parseSchema change&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-5180&quot;&gt;&lt;del&gt;BEAM-5180&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16587423" author="jozovilcek" created="Tue, 21 Aug 2018 13:14:32 +0000"  >&lt;p&gt;So after more investigation, URI, which is backing the HadoopResourceId does also drop &apos;//&apos; on empty authority when calling HadoopResourceIr.resolve() and produce string versions of resource in &quot;hdfs:/path&quot; form. This is not accepted back as hdfs scheme by FileSystems.matchNewResource(). The question is, what would be an elegant fix to that.&lt;/p&gt;</comment>
                            <comment id="16587910" author="timrobertson100" created="Tue, 21 Aug 2018 19:35:30 +0000"  >&lt;p&gt;Thank you for investigating &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=JozoVilcek&quot; class=&quot;user-hover&quot; rel=&quot;JozoVilcek&quot;&gt;JozoVilcek&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Is anyone have this problem if it is using HDFS paths in form with vs without authority?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, but I think you&apos;ve deduced that already&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The question is, what would be an elegant fix to that.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I&apos;ll try and find time to explore, but I am afraid it won&apos;t be until later this week. It would be great if we can solve this for 2.7.0.&lt;/p&gt;</comment>
                            <comment id="16588725" author="jozovilcek" created="Wed, 22 Aug 2018 11:26:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=timrobertson100&quot; class=&quot;user-hover&quot; rel=&quot;timrobertson100&quot;&gt;timrobertson100&lt;/a&gt; I believe root cause and solution to this is&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-5180&quot; title=&quot;Broken FileResultCoder via parseSchema change&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-5180&quot;&gt;&lt;del&gt;BEAM-5180&lt;/del&gt;&lt;/a&gt;&#160;and PR linked there.&lt;/p&gt;</comment>
                            <comment id="16588751" author="timrobertson100" created="Wed, 22 Aug 2018 11:41:48 +0000"  >&lt;p&gt;Thank you again &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=JozoVilcek&quot; class=&quot;user-hover&quot; rel=&quot;JozoVilcek&quot;&gt;JozoVilcek&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16592178" author="charleschen" created="Fri, 24 Aug 2018 21:19:37 +0000"  >&lt;p&gt;Fixed by&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-5180&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/BEAM-5180&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 12 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ew6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>