<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:24:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-14163] Performance Regressions in streaming python ParDo and GBK Load Tests</title>
                <link>https://issues.apache.org/jira/browse/BEAM-14163</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;As specified in the &lt;a href=&quot;https://beam.apache.org/contribute/release-guide/#4-investigate-performance-regressions&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Beam Release Guide&lt;/a&gt;, I&apos;m investigating performance regressions. The following load test metrics show a clear and persistant performance regression starting approximately around March 17 and affecting version 2.38.0.&lt;/p&gt;

&lt;p&gt;ParDo Load Tests: &lt;a href=&quot;http://metrics.beam.apache.org/d/MOi-kf3Zk/pardo-load-tests?orgId=1&amp;amp;var-processingType=streaming&amp;amp;var-sdk=python&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://metrics.beam.apache.org/d/MOi-kf3Zk/pardo-load-tests?orgId=1&amp;amp;var-processingType=streaming&amp;amp;var-sdk=python&lt;/a&gt;&lt;br/&gt;
GBK Load Tests: &lt;a href=&quot;http://metrics.beam.apache.org/d/UYZ-oJ3Zk/gbk-load-tests?orgId=1&amp;amp;var-processingType=streaming&amp;amp;var-sdk=python&amp;amp;from=now-30d&amp;amp;to=now&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://metrics.beam.apache.org/d/UYZ-oJ3Zk/gbk-load-tests?orgId=1&amp;amp;var-processingType=streaming&amp;amp;var-sdk=python&amp;amp;from=now-30d&amp;amp;to=now&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13435453">BEAM-14163</key>
            <summary>Performance Regressions in streaming python ParDo and GBK Load Tests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10101" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">P1</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="robertwb">Robert Bradshaw</assignee>
                                    <reporter username="danoliveira">Daniel Oliveira</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Mar 2022 00:12:46 +0000</created>
                <updated>Wed, 30 Mar 2022 18:02:52 +0000</updated>
                            <resolved>Wed, 30 Mar 2022 02:41:55 +0000</resolved>
                                    <version>2.38.0</version>
                                    <fixVersion>2.38.0</fixVersion>
                                    <component>community-metrics</component>
                    <component>sdk-py-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="6000">1h 40m</timespent>
                                <comments>
                            <comment id="17511931" author="bhulette" created="Thu, 24 Mar 2022 15:59:05 +0000"  >&lt;p&gt;I think &lt;a href=&quot;https://ci-beam.apache.org/job/beam_LoadTests_Python_ParDo_Dataflow_Streaming&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_LoadTests_Python_ParDo_Dataflow_Streaming&lt;/a&gt; is the job that generates the ParDo numbers. It would be nice to identify the specific first run with the regression. &lt;a href=&quot;https://ci-beam.apache.org/job/beam_LoadTests_Python_ParDo_Dataflow_Streaming/546/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-beam.apache.org/job/beam_LoadTests_Python_ParDo_Dataflow_Streaming/546/&lt;/a&gt; was run on 03/17 at 1PM UTC, the regression is reported at 03/17 at 5PM (no timezone). I&apos;m not sure if there&apos;s a timezone that makes that make sense.&lt;/p&gt;

&lt;p&gt;If the regression is at 546 the only python relevant changes are &lt;a href=&quot;https://github.com/apache/beam/commit/02d9657f68fc60bae9704eef0cc98810ea2b143f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/commit/02d9657f68fc60bae9704eef0cc98810ea2b143f&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/beam/commit/9c17960d748b56af4915a3fd1c618b470b0521c3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/commit/9c17960d748b56af4915a3fd1c618b470b0521c3&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17511972" author="chamikara" created="Thu, 24 Mar 2022 17:30:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=danoliveira&quot; class=&quot;user-hover&quot; rel=&quot;danoliveira&quot;&gt;danoliveira&lt;/a&gt; could you try to find an owner given that this is a P0 blocking the release ?&lt;/p&gt;</comment>
                            <comment id="17512643" author="tvalentyn" created="Sat, 26 Mar 2022 00:06:53 +0000"  >&lt;p&gt;Looking.&lt;/p&gt;

&lt;p&gt;Using this command to repro:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;./gradlew -PloadTest.mainClass=apache_beam.testing.load_tests.pardo_test \
 -Prunner=DataflowRunner \
 -PloadTest.args=&quot;--job_name=load-tests-python-dataflow-streaming-pardo-4-valentyn \
   --project=apache-beam-testing 
   --region=us-central1 
   --temp_location=gs://temp-storage-for-perf-tests/loadtests 
   --publish_to_big_query=false 
   --input_options=&apos;{\&quot;num_records\&quot;:20000000,\&quot;key_size\&quot;:10,\&quot;value_size\&quot;:90}&apos;
   --iterations=1 
   --number_of_counter_operations=100 
   --number_of_counters=1 
   --num_workers=5 
   --autoscaling_algorithm=NONE
  &#160;--streaming
   --experiments=use_runner_v2
   --runner=DataflowRunner&quot; \
 -PpythonVersion=3.7 \
 --continue --max-workers=12 -Dorg.gradle.jvmargs=-Xms2g -Dorg.gradle.jvmargs=-Xmx4g -Dorg.gradle.vfs.watch=false \
:sdks:python:apache_beam:testing:load_tests:run&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Command line taken from console output&#160; on Jenikins, and syntax adjusted accordingly to example in: &lt;a href=&quot;https://github.com/apache/beam/blob/master/sdks/python/apache_beam/testing/load_tests/pardo_test.py.&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/master/sdks/python/apache_beam/testing/load_tests/pardo_test.py.&lt;/a&gt; The last part is important: just copy-pasting the command does not work and due to&#160; finicky details about escaping various characters.&#160;&#160;&lt;/p&gt;

&lt;p&gt;Also Jenkins logs replace &apos;worker&apos; with ****r in the console logs that messes up the command line.&lt;/p&gt;</comment>
                            <comment id="17512776" author="tvalentyn" created="Sat, 26 Mar 2022 20:41:40 +0000"  >&lt;p&gt;I think I can reproduce the regression comparing master vs older commit&#160;&lt;/p&gt;

&lt;p&gt;Master&lt;/p&gt;

&lt;p&gt;INFO:apache_beam.runners.dataflow.dataflow_runner:Job 2022-03-25_19_08_11-10128193585164656190 is in state JOB_STATE_DONE&lt;br/&gt;
INFO:apache_beam.testing.load_tests.load_test_metrics_utils:Load test results for test: 2ba385094277483889f4bbc7dea9e489 and timestamp: 1648261523.4674542:&lt;br/&gt;
INFO:apache_beam.testing.load_tests.load_test_metrics_utils:Metric: default_runtime Value: 602&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;with :beam$ git checkout 9833b7be17b1a1ffbddd9ae5457ffee2aa9fee55&#160; :&lt;/p&gt;

&lt;p&gt;INFO:apache_beam.runners.dataflow.dataflow_runner:Job 2022-03-25_19_19_48-17065797399608426583 is in state JOB_STATE_DONE&lt;br/&gt;
INFO:apache_beam.testing.load_tests.load_test_metrics_utils:Load test results for test: c39f12b85a6444648bc9747694970ab5 and timestamp: 1648262283.1458037:&lt;br/&gt;
INFO:apache_beam.testing.load_tests.load_test_metrics_utils:Metric: default_runtime Value: 383&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Will do a couple more runs to see if this is reproducible and then try to narrow down the culprit.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17512789" author="tvalentyn" created="Sun, 27 Mar 2022 00:10:07 +0000"  >&lt;p&gt;results are reproducible in another run. seems to be an sdk regression. no regression at 02d9657f68. looking further.&lt;/p&gt;</comment>
                            <comment id="17512842" author="tvalentyn" created="Sun, 27 Mar 2022 07:13:50 +0000"  >&lt;p&gt;6da5fa6c295e10e44b2f046a9faa5612cca38af0 is the first bad commit&lt;br/&gt;
commit 6da5fa6c295e10e44b2f046a9faa5612cca38af0&lt;br/&gt;
Author: Robert Bradshaw &amp;lt;robertwb@gmail.com&amp;gt;&lt;br/&gt;
Date: &#160; Thu Mar 17 12:17:03 2022 -0700&lt;/p&gt;

&lt;p&gt;&#160; &#160; Populate environment capabilities in v1beta3 protos. (#17042)&lt;/p&gt;

&lt;p&gt;&#160;sdks/python/apache_beam/runners/dataflow/internal/apiclient.py | 9 ++++-----&lt;br/&gt;
&#160;1 file changed, 4 insertions&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/add.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, 5 deletions&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/forbidden.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17514403" author="danoliveira" created="Wed, 30 Mar 2022 02:41:16 +0000"  >&lt;p&gt;Cherry-pick is in and the graphs linked show metrics returning to their previous values on master, so I think it&apos;s safe to mark this resolved. Thanks everyone who helped investigate!&lt;/p&gt;</comment>
                            <comment id="17514870" author="bhulette" created="Wed, 30 Mar 2022 18:02:23 +0000"  >&lt;p&gt;Thank you for noticing the regression &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=danoliveira&quot; class=&quot;user-hover&quot; rel=&quot;danoliveira&quot;&gt;danoliveira&lt;/a&gt;! It&apos;s not easy to go through all those benchmark graphs&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 32 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z10rls:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>