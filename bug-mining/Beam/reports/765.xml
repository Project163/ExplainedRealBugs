<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:52:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-5633] Python SDK harness logging client failure</title>
                <link>https://issues.apache.org/jira/browse/BEAM-5633</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;After running a test with synthetic source for a few minutes, the logging client fails and all subsequent log output is not forwarded to the runner.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13189255">BEAM-5633</key>
            <summary>Python SDK harness logging client failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mwylde">Micah Wylde</assignee>
                                    <reporter username="thw">Thomas Weise</reporter>
                        <labels>
                            <label>portability-flink</label>
                    </labels>
                <created>Wed, 3 Oct 2018 18:05:42 +0000</created>
                <updated>Sat, 16 May 2020 13:52:14 +0000</updated>
                            <resolved>Thu, 11 Oct 2018 13:52:24 +0000</resolved>
                                                    <fixVersion>2.8.0</fixVersion>
                                    <component>sdk-py-harness</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="13200">3h 40m</timespent>
                                <comments>
                            <comment id="16637316" author="thw" created="Wed, 3 Oct 2018 18:07:27 +0000"  >&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[grpc-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-executor-1] WARN org.apache.beam.runners.fnexecution.logging.GrpcLoggingService - Logging client failed unexpectedly.

org.apache.beam.vendor.grpc.v1.io.grpc.StatusRuntimeException: CANCELLED: cancelled before receiving half close

&#160; &#160; &#160; &#160; at org.apache.beam.vendor.grpc.v1.io.grpc.Status.asRuntimeException(Status.java:517)

&#160; &#160; &#160; &#160; at org.apache.beam.vendor.grpc.v1.io.grpc.stub.ServerCalls$StreamingServerCallHandler$StreamingServerCallListener.onCancel(ServerCalls.java:272)

&#160; &#160; &#160; &#160; at org.apache.beam.vendor.grpc.v1.io.grpc.PartialForwardingServerCallListener.onCancel(PartialForwardingServerCallListener.java:40)

&#160; &#160; &#160; &#160; at org.apache.beam.vendor.grpc.v1.io.grpc.ForwardingServerCallListener.onCancel(ForwardingServerCallListener.java:23)

&#160; &#160; &#160; &#160; at org.apache.beam.vendor.grpc.v1.io.grpc.ForwardingServerCallListener$SimpleForwardingServerCallListener.onCancel(ForwardingServerCallListener.java:40)

&#160; &#160; &#160; &#160; at org.apache.beam.vendor.grpc.v1.io.grpc.Contexts$ContextualizedServerCallListener.onCancel(Contexts.java:96)

&#160; &#160; &#160; &#160; at org.apache.beam.vendor.grpc.v1.io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.closed(ServerCallImpl.java:293)

&#160; &#160; &#160; &#160; at org.apache.beam.vendor.grpc.v1.io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1Closed.runInContext(ServerImpl.java:738)

&#160; &#160; &#160; &#160; at org.apache.beam.vendor.grpc.v1.io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)

&#160; &#160; &#160; &#160; at org.apache.beam.vendor.grpc.v1.io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:123)

&#160; &#160; &#160; &#160; at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)

&#160; &#160; &#160; &#160; at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)

&#160; &#160; &#160; &#160; at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)

[grpc-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-executor-1] WARN org.apache.beam.runners.fnexecution.logging.GrpcLoggingService - Beam Fn Logging client failed to be complete.

org.apache.beam.vendor.grpc.v1.io.grpc.StatusRuntimeException: CANCELLED: call already cancelled

&#160; &#160; &#160; &#160; at org.apache.beam.vendor.grpc.v1.io.grpc.Status.asRuntimeException(Status.java:517)

&#160; &#160; &#160; &#160; at org.apache.beam.vendor.grpc.v1.io.grpc.stub.ServerCalls$ServerCallStreamObserverImpl.onCompleted(ServerCalls.java:356)

&#160; &#160; &#160; &#160; at org.apache.beam.runners.fnexecution.logging.GrpcLoggingService.completeIfNotNull(GrpcLoggingService.java:79)

&#160; &#160; &#160; &#160; at org.apache.beam.runners.fnexecution.logging.GrpcLoggingService.access$400(GrpcLoggingService.java:34)

&#160; &#160; &#160; &#160; at org.apache.beam.runners.fnexecution.logging.GrpcLoggingService$InboundObserver.onError(GrpcLoggingService.java:106)

&#160; &#160; &#160; &#160; at org.apache.beam.vendor.grpc.v1.io.grpc.stub.ServerCalls$StreamingServerCallHandler$StreamingServerCallListener.onCancel(ServerCalls.java:269)

&#160; &#160; &#160; &#160; at org.apache.beam.vendor.grpc.v1.io.grpc.PartialForwardingServerCallListener.onCancel(PartialForwardingServerCallListener.java:40)

&#160; &#160; &#160; &#160; at org.apache.beam.vendor.grpc.v1.io.grpc.ForwardingServerCallListener.onCancel(ForwardingServerCallListener.java:23)

&#160; &#160; &#160; &#160; at org.apache.beam.vendor.grpc.v1.io.grpc.ForwardingServerCallListener$SimpleForwardingServerCallListener.onCancel(ForwardingServerCallListener.java:40)

&#160; &#160; &#160; &#160; at org.apache.beam.vendor.grpc.v1.io.grpc.Contexts$ContextualizedServerCallListener.onCancel(Contexts.java:96)

&#160; &#160; &#160; &#160; at org.apache.beam.vendor.grpc.v1.io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.closed(ServerCallImpl.java:293)

&#160; &#160; &#160; &#160; at org.apache.beam.vendor.grpc.v1.io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1Closed.runInContext(ServerImpl.java:738)

&#160; &#160; &#160; &#160; at org.apache.beam.vendor.grpc.v1.io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)

&#160; &#160; &#160; &#160; at org.apache.beam.vendor.grpc.v1.io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:123)

&#160; &#160; &#160; &#160; at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)

&#160; &#160; &#160; &#160; at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)

&#160; &#160; &#160; &#160; at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16638964" author="mwylde" created="Thu, 4 Oct 2018 22:20:29 +0000"  >&lt;p&gt;On the client (sdk_worker) side, we see this error when the logging client disconnects:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
E1004 22:08:02.139750634      38 chttp2_transport.cc:1097]   Received a GOAWAY with error code ENHANCE_YOUR_CALM and debug data equal to &lt;span class=&quot;code-quote&quot;&gt;&quot;too_many_pings&quot;&lt;/span&gt;
Exception in thread read_log_control_messages:
Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python2.7/threading.py&quot;&lt;/span&gt;, line 801, in __bootstrap_inner
    self.run()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python2.7/threading.py&quot;&lt;/span&gt;, line 754, in run
    self.__target(*self.__args, **self.__kwargs)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python2.7/site-packages/apache_beam/runners/worker/log_handler.py&quot;&lt;/span&gt;, line 65, in &amp;lt;lambda&amp;gt;
    target=lambda: self._read_log_control_messages(log_control_messages),
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python2.7/site-packages/apache_beam/runners/worker/log_handler.py&quot;&lt;/span&gt;, line 111, in _read_log_control_messages
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; _ in log_control_iterator:
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python2.7/site-packages/grpc/_channel.py&quot;&lt;/span&gt;, line 350, in next
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; self._next()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python2.7/site-packages/grpc/_channel.py&quot;&lt;/span&gt;, line 341, in _next
    raise self
_Rendezvous: &amp;lt;_Rendezvous of RPC that terminated with (StatusCode.UNAVAILABLE, Socket closed)&amp;gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16640376" author="mwylde" created="Fri, 5 Oct 2018 21:39:19 +0000"  >&lt;p&gt;I have a PR out to fix this:&#160;&lt;a href=&quot;https://github.com/apache/beam/pull/6593&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/6593&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16642505" author="mwylde" created="Mon, 8 Oct 2018 21:24:03 +0000"  >&lt;p&gt;At a high-level, the issue is the client is sending the server too many illegal pings, and the server eventually closes the connection. As the client doesn&apos;t have any retry logic it never recovers from this.&lt;/p&gt;

&lt;p&gt;Ideally, there&apos;d be two levels of fixes:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Update the server or client gRPC configuration to prevent the client from sending bad pings or to prevent the server from killing the connection in this situation (see&#160;&lt;a href=&quot;https://github.com/grpc/grpc/blob/master/doc/keepalive.md&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&#160;for more documentation of this behavior)&lt;/li&gt;
	&lt;li&gt;Make the logging client more robust, reconnecting when the connection is lost&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I haven&apos;t been able to find a configuration that solves the first part, so that may need more investigation. Regardless, I think it&apos;s worthwhile having reconnection logic even if that issue is fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 6 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ysv3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>