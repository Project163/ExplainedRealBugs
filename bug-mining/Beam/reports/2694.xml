<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:21:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-13421] Python DeferredDataFrame.xs differs from Pandas</title>
                <link>https://issues.apache.org/jira/browse/BEAM-13421</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;When testing the `xs` method on DeferredDataFrames I&apos;m seeing a few inconsistent results.&#160; I have two minimal examples that showcase the errors.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;First inconsistency: Beam&apos;s `xs` requries one left over index field while Pandas does not.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
with beam.Pipeline(options=PipelineOptions()) as pipeline:
&#160; &#160; df = pd.DataFrame(
&#160; &#160; &#160; &#160; np.array([
&#160; &#160; &#160; &#160; &#160; &#160; [&lt;span class=&quot;code-quote&quot;&gt;&apos;state&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;day1&apos;&lt;/span&gt;, 12],
&#160; &#160; &#160; &#160; &#160; &#160; [&lt;span class=&quot;code-quote&quot;&gt;&apos;state&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;day1&apos;&lt;/span&gt;, 1],
&#160; &#160; &#160; &#160; &#160; &#160; [&lt;span class=&quot;code-quote&quot;&gt;&apos;state&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;day2&apos;&lt;/span&gt;, 14],
&#160; &#160; &#160; &#160; &#160; &#160; [&lt;span class=&quot;code-quote&quot;&gt;&apos;county&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;day1&apos;&lt;/span&gt;, 9],
&#160; &#160; &#160; &#160; ]),
&#160; &#160; &#160; &#160; columns=[&lt;span class=&quot;code-quote&quot;&gt;&apos;provider&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;time&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;value&apos;&lt;/span&gt;])
&#160; &#160; # Create just one index field
&#160; &#160; df = df.set_index([&lt;span class=&quot;code-quote&quot;&gt;&apos;provider&apos;&lt;/span&gt;])
&#160; &#160; df.to_parquet(&lt;span class=&quot;code-quote&quot;&gt;&apos;test.parquet&apos;&lt;/span&gt;)
&#160; &#160;&#160;
&#160; &#160; # Should print out
&#160; &#160; # &#160; &#160; &#160; &#160; &#160; time value
&#160; &#160; # provider &#160; &#160; &#160; &#160; &#160; &#160;
&#160; &#160; # state &#160; &#160; day1 &#160; &#160;12
&#160; &#160; # state &#160; &#160; day1 &#160; &#160; 1
&#160; &#160; # state &#160; &#160; day2 &#160; &#160;14
&#160; &#160; print(df.xs(&lt;span class=&quot;code-quote&quot;&gt;&apos;state&apos;&lt;/span&gt;))
&#160; &#160;&#160;
&#160; &#160; # Should emit the same data to a csv but instead dies due to
&#160; &#160; # Cannot remove 1 levels from an index with 1 levels: at least one level must be left.
&#160; &#160; test_df = (pipeline | read_parquet(&lt;span class=&quot;code-quote&quot;&gt;&apos;test.parquet&apos;&lt;/span&gt;))
&#160; &#160; (
&#160; &#160; &#160; &#160; test_df.xs(&lt;span class=&quot;code-quote&quot;&gt;&apos;state&apos;&lt;/span&gt;).to_csv(&lt;span class=&quot;code-quote&quot;&gt;&apos;test.csv&apos;&lt;/span&gt;)
&#160; &#160; ) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Second inconsistency: Beam dies for no clear reason&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; pandas as pd
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; numpy as npwith beam.Pipeline(options=PipelineOptions()) as pipeline:
&#160; &#160; df = pd.DataFrame(
&#160; &#160; &#160; &#160; np.array([
&#160; &#160; &#160; &#160; &#160; &#160; [&lt;span class=&quot;code-quote&quot;&gt;&apos;state&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;day1&apos;&lt;/span&gt;, 12],
&#160; &#160; &#160; &#160; &#160; &#160; [&lt;span class=&quot;code-quote&quot;&gt;&apos;state&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;day1&apos;&lt;/span&gt;, 1],
&#160; &#160; &#160; &#160; &#160; &#160; [&lt;span class=&quot;code-quote&quot;&gt;&apos;state&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;day2&apos;&lt;/span&gt;, 14],
&#160; &#160; &#160; &#160; &#160; &#160; [&lt;span class=&quot;code-quote&quot;&gt;&apos;county&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;day1&apos;&lt;/span&gt;, 9],
&#160; &#160; &#160; &#160; ]),
&#160; &#160; &#160; &#160; columns=[&lt;span class=&quot;code-quote&quot;&gt;&apos;provider&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;time&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;value&apos;&lt;/span&gt;])
&#160; &#160; # Create two index fields to satisfy Beam
&#160; &#160; df = df.set_index([&lt;span class=&quot;code-quote&quot;&gt;&apos;provider&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;time&apos;&lt;/span&gt;])
&#160; &#160; df.to_parquet(&lt;span class=&quot;code-quote&quot;&gt;&apos;test.parquet&apos;&lt;/span&gt;)
&#160; &#160;&#160;
&#160; &#160; # Should print out
&#160; &#160; # &#160; &#160; &#160;value
&#160; &#160; # time &#160; &#160; &#160;
&#160; &#160; # day1 &#160; &#160;12
&#160; &#160; # day1 &#160; &#160; 1
&#160; &#160; # day2 &#160; &#160;14
&#160; &#160; print(df.xs(&lt;span class=&quot;code-quote&quot;&gt;&apos;state&apos;&lt;/span&gt;))
&#160; &#160;&#160;
&#160; &#160; # Dies with no clear error at
&#160; &#160; # /opt/conda/lib/python3.9/site-packages/apache_beam/dataframe/transforms.py in output_partitioning_in_stage(expr, stage)
&#160; &#160; # 305&#160;
&#160; &#160; # 306 &#160; &#160; &#160; # Anything that&apos;s not an input must have arguments
&#160; &#160; # 307 &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; len(expr.args())
&#160; &#160; # 308&#160;
&#160; &#160; # 309 &#160; &#160; &#160; arg_partitionings = set(
&#160; &#160; test_df = (pipeline | read_parquet(&lt;span class=&quot;code-quote&quot;&gt;&apos;test.parquet&apos;&lt;/span&gt;))
&#160; &#160; (
&#160; &#160; &#160; &#160; test_df.xs(&lt;span class=&quot;code-quote&quot;&gt;&apos;state&apos;&lt;/span&gt;).to_csv(&lt;span class=&quot;code-quote&quot;&gt;&apos;test.csv&apos;&lt;/span&gt;)
&#160; &#160; ) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>Tested in Jupyter Notebook running in Docker.&lt;br/&gt;
&lt;br/&gt;
The docker file is produced by a modified version of &lt;a href=&quot;https://github.com/fozziethebeat/gpu-jupyter/blob/master/.build/Dockerfile&quot;&gt;https://github.com/fozziethebeat/gpu-jupyter/blob/master/.build/Dockerfile&lt;/a&gt;&lt;br/&gt;
</environment>
        <key id="13416210">BEAM-13421</key>
            <summary>Python DeferredDataFrame.xs differs from Pandas</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="3" iconUrl="https://issues.apache.org/jira/images/icons/statuses/inprogress.png" description="This issue is being actively worked on at the moment by the assignee.">In Progress</status>
                    <statusCategory id="4" key="indeterminate" colorName="yellow"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="bhulette">Brian Hulette</assignee>
                                    <reporter username="fozziethebeat">Keith Stevens</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Dec 2021 07:27:47 +0000</created>
                <updated>Sat, 23 Nov 2024 21:13:29 +0000</updated>
                                            <version>2.34.0</version>
                                    <fixVersion>2.36.0</fixVersion>
                                    <component>dsl-dataframe</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="17461029" author="bhulette" created="Thu, 16 Dec 2021 20:16:29 +0000"  >&lt;p&gt;Thanks for reporting this with the minimal repro. I&apos;ll take a look&lt;/p&gt;</comment>
                            <comment id="17461041" author="bhulette" created="Thu, 16 Dec 2021 21:01:04 +0000"  >&lt;p&gt;Thanks again for the report, &lt;a href=&quot;https://github.com/apache/beam/pull/16258&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/16258&lt;/a&gt; should address this.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>Python</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 47 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0xhsw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>