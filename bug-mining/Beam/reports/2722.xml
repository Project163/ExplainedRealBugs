<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:22:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-13602] Metrics reporting failed bigtable io</title>
                <link>https://issues.apache.org/jira/browse/BEAM-13602</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;Details see comment in &lt;a href=&quot;https://github.com/apache/beam/pull/15562&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/15562&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;We are seeing errors which possibly originate from this code:&lt;/tt&gt;&lt;tt&gt;def write_mutate_metrics(self, rows): for status in rows: grpc_status_string = ( ServiceCallMetric.bigtable_error_code_to_grpc_status_string( status.code)) self.service_call_metric.call(grpc_status_string)&lt;/tt&gt;&lt;tt&gt;Error message:&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;File &quot;/usr/local/lib/python3.6/site-packages/apache_beam/io/gcp/bigtableio.py&quot;, line 123, in write_mutate_metrics status.code)) AttributeError: &apos;NoneType&apos; object has no attribute &apos;code&apos; &lt;span class=&quot;error&quot;&gt;&amp;#91;while running &amp;#39;Write event Bigtable row/ParDo(_BigTableWriteFn)-ptransform-58134&amp;#39;&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;tt&gt;Would you have any idea about this issue?&lt;/tt&gt;&lt;tt&gt;We are running&lt;/tt&gt;&lt;tt&gt;Python 3.6&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;Beam 2.35&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;GCP DataflowRunner&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;In addition, the choice of parameter name (rows) is confusing. Perhaps something like responses or response_list ?&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;a href=&quot;https://cloud.google.com/bigtable/docs/writing-data#batch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cloud.google.com/bigtable/docs/writing-data#batch&lt;/a&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;a href=&quot;https://googleapis.dev/python/bigtable/1.3.0/_modules/google/cloud/bigtable/table.html#Table.mutate_rows&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://googleapis.dev/python/bigtable/1.3.0/_modules/google/cloud/bigtable/table.html#Table.mutate_rows&lt;/a&gt;&lt;/tt&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13420909">BEAM-13602</key>
            <summary>Metrics reporting failed bigtable io</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="10722" iconUrl="https://issues.apache.org/jira/images/icons/statuses/generic.png" description="">Triage Needed</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ningk">Ning</assignee>
                                    <reporter username="ningk">Ning</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Jan 2022 19:09:19 +0000</created>
                <updated>Thu, 28 Nov 2024 10:36:51 +0000</updated>
                            <resolved>Wed, 12 Jan 2022 17:44:28 +0000</resolved>
                                                    <fixVersion>Missing</fixVersion>
                                    <component>io-py-gcp</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="10800">3h</timespent>
                                <comments>
                            <comment id="17470254" author="ningk" created="Fri, 7 Jan 2022 00:01:50 +0000"  >&lt;p&gt;The expected behavior is a single response (based on the&#160;&lt;a href=&quot;https://cloud.google.com/bigtable/docs/reference/data/rpc/google.bigtable.v2#mutaterowsresponse&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;REST API&lt;/a&gt;) with multiple&#160;&lt;tt&gt;Status&lt;/tt&gt;&#160;entries. In the Python client implementation of bigtable, the returned response is a&#160;&lt;tt&gt;List[Optional&lt;span class=&quot;error&quot;&gt;&amp;#91;Status&amp;#93;&lt;/span&gt;]&lt;/tt&gt;&#160;(or equivalently&#160;&lt;tt&gt;List[Union&lt;span class=&quot;error&quot;&gt;&amp;#91;None, Status&amp;#93;&lt;/span&gt;]&lt;/tt&gt;)). Details: default&#160;&lt;a href=&quot;https://github.com/googleapis/python-bigtable/blob/fec06fcd28c36d0d3b347b43d1f3d264e5f5aa39/google/cloud/bigtable/table.py#L1058&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;value&lt;/a&gt;&#160;is None, retryable errors will&#160;&lt;a href=&quot;https://github.com/googleapis/python-bigtable/blob/fec06fcd28c36d0d3b347b43d1f3d264e5f5aa39/google/cloud/bigtable/table.py#L1078&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;return default value&lt;/a&gt;&#160;instead of a&#160;&lt;tt&gt;Status&lt;/tt&gt;&#160;instance)&lt;/p&gt;

&lt;p&gt;I&apos;ll send a PR to do the following 2 things:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Prevent the metrics gathering from failing the job;&lt;/li&gt;
	&lt;li&gt;Handle None cases and treat them as&#160;&lt;a href=&quot;https://grpc.github.io/grpc/core/md_doc_statuscodes.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&apos;DEADLINE_EXCEEDED&apos;&lt;/a&gt;.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I fear that there is data-loss throughout the process. If a row mutation fails but no error is raised, DF nor bigtable no longer retries.&lt;/p&gt;</comment>
                            <comment id="17473263" author="kenn" created="Wed, 12 Jan 2022 03:20:46 +0000"  >&lt;p&gt;Did the PR resolve it?&lt;/p&gt;</comment>
                            <comment id="17473411" author="kenn" created="Wed, 12 Jan 2022 03:49:25 +0000"  >&lt;p&gt;This Jira ticket has a pull request attached to it, but is still open. Did the pull request resolve the issue? If so, could you please mark it resolved? This will help the project have a clear view of its open issues.&lt;/p&gt;</comment>
                            <comment id="17474754" author="ningk" created="Wed, 12 Jan 2022 17:44:23 +0000"  >&lt;p&gt;Yes, it&apos;s resolved.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 43 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ya9k:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>