<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:01:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-5519] Spark Streaming Duplicated Encoding/Decoding Effort</title>
                <link>https://issues.apache.org/jira/browse/BEAM-5519</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;When using the SparkRunner in streaming mode. There is a call to groupByKey followed by a call to updateStateByKey. &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-1815&quot; title=&quot;Avoid shuffling twice in GABW&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-1815&quot;&gt;&lt;del&gt;BEAM-1815&lt;/del&gt;&lt;/a&gt; fixed an issue where this used to cause 2 shuffles but it still causes 2 encode/decode cycles.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13188026">BEAM-5519</key>
            <summary>Spark Streaming Duplicated Encoding/Decoding Effort</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="winkelman.kyle">Kyle Winkelman</assignee>
                                    <reporter username="winkelman.kyle">Kyle Winkelman</reporter>
                        <labels>
                            <label>spark</label>
                            <label>spark-streaming</label>
                    </labels>
                <created>Thu, 27 Sep 2018 20:37:58 +0000</created>
                <updated>Sat, 16 May 2020 14:06:15 +0000</updated>
                            <resolved>Mon, 19 Aug 2019 15:01:47 +0000</resolved>
                                                    <fixVersion>2.16.0</fixVersion>
                                    <component>runner-spark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="27000">7.5h</timespent>
                                <comments>
                            <comment id="16631012" author="winkelman.kyle" created="Thu, 27 Sep 2018 20:42:54 +0000"  >&lt;p&gt;Current:&lt;br/&gt;
// GroupCombineFunctions.groupByKeyOnly&lt;br/&gt;
JavaRDD&amp;lt;WindowedValue&amp;lt;KV&amp;lt;K, V&amp;gt;&amp;gt;&amp;gt;&lt;br/&gt;
JavaRDD&amp;lt;WindowedValue&amp;lt;KV&amp;lt;K, WindowedValue&amp;lt;V&amp;gt;&amp;gt;&amp;gt;&amp;gt;&lt;br/&gt;
JavaRDD&amp;lt;KV&amp;lt;K, WindowedValue&amp;lt;V&amp;gt;&amp;gt;&amp;gt;&lt;br/&gt;
JavaPairRDD&amp;lt;K, WindowedValue&amp;lt;V&amp;gt;&amp;gt;&lt;br/&gt;
JavaPairRDD&amp;lt;ByteArray, byte[]&amp;gt;&lt;br/&gt;
JavaPairRdd&amp;lt;ByteArray, Iterable&amp;lt;byte[]&amp;gt;&amp;gt; // groupByKey&lt;br/&gt;
JavaPairRDD&amp;lt;K, Iterable&amp;lt;WindowedValue&amp;lt;V&amp;gt;&amp;gt;&amp;gt;&lt;br/&gt;
JavaRDD&amp;lt;KV&amp;lt;K, Iterable&amp;lt;WindowedValue&amp;lt;V&amp;gt;&amp;gt;&amp;gt;&amp;gt;&lt;br/&gt;
JavaRDD&amp;lt;WindowedValue&amp;lt;KV&amp;lt;K, Iterable&amp;lt;WindowedValue&amp;lt;V&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;// SparkGroupAlsoByWindowViaWindowSet.buildPairDStream&lt;br/&gt;
JavaRDD&amp;lt;KV&amp;lt;K, Iterable&amp;lt;WindowedValue&amp;lt;V&amp;gt;&amp;gt;&amp;gt;&amp;gt;&lt;br/&gt;
JavaPairRDD&amp;lt;K, Iterable&amp;lt;WindowedValue&amp;lt;V&amp;gt;&amp;gt;&amp;gt;&lt;br/&gt;
JavaPairRDD&amp;lt;K, KV&amp;lt;Long, Iterable&amp;lt;WindowedValue&amp;lt;V&amp;gt;&amp;gt;&amp;gt;&amp;gt;&lt;br/&gt;
JavaPairRDD&amp;lt;ByteArray, byte[]&amp;gt;&lt;/p&gt;

&lt;p&gt;// UpdateStateByKeyOutputIterator.computeNext&lt;br/&gt;
gets the scala.collection.Seq&amp;lt;byte[]&amp;gt; the seq of values that have the same key&lt;br/&gt;
decoded to scala.collection.Seq&amp;lt;KV&amp;lt;Long, Iterable&amp;lt;WindowedValue&amp;lt;V&amp;gt;&amp;gt;&amp;gt;&amp;gt; (zero or one items because we have already grouped by key)&lt;br/&gt;
get the head of the Seq and pull out the Iterable&amp;lt;WindowedValue&amp;lt;V&amp;gt;&amp;gt;&lt;/p&gt;
</comment>
                            <comment id="16631017" author="winkelman.kyle" created="Thu, 27 Sep 2018 20:43:19 +0000"  >&lt;p&gt;Proposed:&lt;/p&gt;

&lt;p&gt;// SparkGroupAlsoByWindowViaWindowSet.buildPairDStream&lt;br/&gt;
JavaRDD&amp;lt;WindowedValue&amp;lt;KV&amp;lt;K, V&amp;gt;&amp;gt;&amp;gt;&lt;br/&gt;
JavaRDD&amp;lt;WindowedValue&amp;lt;KV&amp;lt;K, WindowedValue&amp;lt;V&amp;gt;&amp;gt;&amp;gt;&amp;gt;&lt;br/&gt;
JavaRDD&amp;lt;KV&amp;lt;K, WindowedValue&amp;lt;V&amp;gt;&amp;gt;&amp;gt;&lt;br/&gt;
JavaPairRDD&amp;lt;ByteArray, byte[]&amp;gt;&lt;/p&gt;

&lt;p&gt;// UpdateStateByKeyOutputIterator.computeNext&lt;br/&gt;
gets the scala.collection.Seq&amp;lt;byte[]&amp;gt; the seq of values that have the same key&lt;br/&gt;
decoded to scala.collection.Seq&amp;lt;WindowedValue&amp;lt;V&amp;gt;&amp;gt; (convert to Iterable)&lt;/p&gt;</comment>
                            <comment id="16634849" author="amitsela" created="Tue, 2 Oct 2018 02:09:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=winkelman.kyle&quot; class=&quot;user-hover&quot; rel=&quot;winkelman.kyle&quot;&gt;winkelman.kyle&lt;/a&gt; you bring up a good point.&lt;br/&gt;
IIRC we did all this mess to guarantee that in case a shuffle is required by Spark, we control it (initiate it), and it applies to RDDs containing serialized data only.&lt;br/&gt;
This might have been &lt;em&gt;before&lt;/em&gt; we got the &quot;force default partitioner&quot; in place, or a mixed process.. not sure.&lt;br/&gt;
You can do test your change (in streaming, which uses &lt;tt&gt;UpdateStateByKey&lt;/tt&gt; and so creates shuffles etc.) to make sure that no shuffle occurs on RDDs containing deserialized data. In addition, you can use a non-Kryo serializable (if the runner still defaults to Kryo underneath..) and make sure it doesn&apos;t fail.&lt;br/&gt;
Hope that helps!&lt;/p&gt;</comment>
                            <comment id="16803274" author="kenn" created="Wed, 27 Mar 2019 19:21:44 +0000"  >&lt;p&gt;This has been affecting things for a very long time - why is it now severe enough to block a release? I would say that probably it is not a critical release blocker. I see that there is a PR out for it, but I don&apos;t think we should block the steady release cadence except things that make a release really unusable.&lt;/p&gt;</comment>
                            <comment id="16803299" author="winkelman.kyle" created="Wed, 27 Mar 2019 19:57:56 +0000"  >&lt;p&gt;I would agree that it is not a release blocker. Please update the jira as necessary. I did not believe I indicated it was.&lt;/p&gt;</comment>
                            <comment id="16803384" author="iemejia" created="Wed, 27 Mar 2019 21:42:08 +0000"  >&lt;p&gt;Hi not a blocker I marked it with 2.12.0 because I would like to have it since is a considerable improvement, however I won&apos;t be able to finish the review on this one today. If you guys decide to cut the branch today. I will try to cherry pick it before the vote.&lt;/p&gt;</comment>
                            <comment id="16860355" author="kedin" created="Mon, 10 Jun 2019 21:36:47 +0000"  >&lt;p&gt;It doesn&apos;t look like this&#160;should be treated as&#160;a blocker for 2.14 as well? If so the I suggest removing the concrete fix version&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 23 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ylbj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>