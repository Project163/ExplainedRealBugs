<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:04:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-8974] apache_beam.runners.worker.log_handler_test.FnApiLogRecordHandlerTest.test_exc_info is flaky</title>
                <link>https://issues.apache.org/jira/browse/BEAM-8974</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;The test is failing at apache_beam/runners/worker/log_handler_test.py:110: IndexError&lt;/p&gt;

&lt;p&gt;Added in &lt;a href=&quot;https://github.com/apache/beam/pull/10292&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/10292&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Sample job:&#160;&lt;a href=&quot;https://builds.apache.org/job/beam_PreCommit_Python_Cron/2160/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/beam_PreCommit_Python_Cron/2160/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Console logs:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;06:37:37 =================================== FAILURES ===================================
06:37:37 ___________________ FnApiLogRecordHandlerTest.test_exc_info ____________________
06:37:37 [gw1] linux2 -- Python 2.7.12 /home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Cron/src/sdks/python/test-suites/tox/py2/build/srcs/sdks/python/target/.tox-py27-gcp-pytest/py27-gcp-pytest/bin/python
06:37:37
06:37:37 self = &amp;lt;apache_beam.runners.worker.log_handler_test.FnApiLogRecordHandlerTest testMethod=test_exc_info&amp;gt;
06:37:37
06:37:37     def test_exc_info(self):
06:37:37       try:
06:37:37         raise ValueError(&apos;some message&apos;)
06:37:37       except ValueError:
06:37:37         _LOGGER.error(&apos;some error&apos;, exc_info=True)
06:37:37
06:37:37       self.fn_log_handler.close()
06:37:37
06:37:37 &amp;gt;     log_entry = self.test_logging_service.log_records_received[0].log_entries[0]
06:37:37 E     IndexError: list index out of range
06:37:37
06:37:37 apache_beam/runners/worker/log_handler_test.py:110: IndexError
06:37:37 ----------------------------- Captured stderr call -----------------------------
06:37:37 ERROR:apache_beam.runners.worker.log_handler_test:some error
06:37:37 Traceback (most recent call last):
06:37:37   File &quot;/home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Cron/src/sdks/python/test-suites/tox/py2/build/srcs/sdks/python/apache_beam/runners/worker/log_handler_test.py&quot;, line 104, in test_exc_info
06:37:37     raise ValueError(&apos;some message&apos;)
06:37:37 ValueError: some message
06:37:37 ------------------------------ Captured log call -------------------------------
06:37:37 ERROR    apache_beam.runners.worker.log_handler_test:log_handler_test.py:106 some error
06:37:37 Traceback (most recent call last):
06:37:37   File &quot;/home/jenkins/jenkins-slave/workspace/beam_PreCommit_Python_Cron/src/sdks/python/test-suites/tox/py2/build/srcs/sdks/python/apache_beam/runners/worker/log_handler_test.py&quot;, line 104, in test_exc_info
06:37:37     raise ValueError(&apos;some message&apos;)
06:37:37 ValueError: some message

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13274819">BEAM-8974</key>
            <summary>apache_beam.runners.worker.log_handler_test.FnApiLogRecordHandlerTest.test_exc_info is flaky</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="robertwb">Robert Bradshaw</assignee>
                                    <reporter username="tvalentyn">Valentyn Tymofieiev</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Dec 2019 18:37:37 +0000</created>
                <updated>Sat, 16 May 2020 14:14:20 +0000</updated>
                            <resolved>Sat, 21 Dec 2019 02:55:54 +0000</resolved>
                                                    <fixVersion>2.18.0</fixVersion>
                                    <component>sdk-py-harness</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="16997539" author="tvalentyn" created="Mon, 16 Dec 2019 18:42:12 +0000"  >&lt;p&gt;cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=udim&quot; class=&quot;user-hover&quot; rel=&quot;udim&quot;&gt;udim&lt;/a&gt; since the PR was also merged to the 2.18.0 release branch  &lt;/p&gt;</comment>
                            <comment id="16997541" author="tvalentyn" created="Mon, 16 Dec 2019 18:43:59 +0000"  >&lt;p&gt;Robert, could you please check whether the flake cause is in the test code or in the SDK itself? Setting fix version to 2.18.0 out of caution in case another change for release branch will be required due to this error. &lt;/p&gt;</comment>
                            <comment id="16997542" author="tvalentyn" created="Mon, 16 Dec 2019 18:44:48 +0000"  >&lt;p&gt;Please remove the fix version tag if not release-blocking.&lt;/p&gt;</comment>
                            <comment id="16999513" author="bhulette" created="Wed, 18 Dec 2019 21:29:52 +0000"  >&lt;p&gt;test_context failed in a similar way here: &lt;a href=&quot;https://builds.apache.org/job/beam_PreCommit_Python_Cron/2170/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/beam_PreCommit_Python_Cron/2170/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;stacktrace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
self = &amp;lt;apache_beam.runners.worker.log_handler_test.FnApiLogRecordHandlerTest testMethod=test_context&amp;gt;

    def test_context(self):
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;:
        with statesampler.instruction_id(&lt;span class=&quot;code-quote&quot;&gt;&apos;A&apos;&lt;/span&gt;):
          tracker = statesampler.for_test()
          with tracker.scoped_state(NameContext(&lt;span class=&quot;code-quote&quot;&gt;&apos;name&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;tid&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&apos;stage&apos;&lt;/span&gt;):
            _LOGGER.info(&lt;span class=&quot;code-quote&quot;&gt;&apos;message a&apos;&lt;/span&gt;)
        with statesampler.instruction_id(&lt;span class=&quot;code-quote&quot;&gt;&apos;B&apos;&lt;/span&gt;):
          _LOGGER.info(&lt;span class=&quot;code-quote&quot;&gt;&apos;message b&apos;&lt;/span&gt;)
        _LOGGER.info(&lt;span class=&quot;code-quote&quot;&gt;&apos;message c&apos;&lt;/span&gt;)
    
        self.fn_log_handler.close()
        a, b, c = sum(
            [list(logs.log_entries)
&amp;gt;            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; logs in self.test_logging_service.log_records_received], [])
E            ValueError: need more than 0 values to unpack

apache_beam/runners/worker/log_handler_test.py:128: ValueError
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17000283" author="tvalentyn" created="Thu, 19 Dec 2019 18:27:42 +0000"  >&lt;p&gt;These errors continue to happen. I see that&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iemejia&quot; class=&quot;user-hover&quot; rel=&quot;iemejia&quot;&gt;iemejia&lt;/a&gt;&#160;removed 2.18.0 fix version tag. The flake was introduced by a PR that was cherry-picked into the release branch. Are we confident that this flake does not need to be fixed in the release branch?&lt;/p&gt;</comment>
                            <comment id="17000368" author="iemejia" created="Thu, 19 Dec 2019 20:59:40 +0000"  >&lt;p&gt;If I removed the tag probably it was because I misread that this was part of master aka 2.19.0. I was not aware of the cherry pick so putting the version back looks like the good thing to do.&lt;/p&gt;</comment>
                            <comment id="17001562" author="altay" created="Sat, 21 Dec 2019 00:57:23 +0000"  >&lt;p&gt;What is the next action here with respect to 2.18 release?&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Revert the cherry pick to release branch?&lt;/li&gt;
	&lt;li&gt;Fix forward in the release branch? Do we know what is the fix?&lt;/li&gt;
	&lt;li&gt;Leave it as it its? &#8211; Is this just a test flakiness? Would this affect end users?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17001590" author="robertwb" created="Sat, 21 Dec 2019 01:03:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/beam/pull/10389&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/10389&lt;/a&gt; has been merged. &lt;/p&gt;

&lt;p&gt;This is mostly a testing issue--on a loaded machine the log writing thread might not start up before the test tries to close it. (It was a race with the pre-existing test as well but that generally did &quot;enough work&quot; to make the failure rarer.)&lt;/p&gt;

&lt;p&gt;The only way this could affect a real worker is if it was brought up and shut down very quickly (as in quicker than opening up the grpc channel to get work). I don&apos;t think it&apos;s worth the overhead of a cherry-pick. &lt;/p&gt;</comment>
                            <comment id="17001606" author="tvalentyn" created="Sat, 21 Dec 2019 02:56:14 +0000"  >&lt;p&gt;Thanks, everyone. We can reopen if this comes up again.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13275309">BEAM-8991</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 47 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z09q74:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>