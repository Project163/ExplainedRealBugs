<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:44:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-2154] Writing to large numbers of BigQuery tables causes out-of-memory </title>
                <link>https://issues.apache.org/jira/browse/BEAM-2154</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;Since all TableRowWriters are created in a single DoFn, the write buffers all exist simultaneously and use up large amounts of memory.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13068841">BEAM-2154</key>
            <summary>Writing to large numbers of BigQuery tables causes out-of-memory </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="reuvenlax">Reuven Lax</assignee>
                                    <reporter username="reuvenlax">Reuven Lax</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 May 2017 17:11:53 +0000</created>
                <updated>Fri, 24 Jul 2020 20:20:18 +0000</updated>
                            <resolved>Tue, 9 May 2017 16:44:46 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                                    <component>io-java-gcp</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15995960" author="githubbot" created="Thu, 4 May 2017 00:32:39 +0000"  >&lt;p&gt;GitHub user reuvenlax opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/2883&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/2883&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-2154&quot; title=&quot;Writing to large numbers of BigQuery tables causes out-of-memory &quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-2154&quot;&gt;&lt;del&gt;BEAM-2154&lt;/del&gt;&lt;/a&gt; Make BigQuery&apos;s dynamic-destination support scale to large numbers of destinations&lt;/p&gt;

&lt;p&gt;     Generating hundreds or thousands of file write buffers in a single bundle was causing workers to crash with out of memory. We now detect when too many files have been written in a bundle, and spill the remaining records to another PCollection. This PCollection is then grouped by destination before we write the remaining data to files. We shard destination keys 10 ways to prevent hotspotting. Tests of up to 10TB of data (going from 20 output tables up to 4000) were run, and a sharding factor of 10 seems to work quite well on all runs (and is noticeably faster than not sharding)&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/reuvenlax/incubator-beam&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/reuvenlax/incubator-beam&lt;/a&gt; bigquery_scalability&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/2883.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/2883.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2883&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 45eb1f8ec1f84a3eefd6d85539e9dc433be4842f&lt;br/&gt;
Author: Reuven Lax &amp;lt;relax@google.com&amp;gt;&lt;br/&gt;
Date:   2017-04-29T14:33:54Z&lt;/p&gt;

&lt;p&gt;    If too many tables are generated in a bundle, spill and group the results before writing files. Generating hundreds or thousands of file write buffers in a single bundle was causing workers to crash with out of memory.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16001893" author="githubbot" created="Tue, 9 May 2017 01:20:19 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/2883&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/2883&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16001895" author="githubbot" created="Tue, 9 May 2017 01:24:11 +0000"  >&lt;p&gt;GitHub user jkff opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/2981&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/2981&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Cherrypick #2883 to release-2.0.0&lt;/p&gt;

&lt;p&gt;    Cherrypick #2883 &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-2154&quot; title=&quot;Writing to large numbers of BigQuery tables causes out-of-memory &quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-2154&quot;&gt;&lt;del&gt;BEAM-2154&lt;/del&gt;&lt;/a&gt; Make BigQuery&apos;s dynamic-destination support scale to large numbers of destinations&lt;/p&gt;

&lt;p&gt;    R: @davorbonaci &lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/jkff/incubator-beam&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jkff/incubator-beam&lt;/a&gt; cp-2883&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/2981.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/2981.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2981&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 34dc0938b2d53ff389b24ceed51da89bffa7c1ae&lt;br/&gt;
Author: Eugene Kirpichov &amp;lt;kirpichov@google.com&amp;gt;&lt;br/&gt;
Date:   2017-05-09T01:02:14Z&lt;/p&gt;

&lt;p&gt;    This closes #2883&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16002970" author="dhalperi@google.com" created="Tue, 9 May 2017 16:24:36 +0000"  >&lt;p&gt;It&apos;s not yet in the 2.0.0 release, so keeping it open.&lt;/p&gt;

&lt;p&gt;Either wait until CP is merged and fix confirmed to close, or remove the 2.0.0 Fix Version.&lt;/p&gt;</comment>
                            <comment id="16003008" author="dhalperi@google.com" created="Tue, 9 May 2017 16:44:46 +0000"  >&lt;p&gt;CPed into release&lt;/p&gt;</comment>
                            <comment id="16003289" author="githubbot" created="Tue, 9 May 2017 18:50:26 +0000"  >&lt;p&gt;Github user jkff closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/beam/pull/2981&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/2981&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 27 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3efrj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>