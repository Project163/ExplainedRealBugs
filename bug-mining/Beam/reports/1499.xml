<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:03:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-8884] Python MongoDBIO TypeError when splitting</title>
                <link>https://issues.apache.org/jira/browse/BEAM-8884</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;From &lt;a href=&quot;https://the-asf.slack.com/archives/CBDNLQZM1/p1575350991134000&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;slack&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;I am trying to run a pipeline (defined with the Python SDK) on Dataflow that uses beam.io.ReadFromMongoDB. When dealing with very small datasets (&amp;lt;10mb) it runs fine, when trying to run it with slightly larger datasets (70mb), I always get this error:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
TypeError: &lt;span class=&quot;code-quote&quot;&gt;&apos;&amp;lt;&apos;&lt;/span&gt; not supported between instances of &lt;span class=&quot;code-quote&quot;&gt;&apos;dict&apos;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&apos;ObjectId&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Stack trace see below. Running it on a local machine works just fine. I would highly appreciate any pointers what this could be.&lt;br/&gt;
I hope this is the right channel do address this.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python3.7/site-packages/dataflow_worker/batchworker.py&quot;&lt;/span&gt;, line 649, in do_work
    work_executor.execute()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python3.7/site-packages/dataflow_worker/executor.py&quot;&lt;/span&gt;, line 218, in execute
    self._split_task)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python3.7/site-packages/dataflow_worker/executor.py&quot;&lt;/span&gt;, line 226, in _perform_source_split_considering_api_limits
    desired_bundle_size)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python3.7/site-packages/dataflow_worker/executor.py&quot;&lt;/span&gt;, line 263, in _perform_source_split
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; split in source.split(desired_bundle_size):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/local/lib/python3.7/site-packages/apache_beam/io/mongodbio.py&quot;&lt;/span&gt;, line 174, in split
    bundle_end = min(stop_position, split_key_id)
TypeError: &lt;span class=&quot;code-quote&quot;&gt;&apos;&amp;lt;&apos;&lt;/span&gt; not supported between instances of &lt;span class=&quot;code-quote&quot;&gt;&apos;dict&apos;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&apos;ObjectId&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13272084">BEAM-8884</key>
            <summary>Python MongoDBIO TypeError when splitting</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="10722" iconUrl="https://issues.apache.org/jira/images/icons/statuses/generic.png" description="">Triage Needed</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yichi">Yichi Zhang</assignee>
                                    <reporter username="bhulette">Brian Hulette</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Dec 2019 00:16:59 +0000</created>
                <updated>Thu, 13 Apr 2023 10:59:05 +0000</updated>
                            <resolved>Fri, 13 Dec 2019 01:38:05 +0000</resolved>
                                                    <fixVersion>2.18.0</fixVersion>
                                    <component>sdk-py-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="13200">3h 40m</timespent>
                                <comments>
                            <comment id="16987381" author="bhulette" created="Wed, 4 Dec 2019 00:17:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yichi&quot; class=&quot;user-hover&quot; rel=&quot;yichi&quot;&gt;yichi&lt;/a&gt; it looks like you wrote mongodbio, do you have any thoughts on this?&lt;/p&gt;</comment>
                            <comment id="16987388" author="yichi" created="Wed, 4 Dec 2019 00:31:33 +0000"  >&lt;p&gt;I&apos;ll take a look.&lt;/p&gt;</comment>
                            <comment id="16987394" author="corvin" created="Wed, 4 Dec 2019 00:51:14 +0000"  >&lt;p&gt;Hi there, I found the issue.&#160;&lt;/p&gt;

&lt;p&gt;When querying the split-vector from mongo in _get_split_keys, the function returns a list of dicts with the structure { _id: ObjectId(...) } . The split function in L165 the iterates through the list of dicts instead of a list if ObjectIds (at L174). This causes the min statement in L177 to fail.&lt;/p&gt;

&lt;p&gt;Line numbers all refer to this file:&#160;&lt;a href=&quot;https://github.com/apache/beam/blob/b7fad128a710213267683f3ecf3f890c7a3b82d9/sdks/python/apache_beam/io/mongodbio.py&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/b7fad128a710213267683f3ecf3f890c7a3b82d9/sdks/python/apache_beam/io/mongodbio.py&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I tried a local version and unpacked the list of dicts into a list of ObjectIds and that worked. Hope it helps!&lt;/p&gt;</comment>
                            <comment id="16987414" author="yichi" created="Wed, 4 Dec 2019 01:38:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=corvin&quot; class=&quot;user-hover&quot; rel=&quot;corvin&quot;&gt;corvin&lt;/a&gt;&#160;yeah it seems so, thanks.&lt;/p&gt;</comment>
                            <comment id="16987415" author="yichi" created="Wed, 4 Dec 2019 01:40:02 +0000"  >&lt;p&gt;I was under the impression that the command only returns a list of ObjectId,&#160; will check if there exists a version compatibility issue.&lt;/p&gt;</comment>
                            <comment id="16987422" author="corvin" created="Wed, 4 Dec 2019 01:50:37 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yichi&quot; class=&quot;user-hover&quot; rel=&quot;yichi&quot;&gt;yichi&lt;/a&gt;, I tried with pymongo 3.8.0 and 3.9.0 so far, for both it was the same structure. Did not check any other versions. Thanks for the help and the module in the first place - greatly appreciated &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16987433" author="yichi" created="Wed, 4 Dec 2019 02:08:42 +0000"  >&lt;p&gt;Created another Jira&#160; &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-8886&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/BEAM-8886&lt;/a&gt;&#160;for a follow up to cover the failure scenario in test.&lt;/p&gt;</comment>
                            <comment id="16995266" author="udim" created="Fri, 13 Dec 2019 01:30:26 +0000"  >&lt;p&gt;I&apos;m adding this issue as a 2.18 blocker. Please remove if that is not the case.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 48 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z099b4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>