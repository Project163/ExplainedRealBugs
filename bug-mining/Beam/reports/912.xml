<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 10:54:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-6206] Dataflow template which reads from BigQuery fails if used more than once</title>
                <link>https://issues.apache.org/jira/browse/BEAM-6206</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;When a pipeline contains a BigQuery read, and when that pipeline is uploaded as a template and the template is run in Cloud Dataflow, it will run successfully the first time, but after that it will fail because it can&apos;t find a file in the folder BigQueryExtractTemp (see error message below). If the template is uploaded again it will work again &lt;ins&gt;once only&lt;/ins&gt; and then fail again every time after the first time.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Error message:&lt;/b&gt;&lt;br/&gt;
 java.io.FileNotFoundException: No files matched spec: gs://bigquery-bug-report-4539/temp/BigQueryExtractTemp/847a342637a64e73b126ad33f764dcc9/000000000000.avro&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Steps to reproduce:&lt;/b&gt;&lt;br/&gt;
 1. Create the Beam Word Count sample as described &lt;a href=&quot;https://cloud.google.com/dataflow/docs/quickstarts/quickstart-java-maven&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;2. Copy the command line from the section &quot;Run WordCount on the Cloud Dataflow service&quot; and substitute in your own project id and bucket name. Make sure you can run it successfully.&lt;/p&gt;

&lt;p&gt;3. In the file WordCount.java, add the following lines below the existing import statements:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.beam.sdk.coders.AvroCoder;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.beam.sdk.coders.DefaultCoder;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.beam.sdk.io.gcp.bigquery.BigQueryIO;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.beam.sdk.io.gcp.bigquery.SchemaAndRecord;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.beam.sdk.transforms.SerializableFunction;

@DefaultCoder(AvroCoder.class)
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TestOutput
{ 
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
 4. In this same file, replace the entire method runWordCount with the following code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void runWordCount(WordCountOptions options) {
  Pipeline p = Pipeline.create(options);

  p.apply(&lt;span class=&quot;code-quote&quot;&gt;&quot;ReadBigQuery&quot;&lt;/span&gt;, BigQueryIO
    .read(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SerializableFunction&amp;lt;SchemaAndRecord, TestOutput&amp;gt;() {
      &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; TestOutput apply(SchemaAndRecord record) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TestOutput();
      }
    })
    .from(&lt;span class=&quot;code-quote&quot;&gt;&quot;bigquery-&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt;-data:stackoverflow.tags&quot;&lt;/span&gt;)
  );

  p.run();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(Note I am using the stackoverflow.tags table for purposes of demonstration because it is public and not too large, but the problem seems to occur for any table).&lt;/p&gt;

&lt;p&gt;5. Add the following pipeline parameters to the command line that you have been using:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
--tempLocation=gs:&lt;span class=&quot;code-comment&quot;&gt;//&amp;lt;STORAGE_BUCKET&amp;gt;/temp/
&lt;/span&gt;--templateLocation=gs:&lt;span class=&quot;code-comment&quot;&gt;//&amp;lt;STORAGE_BUCKET&amp;gt;/my-bigquery-dataflow-template&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;6. Run the command line so that the template is created.&lt;/p&gt;

&lt;p&gt;7. Launch the template through the Cloud Console by clicking on &quot;CREATE JOB FROM TEMPLATE&quot;. Give it the job name &quot;test-1&quot;, choose &quot;Custom Template&quot; at the bottom of the list and browse to the template &quot;my-bigquery-dataflow-template&quot;, then press &quot;Run job&quot;.&lt;/p&gt;

&lt;p&gt;8. The job should succeed. But then repeat step 7 and it will fail.&lt;/p&gt;

&lt;p&gt;9. Repeat steps 6 and 7 and it will work again. Repeat step 7 and it will fail again.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This bug may be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-2058&quot; title=&quot;BigQuery load job id should be generated at run time, not submission time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-2058&quot;&gt;&lt;del&gt;BEAM-2058&lt;/del&gt;&lt;/a&gt; (just a hunch).&lt;/p&gt;</description>
                <environment></environment>
        <key id="13203628">BEAM-6206</key>
            <summary>Dataflow template which reads from BigQuery fails if used more than once</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chamikara">Chamikara Madhusanka Jayalath</assignee>
                                    <reporter username="nmc">Neil McCrossin</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Dec 2018 05:39:24 +0000</created>
                <updated>Sat, 16 May 2020 14:04:48 +0000</updated>
                            <resolved>Thu, 10 Jan 2019 16:15:37 +0000</resolved>
                                    <version>2.8.0</version>
                                    <fixVersion>Not applicable</fixVersion>
                                    <component>io-java-gcp</component>
                    <component>runner-dataflow</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="14400">4h</timespent>
                                <comments>
                            <comment id="16717845" author="nmc" created="Tue, 11 Dec 2018 19:29:41 +0000"  >&lt;p&gt;Probably the same issue as &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-5434&quot; title=&quot;Issue with BigQueryIO in Template&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-5434&quot;&gt;&lt;del&gt;BEAM-5434&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16739568" author="chamikara" created="Thu, 10 Jan 2019 16:15:12 +0000"  >&lt;p&gt;You have to use withTemplateCompatibility() for templates.&#160;&lt;/p&gt;

&lt;p&gt;Please re-open if this is still failing for you.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 44 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s01ds0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>