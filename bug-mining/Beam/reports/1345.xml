<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:01:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-7993] portable python precommit is flaky</title>
                <link>https://issues.apache.org/jira/browse/BEAM-7993</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;I&apos;m not sure what the root cause is here.&lt;/p&gt;

&lt;p&gt;Example log where :sdks:python:test-suites:portable:py35:portableWordCountBatch failed:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
11:51:22 [CHAIN MapPartition (MapPartition at [1]read/Read/Split) -&amp;gt; FlatMap (FlatMap at ExtractOutput[0]) (2/2)] ERROR org.apache.flink.runtime.operators.BatchTask - Error in task code:  CHAIN MapPartition (MapPartition at [1]read/Read/Split) -&amp;gt; FlatMap (FlatMap at ExtractOutput[0]) (2/2)
11:51:22 [CHAIN MapPartition (MapPartition at [1]read/Read/Split) -&amp;gt; FlatMap (FlatMap at ExtractOutput[0]) (1/2)] ERROR org.apache.flink.runtime.operators.BatchTask - Error in task code:  CHAIN MapPartition (MapPartition at [1]read/Read/Split) -&amp;gt; FlatMap (FlatMap at ExtractOutput[0]) (1/2)
11:51:22 [CHAIN MapPartition (MapPartition at [2]write/Write/WriteImpl/DoOnce/{FlatMap(&amp;lt;lambda at core.py:2457&amp;gt;), Map(decode)}) -&amp;gt; FlatMap (FlatMap at ExtractOutput[0]) (2/2)] ERROR org.apache.flink.runtime.operators.BatchTask - Error in task code:  CHAIN MapPartition (MapPartition at [2]write/Write/WriteImpl/DoOnce/{FlatMap(&amp;lt;lambda at core.py:2457&amp;gt;), Map(decode)}) -&amp;gt; FlatMap (FlatMap at ExtractOutput[0]) (2/2)
11:51:22 [CHAIN MapPartition (MapPartition at [2]write/Write/WriteImpl/DoOnce/{FlatMap(&amp;lt;lambda at core.py:2457&amp;gt;), Map(decode)}) -&amp;gt; FlatMap (FlatMap at ExtractOutput[0]) (1/2)] ERROR org.apache.flink.runtime.operators.BatchTask - Error in task code:  CHAIN MapPartition (MapPartition at [2]write/Write/WriteImpl/DoOnce/{FlatMap(&amp;lt;lambda at core.py:2457&amp;gt;), Map(decode)}) -&amp;gt; FlatMap (FlatMap at ExtractOutput[0]) (1/2)
11:51:22 java.lang.Exception: The user defined &lt;span class=&quot;code-quote&quot;&gt;&apos;open()&apos;&lt;/span&gt; method caused an exception: java.io.IOException: Received exit code 1 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; command &lt;span class=&quot;code-quote&quot;&gt;&apos;docker inspect -f {{.State.Running}} 642c312c335d3881b885873c66917b536e79cff07503fdceaddee5fbeb10bfd1&apos;&lt;/span&gt;. stderr: Error: No such object: 642c312c335d3881b885873c66917b536e79cff07503fdceaddee5fbeb10bfd1
11:51:22 	at org.apache.flink.runtime.operators.BatchTask.run(BatchTask.java:498)
11:51:22 	at org.apache.flink.runtime.operators.BatchTask.invoke(BatchTask.java:368)
11:51:22 	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:712)
11:51:22 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
11:51:22 Caused by: org.apache.beam.vendor.guava.v26_0_jre.com.google.common.util.concurrent.UncheckedExecutionException: java.io.IOException: Received exit code 1 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; command &lt;span class=&quot;code-quote&quot;&gt;&apos;docker inspect -f {{.State.Running}} 642c312c335d3881b885873c66917b536e79cff07503fdceaddee5fbeb10bfd1&apos;&lt;/span&gt;. stderr: Error: No such object: 642c312c335d3881b885873c66917b536e79cff07503fdceaddee5fbeb10bfd1
11:51:22 	at org.apache.beam.vendor.guava.v26_0_jre.com.google.common.cache.LocalCache$LocalLoadingCache.getUnchecked(LocalCache.java:4966)
11:51:22 	at org.apache.beam.runners.fnexecution.control.DefaultJobBundleFactory$SimpleStageBundleFactory.&amp;lt;init&amp;gt;(DefaultJobBundleFactory.java:211)
11:51:22 	at org.apache.beam.runners.fnexecution.control.DefaultJobBundleFactory$SimpleStageBundleFactory.&amp;lt;init&amp;gt;(DefaultJobBundleFactory.java:202)
11:51:22 	at org.apache.beam.runners.fnexecution.control.DefaultJobBundleFactory.forStage(DefaultJobBundleFactory.java:185)
11:51:22 	at org.apache.beam.runners.flink.translation.functions.FlinkDefaultExecutableStageContext.getStageBundleFactory(FlinkDefaultExecutableStageContext.java:49)
11:51:22 	at org.apache.beam.runners.flink.translation.functions.ReferenceCountingFlinkExecutableStageContextFactory$WrappedContext.getStageBundleFactory(ReferenceCountingFlinkExecutableStageContextFactory.java:203)
11:51:22 	at org.apache.beam.runners.flink.translation.functions.FlinkExecutableStageFunction.open(FlinkExecutableStageFunction.java:129)
11:51:22 	at org.apache.flink.api.common.functions.util.FunctionUtils.openFunction(FunctionUtils.java:36)
11:51:22 	at org.apache.flink.runtime.operators.BatchTask.run(BatchTask.java:494)
11:51:22 	... 3 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/beam_PreCommit_Portable_Python_Commit/5512/consoleFull&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/beam_PreCommit_Portable_Python_Commit/5512/consoleFull&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13251327">BEAM-7993</key>
            <summary>portable python precommit is flaky</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markflyhigh">Mark Liu</assignee>
                                    <reporter username="udim">Udi Meiri</reporter>
                        <labels>
                            <label>currently-failing</label>
                            <label>flake</label>
                    </labels>
                <created>Fri, 16 Aug 2019 19:57:51 +0000</created>
                <updated>Wed, 24 Mar 2021 21:15:23 +0000</updated>
                            <resolved>Mon, 9 Sep 2019 19:38:56 +0000</resolved>
                                    <version>2.15.0</version>
                                    <fixVersion>Not applicable</fixVersion>
                                    <component>sdk-py-core</component>
                    <component>test-failures</component>
                    <component>testing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="19800">5.5h</timespent>
                                <comments>
                            <comment id="16909362" author="udim" created="Fri, 16 Aug 2019 20:01:00 +0000"  >&lt;p&gt;Similar failures:&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/beam_PreCommit_Portable_Python_Commit/5505/consoleFull&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/beam_PreCommit_Portable_Python_Commit/5505/consoleFull&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/beam_PreCommit_Portable_Python_Commit/5508/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/beam_PreCommit_Portable_Python_Commit/5508/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tvalentyn&quot; class=&quot;user-hover&quot; rel=&quot;tvalentyn&quot;&gt;tvalentyn&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=robertwb&quot; class=&quot;user-hover&quot; rel=&quot;robertwb&quot;&gt;robertwb&lt;/a&gt;: Could either of you forward this to someone for triage?&lt;/p&gt;</comment>
                            <comment id="16910749" author="markflyhigh" created="Mon, 19 Aug 2019 20:55:47 +0000"  >&lt;p&gt;Same issue made &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Beam/view/PostCommit/job/beam_PreCommit_Portable_Python_Cron/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;beam_PreCommit_Portable_Python_Cron&lt;/a&gt; very flaky recently. It failed only py35 batch and streaming wordcount test. py2 test passed as expected.&lt;/p&gt;

&lt;p&gt;A most recent failure: &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Beam/view/PostCommit/job/beam_PreCommit_Portable_Python_Cron/1044/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Beam/view/PostCommit/job/beam_PreCommit_Portable_Python_Cron/1044/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16910806" author="ibzib" created="Mon, 19 Aug 2019 22:44:56 +0000"  >&lt;p&gt;It looks like we are only waiting one minute for the Dockerized SDK workers to start:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/beam/blob/c2f0d282337f3ae0196a7717712396a5a41fdde1/runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/environment/DockerEnvironmentFactory.java#L157-L160&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/blob/c2f0d282337f3ae0196a7717712396a5a41fdde1/runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/environment/DockerEnvironmentFactory.java#L157-L160&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We should probably wait longer for the Docker containers to start before giving up.&lt;/p&gt;</comment>
                            <comment id="16911648" author="hannahjiang" created="Tue, 20 Aug 2019 18:42:00 +0000"  >&lt;p&gt;A side note about this test:&lt;br/&gt;
Now we only have py2 and py35, so it only fails with py35. I am introducing minor versions, which will add py36 and py37, and all py3 are flaky.&lt;br/&gt;
It&apos;s really difficult to pass Portable Precommit with minor versions, the chance of passing the test is around 15%.&lt;br/&gt;
&#160;&lt;br/&gt;
From Ahmet:&#160;&lt;br/&gt;
perhaps we need different pre commits for different versions so that flakes do not stack up. Even if a suite is &amp;gt;90% reliable, if we stack up with 4 version, the reliability will get much lower.&lt;/p&gt;</comment>
                            <comment id="16911654" author="ibzib" created="Tue, 20 Aug 2019 18:51:29 +0000"  >&lt;p&gt;I didn&apos;t realize this only seems to be affecting Python 3. That&apos;s suspicious.&lt;/p&gt;</comment>
                            <comment id="16911657" author="hannahjiang" created="Tue, 20 Aug 2019 18:54:08 +0000"  >&lt;p&gt;&lt;del&gt;ah, this happens to py2 as well, but not as frequent as py3, according to the samples I observed so far.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;&lt;del&gt;examples:&lt;/del&gt;&#160;&lt;a href=&quot;#top=0-&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;-https://scans.gradle.com/s/eja72nxfk7uzq/failure#top=0-&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;sorry, I shared a wrong link. Then all failures I observed were on py3.&lt;/p&gt;</comment>
                            <comment id="16911659" author="ibzib" created="Tue, 20 Aug 2019 18:56:44 +0000"  >&lt;p&gt;It is possible the Docker containers are failing to start for some reason, then are immediately being removed (because of the --rm argument &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://docs.docker.com/engine/reference/run/#clean-up---rm&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;[1]&#160;https://docs.docker.com/engine/reference/run/#clean-up---rm&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16911661" author="ibzib" created="Tue, 20 Aug 2019 19:01:43 +0000"  >&lt;p&gt;Thanks for sharing Hannah. The failure you linked actually looks subtly different than the other failures &#8211; it couldn&apos;t find the container image, while elsewhere the problem was that the container image was presumably fetched successfully but then failed to start up properly.&lt;/p&gt;</comment>
                            <comment id="16911675" author="ibzib" created="Tue, 20 Aug 2019 19:08:24 +0000"  >&lt;p&gt;It would be useful to retain the containers briefly so we can print their logs if they fail. We could then remove them immediately after to prevent wasting disk space.&lt;/p&gt;</comment>
                            <comment id="16911712" author="ardagan" created="Tue, 20 Aug 2019 20:28:30 +0000"  >&lt;p&gt;This seem to fail python precommits consistently lately&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/beam_PreCommit_Portable_Python_Cron/1048/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/beam_PreCommit_Portable_Python_Cron/1048/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16911719" author="ibzib" created="Tue, 20 Aug 2019 20:44:26 +0000"  >&lt;p&gt;I created&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-8015&quot; title=&quot;Get logs for SDK worker Docker containers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-8015&quot;&gt;&lt;del&gt;BEAM-8015&lt;/del&gt;&lt;/a&gt; to help debug this issue.&lt;/p&gt;</comment>
                            <comment id="16917275" author="ibzib" created="Tue, 27 Aug 2019 23:50:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/beam_PreCommit_Portable_Python_Commit/5720/consoleFull&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/beam_PreCommit_Portable_Python_Commit/5720/consoleFull&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We now have container logs for the most recent failure. Looks like this is the root cause:&lt;/p&gt;

&lt;p&gt;16:04:21 Traceback (most recent call last):&lt;br/&gt;
16:04:21 File &quot;/usr/local/lib/python3.5/runpy.py&quot;, line 183, in _run_module_as_main&lt;br/&gt;
16:04:21 mod_name, mod_spec, code = _get_module_details(mod_name, _Error)&lt;br/&gt;
16:04:21 File &quot;/usr/local/lib/python3.5/runpy.py&quot;, line 109, in _get_module_details&lt;br/&gt;
16:04:21 _&lt;em&gt;import&lt;/em&gt;_(pkg_name)&lt;br/&gt;
16:04:21 File &quot;/usr/local/lib/python3.5/site-packages/apache_beam/_&lt;em&gt;init&lt;/em&gt;_.py&quot;, line 97, in &amp;lt;module&amp;gt;&lt;br/&gt;
16:04:21 from apache_beam import coders&lt;br/&gt;
16:04:21 File &quot;/usr/local/lib/python3.5/site-packages/apache_beam/coders/_&lt;em&gt;init&lt;/em&gt;_.py&quot;, line 19, in &amp;lt;module&amp;gt;&lt;br/&gt;
16:04:21 from apache_beam.coders.coders import *&lt;br/&gt;
16:04:21 File &quot;/usr/local/lib/python3.5/site-packages/apache_beam/coders/coders.py&quot;, line 33, in &amp;lt;module&amp;gt;&lt;br/&gt;
16:04:21 from apache_beam.coders import coder_impl&lt;br/&gt;
16:04:21 File &quot;apache_beam/utils/windowed_value.pxd&quot;, line 28, in init apache_beam.coders.coder_impl&lt;br/&gt;
16:04:21 File &quot;apache_beam/utils/windowed_value.py&quot;, line 34, in init apache_beam.utils.windowed_value&lt;br/&gt;
16:04:21 File &quot;/usr/local/lib/python3.5/site-packages/apache_beam/utils/timestamp.py&quot;, line 34, in &amp;lt;module&amp;gt;&lt;br/&gt;
16:04:21 from apache_beam.portability import common_urns&lt;br/&gt;
16:04:21 File &quot;/usr/local/lib/python3.5/site-packages/apache_beam/portability/common_urns.py&quot;, line 24, in &amp;lt;module&amp;gt;&lt;br/&gt;
16:04:21 from apache_beam.portability.api import beam_runner_api_pb2&lt;br/&gt;
16:04:21 File &quot;/usr/local/lib/python3.5/site-packages/apache_beam/portability/api/beam_runner_api_pb2.py&quot;, line 16, in &amp;lt;module&amp;gt;&lt;br/&gt;
16:04:21 import endpoints_pb2 as endpoints__pb2&lt;br/&gt;
16:04:21 ImportError: No module named &apos;endpoints_pb2&apos;&lt;/p&gt;</comment>
                            <comment id="16917279" author="ibzib" created="Tue, 27 Aug 2019 23:52:51 +0000"  >&lt;p&gt;This looks like the same error that caused&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-7527&quot; title=&quot;Python 3 test parallelization causes  test flakines due to ModuleNotFoundError.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-7527&quot;&gt;&lt;del&gt;BEAM-7527&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16918727" author="markflyhigh" created="Thu, 29 Aug 2019 15:50:48 +0000"  >&lt;p&gt;Looks like same issue in &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-7527&quot; title=&quot;Python 3 test parallelization causes  test flakines due to ModuleNotFoundError.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-7527&quot;&gt;&lt;del&gt;BEAM-7527&lt;/del&gt;&lt;/a&gt;. It happens if multiple &apos;python setup.py&apos; run concurrently under same project. In portable precommit, py2 and py3 tests are triggered at same time. It&apos;s likely that part of the test call setuptool and unfortunately conflict with each other.&lt;/p&gt;</comment>
                            <comment id="16918758" author="hannahjiang" created="Thu, 29 Aug 2019 16:26:33 +0000"  >&lt;p&gt;I am not sure if this is the root cause, because it doesn&#8217;t answer following two questions.&lt;br/&gt;
1. Why it doesn&#8217;t happen at local?&lt;br/&gt;
2. Why only py3 fails, but not py2?&lt;/p&gt;

&lt;p&gt;I will try to not parallel run portable tests later today to see if the problem is solved. &lt;/p&gt;</comment>
                            <comment id="16919211" author="hannahjiang" created="Fri, 30 Aug 2019 05:40:17 +0000"  >&lt;p&gt;I tried to run at local with py2 and py36.&lt;/p&gt;

&lt;p&gt;I ran more than 10 times, and all of them parallel running py2 and py36 and no one failed. So I haven&apos;t try to run one by one, because it doesn&apos;t explain non-parallel run would solve the problem.&lt;/p&gt;

&lt;p&gt;I wrote a build.gradle to trigger python portable precommit job at local. Jenkins uses a job to build the tasks, so it might not be exactly same.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markflyhigh&quot; class=&quot;user-hover&quot; rel=&quot;markflyhigh&quot;&gt;markflyhigh&lt;/a&gt;, are you familiar with gradle/jenkins? I try to remove parallel part from the Jenkins job, but all precommit job share the same job builder, impact range is very big. Is it possible for you to remove parallel part for Python Portable Precommit tasks only?&lt;/p&gt;</comment>
                            <comment id="16919734" author="markflyhigh" created="Fri, 30 Aug 2019 17:09:25 +0000"  >&lt;p&gt;I don&apos;t have much insight to test itself. But let&apos;s make those tests running sequentially and see how it goes.&lt;/p&gt;</comment>
                            <comment id="16919866" author="hannahjiang" created="Fri, 30 Aug 2019 20:21:08 +0000"  >&lt;p&gt;I investigated a little more.&lt;/p&gt;

&lt;p&gt;We are not parallel running multiple sdist tasks for&#160;Python portable precommit tasks. Only one sdist task is running and all precommit tasks depend on it , which means all precommit tests are sharing the same beam tar ball, so I think we do have&#160;endpoints_pb2.py, because it doesn&apos;t fail with py2. But somehow, it is not recognized by py3.&lt;/p&gt;

&lt;p&gt;We need to investigate&#160;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Is above conclusion correct?&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markflyhigh&quot; class=&quot;user-hover&quot; rel=&quot;markflyhigh&quot;&gt;markflyhigh&lt;/a&gt;, can you please help with it?&lt;/li&gt;
	&lt;li&gt;why import failure only happens at Jenkins, but not at local? What is env diff? who can help with it?&lt;/li&gt;
	&lt;li&gt;why import doesn&apos;t fail some time? If it&apos;s a py3 issue, it should happen consistently, but it doesn&apos;t fail some time, though this chance is small. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tvalentyn&quot; class=&quot;user-hover&quot; rel=&quot;tvalentyn&quot;&gt;tvalentyn&lt;/a&gt;, do you have any insights?&lt;/li&gt;
	&lt;li&gt;anything I missed here..&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="16919934" author="markflyhigh" created="Fri, 30 Aug 2019 22:28:53 +0000"  >&lt;p&gt;Thank you for investigating Hannah. You are right, only one sdist runs and both py2 and py35 container use same output tarball. So now, I don&apos;t know what cause this ImportError. It&apos;s likely py35 container wasn&apos;t built correctly, or some step in pipeline execution is wrong under current test configurations. &lt;/p&gt;

&lt;p&gt;Just in case, I still refactord the Jenkins config to make those tests run in sequential. Let&apos;s see if the failure still exist or not.&lt;/p&gt;</comment>
                            <comment id="16919973" author="tvalentyn" created="Sat, 31 Aug 2019 00:18:21 +0000"  >&lt;p&gt;If the error is reoccurring, we could try to SSH into the VM, SSH into the failed container and inspect contents of SDK tarball, or installed version of Beam SDK in the container. If SDK tarball differs in passing (say, python2) and failing (python3) container for a postcommit run against the same PR, it may mean that we build SDK tarball twice, and as we know, it does not work well if we build it in parallel. Perhaps we can find out other clues. &lt;/p&gt;</comment>
                            <comment id="16920279" author="hannahjiang" created="Sun, 1 Sep 2019 04:27:28 +0000"  >&lt;p&gt;Thanks Mark for trying it out.&lt;/p&gt;

&lt;p&gt;I analyzed last 60 Python Portable Precommit tests from Jenkins to see if I can find some patterns. There was no obvious patterns, however, all tests submitted to Jenkins agent12 failed. It&apos;s also more likely to fail if we parallel run multiple Python Portable Precommit tests on the same agent, which means we may be running multiple sdist parallel in this case(It&apos;s depending on test start time, sdist running at first part, so if two test start time is close, they may run sdist parallel.). However, even if we run only one Python Portable Precommit test in an agent the failure still happens, so it&apos;s not enough to say parallel running sdist caused this issue. However, it&apos;s still worth to check it out.&lt;/p&gt;

&lt;p&gt;I attached a list of these 60 tests in case it can help you any way. &lt;br/&gt;
&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12979058/12979058_Python_Portable_Precommit.pdf&quot; title=&quot;Python_Portable_Precommit.pdf attached to BEAM-7993&quot;&gt;Python_Portable_Precommit.pdf&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; &lt;/p&gt;</comment>
                            <comment id="16921732" author="markflyhigh" created="Tue, 3 Sep 2019 21:29:54 +0000"  >&lt;p&gt;As &lt;a href=&quot;https://github.com/apache/beam/pull/9460&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/9460&lt;/a&gt; is merged, py2 and py3 test will run sequentially in single job.&lt;/p&gt;</comment>
                            <comment id="16926044" author="markflyhigh" created="Mon, 9 Sep 2019 19:37:23 +0000"  >&lt;p&gt;This Jenkins suite back to green consistently for a week. Job history from &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Beam/view/PostCommit/job/beam_PreCommit_Portable_Python_Cron/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Beam/view/PostCommit/job/beam_PreCommit_Portable_Python_Cron/&lt;/a&gt;. The sdist build will only run once due to changes from &lt;a href=&quot;https://github.com/apache/beam/pull/9277&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/beam/pull/9277&lt;/a&gt;. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13251924">BEAM-8015</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13238664">BEAM-7527</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12979058" name="Python_Portable_Precommit.pdf" size="50636" author="hannahjiang" created="Sun, 1 Sep 2019 04:27:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z05r48:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>