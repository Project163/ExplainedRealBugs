<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:00:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-7860] v1new ReadFromDatastore returns duplicates if keys are of mixed types</title>
                <link>https://issues.apache.org/jira/browse/BEAM-7860</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;In the presence of mixed type keys, v1new ReadFromDatastore may return duplicate items. The attached example returns 4 records, not the expected 3.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// code placeholder
&lt;/span&gt;from __future__ &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; unicode_literals
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; apache_beam as beam
from apache_beam.io.gcp.datastore.v1new.types &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; Key, Entity, Query
from apache_beam.io.gcp.datastore.v1new &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; datastoreio


config = dict(project=&lt;span class=&quot;code-quote&quot;&gt;&apos;your-google-project&apos;&lt;/span&gt;, namespace=&lt;span class=&quot;code-quote&quot;&gt;&apos;test&apos;&lt;/span&gt;)


def test_mixed():
    keys = [
        Key([&lt;span class=&quot;code-quote&quot;&gt;&apos;mixed&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;10038260-iperm_eservice&apos;&lt;/span&gt;], **config),
        Key([&lt;span class=&quot;code-quote&quot;&gt;&apos;mixed&apos;&lt;/span&gt;, 4812224868188160], **config),
        Key([&lt;span class=&quot;code-quote&quot;&gt;&apos;mixed&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;99152975-pointshop&apos;&lt;/span&gt;], **config)
    ]

    entities = map(lambda key: Entity(key=key), keys)

    with beam.Pipeline() as p:
        (p
            | beam.Create(entities)
            | datastoreio.WriteToDatastore(project=config[&lt;span class=&quot;code-quote&quot;&gt;&apos;project&apos;&lt;/span&gt;])
        )

    query = Query(kind=&lt;span class=&quot;code-quote&quot;&gt;&apos;mixed&apos;&lt;/span&gt;, **config)

    with beam.Pipeline() as p:
        (p
            | datastoreio.ReadFromDatastore(query=query, num_splits=4)
            | beam.io.WriteToText(&lt;span class=&quot;code-quote&quot;&gt;&apos;tmp.txt&apos;&lt;/span&gt;, num_shards=1, shard_name_template=&apos;&apos;)
    )

    items = open(&lt;span class=&quot;code-quote&quot;&gt;&apos;tmp.txt&apos;&lt;/span&gt;).read().strip().split(&lt;span class=&quot;code-quote&quot;&gt;&apos;\n&apos;&lt;/span&gt;)
    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; len(items) == 3, &lt;span class=&quot;code-quote&quot;&gt;&apos;incorrect number of items&apos;&lt;/span&gt;


&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>Python 2.7&lt;br/&gt;
Python 3.7</environment>
        <key id="13248109">BEAM-7860</key>
            <summary>v1new ReadFromDatastore returns duplicates if keys are of mixed types</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10100" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">P0</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="udim">Udi Meiri</assignee>
                                    <reporter username="innohead">Niels Stender</reporter>
                        <labels>
                    </labels>
                <created>Wed, 31 Jul 2019 13:14:45 +0000</created>
                <updated>Sat, 16 May 2020 14:21:42 +0000</updated>
                            <resolved>Tue, 13 Aug 2019 17:55:20 +0000</resolved>
                                    <version>2.13.0</version>
                                    <fixVersion>2.15.0</fixVersion>
                                    <component>io-py-gcp</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="7800">2h 10m</timespent>
                                <comments>
                            <comment id="16899271" author="udim" created="Fri, 2 Aug 2019 23:13:45 +0000"  >&lt;p&gt;Verified that this happens in both v1 and v1new.&lt;/p&gt;

&lt;p&gt;Edit: not verified in v1 after all (I thought I could reproduce in a unit test, but I had a bug).&lt;br/&gt;
I did recreate the issue in v1new using the sample code.&lt;/p&gt;</comment>
                            <comment id="16899273" author="udim" created="Fri, 2 Aug 2019 23:18:10 +0000"  >&lt;p&gt;It should be possible to work around this by setting num_splits=1 in ReadFromDatastore. You&apos;ll get a SplitNotPossibleError and performance will suffer (depending on the size of the result), but it&apos;ll be correct.&lt;/p&gt;</comment>
                            <comment id="16901244" author="yifanzou" created="Tue, 6 Aug 2019 16:33:04 +0000"  >&lt;p&gt;Any ETA on this?&lt;/p&gt;</comment>
                            <comment id="16902366" author="udim" created="Wed, 7 Aug 2019 18:00:41 +0000"  >&lt;p&gt;Hopefully PR will be merged today.&lt;/p&gt;</comment>
                            <comment id="16902396" author="yifanzou" created="Wed, 7 Aug 2019 18:43:58 +0000"  >&lt;p&gt;Great, thanks!&lt;/p&gt;</comment>
                            <comment id="16902495" author="udim" created="Wed, 7 Aug 2019 21:57:35 +0000"  >&lt;p&gt;merged&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 14 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0579s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>