<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 11:24:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[BEAM-14153] Reshuffled Row Coder PCollection used direct to Side Input breaks Dataflow &amp; PyPortable</title>
                <link>https://issues.apache.org/jira/browse/BEAM-14153</link>
                <project id="12319527" key="BEAM">Beam</project>
                    <description>&lt;p&gt;Since First class Iterable side inputs were implemented, passing a reshuffled PCollection directly to a Side Input will cause a coder mismatch between encoding the reshuffle and decoding it on Dataflow and on Python Portable. In particular, the Row values will be encoded without a Length Prefix, but then be requested to decode them with a length prefix, which wasn&apos;t included.&lt;/p&gt;

&lt;p&gt;This is similar to the issue in &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-12438&quot; title=&quot;Sharing input to both a GBK and a CoGBK causes LP error w/schemas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-12438&quot;&gt;&lt;del&gt;BEAM-12438&lt;/del&gt;&lt;/a&gt; which has been hacked around. &lt;/p&gt;

&lt;p&gt;In this instance it&apos;s likely more resilient to always length prefix Row encoded types, and make it explicit in the pipeline proto. This should avoid issues with runners having odd behaviors WRT row coders at this time, while not preventing them from introspecting row encoded values should they chose. This may also allow us to avoid the hack for &lt;a href=&quot;https://issues.apache.org/jira/browse/BEAM-12438&quot; title=&quot;Sharing input to both a GBK and a CoGBK causes LP error w/schemas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BEAM-12438&quot;&gt;&lt;del&gt;BEAM-12438&lt;/del&gt;&lt;/a&gt;, though that is something to be verified independently.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13435205">BEAM-14153</key>
            <summary>Reshuffled Row Coder PCollection used direct to Side Input breaks Dataflow &amp; PyPortable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10102" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">P2</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lostluck">Robert Burke</assignee>
                                    <reporter username="lostluck">Robert Burke</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Mar 2022 21:41:16 +0000</created>
                <updated>Fri, 1 Apr 2022 16:22:50 +0000</updated>
                            <resolved>Fri, 1 Apr 2022 16:22:50 +0000</resolved>
                                    <version>2.37.0</version>
                    <version>2.38.0</version>
                                    <fixVersion>2.39.0</fixVersion>
                                    <component>sdk-go</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="13200">3h 40m</timespent>
                                <comments>
                            <comment id="17512127" author="danoliveira" created="Thu, 24 Mar 2022 23:34:05 +0000"  >&lt;p&gt;I&apos;m looking at release-blocking bugs and trying to see if any can be safely removed from the list of release blockers.&lt;/p&gt;

&lt;p&gt;What&apos;s the status on this? It does sound like a regression which indicates that it&apos;s a release blocker, but how soon is a fix incoming? If a fix isn&apos;t coming soon, is it a major regression or something that can easily be worked around? It sounds pretty specific to trigger this since it needs to be a reshuffled PCollection, maybe we can just provide workaround instructions along with marking this as a known issue?&lt;/p&gt;</comment>
                            <comment id="17512131" author="lostluck" created="Thu, 24 Mar 2022 23:45:47 +0000"  >&lt;p&gt;It would have been a regression if caught during the 2.37 release, when it was introduced, but it was a very strange situation to end up here, and it only breaks in Dataflow (where it&apos;s unlikely to be used as a construct) and the PyPortable runner (which isn&apos;t easy to use vs Flink or Spark, which aren&apos;t affected.)&lt;/p&gt;

&lt;p&gt;Bumping to be fixed for 2.39, and not block 2.38. I was just ambitious about when I could get a fix in this week.&lt;/p&gt;</comment>
                            <comment id="17514282" author="lostluck" created="Tue, 29 Mar 2022 19:08:27 +0000"  >&lt;p&gt;Now that I&apos;ve got a chance to look at this, the right move is to serialize the coder used for encodings/decodings with the reshuffle transforms. This bug, and the similar one with CoGBK inject both stem from this.&lt;/p&gt;

&lt;p&gt;So the fix would be to add a payload for reshuflle (and extend the one for inject) that will contain the serialized coder protos, and use those for encoding/decoding the types, instead of pulling the coders from the PTransforms.&lt;br/&gt;
A check should be added to ensure that the element types of the incoming and outgoing PCollections match the decoded elements, and this will avoid the issue around recoding the types, leading to the bug.&lt;/p&gt;

&lt;p&gt;The construct is also one of the rare cases we could add an optimized step in the SDK to &lt;b&gt;avoid&lt;/b&gt; doing any decoding/encoding in the stage if the types of the received encoded values from the DataSource are the same as what needs to be sent to the DataSink (modulo the reshuffle key) are the same and no user dofns are in the way. That would be a different JIRA ticket though.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 32 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z10q2o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>