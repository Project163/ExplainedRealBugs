{"url":"https://api.github.com/repos/prettier/prettier/issues/9702","repository_url":"https://api.github.com/repos/prettier/prettier","labels_url":"https://api.github.com/repos/prettier/prettier/issues/9702/labels{/name}","comments_url":"https://api.github.com/repos/prettier/prettier/issues/9702/comments","events_url":"https://api.github.com/repos/prettier/prettier/issues/9702/events","html_url":"https://github.com/prettier/prettier/issues/9702","id":744972854,"node_id":"MDU6SXNzdWU3NDQ5NzI4NTQ=","number":9702,"title":"Plugin cannot print trailing comments without newline at end of file","user":{"login":"dangmai","id":1305527,"node_id":"MDQ6VXNlcjEzMDU1Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/1305527?v=4","gravatar_id":"","url":"https://api.github.com/users/dangmai","html_url":"https://github.com/dangmai","followers_url":"https://api.github.com/users/dangmai/followers","following_url":"https://api.github.com/users/dangmai/following{/other_user}","gists_url":"https://api.github.com/users/dangmai/gists{/gist_id}","starred_url":"https://api.github.com/users/dangmai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dangmai/subscriptions","organizations_url":"https://api.github.com/users/dangmai/orgs","repos_url":"https://api.github.com/users/dangmai/repos","events_url":"https://api.github.com/users/dangmai/events{/privacy}","received_events_url":"https://api.github.com/users/dangmai/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":520495035,"node_id":"MDU6TGFiZWw1MjA0OTUwMzU=","url":"https://api.github.com/repos/prettier/prettier/labels/area:comments","name":"area:comments","color":"fbca04","default":false,"description":"Issues with how Prettier prints comments"},{"id":985033474,"node_id":"MDU6TGFiZWw5ODUwMzM0NzQ=","url":"https://api.github.com/repos/prettier/prettier/labels/locked-due-to-inactivity","name":"locked-due-to-inactivity","color":"000000","default":false,"description":"Please open a new issue and fill out the template instead of commenting."}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2020-11-17T18:18:38Z","updated_at":"2025-03-03T19:04:35Z","closed_at":"2020-11-18T10:58:47Z","author_association":"MEMBER","type":{"id":5763486,"node_id":"IT_kwDOAYoGC84AV_Ge","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-30T10:19:56Z","updated_at":"2024-07-26T11:33:03Z","is_enabled":true},"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n\r\nBEFORE SUBMITTING AN ISSUE:\r\n\r\n1.  Search for your issue on GitHub: https://github.com/prettier/prettier/issues\r\n    A large number of opened issues are duplicates of existing issues.\r\n    If someone has already opened an issue for what you are experiencing,\r\n    you do not need to open a new issue â€” please add a ðŸ‘ reaction to the\r\n    existing issue instead.\r\n\r\n2.  If your issue is with a prettier editor extension or add-on, please open the\r\n    issue in the repo for that extension or add-on, instead of this repo.\r\n\r\n-->\r\n\r\n**Environments:**\r\n\r\n- Prettier Version: 2.1.2\r\n- Running Prettier via: CLI\r\n- Runtime: Node.js v14\r\n- Operating System: Windows/Linux\r\n\r\n**Steps to reproduce:**\r\n\r\nI am the maintainer for [prettier-plugin-apex](https://github.com/dangmai/prettier-plugin-apex), which has an option to turn off the empty newline at the end of the formatted file (this is due to Salesforce's weird handling of empty lines). Recently a user [reports](https://github.com/dangmai/prettier-plugin-apex/issues/301) that when he uses that option, trailing comments are not being included in the formatted result.\r\n\r\nI look into Prettier's core code and I've found that trailing comments are only flushed in the output if there is a new line somewhere after the comment, because a trailing comment uses `line-suffix`, and contents within line-suffix are only flushed after a new line, see [here](https://github.com/prettier/prettier/blob/31e7c1d04e00a5b1f9c20ba6244d3cd7d6f6506b/src/document/doc-printer.js#L505).\r\n\r\nI know most Prettier languages do not support removing the trailing empty lines, but I do think some language plugins do need this depending on the language ecosystem they're supporting. Here are a couple of options that can address this issue:\r\n\r\n- Prettier core can add a doc type that flushes line-suffix contents, similar to `line`, `softline` or `hardline`.\r\n- Alternatively, Prettier can add a `postprocess` for plugin printers, which allows plugins to manipulate the formatted result. If this is an option, my plugin can always add a trailing empty line to the returned Doc, and remove it as part of post-processing phase based on options.\r\n\r\nI know that in my plugin, I can implement `willPrintOwnComments` to work around this issue and make sure my comments are not in a `line-suffix`, however it's a very lengthy hack which IMO should be handled upstream. There may be other options that I haven't thought of as well, and I'm open to suggestions if anyone has any.","closed_by":{"login":"thorn0","id":94334,"node_id":"MDQ6VXNlcjk0MzM0","avatar_url":"https://avatars.githubusercontent.com/u/94334?v=4","gravatar_id":"","url":"https://api.github.com/users/thorn0","html_url":"https://github.com/thorn0","followers_url":"https://api.github.com/users/thorn0/followers","following_url":"https://api.github.com/users/thorn0/following{/other_user}","gists_url":"https://api.github.com/users/thorn0/gists{/gist_id}","starred_url":"https://api.github.com/users/thorn0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thorn0/subscriptions","organizations_url":"https://api.github.com/users/thorn0/orgs","repos_url":"https://api.github.com/users/thorn0/repos","events_url":"https://api.github.com/users/thorn0/events{/privacy}","received_events_url":"https://api.github.com/users/thorn0/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/prettier/prettier/issues/9702/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/prettier/prettier/issues/9702/timeline","performed_via_github_app":null,"state_reason":"completed"}