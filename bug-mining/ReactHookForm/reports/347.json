{"url":"https://api.github.com/repos/react-hook-form/react-hook-form/issues/6731","repository_url":"https://api.github.com/repos/react-hook-form/react-hook-form","labels_url":"https://api.github.com/repos/react-hook-form/react-hook-form/issues/6731/labels{/name}","comments_url":"https://api.github.com/repos/react-hook-form/react-hook-form/issues/6731/comments","events_url":"https://api.github.com/repos/react-hook-form/react-hook-form/issues/6731/events","html_url":"https://github.com/react-hook-form/react-hook-form/issues/6731","id":1019570065,"node_id":"I_kwDOCl-cD848xWeR","number":6731,"title":"[Bug]: Nested FieldArrays and setValue","user":{"login":"shark404","id":4898049,"node_id":"MDQ6VXNlcjQ4OTgwNDk=","avatar_url":"https://avatars.githubusercontent.com/u/4898049?v=4","gravatar_id":"","url":"https://api.github.com/users/shark404","html_url":"https://github.com/shark404","followers_url":"https://api.github.com/users/shark404/followers","following_url":"https://api.github.com/users/shark404/following{/other_user}","gists_url":"https://api.github.com/users/shark404/gists{/gist_id}","starred_url":"https://api.github.com/users/shark404/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shark404/subscriptions","organizations_url":"https://api.github.com/users/shark404/orgs","repos_url":"https://api.github.com/users/shark404/repos","events_url":"https://api.github.com/users/shark404/events{/privacy}","received_events_url":"https://api.github.com/users/shark404/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1260145696,"node_id":"MDU6TGFiZWwxMjYwMTQ1Njk2","url":"https://api.github.com/repos/react-hook-form/react-hook-form/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2021-10-07T03:32:52Z","updated_at":"2022-10-09T12:01:09Z","closed_at":"2021-10-07T07:08:39Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Version Number\n\n7.16.1 - 7.17.1\n\n### Codesandbox/Expo snack\n\nhttps://codesandbox.io/s/frosty-dubinsky-1bgj2\n\n### Steps to reproduce\n\n1. Go to https://codesandbox.io/s/frosty-dubinsky-1bgj2\r\n2. Click on \"Del\" next to \"Item 1\" to remove the middle Item\r\n3. Click on the now \"Item 1\" (previously Item 2) to \"select it\", should now have a grey background\r\n4. Click on \"Append to Item 1\"\r\n5. See error in console about state updates on an unmounted component.\r\n\r\nTracing this back it appears to have been introduced in the refactor of 7.16.1 to `useSubscribe`. At a guess I think the nested `useFieldArray` isn't handling when the name changes from `nest.2.nested` to `nest.1.nested` since React will be re-using that component due to the `key={field.id}` not changing.\r\n\r\nIf I remove the key fields to force React to unmount/remount everything all the time, everything works correctly. Maybe there is a dependency needed in a useEffect somewhere to resubscribe?\r\n\n\n### Expected behaviour\n\nA new sub item appended to the nested array of the last item.\n\n### What browsers are you seeing the problem on?\n\nFirefox, Chrome\n\n### Relevant log output\n\n```shell\nWarning: Can't perform a React state update on an unmounted component. This is a no-op, but it indicates a memory leak in your application. To fix, cancel all subscriptions and asynchronous tasks in a useEffect cleanup function.\r\nNested@https://1bgj2.csb.app/src/App.js:31:16\r\ndiv\r\n```\n```\n\n\n### Code of Conduct\n\n- [X] I agree to follow this project's Code of Conduct","closed_by":{"login":"bluebill1049","id":10513364,"node_id":"MDQ6VXNlcjEwNTEzMzY0","avatar_url":"https://avatars.githubusercontent.com/u/10513364?v=4","gravatar_id":"","url":"https://api.github.com/users/bluebill1049","html_url":"https://github.com/bluebill1049","followers_url":"https://api.github.com/users/bluebill1049/followers","following_url":"https://api.github.com/users/bluebill1049/following{/other_user}","gists_url":"https://api.github.com/users/bluebill1049/gists{/gist_id}","starred_url":"https://api.github.com/users/bluebill1049/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluebill1049/subscriptions","organizations_url":"https://api.github.com/users/bluebill1049/orgs","repos_url":"https://api.github.com/users/bluebill1049/repos","events_url":"https://api.github.com/users/bluebill1049/events{/privacy}","received_events_url":"https://api.github.com/users/bluebill1049/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/react-hook-form/react-hook-form/issues/6731/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/react-hook-form/react-hook-form/issues/6731/timeline","performed_via_github_app":null,"state_reason":"completed"}