{"url":"https://api.github.com/repos/react-hook-form/react-hook-form/issues/11937","repository_url":"https://api.github.com/repos/react-hook-form/react-hook-form","labels_url":"https://api.github.com/repos/react-hook-form/react-hook-form/issues/11937/labels{/name}","comments_url":"https://api.github.com/repos/react-hook-form/react-hook-form/issues/11937/comments","events_url":"https://api.github.com/repos/react-hook-form/react-hook-form/issues/11937/events","html_url":"https://github.com/react-hook-form/react-hook-form/issues/11937","id":2316896917,"node_id":"I_kwDOCl-cD86KGQqV","number":11937,"title":"issue: cleanup process in `useController` crashes when used with `useFieldArray` in certain cases","user":{"login":"nakaakist","id":6212292,"node_id":"MDQ6VXNlcjYyMTIyOTI=","avatar_url":"https://avatars.githubusercontent.com/u/6212292?v=4","gravatar_id":"","url":"https://api.github.com/users/nakaakist","html_url":"https://github.com/nakaakist","followers_url":"https://api.github.com/users/nakaakist/followers","following_url":"https://api.github.com/users/nakaakist/following{/other_user}","gists_url":"https://api.github.com/users/nakaakist/gists{/gist_id}","starred_url":"https://api.github.com/users/nakaakist/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nakaakist/subscriptions","organizations_url":"https://api.github.com/users/nakaakist/orgs","repos_url":"https://api.github.com/users/nakaakist/repos","events_url":"https://api.github.com/users/nakaakist/events{/privacy}","received_events_url":"https://api.github.com/users/nakaakist/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2024-05-25T10:06:05Z","updated_at":"2024-07-25T00:00:19Z","closed_at":"2024-05-25T21:46:35Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Version Number\r\n\r\n7.51.5\r\n\r\n### Codesandbox/Expo snack\r\n\r\nhttps://codesandbox.io/p/sandbox/react-hook-form-null-check-zqxx7v?file=%2Fsrc%2FApp.js\r\n\r\n### Steps to reproduce\r\n\r\n1. Go to the codesandbox.\r\n2. Click on \"remove 0th elem from array (will cause error)\" button\r\n3. See error\r\n\r\n\r\n### Expected behaviour\r\n\r\nThe error should not occur.\r\n\r\nThe cause of the error is as follows:\r\n\r\n- In the CodeSandbox, a form with the default value `{ arr: [{ k: 0 }, { k: 1 }] }` is rendered as follows:\r\n   - The 0th element of the `arr` field is rendered by the `<Zeroth />` component where the `\"arr.0\"` path is controlled by `useController`.\r\n   - The 1st element of the `arr` field is rendered by `<First />` component where the `\"arr.1.k\"` path is controlled by `useController`.\r\n- When the \"remove 0th elem\" button is clicked:\r\n   1. The 0th element is removed from the form's `control._fields`. Here, the resulting `control._fields` is `{ arr: [{ k: { _f: ... }] }` because `arr.1.k` is controlled by `useController`.\r\n   2. Both `<Zeroth />` and `<First />` components start to unmount.\r\n   3. When unmounting the `<Zeroth />` component, [the cleanup process in `useController`](https://github.com/react-hook-form/react-hook-form/blob/master/src/useController.ts#L103) for the `\"arr.0\"` path is executed. Here, this cleanup expects `control._fields` to be `{ arr: [{ k: ..., _f: ... }, ...] }`. However, as mentioned above, the `_f` field does not exist.\r\n   4. This causes the app to crash.\r\n\r\nAlthough the current example is too trivial to use `useController` (just the return values of `useFieldArray` are enough), in a complex form with heavily nested form values, using `useController` with `useFieldArray` can sometimes be more convenient.\r\n\r\n\r\n### What browsers are you seeing the problem on?\r\n\r\nChrome\r\n\r\n### Relevant log output\r\n\r\n_No response_\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow this project's Code of Conduct","closed_by":{"login":"bluebill1049","id":10513364,"node_id":"MDQ6VXNlcjEwNTEzMzY0","avatar_url":"https://avatars.githubusercontent.com/u/10513364?v=4","gravatar_id":"","url":"https://api.github.com/users/bluebill1049","html_url":"https://github.com/bluebill1049","followers_url":"https://api.github.com/users/bluebill1049/followers","following_url":"https://api.github.com/users/bluebill1049/following{/other_user}","gists_url":"https://api.github.com/users/bluebill1049/gists{/gist_id}","starred_url":"https://api.github.com/users/bluebill1049/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluebill1049/subscriptions","organizations_url":"https://api.github.com/users/bluebill1049/orgs","repos_url":"https://api.github.com/users/bluebill1049/repos","events_url":"https://api.github.com/users/bluebill1049/events{/privacy}","received_events_url":"https://api.github.com/users/bluebill1049/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/react-hook-form/react-hook-form/issues/11937/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/react-hook-form/react-hook-form/issues/11937/timeline","performed_via_github_app":null,"state_reason":"completed"}