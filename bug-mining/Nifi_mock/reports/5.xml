<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:45:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[NIFI-516] MergeContent when merging 10,000s or more objects can cause too many open files</title>
                <link>https://issues.apache.org/jira/browse/NIFI-516</link>
                <project id="12316020" key="NIFI">Apache NiFi</project>
                    <description>&lt;p&gt;MergeContent really is just exposing an issue where the process session keeps file handles open longer than necessary.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12820337">NIFI-516</key>
            <summary>MergeContent when merging 10,000s or more objects can cause too many open files</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jpercivall">Joe Percivall</assignee>
                                    <reporter username="joewitt">Joe Witt</reporter>
                        <labels>
                    </labels>
                <created>Sat, 11 Apr 2015 18:54:40 +0000</created>
                <updated>Wed, 16 May 2018 16:30:26 +0000</updated>
                            <resolved>Tue, 27 Oct 2015 00:51:56 +0000</resolved>
                                                    <fixVersion>0.4.0</fixVersion>
                                    <component>Core Framework</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14746160" author="markap14" created="Tue, 15 Sep 2015 20:51:58 +0000"  >&lt;p&gt;I think a good solution to this problem would be to add a new method to ProcessSession, so that when we call session.read(FlowFile, InputStreamCallback) we have the ability to pass a third argument: session.read(FlowFile flowFile, InputStreamCallback callback, boolean allowSessionStreamManagement);&lt;/p&gt;

&lt;p&gt;The existing read method could simply call this method passing &apos;true&apos; as the third argument. If true, it would behave as it does now, where the session is allows to hold the stream open for performance reasons. However, if passing false, the session should always close the InputStream before returning. Then, in MergeContent, we can just pass &apos;false&apos;, so that each of those sessions doesn&apos;t hold open those resources.&lt;/p&gt;</comment>
                            <comment id="14940279" author="jpercivall" created="Thu, 1 Oct 2015 19:32:49 +0000"  >&lt;p&gt;Added new &quot;read&quot; endpoint to close the stream in StandardProcessSession. Added a unit test and verified with attached flow&lt;/p&gt;</comment>
                            <comment id="14946840" author="markap14" created="Wed, 7 Oct 2015 13:22:57 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=JPercivall&quot; class=&quot;user-hover&quot; rel=&quot;jpercivall&quot;&gt;JPercivall&lt;/a&gt; thanks for knocking this out! Looks good, for the most part, but one section of the patch concerns me just a bit:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+
+                &lt;span class=&quot;code-comment&quot;&gt;// Allow processors to close the file after reading to avoid too many files open or &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; smart session stream management.
&lt;/span&gt;+                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(!allowSessionStreamManagement){
+                    currentReadClaimStream.close();
+                }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If we close that read claim stream, we need to ensure that we also then set the currentReadClaimStream to null and also null out the currentReadClaim. Otherwise, some paths through the code could end up trying to read from a stream that has already been closed.&lt;/p&gt;</comment>
                            <comment id="14947028" author="jpercivall" created="Wed, 7 Oct 2015 15:28:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mpayne2&quot; class=&quot;user-hover&quot; rel=&quot;mpayne2&quot;&gt;mpayne2&lt;/a&gt; Good catch, I set it as null and rebased to master&lt;/p&gt;</comment>
                            <comment id="14975442" author="jira-bot" created="Tue, 27 Oct 2015 00:50:14 +0000"  >&lt;p&gt;Commit b885f955f4ee97caeaf5c3a28aab967db1be4c94 in nifi&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=JPercivall&quot; class=&quot;user-hover&quot; rel=&quot;jpercivall&quot;&gt;JPercivall&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=nifi.git;h=b885f95&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=nifi.git;h=b885f95&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/NIFI-516&quot; title=&quot;MergeContent when merging 10,000s or more objects can cause too many open files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NIFI-516&quot;&gt;&lt;del&gt;NIFI-516&lt;/del&gt;&lt;/a&gt; adding option to StandardProcessSession.read to close stream&lt;/p&gt;

&lt;p&gt;Signed-off-by: Mark Payne &amp;lt;markap14@hotmail.com&amp;gt;&lt;/p&gt;</comment>
                            <comment id="14975444" author="markap14" created="Tue, 27 Oct 2015 00:51:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=JPercivall&quot; class=&quot;user-hover&quot; rel=&quot;jpercivall&quot;&gt;JPercivall&lt;/a&gt; - Code looks good. Verified that everything builds and passes contrib-check. A test of MergeContent appears to function as expected. Nice work!! Thanks for knocking this out. Merged into master and will close the ticket.&lt;/p&gt;

&lt;p&gt;On another note... looks like you made a shout out to Michael Payne again &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16477688" author="jira-bot" created="Wed, 16 May 2018 16:30:26 +0000"  >&lt;p&gt;Commit 0688363d87ecdcc68a9dd18888c64a06063c3a15 in nifi&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markap14&quot; class=&quot;user-hover&quot; rel=&quot;markap14&quot;&gt;markap14&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=nifi.git;h=0688363&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=nifi.git;h=0688363&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/NIFI-5200&quot; title=&quot;Nested ProcessSession.read resulting in outer stream being closed.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NIFI-5200&quot;&gt;&lt;del&gt;NIFI-5200&lt;/del&gt;&lt;/a&gt;: Fixed bug that caused the wrong InputStream to be closed by StandardProcessSession if calling Session.read() from the callback of another Session.read(); also changed default of the &apos;allowSessionStreamManagement&apos; flag from &apos;false&apos; to &apos;true&apos; as it will provide performance benefits in some cases and &lt;a href=&quot;https://issues.apache.org/jira/browse/NIFI-516&quot; title=&quot;MergeContent when merging 10,000s or more objects can cause too many open files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NIFI-516&quot;&gt;&lt;del&gt;NIFI-516&lt;/del&gt;&lt;/a&gt; outlined that it should be &apos;true&apos; initially but ended up being false when the PR was merged.&lt;/p&gt;

&lt;p&gt;This closes #2707&lt;/p&gt;

&lt;p&gt;Signed-off-by: Mike Thomsen &amp;lt;mikerthomsen@gmail.com&amp;gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12826848">NIFI-579</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12838957">NIFI-697</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12765404" name="NIFI-516.patch" size="14947" author="jpercivall" created="Wed, 7 Oct 2015 15:28:28 +0000"/>
                            <attachment id="12764667" name="generateMerge.xml" size="23713" author="jpercivall" created="Thu, 1 Oct 2015 19:32:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 26 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2d5an:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>