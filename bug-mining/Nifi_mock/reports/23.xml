<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:46:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[NIFI-3205] Uncaught Failures Can Leave New Flow Files on Disk</title>
                <link>https://issues.apache.org/jira/browse/NIFI-3205</link>
                <project id="12316020" key="NIFI">Apache NiFi</project>
                    <description>&lt;p&gt;We have been hitting a situation where our content repository quickly fills the entire disk despite having archiving off and close to nothing queued.&lt;/p&gt;

&lt;p&gt;We believe this problem happens more often when a processor that creates many flow files fails in the middle.&lt;/p&gt;

&lt;p&gt;I then created this test script and deployed it on a new nifi with a 100KB GenerateFlowFile in front of it. The script makes 5 copies of the incoming flow file, then does session.remove on those copies, then throws a RuntimeException. However, the content repository grows 500KB every time it runs. Then when you restart nifi, it cleans up the content repository with messages like this:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2016-12-15 11:17:29,774 INFO [main] o.a.n.c.repository.FileSystemRepository Found unknown file /Users/alanj/nifi-1.1.0/content_repository/1/1481818525279-1 (1126400 bytes) in File System Repository; archiving file
2016-12-15 11:17:29,778 INFO [main] o.a.n.c.repository.FileSystemRepository Found unknown file /Users/alanj/nifi-1.1.0/content_repository/2/1481818585493-2 (409600 bytes) in File System Repository; archiving file
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The test processor is the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// Copyright 2016 (c) Cloudera
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; com.cloudera.edh.nifi.processors.bundles;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.google.common.collect.Lists;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.InputStream;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.OutputStream;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.List;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.nifi.annotation.behavior.InputRequirement;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.nifi.annotation.behavior.InputRequirement.Requirement;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.nifi.flowfile.FlowFile;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.nifi.processor.AbstractProcessor;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.nifi.processor.ProcessContext;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.nifi.processor.ProcessSession;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.nifi.processor.exception.ProcessException;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.nifi.processor.io.InputStreamCallback;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.nifi.processor.io.OutputStreamCallback;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.nifi.stream.io.StreamUtils;

/**
 * Makes 5 copies of an incoming file, then fails and rolls back.
 */
@InputRequirement(value = Requirement.INPUT_REQUIRED)
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;CopyAndFail &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; AbstractProcessor {
  @Override
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void onTrigger(ProcessContext context, ProcessSession session)
      &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ProcessException {
    FlowFile inputFile = session.get();
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (inputFile == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      context.yield();
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
    }
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; List&amp;lt;FlowFile&amp;gt; newFiles = Lists.newArrayList();
    
    &lt;span class=&quot;code-comment&quot;&gt;// Copy the file 5 times (simulates us opening a zip file and unpacking its contents)
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 5; i++) {
      session.read(inputFile, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InputStreamCallback() {
        @Override
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(InputStream inputStream) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
          FlowFile ff = session.create(inputFile);
          ff = session.write(ff, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OutputStreamCallback() {
            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; OutputStream out) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
              StreamUtils.copy(inputStream, out);
            }
          });
          newFiles.add(ff);
        }
      });
    }
    
    getLogger().warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Removing the &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; files&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Removing the &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; files&quot;&lt;/span&gt;);
    session.remove(newFiles);
    
    &lt;span class=&quot;code-comment&quot;&gt;// Simulate an error handling some file in the zip after unpacking the &lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeException();
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13028428">NIFI-3205</key>
            <summary>Uncaught Failures Can Leave New Flow Files on Disk</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markap14">Mark Payne</assignee>
                                    <reporter username="jackowaya">Alan Jackoway</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 Dec 2016 16:24:16 +0000</created>
                <updated>Wed, 15 Feb 2017 18:19:04 +0000</updated>
                            <resolved>Wed, 15 Feb 2017 18:19:04 +0000</resolved>
                                    <version>1.1.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15751792" author="jackowaya" created="Thu, 15 Dec 2016 16:29:09 +0000"  >&lt;p&gt;The next thing I tried was getting rid of &lt;tt&gt;session.remove(newFiles)&lt;/tt&gt; and replacing it with session.rollback(), then removing the runtime exception.&lt;/p&gt;

&lt;p&gt;Do not do that. The content repository went to about 10GB in 30 seconds. I&apos;m trying penalize (so it will grow slower) with session.remove next.&lt;/p&gt;</comment>
                            <comment id="15751883" author="jackowaya" created="Thu, 15 Dec 2016 17:06:03 +0000"  >&lt;p&gt;Ending the class like this (without the RuntimeException) also doesn&apos;t work:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    session.remove(newFiles);
    session.penalize(inputFile);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m still seeking something that will allow me to prevent new flow files from getting stuck if the session rolls back / penalizes whether it&apos;s intentional or unintentional.&lt;/p&gt;</comment>
                            <comment id="15752088" author="markap14" created="Thu, 15 Dec 2016 18:19:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jackowaya&quot; class=&quot;user-hover&quot; rel=&quot;jackowaya&quot;&gt;jackowaya&lt;/a&gt; I used the DebugFlow processor to replicate the scenario that you&apos;re describing here. That processor really is more of a &quot;Debug Framework when things go bad&quot; processor. Allows you to configure things such as &quot;write the content of the flowfile 5 times&quot; and then &quot;rollback the session without penalizing&quot;. So I did just that - set Write Iterations to 5. Everything seemed to work okay. But it can take a couple of minutes before the Content Repo is cleaned up. After that, it may still have a couple of files hanging out because they are still &quot;writable.&quot; That&apos;s normal.&lt;/p&gt;

&lt;p&gt;I then set it to rollback at the end instead of committing the session (set the &quot;FlowFIle Success Iterations&quot; property to 0 and the &quot;FlowFile Rollback Iterations&quot; property to 1).  So write 5 times and then call session.rollback(). Content repo went up to about 2 GB and then I stopped the processor. Waited a few minutes for the Content Repo to clean up, but it never did! So it looks like what you are describing is accurate: If the content of the FlowFile is written to multiple times, and then the session is rolled back, the content may not get cleaned up properly (I say may not because there are some conditions where it would and some where it wouldn&apos;t). It doesn&apos;t have a setting to remove the FlowFile at the end so i haven&apos;t tried that yet.&lt;/p&gt;

&lt;p&gt;Many thanks for digging in here and keeping the conversation going with great details!&lt;/p&gt;</comment>
                            <comment id="15752179" author="markap14" created="Thu, 15 Dec 2016 18:53:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jackowaya&quot; class=&quot;user-hover&quot; rel=&quot;jackowaya&quot;&gt;jackowaya&lt;/a&gt; - I changed priority to Critical and set the fix version to 1.2.0. I&apos;m going to look into addressing the issue where a processor overwrites the content multiple times and then rolls back the session. If you are seeing other behavior causing the repository to fill up, then we&apos;ll still need to delve in further.&lt;/p&gt;</comment>
                            <comment id="15752681" author="jackowaya" created="Thu, 15 Dec 2016 22:21:51 +0000"  >&lt;p&gt;I&apos;m not sure if this matters, but in my examples I generate multiple flow files, then roll back. I don&apos;t overwrite files once they are created unless you count the fact that after penalization the flow runs again and generates more flow files.&lt;/p&gt;</comment>
                            <comment id="15754490" author="githubbot" created="Fri, 16 Dec 2016 14:01:37 +0000"  >&lt;p&gt;GitHub user markap14 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/nifi/pull/1336&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/nifi/pull/1336&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/NIFI-3205&quot; title=&quot;Uncaught Failures Can Leave New Flow Files on Disk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NIFI-3205&quot;&gt;&lt;del&gt;NIFI-3205&lt;/del&gt;&lt;/a&gt;: Ensure that FlowFile Repository is updated with any Transi&#8230;&lt;/p&gt;

&lt;p&gt;    Thank you for submitting a contribution to Apache NiFi.&lt;/p&gt;

&lt;p&gt;    In order to streamline the review of the contribution we ask you&lt;br/&gt;
    to ensure the following steps have been taken:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;For all changes:&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Is there a JIRA ticket associated with this PR? Is it referenced&lt;br/&gt;
         in the commit message?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Does your PR title start with NIFI-XXXX where XXXX is the JIRA number you are trying to resolve? Pay particular attention to the hyphen &quot;-&quot; character.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Has your PR been rebased against the latest commit within the target branch (typically master)?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Is your initial contribution a single, squashed commit?&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;For code changes:&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Have you ensured that the full suite of tests is executed via mvn -Pcontrib-check clean install at the root nifi folder?&lt;/li&gt;
	&lt;li&gt;[ ] Have you written or updated unit tests to verify your changes?&lt;/li&gt;
	&lt;li&gt;[ ] If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under &lt;span class=&quot;error&quot;&gt;&amp;#91;ASF 2.0&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://www.apache.org/legal/resolved.html#category-a)?&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/legal/resolved.html#category-a)?&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;[ ] If applicable, have you updated the LICENSE file, including the main LICENSE file under nifi-assembly?&lt;/li&gt;
	&lt;li&gt;[ ] If applicable, have you updated the NOTICE file, including the main NOTICE file found under nifi-assembly?&lt;/li&gt;
	&lt;li&gt;[ ] If adding new Properties, have you added .displayName in addition to .name (programmatic access) for each of the new properties?&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;For documentation related changes:&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Have you ensured that format looks appropriate for the output in which it is rendered?&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Note:&lt;br/&gt;
    Please ensure that once the PR is submitted, you check travis-ci for build issues and submit an update to your PR as soon as possible.&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    &#8230;ent Content Claims when session rollback occurs&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/markap14/nifi&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/markap14/nifi&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/NIFI-3205&quot; title=&quot;Uncaught Failures Can Leave New Flow Files on Disk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NIFI-3205&quot;&gt;&lt;del&gt;NIFI-3205&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/nifi/pull/1336.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/nifi/pull/1336.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1336&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit a9d32443eef9d4b6afd48600e3fedfb0bfe23b0c&lt;br/&gt;
Author: Mark Payne &amp;lt;markap14@hotmail.com&amp;gt;&lt;br/&gt;
Date:   2016-12-16T14:01:01Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/NIFI-3205&quot; title=&quot;Uncaught Failures Can Leave New Flow Files on Disk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NIFI-3205&quot;&gt;&lt;del&gt;NIFI-3205&lt;/del&gt;&lt;/a&gt;: Ensure that FlowFile Repository is updated with any Transient Content Claims when session rollback occurs&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15754500" author="markap14" created="Fri, 16 Dec 2016 14:04:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jackowaya&quot; class=&quot;user-hover&quot; rel=&quot;jackowaya&quot;&gt;jackowaya&lt;/a&gt; - In the example processor that you provided, the code calls session.write() for the same FlowFile multiple times before it rolls back. The session did not properly clean this up. So I have addressed that in PR 1336. Is the processor that you&apos;re using in your flow not call session.write multiple times for the same FlowFile?&lt;/p&gt;</comment>
                            <comment id="15754736" author="jackowaya" created="Fri, 16 Dec 2016 15:40:16 +0000"  >&lt;p&gt;I was misunderstanding. I am calling session.write multiple times on the same flow file, which produces several output flow files. I was thinking of it from the output side, not the write side. I think the PR handles it, though it&apos;s a section of the code I&apos;m not familiar with.&lt;/p&gt;</comment>
                            <comment id="15754759" author="githubbot" created="Fri, 16 Dec 2016 15:46:48 +0000"  >&lt;p&gt;Github user jackowaya commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/nifi/pull/1336&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/nifi/pull/1336&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Too far out of my comfort zone to give a true +1. The only thing I couldn&apos;t figure out is how the repoRecord object in StandardProcessSession works. It looks like it falls out of scope, but there must be some magic going on with that context call.&lt;/p&gt;

&lt;p&gt;    All that to say: the tests look good to me. If they&apos;re passing, this is good&lt;/p&gt;</comment>
                            <comment id="15755297" author="githubbot" created="Fri, 16 Dec 2016 19:25:50 +0000"  >&lt;p&gt;Github user markap14 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/nifi/pull/1336&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/nifi/pull/1336&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @jackowaya thanks for verifying. The Repo Record object is stored in a HashMap in StandardProcessSession - all of them except for the TransientClaimRepositoryRecord, which gets created in the rollback() method. That one is needed only to pass to the FlowFile Repository and then it falls out of scope.&lt;/p&gt;</comment>
                            <comment id="15867206" author="joewitt" created="Wed, 15 Feb 2017 04:16:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markap14&quot; class=&quot;user-hover&quot; rel=&quot;markap14&quot;&gt;markap14&lt;/a&gt; please see attached template.  In reviewing this PR i ran the template and was left with a lot of content in the repo.  It did eventually clear out except a single file sitting in my content repository.  I assume there should be zero files left given I never created any content except in the DebugFlow and it only ever rolled back its results.&lt;/p&gt;

&lt;p&gt;Does this make sense?&lt;/p&gt;</comment>
                            <comment id="15867236" author="githubbot" created="Wed, 15 Feb 2017 04:40:58 +0000"  >&lt;p&gt;Github user joewitt commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/nifi/pull/1336&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/nifi/pull/1336&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @markap14 please see comments i left on the JIRA.  &lt;/p&gt;</comment>
                            <comment id="15868245" author="markap14" created="Wed, 15 Feb 2017 17:48:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joewitt&quot; class=&quot;user-hover&quot; rel=&quot;joewitt&quot;&gt;joewitt&lt;/a&gt; - that is to be expected. The Content Repo will retain some open file handles in order to provide better performance. At least one would be held open. If there are multiple threads writing to the Content Repo simultaneously, you could have multiple left. But those that are no longer in use should be cleared away.&lt;/p&gt;</comment>
                            <comment id="15868293" author="jira-bot" created="Wed, 15 Feb 2017 18:16:12 +0000"  >&lt;p&gt;Commit 39cfd0339756e3869d0e3f3bcf45569855d6bca3 in nifi&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markap14&quot; class=&quot;user-hover&quot; rel=&quot;markap14&quot;&gt;markap14&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=nifi.git;h=39cfd03&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=nifi.git;h=39cfd03&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/NIFI-3205&quot; title=&quot;Uncaught Failures Can Leave New Flow Files on Disk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NIFI-3205&quot;&gt;&lt;del&gt;NIFI-3205&lt;/del&gt;&lt;/a&gt;: This closes #1336. Ensure that FlowFile Repository is updated with any Transient Content Claims when session rollback occurs&lt;/p&gt;</comment>
                            <comment id="15868294" author="githubbot" created="Wed, 15 Feb 2017 18:16:30 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/nifi/pull/1336&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/nifi/pull/1336&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15868296" author="githubbot" created="Wed, 15 Feb 2017 18:16:56 +0000"  >&lt;p&gt;Github user joewitt commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/nifi/pull/1336&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/nifi/pull/1336&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    based on mark&apos;s explanation of my observation in reviewing am now a +1.&lt;/p&gt;

&lt;p&gt;    merged to master.  thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12852735" name="replicate_issue.xml" size="13750" author="joewitt" created="Wed, 15 Feb 2017 04:15:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 39 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i37ndj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>