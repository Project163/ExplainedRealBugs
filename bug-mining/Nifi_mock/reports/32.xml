<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:46:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[NIFI-4686] MockFlowFile Penalized status is lost after putting attributes</title>
                <link>https://issues.apache.org/jira/browse/NIFI-4686</link>
                <project id="12316020" key="NIFI">Apache NiFi</project>
                    <description>&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;When I write unit tests to test whether a FlowFile is penalised after an exception is thrown by an external resource, I find a possible issue in the current &lt;b&gt;MockFlowFile&lt;/b&gt; class.&lt;/p&gt;

&lt;p&gt;I first penalized the FlowFile and put a &lt;b&gt;Error&lt;/b&gt; attribute to the file afterwards. The class attribute &lt;b&gt;penalized&lt;/b&gt; will be reset after the calling &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;session.putAttributes(xxx)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; function.&lt;/p&gt;

&lt;p&gt;Here is the unit test I added to the test class &lt;b&gt;TestMockProcessSession&lt;/b&gt;.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testKeepPenalizedStatusAfterPuttingAttribute(){
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Processor processor = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoorlyBehavedProcessor();
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; MockProcessSession session = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MockProcessSession(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SharedSessionState(processor, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AtomicLong(0L)), processor);
        FlowFile ff1 = session.createFlowFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;hello, world&quot;&lt;/span&gt;.getBytes());
        ff1 = session.penalize(ff1);
        assertEquals(ff1.isPenalized(), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
        ff1 = session.putAttribute(ff1, &lt;span class=&quot;code-quote&quot;&gt;&quot;hello&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;world&quot;&lt;/span&gt;);
        assertEquals(ff1.isPenalized(), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the current MockFlowFile implementation:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; MockFlowFile(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; id, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FlowFile toCopy) {}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Class attribute &lt;b&gt;penalized&lt;/b&gt; will not be copied and therefore, this test will fail.&lt;/p&gt;

&lt;p&gt;I think this behaviour is unexpected and checked how this logic is implemented in &lt;b&gt;StandardFlowFileRecord&lt;/b&gt;.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/nifi/blob/c138987bb46b975379daa00e57c42f498b6ef207/nifi-nar-bundles/nifi-framework-bundle/nifi-framework/nifi-repository-models/src/main/java/org/apache/nifi/controller/repository/StandardFlowFileRecord.java#L320&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/nifi/blob/c138987bb46b975379daa00e57c42f498b6ef207/nifi-nar-bundles/nifi-framework-bundle/nifi-framework/nifi-repository-models/src/main/java/org/apache/nifi/controller/repository/StandardFlowFileRecord.java#L320&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Calling method in StandardProcessSession:&lt;/b&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/nifi/blob/c138987bb46b975379daa00e57c42f498b6ef207/nifi-nar-bundles/nifi-framework-bundle/nifi-framework/nifi-framework-core/src/main/java/org/apache/nifi/controller/repository/StandardProcessSession.java#L1756&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/nifi/blob/c138987bb46b975379daa00e57c42f498b6ef207/nifi-nar-bundles/nifi-framework-bundle/nifi-framework/nifi-framework-core/src/main/java/org/apache/nifi/controller/repository/StandardProcessSession.java#L1756&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Could you please advise whether this is a bug? The fix is simple and I would like to submit the change if needed. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</description>
                <environment></environment>
        <key id="13123961">NIFI-4686</key>
            <summary>MockFlowFile Penalized status is lost after putting attributes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jlwt90">jlwt90</reporter>
                        <labels>
                    </labels>
                <created>Sun, 10 Dec 2017 05:26:43 +0000</created>
                <updated>Tue, 3 Oct 2023 05:49:21 +0000</updated>
                            <resolved>Mon, 29 Jan 2018 16:03:34 +0000</resolved>
                                                    <fixVersion>1.6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16289956" author="markap14" created="Wed, 13 Dec 2017 21:38:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jlwt90&quot; class=&quot;user-hover&quot; rel=&quot;jlwt90&quot;&gt;jlwt90&lt;/a&gt;  Yes, I do believe it is a bug. Would be happy to review a PR if one is submitted.&lt;/p&gt;</comment>
                            <comment id="16342424" author="githubbot" created="Sun, 28 Jan 2018 03:32:38 +0000"  >&lt;p&gt;GitHub user jlwt90 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/nifi/pull/2438&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/nifi/pull/2438&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/NIFI-4686&quot; title=&quot;MockFlowFile Penalized status is lost after putting attributes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NIFI-4686&quot;&gt;&lt;del&gt;NIFI-4686&lt;/del&gt;&lt;/a&gt;: MockFlowFile now includes penalized status when copying&lt;/p&gt;

&lt;p&gt;    Thank you for submitting a contribution to Apache NiFi.&lt;/p&gt;

&lt;p&gt;    In order to streamline the review of the contribution we ask you&lt;br/&gt;
    to ensure the following steps have been taken:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;For all changes:&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;x&amp;#93;&lt;/span&gt; Is there a JIRA ticket associated with this PR? Is it referenced&lt;br/&gt;
         in the commit message?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;x&amp;#93;&lt;/span&gt; Does your PR title start with NIFI-XXXX where XXXX is the JIRA number you are trying to resolve? Pay particular attention to the hyphen &quot;-&quot; character.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;x&amp;#93;&lt;/span&gt; Has your PR been rebased against the latest commit within the target branch (typically master)?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;x&amp;#93;&lt;/span&gt; Is your initial contribution a single, squashed commit?&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;For code changes:&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;x&amp;#93;&lt;/span&gt; Have you ensured that the full suite of tests is executed via mvn -Pcontrib-check clean install at the root nifi folder?&lt;/li&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;x&amp;#93;&lt;/span&gt; Have you written or updated unit tests to verify your changes?&lt;/li&gt;
	&lt;li&gt;[ ] If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under &lt;span class=&quot;error&quot;&gt;&amp;#91;ASF 2.0&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://www.apache.org/legal/resolved.html#category-a)?&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/legal/resolved.html#category-a)?&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;[ ] If applicable, have you updated the LICENSE file, including the main LICENSE file under nifi-assembly?&lt;/li&gt;
	&lt;li&gt;[ ] If applicable, have you updated the NOTICE file, including the main NOTICE file found under nifi-assembly?&lt;/li&gt;
	&lt;li&gt;[ ] If adding new Properties, have you added .displayName in addition to .name (programmatic access) for each of the new properties?&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;For documentation related changes:&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Have you ensured that format looks appropriate for the output in which it is rendered?&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Note:&lt;br/&gt;
    Please ensure that once the PR is submitted, you check travis-ci for build issues and submit an update to your PR as soon as possible.&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/jlwt90/nifi&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jlwt90/nifi&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/NIFI-4686&quot; title=&quot;MockFlowFile Penalized status is lost after putting attributes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NIFI-4686&quot;&gt;&lt;del&gt;NIFI-4686&lt;/del&gt;&lt;/a&gt;-fix-mockflowfile&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/nifi/pull/2438.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/nifi/pull/2438.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2438&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 03550a71a083341d440995386d0d93fd623f732e&lt;br/&gt;
Author: jlwt90 &amp;lt;jasonwaiting@...&amp;gt;&lt;br/&gt;
Date:   2018-01-28T02:37:50Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/NIFI-4686&quot; title=&quot;MockFlowFile Penalized status is lost after putting attributes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NIFI-4686&quot;&gt;&lt;del&gt;NIFI-4686&lt;/del&gt;&lt;/a&gt; MockFlowFile now includes penalized status when copying&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16343542" author="jira-bot" created="Mon, 29 Jan 2018 16:02:40 +0000"  >&lt;p&gt;Commit d8cfb8e6c516698d65880bbc86a10048b9fbcab8 in nifi&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jlwt90&quot; class=&quot;user-hover&quot; rel=&quot;jlwt90&quot;&gt;jlwt90&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=nifi.git;h=d8cfb8e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=nifi.git;h=d8cfb8e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/NIFI-4686&quot; title=&quot;MockFlowFile Penalized status is lost after putting attributes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;NIFI-4686&quot;&gt;&lt;del&gt;NIFI-4686&lt;/del&gt;&lt;/a&gt; MockFlowFile now includes penalized status when copying. This closes #2438.&lt;/p&gt;

&lt;p&gt;Signed-off-by: Mark Payne &amp;lt;markap14@hotmail.com&amp;gt;&lt;/p&gt;</comment>
                            <comment id="16343544" author="githubbot" created="Mon, 29 Jan 2018 16:03:13 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/nifi/pull/2438&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/nifi/pull/2438&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16343545" author="githubbot" created="Mon, 29 Jan 2018 16:03:18 +0000"  >&lt;p&gt;Github user markap14 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/nifi/pull/2438&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/nifi/pull/2438&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @jlwt90 thanks for fixing this! Definitely a good find and I appreciate you tackling it and even providing unit tests. +1 merged to master.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13057191">NIFI-3622</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 41 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3nqhj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>