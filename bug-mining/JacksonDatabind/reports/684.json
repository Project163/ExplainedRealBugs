{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/4214","repository_url":"https://api.github.com/repos/FasterXML/jackson-databind","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/4214/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/4214/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/4214/events","html_url":"https://github.com/FasterXML/jackson-databind/issues/4214","id":2007950262,"node_id":"I_kwDOAC5e2c53ruO2","number":4214,"title":"`EnumSet` deserialization does not work when we activate default typing in `ObjectMapper`","user":{"login":"dvhvsekhar","id":22286744,"node_id":"MDQ6VXNlcjIyMjg2NzQ0","avatar_url":"https://avatars.githubusercontent.com/u/22286744?v=4","gravatar_id":"","url":"https://api.github.com/users/dvhvsekhar","html_url":"https://github.com/dvhvsekhar","followers_url":"https://api.github.com/users/dvhvsekhar/followers","following_url":"https://api.github.com/users/dvhvsekhar/following{/other_user}","gists_url":"https://api.github.com/users/dvhvsekhar/gists{/gist_id}","starred_url":"https://api.github.com/users/dvhvsekhar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dvhvsekhar/subscriptions","organizations_url":"https://api.github.com/users/dvhvsekhar/orgs","repos_url":"https://api.github.com/users/dvhvsekhar/repos","events_url":"https://api.github.com/users/dvhvsekhar/events{/privacy}","received_events_url":"https://api.github.com/users/dvhvsekhar/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":6031275861,"node_id":"LA_kwDOAC5e2c8AAAABZ333VQ","url":"https://api.github.com/repos/FasterXML/jackson-databind/labels/2.17","name":"2.17","color":"0052cc","default":false,"description":"Issues planned at earliest for 2.17"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/158","html_url":"https://github.com/FasterXML/jackson-databind/milestone/158","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/158/labels","id":10221950,"node_id":"MI_kwDOAC5e2c4Am_l-","number":158,"title":"2.17.0","description":null,"creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":17,"state":"closed","created_at":"2023-11-23T01:47:25Z","updated_at":"2025-10-30T23:30:19Z","due_on":null,"closed_at":"2025-10-30T23:30:19Z"},"comments":5,"created_at":"2023-11-23T10:43:55Z","updated_at":"2023-11-28T01:54:30Z","closed_at":"2023-11-28T01:53:56Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Search before asking\r\n\r\n- [X] I searched in the [issues](https://github.com/FasterXML/jackson-databind/issues) and found nothing similar.\r\n\r\n### Describe the bug\r\n\r\nIf we serialize an object which has a property of type Set, but referring EnumSet at runtime, then serialization uses CollectionSerializer instead of EnumSetSerializer for this property, when we activate default typing in ObjectMapper. This causes deserialization (using EnumSetDeserializer) to fail, since  EnumSetDeserializer expects encoding of EnumSetSerializer, but not of CollectionSerializer.\r\n\r\n### Version Information\r\n\r\n2.14.0 and above\r\n\r\n### Reproduction\r\n\r\nIf we run the below given test (java code), we get following error:\r\n\r\n[ERROR]   EnumSetSerializationTest.testSerialization:69 Â» MismatchedInput Cannot deserialize value of type `com.fasterxml.jackson.databind.ser.enums.EnumSetSerializationTest$MyEnum` from Array value (token `JsonToken.START_ARRAY`)\r\n at [Source: REDACTED (`StreamReadFeature.INCLUDE_SOURCE_IN_LOCATION` disabled); line: 1, column: 191] (through reference chain: com.fasterxml.jackson.databind.ser.enums.EnumSetSerializationTest$EnumSetHolder[\"enumSet\"]->java.util.RegularEnumSet[0])\r\n\r\n```java\r\npackage com.fasterxml.jackson.databind.ser.enums;\r\n\r\nimport com.fasterxml.jackson.databind.BaseMapTest;\r\nimport com.fasterxml.jackson.databind.ObjectMapper;\r\n\r\nimport java.util.EnumSet;\r\nimport java.util.Set;\r\n\r\nimport com.fasterxml.jackson.annotation.JsonAutoDetect.Visibility;\r\nimport com.fasterxml.jackson.annotation.PropertyAccessor;\r\nimport com.fasterxml.jackson.databind.DeserializationFeature;\r\nimport com.fasterxml.jackson.databind.ObjectMapper.DefaultTyping;\r\nimport com.fasterxml.jackson.databind.jsontype.BasicPolymorphicTypeValidator;\r\n\r\npublic class EnumSetSerializationTest extends BaseMapTest {\r\n\r\n\tstatic enum MyEnum {\r\n\t\tITEM_A, ITEM_B;\r\n\t}\r\n\r\n\tstatic class EnumSetHolder {\r\n\t\tprivate Set<MyEnum> enumSet; // use Set instead of EnumSet for type of this\r\n\r\n\t\tpublic Set<MyEnum> getEnumSet() {\r\n\t\t\treturn enumSet;\r\n\t\t}\r\n\r\n\t\tpublic void setEnumSet(Set<MyEnum> enumSet) {\r\n\t\t\tthis.enumSet = enumSet;\r\n\t\t}\r\n\r\n\t\t@Override\r\n\t\tpublic boolean equals(Object o) {\r\n\t\t\tif (!(o instanceof EnumSetHolder)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tEnumSetHolder eh = (EnumSetHolder) o;\r\n\t\t\tif (eh == this) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (enumSet == null) {\r\n\t\t\t\tif (eh.getEnumSet() == null) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (eh.getEnumSet() == null) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\treturn enumSet.containsAll(eh.getEnumSet());\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic void testSerialization() throws Exception {\r\n\t\tObjectMapper mapper = jsonMapperBuilder().build()\r\n\t\t\t\t.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false)\r\n\t\t\t\t// this type information is needed in json string, for this test\r\n\t\t\t\t.activateDefaultTyping(BasicPolymorphicTypeValidator.builder().allowIfBaseType(Object.class).build(),\r\n\t\t\t\t\t\tDefaultTyping.EVERYTHING);\r\n\r\n\t\tEnumSetHolder enumSetHolder = new EnumSetHolder();\r\n\t\tenumSetHolder.setEnumSet(EnumSet.allOf(MyEnum.class));\r\n\t\tString jsonStr = mapper.writeValueAsString(enumSetHolder);\r\n\t\tEnumSetHolder result = mapper.readValue(jsonStr, EnumSetHolder.class);\r\n\t\tassertEquals(result, enumSetHolder);\r\n\t}\r\n}\r\n\r\n``` \r\n\r\n\r\n### Expected behavior\r\n\r\nAbove given test code should pass. \r\n\r\n### Additional context\r\n\r\nAs a workaround, if we make type of EnumSetHolder#enumSet property as EnumSet instead of Set, in the above given code,  test passes.\r\n\r\n_No response_","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/4214/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/4214/timeline","performed_via_github_app":null,"state_reason":"completed"}