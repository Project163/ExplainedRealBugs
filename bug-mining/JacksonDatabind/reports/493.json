{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2567","repository_url":"https://api.github.com/repos/FasterXML/jackson-databind","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2567/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2567/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2567/events","html_url":"https://github.com/FasterXML/jackson-databind/issues/2567","id":534999972,"node_id":"MDU6SXNzdWU1MzQ5OTk5NzI=","number":2567,"title":"Incorrect target type for arrays when providing nulls and nulls are disabled","user":{"login":"joca-bt","id":1297942,"node_id":"MDQ6VXNlcjEyOTc5NDI=","avatar_url":"https://avatars.githubusercontent.com/u/1297942?v=4","gravatar_id":"","url":"https://api.github.com/users/joca-bt","html_url":"https://github.com/joca-bt","followers_url":"https://api.github.com/users/joca-bt/followers","following_url":"https://api.github.com/users/joca-bt/following{/other_user}","gists_url":"https://api.github.com/users/joca-bt/gists{/gist_id}","starred_url":"https://api.github.com/users/joca-bt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joca-bt/subscriptions","organizations_url":"https://api.github.com/users/joca-bt/orgs","repos_url":"https://api.github.com/users/joca-bt/repos","events_url":"https://api.github.com/users/joca-bt/events{/privacy}","received_events_url":"https://api.github.com/users/joca-bt/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/106","html_url":"https://github.com/FasterXML/jackson-databind/milestone/106","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/106/labels","id":4857949,"node_id":"MDk6TWlsZXN0b25lNDg1Nzk0OQ==","number":106,"title":"2.10.2","description":"Release notes: https://github.com/FasterXML/jackson/wiki/Jackson-Release-2.10.2","creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":10,"state":"closed","created_at":"2019-11-18T23:52:41Z","updated_at":"2021-03-04T04:23:07Z","due_on":"2020-01-05T08:00:00Z","closed_at":"2021-03-04T04:22:49Z"},"comments":1,"created_at":"2019-12-09T15:19:18Z","updated_at":"2019-12-10T04:59:32Z","closed_at":"2019-12-10T04:59:32Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"In the following situation the [target type](http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/exc/MismatchedInputException.html#getTargetType--) of a `MismatchedInputException` is incorrect.\r\n\r\nI have an `ObjectMapper` without scalar conversion and that doesn't allow nulls.\r\n\r\n```\r\ntry {\r\n    ObjectMapper objectMapper = new ObjectMapper();\r\n    objectMapper.disable(MapperFeature.ALLOW_COERCION_OF_SCALARS)\r\n        .setDefaultSetterInfo(JsonSetter.Value.construct(Nulls.FAIL, Nulls.FAIL));\r\n    objectMapper.readValue(\"{ \\\"array\\\": [ null ]}\", Foo.class);\r\n} catch (MismatchedInputException exception) {\r\n    JsonParser parser = (JsonParser) exception.getProcessor();\r\n    System.out.println(exception);\r\n    System.out.println(\"target type: \" + exception.getTargetType());\r\n    System.out.println(\"current token: \" + parser.currentToken());\r\n    for (var node : exception.getPath()) {\r\n        System.out.println(\"node: \" + node);\r\n        System.out.println(\"field name: \" + node.getFieldName());\r\n        System.out.println(\"index: \" + node.getIndex());\r\n    }\r\n}\r\n```\r\n\r\n```\r\npublic static class Foo {\r\n    public List<Boolean> array;\r\n}\r\n```\r\n\r\nWhen I provide an integer as the element of the array of booleans I get that the target type was boolean (correct, since it is an array of booleans).\r\n\r\n```\r\ncom.fasterxml.jackson.databind.exc.MismatchedInputException: Cannot coerce Number (1) for type `java.lang.Boolean` (enable `MapperFeature.ALLOW_COERCION_OF_SCALARS` to allow)\r\n at [Source: (String)\"{ \"array\": [ 1 ]}\"; line: 1, column: 14] (through reference chain: com.booking.demandapi.system.Initializer$Foo[\"array\"]->java.util.ArrayList[0])\r\ntarget type: class java.lang.Boolean\r\ncurrent token: VALUE_NUMBER_INT\r\nnode: com.booking.demandapi.system.Initializer$Foo[\"array\"]\r\nfield name: array\r\nindex: -1\r\nnode: java.util.ArrayList[0]\r\nfield name: null\r\nindex: 0\r\n```\r\n\r\nHowever, when I provide a null as the element I get that the target type was array. I was expecting the target type to be boolean as before.\r\n\r\n```\r\ncom.fasterxml.jackson.databind.exc.InvalidNullException: Invalid `null` value encountered for property \"array\"\r\n at [Source: (String)\"{ \"array\": [ null ]}\"; line: 1, column: 14] (through reference chain: com.booking.demandapi.system.Initializer$Foo[\"array\"]->java.util.ArrayList[0])\r\ntarget type: interface java.util.List\r\ncurrent token: VALUE_NULL\r\nnode: com.booking.demandapi.system.Initializer$Foo[\"array\"]\r\nfield name: array\r\nindex: -1\r\nnode: java.util.ArrayList[0]\r\nfield name: null\r\nindex: 0\r\n```","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2567/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2567/timeline","performed_via_github_app":null,"state_reason":"completed"}