{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/5194","repository_url":"https://api.github.com/repos/FasterXML/jackson-databind","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/5194/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/5194/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/5194/events","html_url":"https://github.com/FasterXML/jackson-databind/issues/5194","id":3150271427,"node_id":"I_kwDOAC5e2c67xVPD","number":5194,"title":"Custom `Throwable` not serializable if using `JsonAutoDetect` settings that only detect Fields","user":{"login":"riskop","id":1511373,"node_id":"MDQ6VXNlcjE1MTEzNzM=","avatar_url":"https://avatars.githubusercontent.com/u/1511373?v=4","gravatar_id":"","url":"https://api.github.com/users/riskop","html_url":"https://github.com/riskop","followers_url":"https://api.github.com/users/riskop/followers","following_url":"https://api.github.com/users/riskop/following{/other_user}","gists_url":"https://api.github.com/users/riskop/gists{/gist_id}","starred_url":"https://api.github.com/users/riskop/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/riskop/subscriptions","organizations_url":"https://api.github.com/users/riskop/orgs","repos_url":"https://api.github.com/users/riskop/repos","events_url":"https://api.github.com/users/riskop/events{/privacy}","received_events_url":"https://api.github.com/users/riskop/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2457821256,"node_id":"MDU6TGFiZWwyNDU3ODIxMjU2","url":"https://api.github.com/repos/FasterXML/jackson-databind/labels/has-failing-test","name":"has-failing-test","color":"4e8a16","default":false,"description":"Indicates that there exists a test case (under `failing/`) to reproduce the issue"},{"id":8506095424,"node_id":"LA_kwDOAC5e2c8AAAAB-wC3QA","url":"https://api.github.com/repos/FasterXML/jackson-databind/labels/2.20","name":"2.20","color":"1D76DB","default":false,"description":"Issues planned at 2.20 or later"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/181","html_url":"https://github.com/FasterXML/jackson-databind/milestone/181","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/181/labels","id":12791387,"node_id":"MI_kwDOAC5e2c4Awy5b","number":181,"title":"2.20.0","description":null,"creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":18,"state":"closed","created_at":"2025-04-26T00:26:36Z","updated_at":"2025-10-30T23:28:38Z","due_on":null,"closed_at":"2025-10-30T23:28:38Z"},"comments":15,"created_at":"2025-06-16T14:38:53Z","updated_at":"2025-07-10T01:54:09Z","closed_at":"2025-07-10T01:44:22Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Search before asking\n\n- [x] I searched in the [issues](https://github.com/FasterXML/jackson-databind/issues) and found nothing similar.\n\n### Describe the bug\n\nI am trying to serialize and then deserialize an exception. It works in case of a java.lang.IllegalArgumentException, but it does not work for my -- identical -- riskop.MyIllegalArgumentException.\n\n\n### Version Information\n\nSpring boot 3.5.0, Jackson 2.19.0\n\n### Reproduction\n\nThis is my ObjectMapper config:\n\n```java\n        ObjectMapper objectMapper = new ObjectMapper();\n        objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.NONE);\n        objectMapper.setVisibility(PropertyAccessor.FIELD, JsonAutoDetect.Visibility.ANY);\n        PolymorphicTypeValidator ptv = BasicPolymorphicTypeValidator.builder()\n                        .allowIfSubType(Object.class)\n                        .build();\n        objectMapper.activateDefaultTyping(ptv, ObjectMapper.DefaultTyping.NON_FINAL, JsonTypeInfo.As.PROPERTY);\n```\n\nThis is how I serialize / deserialize:\n\n```java\n    public void toFromJson(Throwable in) throws Throwable {\n        String json1 = objectMapper.writeValueAsString(in);\n        Throwable out = objectMapper.readValue(json1, Throwable.class);\n        String json2 = objectMapper.writeValueAsString(out);\n        throw out;\n    }\n```\n\nThis is working:\n```java\n        IllegalArgumentException e1 = new IllegalArgumentException();\n        try {\n            toFromJson.toFromJson(e1);\n        }\n        catch (IllegalArgumentException e2) {\n            // okay, expected\n            Assertions.assertEquals(e1.getMessage(), e2.getMessage());\n        }\n        catch (Throwable t) {\n            throw new RuntimeException(t);\n        }\n```\n\nThis is not working, but I think it should:\n```java\n        MyIllegalArgumentException e1 = new MyIllegalArgumentException();\n        try {\n            toFromJson.toFromJson(e1);\n        }\n        catch (MyIllegalArgumentException e2) {\n            // okay, expected\n            Assertions.assertEquals(e1.getMessage(), e2.getMessage());\n        }\n        catch (Throwable t) {\n            throw new RuntimeException(t);\n        }\n```\n\nThere is a mini project for demonstrating the problem:\nhttps://github.com/riskop/jackson_throwable_to_from_json\n\nThere's no difference between MyIllegalArgumentException and the JDK's one:\n\nJDK's IllegalArgumentException:\nhttps://github.com/openjdk/jdk21/blob/master/src/java.base/share/classes/java/lang/IllegalArgumentException.java\n\nMy MyIllegalArgumentException\nhttps://github.com/riskop/jackson_throwable_to_from_json/blob/main/src/main/java/riskop/MyIllegalArgumentException.java\n\njust execute \nmvn clean install\n\nstacktrace:\n```java\n1619 [INFO]  T E S T S\n1619 [INFO] -------------------------------------------------------\n1939 [INFO] Running riskop.MyTest\n11:08:44.999 [main] INFO org.springframework.test.context.support.AnnotationConfigContextLoaderUtils -- Could not detect default configuration classes for test class [riskop.MyTest]: MyTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.\n11:08:45.056 [main] INFO org.springframework.boot.test.context.SpringBootTestContextBootstrapper -- Found @SpringBootConfiguration riskop.Start for test class riskop.MyTest\n\n  .   ____          _            __ _ _\n /\\\\ / ___'_ __ _ _(_)_ __  __ _ \\ \\ \\ \\\n( ( )\\___ | '_ | '_| | '_ \\/ _` | \\ \\ \\ \\\n \\\\/  ___)| |_)| | | | | || (_| |  ) ) ) )\n  '  |____| .__|_| |_|_| |_\\__, | / / / /\n =========|_|==============|___/=/_/_/_/\n\n :: Spring Boot ::                (v3.5.0)\n\n2025-06-17T11:08:45.273+02:00  INFO 524080 --- [           main] riskop.MyTest                            : Starting MyTest using Java 21.0.1 with PID 524080 (started by riskop in /home/riskop/IdeaProjects/jackson_throwable_to_from_json)\n2025-06-17T11:08:45.274+02:00  INFO 524080 --- [           main] riskop.MyTest                            : No active profile set, falling back to 1 default profile: \"default\"\n2025-06-17T11:08:45.625+02:00  INFO 524080 --- [           main] riskop.MyTest                            : Started MyTest in 0.503 seconds (process running for 0.971)\nMockito is currently self-attaching to enable the inline-mock-maker. This will no longer work in future releases of the JDK. Please add Mockito as an agent to your build as described in Mockito's documentation: https://javadoc.io/doc/org.mockito/mockito-core/latest/org.mockito/org/mockito/Mockito.html#0.3\nOpenJDK 64-Bit Server VM warning: Sharing is only supported for boot loader classes because bootstrap classpath has been appended\nWARNING: A Java agent has been loaded dynamically (/home/riskop/.m2/repository/net/bytebuddy/byte-buddy-agent/1.17.5/byte-buddy-agent-1.17.5.jar)\nWARNING: If a serviceability tool is in use, please run with -XX:+EnableDynamicAgentLoading to hide this warning\nWARNING: If a serviceability tool is not in use, please run with -Djdk.instrument.traceUsage for more information\nWARNING: Dynamic loading of agents will be disallowed by default in a future release\n3103 [ERROR] Tests run: 2, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 1.152 s <<< FAILURE! -- in riskop.MyTest\n3103 [ERROR] riskop.MyTest.TestMyIAE -- Time elapsed: 0.007 s <<< ERROR!\njava.lang.RuntimeException: com.fasterxml.jackson.databind.exc.InvalidDefinitionException: Direct self-reference leading to cycle (through reference chain: riskop.MyIllegalArgumentException[\"cause\"])\n        at riskop.MyTest.TestMyIAE(MyTest.java:40)\n        at java.base/java.lang.reflect.Method.invoke(Method.java:580)\n        at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)\n        at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)\nCaused by: com.fasterxml.jackson.databind.exc.InvalidDefinitionException: Direct self-reference leading to cycle (through reference chain: riskop.MyIllegalArgumentException[\"cause\"])\n        at com.fasterxml.jackson.databind.exc.InvalidDefinitionException.from(InvalidDefinitionException.java:77)\n        at com.fasterxml.jackson.databind.SerializerProvider.reportBadDefinition(SerializerProvider.java:1359)\n        at com.fasterxml.jackson.databind.ser.BeanPropertyWriter._handleSelfReference(BeanPropertyWriter.java:953)\n        at com.fasterxml.jackson.databind.ser.BeanPropertyWriter.serializeAsField(BeanPropertyWriter.java:726)\n        at com.fasterxml.jackson.databind.ser.std.BeanSerializerBase.serializeFields(BeanSerializerBase.java:760)\n        at com.fasterxml.jackson.databind.ser.std.BeanSerializerBase.serializeWithType(BeanSerializerBase.java:643)\n        at com.fasterxml.jackson.databind.ser.impl.TypeWrappedSerializer.serialize(TypeWrappedSerializer.java:32)\n        at com.fasterxml.jackson.databind.ser.DefaultSerializerProvider._serialize(DefaultSerializerProvider.java:503)\n        at com.fasterxml.jackson.databind.ser.DefaultSerializerProvider.serializeValue(DefaultSerializerProvider.java:342)\n        at com.fasterxml.jackson.databind.ObjectMapper._writeValueAndClose(ObjectMapper.java:4859)\n        at com.fasterxml.jackson.databind.ObjectMapper.writeValueAsString(ObjectMapper.java:4079)\n        at riskop.ToFromJson.toFromJson(ToFromJson.java:18)\n        at riskop.MyTest.TestMyIAE(MyTest.java:33)\n        ... 3 more\n\n3118 [INFO] \n3118 [INFO] Results:\n3118 [INFO] \n```\n\n\n\n\n\n\n### Expected behavior\n\n_No response_\n\n### Additional context\n\nbackground:\n\nI would like to rewrite a http-invoker based communication framework with REST technology. Http-invoker handled exceptions transparently, if the server side caused an exception, the client side just received it. \n\nI am trying to reproduce that behaviour. In case of errors the server component would serialize the exception to json, pass it to the client ( with rest ) then the client would restore the original exception from json.","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/5194/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/5194/timeline","performed_via_github_app":null,"state_reason":"completed"}