{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/1565","repository_url":"https://api.github.com/repos/FasterXML/jackson-databind","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/1565/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/1565/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/1565/events","html_url":"https://github.com/FasterXML/jackson-databind/issues/1565","id":215166557,"node_id":"MDU6SXNzdWUyMTUxNjY1NTc=","number":1565,"title":"Deserialization failure with Polymorphism using JsonTypeInfo `defaultImpl`, subtype as target","user":{"login":"j1234d2003","id":2636821,"node_id":"MDQ6VXNlcjI2MzY4MjE=","avatar_url":"https://avatars.githubusercontent.com/u/2636821?v=4","gravatar_id":"","url":"https://api.github.com/users/j1234d2003","html_url":"https://github.com/j1234d2003","followers_url":"https://api.github.com/users/j1234d2003/followers","following_url":"https://api.github.com/users/j1234d2003/following{/other_user}","gists_url":"https://api.github.com/users/j1234d2003/gists{/gist_id}","starred_url":"https://api.github.com/users/j1234d2003/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/j1234d2003/subscriptions","organizations_url":"https://api.github.com/users/j1234d2003/orgs","repos_url":"https://api.github.com/users/j1234d2003/repos","events_url":"https://api.github.com/users/j1234d2003/events{/privacy}","received_events_url":"https://api.github.com/users/j1234d2003/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/92","html_url":"https://github.com/FasterXML/jackson-databind/milestone/92","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/92/labels","id":3246804,"node_id":"MDk6TWlsZXN0b25lMzI0NjgwNA==","number":92,"title":"2.9.6","description":"Release notes: https://github.com/FasterXML/jackson/wiki/Jackson-Release-2.9.6","creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":23,"state":"closed","created_at":"2018-04-06T03:10:15Z","updated_at":"2021-03-04T04:11:20Z","due_on":"2018-06-12T07:00:00Z","closed_at":"2021-03-04T04:11:20Z"},"comments":5,"created_at":"2017-03-18T04:51:06Z","updated_at":"2018-04-06T03:21:16Z","closed_at":"2018-04-06T03:21:16Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Issue verified on version jackson-databind 2.8.7 on Ubuntu 14.04, Java 1.8.0_25. A sample code \r\n[CTestTypeId.java.txt](https://github.com/FasterXML/jackson-databind/files/852169/CTestTypeId.java.txt)\r\ndemonstrates this bug.\r\n\r\nA class hierarchy that implements an interface annotated with a @JsonTypeInfo(use=Id.NAME, include=As.PROPERTY, property=\"typeInfo\",  defaultImpl=CBaseClass.class) and a @JsonTypeIdResolve fails to deserialize a derived class that extends the defaultImpl CBaseClass with exception IllegalArgumentException stating that the defaultImpl class is not a subtype of the extending derived class thrown at  com.fasterxml.jackson.databind.type.TypeFactory.constructSpecializedType(TypeFactory.java:359) \r\n\r\nConsider interface CTestInterface annotated with\r\n @JsonTypeInfo(use=Id.NAME, include=As.PROPERTY, property=\"typeInfo\",  defaultImpl=CBaseClass.class)  and\r\n @JsonTypeIdResolver(CTypeMapper.class)\r\n\r\nConsider two classes:\r\n  1) CBaseClass that implements CTestInterface and \r\n   2) CDerivedClass extends CBaseClass. \r\nOn attempt to deserialize data for a CDerivedClass using an ObjectMapper, the type-deserializer failed to be built as demonstrated by the following stack trace. Note that an instance of CBaseClass gets deserialized correctly. For my target usecase, data does not always include the \"typeInfo\" property and hence defaultImpl use becomes necessary.\r\n\r\nException in thread \"main\" java.lang.IllegalArgumentException: Class com.example.CTestTypeId$CBaseClass not subtype of [simple type, class com.example.CTestTypeId$CDerivedClass]\r\n\tat com.fasterxml.jackson.databind.type.TypeFactory.constructSpecializedType(TypeFactory.java:359)\r\n\tat com.fasterxml.jackson.databind.jsontype.impl.StdTypeResolverBuilder.buildTypeDeserializer(StdTypeResolverBuilder.java:128)\r\n\tat com.fasterxml.jackson.databind.deser.BasicDeserializerFactory.findTypeDeserializer(BasicDeserializerFactory.java:1373)\r\n\tat com.fasterxml.jackson.databind.DeserializationContext.findRootValueDeserializer(DeserializationContext.java:482)\r\n\tat com.fasterxml.jackson.databind.ObjectMapper._findRootDeserializer(ObjectMapper.java:3899)\r\n\tat com.fasterxml.jackson.databind.ObjectMapper._readMapAndClose(ObjectMapper.java:3794)\r\n\tat com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:2842)\r\n\tat com.example.CTestTypeId.main(CTestTypeId.java:177)\r\n\r\nI am trying to migrate from jackson-databind 2.1.2 to a more recent production version. Is it possible to know a version that does not suffer from this bug as I need to migrate to a stable version very quickly.","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/1565/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/1565/timeline","performed_via_github_app":null,"state_reason":"completed"}