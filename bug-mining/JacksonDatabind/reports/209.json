{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/1301","repository_url":"https://api.github.com/repos/FasterXML/jackson-databind","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/1301/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/1301/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/1301/events","html_url":"https://github.com/FasterXML/jackson-databind/issues/1301","id":165948616,"node_id":"MDU6SXNzdWUxNjU5NDg2MTY=","number":1301,"title":"Problem with `JavaType.toString()` for recursive (self-referential) types","user":{"login":"voidmain","id":377102,"node_id":"MDQ6VXNlcjM3NzEwMg==","avatar_url":"https://avatars.githubusercontent.com/u/377102?v=4","gravatar_id":"","url":"https://api.github.com/users/voidmain","html_url":"https://github.com/voidmain","followers_url":"https://api.github.com/users/voidmain/followers","following_url":"https://api.github.com/users/voidmain/following{/other_user}","gists_url":"https://api.github.com/users/voidmain/gists{/gist_id}","starred_url":"https://api.github.com/users/voidmain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/voidmain/subscriptions","organizations_url":"https://api.github.com/users/voidmain/orgs","repos_url":"https://api.github.com/users/voidmain/repos","events_url":"https://api.github.com/users/voidmain/events{/privacy}","received_events_url":"https://api.github.com/users/voidmain/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/56","html_url":"https://github.com/FasterXML/jackson-databind/milestone/56","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/56/labels","id":1853894,"node_id":"MDk6TWlsZXN0b25lMTg1Mzg5NA==","number":56,"title":"2.7.6","description":"Release notes: https://github.com/FasterXML/jackson/wiki/Jackson-Release-2.7.6","creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":4,"state":"closed","created_at":"2016-06-28T22:41:33Z","updated_at":"2021-03-04T04:17:23Z","due_on":"2016-07-23T07:00:00Z","closed_at":"2021-03-04T04:17:23Z"},"comments":8,"created_at":"2016-07-16T21:34:29Z","updated_at":"2019-07-18T23:48:57Z","closed_at":"2016-07-18T00:32:07Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I'm getting a StackOverflowError when I try to use this class with Jackson:\n\n```\npublic class DataDefinition extends HashMap<String, DataDefinition> {\n  public DataDefinition definition;\n  public DataDefinition elements;\n  public String regex;\n  public boolean required;\n  public String type;\n}\n```\n\nHere's a snippet of the stack trace I get:\n\n```\n    at com.fasterxml.jackson.databind.type.ResolvedRecursiveType.toString(ResolvedRecursiveType.java:90)\n    at java.lang.String.valueOf(String.java:2994)\n    at java.lang.StringBuilder.append(StringBuilder.java:131)\n    at com.fasterxml.jackson.databind.type.MapType.toString(MapType.java:161)\n    at java.lang.String.valueOf(String.java:2994)\n    at java.lang.StringBuilder.append(StringBuilder.java:131)\n    at com.fasterxml.jackson.databind.type.ResolvedRecursiveType.toString(ResolvedRecursiveType.java:90)\n    at java.lang.String.valueOf(String.java:2994)\n```\n\nI did some debugging and found that this looks like the location where the stack track starts:\n\n```\n    public StdValueInstantiator(DeserializationConfig config, JavaType valueType) {\n        _valueTypeDesc = (valueType == null) ? \"UNKNOWN TYPE\" : valueType.toString();\n        _valueClass = (valueType == null) ? Object.class : valueType.getRawClass();\n    }\n```\n\nIt's line 87 in StdValueInstantiator. That looks like it is calling toString() on the on the type and then it goes into an infinite recursion state. I'm not sure why the toString() call is necessary, but it seems like all of this is for debugging and errors and pre-calculating the string is preventing Jackson from working at all even if there isn't an error.\n\n**WORK-AROUND:** In case anyone looks at this issue and needs a work around, you can use the @JsonAnySetter to fix this issue. Here's the code:\n\n```\npublic class DataDefinition {\n  public DataDefinition definition;\n  public DataDefinition elements;\n  @JsonAnySetter\n  public Map<String, DataDefinition> properties = new HashMap<>();\n  public String regex;\n  public boolean required;\n  public String type;\n}\n```\n\nI also think that this can likely be fixed with code like this:\n\n_com.fasterxml.jackson.databind.type.MapType.java#toString()_\n\n```\n    public String toString()\n    {\n        if ((_keyType instance ResolvedRecursiveType && ((ResolvedRecursiveType) _keyType).getSelfReferencedType() == this) || (_valueType instance ResolvedRecursiveType && ((ResolvedRecursiveType) _valueType).getSelfReferencedType() == this)) {\n            return \"[map type; class \"+_class.getName()+\", \"+_keyType+\" -> self]\";\n        }\n        return \"[map type; class \"+_class.getName()+\", \"+_keyType+\" -> \"+_valueType+\"]\";\n    }\n```\n","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/1301/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/1301/timeline","performed_via_github_app":null,"state_reason":"completed"}