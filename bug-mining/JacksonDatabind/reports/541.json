{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2486","repository_url":"https://api.github.com/repos/FasterXML/jackson-databind","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2486/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2486/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2486/events","html_url":"https://github.com/FasterXML/jackson-databind/issues/2486","id":502289715,"node_id":"MDU6SXNzdWU1MDIyODk3MTU=","number":2486,"title":"Builder Deserialization with JsonCreator Value vs Array","user":{"login":"vjkoskela","id":1775197,"node_id":"MDQ6VXNlcjE3NzUxOTc=","avatar_url":"https://avatars.githubusercontent.com/u/1775197?v=4","gravatar_id":"","url":"https://api.github.com/users/vjkoskela","html_url":"https://github.com/vjkoskela","followers_url":"https://api.github.com/users/vjkoskela/followers","following_url":"https://api.github.com/users/vjkoskela/following{/other_user}","gists_url":"https://api.github.com/users/vjkoskela/gists{/gist_id}","starred_url":"https://api.github.com/users/vjkoskela/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vjkoskela/subscriptions","organizations_url":"https://api.github.com/users/vjkoskela/orgs","repos_url":"https://api.github.com/users/vjkoskela/repos","events_url":"https://api.github.com/users/vjkoskela/events{/privacy}","received_events_url":"https://api.github.com/users/vjkoskela/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/114","html_url":"https://github.com/FasterXML/jackson-databind/milestone/114","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/114/labels","id":5382606,"node_id":"MDk6TWlsZXN0b25lNTM4MjYwNg==","number":114,"title":"2.11.1","description":"Release notes: https://github.com/FasterXML/jackson/wiki/Jackson-Release-2.11.1","creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":10,"state":"closed","created_at":"2020-05-04T21:18:01Z","updated_at":"2021-03-04T04:21:58Z","due_on":"2020-06-25T07:00:00Z","closed_at":"2021-03-04T04:21:58Z"},"comments":10,"created_at":"2019-10-03T20:47:32Z","updated_at":"2020-05-04T21:26:56Z","closed_at":"2020-05-04T21:26:55Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"There seems to be a difference in behavior when deserializing JSON into an object via a Builder when that Builder has a `@JsonCreator` method on it when that method takes a primitive vs an array. \r\n\r\nConsider a pojo class like this:\r\n```\r\n    private static final class TestBean {\r\n\r\n        public int getI() {\r\n            return _i;\r\n        }\r\n\r\n        private TestBean(final Builder builder) {\r\n            _i = builder._i;\r\n        }\r\n\r\n        private final int _i;\r\n    }\r\n```\r\n\r\nThen consider a Builder for the pojo that supports deserialization value from a value as well as an object (or via code calling `setX`):\r\n\r\n```\r\n    public static final class Builder  {\r\n\r\n        public Builder() { }\r\n\r\n        @JsonCreator\r\n        public Builder(final Integer value) {\r\n            _i = value;\r\n        }\r\n\r\n        public void setI(final Integer value) {\r\n            _i = value;\r\n        }\r\n\r\n        private Integer _i;\r\n    }\r\n```\r\n\r\nThis combination can be deserialized from `{\"i\":3}` and from `3`.\r\n\r\nHowever, if we instead declare a `@JsonCreator` method that accepts a `List<Object>` then the deserialization is only supported from `[3]` and not from `{\"i\":3}`. For example, replacing the above `@JsonCreator` annotated constructor with:\r\n\r\n```\r\n        @JsonCreator\r\n        public Builder(final List<Object> jsonArray) {\r\n            setI((int) jsonArray.get(0));\r\n        }\r\n```\r\n\r\nThis appears to be because in [BeanDeserializerBase.java#L222](https://github.com/FasterXML/jackson-databind/blob/master/src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerBase.java#L222) the value of `_vanillaProcessing` is set based in part on the value of `_nonStandardCreation` which considers `_valueInstantiator.canCreateUsingArrayDelegate()` but does not consider instantiation from a primitive value to be \"non standard creation\". \r\n\r\nI am not sure which is the desired behavior. That is, it is an over-sight that with a `@JsonCreator` accepting a value that the same pojo can be deserialized from an object OR whether the array case should also support deserialization from an object. \r\n\r\nIn the case that we don't want the flexibility - and it seems reasonable that if you declare a `@JsonCreator` that this how the object should be built from JSON - then fix would be to include `canCreateFromXXX` for the various primitive types in the computation of `_nonStandardCreation`; although I am unclear on what the broader implications of this migh be.\r\n\r\nIn the case that we want to allow creation of objects from both an alternate representation (e.g. array or primitive) as well as from an object representation then we need a more fine-grained check when delegating to the vanilla path. In particular, we should go down that path if there is non-standard only because of an array delegate (but it's an object representation in json). This will likely lead to evaluating the \"vanilla-ness\" of a particular deserialization based at deserialization time instead of upfront.\r\n\r\nJackson Version: 2.10.0","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2486/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2486/timeline","performed_via_github_app":null,"state_reason":"completed"}