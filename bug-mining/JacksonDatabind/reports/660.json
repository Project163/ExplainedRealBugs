{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/3690","repository_url":"https://api.github.com/repos/FasterXML/jackson-databind","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/3690/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/3690/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/3690/events","html_url":"https://github.com/FasterXML/jackson-databind/issues/3690","id":1478544963,"node_id":"I_kwDOAC5e2c5YIM5D","number":3690,"title":"Incorrect target type for arrays when disabling coercion","user":{"login":"joca-bt","id":1297942,"node_id":"MDQ6VXNlcjEyOTc5NDI=","avatar_url":"https://avatars.githubusercontent.com/u/1297942?v=4","gravatar_id":"","url":"https://api.github.com/users/joca-bt","html_url":"https://github.com/joca-bt","followers_url":"https://api.github.com/users/joca-bt/followers","following_url":"https://api.github.com/users/joca-bt/following{/other_user}","gists_url":"https://api.github.com/users/joca-bt/gists{/gist_id}","starred_url":"https://api.github.com/users/joca-bt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joca-bt/subscriptions","organizations_url":"https://api.github.com/users/joca-bt/orgs","repos_url":"https://api.github.com/users/joca-bt/repos","events_url":"https://api.github.com/users/joca-bt/events{/privacy}","received_events_url":"https://api.github.com/users/joca-bt/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2022-12-06T08:31:37Z","updated_at":"2023-01-06T03:54:04Z","closed_at":"2023-01-06T03:54:04Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When disabling coercions and providing a wrong type on an array element, the error message is specifying that we are trying to coerce the type of the array when it should mention we are trying to coerce the type of the element of the array. See the example below.\r\n\r\n```\r\n// Test class.\r\npublic class Input<T> {\r\n    private final T field;\r\n\r\n    public Input(@JsonProperty(\"field\") T value) {\r\n        this.field = value;\r\n    }\r\n}\r\n\r\n// Building a strict ObjectMapper.\r\nObjectMapper objectMapper = JsonMapper.builder()\r\n    .withCoercionConfigDefaults(config -> {\r\n        config.setCoercion(CoercionInputShape.Boolean, CoercionAction.Fail)\r\n            .setCoercion(CoercionInputShape.Integer, CoercionAction.Fail)\r\n            .setCoercion(CoercionInputShape.Float, CoercionAction.Fail)\r\n            .setCoercion(CoercionInputShape.String, CoercionAction.Fail)\r\n            .setCoercion(CoercionInputShape.Array, CoercionAction.Fail)\r\n            .setCoercion(CoercionInputShape.Object, CoercionAction.Fail);\r\n    })\r\n    .build();\r\nTypeFactory typeFactory = objectMapper.getTypeFactory();\r\n\r\nJavaType arrayType = typeFactory.constructParametricType(List.class, String.class);\r\nJavaType inputType = typeFactory.constructParametricType(Input.class, arrayType);\r\nString json = \"{ \\\"field\\\": [ 1 ] }\";\r\nobjectMapper.readValue(json, inputType);\r\n\r\n// Was expecting an error about field[0] being an integer instead of a string. Instead got the following:\r\n-> com.fasterxml.jackson.databind.exc.InvalidFormatException: Cannot coerce Integer value (1) to element of `java.util.ArrayList<java.lang.String>` (but could if coercion was enabled using `CoercionConfig`)\r\n at [Source: (String)\"{ \"field\": [ 1 ] }\"; line: 1, column: 14] (through reference chain: ...$Input[\"field\"]->java.util.ArrayList[0])\r\n// It seems it might just be the message that is wrong? Since [0] is mentioned.\r\n\r\n// A truly strict String parser.\r\npublic class StringDeserializer extends JsonDeserializer<String> {\r\n    @Override\r\n    public String deserialize(JsonParser parser, DeserializationContext context) throws IOException {\r\n        if (!parser.hasToken(VALUE_STRING)) {\r\n            throw context.wrongTokenException(parser, String.class, VALUE_STRING, null);\r\n        }\r\n\r\n        return parser.getText();\r\n    }\r\n}\r\n\r\n// If we register the StringDeserializer above in the ObjectMapper we will then get the expected error.\r\n-> com.fasterxml.jackson.databind.exc.MismatchedInputException: Unexpected token (VALUE_NUMBER_INT), expected VALUE_STRING\r\n at [Source: (String)\"{ \"field\": [ 1 ] }\"; line: 1, column: 14] (through reference chain: ...$Input[\"field\"]->java.util.ArrayList[0])\r\n```\r\n\r\nRelated to https://github.com/FasterXML/jackson-databind/issues/3240/.\r\nProbably similar to https://github.com/FasterXML/jackson-databind/issues/2567/?","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/3690/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/3690/timeline","performed_via_github_app":null,"state_reason":"completed"}