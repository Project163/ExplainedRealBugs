{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2822","repository_url":"https://api.github.com/repos/FasterXML/jackson-databind","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2822/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2822/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2822/events","html_url":"https://github.com/FasterXML/jackson-databind/issues/2822","id":681616303,"node_id":"MDU6SXNzdWU2ODE2MTYzMDM=","number":2822,"title":"Using JsonValue and JsonFormat on one field does not work as expected","user":{"login":"nils-christian","id":30949845,"node_id":"MDQ6VXNlcjMwOTQ5ODQ1","avatar_url":"https://avatars.githubusercontent.com/u/30949845?v=4","gravatar_id":"","url":"https://api.github.com/users/nils-christian","html_url":"https://github.com/nils-christian","followers_url":"https://api.github.com/users/nils-christian/followers","following_url":"https://api.github.com/users/nils-christian/following{/other_user}","gists_url":"https://api.github.com/users/nils-christian/gists{/gist_id}","starred_url":"https://api.github.com/users/nils-christian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nils-christian/subscriptions","organizations_url":"https://api.github.com/users/nils-christian/orgs","repos_url":"https://api.github.com/users/nils-christian/repos","events_url":"https://api.github.com/users/nils-christian/events{/privacy}","received_events_url":"https://api.github.com/users/nils-christian/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/116","html_url":"https://github.com/FasterXML/jackson-databind/milestone/116","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/116/labels","id":5762549,"node_id":"MDk6TWlsZXN0b25lNTc2MjU0OQ==","number":116,"title":"2.11.3","description":"Release notes: https://github.com/FasterXML/jackson/wiki/Jackson-Release-2.11.3\r\n","creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":6,"state":"closed","created_at":"2020-08-12T03:52:01Z","updated_at":"2021-03-04T04:20:43Z","due_on":"2020-10-02T07:00:00Z","closed_at":"2021-03-04T04:20:43Z"},"comments":4,"created_at":"2020-08-19T07:33:07Z","updated_at":"2020-12-09T04:12:20Z","closed_at":"2020-09-30T01:19:12Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi,\r\n\r\nWe tried to use the both annotations `JsonValue `and `JsonFormat` on one field, but the serialization does not work as expected. Assume following code:\r\n\r\n```\r\npublic static void main( final String[] args ) throws JsonProcessingException {\r\n\tfinal ObjectMapper objectMapper = new ObjectMapper( );\r\n\tobjectMapper.enable( SerializationFeature.INDENT_OUTPUT );\r\n\tobjectMapper.setVisibility( PropertyAccessor.ALL, Visibility.NONE );\r\n\tobjectMapper.setVisibility( PropertyAccessor.FIELD, Visibility.ANY );\r\n\r\n\tSystem.out.println( objectMapper.writeValueAsString( new A( \"Some Value\", new B( BigDecimal.ONE ) ) ) );\r\n}\r\n\r\nprivate static class A {\r\n\r\n\tprivate final String description;\r\n\tprivate final B b;\r\n\r\n\tpublic A( final String description, final B b ) {\r\n\t\tthis.description = description;\r\n\t\tthis.b = b;\r\n\t}\r\n\r\n}\r\n\r\nprivate static class B {\r\n\r\n\t@JsonValue\r\n\t@JsonFormat( shape = Shape.STRING )\r\n\tprivate final BigDecimal value;\r\n\r\n\tpublic B( final BigDecimal value ) {\r\n\t\tthis.value = value;\r\n\t}\r\n\r\n}\r\n```\r\n\r\nNote that the field `value` of `B` has two annotations. The resulting string is \r\n```\r\n{\r\n  \"description\" : \"Some Value\",\r\n  \"b\" : 1\r\n}\r\n```\r\n\r\nWe would expect the value of `B` beeing written as a string, so we would expect\r\n```\r\n{\r\n  \"description\" : \"Some Value\",\r\n  \"b\" : \"1\"\r\n}\r\n```\r\n\r\nIf we remove the `JsonValue `annotation, we get the correct (but nested) value\r\n```\r\n{\r\n  \"description\" : \"Some Value\",\r\n  \"b\" : {\r\n    \"value\" : \"1\"\r\n  }\r\n}\r\n```\r\n\r\nIs this a bug or the correct behaviour?\r\n\r\nThank you and best regards\r\n\r\n  Nils\r\n\r\nEdit: We are using Jackson 2.11.2.","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2822/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2822/timeline","performed_via_github_app":null,"state_reason":"completed"}