{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/4561","repository_url":"https://api.github.com/repos/FasterXML/jackson-databind","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/4561/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/4561/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/4561/events","html_url":"https://github.com/FasterXML/jackson-databind/issues/4561","id":2334051348,"node_id":"I_kwDOAC5e2c6LHswU","number":4561,"title":"Issues using `jackson-databind` 2.17.1 with Reactor (wrt `DeserializerCache` and `ReentrantLock`)","user":{"login":"wdallastella","id":171266965,"node_id":"U_kgDOCjVTlQ","avatar_url":"https://avatars.githubusercontent.com/u/171266965?v=4","gravatar_id":"","url":"https://api.github.com/users/wdallastella","html_url":"https://github.com/wdallastella","followers_url":"https://api.github.com/users/wdallastella/followers","following_url":"https://api.github.com/users/wdallastella/following{/other_user}","gists_url":"https://api.github.com/users/wdallastella/gists{/gist_id}","starred_url":"https://api.github.com/users/wdallastella/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wdallastella/subscriptions","organizations_url":"https://api.github.com/users/wdallastella/orgs","repos_url":"https://api.github.com/users/wdallastella/repos","events_url":"https://api.github.com/users/wdallastella/events{/privacy}","received_events_url":"https://api.github.com/users/wdallastella/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":6031275861,"node_id":"LA_kwDOAC5e2c8AAAABZ333VQ","url":"https://api.github.com/repos/FasterXML/jackson-databind/labels/2.17","name":"2.17","color":"0052cc","default":false,"description":"Issues planned at earliest for 2.17"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/165","html_url":"https://github.com/FasterXML/jackson-databind/milestone/165","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/165/labels","id":11142307,"node_id":"MI_kwDOAC5e2c4AqgSj","number":165,"title":"2.17.2","description":null,"creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":5,"state":"closed","created_at":"2024-06-05T00:59:35Z","updated_at":"2025-10-30T23:30:01Z","due_on":null,"closed_at":"2025-10-30T23:30:01Z"},"comments":4,"created_at":"2024-06-04T17:38:50Z","updated_at":"2024-06-06T18:19:36Z","closed_at":"2024-06-05T01:03:51Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Search before asking\r\n\r\n- [X] I searched in the [issues](https://github.com/FasterXML/jackson-databind/issues) and found nothing similar.\r\n\r\n### Describe the bug\r\n\r\nRelated to: https://github.com/FasterXML/jackson-databind/pull/4430#issuecomment-2147625639\r\n\r\nAfter upgrading to Spring Boot 3 (jackson 2.17.1) we start having the bellow issue.\r\n\r\nI'm using webflux with reactive-feign. Downgrading jackson to 2.17.0 fix the issue.\r\n\r\n```\r\njava.lang.IllegalMonitorStateException: null\r\n\tat java.base/java.util.concurrent.locks.ReentrantLock$Sync.tryRelease(ReentrantLock.java:175)\r\n\tSuppressed: reactor.core.publisher.FluxOnAssembly$OnAssemblyException: \r\nAssembly trace from producer [reactor.core.publisher.MonoLiftFuseable] :\r\n\treactor.core.publisher.Mono.flatMap(Mono.java:3171)\r\n\treactivefeign.publisher.MonoPublisherHttpClient.executeRequest(MonoPublisherHttpClient.java:25)\r\nError has been observed at the following site(s):\r\n\t*____Mono.flatMap ⇢ at reactivefeign.publisher.MonoPublisherHttpClient.executeRequest(MonoPublisherHttpClient.java:25)\r\n\t|_ Mono.transform ⇢ at org.springframework.cloud.circuitbreaker.resilience4j.ReactiveResilience4JCircuitBreaker.run(ReactiveResilience4JCircuitBreaker.java:90)\r\n\t|_   Mono.timeout ⇢ at org.springframework.cloud.circuitbreaker.resilience4j.ReactiveResilience4JCircuitBreaker.run(ReactiveResilience4JCircuitBreaker.java:93)\r\n\t|_ Mono.doOnError ⇢ at org.springframework.cloud.circuitbreaker.resilience4j.ReactiveResilience4JCircuitBreaker.run(ReactiveResilience4JCircuitBreaker.java:97)\r\nOriginal Stack Trace:\r\n\t\tat java.base/java.util.concurrent.locks.ReentrantLock$Sync.tryRelease(ReentrantLock.java:175)\r\n\t\tat java.base/java.util.concurrent.locks.AbstractQueuedSynchronizer.release(AbstractQueuedSynchronizer.java:1007)\r\n\t\tat java.base/java.util.concurrent.locks.ReentrantLock.unlock(ReentrantLock.java:494)\r\n\t\tat com.fasterxml.jackson.databind.deser.DeserializerCache._createAndCacheValueDeserializer(DeserializerCache.java:282)\r\n\t\tat com.fasterxml.jackson.databind.deser.DeserializerCache.hasValueDeserializerFor(DeserializerCache.java:219)\r\n\t\tat com.fasterxml.jackson.databind.DeserializationContext.hasValueDeserializerFor(DeserializationContext.java:614)\r\n\t\tat com.fasterxml.jackson.databind.ObjectMapper.canDeserialize(ObjectMapper.java:3673)\r\n\t\tat org.springframework.http.codec.json.AbstractJackson2Decoder.canDecode(AbstractJackson2Decoder.java:112)\r\n\t\tat org.springframework.http.codec.DecoderHttpMessageReader.canRead(DecoderHttpMessageReader.java:97)\r\n\t\tat org.springframework.web.reactive.function.BodyExtractors.readWithMessageReaders(BodyExtractors.java:198)\r\n\t\tat org.springframework.web.reactive.function.BodyExtractors.lambda$toMono$2(BodyExtractors.java:84)\r\n\t\tat org.springframework.web.reactive.function.client.DefaultClientResponse.body(DefaultClientResponse.java:135)\r\n\t\tat org.springframework.web.reactive.function.client.DefaultClientResponse.bodyToMono(DefaultClientResponse.java:155)\r\n\t\tat reactivefeign.webclient.client.WebReactiveHttpResponse.body(WebReactiveHttpResponse.java:53)\r\n\r\n```\r\n\r\nTested as well with `2.18.0`, in this case we have blockhound claiming: \r\n```\r\nreactor.blockhound.BlockingOperationError: Blocking call! jdk.internal.misc.Unsafe#park\r\n\tat java.base/jdk.internal.misc.Unsafe.park(Unsafe.java)\r\n\tSuppressed: reactor.core.publisher.FluxOnAssembly$OnAssemblyException: \r\nAssembly trace from producer [reactor.core.publisher.MonoLiftFuseable] :\r\n\treactor.core.publisher.Mono.flatMap(Mono.java:3171)\r\n\treactivefeign.publisher.MonoPublisherHttpClient.executeRequest(MonoPublisherHttpClient.java:25)\r\n```\r\n\r\nIf I ignore (like bellow), it works, but we might have issues if there is really a blocking call when using reactor.\r\n```\r\nclass TestBlockHoundIntegration : BlockHoundIntegration {\r\n    override fun applyTo(builder: BlockHound.Builder) {\r\n        builder.allowBlockingCallsInside(\"com.fasterxml.jackson.databind.deser.DeserializerCache\", \"hasValueDeserializerFor\")\r\n    }\r\n}\r\n```\r\n\r\n### Version Information\r\n\r\n2.17.1\r\n\r\n### Reproduction\r\n\r\nTrying to create a sample project ...\r\n\r\n### Expected behavior\r\n\r\nNo issues while parsing messages using jackson-databind and reactor.\r\n\r\n### Additional context\r\n\r\nhttps://github.com/FasterXML/jackson-databind/pull/4430#issuecomment-2147625639","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/4561/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/4561/timeline","performed_via_github_app":null,"state_reason":"completed"}