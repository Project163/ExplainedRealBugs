{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2679","repository_url":"https://api.github.com/repos/FasterXML/jackson-databind","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2679/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2679/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2679/events","html_url":"https://github.com/FasterXML/jackson-databind/issues/2679","id":593865101,"node_id":"MDU6SXNzdWU1OTM4NjUxMDE=","number":2679,"title":"`ObjectMapper.readValue(\"123\", Void.TYPE)` throws \"should never occur\"","user":{"login":"stolsvik","id":3123344,"node_id":"MDQ6VXNlcjMxMjMzNDQ=","avatar_url":"https://avatars.githubusercontent.com/u/3123344?v=4","gravatar_id":"","url":"https://api.github.com/users/stolsvik","html_url":"https://github.com/stolsvik","followers_url":"https://api.github.com/users/stolsvik/followers","following_url":"https://api.github.com/users/stolsvik/following{/other_user}","gists_url":"https://api.github.com/users/stolsvik/gists{/gist_id}","starred_url":"https://api.github.com/users/stolsvik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stolsvik/subscriptions","organizations_url":"https://api.github.com/users/stolsvik/orgs","repos_url":"https://api.github.com/users/stolsvik/repos","events_url":"https://api.github.com/users/stolsvik/events{/privacy}","received_events_url":"https://api.github.com/users/stolsvik/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/111","html_url":"https://github.com/FasterXML/jackson-databind/milestone/111","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/111/labels","id":5275397,"node_id":"MDk6TWlsZXN0b25lNTI3NTM5Nw==","number":111,"title":"2.10.4","description":"Release notes: https://github.com/FasterXML/jackson/wiki/Jackson-Release-2.10.4","creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":1,"state":"closed","created_at":"2020-04-05T03:02:48Z","updated_at":"2021-03-04T04:22:30Z","due_on":"2020-05-03T07:00:00Z","closed_at":"2021-03-04T04:22:30Z"},"comments":1,"created_at":"2020-04-04T13:35:39Z","updated_at":"2020-04-05T03:16:42Z","closed_at":"2020-04-05T03:16:42Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"`objectMapper.readValue(\"123\", Void.class)` returns null.\r\n`objectMapper.readValue(\"123\", Void.TYPE)` throws JsonMappingException, with cause IllegalArgumentException, whose code comment reads \"should never occur\".\r\n`objectMapper.readValue(\"123\", void.class)` also throws, since `void.class == Void.TYPE`\r\n\r\nI would argue that Void.TYPE and void.class should also return null, unconditionally.\r\n\r\n.. basically, in the same vein as if specifying Void.class, you get null, and considering\r\n`objectMapper.readValue(\"123\", Integer.TYPE)` returns 123 - and that the _only_ value a Void variable can have is null.\r\n\r\nCause Exception:\r\n```\r\nCaused by: java.lang.IllegalArgumentException: Internal error: can't find deserializer for void\r\n\tat com.fasterxml.jackson.databind.deser.std.NumberDeserializers.find(NumberDeserializers.java:109)\r\n\tat com.fasterxml.jackson.databind.deser.BasicDeserializerFactory.findDefaultDeserializer(BasicDeserializerFactory.java:1845)\r\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializerFactory.findStdDeserializer(BeanDeserializerFactory.java:167)\r\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializerFactory.createBeanDeserializer(BeanDeserializerFactory.java:131)\r\n...\r\n```\r\nThe reason is that this NumberDeserializers first checks whether the class is primitive (yes), and then has checks for all of Integer.TYPE, Boolean.TYPE etc, but lacks one for Void.TYPE. It thus falls out of that \"then\" block, and hits the default \"should never occur\".\r\n\r\nThe reason why this hits me, is that I have a (de)serialization situation in my library where users must specify which type they need their incoming message as - but can also effectively say \"I don't care\". Up until now I've used Void.class for this, but have come to realize that this is actually not correct - as the Void _class_ that holds the `TYPE` field is \"just a random class\". You want either `void.class` (lowercase 'v'), or \"Void.TYPE\" - these two are actually the same instance, as opposed to `Void.class`.\r\n\r\nThe `Void.class` actually works because there is special handling for this case in JdkDeserializers:\r\n```\r\n            if (rawType == Void.class) {\r\n                return NullifyingDeserializer.instance;\r\n            }\r\n```\r\nThis does not catch the void.class (or Void.TYPE), and it is anyway too late, since the NumberDeserializers class already has crashed it.\r\n\r\nHere's a small test:\r\n```\r\npublic class TestVoid {\r\n    public static void main(String[] args) throws JsonProcessingException {\r\n        System.out.println(\"Void.class: \"+System.identityHashCode(Void.class));\r\n        System.out.println(\"void.class: \"+System.identityHashCode(void.class));\r\n        System.out.println(\"Void.TYPE: \"+System.identityHashCode(Void.TYPE));\r\n        System.out.println(\"Void.TYPE == void.class: \"+(void.class == Void.TYPE));\r\n        System.out.println(\"----\");\r\n\r\n        ObjectMapper ser = new ObjectMapper();\r\n        System.out.println(\"Deserialized Void.class: \"+ser.readValue(\"123\", Void.class));\r\n        System.out.println(\"Deserialized Integer.TYPE: \"+ser.readValue(\"123\", Integer.TYPE));\r\n        System.out.println(\"Deserialized void.class: \"+ser.readValue(\"123\", void.class));\r\n        System.out.println(\"Deserialized Void.TYPE: \"+ser.readValue(\"123\", Void.TYPE));\r\n    }\r\n}\r\n```\r\n\r\nPrints something like:\r\n```\r\nVoid.class: 999966131\r\nvoid.class: 1989780873\r\nVoid.TYPE: 1989780873\r\nVoid.TYPE == void.class: true\r\n----\r\nDeserialized Void.class: null\r\nDeserialized Integer.TYPE: 123\r\nException in thread \"main\" com.fasterxml.jackson.databind.JsonMappingException: Internal error: can't find deserializer for void\r\n at [Source: (String)\"123\"; line: 1, column: 1]\r\n```","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2679/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2679/timeline","performed_via_github_app":null,"state_reason":"completed"}