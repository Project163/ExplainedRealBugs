{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2556","repository_url":"https://api.github.com/repos/FasterXML/jackson-databind","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2556/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2556/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2556/events","html_url":"https://github.com/FasterXML/jackson-databind/issues/2556","id":530375664,"node_id":"MDU6SXNzdWU1MzAzNzU2NjQ=","number":2556,"title":"Contention in `TypeNameIdResolver.idFromClass()`","user":{"login":"CodingFabian","id":176132,"node_id":"MDQ6VXNlcjE3NjEzMg==","avatar_url":"https://avatars.githubusercontent.com/u/176132?v=4","gravatar_id":"","url":"https://api.github.com/users/CodingFabian","html_url":"https://github.com/CodingFabian","followers_url":"https://api.github.com/users/CodingFabian/followers","following_url":"https://api.github.com/users/CodingFabian/following{/other_user}","gists_url":"https://api.github.com/users/CodingFabian/gists{/gist_id}","starred_url":"https://api.github.com/users/CodingFabian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CodingFabian/subscriptions","organizations_url":"https://api.github.com/users/CodingFabian/orgs","repos_url":"https://api.github.com/users/CodingFabian/repos","events_url":"https://api.github.com/users/CodingFabian/events{/privacy}","received_events_url":"https://api.github.com/users/CodingFabian/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/106","html_url":"https://github.com/FasterXML/jackson-databind/milestone/106","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/106/labels","id":4857949,"node_id":"MDk6TWlsZXN0b25lNDg1Nzk0OQ==","number":106,"title":"2.10.2","description":"Release notes: https://github.com/FasterXML/jackson/wiki/Jackson-Release-2.10.2","creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":10,"state":"closed","created_at":"2019-11-18T23:52:41Z","updated_at":"2021-03-04T04:23:07Z","due_on":"2020-01-05T08:00:00Z","closed_at":"2021-03-04T04:22:49Z"},"comments":16,"created_at":"2019-11-29T14:32:58Z","updated_at":"2019-12-03T05:15:30Z","closed_at":"2019-12-03T04:53:46Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"We are using Jackson 2.9.10 and we have many threads serializing Java objects onto kafka.\r\n\r\nUnder high load (cough, black friday), we see several threads blocking on the type map that is contained in TypeNameIdResolver\r\n\r\n```\r\ndownstream-7 id=121 state=BLOCKED\r\n    - waiting to lock <0x1a5caa08> (a java.util.HashMap)\r\n     owned by downstream-4 id=118\r\n    at com.fasterxml.jackson.databind.jsontype.impl.TypeNameIdResolver.idFromClass(TypeNameIdResolver.java:95)\r\n    at com.fasterxml.jackson.databind.jsontype.impl.TypeNameIdResolver.idFromValue(TypeNameIdResolver.java:83)\r\n    at com.fasterxml.jackson.databind.jsontype.impl.TypeSerializerBase.idFromValue(TypeSerializerBase.java:82)\r\n    at com.fasterxml.jackson.databind.jsontype.impl.TypeSerializerBase._generateTypeId(TypeSerializerBase.java:67)\r\n    at com.fasterxml.jackson.databind.jsontype.impl.TypeSerializerBase.writeTypePrefix(TypeSerializerBase.java:45)\r\n    at com.fasterxml.jackson.databind.ser.std.BeanSerializerBase.serializeWithType(BeanSerializerBase.java:600)\r\n    at com.fasterxml.jackson.databind.ser.std.CollectionSerializer.serializeContents(CollectionSerializer.java:147)\r\n    at com.fasterxml.jackson.databind.ser.std.CollectionSerializer.serialize(CollectionSerializer.java:107)\r\n    at com.fasterxml.jackson.databind.ser.std.CollectionSerializer.serialize(CollectionSerializer.java:25)\r\n    at com.fasterxml.jackson.databind.ser.BeanPropertyWriter.serializeAsField(BeanPropertyWriter.java:727)\r\n    at com.fasterxml.jackson.module.afterburner.ser.ObjectMethodPropertyWriter.serializeAsField(ObjectMethodPropertyWriter.java:40)\r\n    at com.fasterxml.jackson.databind.ser.std.BeanSerializerBase.serializeFields(BeanSerializerBase.java:719)\r\n    at com.fasterxml.jackson.databind.ser.BeanSerializer.serialize(BeanSerializer.java:155)\r\n    at com.fasterxml.jackson.databind.ser.DefaultSerializerProvider._serialize(DefaultSerializerProvider.java:480)\r\n    at com.fasterxml.jackson.databind.ser.DefaultSerializerProvider.serializeValue(DefaultSerializerProvider.java:400)\r\n    at com.fasterxml.jackson.databind.ObjectWriter$Prefetch.serialize(ObjectWriter.java:1392)\r\n    at com.fasterxml.jackson.databind.ObjectWriter._configAndWriteValue(ObjectWriter.java:1120)\r\n    at com.fasterxml.jackson.databind.ObjectWriter.writeValueAsBytes(ObjectWriter.java:1017)\r\n```\r\n\r\nI see that this is a `synchronized` block here:\r\nhttps://github.com/FasterXML/jackson-databind/blob/master/src/main/java/com/fasterxml/jackson/databind/jsontype/impl/TypeNameIdResolver.java#L99\r\n\r\nCould that be changed? Should we somehow use several `TypeNameIdResolver`s (how would one do that?","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2556/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2556/timeline","performed_via_github_app":null,"state_reason":"completed"}