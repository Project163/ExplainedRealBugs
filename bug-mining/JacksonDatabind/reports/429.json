{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2195","repository_url":"https://api.github.com/repos/FasterXML/jackson-databind","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2195/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2195/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2195/events","html_url":"https://github.com/FasterXML/jackson-databind/issues/2195","id":388029953,"node_id":"MDU6SXNzdWUzODgwMjk5NTM=","number":2195,"title":"Add abstraction `PolymorphicTypeValidator`, for limiting subtypes allowed by default typing, `@JsonTypeInfo`","user":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/94","html_url":"https://github.com/FasterXML/jackson-databind/milestone/94","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/94/labels","id":3436724,"node_id":"MDk6TWlsZXN0b25lMzQzNjcyNA==","number":94,"title":"2.10.0","description":"Release notes: https://github.com/FasterXML/jackson/wiki/Jackson-Release-2.10\r\n","creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":44,"state":"open","created_at":"2018-06-19T18:52:40Z","updated_at":"2025-10-03T17:55:08Z","due_on":"2019-09-26T07:00:00Z","closed_at":null},"comments":10,"created_at":"2018-12-06T02:29:20Z","updated_at":"2020-07-04T02:52:39Z","closed_at":"2019-05-31T04:12:50Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"(note: moved from https://github.com/FasterXML/jackson3-dev/issues/21)\r\n\r\nSo: there are many CVEs that exploit permissive nature of class-name-based polymorphic deserialization, and especially so-called \"default typing\", in which polymorphic handling is applied without annotations and with base type of `java.lang.Object`.\r\nSince set of potentially dangerous class types to exploit (\"gadget types\") is unbounded, relying on block-listing (which Jackson does) is not effective in long term. And although there are mechanisms one can use to limit accessibility they are cumbersome and not well documented (Spring framework has built upon this, however, kudos to their persistence and ingenuity :) ).\r\n\r\nBut providing for abstraction that could allow simple strategies such as allow-listing (i.e. enumerating allowed classes), or simple predicate, should not be difficult.\r\nNow that we are planning to do one more 2.x release, 2.10, with easier configurability (via `ObjectMapper.Builder`), we should consider adding an extension point, instead of waiting until 3.0 which was the original plan.\r\n\r\n-----\r\n\r\nFrom original issue, some further thoughts:\r\n\r\nIt should be possible to take another approach: define a new small handler API, to be invoked when:\r\n\r\n* Resolving subtype to serialize / deserialize\r\n* Attempting to construct serializer / deserializer\r\n\r\nThis would allow many things, like:\r\n\r\n* Preventing deserialization and/or serialization of types deemed unsafe (or undesired?)\r\n* Changing of type on deserialization (or, for purpose of locating serializer, also serialization?) one use of which is security check.\r\n\r\nCallback(s) could then:\r\n\r\n* translate type as-is, for \"that's fine\"\r\n* substitute type (subtype for deserialization; supertype for serialization)\r\n* throw exception to indicate that type is illegal to serialize/deserialize\r\n\r\nIn theory it might even be possible to perhaps allow some special handling like \"always deserialize as null\"; but at this point this is speculation.\r\n\r\nAs to applicability: although we should not make definition of such handler mandatory for 2.x,\r\n\r\n---\r\n\r\nSome examples of usage can be found from unit tests `src/test/java/com/fasterxml/jackson/databind/jsontype/vld/ValidatePolymBaseTypeTest.java`, `src/test/java/com/fasterxml/jackson/databind/jsontype/vld/ValidatePolymSubTypeTest.java` and ``src/test/java/com/fasterxml/jackson/databind/jsontype/vld/BasicPTVTest.java`\r\n\r\nbut here is an example:\r\n\r\n```java\r\nPolymorphicTypeValidator validator = ...; // build validator\r\nObjectMapper saferMapper = JsonMapper.builder()\r\n   .activateDefaultTyping(validator) // note the new name of method\r\n   .build();\r\nString json = mapper.writeValueAsString(myDefaultTypeUsingValue);\r\n```\r\n\r\nwhere validator could be complete custom one, or, instance of `BasicPolymorphicTypeValidator` like so:\r\n\r\n```java\r\n        final PolymorphicTypeValidator validator = BasicPolymorphicTypeValidator.builder()\r\n                .allowIfBaseType(MyBaseType.class)\r\n                .build();\r\n```\r\n\r\nwhich would then allow all subtypes of `MyBaseType`, which is something user has control over (and thereby typically has no unsafe subtypes -- and definitely no widely shared ones)\r\n\r\n-----\r\n\r\n***EDIT*** 20-Aug-2019: New methods in `ObjectMapper` (and `MapperBuilder`) use name `activateDefaultTyping()` over old now-deprecated `enableDefaultTyping()` (and similarly for disable/deactivate). This to make it easier to code-search for old methods without needing argument checks.\r\n\r\n-----\r\n\r\n***EDIT*** 16-Oct-2019: Further validating this approach a good overview by Sonatype security research team: https://blog.sonatype.com/jackson-databind-the-end-of-the-blacklist\r\n\r\n\r\n","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2195/reactions","total_count":4,"+1":4,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2195/timeline","performed_via_github_app":null,"state_reason":"completed"}