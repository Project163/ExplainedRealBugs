{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2668","repository_url":"https://api.github.com/repos/FasterXML/jackson-databind","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2668/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2668/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2668/events","html_url":"https://github.com/FasterXML/jackson-databind/issues/2668","id":589493453,"node_id":"MDU6SXNzdWU1ODk0OTM0NTM=","number":2668,"title":"`IllegalArgumentException` thrown for mismatched subclass deserialization ","user":{"login":"nbruno","id":1942995,"node_id":"MDQ6VXNlcjE5NDI5OTU=","avatar_url":"https://avatars.githubusercontent.com/u/1942995?v=4","gravatar_id":"","url":"https://api.github.com/users/nbruno","html_url":"https://github.com/nbruno","followers_url":"https://api.github.com/users/nbruno/followers","following_url":"https://api.github.com/users/nbruno/following{/other_user}","gists_url":"https://api.github.com/users/nbruno/gists{/gist_id}","starred_url":"https://api.github.com/users/nbruno/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nbruno/subscriptions","organizations_url":"https://api.github.com/users/nbruno/orgs","repos_url":"https://api.github.com/users/nbruno/repos","events_url":"https://api.github.com/users/nbruno/events{/privacy}","received_events_url":"https://api.github.com/users/nbruno/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/103","html_url":"https://github.com/FasterXML/jackson-databind/milestone/103","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/103/labels","id":4723280,"node_id":"MDk6TWlsZXN0b25lNDcyMzI4MA==","number":103,"title":"2.11.0","description":"Release notes: https://github.com/FasterXML/jackson/wiki/Jackson-Release-2.11","creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":33,"state":"closed","created_at":"2019-10-05T02:59:55Z","updated_at":"2021-03-04T04:19:59Z","due_on":"2020-04-26T07:00:00Z","closed_at":"2021-03-04T04:19:59Z"},"comments":1,"created_at":"2020-03-28T02:38:15Z","updated_at":"2020-03-29T18:40:07Z","closed_at":"2020-03-29T18:40:07Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Current behavior:**\r\nWhen [TypeFactory](https://github.com/FasterXML/jackson-databind/blob/master/src/main/java/com/fasterxml/jackson/databind/type/TypeFactory.java#L376) encounters a mismatch in subtypes between the property in JSON and the subclass target value, an `IllegalArgumentException` is thrown.\r\n\r\n**Expected behavior:** \r\nA Jackson-specific exception is thrown that callers can handle, perhaps `JsonMappingException`, to indicate that the supplied JSON could not be mapped to the chosen target class.   \r\n\r\n**Use case:**\r\nThis causes issues when callers are dynamically invoking Jackson based on runtime information and can't easily verify if the JSON type info value matches the correct subclass. A generic `IllegalArgumentException` hides the fact that the supplied JSON was invalid. \r\n\r\nOne example of this is in Spring, when during content negotiation, Spring determines the subclass to deserialize into based on the Content-Type header of the request. If the user supplies a JSON payload for subclass A, but a Content-Type header that indicates subclass B, Spring will attempt to parse the JSON as subclass B, and fail with this `IllegalArgumentException`.\r\n\r\nIf a Jackson-specific exception was surfaced, this condition could be handled. With the current behavior, an `IllegalArgumentException` is too broad of an Exception to be able to handle generically. \r\n\r\n**MCVE:**\r\n\r\n    public static void main(String[] args) throws IOException  {\r\n        String json = \"{\\\"type\\\": \\\"child2\\\", \\\"baz\\\":\\\"1\\\"}\"; // JSON for Child2\r\n\r\n        ObjectMapper mapper = new ObjectMapper();\r\n        mapper.readValue(json, Child1.class); // Deserializing into Child1\r\n    }\r\n\r\n    @JsonTypeInfo(use = JsonTypeInfo.Id.NAME, property = \"type\")\r\n    @JsonSubTypes({\r\n        @JsonSubTypes.Type(value = Child1.class, name = \"child1\"),\r\n        @JsonSubTypes.Type(value = Child2.class, name = \"child2\")\r\n    })\r\n    public static class Parent {\r\n    }\r\n\r\n    public static class Child1 extends Parent {\r\n        private String bar;\r\n        // Getter / setter\r\n    }\r\n\r\n    public static class Child2 extends Parent {\r\n        private String baz;\r\n        // Getter / setter\r\n    }","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2668/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2668/timeline","performed_via_github_app":null,"state_reason":"completed"}