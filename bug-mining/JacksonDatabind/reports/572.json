{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2972","repository_url":"https://api.github.com/repos/FasterXML/jackson-databind","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2972/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2972/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2972/events","html_url":"https://github.com/FasterXML/jackson-databind/issues/2972","id":757784289,"node_id":"MDU6SXNzdWU3NTc3ODQyODk=","number":2972,"title":"`ObjectMapper.treeToValue()` no longer invokes `JsonDeserializer.getNullValue()`","user":{"login":"andpal","id":21162759,"node_id":"MDQ6VXNlcjIxMTYyNzU5","avatar_url":"https://avatars.githubusercontent.com/u/21162759?v=4","gravatar_id":"","url":"https://api.github.com/users/andpal","html_url":"https://github.com/andpal","followers_url":"https://api.github.com/users/andpal/followers","following_url":"https://api.github.com/users/andpal/following{/other_user}","gists_url":"https://api.github.com/users/andpal/gists{/gist_id}","starred_url":"https://api.github.com/users/andpal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andpal/subscriptions","organizations_url":"https://api.github.com/users/andpal/orgs","repos_url":"https://api.github.com/users/andpal/repos","events_url":"https://api.github.com/users/andpal/events{/privacy}","received_events_url":"https://api.github.com/users/andpal/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/124","html_url":"https://github.com/FasterXML/jackson-databind/milestone/124","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/124/labels","id":6183946,"node_id":"MDk6TWlsZXN0b25lNjE4Mzk0Ng==","number":124,"title":"2.12.1","description":"Release notes: https://github.com/FasterXML/jackson/wiki/Jackson-Release-2.12.1","creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":9,"state":"closed","created_at":"2020-12-06T01:35:36Z","updated_at":"2021-03-04T03:58:35Z","due_on":"2021-01-08T08:00:00Z","closed_at":"2021-03-04T03:58:35Z"},"comments":2,"created_at":"2020-12-05T21:31:19Z","updated_at":"2020-12-09T04:38:37Z","closed_at":"2020-12-09T04:37:57Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Describe the bug**\r\nIf you invoke `ObjectMapper::treeToValue` it no longer uses `JsonDeserializer::getNullValue` on the class' declared deserializer when encountering a `NullNode`, instead just returning a plain `null`.\r\n\r\n**Version information**\r\nThe regression began in `2.10.0`, I think. I have tested `2.12.0` and the issue is present there. The last working release I have tested is `2.9.10`.\r\n\r\n**To Reproduce**\r\n*pom.xml*\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\r\n    <modelVersion>4.0.0</modelVersion>\r\n    <groupId>se.anpal</groupId>\r\n    <artifactId>jackson-mve</artifactId>\r\n    <version>1.0-SNAPSHOT</version>\r\n    <packaging>jar</packaging>\r\n    <properties>\r\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\r\n        <maven.compiler.source>1.8</maven.compiler.source>\r\n        <maven.compiler.target>1.8</maven.compiler.target>\r\n\r\n        <jackson.version>2.12.0</jackson.version>\r\n        <!-- This is the last version where the test passes -->\r\n        <!--<jackson.version>2.9.10</jackson.version>-->\r\n    </properties>\r\n\r\n    <dependencies>\r\n        <dependency>\r\n            <groupId>com.fasterxml.jackson.core</groupId>\r\n            <artifactId>jackson-databind</artifactId>\r\n            <version>${jackson.version}</version>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>com.fasterxml.jackson.core</groupId>\r\n            <artifactId>jackson-annotations</artifactId>\r\n            <version>${jackson.version}</version>\r\n        </dependency>\r\n\r\n        <dependency>\r\n            <groupId>org.junit.jupiter</groupId>\r\n            <artifactId>junit-jupiter-engine</artifactId>\r\n            <version>5.5.2</version>\r\n            <scope>test</scope>\r\n        </dependency>\r\n    </dependencies>\r\n\r\n    <build>\r\n        <plugins>\r\n            <plugin>\r\n                <groupId>org.apache.maven.plugins</groupId>\r\n                <artifactId>maven-surefire-plugin</artifactId>\r\n                <version>3.0.0-M3</version>\r\n            </plugin>\r\n        </plugins>\r\n    </build>\r\n</project>\r\n```\r\n\r\n*JsonElementTest.java*\r\n```java\r\npackage se.anpal.jackson.mve;\r\n\r\nimport static org.junit.jupiter.api.Assertions.assertEquals;\r\n\r\nimport com.fasterxml.jackson.core.JsonParser;\r\nimport com.fasterxml.jackson.databind.DeserializationContext;\r\nimport com.fasterxml.jackson.databind.JsonDeserializer;\r\nimport com.fasterxml.jackson.databind.ObjectMapper;\r\nimport com.fasterxml.jackson.databind.annotation.JsonDeserialize;\r\nimport com.fasterxml.jackson.databind.node.NullNode;\r\n\r\nimport org.junit.jupiter.api.Test;\r\n\r\nimport se.anpal.jackson.mve.JsonElementTest.JsonElement.JsonNull;\r\n\r\npublic class JsonElementTest {\r\n\r\n    @Test\r\n    public void test() throws Exception {\r\n        NullNode input = NullNode.getInstance();\r\n        JsonNull expected = JsonNull.INSTANCE;\r\n        JsonElement actual = new ObjectMapper().treeToValue(input, JsonElement.class);\r\n        assertEquals(expected, actual);\r\n    }\r\n\r\n    @JsonDeserialize(using = JsonElement.MyDeserializer.class)\r\n    public abstract static class JsonElement {\r\n\r\n        public static class JsonNull extends JsonElement {\r\n\r\n            public static final JsonNull INSTANCE = new JsonNull();\r\n        }\r\n\r\n        public static final class MyDeserializer extends JsonDeserializer<JsonElement> {\r\n\r\n            @Override\r\n            public JsonElement deserialize(JsonParser jp, DeserializationContext dc) {\r\n                throw new UnsupportedOperationException(\"Not needed for this example\");\r\n            }\r\n\r\n            @Override\r\n            public JsonElement getNullValue(DeserializationContext ctxt) {\r\n                return JsonNull.INSTANCE;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n```","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2972/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2972/timeline","performed_via_github_app":null,"state_reason":"completed"}