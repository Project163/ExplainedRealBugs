{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/1604","repository_url":"https://api.github.com/repos/FasterXML/jackson-databind","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/1604/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/1604/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/1604/events","html_url":"https://github.com/FasterXML/jackson-databind/issues/1604","id":221499431,"node_id":"MDU6SXNzdWUyMjE0OTk0MzE=","number":1604,"title":"Nested type arguments doesn't work with polymorphic types","user":{"login":"Raniz85","id":4972103,"node_id":"MDQ6VXNlcjQ5NzIxMDM=","avatar_url":"https://avatars.githubusercontent.com/u/4972103?v=4","gravatar_id":"","url":"https://api.github.com/users/Raniz85","html_url":"https://github.com/Raniz85","followers_url":"https://api.github.com/users/Raniz85/followers","following_url":"https://api.github.com/users/Raniz85/following{/other_user}","gists_url":"https://api.github.com/users/Raniz85/gists{/gist_id}","starred_url":"https://api.github.com/users/Raniz85/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Raniz85/subscriptions","organizations_url":"https://api.github.com/users/Raniz85/orgs","repos_url":"https://api.github.com/users/Raniz85/repos","events_url":"https://api.github.com/users/Raniz85/events{/privacy}","received_events_url":"https://api.github.com/users/Raniz85/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/86","html_url":"https://github.com/FasterXML/jackson-databind/milestone/86","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/86/labels","id":2849363,"node_id":"MDk6TWlsZXN0b25lMjg0OTM2Mw==","number":86,"title":"2.9.3","description":"Release notes: https://github.com/FasterXML/jackson/wiki/Jackson-Release-2.9.3","creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":9,"state":"closed","created_at":"2017-10-19T00:13:37Z","updated_at":"2021-03-04T04:48:06Z","due_on":"2017-12-09T08:00:00Z","closed_at":"2021-03-04T04:48:06Z"},"comments":25,"created_at":"2017-04-13T08:55:47Z","updated_at":"2018-05-09T14:23:55Z","closed_at":"2017-10-19T00:20:06Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When using @JsonSubTypes/@JsonTypeInfo on an interface with a generic parameter (de)serialising a subclass that wraps it's own generic parameter in another generic class or interface doesn't work.\r\n\r\nIt's a bit complex to explain with words so here's a short example:\r\n\r\n```\r\npublic class GenericPolymorphismTest {\r\n    @JsonTypeInfo(property = \"type\", use = JsonTypeInfo.Id.NAME)\r\n    @JsonSubTypes({\r\n            @JsonSubTypes.Type(value = AddToList.class, name = \"addToList\")\r\n    })\r\n    public interface Operation<T> {\r\n        T perform(T operand);\r\n    }\r\n\r\n    public static class AddToList<T> implements Operation<List<T>> {\r\n        T value;\r\n        @Override\r\n        public List<T> perform(List<T> operand) {\r\n            operand.add(value);\r\n            return operand;\r\n        }\r\n    }\r\n\r\n    public static class Container {\r\n        Operation<List<UUID>> listOperation;\r\n    }\r\n\r\n    private static final ObjectMapper objectMapper = new ObjectMapper();\r\n    static {\r\n        objectMapper.setVisibility(new VisibilityChecker.Std(JsonAutoDetect.Visibility.ANY));\r\n    }\r\n\r\n    public static void main(String[] args) throws JsonProcessingException {\r\n        AddToList<UUID> addToList = new AddToList<>();\r\n        addToList.value = UUID.randomUUID();\r\n        Container container = new Container();\r\n        container.listOperation = addToList;\r\n\r\n        System.out.println(objectMapper.writeValueAsString(container));\r\n    }\r\n}\r\n```\r\n\r\nThis crashes with the following exception:\r\n\r\n```\r\nException in thread \"main\" com.fasterxml.jackson.databind.JsonMappingException: Class java.util.UUID not subtype of [collection type; class java.util.List, contains [simple type, class java.util.UUID]] (through reference chain: GenericPolymorphismTest$Container[\"listOperation\"]->GenericPolymorphismTest$AddToList[\"value\"])\r\n\tat com.fasterxml.jackson.databind.JsonMappingException.wrapWithPath(JsonMappingException.java:388)\r\n\tat com.fasterxml.jackson.databind.JsonMappingException.wrapWithPath(JsonMappingException.java:348)\r\n\tat com.fasterxml.jackson.databind.ser.std.StdSerializer.wrapAndThrow(StdSerializer.java:343)\r\n\tat com.fasterxml.jackson.databind.ser.std.BeanSerializerBase.serializeFields(BeanSerializerBase.java:698)\r\n\tat com.fasterxml.jackson.databind.ser.std.BeanSerializerBase.serializeWithType(BeanSerializerBase.java:581)\r\n\tat com.fasterxml.jackson.databind.ser.BeanPropertyWriter.serializeAsField(BeanPropertyWriter.java:706)\r\n\tat com.fasterxml.jackson.databind.ser.std.BeanSerializerBase.serializeFields(BeanSerializerBase.java:690)\r\n\tat com.fasterxml.jackson.databind.ser.BeanSerializer.serialize(BeanSerializer.java:155)\r\n\tat com.fasterxml.jackson.databind.ser.DefaultSerializerProvider.serializeValue(DefaultSerializerProvider.java:292)\r\n\tat com.fasterxml.jackson.databind.ObjectMapper._configAndWriteValue(ObjectMapper.java:3681)\r\n\tat com.fasterxml.jackson.databind.ObjectMapper.writeValueAsString(ObjectMapper.java:3057)\r\n\tat GenericPolymorphismTest.main(GenericPolymorphismTest.java:57)\r\nCaused by: java.lang.IllegalArgumentException: Class java.util.UUID not subtype of [collection type; class java.util.List, contains [simple type, class java.util.UUID]]\r\n\tat com.fasterxml.jackson.databind.type.TypeFactory.constructSpecializedType(TypeFactory.java:359)\r\n\tat com.fasterxml.jackson.databind.cfg.MapperConfig.constructSpecializedType(MapperConfig.java:306)\r\n\tat com.fasterxml.jackson.databind.DatabindContext.constructSpecializedType(DatabindContext.java:149)\r\n\tat com.fasterxml.jackson.databind.ser.BeanPropertyWriter._findAndAddDynamic(BeanPropertyWriter.java:870)\r\n\tat com.fasterxml.jackson.databind.ser.BeanPropertyWriter.serializeAsField(BeanPropertyWriter.java:682)\r\n\tat com.fasterxml.jackson.databind.ser.std.BeanSerializerBase.serializeFields(BeanSerializerBase.java:690)\r\n\t... 8 more\r\n```\r\n\r\nIf I try work around it by making `value` into a `List<T>` deserialisation works but serialisation gives me a `List<String>` instead of `List<UUID>` so using a list after `perform` will throw `ClassCastException`s.","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/1604/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/1604/timeline","performed_via_github_app":null,"state_reason":"completed"}