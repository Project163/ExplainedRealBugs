{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/3275","repository_url":"https://api.github.com/repos/FasterXML/jackson-databind","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/3275/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/3275/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/3275/events","html_url":"https://github.com/FasterXML/jackson-databind/issues/3275","id":995251241,"node_id":"MDU6SXNzdWU5OTUyNTEyNDE=","number":3275,"title":"JDK 16 Illegal reflective access for `Throwable.setCause()` with `PropertyNamingStrategy.UPPER_CAMEL_CASE`","user":{"login":"jsharper","id":5386601,"node_id":"MDQ6VXNlcjUzODY2MDE=","avatar_url":"https://avatars.githubusercontent.com/u/5386601?v=4","gravatar_id":"","url":"https://api.github.com/users/jsharper","html_url":"https://github.com/jsharper","followers_url":"https://api.github.com/users/jsharper/followers","following_url":"https://api.github.com/users/jsharper/following{/other_user}","gists_url":"https://api.github.com/users/jsharper/gists{/gist_id}","starred_url":"https://api.github.com/users/jsharper/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jsharper/subscriptions","organizations_url":"https://api.github.com/users/jsharper/orgs","repos_url":"https://api.github.com/users/jsharper/repos","events_url":"https://api.github.com/users/jsharper/events{/privacy}","received_events_url":"https://api.github.com/users/jsharper/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/142","html_url":"https://github.com/FasterXML/jackson-databind/milestone/142","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/milestones/142/labels","id":8023311,"node_id":"MI_kwDOAC5e2c4Aem0P","number":142,"title":"2.13.4","description":null,"creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":3,"state":"open","created_at":"2022-05-26T23:49:31Z","updated_at":"2022-10-05T22:35:19Z","due_on":null,"closed_at":null},"comments":16,"created_at":"2021-09-13T19:34:50Z","updated_at":"2022-05-26T23:50:23Z","closed_at":"2022-05-26T23:48:12Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Describe the bug**\r\nMapping a json string to an instance of RuntimeException with JDK 16 (which defaults to denying illegal reflective access) while using UPPER_CAMEL_CASE property naming strategy, fails with:\r\n\r\n```\r\nException in thread \"main\" com.fasterxml.jackson.databind.exc.InvalidDefinitionException: Failed to call `setAccess()` on Method 'setCause' due to `java.lang.reflect.InaccessibleObjectException`, problem: Unable to make final void java.lang.Throwable.setCause(java.lang.Throwable) accessible: module java.base does not \"opens java.lang\" to unnamed module\r\n```\r\n\r\nThis manifests in parts of the AWS v1 SDK when an error is received from the AWS API endpoints.  Note example report: https://github.com/FasterXML/jackson-databind/issues/2464#issuecomment-856996757\r\n\r\nThe simplified reproduce case below is based on what the failing AWS SDK code is doing internally in `com.amazonaws.transform.JsonErrorUnmarshaller.unmarshall`.\r\n\r\n**Version information**\r\n2.12.3, 2.12.5, 2.13.0-rc2\r\n\r\n**To Reproduce**\r\nExecute this code without any `--add-opens` params and with default `--illegal-access` setting of deny.\r\n\r\n```java\r\npublic class Test {\r\n\tpublic static void main(String[] args) throws Exception {\r\n\t\tObjectMapper mapper = new ObjectMapper();\r\n\t\tmapper.setPropertyNamingStrategy(PropertyNamingStrategies.UPPER_CAMEL_CASE);\r\n\r\n\t\tString jsonString = \"{\\\"message\\\":\\\"This is my runtime exception message\\\"}\";\r\n\t\tJsonNode jsonContent = mapper.readTree(jsonString);\r\n\r\n\t\tthrow mapper.treeToValue(jsonContent, RuntimeException.class);\r\n\t}\r\n}\r\n```\r\n\r\n**Expected behavior**\r\nIt is expected that the code above would throw a RuntimeException with a message of \"This is my runtime exception message\".  This is what happens when working around the issue with java parameter `--add-opens java.base/java.lang=ALL-UNNAMED`\r\n\r\n**Additional context**\r\nUsing java parameter `--illegal-access=debug` results in the following additional info:\r\n\r\n```\r\nWARNING: Illegal reflective access by com.fasterxml.jackson.databind.util.ClassUtil (file:/xxxxxx/jackson-databind-2.13.0-rc2.jar) to method java.lang.Throwable.setCause(java.lang.Throwable)\r\n\tat com.fasterxml.jackson.databind.util.ClassUtil.checkAndFixAccess(ClassUtil.java:994)\r\n\tat com.fasterxml.jackson.databind.introspect.AnnotatedMember.fixAccess(AnnotatedMember.java:139)\r\n\tat com.fasterxml.jackson.databind.deser.impl.MethodProperty.fixAccess(MethodProperty.java:95)\r\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializerBuilder._fixAccess(BeanDeserializerBuilder.java:522)\r\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializerBuilder.build(BeanDeserializerBuilder.java:373)\r\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializerFactory.buildThrowableDeserializer(BeanDeserializerFactory.java:455)\r\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializerFactory.createBeanDeserializer(BeanDeserializerFactory.java:112)\r\n\tat com.fasterxml.jackson.databind.deser.DeserializerCache._createDeserializer2(DeserializerCache.java:415)\r\n\tat com.fasterxml.jackson.databind.deser.DeserializerCache._createDeserializer(DeserializerCache.java:350)\r\n\tat com.fasterxml.jackson.databind.deser.DeserializerCache._createAndCache2(DeserializerCache.java:264)\r\n\tat com.fasterxml.jackson.databind.deser.DeserializerCache._createAndCacheValueDeserializer(DeserializerCache.java:244)\r\n\tat com.fasterxml.jackson.databind.deser.DeserializerCache.findValueDeserializer(DeserializerCache.java:142)\r\n\tat com.fasterxml.jackson.databind.DeserializationContext.findRootValueDeserializer(DeserializationContext.java:642)\r\n\tat com.fasterxml.jackson.databind.ObjectMapper._findRootDeserializer(ObjectMapper.java:4751)\r\n\tat com.fasterxml.jackson.databind.ObjectMapper._readValue(ObjectMapper.java:4596)\r\n\tat com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:2815)\r\n\tat com.fasterxml.jackson.databind.ObjectMapper.treeToValue(ObjectMapper.java:3279)\r\n\tat Test.main(Test.java:13)\r\n```\r\n\r\nNote that the issue does not manifest without `mapper.setPropertyNamingStrategy(PropertyNamingStrategies.UPPER_CAMEL_CASE);`\r\n","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/3275/reactions","total_count":9,"+1":8,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/3275/timeline","performed_via_github_app":null,"state_reason":"completed"}