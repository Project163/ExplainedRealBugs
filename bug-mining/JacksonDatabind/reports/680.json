{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/3906","repository_url":"https://api.github.com/repos/FasterXML/jackson-databind","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/3906/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/3906/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/3906/events","html_url":"https://github.com/FasterXML/jackson-databind/issues/3906","id":1692549806,"node_id":"I_kwDOAC5e2c5k4kKu","number":3906,"title":"Regression: 2.15.0 breaks deserialization for records when mapper.setVisibility(PropertyAccessor.ALL, Visibility.NONE);","user":{"login":"stolsvik","id":3123344,"node_id":"MDQ6VXNlcjMxMjMzNDQ=","avatar_url":"https://avatars.githubusercontent.com/u/3123344?v=4","gravatar_id":"","url":"https://api.github.com/users/stolsvik","html_url":"https://github.com/stolsvik","followers_url":"https://api.github.com/users/stolsvik/followers","following_url":"https://api.github.com/users/stolsvik/following{/other_user}","gists_url":"https://api.github.com/users/stolsvik/gists{/gist_id}","starred_url":"https://api.github.com/users/stolsvik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stolsvik/subscriptions","organizations_url":"https://api.github.com/users/stolsvik/orgs","repos_url":"https://api.github.com/users/stolsvik/repos","events_url":"https://api.github.com/users/stolsvik/events{/privacy}","received_events_url":"https://api.github.com/users/stolsvik/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":30,"created_at":"2023-05-02T14:36:23Z","updated_at":"2023-07-25T22:08:08Z","closed_at":"2023-07-25T21:34:30Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Describe the bug**\r\nThis code used to work with 2.14.2, but not with 2.15.0\r\n```java\r\nObjectMapper mapper = new ObjectMapper();\r\nmapper.setVisibility(PropertyAccessor.ALL, Visibility.NONE);\r\nRecordTest recordTest_deserialized = mapper.readValue(\"{}\", RecordTest.class);\r\n```\r\n\r\n**Version information**\r\n2.15.0\r\n\r\n**To Reproduce**\r\n```java\r\n/**\r\n * This works fine with Jackson 2.14.2, but not with 2.15.0.\r\n */\r\npublic class Jackson_2_15_0_Regression {\r\n\r\n    record RecordTest(String string, int integer) {\r\n    }\r\n\r\n    @Test\r\n    public void emptyJsonToRecord() throws JsonProcessingException {\r\n        ObjectMapper mapper = new ObjectMapper();\r\n\r\n        mapper.setVisibility(PropertyAccessor.ALL, Visibility.NONE);\r\n        // mapper.setVisibility(PropertyAccessor.FIELD, Visibility.ANY);\r\n\r\n        RecordTest recordTest_deserialized = mapper.readValue(\"{}\", RecordTest.class);\r\n\r\n\r\n        System.out.println(\"RecordTest deserialized: \" + recordTest_deserialized);\r\n        Assert.assertEquals(new RecordTest(null, 0), recordTest_deserialized);\r\n    }\r\n}\r\n```\r\nComment out the `mapper.setVisibility(PropertyAccessor.ALL, Visibility.NONE)` and it works.\r\n\r\nNote that the commented-out `mapper.setVisibility(PropertyAccessor.FIELD, Visibility.ANY)` is included in my actual code to get intended behaviour (i.e. only fields are serialized and deserialized, no methods involved), but this did not make any to or from for the problem.\r\n\r\nException is:\r\n```\r\ncom.fasterxml.jackson.databind.exc.InvalidDefinitionException: Cannot construct instance of `io.mats3.examples.jbang.Jackson_2_15_0_Regression$RecordTest` (no Creators, like default constructor, exist): cannot deserialize from Object value (no delegate- or property-based Creator)\r\n at [Source: (String)\"{}\"; line: 1, column: 2]\r\n\r\n\tat com.fasterxml.jackson.databind.exc.InvalidDefinitionException.from(InvalidDefinitionException.java:67)\r\n\tat com.fasterxml.jackson.databind.DeserializationContext.reportBadDefinition(DeserializationContext.java:1915)\r\n\tat com.fasterxml.jackson.databind.DatabindContext.reportBadDefinition(DatabindContext.java:414)\r\n\tat com.fasterxml.jackson.databind.DeserializationContext.handleMissingInstantiator(DeserializationContext.java:1360)\r\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializerBase.deserializeFromObjectUsingNonDefault(BeanDeserializerBase.java:1424)\r\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializer.deserializeFromObject(BeanDeserializer.java:352)\r\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializer.deserialize(BeanDeserializer.java:185)\r\n\tat com.fasterxml.jackson.databind.deser.DefaultDeserializationContext.readRootValue(DefaultDeserializationContext.java:323)\r\n\tat com.fasterxml.jackson.databind.ObjectMapper._readMapAndClose(ObjectMapper.java:4825)\r\n\tat com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:3772)\r\n\tat com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:3740)\r\n\tat io.mats3.examples.jbang.Jackson_2_15_0_Regression.emptyJsonToRecord(Jackson_2_15_0_Regression.java:25)\r\n```","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/3906/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/3906/timeline","performed_via_github_app":null,"state_reason":"completed"}