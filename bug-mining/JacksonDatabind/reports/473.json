{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2473","repository_url":"https://api.github.com/repos/FasterXML/jackson-databind","labels_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2473/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2473/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2473/events","html_url":"https://github.com/FasterXML/jackson-databind/issues/2473","id":497645402,"node_id":"MDU6SXNzdWU0OTc2NDU0MDI=","number":2473,"title":"Array index missing in path of `JsonMappingException` for `Collection<String>`, with custom deserializer","user":{"login":"joca-bt","id":1297942,"node_id":"MDQ6VXNlcjEyOTc5NDI=","avatar_url":"https://avatars.githubusercontent.com/u/1297942?v=4","gravatar_id":"","url":"https://api.github.com/users/joca-bt","html_url":"https://github.com/joca-bt","followers_url":"https://api.github.com/users/joca-bt/followers","following_url":"https://api.github.com/users/joca-bt/following{/other_user}","gists_url":"https://api.github.com/users/joca-bt/gists{/gist_id}","starred_url":"https://api.github.com/users/joca-bt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joca-bt/subscriptions","organizations_url":"https://api.github.com/users/joca-bt/orgs","repos_url":"https://api.github.com/users/joca-bt/repos","events_url":"https://api.github.com/users/joca-bt/events{/privacy}","received_events_url":"https://api.github.com/users/joca-bt/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-09-24T12:05:52Z","updated_at":"2019-09-30T02:39:31Z","closed_at":"2019-09-30T02:39:31Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"In some situations the [path](http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/JsonMappingException.html#getPath--) of a `JsonMappingException` doesn't contain the array index where the error occurred.\r\n\r\nIn the following example we have a custom string deserializer which is disabling the automatic casting from other types (https://github.com/FasterXML/jackson-databind/issues/796/).\r\n\r\n```\r\ntry {\r\n    mapper.readValue(\"{ \\\"array\\\": [ \\\"foo\\\", true ]}\", Foo.class);\r\n} catch (JsonMappingException exception) {\r\n    System.out.println(exception); // 1\r\n    for (var node : exception.getPath()) {\r\n        System.out.println(node); // 2\r\n        System.out.println(node.getFieldName()); // 3\r\n        System.out.println(node.getIndex()); // 4\r\n    }\r\n}\r\n\r\npublic class Foo {\r\n    public List<String> array;\r\n}\r\n\r\npublic class StringDeserializer extends JsonDeserializer<String> {\r\n    @Override\r\n    public String deserialize(JsonParser parser, DeserializationContext context) throws IOException {\r\n        if (parser.hasToken(JsonToken.VALUE_STRING)) {\r\n            return parser.getText();\r\n        } else {\r\n            throw context.wrongTokenException(parser, String.class, JsonToken.VALUE_STRING, \"\");\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n```\r\n1: com.fasterxml.jackson.databind.exc.MismatchedInputException: Unexpected token (VALUE_TRUE), expected VALUE_STRING:\r\n at [Source: (String)\"{ \"array\": [ \"foo\", true ]}\"; line: 1, column: 21] (through reference chain: Foo[\"array\"])\r\n2: Foo[\"array\"]\r\n3: array\r\n4: -1\r\n```\r\n\r\nIn this case, there's no information about the array index in which the error is originating, since the path only has 1 node (it should have two like below).\r\n\r\nIn other situations we do, for example:\r\n\r\n```\r\n\"{ \\\"array\\\": [ true, 1 ]}\"\r\n\r\npublic class Foo {\r\n    public List<Boolean> array;\r\n}\r\n```\r\n\r\n```\r\n1: com.fasterxml.jackson.databind.exc.MismatchedInputException: Cannot coerce Number (1) for type `java.lang.Boolean` (enable `MapperFeature.ALLOW_COERCION_OF_SCALARS` to allow)\r\n at [Source: (PushbackInputStream); line: 2, column: 27] (through reference chain: Foo[\"array\"]->java.util.ArrayList[1])\r\n2: Foo[\"array\"]\r\n3: array\r\n4: -1\r\n2: java.util.ArrayList[1]\r\n3: null\r\n4: 1\r\n```\r\n\r\nIs there something different when using custom deserializers?","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2473/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-databind/issues/2473/timeline","performed_via_github_app":null,"state_reason":"completed"}