<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:17:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-6670] ClassNotFound with Serde</title>
                <link>https://issues.apache.org/jira/browse/HIVE-6670</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;We are finding a ClassNotFound exception when we use CSVSerde(&lt;a href=&quot;https://github.com/ogrodnek/csv-serde&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ogrodnek/csv-serde&lt;/a&gt;) to create a table.&lt;br/&gt;
This is happening because MapredLocalTask does not pass the local added jars to ExecDriver when that is launched.&lt;br/&gt;
ExecDriver&apos;s classpath does not include the added jars. Therefore, when the plan is deserialized, it throws a ClassNotFoundException in the deserialization code, and results in a TableDesc object with a Null DeserializerClass.&lt;br/&gt;
This results in an NPE during Fetch.&lt;br/&gt;
Steps to reproduce:&lt;br/&gt;
wget &lt;a href=&quot;https://drone.io/github.com/ogrodnek/csv-serde/files/target/csv-serde-1.1.2-0.11.0-all.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://drone.io/github.com/ogrodnek/csv-serde/files/target/csv-serde-1.1.2-0.11.0-all.jar&lt;/a&gt; into somewhere local eg. /home/soam/HiveSerdeIssue/csv-serde-1.1.2-0.11.0-all.jar.&lt;br/&gt;
Place some sample SCV files in HDFS as follows:&lt;br/&gt;
hdfs dfs -mkdir /user/soam/HiveSerdeIssue/sampleCSV/&lt;br/&gt;
hdfs dfs -put /home/soam/sampleCSV.csv /user/soam/HiveSerdeIssue/sampleCSV/&lt;br/&gt;
hdfs dfs -mkdir /user/soam/HiveSerdeIssue/sampleJoinTarget/&lt;br/&gt;
hdfs dfs -put /home/soam/sampleJoinTarget.csv /user/soam/HiveSerdeIssue/sampleJoinTarget/&lt;br/&gt;
====&lt;br/&gt;
create the tables in hive:&lt;br/&gt;
ADD JAR /home/soam/HiveSerdeIssue/csv-serde-1.1.2-0.11.0-all.jar;&lt;br/&gt;
create external table sampleCSV (md5hash string, filepath string)&lt;br/&gt;
row format serde &apos;com.bizo.hive.serde.csv.CSVSerde&apos;&lt;br/&gt;
stored as textfile&lt;br/&gt;
location &apos;/user/soam/HiveSerdeIssue/sampleCSV/&apos;&lt;br/&gt;
;&lt;br/&gt;
create external table sampleJoinTarget (md5hash string, filepath string, datestamp string, nblines string, nberrors string)&lt;br/&gt;
ROW FORMAT DELIMITED &lt;br/&gt;
FIELDS TERMINATED BY &apos;,&apos; &lt;br/&gt;
LINES TERMINATED BY &apos;\n&apos;&lt;br/&gt;
STORED AS TEXTFILE&lt;br/&gt;
LOCATION &apos;/user/soam/HiveSerdeIssue/sampleJoinTarget/&apos;&lt;br/&gt;
;&lt;br/&gt;
===============&lt;br/&gt;
Now, try the following JOIN:&lt;br/&gt;
ADD JAR /home/soam/HiveSerdeIssue/csv-serde-1.1.2-0.11.0-all.jar;&lt;br/&gt;
SELECT &lt;br/&gt;
sampleCSV.md5hash, &lt;br/&gt;
sampleCSV.filepath &lt;br/&gt;
FROM sampleCSV&lt;br/&gt;
JOIN sampleJoinTarget&lt;br/&gt;
ON (sampleCSV.md5hash = sampleJoinTarget.md5hash) &lt;br/&gt;
;&lt;br/&gt;
&#8212;&lt;br/&gt;
This will fail with the error:&lt;br/&gt;
Execution log at: /tmp/soam/.log&lt;br/&gt;
java.lang.ClassNotFoundException: com/bizo/hive/serde/csv/CSVSerde&lt;br/&gt;
Continuing ...&lt;br/&gt;
2014-03-11 10:35:03 Starting to launch local task to process map join; maximum memory = 238551040&lt;br/&gt;
Execution failed with exit status: 2&lt;br/&gt;
Obtaining error information&lt;br/&gt;
Task failed!&lt;br/&gt;
Task ID:&lt;br/&gt;
Stage-4&lt;br/&gt;
Logs:&lt;br/&gt;
/var/log/hive/soam/hive.log&lt;br/&gt;
FAILED: Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.mr.MapredLocalTask&lt;br/&gt;
Try the following LEFT JOIN. This will work:&lt;br/&gt;
SELECT &lt;br/&gt;
sampleCSV.md5hash, &lt;br/&gt;
sampleCSV.filepath &lt;br/&gt;
FROM sampleCSV&lt;br/&gt;
LEFT JOIN sampleJoinTarget&lt;br/&gt;
ON (sampleCSV.md5hash = sampleJoinTarget.md5hash) &lt;br/&gt;
;&lt;br/&gt;
==&lt;/p&gt;</description>
                <environment></environment>
        <key id="12701530">HIVE-6670</key>
            <summary>ClassNotFound with Serde</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ashahab">Abin Shahab</assignee>
                                    <reporter username="ashahab">Abin Shahab</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Mar 2014 17:37:01 +0000</created>
                <updated>Thu, 27 Mar 2014 22:38:53 +0000</updated>
                            <resolved>Thu, 27 Mar 2014 22:38:53 +0000</resolved>
                                    <version>0.12.0</version>
                                    <fixVersion>0.13.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="13947021" author="ashahab" created="Tue, 25 Mar 2014 19:26:28 +0000"  >&lt;p&gt;Added patches for both trunk and branch.&lt;/p&gt;</comment>
                            <comment id="13947042" author="ashutoshc" created="Tue, 25 Mar 2014 19:39:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashahab&quot; class=&quot;user-hover&quot; rel=&quot;ashahab&quot;&gt;ashahab&lt;/a&gt; Can you add a testcase with your patch? You can use JsonSerDe (in hcatalog jar) to repro this issue in .q file&lt;br/&gt;
Also, if you can create ReviewBoard entry for this, that will be great.&lt;/p&gt;</comment>
                            <comment id="13947077" author="ashahab" created="Tue, 25 Mar 2014 20:03:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hashutosh&quot; class=&quot;user-hover&quot; rel=&quot;hashutosh&quot;&gt;hashutosh&lt;/a&gt; I can write a test case. Is there a similar testcase that I can look at?&lt;br/&gt;
I&apos;m not sure how to create a ReviewBoard entry. It&apos;d be great if you can do that once I upload the test.&lt;/p&gt;</comment>
                            <comment id="13947287" author="ashutoshc" created="Tue, 25 Mar 2014 22:37:55 +0000"  >&lt;p&gt;Query you posted in description is a good testcase. Just add it in as .q file in ql/src/test/queries/clientpositive/ where all other test queries are. More info at &lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/HiveDeveloperFAQ#HiveDeveloperFAQ&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;wiki site &lt;/a&gt; You can create review request on &lt;a href=&quot;https://reviews.apache.org/r/new/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;review board &lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="13947359" author="ashutoshc" created="Tue, 25 Mar 2014 23:58:59 +0000"  >&lt;p&gt;I tested manually and I am able to repro. Also, with patch it succeeds. Thats, good. &lt;br/&gt;
However, I think instead of passing on cmd line, better to pass it via Conf object using &lt;tt&gt;hive.added.jars.path&lt;/tt&gt; variable , the way its done in MapRedTask. That way its consistent across two types of task.&lt;/p&gt;</comment>
                            <comment id="13947420" author="ashahab" created="Wed, 26 Mar 2014 01:21:15 +0000"  >&lt;p&gt;But I don&apos;t want to overwrite existing added jars.&lt;/p&gt;
</comment>
                            <comment id="13947432" author="ashutoshc" created="Wed, 26 Mar 2014 01:27:28 +0000"  >&lt;p&gt;You need not to. You can append.&lt;/p&gt;</comment>
                            <comment id="13947964" author="hiveqa" created="Wed, 26 Mar 2014 14:47:14 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12636760/HIVE-6670.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12636760/HIVE-6670.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 5457 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/1964/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/1964/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/1964/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/1964/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12636760&lt;/p&gt;</comment>
                            <comment id="13948613" author="ashutoshc" created="Wed, 26 Mar 2014 23:05:41 +0000"  >&lt;p&gt;Patch with my suggested fix and test case.&lt;/p&gt;</comment>
                            <comment id="13948620" author="ashahab" created="Wed, 26 Mar 2014 23:09:14 +0000"  >&lt;p&gt;Thanks for rolling it forward!&lt;/p&gt;
</comment>
                            <comment id="13948621" author="ashutoshc" created="Wed, 26 Mar 2014 23:09:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/19705/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/19705/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13948677" author="jdere" created="Wed, 26 Mar 2014 23:53:24 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13949554" author="alangates" created="Thu, 27 Mar 2014 16:41:56 +0000"  >&lt;p&gt;Ran tests locally, all looks good.&lt;/p&gt;</comment>
                            <comment id="13949968" author="hiveqa" created="Thu, 27 Mar 2014 21:37:43 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12637036/HIVE-6670.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12637036/HIVE-6670.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 1 failed/errored test(s), 5492 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestNegativeMinimrCliDriver.testNegativeCliDriver_mapreduce_stack_trace_hadoop20
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/1987/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/1987/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/1987/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/1987/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12637036&lt;/p&gt;</comment>
                            <comment id="13950047" author="ashutoshc" created="Thu, 27 Mar 2014 22:38:53 +0000"  >&lt;p&gt;Committed to trunk &amp;amp; 0.13. Thanks, Abin!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12636759" name="HIVE-6670-branch-0.12.patch" size="2394" author="ashahab" created="Tue, 25 Mar 2014 19:25:57 +0000"/>
                            <attachment id="12637036" name="HIVE-6670.1.patch" size="4720" author="ashutoshc" created="Wed, 26 Mar 2014 23:05:41 +0000"/>
                            <attachment id="12636760" name="HIVE-6670.patch" size="2394" author="ashahab" created="Tue, 25 Mar 2014 19:25:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>379876</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 34 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1tgcf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>380161</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>