<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:12:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-5486] HiveServer2 should create base scratch directories at startup</title>
                <link>https://issues.apache.org/jira/browse/HIVE-5486</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;With impersonation enabled, the same base directory  is used by all sessions/queries. For a new deployment, this directory gets created on first invocation by the user running that session. This would cause directory permission conflict for other users.&lt;br/&gt;
HiveServer2 should create the base scratch dirs if it doesn&apos;t exist.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12672733">HIVE-5486</key>
            <summary>HiveServer2 should create base scratch directories at startup</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="prasadm">Prasad Suresh Mujumdar</assignee>
                                    <reporter username="prasadm">Prasad Suresh Mujumdar</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Oct 2013 01:27:13 +0000</created>
                <updated>Mon, 28 Oct 2013 23:17:32 +0000</updated>
                            <resolved>Mon, 28 Oct 2013 23:17:32 +0000</resolved>
                                    <version>0.11.0</version>
                    <version>0.12.0</version>
                                    <fixVersion>0.13.0</fixVersion>
                                    <component>HiveServer2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13788808" author="prasadm" created="Tue, 8 Oct 2013 01:30:23 +0000"  >&lt;p&gt;Review request on &lt;a href=&quot;https://reviews.apache.org/r/14523/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/14523/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13788810" author="prasadm" created="Tue, 8 Oct 2013 01:34:12 +0000"  >&lt;p&gt;Reformatted &lt;/p&gt;</comment>
                            <comment id="13789173" author="hiveqa" created="Tue, 8 Oct 2013 12:58:02 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12607288/HIVE-5486.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12607288/HIVE-5486.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 4062 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1072/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1072/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1072/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1072/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13790312" author="hiveqa" created="Wed, 9 Oct 2013 12:52:24 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12607521/HIVE-5486.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12607521/HIVE-5486.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 1 failed/errored test(s), 4391 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_script_broken_pipe1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1083/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1083/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1083/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1083/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests failed with: TestsFailedException: 1 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13790523" author="brocknoland" created="Wed, 9 Oct 2013 15:35:10 +0000"  >&lt;p&gt;New test passed:  &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1083/testReport/org.apache.hive.service.cli/TestScratchDir/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1083/testReport/org.apache.hive.service.cli/TestScratchDir/&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13794975" author="vgumashta" created="Tue, 15 Oct 2013 08:00:07 +0000"  >&lt;p&gt;+1 (non-binding)&lt;/p&gt;</comment>
                            <comment id="13796260" author="thiruvel" created="Wed, 16 Oct 2013 00:45:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasadm&quot; class=&quot;user-hover&quot; rel=&quot;prasadm&quot;&gt;prasadm&lt;/a&gt; Can we set the permission to 1777, with the sticky bit? What do you think?&lt;/p&gt;</comment>
                            <comment id="13796373" author="prasadm" created="Wed, 16 Oct 2013 03:35:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thiruvel&quot; class=&quot;user-hover&quot; rel=&quot;thiruvel&quot;&gt;thiruvel&lt;/a&gt; IMO The sticky bit is not necessary for the top level directory. Each session will create its own sub directory under it. The permissions of session specific directory is controlled by hive.scratch.dir.permission.&lt;/p&gt;</comment>
                            <comment id="13797534" author="thejas" created="Thu, 17 Oct 2013 02:04:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasadm&quot; class=&quot;user-hover&quot; rel=&quot;prasadm&quot;&gt;prasadm&lt;/a&gt; Is the problem happening in cases where the parent dir of these dirs does not already exist ? I assume the old code works in cases where the scratch dir is like &quot;/tmp/scratchdir&quot; (assuming &apos;/tmp/&apos; exists with permissions for all users).&lt;/p&gt;</comment>
                            <comment id="13797650" author="prasadm" created="Thu, 17 Oct 2013 06:16:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thejas&quot; class=&quot;user-hover&quot; rel=&quot;thejas&quot;&gt;thejas&lt;/a&gt; If /tmp/scratchdir exists with permissions for all users, the things work fine. &lt;br/&gt;
Otherwise the first session will create /tmp/scratchdir and its own sessions specific sub-directory under that. In this case the /tmp/scratchdir itself is owned by the first user and created with default permissions (typically 755). Then the subsequent sessions can&apos;t write to /tmp/scratchdir&lt;/p&gt;
</comment>
                            <comment id="13797655" author="thejas" created="Thu, 17 Oct 2013 06:28:03 +0000"  >&lt;p&gt;But this section in old code in HiveSessionImplwithUGI.java was changing the scratch dir from &quot;/tmp/scratchdir&quot; to &quot;/tmp/scratchdir-username&quot; . So the first user (say user1) should create dir &quot;/tmp/scratchdir-user1&quot; , and a different user2 should create &quot;/tmp/scratchdir-user2&quot; . Are you saying that logic wasn&apos;t working ?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;141	
  &lt;span class=&quot;code-comment&quot;&gt;// Append the user name to temp/scratch directory path &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; each impersonated user
&lt;/span&gt;142	
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void setUserPath(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; userName) {
143	
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (HiveConf.ConfVars &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;: HiveConf.userVars) {
144	
      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; userVar = getHiveConf().getVar(&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;);
145	
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (userVar != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
146	
        &lt;span class=&quot;code-comment&quot;&gt;// If there&apos;s a path separator at end then remove it
&lt;/span&gt;147	
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (userVar.endsWith(File.separator)) {
148	
          userVar = userVar.substring(0, userVar.length()-2);
149	
        }
150	
        getHiveConf().setVar(&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;, userVar + &lt;span class=&quot;code-quote&quot;&gt;&quot;-&quot;&lt;/span&gt; + userName);
151	
      }
152	
    }
153	
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13797662" author="prasadm" created="Thu, 17 Oct 2013 06:42:30 +0000"  >&lt;p&gt;right, that works for the kerberos impersonation, but not the non-kerberos case it uses the common scratch directory. I didn&apos;t mention that explicitly, my bad.&lt;/p&gt;
</comment>
                            <comment id="13797686" author="thejas" created="Thu, 17 Oct 2013 07:37:06 +0000"  >&lt;p&gt;Thanks for the clarification. I have some comments in the reviewboard link.&lt;/p&gt;</comment>
                            <comment id="13799976" author="prasadm" created="Sat, 19 Oct 2013 18:50:44 +0000"  >&lt;p&gt;Updated patch per review feedback&lt;/p&gt;</comment>
                            <comment id="13800061" author="hiveqa" created="Sun, 20 Oct 2013 01:56:15 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12609278/HIVE-5486.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12609278/HIVE-5486.4.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 4430 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1175/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1175/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1175/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1175/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13807459" author="thejas" created="Mon, 28 Oct 2013 23:17:32 +0000"  >&lt;p&gt;Patch committed to trunk.&lt;br/&gt;
Thanks for the contribution Prasad!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12607288" name="HIVE-5486.2.patch" size="6805" author="prasadm" created="Tue, 8 Oct 2013 01:34:12 +0000"/>
                            <attachment id="12607521" name="HIVE-5486.3.patch" size="7610" author="prasadm" created="Wed, 9 Oct 2013 06:34:53 +0000"/>
                            <attachment id="12609278" name="HIVE-5486.4.patch" size="8557" author="prasadm" created="Sat, 19 Oct 2013 18:50:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352356</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 4 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1or0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352644</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>