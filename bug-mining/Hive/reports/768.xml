<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:00:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-2504] Warehouse table subdirectories should inherit the group permissions of the warehouse parent directory</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2504</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;When the Hive Metastore creates a subdirectory in the Hive warehouse for&lt;br/&gt;
a new table it does so with the default HDFS permissions. Since the default&lt;br/&gt;
dfs.umask value is 022, this means that the new subdirectory will not inherit the&lt;br/&gt;
group write permissions of the hive warehouse directory.&lt;/p&gt;

&lt;p&gt;We should make the umask used by Warehouse.mkdirs() configurable, and set&lt;br/&gt;
it to use a default value of 002.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12527138">HIVE-2504</key>
            <summary>Warehouse table subdirectories should inherit the group permissions of the warehouse parent directory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chinnalalam">Chinna Rao Lalam</assignee>
                                    <reporter username="cwsteinbach">Carl Steinbach</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Oct 2011 01:58:13 +0000</created>
                <updated>Wed, 9 Jan 2013 10:24:18 +0000</updated>
                            <resolved>Mon, 9 Apr 2012 19:14:22 +0000</resolved>
                                                    <fixVersion>0.9.0</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="13127905" author="ashutoshc" created="Fri, 14 Oct 2011 22:01:05 +0000"  >&lt;p&gt;Can&apos;t you achieve this already by setting dfs.umask to 002 in hdfs-site.xml&lt;/p&gt;</comment>
                            <comment id="13127992" author="cwsteinbach" created="Fri, 14 Oct 2011 23:46:37 +0000"  >&lt;p&gt;@Ashutosh: Yes, but that then shifts the configuration burden to the administrator.&lt;br/&gt;
The point of this ticket is to reduce the configuration burden on admins/users by &lt;br/&gt;
providing a sensible set of default configuration parameters. I&apos;m also selfishly interested&lt;br/&gt;
in heading-off the inevitable stream of emails to hive-user from folks wondering&lt;br/&gt;
why Hive won&apos;t let them insert data into the table they just created.&lt;/p&gt;

&lt;p&gt;Do you disagree with this approach?&lt;/p&gt;</comment>
                            <comment id="13128019" author="ashutoshc" created="Sat, 15 Oct 2011 01:21:46 +0000"  >&lt;p&gt;No, I don&apos;t disagree with the approach. I was just interested to know whether its already possible to do so. &lt;/p&gt;</comment>
                            <comment id="13174833" author="chinnalalam" created="Thu, 22 Dec 2011 14:55:24 +0000"  >&lt;p&gt;for directory creation passed the umask value as 0002.&lt;/p&gt;</comment>
                            <comment id="13184550" author="namit" created="Wed, 11 Jan 2012 23:46:07 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13185220" author="namit" created="Thu, 12 Jan 2012 20:44:12 +0000"  >&lt;p&gt;Committed. Thanks Chinna Rao&lt;/p&gt;</comment>
                            <comment id="13185381" author="hudson" created="Fri, 13 Jan 2012 01:44:44 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #1198 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/1198/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/1198/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2504&quot; title=&quot;Warehouse table subdirectories should inherit the group permissions of the warehouse parent directory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2504&quot;&gt;&lt;del&gt;HIVE-2504&lt;/del&gt;&lt;/a&gt; Warehouse table subdirectories should inherit the group permissions of the warehouse&lt;br/&gt;
parent directory (Chinna Rao Lalam via namit)&lt;/p&gt;

&lt;p&gt;namit : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1230774&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1230774&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/conf/hive-default.xml.template&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/Warehouse.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13186776" author="hudson" created="Mon, 16 Jan 2012 08:45:56 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21-dbg #3 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21-dbg/3/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21-dbg/3/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2504&quot; title=&quot;Warehouse table subdirectories should inherit the group permissions of the warehouse parent directory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2504&quot;&gt;&lt;del&gt;HIVE-2504&lt;/del&gt;&lt;/a&gt; Warehouse table subdirectories should inherit the group permissions of the warehouse&lt;br/&gt;
parent directory (Chinna Rao Lalam via namit)&lt;/p&gt;

&lt;p&gt;namit : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1230774&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1230774&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/conf/hive-default.xml.template&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/Warehouse.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13214331" author="sho.shimauchi" created="Thu, 23 Feb 2012 05:39:00 +0000"  >&lt;p&gt;I found a typo.&lt;/p&gt;

&lt;p&gt;hive.files.umask.vlaue&lt;/p&gt;

&lt;p&gt;should be:&lt;/p&gt;

&lt;p&gt;hive.files.umask.value&lt;/p&gt;</comment>
                            <comment id="13214376" author="cwsteinbach" created="Thu, 23 Feb 2012 06:35:31 +0000"  >&lt;p&gt;@Sho: Can you please file a JIRA for this? Thanks!&lt;/p&gt;</comment>
                            <comment id="13214629" author="sho.shimauchi" created="Thu, 23 Feb 2012 13:25:36 +0000"  >&lt;p&gt;sure, I&apos;ll file a JIRA and submit a patch.&lt;/p&gt;</comment>
                            <comment id="13237414" author="rohini" created="Sat, 24 Mar 2012 02:45:28 +0000"  >&lt;p&gt;     This fix makes the table directory always have permission of 775 and does not actually inherit the group permissions of the parent directory. In most of our cases, the owner produces the data while the group permissions are meant for users reading the data. Now hive.files.umask.value always need to be set to ensure the users belonging to the group cannot write or modify the table. Can&apos;t we change the fix to set the same permissions as the parent directory and get rid of this configuration? &lt;br/&gt;
       Also it is always prudent to do fs.mkdirs() and then fs.setPermission() as setting the umask in configuration is not guaranteed to work. The DistributedFileSystem is cached and it refers to the Configuration that it was first initialized with. &lt;/p&gt;</comment>
                            <comment id="13242783" author="thw" created="Fri, 30 Mar 2012 21:40:31 +0000"  >&lt;p&gt;Reopening per Rohini&apos;s request.&lt;/p&gt;</comment>
                            <comment id="13242787" author="rohini" created="Fri, 30 Mar 2012 21:45:39 +0000"  >&lt;p&gt;Had Thomas reopen the issue as I could not. &lt;/p&gt;

&lt;p&gt;Couple of issues with the fix:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The config that is actually being looked for is HIVE_FILES_UMASK_VALUE instead of hive.files.umask.value as the Enum name() function is used and not varname.&lt;br/&gt;
short umaskVal = (short) conf.getInt(HiveConf.ConfVars.HIVE_FILES_UMASK_VALUE.name(), 0002);&lt;/li&gt;
	&lt;li&gt;Because of the new FsPermission(short mode) the value for the configuration has to be specified in decimal instead of a octal umask.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  Would be more happy if the fix did not resort to using this setting at all and instead applied the permissions of the parent directory.&lt;/p&gt;</comment>
                            <comment id="13244756" author="rohini" created="Mon, 2 Apr 2012 22:25:28 +0000"  >&lt;p&gt;Haven&apos;t gotten any response on this for more than a week. So I am assuming no one is looking at it.&lt;/p&gt;

&lt;p&gt;Chinna,&lt;br/&gt;
   If you are not working on this, I can pick this one up. &lt;/p&gt;</comment>
                            <comment id="13247332" author="rohini" created="Thu, 5 Apr 2012 16:20:04 +0000"  >&lt;p&gt;Made the newly created subdirectories get the same permissions as the parent by setting it explicitly on them. The table directories will get the permissions of the database directory and the partition directories will get the permissions of the table directory.&lt;/p&gt;

&lt;p&gt;Removed the hive.files.umask.value configuration parameter. &lt;/p&gt;</comment>
                            <comment id="13247335" author="rohini" created="Thu, 5 Apr 2012 16:24:10 +0000"  >&lt;p&gt;Unit tests pass with ant clean package test&lt;/p&gt;</comment>
                            <comment id="13249581" author="ashutoshc" created="Sun, 8 Apr 2012 17:25:35 +0000"  >&lt;p&gt;I agree that fiddling with umask is not the cleanest approach here. But, I am not sure about &lt;b&gt;always&lt;/b&gt; inheriting permissions either, since this effectively implies the whole sub-tree of warehouse dir will have same permissions as warehouse dir itself. Concretely, lets consider following example. Lets say, wh dir has 700 perms. Then, if I create table (which only owner of wh can do) I will end up with either 775 or 755 (depending on whether it was before or after the earlier patch of jira). However, with your patch, table dir will end up with 700. In the earlier case, anyone could have read the tables, but now with your approach only owner can read. Now, which of this is correct behavior is open for debate and depends on which security model you have as your premise. Additionally, this will be change of behavior then the current behavior. So, I suggest you define a new config variable like &lt;tt&gt;hive.warehouse.inherit.perms&lt;/tt&gt; or something similar and set it to false by default. And then take your code path of inheriting parent perms in case it is set to true. Thoughts? &lt;/p&gt;</comment>
                            <comment id="13249690" author="rohini" created="Mon, 9 Apr 2012 05:54:10 +0000"  >&lt;p&gt;Agree with you on not breaking backward compatibility. Will post a new patch with the config.&lt;/p&gt;</comment>
                            <comment id="13250047" author="rohini" created="Mon, 9 Apr 2012 18:40:42 +0000"  >&lt;p&gt;Added hive.warehouse.subdir.inherit.perms which is false by default. The default behaviour of hive-0.8 stays. i.e directories will be created with the permissions of dfs.umask or dfs.umaskmode. If hive.warehouse.subdir.inherit.perms is set to true, then table directories will inherit the permission of the default warehouse or the custom database location. This comes in handy when you have databases created with different permissions or if the warehouse directory has permissions like 775. &lt;/p&gt;

&lt;p&gt;Ashutosh,&lt;br/&gt;
   Your argument of warehouse having 700 permissions will not hold. If warehouse has 700 and even if the table directories have 755 or 775 they will not be accessible by any one other than the owner because if you don&apos;t have access to the parent directory you cannot access sub-directories in dfs (Same as Linux). So the warehouse has to be at least 755 or 750 to start with. So with the initial patch, the sub-directories would have been created with 775. But with my patch, they would have been created the same as warehouse directory(755 or 750) which would still allow read access to group. But anyways to avoid any confusion and provide backward compatibility added the new config.&lt;/p&gt;</comment>
                            <comment id="13250080" author="cwsteinbach" created="Mon, 9 Apr 2012 19:14:22 +0000"  >&lt;p&gt;Closing this ticket again since Chinna&apos;s patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2504&quot; title=&quot;Warehouse table subdirectories should inherit the group permissions of the warehouse parent directory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2504&quot;&gt;&lt;del&gt;HIVE-2504&lt;/del&gt;&lt;/a&gt; was committed back in January.&lt;/p&gt;

&lt;p&gt;Please do not reopen tickets that have been marked fixed/resolved (i.e. tickets for which a patch has already been committed). Open a new ticket if you think there&apos;s a problem with the original patch. Thanks.&lt;/p&gt;</comment>
                            <comment id="13250116" author="rohini" created="Mon, 9 Apr 2012 20:01:37 +0000"  >&lt;p&gt;Sorry. I am new to the hive community and was not aware of the process and did not see it in HowToContribute page also. Went with the general practice of reopening bugs if there was an issue. Also this patch was still in trunk and not part of any release. Thanks for pointing out the process. Have created &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2936&quot; title=&quot;Warehouse table subdirectories should inherit the group permissions of the warehouse parent directory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2936&quot;&gt;&lt;del&gt;HIVE-2936&lt;/del&gt;&lt;/a&gt; to track the new patch.&lt;/p&gt;</comment>
                            <comment id="13265272" author="ashutoshc" created="Mon, 30 Apr 2012 21:11:25 +0000"  >&lt;p&gt;This issue is closed now. It was released with the fix in 0.9.0. If there is a problem, please open a new jira and link this one with that.&lt;/p&gt;</comment>
                            <comment id="13397153" author="haathi" created="Tue, 19 Jun 2012 23:22:13 +0000"  >&lt;p&gt;Hi,I am new to Hadoop, Hive, and Linux. and i need some help. I am recieving an error in Hive which I think is permission related and I think this patch may help. But I dont know how to install this patch. Can someone help me with step by step directions on how to install this patch? The error message I get when I run the Hive test is:&lt;br/&gt;
CREATE TABLE invites (foo INT, bar STRING) PARTITIONED BY (ds STRING);&lt;br/&gt;
FAILED: Error in metadata: MetaException(message:Got exception: org.apache.hadoop.security.AccessControlException org.apache.hadoop.security.AccessControlException: Permission denied: user=myID, access=WRITE, inode=&quot;/user/hive/warehouse&quot;:hdfs:hadoop:drwxr-xr-x)&lt;br/&gt;
Reading up on this patch seems like this may be the fix. If not then any assistance will be greatly appreciated.&lt;/p&gt;</comment>
                            <comment id="13397658" author="rohini" created="Wed, 20 Jun 2012 17:31:32 +0000"  >&lt;p&gt;Please send questions to the user mailing list. You cannot create the table because your warehouse directory is writable only by hdfs user. You can use LOCATION clause in create table statement and create the table in a directory where you have access. &lt;/p&gt;</comment>
                            <comment id="13548078" author="hudson" created="Wed, 9 Jan 2013 10:24:18 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #54 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2504&quot; title=&quot;Warehouse table subdirectories should inherit the group permissions of the warehouse parent directory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2504&quot;&gt;&lt;del&gt;HIVE-2504&lt;/del&gt;&lt;/a&gt; Warehouse table subdirectories should inherit the group permissions of the warehouse&lt;br/&gt;
parent directory (Chinna Rao Lalam via namit) (Revision 1230774)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
namit : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1230774&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1230774&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/conf/hive-default.xml.template&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/Warehouse.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                                                <inwardlinks description="is cloned by">
                                        <issuelink>
            <issuekey id="12550263">HIVE-2936</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12544093">HIVE-2824</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12521986" name="HIVE-2504-1.patch" size="8434" author="rohini" created="Mon, 9 Apr 2012 18:40:42 +0000"/>
                            <attachment id="12521527" name="HIVE-2504.patch" size="6672" author="rohini" created="Thu, 5 Apr 2012 16:20:04 +0000"/>
                            <attachment id="12508391" name="HIVE-2504.patch" size="2252" author="chinnalalam" created="Thu, 22 Dec 2011 14:14:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>85512</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 46 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lkan:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123938</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>