<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:49:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-15331] Decimal multiplication with high precision/scale often returns NULL</title>
                <link>https://issues.apache.org/jira/browse/HIVE-15331</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;create temporary table dec (a decimal(38,18));
insert into dec values(100.0);

hive&amp;gt; select a*a from dec;
OK
NULL
Time taken: 0.165 seconds, Fetched: 1 row(s)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Looks like the reason is because the result of decimal(38,18) * decimal(38,18) only has 2 digits of precision for integers:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hive&amp;gt; set hive.explain.user=false;
hive&amp;gt; explain select a*a from dec;
OK
STAGE DEPENDENCIES:
  Stage-0 is a root stage

STAGE PLANS:
  Stage: Stage-0
    Fetch Operator
      limit: -1
      Processor Tree:
        TableScan
          alias: dec
          Select Operator
            expressions: (a * a) (type: decimal(38,36))
            outputColumnNames: _col0
            ListSink

Time taken: 0.039 seconds, Fetched: 15 row(s)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13024866">HIVE-15331</key>
            <summary>Decimal multiplication with high precision/scale often returns NULL</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdere">Jason Dere</assignee>
                                    <reporter username="jdere">Jason Dere</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Dec 2016 19:08:59 +0000</created>
                <updated>Tue, 1 Aug 2023 09:51:52 +0000</updated>
                            <resolved>Wed, 21 Dec 2016 18:07:48 +0000</resolved>
                                                    <fixVersion>2.2.0</fixVersion>
                                    <component>Types</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15712840" author="jdere" created="Thu, 1 Dec 2016 19:26:21 +0000"  >&lt;p&gt;While Hive is using similar precision/scale rules as SQL Server for arithmetic operations (&lt;a href=&quot;https://msdn.microsoft.com/en-us/library/ms190476.aspx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://msdn.microsoft.com/en-us/library/ms190476.aspx&lt;/a&gt;), things seem to be breaking down once we hit the max precision of 38. Looks like this sheds a bit of light on how SQL Server handles things in that case: &lt;a href=&quot;https://blogs.msdn.microsoft.com/sqlprogrammability/2006/03/29/multiplication-and-division-with-numerics&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://blogs.msdn.microsoft.com/sqlprogrammability/2006/03/29/multiplication-and-division-with-numerics&lt;/a&gt; - basically it gives preference to the integer portion rather than the scale (Hive does the opposite), and setting a minimum scale of 6.&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15712964" author="xuefuz" created="Thu, 1 Dec 2016 20:16:45 +0000"  >&lt;p&gt;There are more than a couple of JIRAs on this topic. I think it can be argued both ways regarding which (int part vs dec part) to favor. As pointed by the blog post, user needs to quality the type matching the actually data. When not possible, use double/float instead.&lt;/p&gt;

&lt;p&gt;What is missing in Hive is a mode in which error is thrown instead of null, but that&apos;s not decimal type specific.&lt;/p&gt;</comment>
                            <comment id="15713011" author="jdere" created="Thu, 1 Dec 2016 20:37:33 +0000"  >&lt;p&gt;Yes the user ideally should qualify the type, but they often don&apos;t. And with the way this works now decimal multiplication is pretty much unusable without casts.&lt;br/&gt;
The precision/scale rules for division look like they have been changed because of similar issues (/&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5866&quot; title=&quot;Hive divide operator generates wrong results in certain cases&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5866&quot;&gt;&lt;del&gt;HIVE-5866&lt;/del&gt;&lt;/a&gt;). We could try to match what was done there in multiplication, but I think it would be better to try to emulate the SQL Server behavior given that we were using their precision/scale rules&lt;/p&gt;</comment>
                            <comment id="15713110" author="xuefuz" created="Thu, 1 Dec 2016 21:18:35 +0000"  >&lt;p&gt;I dont&apos; think this can be made bullet proof. I can always construct an example that shows a rule that fails to accommodate.&lt;/p&gt;</comment>
                            <comment id="15713158" author="jdere" created="Thu, 1 Dec 2016 21:41:23 +0000"  >&lt;p&gt;It cannot be bullet proof - even the Msft blogpost admits this. However I do think that we can do a little better here than the existing behavior, which punts multiplication of any value over 100.&lt;/p&gt;</comment>
                            <comment id="15723104" author="jdere" created="Mon, 5 Dec 2016 19:26:08 +0000"  >&lt;p&gt;Initial patch. Let&apos;s see what changes in the golden files.&lt;/p&gt;</comment>
                            <comment id="15726571" author="jdere" created="Tue, 6 Dec 2016 20:10:59 +0000"  >&lt;p&gt;Looks like precommit tests never ran - re-uploading patch.&lt;/p&gt;</comment>
                            <comment id="15726941" author="hiveqa" created="Tue, 6 Dec 2016 22:35:45 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12842017/HIVE-15331.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12842017/HIVE-15331.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 2 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 16 failed/errored test(s), 10775 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[auto_sortmerge_join_2] (batchId=44)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[decimal_precision] (batchId=47)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[decimal_udf] (batchId=8)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample2] (batchId=5)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample4] (batchId=15)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample6] (batchId=61)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample7] (batchId=60)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample9] (batchId=38)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vector_decimal_expressions] (batchId=48)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vector_decimal_precision] (batchId=45)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[transform_ppr2] (batchId=134)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[stats_based_fetch_decision] (batchId=150)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_decimal_expressions] (batchId=146)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_decimal_precision] (batchId=146)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_decimal_udf] (batchId=152)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_2] (batchId=92)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/2450/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/2450/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/2450/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/2450/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-2450/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-2450/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 16 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12842017 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15730273" author="jdere" created="Wed, 7 Dec 2016 23:24:48 +0000"  >&lt;p&gt;Updating golden files.&lt;/p&gt;</comment>
                            <comment id="15730283" author="jdere" created="Wed, 7 Dec 2016 23:28:43 +0000"  >&lt;p&gt;RB at &lt;a href=&quot;https://reviews.apache.org/r/54505/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/54505/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15731436" author="hiveqa" created="Thu, 8 Dec 2016 07:35:06 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12842239/HIVE-15331.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12842239/HIVE-15331.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 2 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 9 failed/errored test(s), 10782 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample2] (batchId=5)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample4] (batchId=15)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample6] (batchId=61)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample7] (batchId=60)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample9] (batchId=38)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[orc_ppd_schema_evol_3a] (batchId=134)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[transform_ppr2] (batchId=134)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[stats_based_fetch_decision] (batchId=150)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_2] (batchId=92)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/2481/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/2481/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/2481/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/2481/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-2481/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-2481/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 9 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12842239 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15732920" author="jdere" created="Thu, 8 Dec 2016 18:04:30 +0000"  >&lt;p&gt;I think this is ready for review now.&lt;/p&gt;</comment>
                            <comment id="15752568" author="jdere" created="Thu, 15 Dec 2016 21:31:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt; can you review?&lt;/p&gt;</comment>
                            <comment id="15752628" author="sershe" created="Thu, 15 Dec 2016 21:57:03 +0000"  >&lt;p&gt;Looks good; it seems like it reduces precision even in cases where it&apos;s not needed though... is that intended? See out file changes, where last few (non-zero) digits of the result are rounded away&lt;/p&gt;</comment>
                            <comment id="15752726" author="jdere" created="Thu, 15 Dec 2016 22:44:19 +0000"  >&lt;p&gt;Which file in particular? These are all cases where the resulting precision/scale exceeds 38 - for example decimal_precision.q.out, the operation is decimal(20,10) * decimal(20,10), the precision/scale (assuming unlimited precision/scale) would be decimal(41,20), however we&apos;re already at the Hive limit of 38.&lt;br/&gt;
So this is where the updated logic would kick in terms of making the precision/scale fit within 38 digits.&lt;/p&gt;</comment>
                            <comment id="15752735" author="sershe" created="Thu, 15 Dec 2016 22:48:23 +0000"  >&lt;p&gt;Decimal_precision:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-1234.5678901235	1524157.87532399036884525225
+1234.5678901235	1524157.87532399036884525
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15752968" author="sershe" created="Fri, 16 Dec 2016 00:31:01 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15767705" author="jdere" created="Wed, 21 Dec 2016 18:07:49 +0000"  >&lt;p&gt;Committed to master&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="13024906">HIVE-15334</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13545541">HIVE-27553</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13102759">SPARK-22036</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12841791" name="HIVE-15331.1.patch" size="10637" author="jdere" created="Mon, 5 Dec 2016 19:26:08 +0000"/>
                            <attachment id="12842017" name="HIVE-15331.2.patch" size="10637" author="jdere" created="Tue, 6 Dec 2016 20:10:59 +0000"/>
                            <attachment id="12842239" name="HIVE-15331.3.patch" size="58081" author="jdere" created="Wed, 7 Dec 2016 23:24:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 48 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i371e7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>The resulting precision/scale of decimal arithmetic has been changed in the case where the precision/scale exceeds the maximum precision of 38.&lt;br/&gt;
&lt;br/&gt;
When reducing the precision/scale down to the Hive limit of 38, the new behavior is to reduce the scale to preserve the integer portion of the precision, while leaving a minimum of 6 digits for the scale.&lt;br/&gt;
&lt;br/&gt;
The previous behavior was to always shrink the integer portion of the precision first before the scale.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>