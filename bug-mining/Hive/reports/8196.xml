<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:21:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-25912] Drop external table at root of s3 bucket throws NPE</title>
                <link>https://issues.apache.org/jira/browse/HIVE-25912</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;&lt;b&gt;new update:&lt;/b&gt;&#160;&lt;/p&gt;

&lt;p&gt;I test the master branch, have the same problem.&lt;/p&gt;

&lt;p&gt;----------&lt;/p&gt;

&lt;p&gt;ENV:&lt;/p&gt;

&lt;p&gt;Hive 3.1.2&lt;/p&gt;

&lt;p&gt;HDFS:3.3.1&lt;/p&gt;

&lt;p&gt;enable OpenLDAP and Ranger .&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I create the external hive table using this command:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CREATE EXTERNAL TABLE `fcbai`(
`inv_item_sk` &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
`inv_warehouse_sk` &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
`inv_quantity_on_hand` &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
PARTITIONED BY (
`inv_date_sk` &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) STORED AS ORC
LOCATION
&lt;span class=&quot;code-quote&quot;&gt;&apos;hdfs:&lt;span class=&quot;code-comment&quot;&gt;//emr-master-1:8020/&apos;&lt;/span&gt;;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The table was created successfully, but&#160; when I drop the table throw the NPE:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Error: Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; processing statement: FAILED: Execution Error, &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; code 1 from org.apache.hadoop.hive.ql.exec.DDLTask. MetaException(message:java.lang.NullPointerException) (state=08S01,code=1)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The same bug can reproduction on the other object storage file system, such as S3 or TOS:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CREATE EXTERNAL TABLE `fcbai`(
`inv_item_sk` &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
`inv_warehouse_sk` &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
`inv_quantity_on_hand` &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
PARTITIONED BY (
`inv_date_sk` &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) STORED AS ORC
LOCATION
&lt;span class=&quot;code-quote&quot;&gt;&apos;s3a:&lt;span class=&quot;code-comment&quot;&gt;//bucketname/&apos;&lt;/span&gt;; // &lt;span class=&quot;code-quote&quot;&gt;&apos;tos://bucketname/&apos;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I see the source code found:&lt;/p&gt;

&lt;p&gt;&#160;common/src/java/org/apache/hadoop/hive/common/FileUtils.java&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; sticky bit is set on the parent dir
&lt;/span&gt;FileStatus parStatus = fs.getFileStatus(path.getParent());
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!shims.hasStickyBit(parStatus.getPermission())) {
  &lt;span class=&quot;code-comment&quot;&gt;// no sticky bit, so write permission on parent dir is sufficient
&lt;/span&gt;  &lt;span class=&quot;code-comment&quot;&gt;// no further checks needed
&lt;/span&gt;  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;because I set the table location to HDFS root path (hdfs://emr-master-1:8020/), so the &#160;path.getParent() function will be return null cause the NPE.&lt;/p&gt;

&lt;p&gt;I think have four solutions to fix the bug:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;modify the create table function, if the location is root dir return create table fail.&lt;/li&gt;
	&lt;li&gt;modify the &#160;FileUtils.checkDeletePermission function, check the path.getParent(), if it is null, the function return, drop successfully.&lt;/li&gt;
	&lt;li&gt;modify the RangerHiveAuthorizer.checkPrivileges function of the hive ranger plugin(in ranger rep), if the location is root dir return create table fail.&lt;/li&gt;
	&lt;li&gt;modify the HDFS Path object, if the URI is root dir, path.getParent() return not null.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I recommend the first or second method, any suggestion for me? thx.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Hive version: 3.1.2&lt;/p&gt;</environment>
        <key id="13425620">HIVE-25912</key>
            <summary>Drop external table at root of s3 bucket throws NPE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fcbai">Fachuan Bai</assignee>
                                    <reporter username="fcbai">Fachuan Bai</reporter>
                        <labels>
                            <label>metastore</label>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sun, 30 Jan 2022 07:37:27 +0000</created>
                <updated>Thu, 17 Nov 2022 08:48:21 +0000</updated>
                            <resolved>Mon, 14 Feb 2022 06:49:41 +0000</resolved>
                                    <version>3.1.2</version>
                    <version>4.0.0</version>
                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                                    <component>Metastore</component>
                        <due>Mon, 14 Feb 2022 00:00:00 +0000</due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <workratio workratioPercent="18"/>
                                    <progress percentage="18">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="18" backgroundColor="#51a825"/>
                                                    <row percentage="82" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="18">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="18" backgroundColor="#51a825"/>
                                                    <row percentage="82" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="345600">96h</timeoriginalestimate>
                            <timeestimate seconds="283200">78h 40m</timeestimate>
                            <timespent seconds="62400">17h 20m</timespent>
                                <comments>
                            <comment id="17491817" author="pvary" created="Mon, 14 Feb 2022 06:49:41 +0000"  >&lt;p&gt;Pushed to master.&lt;br/&gt;
Thanks for the patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fcbai&quot; class=&quot;user-hover&quot; rel=&quot;fcbai&quot;&gt;fcbai&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13039516" name="hive bugs.png" size="443607" author="fcbai" created="Sun, 30 Jan 2022 07:33:10 +0000"/>
                            <attachment id="13039769" name="hive-bug-01.png" size="121094" author="fcbai" created="Tue, 8 Feb 2022 12:17:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>English</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 39 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0z3a0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12344397">3.1.2</customfieldvalue>
    <customfieldvalue id="12343343">4.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>