<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:22:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-25994] Analyze table runs into ClassNotFoundException-s</title>
                <link>https://issues.apache.org/jira/browse/HIVE-25994</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;any nightly release can be used to reproduce this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
create table t (a integer); insert into t values (1) ; analyze table t compute statistics &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; columns;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;results in&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
DAG did not succeed due to VERTEX_FAILURE. failedVertices:1 killedVertices:0
FAILED: Execution Error, &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; code 2 from org.apache.hadoop.hive.ql.exec.tez.TezTask. Vertex failed, vertexName=Map 1, vertexId=vertex_164683
1571866_0006_2_00, diagnostics=[Vertex vertex_1646831571866_0006_2_00 [Map 1] killed/failed due to:ROOT_INPUT_INIT_FAILURE, Vertex Input: test
initializer failed, vertex=vertex_1646831571866_0006_2_00 [Map 1], java.lang.RuntimeException: Failed to load plan: file:/tmp/dev/eebb53b4-db79
-48b9-b78e-cd71fbe1b9d3/hive_2022-03-09_19-00-08_579_8816359375110151189-14/dev/_tez_scratch_dir/55415d69-07cf-45c3-8c57-fa607633a580/map.xml
        at org.apache.hadoop.hive.ql.exec.Utilities.getBaseWork(Utilities.java:535)
        at org.apache.hadoop.hive.ql.exec.Utilities.getMapWork(Utilities.java:366)
        at org.apache.hadoop.hive.ql.exec.tez.HiveSplitGenerator.prepare(HiveSplitGenerator.java:152)
        at org.apache.hadoop.hive.ql.exec.tez.HiveSplitGenerator.initialize(HiveSplitGenerator.java:164)
        at org.apache.tez.dag.app.dag.RootInputInitializerManager.lambda$runInitializer$3(RootInputInitializerManager.java:200)
        at java.security.AccessController.doPrivileged(Native Method)
        at javax.security.auth.Subject.doAs(Subject.java:422)
        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1729)
        at org.apache.tez.dag.app.dag.RootInputInitializerManager.runInitializer(RootInputInitializerManager.java:193)
        at org.apache.tez.dag.app.dag.RootInputInitializerManager.runInitializerAndProcessResult(RootInputInitializerManager.java:174)
        at org.apache.tez.dag.app.dag.RootInputInitializerManager.lambda$createAndStartInitializing$2(RootInputInitializerManager.java:168)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
        at com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:125)
        at com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:57)
        at com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:78)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
Caused by: org.apache.hive.com.esotericsoftware.kryo.KryoException: java.lang.NoClassDefFoundError: org/antlr/runtime/tree/CommonTree
Serialization trace:
tableSpec (org.apache.hadoop.hive.ql.metadata.Table)
tableMetadata (org.apache.hadoop.hive.ql.plan.TableScanDesc)
conf (org.apache.hadoop.hive.ql.exec.TableScanOperator)
aliasToWork (org.apache.hadoop.hive.ql.plan.MapWork)
        at org.apache.hive.com.esotericsoftware.kryo.serializers.ReflectField.read(ReflectField.java:147)
        at org.apache.hive.com.esotericsoftware.kryo.serializers.FieldSerializer.read(FieldSerializer.java:124)
        at org.apache.hive.com.esotericsoftware.kryo.Kryo.readObject(Kryo.java:729)
        at org.apache.hadoop.hive.ql.exec.SerializationUtilities$KryoWithHooks.readObject(SerializationUtilities.java:216)
        at org.apache.hive.com.esotericsoftware.kryo.serializers.ReflectField.read(ReflectField.java:125)
        at org.apache.hive.com.esotericsoftware.kryo.serializers.FieldSerializer.read(FieldSerializer.java:124)
        at org.apache.hive.com.esotericsoftware.kryo.Kryo.readObject(Kryo.java:729)
        at org.apache.hadoop.hive.ql.exec.SerializationUtilities$KryoWithHooks.readObject(SerializationUtilities.java:216)
        at org.apache.hive.com.esotericsoftware.kryo.serializers.ReflectField.read(ReflectField.java:125)
        at org.apache.hive.com.esotericsoftware.kryo.serializers.FieldSerializer.read(FieldSerializer.java:124)
        at org.apache.hive.com.esotericsoftware.kryo.Kryo.readClassAndObject(Kryo.java:810)
        at org.apache.hadoop.hive.ql.exec.SerializationUtilities$KryoWithHooks.readClassAndObject(SerializationUtilities.java:178)
        at org.apache.hive.com.esotericsoftware.kryo.serializers.MapSerializer.read(MapSerializer.java:237)
        at org.apache.hive.com.esotericsoftware.kryo.serializers.MapSerializer.read(MapSerializer.java:42)
        at org.apache.hive.com.esotericsoftware.kryo.Kryo.readObject(Kryo.java:729)
        at org.apache.hadoop.hive.ql.exec.SerializationUtilities$KryoWithHooks.readObject(SerializationUtilities.java:216)
        at org.apache.hive.com.esotericsoftware.kryo.serializers.ReflectField.read(ReflectField.java:125)
        at org.apache.hive.com.esotericsoftware.kryo.serializers.FieldSerializer.read(FieldSerializer.java:124)
        at org.apache.hive.com.esotericsoftware.kryo.Kryo.readObject(Kryo.java:707)
        at org.apache.hadoop.hive.ql.exec.SerializationUtilities$KryoWithHooks.readObject(SerializationUtilities.java:208)
        at org.apache.hadoop.hive.ql.exec.SerializationUtilities.deserializeObjectByKryo(SerializationUtilities.java:807)
        at org.apache.hadoop.hive.ql.exec.SerializationUtilities.deserializePlan(SerializationUtilities.java:714)
        at org.apache.hadoop.hive.ql.exec.Utilities.getBaseWork(Utilities.java:499)
        ... 17 more
Caused by: java.lang.NoClassDefFoundError: org/antlr/runtime/tree/CommonTree
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.defineClass1(Native Method)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.defineClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:757)
        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)
        at java.net.URLClassLoader.defineClass(URLClassLoader.java:468)
        at java.net.URLClassLoader.access$100(URLClassLoader.java:74)
        at java.net.URLClassLoader$1.run(URLClassLoader.java:369)
        at java.net.URLClassLoader$1.run(URLClassLoader.java:363)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.net.URLClassLoader.findClass(URLClassLoader.java:362)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:419)
        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:352)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:352)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.getDeclaredConstructors0(Native Method)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.privateGetDeclaredConstructors(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:2671)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.getConstructor0(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:3075)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.getDeclaredConstructor(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:2178)
        at org.apache.hive.com.esotericsoftware.reflectasm.ConstructorAccess.get(ConstructorAccess.java:65)
        at org.apache.hive.com.esotericsoftware.kryo.util.DefaultInstantiatorStrategy.newInstantiatorOf(DefaultInstantiatorStrategy.java:60)
        at org.apache.hive.com.esotericsoftware.kryo.Kryo.newInstantiator(Kryo.java:1119)
        at org.apache.hive.com.esotericsoftware.kryo.Kryo.newInstance(Kryo.java:1128)
        at org.apache.hive.com.esotericsoftware.kryo.serializers.FieldSerializer.create(FieldSerializer.java:153)
        at org.apache.hive.com.esotericsoftware.kryo.serializers.FieldSerializer.read(FieldSerializer.java:118)
        at org.apache.hive.com.esotericsoftware.kryo.Kryo.readObject(Kryo.java:729)
        at org.apache.hadoop.hive.ql.exec.SerializationUtilities$KryoWithHooks.readObject(SerializationUtilities.java:216)
        at org.apache.hive.com.esotericsoftware.kryo.serializers.ReflectField.read(ReflectField.java:125)
        ... 39 more
Caused by: java.lang.ClassNotFoundException: org.antlr.runtime.tree.CommonTree
        at java.net.URLClassLoader.findClass(URLClassLoader.java:382)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:419)
        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:352)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:352)
        ... 64 more
]DAG did not succeed due to VERTEX_FAILURE. failedVertices:1 killedVertices:0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13431202">HIVE-25994</key>
            <summary>Analyze table runs into ClassNotFoundException-s</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="asolimando">Alessandro Solimando</assignee>
                                    <reporter username="kgyrtkirk">Zoltan Haindrich</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 1 Mar 2022 10:45:54 +0000</created>
                <updated>Thu, 17 Nov 2022 08:47:49 +0000</updated>
                            <resolved>Wed, 16 Mar 2022 13:32:39 +0000</resolved>
                                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="5400">1.5h</timespent>
                                <comments>
                            <comment id="17503469" author="asolimando" created="Wed, 9 Mar 2022 10:23:21 +0000"  >&lt;p&gt;In the final classpath we have both &lt;em&gt;antlr4-runtime-4.5.jar&lt;/em&gt; and &lt;em&gt;antlr-runtime-3.5.2.jar&lt;/em&gt;, Antlr4 does not have the class &lt;em&gt;CommonTree&lt;/em&gt;, Hive is loading the wrong class at some point.&lt;/p&gt;

&lt;p&gt;Antlr4 is an explicit dependency under the &lt;em&gt;hive-hplsql&lt;/em&gt; module, added in 2015, it&apos;s weird that this issue is surfacing just now.&lt;/p&gt;</comment>
                            <comment id="17504144" author="asolimando" created="Thu, 10 Mar 2022 09:49:46 +0000"  >&lt;p&gt;I have updated the stack trace with more info, it&apos;s clear now that the issue happens in &lt;em&gt;org.apache.hadoop.hive.ql.exec.tez.TezTask&lt;/em&gt;, so the issue is most probably happening in the tez worker.&lt;/p&gt;</comment>
                            <comment id="17504525" author="abstractdog" created="Thu, 10 Mar 2022 19:03:48 +0000"  >&lt;p&gt;TezTask runs in HS2 not in Tez, it&apos;s the HS2 abstraction of a tez job&lt;br/&gt;
RootInputInitializerManager runs usually in TezAM, as it&apos;s part of the split generation&lt;br/&gt;
however, in case of a test, all of these can run in the same JVM, so in order to find the root cause it&apos;s crucial to know the exact setup&lt;/p&gt;</comment>
                            <comment id="17505061" author="asolimando" created="Fri, 11 Mar 2022 18:31:57 +0000"  >&lt;p&gt;We have verified and discussed offline with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=abstractdog&quot; class=&quot;user-hover&quot; rel=&quot;abstractdog&quot;&gt;abstractdog&lt;/a&gt;, the problem finally happens to be in the tez worker, which is missing the &lt;em&gt;antlr-runtime.jar&lt;/em&gt; dependency at runtime, which should be provided by &lt;em&gt;hive-exec.jar&lt;/em&gt;, I will shortly provide a PR to fix the issue.&lt;/p&gt;</comment>
                            <comment id="17507608" author="pvary" created="Wed, 16 Mar 2022 13:32:39 +0000"  >&lt;p&gt;Pushed to master.&lt;br/&gt;
Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=asolimando&quot; class=&quot;user-hover&quot; rel=&quot;asolimando&quot;&gt;asolimando&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=abstractdog&quot; class=&quot;user-hover&quot; rel=&quot;abstractdog&quot;&gt;abstractdog&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 35 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z101hc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>