<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:39:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-12418] HiveHBaseTableInputFormat.getRecordReader() causes Zookeeper connection leak.</title>
                <link>https://issues.apache.org/jira/browse/HIVE-12418</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;  @Override&lt;br/&gt;
  public RecordReader&amp;lt;ImmutableBytesWritable, ResultWritable&amp;gt; getRecordReader(&lt;br/&gt;
...&lt;br/&gt;
...&lt;br/&gt;
 setHTable(HiveHBaseInputFormatUtil.getTable(jobConf));&lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;The HiveHBaseInputFormatUtil.getTable() creates new ZooKeeper connections(when HTable instance is created) which are never closed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12913416">HIVE-12418</key>
            <summary>HiveHBaseTableInputFormat.getRecordReader() causes Zookeeper connection leak.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ngangam">Naveen Gangam</assignee>
                                    <reporter username="ngangam">Naveen Gangam</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Nov 2015 19:49:35 +0000</created>
                <updated>Tue, 16 Feb 2016 23:51:17 +0000</updated>
                            <resolved>Thu, 19 Nov 2015 14:11:11 +0000</resolved>
                                    <version>1.1.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>HiveServer2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15008830" author="ngangam" created="Tue, 17 Nov 2015 15:27:48 +0000"  >&lt;p&gt;The proposed fix closes the HTable resources when RecordReader.close() is called. Also overrides the Object.finalize() that closes these resources too in cases when RecordReader.close() is never called.&lt;/p&gt;</comment>
                            <comment id="15008848" author="ngangam" created="Tue, 17 Nov 2015 15:36:10 +0000"  >&lt;p&gt;Code has been posted to reviewboard at &lt;a href=&quot;https://reviews.apache.org/r/40390/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/40390/&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="15008875" author="aihuaxu" created="Tue, 17 Nov 2015 15:52:26 +0000"  >&lt;p&gt;+1. Looks good to me.&lt;/p&gt;</comment>
                            <comment id="15012985" author="hiveqa" created="Thu, 19 Nov 2015 06:38:29 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12772761/HIVE-12418.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12772761/HIVE-12418.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 9865 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestHWISessionManager - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hive.jdbc.TestSSL.testSSLVersion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6072/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6072/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6072/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6072/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6072/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6072/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12772761 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="15013547" author="ngangam" created="Thu, 19 Nov 2015 13:35:49 +0000"  >&lt;p&gt;The test failures are not related to the fix. &lt;/p&gt;</comment>
                            <comment id="15013593" author="aihuaxu" created="Thu, 19 Nov 2015 14:11:11 +0000"  >&lt;p&gt;Committed to master. Thanks Naveen for your work.&lt;/p&gt;</comment>
                            <comment id="15013609" author="ngangam" created="Thu, 19 Nov 2015 14:28:11 +0000"  >&lt;p&gt;Thanks for the code review and committing it.&lt;/p&gt;</comment>
                            <comment id="15085944" author="thejas" created="Wed, 6 Jan 2016 17:57:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;Also overrides the Object.finalize() that closes these resources too in cases when RecordReader.close() is never called.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Is that expected to happen ?&lt;br/&gt;
We should avoid the use of finalizers as far as possible. See one article on that - &lt;a href=&quot;https://plumbr.eu/blog/garbage-collection/debugging-to-understand-finalizer&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://plumbr.eu/blog/garbage-collection/debugging-to-understand-finalizer&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15086075" author="aihuaxu" created="Wed, 6 Jan 2016 19:02:39 +0000"  >&lt;p&gt;Yeah. I gave the same comments in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-12250&quot; title=&quot;Zookeeper connection leaks in Hive&amp;#39;s HBaseHandler.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-12250&quot;&gt;&lt;del&gt;HIVE-12250&lt;/del&gt;&lt;/a&gt;  and Naveen took that out there. But seems it still gave leaks and finalize() did take care of that. &lt;/p&gt;

&lt;p&gt;Do you have any suggestions on that?&lt;/p&gt;</comment>
                            <comment id="15086095" author="thejas" created="Wed, 6 Jan 2016 19:15:09 +0000"  >&lt;p&gt;That usually means that the appropriate close is missing somewhere. I haven&apos;t looked at the hbase storage enough, so not sure.&lt;/p&gt;
</comment>
                            <comment id="15086149" author="ngangam" created="Wed, 6 Jan 2016 19:39:12 +0000"  >
&lt;p&gt;We had removed this form the original fix and committed without overriding finalize(). On re-testing the fix in a customer environment, customer reported that the fix with finalize() worked whereas the fix without the finalize() did not work. As this was the only difference, we had to re-insert the finalize() method.&lt;/p&gt;

&lt;p&gt;With the new fix, the customer still reports that the original test fix works whereas the official fix does not resolve the issue (at this point they should be the same). I suspect this is an environmental issue now as opposed to having finalize().&lt;br/&gt;
I have used classes with finalize() in the past enough in WebLogic&apos;s JTA implementation (back in JDK1.3/1.4 era) and have not heard of any issues. But I am good with removing the finalize() if it is concerning.&lt;/p&gt;</comment>
                            <comment id="15086171" author="aihuaxu" created="Wed, 6 Jan 2016 19:55:43 +0000"  >&lt;p&gt;finalize() is not guaranteed to run. Maybe that&apos;s why sometimes it works and sometime it doesn&apos;t.  I think it doesn&apos;t hurt to override finalize(), but I agree that somewhere we didn&apos;t call close() of RecordReader. I went through the code, but RecordReader was used in many places. I didn&apos;t see places that we forgot to call close(). &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12907555">HIVE-12250</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12772761" name="HIVE-12418.patch" size="811" author="ngangam" created="Tue, 17 Nov 2015 15:26:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 45 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ogkn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>