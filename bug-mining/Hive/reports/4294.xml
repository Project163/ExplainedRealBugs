<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:42:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-9534] incorrect result set for query that projects a windowed aggregate</title>
                <link>https://issues.apache.org/jira/browse/HIVE-9534</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Result set returned by Hive has one row instead of 5&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;select avg(distinct tsint.csint) over () from tsint 

create table  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not exists TSINT (RNUM &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; , CSINT smallint)
 ROW FORMAT DELIMITED FIELDS TERMINATED BY &lt;span class=&quot;code-quote&quot;&gt;&apos;|&apos;&lt;/span&gt; LINES TERMINATED BY &lt;span class=&quot;code-quote&quot;&gt;&apos;\n&apos;&lt;/span&gt; 
 STORED AS TEXTFILE;

0|\N
1|-1
2|0
3|1
4|10
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12771524">HIVE-9534</key>
            <summary>incorrect result set for query that projects a windowed aggregate</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aihuaxu">Aihua Xu</assignee>
                                    <reporter username="the6campbells">N Campbell</reporter>
                        <labels>
                    </labels>
                <created>Sat, 31 Jan 2015 14:04:39 +0000</created>
                <updated>Tue, 21 Jun 2016 15:53:18 +0000</updated>
                            <resolved>Fri, 12 Feb 2016 20:24:04 +0000</resolved>
                                                    <fixVersion>2.1.0</fixVersion>
                                    <component>PTF-Windowing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                                                            <comments>
                            <comment id="14512276" author="qwertymaniac" created="Sat, 25 Apr 2015 05:46:25 +0000"  >&lt;p&gt;Applying a similar SQL in PostgreSQL or Impala returns an error of the form &quot;DISTINCT is not implemented for window functions&quot;. Hive, unless it did add proper support for distinct in such a context, should likely output the same error (if not a bug-fix).&lt;/p&gt;</comment>
                            <comment id="14512997" author="the6campbells" created="Sun, 26 Apr 2015 11:25:34 +0000"  >&lt;p&gt;While Postgres may not support ISO-SQL syntax as shown other vendors do. That said, if the engine does not attempt to support distinct aggregation then a parsing error should be thrown &lt;del&gt;and&lt;/del&gt; the documentation improved at&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/LanguageManual+WindowingAndAnalytics&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/Hive/LanguageManual+WindowingAndAnalytics&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14526190" author="ctang.ma" created="Mon, 4 May 2015 02:39:02 +0000"  >&lt;p&gt;I tried the tests (distinct with window function) in MySQL, PostgreSQL and Oracle with following steps:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;create table testwindow (col1 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, col2 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);
insert into testwindow values (1, 1);
insert into testwindow values (1, 2);
insert into testwindow values (1, 3);
insert into testwindow values (2, 1);
insert into testwindow values (2, 2);
insert into testwindow values (3, 3);
---
select avg(distinct col1) over() from testwindow;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;MySQL: did not work and got the error msg: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &apos;() from testwindow&apos; at line 1&lt;/p&gt;

&lt;p&gt;PostgreSQL: did not work and got the error msg: ERROR: DISTINCT is not implemented for window functions Position: 8&lt;/p&gt;

&lt;p&gt;Oracle: seemed work but I wonder if it is right, the average is right ( average of 1, 2, 3) with 6 rows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;1  2
2  2
3  2
4  2
5  2
6  2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Hive only returns one row but with correct average: 2&lt;/p&gt;
</comment>
                            <comment id="14526193" author="ctang.ma" created="Mon, 4 May 2015 02:42:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhbutani&quot; class=&quot;user-hover&quot; rel=&quot;rhbutani&quot;&gt;rhbutani&lt;/a&gt; I have not looked deeply into code yet, do you think the feature like distinct with window function has not been supported in Hive at this moment, or may it be a bug? Is it related to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-10586&quot; title=&quot;Plans for Queries with Select distinct and Windowing are incorrect&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-10586&quot;&gt;HIVE-10586&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="14528903" author="ctang.ma" created="Tue, 5 May 2015 17:51:12 +0000"  >&lt;p&gt;Actually as of Oracle 11.2 (the version I tested was Oracle Database 11g Express Edition Release 11.2.0.2.0 - 64bit Production), the window function is not supported. Though the query &quot;select avg(distinct col1) over() from testwindow;&quot;, where avg acts on all rows, works, query with windowing_clause does actually not work. for example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Query: 
select avg(distinct col1) over(order by col2 rows between 1 preceding and 1 following) from testwindow;
---
Error:
ORA-30487: ORDER BY not allowed here
30487. 00000 -  &lt;span class=&quot;code-quote&quot;&gt;&quot;ORDER BY not allowed here&quot;&lt;/span&gt;
*Cause:    DISTINCT functions and RATIO_TO_REPORT cannot have an ORDER BY
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Based on Oracle document &lt;a href=&quot;http://docs.oracle.com/cd/E11882_01/server.112/e25554/analysis.htm&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.oracle.com/cd/E11882_01/server.112/e25554/analysis.htm&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Note that the DISTINCT keyword is not supported in windowing functions except &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; MAX and MIN.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Based on Hive plan for &quot;select avg(distinct col1) over() from testwindow;&quot; it looks like Hive was computing the distinct value of col1:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;STAGE DEPENDENCIES:
  Stage-1 is a root stage
  Stage-0 depends on stages: Stage-1

STAGE PLANS:
  Stage: Stage-1
    Map Reduce
      Map Operator Tree:
          TableScan
            alias: testwindow
            Statistics: Num rows: 6 Data size: 18 Basic stats: COMPLETE Column stats: NONE
            Select Operator
              expressions: col1 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
              outputColumnNames: col1
              Statistics: Num rows: 6 Data size: 18 Basic stats: COMPLETE Column stats: NONE
              Group By Operator
                aggregations: avg(DISTINCT col1)
                keys: col1 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
                mode: hash
                outputColumnNames: _col0, _col1
                Statistics: Num rows: 6 Data size: 18 Basic stats: COMPLETE Column stats: NONE
                Reduce Output Operator
                  key expressions: _col0 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
                  sort order: +
                  Statistics: Num rows: 6 Data size: 18 Basic stats: COMPLETE Column stats: NONE
      Reduce Operator Tree:
        Group By Operator
          aggregations: avg(DISTINCT KEY._col0:0._col0)
          mode: mergepartial
          outputColumnNames: _col0
          Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE
          File Output Operator
            compressed: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
            Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE
            table:
                input format: org.apache.hadoop.mapred.TextInputFormat
                output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
                serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe

  Stage: Stage-0
    Fetch Operator
      limit: -1
      Processor Tree:
        ListSink
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="14529304" author="ctang.ma" created="Tue, 5 May 2015 21:20:06 +0000"  >&lt;p&gt;Looks like that the over(analytic_clause) part will be ignored in a query with distinct in Hive:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;function
@init { gParent.pushMsg(&lt;span class=&quot;code-quote&quot;&gt;&quot;function specification&quot;&lt;/span&gt;, state); }
@after { gParent.popMsg(state); }
    :
    functionName
    LPAREN
      (
        (STAR) =&amp;gt; (star=STAR)
        | (dist=KW_DISTINCT)? (selectExpression (COMMA selectExpression)*)?
      )
    RPAREN (KW_OVER ws=window_specification)?
           -&amp;gt; {$star != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}? ^(TOK_FUNCTIONSTAR functionName $ws?)
           -&amp;gt; {$dist == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}? ^(TOK_FUNCTION functionName (selectExpression+)? $ws?)
                            -&amp;gt; ^(TOK_FUNCTIONDI functionName (selectExpression+)?)
    ;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;the query like:&lt;br/&gt;
select avg(distinct col1) over() from testwindow; or &lt;br/&gt;
select avg(distinct col1) over(order by col2 rows between 1 preceding and 1 following) from testwindow;&lt;br/&gt;
the over(...) is totally ignored.&lt;br/&gt;
So I am going to fix this issue by throwing out unsupported error.&lt;/p&gt;</comment>
                            <comment id="14529608" author="the6campbells" created="Wed, 6 May 2015 00:09:40 +0000"  >&lt;p&gt;re your comment about ORACLE&lt;/p&gt;

&lt;p&gt;select avg(distinct tsint.csint) over () from tsint&lt;/p&gt;

&lt;p&gt;null, -1, 0, 1, 10&lt;br/&gt;
ORACLE Oracle Database 12c Enterprise Edition ( 12.1.0.2.0)   returns 2.5,&lt;br/&gt;
2.5, 2.5, 2.5, 2.5&lt;/p&gt;


</comment>
                            <comment id="14529716" author="ctang.ma" created="Wed, 6 May 2015 01:22:30 +0000"  >&lt;p&gt;Oracle 11.2 treats avg(distinct tsint.csint) over () as analytic function instead of aggregation function, so the query return 4 rows of returns 2.5. Note, there is not order by clause or window clause inside the parenthesis of &quot;over&quot;. Could you try query like &quot;select avg(distinct tsint.csint) over (order by rnum rows between 1 preceding and 1 following) from tsint&quot; to see if it works in Oracle c12? It did not work in 11.2.&lt;/p&gt;</comment>
                            <comment id="14901809" author="the6campbells" created="Tue, 22 Sep 2015 02:34:21 +0000"  >&lt;p&gt;IBM Netezza 7.2, IBM Big Insights, SAP Hana SP10, ORACLE 12 etc all return the expected result. &lt;/p&gt;</comment>
                            <comment id="14901818" author="the6campbells" created="Tue, 22 Sep 2015 02:40:04 +0000"  >&lt;p&gt;should say Netezza 7.2 and ORACLE 12.&lt;/p&gt;</comment>
                            <comment id="15101811" author="aihuaxu" created="Fri, 15 Jan 2016 14:12:47 +0000"  >&lt;p&gt;Talked to Chaoyu. I will take a look at the issue.&lt;/p&gt;</comment>
                            <comment id="15132526" author="aihuaxu" created="Thu, 4 Feb 2016 16:24:34 +0000"  >&lt;p&gt;Attach Patch-1:  this is to support AVG(DISTINCT) OVER (PARTITION BY) format. Similar to SUM() and COUNT(), it&apos;s to skip the same value when DISTINCT is present.&lt;/p&gt;</comment>
                            <comment id="15132527" author="aihuaxu" created="Thu, 4 Feb 2016 16:25:15 +0000"  >&lt;p&gt;&lt;br/&gt;
Code review: &lt;a href=&quot;https://reviews.apache.org/r/43192/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/43192/&lt;/a&gt;. Somehow I can&apos;t link to that.&lt;/p&gt;</comment>
                            <comment id="15132537" author="aihuaxu" created="Thu, 4 Feb 2016 16:33:16 +0000"  >&lt;p&gt;Patch-2: add the missing license comment in the new file.&lt;/p&gt;</comment>
                            <comment id="15135706" author="hiveqa" created="Sat, 6 Feb 2016 09:52:56 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12786290/HIVE-9534.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12786290/HIVE-9534.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 18 failed/errored test(s), 10052 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_cbo_rp_windowing_2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ctas_colname
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_lineage3
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ptfgroupbyjoin
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_quotedid_basic
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_in
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_notin
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_unqualcolumnrefs
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_windowing_streaming
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_explainuser_1
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_subquery_in
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_windowing_gby
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_invalid_avg_syntax
org.apache.hadoop.hive.cli.TestPerfCliDriver.testPerfCliDriver_query67
org.apache.hadoop.hive.cli.TestPerfCliDriver.testPerfCliDriver_query70
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_subquery_in
org.apache.hive.jdbc.TestSSL.testSSLVersion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6883/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6883/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6883/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6883/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6883/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6883/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 18 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12786290 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="15137304" author="aihuaxu" created="Mon, 8 Feb 2016 17:33:40 +0000"  >&lt;p&gt;Attached patch-3: other UDAF like RANK() got affected. &lt;/p&gt;</comment>
                            <comment id="15139388" author="hiveqa" created="Tue, 9 Feb 2016 18:49:20 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12786846/HIVE-9534.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12786846/HIVE-9534.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 5 failed/errored test(s), 10039 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestSparkCliDriver-timestamp_lazy.q-bucketsortoptimize_insert_4.q-date_udf.q-and-12-more - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_invalid_avg_syntax
org.apache.hadoop.hive.ql.TestTxnCommands2.testInitiatorWithMultipleFailedCompactions
org.apache.hive.jdbc.TestSSL.testSSLVersion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6920/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6920/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6920/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6920/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6920/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6920/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 5 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12786846 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="15139661" author="aihuaxu" created="Tue, 9 Feb 2016 20:00:19 +0000"  >&lt;p&gt;Attached patch-4: fix the unit test invalid_avg_syntax issue. &lt;/p&gt;</comment>
                            <comment id="15142326" author="hiveqa" created="Thu, 11 Feb 2016 07:01:43 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12787127/HIVE-9534.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12787127/HIVE-9534.4.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 4 failed/errored test(s), 9738 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestMiniTezCliDriver-auto_sortmerge_join_13.q-tez_self_join.q-schema_evol_text_nonvec_mapwork_table.q-and-12-more - did not produce a TEST-*.xml file
TestMiniTezCliDriver-dynpart_sort_optimization2.q-tez_bmj_schema_evolution.q-vector_char_mapjoin1.q-and-12-more - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hive.jdbc.TestSSL.testSSLVersion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6939/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6939/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6939/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6939/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6939/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6939/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12787127 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="15143743" author="ychena" created="Fri, 12 Feb 2016 00:06:15 +0000"  >&lt;p&gt;It seems that your method need a global sorting first, then group the values to have a right answer. Not As what I thought: each node sort and group its own values, then merge (which need combine arrays).  Does your method do global sorting first?&lt;/p&gt;</comment>
                            <comment id="15143928" author="ychena" created="Fri, 12 Feb 2016 02:50:32 +0000"  >&lt;p&gt;My fault, re-attach patch2 with the test fix. &lt;/p&gt;</comment>
                            <comment id="15143953" author="ychena" created="Fri, 12 Feb 2016 03:13:22 +0000"  >&lt;p&gt;As the Avg(distinct) is calculated after global sort, the fix is a good one.&lt;br/&gt;
+1&lt;/p&gt;</comment>
                            <comment id="15144744" author="aihuaxu" created="Fri, 12 Feb 2016 15:58:38 +0000"  >&lt;p&gt;Thanks Yongzhi. Yeah. The current implementation will do a sort on the partitioning columns so each partition data in the reducer is sorted and we only need to check previous row against the current row to find if it&apos;s distinct or not.&lt;/p&gt;</comment>
                            <comment id="15145231" author="aihuaxu" created="Fri, 12 Feb 2016 20:24:04 +0000"  >&lt;p&gt;Pushed to master. Thanks Yongzhi for reviewing.&lt;/p&gt;</comment>
                            <comment id="15145873" author="lefty@hortonworks.com" created="Sat, 13 Feb 2016 08:09:42 +0000"  >&lt;p&gt;Does the documentation still need to be improved?&lt;/p&gt;</comment>
                            <comment id="15226780" author="sershe" created="Tue, 5 Apr 2016 18:00:50 +0000"  >&lt;p&gt;Does this need to be backported to 2.0.1? Seems like a serious bug&lt;/p&gt;</comment>
                            <comment id="15227002" author="aihuaxu" created="Tue, 5 Apr 2016 19:49:57 +0000"  >&lt;p&gt;That could  be considered as new feature rather than bug, I guess. Since technically we don&apos;t support distinct in windowing function before. Probably we should not backport to 2.0.1.&lt;/p&gt;</comment>
                            <comment id="15227037" author="sershe" created="Tue, 5 Apr 2016 20:03:49 +0000"  >&lt;p&gt;Makes sense, thanks.&lt;/p&gt;</comment>
                            <comment id="15227426" author="lefty@hortonworks.com" created="Wed, 6 Apr 2016 00:20:43 +0000"  >&lt;p&gt;Doc query:  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=the6campbells&quot; class=&quot;user-hover&quot; rel=&quot;the6campbells&quot;&gt;the6campbells&lt;/a&gt; said in the second comment on this issue:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;While Postgres may not support ISO-SQL syntax as shown other vendors do. That said, if the engine does not attempt to support distinct aggregation then a parsing error should be thrown and the documentation improved at&lt;br/&gt;
&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/LanguageManual+WindowingAndAnalytics&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/Hive/LanguageManual+WindowingAndAnalytics&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aihuaxu&quot; class=&quot;user-hover&quot; rel=&quot;aihuaxu&quot;&gt;aihuaxu&lt;/a&gt;, what documentation changes are needed now that this issue is resolved?&lt;/p&gt;</comment>
                            <comment id="15230269" author="aihuaxu" created="Thu, 7 Apr 2016 14:00:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=leftylev&quot; class=&quot;user-hover&quot; rel=&quot;leftylev&quot;&gt;leftylev&lt;/a&gt; I just updated the doc. &lt;/p&gt;

&lt;p&gt;I also filed &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-13453&quot; title=&quot;Support ORDER BY and windowing clause in partitioning clause with distinct function&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-13453&quot;&gt;&lt;del&gt;HIVE-13453&lt;/del&gt;&lt;/a&gt; to track the improvement to address the current limitation.&lt;/p&gt;</comment>
                            <comment id="15231840" author="lefty@hortonworks.com" created="Fri, 8 Apr 2016 08:14:53 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aihuaxu&quot; class=&quot;user-hover&quot; rel=&quot;aihuaxu&quot;&gt;aihuaxu&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12786286" name="HIVE-9534.1.patch" size="13151" author="aihuaxu" created="Thu, 4 Feb 2016 16:22:49 +0000"/>
                            <attachment id="12786290" name="HIVE-9534.2.patch" size="14053" author="aihuaxu" created="Thu, 4 Feb 2016 16:32:43 +0000"/>
                            <attachment id="12786846" name="HIVE-9534.3.patch" size="14224" author="aihuaxu" created="Mon, 8 Feb 2016 17:33:40 +0000"/>
                            <attachment id="12787127" name="HIVE-9534.4.patch" size="14897" author="aihuaxu" created="Tue, 9 Feb 2016 19:59:23 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12932459">HIVE-12889</subtask>
                            <subtask id="12934507">HIVE-12944</subtask>
                            <subtask id="12956868">HIVE-13453</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 32 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i251hr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>