<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:25:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-8311] Driver is encoding transaction information too late</title>
                <link>https://issues.apache.org/jira/browse/HIVE-8311</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Currently Driver is obtaining the transaction information and encoding it in the conf in runInternal.  But this is too late, as the query has already been planned.  Either we need to change the plan when this info is obtained or we need to obtain it at compile time.  This bug was introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-8203&quot; title=&quot;ACID operations result in NPE when run through HS2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-8203&quot;&gt;&lt;del&gt;HIVE-8203&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12745031">HIVE-8311</key>
            <summary>Driver is encoding transaction information too late</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gates">Alan Gates</assignee>
                                    <reporter username="gates">Alan Gates</reporter>
                        <labels>
                    </labels>
                <created>Tue, 30 Sep 2014 18:53:56 +0000</created>
                <updated>Thu, 13 Nov 2014 19:40:38 +0000</updated>
                            <resolved>Thu, 2 Oct 2014 15:59:35 +0000</resolved>
                                    <version>0.14.0</version>
                                    <fixVersion>0.14.0</fixVersion>
                                    <component>Transactions</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14153560" author="alangates" created="Tue, 30 Sep 2014 18:54:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vikram.dixit&quot; class=&quot;user-hover&quot; rel=&quot;vikram.dixit&quot;&gt;vikram.dixit&lt;/a&gt; I&apos;d like to get this into 0.14, as it produces wrong results.  I should have a patch in a few hours.&lt;/p&gt;</comment>
                            <comment id="14153680" author="alangates" created="Tue, 30 Sep 2014 20:06:58 +0000"  >&lt;p&gt;This patch moves the encoding of the transaction information from runInternal to compile.&lt;/p&gt;</comment>
                            <comment id="14153803" author="ekoifman" created="Tue, 30 Sep 2014 21:39:39 +0000"  >&lt;p&gt;previously, locks were acquired 1st, then valid transaction list computed.&lt;br/&gt;
Now the order is reversed.  So now it&apos;s possible that txn list is computed, then a new txn (on a resource in in this TX) runs, then locks are acquired.  I think, strictly speaking this is a race condition - for example a compactor run may sneak in here.  Does this seem like an issue? &lt;/p&gt;

&lt;p&gt;Does hive cache query plans?  If so, it will need to be invalidated when valid txn list changes&lt;/p&gt;</comment>
                            <comment id="14154090" author="alangates" created="Wed, 1 Oct 2014 00:25:17 +0000"  >&lt;blockquote&gt;&lt;p&gt;So now it&apos;s possible that txn list is computed...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If another txn runs between when a query generates its txn list and when it acquires locks that&apos;s fine because this txn won&apos;t see the results of that txn.  I think this is more reasonable then having the query wait and generate its txn state after locks, because that makes the results of the query variable based on when locks are obtained instead of when it is submitted.&lt;/p&gt;

&lt;p&gt;(Note that this issue exists no matter what.  Even once locks are acquired it may take some time for the engine (Tez or MR) to submit the job.  Also, once we support cross query transactions we&apos;ll have multiple queries where we are acquiring new sets of locks.)&lt;/p&gt;

&lt;p&gt;If the compactor runs between when the query gets its txn list and when it obtains locks we should still be fine.  By definition the compactor does not change the set of valid data.  Some txns listed as aborted in the query&apos;s list may now be removed from the file, but that&apos;s not a problem.&lt;/p&gt;

&lt;p&gt;Have I missed anything?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Does hive cache query plans? &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Not at the moment.&lt;/p&gt;</comment>
                            <comment id="14154109" author="vikram.dixit" created="Wed, 1 Oct 2014 00:41:34 +0000"  >&lt;p&gt;+1 for 0.14&lt;/p&gt;</comment>
                            <comment id="14154224" author="ekoifman" created="Wed, 1 Oct 2014 02:01:19 +0000"  >&lt;p&gt;You are right.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14154263" author="hiveqa" created="Wed, 1 Oct 2014 02:58:44 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12672115/HIVE-8311.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12672115/HIVE-8311.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 6379 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1062/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1062/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1062/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1062/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-1062/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-1062/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12672115&lt;/p&gt;</comment>
                            <comment id="14156686" author="alangates" created="Thu, 2 Oct 2014 15:59:35 +0000"  >&lt;p&gt;Patch checked into trunk and branch.  Thanks Eugene for the review.&lt;/p&gt;</comment>
                            <comment id="14210394" author="thejas" created="Thu, 13 Nov 2014 19:40:38 +0000"  >&lt;p&gt;This has been fixed in 0.14 release. Please open new jira if you see any issues.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12742901">HIVE-8203</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12672115" name="HIVE-8311.patch" size="3100" author="gates" created="Tue, 30 Sep 2014 20:06:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20ncn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>