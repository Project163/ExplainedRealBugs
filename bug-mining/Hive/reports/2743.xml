<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:25:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-8391] Comparion between TIMESTAMP and Integer types goes to STRING as &quot;common comparison denominator&quot; instead of a numeric type</title>
                <link>https://issues.apache.org/jira/browse/HIVE-8391</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;&lt;br/&gt;
Discovered while investigating why vectorization_7.q has different results for non-vectorized &lt;span class=&quot;error&quot;&gt;&amp;#91;+CBO&amp;#93;&lt;/span&gt; and vectorized &lt;span class=&quot;error&quot;&gt;&amp;#91;+CBO&amp;#93;&lt;/span&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12746569">HIVE-8391</key>
            <summary>Comparion between TIMESTAMP and Integer types goes to STRING as &quot;common comparison denominator&quot; instead of a numeric type</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdere">Jason Dere</assignee>
                                    <reporter username="mmccline">Matt McCline</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Oct 2014 00:45:57 +0000</created>
                <updated>Thu, 13 Nov 2014 19:42:03 +0000</updated>
                            <resolved>Wed, 15 Oct 2014 01:59:35 +0000</resolved>
                                    <version>0.14.0</version>
                                    <fixVersion>0.14.0</fixVersion>
                                    <component>CBO</component>
                    <component>Logical Optimizer</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14162953" author="jdere" created="Wed, 8 Oct 2014 02:20:51 +0000"  >&lt;p&gt;I think this patch should address this issue - the common class between timestamp/numeric (up to double) will be treated as double. Are there any Hive scholars that can confirm that this is the correct behavior?&lt;/p&gt;</comment>
                            <comment id="14162958" author="sershe" created="Wed, 8 Oct 2014 02:22:18 +0000"  >&lt;p&gt;can you add test to some q file? &lt;/p&gt;</comment>
                            <comment id="14163548" author="mmccline" created="Wed, 8 Oct 2014 14:31:01 +0000"  >&lt;p&gt;I attached a modified version of ../../ql/src/test/results/clientpositive/vectorization_7.q that first makes sure the query had a Map stage and vectorizes instead of the Fetch stage (SET hive.fetch.task.conversion=minimal).&lt;/p&gt;

&lt;p&gt;I get differences when vectorization is turned off and on with this q file.  Not sure what is going on.  Haven&apos;t tried CBO yet.&lt;/p&gt;</comment>
                            <comment id="14163556" author="mmccline" created="Wed, 8 Oct 2014 14:39:46 +0000"  >&lt;p&gt;(Note the query does compare a timestamp column against an integer not a double).&lt;/p&gt;</comment>
                            <comment id="14164181" author="jdere" created="Wed, 8 Oct 2014 21:12:25 +0000"  >&lt;p&gt;I think there may be something wrong with the vectorized query.&lt;/p&gt;

&lt;p&gt;First, let&apos;s take a look at time timestamp to numeric value conversion for the value used in the timestamp predicates:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hive&amp;gt; select ts, cast(ts as int), cast(ts as double) from (select cast(-29071.0 as timestamp) as ts) as q;
1969-12-31 07:55:29	-29071	-29071.0

hive&amp;gt; select ts, cast(ts as int), cast(ts as double) from (select cast(0.0 as timestamp) as ts) as q;     
1969-12-31 16:00:00	0	0.0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So substituting in the numeric comparisons for timestamp comparisons, in theory these 2 queries below should return the same result. But in vectorized mode they do not.  With vectorized mode off, these queries both return 1826 with the attached patch.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hive&amp;gt; SET hive.vectorized.execution.enabled=true;
hive&amp;gt; select count(*) 
    &amp;gt; FROM   alltypesorc
    &amp;gt; WHERE  
    &amp;gt; ((ctinyint != 0)
    &amp;gt;     AND 
    &amp;gt;         (((ctimestamp1 &amp;lt;= 0) 
    &amp;gt;             OR ((ctinyint = cint) OR (cstring2 LIKE &apos;ss&apos;)))
    &amp;gt;          AND ((988888 &amp;lt; cdouble)
    &amp;gt;              OR ((ctimestamp2 &amp;gt; -29071) AND (3569 &amp;gt;= cdouble)))))
    &amp;gt; ;
OK
487
Time taken: 1.486 seconds, Fetched: 1 row(s)
hive&amp;gt; select count(*)
    &amp;gt; FROM   alltypesorc
    &amp;gt; WHERE  
    &amp;gt; ((ctinyint != 0)
    &amp;gt;     AND 
    &amp;gt;         (((ctimestamp1 &amp;lt;= timestamp(&apos;1969-12-31 16:00:00&apos;)) 
    &amp;gt;             OR ((ctinyint = cint) OR (cstring2 LIKE &apos;ss&apos;)))
    &amp;gt;          AND ((988888 &amp;lt; cdouble)
    &amp;gt;              OR ((ctimestamp2 &amp;gt; timestamp(&apos;1969-12-31 07:55:29&apos;)) AND (3569 &amp;gt;= cdouble)))));
OK
1826
Time taken: 1.441 seconds, Fetched: 1 row(s)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14164187" author="jdere" created="Wed, 8 Oct 2014 21:17:37 +0000"  >&lt;p&gt;Though I&apos;m not sure about patch v1 as the best fix for this issue - this allows numeric-to-timestamp comparisons by allowing implicit conversions between double and timestamps.  I don&apos;t want to just enable implicit conversions - for example it was a change which allowed implicit conversions between string and dates/timestamps which seems to have caused this particular issue about numeric-to-timestamp comparisons in the first place.&lt;/p&gt;</comment>
                            <comment id="14164295" author="jdere" created="Wed, 8 Oct 2014 22:28:08 +0000"  >&lt;p&gt;Patch v2 allows timestamp and numeric types to be compared as double, without having to allow implicit conversions between timestamp and numeric. Also add q file test.&lt;/p&gt;</comment>
                            <comment id="14165674" author="hiveqa" created="Thu, 9 Oct 2014 20:20:03 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12673730/HIVE-8391.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12673730/HIVE-8391.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 4120 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1189/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1189/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1189/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1189/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-1189/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-1189/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12673730&lt;/p&gt;</comment>
                            <comment id="14165804" author="jdere" created="Thu, 9 Oct 2014 21:44:09 +0000"  >&lt;p&gt;Only 4000 tests run by pre-commit, re-uploading to get full run of tests &lt;/p&gt;</comment>
                            <comment id="14168220" author="hiveqa" created="Sat, 11 Oct 2014 15:57:06 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12674010/HIVE-8391.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12674010/HIVE-8391.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 1 failed/errored test(s), 4138 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_tez_smb_1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1214/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1214/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1214/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1214/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-1214/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-1214/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12674010&lt;/p&gt;</comment>
                            <comment id="14169793" author="sershe" created="Mon, 13 Oct 2014 19:22:18 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14171878" author="jdere" created="Wed, 15 Oct 2014 01:59:36 +0000"  >&lt;p&gt;Committed to trunk/branch-0.14&lt;/p&gt;</comment>
                            <comment id="14210683" author="thejas" created="Thu, 13 Nov 2014 19:42:03 +0000"  >&lt;p&gt;This has been fixed in 0.14 release. Please open new jira if you see any issues.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12673504" name="HIVE-8391.1.patch" size="2405" author="jdere" created="Wed, 8 Oct 2014 02:20:51 +0000"/>
                            <attachment id="12673730" name="HIVE-8391.2.patch" size="5045" author="jdere" created="Wed, 8 Oct 2014 22:28:08 +0000"/>
                            <attachment id="12674010" name="HIVE-8391.3.patch" size="5045" author="jdere" created="Thu, 9 Oct 2014 21:44:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20wsf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>