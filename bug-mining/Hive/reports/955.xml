<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:02:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-3496] Query plan for multi-join where the third table joined is a subquery containing a map-only union with hive.auto.convert.join=true is wrong</title>
                <link>https://issues.apache.org/jira/browse/HIVE-3496</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Take the following query as an example:&lt;/p&gt;

&lt;p&gt;EXPLAIN SELECT * FROM &lt;br/&gt;
src11 a JOIN&lt;br/&gt;
src12 b ON (a.key = b.key) JOIN&lt;br/&gt;
(SELECT * FROM (SELECT * FROM src13 UNION ALL SELECT * FROM src14)a )c ON c.value = b.value;&lt;/p&gt;

&lt;p&gt;When hive.auto.convert.join=true, the two joins are implemented separately as conditional tasks with two mapjoins and a backup common join.  In the second join, the conditional task will be a backup task, contained in the ConditionalTask, and a root task.  This is clearly wrong, and leads to query failures.&lt;/p&gt;

&lt;p&gt;I&apos;ve traced this to the joinUnionPlan method of GenMapRedUtils.  If the union operator was performed in its own map reduce task and it could be a root task, when it is added to the mapper of the existing task which performs the join in the reducer, this task will get made a root task without first checking if the existing (non-union) task has any dependencies.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12608559">HIVE-3496</key>
            <summary>Query plan for multi-join where the third table joined is a subquery containing a map-only union with hive.auto.convert.join=true is wrong</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kevinwilfong">Kevin Wilfong</assignee>
                                    <reporter username="kevinwilfong">Kevin Wilfong</reporter>
                        <labels>
                    </labels>
                <created>Fri, 21 Sep 2012 01:24:44 +0000</created>
                <updated>Thu, 10 Jan 2013 19:53:59 +0000</updated>
                            <resolved>Fri, 21 Sep 2012 10:51:58 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.10.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13460132" author="kevinwilfong" created="Fri, 21 Sep 2012 02:23:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.facebook.net/D5577&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D5577&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13460181" author="namit" created="Fri, 21 Sep 2012 03:53:30 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13460419" author="namit" created="Fri, 21 Sep 2012 10:51:58 +0000"  >&lt;p&gt;Committed. Thanks Kevin&lt;/p&gt;</comment>
                            <comment id="13460624" author="hudson" created="Fri, 21 Sep 2012 17:06:43 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #1688 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/1688/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/1688/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3496&quot; title=&quot;Query plan for multi-join where the third table joined is a subquery containing a map-only union with hive.auto.convert.join=true is wrong&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3496&quot;&gt;&lt;del&gt;HIVE-3496&lt;/del&gt;&lt;/a&gt; Query plan for multi-join where the third table joined is a subquery containing a map-only &lt;br/&gt;
union with hive.auto.convert.join=true is wrong&lt;br/&gt;
(Kevin Wilfong via namit) (Revision 1388412)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
namit : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1388412&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1388412&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/multi_join_union.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/multi_join_union.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13548219" author="hudson" created="Wed, 9 Jan 2013 10:24:51 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #54 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3496&quot; title=&quot;Query plan for multi-join where the third table joined is a subquery containing a map-only union with hive.auto.convert.join=true is wrong&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3496&quot;&gt;&lt;del&gt;HIVE-3496&lt;/del&gt;&lt;/a&gt; Query plan for multi-join where the third table joined is a subquery containing a map-only &lt;br/&gt;
union with hive.auto.convert.join=true is wrong&lt;br/&gt;
(Kevin Wilfong via namit) (Revision 1388412)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
namit : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1388412&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1388412&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/multi_join_union.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/multi_join_union.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13550255" author="ashutoshc" created="Thu, 10 Jan 2013 19:53:59 +0000"  >&lt;p&gt;This issue is fixed and released as part of 0.10.0 release. If you find an issue which seems to be related to this one, please create a new jira and link this one with new jira.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12545991" name="HIVE-3496.1.patch.txt" size="22512" author="kevinwilfong" created="Fri, 21 Sep 2012 02:25:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>259274</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 45 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lnxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>124527</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>