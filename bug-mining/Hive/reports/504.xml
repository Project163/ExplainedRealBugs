<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:57:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-1501] when generating reentrant INSERT for index rebuild, quote identifiers using backticks</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1501</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Yongqiang, you mentioned that you weren&apos;t able to do this due to SORT BY not accepting them.  The SORT BY is gone now as of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1494&quot; title=&quot;Index followup: remove sort by clause and fix a bug in collect_set udaf&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1494&quot;&gt;&lt;del&gt;HIVE-1494&lt;/del&gt;&lt;/a&gt; (and SORT BY needs to be fixed anyway).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12470567">HIVE-1501</key>
            <summary>when generating reentrant INSERT for index rebuild, quote identifiers using backticks</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sberghel">Skye Berghel</assignee>
                                    <reporter username="jvs">John Sichi</reporter>
                        <labels>
                    </labels>
                <created>Sat, 31 Jul 2010 00:56:12 +0000</created>
                <updated>Fri, 16 Dec 2011 23:59:18 +0000</updated>
                            <resolved>Wed, 10 Nov 2010 23:22:01 +0000</resolved>
                                    <version>0.7.0</version>
                                    <fixVersion>0.7.0</fixVersion>
                                    <component>Indexing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="12894230" author="jvs" created="Sat, 31 Jul 2010 00:56:33 +0000"  >&lt;p&gt;Followup for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-417&quot; title=&quot;Implement Indexing in Hive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-417&quot;&gt;&lt;del&gt;HIVE-417&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12913723" author="jvs" created="Wed, 22 Sep 2010 19:03:02 +0000"  >&lt;p&gt;Example:&lt;/p&gt;

&lt;p&gt;create table `_t`(`_i` int, `_j` int);&lt;br/&gt;
create index x on table `_t`(`_j`) as &apos;compact&apos; with deferred rebuild;&lt;br/&gt;
alter index x on `_t` rebuild;&lt;/p&gt;

&lt;p&gt;gives&lt;/p&gt;

&lt;p&gt;FAILED: Parse Error: line 1:48 mismatched input &apos;,&apos; expecting CharSetLiteral in character string literal&lt;/p&gt;

&lt;p&gt;To see why, look at org.apache.hadoop.hive.ql.index.compact.CompactIndexHandler, method getIndexBuilderMapRedTask.  It constructs an internal SQL statement (INSERT) which populates the index table structure.  However, it neglects to quote the table/column names, leading to invalid syntax.  (Hive uses backticks to quote identifiers with special characters--I think this currently only applies to leading underscores, but later we&apos;ll support arbitrary identifiers.)&lt;/p&gt;

&lt;p&gt;HiveUtils.unparseIdentifier should be used for quoting.&lt;/p&gt;</comment>
                            <comment id="12913731" author="jvs" created="Wed, 22 Sep 2010 19:22:19 +0000"  >&lt;p&gt;Russell, please reassign to the actual owner.&lt;/p&gt;</comment>
                            <comment id="12919173" author="sberghel" created="Fri, 8 Oct 2010 06:34:04 +0000"  >&lt;p&gt;Patch for 1501&lt;/p&gt;</comment>
                            <comment id="12919174" author="sberghel" created="Fri, 8 Oct 2010 06:34:46 +0000"  >&lt;p&gt;I&apos;ve added a patch that should solve the issue.&lt;/p&gt;

&lt;p&gt;In terms of tests, is a simple test (of the kind John described in his earlier comment) sufficient?&lt;/p&gt;</comment>
                            <comment id="12919960" author="jvs" created="Mon, 11 Oct 2010 19:37:54 +0000"  >&lt;p&gt;Yes, a simple test such as the one above should be good enough.&lt;/p&gt;</comment>
                            <comment id="12925267" author="sberghel" created="Wed, 27 Oct 2010 06:01:45 +0000"  >&lt;p&gt;Adding a patch for 1501 that also includes tests.&lt;/p&gt;</comment>
                            <comment id="12925618" author="he yongqiang" created="Thu, 28 Oct 2010 00:28:49 +0000"  >&lt;p&gt;String indexCols = MetaStoreUtils.getColumnNamesFromFieldSchema(indexField);&lt;br/&gt;
indexCols is a column list, like:&lt;br/&gt;
col1, col2,col3&lt;br/&gt;
After the change, it should be `col1`, `col2`, `col3`...&lt;/p&gt;

&lt;p&gt;So the whole command should be like:&lt;br/&gt;
INSERT OVERWRITE TABLE `table_name`&lt;br/&gt;
PARTITION (...)&lt;br/&gt;
SELECT `col1`, `col2`, `col3`..., `INPUT_&lt;em&gt;FILE&lt;/em&gt;&lt;em&gt;NAME`,  collect_set (`BLOCK&lt;/em&gt;&lt;em&gt;OFFSET&lt;/em&gt;&lt;em&gt;INSIDE&lt;/em&gt;_FILE`)&lt;br/&gt;
FROM `base_table` &lt;br/&gt;
...&lt;br/&gt;
GROUP BY `col1`, `col2`, `col3`..., `INPUT_&lt;em&gt;FILE&lt;/em&gt;_NAME`&lt;/p&gt;</comment>
                            <comment id="12926526" author="sberghel" created="Sat, 30 Oct 2010 03:32:22 +0000"  >&lt;p&gt;Adding a new patch for 1501 that parses the index columns correctly.&lt;/p&gt;</comment>
                            <comment id="12927096" author="jvs" created="Mon, 1 Nov 2010 19:12:50 +0000"  >&lt;p&gt;Can you update the testcase to use an index on a compound key so that this case gets coverage?&lt;/p&gt;</comment>
                            <comment id="12927730" author="sberghel" created="Wed, 3 Nov 2010 04:04:10 +0000"  >&lt;p&gt;Adding a new patch with a new test case for an index with multiple keys.&lt;/p&gt;</comment>
                            <comment id="12928295" author="jvs" created="Thu, 4 Nov 2010 18:21:59 +0000"  >&lt;p&gt;+1.  Will commit when tests pass.&lt;/p&gt;</comment>
                            <comment id="12928300" author="jvs" created="Thu, 4 Nov 2010 18:34:40 +0000"  >&lt;p&gt;Oops, I have to retract my +1.&lt;/p&gt;

&lt;p&gt;The patch doesn&apos;t compile with &quot;ant package&quot;.  The reason is that code in metastore is not allowed to depend on code in ql.&lt;/p&gt;

&lt;p&gt;If you were compiling with Eclipse, it may have allowed this, but before submitting your patch, make sure it compiles from the command line with &quot;ant package&quot;.&lt;/p&gt;

&lt;p&gt;The solution is to move this method from MetastoreUtils to HiveUtils.&lt;/p&gt;</comment>
                            <comment id="12929271" author="sberghel" created="Sat, 6 Nov 2010 23:09:34 +0000"  >&lt;p&gt;Moved function from MetaStoreUtils to HiveUtils.&lt;/p&gt;</comment>
                            <comment id="12929765" author="jvs" created="Mon, 8 Nov 2010 22:16:25 +0000"  >&lt;p&gt;Whitespace nitpicks:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;MetaStoreUtils.java no longer has any changes, so it should not be in the patch at all&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12929766" author="jvs" created="Mon, 8 Nov 2010 22:19:51 +0000"  >&lt;ul&gt;
	&lt;li&gt;HiveUtils.getUnparsedColumnNamesFromFieldSchema has an extra line of whitespace in between the Javadoc and the method declaration.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;(If you&apos;re using Eclipse for editing, it&apos;s easy to end up with extraneous whitespace.)&lt;/p&gt;</comment>
                            <comment id="12929769" author="jvs" created="Mon, 8 Nov 2010 22:20:24 +0000"  >&lt;p&gt;(Other than those, this one should be ready to go.)&lt;/p&gt;</comment>
                            <comment id="12930535" author="sberghel" created="Wed, 10 Nov 2010 07:23:18 +0000"  >&lt;p&gt;Added a new patch with formatting fixes.&lt;/p&gt;</comment>
                            <comment id="12930677" author="jvs" created="Wed, 10 Nov 2010 17:55:51 +0000"  >&lt;p&gt;+1 on the latest.  Will commit when tests pass.&lt;/p&gt;</comment>
                            <comment id="12930825" author="jvs" created="Wed, 10 Nov 2010 23:22:01 +0000"  >&lt;p&gt;Committed.  Thanks Skye!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12422895">HIVE-417</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12456677" name="1501.patch" size="1616" author="sberghel" created="Fri, 8 Oct 2010 06:34:04 +0000"/>
                            <attachment id="12458468" name="1501_new_tests.patch" size="28201" author="sberghel" created="Sat, 30 Oct 2010 03:32:21 +0000"/>
                            <attachment id="12458134" name="1501_with_tests.patch" size="21264" author="sberghel" created="Wed, 27 Oct 2010 06:01:45 +0000"/>
                            <attachment id="12458708" name="HIVE-1501.4.patch" size="35280" author="sberghel" created="Wed, 3 Nov 2010 04:04:09 +0000"/>
                            <attachment id="12459010" name="HIVE-1501.5.patch" size="35704" author="sberghel" created="Sat, 6 Nov 2010 23:09:33 +0000"/>
                            <attachment id="12459229" name="HIVE-1501.6.patch" size="35218" author="sberghel" created="Wed, 10 Nov 2010 07:23:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72868</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 2 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i010fj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3835</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>