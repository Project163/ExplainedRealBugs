<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:14:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-6117] mapreduce.RecordReader instance needs to be initialized</title>
                <link>https://issues.apache.org/jira/browse/HIVE-6117</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The HBase storage handler makes use of a mapreduce.RecordReader instance but does not initialize it when consumed from local context. This results in a NPE for some queries, for instance&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;create table hbase_1(key string, age int) stored by &apos;org.apache.hadoop.hive.hbase.HBaseStorageHandler&apos; with serdeproperties ( &quot;hbase.columns.mapping&quot; = &quot;info:age&quot;);
insert overwrite table hbase_1 select name, SUM(age) from studenttab10k group by name;
select * from hbase_1;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The select statement throws the following exception&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;13/12/18 01:30:32 ERROR CliDriver: Failed with exception java.io.IOException:java.lang.NullPointerException
java.io.IOException: java.lang.NullPointerException
at org.apache.hadoop.hive.ql.exec.FetchOperator.getNextRow(FetchOperator.java:551)
at org.apache.hadoop.hive.ql.exec.FetchOperator.pushRow(FetchOperator.java:489)
at org.apache.hadoop.hive.ql.exec.FetchTask.fetch(FetchTask.java:136)
at org.apache.hadoop.hive.ql.Driver.getResults(Driver.java:1494)
at org.apache.hadoop.hive.cli.CliDriver.processLocalCmd(CliDriver.java:271)
at org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:216)
at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:413)
at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:348)
at org.apache.hadoop.hive.cli.CliDriver.processReader(CliDriver.java:446)
at org.apache.hadoop.hive.cli.CliDriver.processFile(CliDriver.java:456)
at org.apache.hadoop.hive.cli.CliDriver.executeDriver(CliDriver.java:737)
at org.apache.hadoop.hive.cli.CliDriver.run(CliDriver.java:675)
at org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:614)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:601)
at org.apache.hadoop.util.RunJar.main(RunJar.java:212)
Caused by: java.lang.NullPointerException
at org.apache.hadoop.hbase.mapreduce.TableRecordReaderImpl.nextKeyValue(TableRecordReaderImpl.java:196)
at org.apache.hadoop.hbase.mapreduce.TableRecordReader.nextKeyValue(TableRecordReader.java:138)
at org.apache.hadoop.hive.hbase.HiveHBaseTableInputFormat$1.next(HiveHBaseTableInputFormat.java:234)
at org.apache.hadoop.hive.hbase.HiveHBaseTableInputFormat$1.next(HiveHBaseTableInputFormat.java:193)
at org.apache.hadoop.hive.ql.exec.FetchOperator.getNextRow(FetchOperator.java:521)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12686560">HIVE-6117</key>
            <summary>mapreduce.RecordReader instance needs to be initialized</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ndimiduk">Nick Dimiduk</assignee>
                                    <reporter username="ndimiduk">Nick Dimiduk</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Dec 2013 19:46:24 +0000</created>
                <updated>Mon, 30 Dec 2013 17:47:41 +0000</updated>
                            <resolved>Mon, 30 Dec 2013 14:54:23 +0000</resolved>
                                                    <fixVersion>0.13.0</fixVersion>
                                    <component>HBase Handler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13857681" author="ndimiduk" created="Fri, 27 Dec 2013 19:54:36 +0000"  >&lt;p&gt;Attaching patch for trunk.&lt;/p&gt;</comment>
                            <comment id="13857689" author="brocknoland" created="Fri, 27 Dec 2013 20:06:09 +0000"  >&lt;p&gt;Thanks Nick. Looks like this was caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9791&quot; title=&quot;MR initializes scanner twice&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9791&quot;&gt;&lt;del&gt;HBASE-9791&lt;/del&gt;&lt;/a&gt;. Was hive not correctly using the API or this an API change?&lt;/p&gt;</comment>
                            <comment id="13857697" author="ndimiduk" created="Fri, 27 Dec 2013 20:16:33 +0000"  >&lt;p&gt;Oh, good catch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brocknoland&quot; class=&quot;user-hover&quot; rel=&quot;brocknoland&quot;&gt;brocknoland&lt;/a&gt;. I think the responsibility lies with Hive because, in this case, the RecordReader is being consumed outside of the MapReduce Framework context. I don&apos;t know &lt;b&gt;where&lt;/b&gt; Hive should initialize the RecordReader &amp;#8211; my patch may result in a double-initialize for the mapreduce case, but corrects the problem for the local query. I think, somehow, processLocalCmd needs to indicate to HiveHBaseTableInputFormat that its RecordReader is being consumed outside of MapReduce. Perhaps you can advise?&lt;/p&gt;</comment>
                            <comment id="13857735" author="brocknoland" created="Fri, 27 Dec 2013 21:05:53 +0000"  >&lt;p&gt;Hmm, does this same error not occur during a MR run?&lt;/p&gt;</comment>
                            <comment id="13857747" author="ndimiduk" created="Fri, 27 Dec 2013 21:25:47 +0000"  >&lt;p&gt;Not sure; can I force the SELECT statement to run as a job?&lt;/p&gt;</comment>
                            <comment id="13857749" author="brocknoland" created="Fri, 27 Dec 2013 21:28:27 +0000"  >&lt;p&gt;SELECT count(&amp;#42;) from table&lt;/p&gt;</comment>
                            <comment id="13857758" author="ndimiduk" created="Fri, 27 Dec 2013 21:35:43 +0000"  >&lt;p&gt;SELECT count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; FROM hbase_1; gave me a MR job. It ran without complaint.&lt;/p&gt;</comment>
                            <comment id="13857762" author="brocknoland" created="Fri, 27 Dec 2013 21:39:20 +0000"  >&lt;p&gt;It ran correctly with or without the patch?&lt;/p&gt;</comment>
                            <comment id="13857763" author="ndimiduk" created="Fri, 27 Dec 2013 21:41:25 +0000"  >&lt;p&gt;Ran correctly with the patch.&lt;/p&gt;

&lt;p&gt;BuildBot should verify as well, yes?&lt;/p&gt;</comment>
                            <comment id="13857784" author="brocknoland" created="Fri, 27 Dec 2013 21:56:33 +0000"  >&lt;p&gt;Thanks Nick!  I have seen this error with MR + HBase trunk.&lt;/p&gt;

&lt;p&gt;As fair as I can tell we have not yet answered the question &quot;Was hive not correctly using the API or this an API change?&quot; I am fine making the change to Hive, but we should know if hive was simply using HBase incorrectly or if HBase is changing the API.&lt;/p&gt;

&lt;p&gt;Brock&lt;/p&gt;</comment>
                            <comment id="13857818" author="ndimiduk" created="Fri, 27 Dec 2013 22:54:05 +0000"  >&lt;p&gt;Technically speaking, HBase changed the way it initializes this particular MapReduce component via a public API, thus HBase&apos;s API has changed. Hive is consuming that component without respecting its API &amp;#8211; that is, Hadoop&apos;s mapreduce.RecordReader says the framework will call initialize, so Hive should be calling initialize when consuming it outside of the MapReduce Framework context. I think the answer is &quot;both&quot;. Perhaps &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9791&quot; title=&quot;MR initializes scanner twice&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9791&quot;&gt;&lt;del&gt;HBASE-9791&lt;/del&gt;&lt;/a&gt; needs to add a release note.&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;jxiang&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13858024" author="brocknoland" created="Sat, 28 Dec 2013 13:55:02 +0000"  >&lt;p&gt;Reuploading the exact same patch with a new file name so HiveQA will pick it up.&lt;/p&gt;</comment>
                            <comment id="13858025" author="brocknoland" created="Sat, 28 Dec 2013 13:57:40 +0000"  >&lt;p&gt;Thank you for clarifying. I am +1 if the tests pass.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Hadoop&apos;s mapreduce.RecordReader says the framework will call initialize,&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What&apos;s interesting is I have seen this same error occur within an MR job. Additionally we are doing some weird wrapping of RR here. Therefore I think it&apos;s likely that Hive should be calling initialize itself even in the MR case. I think this patch will in fact do this.&lt;/p&gt;</comment>
                            <comment id="13858201" author="hiveqa" created="Sun, 29 Dec 2013 01:04:03 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12620732/HIVE-6117.0.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12620732/HIVE-6117.0.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 4818 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/762/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/762/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/762/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/762/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12620732&lt;/p&gt;</comment>
                            <comment id="13858497" author="jxiang" created="Mon, 30 Dec 2013 00:47:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;ndimiduk&lt;/a&gt;, I think &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9791&quot; title=&quot;MR initializes scanner twice&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9791&quot;&gt;&lt;del&gt;HBASE-9791&lt;/del&gt;&lt;/a&gt; fixed a bug in HBase that does initialization twice. If some subclass needs to call initialization again, does this mean the fix in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9791&quot; title=&quot;MR initializes scanner twice&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9791&quot;&gt;&lt;del&gt;HBASE-9791&lt;/del&gt;&lt;/a&gt; is not right?  If it is right, why should HIVE need to call init again?&lt;/p&gt;</comment>
                            <comment id="13858837" author="brocknoland" created="Mon, 30 Dec 2013 14:43:07 +0000"  >&lt;p&gt;Hey guys,&lt;/p&gt;

&lt;p&gt;I think I see the issue here. o.a.h.mapreduce.RecordReader has an initialize method which is called by the mapper. o.a.h.mapred.RecordReader does not have an initialize method. Hive uses the mapred API so you can see here: &lt;a href=&quot;https://github.com/apache/hive/blob/fb63a28cd5fddb5e5c974cab84cd9c3a4155e40d/hbase-handler/src/java/org/apache/hadoop/hive/hbase/HiveHBaseTableInputFormat.java#L178&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/blob/fb63a28cd5fddb5e5c974cab84cd9c3a4155e40d/hbase-handler/src/java/org/apache/hadoop/hive/hbase/HiveHBaseTableInputFormat.java#L178&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;that we wrap the mapreduce RR from HBase in a mapred RR. Therefore it&apos;s hive&apos;s responsibility to call initialize which we are not doing. Therefore the patch looks correct and I will commit.&lt;/p&gt;</comment>
                            <comment id="13858845" author="brocknoland" created="Mon, 30 Dec 2013 14:52:52 +0000"  >&lt;p&gt;I also verified that this patch fixes the NPE I was seeing with &lt;b&gt;both&lt;/b&gt; select &amp;#42; from table (no-MR job) and select count(&amp;#42;) from table (MR job).&lt;/p&gt;</comment>
                            <comment id="13858846" author="brocknoland" created="Mon, 30 Dec 2013 14:54:23 +0000"  >&lt;p&gt;Committed to trunk! Thank you Nick and Jimmy for your help on this one!&lt;/p&gt;</comment>
                            <comment id="13858955" author="ndimiduk" created="Mon, 30 Dec 2013 17:47:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;that we wrap the mapreduce RR from HBase in a mapred RR. Therefore it&apos;s hive&apos;s responsibility to call initialize which we are not doing. Therefore the patch looks correct and I will commit.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, that&apos;s my understanding too. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brocknoland&quot; class=&quot;user-hover&quot; rel=&quot;brocknoland&quot;&gt;brocknoland&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;jxiang&lt;/a&gt; for the context and quick response!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12674338">HBASE-9791</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12620641" name="6117.00.patch" size="807" author="ndimiduk" created="Fri, 27 Dec 2013 19:54:36 +0000"/>
                            <attachment id="12620732" name="HIVE-6117.0.patch" size="807" author="brocknoland" created="Sat, 28 Dec 2013 13:55:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>365551</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 47 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1r0fz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>365859</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>