<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:45:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-13991] Union All on view fail with no valid permission on underneath table</title>
                <link>https://issues.apache.org/jira/browse/HIVE-13991</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;When sentry is enabled. &lt;br/&gt;
create view V as select * from T;&lt;br/&gt;
When the user has read permission on view V, but does not have read permission on table T,&lt;/p&gt;

&lt;p&gt;select * from V union all select * from V &lt;br/&gt;
failed with:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;0: jdbc:hive2://********&amp;gt; select * from s07view union all select * from s07view limit 1;
Error: Error while compiling statement: FAILED: SemanticException No valid privileges
 Required privileges for this query: Server=server1-&amp;gt;Db=default-&amp;gt;Table=sample_07-&amp;gt;action=select; (state=42000,code=40000)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; </description>
                <environment></environment>
        <key id="12977464">HIVE-13991</key>
            <summary>Union All on view fail with no valid permission on underneath table</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ychena">Yongzhi Chen</assignee>
                                    <reporter username="ychena">Yongzhi Chen</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Jun 2016 01:43:23 +0000</created>
                <updated>Thu, 8 Dec 2016 14:39:10 +0000</updated>
                            <resolved>Mon, 27 Jun 2016 15:50:08 +0000</resolved>
                                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.1.1</fixVersion>
                    <fixVersion>2.2.0</fixVersion>
                                    <component>Query Planning</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15323765" author="ychena" created="Fri, 10 Jun 2016 02:44:00 +0000"  >&lt;p&gt;There are inconsistent key values between put and get operations for map viewAliasToInput&lt;br/&gt;
In &lt;br/&gt;
private void getMetaData(QB qb, ReadEntity parentInput) method:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        // This is the last time we&apos;ll see the Table objects for views, so add it to the inputs
        // now. isInsideView will tell if this view is embedded in another view.
        ReadEntity viewInput = new ReadEntity(tab, parentInput, !qb.isInsideView());
        viewInput = PlanUtils.addInput(inputs, viewInput);
        aliasToViewInfo.put(alias, new ObjectPair&amp;lt;String, ReadEntity&amp;gt;(fullViewName, viewInput));
        viewAliasToInput.put(getAliasId(alias, qb), viewInput);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The key is getAliasId(alias, qb), the key is non-processed alias ID, for the union all case, it looks like&lt;br/&gt;
null-subquery1:_u1-subquery1:viewsrc&lt;/p&gt;

&lt;p&gt;But in method getParentViewInfo, alias ID is processed before get from the map. The alias ID replace subquery1 to empty, the key&lt;br/&gt;
looks like following:&lt;br/&gt;
null:_u1:viewsrc&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;public static ReadEntity getParentViewInfo(String alias_id,
      Map&amp;lt;String, ReadEntity&amp;gt; viewAliasToInput) {
    String[] aliases = alias_id.split(&quot;:&quot;);

    String currentAlias = null;
    ReadEntity currentInput = null;
    // Find the immediate parent possible.
    // For eg: for a query like &apos;select * from V3&apos;, where V3 -&amp;gt; V2, V2 -&amp;gt; V1, V1 -&amp;gt; T
    // -&amp;gt; implies depends on.
    // T&apos;s parent would be V1
    for (int pos = 0; pos &amp;lt; aliases.length; pos++) {
      currentAlias = currentAlias == null ? aliases[pos] : currentAlias + &quot;:&quot; + aliases[pos];

      currentAlias = currentAlias.replace(SemanticAnalyzer.SUBQUERY_TAG_1, &quot;&quot;)
          .replace(SemanticAnalyzer.SUBQUERY_TAG_2, &quot;&quot;);
      ReadEntity input = viewAliasToInput.get(currentAlias);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This inconsistence causes getParentViewInfo return null.&lt;br/&gt;
Attach the patch to fix the issue. &lt;/p&gt;</comment>
                            <comment id="15323766" author="ychena" created="Fri, 10 Jun 2016 02:45:20 +0000"  >&lt;p&gt;Need code review.&lt;/p&gt;</comment>
                            <comment id="15325746" author="hiveqa" created="Sat, 11 Jun 2016 06:18:12 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12809349/HIVE-13991.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12809349/HIVE-13991.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 8 failed/errored test(s), 10223 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_acid_globallimit
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_13
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_list_bucket
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_multiinsert
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_constprog_partitioner
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_index_bitmap3
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_schemeAuthority
org.apache.hadoop.hive.ql.plan.TestReadEntityDirect.testSelectEntityViewDirectUnion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/82/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/82/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/82/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/82/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-82/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-82/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 8 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12809349 - PreCommit-HIVE-MASTER-Build&lt;/p&gt;</comment>
                            <comment id="15326716" author="ychena" created="Mon, 13 Jun 2016 00:49:04 +0000"  >&lt;p&gt;Second patch working on the case &lt;br/&gt;
select * from view union all select * from table&lt;br/&gt;
Fix test failure of:&lt;br/&gt;
org.apache.hadoop.hive.ql.plan.TestReadEntityDirect.testSelectEntityViewDirectUnion&lt;/p&gt;

&lt;p&gt;It treats the ReadEntity created during genResolvedParseTree&lt;br/&gt;
differently: process its isDirect flag even ReadEntity does not have parents. &lt;/p&gt;</comment>
                            <comment id="15326763" author="hiveqa" created="Mon, 13 Jun 2016 03:11:29 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12809736/HIVE-13991.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12809736/HIVE-13991.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 7 failed/errored test(s), 10224 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_acid_globallimit
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_12
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_13
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_list_bucket
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_multiinsert
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_index_bitmap3
org.apache.hadoop.hive.ql.TestTxnCommands.testSimpleAcidInsert
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/103/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/103/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/103/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/103/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-103/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-103/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 7 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12809736 - PreCommit-HIVE-MASTER-Build&lt;/p&gt;</comment>
                            <comment id="15327375" author="ychena" created="Mon, 13 Jun 2016 13:35:20 +0000"  >&lt;p&gt;The failures are not related.&lt;/p&gt;</comment>
                            <comment id="15346513" author="ychena" created="Thu, 23 Jun 2016 14:30:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aihuaxu&quot; class=&quot;user-hover&quot; rel=&quot;aihuaxu&quot;&gt;aihuaxu&lt;/a&gt;, how about the review? Thanks&lt;br/&gt;
From following analyzeInternal code, there are many step in the analyze:&lt;br/&gt;
First step is generate resolved parse tree, second step is Generate Op tree...&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;void analyzeInternal(ASTNode ast, PlannerContext plannerCtx) throws SemanticException {
    // 1. Generate Resolved Parse tree from syntax tree
    LOG.info(&quot;Starting Semantic Analysis&quot;);
    if (!genResolvedParseTree(ast, plannerCtx)) {
      return;
    }

    // 2. Gen OP Tree from resolved Parse Tree
    Operator sinkOp = genOPTree(ast, plannerCtx);

    // 3. Deduce Resultset Schema
    if (createVwDesc != null) {
      resultSchema = convertRowSchemaToViewSchema(opParseCtx.get(sinkOp).getRowResolver());
    } else {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Only ReadEntities generated during genResolvedParseTree are directly related to the query and should be used by sentry to check permissions. And ,in this step, the ReadEntity without parents should be treated as ReadEntity with direct reference to table and should be merged with ReadEntity with same name. ReadEntity generated in other steps is for intermediate node and partially calculated without view&apos;s information, so these ReadEntity should not be merged if isDirect is true if without parents. mergeIsDirect is used to tell first step from other steps.&lt;/p&gt;</comment>
                            <comment id="15346618" author="aihuaxu" created="Thu, 23 Jun 2016 15:34:42 +0000"  >&lt;p&gt;OK. That makes more sense. So will you change the code to differentiate the calls based on them, like from genResolvedParseTree()  you will do merge, or you keep the same code just with a better explanation? Maybe find a more reasonable way to set mergeIsDirect?&lt;/p&gt;
</comment>
                            <comment id="15348278" author="ychena" created="Fri, 24 Jun 2016 13:42:12 +0000"  >&lt;p&gt;init(true); combined with genResolvedParseTree() do the step one work, so assign mergeIsDirect in init(boolean) is fine. You can think it is the same reason as clear pruned partitions or not.&lt;br/&gt;
There are only two places in our code that calls genResolvedParseTree() , list it may help you understand the code:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;          if (reAnalyzeAST) {
            init(true);
            prunedPartitions.clear();
            // Assumption: At this point Parse Tree gen &amp;amp; resolution will always
            // be true (since we started out that way).
            super.genResolvedParseTree(ast, new PlannerContext());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15348284" author="aihuaxu" created="Fri, 24 Jun 2016 13:45:15 +0000"  >&lt;p&gt;Thanks for the explanation. I can&apos;t think of a better way. Maybe add a little comments when you commit on that line to set mergeIsDirect.&lt;/p&gt;

&lt;p&gt;+1.&lt;/p&gt;</comment>
                            <comment id="15351284" author="ychena" created="Mon, 27 Jun 2016 15:50:09 +0000"  >&lt;p&gt;Thanks Aihua for the review, committed to master and branch-2.1&lt;/p&gt;</comment>
                            <comment id="15399830" author="ekoifman" created="Fri, 29 Jul 2016 18:39:07 +0000"  >&lt;p&gt;back ported to branch-1 &lt;a href=&quot;https://github.com/apache/hive/commit/123f088a3a029c4b01db3e7cc0769a5836e1f6c6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/commit/123f088a3a029c4b01db3e7cc0769a5836e1f6c6&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12989716">HIVE-14248</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12809349" name="HIVE-13991.1.patch" size="2694" author="ychena" created="Fri, 10 Jun 2016 02:44:40 +0000"/>
                            <attachment id="12809736" name="HIVE-13991.2.patch" size="6040" author="ychena" created="Mon, 13 Jun 2016 00:49:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 16 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2z9hr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>