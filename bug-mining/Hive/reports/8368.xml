<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:23:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-26633] Make thrift max message size configurable</title>
                <link>https://issues.apache.org/jira/browse/HIVE-26633</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Since thrift &amp;gt;= 0.14, thrift now enforces max message sizes through a TConfiguration object as described here:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/thrift/blob/master/doc/specs/thrift-tconfiguration.md&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/blob/master/doc/specs/thrift-tconfiguration.md&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;By default MaxMessageSize gets set to 100MB.&lt;/p&gt;

&lt;p&gt;As a result it is possible for HMS clients not to be able to retrieve certain metadata for tables with a large amount of partitions or other metadata.&lt;/p&gt;

&lt;p&gt;For example on a cluster configured with kerberos between hs2 and hms, querying a large table (10k partitions, 200 columns with names of 200 characters) results in this backtrace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.thrift.transport.TTransportException: MaxMessageSize reached
at org.apache.thrift.transport.TEndpointTransport.countConsumedMessageBytes(TEndpointTransport.java:96)&#160;
at org.apache.thrift.transport.TMemoryInputTransport.read(TMemoryInputTransport.java:97)&#160;
at org.apache.thrift.transport.TSaslTransport.read(TSaslTransport.java:390)&#160;
at org.apache.thrift.transport.TSaslClientTransport.read(TSaslClientTransport.java:39)&#160;
at org.apache.thrift.transport.TTransport.readAll(TTransport.java:109)&#160;
at org.apache.hadoop.hive.metastore.security.TFilterTransport.readAll(TFilterTransport.java:63)&#160;
at org.apache.thrift.protocol.TBinaryProtocol.readAll(TBinaryProtocol.java:464)&#160;
at org.apache.thrift.protocol.TBinaryProtocol.readByte(TBinaryProtocol.java:329)&#160;
at org.apache.thrift.protocol.TBinaryProtocol.readFieldBegin(TBinaryProtocol.java:273)&#160;
at org.apache.hadoop.hive.metastore.api.FieldSchema$FieldSchemaStandardScheme.read(FieldSchema.java:461)&#160;
at org.apache.hadoop.hive.metastore.api.FieldSchema$FieldSchemaStandardScheme.read(FieldSchema.java:454)&#160;
at org.apache.hadoop.hive.metastore.api.FieldSchema.read(FieldSchema.java:388)&#160;
at org.apache.hadoop.hive.metastore.api.StorageDescriptor$StorageDescriptorStandardScheme.read(StorageDescriptor.java:1269)&#160;
at org.apache.hadoop.hive.metastore.api.StorageDescriptor$StorageDescriptorStandardScheme.read(StorageDescriptor.java:1248)&#160;
at org.apache.hadoop.hive.metastore.api.StorageDescriptor.read(StorageDescriptor.java:1110)&#160;
at org.apache.hadoop.hive.metastore.api.Partition$PartitionStandardScheme.read(Partition.java:1270)&#160;
at org.apache.hadoop.hive.metastore.api.Partition$PartitionStandardScheme.read(Partition.java:1205)&#160;
at org.apache.hadoop.hive.metastore.api.Partition.read(Partition.java:1062)&#160;
at org.apache.hadoop.hive.metastore.api.PartitionsByExprResult$PartitionsByExprResultStandardScheme.read(PartitionsByExprResult.java:420)&#160;
at org.apache.hadoop.hive.metastore.api.PartitionsByExprResult$PartitionsByExprResultStandardScheme.read(PartitionsByExprResult.java:399)&#160;
at org.apache.hadoop.hive.metastore.api.PartitionsByExprResult.read(PartitionsByExprResult.java:335)&#160;
at org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$get_partitions_by_expr_result$get_partitions_by_expr_resultStandardScheme.read(ThriftHiveMetastore.java)&#160; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Making this configurable (and defaulting to a higher value) would allow these tables to still be accessible.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13486467">HIVE-26633</key>
            <summary>Make thrift max message size configurable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jfs">John Sherman</assignee>
                                    <reporter username="jfs">John Sherman</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sat, 15 Oct 2022 21:48:20 +0000</created>
                <updated>Mon, 2 Sep 2024 07:25:34 +0000</updated>
                            <resolved>Thu, 20 Oct 2022 03:10:35 +0000</resolved>
                                    <version>4.0.0-alpha-2</version>
                                    <fixVersion>4.0.0-alpha-2</fixVersion>
                                    <component>HiveServer2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="17400">4h 50m</timespent>
                                <comments>
                            <comment id="17618333" author="jfs" created="Sun, 16 Oct 2022 20:13:27 +0000"  >&lt;p&gt;I&apos;ve added a WIP patch that makes it configurable via HiveConf and JdbcConf.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/hive/pull/3674&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/pull/3674&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;One issue is that there seems to be no way to provide a different TConfiguration object for SSL connections.&lt;br/&gt;
Hive uses &lt;a href=&quot;https://github.com/apache/thrift/blob/9207b28b7df5f8e01960154971e8de07094c91a8/lib/java/src/main/java/org/apache/thrift/transport/TSSLTransportFactory.java#L290&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/blob/9207b28b7df5f8e01960154971e8de07094c91a8/lib/java/src/main/java/org/apache/thrift/transport/TSSLTransportFactory.java#L290&lt;/a&gt;&lt;br/&gt;
which does a &quot;new TSocket(socket)&quot;.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/thrift/blob/9207b28b7df5f8e01960154971e8de07094c91a8/lib/java/src/main/java/org/apache/thrift/transport/TSocket.java#L58&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/blob/9207b28b7df5f8e01960154971e8de07094c91a8/lib/java/src/main/java/org/apache/thrift/transport/TSocket.java#L58&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I have not had a chance to test with SSL enabled. I will try to get that done. We may need follow up work for this.&lt;/p&gt;

&lt;p&gt;Another interesting observation - this enforcement doesn&apos;t get hit without SASL and/maybe SSL enabled. I would expect the limit by Thrift to be enforced unilaterally.&lt;/p&gt;</comment>
                            <comment id="17620693" author="dengzh" created="Thu, 20 Oct 2022 03:10:35 +0000"  >&lt;p&gt;Merged into master. Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jfs&quot; class=&quot;user-hover&quot; rel=&quot;jfs&quot;&gt;jfs&lt;/a&gt; for the contribution and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=amansinha&quot; class=&quot;user-hover&quot; rel=&quot;amansinha&quot;&gt;amansinha&lt;/a&gt; for the review!&lt;/p&gt;</comment>
                            <comment id="17621161" author="jfs" created="Thu, 20 Oct 2022 14:34:09 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dengzh&quot; class=&quot;user-hover&quot; rel=&quot;dengzh&quot;&gt;dengzh&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;Looping around to add some more detail to the JIRA (just in case someone runs across this issue).&lt;br/&gt;
This patch added &quot;hive.thrift.client.max.message.size&quot; to make the limit configurable for both SSL and SASL (there was concerns in my last comment I wouldn&apos;t be able to fix SSL paths, but the patch was re-worked to fix those paths too).&lt;br/&gt;
I picked a larger default of 1gb vs 100mb internal thrift default, so hopefully very few installations would need to ever adjust the above setting.&lt;/p&gt;</comment>
                            <comment id="17622071" author="zabetak" created="Fri, 21 Oct 2022 07:45:38 +0000"  >&lt;p&gt;The ticket is marked as resolved for 4.0.0 but we are currently underway of releasing 4.0.0-alpha-2 so I changed the fixVersion accordingly; If that is not accurate please update the fixVersion accordingly.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13407859">HIVE-25635</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13590708">SPARK-49489</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 3 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z19ebk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12351489">4.0.0-alpha-2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>