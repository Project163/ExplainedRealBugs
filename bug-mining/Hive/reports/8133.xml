<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:21:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-21075] Metastore: Drop partition performance downgrade with Postgres DB</title>
                <link>https://issues.apache.org/jira/browse/HIVE-21075</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;In order to workaround oracle not supporting limit statement caused performance issue, &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-9447&quot; title=&quot;Metastore: inefficient Oracle query for removing unused column descriptors when add/drop table/partition&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-9447&quot;&gt;&lt;del&gt;HIVE-9447&lt;/del&gt;&lt;/a&gt; makes all the backend DB run select count(1) from SDS where SDS.CD_ID=? to check if the specific CD_ID is referenced in SDS table before drop a partition. This select count(1) statement does not scale well in Postgres, and there is no index for CD_ID column in SDS table.&lt;br/&gt;
For a SDS table with with 1.5 million rows, select count(1) has average 700ms without index, while in 10-20ms with index. But the statement before &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-9447&quot; title=&quot;Metastore: inefficient Oracle query for removing unused column descriptors when add/drop table/partition&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-9447&quot;&gt;&lt;del&gt;HIVE-9447&lt;/del&gt;&lt;/a&gt;( SELECT * FROM &quot;SDS&quot; &quot;A0&quot; WHERE &quot;A0&quot;.&quot;CD_ID&quot; = $1 limit 1) uses less than 10ms .&lt;/p&gt;</description>
                <environment></environment>
        <key id="13206803">HIVE-21075</key>
            <summary>Metastore: Drop partition performance downgrade with Postgres DB</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="osayankin">Oleksiy Sayankin</assignee>
                                    <reporter username="ychena">Yongzhi Chen</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 28 Dec 2018 11:21:39 +0000</created>
                <updated>Thu, 17 Nov 2022 08:54:23 +0000</updated>
                            <resolved>Thu, 2 Dec 2021 13:25:09 +0000</resolved>
                                    <version>3.0.0</version>
                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="28200">7h 50m</timespent>
                                <comments>
                            <comment id="16730383" author="karthik.manamcheri" created="Fri, 28 Dec 2018 17:07:34 +0000"  >&lt;p&gt;Could we add the index on CD_ID column? Any reason why we don&apos;t have an index on that? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pvary&quot; class=&quot;user-hover&quot; rel=&quot;pvary&quot;&gt;pvary&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;ychena&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="16730691" author="ychena" created="Sat, 29 Dec 2018 13:16:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=karthik.manamcheri&quot; class=&quot;user-hover&quot; rel=&quot;karthik.manamcheri&quot;&gt;karthik.manamcheri&lt;/a&gt;, we can add the index, but adding the index alone can not speed up the count(1) query fast enough to match the performance of query SELECT * FROM &quot;SDS&quot; &quot;A0&quot; WHERE &quot;A0&quot;.&quot;CD_ID&quot; = $1 limit 1 .&lt;/p&gt;</comment>
                            <comment id="16731601" author="pvary" created="Tue, 1 Jan 2019 14:04:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=karthik.manamcheri&quot; class=&quot;user-hover&quot; rel=&quot;karthik.manamcheri&quot;&gt;karthik.manamcheri&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;ychena&lt;/a&gt; Sorry for my fast respons which I posted before reading the whole context. New years mailbox cleanup... maybe the only relevant part: Please keep this in mind when testing solutions. Seemingly small changes in CD related queries can multiply when having big number of existing partitions.&lt;/p&gt;</comment>
                            <comment id="17351720" author="osayankin" created="Wed, 26 May 2021 11:21:41 +0000"  >&lt;p&gt;Created &lt;a href=&quot;https://github.com/apache/hive/pull/2323&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Solution is simple:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isPostgres()){
&lt;span class=&quot;code-comment&quot;&gt;// use SELECT * FROM &lt;span class=&quot;code-quote&quot;&gt;&quot;SDS&quot;&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;A0&quot;&lt;/span&gt; WHERE &lt;span class=&quot;code-quote&quot;&gt;&quot;A0&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;CD_ID&quot;&lt;/span&gt; = $1 limit 1
&lt;/span&gt;} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
&lt;span class=&quot;code-comment&quot;&gt;// use select count(1) from org.apache.hadoop.hive.metastore.model.MStorageDescriptor where (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cd == inCD)
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="13414825">HIVE-25757</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12769491">HIVE-9447</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13026061" name="HIVE-21075.2.patch" size="5761" author="osayankin" created="Thu, 27 May 2021 13:42:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 25 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|u00dao:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>