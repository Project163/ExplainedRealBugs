<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:25:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-7800] Parquet Column Index Access Schema Size Checking</title>
                <link>https://issues.apache.org/jira/browse/HIVE-7800</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;In the case that a parquet formatted table has partitions where the files have different size schema, using column index access can result in an index out of bounds exception.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12735437">HIVE-7800</key>
            <summary>Parquet Column Index Access Schema Size Checking</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dweeks-netflix">Daniel Weeks</assignee>
                                    <reporter username="dweeks-netflix">Daniel Weeks</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Aug 2014 15:59:23 +0000</created>
                <updated>Wed, 25 Mar 2015 03:01:26 +0000</updated>
                            <resolved>Mon, 6 Oct 2014 20:00:43 +0000</resolved>
                                    <version>0.14.0</version>
                                    <fixVersion>0.14.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="14104075" author="dweeks-netflix" created="Wed, 20 Aug 2014 16:05:06 +0000"  >&lt;p&gt;Included patch is a trivial fix that simply checks for both the existence of the column in the parquet file as well as checking the column index position to make sure the file contains such a position.&lt;/p&gt;

&lt;p&gt;In the event the check fails, the column is not included and null values are produced for the missing column, which is the expected behavior.&lt;/p&gt;</comment>
                            <comment id="14104705" author="hiveqa" created="Wed, 20 Aug 2014 22:24:56 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12663141/HIVE-7800.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12663141/HIVE-7800.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 6096 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_udaf_histogram_numeric
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_dynpart_sort_opt_vectorization
org.apache.hive.jdbc.miniHS2.TestHiveServer2.testConnection
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/420/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/420/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/420/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/420/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-420/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-420/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12663141&lt;/p&gt;</comment>
                            <comment id="14106242" author="dweeks-netflix" created="Fri, 22 Aug 2014 00:32:43 +0000"  >&lt;p&gt;Working on one other issue, so pulling this back for now.&lt;/p&gt;</comment>
                            <comment id="14108196" author="dweeks-netflix" created="Sat, 23 Aug 2014 23:40:19 +0000"  >&lt;p&gt;Updated patch provides exact schema size as table which is expected by the inputformat&lt;/p&gt;</comment>
                            <comment id="14108198" author="dweeks-netflix" created="Sat, 23 Aug 2014 23:43:59 +0000"  >&lt;p&gt;The previous implementation had an issue that is only triggered in rare cases where the first split of a task does not contain a row group.  This forces the initialization of the value of the input format to be the size of the table (ArrayWritable), but the next row group will produce a value only as wide the columns available in the file.&lt;/p&gt;

&lt;p&gt;The new patch pads the resolved schema to ensure a matching size and masks the name of the column so there no possibility of conflict with named columns within the file.&lt;/p&gt;</comment>
                            <comment id="14108199" author="dweeks-netflix" created="Sat, 23 Aug 2014 23:44:36 +0000"  >&lt;p&gt;Updated patch to address a rare split case.&lt;/p&gt;</comment>
                            <comment id="14108215" author="hiveqa" created="Sun, 24 Aug 2014 01:18:33 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12663887/HIVE-7800.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12663887/HIVE-7800.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 2 failed/errored test(s), 6118 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_dynpart_sort_opt_vectorization
org.apache.hive.jdbc.miniHS2.TestHiveServer2.testConnection
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/477/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/477/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/477/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/477/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-477/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-477/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12663887&lt;/p&gt;</comment>
                            <comment id="14152146" author="vikram.dixit" created="Mon, 29 Sep 2014 19:40:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dweeks-netflix&quot; class=&quot;user-hover&quot; rel=&quot;dweeks-netflix&quot;&gt;dweeks-netflix&lt;/a&gt; Can you please rebase this patch? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt; could you perhaps review this or do you know someone who could?&lt;/p&gt;</comment>
                            <comment id="14152172" author="dweeks-netflix" created="Mon, 29 Sep 2014 19:59:20 +0000"  >&lt;p&gt;I pulled the original patch because the implementation changed.  I believe &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brocknoland&quot; class=&quot;user-hover&quot; rel=&quot;brocknoland&quot;&gt;brocknoland&lt;/a&gt; made some changes and I&apos;ll need to rewrite this to accommodate.&lt;/p&gt;

&lt;p&gt;I&apos;ll get an updated patch.&lt;/p&gt;</comment>
                            <comment id="14152184" author="brocknoland" created="Mon, 29 Sep 2014 20:08:15 +0000"  >&lt;p&gt;This looks good to me. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dweeks-netflix&quot; class=&quot;user-hover&quot; rel=&quot;dweeks-netflix&quot;&gt;dweeks-netflix&lt;/a&gt; can we add a .q file test to ensure we don&apos;t regress?&lt;/p&gt;</comment>
                            <comment id="14152185" author="brocknoland" created="Mon, 29 Sep 2014 20:08:47 +0000"  >&lt;p&gt;Linking to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-8120&quot; title=&quot;Umbrella JIRA tracking Parquet improvements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-8120&quot;&gt;HIVE-8120&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14155444" author="dweeks-netflix" created="Wed, 1 Oct 2014 20:27:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brocknoland&quot; class=&quot;user-hover&quot; rel=&quot;brocknoland&quot;&gt;brocknoland&lt;/a&gt;  The most recent patch isn&apos;t sufficient.  I have a patch that moves the logic into the init method, but it was written against parquet-hive which is now significantly different than the current hive implementation.  I need to update this patch to reflect those changes. &lt;/p&gt;</comment>
                            <comment id="14158589" author="dweeks-netflix" created="Fri, 3 Oct 2014 22:04:15 +0000"  >&lt;p&gt;Updated patch that resolves index access issues.&lt;/p&gt;</comment>
                            <comment id="14158594" author="dweeks-netflix" created="Fri, 3 Oct 2014 22:10:14 +0000"  >&lt;p&gt;This patch actually resolves a few different issues:&lt;/p&gt;

&lt;p&gt;1) If the file schema size and table schema size differ across partitions, it no longer throws an index out of bounds.&lt;br/&gt;
2) There was an odd case where if the calculated input splits resulted in a mapper not processing the first split (due to the row group boundary checking), the array writable used to back the materialized rows would be initialized as the full table length as opposed to projected column length.  In the column index access case this caused problems due to not being able to handle that case.&lt;br/&gt;
3) There was a check included previously that didn&apos;t allow the file schema to vary from the table schema (i.e. could not request a column that doesn&apos;t exist in the underlying file).  This doesn&apos;t allow for schema evolution and was removed.  Columns missing from the file schema should be null padded in the final result. &lt;/p&gt;</comment>
                            <comment id="14158599" author="dweeks-netflix" created="Fri, 3 Oct 2014 22:12:55 +0000"  >&lt;p&gt;One more in the list&lt;/p&gt;

&lt;p&gt;4) Certain operations (group by + order by) lose the hive schema in the configuration, so the table information isn&apos;t available in the &apos;prepareForRead&apos; and column index access resolution didn&apos;t work.&lt;/p&gt;</comment>
                            <comment id="14159152" author="hiveqa" created="Sat, 4 Oct 2014 15:06:27 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12672847/HIVE-7800.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12672847/HIVE-7800.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 6538 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1113/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1113/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1113/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1113/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-1113/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-1113/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12672847&lt;/p&gt;</comment>
                            <comment id="14159348" author="brocknoland" created="Sat, 4 Oct 2014 23:30:58 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14160844" author="brocknoland" created="Mon, 6 Oct 2014 20:00:43 +0000"  >&lt;p&gt;Thank you so much Daniel! I have committed this to trunk.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vikram.dixit&quot; class=&quot;user-hover&quot; rel=&quot;vikram.dixit&quot;&gt;vikram.dixit&lt;/a&gt; could we get this into 0.14?&lt;/p&gt;</comment>
                            <comment id="14186386" author="hagleitn" created="Tue, 28 Oct 2014 05:21:51 +0000"  >&lt;p&gt;+1 for 0.14. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brocknoland&quot; class=&quot;user-hover&quot; rel=&quot;brocknoland&quot;&gt;brocknoland&lt;/a&gt; can you commit to the branch?&lt;/p&gt;</comment>
                            <comment id="14188499" author="brocknoland" created="Wed, 29 Oct 2014 16:05:52 +0000"  >&lt;p&gt;Thank you! I merged to 0.14.&lt;/p&gt;</comment>
                            <comment id="14211167" author="thejas" created="Thu, 13 Nov 2014 19:44:27 +0000"  >&lt;p&gt;This has been fixed in 0.14 release. Please open new jira if you see any issues.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12741673">HIVE-8120</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12785394">HIVE-10079</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12663141" name="HIVE-7800.1.patch" size="1163" author="dweeks-netflix" created="Wed, 20 Aug 2014 16:05:46 +0000"/>
                            <attachment id="12663887" name="HIVE-7800.2.patch" size="1257" author="dweeks-netflix" created="Sat, 23 Aug 2014 23:40:19 +0000"/>
                            <attachment id="12672847" name="HIVE-7800.3.patch" size="5655" author="dweeks-netflix" created="Fri, 3 Oct 2014 22:04:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1z4wf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Parquet</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>