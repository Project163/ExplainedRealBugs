<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:43:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-11427] Location of temporary table for CREATE TABLE  SELECT broken by HIVE-7079</title>
                <link>https://issues.apache.org/jira/browse/HIVE-11427</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;If a user &lt;em&gt;does not&lt;/em&gt; have HDFS write permissions to the &lt;em&gt;default&lt;/em&gt; database, and attempts to create a table in a &lt;em&gt;private&lt;/em&gt; database to which the user &lt;em&gt;does&lt;/em&gt; have permissions using CREATE TABLE AS SELECT from a table in the default database, the following happens:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
use &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;;
create table grisha.blahblah as select * from some_table;
FAILED: SemanticException 0:0 Error creating temporary folder on: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//nn.example.com/user/hive/warehouse. Error encountered near token &apos;TOK_TMP_FILE&#8217;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I&apos;ve edited this issue because my initial explanation was completely bogus. A more likely explanation is in &lt;a href=&quot;https://github.com/apache/hive/commit/1614314ef7bd0c3b8527ee32a434ababf7711278&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/commit/1614314ef7bd0c3b8527ee32a434ababf7711278&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 -                fname = ctx.getExternalTmpPath(
 +                fname = ctx.getExtTmpPathRelTo(  
    &lt;span class=&quot;code-comment&quot;&gt;// and then something incorrect happens in getExtTmpPathRelTo()&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In any event - the bug is that the location chosen for the temporary storage is not in the same place as the target table. It should be same as the target table (/user/hive/warehouse/grisha.db in the above example) because this is where presumably the user running the query would have write permissions to.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12850670">HIVE-11427</key>
            <summary>Location of temporary table for CREATE TABLE  SELECT broken by HIVE-7079</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ychena">Yongzhi Chen</assignee>
                                    <reporter username="grisha">Gregory Trubetskoy</reporter>
                        <labels>
                    </labels>
                <created>Fri, 31 Jul 2015 18:26:36 +0000</created>
                <updated>Sun, 19 Jan 2020 11:26:15 +0000</updated>
                            <resolved>Sun, 17 Apr 2016 05:54:17 +0000</resolved>
                                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15237613" author="ychena" created="Tue, 12 Apr 2016 17:42:14 +0000"  >&lt;p&gt;TOK_TMP_FILE does not have a database before it, so Utilities.getDbTableName provide current working db as its db which is not right for CTAS.&lt;br/&gt;
Should use the database where the table to be created belongs to.&lt;br/&gt;
Attach patch for the fix.&lt;/p&gt;</comment>
                            <comment id="15237618" author="ychena" created="Tue, 12 Apr 2016 17:43:43 +0000"  >&lt;p&gt;Need code review.&lt;/p&gt;</comment>
                            <comment id="15238114" author="hiveqa" created="Tue, 12 Apr 2016 22:25:47 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12798319/HIVE-11427.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12798319/HIVE-11427.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 9974 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestJdbcWithMiniHS2 - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auto_mult_tables
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_index_bitmap3
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/7567/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/7567/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/7567/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/7567/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-7567/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-7567/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12798319 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="15239211" author="ychena" created="Wed, 13 Apr 2016 13:14:53 +0000"  >&lt;p&gt;The failures are not related.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt;, could you review the change? Thanks. I manually tested the fix in a cluster. &lt;/p&gt;</comment>
                            <comment id="15239350" author="spena" created="Wed, 13 Apr 2016 14:40:39 +0000"  >&lt;p&gt;The patch looks good and simple.&lt;br/&gt;
Could you verify and/or add a test case when HDFS encryption is enabled? There are a few &lt;tt&gt;encryption_*.q&lt;/tt&gt; files you can use to see examples about it.&lt;/p&gt;

&lt;p&gt;I wonder what we should do if a user is attempting to create a table (non-encrypted) from an encrypted table. If the encrypted table has sensitive information, such as SSN, then they will be able to copy the data and stored without encryption in the target location?&lt;/p&gt;</comment>
                            <comment id="15240314" author="ychena" created="Thu, 14 Apr 2016 00:26:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt;, I attached the second patch with an encryption test.&lt;/p&gt;</comment>
                            <comment id="15241248" author="ychena" created="Thu, 14 Apr 2016 14:27:22 +0000"  >&lt;p&gt;CTAS function like create a table then do insert with select statement from other tables. I think if the data can be returned to select statement, it will be inserted to the destination table. So user should make sure the destination table is encrypted too. &lt;/p&gt;</comment>
                            <comment id="15241345" author="spena" created="Thu, 14 Apr 2016 15:19:38 +0000"  >&lt;p&gt;What if the destination table is not encrypted? Should we fail running the CTAS command?&lt;br/&gt;
I don&apos;t remember if we have that validation with INSERT ... SELECT. &lt;/p&gt;</comment>
                            <comment id="15241597" author="ychena" created="Thu, 14 Apr 2016 17:50:03 +0000"  >&lt;p&gt;I do not know. It should not be related to this jira, this jira just use the destination database&apos;s resource as the tmp storage and the tmp storage will be deleted after at the end of the CTAS. It does not affect how the final data is stored. &lt;br/&gt;
And I think Insert &amp;#8212; select may not so strict, for example, how do we handle select with several tables joins, some encrypted, some not? We may create a different jira for the encryption issue. &lt;/p&gt;</comment>
                            <comment id="15241787" author="spena" created="Thu, 14 Apr 2016 19:44:39 +0000"  >&lt;p&gt;You&apos;re right. At the end, the security issue was still there before.&lt;br/&gt;
So the code looks right.&lt;br/&gt;
+1&lt;/p&gt;

&lt;p&gt;Let&apos;s wait for tests before doing the commit.&lt;/p&gt;</comment>
                            <comment id="15244103" author="hiveqa" created="Sat, 16 Apr 2016 09:00:06 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12798617/HIVE-11427.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12798617/HIVE-11427.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 9968 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestMiniTezCliDriver-vector_distinct_2.q-load_dyn_part2.q-join1.q-and-12-more - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_coltype_literals
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_index_bitmap3
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/7614/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/7614/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/7614/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/7614/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-7614/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-7614/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12798617 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="15244534" author="ychena" created="Sun, 17 Apr 2016 04:36:32 +0000"  >&lt;p&gt;The failures are not related. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt; for reviewing the code.&lt;/p&gt;</comment>
                            <comment id="15244544" author="ychena" created="Sun, 17 Apr 2016 05:54:17 +0000"  >&lt;p&gt;Committed to master and branch-1&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12714870">HIVE-7079</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12798319" name="HIVE-11427.1.patch" size="1100" author="ychena" created="Tue, 12 Apr 2016 17:43:11 +0000"/>
                            <attachment id="12798617" name="HIVE-11427.2.patch" size="5389" author="ychena" created="Thu, 14 Apr 2016 00:26:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 31 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2i6zb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>