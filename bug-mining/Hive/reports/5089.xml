<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:49:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-15397] metadata-only queries may return incorrect results with empty tables</title>
                <link>https://issues.apache.org/jira/browse/HIVE-15397</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Queries like select 1=1 from t group by 1=1 may return rows, based on OneNullRowInputFormat, even if the source table is empty. For now, add some basic detection of empty tables and turn this off by default (since we can&apos;t know whether a table is empty or not based on there being some files, without reading them).&lt;/p&gt;</description>
                <environment></environment>
        <key id="13026829">HIVE-15397</key>
            <summary>metadata-only queries may return incorrect results with empty tables</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sershe">Sergey Shelukhin</assignee>
                                    <reporter username="sershe">Sergey Shelukhin</reporter>
                        <labels>
                            <label>TODOC2.2</label>
                    </labels>
                <created>Fri, 9 Dec 2016 00:04:40 +0000</created>
                <updated>Wed, 17 Jun 2020 09:36:17 +0000</updated>
                            <resolved>Tue, 13 Dec 2016 20:51:30 +0000</resolved>
                                                    <fixVersion>2.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15733796" author="sershe" created="Fri, 9 Dec 2016 00:06:55 +0000"  >&lt;p&gt;For now, I&apos;m disabling the setting by default and adding safety for the common case.&lt;br/&gt;
 &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pxiong&quot; class=&quot;user-hover&quot; rel=&quot;pxiong&quot;&gt;pxiong&lt;/a&gt; can you take a look? I filed &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-15398&quot; title=&quot;change metadata-only queries to still read the original table (in some cases?)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-15398&quot;&gt;HIVE-15398&lt;/a&gt; to follow up, will update the descriptions in both shortly&lt;/p&gt;</comment>
                            <comment id="15733816" author="ashutoshc" created="Fri, 9 Dec 2016 00:20:14 +0000"  >&lt;p&gt;Another solution could be OneNullRowIF keeps instance of original IF within it and uses it at runtime to determine whether there are 0 or more rows.&lt;/p&gt;</comment>
                            <comment id="15733912" author="sershe" created="Fri, 9 Dec 2016 01:06:31 +0000"  >&lt;p&gt;See follow-up.&lt;br/&gt;
In that case you might as well just add the limit to original table scan and not use NullScan, cause it&apos;s no longer a nullscan.&lt;br/&gt;
That will also require running a task, split generation etc., so it may be involved.&lt;/p&gt;</comment>
                            <comment id="15734067" author="hiveqa" created="Fri, 9 Dec 2016 02:31:40 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12842449/HIVE-15397.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12842449/HIVE-15397.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 16 failed/errored test(s), 10773 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[limit_partition_metadataonly] (batchId=57)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[partInit] (batchId=73)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[partition_date2] (batchId=16)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[partition_timestamp2] (batchId=29)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample2] (batchId=5)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample4] (batchId=15)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample6] (batchId=61)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample7] (batchId=60)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample9] (batchId=38)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[transform_ppr2] (batchId=134)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[metadataonly1] (batchId=149)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[stats_based_fetch_decision] (batchId=150)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver (batchId=159)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_2] (batchId=92)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_4] (batchId=92)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[limit_partition_metadataonly] (batchId=119)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/2507/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/2507/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/2507/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/2507/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-2507/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-2507/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 16 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12842449 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15734804" author="lefty@hortonworks.com" created="Fri, 9 Dec 2016 09:30:00 +0000"  >&lt;p&gt;Typo in parameter description:  &quot;Whether to elimiate scans&quot; --&amp;gt; eliminate.&lt;/p&gt;</comment>
                            <comment id="15736432" author="sershe" created="Fri, 9 Dec 2016 21:47:07 +0000"  >&lt;p&gt;Interesting q file changes.. according to our take on 1=1 group by 1=1 they are correct.&lt;br/&gt;
E.g. table has 3 partitions, part=a, part=b, and part=c. Only a and c have data.&lt;br/&gt;
select distinct part from t&lt;br/&gt;
used to return &quot;a, b, c&quot;. However, there are no rows in the table that actually have value b. So, the result has changed to &quot;a, c&quot;.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jcamachorodriguez&quot; class=&quot;user-hover&quot; rel=&quot;jcamachorodriguez&quot;&gt;jcamachorodriguez&lt;/a&gt; would you say it&apos;s the correct change and previous result is incorrect?&lt;br/&gt;
Same for max(partcol) from an empty table - should it be null? Cause there are no rows in the table to derive max from, similar how there are no rows in gby 1=1 to group by.&lt;/p&gt;</comment>
                            <comment id="15736456" author="sershe" created="Fri, 9 Dec 2016 21:58:42 +0000"  >&lt;p&gt;Updated the out files, expanded one test to run with and without metadataonly enabled to make sure results are consistent, fixed the typo.&lt;/p&gt;</comment>
                            <comment id="15736608" author="hiveqa" created="Fri, 9 Dec 2016 23:04:10 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12842617/HIVE-15397.01.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12842617/HIVE-15397.01.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 6 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 13 failed/errored test(s), 10793 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[auto_sortmerge_join_2] (batchId=44)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample2] (batchId=5)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample4] (batchId=15)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample6] (batchId=61)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample7] (batchId=60)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample9] (batchId=38)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[orc_ppd_schema_evol_3a] (batchId=134)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[transform_ppr2] (batchId=134)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[metadataonly1] (batchId=149)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[stats_based_fetch_decision] (batchId=150)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_5] (batchId=91)
org.apache.hive.jdbc.TestJdbcDriver2.testSelectExecAsync2 (batchId=213)
org.apache.hive.jdbc.TestMultiSessionsHS2WithLocalClusterSpark.testSparkQuery (batchId=215)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/2529/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/2529/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/2529/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/2529/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-2529/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-2529/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 13 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12842617 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15736821" author="ashutoshc" created="Sat, 10 Dec 2016 00:34:03 +0000"  >&lt;p&gt;This is interesting, because Hive allows you to create partitions without any data. That will result in a partitioning column having a value. So, shall we assume that table has row(s) with partitioning column taking supplied value and other columns being null. I think no. This was the case earlier and I think its wrong. I think behavior we are getting now is correct. If partition exists but its empty, we should consider partition has 0 rows, thus value for partitioning column should not matter during query evaluation. So, max(partCol) from empty_table should be null even when there is a partition which has partcol = 1.&lt;br/&gt;
So, I think behavior we are getting after patch is correct and desired. &lt;/p&gt;</comment>
                            <comment id="15736905" author="sershe" created="Sat, 10 Dec 2016 01:17:36 +0000"  >&lt;p&gt;Btw, I am too lazy to rerun it again now, but I think the current master is inconsistent, cause the out file changes that removed the rows on the first run removed the rows because I disabled metadata-only by default. So, non-optimized path on master doesn&apos;t return such rows, but metadata-only does return them. After the patch, neither does.&lt;/p&gt;</comment>
                            <comment id="15736908" author="sershe" created="Sat, 10 Dec 2016 01:17:47 +0000"  >&lt;p&gt;Now all I need is a +1 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/tongue.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15737467" author="lefty@hortonworks.com" created="Sat, 10 Dec 2016 08:08:15 +0000"  >&lt;p&gt;+1 for the typo fix, but that won&apos;t get you far.&lt;/p&gt;</comment>
                            <comment id="15743015" author="sershe" created="Mon, 12 Dec 2016 20:13:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; ping?&lt;/p&gt;</comment>
                            <comment id="15743268" author="ashutoshc" created="Mon, 12 Dec 2016 21:55:35 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15746227" author="sershe" created="Tue, 13 Dec 2016 20:51:31 +0000"  >&lt;p&gt;Committed to master. Thanks for the review&lt;/p&gt;</comment>
                            <comment id="15747826" author="lefty@hortonworks.com" created="Wed, 14 Dec 2016 09:45:04 +0000"  >&lt;p&gt;Doc note:  This changes the default value of &lt;b&gt;hive.optimize.metadataonly&lt;/b&gt; and gives it a description.  It was created in 0.8.0 by &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1003&quot; title=&quot;optimize metadata only queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1003&quot;&gt;&lt;del&gt;HIVE-1003&lt;/del&gt;&lt;/a&gt; and isn&apos;t documented in the wiki yet.  Note that the wiki description will need editing to cover the earlier default value of true.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-QueryandDDLExecution&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Configuration Properties &amp;#8211; Query and DDL Execution &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Added a TODOC2.2 label.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                                                <inwardlinks description="is cloned by">
                                        <issuelink>
            <issuekey id="13026831">HIVE-15398</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13311922">HIVE-23712</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12443933">HIVE-1003</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12842617" name="HIVE-15397.01.patch" size="19373" author="sershe" created="Fri, 9 Dec 2016 21:58:42 +0000"/>
                            <attachment id="12842449" name="HIVE-15397.patch" size="13736" author="sershe" created="Fri, 9 Dec 2016 00:06:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 49 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i37dif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>