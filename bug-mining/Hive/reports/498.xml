<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:57:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-1760] Mismatched open/commit transaction calls in case of connection retry</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1760</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Consider the create table function (parts removed for simplicity):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void create_table_core(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RawStore ms, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Table tbl)
        &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; AlreadyExistsException, MetaException, InvalidObjectException {

      Path tblPath = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
      &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; success = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, madeDir = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        ms.openTransaction();

        &lt;span class=&quot;code-comment&quot;&gt;// get_table checks whether database exists, it should be moved here
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (is_table_exists(tbl.getDbName(), tbl.getTableName())) {
          &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AlreadyExistsException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Table &quot;&lt;/span&gt; + tbl.getTableName()
              + &lt;span class=&quot;code-quote&quot;&gt;&quot; already exists&quot;&lt;/span&gt;);
        }

        ms.createTable(tbl);
        success = ms.commitTransaction();

      } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!success) {
          ms.rollbackTransaction();
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (madeDir) {
            wh.deleteDir(tblPath, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
          }
        }
      }
    }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A potential openTransaction() / commitTransaction() mismatch can occur if the is_table_exits() method call experiences a connection failure. &lt;/p&gt;

&lt;p&gt;Since get_table() in is_table_exists() uses executeWithRetry(),  the transaction will be rolled back and get_table() will be called again if the is a connection problem. However, this rollback and retry will reset the global openTransactionCalls counter back to 0, effectively canceling out the openTransaction() call. &lt;/p&gt;

&lt;p&gt;Then later in the method when commitTransaction() is called, Hive will throw an error similar to the following:&lt;/p&gt;

&lt;p&gt;Caused by: java.lang.RuntimeException: commitTransaction was called but openTransactionCalls = 0. This probably indicates that there are unbalanced calls to openTransaction/commitTransaction&lt;/p&gt;

&lt;p&gt;A similar problem exists with create_type_core()&lt;/p&gt;</description>
                <environment></environment>
        <key id="12478704">HIVE-1760</key>
            <summary>Mismatched open/commit transaction calls in case of connection retry</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pauly">Paul Yang</assignee>
                                    <reporter username="pauly">Paul Yang</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 Oct 2010 22:55:34 +0000</created>
                <updated>Thu, 21 Nov 2013 03:30:41 +0000</updated>
                            <resolved>Sat, 30 Oct 2010 04:59:02 +0000</resolved>
                                    <version>0.7.0</version>
                                    <fixVersion>0.7.0</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12926500" author="namit" created="Fri, 29 Oct 2010 23:36:46 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;running tests now&lt;/p&gt;</comment>
                            <comment id="12926502" author="pauly" created="Fri, 29 Oct 2010 23:43:00 +0000"  >&lt;p&gt;Explanation of the patch - by eliminating cases where executeWithRetry() is nested, this will produce the correct rollback behavior.&lt;/p&gt;</comment>
                            <comment id="12926540" author="namit" created="Sat, 30 Oct 2010 04:59:02 +0000"  >&lt;p&gt;Committed. Thanks Paul&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12661631">HIVE-4996</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12458458" name="HIVE-1760.1.patch" size="2527" author="pauly" created="Fri, 29 Oct 2010 23:21:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72723</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 4 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lgrj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123366</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>