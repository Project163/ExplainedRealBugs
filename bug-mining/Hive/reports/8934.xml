<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:27:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-27805] Hive server2 connections limits bug</title>
                <link>https://issues.apache.org/jira/browse/HIVE-27805</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;When I use JDBC and specify a non-existent database to connect to a hiveserver2 that configured hive.server2.limit.connections.per.user=10, a session initialization error occurs&#65288;org.apache.hive.service.cli.HiveSQLException: Failed to open new session: Database not_exists_db does not exist&#65289;; and even a normal connection will report an error after the number of attempts exceeds the maximum limit I configured (org.apache.hive.service.cli.HiveSQLException: Connection limit per user reached (user: aeolus limit: 10))&lt;br/&gt;
&#160;&lt;br/&gt;
I found that inside the method org.apache.hive.service.cli.session.SessionManager#createSession&lt;br/&gt;
, if seesion initialization fails, it will cause the increased number of connections called incrementConnections cannot be released; after the number of failures exceeds the maximum number of connections configured by the user, such as hive.server2.limit.connections.per.user, hiveserver2 will not accept any connections due to the limitations.&lt;br/&gt;
&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2023-10-17T12:14:54,313 &#160;WARN [HiveServer2-Handler-Pool: &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-3329] thrift.ThriftCLIService: Error opening session:
org.apache.hive.service.cli.HiveSQLException: Failed to open &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; session: Database not_exists_db does not exist
&#160; &#160; at org.apache.hive.service.cli.session.SessionManager.createSession(SessionManager.java:434) ~[hive-service-3.1.3.jar:3.1.3]
&#160; &#160; at org.apache.hive.service.cli.session.SessionManager.openSession(SessionManager.java:373) ~[hive-service-3.1.3.jar:3.1.3]
&#160; &#160; at org.apache.hive.service.cli.CLIService.openSession(CLIService.java:187) ~[hive-service-3.1.3.jar:3.1.3]
&#160; &#160; at org.apache.hive.service.cli.thrift.ThriftCLIService.getSessionHandle(ThriftCLIService.java:475) ~[hive-service-3.1.3.jar:3.1.3]
&#160; &#160; at org.apache.hive.service.cli.thrift.ThriftCLIService.OpenSession(ThriftCLIService.java:322) ~[hive-service-3.1.3.jar:3.1.3]
&#160; &#160; at org.apache.hive.service.rpc.thrift.TCLIService$Processor$OpenSession.getResult(TCLIService.java:1497) ~[hive-exec-3.1.3.jar:3.1.3]
&#160; &#160; at org.apache.hive.service.rpc.thrift.TCLIService$Processor$OpenSession.getResult(TCLIService.java:1482) ~[hive-exec-3.1.3.jar:3.1.3]
&#160; &#160; at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:39) ~[hive-exec-3.1.3.jar:3.1.3]
&#160; &#160; at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:39) ~[hive-exec-3.1.3.jar:3.1.3]
&#160; &#160; at org.apache.hive.service.auth.TSetIpAddressProcessor.process(TSetIpAddressProcessor.java:56) ~[hive-service-3.1.3.jar:3.1.3]
&#160; &#160; at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:286) ~[hive-exec-3.1.3.jar:3.1.3]
&#160; &#160; at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[?:1.8.0_342]
&#160; &#160; at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[?:1.8.0_342]
&#160; &#160; at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:750) [?:1.8.0_342]
Caused by: org.apache.hive.service.cli.HiveSQLException: Database dw_aeolus does not exist
&#160; &#160; at org.apache.hive.service.cli.session.HiveSessionImpl.configureSession(HiveSessionImpl.java:294) ~[hive-service-3.1.3.jar:3.1.3]
&#160; &#160; at org.apache.hive.service.cli.session.HiveSessionImpl.open(HiveSessionImpl.java:199) ~[hive-service-3.1.3.jar:3.1.3]
&#160; &#160; at org.apache.hive.service.cli.session.SessionManager.createSession(SessionManager.java:425) ~[hive-service-3.1.3.jar:3.1.3]
&#160; &#160; ... 13 more
2023-10-17T12:14:54,972 &#160;INFO [HiveServer2-Handler-Pool: &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-3330] thrift.ThriftCLIService: Client protocol version: HIVE_CLI_SERVICE_PROTOCOL_V8
2023-10-17T12:14:54,973 ERROR [HiveServer2-Handler-Pool: &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-3330] service.CompositeService: Connection limit per user reached (user: aeolus limit: 10)
2023-10-17T12:14:54,973 &#160;WARN [HiveServer2-Handler-Pool: &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-3330] thrift.ThriftCLIService: Error opening session:
org.apache.hive.service.cli.HiveSQLException: Connection limit per user reached (user: aeolus limit: 10)
&#160; &#160; at org.apache.hive.service.cli.session.SessionManager.incrementConnections(SessionManager.java:476) ~[hive-service-3.1.3.jar:3.1.3]
&#160; &#160; at org.apache.hive.service.cli.session.SessionManager.createSession(SessionManager.java:383) ~[hive-service-3.1.3.jar:3.1.3]
&#160; &#160; at org.apache.hive.service.cli.session.SessionManager.openSession(SessionManager.java:373) ~[hive-service-3.1.3.jar:3.1.3]
&#160; &#160; at org.apache.hive.service.cli.CLIService.openSession(CLIService.java:187) ~[hive-service-3.1.3.jar:3.1.3]
&#160; &#160; at org.apache.hive.service.cli.thrift.ThriftCLIService.getSessionHandle(ThriftCLIService.java:475) ~[hive-service-3.1.3.jar:3.1.3]
&#160; &#160; at org.apache.hive.service.cli.thrift.ThriftCLIService.OpenSession(ThriftCLIService.java:322) ~[hive-service-3.1.3.jar:3.1.3]
&#160; &#160; at org.apache.hive.service.rpc.thrift.TCLIService$Processor$OpenSession.getResult(TCLIService.java:1497) ~[hive-exec-3.1.3.jar:3.1.3]
&#160; &#160; at org.apache.hive.service.rpc.thrift.TCLIService$Processor$OpenSession.getResult(TCLIService.java:1482) ~[hive-exec-3.1.3.jar:3.1.3]
&#160; &#160; at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:39) ~[hive-exec-3.1.3.jar:3.1.3]
&#160; &#160; at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:39) ~[hive-exec-3.1.3.jar:3.1.3]
&#160; &#160; at org.apache.hive.service.auth.TSetIpAddressProcessor.process(TSetIpAddressProcessor.java:56) ~[hive-service-3.1.3.jar:3.1.3]
&#160; &#160; at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:286) ~[hive-exec-3.1.3.jar:3.1.3]
&#160; &#160; at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[?:1.8.0_342]
&#160; &#160; at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[?:1.8.0_342]
&#160; &#160; at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:750) [?:1.8.0_342] &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;image: apache/hive:3.1.3&lt;/p&gt;

&lt;p&gt;jdbc driver:&#160;hive-jdbc:2.1.0&lt;/p&gt;</environment>
        <key id="13554420">HIVE-27805</key>
            <summary>Hive server2 connections limits bug</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Dayakar">Dayakar M</assignee>
                                    <reporter username="xiwei">Xiwei Wang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 17 Oct 2023 13:33:09 +0000</created>
                <updated>Fri, 7 Nov 2025 06:12:38 +0000</updated>
                            <resolved>Fri, 7 Nov 2025 06:12:37 +0000</resolved>
                                    <version>3.1.0</version>
                    <version>3.0.0</version>
                    <version>3.1.1</version>
                    <version>3.1.2</version>
                    <version>3.1.3</version>
                                    <fixVersion>4.2.0</fixVersion>
                                    <component>HiveServer2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="18034387" author="dayakar" created="Fri, 31 Oct 2025 12:26:57 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dengzh&quot; class=&quot;user-hover&quot; rel=&quot;dengzh&quot;&gt;dengzh&lt;/a&gt; ,&lt;/p&gt;

&lt;p&gt;There is no activity on this issue in the recent time. If you are ok, I would like to work on this issue.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Dayakar&lt;/p&gt;</comment>
                            <comment id="18036092" author="krisztiankasa" created="Fri, 7 Nov 2025 06:12:25 +0000"  >&lt;p&gt;Merged to master. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Dayakar&quot; class=&quot;user-hover&quot; rel=&quot;Dayakar&quot;&gt;Dayakar&lt;/a&gt;&#160;for the fix.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1l000:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>