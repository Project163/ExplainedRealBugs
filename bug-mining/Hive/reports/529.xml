<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:57:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-1806] The merge criteria on dynamic partitons should be per partiton</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1806</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Currently the criteria of whether a merge job should be fired on dynamic generated partitions are is the average file size of files across all dynamic partitions. It is very common that some dynamic partitions contains mostly large files and some contains mostly small files. Even though the average size of the total files are larger than the hive.merge.smallfiles.avgsize, we should merge those partitions containing small files only. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12480715">HIVE-1806</key>
            <summary>The merge criteria on dynamic partitons should be per partiton</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nzhang">Ning Zhang</assignee>
                                    <reporter username="nzhang">Ning Zhang</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Nov 2010 19:22:01 +0000</created>
                <updated>Fri, 16 Dec 2011 23:59:36 +0000</updated>
                            <resolved>Thu, 23 Dec 2010 23:53:08 +0000</resolved>
                                                    <fixVersion>0.7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12971870" author="namit" created="Wed, 15 Dec 2010 22:27:36 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12971977" author="namit" created="Thu, 16 Dec 2010 06:30:35 +0000"  >&lt;p&gt;test dyn_part_empty.q failed - can you take a look ?&lt;/p&gt;</comment>
                            <comment id="12971987" author="nzhang" created="Thu, 16 Dec 2010 07:24:58 +0000"  >&lt;p&gt;dyn_part_empty.q is having intermittent failures. I tried the clean trunk and it sometimes fails as well. The failure is not critical &amp;#8211; exception was printed to log file rather than console. It should not be caused by this patch.&lt;/p&gt;

&lt;p&gt;However, I did find 2 diffs in skewjoin.q and bucketmapjoin2.q. The former has a simple fix. I&apos;m looking at why bucketmapjoin2.q has a slightly different plan. &lt;/p&gt;</comment>
                            <comment id="12973907" author="nzhang" created="Tue, 21 Dec 2010 21:34:08 +0000"  >&lt;p&gt;Uploading a new patch that resolved the diff in bucketmapjoin2.q. I&apos;m rerunning unit tests. &lt;/p&gt;</comment>
                            <comment id="12974101" author="namit" created="Wed, 22 Dec 2010 07:41:50 +0000"  >&lt;p&gt;I will take a look&lt;/p&gt;</comment>
                            <comment id="12974327" author="namit" created="Wed, 22 Dec 2010 18:54:17 +0000"  >&lt;p&gt;combine2.q is failing - &lt;/p&gt;</comment>
                            <comment id="12974437" author="nzhang" created="Wed, 22 Dec 2010 23:38:40 +0000"  >&lt;p&gt;Uploading a new patch that passed all unit tests. The only change is in ConditionalResolveMerge.java by introducing a new boolean doMerge rather than rely on the condition totalSize &amp;gt; 0. &lt;/p&gt;</comment>
                            <comment id="12974543" author="namit" created="Thu, 23 Dec 2010 06:27:46 +0000"  >&lt;p&gt;Comments for getMergeSize are wrong - that function never returns 0.&lt;/p&gt;

&lt;p&gt;Why are you setting reducers for doing the merge for dynamic partitions - shouldnt it be a&lt;br/&gt;
map-only job ?&lt;/p&gt;</comment>
                            <comment id="12974556" author="nzhang" created="Thu, 23 Dec 2010 07:53:09 +0000"  >&lt;p&gt;getMergeSize() could return 0 when there are multiple files generated but each file is an empty file. bucketmapjoin2.q actually hit this case where there are multiple mappers/reducers and non of them produces results. &lt;/p&gt;

&lt;p&gt;The comment about setNumberReducers is taken. The function does not only setup number of reducers but also set up min split size. So I rename it to setupMapRedWork. We cannot assume all merge tasks are map only because the parameters hive.mergejob.maponly may be false and the compiler may generate a MapReduce task. I also found a bug in GenMRFileSink1.createMergeJob() where the hive.mergejob.maponly should be checked rather than hive.merge.mapfiles and hive.merge.mapredfiles. The latter 2 are already checked before createMergeJob() is called. &lt;/p&gt;

&lt;p&gt;Uploading a new patch containing the change. I&apos;m also running unit tests. &lt;/p&gt;</comment>
                            <comment id="12974713" author="namit" created="Thu, 23 Dec 2010 19:58:54 +0000"  >&lt;p&gt;Mostly looks good - a minor comment.&lt;/p&gt;


&lt;p&gt;In the new test that you added, the merge job is a map-only job although you are using HiveInputFormat&lt;br/&gt;
This is because of the fact that you are using hadoop 20 which supports CombineHiveIF.&lt;br/&gt;
Do you think that is the correct behavior ? Looks OK, just wanted to confirm. &lt;/p&gt;</comment>
                            <comment id="12974749" author="nzhang" created="Thu, 23 Dec 2010 21:20:30 +0000"  >&lt;p&gt;That&apos;s expected behavior. The merge job will check if the CombineHiveInputFormat is supported. If so it will use that for the merge job although the default hive.input.format is different. Setting input format for the merge job is done at GenMRFileSink1.java:375.&lt;/p&gt;</comment>
                            <comment id="12974752" author="namit" created="Thu, 23 Dec 2010 21:23:29 +0000"  >&lt;p&gt;Thats fine&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12974794" author="namit" created="Thu, 23 Dec 2010 23:53:08 +0000"  >&lt;p&gt;Committed. Thanks Ning&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12466765" name="HIVE-1806.2.patch" size="34088" author="nzhang" created="Tue, 21 Dec 2010 21:34:08 +0000"/>
                            <attachment id="12466847" name="HIVE-1806.3.patch" size="34600" author="nzhang" created="Wed, 22 Dec 2010 23:38:40 +0000"/>
                            <attachment id="12466864" name="HIVE-1806.4.patch" size="35839" author="nzhang" created="Thu, 23 Dec 2010 07:53:09 +0000"/>
                            <attachment id="12466347" name="HIVE-1806.patch" size="33124" author="nzhang" created="Wed, 15 Dec 2010 21:21:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72694</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 48 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lh0n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123407</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>