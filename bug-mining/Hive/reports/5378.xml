<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:52:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-16104] LLAP: preemption may be too aggressive if the pre-empted task doesn&apos;t die immediately</title>
                <link>https://issues.apache.org/jira/browse/HIVE-16104</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description></description>
                <environment></environment>
        <key id="13048151">HIVE-16104</key>
            <summary>LLAP: preemption may be too aggressive if the pre-empted task doesn&apos;t die immediately</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sershe">Sergey Shelukhin</assignee>
                                    <reporter username="sershe">Sergey Shelukhin</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Mar 2017 19:44:29 +0000</created>
                <updated>Fri, 21 Jul 2017 18:45:57 +0000</updated>
                            <resolved>Tue, 14 Mar 2017 00:50:24 +0000</resolved>
                                                    <fixVersion>2.3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15894940" author="sershe" created="Fri, 3 Mar 2017 19:57:07 +0000"  >&lt;p&gt;The patch. cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sseth&quot; class=&quot;user-hover&quot; rel=&quot;sseth&quot;&gt;sseth&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15894981" author="sershe" created="Fri, 3 Mar 2017 20:30:41 +0000"  >&lt;p&gt;Forgot to submit&lt;/p&gt;</comment>
                            <comment id="15895542" author="hiveqa" created="Sat, 4 Mar 2017 06:39:12 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12855954/HIVE-16104.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12855954/HIVE-16104.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 26 failed/errored test(s), 10285 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestCommandProcessorFactory - did not produce a TEST-*.xml file (likely timed out) (batchId=272)
TestDbTxnManager - did not produce a TEST-*.xml file (likely timed out) (batchId=272)
TestDummyTxnManager - did not produce a TEST-*.xml file (likely timed out) (batchId=272)
TestHiveInputSplitComparator - did not produce a TEST-*.xml file (likely timed out) (batchId=272)
TestIndexType - did not produce a TEST-*.xml file (likely timed out) (batchId=272)
TestSplitFilter - did not produce a TEST-*.xml file (likely timed out) (batchId=272)
org.apache.hadoop.hive.cli.TestBeeLineDriver.testCliDriver[escape_comments] (batchId=229)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[schema_evol_text_vec_table] (batchId=147)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_if_expr] (batchId=140)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[vector_between_in] (batchId=119)
org.apache.hive.beeline.TestSchemaTool.testNestedScriptsForDerby (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testNestedScriptsForMySQL (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testNestedScriptsForOracle (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testPostgresFilter (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testSchemaInit (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testSchemaInitDryRun (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testSchemaUpgrade (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testSchemaUpgradeDryRun (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testScriptMultiRowComment (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testScriptWithDelimiter (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testScripts (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testValidateLocations (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testValidateNullValues (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testValidateSchemaTables (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testValidateSchemaVersions (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testValidateSequences (batchId=212)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/3934/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/3934/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/3934/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/3934/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-3934/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-3934/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 26 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12855954 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15898335" author="sershe" created="Mon, 6 Mar 2017 23:04:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sseth&quot; class=&quot;user-hover&quot; rel=&quot;sseth&quot;&gt;sseth&lt;/a&gt; ping?&lt;/p&gt;</comment>
                            <comment id="15900560" author="sseth" created="Wed, 8 Mar 2017 01:54:01 +0000"  >&lt;p&gt;Looking. Can you please remove the unnecessary parts of the patch - formatting changes, refactored sections, refactored if/else statements. That makes it difficult to review, and is not required.&lt;br/&gt;
More than half the patch seems like a refactor.&lt;/p&gt;</comment>
                            <comment id="15900571" author="sershe" created="Wed, 8 Mar 2017 02:02:27 +0000"  >&lt;p&gt;Some things that look like refactoring are not actually refactoring. The lock in trySchedule is unnecessary so I removed it and renamed the method; preemption was surrounded by a loop because previously, if the first task in queue was finishable it would bail without preempting anything even if there are more tasks.&lt;br/&gt;
I can merge updateQueueMetric back into being copy-pasted in 3 places... also one if was refactored because it has lots of repetitive code.&lt;br/&gt;
Another method was added because something that was previously called in one place is now called in 2 places and I didn&apos;t want to copy-paste it. &lt;/p&gt;</comment>
                            <comment id="15900574" author="sershe" created="Wed, 8 Mar 2017 02:05:55 +0000"  >&lt;p&gt;RB &lt;a href=&quot;https://reviews.apache.org/r/57405/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/57405/&lt;/a&gt; for review where whitespace changes make the patch too verbose&lt;/p&gt;</comment>
                            <comment id="15901833" author="sseth" created="Wed, 8 Mar 2017 19:29:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;The lock in trySchedule is unnecessary so I removed it and renamed the method;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Not required, or relevant to this patch.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;preemption was surrounded by a loop because previously, if the first task in queue was finishable it would bail without preempting anything even if there are more tasks.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I believe this is mostly harmless - the same task will be picked up in the next loop. Unrelated to the jira, but probably a relevant change.There&apos;s some change around switching the condition to return early (negative condition - return, instead of the existing conditions met-&amp;gt; execute) - which is unnecessary.&lt;br/&gt;
Similar condition changes elsewhere as well.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I can merge updateQueueMetric back into being copy-pasted in 3 places... also one if was refactored because it has lots of repetitive code.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Another method was added because something that was previously called in one place is now called in 2 places and I didn&apos;t want to copy-paste it.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;These would be relevant to the jira? - since additional invocations are happening because of the change.&lt;/p&gt;</comment>
                            <comment id="15901897" author="sershe" created="Wed, 8 Mar 2017 20:05:01 +0000"  >&lt;p&gt;We don&apos;t normally have separate jiras for refactoring so I don&apos;t see why not perform small refactors in other changes...&lt;/p&gt;</comment>
                            <comment id="15902006" author="sseth" created="Wed, 8 Mar 2017 21:31:02 +0000"  >&lt;p&gt;We generally don&apos;t refactor sections which interfere with the review. And in most cases, unrelated changes are avoided. Don&apos;t see any reason to make the additional changes here.&lt;/p&gt;</comment>
                            <comment id="15902205" author="sershe" created="Thu, 9 Mar 2017 00:12:26 +0000"  >&lt;p&gt;Restoring the amount of nesting and copy-paste that is expected of Tez-related code &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15902341" author="sseth" created="Thu, 9 Mar 2017 02:10:06 +0000"  >&lt;p&gt;Thank you. Still some parts which should not have changed... Anyway. Actual review comments this time&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Thread.sleep(PREEMPTION_KILL_GRACE_SLEEP_MS); - Think it is possible to replace this with a timed wait. Similar to the way the main scheduling loop waits for a fragment to complete or get scheduled before it tries to schedule the next one. That way we won&apos;t actually be sleeping for the entire 100ms.&lt;/li&gt;
	&lt;li&gt;Another nice to have bit would be to allow the element to go back into the queue, and fetch the latest from the queue - which could be at a higher priority. Don&apos;t think this is critical though.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;In TaskRunnerCallable - killTask needs a minor change. shouldRunTask = false needs to be set independent of the (taskRunner) condition that it is under. Having a fragment wait outside the queue increases the possibility of an issue like this being hit. (The nice to have about putting the fragment back in the queue and waiting for the next schedule attempt would limit the possibility of other such issues, if they exist, as well)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Any chance of adding tests? The test class is setup with some controlled scheduling constructs to help with this. Suspect it&apos;ll need more work with the timed wait though.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;System.nanoTime - replace with the Clock instance already used in the class. (Helps with unit tests to simulate time changes, may not be plugged in yet).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Nit: lastKillTimeNs - Long(null) vs long (-1/special value for unset)?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Not required.
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// TODO: &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; can all be replaced by a &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; with a &lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt; and a &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; block&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15902605" author="hiveqa" created="Thu, 9 Mar 2017 07:21:34 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12856901/HIVE-16104.01.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12856901/HIVE-16104.01.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 10335 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/4040/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/4040/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/4040/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/4040/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-4040/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-4040/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12856901 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15904079" author="sershe" created="Thu, 9 Mar 2017 23:49:17 +0000"  >&lt;p&gt;Wrt special values, monotonic/nanotime can take any value so special values should not be used.&lt;br/&gt;
#3 is completely unrelated, strange that you would ask for it here &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I&apos;ll make the change.&lt;br/&gt;
The class has so many TODO comments that adding another relevant one should not be a problem&lt;/p&gt;</comment>
                            <comment id="15904133" author="sershe" created="Fri, 10 Mar 2017 00:23:21 +0000"  >&lt;p&gt;The rest of the feedback... will look into unit tests&lt;/p&gt;</comment>
                            <comment id="15904273" author="sseth" created="Fri, 10 Mar 2017 02:22:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;Wrt special values, monotonic/nanotime can take any value so special values should not be used.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;How about &quot;-1&quot; as a value, don&apos;t think we&apos;ll see that as a Time.monotonicNow&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;#3 is completely unrelated, strange that you would ask for it here  I&apos;ll make the change.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Think it is related, since the change increases the chances of hitting this (seen while walking through the patch)&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The class has so many TODO comments that adding another relevant one should not be a problem&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That&apos;s a style choice. There&apos;s nothing wrong with using an executor with a single thread. If anything, this should have been Executors.newSingleThreadExecutor&lt;/p&gt;

&lt;p&gt;Think we&apos;re better off using the mega lock in the scheduler for the wait - that way it gets interrupted if some other task completes, another task asks to be scheduled, etc. (Doesn&apos;t need to wait for the specific fragment to end)&lt;br/&gt;
Using isComplete as the wait mechanism has a race when the setIsCompleted() invocation happens in TaskRunnerCallable.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;lastVictim = handleScheduleAttemptedRejection(task);
              &lt;span class=&quot;code-comment&quot;&gt;// We killed something.
&lt;/span&gt;              lastKillTimeMs = clock.getTime();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Should this check for lastVictim being null?&lt;/p&gt;</comment>
                            <comment id="15904326" author="sershe" created="Fri, 10 Mar 2017 03:12:08 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://docs.oracle.com/javase/7/docs/api/java/lang/System.html#nanoTime%28%29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/7/docs/api/java/lang/System.html#nanoTime%28%29&lt;/a&gt;, it can be negative. Anyway there&apos;s no reason to have a magic value when it can be null.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;That&apos;s a style choice. There&apos;s nothing wrong with using an executor with a single thread. If anything, this should have been Executors.newSingleThreadExecutor&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That&apos;s complexity for no reason.. so not really a style choice. &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Think we&apos;re better off using the mega lock in the scheduler for the wait - that way it gets interrupted if some other task completes, another task asks to be scheduled, etc. (Doesn&apos;t need to wait for the specific fragment to end)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sorry didn&apos;t get that. You mean for the waiting for completion? Wouldn&apos;t that block other ops like adding tasks?&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Using isComplete as the wait mechanism has a race when the setIsCompleted() invocation happens in TaskRunnerCallable.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;What is the race? The wait is on the lock and so both wait and notify have to execute when the lock is taken. isComplete is also only examined under the same lock. So either the checker sees isComplete=true (after someone has set it and ran notify) and doesn&apos;t wait, or it sees false, so whoever notifies-All cannot notify before the checker releases the lock by going into wait, cause he needs the lock to notify; hence the waiting thread will get notified. Also isComplete is never unset, so that makes it even less problematic cause noone will set it to false.&lt;/p&gt;
</comment>
                            <comment id="15904375" author="sseth" created="Fri, 10 Mar 2017 03:41:52 +0000"  >&lt;blockquote&gt;&lt;p&gt;Sorry didn&apos;t get that. You mean for the waiting for completion? Wouldn&apos;t that block other ops like adding tasks?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;No. It&apos;s a wait on the giant lock. So there&apos;s no lock held. When a new operation happens, it can signal this. (The same lock used in the main scheduling loop) - which gets a signal from all other opeartions.&lt;/p&gt;

&lt;p&gt;Also, I think the loop can be simplified. trySChedule does not need to be done twice.&lt;/p&gt;</comment>
                            <comment id="15905856" author="sershe" created="Fri, 10 Mar 2017 23:19:21 +0000"  >&lt;p&gt;Updated the loop, the lock and tests&lt;/p&gt;</comment>
                            <comment id="15905932" author="hiveqa" created="Sat, 11 Mar 2017 00:37:56 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12857429/HIVE-16104.04.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12857429/HIVE-16104.04.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 2 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 10341 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/4079/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/4079/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/4079/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/4079/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-4079/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-4079/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12857429 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15906042" author="hiveqa" created="Sat, 11 Mar 2017 03:28:29 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12857429/HIVE-16104.04.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12857429/HIVE-16104.04.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 2 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 10341 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/4082/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/4082/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/4082/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/4082/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-4082/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-4082/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12857429 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15922804" author="sseth" created="Mon, 13 Mar 2017 19:31:28 +0000"  >&lt;p&gt;Mostly looks good.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// TODO: not clear &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we should wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; our last victim, or &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;. CR feedback.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Didn&apos;t get this comment. Should we wait for the specific preemption? - no, if some other fragment completes.&lt;br/&gt;
If another fragment completes, we&apos;ll forget about what was preempted, and when it was preempted. Don&apos;t think we should try fixing this corner case here.&lt;/p&gt;

&lt;p&gt;FixedClock - May want to use &quot;ControlledClock&quot; which is already available.&lt;/p&gt;

&lt;p&gt;The TODO on the thread should go.&lt;/p&gt;

&lt;p&gt;On the test, think we should increase the sleep time + timeouts, or move to a mechanism where the sleep is  not required (that&apos;s where the clock was supposed to help). 500ms typically causes a problems on slow/busy boxes, and will result in test flakiness. A direct notifyAll to break out of the condition is ideal - that gets into the area of whether the main code should be modified for tests. Will probably require a wrapper wait interface which the test can control... IAC, increased timeouts is probably the simplest at the moment.&lt;/p&gt;</comment>
                            <comment id="15922973" author="sseth" created="Mon, 13 Mar 2017 21:26:01 +0000"  >&lt;p&gt;+1 on the latest patch. Thanks!&lt;/p&gt;</comment>
                            <comment id="15923311" author="hiveqa" created="Tue, 14 Mar 2017 00:34:08 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12858549/HIVE-16104.05.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12858549/HIVE-16104.05.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 2 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 10343 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/4109/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/4109/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/4109/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/4109/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-4109/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-4109/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12858549 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15923336" author="sershe" created="Tue, 14 Mar 2017 00:50:24 +0000"  >&lt;p&gt;Committed to master. Thanks for the review!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12856901" name="HIVE-16104.01.patch" size="12973" author="sershe" created="Thu, 9 Mar 2017 00:12:26 +0000"/>
                            <attachment id="12857140" name="HIVE-16104.02.patch" size="18943" author="sershe" created="Fri, 10 Mar 2017 00:23:21 +0000"/>
                            <attachment id="12857392" name="HIVE-16104.03.patch" size="15887" author="sershe" created="Fri, 10 Mar 2017 20:52:51 +0000"/>
                            <attachment id="12857429" name="HIVE-16104.04.patch" size="26065" author="sershe" created="Fri, 10 Mar 2017 23:18:35 +0000"/>
                            <attachment id="12858549" name="HIVE-16104.05.patch" size="26511" author="sershe" created="Mon, 13 Mar 2017 21:22:59 +0000"/>
                            <attachment id="12855954" name="HIVE-16104.patch" size="13671" author="sershe" created="Fri, 3 Mar 2017 19:57:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 36 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3axmv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>