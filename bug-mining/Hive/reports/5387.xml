<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:52:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-16160] OutOfMemoryError: GC overhead limit exceeded on Hiveserver2 </title>
                <link>https://issues.apache.org/jira/browse/HIVE-16160</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Hs2 process killed by OOM:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; ERROR [HiveServer2-Handler-Pool: &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-1361771]: metastore.RetryingHMSHandler (RetryingHMSHandler.java:invokeInternal(203)) - java.lang.OutOfMemoryError: GC overhead limit exceeded
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.toLowerCase(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.java:2647)
        at org.datanucleus.Configuration.getInternalNameForProperty(Configuration.java:188)
        at org.datanucleus.ExecutionContextImpl.getProperty(ExecutionContextImpl.java:1012)
        at org.datanucleus.state.AbstractStateManager.updateLevel2CacheForFields(AbstractStateManager.java:979)
        at org.datanucleus.state.AbstractStateManager.loadFieldsInFetchPlan(AbstractStateManager.java:1097)
        at org.datanucleus.ExecutionContextImpl.performDetachAllOnTxnEndPreparation(ExecutionContextImpl.java:4544)
        at org.datanucleus.ExecutionContextImpl.preCommit(ExecutionContextImpl.java:4199)
        at org.datanucleus.ExecutionContextImpl.transactionPreCommit(ExecutionContextImpl.java:770)
        at org.datanucleus.TransactionImpl.internalPreCommit(TransactionImpl.java:385)
        at org.datanucleus.TransactionImpl.commit(TransactionImpl.java:275)
        at org.datanucleus.api.jdo.JDOTransaction.commit(JDOTransaction.java:107)
        at org.apache.hadoop.hive.metastore.ObjectStore.commitTransaction(ObjectStore.java:570)
        at org.apache.hadoop.hive.metastore.ObjectStore.getTable(ObjectStore.java:1033)
        at sun.reflect.GeneratedMethodAccessor32.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at org.apache.hadoop.hive.metastore.RawStoreProxy.invoke(RawStoreProxy.java:103)
        at com.sun.proxy.$Proxy7.getTable(Unknown Source)
        at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.get_table_core(HiveMetaStore.java:1915)
        at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.get_table(HiveMetaStore.java:1887)
        at sun.reflect.GeneratedMethodAccessor36.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at org.apache.hadoop.hive.metastore.RetryingHMSHandler.invokeInternal(RetryingHMSHandler.java:147)
        at org.apache.hadoop.hive.metastore.RetryingHMSHandler.invoke(RetryingHMSHandler.java:105)
        at com.sun.proxy.$Proxy12.get_table(Unknown Source)
        at org.apache.hadoop.hive.metastore.HiveMetaStoreClient.getTable(HiveMetaStoreClient.java:1271)
        at org.apache.hadoop.hive.ql.metadata.SessionHiveMetaStoreClient.getTable(SessionHiveMetaStoreClient.java:131)
        at sun.reflect.GeneratedMethodAccessor37.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at org.apache.hadoop.hive.metastore.RetryingMetaStoreClient.invoke(RetryingMetaStoreClient.java:178)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13049790">HIVE-16160</key>
            <summary>OutOfMemoryError: GC overhead limit exceeded on Hiveserver2 </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sushanth">Sushanth Sowmyan</assignee>
                                    <reporter username="kavansuresh@gmail.com">Kavan Suresh</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Mar 2017 22:56:46 +0000</created>
                <updated>Fri, 21 Jul 2017 18:45:59 +0000</updated>
                            <resolved>Thu, 16 Mar 2017 18:42:28 +0000</resolved>
                                                    <fixVersion>2.3.0</fixVersion>
                                    <component>HiveServer2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15904036" author="sushanth" created="Thu, 9 Mar 2017 23:08:25 +0000"  >&lt;p&gt;Looking at the heap dump that Kavan provided me for this, it appears we have a large number of leftover objects in a DN WeakValueMap from ClassLoaderResolverImpl, and is an issue similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11499&quot; title=&quot;Datanucleus leaks classloaders when used using embedded metastore with HiveServer2 with UDFs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11499&quot;&gt;&lt;del&gt;HIVE-11499&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The underlying issue is not that there is necessarily a leak as much as that the ClassLoaderResolverImpl winds up having a WeakValueMap&amp;lt;String,Class&amp;gt;, where all the values are stored as WeakReferences with a ReferenceQueue tracking expiry. Thus, at load time, after it&apos;s done loading all the classes, the key list alone is enough for us to wind up going to about 200megs, even if all the values are GCed, because the keys are not removed till after a reap() is called on the WeakValueMap, which does not wind up getting called because we don&apos;t use that map after a while. More to the point, the map that is large is the &quot;unloadedClasses&quot; map of the ClassLoaderResolverImpl.&lt;/p&gt;

&lt;p&gt;I&apos;ll upload more details (screenshots of the memory analysis at least, since the dump itself is huge), and a resolution soon.&lt;/p&gt;</comment>
                            <comment id="15926447" author="sushanth" created="Wed, 15 Mar 2017 16:13:07 +0000"  >&lt;p&gt;Attaching screenshot of a heapdump illustrating the WeakValueMap(unloadedClasses) growth after about a day of running.&lt;/p&gt;</comment>
                            <comment id="15926494" author="sushanth" created="Wed, 15 Mar 2017 16:25:35 +0000"  >&lt;p&gt;Patch attached.&lt;/p&gt;</comment>
                            <comment id="15926597" author="daijy" created="Wed, 15 Mar 2017 17:25:57 +0000"  >&lt;p&gt;+1 pending test.&lt;/p&gt;</comment>
                            <comment id="15927425" author="sushanth" created="Thu, 16 Mar 2017 03:42:49 +0000"  >&lt;p&gt;Note : Tests completed for this - unsure why Hive QA did not autoreply to jira : &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/4160/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/4160/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It looks like there was 1 failure, but that was unrelated, from TestSparkCliDriver.&lt;/p&gt;</comment>
                            <comment id="15928586" author="sushanth" created="Thu, 16 Mar 2017 18:23:49 +0000"  >&lt;p&gt;Looks like something is up with the Hive QA automation bot that it didn&apos;t comment after the tests ran. But, based on the results, I&apos;m going to go ahead and commit.&lt;/p&gt;</comment>
                            <comment id="15928618" author="sushanth" created="Thu, 16 Mar 2017 18:42:28 +0000"  >&lt;p&gt;Committed to master. Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12853055">HIVE-11499</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12858894" name="HIVE-16160.patch" size="4373" author="sushanth" created="Wed, 15 Mar 2017 16:25:35 +0000"/>
                            <attachment id="12858893" name="Screen Shot 2017-03-15 at 9.10.15 AM.png" size="1093996" author="sushanth" created="Wed, 15 Mar 2017 16:13:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 35 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3b7jr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>