<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:25:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-28050] Disable Incremental non aggregated materialized view rebuild in presence of delete operations</title>
                <link>https://issues.apache.org/jira/browse/HIVE-28050</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;To support incremental rebuild of materialized views which definition does not have aggregate in presence of delete operations in any of its source tables the records of the source tables need to be uniquely identified and right joined with the records present in the view.&lt;br/&gt;
The join keys should be the unique columns of each table in the definition query but we can not determine which are those columns.&lt;/p&gt;

&lt;p&gt;One possibility is to project ROW_IDs of each source table in the view definition but the writeId component is changing at delete.&lt;/p&gt;

&lt;p&gt;Another way is to project columns of primary keys or unique keys but these constraints are not enforced in Hive.&lt;/p&gt;


&lt;p&gt;Current implementation leads to data correctness issues:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
set hive.support.concurrency=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
set hive.txn.manager=org.apache.hadoop.hive.ql.lockmgr.DbTxnManager;

create table cmv_basetable_n6 (a &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, b varchar(256), c decimal(10,2), d &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) stored as orc TBLPROPERTIES (&lt;span class=&quot;code-quote&quot;&gt;&apos;transactional&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt;);

insert into cmv_basetable_n6 values
 (1, &lt;span class=&quot;code-quote&quot;&gt;&apos;bob&apos;&lt;/span&gt;, 10.30, 2),
 (1, &lt;span class=&quot;code-quote&quot;&gt;&apos;alfred&apos;&lt;/span&gt;, 10.30, 2),
 (2, &lt;span class=&quot;code-quote&quot;&gt;&apos;bob&apos;&lt;/span&gt;, 3.14, 3),
 (2, &lt;span class=&quot;code-quote&quot;&gt;&apos;bonnie&apos;&lt;/span&gt;, 172342.2, 3),
 (3, &lt;span class=&quot;code-quote&quot;&gt;&apos;calvin&apos;&lt;/span&gt;, 978.76, 3),
 (3, &lt;span class=&quot;code-quote&quot;&gt;&apos;charlie&apos;&lt;/span&gt;, 9.8, 1);

create table cmv_basetable_2_n3 (a &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, b varchar(256), c decimal(10,2), d &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) stored as orc TBLPROPERTIES (&lt;span class=&quot;code-quote&quot;&gt;&apos;transactional&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt;);

insert into cmv_basetable_2_n3 values
 (1, &lt;span class=&quot;code-quote&quot;&gt;&apos;alfred&apos;&lt;/span&gt;, 10.30, 2),
 (3, &lt;span class=&quot;code-quote&quot;&gt;&apos;calvin&apos;&lt;/span&gt;, 978.76, 3);

CREATE MATERIALIZED VIEW cmv_mat_view_n6
  TBLPROPERTIES (&lt;span class=&quot;code-quote&quot;&gt;&apos;transactional&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt;) AS
  SELECT cmv_basetable_n6.a, cmv_basetable_2_n3.c
  FROM cmv_basetable_n6 JOIN cmv_basetable_2_n3 ON (cmv_basetable_n6.a = cmv_basetable_2_n3.a)
  WHERE cmv_basetable_2_n3.c &amp;gt; 10.0;

delete from cmv_basetable_n6 where b = &lt;span class=&quot;code-quote&quot;&gt;&apos;bob&apos;&lt;/span&gt;;

explain cbo
alter materialized view cmv_mat_view_n6 rebuild;
alter materialized view cmv_mat_view_n6 rebuild;

select * from cmv_mat_view_n6;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
3	978.76
3	978.76
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but it should be&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
1	10.30
3	978.76
3	978.76
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13566837">HIVE-28050</key>
            <summary>Disable Incremental non aggregated materialized view rebuild in presence of delete operations</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kkasa">Krisztian Kasa</assignee>
                                    <reporter username="kkasa">Krisztian Kasa</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 31 Jan 2024 05:55:48 +0000</created>
                <updated>Fri, 29 Mar 2024 17:49:54 +0000</updated>
                            <resolved>Mon, 12 Feb 2024 07:18:50 +0000</resolved>
                                                    <fixVersion>4.0.0</fixVersion>
                                    <component>Materialized views</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17815170" author="zabetak" created="Wed, 7 Feb 2024 08:59:00 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkasa&quot; class=&quot;user-hover&quot; rel=&quot;kkasa&quot;&gt;kkasa&lt;/a&gt;, I see that the PR removes code so I assume we are removing the feature introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-24854&quot; title=&quot;Incremental Materialized view refresh in presence of update/delete operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-24854&quot;&gt;&lt;del&gt;HIVE-24854&lt;/del&gt;&lt;/a&gt; is that correct? Is there a plan to restore the functionality in the future?&lt;/p&gt;

&lt;p&gt;Can you briefly outline here why it is impossible to fix the existing code and instead you opted for removal?&lt;/p&gt;</comment>
                            <comment id="17815276" author="kkasa" created="Wed, 7 Feb 2024 12:24:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zabetak&quot; class=&quot;user-hover&quot; rel=&quot;zabetak&quot;&gt;zabetak&lt;/a&gt;&lt;br/&gt;
Updated the description with an example.&lt;br/&gt;
The current implementation should check whether there are unique columns projected from each source table in the view definition query. Unfortunately we can not identify unique columns. If a method is found to do it the feature can be restored in the future.&lt;/p&gt;</comment>
                            <comment id="17815309" author="zabetak" created="Wed, 7 Feb 2024 13:39:06 +0000"  >&lt;p&gt;The materialized view definition in the description contains a join of two tables. Is the problem also relevant when there are no joins in the MV definition?&lt;/p&gt;</comment>
                            <comment id="17815523" author="kkasa" created="Thu, 8 Feb 2024 06:06:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zabetak&quot; class=&quot;user-hover&quot; rel=&quot;zabetak&quot;&gt;zabetak&lt;/a&gt;&lt;br/&gt;
Another example without join:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
set hive.support.concurrency=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
set hive.txn.manager=org.apache.hadoop.hive.ql.lockmgr.DbTxnManager;

create table t1 (a &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, b &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) stored as orc TBLPROPERTIES (&lt;span class=&quot;code-quote&quot;&gt;&apos;transactional&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt;);

insert into t1 values
(3, 3),
(2, 1),
(2, 2),
(1, 2),
(1, 1);

CREATE MATERIALIZED VIEW mat1
  TBLPROPERTIES (&lt;span class=&quot;code-quote&quot;&gt;&apos;transactional&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt;) AS
SELECT a
FROM t1
WHERE b &amp;lt; 10;

delete from t1 where b = 2;

alter materialized view mat1 rebuild;

SELECT a
FROM t1
WHERE b &amp;lt; 10;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
3
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;vs&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
drop materialized view mat1;

SELECT a
FROM t1
WHERE b &amp;lt; 10;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
3
2
1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17815643" author="zabetak" created="Thu, 8 Feb 2024 11:38:18 +0000"  >&lt;p&gt;Thanks for the explanation and additional examples. I definitely get a better understanding of the problem by reading those! I approved the PR dropping the incremental rebuild in this case makes sense.&lt;/p&gt;</comment>
                            <comment id="17816498" author="kkasa" created="Mon, 12 Feb 2024 07:18:50 +0000"  >&lt;p&gt;Merged to master. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=amansinha100&quot; class=&quot;user-hover&quot; rel=&quot;amansinha100&quot;&gt;amansinha100&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zabetak&quot; class=&quot;user-hover&quot; rel=&quot;zabetak&quot;&gt;zabetak&lt;/a&gt; for review.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13560157">HIVE-27924</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 39 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1n49k:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>