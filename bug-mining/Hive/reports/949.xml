<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:02:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-3477] Duplicate data possible with speculative execution for dynamic partitions</title>
                <link>https://issues.apache.org/jira/browse/HIVE-3477</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Consider a query like:&lt;/p&gt;

&lt;p&gt;insert overwrite T partition (ds)&lt;br/&gt;
select * from&lt;br/&gt;
(mapreduce-subq1&lt;br/&gt;
  union all&lt;br/&gt;
mapreduce-subq2)x;&lt;/p&gt;

&lt;p&gt;Once, mapreduce-subq1 and mapreduce-subq2 are done, the task for the union&lt;br/&gt;
is invoked. At the end of the union task, jobClose is invoked.&lt;/p&gt;

&lt;p&gt;Note that there are 2 tablescan operators. The tree is something like:&lt;/p&gt;


&lt;p&gt;TABLESCAN1  &amp;#8211;&lt;br/&gt;
              \&lt;br/&gt;
               UNION &amp;#8211; SELECT &amp;#8211; FILESINK&lt;br/&gt;
              /&lt;br/&gt;
TABLESCAN2  &amp;#8211;&lt;/p&gt;


&lt;p&gt;In the current setup, jobClose will be invoked twice for FileSink.&lt;br/&gt;
In case of speculative execution, it is possible that data is still is&lt;br/&gt;
being written to tmp Dir. after jobClose is finished once. &lt;/p&gt;

&lt;p&gt;The correct fix would be to make sure that jobClose is only invoked once.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12608046">HIVE-3477</key>
            <summary>Duplicate data possible with speculative execution for dynamic partitions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="namit">Namit Jain</assignee>
                                    <reporter username="namit">Namit Jain</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Sep 2012 11:23:25 +0000</created>
                <updated>Thu, 10 Jan 2013 19:54:10 +0000</updated>
                            <resolved>Thu, 20 Sep 2012 01:03:52 +0000</resolved>
                                                    <fixVersion>0.10.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13457750" author="namit" created="Tue, 18 Sep 2012 11:24:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.facebook.net/D5505&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D5505&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13457933" author="kevinwilfong" created="Tue, 18 Sep 2012 16:40:54 +0000"  >&lt;p&gt;+1 Nice catch Namit.&lt;/p&gt;</comment>
                            <comment id="13458017" author="ashutoshc" created="Tue, 18 Sep 2012 18:12:33 +0000"  >&lt;p&gt;In general I think we should start adopting &lt;tt&gt;OutputCommitter&lt;/tt&gt; functionality provided by MR framework instead of having our own &lt;tt&gt;JobClose&lt;/tt&gt; operator. Whatever logic we want to run at the end of the query (which is done via JobClose currently) can be run in &lt;tt&gt;commitJob&lt;/tt&gt; of last MR job for the query. This insulates us from having to keep a live hive client around for long running queries. Secondly, we are replicating functionality which is already provided by underlying framework. Possibly, this may also help us in avoiding bugs like this one.&lt;br/&gt;
This definitely is not in scope of this bug, but wanted to bring this up since while fixing this issue you might have more insights into why or why not this may be a good idea.&lt;/p&gt;</comment>
                            <comment id="13458844" author="namit" created="Wed, 19 Sep 2012 16:53:11 +0000"  >&lt;p&gt;All the tests passed.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt;, we can can definitely discuss it in a new jira.&lt;br/&gt;
We dont use OutputCommitter at all right now - since we write into tmp. directories and then move the temp. dirs into the &lt;br/&gt;
final dir.&lt;/p&gt;</comment>
                            <comment id="13458980" author="ashutoshc" created="Wed, 19 Sep 2012 19:03:29 +0000"  >&lt;p&gt;Cool. I created &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3489&quot; title=&quot;Use OutputCommitter to get rid of requirement of client being alive for long running queries &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3489&quot;&gt;HIVE-3489&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13459267" author="kevinwilfong" created="Thu, 20 Sep 2012 01:03:52 +0000"  >&lt;p&gt;Committed, thanks Namit.&lt;/p&gt;</comment>
                            <comment id="13548126" author="hudson" created="Wed, 9 Jan 2013 10:24:29 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #54 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3477&quot; title=&quot;Duplicate data possible with speculative execution for dynamic partitions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3477&quot;&gt;&lt;del&gt;HIVE-3477&lt;/del&gt;&lt;/a&gt;. Duplicate data possible with speculative execution for dynamic partitions. (njain via kevinwilfong) (Revision 1387833)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
kevinwilfong : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1387833&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1387833&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/FileSinkOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/JoinOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13550303" author="ashutoshc" created="Thu, 10 Jan 2013 19:54:10 +0000"  >&lt;p&gt;This issue is fixed and released as part of 0.10.0 release. If you find an issue which seems to be related to this one, please create a new jira and link this one with new jira.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12545551" name="hive.3477.1.patch" size="3113" author="namit" created="Tue, 18 Sep 2012 11:27:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>259265</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 45 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lnvb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>124517</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>