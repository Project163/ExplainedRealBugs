<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:55:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-17188] ObjectStore runs out of memory for large batches of addPartitions().</title>
                <link>https://issues.apache.org/jira/browse/HIVE-17188</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;For large batches (e.g. hundreds) of &lt;tt&gt;addPartitions()&lt;/tt&gt;, the &lt;tt&gt;ObjectStore&lt;/tt&gt; runs out of memory. Flushing the &lt;tt&gt;PersistenceManager&lt;/tt&gt; alleviates the problem.&lt;/p&gt;

&lt;p&gt;Note: The problem being addressed here isn&apos;t so much with the size of the hundreds of Partition objects, but the cruft that builds with the PersistenceManager, in the JDO layer, as confirmed through memory-profiling.&lt;/p&gt;

&lt;p&gt;(Raising this on behalf of &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cdrome&quot; class=&quot;user-hover&quot; rel=&quot;cdrome&quot;&gt;cdrome&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thiruvel&quot; class=&quot;user-hover&quot; rel=&quot;thiruvel&quot;&gt;thiruvel&lt;/a&gt;.)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13090617">HIVE-17188</key>
            <summary>ObjectStore runs out of memory for large batches of addPartitions().</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cdrome">Chris Drome</assignee>
                                    <reporter username="mithun">Mithun Radhakrishnan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Jul 2017 20:41:10 +0000</created>
                <updated>Tue, 22 May 2018 23:58:39 +0000</updated>
                            <resolved>Wed, 2 Aug 2017 18:13:12 +0000</resolved>
                                    <version>2.2.0</version>
                                    <fixVersion>2.2.0</fixVersion>
                    <fixVersion>2.4.0</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16103882" author="mithun" created="Thu, 27 Jul 2017 20:49:22 +0000"  >&lt;p&gt;Here&apos;s the patch ported for &lt;tt&gt;master/&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I wonder if it&apos;s better to flush at an interval, instead of for &lt;b&gt;every&lt;/b&gt; partition.&lt;/p&gt;</comment>
                            <comment id="16103889" author="mithun" created="Thu, 27 Jul 2017 20:50:51 +0000"  >&lt;p&gt;Submitting, to run tests.&lt;/p&gt;</comment>
                            <comment id="16103956" author="vihangk1" created="Thu, 27 Jul 2017 21:38:34 +0000"  >&lt;p&gt;Hi Mithun, thanks for the providing the patch. Can you please update the patch with HIVE specific JIRA number and description of this JIRA as per our convention? You can add a line in the description where this patch was cherry-picked from I you like.. Also, wondering how the patch alleviates the problem? If there are hundreds of partitions being added, aren&apos;t they already in memory in the &lt;tt&gt;List&amp;lt;Partition&amp;gt; parts&lt;/tt&gt; object? If you have any stats to share it would be great. Eg. before --&amp;gt; running out of memory at X number of partitions ; after --&amp;gt; running out of memory at X+Y number of partitions. Thanks!&lt;/p&gt;</comment>
                            <comment id="16104014" author="mithun" created="Thu, 27 Jul 2017 22:24:47 +0000"  >&lt;p&gt;@&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vihangk1&quot; class=&quot;user-hover&quot; rel=&quot;vihangk1&quot;&gt;vihangk1&lt;/a&gt;: Thank you for your attention. :]&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Can you please update the patch with HIVE specific JIRA number and description of this JIRA as per our convention?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sorry, it&apos;s been a while, so perhaps you could clarify for me. My memory of the convention is that patches are named &lt;tt&gt;HIVE-&amp;lt;jira-number&amp;gt;.&amp;lt;version-of-patch&amp;gt;.patch&lt;/tt&gt;. If the patch is a port to another branch, then it&apos;s &lt;tt&gt;HIVE-&amp;lt;jira-number&amp;gt;.&amp;lt;branch&amp;gt;.patch&lt;/tt&gt;. &lt;br/&gt;
From perusing the JIRAs included in &lt;a href=&quot;https://issues.apache.org/jira/projects/HIVE/versions/12335837&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;the Hive 2.2 release&lt;/a&gt;, this seems like the format of choice. Could you please clarify what I&apos;m missing?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;You can add a line in the description where this patch was cherry-picked from I you like..&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This is a port from Yahoo&apos;s internal production branch. The commit dates back to April of 2014. :]&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If there are hundreds of partitions being added, aren&apos;t they already in memory in the &lt;tt&gt;List&amp;lt;Partition&amp;gt;&lt;/tt&gt; parts object?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;A fair question. :] I can try answer this, although &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cdrome&quot; class=&quot;user-hover&quot; rel=&quot;cdrome&quot;&gt;cdrome&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thiruvel&quot; class=&quot;user-hover&quot; rel=&quot;thiruvel&quot;&gt;thiruvel&lt;/a&gt; are really the experts on this one. &lt;br/&gt;
The problem being addressed here isn&apos;t so much with the size of the hundreds of &lt;tt&gt;Partition&lt;/tt&gt; objects, but the cruft that builds with the &lt;tt&gt;PersistenceManager&lt;/tt&gt;, in the JDO layer, as confirmed through memory-profiling.&lt;/p&gt;

&lt;p&gt;Our larger commit also plugged leaks from neglecting to call &lt;tt&gt;Query::close()&lt;/tt&gt;, etc. It looks like those have independently been solved already.&lt;/p&gt;</comment>
                            <comment id="16104030" author="mithun" created="Thu, 27 Jul 2017 22:31:33 +0000"  >&lt;p&gt;P.S. I&apos;ve added clarification in the JIRA description.&lt;/p&gt;

&lt;p&gt;We&apos;ve had a rash of JIRAs with anaemic descriptions recently. I hope this version is more clear.&lt;/p&gt;</comment>
                            <comment id="16104729" author="hiveqa" created="Fri, 28 Jul 2017 09:45:34 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12879241/HIVE-17188.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12879241/HIVE-17188.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 11 failed/errored test(s), 11007 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestPerfCliDriver - did not produce a TEST-*.xml file (likely timed out) (batchId=235)
org.apache.hadoop.hive.cli.TestBeeLineDriver.testCliDriver[insert_overwrite_local_directory_1] (batchId=240)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[llap_smb] (batchId=144)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_dynamic_partition_pruning] (batchId=168)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=168)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainuser_3] (batchId=99)
org.apache.hadoop.hive.cli.TestSparkNegativeCliDriver.org.apache.hadoop.hive.cli.TestSparkNegativeCliDriver (batchId=242)
org.apache.hadoop.hive.metastore.TestHiveMetaStoreStatsMerge.testStatsMerge (batchId=206)
org.apache.hive.hcatalog.api.TestHCatClient.testPartitionRegistrationWithCustomSchema (batchId=179)
org.apache.hive.hcatalog.api.TestHCatClient.testPartitionSpecRegistrationWithCustomSchema (batchId=179)
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation (batchId=179)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6166/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6166/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6166/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6166/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-6166/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-6166/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 11 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12879241 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="16108024" author="mithun" created="Mon, 31 Jul 2017 21:48:53 +0000"  >&lt;p&gt;I&apos;m +1 on this change. This has been running in production for some time now. &lt;/p&gt;

&lt;p&gt;I&apos;d like to commit this to &lt;tt&gt;master&lt;/tt&gt; and &lt;tt&gt;branch-2&lt;/tt&gt;, tomorrow, unless there is objection.&lt;/p&gt;</comment>
                            <comment id="16108132" author="vihangk1" created="Mon, 31 Jul 2017 23:09:44 +0000"  >&lt;p&gt;Looks good to me. &lt;br/&gt;
+1 &lt;/p&gt;</comment>
                            <comment id="16111452" author="mithun" created="Wed, 2 Aug 2017 18:13:12 +0000"  >&lt;p&gt;Committed to &lt;tt&gt;master&lt;/tt&gt;, &lt;tt&gt;branch-2&lt;/tt&gt;, and &lt;tt&gt;branch-2.2&lt;/tt&gt;, as advised by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=owen.omalley&quot; class=&quot;user-hover&quot; rel=&quot;owen.omalley&quot;&gt;owen.omalley&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Thank you, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cdrome&quot; class=&quot;user-hover&quot; rel=&quot;cdrome&quot;&gt;cdrome&lt;/a&gt;, for the patch. Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vihangk1&quot; class=&quot;user-hover&quot; rel=&quot;vihangk1&quot;&gt;vihangk1&lt;/a&gt;, for the review.&lt;/p&gt;</comment>
                            <comment id="16112268" author="lefty@hortonworks.com" created="Thu, 3 Aug 2017 06:32:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mithun&quot; class=&quot;user-hover&quot; rel=&quot;mithun&quot;&gt;mithun&lt;/a&gt;, you should add 2.4.0 to the fix versions, since you also committed this to branch-2 (but not to branch-2.3 for 2.3.0).&lt;/p&gt;</comment>
                            <comment id="16112917" author="vihangk1" created="Thu, 3 Aug 2017 15:20:52 +0000"  >&lt;p&gt;Yes, would probably make sense to merge this in branch-2.3 as well if this is available in 2.2.0 release. Otherwise, this patch would be available in 2.2.0 and 2.4.0 but not in 2.3.0&lt;/p&gt;</comment>
                            <comment id="16113351" author="mithun" created="Thu, 3 Aug 2017 19:32:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=leftylev&quot; class=&quot;user-hover&quot; rel=&quot;leftylev&quot;&gt;leftylev&lt;/a&gt;: Thank you for correcting me. I&apos;ve added 2.4, as per your advice.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;would probably make sense to merge this in branch-2.3 as well...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;A fair point, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vihangk1&quot; class=&quot;user-hover&quot; rel=&quot;vihangk1&quot;&gt;vihangk1&lt;/a&gt;. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pxiong&quot; class=&quot;user-hover&quot; rel=&quot;pxiong&quot;&gt;pxiong&lt;/a&gt;, do I have your permission to merge this into &lt;tt&gt;branch-2.3&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="16486003" author="vgarg" created="Tue, 22 May 2018 23:58:39 +0000"  >&lt;p&gt;Hive 3.0.0 has been released so closing this jira.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12879241" name="HIVE-17188.1.patch" size="868" author="mithun" created="Thu, 27 Jul 2017 20:48:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3i3uv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>