<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:52:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-467] Scratch data location should be on different filesystems for different types of intermediate data</title>
                <link>https://issues.apache.org/jira/browse/HIVE-467</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Currently Hive uses the same scratch directory/path for all sorts of temporary and intermediate data. This is problematic:&lt;/p&gt;

&lt;p&gt;1. Temporary location for writing out DDL output should just be temp file on local file system. This divorces the dependence of metadata and browsing operations on a functioning hadoop cluster.&lt;br/&gt;
2. Temporary location of intermediate map-reduce data should be the default file system (which is typically the hdfs instance on the compute cluster)&lt;br/&gt;
3. Temporary location for data that needs to be &apos;moved&apos; into tables should be on the same file system as the table&apos;s location (table&apos;s location may not be same as hdfs instance of processing cluster).&lt;/p&gt;

&lt;p&gt;ie. - local storage, map-reduce intermediate storage and table storage should be distinguished. Without this distinction - using hive on environments like S3/EC2 causes problems. In such an environment - i would like to be able to:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;do metadata operations without a provisioned hadoop cluster (using data stored in S3 and metastore on local disk)&lt;/li&gt;
	&lt;li&gt;attach to a provisioned hadoop cluster and run queries&lt;/li&gt;
	&lt;li&gt;store data back in tables that are created over s3 file system&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>&lt;p&gt;S3/EC2&lt;/p&gt;</environment>
        <key id="12424438">HIVE-467</key>
            <summary>Scratch data location should be on different filesystems for different types of intermediate data</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jsensarma">Joydeep Sen Sarma</assignee>
                                    <reporter username="jsensarma">Joydeep Sen Sarma</reporter>
                        <labels>
                    </labels>
                <created>Sat, 2 May 2009 03:03:20 +0000</created>
                <updated>Sat, 17 Dec 2011 00:07:38 +0000</updated>
                            <resolved>Thu, 28 May 2009 19:41:51 +0000</resolved>
                                                    <fixVersion>0.4.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="12706714" author="jsensarma" created="Thu, 7 May 2009 04:12:11 +0000"  >&lt;p&gt;first try. need to add some tests (the only thing i can think of right now is making sure that explain and other statements work with invalid hdfs file system setting). if minimr is there - can write better tests.&lt;/p&gt;

&lt;p&gt;i haven&apos;t been able to make select * work without hdfs (since the map operator/intermediate dir are optimized away later after they have already been created). need some ideas on this as well.&lt;/p&gt;</comment>
                            <comment id="12708997" author="jsensarma" created="Wed, 13 May 2009 16:33:19 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;takes care of the issues mentioned here - consolidates all temp file logic into one place with different policies for local/MR/external storage&lt;br/&gt;
a) DDL/Explain operations only require local storage - tests for the same included.&lt;br/&gt;
b) insert operations write to tmp storage on file system of target. ie. if the destination is an external table on s3 - we will write to tmp storage on s3 and then move to target. unfortunately - can&apos;t think of a way to test this since don&apos;t have two functioning file systems&lt;br/&gt;
c) all else get MR intermediate storage.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;fixed a problem with external partitions where insert overwrites into an external partition were not using the external location (but the default location). test for this is included.&lt;/p&gt;

&lt;p&gt;review appreciated - i would like to publish a recipe for working against s3 storage and can&apos;t really do without this.&lt;/p&gt;</comment>
                            <comment id="12709248" author="jsensarma" created="Thu, 14 May 2009 02:32:59 +0000"  >&lt;p&gt;retry - previous attachment was bogus&lt;/p&gt;</comment>
                            <comment id="12709261" author="prasadc" created="Thu, 14 May 2009 04:13:05 +0000"  >&lt;p&gt;Good catch about overwriting external partitions. But that might undo the fix where partition dir can get created a little bit before the actual data is moved (in replaceFiles()). so down stream processes can start before data is moved.&lt;/p&gt;



&lt;p&gt;HiveMetaStore.java:~289 remove System.out.println(tblPath.toString());&lt;br/&gt;
insertexternal1.q: create and alter can be replaced with one stmt. create external table texternal(key string, val string) partitioned by (insertdate string) location &apos;file:///tmp/texternal/2008-01-01&apos;;&lt;br/&gt;
Hive.java: replaceFiles() &amp;#8211; look at the fix for 488&lt;/p&gt;

&lt;p&gt;I am going to let others review the scratch dir related stuff.&lt;/p&gt;</comment>
                            <comment id="12709740" author="jsensarma" created="Fri, 15 May 2009 06:45:05 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;contains one more fix in ExecDriver where addinputpaths was not using the right filesystem&lt;/li&gt;
	&lt;li&gt;removed the system.out.println&lt;/li&gt;
	&lt;li&gt;don&apos;t want to change insertexternal - i wanted the test to specifically cover the case where the partition location is specified to external fs (and the table isn&apos;t - which means it has a default location). the suggested test would have actually passed the old code.&lt;/li&gt;
	&lt;li&gt;Fixed Hive.java to not create partition first.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;i didn&apos;t read carefully through 488 and other jiras. it seems that hive.java&apos;s behavior is exactly the way it is in trunk now except handling the external partition case correctly. if there are other issues with the current code path - we can fix them through a separate jira?&lt;/p&gt;</comment>
                            <comment id="12709859" author="prasadc" created="Fri, 15 May 2009 14:52:27 +0000"  >&lt;p&gt;&amp;gt; with the current code path - we can fix them through a separate jira?&lt;br/&gt;
i just wanted partition to be not  created until data has been moved.&lt;/p&gt;

&lt;p&gt;the load part and the metastore part looks good to me.&lt;/p&gt;</comment>
                            <comment id="12709901" author="jsensarma" created="Fri, 15 May 2009 16:40:40 +0000"  >&lt;p&gt;&amp;gt; i just wanted partition to be not created until data has been moved. &lt;/p&gt;

&lt;p&gt;cool - that&apos;s taken care of .. (although not sure we can test without some kind of fault injection code).&lt;/p&gt;</comment>
                            <comment id="12710066" author="jsensarma" created="Sat, 16 May 2009 04:14:37 +0000"  >&lt;p&gt;would be great if someone could review the rest of the patch. some javadocs were missing on the new public apis - attaching another one.&lt;/p&gt;

&lt;p&gt;he changes are relatively trivial - they just consolidate all the tmp file logic in one place and provide four public api calls from Context.java:&lt;/p&gt;

&lt;p&gt;  public boolean isMRTmpFileURI(String uriStr)&lt;br/&gt;
  public String getMRTmpFileURI() &lt;br/&gt;
  public String getLocalTmpFileURI()   &lt;br/&gt;
  public String getExternalTmpFileURI(URI extURI)&lt;/p&gt;

&lt;p&gt;the semantics are obvious. Context.java is also simplified to not be a reusable object. There are a small number of indent only changes in BaseSemanticAnalyzer.java. Quite a bit of code reduction across the different parts of the compiler that had their own tmp file allocation logic. &lt;/p&gt;
</comment>
                            <comment id="12711914" author="rsm" created="Fri, 22 May 2009 01:26:33 +0000"  >&lt;p&gt;The diff looks good. However, there are several space issues - there should be a space after &apos;if&apos; and &apos;for&apos;. once you fix those, i can commit after running tests.&lt;/p&gt;</comment>
                            <comment id="12712891" author="jsensarma" created="Tue, 26 May 2009 07:34:31 +0000"  >&lt;p&gt;fixed the space issues and resubmitted.&lt;/p&gt;</comment>
                            <comment id="12713356" author="rsm" created="Wed, 27 May 2009 01:13:49 +0000"  >&lt;p&gt;looks good. will commit once tests pass.&lt;/p&gt;</comment>
                            <comment id="12713747" author="jsensarma" created="Wed, 27 May 2009 21:21:36 +0000"  >&lt;p&gt;the Trash constructor i was using was only available in 19.2 onwards. fixed and made sure the patch compiles with all hadoop 17/18/19&lt;/p&gt;</comment>
                            <comment id="12714127" author="rsm" created="Thu, 28 May 2009 19:41:51 +0000"  >&lt;p&gt;Committed. Thanks Joydeep!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12408231" name="hive-467.3.patch" size="77419" author="jsensarma" created="Fri, 15 May 2009 06:45:05 +0000"/>
                            <attachment id="12408306" name="hive-467.4.patch" size="78766" author="jsensarma" created="Sat, 16 May 2009 04:14:37 +0000"/>
                            <attachment id="12409003" name="hive-467.5.patch" size="78608" author="jsensarma" created="Tue, 26 May 2009 07:24:50 +0000"/>
                            <attachment id="12409210" name="hive-467.6.patch" size="78940" author="jsensarma" created="Wed, 27 May 2009 21:21:36 +0000"/>
                            <attachment id="12407420" name="hive-467.patch.1" size="55774" author="jsensarma" created="Thu, 7 May 2009 04:12:11 +0000"/>
                            <attachment id="12408095" name="hive-467.patch.2" size="76035" author="jsensarma" created="Thu, 14 May 2009 02:32:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49724</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 26 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0l9xz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>122261</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>