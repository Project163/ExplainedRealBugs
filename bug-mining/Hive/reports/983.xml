<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:03:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-3544] union involving double column with a map join subquery will fail or give wrong results</title>
                <link>https://issues.apache.org/jira/browse/HIVE-3544</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The following query fails:&lt;br/&gt;
select * from (select cast(a.key as bigint) as key from src a join src b on a.key = b.key union all select cast(key as double) as key from src)a&lt;/p&gt;

&lt;p&gt;The following query gives wrong results:&lt;br/&gt;
select * from (select cast(a.key as bigint) as key, cast(b.key as double) as value from src a join src b on a.key = b.key union all select cast(key as double) as key, cast(key as string) as value from src)a&lt;/p&gt;

&lt;p&gt;But the following query runs fine:&lt;br/&gt;
select * from (select cast(a.key as bigint) as key from src a union all select cast(key as double) as key from src)a&lt;/p&gt;</description>
                <environment></environment>
        <key id="12610746">HIVE-3544</key>
            <summary>union involving double column with a map join subquery will fail or give wrong results</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kevinwilfong">Kevin Wilfong</assignee>
                                    <reporter username="kevinwilfong">Kevin Wilfong</reporter>
                        <labels>
                    </labels>
                <created>Sun, 7 Oct 2012 08:23:23 +0000</created>
                <updated>Thu, 2 May 2013 02:29:56 +0000</updated>
                            <resolved>Fri, 19 Oct 2012 20:06:35 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.10.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13478343" author="kevinwilfong" created="Wed, 17 Oct 2012 20:36:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.facebook.net/D6063&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D6063&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13478346" author="kevinwilfong" created="Wed, 17 Oct 2012 20:37:38 +0000"  >&lt;p&gt;I tracked the problem down to two causes.&lt;/p&gt;

&lt;p&gt;1) In the genUnionPlan, when preparing the ColumnInfo objects to be used to generate the RowResolver for the Union operator, it actually changes the ColumnInfo objects of the left operator&apos;s RowResolver to have the &quot;common class&quot; as its type. This would cause it to get serialized wrong in the intermediate FileSink operator between map reduce jobs (as was the case when the left subquery of the union involved a join).&lt;/p&gt;

&lt;p&gt;2) The common class for a column of the Union operator would get determined once at compile time and again later at run time using different functions which could return different classes (for instance when the type on one side was a double and on the other it was a string). This caused the union operator to return objects with a different type from what the RowResolver specified causing serialization errors/failures.&lt;/p&gt;

&lt;p&gt;To fix 1) I added the ability to clone a ColumnInfo, and in the SemanticAnalyzer the left operator&apos;s ColumnInfo objects are now cloned before being modified.&lt;/p&gt;

&lt;p&gt;To fix 2) I added Select operators between the input operators and the union operator. These select operators cast the input columns to the types determined at compile time if they do not match, otherwise they simply forward the value. Now the conversion in the union operator is only needed to alter the the type of the ObjectInspector, not the type of the column.&lt;/p&gt;</comment>
                            <comment id="13478511" author="kevinwilfong" created="Thu, 18 Oct 2012 00:00:06 +0000"  >&lt;p&gt;Updated my checkout, and uploaded a new patch.&lt;/p&gt;</comment>
                            <comment id="13479329" author="namit" created="Thu, 18 Oct 2012 20:31:08 +0000"  >&lt;p&gt;minor comments on phabricator&lt;/p&gt;</comment>
                            <comment id="13479543" author="kevinwilfong" created="Fri, 19 Oct 2012 01:01:40 +0000"  >&lt;p&gt;Updated per comments.&lt;/p&gt;</comment>
                            <comment id="13480118" author="namit" created="Fri, 19 Oct 2012 16:40:03 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13480334" author="namit" created="Fri, 19 Oct 2012 20:06:35 +0000"  >&lt;p&gt;Committed. Thanks Kevin&lt;/p&gt;</comment>
                            <comment id="13480656" author="hudson" created="Sat, 20 Oct 2012 05:55:36 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #1748 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/1748/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/1748/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3544&quot; title=&quot;union involving double column with a map join subquery will fail or give wrong results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3544&quot;&gt;&lt;del&gt;HIVE-3544&lt;/del&gt;&lt;/a&gt; union involving double column with a map join subquery will fail or give wrong results&lt;br/&gt;
(Kevin Wilfong via namit) (Revision 1400260)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
namit : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1400260&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1400260&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ColumnInfo.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/SelectOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcCtx.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcFactory.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/SelectDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/skewjoinopt11.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/union32.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/groupby_sort_1.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/groupby_sort_skew_1.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/ql_rewrite_gbtoidx.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/skewjoinopt11.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/type_widening.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/union32.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/compiler/plan/union.q.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13548048" author="hudson" created="Wed, 9 Jan 2013 10:24:11 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #54 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3544&quot; title=&quot;union involving double column with a map join subquery will fail or give wrong results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3544&quot;&gt;&lt;del&gt;HIVE-3544&lt;/del&gt;&lt;/a&gt; union involving double column with a map join subquery will fail or give wrong results&lt;br/&gt;
(Kevin Wilfong via namit) (Revision 1400260)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
namit : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1400260&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1400260&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/ColumnInfo.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/SelectOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcCtx.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcFactory.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/SelectDesc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/skewjoinopt11.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/union32.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/groupby_sort_1.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/groupby_sort_skew_1.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/ql_rewrite_gbtoidx.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/skewjoinopt11.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/type_widening.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/union32.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/compiler/plan/union.q.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13550091" author="ashutoshc" created="Thu, 10 Jan 2013 19:53:21 +0000"  >&lt;p&gt;This issue is fixed and released as part of 0.10.0 release. If you find an issue which seems to be related to this one, please create a new jira and link this one with new jira.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12599401">HIVE-3276</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12549608" name="HIVE-3544.1.patch.txt" size="658013" author="kevinwilfong" created="Wed, 17 Oct 2012 23:59:49 +0000"/>
                            <attachment id="12549607" name="HIVE-3544.2.patch.txt" size="658472" author="kevinwilfong" created="Wed, 17 Oct 2012 23:59:08 +0000"/>
                            <attachment id="12549731" name="HIVE-3544.3.patch.txt" size="659530" author="kevinwilfong" created="Thu, 18 Oct 2012 18:57:04 +0000"/>
                            <attachment id="12549790" name="HIVE-3544.4.patch.txt" size="83436" author="kevinwilfong" created="Fri, 19 Oct 2012 01:01:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>244945</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 45 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05wsf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32409</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>