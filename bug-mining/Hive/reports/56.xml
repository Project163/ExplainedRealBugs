<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:51:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-25] [Hive] cluster by does not work with column aliasing</title>
                <link>https://issues.apache.org/jira/browse/HIVE-25</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;                    SELECT b.*  &lt;br/&gt;
                    FROM                                                 &lt;br/&gt;
                    (                                                    &lt;br/&gt;
                      SELECT x.col1, x.col2&lt;br/&gt;
                      FROM tmp x              &lt;br/&gt;
                      WHERE x.col2= 10&lt;br/&gt;
                      CLUSTER BY col2                                  &lt;br/&gt;
                    ) b&quot;&lt;/p&gt;


&lt;p&gt;The above query works, but if I change the cluster by to:&lt;/p&gt;

&lt;p&gt;CLUSTER BY x.col2, &lt;/p&gt;

&lt;p&gt;it croaks.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12407101">HIVE-25</key>
            <summary>[Hive] cluster by does not work with column aliasing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="prasadc">Prasad Chakka</assignee>
                                    <reporter username="namit">Namit Jain</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Oct 2008 16:18:53 +0000</created>
                <updated>Sat, 17 Dec 2011 00:08:56 +0000</updated>
                            <resolved>Wed, 21 Jan 2009 00:58:23 +0000</resolved>
                                                    <fixVersion>0.3.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12662714" author="prasadc" created="Sun, 11 Jan 2009 02:44:23 +0000"  >&lt;p&gt;Attached is the proposed code changes. Fix for this seems to be more complex that I originally thought.&lt;/p&gt;

&lt;p&gt;This fix will work for below type of queries. The fix attempts to make all column references with in a parenthesis refer to tables specified in the from clause.&lt;/p&gt;

&lt;p&gt;SELECT x.*  FROM SRC x CLUSTER BY x.key;&lt;/p&gt;

&lt;p&gt;SELECT y.* from (SELECT x.* FROM SRC x CLUSTER BY key) y where y.key = 20;&lt;/p&gt;

&lt;p&gt;SELECT y.* from (SELECT x.* FROM SRC x CLUSTER BY x.key) y where y.key = 20;&lt;/p&gt;

&lt;p&gt;Would appreciate your thoughts on this.&lt;/p&gt;</comment>
                            <comment id="12662715" author="prasadc" created="Sun, 11 Jan 2009 02:47:19 +0000"  >&lt;p&gt;this contains changes to tests as well...&lt;/p&gt;</comment>
                            <comment id="12663519" author="athusoo" created="Tue, 13 Jan 2009 22:43:19 +0000"  >&lt;p&gt;In Hive.g the change to the rule for columnNameOrder will also change the ddl (the tablebuckets rule) and there we clearly do not have a notion of tableColumn as there is no table alias. &lt;/p&gt;

&lt;p&gt;We need to think a bit to see if we really want to lift this restriction. The reason it was modeled like this was because of the transform operator. Basically, the cluster by clause addresses the alias list instead of the select expressions. There are no tangible select expressions in the transform case. &lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="12663560" author="prasadc" created="Wed, 14 Jan 2009 00:11:42 +0000"  >&lt;p&gt;I will change Hive.g so that sortOrder in DDL can only have identifiers and not column refs.&lt;/p&gt;

&lt;p&gt;The way I want to do this is to allow select columns to be referenced in cluster/distributed/sort clauses according to following rules&lt;/p&gt;

&lt;p&gt;1) column has an alias in the select clause. this column can only be referred with the alias in the above 3 clauses&lt;br/&gt;
2) column doesn&apos;t have an alias but it may have table alias. this column can be referred with the columnName or tabAlias.columnName in the above 3 clauses.&lt;/p&gt;

&lt;p&gt;where clause can only contain tabAlias.columnName and is different from above rules.&lt;/p&gt;

&lt;p&gt;I will upload modified patch with tests for all the above conditions. How about it?&lt;/p&gt;</comment>
                            <comment id="12663579" author="prasadc" created="Wed, 14 Jan 2009 00:58:56 +0000"  >&lt;p&gt;here is the correct patch with the changes mentioned above.&lt;/p&gt;

&lt;p&gt;cluster.q contains following queries and clustern1.q and clustern2.q contains negative testcases&lt;/p&gt;

&lt;p&gt;EXPLAIN&lt;br/&gt;
SELECT x.key, x.value as v1, y.*  FROM SRC x JOIN SRC y ON (x.key = y.key) CLUSTER BY v1;&lt;/p&gt;

&lt;p&gt;EXPLAIN&lt;br/&gt;
SELECT x.key, x.value as v1, y.*  FROM SRC x JOIN SRC y ON (x.key = y.key) CLUSTER BY x.key;&lt;/p&gt;

&lt;p&gt;EXPLAIN&lt;br/&gt;
SELECT x.key, x.value as v1, y.key as yk  FROM SRC x JOIN SRC y ON (x.key = y.key) CLUSTER BY key;&lt;/p&gt;

&lt;p&gt;EXPLAIN&lt;br/&gt;
SELECT * FROM SRC x CLUSTER BY x.key;&lt;/p&gt;

&lt;p&gt;EXPLAIN&lt;br/&gt;
SELECT * FROM SRC x CLUSTER BY key;&lt;/p&gt;

&lt;p&gt;EXPLAIN&lt;br/&gt;
SELECT x.* FROM SRC x CLUSTER BY key;&lt;/p&gt;

&lt;p&gt;EXPLAIN&lt;br/&gt;
SELECT x.*  FROM SRC x CLUSTER BY x.key;&lt;/p&gt;

&lt;p&gt;EXPLAIN&lt;br/&gt;
SELECT x.key, x.value as v1 FROM SRC x CLUSTER BY key;&lt;/p&gt;

&lt;p&gt;EXPLAIN&lt;br/&gt;
SELECT x.key, x.value as v1 FROM SRC x CLUSTER BY x.key;&lt;/p&gt;

&lt;p&gt;EXPLAIN&lt;br/&gt;
SELECT x.key, x.value as v1  FROM SRC x CLUSTER BY v1;&lt;/p&gt;
</comment>
                            <comment id="12664641" author="athusoo" created="Fri, 16 Jan 2009 19:33:15 +0000"  >&lt;p&gt;Comments from the code review with Prasad:&lt;/p&gt;

&lt;p&gt;1. Please run the queries also apart from the explain plans in the test cases&lt;br/&gt;
2. Union all case should also be added to the tests&lt;br/&gt;
3. In SemanticAnalyzer.java:1085 the check for identifier is not needed.&lt;br/&gt;
4. getColAliasFromRef does nothing so it can be removed.&lt;/p&gt;

&lt;p&gt;Also as we discussed, bigger changes are needed to support:&lt;br/&gt;
1. select a.key, a.key from a&lt;br/&gt;
2. complex columns are broken in the query because the table alias is optional.&lt;/p&gt;

&lt;p&gt;Please file separate JIRAs for those.&lt;/p&gt;</comment>
                            <comment id="12664718" author="prasadc" created="Fri, 16 Jan 2009 22:39:44 +0000"  >&lt;p&gt;queries of the form &apos;select a.key. a.key from a&apos; seem to be working.&lt;/p&gt;

&lt;p&gt;i will upload patch that adds the new testcases as suggested.&lt;/p&gt;</comment>
                            <comment id="12665488" author="prasadc" created="Tue, 20 Jan 2009 18:09:33 +0000"  >&lt;p&gt;added more tests as suggested&lt;/p&gt;</comment>
                            <comment id="12665579" author="athusoo" created="Tue, 20 Jan 2009 21:50:31 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;looks good to me.&lt;/p&gt;</comment>
                            <comment id="12665596" author="athusoo" created="Tue, 20 Jan 2009 22:24:24 +0000"  >&lt;p&gt;I am seeing a number of test failures both in clientpositive and clientnegative...&lt;/p&gt;

&lt;p&gt;Can you rerun and check that all the tests are passing.&lt;/p&gt;</comment>
                            <comment id="12665644" author="prasadc" created="Wed, 21 Jan 2009 00:23:54 +0000"  >&lt;p&gt;couple of new tests were added that were breaking which i fixed them.&lt;br/&gt;
remove CliDriver.java which got into previous patch by mistake and which was breaking TestNegativeCliDriver tests.&lt;/p&gt;</comment>
                            <comment id="12665664" author="athusoo" created="Wed, 21 Jan 2009 00:58:23 +0000"  >&lt;p&gt;committed. Thanks Prasad!!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12412636">HIVE-238</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12397631" name="hive-25-code-changes.patch" size="9752" author="prasadc" created="Sun, 11 Jan 2009 02:44:23 +0000"/>
                            <attachment id="12397846" name="hive-25.2.patch" size="86791" author="prasadc" created="Wed, 14 Jan 2009 00:58:55 +0000"/>
                            <attachment id="12398317" name="hive-25.3.patch" size="139050" author="prasadc" created="Tue, 20 Jan 2009 18:09:33 +0000"/>
                            <attachment id="12398356" name="hive-25.4.patch" size="139509" author="prasadc" created="Wed, 21 Jan 2009 00:23:54 +0000"/>
                            <attachment id="12397632" name="hive-25.patch" size="63500" author="prasadc" created="Sun, 11 Jan 2009 02:47:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73826</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 45 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0iv2n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>108128</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>enables table aliases in cluster by, distribute by, sort by clauses.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>