<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:35:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-11284] Fix cbo_rp_join0 failure on master</title>
                <link>https://issues.apache.org/jira/browse/HIVE-11284</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;It first failed in this build : &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4621/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4621/&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12845704">HIVE-11284</key>
            <summary>Fix cbo_rp_join0 failure on master</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jcamacho">Jes&#250;s Camacho Rodr&#237;guez</assignee>
                                    <reporter username="ashutoshc">Ashutosh Chauhan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Jul 2015 20:13:55 +0000</created>
                <updated>Tue, 27 Feb 2024 22:23:49 +0000</updated>
                            <resolved>Sat, 18 Jul 2015 10:15:42 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>CBO</component>
                    <component>Query Planning</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14630257" author="ashutoshc" created="Thu, 16 Jul 2015 20:15:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jcamachorodriguez&quot; class=&quot;user-hover&quot; rel=&quot;jcamachorodriguez&quot;&gt;jcamachorodriguez&lt;/a&gt; Would you like to take a look? Seems like either &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11251&quot; title=&quot;CBO (Calcite Return Path): Extending ExprNodeConverter to consider additional types&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11251&quot;&gt;&lt;del&gt;HIVE-11251&lt;/del&gt;&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11223&quot; title=&quot;CBO (Calcite Return Path): MapJoin and SMBJoin conversion not triggered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11223&quot;&gt;&lt;del&gt;HIVE-11223&lt;/del&gt;&lt;/a&gt; broke it?&lt;/p&gt;</comment>
                            <comment id="14631778" author="jcamacho" created="Fri, 17 Jul 2015 19:25:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt;, actually it was the interaction of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11252&quot; title=&quot;CBO (Calcite Return Path): DUMMY project in plan&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11252&quot;&gt;&lt;del&gt;HIVE-11252&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11223&quot; title=&quot;CBO (Calcite Return Path): MapJoin and SMBJoin conversion not triggered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11223&quot;&gt;&lt;del&gt;HIVE-11223&lt;/del&gt;&lt;/a&gt;, and I didn&apos;t realize as the QA run on both at the same time. This patch solves the issue.&lt;/p&gt;</comment>
                            <comment id="14631802" author="hiveqa" created="Fri, 17 Jul 2015 19:46:10 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12745846/HIVE-11284.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12745846/HIVE-11284.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 1 failed/errored test(s), 9225 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hive.hcatalog.streaming.TestStreaming.testTransactionBatchCommit_Json
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4638/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4638/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4638/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4638/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4638/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4638/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12745846 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14631813" author="ashutoshc" created="Fri, 17 Jul 2015 19:55:46 +0000"  >&lt;p&gt;Can you briefly explain what was the issue and how is patch fixing it?&lt;/p&gt;</comment>
                            <comment id="14631924" author="jcamacho" created="Fri, 17 Jul 2015 21:19:39 +0000"  >&lt;p&gt;Sure.&lt;/p&gt;

&lt;p&gt;==&lt;br/&gt;
Background:&lt;br/&gt;
When RT is on, HiveJoinToMultiJoinRule is responsible for creating MultiJoin operators out of Join operators (if possible). But the plan might be the following:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Join(...)
    Project(...)
        Join(...)
            ...
    Filter(...)
        ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 
&lt;p&gt;Thus, first we need to pull up the Project operator(s) through Join(s) using HiveJoinProjectTransposeRule, to obtain:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Project(...)
    Join(...)
        Join(...)
            ...
    Filter(...)
        ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 
&lt;p&gt;Then, HiveJoinToMultiJoinRule will find both Join operators and merge them. Finally, the Project operator(s) will be pushed down again throw the tree (this is done by HiveRelTrimmer).&lt;/p&gt;

&lt;p&gt;==&lt;br/&gt;
Problem:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11223&quot; title=&quot;CBO (Calcite Return Path): MapJoin and SMBJoin conversion not triggered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11223&quot;&gt;&lt;del&gt;HIVE-11223&lt;/del&gt;&lt;/a&gt; enabled the return path for the cbo_rp_join0.q test.&lt;br/&gt;
At the same time, &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11252&quot; title=&quot;CBO (Calcite Return Path): DUMMY project in plan&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11252&quot;&gt;&lt;del&gt;HIVE-11252&lt;/del&gt;&lt;/a&gt; changed the application of the rules.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Before &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11252&quot; title=&quot;CBO (Calcite Return Path): DUMMY project in plan&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11252&quot;&gt;&lt;del&gt;HIVE-11252&lt;/del&gt;&lt;/a&gt;, HiveJoinToMultiJoinRule was applied first, then HiveJoinProjectTransposeRule + HiveJoinToMultiJoinRule. This was merging the operators correctly, because no projects were found in between the Joins.&lt;/li&gt;
	&lt;li&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11252&quot; title=&quot;CBO (Calcite Return Path): DUMMY project in plan&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11252&quot;&gt;&lt;del&gt;HIVE-11252&lt;/del&gt;&lt;/a&gt;, only HiveJoinToMultiJoinRule + HiveJoinProjectTransposeRule are applied (this is correct). The problem is that 1) HiveJoinProjectTransposeRule.LEFT and HiveJoinProjectTransposeRule.RIGHT were not enabled, and 2) even if they were enabled, they were not working as expected (more on this below). That&apos;s why the test failed.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;==&lt;br/&gt;
Solution:&lt;br/&gt;
HiveJoinProjectTransposeRule.LEFT and HiveJoinProjectTransposeRule.RIGHT get enabled in the patch. In addition, JoinProjectTransposeRule was only working on inner joins, but we need it to work also on outer joins in Hive. That&apos;s why I had to bring so much code from the Calcite superclass (JoinProjectTransposeRule) to the Hive subclass (HiveJoinProjectTransposeRule) to solve the issue. I plan to create a Calcite patch so we can use JoinProjectTransposeRule with all kind of Joins. &lt;/p&gt;</comment>
                            <comment id="14631933" author="ashutoshc" created="Fri, 17 Jul 2015 21:25:57 +0000"  >&lt;p&gt;Cool. +1&lt;/p&gt;</comment>
                            <comment id="14632360" author="jcamacho" created="Sat, 18 Jul 2015 10:15:42 +0000"  >&lt;p&gt;Pushed to master.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12745846" name="HIVE-11284.patch" size="11754" author="jcamachorodriguez" created="Fri, 17 Jul 2015 17:36:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2hctr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>