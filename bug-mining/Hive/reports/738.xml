<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:59:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-2253] Merge failing of join tree in exceptional case</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2253</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;In some very exceptional cases, SemanticAnayzer fails to merge join tree. Example is below.&lt;/p&gt;

&lt;p&gt;create table a (val1 int, val2 int)&lt;br/&gt;
create table b (val1 int, val2 int)&lt;br/&gt;
create table c (val1 int, val2 int)&lt;br/&gt;
create table d (val1 int, val2 int)&lt;br/&gt;
create table e (val1 int, val2 int)&lt;/p&gt;

&lt;p&gt;1. all same(single) join key --&amp;gt; one MR, good&lt;br/&gt;
select * from a join b on a.val1=b.val1 join c on a.val1=c.val1 join d on a.val1=d.val1 join e on a.val1=e.val1&lt;/p&gt;

&lt;p&gt;2. two join keys --&amp;gt; expected to have two MR, but resulted to three MR&lt;br/&gt;
select * from a join b on a.val1=b.val1 join c on a.val1=c.val1 join d on a.val1=d.val1 join e on a.val2=e.val2&lt;/p&gt;

&lt;p&gt;3. by changing the join order, we could attain two MR as first-expectation.&lt;br/&gt;
select * from a join e on a.val2=e.val2 join c on a.val1=c.val1 join d on a.val1=d.val1 join b on a.val1=b.val1&lt;/p&gt;</description>
                <environment>&lt;p&gt;hadoop 0.20.2, hive 0.7.0&lt;/p&gt;</environment>
        <key id="12512698">HIVE-2253</key>
            <summary>Merge failing of join tree in exceptional case</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="navis">Navis Ryu</assignee>
                                    <reporter username="navis">Navis Ryu</reporter>
                        <labels>
                    </labels>
                <created>Mon, 4 Jul 2011 07:45:19 +0000</created>
                <updated>Fri, 16 Dec 2011 23:56:33 +0000</updated>
                            <resolved>Thu, 1 Dec 2011 20:28:05 +0000</resolved>
                                    <version>0.9.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13060030" author="jvs" created="Tue, 5 Jul 2011 17:37:00 +0000"  >&lt;p&gt;We&apos;ll need a small unit test with EXPLAIN for this case.&lt;/p&gt;</comment>
                            <comment id="13060337" author="navis" created="Wed, 6 Jul 2011 07:24:30 +0000"  >&lt;p&gt;added unit test&lt;/p&gt;</comment>
                            <comment id="13061479" author="jvs" created="Thu, 7 Jul 2011 18:39:29 +0000"  >&lt;p&gt;If this patch is ready for review, click the Submit Patch button.&lt;/p&gt;</comment>
                            <comment id="13061858" author="navis" created="Fri, 8 Jul 2011 09:11:04 +0000"  >&lt;p&gt;missed granting ASF license part.&lt;/p&gt;</comment>
                            <comment id="13061859" author="navis" created="Fri, 8 Jul 2011 09:11:50 +0000"  >&lt;p&gt;minor fix.&lt;/p&gt;</comment>
                            <comment id="13063536" author="jvs" created="Mon, 11 Jul 2011 21:00:54 +0000"  >&lt;p&gt;Also please create a Review Board entry in reviews.apache.org.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/HowToContribute#HowToContribute-ReviewProcess&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/Hive/HowToContribute#HowToContribute-ReviewProcess&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13079824" author="navis" created="Fri, 5 Aug 2011 08:26:40 +0000"  >&lt;p&gt;changed to git patch&lt;/p&gt;</comment>
                            <comment id="13132308" author="navis" created="Fri, 21 Oct 2011 03:50:48 +0000"  >&lt;p&gt;merged to 0.8.0-SNAPSHOT&lt;/p&gt;</comment>
                            <comment id="13135237" author="namit" created="Tue, 25 Oct 2011 17:06:09 +0000"  >&lt;p&gt;@Navis, your code changes look good.&lt;br/&gt;
Thanks for catching this.&lt;/p&gt;

&lt;p&gt;For testing, the convention we have adopted is to have a test file for such a case.&lt;br/&gt;
Look at the *.q files in ql/src/test/queries/clientpositive&lt;/p&gt;

&lt;p&gt;Add a new .q file (say, mergejoins.q)&lt;br/&gt;
Add a explain plan in the .q file to check the number of map-reduce jobs etc.&lt;/p&gt;

&lt;p&gt;You can run the test by executing:&lt;/p&gt;

&lt;p&gt;ant test -Dtestcase=TestCliDriver -Dqfile=mergejoins.q &lt;/p&gt;

&lt;p&gt;Verify that the output file mergejoins.q.out is correct, and check it in&lt;br/&gt;
ql/src/results/clientpositive&lt;/p&gt;

</comment>
                            <comment id="13150295" author="jiraposter@reviews.apache.org" created="Tue, 15 Nov 2011 08:13:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1304/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/1304/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-11-15 08:13:13.468713)&lt;/p&gt;


&lt;p&gt;Review request for hive and namit jain.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Rebased patch to trunk&lt;/p&gt;


&lt;p&gt;Summary (updated)&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;It&apos;s very very rare case.. just for code completeness.&lt;/p&gt;

&lt;p&gt;&amp;lt;added&amp;gt; &lt;/p&gt;

&lt;p&gt;This case had happened in real query. It was not as rare as we thought. Fix this plz.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2253&quot; title=&quot;Merge failing of join tree in exceptional case&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2253&quot;&gt;&lt;del&gt;HIVE-2253&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2253&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2253&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java d60ba09 &lt;br/&gt;
  ql/src/test/queries/clientpositive/mergejoins.q PRE-CREATION &lt;br/&gt;
  ql/src/test/results/clientpositive/mergejoins.q.out PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1304/diff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/1304/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing (updated)&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Test case added : clientpositive/mergejoins.q&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Navis&lt;/p&gt;
</comment>
                            <comment id="13155458" author="cwsteinbach" created="Tue, 22 Nov 2011 21:39:08 +0000"  >&lt;p&gt;Is this ready for review? If so, please change the status to Patch Available. Thanks.&lt;/p&gt;</comment>
                            <comment id="13161117" author="jvs" created="Thu, 1 Dec 2011 20:28:05 +0000"  >&lt;p&gt;+1, passed tests, committed to trunk.  Thanks Navis!&lt;/p&gt;</comment>
                            <comment id="13161334" author="hudson" created="Fri, 2 Dec 2011 01:03:09 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #1117 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/1117/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/1117/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2253&quot; title=&quot;Merge failing of join tree in exceptional case&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2253&quot;&gt;&lt;del&gt;HIVE-2253&lt;/del&gt;&lt;/a&gt;. Merge failing of join tree in exceptional case&lt;br/&gt;
(Navis Ryu via jvs)&lt;/p&gt;

&lt;p&gt;jvs : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1209226&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1209226&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/mergejoins.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/mergejoins.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12500080" name="HIVE-2253-0.8.0.patch" size="4362" author="navis" created="Fri, 21 Oct 2011 03:50:47 +0000"/>
                            <attachment id="12503721" name="HIVE-2253.1.patch.txt" size="9428" author="navis" created="Tue, 15 Nov 2011 08:04:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42206</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 51 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lj5r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123754</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>