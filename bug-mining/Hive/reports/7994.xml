<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:20:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-25258] Incorrect row order after query-based MINOR compaction</title>
                <link>https://issues.apache.org/jira/browse/HIVE-25258</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The query based MINOR compaction uses the following sorting order in its inner query: `bucket`, `originalTransaction`, `rowId`, as it can be seen in the &lt;a href=&quot;https://github.com/apache/hive/blob/d0bbe76ad626244802d062b0a93a9f1cd4fc5f20/ql/src/java/org/apache/hadoop/hive/ql/txn/compactor/CompactionQueryBuilder.java#L474-L476&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;code&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;But actually the rows should be ordered by originalTransactionId, bucketProperty and rowId, otherwise the delete deltas cannot be applied correctly. And this is the order what the MR MAJOR and MR MINOR compactions write. &lt;br/&gt;
The sorting order used by the query-based MINOR compaction can lead to duplicated rows when running the compaction after multiple merge statements. This issue can be reproduced for example by running the following queries:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE TABLE transactions(id int,value string) STORED AS ORC TBLPROPERTIES (&apos;transactional&apos;=&apos;true&apos;);
INSERT INTO transactions VALUES
(1, &apos;value_01&apos;),(2, &apos;value_02&apos;),(3, &apos;value_03&apos;),(4, &apos;value_04&apos;),(5, &apos;value_05&apos;),(6, &apos;value_06&apos;),(7, &apos;value_07&apos;),(8, &apos;value_08&apos;);


CREATE TABLE merge_source_1(ID int,value string) STORED AS ORC;
INSERT INTO merge_source_1 VALUES (1, &apos;newvalue_1&apos;),(2, &apos;newvalue_2&apos;),(4, &apos;newvalue_4&apos;),(6, &apos;newvalue_6&apos;),(9, &apos;value_9&apos;),(10, &apos;value_10&apos;),(11, &apos;value_11&apos;),(12, &apos;value_12&apos;);

MERGE INTO transactions AS T USING merge_source_1 AS S ON T.ID = S.ID 
WHEN MATCHED AND (T.value != S.value AND S.value IS NOT NULL) THEN UPDATE SET value = S.value 
WHEN NOT MATCHED THEN INSERT VALUES (S.ID, S.value);


CREATE TABLE merge_source_2(ID int, value string) STORED AS ORC;
INSERT INTO merge_source_2 VALUES
  (2, &apos;newestvalue_2&apos;),(4, &apos;newestvalue_4&apos;),(6, &apos;newestvalue_6&apos;),(10, &apos;newestvalue_10&apos;),(11, &apos;newestvalue_11&apos;),(13, &apos;value_13&apos;),(14, &apos;value_14&apos;);

MERGE INTO transactions AS T 
USING merge_source_2 AS S
ON T.ID = S.ID
WHEN MATCHED AND (T.value != S.value AND S.value IS NOT NULL) THEN UPDATE SET value = S.value
WHEN NOT MATCHED THEN INSERT VALUES (S.ID, S.value);


ALTER TABLE transactions COMPACT &apos;MINOR&apos;;


CREATE TABLE merge_source_3(ID int, value string) STORED AS ORC;
INSERT INTO merge_source_3 VALUES
  (1, &apos;latestvalue_1&apos;),(4, &apos;latestvalue_4&apos;),(5, &apos;latestvalue_5&apos;),(9, &apos;latestvalue_9&apos;),(11, &apos;latestvalue_11&apos;),(13, &apos;latestvalue_13&apos;),(15, &apos;value_15&apos;);

MERGE INTO transactions AS T 
USING merge_source_3 AS S
ON T.ID = S.ID
WHEN MATCHED AND (T.value != S.value AND S.value IS NOT NULL) THEN UPDATE SET value = S.value
WHEN NOT MATCHED THEN INSERT VALUES (S.ID, S.value);

ALTER TABLE transactions COMPACT &apos;MINOR&apos;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Running a select after the second compaction finished will return duplicated rows:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;select * from transactions order by id;

+------------------+---------------------+
| transactions.id  | transactions.value  |
+------------------+---------------------+
| 1                | newvalue_1          |
| 1                | latestvalue_1       |
| 2                | newestvalue_2       |
| 2                | newvalue_2          |
| 3                | value_03            |
| 4                | latestvalue_4       |
| 4                | newvalue_4          |
| 5                | latestvalue_5       |
| 6                | newvalue_6          |
| 6                | newestvalue_6       |
| 7                | value_07            |
| 8                | value_08            |
| 9                | latestvalue_9       |
| 10               | newestvalue_10      |
| 11               | latestvalue_11      |
| 12               | value_12            |
| 13               | latestvalue_13      |
| 14               | value_14            |
| 15               | value_15            |
+------------------+---------------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If the same queries are run with MR MINOR compaction, instead of the query-based MINOR compaction, the select will return the correct result:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+------------------+---------------------+
| transactions.id  | transactions.value  |
+------------------+---------------------+
| 1                | latestvalue_1       |
| 2                | newestvalue_2       |
| 3                | value_03            |
| 4                | latestvalue_4       |
| 5                | latestvalue_5       |
| 6                | newestvalue_6       |
| 7                | value_07            |
| 8                | value_08            |
| 9                | latestvalue_9       |
| 10               | newestvalue_10      |
| 11               | latestvalue_11      |
| 12               | value_12            |
| 13               | latestvalue_13      |
| 14               | value_14            |
| 15               | value_15            |
+------------------+---------------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The content of the bucket files in the delta and delete delta directories after the query-based and MR compactions look like this.&lt;br/&gt;
Query-based&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Processing data file tmp/transactions/delta_0000001_0000004_v0000429/bucket_00000 [length: 947]
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowid&quot;:0,&quot;currenttransaction&quot;:1,&quot;row&quot;:{&quot;id&quot;:1,&quot;value&quot;:&quot;value_01&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowid&quot;:1,&quot;currenttransaction&quot;:1,&quot;row&quot;:{&quot;id&quot;:2,&quot;value&quot;:&quot;value_02&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowid&quot;:2,&quot;currenttransaction&quot;:1,&quot;row&quot;:{&quot;id&quot;:3,&quot;value&quot;:&quot;value_03&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowid&quot;:3,&quot;currenttransaction&quot;:1,&quot;row&quot;:{&quot;id&quot;:4,&quot;value&quot;:&quot;value_04&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowid&quot;:4,&quot;currenttransaction&quot;:1,&quot;row&quot;:{&quot;id&quot;:5,&quot;value&quot;:&quot;value_05&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowid&quot;:5,&quot;currenttransaction&quot;:1,&quot;row&quot;:{&quot;id&quot;:6,&quot;value&quot;:&quot;value_06&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowid&quot;:6,&quot;currenttransaction&quot;:1,&quot;row&quot;:{&quot;id&quot;:7,&quot;value&quot;:&quot;value_07&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowid&quot;:7,&quot;currenttransaction&quot;:1,&quot;row&quot;:{&quot;id&quot;:8,&quot;value&quot;:&quot;value_08&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:2,&quot;bucket&quot;:536870912,&quot;rowid&quot;:0,&quot;currenttransaction&quot;:2,&quot;row&quot;:{&quot;id&quot;:9,&quot;value&quot;:&quot;value_9&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:2,&quot;bucket&quot;:536870912,&quot;rowid&quot;:1,&quot;currenttransaction&quot;:2,&quot;row&quot;:{&quot;id&quot;:10,&quot;value&quot;:&quot;value_10&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:2,&quot;bucket&quot;:536870912,&quot;rowid&quot;:2,&quot;currenttransaction&quot;:2,&quot;row&quot;:{&quot;id&quot;:11,&quot;value&quot;:&quot;value_11&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:2,&quot;bucket&quot;:536870912,&quot;rowid&quot;:3,&quot;currenttransaction&quot;:2,&quot;row&quot;:{&quot;id&quot;:12,&quot;value&quot;:&quot;value_12&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:3,&quot;bucket&quot;:536870912,&quot;rowid&quot;:0,&quot;currenttransaction&quot;:3,&quot;row&quot;:{&quot;id&quot;:13,&quot;value&quot;:&quot;value_13&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:3,&quot;bucket&quot;:536870912,&quot;rowid&quot;:1,&quot;currenttransaction&quot;:3,&quot;row&quot;:{&quot;id&quot;:14,&quot;value&quot;:&quot;value_14&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:4,&quot;bucket&quot;:536870912,&quot;rowid&quot;:0,&quot;currenttransaction&quot;:4,&quot;row&quot;:{&quot;id&quot;:15,&quot;value&quot;:&quot;value_15&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:2,&quot;bucket&quot;:536870913,&quot;rowid&quot;:0,&quot;currenttransaction&quot;:2,&quot;row&quot;:{&quot;id&quot;:1,&quot;value&quot;:&quot;newvalue_1&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:2,&quot;bucket&quot;:536870913,&quot;rowid&quot;:1,&quot;currenttransaction&quot;:2,&quot;row&quot;:{&quot;id&quot;:2,&quot;value&quot;:&quot;newvalue_2&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:2,&quot;bucket&quot;:536870913,&quot;rowid&quot;:2,&quot;currenttransaction&quot;:2,&quot;row&quot;:{&quot;id&quot;:4,&quot;value&quot;:&quot;newvalue_4&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:2,&quot;bucket&quot;:536870913,&quot;rowid&quot;:3,&quot;currenttransaction&quot;:2,&quot;row&quot;:{&quot;id&quot;:6,&quot;value&quot;:&quot;newvalue_6&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:3,&quot;bucket&quot;:536870913,&quot;rowid&quot;:0,&quot;currenttransaction&quot;:3,&quot;row&quot;:{&quot;id&quot;:10,&quot;value&quot;:&quot;newestvalue_10&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:3,&quot;bucket&quot;:536870913,&quot;rowid&quot;:1,&quot;currenttransaction&quot;:3,&quot;row&quot;:{&quot;id&quot;:11,&quot;value&quot;:&quot;newestvalue_11&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:3,&quot;bucket&quot;:536870913,&quot;rowid&quot;:2,&quot;currenttransaction&quot;:3,&quot;row&quot;:{&quot;id&quot;:2,&quot;value&quot;:&quot;newestvalue_2&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:3,&quot;bucket&quot;:536870913,&quot;rowid&quot;:3,&quot;currenttransaction&quot;:3,&quot;row&quot;:{&quot;id&quot;:4,&quot;value&quot;:&quot;newestvalue_4&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:3,&quot;bucket&quot;:536870913,&quot;rowid&quot;:4,&quot;currenttransaction&quot;:3,&quot;row&quot;:{&quot;id&quot;:6,&quot;value&quot;:&quot;newestvalue_6&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:4,&quot;bucket&quot;:536870913,&quot;rowid&quot;:0,&quot;currenttransaction&quot;:4,&quot;row&quot;:{&quot;id&quot;:5,&quot;value&quot;:&quot;latestvalue_5&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:4,&quot;bucket&quot;:536870913,&quot;rowid&quot;:1,&quot;currenttransaction&quot;:4,&quot;row&quot;:{&quot;id&quot;:9,&quot;value&quot;:&quot;latestvalue_9&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:4,&quot;bucket&quot;:536870913,&quot;rowid&quot;:2,&quot;currenttransaction&quot;:4,&quot;row&quot;:{&quot;id&quot;:1,&quot;value&quot;:&quot;latestvalue_1&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:4,&quot;bucket&quot;:536870913,&quot;rowid&quot;:3,&quot;currenttransaction&quot;:4,&quot;row&quot;:{&quot;id&quot;:13,&quot;value&quot;:&quot;latestvalue_13&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:4,&quot;bucket&quot;:536870913,&quot;rowid&quot;:4,&quot;currenttransaction&quot;:4,&quot;row&quot;:{&quot;id&quot;:11,&quot;value&quot;:&quot;latestvalue_11&quot;}}
{&quot;operation&quot;:0,&quot;originaltransaction&quot;:4,&quot;bucket&quot;:536870913,&quot;rowid&quot;:5,&quot;currenttransaction&quot;:4,&quot;row&quot;:{&quot;id&quot;:4,&quot;value&quot;:&quot;latestvalue_4&quot;}}


Processing data file tmp/transactions/delete_delta_0000001_0000004_v0000429/bucket_00000 [length: 713]
{&quot;operation&quot;:2,&quot;originaltransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowid&quot;:0,&quot;currenttransaction&quot;:2,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originaltransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowid&quot;:1,&quot;currenttransaction&quot;:2,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originaltransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowid&quot;:3,&quot;currenttransaction&quot;:2,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originaltransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowid&quot;:4,&quot;currenttransaction&quot;:4,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originaltransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowid&quot;:5,&quot;currenttransaction&quot;:2,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originaltransaction&quot;:2,&quot;bucket&quot;:536870912,&quot;rowid&quot;:0,&quot;currenttransaction&quot;:4,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originaltransaction&quot;:2,&quot;bucket&quot;:536870912,&quot;rowid&quot;:1,&quot;currenttransaction&quot;:3,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originaltransaction&quot;:2,&quot;bucket&quot;:536870912,&quot;rowid&quot;:2,&quot;currenttransaction&quot;:3,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originaltransaction&quot;:3,&quot;bucket&quot;:536870912,&quot;rowid&quot;:0,&quot;currenttransaction&quot;:4,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originaltransaction&quot;:2,&quot;bucket&quot;:536870913,&quot;rowid&quot;:0,&quot;currenttransaction&quot;:4,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originaltransaction&quot;:2,&quot;bucket&quot;:536870913,&quot;rowid&quot;:1,&quot;currenttransaction&quot;:3,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originaltransaction&quot;:2,&quot;bucket&quot;:536870913,&quot;rowid&quot;:2,&quot;currenttransaction&quot;:3,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originaltransaction&quot;:2,&quot;bucket&quot;:536870913,&quot;rowid&quot;:3,&quot;currenttransaction&quot;:3,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originaltransaction&quot;:3,&quot;bucket&quot;:536870913,&quot;rowid&quot;:1,&quot;currenttransaction&quot;:4,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originaltransaction&quot;:3,&quot;bucket&quot;:536870913,&quot;rowid&quot;:3,&quot;currenttransaction&quot;:4,&quot;row&quot;:null}
_____________________________________________________________________________________________________________________
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;MR&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Processing data file tmp/transactions/delta_0000001_0000004_v0000479/bucket_00000 [length: 1002]
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowId&quot;:0,&quot;currentTransaction&quot;:1,&quot;row&quot;:{&quot;id&quot;:1,&quot;value&quot;:&quot;value_01&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowId&quot;:1,&quot;currentTransaction&quot;:1,&quot;row&quot;:{&quot;id&quot;:2,&quot;value&quot;:&quot;value_02&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowId&quot;:2,&quot;currentTransaction&quot;:1,&quot;row&quot;:{&quot;id&quot;:3,&quot;value&quot;:&quot;value_03&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowId&quot;:3,&quot;currentTransaction&quot;:1,&quot;row&quot;:{&quot;id&quot;:4,&quot;value&quot;:&quot;value_04&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowId&quot;:4,&quot;currentTransaction&quot;:1,&quot;row&quot;:{&quot;id&quot;:5,&quot;value&quot;:&quot;value_05&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowId&quot;:5,&quot;currentTransaction&quot;:1,&quot;row&quot;:{&quot;id&quot;:6,&quot;value&quot;:&quot;value_06&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowId&quot;:6,&quot;currentTransaction&quot;:1,&quot;row&quot;:{&quot;id&quot;:7,&quot;value&quot;:&quot;value_07&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowId&quot;:7,&quot;currentTransaction&quot;:1,&quot;row&quot;:{&quot;id&quot;:8,&quot;value&quot;:&quot;value_08&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:2,&quot;bucket&quot;:536870912,&quot;rowId&quot;:0,&quot;currentTransaction&quot;:2,&quot;row&quot;:{&quot;id&quot;:9,&quot;value&quot;:&quot;value_9&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:2,&quot;bucket&quot;:536870912,&quot;rowId&quot;:1,&quot;currentTransaction&quot;:2,&quot;row&quot;:{&quot;id&quot;:10,&quot;value&quot;:&quot;value_10&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:2,&quot;bucket&quot;:536870912,&quot;rowId&quot;:2,&quot;currentTransaction&quot;:2,&quot;row&quot;:{&quot;id&quot;:11,&quot;value&quot;:&quot;value_11&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:2,&quot;bucket&quot;:536870912,&quot;rowId&quot;:3,&quot;currentTransaction&quot;:2,&quot;row&quot;:{&quot;id&quot;:12,&quot;value&quot;:&quot;value_12&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:2,&quot;bucket&quot;:536870913,&quot;rowId&quot;:0,&quot;currentTransaction&quot;:2,&quot;row&quot;:{&quot;id&quot;:1,&quot;value&quot;:&quot;newvalue_1&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:2,&quot;bucket&quot;:536870913,&quot;rowId&quot;:1,&quot;currentTransaction&quot;:2,&quot;row&quot;:{&quot;id&quot;:2,&quot;value&quot;:&quot;newvalue_2&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:2,&quot;bucket&quot;:536870913,&quot;rowId&quot;:2,&quot;currentTransaction&quot;:2,&quot;row&quot;:{&quot;id&quot;:4,&quot;value&quot;:&quot;newvalue_4&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:2,&quot;bucket&quot;:536870913,&quot;rowId&quot;:3,&quot;currentTransaction&quot;:2,&quot;row&quot;:{&quot;id&quot;:6,&quot;value&quot;:&quot;newvalue_6&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:3,&quot;bucket&quot;:536870912,&quot;rowId&quot;:0,&quot;currentTransaction&quot;:3,&quot;row&quot;:{&quot;id&quot;:13,&quot;value&quot;:&quot;value_13&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:3,&quot;bucket&quot;:536870912,&quot;rowId&quot;:1,&quot;currentTransaction&quot;:3,&quot;row&quot;:{&quot;id&quot;:14,&quot;value&quot;:&quot;value_14&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:3,&quot;bucket&quot;:536870913,&quot;rowId&quot;:0,&quot;currentTransaction&quot;:3,&quot;row&quot;:{&quot;id&quot;:10,&quot;value&quot;:&quot;newestvalue_10&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:3,&quot;bucket&quot;:536870913,&quot;rowId&quot;:1,&quot;currentTransaction&quot;:3,&quot;row&quot;:{&quot;id&quot;:11,&quot;value&quot;:&quot;newestvalue_11&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:3,&quot;bucket&quot;:536870913,&quot;rowId&quot;:2,&quot;currentTransaction&quot;:3,&quot;row&quot;:{&quot;id&quot;:2,&quot;value&quot;:&quot;newestvalue_2&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:3,&quot;bucket&quot;:536870913,&quot;rowId&quot;:3,&quot;currentTransaction&quot;:3,&quot;row&quot;:{&quot;id&quot;:4,&quot;value&quot;:&quot;newestvalue_4&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:3,&quot;bucket&quot;:536870913,&quot;rowId&quot;:4,&quot;currentTransaction&quot;:3,&quot;row&quot;:{&quot;id&quot;:6,&quot;value&quot;:&quot;newestvalue_6&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:4,&quot;bucket&quot;:536870912,&quot;rowId&quot;:0,&quot;currentTransaction&quot;:4,&quot;row&quot;:{&quot;id&quot;:15,&quot;value&quot;:&quot;value_15&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:4,&quot;bucket&quot;:536870913,&quot;rowId&quot;:0,&quot;currentTransaction&quot;:4,&quot;row&quot;:{&quot;id&quot;:5,&quot;value&quot;:&quot;latestvalue_5&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:4,&quot;bucket&quot;:536870913,&quot;rowId&quot;:1,&quot;currentTransaction&quot;:4,&quot;row&quot;:{&quot;id&quot;:9,&quot;value&quot;:&quot;latestvalue_9&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:4,&quot;bucket&quot;:536870913,&quot;rowId&quot;:2,&quot;currentTransaction&quot;:4,&quot;row&quot;:{&quot;id&quot;:1,&quot;value&quot;:&quot;latestvalue_1&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:4,&quot;bucket&quot;:536870913,&quot;rowId&quot;:3,&quot;currentTransaction&quot;:4,&quot;row&quot;:{&quot;id&quot;:13,&quot;value&quot;:&quot;latestvalue_13&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:4,&quot;bucket&quot;:536870913,&quot;rowId&quot;:4,&quot;currentTransaction&quot;:4,&quot;row&quot;:{&quot;id&quot;:11,&quot;value&quot;:&quot;latestvalue_11&quot;}}
{&quot;operation&quot;:0,&quot;originalTransaction&quot;:4,&quot;bucket&quot;:536870913,&quot;rowId&quot;:5,&quot;currentTransaction&quot;:4,&quot;row&quot;:{&quot;id&quot;:4,&quot;value&quot;:&quot;latestvalue_4&quot;}}
_____________________________________________________________________________________________________________________


Processing data file tmp/transactions/delete_delta_0000001_0000004_v0000479/bucket_00000 [length: 632]
{&quot;operation&quot;:2,&quot;originalTransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowId&quot;:0,&quot;currentTransaction&quot;:2,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originalTransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowId&quot;:1,&quot;currentTransaction&quot;:2,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originalTransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowId&quot;:3,&quot;currentTransaction&quot;:2,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originalTransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowId&quot;:4,&quot;currentTransaction&quot;:4,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originalTransaction&quot;:1,&quot;bucket&quot;:536870912,&quot;rowId&quot;:5,&quot;currentTransaction&quot;:2,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originalTransaction&quot;:2,&quot;bucket&quot;:536870912,&quot;rowId&quot;:0,&quot;currentTransaction&quot;:4,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originalTransaction&quot;:2,&quot;bucket&quot;:536870912,&quot;rowId&quot;:1,&quot;currentTransaction&quot;:3,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originalTransaction&quot;:2,&quot;bucket&quot;:536870912,&quot;rowId&quot;:2,&quot;currentTransaction&quot;:3,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originalTransaction&quot;:2,&quot;bucket&quot;:536870913,&quot;rowId&quot;:0,&quot;currentTransaction&quot;:4,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originalTransaction&quot;:2,&quot;bucket&quot;:536870913,&quot;rowId&quot;:1,&quot;currentTransaction&quot;:3,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originalTransaction&quot;:2,&quot;bucket&quot;:536870913,&quot;rowId&quot;:2,&quot;currentTransaction&quot;:3,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originalTransaction&quot;:2,&quot;bucket&quot;:536870913,&quot;rowId&quot;:3,&quot;currentTransaction&quot;:3,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originalTransaction&quot;:3,&quot;bucket&quot;:536870912,&quot;rowId&quot;:0,&quot;currentTransaction&quot;:4,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originalTransaction&quot;:3,&quot;bucket&quot;:536870913,&quot;rowId&quot;:1,&quot;currentTransaction&quot;:4,&quot;row&quot;:null}
{&quot;operation&quot;:2,&quot;originalTransaction&quot;:3,&quot;bucket&quot;:536870913,&quot;rowId&quot;:3,&quot;currentTransaction&quot;:4,&quot;row&quot;:null}
_____________________________________________________________________________________________________________________
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It can be seen that when the query-based MINOR compaction was used, the sorting order of the rows is &quot;bucket, originalTransactionId, rowId&quot;.  But when the MR MINOR compaction was used, the order is &quot;originalTransactionId, bucket, rowId&quot;.&lt;br/&gt;
The ordering in the query-based compaction has to be fixed to be aligned with the MR compaction&apos;s ordering.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13384180">HIVE-25258</key>
            <summary>Incorrect row order after query-based MINOR compaction</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kuczoram">Marta Kuczora</assignee>
                                    <reporter username="kuczoram">Marta Kuczora</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 16 Jun 2021 14:46:32 +0000</created>
                <updated>Thu, 17 Nov 2022 08:48:23 +0000</updated>
                            <resolved>Tue, 22 Jun 2021 07:58:12 +0000</resolved>
                                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                                    <component>Transactions</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17367106" author="kuczoram" created="Tue, 22 Jun 2021 07:58:12 +0000"  >&lt;p&gt;Pushed to master. Thanks a lot &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lpinter&quot; class=&quot;user-hover&quot; rel=&quot;lpinter&quot;&gt;lpinter&lt;/a&gt; for the review!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 21 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0s0gw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>