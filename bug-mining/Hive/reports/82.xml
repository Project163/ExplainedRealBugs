<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:51:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-339] [Hive] problem in count distinct in 1mapreduce job with map side aggregation</title>
                <link>https://issues.apache.org/jira/browse/HIVE-339</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description></description>
                <environment></environment>
        <key id="12416609">HIVE-339</key>
            <summary>[Hive] problem in count distinct in 1mapreduce job with map side aggregation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="namit">Namit Jain</assignee>
                                    <reporter username="namit">Namit Jain</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Mar 2009 05:50:38 +0000</created>
                <updated>Sat, 17 Dec 2011 00:08:39 +0000</updated>
                            <resolved>Thu, 12 Mar 2009 20:37:38 +0000</resolved>
                                                    <fixVersion>0.3.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12680765" author="namit" created="Wed, 11 Mar 2009 06:25:05 +0000"  >&lt;p&gt;fixed some testparse logs also&lt;/p&gt;</comment>
                            <comment id="12680779" author="rsm" created="Wed, 11 Mar 2009 07:41:09 +0000"  >&lt;p&gt;It&apos;s not clear what adding a new group by mode would do. There are no changes to GroupByOperator which seem to use this mode. Is that correct? If so, can you add a comment what the mergepartial mode is supposed to indicate?&lt;/p&gt;</comment>
                            <comment id="12680797" author="jsensarma" created="Wed, 11 Mar 2009 08:24:39 +0000"  >&lt;p&gt;man - this code is unparseable at this point. seems like 99% of the code in the old and new function (gengroupbyplanxxx) is common. is any refactoring and better documentation possible here at all? &lt;/p&gt;

&lt;p&gt;i also don&apos;t understand the new groupbydesc mode. it seems the effect is to choose &apos;iterate&apos; method in the group by operator for the distinct case (is that correct?). why is this necessary?&lt;/p&gt;</comment>
                            <comment id="12680892" author="namit" created="Wed, 11 Mar 2009 15:42:31 +0000"  >&lt;p&gt;will add comments and load a new patch&lt;/p&gt;</comment>
                            <comment id="12680928" author="namit" created="Wed, 11 Mar 2009 17:07:50 +0000"  >&lt;p&gt;added a lot more comments.&lt;/p&gt;

&lt;p&gt;Need iterate at reduce-side because it is possible that the map-aide aggregation was turned off at runtime &lt;br/&gt;
and then distinct need to be eliminated&lt;/p&gt;</comment>
                            <comment id="12680958" author="jsensarma" created="Wed, 11 Mar 2009 18:08:31 +0000"  >&lt;p&gt;not able to understand. regardless of whether map-side aggregation is turned off dynamically - the aggregation output type of the mapside will be a partial aggregate. i don&apos;t understand how we can iterate over the results of partial aggregate.&lt;/p&gt;

&lt;p&gt;i think problems may be getting masked because the output type of count partial aggregate is the same as count full aggregate. if we were doing &apos;avg(distinct column)&apos; - then doing iterate over partial aggregate output &lt;em&gt;should&lt;/em&gt; cause problems. this would be a good test case as well.&lt;/p&gt;</comment>
                            <comment id="12680984" author="namit" created="Wed, 11 Mar 2009 18:59:48 +0000"  >&lt;p&gt;Say the query is: select col2, count(distinct col2) from T group by col1;&lt;/p&gt;

&lt;p&gt;the mapper emits:&lt;/p&gt;

&lt;p&gt;col1   col2  col3&lt;br/&gt;
Key    19   1&lt;br/&gt;
Key    19   1&lt;br/&gt;
Key    22   1&lt;br/&gt;
Key    22   1&lt;br/&gt;
Key    23   1&lt;/p&gt;

&lt;p&gt;The expected answer is:&lt;/p&gt;

&lt;p&gt;Key  3&lt;/p&gt;

&lt;p&gt;So, you walk over the key+sort (which is col1 + col2), which makes sure that in the above example, 2nd and 4th rows are ignored,&lt;br/&gt;
and then iterate is called 3 times, which result in (key 3)&lt;/p&gt;

&lt;p&gt;However,if you called merge in the reducer: it would result in:&lt;/p&gt;

&lt;p&gt;key (19+22+23) --&amp;gt; key 64&lt;/p&gt;


&lt;p&gt;The same should work for avg also. I am running a query on mobile_mms for february currently to validate.&lt;br/&gt;
Partial results do not mean anything for distincts whereas they can be aggregated for non-distincts.&lt;/p&gt;




</comment>
                            <comment id="12681002" author="zshao" created="Wed, 11 Mar 2009 19:26:27 +0000"  >&lt;p&gt;Agree.&lt;/p&gt;

&lt;p&gt;In short, for DINSTICT aggregations in 1-map/reduce plan, we do &quot;de-duplicate&quot; as much as we can in the map-phase, and the whole aggregation is done in the reduce phase.&lt;br/&gt;
That&apos;s why reduce phase also needs iterate().&lt;/p&gt;</comment>
                            <comment id="12681015" author="rsm" created="Wed, 11 Mar 2009 20:16:57 +0000"  >&lt;p&gt;Can you rename Reduction key to &apos;Partitioning Key&apos; and &apos;Partitioning Key&apos; to &apos;Sorting Key&apos;. I&apos;m guessing that&apos;s what you mean.&lt;/p&gt;</comment>
                            <comment id="12681020" author="namit" created="Wed, 11 Mar 2009 20:46:09 +0000"  >&lt;p&gt;incorporated Raghu&apos;s comments&lt;/p&gt;</comment>
                            <comment id="12681030" author="jsensarma" created="Wed, 11 Mar 2009 21:13:09 +0000"  >&lt;p&gt;the explanations and comments make this much easier to understand. am just thumbing through the code one last time.&lt;/p&gt;
</comment>
                            <comment id="12681060" author="zshao" created="Wed, 11 Mar 2009 22:02:59 +0000"  >&lt;p&gt;hive.339.4.patch: 1073:&lt;br/&gt;
+   *   Partitioning Key: &lt;br/&gt;
+   *      grouping key if no DISTINCT&lt;br/&gt;
+   *      grouping + distinct key if DISTINCT&lt;/p&gt;

&lt;p&gt;should be:&lt;br/&gt;
+   *   Partitioning Key: &lt;br/&gt;
+   *      random() if no DISTINCT&lt;br/&gt;
+   *      grouping + distinct key if DISTINCT&lt;/p&gt;

&lt;p&gt;The same is true for line 1158.&lt;/p&gt;


&lt;p&gt;Line 1017: Can you add the comment for MERGEPARTIAL?&lt;/p&gt;</comment>
                            <comment id="12681069" author="namit" created="Wed, 11 Mar 2009 22:35:52 +0000"  >&lt;p&gt;incorporated Zheng&apos;s comments&lt;/p&gt;</comment>
                            <comment id="12681454" author="zshao" created="Thu, 12 Mar 2009 19:21:25 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12681481" author="zshao" created="Thu, 12 Mar 2009 20:37:37 +0000"  >&lt;p&gt;Committed revision 752996. Thanks Namit!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12401897" name="hive.339.1.patch" size="36775" author="namit" created="Wed, 11 Mar 2009 05:55:30 +0000"/>
                            <attachment id="12401899" name="hive.339.2.patch" size="41493" author="namit" created="Wed, 11 Mar 2009 06:24:45 +0000"/>
                            <attachment id="12401943" name="hive.339.3.patch" size="46788" author="namit" created="Wed, 11 Mar 2009 17:06:12 +0000"/>
                            <attachment id="12401965" name="hive.339.4.patch" size="46777" author="namit" created="Wed, 11 Mar 2009 20:45:51 +0000"/>
                            <attachment id="12401980" name="hive.339.5.patch" size="47107" author="namit" created="Wed, 11 Mar 2009 22:35:29 +0000"/>
                            <attachment id="12401997" name="hive.339.6.patch" size="33010" author="namit" created="Thu, 12 Mar 2009 00:33:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73602</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 37 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0l99j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>122151</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-339&quot; title=&quot;[Hive] problem in count distinct in 1mapreduce job with map side aggregation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-339&quot;&gt;&lt;strike&gt;HIVE-339&lt;/strike&gt;&lt;/a&gt;: Fix count distinct in 1 map-reduce job with map side aggregation. (Namit Jain via zshao)</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>