<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:06:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-4392] Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns </title>
                <link>https://issues.apache.org/jira/browse/HIVE-4392</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;For Example:&lt;/p&gt;

&lt;p&gt;hive (default)&amp;gt; create table liza_1 as &lt;br/&gt;
              &amp;gt; select *, sum(key), sum(value) &lt;br/&gt;
              &amp;gt; from new_src;&lt;br/&gt;
Total MapReduce jobs = 1&lt;br/&gt;
Launching Job 1 out of 1&lt;br/&gt;
Number of reduce tasks determined at compile time: 1&lt;br/&gt;
In order to change the average load for a reducer (in bytes):&lt;br/&gt;
  set hive.exec.reducers.bytes.per.reducer=&amp;lt;number&amp;gt;&lt;br/&gt;
In order to limit the maximum number of reducers:&lt;br/&gt;
  set hive.exec.reducers.max=&amp;lt;number&amp;gt;&lt;br/&gt;
In order to set a constant number of reducers:&lt;br/&gt;
  set mapred.reduce.tasks=&amp;lt;number&amp;gt;&lt;br/&gt;
Starting Job = job_201304191025_0003, Tracking URL = &lt;a href=&quot;http://hd17-vm5:51030/jobdetails.jsp?jobid=job_201304191025_0003&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hd17-vm5:51030/jobdetails.jsp?jobid=job_201304191025_0003&lt;/a&gt;&lt;br/&gt;
Kill Command = /home/zongren/hadoop-current/bin/../bin/hadoop job  -kill job_201304191025_0003&lt;br/&gt;
Hadoop job information for Stage-1: number of mappers: 0; number of reducers: 1&lt;br/&gt;
2013-04-22 11:09:28,017 Stage-1 map = 0%,  reduce = 0%&lt;br/&gt;
2013-04-22 11:09:34,054 Stage-1 map = 0%,  reduce = 100%&lt;br/&gt;
2013-04-22 11:09:37,074 Stage-1 map = 100%,  reduce = 100%&lt;br/&gt;
Ended Job = job_201304191025_0003&lt;br/&gt;
Moving data to: hdfs://hd17-vm5:9101/user/zongren/hive/liza_1&lt;br/&gt;
FAILED: Error in metadata: InvalidObjectException(message:liza_1 is not a valid object name)&lt;br/&gt;
FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask&lt;br/&gt;
MapReduce Jobs Launched: &lt;br/&gt;
Job 0: Reduce: 1   HDFS Read: 0 HDFS Write: 12 SUCCESS&lt;br/&gt;
Total MapReduce CPU Time Spent: 0 msec&lt;/p&gt;

&lt;p&gt;hive (default)&amp;gt; create table liza_1 as         &lt;br/&gt;
              &amp;gt; select *, sum(key), sum(value) &lt;br/&gt;
              &amp;gt; from new_src                   &lt;br/&gt;
              &amp;gt; group by key, value;&lt;br/&gt;
Total MapReduce jobs = 1&lt;br/&gt;
Launching Job 1 out of 1&lt;br/&gt;
Number of reduce tasks not specified. Estimated from input data size: 1&lt;br/&gt;
In order to change the average load for a reducer (in bytes):&lt;br/&gt;
  set hive.exec.reducers.bytes.per.reducer=&amp;lt;number&amp;gt;&lt;br/&gt;
In order to limit the maximum number of reducers:&lt;br/&gt;
  set hive.exec.reducers.max=&amp;lt;number&amp;gt;&lt;br/&gt;
In order to set a constant number of reducers:&lt;br/&gt;
  set mapred.reduce.tasks=&amp;lt;number&amp;gt;&lt;br/&gt;
Starting Job = job_201304191025_0004, Tracking URL = &lt;a href=&quot;http://hd17-vm5:51030/jobdetails.jsp?jobid=job_201304191025_0004&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hd17-vm5:51030/jobdetails.jsp?jobid=job_201304191025_0004&lt;/a&gt;&lt;br/&gt;
Kill Command = /home/zongren/hadoop-current/bin/../bin/hadoop job  -kill job_201304191025_0004&lt;br/&gt;
Hadoop job information for Stage-1: number of mappers: 0; number of reducers: 1&lt;br/&gt;
2013-04-22 11:11:58,945 Stage-1 map = 0%,  reduce = 0%&lt;br/&gt;
2013-04-22 11:12:01,964 Stage-1 map = 0%,  reduce = 100%&lt;br/&gt;
2013-04-22 11:12:04,982 Stage-1 map = 100%,  reduce = 100%&lt;br/&gt;
Ended Job = job_201304191025_0004&lt;br/&gt;
Moving data to: hdfs://hd17-vm5:9101/user/zongren/hive/liza_1&lt;br/&gt;
FAILED: Error in metadata: InvalidObjectException(message:liza_1 is not a valid object name)&lt;br/&gt;
FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask&lt;br/&gt;
MapReduce Jobs Launched: &lt;br/&gt;
Job 0: Reduce: 1   HDFS Read: 0 HDFS Write: 0 SUCCESS&lt;br/&gt;
Total MapReduce CPU Time Spent: 0 msec&lt;/p&gt;

&lt;p&gt;But the following tow Queries  work:&lt;br/&gt;
hive (default)&amp;gt; create table liza_1 as select * from new_src;&lt;br/&gt;
Total MapReduce jobs = 3&lt;br/&gt;
Launching Job 1 out of 3&lt;br/&gt;
Number of reduce tasks is set to 0 since there&apos;s no reduce operator&lt;br/&gt;
Starting Job = job_201304191025_0006, Tracking URL = &lt;a href=&quot;http://hd17-vm5:51030/jobdetails.jsp?jobid=job_201304191025_0006&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hd17-vm5:51030/jobdetails.jsp?jobid=job_201304191025_0006&lt;/a&gt;&lt;br/&gt;
Kill Command = /home/zongren/hadoop-current/bin/../bin/hadoop job  -kill job_201304191025_0006&lt;br/&gt;
Hadoop job information for Stage-1: number of mappers: 0; number of reducers: 0&lt;br/&gt;
2013-04-22 11:15:00,681 Stage-1 map = 0%,  reduce = 0%&lt;br/&gt;
2013-04-22 11:15:03,697 Stage-1 map = 100%,  reduce = 100%&lt;br/&gt;
Ended Job = job_201304191025_0006&lt;br/&gt;
Stage-4 is selected by condition resolver.&lt;br/&gt;
Stage-3 is filtered out by condition resolver.&lt;br/&gt;
Stage-5 is filtered out by condition resolver.&lt;br/&gt;
Moving data to: hdfs://hd17-vm5:9101/user/zongren/hive-scratchdir/hive_2013-04-22_11-14-54_632_6709035018023861094/-ext-10001&lt;br/&gt;
Moving data to: hdfs://hd17-vm5:9101/user/zongren/hive/liza_1&lt;br/&gt;
Table default.liza_1 stats: &lt;span class=&quot;error&quot;&gt;&amp;#91;num_partitions: 0, num_files: 0, num_rows: 0, total_size: 0, raw_data_size: 0&amp;#93;&lt;/span&gt;&lt;br/&gt;
MapReduce Jobs Launched: &lt;br/&gt;
Job 0:  HDFS Read: 0 HDFS Write: 0 SUCCESS&lt;br/&gt;
Total MapReduce CPU Time Spent: 0 msec&lt;br/&gt;
OK&lt;br/&gt;
Time taken: 9.576 seconds&lt;/p&gt;

&lt;p&gt;hive (default)&amp;gt; create table liza_1 as&lt;br/&gt;
              &amp;gt; select sum (key), sum(value) &lt;br/&gt;
              &amp;gt; from new_test;&lt;br/&gt;
Total MapReduce jobs = 1&lt;br/&gt;
Launching Job 1 out of 1&lt;br/&gt;
Number of reduce tasks determined at compile time: 1&lt;br/&gt;
In order to change the average load for a reducer (in bytes):&lt;br/&gt;
  set hive.exec.reducers.bytes.per.reducer=&amp;lt;number&amp;gt;&lt;br/&gt;
In order to limit the maximum number of reducers:&lt;br/&gt;
  set hive.exec.reducers.max=&amp;lt;number&amp;gt;&lt;br/&gt;
In order to set a constant number of reducers:&lt;br/&gt;
  set mapred.reduce.tasks=&amp;lt;number&amp;gt;&lt;br/&gt;
Starting Job = job_201304191025_0008, Tracking URL = &lt;a href=&quot;http://hd17-vm5:51030/jobdetails.jsp?jobid=job_201304191025_0008&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hd17-vm5:51030/jobdetails.jsp?jobid=job_201304191025_0008&lt;/a&gt;&lt;br/&gt;
Kill Command = /home/zongren/hadoop-current/bin/../bin/hadoop job  -kill job_201304191025_0008&lt;br/&gt;
Hadoop job information for Stage-1: number of mappers: 0; number of reducers: 1&lt;br/&gt;
2013-04-22 11:22:52,200 Stage-1 map = 0%,  reduce = 0%&lt;br/&gt;
2013-04-22 11:22:55,216 Stage-1 map = 0%,  reduce = 100%&lt;br/&gt;
2013-04-22 11:22:58,234 Stage-1 map = 100%,  reduce = 100%&lt;br/&gt;
Ended Job = job_201304191025_0008&lt;br/&gt;
Moving data to: hdfs://hd17-vm5:9101/user/zongren/hive/liza_1&lt;br/&gt;
Table default.liza_1 stats: &lt;span class=&quot;error&quot;&gt;&amp;#91;num_partitions: 0, num_files: 1, num_rows: 0, total_size: 6, raw_data_size: 0&amp;#93;&lt;/span&gt;&lt;br/&gt;
MapReduce Jobs Launched: &lt;br/&gt;
Job 0: Reduce: 1   HDFS Read: 0 HDFS Write: 6 SUCCESS&lt;br/&gt;
Total MapReduce CPU Time Spent: 0 msec&lt;br/&gt;
OK&lt;br/&gt;
Time taken: 11.115 seconds&lt;/p&gt;


&lt;p&gt;In MySQL :&lt;br/&gt;
mysql&amp;gt; select * from example ;&lt;br/&gt;
&lt;ins&gt;-----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-----+&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; id   &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; data &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;ins&gt;-----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-----+&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;    1 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 2    &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;    2 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 2    &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;    3 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 3    &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;ins&gt;-----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-----+&lt;br/&gt;
3 rows in set (0.00 sec)&lt;/p&gt;

&lt;p&gt;mysql&amp;gt; select *, sum(id),count(data)  from example ;&lt;br/&gt;
&lt;ins&gt;-----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;----&lt;del&gt;&lt;ins&gt;&lt;/del&gt;-------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;------------+&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; id   &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; data &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; sum(id) &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; count(data) &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;ins&gt;-----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;----&lt;del&gt;&lt;ins&gt;&lt;/del&gt;-------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;------------+&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;    1 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 2    &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;       6 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;           3 &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;ins&gt;-----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;----&lt;del&gt;&lt;ins&gt;&lt;/del&gt;-------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;------------+&lt;br/&gt;
1 row in set (0.03 sec)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Apache Hadoop 0.20.1&lt;br/&gt;
Apache Hive Trunk&lt;/p&gt;</environment>
        <key id="12643864">HIVE-4392</key>
            <summary>Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="navis">Navis Ryu</assignee>
                                    <reporter username="caofangkun">caofangkun</reporter>
                        <labels>
                    </labels>
                <created>Mon, 22 Apr 2013 03:26:58 +0000</created>
                <updated>Tue, 15 Oct 2013 23:31:31 +0000</updated>
                            <resolved>Wed, 8 May 2013 05:15:19 +0000</resolved>
                                                    <fixVersion>0.12.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="13637815" author="phabricator@reviews.facebook.net" created="Mon, 22 Apr 2013 07:45:15 +0000"  >&lt;p&gt;navis requested code review of &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4392&quot; title=&quot;Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4392&quot;&gt;&lt;del&gt;HIVE-4392&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns&quot;.&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4392&quot; title=&quot;Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4392&quot;&gt;&lt;del&gt;HIVE-4392&lt;/del&gt;&lt;/a&gt; Illogical InvalidObjectException throwed when use multi aggregate functions with star columns&lt;/p&gt;

&lt;p&gt;For Example:&lt;/p&gt;

&lt;p&gt;hive (default)&amp;gt; create table liza_1 as&lt;br/&gt;
              &amp;gt; select *, sum(key), sum(value)&lt;br/&gt;
              &amp;gt; from new_src;&lt;br/&gt;
Total MapReduce jobs = 1&lt;br/&gt;
Launching Job 1 out of 1&lt;br/&gt;
Number of reduce tasks determined at compile time: 1&lt;br/&gt;
In order to change the average load for a reducer (in bytes):&lt;br/&gt;
  set hive.exec.reducers.bytes.per.reducer=&amp;lt;number&amp;gt;&lt;br/&gt;
In order to limit the maximum number of reducers:&lt;br/&gt;
  set hive.exec.reducers.max=&amp;lt;number&amp;gt;&lt;br/&gt;
In order to set a constant number of reducers:&lt;br/&gt;
  set mapred.reduce.tasks=&amp;lt;number&amp;gt;&lt;br/&gt;
Starting Job = job_201304191025_0003, Tracking URL = &lt;a href=&quot;http://hd17-vm5:51030/jobdetails.jsp?jobid=job_201304191025_0003&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hd17-vm5:51030/jobdetails.jsp?jobid=job_201304191025_0003&lt;/a&gt;&lt;br/&gt;
Kill Command = /home/zongren/hadoop-current/bin/../bin/hadoop job  -kill job_201304191025_0003&lt;br/&gt;
Hadoop job information for Stage-1: number of mappers: 0; number of reducers: 1&lt;br/&gt;
2013-04-22 11:09:28,017 Stage-1 map = 0%,  reduce = 0%&lt;br/&gt;
2013-04-22 11:09:34,054 Stage-1 map = 0%,  reduce = 100%&lt;br/&gt;
2013-04-22 11:09:37,074 Stage-1 map = 100%,  reduce = 100%&lt;br/&gt;
Ended Job = job_201304191025_0003&lt;br/&gt;
Moving data to: hdfs://hd17-vm5:9101/user/zongren/hive/liza_1&lt;br/&gt;
FAILED: Error in metadata: InvalidObjectException(message:liza_1 is not a valid object name)&lt;br/&gt;
FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask&lt;br/&gt;
MapReduce Jobs Launched:&lt;br/&gt;
Job 0: Reduce: 1   HDFS Read: 0 HDFS Write: 12 SUCCESS&lt;br/&gt;
Total MapReduce CPU Time Spent: 0 msec&lt;/p&gt;

&lt;p&gt;hive (default)&amp;gt; create table liza_1 as&lt;br/&gt;
              &amp;gt; select *, sum(key), sum(value)&lt;br/&gt;
              &amp;gt; from new_src&lt;br/&gt;
              &amp;gt; group by key, value;&lt;br/&gt;
Total MapReduce jobs = 1&lt;br/&gt;
Launching Job 1 out of 1&lt;br/&gt;
Number of reduce tasks not specified. Estimated from input data size: 1&lt;br/&gt;
In order to change the average load for a reducer (in bytes):&lt;br/&gt;
  set hive.exec.reducers.bytes.per.reducer=&amp;lt;number&amp;gt;&lt;br/&gt;
In order to limit the maximum number of reducers:&lt;br/&gt;
  set hive.exec.reducers.max=&amp;lt;number&amp;gt;&lt;br/&gt;
In order to set a constant number of reducers:&lt;br/&gt;
  set mapred.reduce.tasks=&amp;lt;number&amp;gt;&lt;br/&gt;
Starting Job = job_201304191025_0004, Tracking URL = &lt;a href=&quot;http://hd17-vm5:51030/jobdetails.jsp?jobid=job_201304191025_0004&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hd17-vm5:51030/jobdetails.jsp?jobid=job_201304191025_0004&lt;/a&gt;&lt;br/&gt;
Kill Command = /home/zongren/hadoop-current/bin/../bin/hadoop job  -kill job_201304191025_0004&lt;br/&gt;
Hadoop job information for Stage-1: number of mappers: 0; number of reducers: 1&lt;br/&gt;
2013-04-22 11:11:58,945 Stage-1 map = 0%,  reduce = 0%&lt;br/&gt;
2013-04-22 11:12:01,964 Stage-1 map = 0%,  reduce = 100%&lt;br/&gt;
2013-04-22 11:12:04,982 Stage-1 map = 100%,  reduce = 100%&lt;br/&gt;
Ended Job = job_201304191025_0004&lt;br/&gt;
Moving data to: hdfs://hd17-vm5:9101/user/zongren/hive/liza_1&lt;br/&gt;
FAILED: Error in metadata: InvalidObjectException(message:liza_1 is not a valid object name)&lt;br/&gt;
FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask&lt;br/&gt;
MapReduce Jobs Launched:&lt;br/&gt;
Job 0: Reduce: 1   HDFS Read: 0 HDFS Write: 0 SUCCESS&lt;br/&gt;
Total MapReduce CPU Time Spent: 0 msec&lt;/p&gt;

&lt;p&gt;But the following tow Queries  work:&lt;br/&gt;
hive (default)&amp;gt; create table liza_1 as select * from new_src;&lt;br/&gt;
Total MapReduce jobs = 3&lt;br/&gt;
Launching Job 1 out of 3&lt;br/&gt;
Number of reduce tasks is set to 0 since there&apos;s no reduce operator&lt;br/&gt;
Starting Job = job_201304191025_0006, Tracking URL = &lt;a href=&quot;http://hd17-vm5:51030/jobdetails.jsp?jobid=job_201304191025_0006&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hd17-vm5:51030/jobdetails.jsp?jobid=job_201304191025_0006&lt;/a&gt;&lt;br/&gt;
Kill Command = /home/zongren/hadoop-current/bin/../bin/hadoop job  -kill job_201304191025_0006&lt;br/&gt;
Hadoop job information for Stage-1: number of mappers: 0; number of reducers: 0&lt;br/&gt;
2013-04-22 11:15:00,681 Stage-1 map = 0%,  reduce = 0%&lt;br/&gt;
2013-04-22 11:15:03,697 Stage-1 map = 100%,  reduce = 100%&lt;br/&gt;
Ended Job = job_201304191025_0006&lt;br/&gt;
Stage-4 is selected by condition resolver.&lt;br/&gt;
Stage-3 is filtered out by condition resolver.&lt;br/&gt;
Stage-5 is filtered out by condition resolver.&lt;br/&gt;
Moving data to: hdfs://hd17-vm5:9101/user/zongren/hive-scratchdir/hive_2013-04-22_11-14-54_632_6709035018023861094/-ext-10001&lt;br/&gt;
Moving data to: hdfs://hd17-vm5:9101/user/zongren/hive/liza_1&lt;br/&gt;
Table default.liza_1 stats: &lt;span class=&quot;error&quot;&gt;&amp;#91;num_partitions: 0, num_files: 0, num_rows: 0, total_size: 0, raw_data_size: 0&amp;#93;&lt;/span&gt;&lt;br/&gt;
MapReduce Jobs Launched:&lt;br/&gt;
Job 0:  HDFS Read: 0 HDFS Write: 0 SUCCESS&lt;br/&gt;
Total MapReduce CPU Time Spent: 0 msec&lt;br/&gt;
OK&lt;br/&gt;
Time taken: 9.576 seconds&lt;/p&gt;

&lt;p&gt;hive (default)&amp;gt; create table liza_1 as&lt;br/&gt;
              &amp;gt; select sum (key), sum(value)&lt;br/&gt;
              &amp;gt; from new_test;&lt;br/&gt;
Total MapReduce jobs = 1&lt;br/&gt;
Launching Job 1 out of 1&lt;br/&gt;
Number of reduce tasks determined at compile time: 1&lt;br/&gt;
In order to change the average load for a reducer (in bytes):&lt;br/&gt;
  set hive.exec.reducers.bytes.per.reducer=&amp;lt;number&amp;gt;&lt;br/&gt;
In order to limit the maximum number of reducers:&lt;br/&gt;
  set hive.exec.reducers.max=&amp;lt;number&amp;gt;&lt;br/&gt;
In order to set a constant number of reducers:&lt;br/&gt;
  set mapred.reduce.tasks=&amp;lt;number&amp;gt;&lt;br/&gt;
Starting Job = job_201304191025_0008, Tracking URL = &lt;a href=&quot;http://hd17-vm5:51030/jobdetails.jsp?jobid=job_201304191025_0008&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hd17-vm5:51030/jobdetails.jsp?jobid=job_201304191025_0008&lt;/a&gt;&lt;br/&gt;
Kill Command = /home/zongren/hadoop-current/bin/../bin/hadoop job  -kill job_201304191025_0008&lt;br/&gt;
Hadoop job information for Stage-1: number of mappers: 0; number of reducers: 1&lt;br/&gt;
2013-04-22 11:22:52,200 Stage-1 map = 0%,  reduce = 0%&lt;br/&gt;
2013-04-22 11:22:55,216 Stage-1 map = 0%,  reduce = 100%&lt;br/&gt;
2013-04-22 11:22:58,234 Stage-1 map = 100%,  reduce = 100%&lt;br/&gt;
Ended Job = job_201304191025_0008&lt;br/&gt;
Moving data to: hdfs://hd17-vm5:9101/user/zongren/hive/liza_1&lt;br/&gt;
Table default.liza_1 stats: &lt;span class=&quot;error&quot;&gt;&amp;#91;num_partitions: 0, num_files: 1, num_rows: 0, total_size: 6, raw_data_size: 0&amp;#93;&lt;/span&gt;&lt;br/&gt;
MapReduce Jobs Launched:&lt;br/&gt;
Job 0: Reduce: 1   HDFS Read: 0 HDFS Write: 6 SUCCESS&lt;br/&gt;
Total MapReduce CPU Time Spent: 0 msec&lt;br/&gt;
OK&lt;br/&gt;
Time taken: 11.115 seconds&lt;/p&gt;

&lt;p&gt;TEST PLAN&lt;br/&gt;
  EMPTY&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10431&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10431&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/ctas_colname.q&lt;br/&gt;
  ql/src/test/results/clientpositive/ctas_colname.q.out&lt;/p&gt;

&lt;p&gt;MANAGE HERALD RULES&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/view/differential/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/herald/view/differential/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WHY DID I GET THIS EMAIL?&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/transcript/24963/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/herald/transcript/24963/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, navis&lt;/p&gt;</comment>
                            <comment id="13637817" author="ashutoshc" created="Mon, 22 Apr 2013 07:52:12 +0000"  >&lt;p&gt;Looks like same bug is causing &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4391&quot; title=&quot;Windowing function doesn&amp;#39;t work in conjunction with CTAS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4391&quot;&gt;&lt;del&gt;HIVE-4391&lt;/del&gt;&lt;/a&gt; as well.&lt;/p&gt;</comment>
                            <comment id="13638088" author="ashutoshc" created="Mon, 22 Apr 2013 15:13:24 +0000"  >&lt;p&gt;Since, &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4391&quot; title=&quot;Windowing function doesn&amp;#39;t work in conjunction with CTAS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4391&quot;&gt;&lt;del&gt;HIVE-4391&lt;/del&gt;&lt;/a&gt; is very similar to this. I tried with this patch and the queries posted there (e.g.,  from t2 insert overwrite  table t7  select c1, rank() over() ; ) . This query used to fail exactly as in the stacktrace here earlier (ie, after executing MR job, failing saying InvalidObjectException). But now fails at compile time itself with exception&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;FAILED: SemanticException [Error 10001]: Line 1:32 Table not found &apos;t7&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13638615" author="navis" created="Tue, 23 Apr 2013 00:30:52 +0000"  >&lt;p&gt;I&apos;ll check that. Thanks.&lt;/p&gt;</comment>
                            <comment id="13638626" author="navis" created="Tue, 23 Apr 2013 00:49:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; It&apos;s not CTAS and it seemed t7 is not exist. I&apos;ve tried &quot;create table x2 as select *, rank() over() as rr from src&quot; and it worked.&lt;/p&gt;</comment>
                            <comment id="13638653" author="ashutoshc" created="Tue, 23 Apr 2013 01:09:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; You are correct (as always : ) ). It does indeed work. Can you add some variant of following tests in the patch. I verified these tests work. I meanwhile will review the patch.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; create table x4 as select *, rank() over(partition by c1 order by c2)  as rr from t1; 
 select * from x4;  
create table x5 as select *, lead(c3,1) over(partition by c1 order by c2)   from t1 limit 5;
select * from x5;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13638837" author="phabricator@reviews.facebook.net" created="Tue, 23 Apr 2013 06:31:14 +0000"  >&lt;p&gt;navis updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4392&quot; title=&quot;Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4392&quot;&gt;&lt;del&gt;HIVE-4392&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns&quot;.&lt;/p&gt;

&lt;p&gt;  Added test cases&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10431&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10431&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10431?vs=32607&amp;amp;id=32715#toc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10431?vs=32607&amp;amp;id=32715#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/ctas_colname.q&lt;br/&gt;
  ql/src/test/results/clientpositive/ctas_colname.q.out&lt;/p&gt;

&lt;p&gt;To: JIRA, navis&lt;/p&gt;</comment>
                            <comment id="13639122" author="ashutoshc" created="Tue, 23 Apr 2013 14:46:02 +0000"  >&lt;p&gt;comments.&lt;/p&gt;</comment>
                            <comment id="13639123" author="phabricator@reviews.facebook.net" created="Tue, 23 Apr 2013 14:47:14 +0000"  >&lt;p&gt;ashutoshc has requested changes to the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4392&quot; title=&quot;Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4392&quot;&gt;&lt;del&gt;HIVE-4392&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns&quot;.&lt;/p&gt;

&lt;p&gt;  .q.out file changes doesn&apos;t look right for windowing functions.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/test/results/clientpositive/ctas_colname.q.out:245 This doesn&apos;t look right. There should be three columns here, not 4.&lt;br/&gt;
  Column _col2 looks suspicious.&lt;br/&gt;
  ql/src/test/results/clientpositive/ctas_colname.q.out:291 Some rows here have 3 columns and others have 4 columns. How is that possible?&lt;br/&gt;
  ql/src/test/results/clientpositive/ctas_colname.q.out:430 Again, there should only be 3 columns here, not 4.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10431&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10431&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4392&quot; title=&quot;Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4392&quot;&gt;&lt;del&gt;HIVE-4392&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, navis&lt;/p&gt;</comment>
                            <comment id="13639981" author="phabricator@reviews.facebook.net" created="Wed, 24 Apr 2013 01:59:14 +0000"  >&lt;p&gt;navis has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4392&quot; title=&quot;Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4392&quot;&gt;&lt;del&gt;HIVE-4392&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/test/results/clientpositive/ctas_colname.q.out:245 PTF operator, which is parent of SEL hands over 3 columns(except vcs). One window column and two other columns(key, value). So * is resolved into theses three columns and adding one window column(rank()..) makes 4 columns.&lt;/p&gt;

&lt;p&gt;  it&apos;s similar to &quot;select *, key from src&quot; returning 3 columns.&lt;br/&gt;
  ql/src/test/results/clientpositive/ctas_colname.q.out:291 The table &apos;src1&apos; has null columns which makes query result very confusing.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10431&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10431&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4392&quot; title=&quot;Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4392&quot;&gt;&lt;del&gt;HIVE-4392&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, navis&lt;/p&gt;</comment>
                            <comment id="13639996" author="phabricator@reviews.facebook.net" created="Wed, 24 Apr 2013 02:19:13 +0000"  >&lt;p&gt;ashutoshc has added CCs to the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4392&quot; title=&quot;Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4392&quot;&gt;&lt;del&gt;HIVE-4392&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns&quot;.&lt;br/&gt;
Added CCs: hbutani&lt;/p&gt;

&lt;p&gt;  I think we need to fix why in case of windowing we have an extra column.&lt;br/&gt;
  CCing Harish, who may have an insight into this.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/test/results/clientpositive/ctas_colname.q.out:245 I see why is this happening. But that still against the semantics. When I do create table t1 as select * , rank() from src; where src has 2 columns. I expect t1 to have 3 columns, not 4. Isn&apos;t it ?&lt;br/&gt;
  ql/src/test/results/clientpositive/ctas_colname.q.out:291 I thought when column is null, we print NULL for column, how come its empty string in this case?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10431&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10431&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4392&quot; title=&quot;Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4392&quot;&gt;&lt;del&gt;HIVE-4392&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, navis&lt;br/&gt;
Cc: hbutani&lt;/p&gt;</comment>
                            <comment id="13640004" author="phabricator@reviews.facebook.net" created="Wed, 24 Apr 2013 02:31:13 +0000"  >&lt;p&gt;navis has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4392&quot; title=&quot;Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4392&quot;&gt;&lt;del&gt;HIVE-4392&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/test/results/clientpositive/ctas_colname.q.out:245 Yes, I think windows columns should be marked as hidden-virtual column. But I can&apos;t decide it cause I don&apos;t know anything on windowing functions.&lt;br/&gt;
  ql/src/test/results/clientpositive/ctas_colname.q.out:291 You are right, what&apos;s that then? I should investigate on it.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10431&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10431&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4392&quot; title=&quot;Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4392&quot;&gt;&lt;del&gt;HIVE-4392&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, navis&lt;br/&gt;
Cc: hbutani&lt;/p&gt;</comment>
                            <comment id="13640016" author="ashutoshc" created="Wed, 24 Apr 2013 02:43:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhbutani&quot; class=&quot;user-hover&quot; rel=&quot;rhbutani&quot;&gt;rhbutani&lt;/a&gt; Do you think marking windowing column as hidden virtual column is a wise thing to do?&lt;/p&gt;</comment>
                            <comment id="13640136" author="phabricator@reviews.facebook.net" created="Wed, 24 Apr 2013 06:01:14 +0000"  >&lt;p&gt;navis has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4392&quot; title=&quot;Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4392&quot;&gt;&lt;del&gt;HIVE-4392&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/test/results/clientpositive/ctas_colname.q.out:245 I&apos;ve changed window columns to hidden virtual columns and it seemed working good (passed ptf* and window* in client positive tests in ql). But still need a confirmation from Harish.&lt;br/&gt;
  ql/src/test/results/clientpositive/ctas_colname.q.out:291 My bad. It&apos;s empty string, not null.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10431&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10431&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4392&quot; title=&quot;Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4392&quot;&gt;&lt;del&gt;HIVE-4392&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, navis&lt;br/&gt;
Cc: hbutani&lt;/p&gt;</comment>
                            <comment id="13640541" author="ashutoshc" created="Wed, 24 Apr 2013 15:35:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; Can you update the phabricator entry with your fix. I will take a look.&lt;/p&gt;</comment>
                            <comment id="13640902" author="rhbutani" created="Wed, 24 Apr 2013 20:27:52 +0000"  >&lt;p&gt;But the check in genFileSinkPlan doesn&apos;t work for this query:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;create table x4 as select * from (select *, rank() over(partition by key order by value) as rr from src1) a
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It would be nice to fix this in genSelectPlan. &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;both PTFOp and GByOp set the agg function expression&apos;s ColInfo.alias as the ast.toStringTree&lt;/li&gt;
	&lt;li&gt;because of the star, genColListRegex adds the ColInfo&apos;s for these to the out_schema&lt;/li&gt;
	&lt;li&gt;then in the expr loop in genSelectPlan, the expression is added again, using the alias specified this time.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Still trying to see how to prevent the expression from being added twice:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the straightforward answer would be to check in genColListRegex if the ColInfo.alias matches some expression.toStringTree on the SelectList. But to me it appears that this would require reproducing a lot of logic that is in genSelectPlan here.&lt;/li&gt;
	&lt;li&gt;a potential simple check is, to check in genColListRegex if the alias is a validName; if not then the Column represents an expression that will get added explicitly in the genSelectPlan expr loop. But I am not sure if this is a bullet proof check.&lt;br/&gt;
By adding the following, around line 1816 in SemAnalyzer, I get the above e.g. to work:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;       if ( !MetaStoreUtils.validateName(entry.getKey()) ) {
         continue;
       }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But haven&apos;t run any other tests, so this is very preliminary.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13641304" author="phabricator@reviews.facebook.net" created="Thu, 25 Apr 2013 02:06:14 +0000"  >&lt;p&gt;navis updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4392&quot; title=&quot;Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4392&quot;&gt;&lt;del&gt;HIVE-4392&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns&quot;.&lt;/p&gt;

&lt;p&gt;  Changed window/ptf columns to hidden virtual column&lt;/p&gt;

&lt;p&gt;Reviewers: ashutoshc, JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10431&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10431&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10431?vs=32715&amp;amp;id=32847#toc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10431?vs=32715&amp;amp;id=32847#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/PTFTranslator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/ctas_colname.q&lt;br/&gt;
  ql/src/test/results/clientpositive/ctas_colname.q.out&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, navis&lt;br/&gt;
Cc: hbutani&lt;/p&gt;</comment>
                            <comment id="13641528" author="ashutoshc" created="Thu, 25 Apr 2013 07:34:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhbutani&quot; class=&quot;user-hover&quot; rel=&quot;rhbutani&quot;&gt;rhbutani&lt;/a&gt; I didn&apos;t completely follow your suggestion. But, Navis&apos;s trick of treating the window column as hidden virtual column seems to have fixed the issue. I tested the test-case you have posted. That seems to have worked. I also ran all windowing and ptf tests those worked too. Can you take a look at Navis&apos;s latest patch to see if that looks right.&lt;/p&gt;</comment>
                            <comment id="13642229" author="rhbutani" created="Thu, 25 Apr 2013 21:16:38 +0000"  >&lt;p&gt;In PTFTranslator, only the change on line 1053(pertaining to Window Functions) should be made. &lt;/p&gt;

&lt;p&gt;But to me it looks like the issue is the same for both PTFOp and GByOp. And the issue is in how the RowResolver is constructed in SelectOp when a &apos;*&apos; is present in the Select List.&lt;/p&gt;

&lt;p&gt;The combination of:&lt;br/&gt;
1. using the internalName in genFileSinkPlan when the input column has no table Alias.&lt;br/&gt;
2. making the Windowing expressions hidden Virtual&lt;/p&gt;

&lt;p&gt;Works for PTFs. But same thing has to be done for GBy.&lt;/p&gt;

&lt;p&gt;1. For this e.g.  &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;create table x4 as select *, min(value) from src1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; the output schema still has 2 columns instead of 1; the GByOp&apos;s RowResolver has 1 column; but the SelectOp&apos;s RR has 2 columns.&lt;/p&gt;

&lt;p&gt;2. This one still fails:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;create table x4 as select * from (select *, min(value) from src1) a
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I wonder if you can make the aggregations expressions in GByOp virtual hidden? They maybe referenced in a Having clause.&lt;br/&gt;
A more direct fix maybe to avoid adding these SelectExprs twice in the SelectOp RR. &lt;/p&gt;</comment>
                            <comment id="13642335" author="ashutoshc" created="Thu, 25 Apr 2013 22:51:18 +0000"  >&lt;p&gt;I see. Thanks for explanation. I agree right fix is to correctly handle * and not add select list twice in such cases. I would make following proposal. &lt;br/&gt;
For 0.11 we go ahead with current fix and track the correct fix in a new jira.  &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; / &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhbutani&quot; class=&quot;user-hover&quot; rel=&quot;rhbutani&quot;&gt;rhbutani&lt;/a&gt; What do you guys think ?&lt;/p&gt;</comment>
                            <comment id="13642508" author="navis" created="Fri, 26 Apr 2013 02:00:03 +0000"  >&lt;p&gt;Harish is right. Query 2 is failing and it&apos;s apparent that the patch is still missing something even for a stopgap. I&apos;ll look into this more.&lt;/p&gt;</comment>
                            <comment id="13645095" author="phabricator@reviews.facebook.net" created="Tue, 30 Apr 2013 00:32:15 +0000"  >&lt;p&gt;navis updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4392&quot; title=&quot;Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4392&quot;&gt;&lt;del&gt;HIVE-4392&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns&quot;.&lt;/p&gt;

&lt;p&gt;  Addressed comments&lt;/p&gt;

&lt;p&gt;Reviewers: ashutoshc, JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10431&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10431&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10431?vs=32847&amp;amp;id=33177#toc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10431?vs=32847&amp;amp;id=33177#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/PTFTranslator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/ctas_colname.q&lt;br/&gt;
  ql/src/test/results/clientpositive/ctas_colname.q.out&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, navis&lt;br/&gt;
Cc: hbutani&lt;/p&gt;</comment>
                            <comment id="13645096" author="navis" created="Tue, 30 Apr 2013 00:32:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhbutani&quot; class=&quot;user-hover&quot; rel=&quot;rhbutani&quot;&gt;rhbutani&lt;/a&gt; / &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; Updated patch. Could you take a look at it?&lt;/p&gt;</comment>
                            <comment id="13645952" author="ashutoshc" created="Tue, 30 Apr 2013 20:41:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; You opted to make aggregate column virtual hidden. But as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhbutani&quot; class=&quot;user-hover&quot; rel=&quot;rhbutani&quot;&gt;rhbutani&lt;/a&gt; this may still be problematic when these aggregate columns are referenced in having clause. e.g, consider query 2 from Harish&apos;s example with groupby and having clause in subquery. Did you test that.&lt;/p&gt;

&lt;p&gt;Also as Harish suggested root problem here is&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;And the issue is in how the RowResolver is constructed in SelectOp when a &apos;*&apos; is present in the Select List.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So, proper fix is to correctly handle * and only add requisite columns in RowResolver of select Op and thereby avoiding duplication of columns in first place. Wondering if you explored that route ?&lt;/p&gt;</comment>
                            <comment id="13646879" author="ashutoshc" created="Wed, 1 May 2013 20:06:35 +0000"  >&lt;p&gt;I played bit more with the patch and tried out following queries:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt; create table x6 as select * from (select * from t1 group by key) a;&lt;br/&gt;
 create table x6 as select * from (select * from t1 group by key having key &amp;lt; 9) a;&lt;br/&gt;
 create table x7 as select * from (select max(value),key from t1 group by key having key &amp;lt; 9) a;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;All of the above worked, so seems like patch is effective. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhbutani&quot; class=&quot;user-hover&quot; rel=&quot;rhbutani&quot;&gt;rhbutani&lt;/a&gt; Do you think there could be other queries which you think might still be broken. I am fine with moving forward with the current patch, unless &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhbutani&quot; class=&quot;user-hover&quot; rel=&quot;rhbutani&quot;&gt;rhbutani&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; you guys want to do further investigation on the proper fix.&lt;/p&gt;</comment>
                            <comment id="13647165" author="navis" created="Thu, 2 May 2013 01:32:27 +0000"  >&lt;p&gt;I&apos;ve understood this issue is for temporal stopgap. Wasn&apos;t it?&lt;/p&gt;

&lt;p&gt;Making a column as VHC does not affect resolving it in &quot;having&quot; or others and just affects &quot;select&quot; clause. And changing aggregation columns to VHC might make backward compatibility issue (different schema).&lt;/p&gt;</comment>
                            <comment id="13647182" author="ashutoshc" created="Thu, 2 May 2013 01:53:09 +0000"  >&lt;p&gt;I was suggesting this as a stopgap for 0.11. But since now that 0.11 has already shipped there is no rush. So, now we can take time to fix it the proper way. There are few alternatives now:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;We check this fix in and forget about the issue.&lt;/li&gt;
	&lt;li&gt;We check this fix in to fix the issue on trunk and create another jira to track proper fix.&lt;/li&gt;
	&lt;li&gt;We don&apos;t check in this fix and explore the proper fix (of correctly handling * in RR of select op) in this jira and try to get that in trunk.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; Since you are the one actively working on the issue, I will let you make the call for it. I am fine with any of three options.&lt;/p&gt;</comment>
                            <comment id="13647284" author="rhbutani" created="Thu, 2 May 2013 04:40:53 +0000"  >&lt;p&gt;I agree &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; your call.&lt;/p&gt;

&lt;p&gt;But couple of related observations, what are your thoughts on this.&lt;br/&gt;
If you do this query:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;select *, max(p_size), min(p_size) from part
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The output has 4 columns. It will always be twice the number of aggregation expressions.&lt;/li&gt;
	&lt;li&gt;If you do this
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;select *, max(p_size), min(p_size) from part group by p_name
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;you get 5 columns.&lt;/li&gt;
	&lt;li&gt;This is because the * applies to the schema of the GBy Op.&lt;/li&gt;
	&lt;li&gt;In the case of the PTFs you don&apos;t get duplicates because the agg. expressions are marked as VHC.&lt;/li&gt;
	&lt;li&gt;But if you try either of these in Postgres
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;select *, max(p_size) from part
select *, max(p_size) from part group by p_name
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;they fail; giving an error to the effect the part columns are not in Group By.&lt;/li&gt;
	&lt;li&gt;So the &apos;*&apos; is resolved against the schema before the GBy&lt;/li&gt;
	&lt;li&gt;I think the behavior in Hive makes more sense; at some point should we change it so that we don&apos;t get duplicate output columns for aggregations?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13647288" author="navis" created="Thu, 2 May 2013 04:55:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=charish&quot; class=&quot;user-hover&quot; rel=&quot;charish&quot;&gt;charish&lt;/a&gt; I was writing on the same issue, and now I see your comment. Thanks.&lt;br/&gt;
For the patch, I think this would be enough for now. But it&apos;s based on assumptions which can be broken if things changed, so let&apos;s include tests mentioned above and wait for next fail (and fix then).&lt;/p&gt;

&lt;p&gt;And.. it seemed better to decide whether aggregation columns should be included or not for select-star in here. I prefer to change it not-included, but I&apos;m not sure of it.&lt;/p&gt;</comment>
                            <comment id="13647690" author="ashutoshc" created="Thu, 2 May 2013 16:50:53 +0000"  >&lt;p&gt;Ok. Lets go ahead with this patch than. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; Do you want to update the patch with these tests or shall I go ahead with testing it for commit?&lt;/p&gt;</comment>
                            <comment id="13648068" author="phabricator@reviews.facebook.net" created="Fri, 3 May 2013 00:52:14 +0000"  >&lt;p&gt;navis updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4392&quot; title=&quot;Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4392&quot;&gt;&lt;del&gt;HIVE-4392&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns&quot;.&lt;/p&gt;

&lt;p&gt;  Added tests&lt;/p&gt;

&lt;p&gt;Reviewers: ashutoshc, JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10431&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10431&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10431?vs=33177&amp;amp;id=33285#toc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10431?vs=33177&amp;amp;id=33285#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/PTFTranslator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/ctas_colname.q&lt;br/&gt;
  ql/src/test/results/clientpositive/ctas_colname.q.out&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, navis&lt;br/&gt;
Cc: hbutani&lt;/p&gt;</comment>
                            <comment id="13648069" author="navis" created="Fri, 3 May 2013 00:52:32 +0000"  >&lt;p&gt;Added tests. Not changed aggregation columns.&lt;/p&gt;</comment>
                            <comment id="13651545" author="caofangkun" created="Wed, 8 May 2013 01:51:01 +0000"  >&lt;p&gt;hive&amp;gt;create table summary as select *, sum(key), count(value) from src;&lt;br/&gt;
hive&amp;gt;select * from summary;&lt;br/&gt;
130091.0	500	130091.0	500&lt;/p&gt;

&lt;p&gt;Such kind of query will generate only one row of result ? &lt;br/&gt;
And the the first two column values are not correct ?&lt;/p&gt;</comment>
                            <comment id="13651575" author="caofangkun" created="Wed, 8 May 2013 02:51:46 +0000"  >&lt;p&gt;hive (default)&amp;gt; select * from src_for_test;&lt;br/&gt;
	35&lt;br/&gt;
48	&lt;br/&gt;
100	100&lt;br/&gt;
hive (default)&amp;gt; select *, sum(key), count(value)  from src_for_test group by key, value ;&lt;br/&gt;
	35	0.0	1	0.0	1&lt;br/&gt;
100	100	100.0	1	100.0	1&lt;br/&gt;
48		48.0	1	48.0	1&lt;/p&gt;

&lt;p&gt;two more columns generated!&lt;/p&gt;</comment>
                            <comment id="13651625" author="ashutoshc" created="Wed, 8 May 2013 05:14:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caofangkun&quot; class=&quot;user-hover&quot; rel=&quot;caofangkun&quot;&gt;caofangkun&lt;/a&gt; As discussed earlier on this thread, I went ahead with the commit of the patch. Can you test  on top of trunk and please feel free to open new jiras if you think behavior is incorrect.&lt;/p&gt;

&lt;p&gt;Committed to trunk. Thanks, Navis!&lt;/p&gt;</comment>
                            <comment id="13651879" author="hudson" created="Wed, 8 May 2013 13:29:18 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #2091 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/2091/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/2091/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4392&quot; title=&quot;Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4392&quot;&gt;&lt;del&gt;HIVE-4392&lt;/del&gt;&lt;/a&gt; : Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns  (Navis via Ashutosh Chauhan) (Revision 1480161)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
hashutosh : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1480161&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1480161&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreUtils.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/PTFTranslator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/ctas_colname.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/ctas_colname.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13652669" author="hudson" created="Thu, 9 May 2013 02:10:15 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #188 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/188/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/188/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4392&quot; title=&quot;Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4392&quot;&gt;&lt;del&gt;HIVE-4392&lt;/del&gt;&lt;/a&gt; : Illogical InvalidObjectException throwed when use mulit aggregate functions with star columns  (Navis via Ashutosh Chauhan) (Revision 1480161)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
hashutosh : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1480161&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1480161&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveAlterHandler.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreUtils.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/PTFTranslator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/ctas_colname.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/ctas_colname.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13796165" author="ashutoshc" created="Tue, 15 Oct 2013 23:31:31 +0000"  >&lt;p&gt;This issue has been fixed and released as part of 0.12 release. If you find further issues, please create a new jira and link it to this one.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12646559">HIVE-4522</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12643848">HIVE-4391</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12579796" name="HIVE-4392.D10431.1.patch" size="13173" author="phabricator@reviews.facebook.net" created="Mon, 22 Apr 2013 07:45:15 +0000"/>
                            <attachment id="12579986" name="HIVE-4392.D10431.2.patch" size="25876" author="phabricator@reviews.facebook.net" created="Tue, 23 Apr 2013 06:31:15 +0000"/>
                            <attachment id="12580450" name="HIVE-4392.D10431.3.patch" size="26981" author="phabricator@reviews.facebook.net" created="Thu, 25 Apr 2013 02:06:14 +0000"/>
                            <attachment id="12581090" name="HIVE-4392.D10431.4.patch" size="31632" author="phabricator@reviews.facebook.net" created="Tue, 30 Apr 2013 00:32:15 +0000"/>
                            <attachment id="12581646" name="HIVE-4392.D10431.5.patch" size="50037" author="phabricator@reviews.facebook.net" created="Fri, 3 May 2013 00:52:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>324231</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 6 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1jxtr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>324576</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>