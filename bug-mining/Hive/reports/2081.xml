<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:17:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-6783] Incompatible schema for maps between parquet-hive and parquet-pig</title>
                <link>https://issues.apache.org/jira/browse/HIVE-6783</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;see also in following parquet issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/Parquet/parquet-mr/issues/290&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/Parquet/parquet-mr/issues/290&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The schema written for maps isn&apos;t compatible between hive and pig. This means any files written in one cannot be properly read in the other.&lt;/p&gt;

&lt;p&gt;More specifically,  for the same map column c1, parquet-pig generates schema:&lt;/p&gt;

&lt;p&gt;message pig_schema {&lt;br/&gt;
  optional group c1 (MAP) {&lt;br/&gt;
    repeated group map (MAP_KEY_VALUE) &lt;/p&gt;
{
      required binary key (UTF8);
      optional binary value;
    }
&lt;p&gt;   &lt;br/&gt;
  }&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;while parquet-hive generates schema:&lt;br/&gt;
message hive_schema {&lt;br/&gt;
   optional group c1 (MAP_KEY_VALUE) {&lt;br/&gt;
     repeated group map &lt;/p&gt;
{
       required binary key;
       optional binary value;
   }
&lt;p&gt; }&lt;br/&gt;
}&lt;/p&gt;</description>
                <environment></environment>
        <key id="12704406">HIVE-6783</key>
            <summary>Incompatible schema for maps between parquet-hive and parquet-pig</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tongjie">Tongjie Chen</reporter>
                        <labels>
                    </labels>
                <created>Sat, 29 Mar 2014 02:16:08 +0000</created>
                <updated>Mon, 9 Jun 2014 06:39:39 +0000</updated>
                            <resolved>Wed, 2 Apr 2014 21:57:57 +0000</resolved>
                                    <version>0.13.0</version>
                                    <fixVersion>0.13.1</fixVersion>
                    <fixVersion>0.14.0</fixVersion>
                                    <component>File Formats</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13951776" author="tongjie" created="Sat, 29 Mar 2014 05:55:15 +0000"  >&lt;p&gt;this patch will correctly convert hive map type (consistent with Pig map)&lt;/p&gt;</comment>
                            <comment id="13954269" author="hiveqa" created="Sat, 29 Mar 2014 14:28:58 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12637609/HIVE-6783.1.patch.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12637609/HIVE-6783.1.patch.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 5503 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2031/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2031/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2031/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2031/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12637609&lt;/p&gt;</comment>
                            <comment id="13954288" author="brocknoland" created="Sat, 29 Mar 2014 15:30:17 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;The patch has tabs where as Hive requires two spaces. Can you fix that and then put a Review Board item up? (reviews.apache.org)&lt;/p&gt;

&lt;p&gt;FYI &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jcoffey&quot; class=&quot;user-hover&quot; rel=&quot;jcoffey&quot;&gt;jcoffey&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13954294" author="brocknoland" created="Sat, 29 Mar 2014 15:37:52 +0000"  >&lt;p&gt;FYI &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=szehon&quot; class=&quot;user-hover&quot; rel=&quot;szehon&quot;&gt;szehon&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13954375" author="tongjie" created="Sat, 29 Mar 2014 18:14:52 +0000"  >&lt;p&gt;remove tab and clean up some format&lt;/p&gt;</comment>
                            <comment id="13954387" author="tongjie" created="Sat, 29 Mar 2014 18:41:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/19825/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/19825/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13954543" author="hiveqa" created="Sun, 30 Mar 2014 01:33:01 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12637662/HIVE-6783.4.patch.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12637662/HIVE-6783.4.patch.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 1 failed/errored test(s), 5503 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hive.jdbc.TestJdbcDriver2.testNewConnectionConfiguration
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2036/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2036/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2036/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2036/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12637662&lt;/p&gt;</comment>
                            <comment id="13954548" author="tongjie" created="Sun, 30 Mar 2014 02:07:18 +0000"  >&lt;p&gt;Hmm, why formatting code would cause one previously passed test to fail. The failure is related to jdbc, which is unrelated at all.&lt;/p&gt;

&lt;p&gt;Is that transient error?&lt;/p&gt;</comment>
                            <comment id="13954940" author="szehon" created="Mon, 31 Mar 2014 04:46:15 +0000"  >&lt;p&gt;Hi Tongjie yea it looks like a transient error, a few pre commit builds around that time also failed with same failure.&lt;/p&gt;

&lt;p&gt;About this patch, my question is, will it affect backward compatibility of reading existing stored maps in hive-parquet?&lt;/p&gt;</comment>
                            <comment id="13955563" author="tongjie" created="Mon, 31 Mar 2014 19:25:27 +0000"  >&lt;p&gt;I think it should be backward compatible, I am able to read existing stored maps with this fix.&lt;/p&gt;</comment>
                            <comment id="13955782" author="szehon" created="Mon, 31 Mar 2014 22:06:26 +0000"  >&lt;p&gt;Thanks, that is my only concern to not break existing stored maps, I&apos;m ok if thats the case.  Although I wonder, it would seem pig should be able to read hive&apos;s maps if that is the case, because we are using pig&apos;s schema now to read?  Or is there some difference there?&lt;/p&gt;</comment>
                            <comment id="13955845" author="tongjie" created="Mon, 31 Mar 2014 22:56:52 +0000"  >&lt;p&gt;The fix presented in this jira is to tag map type with the appropriate OriginalType.&lt;/p&gt;

&lt;p&gt;The reason hive is backward compatible is that when parquet-hive converts parquet fields map.key and map.value back to hive map column, it does not check MAP_KEY_VALUE OriginalType.  Also, the equals method of GroupType does not check OriginalType at all, hence hive_schema and pig_schema shown in description section are treated as equal (the only different is OriginalType).&lt;/p&gt;

&lt;p&gt;However, parquet-pig&apos;s PigSchemaConverter checks to make sure map&apos;s OriginalType is of correct type, hence it breaks when it reads Hive&apos;s map.&lt;/p&gt;

&lt;p&gt;With the fix, pig now can read hive&apos;s map since hive converts it right.&lt;/p&gt;</comment>
                            <comment id="13955851" author="szehon" created="Mon, 31 Mar 2014 23:00:21 +0000"  >&lt;p&gt;Thanks looks good to me.  + &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brocknoland&quot; class=&quot;user-hover&quot; rel=&quot;brocknoland&quot;&gt;brocknoland&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13956820" author="xuefuz" created="Tue, 1 Apr 2014 17:53:04 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13958229" author="xuefuz" created="Wed, 2 Apr 2014 21:57:30 +0000"  >&lt;p&gt;Patch committed to trunk. Thanks to Tongjie for the contribution.&lt;/p&gt;

&lt;p&gt;BTW, it seems that you&apos;re not in the contributor list so I&apos;m not able to assign this JIRA to your credit. You might request this on dev email list.&lt;/p&gt;</comment>
                            <comment id="13972122" author="szehon" created="Thu, 17 Apr 2014 00:12:43 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhbutani&quot; class=&quot;user-hover&quot; rel=&quot;rhbutani&quot;&gt;rhbutani&lt;/a&gt;, the Parquet community is wondering if this can be also in 0.13.1, or some release of 0.13?  That would be helpful , as this fixes parquet format compatibility between hive and pig.  Thanks.&lt;/p&gt;</comment>
                            <comment id="13995680" author="sushanth" created="Mon, 12 May 2014 21:47:12 +0000"  >&lt;p&gt;(Btw, to be explicit, this has been accepted for inclusion in 0.13.1, and will be part of it)&lt;/p&gt;</comment>
                            <comment id="14021693" author="thejas" created="Mon, 9 Jun 2014 06:39:39 +0000"  >&lt;p&gt;This jira has been fixed as part of 0.13.1 release. If you find further issues, please create a new jira and link it to this one.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12637609" name="HIVE-6783.1.patch.txt" size="3268" author="tongjie" created="Sat, 29 Mar 2014 05:55:15 +0000"/>
                            <attachment id="12637660" name="HIVE-6783.2.patch.txt" size="3284" author="tongjie" created="Sat, 29 Mar 2014 18:14:52 +0000"/>
                            <attachment id="12637661" name="HIVE-6783.3.patch.txt" size="3282" author="tongjie" created="Sat, 29 Mar 2014 18:32:42 +0000"/>
                            <attachment id="12637662" name="HIVE-6783.4.patch.txt" size="3280" author="tongjie" created="Sat, 29 Mar 2014 18:36:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>382740</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 24 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1txtr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>383008</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>