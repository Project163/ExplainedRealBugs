<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:17:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-23725] ValidTxnManager snapshot outdating causing partial reads in merge insert</title>
                <link>https://issues.apache.org/jira/browse/HIVE-23725</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;When the ValidTxnManager invalidates the snapshot during merge insert and starts to read committed transactions that were not committed when the query compilation happened, it can cause partial read problems if the committed transaction created new partition in the source or target table.&lt;/p&gt;

&lt;p&gt;The solution should be not only fix the snapshot but also recompile the query and acquire the locks again.&lt;br/&gt;
You could construct an example like this:&lt;br/&gt;
1. open and compile transaction 1 that merge inserts data from a partitioned source table that has a few partition.&lt;br/&gt;
2. Open, run and commit transaction 2 that inserts data to an old and a new partition to the source table.&lt;br/&gt;
3. Open, run and commit transaction 3 that inserts data to the target table of the merge statement, that will retrigger a snapshot generation in transaction 1.&lt;br/&gt;
4. Run transaction 1, the snapshot will be regenerated, and it will read partial data from transaction 2 breaking the ACID properties.&lt;/p&gt;

&lt;p&gt;Different setup.&lt;br/&gt;
Switch the transaction order:&lt;br/&gt;
1. compile transaction 1 that inserts data to an old and a new partition of the source table.&lt;br/&gt;
2. compile transaction 2 that insert data to the target table&lt;br/&gt;
2. compile transaction 3 that merge inserts data from the source table to the target table&lt;br/&gt;
3. run and commit transaction 1&lt;br/&gt;
4. run and commit transaction 2&lt;br/&gt;
5. run transaction 3, since it cointains 1 and 2 in its snaphot the isValidTxnListState will be triggered and we do a partial read of the transaction 1 for the same reasons.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13312424">HIVE-23725</key>
            <summary>ValidTxnManager snapshot outdating causing partial reads in merge insert</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pvargacl">Peter Varga</assignee>
                                    <reporter username="pvargacl">Peter Varga</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 19 Jun 2020 09:30:16 +0000</created>
                <updated>Tue, 27 Feb 2024 22:23:57 +0000</updated>
                            <resolved>Mon, 29 Jun 2020 07:18:47 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="27600">7h 40m</timespent>
                                <comments>
                            <comment id="17143023" author="jcamacho" created="Tue, 23 Jun 2020 15:07:24 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="17147593" author="dkuzmenko" created="Mon, 29 Jun 2020 07:18:37 +0000"  >&lt;p&gt;Pushed to master.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pvargacl&quot; class=&quot;user-hover&quot; rel=&quot;pvargacl&quot;&gt;pvargacl&lt;/a&gt;, thank you for the patch and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jcamachorodriguez&quot; class=&quot;user-hover&quot; rel=&quot;jcamachorodriguez&quot;&gt;jcamachorodriguez&lt;/a&gt; for the review!&lt;/p&gt;</comment>
                            <comment id="17183835" author="kgyrtkirk" created="Tue, 25 Aug 2020 07:55:23 +0000"  >&lt;ul&gt;
	&lt;li&gt;this patch added an arbitrary MAX_EXECUTION 10 ?&lt;/li&gt;
	&lt;li&gt;it&apos;s enabled by default???? it shouldn&apos;t be...it should be pluggable - so that you  don&apos;t mess up other plugins like this patch have done....&lt;/li&gt;
	&lt;li&gt;uses CommandProcessorException instead of tapping into the hooks? I see no benefit in that..&lt;/li&gt;
	&lt;li&gt;and changed ALL existing plugin to check for max executions ?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;why didn&apos;t you guys pinged me?&lt;/p&gt;</comment>
                            <comment id="17184112" author="jcamacho" created="Tue, 25 Aug 2020 15:00:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pvargacl&quot; class=&quot;user-hover&quot; rel=&quot;pvargacl&quot;&gt;pvargacl&lt;/a&gt;, could you create a follow-up to address &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kgyrtkirk&quot; class=&quot;user-hover&quot; rel=&quot;kgyrtkirk&quot;&gt;kgyrtkirk&lt;/a&gt; comments? It also seems the final version of the patch that landed is not the same one that I reviewed.&lt;/p&gt;</comment>
                            <comment id="17184154" author="pvargacl" created="Tue, 25 Aug 2020 15:52:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kgyrtkirk&quot; class=&quot;user-hover&quot; rel=&quot;kgyrtkirk&quot;&gt;kgyrtkirk&lt;/a&gt;&#160;I will have to work on an upgraded version of this, because releasing the locks when reexecuting causing problems when the degree of concurrent update queries for the same partition is high. I will try to address your comments there and invite you to review.&lt;/p&gt;

&lt;p&gt;Few questions, so I can go for the right direction:&lt;/p&gt;

&lt;p&gt;&#160;* I have seen that the other plugin implementation use hooks, but my problem was that this exception is thrown between the compilation and execution phase. Can I use the failure hook there, would the failure hook be called?&lt;br/&gt;
*&#160; The whole reexecution count misery was introduced, to make it possible for the new plugin to have an individual config for rexec count that can be higher than the&#160;HIVE_QUERY_MAX_REEXECUTION_COUNT, but still keep that config for every other plugin. If you have an idea how to solve this properly, I happy to implement it, because I do not like the current solution either&lt;/p&gt;</comment>
                            <comment id="17184162" author="kgyrtkirk" created="Tue, 25 Aug 2020 16:02:28 +0000"  >&lt;ul&gt;
	&lt;li&gt;I think using hooks is better - because it could give you more context about the actual system&apos;s state...if some information is not yet accessible using the hooks please try to extend the hooks with it...so that you can be notified/etc&lt;/li&gt;
	&lt;li&gt;making the plugin optional could have been usefull in that case...when a plugin doesn&apos;t work as expected; you could disable it - but in case it&apos;s burned in..you can&apos;t disable it...&lt;/li&gt;
	&lt;li&gt;I don&apos;t know why would you need to go over say HIVE_QUERY_MAX_REEXECUTION_COUNT - I think if we try something for 3 times it will likely not succeed after further attempts as well...&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17192760" author="dkuzmenko" created="Wed, 9 Sep 2020 10:11:09 +0000"  >&lt;p&gt;reverted commit e2a02f1: &lt;a href=&quot;https://github.com/apache/hive/pull/1474&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/pull/1474&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kgyrtkirk&quot; class=&quot;user-hover&quot; rel=&quot;kgyrtkirk&quot;&gt;kgyrtkirk&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pvargacl&quot; class=&quot;user-hover&quot; rel=&quot;pvargacl&quot;&gt;pvargacl&lt;/a&gt;, thank you for the review!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13326326">HIVE-24125</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13305887">HIVE-23503</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0g0og:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>