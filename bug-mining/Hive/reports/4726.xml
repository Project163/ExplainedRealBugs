<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:46:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-14027] NULL values produced by left outer join do not behave as NULL</title>
                <link>https://issues.apache.org/jira/browse/HIVE-14027</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Consider the following setup:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;create table tbl (n bigint, t string); 

insert into tbl values (1, &lt;span class=&quot;code-quote&quot;&gt;&apos;one&apos;&lt;/span&gt;); 
insert into tbl values(2, &lt;span class=&quot;code-quote&quot;&gt;&apos;two&apos;&lt;/span&gt;);

select a.n, a.t, isnull(b.n), isnull(b.t) from (select * from tbl where n = 1) a  left &lt;span class=&quot;code-keyword&quot;&gt;outer&lt;/span&gt; join  (select * from tbl where 1 = 2) b on a.n = b.n;

1    one    &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The query should return true for isnull(b.n).&lt;/p&gt;

&lt;p&gt;I&apos;ve tested by inserting a row with null value for the bigint column into tbl, and isnull returns true in that case. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12979563">HIVE-14027</key>
            <summary>NULL values produced by left outer join do not behave as NULL</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jcamacho">Jes&#250;s Camacho Rodr&#237;guez</assignee>
                                    <reporter username="vgumashta">Vaibhav Gumashta</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Jun 2016 22:52:26 +0000</created>
                <updated>Tue, 27 Feb 2024 22:23:56 +0000</updated>
                            <resolved>Mon, 11 Jul 2016 17:19:38 +0000</resolved>
                                    <version>1.2.1</version>
                    <version>2.2.0</version>
                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.1.1</fixVersion>
                    <fixVersion>2.2.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15342133" author="vgumashta" created="Tue, 21 Jun 2016 16:40:14 +0000"  >&lt;p&gt;Explain output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;hive&amp;gt; explain select a.n, a.t, isnull(b.n), isnull(b.t) from (select * from biq998_bigint where n = 1) a left &lt;span class=&quot;code-keyword&quot;&gt;outer&lt;/span&gt; join  (select * from biq998_bigint where 1 = 2) b on a.n = b.n;
OK
STAGE DEPENDENCIES:
  Stage-4 is a root stage
  Stage-3 depends on stages: Stage-4
  Stage-0 depends on stages: Stage-3

STAGE PLANS:
  Stage: Stage-4
    Map Reduce Local Work
      Alias -&amp;gt; Map Local Tables:
        $hdt$_1:biq998_bigint 
          Fetch Operator
            limit: -1
      Alias -&amp;gt; Map Local Operator Tree:
        $hdt$_1:biq998_bigint 
          TableScan
            alias: biq998_bigint
            Statistics: Num rows: 2 Data size: 10 Basic stats: COMPLETE Column stats: NONE
            Filter Operator
              predicate: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; (type: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;)
              Statistics: Num rows: 1 Data size: 5 Basic stats: COMPLETE Column stats: NONE
              Select Operator
                expressions: n (type: bigint), t (type: string)
                outputColumnNames: _col0, _col1
                Statistics: Num rows: 1 Data size: 5 Basic stats: COMPLETE Column stats: NONE
                HashTable Sink Operator
                  keys:
                    0 1 (type: bigint)
                    1 _col0 (type: bigint)

  Stage: Stage-3
    Map Reduce
      Map Operator Tree:
          TableScan
            alias: biq998_bigint
            Statistics: Num rows: 2 Data size: 10 Basic stats: COMPLETE Column stats: NONE
            Filter Operator
              predicate: (n = 1) (type: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;)
              Statistics: Num rows: 1 Data size: 5 Basic stats: COMPLETE Column stats: NONE
              Select Operator
                expressions: t (type: string)
                outputColumnNames: _col1
                Statistics: Num rows: 1 Data size: 5 Basic stats: COMPLETE Column stats: NONE
                Map Join Operator
                  condition map:
                       Left Outer Join0 to 1
                  keys:
                    0 1 (type: bigint)
                    1 _col0 (type: bigint)
                  outputColumnNames: _col1, _col2, _col3
                  Statistics: Num rows: 1 Data size: 5 Basic stats: COMPLETE Column stats: NONE
                  Select Operator
                    expressions: 1 (type: bigint), _col1 (type: string), _col2 is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; (type: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;), _col3 is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; (type: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;)
                    outputColumnNames: _col0, _col1, _col2, _col3
                    Statistics: Num rows: 1 Data size: 5 Basic stats: COMPLETE Column stats: NONE
                    File Output Operator
                      compressed: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
                      Statistics: Num rows: 1 Data size: 5 Basic stats: COMPLETE Column stats: NONE
                      table:
                          input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                          output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
                          serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
      Local Work:
        Map Reduce Local Work

  Stage: Stage-0
    Fetch Operator
      limit: -1
      Processor Tree:
        ListSink

Time taken: 0.637 seconds, Fetched: 70 row(s)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Looks like stage-4 after the filter operator should output 0 rows; stats shown are different.&lt;/p&gt;</comment>
                            <comment id="15346927" author="thejas" created="Thu, 23 Jun 2016 18:31:49 +0000"  >&lt;p&gt;This is happening only when UDF is in picture. If it is a select without UDF, the results are correct.&lt;br/&gt;
Some more experiments I ran with hive 1.2.1 -&lt;/p&gt;

&lt;p&gt;created a new table - tbl2&lt;br/&gt;
hive&amp;gt; select * from tbl2;&lt;br/&gt;
OK&lt;br/&gt;
2&#8194;&#8194;&#8194;&#8194;&#8194;&#8194; two&lt;br/&gt;
ran&#8194;&#8194;-&lt;br/&gt;
select a.n, a.t, concat(b.n, &quot;&quot;), concat(b.t, &quot;&quot;) from (select * from tbl where n = 1) a&#8194;&#8194;left outer join&#8194;&#8194;(select * from tbl2 where 1 = 2) b on a.n = b.n;&lt;br/&gt;
actually ran - select a.n, a.t, concat(b.n, &quot;&quot;), concat(b.t, &quot;&quot;) from (select * from tbl where n = 1) a&#8194;&#8194;left outer join&#8194;&#8194;(select * from tbl2 where 1 = 2) b on a.n = b.n;&lt;br/&gt;
ie replaced tbl with tbl2 for b in original query.&lt;br/&gt;
it gives -&lt;br/&gt;
1&#8194;&#8194;&#8194;&#8194;&#8194;&#8194; one&#8194;&#8194;&#8194;&#8194; 1&#8194;&#8194;&#8194;&#8194;&#8194;&#8194; NULL&lt;br/&gt;
looks like the join key is getting used as the input&lt;br/&gt;
ie . a.t is getting used as input&lt;br/&gt;
sorry, a.n is getting used as input to concat(b.n, &quot;&quot;)&lt;br/&gt;
there might be an assumption somewhere that a.n and b.n are the same, since this is a join&lt;br/&gt;
but doesn&apos;t hold true for outer join&lt;/p&gt;</comment>
                            <comment id="15347646" author="vaddebalu" created="Fri, 24 Jun 2016 03:50:48 +0000"  >&lt;p&gt;similar issue.&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-13977&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-13977&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15347734" author="thejas" created="Fri, 24 Jun 2016 05:20:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vaddebalu&quot; class=&quot;user-hover&quot; rel=&quot;vaddebalu&quot;&gt;vaddebalu&lt;/a&gt; did you mean to post link to a different jira ?&lt;/p&gt;</comment>
                            <comment id="15348967" author="jcamacho" created="Sat, 25 Jun 2016 00:56:15 +0000"  >&lt;p&gt;It seems to be a problem in the execution side, not in the planner.&lt;/p&gt;

&lt;p&gt;If we set hive.auto.convert.join to false, we execute a MergeJoin and we get correct results.&lt;/p&gt;</comment>
                            <comment id="15350484" author="vaddebalu" created="Mon, 27 Jun 2016 06:43:28 +0000"  >&lt;p&gt;Yes, I modified link&lt;/p&gt;</comment>
                            <comment id="15353599" author="jcamacho" created="Tue, 28 Jun 2016 19:42:20 +0000"  >&lt;p&gt;Problem was in the initialization of MapJoin operator. We use the object inspector from the key of the BigTable in the MapJoin for the key of the broadcast table, but this is not correct for outer joins (if you have not match for a left record, the value for the key column in the right side will be null). I have uploaded a fix and the test case to validate the fix.&lt;/p&gt;</comment>
                            <comment id="15355602" author="ashutoshc" created="Wed, 29 Jun 2016 18:41:17 +0000"  >&lt;p&gt;+1 &lt;br/&gt;
expect few golden file updates&lt;/p&gt;</comment>
                            <comment id="15357442" author="hiveqa" created="Thu, 30 Jun 2016 16:46:26 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12814188/HIVE-14027.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12814188/HIVE-14027.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 21 failed/errored test(s), 10287 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_12
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_list_bucket
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_multiinsert
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_tez_union
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_vector_complex_all
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_vector_complex_join
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_auto_join29
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_auto_join30
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_auto_join_filters
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_auto_join_nulls
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_empty_join
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_tez_union
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_groupby_mapjoin
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_join30
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_join_filters
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_join_nulls
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_nullsafe_join
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_outer_join0
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_outer_join1
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_outer_join4
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_outer_join6
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/326/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/326/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/326/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/326/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-326/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-326/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 21 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12814188 - PreCommit-HIVE-MASTER-Build&lt;/p&gt;</comment>
                            <comment id="15358849" author="hiveqa" created="Fri, 1 Jul 2016 11:55:58 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12815493/HIVE-14027.01.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12815493/HIVE-14027.01.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 22 failed/errored test(s), 10288 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_12
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_13
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_list_bucket
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_multiinsert
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_tez_union
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_vector_complex_all
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_vector_complex_join
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_auto_join29
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_auto_join30
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_auto_join_filters
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_auto_join_nulls
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_empty_join
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_tez_union
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_groupby_mapjoin
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_join30
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_join_filters
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_join_nulls
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_nullsafe_join
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_outer_join0
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_outer_join1
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_outer_join4
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_outer_join6
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/334/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/334/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/334/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/334/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-334/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-334/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 22 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12815493 - PreCommit-HIVE-MASTER-Build&lt;/p&gt;</comment>
                            <comment id="15369408" author="hiveqa" created="Sun, 10 Jul 2016 03:55:09 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12816954/HIVE-14027.02.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12816954/HIVE-14027.02.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 9 failed/errored test(s), 10297 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_acid_globallimit
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_12
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_13
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_multiinsert
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_vector_complex_all
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_vector_complex_join
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_acid_globallimit
org.apache.hadoop.hive.cli.TestMinimrCliDriver.org.apache.hadoop.hive.cli.TestMinimrCliDriver
org.apache.hadoop.hive.llap.tezplugins.TestLlapTaskSchedulerService.testDelayedLocalityNodeCommErrorImmediateAllocation
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/448/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/448/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/448/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/448/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-448/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-448/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 9 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12816954 - PreCommit-HIVE-MASTER-Build&lt;/p&gt;</comment>
                            <comment id="15370444" author="jcamacho" created="Mon, 11 Jul 2016 09:29:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt;, fails are unrelated. Could you review the additional changes? Basically I extended the UnwrapRowContainer to deal with different types in the key for outer/inner part of the join. &lt;/p&gt;

&lt;p&gt;Btw, there are no q file changes because the only thing that is changing is the internal representation in the Join i.e. the object inspectors. I added additional tests to the new q file though.&lt;/p&gt;</comment>
                            <comment id="15370982" author="ashutoshc" created="Mon, 11 Jul 2016 15:31:50 +0000"  >&lt;p&gt;Instead of adding converter wondering if its possible to get OI itself from outer side?&lt;/p&gt;</comment>
                            <comment id="15370984" author="jcamacho" created="Mon, 11 Jul 2016 15:33:21 +0000"  >&lt;p&gt;That is the source of the original problem and what the code was originally doing: the problem is that OI of the outer side becomes constant OI, and thus, the one of the inner side would return the constant too.&lt;/p&gt;</comment>
                            <comment id="15371085" author="ashutoshc" created="Mon, 11 Jul 2016 16:16:30 +0000"  >&lt;p&gt;Why does it become constant OI? Sounds like thats the problem. It shouldn&apos;t be a constant OI. Or may be I am missing something.&lt;/p&gt;</comment>
                            <comment id="15371107" author="jcamacho" created="Mon, 11 Jul 2016 16:30:58 +0000"  >&lt;p&gt;Consider the original query:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;select a.n, a.t, isnull(b.n), isnull(b.t) from (select * from tbl where n = 1) a  left outer join  (select * from tbl where 1 = 2) b on a.n = b.n;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The field &lt;tt&gt;n&lt;/tt&gt; from table &lt;tt&gt;a&lt;/tt&gt; can become a constant &lt;tt&gt;1&lt;/tt&gt; when we fold the OI. For every record that the left outer join produces, &lt;tt&gt;n&lt;/tt&gt; will always be &lt;tt&gt;1&lt;/tt&gt;. The real problem is that the &lt;em&gt;MapJoin&lt;/em&gt; reuses the OI of the key from the outer side for the key of the inner side. This is fine for inner joins, but it is incorrect for outer joins.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Solution 1&lt;/em&gt; would be to rewrite the &lt;em&gt;MapJoin&lt;/em&gt; operator logic. But that change is non-trivial (at least for me that I am not familiar with the operator logic). After I studied it initially, I did not proceed with it, as I would have to change the initialization logic, process logic, UnwrapRowContainer, etc.&lt;/p&gt;

&lt;p&gt;Thus, I went on with the &lt;em&gt;solution 2&lt;/em&gt; that is implemented in this patch. Consider an outer join. With this patch, OI for the outputs are created from outer and inner side independently from their inputs. But when there is a match in the join, the data for the key is always taken from the outer side (as it is done currently). Thus, we apply the &lt;em&gt;converter&lt;/em&gt; logic on the data to get the correct type.&lt;/p&gt;

&lt;p&gt;In fact, depending on the cost of deserializing vs cost of conversion, it might be that the current solution is more efficient than &lt;em&gt;solution 1&lt;/em&gt;.&lt;/p&gt;</comment>
                            <comment id="15371152" author="ashutoshc" created="Mon, 11 Jul 2016 16:53:44 +0000"  >&lt;p&gt;+1 lets file follow-up jira to retrieve key from correct side of join to eliminate need of converters.&lt;/p&gt;</comment>
                            <comment id="15371191" author="jcamacho" created="Mon, 11 Jul 2016 17:19:38 +0000"  >&lt;p&gt;Pushed to master, branch-2.1, branch-1. Thanks for the review &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12977133">HIVE-13977</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12988392">HIVE-14208</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12815493" name="HIVE-14027.01.patch" size="3601" author="jcamachorodriguez" created="Thu, 30 Jun 2016 15:51:44 +0000"/>
                            <attachment id="12816954" name="HIVE-14027.02.patch" size="7892" author="jcamachorodriguez" created="Sat, 9 Jul 2016 00:53:00 +0000"/>
                            <attachment id="12817108" name="HIVE-14027.03.patch" size="9317" author="jcamachorodriguez" created="Mon, 11 Jul 2016 09:29:30 +0000"/>
                            <attachment id="12814188" name="HIVE-14027.patch" size="3601" author="jcamachorodriguez" created="Tue, 28 Jun 2016 21:14:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 19 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2zj47:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>