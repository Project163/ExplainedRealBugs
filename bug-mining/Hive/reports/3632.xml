<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:35:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-11118] Load data query should validate file formats with destination tables</title>
                <link>https://issues.apache.org/jira/browse/HIVE-11118</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Load data local inpath queries does not do any validation wrt file format. If the destination table is ORC and if we try to load files that are not ORC, the load will succeed but querying such tables will result in runtime exceptions. We can do some simple sanity checks to prevent loading of files that does not match the destination table file format.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12840698">HIVE-11118</key>
            <summary>Load data query should validate file formats with destination tables</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="prasanth_j">Prasanth Jayachandran</assignee>
                                    <reporter username="prasanth_j">Prasanth Jayachandran</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Jun 2015 00:10:20 +0000</created>
                <updated>Tue, 16 Feb 2016 23:51:16 +0000</updated>
                            <resolved>Sat, 27 Jun 2015 01:53:33 +0000</resolved>
                                    <version>1.3.0</version>
                    <version>2.0.0</version>
                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14602235" author="prasanth_j" created="Fri, 26 Jun 2015 01:25:33 +0000"  >&lt;p&gt;Addressed Gunther&apos;s review comments. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hagleitn&quot; class=&quot;user-hover&quot; rel=&quot;hagleitn&quot;&gt;hagleitn&lt;/a&gt; Can you take a look again?&lt;/p&gt;</comment>
                            <comment id="14602276" author="xuefuz" created="Fri, 26 Jun 2015 02:07:43 +0000"  >&lt;p&gt;Just curious, does it make sense to do the check generically rather than specifically for ORC?&lt;/p&gt;</comment>
                            <comment id="14602302" author="hagleitn" created="Fri, 26 Jun 2015 02:36:11 +0000"  >&lt;p&gt;+1. You could use multiple exception handlers instead of the if-then-else. I also think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt; is right, but that probably requires introducing a new interface that can check magic byte for participating formats, etc. Maybe create a follow-up jira?&lt;/p&gt;</comment>
                            <comment id="14602310" author="prasanth_j" created="Fri, 26 Jun 2015 02:46:33 +0000"  >&lt;p&gt;Agreed we should do this generically. Also for some formats like text, sequence files that are not managed within hive its not possible to implement this interface.&lt;br/&gt;
Created to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11120&quot; title=&quot;Generic interface for file format validation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11120&quot;&gt;&lt;del&gt;HIVE-11120&lt;/del&gt;&lt;/a&gt; for implementing generic file format validation interface. Also a subtask for ORC to implement the interface (&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11121&quot; title=&quot;Make ORC implement file format validation interface&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11121&quot;&gt;&lt;del&gt;HIVE-11121&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="14602322" author="prasanth_j" created="Fri, 26 Jun 2015 02:54:40 +0000"  >&lt;p&gt;Remove instanceof check for returned exception.&lt;/p&gt;</comment>
                            <comment id="14603885" author="hiveqa" created="Sat, 27 Jun 2015 01:44:12 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12742179/HIVE-11118.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12742179/HIVE-11118.4.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 9030 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4402/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4402/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4402/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4402/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4402/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4402/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12742179 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14603894" author="hagleitn" created="Sat, 27 Jun 2015 01:53:33 +0000"  >&lt;p&gt;Committed to branch-1 and master. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="14604843" author="lefty@hortonworks.com" created="Sun, 28 Jun 2015 19:10:36 +0000"  >&lt;p&gt;Nudge:  This needs to show Fix Versions 1.3.0 and 2.0.0.&lt;/p&gt;

&lt;p&gt;(Commits 49da35903f8334d6dd0c597563c34388772914cc &amp;amp; d373962de475ea9f3ef7b2594fbc5d8488636af0.)&lt;/p&gt;</comment>
                            <comment id="14617264" author="sushanth" created="Tue, 7 Jul 2015 19:53:10 +0000"  >&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=leftylev&quot; class=&quot;user-hover&quot; rel=&quot;leftylev&quot;&gt;leftylev&lt;/a&gt;! Added.&lt;/p&gt;</comment>
                            <comment id="14617271" author="sushanth" created="Tue, 7 Jul 2015 20:01:11 +0000"  >&lt;p&gt;I have a question here - I will open another bug if need be, but if it&apos;s a simple misunderstanding, it won&apos;t matter.&lt;/p&gt;

&lt;p&gt;From the patch, I see the following bit:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;	337	  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void ensureFileFormatsMatch(TableSpec ts, URI fromURI) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SemanticException {
338	    &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; InputFormat&amp;gt; destInputFormat = ts.tableHandle.getInputFormatClass();
339	    &lt;span class=&quot;code-comment&quot;&gt;// Other file formats should &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; similar check to make sure file formats match
&lt;/span&gt;340	    &lt;span class=&quot;code-comment&quot;&gt;// when doing LOAD DATA .. INTO TABLE
&lt;/span&gt;341	    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (OrcInputFormat.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;equals(destInputFormat)) {
342	      Path inputFilePath = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(fromURI);
343	      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
344	        FileSystem fs = FileSystem.get(fromURI, conf);
345	        &lt;span class=&quot;code-comment&quot;&gt;// just creating orc reader is going to &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; sanity checks to make sure its valid ORC file
&lt;/span&gt;346	        OrcFile.createReader(fs, inputFilePath);
347	      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (FileFormatException e) {
348	        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SemanticException(ErrorMsg.INVALID_FILE_FORMAT_IN_LOAD.getMsg(&lt;span class=&quot;code-quote&quot;&gt;&quot;Destination&quot;&lt;/span&gt; +
349	            &lt;span class=&quot;code-quote&quot;&gt;&quot; table is stored as ORC but the file being loaded is not a valid ORC file.&quot;&lt;/span&gt;));
350	      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
351	        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SemanticException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to load data to destination table.&quot;&lt;/span&gt; +
352	            &lt;span class=&quot;code-quote&quot;&gt;&quot; Error: &quot;&lt;/span&gt; + e.getMessage());
353	      }
354	    }
355	  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now, it&apos;s entirely possible that the table in question is an ORC table, but the partition being loaded is of another format, such as Text - Hive supports mixed partition scenarios. In fact, this is a likely scenario in the case of a replication of a table that used to be Text, but has been converted to Orc, so that all new partitions will be orc. Then, in that case, the destination table will be a MANAGED_TABLE, and will be an &quot;orc&quot; table, but import will try to load a text partition on to it.&lt;/p&gt;

&lt;p&gt;Shouldn&apos;t this refer to a partitionspec rather than the table&apos;s inputformat for this check to work with that scenario?&lt;/p&gt;</comment>
                            <comment id="14617317" author="prasanth_j" created="Tue, 7 Jul 2015 20:24:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sushanth&quot; class=&quot;user-hover&quot; rel=&quot;sushanth&quot;&gt;sushanth&lt;/a&gt; Thanks for looking into this. Yes. Its entirely possible that table desc is ORC and partition desc is of other formats. Hive supports that. I missed that part when I put up the patch. The check should use the partition desc for partitioned table instead of table desc throughout. Can you please create a separate bug for it? I will address it shortly.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12843365">HIVE-11198</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12742016" name="HIVE-11118.2.patch" size="16619" author="prasanth_j" created="Fri, 26 Jun 2015 01:25:02 +0000"/>
                            <attachment id="12742024" name="HIVE-11118.3.patch" size="16574" author="prasanth_j" created="Fri, 26 Jun 2015 02:54:40 +0000"/>
                            <attachment id="12742179" name="HIVE-11118.4.patch" size="16574" author="hagleitn" created="Fri, 26 Jun 2015 18:08:36 +0000"/>
                            <attachment id="12741996" name="HIVE-11118.patch" size="8734" author="prasanth_j" created="Fri, 26 Jun 2015 00:11:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 20 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ginr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>