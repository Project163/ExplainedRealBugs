<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:27:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-27944] Possible deadlock in HIVE-LLAP when reading  location-based Iceberg tables</title>
                <link>https://issues.apache.org/jira/browse/HIVE-27944</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;We found that org.apache.hadoop.hive.ql.plan.PartitionDesc.equals() may deadlock in a multithreaded environment.&lt;/p&gt;

&lt;p&gt;Here&apos;s the deadlock information we&apos;ve gathered:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;DAG44-Input-4-16&quot;&lt;/span&gt; Id=161 BLOCKED on org.apache.hadoop.hive.common.CopyOnFirstWriteProperties@44196d35 owned by &lt;span class=&quot;code-quote&quot;&gt;&quot;DAG44-Input-4-15&quot;&lt;/span&gt; Id=160
&#160; &#160; at org.apache.hadoop.hive.common.CopyOnFirstWriteProperties.size(CopyOnFirstWriteProperties.java:315)
&#160; &#160; - &#160;blocked on org.apache.hadoop.hive.common.CopyOnFirstWriteProperties@44196d35
&#160; &#160; at java.util.Hashtable.equals(Hashtable.java:801)
&#160; &#160; - &#160;locked java.util.Properties@77a541be &amp;lt;---- but blocks 3 other threads!
&#160; &#160; at org.apache.hadoop.hive.common.CopyOnFirstWriteProperties.equals(CopyOnFirstWriteProperties.java:213)
&#160; &#160; - &#160;locked org.apache.hadoop.hive.common.CopyOnFirstWriteProperties@2d973aa3
&#160; &#160; at org.apache.hadoop.hive.ql.plan.PartitionDesc.equals(PartitionDesc.java:327)
&#160; &#160; at java.util.AbstractMap.equals(AbstractMap.java:495)
&#160; &#160; at java.util.concurrent.ConcurrentHashMap.get(ConcurrentHashMap.java:940)
&#160; &#160; at org.apache.hadoop.hive.ql.io.HiveFileFormatUtils.getFromPathRecursively(HiveFileFormatUtils.java:374)
&#160; &#160; at org.apache.hadoop.hive.ql.io.HiveFileFormatUtils.getFromPathRecursively(HiveFileFormatUtils.java:359)
&#160; &#160; at org.apache.hadoop.hive.ql.io.HiveFileFormatUtils.getFromPathRecursively(HiveFileFormatUtils.java:354)
&#160; &#160; at org.apache.hadoop.hive.ql.exec.tez.SplitGrouper.schemaEvolved(SplitGrouper.java:278)
&#160; &#160; at org.apache.hadoop.hive.ql.exec.tez.SplitGrouper.generateGroupedSplits(SplitGrouper.java:183)
&#160; &#160; at org.apache.hadoop.hive.ql.exec.tez.SplitGrouper.generateGroupedSplits(SplitGrouper.java:160)
&#160; &#160; at org.apache.hadoop.hive.ql.exec.tez.HiveSplitGenerator.initialize(HiveSplitGenerator.java:287) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Since the Properties object implement HashTable interface, all the methods of the HashTable interface are synchronised.&lt;/p&gt;

&lt;p&gt;In a multi-threaded environment, a deadlock will occur when propA.equals(propB)&#160; and propB.equals(propA) occur at the same time.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I have a fix-idea for this, when we call CopyOnFirstWriteProperties.equals(), we can do a copy of the object within this method. Compare it with the copied object. If there are no problems with this solution, I will submit a PR.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13561095">HIVE-27944</key>
            <summary>Possible deadlock in HIVE-LLAP when reading  location-based Iceberg tables</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lisoda">yongzhi.shao</assignee>
                                    <reporter username="lisoda">yongzhi.shao</reporter>
                        <labels>
                            <label>hive-4.1.0-must</label>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 8 Dec 2023 06:14:31 +0000</created>
                <updated>Tue, 29 Jul 2025 14:51:42 +0000</updated>
                            <resolved>Fri, 11 Jul 2025 02:32:55 +0000</resolved>
                                    <version>3.1.3</version>
                    <version>4.0.0</version>
                    <version>4.0.1</version>
                                    <fixVersion>4.1.0</fixVersion>
                    <fixVersion>4.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17794539" author="lisoda" created="Fri, 8 Dec 2023 06:23:57 +0000"  >&lt;p&gt;Hi.&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dkuzmenko&quot; class=&quot;user-hover&quot; rel=&quot;dkuzmenko&quot;&gt;dkuzmenko&lt;/a&gt;&#160;.&lt;/p&gt;

&lt;p&gt;Can you see this issue?&lt;/p&gt;

&lt;p&gt;From the stack trace, this bug occurs when two InputInitializer threads access&#160;&lt;b&gt;SplitGrouper.cache[]&lt;/b&gt;&#160;simultaneously. When accessing SplitGrouper.cache[] (ConcurrentHashMap), equals() method is called on CopyOnFirstWriteProperties.&lt;/p&gt;</comment>
                            <comment id="17794596" author="dkuzmenko" created="Fri, 8 Dec 2023 09:03:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lisoda&quot; class=&quot;user-hover&quot; rel=&quot;lisoda&quot;&gt;lisoda&lt;/a&gt;, thanks for reporting this, let me check&lt;/p&gt;</comment>
                            <comment id="17794628" author="lisoda" created="Fri, 8 Dec 2023 10:35:55 +0000"  >&lt;p&gt;to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=glapark&quot; class=&quot;user-hover&quot; rel=&quot;glapark&quot;&gt;glapark&lt;/a&gt;&#160; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dkuzmenko&quot; class=&quot;user-hover&quot; rel=&quot;dkuzmenko&quot;&gt;dkuzmenko&lt;/a&gt; :&lt;/p&gt;

&lt;p&gt;SplitGrouper.cache[] related code was introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-9976&quot; title=&quot;Possible race condition in DynamicPartitionPruner for &amp;lt;200ms tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-9976&quot;&gt;&lt;del&gt;HIVE-9976&lt;/del&gt;&lt;/a&gt;. It seems that we should not define the cache property as static. This could be problematic.&lt;/p&gt;

&lt;p&gt;Since the SplitGrouper is always served as an object, I think it&apos;s a good idea to define the cache property as non-static.&lt;/p&gt;</comment>
                            <comment id="17795040" author="lisoda" created="Sun, 10 Dec 2023 08:23:13 +0000"  >&lt;p&gt;HI &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dkuzmenko&quot; class=&quot;user-hover&quot; rel=&quot;dkuzmenko&quot;&gt;dkuzmenko&lt;/a&gt;&#160; &#160;&amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=glapark&quot; class=&quot;user-hover&quot; rel=&quot;glapark&quot;&gt;glapark&lt;/a&gt; :&lt;/p&gt;

&lt;p&gt;By defining SplitGrouper.cache[] as a non-static property, we observed that the problem disappeared. So far we haven&apos;t found any adverse phenomena. But, let me see how this patch works for a little while longer.&lt;/p&gt;</comment>
                            <comment id="18000459" author="dkuzmenko" created="Sun, 6 Jul 2025 09:28:00 +0000"  >&lt;p&gt;hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lisoda&quot; class=&quot;user-hover&quot; rel=&quot;lisoda&quot;&gt;lisoda&lt;/a&gt;, that issue seems to have slipped through. Did we reach any common agreement on it? Have you already applied the fix to your prod env?&lt;/p&gt;</comment>
                            <comment id="18000460" author="lisoda" created="Sun, 6 Jul 2025 09:37:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dkuzmenko&quot; class=&quot;user-hover&quot; rel=&quot;dkuzmenko&quot;&gt;dkuzmenko&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;hello,sir.&lt;/p&gt;

&lt;p&gt;--Have you already applied the fix to your prod env?&lt;/p&gt;

&lt;p&gt;yea,and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=glapark&quot; class=&quot;user-hover&quot; rel=&quot;glapark&quot;&gt;glapark&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=seonggon&quot; class=&quot;user-hover&quot; rel=&quot;seonggon&quot;&gt;seonggon&lt;/a&gt; also use this patch.&lt;/p&gt;

&lt;p&gt;However, as of now, I still don&apos;t know how to reproduce this deadlock problem stably.Therefore, I don&apos;t know how to write a test case.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="18000462" author="dkuzmenko" created="Sun, 6 Jul 2025 09:53:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lisoda&quot; class=&quot;user-hover&quot; rel=&quot;lisoda&quot;&gt;lisoda&lt;/a&gt; could you please reopen the PR with the fix, let&apos;s get it in and worry about the test later. Thank you!&lt;/p&gt;</comment>
                            <comment id="18000463" author="lisoda" created="Sun, 6 Jul 2025 09:56:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dkuzmenko&quot; class=&quot;user-hover&quot; rel=&quot;dkuzmenko&quot;&gt;dkuzmenko&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Okay&lt;/p&gt;</comment>
                            <comment id="18004553" author="dkuzmenko" created="Thu, 10 Jul 2025 22:28:13 +0000"  >&lt;p&gt;Merged to master&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lisoda&quot; class=&quot;user-hover&quot; rel=&quot;lisoda&quot;&gt;lisoda&lt;/a&gt; for the fix! Please cherry-pick the commit to branch-4.1&lt;/p&gt;</comment>
                            <comment id="18004590" author="lisoda" created="Fri, 11 Jul 2025 02:29:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dkuzmenko&quot; class=&quot;user-hover&quot; rel=&quot;dkuzmenko&quot;&gt;dkuzmenko&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Sir, thank you for your help&lt;/p&gt;</comment>
                            <comment id="18004591" author="zhangbutao" created="Fri, 11 Jul 2025 02:35:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lisoda&quot; class=&quot;user-hover&quot; rel=&quot;lisoda&quot;&gt;lisoda&lt;/a&gt; Need to cherry-pich this PR branch-4.1 &lt;a href=&quot;https://github.com/apache/hive/tree/branch-4.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/tree/branch-4.1&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13065107" name="image-2023-12-08-14-17-53-822.png" size="602495" author="lisoda" created="Fri, 8 Dec 2023 06:17:59 +0000"/>
                            <attachment id="13065108" name="image-2023-12-08-14-22-18-998.png" size="81886" author="lisoda" created="Fri, 8 Dec 2023 06:22:22 +0000"/>
                            <attachment id="13065168" name="image-2023-12-10-16-24-34-351.png" size="111555" author="lisoda" created="Sun, 10 Dec 2023 08:24:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1m4ug:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12353994">4.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>