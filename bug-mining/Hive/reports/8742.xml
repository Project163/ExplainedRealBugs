<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:26:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-21614] Derby/Oracle does not support CLOB comparisons</title>
                <link>https://issues.apache.org/jira/browse/HIVE-21614</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;HiveMetaStoreClient.listTableNamesByFilter() with non empty filter causes exception with Derby DB:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caused by: ERROR 42818: Comparisons between &apos;CLOB (UCS_BASIC)&apos; and &apos;CLOB (UCS_BASIC)&apos; are not supported. Types must be comparable. String types must also have matching collation. If collation does not match, a possible solution is to cast operands to force them to the default collation (e.g. SELECT tablename FROM sys.systables WHERE CAST(tablename AS VARCHAR(128)) = &apos;T1&apos;)
	at org.apache.derby.iapi.error.StandardException.newException(Unknown Source)
	at org.apache.derby.iapi.error.StandardException.newException(Unknown Source)
	at org.apache.derby.impl.sql.compile.BinaryComparisonOperatorNode.bindComparisonOperator(Unknown Source)
	at org.apache.derby.impl.sql.compile.BinaryComparisonOperatorNode.bindExpression(Unknown Source)
	at org.apache.derby.impl.sql.compile.BinaryOperatorNode.bindExpression(Unknown Source)
	at org.apache.derby.impl.sql.compile.BinaryLogicalOperatorNode.bindExpression(Unknown Source)
	at org.apache.derby.impl.sql.compile.AndNode.bindExpression(Unknown Source)
	at org.apache.derby.impl.sql.compile.SelectNode.bindExpressions(Unknown Source)
	at org.apache.derby.impl.sql.compile.DMLStatementNode.bindExpressions(Unknown Source)
	at org.apache.derby.impl.sql.compile.DMLStatementNode.bind(Unknown Source)
	at org.apache.derby.impl.sql.compile.CursorNode.bindStatement(Unknown Source)
	at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source)
	at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source)
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source)
	... 42 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13228128">HIVE-21614</key>
            <summary>Derby/Oracle does not support CLOB comparisons</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dengzh">Zhihua Deng</assignee>
                                    <reporter username="vrozov">Vlad Rozov</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 15 Apr 2019 15:07:54 +0000</created>
                <updated>Tue, 29 Jul 2025 14:51:14 +0000</updated>
                            <resolved>Wed, 9 Oct 2024 05:02:18 +0000</resolved>
                                    <version>2.3.4</version>
                    <version>3.0.0</version>
                                    <fixVersion>4.1.0</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="10200">2h 50m</timespent>
                                <comments>
                            <comment id="16849571" author="findepi" created="Tue, 28 May 2019 10:21:51 +0000"  >&lt;p&gt;This breaks &lt;tt&gt;get_table_names_by_filter&lt;/tt&gt; Metastore thrift call when using &lt;tt&gt;hive_filter_field_params__&lt;/tt&gt; prefix (&lt;tt&gt;HIVE_FILTER_FIELD_PARAMS&lt;/tt&gt;)&lt;br/&gt;
Like in &lt;a href=&quot;https://github.com/apache/hive/blob/fcd4721591e0ba7d9ba24821f9528dadb7ec16fd/standalone-metastore/metastore-common/src/main/thrift/hive_metastore.thrift#L2019-L2020&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/blob/fcd4721591e0ba7d9ba24821f9528dadb7ec16fd/standalone-metastore/metastore-common/src/main/thrift/hive_metastore.thrift#L2019-L2020&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This probably affects Metastore running on Oracle too.&lt;/p&gt;</comment>
                            <comment id="17368642" author="hankfanchiu" created="Thu, 24 Jun 2021 06:16:39 +0000"  >&lt;p&gt;I&apos;ve run into this issue, in an attempt to push the filtering &amp;#8211; for the Iceberg table type &#8211; to the Metastore:&#160;&lt;a href=&quot;https://github.com/apache/iceberg/pull/2722&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/iceberg/pull/2722&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The Iceberg tests using Derby failed for the same reason as described above: &lt;a href=&quot;https://github.com/apache/iceberg/pull/2722#issuecomment-867363019&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/iceberg/pull/2722#issuecomment-867363019&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17368778" author="findepi" created="Thu, 24 Jun 2021 11:03:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hankfanchiu&quot; class=&quot;user-hover&quot; rel=&quot;hankfanchiu&quot;&gt;hankfanchiu&lt;/a&gt; , in Trino i worked around this limitation by issuing filter with `LIKE` instead of `=` predicate.&lt;/p&gt;

&lt;p&gt;The code is here&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/trinodb/trino/blob/d95eafe397fe4b476b2b1a73baeb7643349d4bdb/plugin/trino-hive/src/main/java/io/trino/plugin/hive/metastore/thrift/ThriftHiveMetastore.java#L973-L981&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/trinodb/trino/blob/d95eafe397fe4b476b2b1a73baeb7643349d4bdb/plugin/trino-hive/src/main/java/io/trino/plugin/hive/metastore/thrift/ThriftHiveMetastore.java#L973-L981&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17371613" author="hankfanchiu" created="Tue, 29 Jun 2021 20:03:56 +0000"  >&lt;p&gt;Hi&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pvary&quot; class=&quot;user-hover&quot; rel=&quot;pvary&quot;&gt;pvary&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Continuing the discussion from &lt;a href=&quot;https://github.com/apache/iceberg/pull/2722#issuecomment-867420525,&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/iceberg/pull/2722#issuecomment-867420525,&lt;/a&gt;&#160;how would you suggest fixing this in Hive?&lt;/p&gt;

&lt;p&gt;Looking at&#160;&lt;tt&gt;org.apache.hadoop.hive.metastore.ObjectStore&lt;/tt&gt;, I see that there is the existing pattern of checking &lt;tt&gt;SQLGenerator.getDbProduct().isDERBY()&lt;/tt&gt;, e.g.:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hive/blob/dc8891ec9459d2eff5a23154383ec3bd19481fd2/standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/ObjectStore.java#L11146&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/blob/dc8891ec9459d2eff5a23154383ec3bd19481fd2/standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/ObjectStore.java#L11146&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;However, I don&apos;t think that it would be appropriate to do so within &lt;tt&gt;ObjectStore#listTableNamesByFilter&lt;/tt&gt; without doing fragile string replacement:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hive/blob/f7a21abf5579a8df07117928caff2d72ecae27e3/standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/ObjectStore.java#L4793-L4833&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/blob/f7a21abf5579a8df07117928caff2d72ecae27e3/standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/ObjectStore.java#L4793-L4833&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;One level lower, &lt;tt&gt;org.apache.hadoop.hive.metastore.parser.ExpressionTree&lt;/tt&gt; has no concern with the database product.&lt;/p&gt;</comment>
                            <comment id="17379116" author="pvary" created="Mon, 12 Jul 2021 10:43:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hankfanchiu&quot; class=&quot;user-hover&quot; rel=&quot;hankfanchiu&quot;&gt;hankfanchiu&lt;/a&gt;: I would add the change to &lt;tt&gt;ObjectStore.makeQueryFilterString&lt;/tt&gt;. I would convert, or change the &lt;tt&gt;ExpressionTree&lt;/tt&gt; to use the &lt;tt&gt;LIKE&lt;/tt&gt; operation instead of the &lt;tt&gt;`=`&lt;/tt&gt; when it is needed. What do you think?&lt;/p&gt;</comment>
                            <comment id="17887766" author="dengzh" created="Wed, 9 Oct 2024 05:02:08 +0000"  >&lt;p&gt;Thank you for the review, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dkuzmenko&quot; class=&quot;user-hover&quot; rel=&quot;dkuzmenko&quot;&gt;dkuzmenko&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12908275">HIVE-12274</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z01su0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>