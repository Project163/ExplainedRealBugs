<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:06:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-4394] test leadlag.q fails</title>
                <link>https://issues.apache.org/jira/browse/HIVE-4394</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;ant test -Dtestcase=TestCliDriver -Dqfile=leadlag.q fails.&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhbutani&quot; class=&quot;user-hover&quot; rel=&quot;rhbutani&quot;&gt;rhbutani&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12643870">HIVE-4394</key>
            <summary>test leadlag.q fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ashutoshc">Ashutosh Chauhan</assignee>
                                    <reporter username="namit">Namit Jain</reporter>
                        <labels>
                    </labels>
                <created>Mon, 22 Apr 2013 04:32:25 +0000</created>
                <updated>Thu, 16 May 2013 21:10:30 +0000</updated>
                            <resolved>Tue, 23 Apr 2013 15:35:12 +0000</resolved>
                                    <version>0.11.0</version>
                                    <fixVersion>0.11.0</fixVersion>
                                    <component>PTF-Windowing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13637820" author="ashutoshc" created="Mon, 22 Apr 2013 07:56:52 +0000"  >&lt;p&gt;Looks like this is related to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4130&quot; title=&quot;Bring the Lead/Lag UDFs interface in line with Lead/Lag UDAFs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4130&quot;&gt;&lt;del&gt;HIVE-4130&lt;/del&gt;&lt;/a&gt; where we changed the default amount for lead/lag function to 1 instead of 0.&lt;/p&gt;</comment>
                            <comment id="13638282" author="ashutoshc" created="Mon, 22 Apr 2013 18:28:28 +0000"  >&lt;p&gt;I am not sure what&apos;s going on, its the query 4 which is failing. When I ran the same query again postgres, I got results which match the previous output. So, certainly the new results are wrong and needs investigation.&lt;/p&gt;</comment>
                            <comment id="13638514" author="ashutoshc" created="Mon, 22 Apr 2013 22:28:21 +0000"  >&lt;p&gt;I think whats happening. For rows where column value can&apos;t be computed (e.g. first row of lag function) we return null, whereas earlier we use to return current value.  I am not sure whats correct (or what standard says) but postgres atleast seems to do what we were doing earlier (ie, return current column value).&lt;/p&gt;</comment>
                            <comment id="13638798" author="rhbutani" created="Tue, 23 Apr 2013 05:25:53 +0000"  >&lt;p&gt;Previously we used to return the first/last value in the window if the evaluation of lag/lead amounted to an index that crossed the boundary. Now we return the default value. Since in this e.g. we don&apos;t have a default value, we return null.&lt;/p&gt;

&lt;p&gt;Also the way we interpret this query maybe different from Postgres. We treat the lag function as a UDF when it appears as an argument of a UDAF. So we do the sum in one pass. As far as I know this concept of lead/lag udfs is unique to us. Is Postgres allowing for UDAFs to be arguments of other UDAFs. We don&apos;t support this.&lt;/p&gt;</comment>
                            <comment id="13638842" author="ashutoshc" created="Tue, 23 Apr 2013 06:47:09 +0000"  >&lt;p&gt;Yeah, I ran the query as it is on pg, it ran fine and produced results.&lt;/p&gt;

&lt;p&gt;I read standard but couldn&apos;t determine if it actually says anything for this scenario. Reading online documentation for DB2, Sql Server and Oracle seems to indicate all of them return NULL in such cases. So, seems like only postgres has a different behavior. At this point to me either way is an acceptable solution. Harish, what do you think?&lt;/p&gt;</comment>
                            <comment id="13639139" author="rhbutani" created="Tue, 23 Apr 2013 15:07:31 +0000"  >&lt;p&gt;If I try this in pg:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;select  p_mfgr,p_name, p_size,   
sum(p_size - lag(p_size,1)  over(partition by p_mfgr  order by p_name) ) over(partition by p_mfgr  order by p_name ) as deltaSum 
from part 
window w1 as (rows between 2 preceding and 2 following)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;it  gives ERROR:  window function calls cannot be nested&lt;/p&gt;

&lt;p&gt;If I try this&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;select  p_mfgr,p_name, p_size,   
sum(p_size) over(partition by p_mfgr  order by p_name ) - lag(p_size,1) over(partition by p_mfgr  order by p_name ) as deltaSum 
from part 
window w1 as (rows between 2 preceding and 2 following)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;the first Mfr2 row has a null for delatSum.&lt;/p&gt;

&lt;p&gt;What was the query that gives 0? &lt;br/&gt;
Null seems like the right answer to me.&lt;/p&gt;</comment>
                            <comment id="13639142" author="ashutoshc" created="Tue, 23 Apr 2013 15:11:39 +0000"  >&lt;p&gt;Aah.. second time in a day : ( I thought I ran some query but really it was different.&lt;br/&gt;
Harish, you are right, postgres doesn&apos;t allow UDAF as an argument of another UDAF, so above query doesn&apos;t run on pg. I checked pg docs which also says to return NULL in case default is not defined. So, I think our new behavior is consistent with all other implementations. I will upload the patch overwriting .q.out file. Harish, can you take a look.&lt;/p&gt;</comment>
                            <comment id="13639150" author="rhbutani" created="Tue, 23 Apr 2013 15:22:41 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13639168" author="ashutoshc" created="Tue, 23 Apr 2013 15:35:12 +0000"  >&lt;p&gt;Committed to trunk. Thanks, Harish for review!&lt;/p&gt;</comment>
                            <comment id="13640057" author="hudson" created="Wed, 24 Apr 2013 04:04:44 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #172 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/172/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/172/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4394&quot; title=&quot;test leadlag.q fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4394&quot;&gt;&lt;del&gt;HIVE-4394&lt;/del&gt;&lt;/a&gt; : test leadlag.q fails (Ashutosh Chauhan) (Revision 1471015)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
hashutosh : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1471015&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1471015&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/leadlag.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13640101" author="hudson" created="Wed, 24 Apr 2013 05:24:35 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #2076 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/2076/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/2076/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4394&quot; title=&quot;test leadlag.q fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4394&quot;&gt;&lt;del&gt;HIVE-4394&lt;/del&gt;&lt;/a&gt; : test leadlag.q fails (Ashutosh Chauhan) (Revision 1471015)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
hashutosh : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1471015&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1471015&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/leadlag.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12580059" name="HIVE-4394.patch" size="1840" author="ashutoshc" created="Tue, 23 Apr 2013 15:15:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>324237</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 31 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1jxv3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>324582</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>