<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:04:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-3999] Mysql metastore upgrade script will end up with different schema than the full schema load</title>
                <link>https://issues.apache.org/jira/browse/HIVE-3999</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;I&apos;ve noticed that the file &lt;tt&gt;hive-schema-0.10.0.mysql.sql&lt;/tt&gt; is creating table SDS with following column:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  `IS_STOREDASSUBDIRECTORIES` bit(1) NOT NULL,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However the upgrade script &lt;tt&gt;011-&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3649&quot; title=&quot;Hive List Bucketing - enhance DDL to specify list bucketing table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3649&quot;&gt;&lt;del&gt;HIVE-3649&lt;/del&gt;&lt;/a&gt;.mysql.sql&lt;/tt&gt; will create the column differently:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ALTER TABLE `SDS` ADD `IS_STOREDASSUBDIRECTORIES` bit(1) ;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thus user will get slightly different schema each time - once with &quot;NOT NULL&quot; and secondly with &quot;NULL&quot; definition.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12631340">HIVE-3999</key>
            <summary>Mysql metastore upgrade script will end up with different schema than the full schema load</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jarcec">Jarek Jarcec Cecho</assignee>
                                    <reporter username="jarcec">Jarek Jarcec Cecho</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Feb 2013 21:24:10 +0000</created>
                <updated>Thu, 16 May 2013 21:10:38 +0000</updated>
                            <resolved>Fri, 8 Feb 2013 11:43:28 +0000</resolved>
                                                    <fixVersion>0.11.0</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13574253" author="mgrover" created="Fri, 8 Feb 2013 05:03:32 +0000"  >&lt;p&gt;+1 (non-committer)&lt;/p&gt;</comment>
                            <comment id="13574414" author="namit" created="Fri, 8 Feb 2013 11:43:28 +0000"  >&lt;p&gt;Committed. Thanks Jarek and Mark&lt;/p&gt;</comment>
                            <comment id="13574474" author="hudson" created="Fri, 8 Feb 2013 13:29:32 +0000"  >&lt;p&gt;Integrated in hive-trunk-hadoop1 #73 (See &lt;a href=&quot;https://builds.apache.org/job/hive-trunk-hadoop1/73/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/hive-trunk-hadoop1/73/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3999&quot; title=&quot;Mysql metastore upgrade script will end up with different schema than the full schema load&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3999&quot;&gt;&lt;del&gt;HIVE-3999&lt;/del&gt;&lt;/a&gt; Mysql metastore upgrade script will end up with different schema than&lt;br/&gt;
the full schema load (Jarek and Mark via namit) (Revision 1443952)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
namit : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1443952&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1443952&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/metastore/scripts/upgrade/mysql/011-&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3649&quot; title=&quot;Hive List Bucketing - enhance DDL to specify list bucketing table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3649&quot;&gt;&lt;del&gt;HIVE-3649&lt;/del&gt;&lt;/a&gt;.mysql.sql&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13574505" author="mgrover" created="Fri, 8 Feb 2013 14:18:16 +0000"  >&lt;p&gt;Thanks Namit!&lt;/p&gt;</comment>
                            <comment id="13574918" author="hudson" created="Fri, 8 Feb 2013 22:53:09 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #112 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/112/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/112/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3999&quot; title=&quot;Mysql metastore upgrade script will end up with different schema than the full schema load&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3999&quot;&gt;&lt;del&gt;HIVE-3999&lt;/del&gt;&lt;/a&gt; Mysql metastore upgrade script will end up with different schema than&lt;br/&gt;
the full schema load (Jarek and Mark via namit) (Revision 1443952)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
namit : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1443952&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1443952&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/metastore/scripts/upgrade/mysql/011-&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3649&quot; title=&quot;Hive List Bucketing - enhance DDL to specify list bucketing table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3649&quot;&gt;&lt;del&gt;HIVE-3649&lt;/del&gt;&lt;/a&gt;.mysql.sql&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13574956" author="hudson" created="Fri, 8 Feb 2013 23:48:33 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #1961 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/1961/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/1961/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3999&quot; title=&quot;Mysql metastore upgrade script will end up with different schema than the full schema load&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3999&quot;&gt;&lt;del&gt;HIVE-3999&lt;/del&gt;&lt;/a&gt; Mysql metastore upgrade script will end up with different schema than&lt;br/&gt;
the full schema load (Jarek and Mark via namit) (Revision 1443952)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
namit : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1443952&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1443952&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/metastore/scripts/upgrade/mysql/011-&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3649&quot; title=&quot;Hive List Bucketing - enhance DDL to specify list bucketing table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3649&quot;&gt;&lt;del&gt;HIVE-3649&lt;/del&gt;&lt;/a&gt;.mysql.sql&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13580452" author="caofangkun" created="Mon, 18 Feb 2013 06:29:07 +0000"  >&lt;p&gt;We&apos;d better set a default value for column IS_STOREDASSUBDIRECTORIES:&lt;/p&gt;

&lt;p&gt;ALTER TABLE `SDS` ADD  `IS_STOREDASSUBDIRECTORIES` BIT(1) NOT NULL;&lt;br/&gt;
ALTER TABLE `SDS` ALTER  `IS_STOREDASSUBDIRECTORIES` SET DEFAULT 0;&lt;/p&gt;

&lt;p&gt;or Query May Throw :&lt;br/&gt;
Failed with exception javax.jdo.JDODataStoreException: Insert of object &quot;org.apache.hadoop.hive.metastore.model.MStorageDescriptor@c3c44&quot; using statement &quot;INSERT INTO `SDS` (`SD_ID`,`OUTPUT_FORMAT`,`CD_ID`,`NUM_BUCKETS`,`INPUT_FORMAT`,`SERDE_ID`,`IS_COMPRESSED`,`LOCATION`) VALUES (?,?,?,?,?,?,?,?)&quot; failed : Field &apos;IS_STOREDASSUBDIRECTORIES&apos; doesn&apos;t have a default value&lt;br/&gt;
NestedThrowables:&lt;br/&gt;
java.sql.SQLException: Field &apos;IS_STOREDASSUBDIRECTORIES&apos; doesn&apos;t have a default value&lt;/p&gt;</comment>
                            <comment id="13580457" author="jarcec" created="Mon, 18 Feb 2013 06:38:50 +0000"  >&lt;p&gt;Hi sir,&lt;br/&gt;
setting the default value was one of the options that I&apos;ve explored when working on this JIRA. However I&apos;ve decided not to use it and rather use three step column addition (please checkout the patch). One of the reasons behind this decision is that with no explicit default value, running old hive against new metastore will fail. I believe that this is much safer as otherwise Hive would continue to operate on updated schema repository and might eventually corrupt the data.&lt;/p&gt;

&lt;p&gt;Jarcec&lt;/p&gt;</comment>
                            <comment id="13580469" author="caofangkun" created="Mon, 18 Feb 2013 07:27:21 +0000"  >&lt;p&gt;Hi Jarek Jarcec Cecho,&lt;br/&gt;
I agree with you now. Your solution is the most suitable way.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12631192">HIVE-3995</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12631336">HIVE-3998</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12631192">HIVE-3995</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12632521">HIVE-4024</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12568466" name="mysql_upgrade_issue.patch" size="832" author="jarcec" created="Thu, 7 Feb 2013 21:25:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>311836</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 40 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1htcn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>312182</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>