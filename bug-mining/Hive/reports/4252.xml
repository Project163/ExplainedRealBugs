<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:41:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-12466] SparkCounter not initialized error</title>
                <link>https://issues.apache.org/jira/browse/HIVE-12466</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;During a query, lots of the following error found in executor&apos;s log:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;03:47:28.759 [Executor task launch worker-0] ERROR org.apache.hive.spark.counter.SparkCounters - counter[HIVE, RECORDS_OUT_0] has not initialized before.
03:47:28.762 [Executor task launch worker-1] ERROR org.apache.hive.spark.counter.SparkCounters - counter[HIVE, RECORDS_OUT_0] has not initialized before.
03:47:30.707 [Executor task launch worker-1] ERROR org.apache.hive.spark.counter.SparkCounters - counter[HIVE, RECORDS_OUT_1_default.tmp_tmp] has not initialized before.
03:47:33.385 [Executor task launch worker-1] ERROR org.apache.hive.spark.counter.SparkCounters - counter[HIVE, RECORDS_OUT_1_default.test_table] has not initialized before.
03:47:33.388 [Executor task launch worker-0] ERROR org.apache.hive.spark.counter.SparkCounters - counter[HIVE, RECORDS_OUT_1_default.test_table] has not initialized before.
03:47:33.495 [Executor task launch worker-0] ERROR org.apache.hive.spark.counter.SparkCounters - counter[HIVE, RECORDS_OUT_1_default.test_table] has not initialized before.
03:47:35.141 [Executor task launch worker-1] ERROR org.apache.hive.spark.counter.SparkCounters - counter[HIVE, RECORDS_OUT_1_default.test_table] has not initialized before.

...........
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12914449">HIVE-12466</key>
            <summary>SparkCounter not initialized error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lirui">Rui Li</assignee>
                                    <reporter username="lirui">Rui Li</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Nov 2015 12:29:55 +0000</created>
                <updated>Tue, 21 Jun 2016 15:53:10 +0000</updated>
                            <resolved>Wed, 25 Nov 2015 03:04:46 +0000</resolved>
                                                    <fixVersion>2.1.0</fixVersion>
                                    <component>Spark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15015100" author="lirui" created="Fri, 20 Nov 2015 03:04:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt; - Seems this JIRA gets assigned to you automatically &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15015213" author="xuefuz" created="Fri, 20 Nov 2015 04:44:57 +0000"  >&lt;p&gt;No problem, I was using it for testing the build, which we are having problems with. Yes, this seems to be a problem that also needs to be fixed.&lt;/p&gt;</comment>
                            <comment id="15021570" author="xuefuz" created="Mon, 23 Nov 2015 06:12:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chengxiang+li&quot; class=&quot;user-hover&quot; rel=&quot;chengxiang li&quot;&gt;chengxiang li&lt;/a&gt;, any idea why this is happening? Could you quickly check if there is any easy fix? Thanks!&lt;/p&gt;</comment>
                            <comment id="15021611" author="chengxiang li" created="Mon, 23 Nov 2015 06:47:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt;, due to the limitation of Spark accumulator, the `SparkCounter` has to register the counter name before the job execution. The error message shows that specified counter name is not registered before. In default, all the default spark counters are collected with `SparkTask::getCounterPrefixes()`, `RECORDS_OUT_0`, `RECORDS_OUT_1_default.tmp_tmp` and `RECORDS_OUT_1_default.test_table` are not included, seems the counter logic changes in `ReduceSinkOperator` and &apos;FileSinkOperator&apos;, we need to update the logic of `SparkTask::getOperatorCounters`. &lt;/p&gt;</comment>
                            <comment id="15023547" author="nemon" created="Tue, 24 Nov 2015 01:25:47 +0000"  >&lt;p&gt;Hive support multiple insert&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; from (select * from dec union all select * from dec2) s
insert overwrite table dec3 select s.name, sum(s.value) group by s.name
insert overwrite table dec4 select s.name, s.value order by s.value;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In order to distinguish records out for different table,Hive use  RECORDS_OUT + suffix for counters key in FileSinkOperator.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;statsMap.put(Counter.RECORDS_OUT + &quot;_&quot; + suffix, row_count);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15023551" author="lirui" created="Tue, 24 Nov 2015 01:30:17 +0000"  >&lt;p&gt;Yeah they&apos;re appending suffix to the counter name now. Maybe we can initialize the counter in the same way. I think the suffix is available in the operator conf.&lt;/p&gt;</comment>
                            <comment id="15023574" author="chengxiang li" created="Tue, 24 Nov 2015 01:55:09 +0000"  >&lt;p&gt;Yes, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lirui&quot; class=&quot;user-hover&quot; rel=&quot;lirui&quot;&gt;lirui&lt;/a&gt;, the suffix is available in the operator conf. As recently i didn&apos;t work on HoS, it would take some time to prepare a test environment, do you mind to give a quick fix on this issue? i can do the review work.&lt;/p&gt;</comment>
                            <comment id="15023582" author="lirui" created="Tue, 24 Nov 2015 02:00:45 +0000"  >&lt;p&gt;Sure. Assigned this to me.&lt;/p&gt;</comment>
                            <comment id="15024042" author="chengxiang li" created="Tue, 24 Nov 2015 09:04:13 +0000"  >&lt;p&gt;LGTM, wait for the testing.&lt;/p&gt;</comment>
                            <comment id="15024062" author="hiveqa" created="Tue, 24 Nov 2015 09:13:53 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12773993/HIVE-12466.1-spark.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12773993/HIVE-12466.1-spark.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 9 failed/errored test(s), 9788 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestHWISessionManager - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_auto_join4
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_cbo_rp_annotate_stats_groupby
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_constantPropagateForSubQuery
org.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver_encryption_insert_partition_dynamic
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_schemeAuthority
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_schemeAuthority2
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hive.jdbc.TestSSL.testSSLVersion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-SPARK-Build/1011/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-SPARK-Build/1011/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-SPARK-Build/1011/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-SPARK-Build/1011/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-SPARK-Build-1011/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-SPARK-Build-1011/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 9 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12773993 - PreCommit-HIVE-SPARK-Build&lt;/p&gt;</comment>
                            <comment id="15025212" author="xuefuz" created="Tue, 24 Nov 2015 19:50:53 +0000"  >&lt;p&gt;Thanks to Rui/Chengxiang for working on this. I happened to see that counter-based stats gathering is completely removed by &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-12411&quot; title=&quot;Remove counter based stats collection mechanism&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-12411&quot;&gt;&lt;del&gt;HIVE-12411&lt;/del&gt;&lt;/a&gt;. I&apos;d like to knows its implications. Does it mean that we don&apos;t even need SparkCounter at all? Are there any impacts on Spark regarding stats collection with the removal. Thanks.&lt;/p&gt;</comment>
                            <comment id="15025999" author="chengxiang li" created="Wed, 25 Nov 2015 02:09:35 +0000"  >&lt;p&gt;SparkCounters is only used for stats collection now, so yes, i think we may not need SparkCounters anymore if counter-based stats collection is removed. As far as i know, there is no other Hive features which depends on SparkCounters.&lt;/p&gt;</comment>
                            <comment id="15026017" author="lirui" created="Wed, 25 Nov 2015 02:17:56 +0000"  >&lt;p&gt;If spark counter is removed, does HoS support other methods to collect stats, like fs-based?&lt;/p&gt;</comment>
                            <comment id="15026034" author="chengxiang li" created="Wed, 25 Nov 2015 02:35:53 +0000"  >&lt;p&gt;Yes, it does, at least at the time i implemented the counter-based stats collection for Spark, it does not relate to any part of our work on HoS, so i assume it should work just as well now.&lt;/p&gt;</comment>
                            <comment id="15026042" author="xuefuz" created="Wed, 25 Nov 2015 02:42:38 +0000"  >&lt;p&gt;Thanks, guys. Let&apos;s get this in and uses a separate JIRA to do the cleanup.&lt;/p&gt;</comment>
                            <comment id="15026081" author="chengxiang li" created="Wed, 25 Nov 2015 03:04:24 +0000"  >&lt;p&gt;Committed to spark branch, thanks Rui for this contribution.&lt;/p&gt;</comment>
                            <comment id="15026089" author="chengxiang li" created="Wed, 25 Nov 2015 03:10:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-12515&quot; title=&quot;Clean the SparkCounters related code after remove counter based stats collection[Spark Branch]&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-12515&quot;&gt;&lt;del&gt;HIVE-12515&lt;/del&gt;&lt;/a&gt; is created for the following cleanup work.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12913607">HIVE-12432</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12773993" name="HIVE-12466.1-spark.patch" size="4225" author="lirui" created="Tue, 24 Nov 2015 05:56:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2omxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>