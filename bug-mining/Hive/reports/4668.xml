<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:45:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-13590] Kerberized HS2 with LDAP auth enabled fails in multi-domain LDAP case</title>
                <link>https://issues.apache.org/jira/browse/HIVE-13590</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;In a kerberized HS2 with LDAP authentication enabled, LDAP user usually logs in using username in form of username@domain in LDAP multi-domain case. But it fails if the domain was not in the Hadoop auth_to_local mapping rule, the error is as following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Caused by: org.apache.hadoop.security.authentication.util.KerberosName$NoMatchingRule: No rules applied to ctang@mydomain.com
at org.apache.hadoop.security.authentication.util.KerberosName.getShortName(KerberosName.java:389)
at org.apache.hadoop.security.User.&amp;lt;init&amp;gt;(User.java:48)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12961512">HIVE-13590</key>
            <summary>Kerberized HS2 with LDAP auth enabled fails in multi-domain LDAP case</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ctang">Chaoyu Tang</assignee>
                                    <reporter username="ctang">Chaoyu Tang</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Apr 2016 03:03:05 +0000</created>
                <updated>Thu, 8 Dec 2016 14:39:21 +0000</updated>
                            <resolved>Tue, 21 Jun 2016 00:44:21 +0000</resolved>
                                                    <fixVersion>2.1.1</fixVersion>
                    <fixVersion>2.2.0</fixVersion>
                                    <component>Authentication</component>
                    <component>Security</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="15332909" author="ctang.ma" created="Thu, 16 Jun 2016 02:19:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=szehon&quot; class=&quot;user-hover&quot; rel=&quot;szehon&quot;&gt;szehon&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt; could you help review the patch? Thanks.&lt;/p&gt;</comment>
                            <comment id="15332931" author="ctang.ma" created="Thu, 16 Jun 2016 02:33:34 +0000"  >&lt;p&gt;The patch has been uploaded to &lt;a href=&quot;https://reviews.apache.org/r/48771/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/48771/&lt;/a&gt; for review.&lt;/p&gt;</comment>
                            <comment id="15333990" author="ctang.ma" created="Thu, 16 Jun 2016 15:25:49 +0000"  >&lt;p&gt;Reattach patch to kick off the prebuild test&lt;/p&gt;</comment>
                            <comment id="15334695" author="szehon" created="Thu, 16 Jun 2016 21:10:06 +0000"  >&lt;p&gt;Change looks good to me, but are the changes in HadoopThriftAuthBridge needed?  For example  &quot;HadoopThriftAuthBridge::getAuthenticationMethod()&quot; doesn&apos;t seem to be used as far as I can tell..&lt;/p&gt;</comment>
                            <comment id="15334717" author="ctang.ma" created="Thu, 16 Jun 2016 21:24:41 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=szehon&quot; class=&quot;user-hover&quot; rel=&quot;szehon&quot;&gt;szehon&lt;/a&gt; for review. It is a good catch, I initially tried to use the threadLocal authenticationMethod and later found it was not suitable, but forgot to remove the get method.&lt;br/&gt;
Upload a new patch removing this unnecessary method.&lt;/p&gt;</comment>
                            <comment id="15334724" author="szehon" created="Thu, 16 Jun 2016 21:29:20 +0000"  >&lt;p&gt;+1 on my side.&lt;/p&gt;</comment>
                            <comment id="15336039" author="ctang.ma" created="Fri, 17 Jun 2016 13:33:09 +0000"  >&lt;p&gt;The precommit test failed due to test infrastructure issue. Reattach patch to kick off another run&lt;/p&gt;</comment>
                            <comment id="15338015" author="hiveqa" created="Sat, 18 Jun 2016 16:42:37 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12811366/HIVE-13590.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12811366/HIVE-13590.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 11 failed/errored test(s), 10222 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestMiniTezCliDriver-update_all_partitioned.q-schema_evol_stats.q-vector_decimal_expressions.q-and-12-more - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_acid_globallimit
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_constantPropagateForSubQuery
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_13
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_repair
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_list_bucket
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_multiinsert
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_index_bitmap3
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_table_nonprintable
org.apache.hadoop.hive.ql.metadata.TestHiveMetaStoreChecker.testPartitionsCheck
org.apache.hadoop.hive.ql.metadata.TestHiveMetaStoreChecker.testTableCheck
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/166/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/166/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/166/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/166/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-166/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-166/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 11 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12811366 - PreCommit-HIVE-MASTER-Build&lt;/p&gt;</comment>
                            <comment id="15338308" author="ctang.ma" created="Sun, 19 Jun 2016 01:06:52 +0000"  >&lt;p&gt;The failed tests are aged and not related to this patch.&lt;/p&gt;</comment>
                            <comment id="15340353" author="spena" created="Mon, 20 Jun 2016 20:38:53 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ctang.ma&quot; class=&quot;user-hover&quot; rel=&quot;ctang.ma&quot;&gt;ctang.ma&lt;/a&gt;&lt;br/&gt;
+1&lt;/p&gt;</comment>
                            <comment id="15340792" author="ctang.ma" created="Tue, 21 Jun 2016 00:44:21 +0000"  >&lt;p&gt;Patch has been committed to master (for 2.2.0) and branch-2.1 (for 2.1.1). Thank &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=szehon&quot; class=&quot;user-hover&quot; rel=&quot;szehon&quot;&gt;szehon&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt; for review.&lt;/p&gt;</comment>
                            <comment id="15665041" author="tagar" created="Mon, 14 Nov 2016 21:14:19 +0000"  >&lt;p&gt;thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ctang.ma&quot; class=&quot;user-hover&quot; rel=&quot;ctang.ma&quot;&gt;ctang.ma&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Looking at your patch &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12811366/HIVE-13590.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12811366/HIVE-13590.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;...
+        // KerberosName.getShorName can only be used for kerberos user, but not for the user
+        // logged in via other authentications such as LDAP
+        KerberosNameShim fullKerberosName = ShimLoader.getHadoopShims().getKerberosNameShim(userName);
+        ret = fullKerberosName.getShortName();
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is there any specific reason getShortName() can&apos;t be used for LDAP principals too?&lt;br/&gt;
Looking around for potential solutions for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-15174&quot; title=&quot;Respect auth_to_local rules from hdfs configs (core-site.xml) for LDAP authentication too&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-15174&quot;&gt;HIVE-15174&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="15665704" author="ctang.ma" created="Tue, 15 Nov 2016 01:46:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Tagar&quot; class=&quot;user-hover&quot; rel=&quot;Tagar&quot;&gt;Tagar&lt;/a&gt; as I recall, we did not use the KerberosName.getShortName for LDAP users for two reasons:&lt;br/&gt;
1. security: add the rules to LDAP users in Hadoop auth_to_local might introduce the security holes to other components accessing Hadoop only via Kerberos.&lt;br/&gt;
2. backward compatibility: for HS2 only using LDAP authentication. The KerberosName/auth_to_local rules were previously not required.&lt;/p&gt;

&lt;p&gt;HTH, thanks&lt;/p&gt;</comment>
                            <comment id="15665734" author="tagar" created="Tue, 15 Nov 2016 02:02:17 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ctang.ma&quot; class=&quot;user-hover&quot; rel=&quot;ctang.ma&quot;&gt;ctang.ma&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;On your point #1. &lt;br/&gt;
If this mapping logic only works when hive.server2.authentication.ldap.url and/or hive.server2.authentication are set.&lt;br/&gt;
Or perhaps, we there should be a new knob to turn on auth_to_local for LDAP authentication.&lt;br/&gt;
If above would be true, would it address your concerns?&lt;/p&gt;

&lt;p&gt;Thanks again.&lt;/p&gt;</comment>
                            <comment id="15665832" author="ctang.ma" created="Tue, 15 Nov 2016 02:49:26 +0000"  >&lt;p&gt;The concern we had is the new rules added in Hadoop auth_to_local for HS2 LDAP users might bring in a potential security hole for the kerberized cluster system.&lt;/p&gt;</comment>
                            <comment id="15665833" author="ctang.ma" created="Tue, 15 Nov 2016 02:49:32 +0000"  >&lt;p&gt;The concern we had is the new rules added in Hadoop auth_to_local for HS2 LDAP users might bring in a potential security hole for the kerberized cluster system.&lt;/p&gt;</comment>
                            <comment id="15674832" author="tagar" created="Thu, 17 Nov 2016 21:12:44 +0000"  >&lt;p&gt;Sorry, I am not following. auth_to_local is already being applied to Kerberos principals. Why applying auth_to_local to LDAP principals is different than mapping Kerberos principals? Why it introduces security risk? Please elaborate. Thank you.&lt;/p&gt;</comment>
                            <comment id="15675638" author="ctang.ma" created="Fri, 18 Nov 2016 03:43:46 +0000"  >&lt;p&gt;In a user case where LDAP and Kerberos are two separate authentication systems within a cooperation, you might not want to add LDAP mapping rules to Hadoop auth_to_local because these rules could be also applied to Kerberos principals which is considered as a security hole to kerberized cluster, is not it?&lt;/p&gt;</comment>
                            <comment id="15677292" author="tagar" created="Fri, 18 Nov 2016 18:01:33 +0000"  >&lt;p&gt;I got it now. Thanks for explaining. The key piece is &quot;where LDAP and Kerberos are two separate authentication systems&quot;. In our case they are the same (the same Active Directory is used for both Kerberos and LDAP authentication). Although it&apos;s totally possible when authentication backends behind Kerberos and LDAP are separate. Then best solutions could be to either:&lt;br/&gt;
1) Make a switch if auth_to_local is used for LDAP or Kerberos, or both;&lt;br/&gt;
2) Make two separate mappings - one for Kerberoers (that could stay to be auth_to_local), and introduce a new mapping auth_ldap_to_local (just to give you an idea).&lt;br/&gt;
Thank you.&lt;/p&gt;</comment>
                            <comment id="15678415" author="ctang.ma" created="Sat, 19 Nov 2016 02:30:29 +0000"  >&lt;p&gt;Thanks for the suggested solution. The auth_to_local rule mapping is part of hadoop implementation.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13019708">HIVE-15174</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12935943">HIVE-12981</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12955031">HIVE-13401</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12811366" name="HIVE-13590.1.patch" size="11747" author="ctang" created="Fri, 17 Jun 2016 13:33:09 +0000"/>
                            <attachment id="12811216" name="HIVE-13590.1.patch" size="11747" author="ctang" created="Thu, 16 Jun 2016 21:24:41 +0000"/>
                            <attachment id="12811132" name="HIVE-13590.patch" size="12048" author="ctang" created="Thu, 16 Jun 2016 15:25:49 +0000"/>
                            <attachment id="12810964" name="HIVE-13590.patch" size="12048" author="ctang" created="Thu, 16 Jun 2016 02:19:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2wkg7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>