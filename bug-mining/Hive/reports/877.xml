<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:01:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-3168] LazyBinaryObjectInspector.getPrimitiveJavaObject copies beyond length of underlying BytesWritable</title>
                <link>https://issues.apache.org/jira/browse/HIVE-3168</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;LazyBinaryObjectInspector.getPrimitiveJavaObject copies the full capacity of the LazyBinary&apos;s underlying BytesWritable object, which can be greater than the size of the actual contents. &lt;/p&gt;

&lt;p&gt;This leads to additional characters at the end of the ByteArrayRef returned. When the LazyBinary object gets re-used, there can be remnants of the later portion of previous entry. &lt;br/&gt;
This was not seen while reading through hive queries, which I think is because a copy elsewhere seems to create LazyBinary with length == capacity. (probably LazyBinary copy constructor). This was seen when MR or pig used Hcatalog to read the data.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12595376">HIVE-3168</key>
            <summary>LazyBinaryObjectInspector.getPrimitiveJavaObject copies beyond length of underlying BytesWritable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thejas">Thejas Nair</assignee>
                                    <reporter username="thejas">Thejas Nair</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 Jun 2012 02:53:16 +0000</created>
                <updated>Thu, 10 Jan 2013 19:53:37 +0000</updated>
                            <resolved>Thu, 12 Jul 2012 16:53:41 +0000</resolved>
                                    <version>0.9.0</version>
                                    <fixVersion>0.10.0</fixVersion>
                                    <component>Serializers/Deserializers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13399000" author="thejas" created="Thu, 21 Jun 2012 23:35:03 +0000"  >&lt;p&gt;review board link - &lt;a href=&quot;https://reviews.facebook.net/D3777&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D3777&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13399815" author="cwsteinbach" created="Sat, 23 Jun 2012 02:52:07 +0000"  >&lt;p&gt;@Thejas: I left some comments on phabricator. Thanks.&lt;/p&gt;</comment>
                            <comment id="13401991" author="thejas" created="Wed, 27 Jun 2012 06:25:55 +0000"  >&lt;p&gt;Updated patch on phabricator. Fixes JavaBinaryObjectInspector and WritableBinaryObjectInspector as well. Also, tries to avoid copy of byte[] in BytesWritable .&lt;/p&gt;</comment>
                            <comment id="13402918" author="cwsteinbach" created="Thu, 28 Jun 2012 08:01:33 +0000"  >&lt;p&gt;@Thejas: Is the patch ready for review?&lt;/p&gt;</comment>
                            <comment id="13403227" author="thejas" created="Thu, 28 Jun 2012 17:06:22 +0000"  >&lt;p&gt;Yes, the updated patch on phabricator is ready for review. &lt;/p&gt;</comment>
                            <comment id="13404654" author="thejas" created="Sat, 30 Jun 2012 23:52:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3168&quot; title=&quot;LazyBinaryObjectInspector.getPrimitiveJavaObject copies beyond length of underlying BytesWritable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3168&quot;&gt;&lt;del&gt;HIVE-3168&lt;/del&gt;&lt;/a&gt;.2.patch - attaching patch that has already been published in phabricator.&lt;/p&gt;</comment>
                            <comment id="13405834" author="neha_tomar" created="Tue, 3 Jul 2012 12:27:43 +0000"  >&lt;p&gt;I downloaded hive-0.9.0 and applied the second patch &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3168&quot; title=&quot;LazyBinaryObjectInspector.getPrimitiveJavaObject copies beyond length of underlying BytesWritable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3168&quot;&gt;&lt;del&gt;HIVE-3168&lt;/del&gt;&lt;/a&gt;.2.patch&quot; using the command &quot;patch -p0 &amp;lt; /home/neha/hive_patches/&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3168&quot; title=&quot;LazyBinaryObjectInspector.getPrimitiveJavaObject copies beyond length of underlying BytesWritable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3168&quot;&gt;&lt;del&gt;HIVE-3168&lt;/del&gt;&lt;/a&gt;.2.patch&quot;. &lt;br/&gt;
After this, if I try to build the hive, it fails. Can you please let me know if I am doing anything incorrect. Thank you.&lt;/p&gt;</comment>
                            <comment id="13405922" author="neha_tomar" created="Tue, 3 Jul 2012 13:37:28 +0000"  >&lt;p&gt;One more question here. Do we need to apply both the patches attached?&lt;/p&gt;</comment>
                            <comment id="13406012" author="thejas" created="Tue, 3 Jul 2012 20:32:19 +0000"  >&lt;p&gt;The 2nd patch replaces the first, so you need to apply on the 2nd one. I tried applying it to a fresh checkout of hive 0.9 branch and I was able to build it fine. Please post the build error if you think it is related to the patch.&lt;/p&gt;</comment>
                            <comment id="13406258" author="neha_tomar" created="Wed, 4 Jul 2012 03:53:15 +0000"  >&lt;p&gt;Thanks Thejas. I applied only the second patch and the build was fine. However, I am still seeing the same incorrect values coming back. Could you please let me know if you have verified and this works fine for you.&lt;br/&gt;
e.g. I have following data in table.&lt;br/&gt;
a&lt;br/&gt;
ab&lt;br/&gt;
abc&lt;br/&gt;
abcd&lt;br/&gt;
abcde&lt;br/&gt;
z&lt;br/&gt;
And the values (this is in hexadecimal) coming back from HCatalog is :&lt;br/&gt;
61&lt;br/&gt;
616200&lt;br/&gt;
616263&lt;br/&gt;
616263640000&lt;br/&gt;
616263646500&lt;br/&gt;
7A6263646500&lt;/p&gt;</comment>
                            <comment id="13407286" author="neha_tomar" created="Thu, 5 Jul 2012 17:16:08 +0000"  >&lt;p&gt;Please let me know if anyone tried and these patches are working fine. I need to look into my setup if this works fine for you. Would be very helpful if I get any clue here. Thanks a lot.&lt;/p&gt;</comment>
                            <comment id="13407374" author="thejas" created="Thu, 5 Jul 2012 18:39:28 +0000"  >&lt;p&gt;Yes, I tried the patch and it worked for me with hcatalog. I tested it using MR job that uses hcat to read data. &lt;br/&gt;
You might want to make sure that the you have deployed the updated hive jars and that hcatalog is using those.&lt;br/&gt;
hive build has some issues now, and I had to do &quot;rm &lt;del&gt;rf ~/.ivy2/local/org.apache.hive/hive&lt;/del&gt;* ; rm &lt;del&gt;rf ~/.ivy2/cache/org.apache.hive/hive&lt;/del&gt;*&quot; to clear the old jars. I am not sure if this affects only unit tests, or if it affects the package creation as well. But you might want to give that a try. &lt;/p&gt;

&lt;p&gt;Hive(ie hcat as well) expects the binary column be base64 encoded (at least for text format). The values you pasted don&apos;t have the padding with &apos;==&apos;, and my  understanding is that base64 is expected to be padded to 4 bytes. Can you try with valid base64 encoding of printable ascii strings ?&lt;/p&gt;</comment>
                            <comment id="13407375" author="thejas" created="Thu, 5 Jul 2012 18:40:20 +0000"  >&lt;p&gt;The command for clearing ivy cache for hive is &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;rm rf ~/.ivy2/local/org.apache.hive/hive* ; rm rf ~/.ivy2/cache/org.apache.hive/hive*&quot;&lt;/span&gt; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13407404" author="neha_tomar" created="Thu, 5 Jul 2012 19:11:06 +0000"  >&lt;p&gt;Thanks a lot, Thejas. Will try this. &lt;br/&gt;
The data that I have pasted above is the hive output. And, the data actually stored is in base64 encoding only.&lt;/p&gt;</comment>
                            <comment id="13407893" author="neha_tomar" created="Fri, 6 Jul 2012 11:10:22 +0000"  >&lt;p&gt;Tried the given suggestion. Replaced everything, but still same issue. Not sure where I am making the mistake. I am using hcatalog released version 0.4.0. Can you please confirm if there is no change in this hcatalog code.&lt;/p&gt;</comment>
                            <comment id="13408135" author="thejas" created="Fri, 6 Jul 2012 16:31:34 +0000"  >&lt;p&gt;Neha,&lt;br/&gt;
Try &apos;ant clean&apos; on the hive dir before building it. &lt;br/&gt;
To verify that the patched hive code is getting used, try adding a debug message in LazyBinaryObjectInspector around line 43 (after applying patch) (note the debug message would come out of map task). Or change the data setting the first byte, and see if changes your result -&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.arraycopy(bWritable.getBytes(), 0, data, 0, bWritable.getLength());
    ba.setData(data);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.arraycopy(bWritable.getBytes(), 0, data, 0, bWritable.getLength());
    data[0]=&lt;span class=&quot;code-quote&quot;&gt;&apos;Z&apos;&lt;/span&gt;;
    ba.setData(data);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I am not sure if I tested with hcat 0.4 branch or trunk. But I don&apos;t think there has been any change that should affect this behavior, it should work with hcat 0.4 release as well.&lt;/p&gt;</comment>
                            <comment id="13409264" author="neha_tomar" created="Mon, 9 Jul 2012 08:21:36 +0000"  >&lt;p&gt;Thanks a lot, Thejas. It is working fine now.&lt;/p&gt;</comment>
                            <comment id="13410576" author="thejas" created="Tue, 10 Jul 2012 17:26:28 +0000"  >&lt;p&gt;Can any committer please review the 2nd patch ? (also in phabricator link)&lt;/p&gt;</comment>
                            <comment id="13411925" author="thejas" created="Wed, 11 Jul 2012 20:12:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3168&quot; title=&quot;LazyBinaryObjectInspector.getPrimitiveJavaObject copies beyond length of underlying BytesWritable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3168&quot;&gt;&lt;del&gt;HIVE-3168&lt;/del&gt;&lt;/a&gt;.3.patch - updated patch based on Ashutosh&apos;s comments in phabricator. Also updated patch on phabricator.&lt;/p&gt;</comment>
                            <comment id="13411927" author="thejas" created="Wed, 11 Jul 2012 20:13:11 +0000"  >&lt;p&gt;New patch is ready for reivew.&lt;/p&gt;</comment>
                            <comment id="13412930" author="ashutoshc" created="Thu, 12 Jul 2012 16:53:41 +0000"  >&lt;p&gt;Committed. Thanks, Thejas!&lt;/p&gt;</comment>
                            <comment id="13413447" author="hudson" created="Fri, 13 Jul 2012 02:52:48 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #1539 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/1539/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/1539/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3168&quot; title=&quot;LazyBinaryObjectInspector.getPrimitiveJavaObject copies beyond length of underlying BytesWritable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3168&quot;&gt;&lt;del&gt;HIVE-3168&lt;/del&gt;&lt;/a&gt;: LazyBinaryObjectInspector.getPrimitiveJavaObject copies beyond length of underlying BytesWritable (Thejas Nair via Ashutosh Chauhan) (Revision 1360812)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
hashutosh : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1360812&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1360812&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/lazy/LazyUtils.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/lazy/objectinspector/primitive/LazyBinaryObjectInspector.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/primitive/JavaBinaryObjectInspector.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/primitive/WritableBinaryObjectInspector.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/serde/src/test/org/apache/hadoop/hive/serde2/lazybinary/TestLazyBinarySerDe.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13413923" author="thejas" created="Fri, 13 Jul 2012 18:10:31 +0000"  >&lt;p&gt;Ashutosh,&lt;br/&gt;
Can you please apply this fix to 0.9 branch as well ?&lt;/p&gt;</comment>
                            <comment id="13547967" author="hudson" created="Wed, 9 Jan 2013 10:23:47 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #54 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3168&quot; title=&quot;LazyBinaryObjectInspector.getPrimitiveJavaObject copies beyond length of underlying BytesWritable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3168&quot;&gt;&lt;del&gt;HIVE-3168&lt;/del&gt;&lt;/a&gt;: LazyBinaryObjectInspector.getPrimitiveJavaObject copies beyond length of underlying BytesWritable (Thejas Nair via Ashutosh Chauhan) (Revision 1360812)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
hashutosh : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1360812&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1360812&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/lazy/LazyUtils.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/lazy/objectinspector/primitive/LazyBinaryObjectInspector.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/primitive/JavaBinaryObjectInspector.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/primitive/WritableBinaryObjectInspector.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/serde/src/test/org/apache/hadoop/hive/serde2/lazybinary/TestLazyBinarySerDe.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13550161" author="ashutoshc" created="Thu, 10 Jan 2013 19:53:37 +0000"  >&lt;p&gt;This issue is fixed and released as part of 0.10.0 release. If you find an issue which seems to be related to this one, please create a new jira and link this one with new jira.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12560282">HCATALOG-430</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12532948" name="HIVE-3168.1.patch" size="4929" author="thejas" created="Thu, 21 Jun 2012 21:40:43 +0000"/>
                            <attachment id="12534136" name="HIVE-3168.2.patch" size="10391" author="thejas" created="Sat, 30 Jun 2012 23:52:18 +0000"/>
                            <attachment id="12536104" name="HIVE-3168.3.patch" size="10009" author="thejas" created="Wed, 11 Jul 2012 20:12:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>248755</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 45 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i09yaf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>55996</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>