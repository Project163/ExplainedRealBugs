<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:06:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-4440] SMB Operator spills to disk like it&apos;s 1999</title>
                <link>https://issues.apache.org/jira/browse/HIVE-4440</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;I was recently looking into some performance issue with a query that used SMB join and was running really slow. Turns out that the SMB join by default caches only 100 values per key before spilling to disk. That seems overly conservative to me. Changing the parameter resulted in a ~5x speedup - quite significant.&lt;/p&gt;

&lt;p&gt;The parameter is: hive.mapjoin.bucket.cache.size&lt;/p&gt;

&lt;p&gt;Which right now is only used the SMB Operator as far as I can tell.&lt;/p&gt;

&lt;p&gt;The parameter was introduced originally (3 yrs ago) for the map join operator (looks like pre-SMB) and set to 100 to avoid OOM. That seems to have been in a different context though where you had to avoid running out of memory with the cached hash table in the same process, I think.&lt;/p&gt;

&lt;p&gt;Two things I&apos;d like to propose:&lt;/p&gt;

&lt;p&gt;a) Rename it to what it does: hive.smbjoin.cache.rows&lt;br/&gt;
b) Set it to something less restrictive: 10000&lt;/p&gt;

&lt;p&gt;If you string together a 5 table smb join with a map join and a map-side group by aggregation you might still run out of memory, but the renamed parameter should be easier to find and reduce. For most queries, I would think that 10000 is still a reasonable number to cache (On the reduce side we use 25000 for shuffle joins).&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12645124">HIVE-4440</key>
            <summary>SMB Operator spills to disk like it&apos;s 1999</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hagleitn">Gunther Hagleitner</assignee>
                                    <reporter username="hagleitn">Gunther Hagleitner</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Apr 2013 02:49:15 +0000</created>
                <updated>Mon, 19 May 2014 08:50:21 +0000</updated>
                            <resolved>Wed, 15 May 2013 21:11:59 +0000</resolved>
                                                    <fixVersion>0.12.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13645178" author="namit" created="Tue, 30 Apr 2013 02:54:00 +0000"  >&lt;p&gt;I really like the title of the jira.&lt;/p&gt;

&lt;p&gt;Changing the parameter name is backward incompatible.&lt;br/&gt;
Can you support both the current parameter and the proposed parameter for now ?&lt;br/&gt;
Document it clearly, and say that the current parameter hive.mapjoin.bucket.cache.size will not be supported&lt;br/&gt;
for this from 0.13 or something like that.&lt;/p&gt;</comment>
                            <comment id="13647395" author="hagleitn" created="Thu, 2 May 2013 09:24:35 +0000"  >&lt;p&gt;Thanks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Patch .2 honors the old parameter unless it&apos;s at the default in which case it uses the new one. I also put documentation around it. &lt;/p&gt;

&lt;p&gt;You bring up a good point, but are you sure it&apos;s necessary to support both in this case though? It&apos;s just slightly ugly in the code and requires us to move in again to remove later. My thinking is this: If you use the old parameter, it&apos;s probably because you needed to up it to get better performance - in this case the new default should most likely be ok for you. Do you think there&apos;s going to be cases where this falls flat?&lt;/p&gt;</comment>
                            <comment id="13657645" author="owen.omalley" created="Tue, 14 May 2013 23:04:12 +0000"  >&lt;p&gt;Patch.2 looks good. I agree with Namit that supporting the old config makes sense. Can you run tests on it. We might consider warning in Hive 0.13 and removing in Hive 0.14. &lt;b&gt;smile&lt;/b&gt;&lt;/p&gt;</comment>
                            <comment id="13658727" author="hagleitn" created="Wed, 15 May 2013 20:04:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=owen.omalley&quot; class=&quot;user-hover&quot; rel=&quot;owen.omalley&quot;&gt;owen.omalley&lt;/a&gt;: Ran all tests - no failures.&lt;/p&gt;</comment>
                            <comment id="13658827" author="owen.omalley" created="Wed, 15 May 2013 21:11:59 +0000"  >&lt;p&gt;I just committed this. Thanks, Gunther!&lt;/p&gt;</comment>
                            <comment id="13659362" author="hudson" created="Thu, 16 May 2013 08:41:25 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #2105 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/2105/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/2105/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4440&quot; title=&quot;SMB Operator spills to disk like it&amp;#39;s 1999&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4440&quot;&gt;&lt;del&gt;HIVE-4440&lt;/del&gt;&lt;/a&gt; SMB Operator spills to disk like it&apos;s 1999 (Gunther Hagleitner via&lt;br/&gt;
omalley) (Revision 1483084)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
omalley : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1483084&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1483084&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/conf/hive-default.xml.template&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/SMBMapJoinOperator.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13659934" author="hudson" created="Thu, 16 May 2013 20:23:56 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #199 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/199/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/199/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4440&quot; title=&quot;SMB Operator spills to disk like it&amp;#39;s 1999&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4440&quot;&gt;&lt;del&gt;HIVE-4440&lt;/del&gt;&lt;/a&gt; SMB Operator spills to disk like it&apos;s 1999 (Gunther Hagleitner via&lt;br/&gt;
omalley) (Revision 1483084)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
omalley : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1483084&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1483084&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/conf/hive-default.xml.template&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/SMBMapJoinOperator.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13795900" author="ashutoshc" created="Tue, 15 Oct 2013 23:29:29 +0000"  >&lt;p&gt;This issue has been fixed and released as part of 0.12 release. If you find further issues, please create a new jira and link it to this one.&lt;/p&gt;</comment>
                            <comment id="14001270" author="lefty@hortonworks.com" created="Mon, 19 May 2014 00:01:03 +0000"  >&lt;p&gt;Hive 0.13.0 did not remove &lt;b&gt;hive.mapjoin.bucket.cache.size&lt;/b&gt;.  Also, the comment that says it should be removed has a typo in the name of the new parameter &amp;#8211; it should be &lt;b&gt;hive.smbjoin.cache.rows&lt;/b&gt;, not hive.smbjoin.cache.row:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;+    // hive.mapjoin.bucket.cache.size has been replaced by hive.smbjoin.cache.row,&lt;br/&gt;
+    // need to remove by hive .13. Also, do not change default (see SMB operator)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Instead of creating a new jira for this, I&apos;ll add a comment on &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-6586&quot; title=&quot;Update parameters in HiveConf.java after commit HIVE-6037&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-6586&quot;&gt;&lt;del&gt;HIVE-6586&lt;/del&gt;&lt;/a&gt; (for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-6037&quot; title=&quot;Synchronize HiveConf with hive-default.xml.template and support show conf&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-6037&quot;&gt;&lt;del&gt;HIVE-6037&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="14001280" author="lefty@hortonworks.com" created="Mon, 19 May 2014 00:14:57 +0000"  >&lt;p&gt;Here&apos;s the comment I added to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-6586&quot; title=&quot;Update parameters in HiveConf.java after commit HIVE-6037&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-6586&quot;&gt;&lt;del&gt;HIVE-6586&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-6586?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;amp;focusedCommentId=14001274#comment-14001274&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;comment about hive.mapjoin.bucket.cache.size and hive.smbjoin.cache.rows &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14001506" author="lefty@hortonworks.com" created="Mon, 19 May 2014 08:50:21 +0000"  >&lt;p&gt;Documented &lt;b&gt;hive.smbjoin.cache.rows&lt;/b&gt; in the wiki, and revised &lt;b&gt;hive.mapjoin.bucket.cache.size&lt;/b&gt;:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.smbjoin.cache.rows&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;hive.smbjoin.cache.rows &lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.mapjoin.bucket.cache.size&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;hive.mapjoin.bucket.cache.size &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12645123">HIVE-4439</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12580923" name="HIVE-4440.1.patch" size="2085" author="hagleitn" created="Mon, 29 Apr 2013 02:52:58 +0000"/>
                            <attachment id="12581498" name="HIVE-4440.2.patch" size="2836" author="hagleitn" created="Thu, 2 May 2013 09:24:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>325486</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 27 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1k5jz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>325831</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>