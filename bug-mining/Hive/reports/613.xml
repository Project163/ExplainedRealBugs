<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:58:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-2117] insert overwrite ignoring partition location</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2117</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The following code works differently in 0.5.0 vs 0.7.0.&lt;/p&gt;

&lt;p&gt;In 0.5.0 the partition location is respected. &lt;/p&gt;

&lt;p&gt;However in 0.7.0 while the initial partition is create with the specified location &quot;&amp;lt;path&amp;gt;/parta&quot;, the &quot;insert overwrite ...&quot; results in the partition written to &quot;&amp;lt;path&amp;gt;/dt=a&quot; (note that &amp;lt;path&amp;gt; is the same in both cases).&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;create table foo_stg (bar INT, car INT); 
load data local inpath &lt;span class=&quot;code-quote&quot;&gt;&apos;data.txt&apos;&lt;/span&gt; into table foo_stg;
 
create table foo4 (bar INT, car INT) partitioned by (dt STRING) LOCATION &lt;span class=&quot;code-quote&quot;&gt;&apos;/user/hive/warehouse/foo4&apos;&lt;/span&gt;; 
alter table foo4 add partition (dt=&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;) location &lt;span class=&quot;code-quote&quot;&gt;&apos;/user/hive/warehouse/foo4/parta&apos;&lt;/span&gt;;
 
from foo_stg fs insert overwrite table foo4 partition (dt=&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;) select *;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From what I can tell &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1707&quot; title=&quot;bug when different partitions are present in different dfs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1707&quot;&gt;&lt;del&gt;HIVE-1707&lt;/del&gt;&lt;/a&gt; introduced this via a change to&lt;br/&gt;
org.apache.hadoop.hive.ql.metadata.Hive.loadPartition(Path, String, Map&amp;lt;String, String&amp;gt;, boolean, boolean)&lt;br/&gt;
specifically:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+      Path partPath = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(tbl.getDataLocation().getPath(),
+          Warehouse.makePartPath(partSpec));
+
+      Path newPartPath = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(loadPath.toUri().getScheme(), loadPath
+          .toUri().getAuthority(), partPath.toUri().getPath());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Reading the description on &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1707&quot; title=&quot;bug when different partitions are present in different dfs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1707&quot;&gt;&lt;del&gt;HIVE-1707&lt;/del&gt;&lt;/a&gt; it seems that this may have been done purposefully, however given the partition location is explicitly specified for the partition in question it seems like that should be honored (esp give the table location has not changed).&lt;/p&gt;

&lt;p&gt;This difference in behavior is causing a regression in existing production Hive based code. I&apos;d like to take a stab at addressing this, any suggestions?&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12504577">HIVE-2117</key>
            <summary>insert overwrite ignoring partition location</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="phunt">Patrick D. Hunt</assignee>
                                    <reporter username="phunt">Patrick D. Hunt</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Apr 2011 18:26:23 +0000</created>
                <updated>Wed, 27 Jul 2011 04:20:24 +0000</updated>
                            <resolved>Wed, 25 May 2011 05:10:06 +0000</resolved>
                                    <version>0.7.1</version>
                    <version>0.8.0</version>
                                    <fixVersion>0.7.1</fixVersion>
                    <fixVersion>0.8.0</fixVersion>
                                    <component>Metastore</component>
                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13021167" author="phunt" created="Mon, 18 Apr 2011 18:34:58 +0000"  >&lt;p&gt;single row of data that is used to reproduce the issue&lt;/p&gt;</comment>
                            <comment id="13023040" author="phunt" created="Thu, 21 Apr 2011 23:58:53 +0000"  >&lt;p&gt;This patch is a work in progress, it resolves this jira in branch 0.7 while maintaining compatibility with the requirements from &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1707&quot; title=&quot;bug when different partitions are present in different dfs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1707&quot;&gt;&lt;del&gt;HIVE-1707&lt;/del&gt;&lt;/a&gt;. All unit tests are passing with this patch applied, also fixes the example I provided in the description (managed and external table).&lt;/p&gt;

&lt;p&gt;I&apos;m still working on two aspects of this JIRA; 1) creating a patch for trunk, and 2) adding unit tests to verify this behavior.&lt;/p&gt;</comment>
                            <comment id="13036599" author="phunt" created="Fri, 20 May 2011 00:26:01 +0000"  >&lt;p&gt;Updated patch files for branch 0.7 and trunk.&lt;/p&gt;

&lt;p&gt;This fixes the problem &amp;#8211; I&apos;ve also added a new test which verifies the location used for the partition. I verified this failed before my patch and passes after applying my patch.&lt;/p&gt;</comment>
                            <comment id="13036908" author="jiraposter@reviews.apache.org" created="Fri, 20 May 2011 16:18:47 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/772/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/772/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive and Carl Steinbach.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This change resolves a regression introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1707&quot; title=&quot;bug when different partitions are present in different dfs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1707&quot;&gt;&lt;del&gt;HIVE-1707&lt;/del&gt;&lt;/a&gt;, specifically that the partition location (set via alter table partition location) is not being respected.&lt;/p&gt;

&lt;p&gt;I addressed this by using the user specified location (as done originally), except in the case with cross-filesystem moves (which was the concern in 1707).&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2117&quot; title=&quot;insert overwrite ignoring partition location&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2117&quot;&gt;&lt;del&gt;HIVE-2117&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2117&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2117&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java 916b235 &lt;br/&gt;
  ql/src/test/org/apache/hadoop/hive/ql/BaseTestQueries.java PRE-CREATION &lt;br/&gt;
  ql/src/test/org/apache/hadoop/hive/ql/QTestUtil.java 4685471 &lt;br/&gt;
  ql/src/test/org/apache/hadoop/hive/ql/TestLocationQueries.java PRE-CREATION &lt;br/&gt;
  ql/src/test/org/apache/hadoop/hive/ql/TestMTQueries.java 8c7c0b8 &lt;br/&gt;
  ql/src/test/queries/clientpositive/alter5.q PRE-CREATION &lt;br/&gt;
  ql/src/test/results/clientpositive/alter5.q.out PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/772/diff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/772/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;I added a new test which verifies partition location explicitly - as the existing tests ignore this detail. This test failed w/o my fix applied, it passes with the fix applied.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Patrick&lt;/p&gt;
</comment>
                            <comment id="13036912" author="phunt" created="Fri, 20 May 2011 16:26:40 +0000"  >&lt;p&gt;I posted reviews up on reviewboard:&lt;br/&gt;
trunk: &lt;a href=&quot;https://reviews.apache.org/r/773/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/773/&lt;/a&gt;&lt;br/&gt;
branch-0.7: &lt;a href=&quot;https://reviews.apache.org/r/772/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/772/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13036914" author="jiraposter@reviews.apache.org" created="Fri, 20 May 2011 16:26:47 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/773/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/773/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive and Carl Steinbach.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This change resolves a regression introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1707&quot; title=&quot;bug when different partitions are present in different dfs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1707&quot;&gt;&lt;del&gt;HIVE-1707&lt;/del&gt;&lt;/a&gt;, specifically that the partition location (set via alter table partition location) is not being respected.&lt;/p&gt;

&lt;p&gt;I addressed this by using the user specified location (as done originally), except in the case with cross-filesystem moves (which was the concern in 1707).&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2117&quot; title=&quot;insert overwrite ignoring partition location&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2117&quot;&gt;&lt;del&gt;HIVE-2117&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2117&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2117&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java bcacd35 &lt;br/&gt;
  ql/src/test/org/apache/hadoop/hive/ql/BaseTestQueries.java PRE-CREATION &lt;br/&gt;
  ql/src/test/org/apache/hadoop/hive/ql/QTestUtil.java 06a0447 &lt;br/&gt;
  ql/src/test/org/apache/hadoop/hive/ql/TestLocationQueries.java PRE-CREATION &lt;br/&gt;
  ql/src/test/org/apache/hadoop/hive/ql/TestMTQueries.java 8c7c0b8 &lt;br/&gt;
  ql/src/test/queries/clientpositive/alter5.q PRE-CREATION &lt;br/&gt;
  ql/src/test/results/clientpositive/alter5.q.out PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/773/diff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/773/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;I added a new test which verifies partition location explicitly - as the existing tests ignore this detail. This test failed w/o my fix applied, it passes with the fix applied.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Patrick&lt;/p&gt;
</comment>
                            <comment id="13037096" author="cwsteinbach" created="Fri, 20 May 2011 21:30:25 +0000"  >&lt;p&gt;+1. Will commit if tests pass.&lt;/p&gt;</comment>
                            <comment id="13038354" author="hudson" created="Tue, 24 May 2011 01:45:55 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #745 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/Hive-trunk-h0.21/745/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/hudson/job/Hive-trunk-h0.21/745/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2117&quot; title=&quot;insert overwrite ignoring partition location&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2117&quot;&gt;&lt;del&gt;HIVE-2117&lt;/del&gt;&lt;/a&gt;. Insert overwrite ignoring partition location (Patrick Hunt via cws)&lt;/p&gt;

&lt;p&gt;cws : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1126726&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1126726&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/org/apache/hadoop/hive/ql/TestLocationQueries.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/org/apache/hadoop/hive/ql/TestMTQueries.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/alter5.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/alter5.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/org/apache/hadoop/hive/ql/QTestUtil.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/org/apache/hadoop/hive/ql/BaseTestQueries.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13038963" author="cwsteinbach" created="Wed, 25 May 2011 05:10:06 +0000"  >&lt;p&gt;Committed to trunk. Thanks Patrick!&lt;/p&gt;</comment>
                            <comment id="13048697" author="cwsteinbach" created="Mon, 13 Jun 2011 18:29:13 +0000"  >&lt;p&gt;Backported to branch-0.7&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12477245">HIVE-1707</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12479864" name="HIVE-2117_br07.patch" size="30482" author="phunt" created="Fri, 20 May 2011 00:26:01 +0000"/>
                            <attachment id="12477059" name="HIVE-2117_br07.patch" size="1673" author="phunt" created="Thu, 21 Apr 2011 23:58:53 +0000"/>
                            <attachment id="12479865" name="HIVE-2117_trunk.patch" size="30231" author="phunt" created="Fri, 20 May 2011 00:26:01 +0000"/>
                            <attachment id="12476643" name="data.txt" size="4" author="phunt" created="Mon, 18 Apr 2011 18:34:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>66828</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 24 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lihz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123647</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>