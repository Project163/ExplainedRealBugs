<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:44:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-13743] Data move codepath is broken with hive (2.1.0-SNAPSHOT)</title>
                <link>https://issues.apache.org/jira/browse/HIVE-13743</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Data move codepath is broken with hive 2.1.0-SNAPSHOT with hadoop 2.8.0-snapshot.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caused by: org.apache.hadoop.ipc.RemoteException(java.io.FileNotFoundException): Path not found: /apps/hive/warehouse/tpcds_bin_partitioned_orc_10000.db/date_dim1
        at org.apache.hadoop.hdfs.server.namenode.FSDirEncryptionZoneOp.getEZForPath(FSDirEncryptionZoneOp.java:178)
        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.getEZForPath(FSNamesystem.java:7336)
        at org.apache.hadoop.hdfs.server.namenode.NameNodeRpcServer.getEZForPath(NameNodeRpcServer.java:1973)
        at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolServerSideTranslatorPB.getEZForPath(ClientNamenodeProtocolServerSideTranslatorPB.java:1376)
        at org.apache.hadoop.hdfs.protocol.proto.ClientNamenodeProtocolProtos$ClientNamenodeProtocol$2.callBlockingMethod(ClientNamenodeProtocolProtos.java)
        at org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:645)
        at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:989)
        at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:2339)
        at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:2335)
        at java.security.AccessController.doPrivileged(Native Method)
        at javax.security.auth.Subject.doAs(Subject.java:422)
        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1711)
        at org.apache.hadoop.ipc.Server$Handler.run(Server.java:2333)

        at org.apache.hadoop.ipc.Client.call(Client.java:1448)
        at org.apache.hadoop.ipc.Client.call(Client.java:1385)
        at org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:230)
        at com.sun.proxy.$Proxy30.getEZForPath(Unknown Source)/apps/hive/warehouse/tpcds_bin_partitioned_orc_200.db/

...
...
...
2016-05-11T09:40:43,760 ERROR [main]: ql.Driver (:()) - FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.MoveTask. Unable to move source hdfs://xyz:8020/apps/hive/warehouse/tpcds_bin_partitioned_orc_10000.db/.hive-staging_hive_2016-05-11_09-40-42_489_5056654133706433454-1/-ext-10002 to destination hdfs://xyz:8020/apps/hive/warehouse/tpcds_bin_partitioned_orc_10000.db/date_dim1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hive/blob/26b5c7b56a4f28ce3eabc0207566cce46b29b558/ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java#L2836&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/blob/26b5c7b56a4f28ce3eabc0207566cce46b29b558/ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java#L2836&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;hdfsEncryptionShim.isPathEncrypted(destf) in Hive could end up throwing FileNotFoundException as the destf is not present yet.  This causes moveFile to fail.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12968159">HIVE-13743</key>
            <summary>Data move codepath is broken with hive (2.1.0-SNAPSHOT)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ashutoshc">Ashutosh Chauhan</assignee>
                                    <reporter username="rajesh.balamohan">Rajesh Balamohan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 May 2016 00:06:38 +0000</created>
                <updated>Tue, 21 Jun 2016 15:08:26 +0000</updated>
                            <resolved>Sat, 14 May 2016 15:22:11 +0000</resolved>
                                    <version>2.1.0</version>
                                    <fixVersion>2.1.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15281126" author="ashutoshc" created="Thu, 12 May 2016 02:35:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rajesh.balamohan&quot; class=&quot;user-hover&quot; rel=&quot;rajesh.balamohan&quot;&gt;rajesh.balamohan&lt;/a&gt; Do you have small repro for this?&lt;/p&gt;</comment>
                            <comment id="15281237" author="rajesh.balamohan" created="Thu, 12 May 2016 06:09:03 +0000"  >&lt;p&gt;hive - 2.1.0-snapshot&lt;br/&gt;
tez - 0.8.4&lt;br/&gt;
hadoop - 2.8.0-snapshot (built on may-10)&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hive&amp;gt; create table test(id int) stored as orc;
OK
Time taken: 0.091 seconds

hive&amp;gt; insert into test values(10);
Query ID = rajesh_20160512060245_a6f56633-fd78-4c8b-81a5-863f80a161e2
Total jobs = 1
Launching Job 1 out of 1


----------------------------------------------------------------------------------------------
        VERTICES      MODE        STATUS  TOTAL  COMPLETED  RUNNING  PENDING  FAILED  KILLED
----------------------------------------------------------------------------------------------
Map 1 .......... container     SUCCEEDED      1          1        0        0       0       0
----------------------------------------------------------------------------------------------
VERTICES: 01/01  [==========================&amp;gt;&amp;gt;] 100%  ELAPSED TIME: 0.08 s
----------------------------------------------------------------------------------------------
Status: DAG finished successfully in 0.08 seconds
...
Loading data to table rajesh.test
Table rajesh.test stats: [numFiles=1, numRows=1, totalSize=182, rawDataSize=4]
OK
Time taken: 0.839 seconds
...
...
..
hive&amp;gt; create table test_1 as select * from test;
Query ID = rajesh_20160512060301_9233d9d1-e964-4e94-935a-ac778392d031
Total jobs = 1
Launching Job 1 out of 1


----------------------------------------------------------------------------------------------
        VERTICES      MODE        STATUS  TOTAL  COMPLETED  RUNNING  PENDING  FAILED  KILLED
----------------------------------------------------------------------------------------------
Map 1 .......... container     SUCCEEDED      1          1        0        0       0       0
----------------------------------------------------------------------------------------------
VERTICES: 01/01  [==========================&amp;gt;&amp;gt;] 100%  ELAPSED TIME: 0.05 s
----------------------------------------------------------------------------------------------
Status: DAG finished successfully in 0.05 seconds
Moving data to directory hdfs://xyz:8020/apps/hive/warehouse/rajesh.db/test_1
Failed with exception Unable to move source hdfs://xyz:8020/apps/hive/warehouse/rajesh.db/.hive-staging_hive_2016-05-12_06-03-01_281_5180494512279326104-1/-ext-10002 to destination hdfs://xyz:8020/apps/hive/warehouse/rajesh.db/test_1
FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.MoveTask. Unable to move source hdfs://xyz:8020/apps/hive/warehouse/rajesh.db/.hive-staging_hive_2016-05-12_06-03-01_281_5180494512279326104-1/-ext-10002 to destination hdfs://xyz:8020/apps/hive/warehouse/rajesh.db/test_1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Notice &quot;create table test_1 as select * from test;&quot; fails in the move task.&lt;/p&gt;</comment>
                            <comment id="15281238" author="rajesh.balamohan" created="Thu, 12 May 2016 06:11:50 +0000"  >&lt;p&gt;Tried a dirty hack by removing &quot;HdfsEncryptionShim&quot; check in needToCopy (which would get rid of the FileNotFoundException) and it went through without issues. &lt;/p&gt;</comment>
                            <comment id="15281908" author="ashutoshc" created="Thu, 12 May 2016 18:49:29 +0000"  >&lt;p&gt;This is because of change in behavior of HDFS from 2.6 to 2.8 wherein api hdfsAdmin.getEncryptionZoneForPath(path) used to return null for non-existent path in 2.6, now throws FNFE.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rajesh.balamohan&quot; class=&quot;user-hover&quot; rel=&quot;rajesh.balamohan&quot;&gt;rajesh.balamohan&lt;/a&gt; Can you test this out in 2.8 cluster? Can&apos;t write unit test for this since Hive currently uses 2.6 hadoop&lt;/p&gt;</comment>
                            <comment id="15282299" author="rajesh.balamohan" created="Fri, 13 May 2016 00:54:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; - Checked the patch in Hadoop 2.8 cluster and patch works as expected. No longer seeing this issue.&lt;/p&gt;</comment>
                            <comment id="15282397" author="ashutoshc" created="Fri, 13 May 2016 04:47:45 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rajesh.balamohan&quot; class=&quot;user-hover&quot; rel=&quot;rajesh.balamohan&quot;&gt;rajesh.balamohan&lt;/a&gt; for verification. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt; can you take a quick look at the patch?&lt;/p&gt;</comment>
                            <comment id="15283050" author="thejas" created="Fri, 13 May 2016 19:34:01 +0000"  >&lt;p&gt;I haven&apos;t gone very deep into the logic, but based on a quick look-  The current logic seems broken, if the destination file/directory does not exist, it does not mean that the destination file&apos;s zone is not encrypted. &lt;/p&gt;

&lt;p&gt;What are your thoughts &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt; ?&lt;/p&gt;

&lt;p&gt;The new patch from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; doesn&apos;t fix that issue, but it should get it working with Hadoop 2.8. We could get this in and follow up with another patch to address what seems to be an issue with current logic.&lt;/p&gt;

&lt;p&gt;Comments regarding the patch -&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Can you also include the exception in the log message ?&lt;/li&gt;
	&lt;li&gt;The indentation of return false; seems to be off&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15283188" author="ashutoshc" created="Fri, 13 May 2016 21:39:42 +0000"  >&lt;p&gt;updated patch to address Thejas&apos;s comments.&lt;/p&gt;</comment>
                            <comment id="15283308" author="thejas" created="Fri, 13 May 2016 23:40:01 +0000"  >&lt;p&gt;+1 to this patch.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt; what are your thoughts on the overall existing logic of this function and follow up jira ?&lt;/p&gt;</comment>
                            <comment id="15283584" author="ashutoshc" created="Sat, 14 May 2016 15:22:11 +0000"  >&lt;p&gt;Pushed to master. &lt;/p&gt;</comment>
                            <comment id="15283589" author="spena" created="Sat, 14 May 2016 15:51:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thejas&quot; class=&quot;user-hover&quot; rel=&quot;thejas&quot;&gt;thejas&lt;/a&gt; is right. The destination path that does not exist might be encrypted (when created) by its parent directory if the parent is in an encryption zone.&lt;br/&gt;
May we try to check if the destination parent directory in case the destination path does not exist?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12803958" name="HIVE-13743.2.patch" size="1273" author="ashutoshc" created="Fri, 13 May 2016 21:39:42 +0000"/>
                            <attachment id="12803732" name="HIVE-13743.patch" size="1268" author="ashutoshc" created="Thu, 12 May 2016 18:49:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 27 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2xp9b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>