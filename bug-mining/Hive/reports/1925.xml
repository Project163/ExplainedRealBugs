<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:16:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-6409] FileOutputCommitterContainer::commitJob() cancels delegation tokens too early.</title>
                <link>https://issues.apache.org/jira/browse/HIVE-6409</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;When HCatalog&apos;s FileOutputCommitterContainer::commitJob() is run, it calls the underlying OutputCommitter and then attempts to register partitions in HCatalog.&lt;/p&gt;

&lt;p&gt;If the commit fails (for example, because of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4996&quot; title=&quot;unbalanced calls to openTransaction/commitTransaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4996&quot;&gt;&lt;del&gt;HIVE-4996&lt;/del&gt;&lt;/a&gt;), commitJob() cancels delegation tokens retrieved from HCatalog before the exception is rethrown.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.io.IOException: java.lang.reflect.InvocationTargetException
    at
org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigOutputCommitter.commitJob(PigOutputCommitter.java:185)
    at
org.apache.hadoop.mapreduce.v2.app.commit.CommitterEventHandler$EventProcessor.handleJobCommit(CommitterEventHandler.java:249)
    at
org.apache.hadoop.mapreduce.v2.app.commit.CommitterEventHandler$EventProcessor.run(CommitterEventHandler.java:212)
    at
java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
    at
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
    at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:722)
Caused by: java.lang.reflect.InvocationTargetException
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
    at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:601)
    at
org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigOutputCommitter.commitJob(PigOutputCommitter.java:183)
    ... 5 more
Caused by: org.apache.hcatalog.common.HCatException : 2006 : Error adding
partition to metastore. Cause :
MetaException(message:java.lang.RuntimeException: commitTransaction was called
but openTransactionCalls = 0. This probably indicates that there are unbalanced
calls to openTransaction/commitTransaction)
    at
org.apache.hcatalog.mapreduce.FileOutputCommitterContainer.registerPartitions(FileOutputCommitterContainer.java:712)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem is that this happens before abortJob() has had a chance to run, thus yielding the following error:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;MetaException(message:Could not connect to meta store using any of the URIs provided. Most recent failure: org.apache.thrift.transport.TTransportException: Peer indicated failure: DIGEST-MD5: IO error acquiring password
	at org.apache.thrift.transport.TSaslTransport.receiveSaslMessage(TSaslTransport.java:190)
	at org.apache.thrift.transport.TSaslTransport.open(TSaslTransport.java:266)
	at org.apache.thrift.transport.TSaslClientTransport.open(TSaslClientTransport.java:37)
	at org.apache.hadoop.hive.thrift.client.TUGIAssumingTransport$1.run(TUGIAssumingTransport.java:52)
	at org.apache.hadoop.hive.thrift.client.TUGIAssumingTransport$1.run(TUGIAssumingTransport.java:49)
	at java.security.AccessController.doPrivileged(Native Method)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ll have a patch out that only cancels delegation tokens if the commitJob() has succeeded.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12694623">HIVE-6409</key>
            <summary>FileOutputCommitterContainer::commitJob() cancels delegation tokens too early.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mithun">Mithun Radhakrishnan</assignee>
                                    <reporter username="mithun">Mithun Radhakrishnan</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Feb 2014 23:52:45 +0000</created>
                <updated>Mon, 3 Mar 2014 21:53:45 +0000</updated>
                            <resolved>Mon, 3 Mar 2014 21:53:45 +0000</resolved>
                                    <version>0.12.0</version>
                    <version>0.13.0</version>
                                    <fixVersion>0.13.0</fixVersion>
                                    <component>HCatalog</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13898529" author="mithun" created="Wed, 12 Feb 2014 00:02:58 +0000"  >&lt;p&gt;Removed the finally{} block from commitJob(). If commit succeeds, there are no exceptions, and the tokens are cancelled. If commit fails, the cancel is avoided, and abortJob() takes care of cancelling the token.&lt;/p&gt;

&lt;p&gt;I&apos;ve also removed an annoying typo. I would also like to remove the following  catch blocks:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;(TException e){} 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;TException isA MetaException, so this is redundant. The error handling is identical in both cases. I&apos;d like to remove this cruft, if it&apos;s alright.&lt;/p&gt;</comment>
                            <comment id="13916562" author="sushanth" created="Fri, 28 Feb 2014 23:16:52 +0000"  >&lt;p&gt;Hi Mithun, could you please cancel your patch, rename your patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-6409&quot; title=&quot;FileOutputCommitterContainer::commitJob() cancels delegation tokens too early.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-6409&quot;&gt;&lt;del&gt;HIVE-6409&lt;/del&gt;&lt;/a&gt;.patch, and mark it as patch available again? That helps the pre-commit tests pick up the patch and run it with it.&lt;/p&gt;</comment>
                            <comment id="13916564" author="sushanth" created="Fri, 28 Feb 2014 23:18:11 +0000"  >&lt;p&gt;Also, actually, you may have to regenerate this patch real quick off trunk now, since FileOutputCommitterContainer has changed a bit.&lt;/p&gt;</comment>
                            <comment id="13916568" author="sushanth" created="Fri, 28 Feb 2014 23:20:29 +0000"  >&lt;p&gt;Also, please do not patch any of the org.apache.hcatalog.* classes - they are deprecated and are being maintained in parity with the state they were in as of hive-0.11. The only reason we&apos;d change them is if they do not build any more due to issues with hadoop or hive/etc. Bugfixes are to go on to org.apache.hive.hcatalog.* only for now.&lt;/p&gt;</comment>
                            <comment id="13917513" author="mithun" created="Sun, 2 Mar 2014 18:29:44 +0000"  >&lt;p&gt;I&apos;ve renamed the patch, removed the changes to the deprecated code and resubmitted.&lt;/p&gt;

&lt;p&gt;About not making changes to org.apache.hcatalog: It is really quite dangerous to patch fixes only into org.apache.hive.hcatalog. :/ We&apos;ll have to make sure that projects like Pig are using the right version of the packages, for fixes.&lt;/p&gt;

&lt;p&gt;Wouldn&apos;t it be preferable to remove the package entirely (and visibly break code) than to silently compile and produce something unusable? (Has this been discussed already?)&lt;/p&gt;</comment>
                            <comment id="13917551" author="hiveqa" created="Sun, 2 Mar 2014 20:39:36 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12632065/HIVE-6409.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12632065/HIVE-6409.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 5201 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/1594/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/1594/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/1594/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/1594/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12632065&lt;/p&gt;</comment>
                            <comment id="13918414" author="sushanth" created="Mon, 3 Mar 2014 18:51:58 +0000"  >&lt;p&gt;I&apos;m +1 on this new patch, I&apos;ll go ahead and commit it.&lt;/p&gt;

&lt;p&gt;As to your other concerns, this is per &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5274&quot; title=&quot;HCatalog package renaming backward compatibility follow-up&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5274&quot;&gt;&lt;del&gt;HIVE-5274&lt;/del&gt;&lt;/a&gt;, and per discussions that I brought up in the next hive-dev meetup(after that patch) as well.&lt;/p&gt;

&lt;p&gt;As to visibly breaking code, we will do that, as of 0.14, which will be trunk in a couple more days as soon as we branch out for 0.13 - we have &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-6432&quot; title=&quot;Remove deprecated methods in HCatalog&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-6432&quot;&gt;&lt;del&gt;HIVE-6432&lt;/del&gt;&lt;/a&gt; open for just that. The idea is that org.apache.hcatalog.* works predictably in the way it has for all of those that have already been using it and find it usable in the state it is in, whereas to all new users who may be evaluating, they must be moving to org.apache.hive.hcatalog.&lt;/p&gt;</comment>
                            <comment id="13918424" author="sushanth" created="Mon, 3 Mar 2014 19:00:07 +0000"  >&lt;p&gt;Committed (with some minor indenting fixes).&lt;/p&gt;

&lt;p&gt;Thanks, Mithun!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12632065" name="HIVE-6409.patch" size="1406" author="mithun" created="Sun, 2 Mar 2014 18:29:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>373131</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 38 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1sawn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>373432</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>FileOutputCommitterContainer delegation tokens</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>