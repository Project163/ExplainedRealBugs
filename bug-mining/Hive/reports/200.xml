<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:53:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-626] Typecast bug in Join operator</title>
                <link>https://issues.apache.org/jira/browse/HIVE-626</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;There is a type cast error in Join operator. Produced by the following steps:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;create table zshao_foo (foo_id &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, foo_name string, foo_a string, foo_b string,
foo_c string, foo_d string) row format delimited fields terminated by &lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;
stored as textfile;

create table zshao_bar (bar_id &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, bar_0 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, foo_id &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, bar_1 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, bar_name
string, bar_a string, bar_b string, bar_c string, bar_d string) row format
delimited fields terminated by &lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt; stored as textfile;

create table zshao_count (bar_id &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, n &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) row format delimited fields
terminated by &lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt; stored as textfile;


Each table has a single row as follows:

zshao_foo:
1,foo1,a,b,c,d

zshao_bar:
10,0,1,1,bar10,a,b,c,d

zshao_count:
10,2

load data local inpath &lt;span class=&quot;code-quote&quot;&gt;&apos;zshao_foo&apos;&lt;/span&gt; overwrite into table zshao_foo;
load data local inpath &lt;span class=&quot;code-quote&quot;&gt;&apos;zshao_bar&apos;&lt;/span&gt; overwrite into table zshao_bar;
load data local inpath &lt;span class=&quot;code-quote&quot;&gt;&apos;zshao_count&apos;&lt;/span&gt; overwrite into table zshao_count;

explain extended
select zshao_foo.foo_name, zshao_bar.bar_name, n from zshao_foo join zshao_bar on zshao_foo.foo_id =
zshao_bar.foo_id join zshao_count on zshao_count.bar_id = zshao_bar.bar_id;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The case is from David Lerman.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12430112">HIVE-626</key>
            <summary>Typecast bug in Join operator</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="he yongqiang">He Yongqiang</assignee>
                                    <reporter username="zshao">Zheng Shao</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Jul 2009 22:45:57 +0000</created>
                <updated>Tue, 26 Jan 2016 08:23:26 +0000</updated>
                            <resolved>Tue, 14 Jul 2009 00:06:21 +0000</resolved>
                                                    <fixVersion>0.4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="12729880" author="zshao" created="Fri, 10 Jul 2009 23:12:44 +0000"  >&lt;p&gt;I added some instrumentation to the code (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-626&quot; title=&quot;Typecast bug in Join operator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-626&quot;&gt;&lt;del&gt;HIVE-626&lt;/del&gt;&lt;/a&gt;.1.showinfo.patch)  The result of &quot;explain extended&quot; (below) shows that the order of the output column of the JoinOperator does not match that of the FileSinkOperator:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;hive&amp;gt; explain extended
    &amp;gt; select zshao_foo.foo_name, zshao_bar.bar_name, n from zshao_foo join zshao_bar on zshao_foo.foo_id =
    &amp;gt; zshao_bar.foo_id join zshao_count on zshao_count.bar_id = zshao_bar.bar_id;
OK
ABSTRACT SYNTAX TREE:
  (TOK_QUERY (TOK_FROM (TOK_JOIN (TOK_JOIN (TOK_TABREF zshao_foo) (TOK_TABREF zshao_bar) (= (. (TOK_TABLE_OR_COL zshao_foo) foo_id) (. (TOK_TABLE_OR_COL zshao_bar) foo_id))) (TOK_TABREF zshao_count) (= (. (TOK_TABLE_OR_COL zshao_count) bar_id) (. (TOK_TABLE_OR_COL zshao_bar) bar_id)))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (. (TOK_TABLE_OR_COL zshao_foo) foo_name)) (TOK_SELEXPR (. (TOK_TABLE_OR_COL zshao_bar) bar_name)) (TOK_SELEXPR (TOK_TABLE_OR_COL n)))))

STAGE DEPENDENCIES:
  Stage-1 is a root stage
  Stage-2 depends on stages: Stage-1
  Stage-0 is a root stage

STAGE PLANS:
  Stage: Stage-1
    Map Reduce
      Alias -&amp;gt; Map Operator Tree:
...
      Reduce Operator Tree:
        Join Operator
          condition map:
               Inner Join 0 to 1
          condition expressions:
            0 {VALUE._col1}
            1 {VALUE._col0} {VALUE._col4}
          output names: _col1, _col6, _col10
          File Output Operator
            compressed: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
            GlobalTableId: 0
            directory: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//xxx:9000/tmp/hive-zshao/1413634235/10002
&lt;/span&gt;            table:
                input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
                properties:
                  name binary_table
                  serialization.ddl struct binary_table { string _col1, string _col10, i32 _col6}
                  serialization.format com.facebook.thrift.protocol.TBinaryProtocol
                name: binary_table

  Stage: Stage-2
    Map Reduce
      Alias -&amp;gt; Map Operator Tree:
        $INTNAME
...

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;The output of the join has the order: output names: _col1, _col6, _col10&lt;br/&gt;
The FileSinkOperator expects: struct binary_table &lt;/p&gt;
{ string _col1, string _col10, i32 _col6}</comment>
                            <comment id="12729899" author="zshao" created="Fri, 10 Jul 2009 23:59:03 +0000"  >&lt;p&gt;One hypothesis: the column names got sorted at some places - _col10 &amp;lt; _col6.&lt;/p&gt;

&lt;p&gt;I tried to disable &quot;column pruner&quot; but it didn&apos;t work as well.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;hive&amp;gt; set hive.optimize.ppd=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12729923" author="namit" created="Sat, 11 Jul 2009 01:04:28 +0000"  >&lt;p&gt;Zheng, you are disabling partition pushdown - not column pruning.&lt;br/&gt;
For that, you need to change the code - there is no way to disable column pruning right now.&lt;/p&gt;</comment>
                            <comment id="12730171" author="zshao" created="Mon, 13 Jul 2009 00:12:34 +0000"  >&lt;p&gt;Thanks Namit for pointing that out. This patch adds the capability of disabling column pruner.&lt;/p&gt;

&lt;p&gt;The following query runs successfully, so the problem is inside the column pruner.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;hive&amp;gt; set hive.optimize.cp=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
hive&amp;gt; explain extended
    &amp;gt; select zshao_foo.foo_name, zshao_bar.bar_name, n from zshao_foo join zshao_bar on zshao_foo.foo_id =
    &amp;gt; zshao_bar.foo_id join zshao_count on zshao_count.bar_id = zshao_bar.bar_id;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12730176" author="zshao" created="Mon, 13 Jul 2009 00:56:51 +0000"  >&lt;p&gt;Some comments from briefly looking at the ColumnPruner.java code:&lt;/p&gt;

&lt;p&gt;1. selectDesc has boolean selectStar and boolean selectStarNoCompute - &quot;SELECT *&quot; is just a syntactic sugar. We should remove these from the plan.&lt;/p&gt;

&lt;p&gt;2. RowResolver is used at compilation stage (to resolve a name like &quot;alias.col&quot; to the actual fields in the input row object). Why do we need to access RowResolver at all in the optimization stage? We only need to use RowSchema which can be obtained through &quot;Operator.getSchema()&quot; call.&lt;/p&gt;

&lt;p&gt;3. The following comment from &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-460&quot; title=&quot;Improve ColumnPruner to prune more aggressively and keep column information for input tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-460&quot;&gt;&lt;del&gt;HIVE-460&lt;/del&gt;&lt;/a&gt; looks highly suspicious.&lt;br/&gt;
&quot;&lt;br/&gt;
Yongqiang He added a comment - 13/Jun/09 12:41 AM&lt;br/&gt;
Namit, Thanks for correction. Upload a new patch. I guess the diffs came from the order of file output operator&apos;s column names. And the new patch sorted field schemas according to their names. Hope this can pass the tests. Again it passed in my local. &lt;br/&gt;
&quot;&lt;/p&gt;</comment>
                            <comment id="12730177" author="zshao" created="Mon, 13 Jul 2009 01:01:28 +0000"  >&lt;p&gt;For 3 in the last comment, the right way to do it is to preserve the order of the columns - for each of the original columns, we test if it&apos;s needed or not, and then add it to the new column list.&lt;br/&gt;
We should not sort the columns by names.&lt;/p&gt;</comment>
                            <comment id="12730188" author="he yongqiang" created="Mon, 13 Jul 2009 01:53:54 +0000"  >&lt;p&gt;The reason is the inconsistent of the order of columns in reduceSink&apos;s rowschema and the order of columns in reduce sink&apos;s output column array.&lt;br/&gt;
rowschema is used to create a file output op when splitting mr tasks, and the output column names are used to init the inspector.&lt;br/&gt;
will upload a patch soon.&lt;/p&gt;</comment>
                            <comment id="12730259" author="he yongqiang" created="Mon, 13 Jul 2009 08:55:56 +0000"  >&lt;p&gt;Added a new testcase and removed keyinfor and valueinfo from explain plan. &lt;br/&gt;
Passed tests in my local.&lt;/p&gt;</comment>
                            <comment id="12730614" author="zshao" created="Tue, 14 Jul 2009 00:06:21 +0000"  >&lt;p&gt;Committed. Thanks Yonqqiang!&lt;/p&gt;</comment>
                            <comment id="15116917" author="lefty@hortonworks.com" created="Tue, 26 Jan 2016 08:22:49 +0000"  >&lt;p&gt;Doc note:  This added &lt;b&gt;hive.optimize.cp&lt;/b&gt; (column pruner) to HiveConf.java and changed the default value of &lt;b&gt;hive.optimize.ppd&lt;/b&gt; to true in 0.4.0 (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-279&quot; title=&quot;Implement predicate push down for hive queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-279&quot;&gt;&lt;del&gt;HIVE-279&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.optimize.cp&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Configuration Properties &amp;#8211; hive.optimize.cp &lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.optimize.ppd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Configuration Properties &amp;#8211; hive.optimize.ppd &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12414282">HIVE-279</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12430181">HIVE-627</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12413169" name="HIVE-626.1.showinfo.patch" size="1665" author="zshao" created="Fri, 10 Jul 2009 23:12:44 +0000"/>
                            <attachment id="12413249" name="HIVE-626.2.showinfo_disable_cp.patch" size="3668" author="zshao" created="Mon, 13 Jul 2009 00:12:34 +0000"/>
                            <attachment id="12413280" name="hive-626-2009-07-13-2.patch" size="385531" author="he yongqiang" created="Mon, 13 Jul 2009 08:55:56 +0000"/>
                            <attachment id="12413255" name="hive-626-2009-07-13.patch" size="950763" author="he yongqiang" created="Mon, 13 Jul 2009 02:00:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73403</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 43 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lavj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>122412</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-626&quot; title=&quot;Typecast bug in Join operator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-626&quot;&gt;&lt;strike&gt;HIVE-626&lt;/strike&gt;&lt;/a&gt;. Fix Column Pruner column order bug. (Yongqiang He via zshao)</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>