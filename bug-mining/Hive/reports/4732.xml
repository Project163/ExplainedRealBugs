<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:46:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-13704] Don&apos;t call DistCp.execute() instead of DistCp.run()</title>
                <link>https://issues.apache.org/jira/browse/HIVE-13704</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11607&quot; title=&quot;Export tables broken for data &amp;gt; 32 MB&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11607&quot;&gt;&lt;del&gt;HIVE-11607&lt;/del&gt;&lt;/a&gt; switched DistCp from using &lt;tt&gt;run&lt;/tt&gt; to &lt;tt&gt;execute&lt;/tt&gt;. The &lt;tt&gt;run&lt;/tt&gt; method runs added logic that drives the state of &lt;tt&gt;SimpleCopyListing&lt;/tt&gt; which runs in the driver, and of &lt;tt&gt;CopyCommitter&lt;/tt&gt; which runs in the job runtime.&lt;/p&gt;

&lt;p&gt;When Hive ends up running DistCp for copy work (Between non matching FS or between encrypted/non-encrypted zones, for sizes above a configured value) this state not being set causes wrong paths to appear on the target (subdirs named after the file, instead of just the file).&lt;/p&gt;

&lt;p&gt;Hive should call DistCp&apos;s Tool &lt;tt&gt;run&lt;/tt&gt; method and not the &lt;tt&gt;execute&lt;/tt&gt; method directly, to not skip the target exists flag that the &lt;tt&gt;setTargetPathExists&lt;/tt&gt; call would set:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hadoop/blob/release-2.7.1/hadoop-tools/hadoop-distcp/src/main/java/org/apache/hadoop/tools/DistCp.java#L108-L126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/blob/release-2.7.1/hadoop-tools/hadoop-distcp/src/main/java/org/apache/hadoop/tools/DistCp.java#L108-L126&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12965562">HIVE-13704</key>
            <summary>Don&apos;t call DistCp.execute() instead of DistCp.run()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="spena">Sergio Pe&#241;a</assignee>
                                    <reporter username="qwertymaniac">Harsh J</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 May 2016 11:25:19 +0000</created>
                <updated>Thu, 23 Aug 2018 06:39:26 +0000</updated>
                            <resolved>Tue, 12 Jul 2016 18:36:59 +0000</resolved>
                                    <version>1.3.0</version>
                    <version>2.0.0</version>
                                    <fixVersion>2.1.1</fixVersion>
                    <fixVersion>2.2.0</fixVersion>
                                    <component>Hive</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15274004" author="qwertymaniac" created="Fri, 6 May 2016 13:05:42 +0000"  >&lt;p&gt;This is a problem only for the Hadoop23Shims DistCp callers, not for Hadoop20Shims, because branch-1&apos;s distcp2 in hadoop does not have such a state-setting function inside &lt;tt&gt;run()&lt;/tt&gt;: &lt;a href=&quot;https://github.com/apache/hadoop/blob/branch-1/src/tools/org/apache/hadoop/tools/distcp2/DistCp.java#L96-L114&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/blob/branch-1/src/tools/org/apache/hadoop/tools/distcp2/DistCp.java#L96-L114&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15274690" author="ashutoshc" created="Fri, 6 May 2016 20:40:29 +0000"  >&lt;p&gt;If its because of &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10459&quot; title=&quot;distcp V2 doesn&amp;#39;t preserve root dir&amp;#39;s attributes when -p is specified&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10459&quot;&gt;&lt;del&gt;HADOOP-10459&lt;/del&gt;&lt;/a&gt; then bug shouldn&apos;t manifest in hadoop-2.5+ Is that correct?&lt;/p&gt;</comment>
                            <comment id="15275975" author="qwertymaniac" created="Mon, 9 May 2016 05:46:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; - The opposite. &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10459&quot; title=&quot;distcp V2 doesn&amp;#39;t preserve root dir&amp;#39;s attributes when -p is specified&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10459&quot;&gt;&lt;del&gt;HADOOP-10459&lt;/del&gt;&lt;/a&gt; added the new method call in &lt;tt&gt;run()&lt;/tt&gt;, so any Hadoop releases with that fix in will no longer execute DistCp correctly in Hive, because Hive has skipped calling &lt;tt&gt;run()&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15371601" author="spena" created="Mon, 11 Jul 2016 20:56:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; Could you review this small patch? I just start using run() again. &lt;/p&gt;

&lt;p&gt;I run a test with the old code and the issue was happening as stated in this patch. When I changed to run(), then the problem got away.&lt;/p&gt;

&lt;p&gt;Btw, I reproduced the issue using:&lt;br/&gt;
&lt;tt&gt;LOAD PATH INPATH &apos;/tmp/dummytext.txt&apos; OVERWRITE INTO TABLE dummytext;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;dummytext was in an encryption zone, and when I run it with the execute() method, then the final destination for the file was: &lt;tt&gt;/user/hive/warehouse/dummytext/dummytext.txt/dummytext.txt&lt;/tt&gt;. It was creating a new subdirectory inside the table location.&lt;/p&gt;</comment>
                            <comment id="15371868" author="ashutoshc" created="Mon, 11 Jul 2016 23:13:16 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15373309" author="hiveqa" created="Tue, 12 Jul 2016 17:36:40 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12817250/HIVE-13704.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12817250/HIVE-13704.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 11 failed/errored test(s), 10309 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_acid_globallimit
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_12
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_13
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_list_bucket
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_multiinsert
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_vector_complex_all
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_vector_complex_join
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_acid_globallimit
org.apache.hadoop.hive.cli.TestMinimrCliDriver.org.apache.hadoop.hive.cli.TestMinimrCliDriver
org.apache.hive.service.cli.session.TestSessionManagerMetrics.testThreadPoolMetrics
org.apache.hive.spark.client.TestSparkClient.testJobSubmission
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/483/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/483/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/483/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/483/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-483/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-483/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 11 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12817250 - PreCommit-HIVE-MASTER-Build&lt;/p&gt;</comment>
                            <comment id="15373390" author="spena" created="Tue, 12 Jul 2016 18:22:54 +0000"  >&lt;p&gt;The tests are not related. &lt;br/&gt;
Most of the tests are failing on previous jobs, except for TestSessionManagerMetrics.testThreadPoolMetrics, but the output nor the test look related to the distcp change.&lt;br/&gt;
I will commit this patch.&lt;/p&gt;</comment>
                            <comment id="15373432" author="spena" created="Tue, 12 Jul 2016 18:36:59 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; for the review.&lt;/p&gt;</comment>
                            <comment id="16589769" author="maheshk114" created="Thu, 23 Aug 2018 06:39:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;There seems to be a leak of job object if we call run instead of execute. The issue is in the run method of distcp which does not close the job created. As per this issue, the problem with calling execute is that , setTargetPathExists is not done in execute. Can we do that and other settings done in run method  in hive and call distcp.execute instead of distcp.run ? &lt;/p&gt;

&lt;p&gt;//cc&lt;br/&gt;
 &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thejas&quot; class=&quot;user-hover&quot; rel=&quot;thejas&quot;&gt;thejas&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anishek&quot; class=&quot;user-hover&quot; rel=&quot;anishek&quot;&gt;anishek&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sankarh&quot; class=&quot;user-hover&quot; rel=&quot;sankarh&quot;&gt;sankarh&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12857353">HIVE-11607</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12817250" name="HIVE-13704.1.patch" size="1300" author="spena" created="Mon, 11 Jul 2016 20:56:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 12 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2x9av:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>