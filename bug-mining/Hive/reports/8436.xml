<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:23:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-22173] Query with multiple lateral views hangs during compilation</title>
                <link>https://issues.apache.org/jira/browse/HIVE-22173</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Steps To Repro:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-- create table 

CREATE EXTERNAL TABLE `jsontable`( 
`json_string` string) 
ROW FORMAT SERDE 
&lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe&apos;&lt;/span&gt; 
STORED AS INPUTFORMAT 
&lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.hadoop.mapred.TextInputFormat&apos;&lt;/span&gt; 
OUTPUTFORMAT 
&lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&apos;&lt;/span&gt; ;

-- Run explain of the query
explain SELECT
*
FROM jsontable
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield.addr.city&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t1 as c1
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield.addr.country&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t2 as c2
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield.addr&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t3 as c3
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield.addr.postalCode&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t4 as c4
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield.addr.state&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t5 as c5
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield.addr.streetAddressLine&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t6 as c6
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield.dummyfield&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t7 as c7
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield.dummyfield&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t8 as c8
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield.dummyfield.name.suffix&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t9 as c9
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield.id.extension&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t10 as c10
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield.id&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t11 as c11
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield.id.root&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t12 as c12
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield.telecom.&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t13 as c13
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield.dummyfield1.use&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t14 as c14
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield.dummyfield1.value&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t15 as c15
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield1.dummyfield1.code&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t16 as c16
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield1.dummyfield1.value&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t17 as c17
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield2.city&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t18 as c18
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield2.city&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t19 as c19
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield2.country&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t20 as c20
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield2.country&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t21 as c21
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t22 as c22
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield2.postalCode&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t23 as c23
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield2.postalCode&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t24 as c24
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield2.state&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t25 as c25
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield2.state&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t26 as c26
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield2&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t27 as c27
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield2.streetAddressLine&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t28 as c28
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield2.use&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t29 as c29
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield3&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t30 as c30
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield3&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t31 as c31
lateral view explode(split(regexp_replace(get_json_object(jsontable.json_string, &lt;span class=&quot;code-quote&quot;&gt;&apos;$.jsonfield4&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\\[|\\]|\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;&quot;),&lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;)) t32 as c32
;

-- it will hung forever
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#8211; HS2 jstacks&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// 
&lt;/span&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;8ed37c3a-be03-4f74-9afd-419d05609b9c HiveServer2-Handler-Pool: &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-85&quot;&lt;/span&gt; #85 prio=5 os_prio=0 tid=0x00007f3bd873f800 nid=0x90b94 runnable [0x00007f3baa6e2000]&lt;span class=&quot;code-quote&quot;&gt;&quot;8ed37c3a-be03-4f74-9afd-419d05609b9c HiveServer2-Handler-Pool: &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-85&quot;&lt;/span&gt; #85 prio=5 os_prio=0 tid=0x00007f3bd873f800 nid=0x90b94 runnable [0x00007f3baa6e2000]&#160; &#160;java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE at java.util.regex.Pattern$Curly.match0(Pattern.java:4272) at java.util.regex.Pattern$Curly.match(Pattern.java:4234) at java.util.regex.Pattern$Slice.match(Pattern.java:3972) at java.util.regex.Pattern$GroupHead.match(Pattern.java:4658) at java.util.regex.Matcher.match(Matcher.java:1270) at java.util.regex.Matcher.matches(Matcher.java:604) at org.apache.hadoop.hive.ql.lib.RuleRegExp.costPatternWithWildCardChar(RuleRegExp.java:236) at org.apache.hadoop.hive.ql.lib.RuleRegExp.cost(RuleRegExp.java:279) at org.apache.hadoop.hive.ql.lib.DefaultRuleDispatcher.dispatch(DefaultRuleDispatcher.java:72) at org.apache.hadoop.hive.ql.lib.DefaultGraphWalker.dispatchAndReturn(DefaultGraphWalker.java:105) at org.apache.hadoop.hive.ql.lib.DefaultGraphWalker.dispatch(DefaultGraphWalker.java:89) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:43) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.PreOrderOnceWalker.walk(PreOrderOnceWalker.java:54) at org.apache.hadoop.hive.ql.lib.DefaultGraphWalker.startWalking(DefaultGraphWalker.java:120) at org.apache.hadoop.hive.ql.ppd.SyntheticJoinPredicate.transform(SyntheticJoinPredicate.java:106) at org.apache.hadoop.hive.ql.optimizer.Optimizer.optimize(Optimizer.java:250) at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.analyzeInternal(SemanticAnalyzer.java:12423) at org.apache.hadoop.hive.ql.parse.CalcitePlanner.analyzeInternal(CalcitePlanner.java:360) at org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:289) at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:664) at org.apache.hadoop.hive.ql.Driver.compileInternal(Driver.java:1869) at org.apache.hadoop.hive.ql.Driver.compileAndRespond(Driver.java:1816) at org.apache.hadoop.hive.ql.Driver.compileAndRespond(Driver.java:1811) at org.apache.hadoop.hive.ql.reexec.ReExecDriver.compileAndRespond(ReExecDriver.java:126) at org.apache.hive.service.cli.operation.SQLOperation.prepare(SQLOperation.java:197) at org.apache.hive.service.cli.operation.SQLOperation.runInternal(SQLOperation.java:262) at org.apache.hive.service.cli.operation.Operation.run(Operation.java:247) at org.apache.hive.service.cli.session.HiveSessionImpl.executeStatementInternal(HiveSessionImpl.java:575) at org.apache.hive.service.cli.session.HiveSessionImpl.executeStatementAsync(HiveSessionImpl.java:561) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.apache.hive.service.cli.session.HiveSessionProxy.invoke(HiveSessionProxy.java:78) at org.apache.hive.service.cli.session.HiveSessionProxy.access$000(HiveSessionProxy.java:36) at org.apache.hive.service.cli.session.HiveSessionProxy$1.run(HiveSessionProxy.java:63) at java.security.AccessController.doPrivileged(Native Method) at javax.security.auth.Subject.doAs(Subject.java:422) at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1730) at org.apache.hive.service.cli.session.HiveSessionProxy.invoke(HiveSessionProxy.java:59) at com.sun.proxy.$Proxy45.executeStatementAsync(Unknown Source) at org.apache.hive.service.cli.CLIService.executeStatementAsync(CLIService.java:315) at org.apache.hive.service.cli.thrift.ThriftCLIService.ExecuteStatement(ThriftCLIService.java:566) at org.apache.hive.service.rpc.thrift.TCLIService$Processor$ExecuteStatement.getResult(TCLIService.java:1557) at org.apache.hive.service.rpc.thrift.TCLIService$Processor$ExecuteStatement.getResult(TCLIService.java:1542) at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:39) at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:39) at org.apache.hive.service.auth.TSetIpAddressProcessor.process(TSetIpAddressProcessor.java:56) at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:286) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;attached 10 jstacks taken at the interval of 30 seconds.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Hive-3.1.1, Java-8&lt;/p&gt;</environment>
        <key id="13255087">HIVE-22173</key>
            <summary>Query with multiple lateral views hangs during compilation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zabetak">Stamatis Zampetakis</assignee>
                                    <reporter username="Rajkumar Singh">Rajkumar Singh</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 5 Sep 2019 20:57:57 +0000</created>
                <updated>Tue, 15 Aug 2023 06:33:21 +0000</updated>
                            <resolved>Mon, 23 Jan 2023 13:10:33 +0000</resolved>
                                    <version>3.1.1</version>
                    <version>4.0.0-alpha-1</version>
                                    <fixVersion>4.0.0-beta-1</fixVersion>
                                    <component>HiveServer2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="8400">2h 20m</timespent>
                                <comments>
                            <comment id="16923834" author="vgarg" created="Fri, 6 Sep 2019 00:20:51 +0000"  >&lt;p&gt;Is CBO off in this case?&lt;/p&gt;</comment>
                            <comment id="17559736" author="zabetak" created="Tue, 28 Jun 2022 12:16:59 +0000"  >&lt;p&gt;The problem is still present currently in master (&lt;a href=&quot;https://github.com/apache/hive/commit/e0f1baaa59153cc260f0a50f04218a450cbdc1b8)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/commit/e0f1baaa59153cc260f0a50f04218a450cbdc1b8).&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17559745" author="zabetak" created="Tue, 28 Jun 2022 12:33:53 +0000"  >&lt;p&gt;There is a workaround which allows the query to pass successfully from the compilation stage:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;set&lt;/span&gt; hive.tez.&lt;span class=&quot;code-keyword&quot;&gt;dynamic&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;partition&lt;/span&gt;.pruning=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Setting the above property to false will bybass the &lt;tt&gt;SyntheticJoinPredicate&lt;/tt&gt; transformation which triggers the problem&lt;/p&gt;</comment>
                            <comment id="17642144" author="zabetak" created="Thu, 1 Dec 2022 19:54:50 +0000"  >&lt;p&gt;I will simplify a bit the query to demonstrate the problem. Consider the following setting:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; customer(orders &lt;span class=&quot;code-keyword&quot;&gt;array&lt;/span&gt;&amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;string&lt;/span&gt;&amp;gt;);

&lt;span class=&quot;code-keyword&quot;&gt;EXPLAIN&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; *
&lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; customer
&lt;span class=&quot;code-keyword&quot;&gt;lateral&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;view&lt;/span&gt; explode(orders) v &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; c1
&lt;span class=&quot;code-keyword&quot;&gt;lateral&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;view&lt;/span&gt; explode(orders) v &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; c2
&lt;span class=&quot;code-keyword&quot;&gt;lateral&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;view&lt;/span&gt; explode(orders) v &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; c3
&lt;span class=&quot;code-keyword&quot;&gt;lateral&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;view&lt;/span&gt; explode(orders) v &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; c4
; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The structure of the operator plan &lt;a href=&quot;https://github.com/apache/hive/blob/b053c61e6d9ffe36f3197a3efe88732bef726ecf/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java#L12904&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;before logical optimizations&lt;/a&gt; is shown in  &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13053418/13053418_op_plan_4_lateral_views.pdf&quot; title=&quot;op_plan_4_lateral_views.pdf attached to HIVE-22173&quot;&gt;op_plan_4_lateral_views.pdf&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; .&lt;/p&gt;

&lt;p&gt;The plan is comprised from 4 sub-graphs (one for each lateral view appearing in the query) connected together in a linear fashion. We can observe that from each LVF node we have exactly two paths that merge onto an LVJ node. &lt;/p&gt;

&lt;p&gt;Recursive algorithms follow a DFS traversal pattern some allowing a node to be visited again (e.g., when trying to enumerate all possible paths in a DAG) and some not. Such kind of algorithms appear in various places in Hive and two that cause problems in this case are shown below:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;PreOrderOnceWalker uses DFS and allows a node to be visited again&lt;/li&gt;
	&lt;li&gt;The JSON plan serialization (ExplainTask#getJSONPlan) uses DFS and allows a node to be visited again&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;By allowing a node to be visited again we are more or less enumerating all paths from the root to every other node in the DAG. Observe that for this particular plan with the lateral views we have 2^N paths from the TS (root) to the FS (leaf) where N is the number of lateral views in the query. When the N is small (e.g., in this case 4) the query finishes normally but as soon as it grows a bit (15 to 20) the query will get stuck (or die with OOM) in every place where there is recursion (DFS traversal) with repetition.&lt;/p&gt;

&lt;p&gt;Next steps/potential solutions:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Check if it is possible to change the shape of the operator tree;&lt;/li&gt;
	&lt;li&gt;Check if the DFS algorithms that allow nodes to be visited again can be changed/fixed;&lt;/li&gt;
	&lt;li&gt;Detect potentially expensive traversals and selectively disable optimizations.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17646665" author="zabetak" created="Tue, 13 Dec 2022 14:31:42 +0000"  >&lt;p&gt;As explained above, the nature of the query plan graph is likely to cause problems in various areas. The problem appeared in the past (&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11617&quot; title=&quot;Explain plan for multiple lateral views is very slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11617&quot;&gt;&lt;del&gt;HIVE-11617&lt;/del&gt;&lt;/a&gt;) and as long as the graph structure remains the same it will probably appear again in the future.&lt;/p&gt;

&lt;p&gt;Changing the structure of the plan is not trivial and may have unpredictable consequences to various queries. PR#3852, attempts to address the problem locally in the areas that suffer at this point in time (EXPLAIN and SyntheticJoinPredicate transformation).&lt;/p&gt;

&lt;p&gt;The EXPLAIN output cannot really be fixed for this query since the output requires all paths to be displayed and the same goes for the JSON representation. However, to prevent HS2 from crashing or hanging I opted to fail-fast the respective EXPLAIN statements when a certain (configurable) threshold is exceeded.&lt;/p&gt;

&lt;p&gt;Along the same lines, in order to avoid an exponential visit of nodes during the SyntheticJoinPredicate transformation I chose to &quot;disable&quot; the optimization for paths containing lateral views. This change essentially nukes the partition pruning and semijoin reduction optimizations on branches with lateral views but this should be rather rare anyways.&lt;/p&gt;</comment>
                            <comment id="17679794" author="zabetak" created="Mon, 23 Jan 2023 13:10:33 +0000"  >&lt;p&gt;Fixed in &lt;a href=&quot;https://github.com/apache/hive/commit/2031af314e70f3b8e07add13cb65416c29956181&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/commit/2031af314e70f3b8e07add13cb65416c29956181&lt;/a&gt;. Thanks for the reviews &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=amansinha100&quot; class=&quot;user-hover&quot; rel=&quot;amansinha100&quot;&gt;amansinha100&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ayushsaxena&quot; class=&quot;user-hover&quot; rel=&quot;ayushsaxena&quot;&gt;ayushsaxena&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                            <outwardlinks description="requires">
                                        <issuelink>
            <issuekey id="12857843">HIVE-11617</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13053418" name="op_plan_4_lateral_views.pdf" size="10770" author="zabetak" created="Thu, 1 Dec 2022 18:24:58 +0000"/>
                            <attachment id="12979589" name="thread-progress.log" size="132528" author="Rajkumar Singh" created="Thu, 5 Sep 2019 20:59:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 42 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z06dbk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>