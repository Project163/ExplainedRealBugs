<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:22:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-25904] ObjectStore&apos;s updateTableColumnStatistics is not ThreadSafe</title>
                <link>https://issues.apache.org/jira/browse/HIVE-25904</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[root@igansperger-hive-tgt-3 ~]# cat test.sh
hive -e &lt;span class=&quot;code-quote&quot;&gt;&apos;create database test; create external table test.foo(col1 string);&apos;&lt;/span&gt; 2&amp;gt; /dev/&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
hive -e &lt;span class=&quot;code-quote&quot;&gt;&quot;select count(*) from sys.tab_col_stats where db_name = &lt;span class=&quot;code-quote&quot;&gt;&apos;test&apos;&lt;/span&gt; and table_name = &lt;span class=&quot;code-quote&quot;&gt;&apos;foo&apos;&lt;/span&gt;&quot;&lt;/span&gt; 2&amp;gt; /dev/&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;

export JAVA_HOME=/usr/java/jdk1.8.0_232-cloudera
export JAVA_OPTS=&lt;span class=&quot;code-quote&quot;&gt;&quot;-Xmx1g&quot;&lt;/span&gt;
export PATH=&lt;span class=&quot;code-quote&quot;&gt;&quot;/root/scala-2.13.8/bin:$JAVA_HOME/bin:$PATH&quot;&lt;/span&gt;

export CONF_DIR=/run/cloudera-scm-agent/process/79-hive_on_tez-HIVESERVER2
export CDH_HCAT_HOME=/opt/cloudera/parcels/CDH/lib/hive-hcatalog/
export CDH_HIVE_HOME=/opt/cloudera/parcels/CDH/lib/hive

CLASSPATH=&lt;span class=&quot;code-quote&quot;&gt;&quot;$CLASSPATH:$CONF_DIR/hadoop-conf&quot;&lt;/span&gt;
CLASSPATH=&lt;span class=&quot;code-quote&quot;&gt;&quot;$CLASSPATH:$CONF_DIR/hive-conf&quot;&lt;/span&gt;
CLASSPATH=&lt;span class=&quot;code-quote&quot;&gt;&quot;$CLASSPATH:$(hadoop classpath)&quot;&lt;/span&gt;
CLASSPATH=&lt;span class=&quot;code-quote&quot;&gt;&quot;$CLASSPATH:$CDH_HIVE_HOME/*&quot;&lt;/span&gt;
CLASSPATH=&lt;span class=&quot;code-quote&quot;&gt;&quot;$CLASSPATH:$CDH_HIVE_HOME/lib/*&quot;&lt;/span&gt;
CLASSPATH=&lt;span class=&quot;code-quote&quot;&gt;&quot;$CLASSPATH:${CDH_HCAT_HOME}/share/webhcat/java-client/hive-webhcat-java-client.jar&quot;&lt;/span&gt;
CLASSPATH=&lt;span class=&quot;code-quote&quot;&gt;&quot;$CLASSPATH:${CDH_HCAT_HOME}/share/hcatalog/hive-hcatalog-core.jar&quot;&lt;/span&gt;

scala -classpath $CLASSPATH &amp;lt;&amp;lt;-EOF

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hive.metastore.HiveMetaStoreClient
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hive.conf.HiveConf
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hive.metastore.api._

def go() = {
    val conf = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HiveConf()
    val client = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HiveMetaStoreClient(conf)

    val colStatData = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ColumnStatisticsData()
    colStatData.setStringStats(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringColumnStatsData(3, 3.0, 0, 1))
    val colStatsObj = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ColumnStatisticsObj(&lt;span class=&quot;code-quote&quot;&gt;&quot;col1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt;, colStatData)
    val colStatsObjs = java.util.Arrays.asList(colStatsObj)
    val colStatsDesc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ColumnStatisticsDesc(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;)
    val colStats = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ColumnStatistics(colStatsDesc, colStatsObjs)
    colStats.setEngine(&lt;span class=&quot;code-quote&quot;&gt;&quot;hive&quot;&lt;/span&gt;)

    client.updateTableColumnStatistics(colStats)
    println(&lt;span class=&quot;code-quote&quot;&gt;&quot;SUCCESS&quot;&lt;/span&gt;)
}

val t1 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;(() =&amp;gt; go())
val t2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;(() =&amp;gt; go())
t1.start()
t2.start()

t1.join()
t2.join()

go()

EOF

hive -e &lt;span class=&quot;code-quote&quot;&gt;&quot;select count(*) from sys.tab_col_stats where db_name = &lt;span class=&quot;code-quote&quot;&gt;&apos;test&apos;&lt;/span&gt; and table_name = &lt;span class=&quot;code-quote&quot;&gt;&apos;foo&apos;&lt;/span&gt;&quot;&lt;/span&gt; 2&amp;gt; /dev/&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This produces (minus logging):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[root@igansperger-hive-tgt-3 ~]# sh test.sh
+------+
| _c0  |
+------+
| 0    |
+------+

Welcome to Scala 2.13.8 (OpenJDK 64-Bit Server VM, Java 1.8.0_232).
Type in expressions &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; evaluation. Or &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; :help.

SUCCESS
SUCCESS
org.apache.hadoop.hive.metastore.api.MetaException: Unexpected 2 statistics &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 1 columns
  at org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$update_table_column_statistics_req_result$update_table_column_statistics_req_resultStandardScheme.read(ThriftHiveMetastore.java)
  at org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$update_table_column_statistics_req_result$update_table_column_statistics_req_resultStandardScheme.read(ThriftHiveMetastore.java)
  at org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$update_table_column_statistics_req_result.read(ThriftHiveMetastore.java)
  at org.apache.thrift.TServiceClient.receiveBase(TServiceClient.java:86)
  at org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$Client.recv_update_table_column_statistics_req(ThriftHiveMetastore.java:4597)
  at org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$Client.update_table_column_statistics_req(ThriftHiveMetastore.java:4584)
  at org.apache.hadoop.hive.metastore.HiveMetaStoreClient.updateTableColumnStatistics(HiveMetaStoreClient.java:2846)
  at go(&amp;lt;console&amp;gt;:13)
  ... 32 elided

scala&amp;gt;
scala&amp;gt; :quit

+------+
| _c0  |
+------+
| 2    |
+------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13425106">HIVE-25904</key>
            <summary>ObjectStore&apos;s updateTableColumnStatistics is not ThreadSafe</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkuzmenko">Denys Kuzmenko</assignee>
                                    <reporter username="dkuzmenko">Denys Kuzmenko</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 27 Jan 2022 08:50:57 +0000</created>
                <updated>Thu, 17 Nov 2022 08:48:52 +0000</updated>
                            <resolved>Wed, 23 Mar 2022 08:26:36 +0000</resolved>
                                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4800">1h 20m</timespent>
                                <comments>
                            <comment id="17511097" author="dkuzmenko" created="Wed, 23 Mar 2022 08:26:11 +0000"  >&lt;p&gt;Merged to master.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rbalamohan&quot; class=&quot;user-hover&quot; rel=&quot;rbalamohan&quot;&gt;rbalamohan&lt;/a&gt; thank you for the review!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 34 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0z040:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>