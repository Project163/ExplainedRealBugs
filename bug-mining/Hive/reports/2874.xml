<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:27:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-8719] LoadSemanticAnalyzer ignores previous partition location if inserting into partition that already exists</title>
                <link>https://issues.apache.org/jira/browse/HIVE-8719</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;LOAD DATA INSERT INTO seems to be broken currently for partitions that do not use hive&apos;s native directory structure naming scheme, thus ignoring any location previously set by an ALTER TABLE ADD PARTITION ... LOCATION ... command.&lt;/p&gt;

&lt;p&gt;Here is a simple reproducer:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;echo 1 &amp;gt; /tmp/data1.txt
hive -e &quot;create external table testpart(id int) partitioned by (date string) location &apos;/tmp/testpart&apos;;&quot;
hive -e &quot;alter table testpart add partition(date=&apos;2014-09-16&apos;)  location &apos;/tmp/testpart/20140916&apos;;&quot;
hive -e &quot;describe formatted testpart partition(date=&apos;2014-09-16&apos;) ;&quot; | egrep &apos;/tmp/testpart/(date=.?)?2014-?09-?16&apos; &amp;gt; /tmp/a
hive -e &quot;load data local inpath &apos;/tmp/data1.txt&apos; into table testpart partition(date=&apos;2014-09-16&apos;);&quot;
hive -e &quot;describe formatted testpart partition(date=&apos;2014-09-16&apos;) ;&quot; | egrep &apos;/tmp/testpart/(date=.?)?2014-?09-?16&apos; &amp;gt; /tmp/b
diff /tmp/a /tmp/b
hadoop fs -ls /tmp/testpart/
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Basically, what happens is that after the ALTER TABLE ADD PARTITION ... LOCATION, the location is &quot;/tmp/testpart/20140916&quot;. After the LOAD DATA has run, the partition location becomes &quot;/tmp/testpart/date=2014-09-16/&quot;. Any data previously present in the other location will then be ignored as well.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12752618">HIVE-8719</key>
            <summary>LoadSemanticAnalyzer ignores previous partition location if inserting into partition that already exists</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sushanth">Sushanth Sowmyan</assignee>
                                    <reporter username="sushanth">Sushanth Sowmyan</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Nov 2014 02:56:19 +0000</created>
                <updated>Tue, 1 Oct 2019 22:07:46 +0000</updated>
                            <resolved>Wed, 5 Nov 2014 07:44:02 +0000</resolved>
                                    <version>0.14.0</version>
                                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14195624" author="sushanth" created="Tue, 4 Nov 2014 02:58:26 +0000"  >&lt;p&gt;Interestingly, if I write a .q to test this, (and changing QTestUtil to not mask out the location), I do not notice this. This happens only in a deployed cluster. Thus, I do not currently have a unit test for it, but we have a trivially simple reproducer as above.&lt;/p&gt;</comment>
                            <comment id="14195626" author="sushanth" created="Tue, 4 Nov 2014 02:59:56 +0000"  >&lt;p&gt;Patch attached.&lt;/p&gt;</comment>
                            <comment id="14195627" author="sushanth" created="Tue, 4 Nov 2014 03:02:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gates&quot; class=&quot;user-hover&quot; rel=&quot;gates&quot;&gt;gates&lt;/a&gt;, could you please review/look at this? This skirts close to the territory of your Insert/Update/Delete work, and maybe you know a better way of handling this?&lt;/p&gt;</comment>
                            <comment id="14195633" author="sushanth" created="Tue, 4 Nov 2014 03:08:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hagleitn&quot; class=&quot;user-hover&quot; rel=&quot;hagleitn&quot;&gt;hagleitn&lt;/a&gt; : One more that should go in for 0.14 - this is a pretty important bug.&lt;/p&gt;</comment>
                            <comment id="14197185" author="alangates" created="Wed, 5 Nov 2014 00:08:25 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14197438" author="hagleitn" created="Wed, 5 Nov 2014 03:33:27 +0000"  >&lt;p&gt;+1 for hive 14, since this is a regression. It would still be nice to have a test.&lt;/p&gt;</comment>
                            <comment id="14197459" author="hiveqa" created="Wed, 5 Nov 2014 04:07:32 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12679129/HIVE-8719.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12679129/HIVE-8719.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 6672 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1636/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1636/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1636/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1636/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-1636/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-1636/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12679129 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14197791" author="sushanth" created="Wed, 5 Nov 2014 07:33:59 +0000"  >&lt;p&gt;If it matters, this can be tested using the HCat E2E test framework, with the following test conf addition&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;{
+      &apos;name&apos; =&amp;gt; &apos;LoadData&apos;,
+      &apos;tests&apos; =&amp;gt; [ {
+          &apos;num&apos; =&amp;gt; 1,
+          &apos;sql&apos; =&amp;gt; &quot;drop table if exists load_8719;
+                    dfs -mkdir /:HDFSTMP:/load_8719;
+                    create external table load_8719 (name string)  partitioned by (date string) location &apos;/:HDFSTMP:/load_8719&apos;;
+                    insert overwrite local directory &apos;:OUTPATH:&apos; select name from studenttab10k;
+                    alter table load_8719 add partition(date=&apos;2014-09-16&apos;) location &apos;:HDFSTMP:/load_8719/20140916&apos;;
+                    load data local inpath &apos;:OUTPATH:&apos; into table load_8719 partition(date=&apos;2014-09-16&apos;);
+                    describe formatted load_8719 partition(date=&apos;2014-09-16&apos;);&quot;,
+          &apos;cmd_fail&apos; =&amp;gt; 1, # Isn&apos;t really expected to fail, but we want to prevent benchmark generation because we aren&apos;t interested in it.
+          &apos;expected_out_regex&apos; =&amp;gt; &quot;Location:.*/load_8719/20140916&quot;,
+      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I will take on a task on another bug to try and extend the current .q test framework to be able to test this, and file a jira for that.&lt;/p&gt;</comment>
                            <comment id="14197795" author="sushanth" created="Wed, 5 Nov 2014 07:40:09 +0000"  >&lt;p&gt;Filed &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-8719&quot; title=&quot;LoadSemanticAnalyzer ignores previous partition location if inserting into partition that already exists&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-8719&quot;&gt;&lt;del&gt;HIVE-8719&lt;/del&gt;&lt;/a&gt; for that.&lt;/p&gt;</comment>
                            <comment id="14197796" author="sushanth" created="Wed, 5 Nov 2014 07:40:27 +0000"  >&lt;p&gt;Err... &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-8741&quot; title=&quot;Make changes to .q test framework to be able to test HIVE-8719&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-8741&quot;&gt;HIVE-8741&lt;/a&gt;, sorry.&lt;/p&gt;</comment>
                            <comment id="14197801" author="sushanth" created="Wed, 5 Nov 2014 07:44:02 +0000"  >&lt;p&gt;Committed to 0.14 and trunk. Thanks Alan &amp;amp; Gunther!&lt;/p&gt;</comment>
                            <comment id="14197802" author="sushanth" created="Wed, 5 Nov 2014 07:44:46 +0000"  >&lt;p&gt;(@&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=leftylev&quot; class=&quot;user-hover&quot; rel=&quot;leftylev&quot;&gt;leftylev&lt;/a&gt; : Again, a bugfix, nothing to doc here.)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12752980">HIVE-8741</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12679129" name="HIVE-8719.patch" size="2354" author="sushanth" created="Tue, 4 Nov 2014 02:59:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 3 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21xcn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>