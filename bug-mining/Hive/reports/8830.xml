<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:26:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-28909] After DataNucleus upgrade to 6.0.8 for JDK17 compatibility, there are unnecessary update queries executing by DN</title>
                <link>https://issues.apache.org/jira/browse/HIVE-28909</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;For Hive with JDK17 compile support, Data-Nucleus needed to be upgraded from 5.x to 6.x&lt;/p&gt;

&lt;p&gt;After upgrading to 6.x (specifically version 6.0.8), we observed multiple QTest failures, particularly for SELECT queries due to unexpected UPDATE statements being triggered on the COLUMNS_V2 table during read operations.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: org.apache.hadoop.hive.metastore.api.MetaException: JDOUserException: One or more instances could not be retrieved
Root cause: Error : 22848, Position : 102, Sql = UPDATE COLUMNS_V2 SET &lt;span class=&quot;code-quote&quot;&gt;&quot;COMMENT&quot;&lt;/span&gt; = :1 WHERE CD_ID=:2 AND &lt;span class=&quot;code-quote&quot;&gt;&quot;COMMENT&quot;&lt;/span&gt; = :3 AND &lt;span class=&quot;code-quote&quot;&gt;&quot;COLUMN_NAME&quot;&lt;/span&gt; = :4 AND TYPE_NAME = :5,
OriginalSql = UPDATE COLUMNS_V2 SET &lt;span class=&quot;code-quote&quot;&gt;&quot;COMMENT&quot;&lt;/span&gt; = ? WHERE CD_ID=? AND &lt;span class=&quot;code-quote&quot;&gt;&quot;COMMENT&quot;&lt;/span&gt; = ? AND &lt;span class=&quot;code-quote&quot;&gt;&quot;COLUMN_NAME&quot;&lt;/span&gt; = ? AND TYPE_NAME = ?,
Error Msg = ORA-22848: cannot use CLOB type as comparison key&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;Analysis:&lt;/b&gt;&lt;br/&gt;
&#160; &#160; When we ran a SELECT query like SELECT * FROM test_table, we noticed (via Oracle audit logs) that 18 unexpected UPDATE statements were issued on the COLUMNS_V2 table.&lt;/p&gt;

&lt;p&gt;&#160; &#160; These UPDATEs were not user-initiated, but instead triggered internally from DataNucleus, specifically during column descriptor retrieval (e.g., loading embedded elements from MColumnDescriptor).&lt;/p&gt;

&lt;p&gt;&#160; &#160; One INSERT (expected) was for the actual CREATE TABLE DDL.&lt;/p&gt;

&lt;p&gt;&#160; &#160; However, these 18 UPDATEs are redundant, as no actual column change was made &#8212; these are simply side effects of dirty state synchronization inside the JDO lifecycle.&lt;/p&gt;

&lt;p&gt;&#160; &#160;The use of CLOB columns (TYPE_NAME) in Oracle becomes problematic in such UPDATE WHERE clauses due to the following error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ORA-22848: cannot use CLOB type as comparison key&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Why This Is Not Oracle-Specific&lt;/b&gt;&lt;br/&gt;
&#160; &#160; We see the same issue in Derby (in terms of unnecessary updates), although without the CLOB-specific exception.&lt;/p&gt;

&lt;p&gt;&#160; &#160; In PostgreSQL or MySQL, the issue is not encountered because the Hive schemas use VARCHAR (STRING) instead of CLOB for these fields &#8212; and those types do support equality comparisons.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13615535">HIVE-28909</key>
            <summary>After DataNucleus upgrade to 6.0.8 for JDK17 compatibility, there are unnecessary update queries executing by DN</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gsaihemanth">Sai Hemanth Gantasala</assignee>
                                    <reporter username="kokila19">Kokila N</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 16 Apr 2025 16:02:37 +0000</created>
                <updated>Tue, 29 Jul 2025 14:51:29 +0000</updated>
                            <resolved>Fri, 23 May 2025 15:25:25 +0000</resolved>
                                                    <fixVersion>4.1.0</fixVersion>
                                    <component>Standalone Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17945283" author="ayushtkn" created="Thu, 17 Apr 2025 08:14:21 +0000"  >&lt;p&gt;cc. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Aggarwal_Raghav&quot; class=&quot;user-hover&quot; rel=&quot;Aggarwal_Raghav&quot;&gt;Aggarwal_Raghav&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=okumin&quot; class=&quot;user-hover&quot; rel=&quot;okumin&quot;&gt;okumin&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=glapark&quot; class=&quot;user-hover&quot; rel=&quot;glapark&quot;&gt;glapark&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In case you folks hit this or aware of anything or any pointers&lt;/p&gt;</comment>
                            <comment id="17945649" author="okumin" created="Fri, 18 Apr 2025 10:54:15 +0000"  >&lt;p&gt;Although I don&apos;t have any clues yet, the stack trace here is very informative.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/datanucleus/datanucleus-rdbms/issues/502&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/datanucleus/datanucleus-rdbms/issues/502&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17949387" author="okumin" created="Mon, 5 May 2025 08:20:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kokila19&quot; class=&quot;user-hover&quot; rel=&quot;kokila19&quot;&gt;kokila19&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gsaihemanth&quot; class=&quot;user-hover&quot; rel=&quot;gsaihemanth&quot;&gt;gsaihemanth&lt;/a&gt; Do we have the minimal change and unit test reproducing the issue?&lt;/p&gt;</comment>
                            <comment id="17949848" author="hemanth619" created="Tue, 6 May 2025 22:36:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=okumin&quot; class=&quot;user-hover&quot; rel=&quot;okumin&quot;&gt;okumin&lt;/a&gt; - I&apos;m still trying to reproduce a unit test for Data Nuclease folks to address this issue.&lt;/p&gt;</comment>
                            <comment id="17953508" author="JIRAUSER295901" created="Thu, 22 May 2025 16:53:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ayushtkn&quot; class=&quot;user-hover&quot; rel=&quot;ayushtkn&quot;&gt;ayushtkn&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hemanth619&quot; class=&quot;user-hover&quot; rel=&quot;hemanth619&quot;&gt;hemanth619&lt;/a&gt; , apologies for late reply. I didn&apos;t encounter this issue as we use MySql as backend DB. But I checked in 4.0.1 with and without jdk17 patches by enabling datanucleus DEBUG logs. In datanucleus 6.x, there are lot of &lt;em&gt;UPDATE `COLUMNS_V2`&lt;/em&gt; &#160; queries compared to 5.x but are not failing for MySql as per the reason mentioned in the above Jira description.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;If it helps, you can check the &lt;a href=&quot;https://github.com/Aggarwal-Raghav/rdbms-496&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/Aggarwal-Raghav/rdbms-496&lt;/a&gt; that&apos;s how i reproduced &lt;a href=&quot;https://github.com/datanucleus/datanucleus-rdbms/issues/496&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/datanucleus/datanucleus-rdbms/issues/496&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17953516" author="hemanth619" created="Thu, 22 May 2025 17:23:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Aggarwal_Raghav&quot; class=&quot;user-hover&quot; rel=&quot;Aggarwal_Raghav&quot;&gt;Aggarwal_Raghav&lt;/a&gt; - Thanks for repro. We see the same issue when we change the CLOB column type to varchar type, that COLUMNS_V2 table is being updated atleast 15 times when metadata for a table is being fetched. Let me try and repro the issue with the CLOB column (in Derby or Oracle DB).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13621582">HIVE-29039</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13619345">HIVE-28972</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            24 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ver4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>