<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:16:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-6518] Add a GC canary to the VectorGroupByOperator to flush whenever a GC is triggered</title>
                <link>https://issues.apache.org/jira/browse/HIVE-6518</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The current VectorGroupByOperator implementation flushes the in-memory hashes when the maximum entries or fraction of memory is hit.&lt;/p&gt;

&lt;p&gt;This works for most cases, but there are some corner cases where we hit GC ovehead limits or heap size limits before either of those conditions are reached due to the rest of the pipeline.&lt;/p&gt;

&lt;p&gt;This patch adds a SoftReference as a GC canary. If the soft reference is dead, then a full GC pass happened sometime in the near past &amp;amp; the aggregation hashtables should be flushed immediately before another full GC is triggered.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12697823">HIVE-6518</key>
            <summary>Add a GC canary to the VectorGroupByOperator to flush whenever a GC is triggered</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gopalv">Gopal Vijayaraghavan</assignee>
                                    <reporter username="gopalv">Gopal Vijayaraghavan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Feb 2014 23:16:35 +0000</created>
                <updated>Mon, 17 Mar 2014 18:41:09 +0000</updated>
                            <resolved>Mon, 17 Mar 2014 16:42:01 +0000</resolved>
                                    <version>0.13.0</version>
                                    <fixVersion>0.13.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13915212" author="hagleitn" created="Thu, 27 Feb 2014 23:36:46 +0000"  >&lt;p&gt;I like it. Sounds like this will allow you to be more aggressive with caching/flushing params, while having a trigger that will flush out stuff when necessary.&lt;/p&gt;

&lt;p&gt;+1 (assuming tests pass)&lt;/p&gt;</comment>
                            <comment id="13915238" author="gopalv" created="Fri, 28 Feb 2014 00:00:45 +0000"  >&lt;p&gt;Yes, also the ORC scenario is more complex for strings in dictionaries. &lt;/p&gt;

&lt;p&gt;A substring does not drop the rest of the data off the memory overhead because in vectorized mode, only the start:len get modified, no new allocations are made.&lt;/p&gt;

&lt;p&gt;So a group by SUBSTR() will keep the entire string in  memory, except the VGBY does not know that it does.&lt;/p&gt;</comment>
                            <comment id="13916282" author="rusanu" created="Fri, 28 Feb 2014 19:57:04 +0000"  >&lt;p&gt;Can you somehow modify the LOG.debug at top of flush() to call out that the flush was triggered by the gcCanary.get() == null? I was thinking: keep a count of gcCanary allocations and print it in the LOG.debug message, this will tell us if the GC is the trigger and also will tell how often has occured in the operator lifetime, when debugging etc.&lt;br/&gt;
+1&lt;/p&gt;</comment>
                            <comment id="13916590" author="gopalv" created="Fri, 28 Feb 2014 23:42:26 +0000"  >&lt;p&gt;Add DEBUG lines&lt;/p&gt;</comment>
                            <comment id="13917289" author="hagleitn" created="Sun, 2 Mar 2014 05:02:08 +0000"  >&lt;p&gt;Reuploading .2 for precommit.&lt;/p&gt;</comment>
                            <comment id="13926289" author="gopalv" created="Mon, 10 Mar 2014 21:53:02 +0000"  >&lt;p&gt;Resubmit for pre-commit tests&lt;/p&gt;</comment>
                            <comment id="13933015" author="hagleitn" created="Thu, 13 Mar 2014 08:53:42 +0000"  >&lt;p&gt;pre-commit is back. let&apos;s try again.&lt;/p&gt;</comment>
                            <comment id="13934667" author="hiveqa" created="Fri, 14 Mar 2014 06:09:57 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12634401/HIVE-6518.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12634401/HIVE-6518.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 2 failed/errored test(s), 5389 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_auto_sortmerge_join_16
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_bucketmapjoin6
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/1769/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/1769/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/1769/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/1769/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12634401&lt;/p&gt;</comment>
                            <comment id="13935444" author="gopalv" created="Fri, 14 Mar 2014 18:52:29 +0000"  >&lt;p&gt;The test failures don&apos;t seem to be related to this fix - they aren&apos;t vectorized.&lt;/p&gt;</comment>
                            <comment id="13938007" author="jnp" created="Mon, 17 Mar 2014 16:42:01 +0000"  >&lt;p&gt;I have committed this trunk. Thanks to Gopal!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhbutani&quot; class=&quot;user-hover&quot; rel=&quot;rhbutani&quot;&gt;rhbutani&lt;/a&gt; This is an important fix to vector group by because the aggregates must flush more aggressively in case of GC. Therefore, I intend to commit it to branch-0.13. as well.&lt;/p&gt;</comment>
                            <comment id="13938056" author="rhbutani" created="Mon, 17 Mar 2014 17:13:04 +0000"  >&lt;p&gt;+1 for port to 0.13&lt;/p&gt;</comment>
                            <comment id="13938186" author="jnp" created="Mon, 17 Mar 2014 18:41:09 +0000"  >&lt;p&gt;Committed to branch-0.13 as well. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12631621" name="HIVE-6518.1-tez.patch" size="1829" author="gopalv" created="Thu, 27 Feb 2014 23:23:58 +0000"/>
                            <attachment id="12631872" name="HIVE-6518.2-tez.patch" size="3023" author="gopalv" created="Fri, 28 Feb 2014 23:42:26 +0000"/>
                            <attachment id="12631991" name="HIVE-6518.2.patch" size="3023" author="hagleitn" created="Sun, 2 Mar 2014 05:02:08 +0000"/>
                            <attachment id="12634401" name="HIVE-6518.3.patch" size="3023" author="hagleitn" created="Thu, 13 Mar 2014 08:53:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>376297</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 36 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1sudb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>376593</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Flush VectorGroupBy aggregation hashes in case of a full GC</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>