<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:26:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-28934] PlanUtils.configureJobPropertiesForStorageHandler should use hive session configuration</title>
                <link>https://issues.apache.org/jira/browse/HIVE-28934</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Using&#160;&lt;tt&gt;Hive.get().getConf()&lt;/tt&gt; to get &lt;tt&gt;HiveConf&lt;/tt&gt; leads to Hive instantiation with default configuration.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13616607">HIVE-28934</key>
            <summary>PlanUtils.configureJobPropertiesForStorageHandler should use hive session configuration</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vrozov">Vlad Rozov</assignee>
                                    <reporter username="vrozov">Vlad Rozov</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 28 Apr 2025 16:21:31 +0000</created>
                <updated>Tue, 29 Jul 2025 14:52:00 +0000</updated>
                            <resolved>Tue, 6 May 2025 15:08:24 +0000</resolved>
                                    <version>4.0.0</version>
                                    <fixVersion>4.1.0</fixVersion>
                                    <component>Query Planning</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17949752" author="simhadri-g" created="Tue, 6 May 2025 15:08:24 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vrozov&quot; class=&quot;user-hover&quot; rel=&quot;vrozov&quot;&gt;vrozov&lt;/a&gt; for the PR !&lt;/p&gt;</comment>
                            <comment id="17951032" author="dkuzmenko" created="Mon, 12 May 2025 18:28:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vrozov&quot; class=&quot;user-hover&quot; rel=&quot;vrozov&quot;&gt;vrozov&lt;/a&gt;, why did you change `fallbackToNonVectorizedModeBasedOnProperties` to&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

Hive.get(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;).getConf().setBoolVar(ConfVars.HIVE_VECTORIZATION_ENABLED, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)&#160;

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17951050" author="vrozov" created="Mon, 12 May 2025 20:10:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dkuzmenko&quot; class=&quot;user-hover&quot; rel=&quot;dkuzmenko&quot;&gt;dkuzmenko&lt;/a&gt; Please see the PR. The change was necessary to keep vectorized mode disabled.&lt;/p&gt;</comment>
                            <comment id="17951205" author="dkuzmenko" created="Tue, 13 May 2025 14:30:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vrozov&quot; class=&quot;user-hover&quot; rel=&quot;vrozov&quot;&gt;vrozov&lt;/a&gt; could you clarify the purpose of this change?&#160;&lt;/p&gt;

&lt;p&gt;`&lt;tt&gt;Hive.get()`&lt;/tt&gt; was removed from one place: `PlanUtils.configureJobPropertiesForStorageHandler()`, but added in another: `HiveIcebergStorageHandler&lt;a href=&quot;https://github.com/apache/hive/pull/5788/files#diff-93864ecf035fe51b92185015da842a56837cea89064813de39c278c6f8fed03c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;.&lt;/a&gt;fallbackToNonVectorizedModeBasedOnProperties`.&lt;/p&gt;

&lt;p&gt;Since there are no accompanying tests, I assume this isn&apos;t a correctness fix but rather an optimization?&lt;/p&gt;

&lt;p&gt;PR states that &quot;Creating new instance of &lt;tt&gt;Hive&lt;/tt&gt; is a heavy weight operation&quot;.&lt;/p&gt;</comment>
                            <comment id="17951218" author="vrozov" created="Tue, 13 May 2025 15:42:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dkuzmenko&quot; class=&quot;user-hover&quot; rel=&quot;dkuzmenko&quot;&gt;dkuzmenko&lt;/a&gt; The purpose of the change is to use &lt;tt&gt;conf&lt;/tt&gt; from Hive session the same way how it is used in &lt;tt&gt;PlanUitls.java&lt;/tt&gt;. It is both correctness fix and optimization. The fix relies on existing tests.&lt;/p&gt;

&lt;p&gt;Will it be better to continue discussion on the PR? Discussing code changes in JIRA is less convenient, IMO.&lt;/p&gt;</comment>
                            <comment id="17951222" author="simhadri-g" created="Tue, 13 May 2025 15:56:03 +0000"  >&lt;p&gt;hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dkuzmenko&quot; class=&quot;user-hover&quot; rel=&quot;dkuzmenko&quot;&gt;dkuzmenko&lt;/a&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;The existing iceberg tests&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; started to fail without the changes in fallbackToNonVectorizedModeBasedOnProperties . With the following exception for some of the tests.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.RuntimeException: java.io.IOException: java.lang.IllegalArgumentException: Vectorized execution is not yet supported for Iceberg avro tables. Please turn off vectorization and retry the query.
at org.apache.hadoop.hive.ql.exec.tez.TezProcessor.initializeAndRunProcessor(TezProcessor.java:348)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://ci.hive.apache.org/blue/organizations/jenkins/hive-precommit/detail/PR-5788/1/tests&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci.hive.apache.org/blue/organizations/jenkins/hive-precommit/detail/PR-5788/1/tests&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17951259" author="dkuzmenko" created="Tue, 13 May 2025 18:21:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vrozov&quot; class=&quot;user-hover&quot; rel=&quot;vrozov&quot;&gt;vrozov&lt;/a&gt; if that&apos;s a correctness fix, where are the tests? Existing tests didn&apos;t catch the problem.&lt;/p&gt;

&lt;p&gt;Reg the optimization, where do we save anything if we call the same `Hive.get()` lower in the call chain, maybe I am missing something?&lt;/p&gt;

&lt;p&gt;PR is closed, so I thought we could keep the discussion in JIRA.&lt;/p&gt;</comment>
                            <comment id="17951268" author="vrozov" created="Tue, 13 May 2025 19:09:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dkuzmenko&quot; class=&quot;user-hover&quot; rel=&quot;dkuzmenko&quot;&gt;dkuzmenko&lt;/a&gt; comments can be posted on a closed PR as well.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;if that&apos;s a correctness fix, where are the tests? Existing tests didn&apos;t catch the problem.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I faced problem with incorrect &lt;tt&gt;conf&lt;/tt&gt; &#160;while calling the subject API from Spark.&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Reg the optimization, where do we save anything if we call the same `Hive.get()` lower in the call chain, maybe I am missing something?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The call to &lt;tt&gt;Hive.get()&lt;/tt&gt; is only done for specific storage handler and will be later removed once vectorization support is in place, right?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17951281" author="dkuzmenko" created="Tue, 13 May 2025 20:28:38 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TaskCompiler {
&#160; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void init(QueryState queryState, LogHelper console, Hive db) {
&#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.conf = queryState.getConf();
&#160; }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;A better way to do it would be&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SessionStateUtil.getQueryState(conf).ifPresent(queryState -&amp;gt;
    queryState.getConf().setBoolVar(ConfVars.HIVE_VECTORIZATION_ENABLED, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I&apos;ll fix it in a follow-up PR.&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vrozov&quot; class=&quot;user-hover&quot; rel=&quot;vrozov&quot;&gt;vrozov&lt;/a&gt; would be great if you could explain Spark repro in more details so we could create a test based on that.&lt;/p&gt;</comment>
                            <comment id="17951292" author="vrozov" created="Tue, 13 May 2025 22:03:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dkuzmenko&quot; class=&quot;user-hover&quot; rel=&quot;dkuzmenko&quot;&gt;dkuzmenko&lt;/a&gt; Possibly that would be a better fix. My goal was to fix CI and as I changed &lt;tt&gt;conf&lt;/tt&gt; that is passed to the storage handler from &lt;tt&gt;Hive.get()&lt;/tt&gt; to Hive session &lt;tt&gt;conf&lt;/tt&gt;, I used code from &lt;tt&gt;PlanUtils.java&lt;/tt&gt; in &lt;tt&gt;HiveIcebergStorageHandler.fallbackToNonVectorizedModeBasedOnProperties&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Spark calls &lt;tt&gt;configureJobPropertiesForStorageHandler&lt;/tt&gt; using Hive session with modified &lt;tt&gt;conf&lt;/tt&gt; and it was not taking effect in ORC if I remember correctly. I&apos;ll try to recollect the exact use case, but don&apos;t have it handy now.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1vldc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>