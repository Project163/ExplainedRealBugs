<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:23:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-26652] HiveSortPullUpConstantsRule produces an invalid plan when pulling up constants for nullable fields</title>
                <link>https://issues.apache.org/jira/browse/HIVE-26652</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The rule pulls up constants without checking/adjusting nullability to match that of the field type.&lt;/p&gt;

&lt;p&gt;Here is the stack-trace when a nullable type is involved:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.AssertionError: type mismatch:
ref:
JavaType(&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;java.lang.&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;)
input:
JavaType(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) NOT NULL&#160; &#160; at org.apache.calcite.util.Litmus$1.fail(Litmus.java:31)
&#160; &#160; at org.apache.calcite.plan.RelOptUtil.eq(RelOptUtil.java:2167)
&#160; &#160; at org.apache.calcite.rex.RexChecker.visitInputRef(RexChecker.java:125)
&#160; &#160; at org.apache.calcite.rex.RexChecker.visitInputRef(RexChecker.java:57)
&#160; &#160; at org.apache.calcite.rex.RexInputRef.accept(RexInputRef.java:112)
&#160; &#160; at org.apache.calcite.rel.core.Project.isValid(Project.java:215)
&#160; &#160; at org.apache.calcite.rel.core.Project.&amp;lt;init&amp;gt;(Project.java:94)
&#160; &#160; at org.apache.calcite.rel.core.Project.&amp;lt;init&amp;gt;(Project.java:100)
&#160; &#160; at org.apache.hadoop.hive.ql.optimizer.calcite.reloperators.HiveProject.&amp;lt;init&amp;gt;(HiveProject.java:58)
&#160; &#160; at org.apache.hadoop.hive.ql.optimizer.calcite.reloperators.HiveProject.copy(HiveProject.java:106)
&#160; &#160; at org.apache.calcite.rel.core.Project.copy(Project.java:126)
&#160; &#160; at org.apache.hadoop.hive.ql.optimizer.calcite.rules.HiveSortPullUpConstantsRule$HiveSortPullUpConstantsRuleBase.onMatch(HiveSortPullUpConstantsRule.java:195)
&#160; &#160; at org.apache.calcite.plan.AbstractRelOptPlanner.fireRule(AbstractRelOptPlanner.java:333)
&#160; &#160; at org.apache.calcite.plan.hep.HepPlanner.applyRule(HepPlanner.java:542)
&#160; &#160; at org.apache.calcite.plan.hep.HepPlanner.applyRules(HepPlanner.java:407)
&#160; &#160; at org.apache.calcite.plan.hep.HepPlanner.executeInstruction(HepPlanner.java:243)
&#160; &#160; at org.apache.calcite.plan.hep.HepInstruction$RuleInstance.execute(HepInstruction.java:127)
&#160; &#160; at org.apache.calcite.plan.hep.HepPlanner.executeProgram(HepPlanner.java:202)
&#160; &#160; at org.apache.calcite.plan.hep.HepPlanner.findBestExp(HepPlanner.java:189)
&#160; &#160; at org.apache.hadoop.hive.ql.optimizer.calcite.rules.TestHiveSortExchangePullUpConstantsRule.test(TestHiveSortExchangePullUpConstantsRule.java:104)
&#160; &#160; at org.apache.hadoop.hive.ql.optimizer.calcite.rules.TestHiveSortExchangePullUpConstantsRule.testNullableFields(TestHiveSortExchangePullUpConstantsRule.java:156)
&#160; &#160; at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
&#160; &#160; at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
&#160; &#160; at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
&#160; &#160; at java.lang.reflect.Method.invoke(Method.java:498)
&#160; &#160; at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
&#160; &#160; at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
&#160; &#160; at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
&#160; &#160; at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
&#160; &#160; at org.mockito.internal.runners.DefaultInternalRunner$1$1.evaluate(DefaultInternalRunner.java:54)
&#160; &#160; at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
&#160; &#160; at org.junit.runners.BlockJUnit4ClassRunner$1.evaluate(BlockJUnit4ClassRunner.java:100)
&#160; &#160; at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
&#160; &#160; at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:103)
&#160; &#160; at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:63)
&#160; &#160; at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
&#160; &#160; at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
&#160; &#160; at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
&#160; &#160; at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
&#160; &#160; at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
&#160; &#160; at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
&#160; &#160; at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
&#160; &#160; at org.mockito.internal.runners.DefaultInternalRunner$1.run(DefaultInternalRunner.java:99)
&#160; &#160; at org.mockito.internal.runners.DefaultInternalRunner.run(DefaultInternalRunner.java:105)
&#160; &#160; at org.mockito.internal.runners.StrictRunner.run(StrictRunner.java:40)
&#160; &#160; at org.mockito.junit.MockitoJUnitRunner.run(MockitoJUnitRunner.java:163)
&#160; &#160; at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
&#160; &#160; at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
&#160; &#160; at com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38)
&#160; &#160; at com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11)
&#160; &#160; at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35)
&#160; &#160; at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:235)
&#160; &#160; at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:54) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The solution is to check nullability and add a cast when the field is nullable, since the constant&apos;s type is not.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13487105">HIVE-26652</key>
            <summary>HiveSortPullUpConstantsRule produces an invalid plan when pulling up constants for nullable fields</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="asolimando">Alessandro Solimando</assignee>
                                    <reporter username="asolimando">Alessandro Solimando</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 19 Oct 2022 15:02:23 +0000</created>
                <updated>Wed, 16 Nov 2022 13:50:28 +0000</updated>
                            <resolved>Mon, 24 Oct 2022 14:35:43 +0000</resolved>
                                    <version>4.0.0-alpha-2</version>
                                    <fixVersion>4.0.0-alpha-2</fixVersion>
                                    <component>CBO</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="17621777" author="zabetak" created="Fri, 21 Oct 2022 07:31:44 +0000"  >&lt;p&gt;I cleared the fixVersion field since this ticket is not resolved. Please review this ticket and if the fix is already committed to a specific version please set the version accordingly and mark the ticket as RESOLVED.&lt;/p&gt;

&lt;p&gt;According to the JIRA guidelines (&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/HowToContribute&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/Hive/HowToContribute&lt;/a&gt;) the fixVersion should be set only when the issue is resolved/closed.&lt;/p&gt;</comment>
                            <comment id="17623222" author="kkasa" created="Mon, 24 Oct 2022 14:35:43 +0000"  >&lt;p&gt;Merged to master. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=asolimando&quot; class=&quot;user-hover&quot; rel=&quot;asolimando&quot;&gt;asolimando&lt;/a&gt; for the patch.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13486633">HIVE-26643</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 3 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z19i6w:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>