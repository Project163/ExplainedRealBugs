<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:23:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-26320] Incorrect results for IN UDF on Parquet column of CHAR/VARCHAR type</title>
                <link>https://issues.apache.org/jira/browse/HIVE-26320</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Query involving case statement with two or more conditions leads to incorrect result for tables with parquet format, The problem is not observed with ORC or TextFile.&lt;/p&gt;


&lt;p&gt;&lt;b&gt;Steps to reproduce&lt;/b&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
create external table case_test_parquet(kob varchar(2),enhanced_type_code &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) stored as parquet;
insert into case_test_parquet values(&lt;span class=&quot;code-quote&quot;&gt;&apos;BB&apos;&lt;/span&gt;,18),(&lt;span class=&quot;code-quote&quot;&gt;&apos;BC&apos;&lt;/span&gt;,18),(&lt;span class=&quot;code-quote&quot;&gt;&apos;AB&apos;&lt;/span&gt;,18);

select &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; when (
                   (kob=&lt;span class=&quot;code-quote&quot;&gt;&apos;BB&apos;&lt;/span&gt; and enhanced_type_code=&lt;span class=&quot;code-quote&quot;&gt;&apos;18&apos;&lt;/span&gt;)
                   or (kob=&lt;span class=&quot;code-quote&quot;&gt;&apos;BC&apos;&lt;/span&gt; and enhanced_type_code=&lt;span class=&quot;code-quote&quot;&gt;&apos;18&apos;&lt;/span&gt;)
                 )
            then 1
            &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; 0
        end as logic_check
from case_test_parquet;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Result:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
0
0
0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Expected result:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
1
1
0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem does not appear when setting hive.optimize.point.lookup=false.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13449824">HIVE-26320</key>
            <summary>Incorrect results for IN UDF on Parquet column of CHAR/VARCHAR type</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jfs">John Sherman</assignee>
                                    <reporter username="chiran54321">Chiran Ravani</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 13 Jun 2022 14:45:20 +0000</created>
                <updated>Wed, 16 Nov 2022 13:50:17 +0000</updated>
                            <resolved>Mon, 3 Oct 2022 11:07:44 +0000</resolved>
                                    <version>4.0.0-alpha-1</version>
                                    <fixVersion>4.0.0-alpha-2</fixVersion>
                                    <component>HiveServer2</component>
                    <component>Query Planning</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="18000">5h</timespent>
                                <comments>
                            <comment id="17554057" author="zabetak" created="Tue, 14 Jun 2022 11:46:55 +0000"  >&lt;p&gt;Thanks for reporting this issue &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chiran54321&quot; class=&quot;user-hover&quot; rel=&quot;chiran54321&quot;&gt;chiran54321&lt;/a&gt; . Have you checked if the query plan is the same for Parquet, ORC, and textfile? This would allow to narrow down where the problem is: compilation vs execution. Based on the current description it seems that it is most likely on the execution side but it would be nice to clarify this.&lt;/p&gt;</comment>
                            <comment id="17554115" author="chiran54321" created="Tue, 14 Jun 2022 13:56:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zabetak&quot; class=&quot;user-hover&quot; rel=&quot;zabetak&quot;&gt;zabetak&lt;/a&gt; Apologies, I forgot to mention that explain appears to be same for ORC vs Parquet table. Sharing the explain extended and results for query reported in description with table type parquet vs orc.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Parquet&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+----------------------------------------------------+
|                      Explain                       |
+----------------------------------------------------+
| OPTIMIZED SQL: SELECT CAST(CASE WHEN ROW(`kob`, `enhanced_type_code`) IN (ROW(&lt;span class=&quot;code-quote&quot;&gt;&apos;BB&apos;&lt;/span&gt;, 18), ROW(&lt;span class=&quot;code-quote&quot;&gt;&apos;BC&apos;&lt;/span&gt;, 18)) THEN 1 ELSE 0 END AS INTEGER) AS `logic_check` |
| FROM `ascend_lite`.`case_test_parquet`             |
| STAGE DEPENDENCIES:                                |
|   Stage-0 is a root stage                          |
|                                                    |
| STAGE PLANS:                                       |
|   Stage: Stage-0                                   |
|     Fetch Operator                                 |
|       limit: -1                                    |
|       Processor Tree:                              |
|         TableScan                                  |
|           alias: case_test_parquet                 |
|           GatherStats: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;                       |
|           Select Operator                          |
|             expressions: CASE WHEN ((struct(kob,enhanced_type_code)) IN (&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; struct(&lt;span class=&quot;code-quote&quot;&gt;&apos;BB&apos;&lt;/span&gt;,18), &lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; struct(&lt;span class=&quot;code-quote&quot;&gt;&apos;BC&apos;&lt;/span&gt;,18))) THEN (1) ELSE (0) END (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) |
|             outputColumnNames: _col0               |
|             ListSink                               |
|                                                    |
+----------------------------------------------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Results&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
INFO  : Compiling command(queryId=hive_20220614134848_0c726af4-d554-4cbf-b3be-0573cbf39125): select &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; when (
(kob=&lt;span class=&quot;code-quote&quot;&gt;&apos;BB&apos;&lt;/span&gt; and enhanced_type_code=&lt;span class=&quot;code-quote&quot;&gt;&apos;18&apos;&lt;/span&gt;)
or (kob=&lt;span class=&quot;code-quote&quot;&gt;&apos;BC&apos;&lt;/span&gt; and enhanced_type_code=&lt;span class=&quot;code-quote&quot;&gt;&apos;18&apos;&lt;/span&gt;)
)
then 1
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; 0
end as logic_check
from case_test_parquet
INFO  : Semantic Analysis Completed (retrial = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
INFO  : Created Hive schema: Schema(fieldSchemas:[FieldSchema(name:logic_check, type:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, comment:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)], properties:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
INFO  : Completed compiling command(queryId=hive_20220614134848_0c726af4-d554-4cbf-b3be-0573cbf39125); Time taken: 0.15 seconds
INFO  : Executing command(queryId=hive_20220614134848_0c726af4-d554-4cbf-b3be-0573cbf39125): select &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; when (
(kob=&lt;span class=&quot;code-quote&quot;&gt;&apos;BB&apos;&lt;/span&gt; and enhanced_type_code=&lt;span class=&quot;code-quote&quot;&gt;&apos;18&apos;&lt;/span&gt;)
or (kob=&lt;span class=&quot;code-quote&quot;&gt;&apos;BC&apos;&lt;/span&gt; and enhanced_type_code=&lt;span class=&quot;code-quote&quot;&gt;&apos;18&apos;&lt;/span&gt;)
)
then 1
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; 0
end as logic_check
from case_test_parquet
INFO  : Completed executing command(queryId=hive_20220614134848_0c726af4-d554-4cbf-b3be-0573cbf39125); Time taken: 0.006 seconds
INFO  : OK
+--------------+
| logic_check  |
+--------------+
| 0            |
| 0            |
| 0            |
+--------------+
3 rows selected (0.56 seconds)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;ORC&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+----------------------------------------------------+
|                      Explain                       |
+----------------------------------------------------+
| OPTIMIZED SQL: SELECT CAST(CASE WHEN ROW(`kob`, `enhanced_type_code`) IN (ROW(&lt;span class=&quot;code-quote&quot;&gt;&apos;BB&apos;&lt;/span&gt;, 18), ROW(&lt;span class=&quot;code-quote&quot;&gt;&apos;BC&apos;&lt;/span&gt;, 18)) THEN 1 ELSE 0 END AS INTEGER) AS `logic_check` |
| FROM `ascend_lite`.`case_test_orc`                 |
| STAGE DEPENDENCIES:                                |
|   Stage-0 is a root stage                          |
|                                                    |
| STAGE PLANS:                                       |
|   Stage: Stage-0                                   |
|     Fetch Operator                                 |
|       limit: -1                                    |
|       Processor Tree:                              |
|         TableScan                                  |
|           alias: case_test_orc                     |
|           GatherStats: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;                       |
|           Select Operator                          |
|             expressions: CASE WHEN ((struct(kob,enhanced_type_code)) IN (&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; struct(&lt;span class=&quot;code-quote&quot;&gt;&apos;BB&apos;&lt;/span&gt;,18), &lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; struct(&lt;span class=&quot;code-quote&quot;&gt;&apos;BC&apos;&lt;/span&gt;,18))) THEN (1) ELSE (0) END (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) |
|             outputColumnNames: _col0               |
|             ListSink                               |
|                                                    |
+----------------------------------------------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Results:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
INFO  : Compiling command(queryId=hive_20220614134807_2ae11d4a-34bd-4c68-a5c0-b36cc0bbe350): select &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; when (
(kob=&lt;span class=&quot;code-quote&quot;&gt;&apos;BB&apos;&lt;/span&gt; and enhanced_type_code=&lt;span class=&quot;code-quote&quot;&gt;&apos;18&apos;&lt;/span&gt;)
or (kob=&lt;span class=&quot;code-quote&quot;&gt;&apos;BC&apos;&lt;/span&gt; and enhanced_type_code=&lt;span class=&quot;code-quote&quot;&gt;&apos;18&apos;&lt;/span&gt;)
)
then 1
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; 0
end as logic_check
from case_test_orc
INFO  : Semantic Analysis Completed (retrial = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
INFO  : Created Hive schema: Schema(fieldSchemas:[FieldSchema(name:logic_check, type:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, comment:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)], properties:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
INFO  : Completed compiling command(queryId=hive_20220614134807_2ae11d4a-34bd-4c68-a5c0-b36cc0bbe350); Time taken: 0.161 seconds
INFO  : Executing command(queryId=hive_20220614134807_2ae11d4a-34bd-4c68-a5c0-b36cc0bbe350): select &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; when (
(kob=&lt;span class=&quot;code-quote&quot;&gt;&apos;BB&apos;&lt;/span&gt; and enhanced_type_code=&lt;span class=&quot;code-quote&quot;&gt;&apos;18&apos;&lt;/span&gt;)
or (kob=&lt;span class=&quot;code-quote&quot;&gt;&apos;BC&apos;&lt;/span&gt; and enhanced_type_code=&lt;span class=&quot;code-quote&quot;&gt;&apos;18&apos;&lt;/span&gt;)
)
then 1
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; 0
end as logic_check
from case_test_orc
INFO  : Completed executing command(queryId=hive_20220614134807_2ae11d4a-34bd-4c68-a5c0-b36cc0bbe350); Time taken: 0.006 seconds
INFO  : OK
+--------------+
| logic_check  |
+--------------+
| 1            |
| 1            |
| 0            |
+--------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17555159" author="zabetak" created="Thu, 16 Jun 2022 15:57:09 +0000"  >&lt;p&gt;Thanks for the feedback &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chiran54321&quot; class=&quot;user-hover&quot; rel=&quot;chiran54321&quot;&gt;chiran54321&lt;/a&gt; ! It may worth also checking &lt;tt&gt;EXPLAIN VECTORIZATION DETAIL&lt;/tt&gt; since I remember in the past some differences between vectorization for ORC, PARQUET, and other formats.&lt;/p&gt;</comment>
                            <comment id="17568248" author="jfs" created="Mon, 18 Jul 2022 23:51:50 +0000"  >&lt;p&gt;I&apos;ll play around with this some more. I had missed the detail about ORC/Text working but not Parquet. My patch does fix it for parquet, but I would like to know why ORC/Text file just worked? Maybe different handling of varchar/char/string for the types in at the SerDe level?&lt;/p&gt;</comment>
                            <comment id="17610300" author="jfs" created="Tue, 27 Sep 2022 23:44:09 +0000"  >&lt;p&gt;So digging into this - the root cause seems to be that the Parquet SerDe will return STRING/Text types for CHAR and VARCHAR.&lt;br/&gt;
The code in GenericUDFIn creates a Set&amp;lt;&amp;gt; containing the constant part of the IN clause which also includes the correct types.&lt;/p&gt;

&lt;p&gt;So the constant IN Set&amp;lt;&amp;gt; would have entries like:&lt;br/&gt;
struct&amp;lt;kob varchar(2),enhanced_type_code int&amp;gt; which is basically a List containing a HiveVarcharWritable and an IntWritable.&lt;/p&gt;

&lt;p&gt;The Parquet reader seems to produce:&lt;br/&gt;
struct&amp;lt;kob String, enhanced_type_code int&amp;gt; which is basically a List containing a Text and a IntWritable.&lt;/p&gt;

&lt;p&gt;So the constant IN set doesn&apos;t match the rows produced due to the types being different.&lt;br/&gt;
I could likely fix this for the GenericUDFIn case - but I suspect there are other areas in which this type difference causes different results. So I&apos;ve attempted to fix this at the SerDe deserialization level by converting the row data from PARQUET to the appropriate types (if needed).&lt;/p&gt;

&lt;p&gt;I am a bit concerned with if this has performance implication,&#160; though I am hoping the conversion between the string types are relatively low overhead.&lt;/p&gt;

&lt;p&gt;I&apos;ve posted a WIP patch to see how it does on tests and I will likely investigate a couple of other areas.&lt;/p&gt;</comment>
                            <comment id="17610984" author="zabetak" created="Thu, 29 Sep 2022 11:53:21 +0000"  >&lt;p&gt;The Parquet format specification does not offer bounded character data types so max length cannot be enforced at storage level. The best that Hive can do (and what actually does) is pick the STRING &lt;a href=&quot;https://github.com/apache/parquet-format/blob/master/LogicalTypes.md#string&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;logical type&lt;/a&gt; for the actual storage. When storing data to the Parquet file (with Hive or other tools writing directly into Parquet) we can easily end up with arbitrarily long strings. &lt;/p&gt;

&lt;p&gt;The Hive DDL command allows to declare character types with maximum length but for Parquet storage handler this seems to be more like a hint for the compiler rather than a constraint as it should be. When we write data exclusively with Hive we can probably enforce the max len constraint, and may we do in some places but we cannot control what other (external) writers can do (since we are talking about an external table). Anyways if the DDL says that we have a len constraint I guess nobody will blame us/Hive if we fail miserably while reading data that do not conform to the definition.&lt;/p&gt;

&lt;p&gt;Maybe it would be a good idea to advise people to use only the STRING datatype in the DDL for Parquet but since we claim to support char/varchar types (&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-7735&quot; title=&quot;Implement Char, Varchar in ParquetSerDe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-7735&quot;&gt;&lt;del&gt;HIVE-7735&lt;/del&gt;&lt;/a&gt;) it is a bit too late to do it now.&lt;/p&gt;

&lt;p&gt;Parquet reader gives back a &lt;tt&gt;Text&lt;/tt&gt; instead of &lt;tt&gt;HiveVarcharWritable&lt;/tt&gt; probably due to the fact that there are no length limitations in the format itself. The code responsible for this is the &lt;a href=&quot;https://github.com/apache/hive/blob/c19d56ec7429bfcfad92b62ac335dbf8177dab24/ql/src/java/org/apache/hadoop/hive/ql/io/parquet/convert/ETypeConverter.java#L488&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ETypeConverter&lt;/a&gt; and observe that at this point we don&apos;t care much about what the actual DDL type is (we have it in hiveTypeInfo) but we simply take the binary data from Parquet and wrap it in a &lt;tt&gt;Text&lt;/tt&gt; object. &lt;/p&gt;

&lt;p&gt;I guess if we want to change the way that Parquet is deserialized we probably have to do it inside the &lt;tt&gt;ETypeConverter&lt;/tt&gt;. There we have the actual DDL type and if we do it at this level we avoid the performance overhead of multiple conversions. Plus other type conversions to HiveXX objects also take place in this class so it seems like the right place. We can construct a &lt;tt&gt;HiveVarcharWritable&lt;/tt&gt; at this level but as I said before if the data do not conform to the max len then most likely we are going truncate them silently.&lt;/p&gt;

&lt;p&gt;Now considering the other angle that John mentioned, it may also make sense fixing it at the &lt;tt&gt;GenericUDFIn&lt;/tt&gt; level. The fact that the query below works fine, while the query in the summary does not, indicates that there is specific code handling structs vs simple columns in the function itself and somewhat it is problematic. I strongly suspect that the object that comes from Parquet is still a &lt;tt&gt;Text&lt;/tt&gt; but somehow there is conversion code in the function that it handles it successfully when it is not in a struct. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;when&lt;/span&gt; (kob=&lt;span class=&quot;code-quote&quot;&gt;&apos;BB&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;or&lt;/span&gt; kob=&lt;span class=&quot;code-quote&quot;&gt;&apos;BC&apos;&lt;/span&gt; )
            &lt;span class=&quot;code-keyword&quot;&gt;then&lt;/span&gt; 1
            &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; 0
        &lt;span class=&quot;code-keyword&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; logic_check
&lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; case_test_parquet;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17611012" author="jfs" created="Thu, 29 Sep 2022 12:41:33 +0000"  >&lt;p&gt;I think it feels more correct to investigate the ETypeConverter change, since it feels like it is at the root of the issue rather than fixing the issue at the symptom level (but the change could have wide effect and may uncover different issues). As far as the GenericUDFIn and why it works with non struct vs varchar, it is due to:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hive/blob/master/ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDFIn.java#L159&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/blob/master/ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDFIn.java#L159&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; PRIMITIVE: {
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; arg = ((PrimitiveObjectInspector) compareOI)
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .getPrimitiveJavaObject(conversionHelper.convertIfNecessary(arguments[0].get(),
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; argumentOIs[0]));
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (compareOI.getTypeName().equals(serdeConstants.BINARY_TYPE_NAME)) {
&#160; &#160; &#160; &#160; &#160; arg = ByteBuffer.wrap((&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]) arg);
&#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (constantInSet.contains(arg)) {
&#160; &#160; &#160; &#160; &#160; bw.set(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
&#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; bw;
&#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
&#160; &#160; &#160; } &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The getPrimitiveJavaObject will end up convert Text to the appropriate type - as shown here for HiveVarchar.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/hive/blob/c19d56ec7429bfcfad92b62ac335dbf8177dab24/serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/primitive/WritableHiveVarcharObjectInspector.java#L48&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/blob/c19d56ec7429bfcfad92b62ac335dbf8177dab24/serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/primitive/WritableHiveVarcharObjectInspector.java#L48&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;However, structs are handled here:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/hive/blob/c19d56ec7429bfcfad92b62ac335dbf8177dab24/ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDFIn.java#L186&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/blob/c19d56ec7429bfcfad92b62ac335dbf8177dab24/ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDFIn.java#L186&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; STRUCT: {
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; value;
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (argumentOIs[0] &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; ConstantObjectInspector) {
&#160; &#160; &#160; &#160; &#160; value = ((ConstantObjectInspector) argumentOIs[0]).getWritableConstantValue();
&#160; &#160; &#160; &#160; } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
&#160; &#160; &#160; &#160; &#160; value = conversionHelper.convertIfNecessary(arguments[0].get(), argumentOIs[0]);
&#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (constantInSet.contains(((StructObjectInspector) compareOI).getStructFieldsDataAsList(value))) {
&#160; &#160; &#160; &#160; &#160; bw.set(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
&#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; bw;
&#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
&#160; &#160; &#160; } &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;getStructFieldsDataAsList does not attempt to do any conversion and just returns the data&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/hive/blob/c19d56ec7429bfcfad92b62ac335dbf8177dab24/ql/src/java/org/apache/hadoop/hive/ql/io/parquet/serde/ArrayWritableObjectInspector.java#L193&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/blob/c19d56ec7429bfcfad92b62ac335dbf8177dab24/ql/src/java/org/apache/hadoop/hive/ql/io/parquet/serde/ArrayWritableObjectInspector.java#L193&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I also would have thought that the convertIfNecessary methods should have converted the string/text values to the appropriate types but it does not because the Parquet SerDe ObjectInspector is saying the row contains the appropriately typed objects (even though everything is actually represented as Text), so the conversion doesn&apos;t take place because the converters already think the input and output object inspector schemas match.&lt;/p&gt;</comment>
                            <comment id="17612247" author="zabetak" created="Mon, 3 Oct 2022 11:07:44 +0000"  >&lt;p&gt;Fixed in &lt;a href=&quot;https://github.com/apache/hive/commit/70562437d369c2f4ab3e879bae519f81d386da3b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/commit/70562437d369c2f4ab3e879bae519f81d386da3b&lt;/a&gt;. Thanks for the PR &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jfs&quot; class=&quot;user-hover&quot; rel=&quot;jfs&quot;&gt;jfs&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=amansinha&quot; class=&quot;user-hover&quot; rel=&quot;amansinha&quot;&gt;amansinha&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkasa&quot; class=&quot;user-hover&quot; rel=&quot;kkasa&quot;&gt;kkasa&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=asolimando&quot; class=&quot;user-hover&quot; rel=&quot;asolimando&quot;&gt;asolimando&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mdayakar&quot; class=&quot;user-hover&quot; rel=&quot;mdayakar&quot;&gt;mdayakar&lt;/a&gt; for the reviews! Also many thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chiran54321&quot; class=&quot;user-hover&quot; rel=&quot;chiran54321&quot;&gt;chiran54321&lt;/a&gt; for reporting the issue and helping out with the initial investigation.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 6 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z136zc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>