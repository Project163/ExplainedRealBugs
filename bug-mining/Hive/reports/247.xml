<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:54:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-726] Make &quot;ant package -Dhadoop.version=0.17.0&quot; work</title>
                <link>https://issues.apache.org/jira/browse/HIVE-726</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-487&quot; title=&quot;Hive does not compile with Hadoop 0.20.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-487&quot;&gt;&lt;del&gt;HIVE-487&lt;/del&gt;&lt;/a&gt;, users will have to specify the versions as in &quot;shims/ivy.xml&quot; to make &quot;ant package -Dhadoop.version=&amp;lt;version&amp;gt;&quot;.work.&lt;br/&gt;
Currently it is only running fine with the following versions (from shims/ivy.xml): 0.17.2.1, 0.18.3, 0.19.0, 0.20.0.&lt;/p&gt;

&lt;p&gt;We used to do &quot;ant package -Dhadoop.version=0.17.0&quot; but it&apos;s not working any more, although we can specify &quot;ant package -Dhadoop.version=0.17.2.1&quot; and the package will probably still work with 0.17.0.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12432308">HIVE-726</key>
            <summary>Make &quot;ant package -Dhadoop.version=0.17.0&quot; work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tlipcon">Todd Lipcon</assignee>
                                    <reporter username="zshao">Zheng Shao</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Aug 2009 18:23:08 +0000</created>
                <updated>Sat, 17 Dec 2011 00:06:15 +0000</updated>
                            <resolved>Tue, 8 Sep 2009 18:24:23 +0000</resolved>
                                                    <fixVersion>0.4.0</fixVersion>
                    <fixVersion>0.5.0</fixVersion>
                                    <component>Build Infrastructure</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12739662" author="zshao" created="Wed, 5 Aug 2009 18:30:51 +0000"  >&lt;p&gt;Talked with Ashish offline on this. Assuming that API does not change within major versions, we can always download major-version.0 no matter which hadoop minor version the user specified.&lt;br/&gt;
The compiled hive package should still work with any hadoop minor versions within the same major version. This should be better for our users because users can still specify any hadoop versions on the command line - we just strip it off to get the major version and append &quot;.0&quot;.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="12739730" author="zshao" created="Wed, 5 Aug 2009 20:34:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-726&quot; title=&quot;Make &amp;quot;ant package -Dhadoop.version=0.17.0&amp;quot; work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-726&quot;&gt;&lt;del&gt;HIVE-726&lt;/del&gt;&lt;/a&gt;.1.patch: This patch allows us to build 0.17.0, 0.18.0, 0.19.0, 0.20.0.&lt;/p&gt;

&lt;p&gt;However it does not work for other versions because I could not find a way to compute hadoop.version.0 beforehand, and then use it for expansion in build.properties.&lt;br/&gt;
The &quot;getversionpref&quot; is only available after &quot;deploy-ant-tasks&quot; in build-common.xml is done.&lt;/p&gt;

&lt;p&gt;If anybody is interested in going this route, feel free to take &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-726&quot; title=&quot;Make &amp;quot;ant package -Dhadoop.version=0.17.0&amp;quot; work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-726&quot;&gt;&lt;del&gt;HIVE-726&lt;/del&gt;&lt;/a&gt;.1.patch and continue in this direction.&lt;/p&gt;

&lt;p&gt;I will try a different approach by enforcing our users to use only major versions, and we already blindly append &quot;.0&quot; to it.&lt;/p&gt;</comment>
                            <comment id="12739746" author="zshao" created="Wed, 5 Aug 2009 20:58:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-726&quot; title=&quot;Make &amp;quot;ant package -Dhadoop.version=0.17.0&amp;quot; work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-726&quot;&gt;&lt;del&gt;HIVE-726&lt;/del&gt;&lt;/a&gt;.2.patch:&lt;/p&gt;

&lt;p&gt;Please ignore all comments above. &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-726&quot; title=&quot;Make &amp;quot;ant package -Dhadoop.version=0.17.0&amp;quot; work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-726&quot;&gt;&lt;del&gt;HIVE-726&lt;/del&gt;&lt;/a&gt;.2.patch simply replaced the hadoop version with that specified by the user in shims/build.xml and shims/ivy.xml.&lt;/p&gt;

&lt;p&gt;All these commands are successful now:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ant &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; -Dhadoop.version=0.17.0
ant &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; -Dhadoop.version=0.17.2.1
ant &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; -Dhadoop.version=0.20.0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12739765" author="tlipcon" created="Wed, 5 Aug 2009 21:27:39 +0000"  >&lt;p&gt;I think there is some confusion about how the shims work.&lt;/p&gt;

&lt;p&gt;The point of the new shims package as done in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-487&quot; title=&quot;Hive does not compile with Hadoop 0.20.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-487&quot;&gt;&lt;del&gt;HIVE-487&lt;/del&gt;&lt;/a&gt; is that, on every build, the shims are build for all major versions of Hadoop. The versions in the ivy.xml there were picked as the most recent versions, but as Ashish said, we could use the .0 releases instead - it&apos;s somewhat arbitrary. After the shims have been built with each of the hadoop versions, it makes a hive_shims.jar which includes &lt;b&gt;all&lt;/b&gt; of the implementations.&lt;/p&gt;

&lt;p&gt;At this point, when Hadoop is built, it can be built against any version of Hadoop using the -Dhadoop.version flag. In actuality this should not matter - it may be that there is still some work yet to be done, but in my testing I build with the default hadoop.version (0.19.0) and then ran the build products against 18 and 20 with no recompile. The ShimLoader class determines the current hadoop version at runtime and loads the correct implementation class out of hive_shims.jar.&lt;/p&gt;

&lt;p&gt;So, -1 on the patch, since it would result in a hive_shims.jar that only includes one version of the shims, and thus the build product would only work on that version of Hadoop.&lt;/p&gt;</comment>
                            <comment id="12739825" author="zshao" created="Wed, 5 Aug 2009 23:37:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-726&quot; title=&quot;Make &amp;quot;ant package -Dhadoop.version=0.17.0&amp;quot; work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-726&quot;&gt;&lt;del&gt;HIVE-726&lt;/del&gt;&lt;/a&gt;.3.patch: This patch is even simpler. just add the hadoop.version that user specified for ivy to download.&lt;br/&gt;
shims will be compiled as it was, but other parts of hive will be compiled against the version that the user specifies.&lt;br/&gt;
I&apos;ve verified all the following command runs fine:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ant -Dhadoop.version=0.17.0 clean &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;
ant -Dhadoop.version=0.17.2.1 clean &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;
ant -Dhadoop.version=0.19.0 clean &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;
ant -Dhadoop.version=0.20.0 clean &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12739850" author="tlipcon" created="Thu, 6 Aug 2009 00:57:34 +0000"  >&lt;p&gt;I think there was still an issue which you&apos;ve uncovered. ant&apos;s semantics for the &amp;lt;param&amp;gt; element inside &amp;lt;antcall&amp;gt; are somewhat screwy - you can&apos;t override something that has been passed on the command line. Since you guys were passing hadoop.version on the command line, it was actually compiling the shims for 17 four times rather than compiling each version, as best I can tell.&lt;/p&gt;

&lt;p&gt;Attaching a patch which gets around this by introducing a new ant property called &quot;hadoop.version.ant-internal&quot;. This property is set in build.properties to default to hadoop.version, and hadoop.version is left as is. Everywhere in the build files that used to reference hadoop.version now references hadoop.version.ant-internal. Since we&apos;re not specifying this on the command line, the &amp;lt;antcall&amp;gt;s inside shims/build.xml can properly override it.&lt;/p&gt;

&lt;p&gt;One question: I think the condition in build.xml&apos;s eclipsefiles targets that defaults to 0.19 is now dead code, since the property itself is defaulted to 0.19.0.&lt;/p&gt;

&lt;p&gt;Also, can we change ${final.name} to simply ${name}-${version} since one build can work with any hadoop?&lt;/p&gt;</comment>
                            <comment id="12750110" author="namit" created="Tue, 1 Sep 2009 21:30:01 +0000"  >&lt;p&gt;I think we need this for 0.4 release&lt;/p&gt;</comment>
                            <comment id="12750830" author="zshao" created="Thu, 3 Sep 2009 05:49:02 +0000"  >&lt;p&gt;Todd, when I opened this issue I didn&apos;t know the way shims work (as you commented above).&lt;/p&gt;

&lt;p&gt;When I first saw that, it didn&apos;t work for me - see &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-812&quot; title=&quot;Hive compiled with &amp;quot;ant package&amp;quot; should work with hadoop 0.17&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-812&quot;&gt;&lt;del&gt;HIVE-812&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
But with &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-812&quot; title=&quot;Hive compiled with &amp;quot;ant package&amp;quot; should work with hadoop 0.17&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-812&quot;&gt;&lt;del&gt;HIVE-812&lt;/del&gt;&lt;/a&gt; I think it should work as you planned.&lt;/p&gt;

&lt;p&gt;I think this JIRA still has value in that it allows user to choose which hadoop version to compile against - however, if shims work as expected, the value of doing this would be minimal.&lt;/p&gt;

&lt;p&gt;I would treat this as a nice-to-have (non-blocker) for branch-0.4, as long as &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-812&quot; title=&quot;Hive compiled with &amp;quot;ant package&amp;quot; should work with hadoop 0.17&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-812&quot;&gt;&lt;del&gt;HIVE-812&lt;/del&gt;&lt;/a&gt; is in, and we inform users to remove the &quot;-Dhadoop.version=xxx&quot; from all commands lines and wikis.&lt;br/&gt;
This is a good simplification for our users I think.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="12751170" author="tlipcon" created="Thu, 3 Sep 2009 21:21:23 +0000"  >&lt;p&gt;Yea, I think this is a nice-to-have but not complete blocker. Its value is that you can ensure that you are still compatible with future releases. Since we didn&apos;t shim the entirety of Hadoop, it&apos;s possible to compile against the default fine, but still break at runtime if you&apos;re relying on an API that doesn&apos;t exist in other versions. Occasionally compiling against all of the &quot;supported&quot; versions is a good sanity check - if possible we should probably set up Hudson tests that check against all of the supported Hadoop versions on a nightly basis.&lt;/p&gt;</comment>
                            <comment id="12751555" author="zshao" created="Fri, 4 Sep 2009 18:17:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;Also, can we change ${final.name} to simply ${name}-${version} since one build can work with any hadoop?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Agree.&lt;/p&gt;

&lt;p&gt;Todd, can you make that change? Otherwise I think it&apos;s good to commit.&lt;/p&gt;</comment>
                            <comment id="12751557" author="tlipcon" created="Fri, 4 Sep 2009 18:21:15 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-799&quot; title=&quot;final.name should not include hadoop version&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-799&quot;&gt;&lt;del&gt;HIVE-799&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12752661" author="zshao" created="Tue, 8 Sep 2009 18:24:23 +0000"  >&lt;p&gt;Committed. Thanks Todd!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12425378">HIVE-487</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12434699">HIVE-812</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12415655" name="HIVE-726.1.patch" size="4474" author="zshao" created="Wed, 5 Aug 2009 20:34:39 +0000"/>
                            <attachment id="12415662" name="HIVE-726.2.patch" size="1967" author="zshao" created="Wed, 5 Aug 2009 20:58:05 +0000"/>
                            <attachment id="12415680" name="HIVE-726.3.patch" size="555" author="zshao" created="Wed, 5 Aug 2009 23:37:45 +0000"/>
                            <attachment id="12415683" name="hive-726.txt" size="9536" author="tlipcon" created="Thu, 6 Aug 2009 00:57:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73339</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 12 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lbf3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>122500</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-726&quot; title=&quot;Make &amp;quot;ant package -Dhadoop.version=0.17.0&amp;quot; work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-726&quot;&gt;&lt;strike&gt;HIVE-726&lt;/strike&gt;&lt;/a&gt;. Make &amp;quot;ant package -Dhadoop.version=0.17.0&amp;quot; work. (Todd Lipcon via zshao)&lt;br/&gt;
</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>