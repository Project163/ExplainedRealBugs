<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:51:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-384] problem in union if the first subquery is a map-only job</title>
                <link>https://issues.apache.org/jira/browse/HIVE-384</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Union needs special handling.&lt;/p&gt;

&lt;p&gt;explain &lt;br/&gt;
  select unionsrc.key, count(1) FROM (select s2.key as key, s2.value as value from src1 s2&lt;br/&gt;
                                        UNION  ALL  &lt;br/&gt;
                                      select &apos;tst1&apos; as key, cast(count(1) as string) as value from src s1) &lt;br/&gt;
  unionsrc group by unionsrc.key;&lt;/p&gt;

&lt;p&gt;results in a null pointer exception&lt;/p&gt;</description>
                <environment></environment>
        <key id="12421932">HIVE-384</key>
            <summary>problem in union if the first subquery is a map-only job</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="namit">Namit Jain</assignee>
                                    <reporter username="namit">Namit Jain</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 Apr 2009 23:43:10 +0000</created>
                <updated>Sat, 17 Dec 2011 00:07:30 +0000</updated>
                            <resolved>Tue, 7 Apr 2009 09:02:06 +0000</resolved>
                                                    <fixVersion>0.3.0</fixVersion>
                    <fixVersion>0.4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12695647" author="namit" created="Sat, 4 Apr 2009 00:02:07 +0000"  >&lt;p&gt;added a fix for number of jobs also&lt;/p&gt;</comment>
                            <comment id="12696173" author="namit" created="Mon, 6 Apr 2009 16:54:44 +0000"  >&lt;p&gt;The patch has a few bug fixes:&lt;/p&gt;

&lt;p&gt;1. The total number of jobs were counted wrongly, which made it very difficult to debug (specially big union queries).&lt;br/&gt;
2. The job name for a query was incorrect, , which made it very difficult to debug (specially big union queries).&lt;/p&gt;

&lt;p&gt;These two are fixed in Driver.java&lt;/p&gt;

&lt;p&gt;3. Union plans were very complex and inefficient - since the unions were not getting merged - the simple fix to to merge &lt;br/&gt;
them in the SemanticAnalyzer - no need to check anything, union schema should be the same.&lt;/p&gt;

&lt;p&gt;4. No special case for ReduceSink followed by Union &amp;#8211; the fix is in GenMRRedSink3&lt;/p&gt;


&lt;p&gt;Added a bunch of new tests&lt;/p&gt;

</comment>
                            <comment id="12696247" author="zshao" created="Mon, 6 Apr 2009 21:03:12 +0000"  >&lt;p&gt;It seems that the new test results print out the GroupByOperator after ReduceOutputOperator in the &quot;Map Operator Tree&quot;, while it is already printed out in the &quot;Reduce Operator Tree:&quot; section.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+              Reduce Output Operator
+                key expressions:
+                      expr: 0
+                      type: string
+                sort order: +
+                Map-reduce partition columns:
+                      expr: 0
+                      type: string
+                tag: -1
+                value expressions:
+                      expr: 1
+                      type: bigint
+                Group By Operator
+                  aggregations:
+                        expr: count(VALUE.0)
+                  keys:
+                        expr: KEY.0
+                        type: string
+                  mode: mergepartial
+                  Select Operator
+                    expressions:
+                          expr: 0
+                          type: string
+                          expr: 1
+                          type: bigint
+                    File Output Operator
+                      compressed: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
+                      GlobalTableId: 0
+                      table:
+                          input format: org.apache.hadoop.mapred.TextInputFormat
+                          output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+        /data/users/njain/hive1/hive/build/ql/tmp/58586108/201879798.10003 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12696248" author="namit" created="Mon, 6 Apr 2009 21:05:00 +0000"  >&lt;p&gt;that is because of map-side aggregation&lt;/p&gt;</comment>
                            <comment id="12696305" author="namit" created="Tue, 7 Apr 2009 00:05:45 +0000"  >&lt;p&gt;Zheng pointed out another unrelated bug in the code for explain. The kids of reduce sink was not made null for all dependent tasks, so only explain plans&lt;br/&gt;
of top level tasks were correct.&lt;/p&gt;

&lt;p&gt;Although, the reduce sink operator would ignore the kids, so there is no runtime bug&lt;/p&gt;</comment>
                            <comment id="12696328" author="namit" created="Tue, 7 Apr 2009 01:20:06 +0000"  >&lt;p&gt;fixed explain plan bug and updated a bunch of log files&lt;/p&gt;</comment>
                            <comment id="12696440" author="zshao" created="Tue, 7 Apr 2009 09:02:06 +0000"  >&lt;p&gt;Thanks Namit.&lt;/p&gt;</comment>
                            <comment id="12696963" author="johanoskarsson" created="Wed, 8 Apr 2009 09:38:23 +0000"  >&lt;p&gt;Looks like this patch cause two unit tests to fail: &lt;br/&gt;
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union10&lt;br/&gt;
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union12&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hive-trunk-h0.19/lastBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hive-trunk-h0.19/lastBuild/testReport/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12697067" author="namit" created="Wed, 8 Apr 2009 15:43:53 +0000"  >&lt;p&gt;I will look into this&lt;/p&gt;</comment>
                            <comment id="12697074" author="johanoskarsson" created="Wed, 8 Apr 2009 15:58:57 +0000"  >&lt;p&gt;I created &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-397&quot; title=&quot;Union tests fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-397&quot;&gt;&lt;del&gt;HIVE-397&lt;/del&gt;&lt;/a&gt; to track the test fixing&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12404579" name="hive.384.1.patch" size="72042" author="namit" created="Fri, 3 Apr 2009 19:34:17 +0000"/>
                            <attachment id="12404610" name="hive.384.2.patch" size="1222" author="namit" created="Sat, 4 Apr 2009 00:02:07 +0000"/>
                            <attachment id="12404617" name="hive.384.3.patch" size="75912" author="namit" created="Sat, 4 Apr 2009 01:31:48 +0000"/>
                            <attachment id="12404619" name="hive.384.4.patch" size="75545" author="namit" created="Sat, 4 Apr 2009 05:17:30 +0000"/>
                            <attachment id="12404775" name="hive.384.5.patch" size="68181" author="namit" created="Mon, 6 Apr 2009 22:55:56 +0000"/>
                            <attachment id="12404790" name="hive.384.6.patch" size="74024" author="namit" created="Tue, 7 Apr 2009 01:19:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73573</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 34 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0l9hr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>122188</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-384&quot; title=&quot;problem in union if the first subquery is a map-only job&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-384&quot;&gt;&lt;strike&gt;HIVE-384&lt;/strike&gt;&lt;/a&gt;. Fixing UNION ALL when the first job is a map-only job. (Namit Jain via zshao)</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>