<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:22:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-7730] Extend ReadEntity to add accessed columns from query</title>
                <link>https://issues.apache.org/jira/browse/HIVE-7730</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;&lt;del&gt;Now what we get from HiveSemanticAnalyzerHookContextImpl is limited. If we have hook of HiveSemanticAnalyzerHook, we may want to get more things from hookContext. (e.g. the needed colums from query).&lt;/del&gt;&lt;br/&gt;
&lt;del&gt;So we should get instance of HiveSemanticAnalyzerHookContext from configuration, extends HiveSemanticAnalyzerHookContext with a new implementation, overide the HiveSemanticAnalyzerHookContext.update() and put what you want to the class.&lt;/del&gt;&lt;br/&gt;
Hive should store accessed columns to ReadEntity when we set HIVE_STATS_COLLECT_SCANCOLS(or we can add a confVar) is true.&lt;br/&gt;
Then external authorization model can get accessed columns when do authorization in compile before execute. Maybe we will remove columnAccessInfo from BaseSemanticAnalyzer, old authorization and AuthorizationModeV2 can get accessed columns from ReadEntity too.&lt;br/&gt;
Here is the quick implement in SemanticAnalyzer.analyzeInternal() below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isColumnInfoNeedForAuth = SessionState.get().isAuthorizationModeV2()
        &amp;amp;&amp;amp; HiveConf.getBoolVar(conf, HiveConf.ConfVars.HIVE_AUTHORIZATION_ENABLED);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isColumnInfoNeedForAuth
        || HiveConf.getBoolVar(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.conf, HiveConf.ConfVars.HIVE_STATS_COLLECT_SCANCOLS) == &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) {
      ColumnAccessAnalyzer columnAccessAnalyzer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ColumnAccessAnalyzer(pCtx);
      setColumnAccessInfo(columnAccessAnalyzer.analyzeColumnAccess()); 
    }
    compiler.compile(pCtx, rootTasks, inputs, outputs);
    &lt;span class=&quot;code-comment&quot;&gt;// TODO: 
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// after compile, we can put accessed column list to ReadEntity getting from columnAccessInfo &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; HIVE_AUTHORIZATION_ENABLED is set &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12734010">HIVE-7730</key>
            <summary>Extend ReadEntity to add accessed columns from query</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Huang Xiaomeng">Xiaomeng Huang</assignee>
                                    <reporter username="Huang Xiaomeng">Xiaomeng Huang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Aug 2014 09:03:51 +0000</created>
                <updated>Thu, 13 Nov 2014 19:39:42 +0000</updated>
                            <resolved>Tue, 2 Sep 2014 00:43:27 +0000</resolved>
                                                    <fixVersion>0.14.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14096772" author="huang xiaomeng" created="Thu, 14 Aug 2014 09:10:54 +0000"  >&lt;p&gt;This is the patch and this feature blocks &lt;a href=&quot;https://issues.apache.org/jira/browse/SENTRY-392&quot; title=&quot;Authorization for column level security &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SENTRY-392&quot;&gt;&lt;del&gt;SENTRY-392&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14097059" author="ashutoshc" created="Thu, 14 Aug 2014 15:17:16 +0000"  >&lt;p&gt;If all you want is list of columns accessed in query, that is possible today with existing interface. Look at: itests/util/src/main/java/org/apache/hadoop/hive/ql/hooks/CheckColumnAccessHook.java&lt;/p&gt;</comment>
                            <comment id="14098046" author="huang xiaomeng" created="Fri, 15 Aug 2014 01:47:21 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; for the valuable comment!&lt;br/&gt;
I have seen CheckColumnAccessHook implements ExecuteWithHookContext, and it occurs in execute&lt;br/&gt;
But authorization should occurs in compile before execute.&lt;br/&gt;
So I am afraid this approach can not meet my requirement.&lt;/p&gt;</comment>
                            <comment id="14103568" author="huang xiaomeng" created="Wed, 20 Aug 2014 07:36:56 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt;&lt;br/&gt;
Currently Hive has a new interface for external authorization plugin and semantic hook may be replaced in the future. So I will try to put accessed columns to ReadEntity instread of enhancing semantic hook.This way will be available to hooks as well as authorization interfaces. I have updated the description, and wait for you feedback. Thanks!&lt;/p&gt;</comment>
                            <comment id="14105072" author="huang xiaomeng" created="Thu, 21 Aug 2014 05:38:02 +0000"  >&lt;p&gt;This is the patch of extending ReadEntity with accessed columns list.&lt;/p&gt;</comment>
                            <comment id="14106215" author="szehon" created="Fri, 22 Aug 2014 00:11:22 +0000"  >&lt;p&gt;I think its reasonable.  Xiaomeng, can you put up a review request at : &lt;a href=&quot;https://reviews.apache.org/dashboard/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/dashboard/&lt;/a&gt; for some comments?&lt;/p&gt;</comment>
                            <comment id="14106515" author="huang xiaomeng" created="Fri, 22 Aug 2014 06:05:35 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=szehon&quot; class=&quot;user-hover&quot; rel=&quot;szehon&quot;&gt;szehon&lt;/a&gt; I have linked to review board.&lt;/p&gt;</comment>
                            <comment id="14106523" author="szehon" created="Fri, 22 Aug 2014 06:15:06 +0000"  >&lt;p&gt;Thanks Xiaomeng, patch looks good overall, I put some minor comments on rb.&lt;/p&gt;</comment>
                            <comment id="14110184" author="huang xiaomeng" created="Tue, 26 Aug 2014 02:24:48 +0000"  >&lt;p&gt;Fixed something from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=szehon&quot; class=&quot;user-hover&quot; rel=&quot;szehon&quot;&gt;szehon&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14110858" author="hiveqa" created="Tue, 26 Aug 2014 15:51:35 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12664292/HIVE-7730.003.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12664292/HIVE-7730.003.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 2 failed/errored test(s), 6115 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_dynpart_sort_opt_vectorization
org.apache.hive.hcatalog.pig.TestOrcHCatLoader.testReadDataPrimitiveTypes
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/503/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/503/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/503/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/503/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-503/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-503/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12664292&lt;/p&gt;</comment>
                            <comment id="14111763" author="szehon" created="Wed, 27 Aug 2014 02:50:55 +0000"  >&lt;p&gt;Thanks Xiaomeng, +1 pending latest test result&lt;/p&gt;</comment>
                            <comment id="14111907" author="hiveqa" created="Wed, 27 Aug 2014 05:58:33 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12664542/HIVE-7730.004.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12664542/HIVE-7730.004.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 6115 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_dynpart_sort_opt_vectorization
org.apache.hive.hcatalog.pig.TestOrcHCatLoader.testReadDataPrimitiveTypes
org.apache.hive.jdbc.miniHS2.TestHiveServer2.testConnection
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/519/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/519/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/519/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/519/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-519/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-519/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12664542&lt;/p&gt;</comment>
                            <comment id="14113368" author="szehon" created="Thu, 28 Aug 2014 05:41:12 +0000"  >&lt;p&gt;Committed to trunk.  Thanks Xiaomeng for the contribution!  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brocknoland&quot; class=&quot;user-hover&quot; rel=&quot;brocknoland&quot;&gt;brocknoland&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; can one of you please add Xiaomeng to list of contributors to accredit the patch?  Thanks.&lt;/p&gt;</comment>
                            <comment id="14113376" author="huang xiaomeng" created="Thu, 28 Aug 2014 05:46:13 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=szehon&quot; class=&quot;user-hover&quot; rel=&quot;szehon&quot;&gt;szehon&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="14117038" author="huang xiaomeng" created="Mon, 1 Sep 2014 05:23:00 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=szehon&quot; class=&quot;user-hover&quot; rel=&quot;szehon&quot;&gt;szehon&lt;/a&gt;&lt;br/&gt;
There is a null pointer issue in latest patch.&lt;br/&gt;
entity.getAccessedColumns().addAll(tableToColumnAccessMap.get(entity.getTable().getCompleteName()));&lt;br/&gt;
if tableToColumnAccessMap.get(entity.getTable().getCompleteName()) is null, addAll(null) will throw null pointer exception.&lt;br/&gt;
I attached a patch to fix it, could you help to review it? Thanks!&lt;/p&gt;</comment>
                            <comment id="14117645" author="szehon" created="Mon, 1 Sep 2014 19:13:34 +0000"  >&lt;p&gt;Hi Xiaomeng, in Hive we have one JIRA per commit, so we should open a new JIRA for this.  Thanks.&lt;/p&gt;</comment>
                            <comment id="14210230" author="thejas" created="Thu, 13 Nov 2014 19:39:42 +0000"  >&lt;p&gt;This has been fixed in 0.14 release. Please open new jira if you see any issues.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12734001">SENTRY-392</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12685729">SENTRY-74</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12738332">HIVE-7932</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12661683" name="HIVE-7730.001.patch" size="4270" author="Huang Xiaomeng" created="Thu, 14 Aug 2014 09:10:54 +0000"/>
                            <attachment id="12663355" name="HIVE-7730.002.patch" size="3230" author="Huang Xiaomeng" created="Thu, 21 Aug 2014 07:22:40 +0000"/>
                            <attachment id="12664292" name="HIVE-7730.003.patch" size="3045" author="Huang Xiaomeng" created="Tue, 26 Aug 2014 02:24:48 +0000"/>
                            <attachment id="12664542" name="HIVE-7730.004.patch" size="2991" author="Huang Xiaomeng" created="Wed, 27 Aug 2014 01:37:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>412038</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1yvun:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>412027</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>