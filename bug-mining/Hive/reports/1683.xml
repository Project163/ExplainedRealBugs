<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:13:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-5657] TopN produces incorrect results with count(distinct)</title>
                <link>https://issues.apache.org/jira/browse/HIVE-5657</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Attached patch illustrates the problem.&lt;br/&gt;
limit_pushdown test has various other cases of aggregations and distincts, incl. count-distinct, that work correctly (that said, src dataset is bad for testing these things because every count, for example, produces one record only), so something must be special about this.&lt;br/&gt;
I am not very familiar with distinct- code and these nuances; if someone knows a quick fix feel free to take this, otherwise I will probably start looking next week. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12675918">HIVE-5657</key>
            <summary>TopN produces incorrect results with count(distinct)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sershe">Sergey Shelukhin</assignee>
                                    <reporter username="sershe">Sergey Shelukhin</reporter>
                        <labels>
                    </labels>
                <created>Sat, 26 Oct 2013 01:25:06 +0000</created>
                <updated>Sat, 9 Nov 2013 15:22:55 +0000</updated>
                            <resolved>Sat, 9 Nov 2013 15:22:55 +0000</resolved>
                                                    <fixVersion>0.13.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13805933" author="sershe" created="Sat, 26 Oct 2013 01:32:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; you guys might be interested&lt;/p&gt;</comment>
                            <comment id="13806508" author="navis" created="Mon, 28 Oct 2013 01:37:48 +0000"  >&lt;p&gt;Yes, top-n is not working with distincts. Test included in limit_pushdown.q was not good enough to show the flaw. I&apos;ll check this later.&lt;/p&gt;</comment>
                            <comment id="13806573" author="navis" created="Mon, 28 Oct 2013 05:11:31 +0000"  >&lt;p&gt;Attaching patch, which is not yet completed. I will return to this tomorrow or later.&lt;/p&gt;</comment>
                            <comment id="13806882" author="sershe" created="Mon, 28 Oct 2013 16:17:20 +0000"  >&lt;p&gt;is it ready for review? I skimmed a bit, it makes sense. Would be nice to have RB/FB for final patch. Thanks!&lt;/p&gt;</comment>
                            <comment id="13808829" author="phabricator@reviews.facebook.net" created="Wed, 30 Oct 2013 08:05:27 +0000"  >&lt;p&gt;navis requested code review of &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5657&quot; title=&quot;TopN produces incorrect results with count(distinct)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5657&quot;&gt;&lt;del&gt;HIVE-5657&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; TopN produces incorrect results with count(distinct)&quot;.&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5657&quot; title=&quot;TopN produces incorrect results with count(distinct)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5657&quot;&gt;&lt;del&gt;HIVE-5657&lt;/del&gt;&lt;/a&gt; TopN produces incorrect results with count(distinct)&lt;/p&gt;

&lt;p&gt;Attached patch illustrates the problem.&lt;br/&gt;
limit_pushdown test has various other cases of aggregations and distincts, incl. count-distinct, that work correctly (that said, src dataset is bad for testing these things because every count, for example, produces one record only), so something must be special about this.&lt;br/&gt;
I am not very familiar with distinct- code and these nuances; if someone knows a quick fix feel free to take this, otherwise I will probably start looking next week.&lt;/p&gt;

&lt;p&gt;TEST PLAN&lt;br/&gt;
  EMPTY&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D13797&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D13797&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/TopNHash.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/vector/VectorReduceSinkOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/LimitPushdownOptimizer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/limit_pushdown.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/limit_pushdown_negative.q&lt;br/&gt;
  ql/src/test/results/clientpositive/limit_pushdown.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/limit_pushdown_negative.q.out&lt;br/&gt;
  serde/src/java/org/apache/hadoop/hive/serde2/KeySerializer.java&lt;br/&gt;
  serde/src/java/org/apache/hadoop/hive/serde2/binarysortable/BinarySortableSerDe.java&lt;br/&gt;
  serde/src/java/org/apache/hadoop/hive/serde2/binarysortable/OutputByteBuffer.java&lt;/p&gt;

&lt;p&gt;WHY DID I GET THIS EMAIL?&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/transcript/41811/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/herald/transcript/41811/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, navis&lt;/p&gt;</comment>
                            <comment id="13808830" author="navis" created="Wed, 30 Oct 2013 08:05:33 +0000"  >&lt;p&gt;Distinct bug fix + Multi-distinct support. But huge conflict with &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5503&quot; title=&quot;TopN optimization in VectorReduceSink&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5503&quot;&gt;&lt;del&gt;HIVE-5503&lt;/del&gt;&lt;/a&gt; is expected. &lt;/p&gt;</comment>
                            <comment id="13809784" author="phabricator@reviews.facebook.net" created="Thu, 31 Oct 2013 00:11:26 +0000"  >&lt;p&gt;sershe has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5657&quot; title=&quot;TopN produces incorrect results with count(distinct)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5657&quot;&gt;&lt;del&gt;HIVE-5657&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; TopN produces incorrect results with count(distinct)&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/LimitPushdownOptimizer.java:125 so this now supports any number of distincts?&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/TopNHash.java:255 right now this only returns forward... is this by design?&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java:243 should all of this also be done for vectorized path?&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java:268 I fixed it in my patch for vectorized... why is hash needed here?&lt;br/&gt;
  If row is excluded we don&apos;t need hash, it&apos;s only needed when we store the value or collect&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java:297 if index &amp;gt;= 0 this should store value&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java:255 Previously there was just key, which was some columns and optionally one distinct.&lt;br/&gt;
  Do I read correctly that distribution key is now the same, just without distinct?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D13797&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D13797&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, navis&lt;br/&gt;
Cc: sershe&lt;/p&gt;</comment>
                            <comment id="13809785" author="sershe" created="Thu, 31 Oct 2013 00:11:33 +0000"  >&lt;p&gt;Left some comments on fb. Can you summarize how the change works? it seems like with any distincts, it will just forward all rows (like if it was disabled), but there is lots of code to do it.&lt;/p&gt;</comment>
                            <comment id="13809787" author="sershe" created="Thu, 31 Oct 2013 00:16:19 +0000"  >&lt;p&gt;What do you want to do about conflict? It seems like your patch contains many of the same changes as my patch also &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13809811" author="phabricator@reviews.facebook.net" created="Thu, 31 Oct 2013 00:49:26 +0000"  >&lt;p&gt;navis has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5657&quot; title=&quot;TopN produces incorrect results with count(distinct)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5657&quot;&gt;&lt;del&gt;HIVE-5657&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; TopN produces incorrect results with count(distinct)&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java:268 Right. it should be -1. I did mistake doing some refactoring.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/TopNHash.java:255 For distinct, it does not store values. Check the key and decide to forward all or exclude all. I&apos;m not sure that the previous version was better. In this time, I&apos;ve focused simplifying the flow of RS-op.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java:255 Yes right. Previously, the key was like this&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;distributeKey:distinctKey1&amp;#93;&lt;/span&gt;&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;distributeKey:distinctKey2&amp;#93;&lt;/span&gt;&lt;br/&gt;
  and each row is serialized in whole by OI&lt;br/&gt;
  structOI&lt;span class=&quot;error&quot;&gt;&amp;#91;structOI(distributeKey):UnionOI(distinctKey)&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;  Now the key is prepared like this and&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;distributeKey&amp;#93;&lt;/span&gt;&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;distinctKey1,distinctKey2&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;  serialized for each part directly by inner OI : structOI(distributeKey) and UnionOI(distinctKey)&lt;/p&gt;

&lt;p&gt;  I&apos;m not feel good introducing new interface KeySerializer. But serializing distributeKey multiple time seemed worse than that.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/LimitPushdownOptimizer.java:125 yes.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/ReduceSinkDesc.java:211 Changed the name because it was confusing that RS is for MapAggr GBY, which is not.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java:243 I didn&apos;t know there was VectorReduceSinkOperator when I&apos;ve started this, which made me include more refactorings than just amount of fixing the problem. I think current version of patch is way simpler than that of original. But if it makes merging of vectorization hard, I might create minimal patch just for fix.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D13797&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D13797&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, navis&lt;br/&gt;
Cc: sershe&lt;/p&gt;</comment>
                            <comment id="13809819" author="sershe" created="Thu, 31 Oct 2013 01:01:18 +0000"  >&lt;p&gt;(responding to FB comment) yeah, it would be nice to have simpler fix to make merge easier, esp. since many of these changes (e.g. setting writable without duplicated code from BinaryComparable, and some other stuff) is already coming.&lt;/p&gt;

&lt;p&gt;What I don&apos;t understand still is what it does for distinct. Where can it decide to exclude? It seems the same forward-all behavior can be achieved by removing support for any distinct from optimizer.&lt;/p&gt;</comment>
                            <comment id="13809835" author="navis" created="Thu, 31 Oct 2013 01:32:14 +0000"  >&lt;p&gt;indexOf() stores keys into hash(yes, confusing name). Exclude or not can be decided base on it.&lt;/p&gt;</comment>
                            <comment id="13809846" author="sershe" created="Thu, 31 Oct 2013 01:54:54 +0000"  >&lt;p&gt;but the hash for distinct in the review always returns FORWARD in current patch on FB:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;HashForDistinct &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; HashForGroup {

 HashForDistinct(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; topN, &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; threshold, BinaryCollector collector) {
 &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;(topN, threshold, collector);
 }

 @Override
 &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; index(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; index) {
 &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; FORWARD;
 }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13809847" author="sershe" created="Thu, 31 Oct 2013 01:55:46 +0000"  >&lt;p&gt;Ah, sorry, I read the name of the override function wrong, it&apos;s similar. Let me reread&lt;/p&gt;</comment>
                            <comment id="13809848" author="sershe" created="Thu, 31 Oct 2013 02:01:59 +0000"  >&lt;p&gt;Oh, I see how it works now. Logically, is it the same behavior as groupby, but groupby forwards all MR KVs except one, which is later flushed if it &quot;survives&quot; in the heap, or maybe evicted. Whereas this guy would have to store multiple key-values for each key in the case of multi distinct, so it just forwards everything in case it&apos;s in the heap, not storing that one row. &lt;br/&gt;
That part makes sense. Thanks! Function name (&quot;index&quot;) could be improved.&lt;br/&gt;
Are you going to post updated patch?&lt;/p&gt;</comment>
                            <comment id="13809898" author="phabricator@reviews.facebook.net" created="Thu, 31 Oct 2013 04:08:25 +0000"  >&lt;p&gt;navis updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5657&quot; title=&quot;TopN produces incorrect results with count(distinct)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5657&quot;&gt;&lt;del&gt;HIVE-5657&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; TopN produces incorrect results with count(distinct)&quot;.&lt;/p&gt;

&lt;p&gt;  1. Minimized diff&lt;br/&gt;
  2. Support multi-distinct cases&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D13797&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D13797&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D13797?vs=42645&amp;amp;id=42747#toc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D13797?vs=42645&amp;amp;id=42747#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/TopNHash.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/io/HiveKey.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/LimitPushdownOptimizer.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/limit_pushdown.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/limit_pushdown_negative.q&lt;br/&gt;
  ql/src/test/results/clientpositive/limit_pushdown.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/limit_pushdown_negative.q.out&lt;/p&gt;

&lt;p&gt;To: JIRA, navis&lt;br/&gt;
Cc: sershe&lt;/p&gt;</comment>
                            <comment id="13810688" author="phabricator@reviews.facebook.net" created="Thu, 31 Oct 2013 20:53:18 +0000"  >&lt;p&gt;sershe has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5657&quot; title=&quot;TopN produces incorrect results with count(distinct)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5657&quot;&gt;&lt;del&gt;HIVE-5657&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; TopN produces incorrect results with count(distinct)&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java:387 this changes the meaning to now refer to the field &quot;this.value&quot;. Is it intended? Previously it was not used. Perhaps the first &quot;if&quot; should be removed if not used on purpose&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D13797&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D13797&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, navis&lt;br/&gt;
Cc: sershe&lt;/p&gt;</comment>
                            <comment id="13810690" author="sershe" created="Thu, 31 Oct 2013 20:54:11 +0000"  >&lt;p&gt;One small comment about the &quot;value&quot; field usage. I&apos;m +1 if you can remove it, or add comment so that it&apos;s clear when it&apos;s reused and when it&apos;s reset)&lt;/p&gt;

&lt;p&gt;Note that I&apos;m not a committed though, so someone else might need to +1 in addition&lt;/p&gt;</comment>
                            <comment id="13810692" author="sershe" created="Thu, 31 Oct 2013 20:54:30 +0000"  >&lt;p&gt;*committer&lt;/p&gt;</comment>
                            <comment id="13812617" author="navis" created="Mon, 4 Nov 2013 04:48:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5503&quot; title=&quot;TopN optimization in VectorReduceSink&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5503&quot;&gt;&lt;del&gt;HIVE-5503&lt;/del&gt;&lt;/a&gt; is committed and I cannot rebase on that. Was it necessary to &quot;refactor&quot; the codes which is not yet confirmed solid and has on-going issues on it? I appreciate progresses made by members of the company. But not like this.&lt;/p&gt;</comment>
                            <comment id="13813143" author="sershe" created="Mon, 4 Nov 2013 19:27:50 +0000"  >&lt;p&gt;I refactored the code there because it was to be called from 2 places (vectorized and not) and some code that is TopN specific was inside ReducerSink, also similarly vectorized and non-vectorized path inside TopNHash would have a lot of code in common like serialization.&lt;/p&gt;

&lt;p&gt;Let me try to rebase this patch later today...&lt;/p&gt;</comment>
                            <comment id="13813148" author="ashutoshc" created="Mon, 4 Nov 2013 19:32:20 +0000"  >&lt;p&gt;Sorry for grief &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; However, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt; is offering to rebase this patch, since he is familiar with this piece of code. Hopefully, that is acceptable to you.&lt;/p&gt;</comment>
                            <comment id="13813604" author="sershe" created="Tue, 5 Nov 2013 03:38:34 +0000"  >&lt;p&gt;I think I have the non-vector part, need to add vector part, let me finish this tomorrow&lt;/p&gt;</comment>
                            <comment id="13814576" author="sershe" created="Wed, 6 Nov 2013 03:43:49 +0000"  >&lt;p&gt;Rebased and added vectorized handling.&lt;br/&gt;
I got a little bit carried away and added bunch of comments and renames i, j, index variables to be more specific.&lt;/p&gt;</comment>
                            <comment id="13814846" author="hiveqa" created="Wed, 6 Nov 2013 12:31:07 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12612317/HIVE-5657.02.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12612317/HIVE-5657.02.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 4551 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/148/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/148/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/148/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/148/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12612317&lt;/p&gt;</comment>
                            <comment id="13815044" author="ashutoshc" created="Wed, 6 Nov 2013 17:12:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt; Can you create a RB for this ?&lt;/p&gt;</comment>
                            <comment id="13815199" author="sershe" created="Wed, 6 Nov 2013 19:36:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/15282/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/15282/&lt;/a&gt; is the 2nd rb&lt;/p&gt;</comment>
                            <comment id="13817450" author="ashutoshc" created="Fri, 8 Nov 2013 16:59:03 +0000"  >&lt;p&gt;+1 &lt;br/&gt;
Can you create a follow-up jira for removing unnecessary if(firstRow) from processOp(), seems like work in that if block can be done in initializeOp() ?&lt;br/&gt;
Also, you need to reupload your patch since seems like Hive QA hasn&apos;t picked it up yet.&lt;/p&gt;</comment>
                            <comment id="13817572" author="sershe" created="Fri, 8 Nov 2013 18:56:24 +0000"  >&lt;p&gt;seems like too small an item to create JIRA for... also are you sure it can indeed be moved? see my TODO comment. As a matter of priorities I&apos;d like to not spend time making sure &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13817574" author="sershe" created="Fri, 8 Nov 2013 18:56:48 +0000"  >&lt;p&gt;btw please don&apos;t commit, let me address my own comments on rb&lt;/p&gt;</comment>
                            <comment id="13817595" author="sershe" created="Fri, 8 Nov 2013 19:22:38 +0000"  >&lt;p&gt;trivial changes compared to 02&lt;/p&gt;</comment>
                            <comment id="13817982" author="hiveqa" created="Sat, 9 Nov 2013 03:21:40 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12612869/HIVE-5657.03.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12612869/HIVE-5657.03.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 4598 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/218/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/218/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/218/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/218/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12612869&lt;/p&gt;</comment>
                            <comment id="13818161" author="ashutoshc" created="Sat, 9 Nov 2013 15:22:55 +0000"  >&lt;p&gt;Committed to trunk. Thanks, Sergey!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12611004" name="D13797.1.patch" size="47936" author="phabricator@reviews.facebook.net" created="Wed, 30 Oct 2013 08:05:27 +0000"/>
                            <attachment id="12611247" name="D13797.2.patch" size="31455" author="phabricator@reviews.facebook.net" created="Thu, 31 Oct 2013 04:08:25 +0000"/>
                            <attachment id="12612317" name="HIVE-5657.02.patch" size="56687" author="sershe" created="Wed, 6 Nov 2013 03:43:49 +0000"/>
                            <attachment id="12612869" name="HIVE-5657.03.patch" size="56928" author="sershe" created="Fri, 8 Nov 2013 19:22:38 +0000"/>
                            <attachment id="12610507" name="HIVE-5657.1.patch.txt" size="27183" author="navis" created="Mon, 28 Oct 2013 05:11:31 +0000"/>
                            <attachment id="12610427" name="example.patch" size="1725" author="sershe" created="Sat, 26 Oct 2013 01:25:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>355415</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1p9tr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>355703</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>