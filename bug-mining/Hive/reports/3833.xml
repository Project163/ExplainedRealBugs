<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:37:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-11846] CliDriver shutdown tries to drop index table again which was already dropped when dropping the original table </title>
                <link>https://issues.apache.org/jira/browse/HIVE-11846</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Steps to repro:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;set hive.stats.dbclass=fs;
set hive.stats.autogather=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
set hive.cbo.enable=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;

DROP TABLE IF EXISTS aa;
CREATE TABLE aa (L_ORDERKEY      INT,
                                L_PARTKEY       INT,
                                L_SUPPKEY       INT,
                                L_LINENUMBER    INT,
                                L_QUANTITY      DOUBLE,
                                L_EXTENDEDPRICE DOUBLE,
                                L_DISCOUNT      DOUBLE,
                                L_TAX           DOUBLE,
                                L_RETURNFLAG    STRING,
                                L_LINESTATUS    STRING,
                                l_shipdate      STRING,
                                L_COMMITDATE    STRING,
                                L_RECEIPTDATE   STRING,
                                L_SHIPINSTRUCT  STRING,
                                L_SHIPMODE      STRING,
                                L_COMMENT       STRING)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY &lt;span class=&quot;code-quote&quot;&gt;&apos;|&apos;&lt;/span&gt;;

LOAD DATA LOCAL INPATH &lt;span class=&quot;code-quote&quot;&gt;&apos;../../data/files/lineitem.txt&apos;&lt;/span&gt; OVERWRITE INTO TABLE aa;

CREATE INDEX aa_lshipdate_idx ON TABLE aa(l_shipdate) AS &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.hadoop.hive.ql.index.AggregateIndexHandler&apos;&lt;/span&gt; WITH DEFERRED REBUILD IDXPROPERTIES(&lt;span class=&quot;code-quote&quot;&gt;&quot;AGGREGATES&quot;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;count(l_shipdate)&quot;&lt;/span&gt;);
ALTER INDEX aa_lshipdate_idx ON aa REBUILD;

show tables;

explain select l_shipdate, count(l_shipdate)
from aa
group by l_shipdate;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem is that, we create an index table default_aa_lshipdate_idx, (default is the database name) and it comes after the table aa. Then, it first drop aa, which will drop default_aa_lshipdate_idx as well as it is related to aa. It will not find the table default_aa_lshipdate_idx when it tries to drop it again, which will throw an exception.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12873052">HIVE-11846</key>
            <summary>CliDriver shutdown tries to drop index table again which was already dropped when dropping the original table </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pxiong">Pengcheng Xiong</assignee>
                                    <reporter username="pxiong">Pengcheng Xiong</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Sep 2015 17:35:32 +0000</created>
                <updated>Tue, 16 Feb 2016 23:53:11 +0000</updated>
                            <resolved>Fri, 18 Sep 2015 17:34:03 +0000</resolved>
                                    <version>1.2.1</version>
                                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14790907" author="xuefuz" created="Wed, 16 Sep 2015 18:46:38 +0000"  >&lt;p&gt;The description doesn&apos;t seem describing the problem clearly. What&apos;s the symptom of the problem and how is it releated to CliDriver shutdown?&lt;/p&gt;</comment>
                            <comment id="14791046" author="pxiong" created="Wed, 16 Sep 2015 20:08:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt;. thanks for your attention. The problem can be better understood if you can take a look at my patch. So, when CliDriver tries to shutdown, it tries to drop all the tables that are created during q test. In this case, it iterates through all the tables in db.getAllTables() in QTestUtil.java and try to drop every one of them. Let&apos;s assume there are two tables, A, an original table, and index_A, which is an index table created based on A. If index_A comes before A in the iteration, there is no problem, because L674 in QTestUtil.java will skip it and later when A is dropped, index_A is dropped as well. However, If A comes before index_A in the iteration, A will be dropped and index_A is dropped as well, later, it will not find index_A and throw InvalidTableException. That is the symptom of the problem and why it is related to CliDriver shutdown. Thanks.&lt;/p&gt;</comment>
                            <comment id="14791294" author="xuefuz" created="Wed, 16 Sep 2015 23:26:39 +0000"  >&lt;p&gt;Got it. Thanks for the explanation.&lt;/p&gt;</comment>
                            <comment id="14803305" author="hiveqa" created="Thu, 17 Sep 2015 17:54:22 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12756342/HIVE-11846.01.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12756342/HIVE-11846.01.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 9447 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
org.apache.hive.hcatalog.hbase.TestPigHBaseStorageHandler.org.apache.hive.hcatalog.hbase.TestPigHBaseStorageHandler
org.apache.hive.hcatalog.streaming.TestStreaming.testEndpointConnection
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5312/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5312/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5312/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5312/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5312/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5312/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12756342 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14803334" author="pxiong" created="Thu, 17 Sep 2015 18:16:16 +0000"  >&lt;p&gt;The failed tests are unrelated and when I ran them on my laptop, all of them passed. As it is a rather simple patch, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpullokkaran&quot; class=&quot;user-hover&quot; rel=&quot;jpullokkaran&quot;&gt;jpullokkaran&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt;, could any of you review the patch? Thanks.&lt;/p&gt;</comment>
                            <comment id="14803359" author="ashutoshc" created="Thu, 17 Sep 2015 18:25:32 +0000"  >&lt;p&gt;+1 LGTM&lt;/p&gt;</comment>
                            <comment id="14876015" author="pxiong" created="Fri, 18 Sep 2015 17:33:54 +0000"  >&lt;p&gt;pushed to master, thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; for the review!&lt;/p&gt;</comment>
                            <comment id="14876105" author="xuefuz" created="Fri, 18 Sep 2015 18:31:34 +0000"  >&lt;p&gt;Could you please update affected versions as well as fix versions? Thanks.&lt;/p&gt;</comment>
                            <comment id="15001519" author="sershe" created="Thu, 12 Nov 2015 02:12:13 +0000"  >&lt;p&gt;Should this issue be backported to branch-1? It looks like a bug.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12860760">HIVE-11699</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12756342" name="HIVE-11846.01.patch" size="10300" author="pxiong" created="Wed, 16 Sep 2015 20:01:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2k9gf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332154">1.3.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>