<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:22:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-25894] Table migration to Iceberg doesn&apos;t remove HMS partitions</title>
                <link>https://issues.apache.org/jira/browse/HIVE-25894</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Repro:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
create table ice_part_migrate (i &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) partitioned by (p &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) stored as parquet;

insert into ice_part_migrate partition(p=1) values (1), (11), (111);

insert into ice_part_migrate partition(p=2) values (2), (22), (222);

ALTER TABLE ice_part_migrate  SET TBLPROPERTIES (&lt;span class=&quot;code-quote&quot;&gt;&apos;storage_handler&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.iceberg.mr.hive.HiveIcebergStorageHandler&apos;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then looking at the HMS database:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
=&amp;gt; select &lt;span class=&quot;code-quote&quot;&gt;&quot;PART_NAME&quot;&lt;/span&gt; from &lt;span class=&quot;code-quote&quot;&gt;&quot;PARTITIONS&quot;&lt;/span&gt; p, &lt;span class=&quot;code-quote&quot;&gt;&quot;TBLS&quot;&lt;/span&gt; t where t.&lt;span class=&quot;code-quote&quot;&gt;&quot;TBL_ID&quot;&lt;/span&gt;=p.&lt;span class=&quot;code-quote&quot;&gt;&quot;TBL_ID&quot;&lt;/span&gt; and t.&lt;span class=&quot;code-quote&quot;&gt;&quot;TBL_NAME&quot;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;ice_part_migrate&apos;&lt;/span&gt;;
 PART_NAME
-----------
 p=1
 p=2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is weird because Iceberg tables are supposed to be unpartitioned. It also breaks some precondition checks in Impala. Is there a particular reason to keep the partitions in HMS?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13424503">HIVE-25894</key>
            <summary>Table migration to Iceberg doesn&apos;t remove HMS partitions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pvary">Peter Vary</assignee>
                                    <reporter username="boroknagyz">Zolt&#225;n Bor&#243;k-Nagy</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 24 Jan 2022 20:25:02 +0000</created>
                <updated>Thu, 17 Nov 2022 08:47:40 +0000</updated>
                            <resolved>Fri, 4 Mar 2022 13:38:44 +0000</resolved>
                                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="17481372" author="boroknagyz" created="Mon, 24 Jan 2022 20:26:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbod&quot; class=&quot;user-hover&quot; rel=&quot;mbod&quot;&gt;mbod&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lpinter&quot; class=&quot;user-hover&quot; rel=&quot;lpinter&quot;&gt;lpinter&lt;/a&gt; could you please take a look? Thanks.&lt;/p&gt;</comment>
                            <comment id="17481669" author="marton bod" created="Tue, 25 Jan 2022 09:13:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=boroknagyz&quot; class=&quot;user-hover&quot; rel=&quot;boroknagyz&quot;&gt;boroknagyz&lt;/a&gt; interesting, thanks for raising this! If you load the table from HMS, it is unpartitioned:&#160;&lt;/p&gt;

&lt;p&gt;table.getPartitionKeys() gives back an empty list. Not sure why the partitions are not purged from the database too and whether it causes any problems.&lt;/p&gt;</comment>
                            <comment id="17481685" author="boroknagyz" created="Tue, 25 Jan 2022 09:40:33 +0000"  >&lt;p&gt;Yeah, in Impala we have a check that if partition keys are empty, then there shouldn&apos;t be any partitions:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/impala/blob/12118664d84599f4164494058d35a882ba2dd193/fe/src/main/java/org/apache/impala/catalog/HdfsTable.java#L685-L686&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/impala/blob/12118664d84599f4164494058d35a882ba2dd193/fe/src/main/java/org/apache/impala/catalog/HdfsTable.java#L685-L686&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I can change our preconditions, but if you also consider this to be a bug, then I think it&apos;s better to fix at the Hive side.&lt;/p&gt;</comment>
                            <comment id="17501329" author="pvary" created="Fri, 4 Mar 2022 13:38:44 +0000"  >&lt;p&gt;Pushed to master.&lt;/p&gt;

&lt;p&gt;Thanks for reporting &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=boroknagyz&quot; class=&quot;user-hover&quot; rel=&quot;boroknagyz&quot;&gt;boroknagyz&lt;/a&gt; and for the review &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Marton+Bod&quot; class=&quot;user-hover&quot; rel=&quot;Marton Bod&quot;&gt;Marton Bod&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lpinter&quot; class=&quot;user-hover&quot; rel=&quot;lpinter&quot;&gt;lpinter&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 36 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ywf4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>