<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:02:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-3301] Fix quote printing bug in mapreduce_stack_trace.q testcase failure when running hive on hadoop23</title>
                <link>https://issues.apache.org/jira/browse/HIVE-3301</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;When running hive on hadoop0.23, mapreduce_stack_trace.q is failing due to quote printing bug:&lt;/p&gt;

&lt;p&gt;quote is printed as: &apos;&amp;quot;&apos;, instead of &quot;&lt;/p&gt;

&lt;p&gt;Seems not able to state the bug clearly in html:&lt;/p&gt;

&lt;p&gt;quote is printed as &apos;address sign&apos; + &apos;quot&apos; + semicolon&lt;br/&gt;
not the expected &apos;quote sign&apos;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12600246">HIVE-3301</key>
            <summary>Fix quote printing bug in mapreduce_stack_trace.q testcase failure when running hive on hadoop23</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zhenxiao">Zhenxiao Luo</assignee>
                                    <reporter username="zhenxiao">Zhenxiao Luo</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Jul 2012 00:45:08 +0000</created>
                <updated>Thu, 10 Jan 2013 19:54:11 +0000</updated>
                            <resolved>Thu, 26 Jul 2012 23:24:42 +0000</resolved>
                                                    <fixVersion>0.10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13422787" author="zhenxiao" created="Thu, 26 Jul 2012 00:58:32 +0000"  >&lt;p&gt;The problem is:&lt;/p&gt;

&lt;p&gt;In hadoop23, TaskLogServlet.java is using a new utility HtmlQuoting.java to print Task Log.&lt;/p&gt;

&lt;p&gt;In TaskLogServlet.java, printTaskLog() function:&lt;/p&gt;

&lt;p&gt;result = taskLogReader.read(b);&lt;br/&gt;
        if (result &amp;gt; 0) {&lt;br/&gt;
          if (plainText) &lt;/p&gt;
{
            out.write(b, 0, result);
          } else {
            HtmlQuoting.quoteHtmlChars(out, b, 0, result);
          }&lt;br/&gt;
        } else {
          break;
        }&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
While, in hadoop20,  TaskLogServlet.java is using its own utility(there is no such HtmlQuoting.java at all) to print Task Log:&lt;br/&gt;
&lt;br/&gt;
In TaskLogServlet.java, printTaskLog fucntion:&lt;br/&gt;
&lt;br/&gt;
result = taskLogReader.read(b);&lt;br/&gt;
        if (result &amp;gt; 0) {&lt;br/&gt;
          if (plainText) {            out.write(b, 0, result);          }
&lt;p&gt; else &lt;/p&gt;
{
            quotedWrite(out, b, 0, result);
          }
&lt;p&gt;        } else &lt;/p&gt;
{
          break;
        }


&lt;p&gt;And in Hive, TaskLogProcessor.java is generating stack trace by reading the raw taskAttemptLog.&lt;/p&gt;

&lt;p&gt;In ql/src/java/org/apache/hadoop/hive/ql/exec/errors/TaskLogProcessor.java, getStackTraces() fuction:&lt;/p&gt;


&lt;p&gt;List&amp;lt;String&amp;gt; stackTrace = null;&lt;/p&gt;

&lt;p&gt;        // Patterns that match the middle/end of stack traces&lt;br/&gt;
        Pattern stackTracePattern = Pattern.compile(&quot;^\tat .*&quot;, Pattern.CASE_INSENSITIVE);&lt;br/&gt;
        Pattern endStackTracePattern =&lt;br/&gt;
            Pattern.compile(&quot;^\t... &lt;span class=&quot;error&quot;&gt;&amp;#91;0-9&amp;#93;&lt;/span&gt;+ more.*&quot;, Pattern.CASE_INSENSITIVE);&lt;/p&gt;

&lt;p&gt;        while ((inputLine = in.readLine()) != null) {&lt;/p&gt;

&lt;p&gt;          if (stackTracePattern.matcher(inputLine).matches() ||&lt;br/&gt;
              endStackTracePattern.matcher(inputLine).matches()) {&lt;/p&gt;


&lt;p&gt;To have Hive working for both hadoop20 and hadoop23, we should use different mechanisms when hive TaskLogProcessor is parsing TaskAttemptLog.&lt;/p&gt;

&lt;p&gt;My plan is creating a shim, which have different implementations for hadoop20 and hadoop23.&lt;/p&gt;

&lt;p&gt;In hadoop23, HtmlQuoting.unquoteHtmlChars() is used to parse the TaskAttemptLog.&lt;/p&gt;</comment>
                            <comment id="13422789" author="appodictic" created="Thu, 26 Jul 2012 01:01:14 +0000"  >&lt;p&gt;You know these hadoop 23 jiras are like death of a thousand paper cuts, if I had known we were going to face so many issues i would have proposed making a larger shim layer. Can we come up with a definitive list of all the 23 problems?&lt;/p&gt;</comment>
                            <comment id="13422790" author="zhenxiao" created="Thu, 26 Jul 2012 01:02:29 +0000"  >&lt;p&gt;review request submitted at:&lt;br/&gt;
&lt;a href=&quot;https://reviews.facebook.net/D4353&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D4353&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13422795" author="zhenxiao" created="Thu, 26 Jul 2012 01:08:40 +0000"  >&lt;p&gt;@Edward: oh yes. As I know, &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3301&quot; title=&quot;Fix quote printing bug in mapreduce_stack_trace.q testcase failure when running hive on hadoop23&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3301&quot;&gt;&lt;del&gt;HIVE-3301&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3275&quot; title=&quot;Fix autolocal1.q testcase failure when building hive on hadoop0.23 MR2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3275&quot;&gt;&lt;del&gt;HIVE-3275&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3273&quot; title=&quot;Add avro jars into hive execution classpath&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3273&quot;&gt;&lt;del&gt;HIVE-3273&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3242&quot; title=&quot;Fix cascade_dbdrop.q when building hive on hadoop0.23&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3242&quot;&gt;&lt;del&gt;HIVE-3242&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3240&quot; title=&quot;Fix non-deterministic results in newline.q and timestamp_lazy.q&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3240&quot;&gt;&lt;del&gt;HIVE-3240&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3257&quot; title=&quot;Fix avro_joins.q testcase failure when building hive on hadoop0.23&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3257&quot;&gt;&lt;del&gt;HIVE-3257&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3249&quot; title=&quot;Upgrade guava to 11.0.2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3249&quot;&gt;&lt;del&gt;HIVE-3249&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2804&quot; title=&quot;Task log retrieval fails on Hadoop 0.23&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2804&quot;&gt;&lt;del&gt;HIVE-2804&lt;/del&gt;&lt;/a&gt; are all hadoop 23 bugs. I am fixing these one by one. Thanks for your advice. I will try to put them into a larger shim layer.&lt;/p&gt;

&lt;p&gt;I just found an Error Code retrieval inconsistency between hadoop20 and hadoop23. Will file another one soon.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Zhenxiao&lt;/p&gt;</comment>
                            <comment id="13422800" author="appodictic" created="Thu, 26 Jul 2012 01:15:37 +0000"  >&lt;p&gt;I am not saying we need to shim layer all the fixes, but having a reasonably exhaustive list of the problems linked together in jira would make me more confident that we are taking the right plan of action. &lt;/p&gt;</comment>
                            <comment id="13422809" author="ashutoshc" created="Thu, 26 Jul 2012 01:25:36 +0000"  >&lt;p&gt;Zhenxiao I left comments on Phabricator.&lt;/p&gt;</comment>
                            <comment id="13422826" author="zhenxiao" created="Thu, 26 Jul 2012 01:46:54 +0000"  >&lt;p&gt;Link with hadoop23 integration related bugs&lt;/p&gt;</comment>
                            <comment id="13422831" author="zhenxiao" created="Thu, 26 Jul 2012 01:53:12 +0000"  >&lt;p&gt;@Edward: related HIVE tickets are linked. I will add more whenever any new bugs filed. Do we need a separate upper level JIRA to trace all the hadoop23 integration bugs?&lt;/p&gt;</comment>
                            <comment id="13422832" author="zhenxiao" created="Thu, 26 Jul 2012 01:53:52 +0000"  >&lt;p&gt;@ashutosh: Thanks a lot for the comments.&lt;/p&gt;

&lt;p&gt;I made updates and resubmitted review request at:&lt;br/&gt;
&lt;a href=&quot;https://reviews.facebook.net/D4353&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D4353&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13422836" author="zhenxiao" created="Thu, 26 Jul 2012 02:00:37 +0000"  >&lt;p&gt;patch has prefix in it&lt;/p&gt;</comment>
                            <comment id="13422837" author="zhenxiao" created="Thu, 26 Jul 2012 02:01:06 +0000"  >&lt;p&gt;updated patch without prefix&lt;br/&gt;
could apply cleanly&lt;/p&gt;</comment>
                            <comment id="13423167" author="ashutoshc" created="Thu, 26 Jul 2012 15:56:19 +0000"  >&lt;p&gt;+1 Running tests.&lt;/p&gt;</comment>
                            <comment id="13423555" author="ashutoshc" created="Thu, 26 Jul 2012 23:24:42 +0000"  >&lt;p&gt;Committed to trunk. Thanks, Zhenxiao!&lt;/p&gt;</comment>
                            <comment id="13423778" author="hudson" created="Fri, 27 Jul 2012 10:09:05 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #1570 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/1570/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/1570/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3301&quot; title=&quot;Fix quote printing bug in mapreduce_stack_trace.q testcase failure when running hive on hadoop23&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3301&quot;&gt;&lt;del&gt;HIVE-3301&lt;/del&gt;&lt;/a&gt; : Fix quote printing bug in mapreduce_stack_trace.q testcase failure when running hive on hadoop23 (Zhenxiao Luo via Ashutosh Chauhan) (Revision 1366233)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
hashutosh : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1366233&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1366233&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/errors/TaskLogProcessor.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/shims/src/0.20/java/org/apache/hadoop/hive/shims/Hadoop20Shims.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/shims/src/common-secure/java/org/apache/hadoop/hive/shims/HadoopShimsSecure.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/shims/src/common/java/org/apache/hadoop/hive/shims/HadoopShims.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13548011" author="hudson" created="Wed, 9 Jan 2013 10:23:57 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #54 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3301&quot; title=&quot;Fix quote printing bug in mapreduce_stack_trace.q testcase failure when running hive on hadoop23&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3301&quot;&gt;&lt;del&gt;HIVE-3301&lt;/del&gt;&lt;/a&gt; : Fix quote printing bug in mapreduce_stack_trace.q testcase failure when running hive on hadoop23 (Zhenxiao Luo via Ashutosh Chauhan) (Revision 1366233)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
hashutosh : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1366233&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1366233&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/errors/TaskLogProcessor.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/shims/src/0.20/java/org/apache/hadoop/hive/shims/Hadoop20Shims.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/shims/src/common-secure/java/org/apache/hadoop/hive/shims/HadoopShimsSecure.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/shims/src/common/java/org/apache/hadoop/hive/shims/HadoopShims.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13550307" author="ashutoshc" created="Thu, 10 Jan 2013 19:54:11 +0000"  >&lt;p&gt;This issue is fixed and released as part of 0.10.0 release. If you find an issue which seems to be related to this one, please create a new jira and link this one with new jira.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12542461">HIVE-2804</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12597829">HIVE-3240</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12597876">HIVE-3242</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12598278">HIVE-3249</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12598782">HIVE-3257</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12599373">HIVE-3273</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12599389">HIVE-3275</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12600252">HIVE-3303</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12537939" name="HIVE-3301.1.patch.txt" size="4469" author="zhenxiao" created="Thu, 26 Jul 2012 01:03:25 +0000"/>
                            <attachment id="12537944" name="HIVE-3301.2.patch.txt" size="3722" author="zhenxiao" created="Thu, 26 Jul 2012 01:51:53 +0000"/>
                            <attachment id="12537945" name="HIVE-3301.3.patch.txt" size="3690" author="zhenxiao" created="Thu, 26 Jul 2012 02:01:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>242372</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 45 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02u6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14490</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>