<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:29:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-6099] Multi insert does not work properly with distinct count</title>
                <link>https://issues.apache.org/jira/browse/HIVE-6099</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Need 2 rows to reproduce this Bug. Here are the steps.&lt;/p&gt;

&lt;p&gt;Step 1) Create a table Table_A&lt;br/&gt;
CREATE EXTERNAL TABLE Table_A&lt;br/&gt;
(&lt;br/&gt;
user string&lt;br/&gt;
, type int&lt;br/&gt;
)&lt;br/&gt;
PARTITIONED BY (dt string)&lt;br/&gt;
ROW FORMAT DELIMITED &lt;br/&gt;
FIELDS TERMINATED BY &apos;|&apos; &lt;br/&gt;
 STORED AS RCFILE&lt;br/&gt;
LOCATION &apos;/hive/&amp;lt;path&amp;gt;/Table_A&apos;;&lt;/p&gt;

&lt;p&gt;Step 2) Scenario: Lets us say consider user tommy belong to both usertypes 111 and 123. Insert 2 records into the table created above.&lt;/p&gt;

&lt;p&gt;select * from  Table_A;&lt;/p&gt;

&lt;p&gt;hive&amp;gt;  select * from table_a;&lt;br/&gt;
OK&lt;br/&gt;
tommy   123     2013-12-02&lt;br/&gt;
tommy   111     2013-12-02&lt;/p&gt;

&lt;p&gt;Step 3) Create 2 destination tables to simulate multi-insert.&lt;br/&gt;
CREATE EXTERNAL TABLE dest_Table_A&lt;br/&gt;
(&lt;br/&gt;
p_date string&lt;br/&gt;
, Distinct_Users int&lt;br/&gt;
, Type111Users int&lt;br/&gt;
, Type123Users int&lt;br/&gt;
)&lt;br/&gt;
PARTITIONED BY (dt string)&lt;br/&gt;
ROW FORMAT DELIMITED &lt;br/&gt;
FIELDS TERMINATED BY &apos;|&apos; &lt;br/&gt;
 STORED AS RCFILE&lt;br/&gt;
LOCATION &apos;/hive/&amp;lt;path&amp;gt;/dest_Table_A&apos;;&lt;/p&gt;

&lt;p&gt;CREATE EXTERNAL TABLE dest_Table_B&lt;br/&gt;
(&lt;br/&gt;
p_date string&lt;br/&gt;
, Distinct_Users int&lt;br/&gt;
, Type111Users int&lt;br/&gt;
, Type123Users int&lt;br/&gt;
)&lt;br/&gt;
PARTITIONED BY (dt string)&lt;br/&gt;
ROW FORMAT DELIMITED &lt;br/&gt;
FIELDS TERMINATED BY &apos;|&apos; &lt;br/&gt;
 STORED AS RCFILE&lt;br/&gt;
LOCATION &apos;/hive/&amp;lt;path&amp;gt;/dest_Table_B&apos;;&lt;/p&gt;

&lt;p&gt;Step 4) Multi insert statement&lt;br/&gt;
from Table_A a&lt;br/&gt;
INSERT OVERWRITE TABLE dest_Table_A PARTITION(dt=&apos;2013-12-02&apos;)&lt;br/&gt;
select a.dt&lt;br/&gt;
,count(distinct a.user) as AllDist&lt;br/&gt;
,count(distinct case when a.type = 111 then a.user else null end) as Type111User&lt;br/&gt;
,count(distinct case when a.type != 111 then a.user else null end) as Type123User&lt;br/&gt;
group by a.dt&lt;/p&gt;

&lt;p&gt;INSERT OVERWRITE TABLE dest_Table_B PARTITION(dt=&apos;2013-12-02&apos;)&lt;br/&gt;
select a.dt&lt;br/&gt;
,count(distinct a.user) as AllDist&lt;br/&gt;
,count(distinct case when a.type = 111 then a.user else null end) as Type111User&lt;br/&gt;
,count(distinct case when a.type != 111 then a.user else null end) as Type123User&lt;br/&gt;
group by a.dt&lt;br/&gt;
;&lt;/p&gt;

&lt;p&gt;Step 5) Verify results.&lt;br/&gt;
hive&amp;gt;  select * from dest_table_a;&lt;br/&gt;
OK&lt;br/&gt;
2013-12-02      2       1       1       2013-12-02&lt;br/&gt;
Time taken: 0.116 seconds&lt;br/&gt;
hive&amp;gt;  select * from dest_table_b;&lt;br/&gt;
OK&lt;br/&gt;
2013-12-02      2       1       1       2013-12-02&lt;br/&gt;
Time taken: 0.13 seconds&lt;/p&gt;

&lt;p&gt;Conclusion: Hive gives a count of 2 for distinct users although there is &lt;br/&gt;
only one distinct user. After trying many datasets observed that Hive is doing Type111Users + Typoe123Users = DistinctUsers which is wrong.&lt;/p&gt;

&lt;p&gt;hive&amp;gt; select count(distinct a.user) from table_a a;&lt;br/&gt;
Gives:&lt;br/&gt;
Total MapReduce CPU Time Spent: 4 seconds 350 msec&lt;br/&gt;
OK&lt;br/&gt;
1&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12686196">HIVE-6099</key>
            <summary>Multi insert does not work properly with distinct count</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ashutoshc">Ashutosh Chauhan</assignee>
                                    <reporter username="pavangm">Pavan Gadam Manohar</reporter>
                        <labels>
                            <label>TODOC1.2</label>
                            <label>count</label>
                            <label>distinct</label>
                            <label>insert</label>
                            <label>multi-insert</label>
                    </labels>
                <created>Mon, 23 Dec 2013 19:46:18 +0000</created>
                <updated>Mon, 31 Aug 2015 18:20:20 +0000</updated>
                            <resolved>Fri, 6 Feb 2015 01:49:39 +0000</resolved>
                                    <version>0.9.0</version>
                    <version>0.10.0</version>
                    <version>0.11.0</version>
                    <version>0.12.0</version>
                    <version>0.13.0</version>
                    <version>0.14.0</version>
                    <version>1.0.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13873073" author="navis" created="Thu, 16 Jan 2014 06:11:29 +0000"  >&lt;p&gt;I&apos;ve tried with trunk and hive-0.12.0 and all worked as expected (1 for distinct all). Could it be possible that there is a white space or something in &apos;tommy&apos;?&lt;/p&gt;</comment>
                            <comment id="13873078" author="pavangm" created="Thu, 16 Jan 2014 06:23:14 +0000"  >&lt;p&gt;I am consistently able to reproduce in 0.10.0 and 0.9.0... I checked the explain of the multi insert too..&lt;/p&gt;</comment>
                            <comment id="13873085" author="navis" created="Thu, 16 Jan 2014 06:28:11 +0000"  >&lt;p&gt;I&apos;ve seen hive-0.12.0 is included in affects versions, which might be removed. Anyway, It seemingly fixed in later versions. Could you try that?&lt;/p&gt;</comment>
                            <comment id="13873088" author="pavangm" created="Thu, 16 Jan 2014 06:32:06 +0000"  >&lt;p&gt;I have removed affected versions. 0.11.0 and 0.12.0. Do you mind attaching the explain for the multi-insert in 0.12.0. I will compare it with what I get. &lt;/p&gt;</comment>
                            <comment id="13873093" author="navis" created="Thu, 16 Jan 2014 06:37:11 +0000"  >&lt;p&gt;sure&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hive&amp;gt; explain select a.dt,count(distinct a.user) as AllDist,count(distinct case when a.type = 111 then a.user else null end) as Type111User,
    &amp;gt; count(distinct case when a.type != 111 then a.user else null end) as Type123User from Table_A a
    &amp;gt; group by a.dt
    &amp;gt; ;
OK
ABSTRACT SYNTAX TREE:
  (TOK_QUERY (TOK_FROM (TOK_TABREF (TOK_TABNAME Table_A) a)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (. (TOK_TABLE_OR_COL a) dt)) (TOK_SELEXPR (TOK_FUNCTIONDI count (. (TOK_TABLE_OR_COL a) user)) AllDist) (TOK_SELEXPR (TOK_FUNCTIONDI count (TOK_FUNCTION when (= (. (TOK_TABLE_OR_COL a) type) 111) (. (TOK_TABLE_OR_COL a) user) TOK_NULL)) Type111User) (TOK_SELEXPR (TOK_FUNCTIONDI count (TOK_FUNCTION when (!= (. (TOK_TABLE_OR_COL a) type) 111) (. (TOK_TABLE_OR_COL a) user) TOK_NULL)) Type123User)) (TOK_GROUPBY (. (TOK_TABLE_OR_COL a) dt))))

STAGE DEPENDENCIES:
  Stage-1 is a root stage
  Stage-0 is a root stage

STAGE PLANS:
  Stage: Stage-1
    Map Reduce
      Alias -&amp;gt; Map Operator Tree:
        a 
          TableScan
            alias: a
            Select Operator
              expressions:
                    expr: dt
                    type: string
                    expr: user
                    type: string
                    expr: type
                    type: int
              outputColumnNames: dt, user, type
              Group By Operator
                aggregations:
                      expr: count(DISTINCT user)
                      expr: count(DISTINCT CASE WHEN ((type = 111)) THEN (user) ELSE (null) END)
                      expr: count(DISTINCT CASE WHEN ((type &amp;lt;&amp;gt; 111)) THEN (user) ELSE (null) END)
                bucketGroup: false
                keys:
                      expr: dt
                      type: string
                      expr: user
                      type: string
                      expr: CASE WHEN ((type = 111)) THEN (user) ELSE (null) END
                      type: string
                      expr: CASE WHEN ((type &amp;lt;&amp;gt; 111)) THEN (user) ELSE (null) END
                      type: string
                mode: hash
                outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6
                Reduce Output Operator
                  key expressions:
                        expr: _col0
                        type: string
                        expr: _col1
                        type: string
                        expr: _col2
                        type: string
                        expr: _col3
                        type: string
                  sort order: ++++
                  Map-reduce partition columns:
                        expr: _col0
                        type: string
                  tag: -1
                  value expressions:
                        expr: _col4
                        type: bigint
                        expr: _col5
                        type: bigint
                        expr: _col6
                        type: bigint
      Reduce Operator Tree:
        Group By Operator
          aggregations:
                expr: count(DISTINCT KEY._col1:0._col0)
                expr: count(DISTINCT KEY._col1:1._col0)
                expr: count(DISTINCT KEY._col1:2._col0)
          bucketGroup: false
          keys:
                expr: KEY._col0
                type: string
          mode: mergepartial
          outputColumnNames: _col0, _col1, _col2, _col3
          Select Operator
            expressions:
                  expr: _col0
                  type: string
                  expr: _col1
                  type: bigint
                  expr: _col2
                  type: bigint
                  expr: _col3
                  type: bigint
            outputColumnNames: _col0, _col1, _col2, _col3
            File Output Operator
              compressed: false
              GlobalTableId: 0
              table:
                  input format: org.apache.hadoop.mapred.TextInputFormat
                  output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
                  serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe

  Stage: Stage-0
    Fetch Operator
      limit: -1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13873094" author="navis" created="Thu, 16 Jan 2014 06:39:19 +0000"  >&lt;p&gt;Ah, I&apos;ve ran test wrong. I&apos;ll try it again.&lt;/p&gt;</comment>
                            <comment id="13873098" author="navis" created="Thu, 16 Jan 2014 06:47:14 +0000"  >&lt;p&gt;I got it. Ill check this.&lt;/p&gt;</comment>
                            <comment id="13873105" author="pavangm" created="Thu, 16 Jan 2014 06:59:22 +0000"  >&lt;p&gt;This is the explain for Hive 0.10.0. My guess is all higher versions might also have same issue. &lt;/p&gt;</comment>
                            <comment id="13877276" author="navis" created="Tue, 21 Jan 2014 06:40:34 +0000"  >&lt;p&gt;Looks like &quot;hive.optimize.multigroupby.common.distincts&quot; optimization is not valid. I cannot imagine how to collect values of each distinct columns into single group when there are multiple distinct columns in the query. I think the optimization should be disabled.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pavangm&quot; class=&quot;user-hover&quot; rel=&quot;pavangm&quot;&gt;pavangm&lt;/a&gt; set hive.optimize.multigroupby.common.distincts=false might be helpful.&lt;/p&gt;</comment>
                            <comment id="13877894" author="pavangm" created="Tue, 21 Jan 2014 21:50:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; I tried with the setting you mentioned. The issue still exists. &lt;/p&gt;</comment>
                            <comment id="13878083" author="navis" created="Wed, 22 Jan 2014 00:51:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pavangm&quot; class=&quot;user-hover&quot; rel=&quot;pavangm&quot;&gt;pavangm&lt;/a&gt; I&apos;ve confirmed it&apos;s working with the option disabled on trunk. But it&apos;s hard to tell exactly the issue number fixed that.&lt;/p&gt;</comment>
                            <comment id="13878101" author="pavangm" created="Wed, 22 Jan 2014 01:06:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; Can you attach the hive logs with option enabled and then disabled. Also, make sure you are running with atleast two inserts together to simulate multi-insert as mentioned in the ticket. &lt;br/&gt;
Then just mark it as Resolved if you are sure it does not occur in higher versions. &lt;/p&gt;</comment>
                            <comment id="13878110" author="navis" created="Wed, 22 Jan 2014 01:19:58 +0000"  >&lt;p&gt;The query is same with the one you&apos;ve mentioned in issue description. Attached query plan and result with the option enabled/disabled.&lt;/p&gt;</comment>
                            <comment id="13878136" author="pavangm" created="Wed, 22 Jan 2014 01:43:01 +0000"  >&lt;p&gt;Option enabled/disabled did not make any difference in query plan in version 0.10.0. May be this got resolved in 0.12.0 implicitly for some change made. &lt;/p&gt;</comment>
                            <comment id="13878169" author="navis" created="Wed, 22 Jan 2014 02:18:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pavangm&quot; class=&quot;user-hover&quot; rel=&quot;pavangm&quot;&gt;pavangm&lt;/a&gt; I&apos;ve found It&apos;s optionized in hive-0.12.0 (&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3728&quot; title=&quot;make optimizing multi-group by configurable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3728&quot;&gt;&lt;del&gt;HIVE-3728&lt;/del&gt;&lt;/a&gt;), which cannot be disabled pre-0.12.0 versions. Sorry. &lt;/p&gt;</comment>
                            <comment id="13880599" author="navis" created="Fri, 24 Jan 2014 01:27:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pavangm&quot; class=&quot;user-hover&quot; rel=&quot;pavangm&quot;&gt;pavangm&lt;/a&gt; Can we close this?&lt;/p&gt;</comment>
                            <comment id="13880627" author="pavangm" created="Fri, 24 Jan 2014 02:15:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; This is still a problem for many who are using pre-hive-0.12.0. But, as you mentioned there is already a work around available for 0.12.0, You can close this. &lt;/p&gt;</comment>
                            <comment id="14091969" author="ashutoshc" created="Sun, 10 Aug 2014 01:51:24 +0000"  >&lt;p&gt;I think this is still a problem. This conf is on by default on trunk. So, if you run the test query as above, you will get wrong results. &lt;/p&gt;</comment>
                            <comment id="14091984" author="lefty@hortonworks.com" created="Sun, 10 Aug 2014 03:09:09 +0000"  >&lt;p&gt;Just for the record:  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3728&quot; title=&quot;make optimizing multi-group by configurable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3728&quot;&gt;&lt;del&gt;HIVE-3728&lt;/del&gt;&lt;/a&gt; introduced hive.optimize.multigroupby.common.distincts in release 0.11.0, not 0.12.0.  (The JIRA says so and branch-0.11 confirms it.)&lt;/p&gt;</comment>
                            <comment id="14092516" author="navis" created="Mon, 11 Aug 2014 07:13:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=leftylev&quot; class=&quot;user-hover&quot; rel=&quot;leftylev&quot;&gt;leftylev&lt;/a&gt; You are right, as always. I&apos;ve confirmed that it&apos;s included in hive-0.11.0. &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; I cannot sure but the optimization seemed not valid. If this will not be fixed till next release process, we should disabled it by default.&lt;/p&gt;</comment>
                            <comment id="14302613" author="navis" created="Tue, 3 Feb 2015 01:12:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; Could we remove this optimization? I&apos;m sure this is not valid from the start.&lt;/p&gt;</comment>
                            <comment id="14303657" author="ashutoshc" created="Tue, 3 Feb 2015 17:44:09 +0000"  >&lt;p&gt;I will take a look for its validity. &lt;br/&gt;
In the meanwhile, lets turn this off by default, until we decide whether it has any use case at all.&lt;/p&gt;</comment>
                            <comment id="14303695" author="ashutoshc" created="Tue, 3 Feb 2015 18:14:11 +0000"  >&lt;p&gt;Patch to disable this optimization by default.&lt;/p&gt;</comment>
                            <comment id="14304364" author="hiveqa" created="Wed, 4 Feb 2015 00:17:30 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12696235/HIVE-6099.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12696235/HIVE-6099.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 17 failed/errored test(s), 7422 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby10
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby11
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby8
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby8_map
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby8_map_skew
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby8_noskew
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby9
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_udaf_covar_pop
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union17
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_groupby10
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_groupby11
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_groupby8
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_groupby8_map
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_groupby8_map_skew
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_groupby8_noskew
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_groupby9
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_groupby_multi_insert_common_distinct
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2639/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2639/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2639/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2639/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2639/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2639/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 17 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12696235 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14304432" author="ashutoshc" created="Wed, 4 Feb 2015 01:09:44 +0000"  >&lt;p&gt;Funnily, plan generated with optimization off looks better, with one less stage. Not sure how this optimization is suppose to improve query performance. As you, I am also not sure how spraying by distinct keys first and than doing grouping in subsequent stages really works. Further, given that it has bugs which are unfixed for so long, I agree we should remove this optimization.&lt;br/&gt;
I will update the patch with removal of this optimization.&lt;/p&gt;</comment>
                            <comment id="14304492" author="ashutoshc" created="Wed, 4 Feb 2015 02:04:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/30602/diff/#&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/30602/diff/#&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14304503" author="navis" created="Wed, 4 Feb 2015 02:14:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; Good! I&apos;ve leaved some comments in rb. I think we are purging the most complicated parts in GroupByOperator.&lt;/p&gt;</comment>
                            <comment id="14304550" author="ashutoshc" created="Wed, 4 Feb 2015 02:50:44 +0000"  >&lt;p&gt;Updated patch per Navis suggestions. I am not sure firstRowInGroup/startGroup can be removed yet. Do you think they are safe for removal?&lt;/p&gt;</comment>
                            <comment id="14304657" author="navis" created="Wed, 4 Feb 2015 05:16:35 +0000"  >&lt;p&gt;It&apos;s introduced to generated distinct keys for this optimization and seemed not used by other codes. The optimization seemed working with single common distinct column, but I think the overhead for it overrides the good part (and hard to read). But.. let&apos;s see the result of test.&lt;/p&gt;</comment>
                            <comment id="14306246" author="hiveqa" created="Wed, 4 Feb 2015 23:51:06 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12696543/HIVE-6099.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12696543/HIVE-6099.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 2 failed/errored test(s), 7475 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hive.hcatalog.streaming.TestStreaming.testRemainingTransactions
org.apache.hive.spark.client.TestSparkClient.testSyncRpc
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2656/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2656/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2656/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2656/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2656/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2656/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12696543 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14306708" author="ashutoshc" created="Thu, 5 Feb 2015 06:05:37 +0000"  >&lt;p&gt;Updated patch incorporating RB comments.&lt;/p&gt;</comment>
                            <comment id="14308314" author="hiveqa" created="Fri, 6 Feb 2015 00:14:40 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12696678/HIVE-6099.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12696678/HIVE-6099.4.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 2 failed/errored test(s), 7476 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.thrift.TestHadoop20SAuthBridge.testMetastoreProxyUser
org.apache.hadoop.hive.thrift.TestHadoop20SAuthBridge.testSaslWithHiveMetaStore
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2675/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2675/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2675/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2675/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2675/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2675/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12696678 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14308399" author="ashutoshc" created="Fri, 6 Feb 2015 01:15:55 +0000"  >&lt;p&gt;Failures are unrelated to patch. &lt;/p&gt;</comment>
                            <comment id="14308401" author="navis" created="Fri, 6 Feb 2015 01:17:30 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14308440" author="ashutoshc" created="Fri, 6 Feb 2015 01:49:39 +0000"  >&lt;p&gt;Committed to trunk.&lt;/p&gt;</comment>
                            <comment id="14308856" author="lefty@hortonworks.com" created="Fri, 6 Feb 2015 08:49:41 +0000"  >&lt;p&gt;Doc note:  This removes configuration parameter &lt;b&gt;hive.optimize.multigroupby.common.distincts&lt;/b&gt; from HiveConf.java in version 1.2.0.  It was introduced in 0.11.0 by &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3728&quot; title=&quot;make optimizing multi-group by configurable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3728&quot;&gt;&lt;del&gt;HIVE-3728&lt;/del&gt;&lt;/a&gt; and hasn&apos;t been documented yet.  The Configuration Properties wikidoc should specify that it exists in versions 0.11.0 through 1.1.0, with links to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3728&quot; title=&quot;make optimizing multi-group by configurable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3728&quot;&gt;&lt;del&gt;HIVE-3728&lt;/del&gt;&lt;/a&gt; and this issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-6099&quot; title=&quot;Multi insert does not work properly with distinct count&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-6099&quot;&gt;&lt;del&gt;HIVE-6099&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-QueryandDDLExecution&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Configuration Properties &amp;#8211; Query and DDL Execution &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14548900" author="sushanth" created="Mon, 18 May 2015 19:53:12 +0000"  >&lt;p&gt;This issue has been fixed and released as part of the 1.2.0 release. If you find an issue which seems to be related to this one, please create a new jira and link this one with new jira.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12617051">HIVE-3728</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12696354" name="HIVE-6099.1.patch" size="234941" author="ashutoshc" created="Wed, 4 Feb 2015 02:03:35 +0000"/>
                            <attachment id="12696365" name="HIVE-6099.2.patch" size="248268" author="ashutoshc" created="Wed, 4 Feb 2015 02:50:44 +0000"/>
                            <attachment id="12696543" name="HIVE-6099.3.patch" size="248264" author="ashutoshc" created="Wed, 4 Feb 2015 20:05:22 +0000"/>
                            <attachment id="12696678" name="HIVE-6099.4.patch" size="249468" author="ashutoshc" created="Thu, 5 Feb 2015 06:05:37 +0000"/>
                            <attachment id="12696235" name="HIVE-6099.patch" size="7627" author="ashutoshc" created="Tue, 3 Feb 2015 18:14:11 +0000"/>
                            <attachment id="12623322" name="explain_hive_0.10.0.txt" size="9332" author="pavangm" created="Thu, 16 Jan 2014 06:59:22 +0000"/>
                            <attachment id="12624247" name="with_disabled.txt" size="6146" author="navis" created="Wed, 22 Jan 2014 01:17:40 +0000"/>
                            <attachment id="12624248" name="with_enabled.txt" size="8967" author="navis" created="Wed, 22 Jan 2014 01:17:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>365169</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 27 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1qxy7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>365474</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>