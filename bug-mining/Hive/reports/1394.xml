<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:08:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-4051] Hive&apos;s metastore suffers from 1+N queries when querying partitions &amp; is slow</title>
                <link>https://issues.apache.org/jira/browse/HIVE-4051</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Hive&apos;s query client takes a long time to initialize &amp;amp; start planning queries because of delays in creating all the MTable/MPartition objects.&lt;/p&gt;

&lt;p&gt;For a hive db with 1800 partitions, the metastore took 6-7 seconds to initialize - firing approximately 5900 queries to the mysql database.&lt;/p&gt;

&lt;p&gt;Several of those queries fetch exactly one row to create a single object on the client.&lt;/p&gt;

&lt;p&gt;The following 12 queries were repeated for each partition, generating a storm of SQL queries &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;4 Query     SELECT `A0`.`SD_ID`,`B0`.`INPUT_FORMAT`,`B0`.`IS_COMPRESSED`,`B0`.`IS_STOREDASSUBDIRECTORIES`,`B0`.`LOCATION`,`B0`.`NUM_BUCKETS`,`B0`.`OUTPUT_FORMAT`,`B0`.`SD_ID` FROM `PARTITIONS` `A0` LEFT OUTER JOIN `SDS` `B0` ON `A0`.`SD_ID` = `B0`.`SD_ID` WHERE `A0`.`PART_ID` = 3945
4 Query     SELECT `A0`.`CD_ID`,`B0`.`CD_ID` FROM `SDS` `A0` LEFT OUTER JOIN `CDS` `B0` ON `A0`.`CD_ID` = `B0`.`CD_ID` WHERE `A0`.`SD_ID` =4871
4 Query     SELECT COUNT(*) FROM `COLUMNS_V2` THIS WHERE THIS.`CD_ID`=1546 AND THIS.`INTEGER_IDX`&amp;gt;=0
4 Query     SELECT `A0`.`COMMENT`,`A0`.`COLUMN_NAME`,`A0`.`TYPE_NAME`,`A0`.`INTEGER_IDX` AS NUCORDER0 FROM `COLUMNS_V2` `A0` WHERE `A0`.`CD_ID` = 1546 AND `A0`.`INTEGER_IDX` &amp;gt;= 0 ORDER BY NUCORDER0
4 Query     SELECT `A0`.`SERDE_ID`,`B0`.`NAME`,`B0`.`SLIB`,`B0`.`SERDE_ID` FROM `SDS` `A0` LEFT OUTER JOIN `SERDES` `B0` ON `A0`.`SERDE_ID` = `B0`.`SERDE_ID` WHERE `A0`.`SD_ID` =4871
4 Query     SELECT COUNT(*) FROM `SORT_COLS` THIS WHERE THIS.`SD_ID`=4871 AND THIS.`INTEGER_IDX`&amp;gt;=0
4 Query     SELECT `A0`.`COLUMN_NAME`,`A0`.`ORDER`,`A0`.`INTEGER_IDX` AS NUCORDER0 FROM `SORT_COLS` `A0` WHERE `A0`.`SD_ID` =4871 AND `A0`.`INTEGER_IDX` &amp;gt;= 0 ORDER BY NUCORDER0
4 Query     SELECT COUNT(*) FROM `SKEWED_VALUES` THIS WHERE THIS.`SD_ID_OID`=4871 AND THIS.`INTEGER_IDX`&amp;gt;=0
4 Query     SELECT &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.hadoop.hive.metastore.model.MStringList&apos;&lt;/span&gt; AS NUCLEUS_TYPE,`A1`.`STRING_LIST_ID`,`A0`.`INTEGER_IDX` AS NUCORDER0 FROM `SKEWED_VALUES` `A0` INNER JOIN `SKEWED_STRING_LIST` `A1` ON `A0`.`STRING_LIST_ID_EID` = `A1`.`STRING_LIST_ID` WHERE `A0`.`SD_ID_OID` =4871 AND `A0`.`INTEGER_IDX` &amp;gt;= 0 ORDER BY NUCORDER0
4 Query     SELECT COUNT(*) FROM `SKEWED_COL_VALUE_LOC_MAP` WHERE `SD_ID` =4871 AND `STRING_LIST_ID_KID` IS NOT NULL
4 Query     SELECT &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.hadoop.hive.metastore.model.MStringList&apos;&lt;/span&gt; AS NUCLEUS_TYPE,`A0`.`STRING_LIST_ID` FROM `SKEWED_STRING_LIST` `A0` INNER JOIN `SKEWED_COL_VALUE_LOC_MAP` `B0` ON `A0`.`STRING_LIST_ID` = `B0`.`STRING_LIST_ID_KID` WHERE `B0`.`SD_ID` =4871
4 Query     SELECT `A0`.`STRING_LIST_ID_KID`,`A0`.`LOCATION` FROM `SKEWED_COL_VALUE_LOC_MAP` `A0` WHERE `A0`.`SD_ID` =4871 AND NOT (`A0`.`STRING_LIST_ID_KID` IS NULL)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This data is not detached or cached, so this operation is performed during every query plan for the partitions, even in the same hive client.&lt;/p&gt;

&lt;p&gt;The queries are automatically generated by JDO/DataNucleus which makes it nearly impossible to rewrite it into a single denormalized join operation &amp;amp; process it locally.&lt;/p&gt;

&lt;p&gt;Attempts to optimize this with JDO fetch-groups did not bear fruit in improving the query count.&lt;/p&gt;</description>
                <environment>&lt;p&gt;RHEL 6.3 / EC2 C1.XL&lt;/p&gt;</environment>
        <key id="12633522">HIVE-4051</key>
            <summary>Hive&apos;s metastore suffers from 1+N queries when querying partitions &amp; is slow</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sershe">Sergey Shelukhin</assignee>
                                    <reporter username="gopalv">Gopal Vijayaraghavan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Feb 2013 01:25:39 +0000</created>
                <updated>Tue, 25 Mar 2014 07:28:19 +0000</updated>
                            <resolved>Wed, 7 Aug 2013 05:30:29 +0000</resolved>
                                                    <fixVersion>0.12.0</fixVersion>
                                    <component>Clients</component>
                    <component>Metastore</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>18</watches>
                                                                                                                <comments>
                            <comment id="13714281" author="sershe" created="Sat, 20 Jul 2013 00:58:43 +0000"  >&lt;p&gt;I am actually getting 16 queries... 3 by PART_ID (itself, values, params), 10 per its SD_ID, 2 for SD_ID_OID (might also be SD_ID?), and 1 for SERDE.&lt;br/&gt;
Some normalization doesn&apos;t make any sense, e.g.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;mysql&amp;gt; select name, slib, count(1) from SERDES;
+------+----------------------------------------------------+----------+
| name | slib                                               | count(1) |
+------+----------------------------------------------------+----------+
| NULL | org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe |    32769 |
+------+----------------------------------------------------+----------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;if stored for each row 1-on-1 anyway, why not just store it in the row?&lt;/p&gt;

&lt;p&gt;I am looking in the direction of doing a full-string query returning a bag of fields, rather than MPartition, so that per-object calls are not done. Then SDs can be fetched with join, etc.&lt;br/&gt;
One thing that is not quite clear is how to do fetch from separate tables for which DN object doesn&apos;t exist e.g. PARTITION_KEY_VALS. Ideally we would fetch all of these for all necessary partitions in one query and put them into objects.&lt;/p&gt;

&lt;p&gt;If all else fails we can use SQL &lt;a href=&quot;http://www.datanucleus.org/products/datanucleus/jdo/sql.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.datanucleus.org/products/datanucleus/jdo/sql.html&lt;/a&gt;, but it will halfway defeat the purpose of having DN in the first place, since it becomes RDBMS-dependent.&lt;/p&gt;

&lt;p&gt;In fact to avoid warring with datanucleus perhaps we could do SQL as storage-specific optimization, configurable for metastore, and fall back to ORM if disabled.&lt;/p&gt;</comment>
                            <comment id="13719045" author="phabricator@reviews.facebook.net" created="Wed, 24 Jul 2013 23:53:46 +0000"  >&lt;p&gt;sershe requested code review of &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Hive&apos;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot;.&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;Preliminary patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt; (ready for review).&lt;br/&gt;
This introduces &quot;direct SQL&quot; optimization for metastore.&lt;br/&gt;
When memstore gets partitions by filter or by names, it does so using ANSI SQL92 queries, if enabled (default).&lt;br/&gt;
This will not work on non-RDBMS datastores, may not work on non-ANSI-compiant ones (I tested on mysql in default mode).&lt;br/&gt;
If disabled, or if any error happens, it will use the default DataNucleus code.&lt;br/&gt;
When it does work, which is most practical cases, with local mysql it produces up to x20 speedup for getting large number of partitions.&lt;br/&gt;
SQL queries can be further optimized to achieve even more, presumably - see some comments in the code. That will be done as separate JIRAs.&lt;/p&gt;

&lt;p&gt;So far the patch has no tests, because it is peculiar to the storage engine, so I need to look if derby test makes sense.&lt;br/&gt;
Another question is whether it makes sense to put SQL antics into separate class.&lt;br/&gt;
Let me run HIVE QA (some test have run on local). After discussion I will update the patch, but the core is ready for review.&lt;/p&gt;


&lt;p&gt;Hive&apos;s query client takes a long time to initialize &amp;amp; start planning queries because of delays in creating all the MTable/MPartition objects.&lt;/p&gt;

&lt;p&gt;For a hive db with 1800 partitions, the metastore took 6-7 seconds to initialize - firing approximately 5900 queries to the mysql database.&lt;/p&gt;

&lt;p&gt;Several of those queries fetch exactly one row to create a single object on the client.&lt;/p&gt;

&lt;p&gt;The following 12 queries were repeated for each partition, generating a storm of SQL queries&lt;/p&gt;

&lt;p&gt;4 Query     SELECT `A0`.`SD_ID`,`B0`.`INPUT_FORMAT`,`B0`.`IS_COMPRESSED`,`B0`.`IS_STOREDASSUBDIRECTORIES`,`B0`.`LOCATION`,`B0`.`NUM_BUCKETS`,`B0`.`OUTPUT_FORMAT`,`B0`.`SD_ID` FROM `PARTITIONS` `A0` LEFT OUTER JOIN `SDS` `B0` ON `A0`.`SD_ID` = `B0`.`SD_ID` WHERE `A0`.`PART_ID` = 3945&lt;br/&gt;
4 Query     SELECT `A0`.`CD_ID`,`B0`.`CD_ID` FROM `SDS` `A0` LEFT OUTER JOIN `CDS` `B0` ON `A0`.`CD_ID` = `B0`.`CD_ID` WHERE `A0`.`SD_ID` =4871&lt;br/&gt;
4 Query     SELECT COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; FROM `COLUMNS_V2` THIS WHERE THIS.`CD_ID`=1546 AND THIS.`INTEGER_IDX`&amp;gt;=0&lt;br/&gt;
4 Query     SELECT `A0`.`COMMENT`,`A0`.`COLUMN_NAME`,`A0`.`TYPE_NAME`,`A0`.`INTEGER_IDX` AS NUCORDER0 FROM `COLUMNS_V2` `A0` WHERE `A0`.`CD_ID` = 1546 AND `A0`.`INTEGER_IDX` &amp;gt;= 0 ORDER BY NUCORDER0&lt;br/&gt;
4 Query     SELECT `A0`.`SERDE_ID`,`B0`.`NAME`,`B0`.`SLIB`,`B0`.`SERDE_ID` FROM `SDS` `A0` LEFT OUTER JOIN `SERDES` `B0` ON `A0`.`SERDE_ID` = `B0`.`SERDE_ID` WHERE `A0`.`SD_ID` =4871&lt;br/&gt;
4 Query     SELECT COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; FROM `SORT_COLS` THIS WHERE THIS.`SD_ID`=4871 AND THIS.`INTEGER_IDX`&amp;gt;=0&lt;br/&gt;
4 Query     SELECT `A0`.`COLUMN_NAME`,`A0`.`ORDER`,`A0`.`INTEGER_IDX` AS NUCORDER0 FROM `SORT_COLS` `A0` WHERE `A0`.`SD_ID` =4871 AND `A0`.`INTEGER_IDX` &amp;gt;= 0 ORDER BY NUCORDER0&lt;br/&gt;
4 Query     SELECT COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; FROM `SKEWED_VALUES` THIS WHERE THIS.`SD_ID_OID`=4871 AND THIS.`INTEGER_IDX`&amp;gt;=0&lt;br/&gt;
4 Query     SELECT &apos;org.apache.hadoop.hive.metastore.model.MStringList&apos; AS NUCLEUS_TYPE,`A1`.`STRING_LIST_ID`,`A0`.`INTEGER_IDX` AS NUCORDER0 FROM `SKEWED_VALUES` `A0` INNER JOIN `SKEWED_STRING_LIST` `A1` ON `A0`.`STRING_LIST_ID_EID` = `A1`.`STRING_LIST_ID` WHERE `A0`.`SD_ID_OID` =4871 AND `A0`.`INTEGER_IDX` &amp;gt;= 0 ORDER BY NUCORDER0&lt;br/&gt;
4 Query     SELECT COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; FROM `SKEWED_COL_VALUE_LOC_MAP` WHERE `SD_ID` =4871 AND `STRING_LIST_ID_KID` IS NOT NULL&lt;br/&gt;
4 Query     SELECT &apos;org.apache.hadoop.hive.metastore.model.MStringList&apos; AS NUCLEUS_TYPE,`A0`.`STRING_LIST_ID` FROM `SKEWED_STRING_LIST` `A0` INNER JOIN `SKEWED_COL_VALUE_LOC_MAP` `B0` ON `A0`.`STRING_LIST_ID` = `B0`.`STRING_LIST_ID_KID` WHERE `B0`.`SD_ID` =4871&lt;br/&gt;
4 Query     SELECT `A0`.`STRING_LIST_ID_KID`,`A0`.`LOCATION` FROM `SKEWED_COL_VALUE_LOC_MAP` `A0` WHERE `A0`.`SD_ID` =4871 AND NOT (`A0`.`STRING_LIST_ID_KID` IS NULL)&lt;/p&gt;

&lt;p&gt;This data is not detached or cached, so this operation is performed during every query plan for the partitions, even in the same hive client.&lt;/p&gt;

&lt;p&gt;The queries are automatically generated by JDO/DataNucleus which makes it nearly impossible to rewrite it into a single denormalized join operation &amp;amp; process it locally.&lt;/p&gt;

&lt;p&gt;Attempts to optimize this with JDO fetch-groups did not bear fruit in improving the query count.&lt;/p&gt;

&lt;p&gt;TEST PLAN&lt;br/&gt;
  EMPTY&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11805&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D11805&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  build.xml&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java&lt;/p&gt;

&lt;p&gt;MANAGE HERALD RULES&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/view/differential/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/herald/view/differential/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WHY DID I GET THIS EMAIL?&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/transcript/28047/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/herald/transcript/28047/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, sershe&lt;/p&gt;</comment>
                            <comment id="13719782" author="hiveqa" created="Thu, 25 Jul 2013 17:06:02 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12594063/HIVE-4051.D11805.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12594063/HIVE-4051.D11805.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 230 failed/errored test(s), 2651 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_drop_multi_partitions
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_sort_merge_join_desc_6
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_multi7
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketsortoptimize_insert_1
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_quote1
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_nullgroup5
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_escape1
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketmapjoin2
org.apache.hadoop.hive.metastore.TestRemoteHiveMetaStore.testFilterSinglePartition
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input_part10
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input_part5
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_mapjoin_hook
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketsortoptimize_insert_8
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby_map_ppr
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_insert4
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_part
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_smb_mapjoin_19
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_bitmap_rc
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_filter_join_breaktask
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union_ppr
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union_lateralview
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_auto_join9
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ppr_pushdown2
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_hook_context_cs
org.apache.hcatalog.listener.TestNotificationListener.testAMQListener
org.apache.hcatalog.pig.TestHCatStorer.testPartColsInData
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_smb_mapjoin_12
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part6
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_merge_dynamic_partition
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_insert_into2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ppr_pushdown
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_smb_mapjoin_11
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_mapjoin_distinct
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats10
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat7
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_compact_2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_sort_merge_join_desc_5
org.apache.hcatalog.pig.TestHCatLoader.testReadPartitionedBasic
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input_part0
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auto_partitioned
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_multi2
org.apache.hcatalog.mapreduce.TestHCatPartitioned.testHCatPartitionedTable
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_smb_mapjoin_10
org.apache.hadoop.hive.metastore.TestRemoteHiveMetaStore.testPartitionFilter
org.apache.hadoop.hive.metastore.TestSetUGIOnBothClientServer.testFilterSinglePartition
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_alter5
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_drop_partitions_ignore_protection
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union_view
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part5
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketsortoptimize_insert_7
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_nonmr_fetch
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input25
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union26
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_transform_ppr2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_merge_dynamic_partition5
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_auto_join25
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_serde_format
org.apache.hadoop.hive.metastore.TestEmbeddedHiveMetaStore.testPartitionFilter
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_smb_mapjoin_20
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_disallow_incompatible_type_change_on2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_lock2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_merge_dynamic_partition2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketsortoptimize_insert_6
org.apache.hadoop.hive.ql.parse.TestParse.testParse_input_part1
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_partspec5
org.apache.hadoop.hive.metastore.TestEmbeddedHiveMetaStore.testFilterLastPartition
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_multi1
org.apache.hcatalog.pig.TestOrcHCatLoader.testReadPartitionedBasic
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_filter_join_breaktask2
org.apache.hadoop.hive.metastore.TestSetUGIOnOnlyServer.testPartitionFilter
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_authorization_2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketmapjoin12
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_smb_mapjoin_18
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_bitmap_auto_partitioned
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_alter_partition_offline
org.apache.hadoop.hive.metastore.TestSetUGIOnOnlyClient.testFilterLastPartition
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_alter_partition_protect_mode
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_insert2_overwrite_partitions
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_global_limit
org.apache.hadoop.hive.ql.parse.TestParse.testParse_sample1
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input_part1
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_router_join_ppr
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_truncate_column
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_compact
org.apache.hadoop.hive.metastore.TestEmbeddedHiveMetaStore.testFilterSinglePartition
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_merge_dynamic_partition4
org.apache.hadoop.hive.metastore.TestSetUGIOnOnlyServer.testFilterLastPartition
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_sample1
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_mi
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_fail_5
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input42
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_alter_merge_2
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_protectmode_tbl7
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_inputddl7
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_partspec2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_archive_multi
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_create_or_replace_view
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_merge4
org.apache.hcatalog.mapreduce.TestHCatDynamicPartitioned.testHCatDynamicPartitionedTableMultipleTask
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_dynamic_partitions_with_whitelist
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketmapjoin8
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_smb_mapjoin_21
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_bitmap
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_smb_mapjoin9
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input28
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_insertexternal1
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input_part9
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ppr_allchildsarenull
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_sa_fail_hook3
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_sample8
org.apache.hcatalog.mapreduce.TestHCatHiveThriftCompatibility.testDynamicCols
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_multi4
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketsortoptimize_insert_5
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_join14_hadoop20
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input_part2
org.apache.hadoop.hive.metastore.TestSetUGIOnBothClientServer.testPartitionFilter
org.apache.hadoop.hive.metastore.TestSetUGIOnBothClientServer.testFilterLastPartition
org.apache.hadoop.hive.metastore.TestSetUGIOnOnlyServer.testFilterSinglePartition
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auto_mult_tables
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_protectmode
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_lock4
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_union22
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_protectmode_part
org.apache.hcatalog.fileformats.TestOrcDynamicPartitioned.testHCatDynamicPartitionedTable
org.apache.hcatalog.fileformats.TestOrcDynamicPartitioned.testHCatDynamicPartitionedTableMultipleTask
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_rename_external_partition_location
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partitions_json
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_partspec1
org.apache.hadoop.hive.metastore.TestSetUGIOnOnlyClient.testFilterSinglePartition
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_truncate_table
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_noscan_2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketsortoptimize_insert_4
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby_ppr_multi_distinct
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_inputddl6
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_pcr
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_partspec3
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ppd2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby_sort_6
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_alter_partition_nodrop
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_fail_4
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketmapjoin_negative
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_multi3
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_rand_partitionpruner2
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_multi6
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_rcfile_merge1
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats3
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_insert1
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auto_unused
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_alter3
org.apache.hadoop.hive.metastore.TestMetaStoreEventListener.testListener
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_disallow_incompatible_type_change_on1
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ppd_union_view
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input40
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby_map_ppr_multi_distinct
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketmapjoin3
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_louter_join_ppr
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_alter_partition_coltype
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucket_groupby
org.apache.hadoop.hive.ql.security.TestAuthorizationPreEventListener.testListener
org.apache.hcatalog.security.TestHdfsAuthorizationProvider.testAddDropPartition
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_fail_3
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_stale_partitioned
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part2
org.apache.hcatalog.security.TestHdfsAuthorizationProvider.testDropPartitionFail2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucket3
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_auto_join14_hadoop20
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_insert2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part7
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_partspec4
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_insert1_overwrite_partitions
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats11
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_concatenate_inherit_table_location
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_disallow_incompatible_type_change_off
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input26
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_loadpart1
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_lock3
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_create_view_partitioned
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketsortoptimize_insert_2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_join9
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby_sort_8
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_protectmode_part_no_drop
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_multi5
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union25
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input24
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part11
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auth
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_lockneg4
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union22
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketsortoptimize_insert_3
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_touch
org.apache.hcatalog.api.TestHCatClient.testGetPartitionsWithPartialSpec
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_combine3
org.apache.hadoop.hive.metastore.TestSetUGIOnOnlyClient.testPartitionFilter
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_bucket_mapjoin_mismatch1
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_rename_partition_location
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby_sort_7
org.apache.hcatalog.api.TestHCatClient.testPartitionsHCatClientImpl
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input_part8
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_auto_join19
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input39_hadoop20
org.apache.hcatalog.mapreduce.TestHCatDynamicPartitioned.testHCatDynamicPartitionedTable
org.apache.hcatalog.security.TestHdfsAuthorizationProvider.testDropPartitionFail1
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_updateAccessTime
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_drop_partitions_filter
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_database_drop
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive1
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auto_mult_tables_compact
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_archive_insert3
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat4
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_protectmode_tbl8
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input23
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input_part7
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketmapjoin13
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketmapjoin1
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_lockneg3
org.apache.hcatalog.pig.TestHCatStorer.testStoreInPartiitonedTbl
org.apache.hcatalog.mapreduce.TestHCatHiveCompatibility.testPartedRead
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_view_cast
org.apache.hadoop.hive.metastore.TestRemoteHiveMetaStore.testFilterLastPartition
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketmapjoin9
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby_ppr
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_protectmode_part1
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_alter_rename_partition
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ppd_udf_case
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_database
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_bucketmapjoin7
org.apache.hcatalog.api.TestHCatClient.testDropPartitionsWithPartialSpec
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby_sort_9
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_lateral_view_ppd
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/182/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/182/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/182/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/182/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.CleanupPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests failed with: TestsFailedException: 230 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13721505" author="phabricator@reviews.facebook.net" created="Sat, 27 Jul 2013 02:53:46 +0000"  >&lt;p&gt;sershe updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Hive&apos;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot;.&lt;/p&gt;

&lt;p&gt;  Fixed mishandling of transactions, lack of support for limit, and boolean fields failing on Derby. Some random tests I ran pass, will run all tests overnight.&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11805&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D11805&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11805?vs=36135&amp;amp;id=36357#toc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D11805?vs=36135&amp;amp;id=36357#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  build.xml&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java&lt;/p&gt;

&lt;p&gt;To: JIRA, sershe&lt;/p&gt;</comment>
                            <comment id="13721584" author="hiveqa" created="Sat, 27 Jul 2013 09:07:33 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12594511/HIVE-4051.D11805.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12594511/HIVE-4051.D11805.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 59 failed/errored test(s), 2653 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ppr_pushdown2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_select_unquote_or
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_bitmap_rc
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_insert_into2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auto_partitioned
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_compact_2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_select_unquote_and
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat11
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_explain_dependency2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union_view
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_sample10
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_special_char
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part12
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_bitmap_auto_partitioned
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part3
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_compact
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_inputddl7
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_archive_multi
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_mi
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_combine2_hadoop20
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_alter_merge_2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_merge_dynamic_partition3
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part4
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_columnstats_partlvl
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_bitmap
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats4
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_merge3
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_decode_name
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auto_mult_tables
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat12
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ql_rewrite_gbtoidx
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_noscan_2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part10
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats12
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ppd2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby_sort_6
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auto_unused
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_alter_partition_coltype
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_stale_partitioned
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucket_groupby
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_explain_dependency
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_concatenate_inherit_table_location
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auth
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat5
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_input24
org.apache.hcatalog.api.TestHCatClient.testGetPartitionsWithPartialSpec
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part8
org.apache.hcatalog.api.TestHCatClient.testPartitionsHCatClientImpl
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_explain_logical
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_rename_partition_location
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_select_unquote_not
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part9
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_updateAccessTime
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats7
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auto_mult_tables_compact
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_database_drop
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ppd_constant_where
org.apache.hcatalog.api.TestHCatClient.testDropPartitionsWithPartialSpec
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/206/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/206/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/206/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/206/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.CleanupPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests failed with: TestsFailedException: 59 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13721696" author="phabricator@reviews.facebook.net" created="Sat, 27 Jul 2013 17:33:46 +0000"  >&lt;p&gt;brock has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Hive&apos;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot;.&lt;/p&gt;

&lt;p&gt;  Comments about handling of error.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:2074 In general I am supportive of this patch but we should not be catching Throwable here. We should at most catch Exceptuon.&lt;/p&gt;

&lt;p&gt;  Additionally log4j now supports passing exceptions directly, the stringifyException is no longer needed, you can pass the exception as the second arg of the log method.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11805&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D11805&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, sershe&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13724152" author="sershe" created="Tue, 30 Jul 2013 17:49:50 +0000"  >&lt;p&gt;I&apos;ve fixed most of the queries, there are a couple of bugs and sorting is undefined (and changed as we no longer sort by partition name) in some tests, couple stubborn ones remain, hopefully will update today&lt;/p&gt;</comment>
                            <comment id="13724160" author="lchouinard" created="Tue, 30 Jul 2013 17:53:48 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I will be on vacation from July 29th to August 6th inclusively. For any question or emergency, please contact the group MTL-IT-Production-Tools@ubisoft.com&amp;lt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;mailto:MTL-IT-Production-Tools@ubisoft.com&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;MTL-IT-Production-Tools@ubisoft.com&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/mail_small.gif&quot; height=&quot;12&quot; width=&quot;13&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;

&lt;p&gt;Laurent Chouinard&lt;br/&gt;
IT Production - Tools Programmer&lt;/p&gt;

</comment>
                            <comment id="13724607" author="phabricator@reviews.facebook.net" created="Tue, 30 Jul 2013 23:29:48 +0000"  >&lt;p&gt;sershe updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Hive&apos;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot;.&lt;/p&gt;

&lt;p&gt;  Addressed Phabricator comments, fixed minor bugs (e.g. null checks, setTableName called instead of setDbName), added column schemas that ended up being needed after all, cleaned up the code a bit, added some short circuiting, added order to tests that had undefined order and so depended on the order in which partitions are returned (ORM code returns them by name, SQL by ID).&lt;br/&gt;
  Added some short-circuiting to the queries/getting stuff.&lt;br/&gt;
  I compared the reflection-based dump of SQL- and ORM- based objects from some tests (code not included) and they are the same.&lt;/p&gt;

&lt;p&gt;  The existing tests seem to adequately cover this code. The only concern is that if it fails it&apos;s impossible to see as it falls back to ORM...&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11805&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D11805&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11805?vs=36357&amp;amp;id=36615#toc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D11805?vs=36357&amp;amp;id=36615#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  build.xml&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/alter_partition_coltype.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/load_dyn_part3.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/load_dyn_part4.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/load_dyn_part9.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/ppr_pushdown2.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/stats4.q&lt;br/&gt;
  ql/src/test/results/clientpositive/load_dyn_part3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/load_dyn_part4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/load_dyn_part9.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/ppr_pushdown2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/stats4.q.out&lt;/p&gt;

&lt;p&gt;To: JIRA, sershe&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13724630" author="phabricator@reviews.facebook.net" created="Tue, 30 Jul 2013 23:53:47 +0000"  >&lt;p&gt;sershe updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Hive&apos;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot;.&lt;/p&gt;

&lt;p&gt;  Followup - forgot to rerun one query after changing.&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11805&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D11805&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11805?vs=36615&amp;amp;id=36621#toc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D11805?vs=36615&amp;amp;id=36621#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  build.xml&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/alter_partition_coltype.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/load_dyn_part3.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/load_dyn_part4.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/load_dyn_part9.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/ppr_pushdown2.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/stats4.q&lt;br/&gt;
  ql/src/test/results/clientpositive/alter_partition_coltype.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/load_dyn_part3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/load_dyn_part4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/load_dyn_part9.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/ppr_pushdown2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/stats4.q.out&lt;/p&gt;

&lt;p&gt;To: JIRA, sershe&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13724737" author="hiveqa" created="Wed, 31 Jul 2013 01:42:44 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 no tests executed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12595079/HIVE-4051.D11805.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12595079/HIVE-4051.D11805.4.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/251/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/251/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/251/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/251/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Tests failed with: NonZeroExitCodeException: Command &apos;bash /data/hive-ptest/working/scratch/source-prep.sh&apos; failed with exit status 1 and output &apos;+ [[ -n &apos;&apos; ]]
+ export &apos;ANT_OPTS=-Xmx1g -XX:MaxPermSize=256m -Dhttp.proxyHost=localhost -Dhttp.proxyPort=3128&apos;
+ ANT_OPTS=&apos;-Xmx1g -XX:MaxPermSize=256m -Dhttp.proxyHost=localhost -Dhttp.proxyPort=3128&apos;
+ cd /data/hive-ptest/working/
+ tee /data/hive-ptest/logs/PreCommit-HIVE-Build-251/source-prep.txt
+ mkdir -p maven ivy
+ [[ svn = \s\v\n ]]
+ [[ -n &apos;&apos; ]]
+ [[ -d apache-svn-trunk-source ]]
+ [[ ! -d apache-svn-trunk-source/.svn ]]
+ [[ ! -d apache-svn-trunk-source ]]
+ cd apache-svn-trunk-source
+ svn revert -R .
Reverted &apos;ql/src/java/org/apache/hadoop/hive/ql/exec/JoinOperator.java&apos;
Reverted &apos;ql/src/java/org/apache/hadoop/hive/ql/exec/MapJoinOperator.java&apos;
Reverted &apos;ql/src/java/org/apache/hadoop/hive/ql/exec/CommonJoinOperator.java&apos;
++ egrep -v &apos;^X|^Performing status on external&apos;
++ awk &apos;{print $2}&apos;
++ svn status --no-ignore
+ rm -rf build hcatalog/build hcatalog/core/build hcatalog/storage-handlers/hbase/build hcatalog/server-extensions/build hcatalog/webhcat/svr/build hcatalog/webhcat/java-client/build hcatalog/hcatalog-pig-adapter/build common/src/gen
+ svn update

Fetching external item into &apos;hcatalog/src/test/e2e/harness&apos;
External at revision 1508705.

At revision 1508705.
+ patchCommandPath=/data/hive-ptest/working/scratch/smart-apply-patch.sh
+ patchFilePath=/data/hive-ptest/working/scratch/build.patch
+ [[ -f /data/hive-ptest/working/scratch/build.patch ]]
+ chmod +x /data/hive-ptest/working/scratch/smart-apply-patch.sh
+ /data/hive-ptest/working/scratch/smart-apply-patch.sh /data/hive-ptest/working/scratch/build.patch
The patch does not appear to apply with p0 to p2
+ exit 1
&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13724749" author="hiveqa" created="Wed, 31 Jul 2013 01:54:49 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 no tests executed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12595079/HIVE-4051.D11805.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12595079/HIVE-4051.D11805.4.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/252/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/252/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/252/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/252/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Tests failed with: NonZeroExitCodeException: Command &apos;bash /data/hive-ptest/working/scratch/source-prep.sh&apos; failed with exit status 1 and output &apos;+ [[ -n &apos;&apos; ]]
+ export &apos;ANT_OPTS=-Xmx1g -XX:MaxPermSize=256m -Dhttp.proxyHost=localhost -Dhttp.proxyPort=3128&apos;
+ ANT_OPTS=&apos;-Xmx1g -XX:MaxPermSize=256m -Dhttp.proxyHost=localhost -Dhttp.proxyPort=3128&apos;
+ cd /data/hive-ptest/working/
+ tee /data/hive-ptest/logs/PreCommit-HIVE-Build-252/source-prep.txt
+ mkdir -p maven ivy
+ [[ svn = \s\v\n ]]
+ [[ -n &apos;&apos; ]]
+ [[ -d apache-svn-trunk-source ]]
+ [[ ! -d apache-svn-trunk-source/.svn ]]
+ [[ ! -d apache-svn-trunk-source ]]
+ cd apache-svn-trunk-source
+ svn revert -R .
++ awk &apos;{print $2}&apos;
++ egrep -v &apos;^X|^Performing status on external&apos;
++ svn status --no-ignore
+ rm -rf
+ svn update
U    testutils/ptest2/src/test/resources/SomeTest-success.xml
U    testutils/ptest2/src/test/resources/test-outputs/SomeTest-truncated.xml
U    testutils/ptest2/src/test/resources/test-outputs/skewjoin_union_remove_1.q-TEST-org.apache.hadoop.hive.cli.TestCliDriver.xml
U    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestHostExecutor.java
U    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestExecutionPhase.testPassingUnitTest.approved.txt
U    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestCleanupPhase.java
U    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestScripts.testPrepGit.approved.txt
U    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestPhase.testRsyncFromLocalToRemoteInstancesWithFailureUnknown.approved.txt
U    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestCleanupPhase.testExecute.approved.txt
U    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestScripts.java
U    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestScripts.testPrepNone.approved.txt
U    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestScripts.testPrepSvn.approved.txt
U    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestPhase.java
U    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestPrepPhase.testExecute.approved.txt
U    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestPhase.testRsyncFromLocalToRemoteInstancesWithFailureOne.approved.txt
U    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestExecutionPhase.testFailingUnitTest.approved.txt
U    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestExecutionPhase.java
U    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/AbstractTestPhase.java
U    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestExecutionPhase.testPassingQFileTest.approved.txt
U    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/MockSSHCommandExecutor.java
U    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/MockRSyncCommandExecutor.java
U    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestReportParser.java
U    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/TestExecutionPhase.testFailingQFile.approved.txt
U    testutils/ptest2/src/test/java/org/apache/hive/ptest/execution/MockLocalCommandFactory.java
U    testutils/ptest2/src/test/java/org/apache/hive/ptest/api/server/TestTestExecutor.java
U    testutils/ptest2/src/main/resources/batch-exec.vm
U    testutils/ptest2/src/main/resources/source-prep.vm
U    testutils/ptest2/src/main/resources/log4j.properties
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/api/server/TestExecutor.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/api/server/ExecutionController.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/api/request/TestStartRequest.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/api/client/PTestClient.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/ExecutionPhase.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/PrepPhase.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/ReportingPhase.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/HostExecutor.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/PTest.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/LogDirectoryCleaner.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/Phase.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/JUnitReportParser.java
A    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/HostExecutorBuilder.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/context/CloudExecutionContextProvider.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/context/CloudComputeService.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/conf/ExecutionContextConfiguration.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/conf/QFileTestBatch.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/conf/TestConfiguration.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/conf/TestParser.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/JIRAService.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/Drone.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/CleanupPhase.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/Constants.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/ssh/SSHCommandExecutor.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/ssh/RSyncCommandExecutor.java
U    testutils/ptest2/src/main/java/org/apache/hive/ptest/execution/ssh/AbstractSSHCommand.java
U    eclipse-templates/.classpath
U    eclipse-templates/.classpath._hbase

Fetching external item into &apos;hcatalog/src/test/e2e/harness&apos;
Updated external to revision 1508709.

Updated to revision 1508708.
+ patchCommandPath=/data/hive-ptest/working/scratch/smart-apply-patch.sh
+ patchFilePath=/data/hive-ptest/working/scratch/build.patch
+ [[ -f /data/hive-ptest/working/scratch/build.patch ]]
+ chmod +x /data/hive-ptest/working/scratch/smart-apply-patch.sh
+ /data/hive-ptest/working/scratch/smart-apply-patch.sh /data/hive-ptest/working/scratch/build.patch
The patch does not appear to apply with p0 to p2
+ exit 1
&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13724781" author="phabricator@reviews.facebook.net" created="Wed, 31 Jul 2013 02:33:47 +0000"  >&lt;p&gt;sershe updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Hive&apos;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot;.&lt;/p&gt;

&lt;p&gt;  Rebase the patch&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11805&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D11805&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11805?vs=36621&amp;amp;id=36627#toc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D11805?vs=36621&amp;amp;id=36627#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  build.xml&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/alter_partition_coltype.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/load_dyn_part3.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/load_dyn_part4.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/load_dyn_part9.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/ppr_pushdown2.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/stats4.q&lt;br/&gt;
  ql/src/test/results/clientpositive/alter_partition_coltype.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/load_dyn_part3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/load_dyn_part4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/load_dyn_part9.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/ppr_pushdown2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/stats4.q.out&lt;/p&gt;

&lt;p&gt;To: JIRA, sershe&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13724818" author="cwsteinbach" created="Wed, 31 Jul 2013 03:38:34 +0000"  >&lt;blockquote&gt;
&lt;p&gt;This introduces &quot;direct SQL&quot; optimization for metastore.&lt;br/&gt;
When memstore gets partitions by filter or by names, it does so using ANSI SQL92 queries, if enabled (default).&lt;br/&gt;
This will not work on non-RDBMS datastores, may not work on non-ANSI-compiant ones (I tested on mysql in default mode).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Has anyone tested this patch on Derby, PostgreSQL, or Oracle? Until it&apos;s verified to work on these DBs I think this new code should be disabled by default.&lt;/p&gt;</comment>
                            <comment id="13724880" author="hiveqa" created="Wed, 31 Jul 2013 05:21:21 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12595110/HIVE-4051.D11805.5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12595110/HIVE-4051.D11805.5.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 8 failed/errored test(s), 2748 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part3
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part13
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part4
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats4
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part1
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_merge3
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part9
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_load_dyn_part8
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/256/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/256/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/256/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/256/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests failed with: TestsFailedException: 8 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13725486" author="sershe" created="Wed, 31 Jul 2013 17:48:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;Has anyone tested this patch on Derby, PostgreSQL, or Oracle? Until it&apos;s verified to work on these DBs I think this new code should be disabled by default.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I tested on Derby and MySQL so far.&lt;br/&gt;
Note that full fallback is there, so it could have a 3-position switch or two settings - current on/off being the same, and the &quot;on, but turn off &lt;span class=&quot;error&quot;&gt;&amp;#91;for some grace period?&amp;#93;&lt;/span&gt; on first error&quot;-setting. The latter could be the default, so in case if it fails it goes back to DN and doesn&apos;t introduce a lot of extra load. &lt;br/&gt;
What do you think?&lt;/p&gt;</comment>
                            <comment id="13726852" author="phabricator@reviews.facebook.net" created="Thu, 1 Aug 2013 20:37:47 +0000"  >&lt;p&gt;sershe updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Hive&apos;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot;.&lt;/p&gt;

&lt;p&gt;  The above failed tests are due to sorting. Due to so many tests failing I changed the code to preserve the same sort as JDO, it&apos;s actually a very small change. I am getting some test failures locally that look like they are caused by my laptop problems; let me try to push to HiveQA again.&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11805&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D11805&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11805?vs=36627&amp;amp;id=36771#toc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D11805?vs=36627&amp;amp;id=36771#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  build.xml&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java&lt;/p&gt;

&lt;p&gt;To: JIRA, sershe&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13726974" author="hiveqa" created="Thu, 1 Aug 2013 22:14:27 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12595477/HIVE-4051.D11805.6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12595477/HIVE-4051.D11805.6.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 2749 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/278/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/278/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/278/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/278/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13728115" author="phabricator@reviews.facebook.net" created="Fri, 2 Aug 2013 21:05:47 +0000"  >&lt;p&gt;ashutoshc has requested changes to the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Hive&apos;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot;.&lt;/p&gt;

&lt;p&gt;  Initial review pass. Few comments.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  build.xml:703 This is a good change which I like, but lets do it in separate jira : )&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1654 ObjectStore is getting too big. Lets move this class in a separate file.&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1681 I havent verified in code, but as far as I remember nothing in code at the moment uses CREATE_TIME, LAST_ACCESS_TIME, so we can drop these from select list.&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1711 You can initialize size of these treemaps with result.size()&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1681 We already know dbName and table name, why are you having them in select list?&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1735 If we do decide to keep create and last access time, can you check if they are Integer, I though they are longs.&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1776 Can there ever be a case when coldId == null ? I am not able to imagine one, did you see some failures ?&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1826 Instead of *, its better to use ORDER here, because RDBMS which doesn&apos;t support ORDER as column name would anyway be broken when schemas are created in it.&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:2268 This query is not encapsulated in transaction anymore?&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java:379 We should be able to support for non-strings as well, right? Is it just that you want to do that in later jira ?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11805&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D11805&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, sershe&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13728356" author="phabricator@reviews.facebook.net" created="Sat, 3 Aug 2013 01:03:47 +0000"  >&lt;p&gt;sershe has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Hive&apos;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1654 Will do after other feedback, otherwise the diff will be hard to do between files&lt;br/&gt;
  build.xml:703 fixed&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1681 fixed&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1681 someone might use them without knowing... it&apos;s cheap to get couple more columns&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1711 treemaps don&apos;t have size initializer?&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1735 they are int both in db, and in methods&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1776 I am being paranoid... I think it cannot happen, but db schema doesn&apos;t prevent that.&lt;br/&gt;
  Should we throw if sd, serde or col Ids are null?&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1826 the database is created by script (or DN) in RDBMS-specific way I&apos;d assume, so it would escape the reserved word properly. Mysql by default doesn&apos;t support ANSI way of escaping words... and it we use backticks for mysql it won&apos;t work on other RDBMS-es.&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:2268 the tx is external to the method... renamed method for clarity&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11805&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D11805&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, sershe&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13728403" author="sershe" created="Sat, 3 Aug 2013 02:25:38 +0000"  >&lt;p&gt;Some perf results (with a patch I am about to update).&lt;br/&gt;
I am running metastore separately on the same box as MySQL box in a cluster, with default config.&lt;br/&gt;
I&apos;ve created a table as such:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;create table sqltest(c string) partitioned by (s string,n string,p &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and inserted 32k partitions with s being 32-character random string, n - a number between 0 and 14, and p also a number.&lt;br/&gt;
There&apos;s no data in the table.&lt;/p&gt;

&lt;p&gt;I am running a query that would select 256 partitions with filter pushdown from hive CLI is on a different box&lt;br/&gt;
The time spent for creating partition objects out of 32k is about 150-180ms on current database schema. Bulk of it (~100ms) is in the query that does the filtering by joining PARTITION_KEY_VALS.&lt;br/&gt;
If this is done beforehand: &quot;create index idx1 on PARTITION_KEY_VALS (PART_KEY_VAL);&quot;, the total server-side fetch time becomes about 50ms, ~40-45ms for assorted queries and ~5ms for java code.&lt;br/&gt;
On empty dataset, the total time to run the query (no job as there&apos;s no data) is about 150ms in the latter case.&lt;br/&gt;
Trunk with filter pushdown takes the total of 1.7-2 seconds in this case; with more partitions fetched the difference is proportional.&lt;br/&gt;
Results are similar if both are run w/o pushdown (both are slower ofc).&lt;/p&gt;

&lt;p&gt;As mentioned above, I will move code into its own class in separate &quot;last&quot; iteration w/o logic changes in order to not complicate the review.&lt;/p&gt;

&lt;p&gt;Tuning MySQL/other databases, and queries, for further perf, can be in separate JIRA(s). The Hive admin/DBA could even do the former in the meantime if absolutely necessary.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cws&quot; class=&quot;user-hover&quot; rel=&quot;cws&quot;&gt;cws&lt;/a&gt; What do you think about the more conservative fallback scheme proposed above? (not in the patch yet)&lt;br/&gt;
I can test on Postgres if desired but I don&apos;t think I have access to Oracle.&lt;/p&gt;

</comment>
                            <comment id="13728404" author="sershe" created="Sat, 3 Aug 2013 02:27:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cwsteinbach&quot; class=&quot;user-hover&quot; rel=&quot;cwsteinbach&quot;&gt;cwsteinbach&lt;/a&gt; Sorry, mistyped the alias in the previous comment.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;What do you think about the more conservative fallback scheme proposed above? (not in the patch yet)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I can test on Postgres if desired but I don&apos;t think I have access to Oracle.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="13728408" author="phabricator@reviews.facebook.net" created="Sat, 3 Aug 2013 02:35:48 +0000"  >&lt;p&gt;sershe updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Hive&apos;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot;.&lt;/p&gt;

&lt;p&gt;  Feedback from review board, split the first query because it&apos;s hideously slow otherwise after sorting is added.&lt;/p&gt;

&lt;p&gt;Reviewers: ashutoshc, JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11805&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D11805&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11805?vs=36771&amp;amp;id=36879#toc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D11805?vs=36771&amp;amp;id=36879#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, sershe&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13728460" author="hiveqa" created="Sat, 3 Aug 2013 05:40:23 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12595725/HIVE-4051.D11805.7.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12595725/HIVE-4051.D11805.7.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 1 failed/errored test(s), 2758 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hcatalog.pig.TestHCatStorer.testPartColsInData
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/296/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/296/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/296/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/296/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests failed with: TestsFailedException: 1 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13729915" author="phabricator@reviews.facebook.net" created="Mon, 5 Aug 2013 20:45:47 +0000"  >&lt;p&gt;ashutoshc has requested changes to the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Hive&apos;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot;.&lt;/p&gt;

&lt;p&gt;  Mostly looks good. Can you update the final patch with new class in its own file, with following two comments (if they looks alright.)&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1681 You are still selecting dbname, tblname ?&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1776 Yes.. I think we should throw in those cases. Having empty list will mask the root problem if there is any which results from it.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11805&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D11805&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, sershe&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13729917" author="ashutoshc" created="Mon, 5 Aug 2013 20:47:13 +0000"  >&lt;p&gt;I think automatic fallback is good which makes sure that user query always succeed even in cases where this direct-sql optimization doesn&apos;t work for whatever reason. Folks who wants to turn this off anyway, can always do this by setting config variable. I am +1 on the patch as it is.&lt;/p&gt;</comment>
                            <comment id="13730134" author="phabricator@reviews.facebook.net" created="Mon, 5 Aug 2013 23:33:50 +0000"  >&lt;p&gt;sershe updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Hive&apos;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot;.&lt;/p&gt;

&lt;p&gt;  Moved the code for SQL filter generation and usage into separate class.&lt;br/&gt;
  The only other changes are latest two comments on Phabricator, as well as some minor cleanup like null checks.&lt;/p&gt;

&lt;p&gt;Reviewers: ashutoshc, JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11805&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D11805&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11805?vs=36879&amp;amp;id=37071#toc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D11805?vs=36879&amp;amp;id=37071#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreDirectSql.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, sershe&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13730137" author="phabricator@reviews.facebook.net" created="Mon, 5 Aug 2013 23:35:50 +0000"  >&lt;p&gt;sershe has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Hive&apos;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1681 fixed&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java:1776 fixed&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11805&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D11805&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, sershe&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13730238" author="phabricator@reviews.facebook.net" created="Tue, 6 Aug 2013 01:09:48 +0000"  >&lt;p&gt;sershe updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Hive&apos;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot;.&lt;/p&gt;

&lt;p&gt;  Fixing bugs introduced while moving code.&lt;/p&gt;

&lt;p&gt;Reviewers: ashutoshc, JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11805&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D11805&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11805?vs=37071&amp;amp;id=37083#toc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D11805?vs=37071&amp;amp;id=37083#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreDirectSql.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, sershe&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13730363" author="phabricator@reviews.facebook.net" created="Tue, 6 Aug 2013 05:17:49 +0000"  >&lt;p&gt;ashutoshc has accepted the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Hive&apos;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot;.&lt;/p&gt;

&lt;p&gt;  +1&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D11805&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D11805&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, sershe&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13731662" author="ashutoshc" created="Wed, 7 Aug 2013 05:30:29 +0000"  >&lt;p&gt;Committed to trunk. Thanks, Sergey!&lt;/p&gt;</comment>
                            <comment id="13731676" author="hudson" created="Wed, 7 Aug 2013 05:50:27 +0000"  >&lt;p&gt;FAILURE: Integrated in Hive-trunk-hadoop2 #336 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/336/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/336/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt; : Hive&apos;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow (Sergey Shelukhin via Ashutosh Chauhan) (hashutosh: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1511177&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1511177&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreDirectSql.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13732847" author="hudson" created="Wed, 7 Aug 2013 22:29:51 +0000"  >&lt;p&gt;ABORTED: Integrated in Hive-trunk-hadoop2-ptest #50 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2-ptest/50/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2-ptest/50/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt; : Hive&apos;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow (Sergey Shelukhin via Ashutosh Chauhan) (hashutosh: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1511177&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1511177&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreDirectSql.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13733048" author="hudson" created="Thu, 8 Aug 2013 01:46:51 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hive-trunk-h0.21 #2250 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/2250/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/2250/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt; : Hive&apos;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow (Sergey Shelukhin via Ashutosh Chauhan) (hashutosh: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1511177&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1511177&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreDirectSql.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13733287" author="hudson" created="Thu, 8 Aug 2013 09:08:56 +0000"  >&lt;p&gt;ABORTED: Integrated in Hive-trunk-hadoop1-ptest #121 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop1-ptest/121/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop1-ptest/121/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4051&quot; title=&quot;Hive&amp;#39;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4051&quot;&gt;&lt;del&gt;HIVE-4051&lt;/del&gt;&lt;/a&gt; : Hive&apos;s metastore suffers from 1+N queries when querying partitions &amp;amp; is slow (Sergey Shelukhin via Ashutosh Chauhan) (hashutosh: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1511177&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1511177&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/MetaStoreDirectSql.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/ObjectStore.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/parser/ExpressionTree.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13772142" author="dougsedlak" created="Thu, 19 Sep 2013 18:26:05 +0000"  >&lt;p&gt;I&apos;ve noticed that the more partitions in a Hive table, the slower the following operations come back.  With thousands of partitions they approach painfully slow:&lt;br/&gt;
SELECT * FROM TABNAME&lt;br/&gt;
SHOW TABLE EXTENDED LIKE `TABNAME`&lt;/p&gt;

&lt;p&gt;Do you know if this fix takes case of these issues?  If not is it something you could test?&lt;br/&gt;
If not, I&apos;ll enter a new case.&lt;/p&gt;

&lt;p&gt;Thanks, Doug  doug.sedlak@sas.com&lt;/p&gt;</comment>
                            <comment id="13775826" author="sershe" created="Tue, 24 Sep 2013 00:01:20 +0000"  >&lt;p&gt;this and the followup patches (&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5158&quot; title=&quot;allow getting all partitions for table to also use direct SQL path&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5158&quot;&gt;&lt;del&gt;HIVE-5158&lt;/del&gt;&lt;/a&gt;) will take care of pre-map-reduce-job slowdown on select * with many partitions, but it&apos;s hard to tell whether that&apos;s the main culprit from just looking at the query.&lt;br/&gt;
show table I am not sure, if not it should be easy to extend. &lt;/p&gt;</comment>
                            <comment id="13796011" author="ashutoshc" created="Tue, 15 Oct 2013 23:30:21 +0000"  >&lt;p&gt;This issue has been fixed and released as part of 0.12 release. If you find further issues, please create a new jira and link it to this one.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12675308">HIVE-5626</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12688444">HIVE-6188</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12662706">HIVE-5029</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12594063" name="HIVE-4051.D11805.1.patch" size="36856" author="phabricator@reviews.facebook.net" created="Wed, 24 Jul 2013 23:53:46 +0000"/>
                            <attachment id="12594511" name="HIVE-4051.D11805.2.patch" size="37616" author="phabricator@reviews.facebook.net" created="Sat, 27 Jul 2013 02:53:46 +0000"/>
                            <attachment id="12595072" name="HIVE-4051.D11805.3.patch" size="179986" author="phabricator@reviews.facebook.net" created="Tue, 30 Jul 2013 23:29:48 +0000"/>
                            <attachment id="12595079" name="HIVE-4051.D11805.4.patch" size="185778" author="phabricator@reviews.facebook.net" created="Tue, 30 Jul 2013 23:53:48 +0000"/>
                            <attachment id="12595110" name="HIVE-4051.D11805.5.patch" size="186200" author="phabricator@reviews.facebook.net" created="Wed, 31 Jul 2013 02:33:47 +0000"/>
                            <attachment id="12595477" name="HIVE-4051.D11805.6.patch" size="40725" author="phabricator@reviews.facebook.net" created="Thu, 1 Aug 2013 20:37:48 +0000"/>
                            <attachment id="12595725" name="HIVE-4051.D11805.7.patch" size="44334" author="phabricator@reviews.facebook.net" created="Sat, 3 Aug 2013 02:35:48 +0000"/>
                            <attachment id="12596239" name="HIVE-4051.D11805.8.patch" size="52059" author="phabricator@reviews.facebook.net" created="Mon, 5 Aug 2013 23:33:50 +0000"/>
                            <attachment id="12596257" name="HIVE-4051.D11805.9.patch" size="52064" author="phabricator@reviews.facebook.net" created="Tue, 6 Aug 2013 01:09:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>314017</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 6 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1i6t3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>314362</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>