<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:45:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-13957] vectorized IN is inconsistent with non-vectorized (at least for decimal in (string))</title>
                <link>https://issues.apache.org/jira/browse/HIVE-13957</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The cast is applied to the column in regular IN, but vectorized IN applies it to the IN() list.&lt;br/&gt;
This can cause queries to produce incorrect results.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12976250">HIVE-13957</key>
            <summary>vectorized IN is inconsistent with non-vectorized (at least for decimal in (string))</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sershe">Sergey Shelukhin</assignee>
                                    <reporter username="sershe">Sergey Shelukhin</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Jun 2016 00:42:17 +0000</created>
                <updated>Tue, 27 Feb 2024 22:23:50 +0000</updated>
                            <resolved>Tue, 14 Jun 2016 01:55:48 +0000</resolved>
                                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.2</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15317567" author="sershe" created="Tue, 7 Jun 2016 00:42:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mmccline&quot; class=&quot;user-hover&quot; rel=&quot;mmccline&quot;&gt;mmccline&lt;/a&gt; fyi... I will take a look&lt;/p&gt;</comment>
                            <comment id="15317671" author="sershe" created="Tue, 7 Jun 2016 02:09:54 +0000"  >&lt;p&gt;The patch disables IN vectorization for such cases, since it looks like Col... specializations cannot be used if the column needs to be cast. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mmccline&quot; class=&quot;user-hover&quot; rel=&quot;mmccline&quot;&gt;mmccline&lt;/a&gt; can you please review?&lt;/p&gt;</comment>
                            <comment id="15317698" author="gopalv" created="Tue, 7 Jun 2016 02:34:35 +0000"  >&lt;p&gt;Would it be better to convert the implicit conversion (as done in GenericUDF) into an explicit one if the type conversion is legal?&lt;/p&gt;

&lt;p&gt;The tangential reason is that the type of the first argument is enforced for the rest of the IN() expression - relaxing type safety and letting the UDF handle it at runtime.&lt;/p&gt;

&lt;p&gt;Similar type issues exist for concat() for instance, where the UDF internally type-casts all args to String, but the actual plan doesn&apos;t.&lt;/p&gt;</comment>
                            <comment id="15318725" author="hiveqa" created="Tue, 7 Jun 2016 15:49:13 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12808537/HIVE-13957.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12808537/HIVE-13957.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 14 failed/errored test(s), 10223 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_acid_globallimit
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_acid_table_stats
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_create_func1
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_12
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_13
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_list_bucket
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_multiinsert
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_vector_between_in
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_constprog_partitioner
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_index_bitmap3
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_between_in
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_vector_between_in
org.apache.hive.jdbc.TestJdbcWithLocalClusterSpark.testPermFunc
org.apache.hive.jdbc.TestJdbcWithMiniMr.testPermFunc
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/30/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/30/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/30/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/30/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-30/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-30/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 14 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12808537 - PreCommit-HIVE-MASTER-Build&lt;/p&gt;</comment>
                            <comment id="15319171" author="sershe" created="Tue, 7 Jun 2016 19:19:27 +0000"  >&lt;p&gt;Can you elaborate? The problem is the difference between the approaches, not the type of the cast per se.&lt;/p&gt;

&lt;p&gt;Normal IN, at some point that doesn&apos;t really matter, derives the common type for the column and constants, and casts both columns and constants to that whenever needed.&lt;br/&gt;
Whereas vectorization always tries to convert the constants to the column type, the reason being (I supposed) that the specializations for IN all have a particular column type in mind. I am not actually very familiar with these and whether it would be easy to incorporate a cast; I assume the cast of the column would need to come earlier than the specialized IN (i.e. specialized IN should already be able to utilize values of the correct type straight out of the VRB), which would require the vectorizer to modify the plan above the IN. Or something like that.&lt;/p&gt;

&lt;p&gt;We could do that, however, as far as I see, it&apos;s not the solution we want, because of the following.&lt;br/&gt;
First, in case of decimal-string, this issue can produce incorrect results, so we want a simple fix for that, which the above isn&apos;t.&lt;br/&gt;
From the long term perspective, I&apos;d say we need to prohibit implicit casts in this case (I opened a separate JIRA) AND/OR change non-vectorized pipeline rather than vectorized, because casting decimal column to string in this case (what the non-vectorized IN does) is not the intuitively logical thing for the user and may produce unexpected result.&lt;/p&gt;

&lt;p&gt;With the latter in mind, we /could/ fix the proximate issue in vectorized code (cast to decimal(38,38) that ends up converting all reasonable values to null), e.g. constrain the precision and scale to the column type (potentially +2/+1 for NOT, although the enforcement will probably convert the values that don&apos;t fit to NULL), assuming the values are trimmed, since more should never be needed. But that&apos;s still inconsistent with normal IN, and we should probably do it later. &lt;br/&gt;
Actually, come think of it, this might also be broken for other UDFs, where constraining is not as easy or at least is different (e.g. between needs more than strict equality, and with arithmetic ops, if this problem applies, the only way would be to derive the maximum values from the value list). I can also file a separate JIRA for that...&lt;/p&gt;</comment>
                            <comment id="15319177" author="gopalv" created="Tue, 7 Jun 2016 19:26:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;derives the common type for the column and constants, and casts both columns and constants to that whenever needed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The cast is implicit right now - the UDF does the conversion behind the scenes. Making the cast explicit actually would do the trick instead.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;id in (&apos;100000000&apos;, &apos;200000000&apos;)&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;could be written in 2 ways.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;cast(id as string) in (...)&lt;/tt&gt; or &lt;tt&gt;id in (cast(&apos;100000000&apos; as decimal(17,2)), ...)&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Vectorization should have no trouble with either disambiguated forms, but cannot deal with the actual lack of type conversions in the plan.&lt;/p&gt;

&lt;p&gt;The interesting constraint is that all types inside the IN() clause have to be identical, so that the conversion is exactly once - not like {{ id in (1.0, &apos;1.0&apos;, &apos;1.00&apos;) }}&lt;/p&gt;</comment>
                            <comment id="15319187" author="sershe" created="Tue, 7 Jun 2016 19:30:28 +0000"  >&lt;p&gt;Yeah, that&apos;s what I was alluding to above. It seems like it would be a complex fix. Where is that handled for concat?&lt;/p&gt;</comment>
                            <comment id="15319192" author="gopalv" created="Tue, 7 Jun 2016 19:32:57 +0000"  >&lt;p&gt;It is not handled for concat and concat fails vectorizing entire vertices because it doesn&apos;t wrap a UDFToString() around all args  - see &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-7160&quot; title=&quot;Vectorization Udf: GenericUDFConcat for non-string columns input, is not supported&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-7160&quot;&gt;HIVE-7160&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15319216" author="sershe" created="Tue, 7 Jun 2016 19:46:01 +0000"  >&lt;p&gt;Well, then we should do this first for correctness, then do other things as a follow-up.&lt;/p&gt;</comment>
                            <comment id="15319695" author="sershe" created="Tue, 7 Jun 2016 23:41:20 +0000"  >&lt;p&gt;Updated the out files&lt;/p&gt;</comment>
                            <comment id="15319786" author="sershe" created="Wed, 8 Jun 2016 00:30:31 +0000"  >&lt;p&gt;Updated the patch to use default precision and scale instead of max values, this will make the other UDFs valid in vast majority of cases.&lt;/p&gt;</comment>
                            <comment id="15321524" author="sershe" created="Wed, 8 Jun 2016 22:00:35 +0000"  >&lt;p&gt;The same patch, for HiveQA&lt;/p&gt;</comment>
                            <comment id="15322645" author="hiveqa" created="Thu, 9 Jun 2016 14:52:20 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12809044/HIVE-13957.03.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12809044/HIVE-13957.03.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 7 failed/errored test(s), 10224 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_acid_globallimit
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_12
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_13
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_list_bucket
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_multiinsert
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_constprog_partitioner
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_index_bitmap3
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/61/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/61/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/61/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/61/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-61/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-61/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 7 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12809044 - PreCommit-HIVE-MASTER-Build&lt;/p&gt;</comment>
                            <comment id="15325434" author="sershe" created="Fri, 10 Jun 2016 22:43:41 +0000"  >&lt;p&gt;Test failures are unrelated.&lt;/p&gt;</comment>
                            <comment id="15328079" author="sershe" created="Mon, 13 Jun 2016 20:01:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mmccline&quot; class=&quot;user-hover&quot; rel=&quot;mmccline&quot;&gt;mmccline&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gopalv&quot; class=&quot;user-hover&quot; rel=&quot;gopalv&quot;&gt;gopalv&lt;/a&gt; ping?&lt;/p&gt;</comment>
                            <comment id="15328211" author="mmccline" created="Mon, 13 Jun 2016 20:38:15 +0000"  >&lt;p&gt;(Patch #3) LGTM +1&lt;/p&gt;</comment>
                            <comment id="15328778" author="sershe" created="Tue, 14 Jun 2016 01:55:49 +0000"  >&lt;p&gt;Committed to some branches. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jcamachorodriguez&quot; class=&quot;user-hover&quot; rel=&quot;jcamachorodriguez&quot;&gt;jcamachorodriguez&lt;/a&gt; what is the state of 2.1? Can I commit there now? I put 2.1.1 as target version for now&lt;/p&gt;</comment>
                            <comment id="15329225" author="jcamacho" created="Tue, 14 Jun 2016 10:11:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt;, fix can be pushed to branch-2.1 and fix version set to 2.1.1. About 2.1.0, it is waiting for you vote! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/tongue.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Thanks&lt;/p&gt;</comment>
                            <comment id="15330182" author="sershe" created="Tue, 14 Jun 2016 19:05:46 +0000"  >&lt;p&gt;Committed there too. Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12808786" name="HIVE-13957.01.patch" size="18038" author="sershe" created="Tue, 7 Jun 2016 23:41:20 +0000"/>
                            <attachment id="12808797" name="HIVE-13957.02.patch" size="18861" author="sershe" created="Wed, 8 Jun 2016 00:30:31 +0000"/>
                            <attachment id="12809044" name="HIVE-13957.03.patch" size="18861" author="sershe" created="Wed, 8 Jun 2016 22:00:35 +0000"/>
                            <attachment id="12808537" name="HIVE-13957.patch" size="13601" author="sershe" created="Tue, 7 Jun 2016 02:23:47 +0000"/>
                            <attachment id="12808529" name="HIVE-13957.patch" size="13605" author="sershe" created="Tue, 7 Jun 2016 02:09:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2z207:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>