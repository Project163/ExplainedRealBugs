<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:51:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-189] Various TestCliDriver tests fail</title>
                <link>https://issues.apache.org/jira/browse/HIVE-189</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;On a fresh checkout of trunk a number of tests fail in org.apache.hadoop.hive.cli.TestCliDriver:&lt;br/&gt;
testCliDriver_sample5&lt;br/&gt;
testCliDriver_input3_limit&lt;br/&gt;
testCliDriver_udf5&lt;br/&gt;
testCliDriver_sample3&lt;/p&gt;</description>
                <environment></environment>
        <key id="12411044">HIVE-189</key>
            <summary>Various TestCliDriver tests fail</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="athusoo">Ashish Thusoo</assignee>
                                    <reporter username="johanoskarsson">Johan Oskarsson</reporter>
                        <labels>
                    </labels>
                <created>Fri, 19 Dec 2008 12:03:49 +0000</created>
                <updated>Sat, 17 Dec 2011 00:08:45 +0000</updated>
                            <resolved>Wed, 4 Feb 2009 22:42:40 +0000</resolved>
                                                    <fixVersion>0.3.0</fixVersion>
                                    <component>Testing Infrastructure</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12659294" author="athusoo" created="Sat, 27 Dec 2008 00:27:29 +0000"  >&lt;p&gt;I am getting a clean build and all tests succeeded on the latest branch. Are you still seeing this?&lt;/p&gt;</comment>
                            <comment id="12659325" author="johanoskarsson" created="Sat, 27 Dec 2008 11:11:22 +0000"  >&lt;p&gt;It seems three of the four tests are now finishing properly.&lt;br/&gt;
The fourth one still fails:&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; diff &lt;del&gt;I &amp;#40;&lt;a href=&quot;file:)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:&amp;amp;#41;\&lt;/a&gt;|&amp;#40;tmp/hive&lt;/del&gt;.*&amp;#41; /storage/home/chartgen/hive-trunk/ql/../build/ql/test/logs/udf5.q.out /storage/home/chartgen/hive-trunk/ql/src/&lt;br/&gt;
test/results/clientpositive/udf5.q.out&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 43c43&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; &amp;lt; 2008-11-11 23:32:20       2008-11-11      1       11      2008    1       11      2008&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; &amp;#8212;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; &amp;gt; 2008-11-11 15:32:20       2008-11-11      1       11      2008    1       11      2008&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Exception: Client execution results dailed with error code = 1&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; junit.framework.AssertionFailedError: Client execution results dailed with error code = 1&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at junit.framework.Assert.fail(Assert.java:47)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_udf5(TestCliDriver.java:3034)&lt;/p&gt;

&lt;p&gt;I&apos;ll attach the log of the test run&lt;/p&gt;</comment>
                            <comment id="12659326" author="johanoskarsson" created="Sat, 27 Dec 2008 11:16:09 +0000"  >&lt;p&gt;Log file for the test run that fails&lt;/p&gt;</comment>
                            <comment id="12659329" author="johanoskarsson" created="Sat, 27 Dec 2008 11:29:01 +0000"  >&lt;p&gt;Since it looks like the error is caused by some date/time issue it is worth mentioning that the server where the tests ran is set to UTC.&lt;/p&gt;</comment>
                            <comment id="12660871" author="electrum" created="Mon, 5 Jan 2009 19:40:53 +0000"  >&lt;p&gt;Set your TZ environment variable to &quot;US/Pacific&quot; before running the tests:&lt;/p&gt;

&lt;p&gt;export TZ=US/Pacific&lt;/p&gt;
</comment>
                            <comment id="12661181" author="johanoskarsson" created="Tue, 6 Jan 2009 16:00:59 +0000"  >&lt;p&gt;Looking at the code it seems you&apos;re right, it just dumps the output of the command to a file and then runs the cmd line diff against it and the predefined correct test output file. Since the unix timestamp in the query is GMT the UDFFromUnixTime class will format it differently for all the timezones. Any suggestions on how to solve this? Having a unit test tied to a specific timezone doesn&apos;t sound like a good idea.&lt;/p&gt;</comment>
                            <comment id="12661550" author="athusoo" created="Wed, 7 Jan 2009 13:09:38 +0000"  >&lt;p&gt;There are two ways to solve this, and I think we should do both in the long run:&lt;/p&gt;

&lt;p&gt;1. Add a variable to hive-site.xml to indicate the timezone. This variable if present would override the timezone set on the machine. Then we can set that variable for the hive-site.xml for the tests.\&lt;br/&gt;
2. Make all the datetime functions timezone aware like they are for other RDBMs (mysql, oracle etc.) and then change the test query to take the timezone.&lt;/p&gt;

&lt;p&gt;Both of these would solve the problem and would be desirable feature extensions as well.&lt;/p&gt;</comment>
                            <comment id="12661687" author="athusoo" created="Wed, 7 Jan 2009 19:59:45 +0000"  >&lt;p&gt;Added setting of TZ in the ant file.&lt;/p&gt;

&lt;p&gt;Do let me know if this works and I can then submit it for review.&lt;/p&gt;</comment>
                            <comment id="12661989" author="johanoskarsson" created="Thu, 8 Jan 2009 15:11:33 +0000"  >&lt;p&gt;I&apos;ve tested this solution and it works for me, the udf5 test passes.&lt;/p&gt;</comment>
                            <comment id="12662328" author="johanoskarsson" created="Fri, 9 Jan 2009 11:27:02 +0000"  >&lt;p&gt;For whatever reason the three other tests in this ticket description have started failing for me again in a similar fashion to the log already attached to this ticket. Am I the only one to see this?&lt;/p&gt;</comment>
                            <comment id="12663009" author="johanoskarsson" created="Mon, 12 Jan 2009 17:10:57 +0000"  >&lt;p&gt;I&apos;m starting to suspect that these are related to File.list ordering just like &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-90&quot; title=&quot;TestGetDBs assumes a specific File.list() order&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-90&quot;&gt;&lt;del&gt;HIVE-90&lt;/del&gt;&lt;/a&gt;. I had a closer look at input3_limit.q. The important bits:&lt;br/&gt;
&amp;lt;snip&amp;gt;&lt;br/&gt;
LOAD DATA LOCAL INPATH &apos;../data/files/kv1.txt&apos; INTO TABLE T1;&lt;br/&gt;
LOAD DATA LOCAL INPATH &apos;../data/files/kv2.txt&apos; INTO TABLE T1;&lt;br/&gt;
&amp;lt;snip&amp;gt;&lt;br/&gt;
INSERT OVERWRITE TABLE T2 SELECT a.key, a.value from T1 a LIMIT 20;&lt;br/&gt;
&amp;lt;snip&amp;gt;&lt;/p&gt;

&lt;p&gt;It seems that the insert select statement with a 20 limit is meant to select from the kv1.txt file, but on my system it picks the kv2.txt file first. Thus the final output will be incorrect. Could someone confirm that this differs from a run where it passes?&lt;/p&gt;</comment>
                            <comment id="12663140" author="zshao" created="Mon, 12 Jan 2009 22:55:45 +0000"  >&lt;p&gt;I believe LIMIT statement does take the data from the first file first. So the file ordering does matter.&lt;/p&gt;

&lt;p&gt;The other 3 tests should be fixed by Ashish&apos;s patch correct? If it does, please let me know and I will commit Ashish&apos;s patch and close this jira (and please open a new one for the limit problem).&lt;/p&gt;</comment>
                            <comment id="12663181" author="athusoo" created="Tue, 13 Jan 2009 01:51:21 +0000"  >&lt;p&gt;Submitting the patch for review.&lt;/p&gt;</comment>
                            <comment id="12663184" author="athusoo" created="Tue, 13 Jan 2009 02:00:09 +0000"  >&lt;p&gt;The problematic code is in &lt;/p&gt;

&lt;p&gt;FetchTask.java:getNextPath()&lt;/p&gt;

&lt;p&gt;We are using fs.listStatus there to get the list of files and I do not think that gaurantees order. &lt;/p&gt;</comment>
                            <comment id="12663289" author="johanoskarsson" created="Tue, 13 Jan 2009 10:14:04 +0000"  >&lt;p&gt;Zheng: Only one of the tests are fixed by the patch, the udf5 test. The others are working sometimes but mostly failing, I suspect they might all be related to File list sort order, but I have only confirmed it with one of them so far as mentioned above.&lt;br/&gt;
There are a few options as far as I can see, commit the udf5 and open new ticket for the other three tests or try to fix all the tests in this ticket. I don&apos;t mind either way.&lt;/p&gt;</comment>
                            <comment id="12663831" author="athusoo" created="Wed, 14 Jan 2009 18:29:34 +0000"  >&lt;p&gt;On thinking more about this, I think we should change the test for input3_limit.q to make it deterministic. Instead of&lt;/p&gt;

&lt;p&gt;INSERT OVERWRITE TABLE T2 SELECT a.key, a.value from T1 a LIMIT 20;&lt;/p&gt;

&lt;p&gt;We should have&lt;/p&gt;

&lt;p&gt;INSERT OVERWRITE TABLE T2 SELECT * FROM (SELECT * FROM T1 DISTRIBUTE BY key SORT BY key, value) T LIMIT 20;&lt;/p&gt;

&lt;p&gt;SELECT * FROM T2&lt;/p&gt;

&lt;p&gt;That would ensure that the rows that we get are top 20 rows.&lt;/p&gt;

&lt;p&gt;The order in which these files are processed are controlled by hadoop, so I don&apos;t think we have much control on whether kv1.txt gets processed first or kv2.txt.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="12663832" author="johanoskarsson" created="Wed, 14 Jan 2009 18:32:33 +0000"  >&lt;p&gt;Sounds like a good solution to me. &lt;/p&gt;

&lt;p&gt;Do you have any idea what might be happening in testCliDriver_sample5 and testCliDriver_sample3? Similar issue with file sorting?&lt;/p&gt;</comment>
                            <comment id="12665505" author="athusoo" created="Tue, 20 Jan 2009 19:10:41 +0000"  >&lt;p&gt;sample3 and sample5 are suffering from the same sorting issue. I think the related code there is at&lt;/p&gt;

&lt;p&gt;getBucketPath in&lt;/p&gt;

&lt;p&gt;ql/metadata/Partition.java&lt;/p&gt;

&lt;p&gt;I think we should be sorting the files there as well...&lt;/p&gt;

&lt;p&gt;This is picked up in&lt;/p&gt;

&lt;p&gt;TableSample.java to create the paths needed..&lt;/p&gt;</comment>
                            <comment id="12665605" author="athusoo" created="Tue, 20 Jan 2009 22:31:59 +0000"  >&lt;p&gt;changed the query in input2_limit.q&lt;/p&gt;

&lt;p&gt;Also fixed the getBucketPath so that it is deterministic now.&lt;/p&gt;</comment>
                            <comment id="12665671" author="prasadc" created="Wed, 21 Jan 2009 01:17:53 +0000"  >&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/metadata/Partition.java:216 i think FileStatus default comparator is same the one you defined here. so custom comparator is not necessary.&lt;/p&gt;</comment>
                            <comment id="12665682" author="athusoo" created="Wed, 21 Jan 2009 01:54:58 +0000"  >&lt;p&gt;you are right!! Will upload a new patch.&lt;/p&gt;</comment>
                            <comment id="12665683" author="athusoo" created="Wed, 21 Jan 2009 01:56:17 +0000"  >&lt;p&gt;Removed the comparator.&lt;/p&gt;</comment>
                            <comment id="12665687" author="athusoo" created="Wed, 21 Jan 2009 02:17:47 +0000"  >&lt;p&gt;Fixed the unit test output..&lt;/p&gt;</comment>
                            <comment id="12665696" author="zshao" created="Wed, 21 Jan 2009 04:08:11 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12665822" author="johanoskarsson" created="Wed, 21 Jan 2009 13:11:11 +0000"  >&lt;p&gt;Tried out the latest patch but unfortunately both of the sample methods still fail. The rest works fine though. I don&apos;t have time to look deeper at why right now. Attaching log file for the test run.&lt;/p&gt;</comment>
                            <comment id="12666491" author="athusoo" created="Fri, 23 Jan 2009 11:41:32 +0000"  >&lt;p&gt;From the diffs I do not actually see any difference in the lines that are reported as diffining in the two test cases. Is there extra space at the end of one of these results? Puzzled...&lt;/p&gt;</comment>
                            <comment id="12666532" author="johanoskarsson" created="Fri, 23 Jan 2009 12:43:54 +0000"  >&lt;p&gt;It seems the latest patch doesn&apos;t apply cleanly anymore. Was going to run the test again and see if I can help figuring out what&apos;s going on.&lt;/p&gt;</comment>
                            <comment id="12666549" author="johanoskarsson" created="Fri, 23 Jan 2009 14:41:26 +0000"  >&lt;p&gt;This is the output from /build/ql/test/logs/clientpositive/sample3.q.out after running the test&lt;/p&gt;</comment>
                            <comment id="12669080" author="athusoo" created="Fri, 30 Jan 2009 23:40:52 +0000"  >&lt;p&gt;Another patch after resolving the conflicts. Can you try once more. I think this one will also fail but just wanted to make sure..&lt;/p&gt;</comment>
                            <comment id="12669611" author="johanoskarsson" created="Mon, 2 Feb 2009 14:27:16 +0000"  >&lt;p&gt;As you suspected the sample tests still fail with the new patch.&lt;/p&gt;</comment>
                            <comment id="12670186" author="athusoo" created="Wed, 4 Feb 2009 00:01:51 +0000"  >&lt;p&gt;Ok. This one should work. The problem was the ordering the sample queries and I have fixed those. Please verify and let me know. I will checkin once this passes for you.&lt;/p&gt;</comment>
                            <comment id="12670308" author="johanoskarsson" created="Wed, 4 Feb 2009 11:30:57 +0000"  >&lt;p&gt;+1. With the latest patch all tests pass just fine on my machine. Thanks for looking into this Ashish!&lt;/p&gt;</comment>
                            <comment id="12670536" author="athusoo" created="Wed, 4 Feb 2009 22:42:40 +0000"  >&lt;p&gt;committed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12410222">HIVE-137</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12398394" name="TEST-org.apache.hadoop.hive.cli.TestCliDriver.txt" size="821533" author="johanoskarsson" created="Wed, 21 Jan 2009 13:11:11 +0000"/>
                            <attachment id="12396794" name="TEST-org.apache.hadoop.hive.cli.TestCliDriver.txt" size="692770" author="johanoskarsson" created="Sat, 27 Dec 2008 11:16:09 +0000"/>
                            <attachment id="12397323" name="patch-189.txt" size="679" author="athusoo" created="Wed, 7 Jan 2009 19:59:45 +0000"/>
                            <attachment id="12398348" name="patch-189_2.txt" size="24435" author="athusoo" created="Tue, 20 Jan 2009 22:31:59 +0000"/>
                            <attachment id="12398362" name="patch-189_3.txt" size="24038" author="athusoo" created="Wed, 21 Jan 2009 01:56:17 +0000"/>
                            <attachment id="12398364" name="patch-189_4.txt" size="24078" author="athusoo" created="Wed, 21 Jan 2009 02:17:47 +0000"/>
                            <attachment id="12399179" name="patch-189_5.txt" size="24637" author="athusoo" created="Fri, 30 Jan 2009 23:40:52 +0000"/>
                            <attachment id="12399410" name="patch-189_6.txt" size="36850" author="athusoo" created="Wed, 4 Feb 2009 00:01:51 +0000"/>
                            <attachment id="12398578" name="sample3.q.out" size="1927" author="johanoskarsson" created="Fri, 23 Jan 2009 14:41:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73717</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 42 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0l8en:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>122012</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>