<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:59:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-2497] partition pruning  prune some right partition under specific conditions</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2497</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;create table src3(key string, value string) partitioned by (pt string)&lt;br/&gt;
row format delimited fields terminated by &apos;,&apos;;&lt;/p&gt;

&lt;p&gt;ALTER TABLE src3 ADD IF NOT EXISTS PARTITION (pt=&apos;20110911000000&apos;) ;&lt;br/&gt;
ALTER TABLE src3 ADD IF NOT EXISTS PARTITION (pt=&apos;20110912000000&apos;) ;&lt;br/&gt;
ALTER TABLE src3 ADD IF NOT EXISTS PARTITION (pt=&apos;20110913000000&apos;) ;&lt;/p&gt;



&lt;p&gt;explain extended&lt;br/&gt;
select user_id &lt;br/&gt;
from&lt;br/&gt;
 (&lt;br/&gt;
   select &lt;br/&gt;
    cast(key as int) as user_id&lt;br/&gt;
    ,case when (value like &apos;aaa%&apos; or value like &apos;vvv%&apos;)&lt;br/&gt;
            then 1&lt;br/&gt;
            else 0  end as tag_student&lt;br/&gt;
   from src3&lt;br/&gt;
 ) sub&lt;br/&gt;
where sub.tag_student &amp;gt; 0;&lt;/p&gt;


&lt;p&gt;STAGE DEPENDENCIES:&lt;br/&gt;
  Stage-1 is a root stage&lt;br/&gt;
  Stage-0 is a root stage&lt;/p&gt;

&lt;p&gt;STAGE PLANS:&lt;br/&gt;
  Stage: Stage-1&lt;br/&gt;
    Map Reduce&lt;br/&gt;
      Alias -&amp;gt; Map Operator Tree:&lt;br/&gt;
        sub:src3 &lt;br/&gt;
          TableScan&lt;br/&gt;
            alias: src3&lt;br/&gt;
            Filter Operator&lt;br/&gt;
              isSamplingPred: false&lt;br/&gt;
              predicate:&lt;br/&gt;
                  expr: (CASE WHEN (((value like &apos;aaa%&apos;) or (value like &apos;vvv%&apos;))) THEN (1) ELSE (0) END &amp;gt; 0)&lt;br/&gt;
                  type: boolean&lt;br/&gt;
              Select Operator&lt;br/&gt;
                expressions:&lt;br/&gt;
                      expr: UDFToInteger(key)&lt;br/&gt;
                      type: int&lt;br/&gt;
                      expr: CASE WHEN (((value like &apos;aaa%&apos;) or (value like &apos;vvv%&apos;))) THEN (1) ELSE (0) END&lt;br/&gt;
                      type: int&lt;br/&gt;
                outputColumnNames: _col0, _col1&lt;br/&gt;
                Filter Operator&lt;br/&gt;
                  isSamplingPred: false&lt;br/&gt;
                  predicate:&lt;br/&gt;
                      expr: (_col1 &amp;gt; 0)&lt;br/&gt;
                      type: boolean&lt;br/&gt;
                  Select Operator&lt;br/&gt;
                    expressions:&lt;br/&gt;
                          expr: _col0&lt;br/&gt;
                          type: int&lt;br/&gt;
                    outputColumnNames: _col0&lt;br/&gt;
                    File Output Operator&lt;br/&gt;
                      compressed: false&lt;br/&gt;
                      GlobalTableId: 0&lt;br/&gt;
                      directory: hdfs://localhost:54310/tmp/hive-tianzhao/hive_2011-10-11_19-26-12_894_9085644225727185586/-ext-10001&lt;br/&gt;
                      NumFilesPerFileSink: 1&lt;br/&gt;
                      table:&lt;br/&gt;
                          input format: org.apache.hadoop.mapred.TextInputFormat&lt;br/&gt;
                          output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&lt;br/&gt;
                          properties:&lt;br/&gt;
                            columns _col0&lt;br/&gt;
                            columns.types int&lt;br/&gt;
                            serialization.format 1&lt;br/&gt;
                      TotalFiles: 1&lt;br/&gt;
                      MultiFileSpray: false&lt;br/&gt;
      Needs Tagging: false&lt;/p&gt;

&lt;p&gt;  Stage: Stage-0&lt;br/&gt;
    Fetch Operator&lt;br/&gt;
      limit: -1&lt;/p&gt;


&lt;p&gt;if we set hive.optimize.ppd=false;&lt;/p&gt;

&lt;p&gt;STAGE DEPENDENCIES:&lt;br/&gt;
  Stage-1 is a root stage&lt;br/&gt;
  Stage-0 is a root stage&lt;/p&gt;

&lt;p&gt;STAGE PLANS:&lt;br/&gt;
  Stage: Stage-1&lt;br/&gt;
    Map Reduce&lt;br/&gt;
      Alias -&amp;gt; Map Operator Tree:&lt;br/&gt;
        sub:src3 &lt;br/&gt;
          TableScan&lt;br/&gt;
            alias: src3&lt;br/&gt;
            Select Operator&lt;br/&gt;
              expressions:&lt;br/&gt;
                    expr: UDFToInteger(key)&lt;br/&gt;
                    type: int&lt;br/&gt;
                    expr: CASE WHEN (((value like &apos;aaa%&apos;) or (value like &apos;vvv%&apos;))) THEN (1) ELSE (0) END&lt;br/&gt;
                    type: int&lt;br/&gt;
              outputColumnNames: _col0, _col1&lt;br/&gt;
              Filter Operator&lt;br/&gt;
                isSamplingPred: false&lt;br/&gt;
                predicate:&lt;br/&gt;
                    expr: (_col1 &amp;gt; 0)&lt;br/&gt;
                    type: boolean&lt;br/&gt;
                Select Operator&lt;br/&gt;
                  expressions:&lt;br/&gt;
                        expr: _col0&lt;br/&gt;
                        type: int&lt;br/&gt;
                  outputColumnNames: _col0&lt;br/&gt;
                  File Output Operator&lt;br/&gt;
                    compressed: false&lt;br/&gt;
                    GlobalTableId: 0&lt;br/&gt;
                    directory: hdfs://localhost:54310/tmp/hive-tianzhao/hive_2011-10-11_19-27-22_527_1729287213481398480/-ext-10001&lt;br/&gt;
                    NumFilesPerFileSink: 1&lt;br/&gt;
                    table:&lt;br/&gt;
                        input format: org.apache.hadoop.mapred.TextInputFormat&lt;br/&gt;
                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&lt;br/&gt;
                        properties:&lt;br/&gt;
                          columns _col0&lt;br/&gt;
                          columns.types int&lt;br/&gt;
                          serialization.format 1&lt;br/&gt;
                    TotalFiles: 1&lt;br/&gt;
                    MultiFileSpray: false&lt;br/&gt;
      Needs Tagging: false&lt;br/&gt;
      Path -&amp;gt; Alias:&lt;br/&gt;
        hdfs://localhost:54310/user/hive/warehouse/src3/pt=20110911000000 &lt;span class=&quot;error&quot;&gt;&amp;#91;sub:src3&amp;#93;&lt;/span&gt;&lt;br/&gt;
        hdfs://localhost:54310/user/hive/warehouse/src3/pt=20110912000000 &lt;span class=&quot;error&quot;&gt;&amp;#91;sub:src3&amp;#93;&lt;/span&gt;&lt;br/&gt;
        hdfs://localhost:54310/user/hive/warehouse/src3/pt=20110913000000 &lt;span class=&quot;error&quot;&gt;&amp;#91;sub:src3&amp;#93;&lt;/span&gt;&lt;br/&gt;
      Path -&amp;gt; Partition:&lt;br/&gt;
        hdfs://localhost:54310/user/hive/warehouse/src3/pt=20110911000000 &lt;br/&gt;
          Partition&lt;br/&gt;
            base file name: pt=20110911000000&lt;/p&gt;



</description>
                <environment></environment>
        <key id="12526789">HIVE-2497</key>
            <summary>partition pruning  prune some right partition under specific conditions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="binlijin">Lijin Bin</assignee>
                                    <reporter username="binlijin">Lijin Bin</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Wed, 12 Oct 2011 02:27:43 +0000</created>
                <updated>Fri, 16 Dec 2011 23:55:56 +0000</updated>
                            <resolved>Tue, 25 Oct 2011 03:45:13 +0000</resolved>
                                    <version>0.7.1</version>
                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13125550" author="coderplay" created="Wed, 12 Oct 2011 02:50:21 +0000"  >&lt;p&gt;We found partition pruning would incorrectly prune some partitions the MR job needs by running a sql like below&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; 
select user_id 
from
(
  select 
    cast(key as int) as user_id,
    case when (value like &apos;aaa%&apos; or value like &apos;vvv%&apos;) 
      then 1 
      else 0 
      end as tag_student
  from src3
) sub
where sub.tag_student &amp;gt; 0;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The patch should fix this problem.&lt;/p&gt;</comment>
                            <comment id="13125553" author="aoxiang" created="Wed, 12 Oct 2011 02:56:08 +0000"  >&lt;p&gt;PredicatePushDown will push the predicate  sub.tag_student &amp;gt; 0 down following TableScanOperator. When  partition pruning ,  try to iterate all partitions , the filter condition is :&lt;br/&gt;
case when (null or null)&lt;br/&gt;
then 1&lt;br/&gt;
else 0 &lt;br/&gt;
&amp;gt; 0&lt;br/&gt;
The case when return 0, so all partitions are pruned.&lt;/p&gt;</comment>
                            <comment id="13127949" author="ashutoshc" created="Fri, 14 Oct 2011 22:49:07 +0000"  >&lt;p&gt;Binlijin,&lt;br/&gt;
It will be good to also include a test case in the patch for regression purposes.&lt;/p&gt;</comment>
                            <comment id="13128693" author="aoxiang" created="Mon, 17 Oct 2011 06:24:06 +0000"  >&lt;p&gt;Ashutosh Chauhan, I add a test case in hive-2497.2.patch.&lt;br/&gt;
Because I use a version does not have PartitionConditionRemover, having PartitionConditionRemover and not having PartitionConditionRemover the situation is different, so the test case is not the one in above Description.&lt;/p&gt;</comment>
                            <comment id="13128708" author="ashutoshc" created="Mon, 17 Oct 2011 07:16:49 +0000"  >&lt;p&gt;Binlijin,&lt;br/&gt;
Is problem reproducible on a)trunk b) 0.8 branch? Is your patch targeted for 0.7 branch?&lt;/p&gt;</comment>
                            <comment id="13128711" author="aoxiang" created="Mon, 17 Oct 2011 07:41:15 +0000"  >&lt;p&gt;Ashutosh Chauhan,&lt;br/&gt;
the problem is reproducible on trunk, 0.8 branch, 0.7 branch that set hive.optimize.ppd=true;&lt;br/&gt;
the patch is for the version that uses PredicatePushDown and PartitionPruner, so 0.7 branch, 0.8 branch, and trunk they all can use the patch.&lt;/p&gt;</comment>
                            <comment id="13134455" author="namit" created="Mon, 24 Oct 2011 20:30:37 +0000"  >&lt;p&gt;reviewing right now&lt;/p&gt;</comment>
                            <comment id="13134482" author="namit" created="Mon, 24 Oct 2011 21:02:18 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13134733" author="namit" created="Tue, 25 Oct 2011 03:45:13 +0000"  >&lt;p&gt;Committed. Thanks binlijin&lt;/p&gt;</comment>
                            <comment id="13135313" author="hudson" created="Tue, 25 Oct 2011 18:28:11 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #1032 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/1032/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/1032/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2497&quot; title=&quot;partition pruning  prune some right partition under specific conditions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2497&quot;&gt;&lt;del&gt;HIVE-2497&lt;/del&gt;&lt;/a&gt; partition pruning prune some right partition under specific conditions&lt;br/&gt;
(binlijin via namit)&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;begin &lt;b&gt;PUBLIC&lt;/b&gt; platform impact section -&lt;br/&gt;
Bugzilla: #&lt;/li&gt;
	&lt;li&gt;end platform impact -&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;namit : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1188507&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1188507&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ppr/ExprProcFactory.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/ppr_allchildsarenull.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/ppr_allchildsarenull.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12499264" name="hive-2497.2.patch" size="22148" author="binlijin" created="Mon, 17 Oct 2011 06:18:09 +0000"/>
                            <attachment id="12498699" name="hive-2497.patch" size="1136" author="binlijin" created="Wed, 12 Oct 2011 02:36:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73844</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lk9j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123933</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>