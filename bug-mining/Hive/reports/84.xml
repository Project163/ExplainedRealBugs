<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:51:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-320] Issuing queries with COUNT(DISTINCT) on a column that may contain null values hits a NPE</title>
                <link>https://issues.apache.org/jira/browse/HIVE-320</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;When issuing a query that may contain a null value, I get a NPE. &lt;/p&gt;

&lt;p&gt;E.g. if &apos;middle_name&apos; potentially holds null values,&lt;/p&gt;

&lt;p&gt;select count(distinct middle_name) from people; will fail with the below exception.&lt;/p&gt;

&lt;p&gt;Other queries that work with the same input set:&lt;br/&gt;
select distinct middle_name from people;&lt;br/&gt;
select count(1), middle_name from people group by middle_name;&lt;/p&gt;

&lt;p&gt;java.io.IOException: org.apache.hadoop.hive.ql.metadata.HiveException: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.hadoop.hive.ql.exec.ExecReducer.reduce(ExecReducer.java:169)&lt;br/&gt;
	at org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:318)&lt;br/&gt;
	at org.apache.hadoop.mapred.TaskTracker$Child.main(TaskTracker.java:2198)&lt;br/&gt;
Caused by: org.apache.hadoop.hive.ql.metadata.HiveException: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.hadoop.hive.ql.exec.GroupByOperator.process(GroupByOperator.java:424)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.exec.ExecReducer.reduce(ExecReducer.java:164)&lt;br/&gt;
	... 2 more&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.hadoop.hive.ql.exec.GroupByOperator.updateAggregations(GroupByOperator.java:376)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.exec.GroupByOperator.processAggr(GroupByOperator.java:477)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.exec.GroupByOperator.process(GroupByOperator.java:420)&lt;br/&gt;
	... 3 more&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12416057">HIVE-320</key>
            <summary>Issuing queries with COUNT(DISTINCT) on a column that may contain null values hits a NPE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="namit">Namit Jain</assignee>
                                    <reporter username="ryancshih">Ryan Shih</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Mar 2009 02:50:47 +0000</created>
                <updated>Sat, 17 Dec 2011 00:08:45 +0000</updated>
                            <resolved>Tue, 17 Mar 2009 01:14:44 +0000</resolved>
                                    <version>0.3.0</version>
                    <version>0.6.0</version>
                                    <fixVersion>0.3.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12680215" author="namit" created="Mon, 9 Mar 2009 17:52:58 +0000"  >&lt;p&gt;Do you have a testcase, I was not able to reproduce it.&lt;/p&gt;
</comment>
                            <comment id="12680944" author="jsensarma" created="Wed, 11 Mar 2009 17:46:48 +0000"  >&lt;p&gt;sounds like a blocker to me. &lt;/p&gt;

&lt;p&gt;Can we get a test case please (DDL, data etc)?&lt;/p&gt;</comment>
                            <comment id="12681026" author="ryancshih" created="Wed, 11 Mar 2009 21:01:27 +0000"  >&lt;p&gt;I&apos;m generating the input into the schema using a custom serde. I&apos;ll work on stripping it down to get you a test case you can reproduce from but it may take some time. This is still consistently reproducible for me.&lt;/p&gt;</comment>
                            <comment id="12681392" author="rsm" created="Thu, 12 Mar 2009 16:59:04 +0000"  >&lt;p&gt;Isnt there a workaround where users can specify &apos;column is not null&apos; in the where clause?&lt;/p&gt;</comment>
                            <comment id="12681419" author="namit" created="Thu, 12 Mar 2009 17:54:47 +0000"  >&lt;p&gt;I would still consider this a BLOCKER - the user may want to nulls. Too simple a test to ignore.&lt;/p&gt;</comment>
                            <comment id="12681568" author="athusoo" created="Fri, 13 Mar 2009 01:07:43 +0000"  >&lt;p&gt;Load balancing...&lt;/p&gt;</comment>
                            <comment id="12681576" author="namit" created="Fri, 13 Mar 2009 01:54:01 +0000"  >&lt;p&gt;Found the bug - can someone review it - pretty simple change&lt;/p&gt;</comment>
                            <comment id="12681826" author="prasadc" created="Fri, 13 Mar 2009 16:55:18 +0000"  >&lt;p&gt;looks good. +1&lt;/p&gt;</comment>
                            <comment id="12681832" author="ryancshih" created="Fri, 13 Mar 2009 17:18:51 +0000"  >&lt;p&gt;Fixes problem on my on my test case also.&lt;/p&gt;

&lt;p&gt;Spent the better part of yesterday trying to distill a test case for you guys. It seems to happen only if there are at least two rows with the count(distinct) column null on both. Possibly it only occurs for custom serdes because as I was trying to adapt our proprietary format to something that I could post, it seemed that by using TextInputformat, the problem would go away. Can&apos;t confirm this 100% though. Since I saw a patch had been submitted, I stopped working on figuring it out.&lt;/p&gt;</comment>
                            <comment id="12682538" author="athusoo" created="Tue, 17 Mar 2009 01:14:44 +0000"  >&lt;p&gt;committed. Thanks Namit!!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12416187">HIVE-326</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12402106" name="hive.320.1.patch" size="835" author="namit" created="Fri, 13 Mar 2009 01:53:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73618</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 37 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0l95j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>122133</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>