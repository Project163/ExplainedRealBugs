<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:56:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-1422] skip counter update when RunningJob.getCounters() returns null</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1422</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Under heavy load circumstances on some Hadoop versions, we may get a NPE from trying to dereference a null Counters object.  I don&apos;t have a unit test which can reproduce it, but here&apos;s an example stack from a production cluster we saw today:&lt;/p&gt;

&lt;p&gt;10/06/21 13:01:10 ERROR exec.ExecDriver: Ended Job = job_201005200457_701060 with exception &apos;java.lang.NullPointerException(null)&apos;&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
at org.apache.hadoop.hive.ql.exec.Operator.updateCounters(Operator.java:999)&lt;br/&gt;
at org.apache.hadoop.hive.ql.exec.ExecDriver.updateCounters(ExecDriver.java:503)&lt;br/&gt;
at org.apache.hadoop.hive.ql.exec.ExecDriver.progress(ExecDriver.java:390)&lt;br/&gt;
at org.apache.hadoop.hive.ql.exec.ExecDriver.execute(ExecDriver.java:697)&lt;br/&gt;
at org.apache.hadoop.hive.ql.exec.Task.executeTask(Task.java:107)&lt;br/&gt;
at org.apache.hadoop.hive.ql.exec.TaskRunner.runSequential(TaskRunner.java:55)&lt;br/&gt;
at org.apache.hadoop.hive.ql.exec.TaskRunner.run(TaskRunner.java:47)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12467519">HIVE-1422</key>
            <summary>skip counter update when RunningJob.getCounters() returns null</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jsensarma">Joydeep Sen Sarma</assignee>
                                    <reporter username="jvs">John Sichi</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Jun 2010 01:33:52 +0000</created>
                <updated>Sat, 17 Dec 2011 00:00:46 +0000</updated>
                            <resolved>Mon, 2 Aug 2010 23:43:02 +0000</resolved>
                                    <version>0.6.0</version>
                                    <fixVersion>0.7.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12881300" author="namit" created="Tue, 22 Jun 2010 18:59:33 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;looks good&lt;/p&gt;</comment>
                            <comment id="12881365" author="namit" created="Tue, 22 Jun 2010 21:23:33 +0000"  >&lt;p&gt;Committed. Thanks John&lt;/p&gt;</comment>
                            <comment id="12892025" author="jsensarma" created="Sat, 24 Jul 2010 20:36:19 +0000"  >&lt;p&gt;reopening. i think the bug still exists:&lt;/p&gt;

&lt;p&gt;jc.getJob(rj.getJobID()) can return null if the jobtracker has retired the job by the time we poll for it. this happens very rarely. we are setting the returned value in the execdriver handle. and then trying to dereference it later on.&lt;/p&gt;

&lt;p&gt;if we have a valid runningjob reference - i don&apos;t think we have seen the getCounters call return null (in the past).&lt;/p&gt;</comment>
                            <comment id="12893852" author="jsensarma" created="Thu, 29 Jul 2010 23:05:12 +0000"  >&lt;p&gt;i looked at the hadoop source for 20 a bit. looks like both getCounters() and getJob() can return null (in case the job cannot be found). on 0.20 - completed jobs are looked up from persistent store - so i think this is pretty hard to happen (if it does - it seems like a hadoop bug). but for 17 (and maybe other versions in between) - we need to guard against these.&lt;/p&gt;</comment>
                            <comment id="12894126" author="jsensarma" created="Fri, 30 Jul 2010 19:45:45 +0000"  >&lt;p&gt;more hadoop goriness - i think John your fix was pretty spot on:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;there are three levels of job storage:&lt;br/&gt;
   a. fully in memory (can get status and counters)&lt;br/&gt;
   b. partially in memory (a la retired - can get status and not counters)&lt;br/&gt;
   c. on disk (completed jobs)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;so what is happening is that we are hitting case b. jobstatus is available - but not counters. we should probably anticipate the null jobstatus (which we used to get in 0.17 before b. and c. were available).&lt;/p&gt;

&lt;p&gt;what is the effect of not having final counter values available in Hive? Local mode also doesn&apos;t report counters i think.&lt;/p&gt;</comment>
                            <comment id="12894136" author="nzhang" created="Fri, 30 Jul 2010 20:30:04 +0000"  >&lt;p&gt;Counters are used in for reporting fatal errors from tasks to Driver so that it can kill the job. Currently fatal errors can be thrown from dynamic partition (when there are too many partitions created by a mapper) or map-side join when the threshold of # of rows of the small table has encountered. I think the fatal error mechanism is only enabled for the first case (DP) by default. &lt;/p&gt;</comment>
                            <comment id="12894207" author="jsensarma" created="Fri, 30 Jul 2010 23:50:33 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;cleaned up ExecDriver a bit - removed some dead code, some unnecessary global vars and throw better exception if JT has lost job&lt;/li&gt;
	&lt;li&gt;fixed &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1493&quot; title=&quot;incorrect explanation when local mode not chosen automatically&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1493&quot;&gt;&lt;del&gt;HIVE-1493&lt;/del&gt;&lt;/a&gt; here as well. it&apos;s a one line fix in a printf&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;running tests.&lt;/p&gt;</comment>
                            <comment id="12894658" author="nzhang" created="Mon, 2 Aug 2010 19:16:26 +0000"  >&lt;p&gt;Will take a look.&lt;/p&gt;</comment>
                            <comment id="12894699" author="jsensarma" created="Mon, 2 Aug 2010 20:34:13 +0000"  >&lt;p&gt;damn - this uncovered a bug in the tests and fixed an unncessary throws declaration.&lt;/p&gt;</comment>
                            <comment id="12894702" author="nzhang" created="Mon, 2 Aug 2010 20:44:06 +0000"  >&lt;p&gt;The previous patch still put fatal.q* to clientpositive/. Moving them to clientnegative/.&lt;/p&gt;</comment>
                            <comment id="12894748" author="nzhang" created="Mon, 2 Aug 2010 23:43:02 +0000"  >&lt;p&gt;Committed. Thanks Joydeep!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12470421">HIVE-1493</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12451075" name="1422.2.patch" size="9286" author="jsensarma" created="Mon, 2 Aug 2010 20:34:13 +0000"/>
                            <attachment id="12450932" name="1422.2.patch" size="8463" author="jsensarma" created="Fri, 30 Jul 2010 23:50:33 +0000"/>
                            <attachment id="12447651" name="HIVE-1422.1.patch" size="998" author="jvs" created="Tue, 22 Jun 2010 01:44:02 +0000"/>
                            <attachment id="12451076" name="HIVE-1422.3.patch" size="10250" author="nzhang" created="Mon, 2 Aug 2010 20:44:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72908</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 17 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lf0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123084</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>