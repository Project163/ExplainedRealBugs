<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:51:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-413] multi-table insert</title>
                <link>https://issues.apache.org/jira/browse/HIVE-413</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;some problem in multi-table insert if both of them contain grouping keys which are different.&lt;/p&gt;

&lt;p&gt;have not marked it a blocker, since a workaround exists (issue both inserts separately) - but this if the release is not yet done, we should fix this also.&lt;/p&gt;

&lt;p&gt;FROM SRC&lt;br/&gt;
INSERT OVERWRITE TABLE DEST1 SELECT SRC.key, src.value, COUNT(DISTINCT SUBSTR(SRC.value,5)) GROUP BY SRC.key\&lt;br/&gt;
, src.value&lt;br/&gt;
INSERT OVERWRITE TABLE DEST2 SELECT SRC.key, COUNT(DISTINCT SUBSTR(SRC.value,5)) GROUP BY SRC.key;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12422806">HIVE-413</key>
            <summary>multi-table insert</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="namit">Namit Jain</assignee>
                                    <reporter username="namit">Namit Jain</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Apr 2009 16:38:35 +0000</created>
                <updated>Sat, 17 Dec 2011 00:07:42 +0000</updated>
                            <resolved>Wed, 15 Apr 2009 21:19:02 +0000</resolved>
                                                    <fixVersion>0.4.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12699092" author="zshao" created="Wed, 15 Apr 2009 06:57:57 +0000"  >&lt;p&gt;GenMRRedSink1.process calls GenMapRedUtils.initPlan calls GenMapRedUtils.setTaskPlan calls GenMapRedUtils.setKeyAndValueDesc.&lt;br/&gt;
GenMRRedSink1.process calls GenMapRedUtils.splitPlan calls GenMapRedUtils.splitTasks calls GenMapRedUtils.setKeyAndValueDesc.&lt;/p&gt;

&lt;p&gt;In setKeyAndValueDesc (shown below, from GenMapRedUtils.java:236) we are walking down the operator tree to get all reachable reduceSinkOperators, even reduceSinkOperators of another MapRedTask (since the Operator Graph is not split yet).&lt;/p&gt;

&lt;p&gt;Instead of doing GenMapRedUtils.setKeyAndValueDesc inline in GenMapRedUtils.setTaskPlan and GenMapRedUtils.splitTasks, we should first break up all MapRedTasks, then for each task, for all topOps, call GenMapRedUtils.setKeyAndValueDesc.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void setKeyAndValueDesc(mapredWork plan, Operator&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Serializable&amp;gt; topOp) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (topOp &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; ReduceSinkOperator) {
      ReduceSinkOperator rs = (ReduceSinkOperator)topOp;
      plan.setKeyDesc(rs.getConf().getKeySerializeInfo());
      &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; tag = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.max(0, rs.getConf().getTag());
      List&amp;lt;tableDesc&amp;gt; tagToSchema = plan.getTagToValueDesc();
      &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (tag + 1 &amp;gt; tagToSchema.size()) {
        tagToSchema.add(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
      }
      tagToSchema.set(tag, rs.getConf().getValueSerializeInfo());
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
      List&amp;lt;Operator&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Serializable&amp;gt;&amp;gt; children = topOp.getChildOperators(); 
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (children != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(Operator&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Serializable&amp;gt; op: children) {
          setKeyAndValueDesc(plan, op);
        }
      }
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12699234" author="namit" created="Wed, 15 Apr 2009 15:09:56 +0000"  >&lt;p&gt;The above approach will not work, as in case of sub-queries there are no topOps to start with.&lt;br/&gt;
A simpler solution is to pass the reduce sink operator and use that to perform setKeyAndValueDesc()&lt;/p&gt;</comment>
                            <comment id="12699392" author="zshao" created="Wed, 15 Apr 2009 21:19:02 +0000"  >&lt;p&gt;Committed. Thanks Namit!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12405536" name="hive.413.1.patch" size="18016" author="namit" created="Wed, 15 Apr 2009 15:10:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73550</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 32 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0l9nz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>122216</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-413&quot; title=&quot;multi-table insert&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-413&quot;&gt;&lt;strike&gt;HIVE-413&lt;/strike&gt;&lt;/a&gt;. Fix multi-table insert. (Namit Jain via zshao)</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>