<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:33:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-10722] external table creation with msck in Hive can create unusable partition</title>
                <link>https://issues.apache.org/jira/browse/HIVE-10722</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;There can be directories in HDFS containing unprintable characters; when doing hadoop fs -ls, these characters are not even visible, and can only be seen for example if output is piped thru od.&lt;br/&gt;
When these are loaded via msck, they are stored in e.g. mysql as &quot;?&quot; (literal question mark, findable via LIKE &apos;%?%&apos; in db) and show accordingly in Hive.&lt;br/&gt;
However, datanucleus appears to encode it as %3F; this causes the partition to be unusable - it cannot be dropped, and other operations like drop table get stuck (didn&apos;t investigate in detail why; drop table got unstuck as soon as the partition was removed from metastore).&lt;/p&gt;

&lt;p&gt;We should probably have a 2-way option for such cases - error out on load (default), or convert to &apos;?&apos;/drop such characters (and have partition that actually works, too).&lt;/p&gt;

&lt;p&gt;We should also check if partitions with &apos;?&apos; inserted explicitly work at all with datanucleus.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12830254">HIVE-10722</key>
            <summary>external table creation with msck in Hive can create unusable partition</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sershe">Sergey Shelukhin</assignee>
                                    <reporter username="sershe">Sergey Shelukhin</reporter>
                        <labels>
                            <label>TODOC1.3</label>
                    </labels>
                <created>Fri, 15 May 2015 18:13:48 +0000</created>
                <updated>Wed, 4 Oct 2017 20:14:24 +0000</updated>
                            <resolved>Sat, 30 May 2015 00:08:26 +0000</resolved>
                                    <version>0.14.1</version>
                    <version>1.0.0</version>
                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14549684" author="sershe" created="Tue, 19 May 2015 02:35:05 +0000"  >&lt;p&gt;I have a fix for the main issue, fixing some rough edges...&lt;/p&gt;</comment>
                            <comment id="14551160" author="sershe" created="Tue, 19 May 2015 20:30:28 +0000"  >&lt;p&gt;This fixes the standard formatter to provide proper output, and adds validation to msck to make sure metastore will actually create matching partitions &lt;/p&gt;</comment>
                            <comment id="14551161" author="sershe" created="Tue, 19 May 2015 20:30:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; can you take a look?&lt;/p&gt;</comment>
                            <comment id="14551170" author="sershe" created="Tue, 19 May 2015 20:34:11 +0000"  >&lt;p&gt;cannot post RB, fails to validate diff... probably because of unprintable characters&lt;/p&gt;</comment>
                            <comment id="14552023" author="hiveqa" created="Wed, 20 May 2015 08:54:03 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12733941/HIVE-10722.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12733941/HIVE-10722.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 2 failed/errored test(s), 8966 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver_encryption_insert_partition_static
org.apache.hive.hcatalog.streaming.TestStreaming.testTransactionBatchEmptyCommit
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3954/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3954/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3954/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3954/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-3954/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-3954/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12733941 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14553009" author="sershe" created="Wed, 20 May 2015 20:02:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thejas&quot; class=&quot;user-hover&quot; rel=&quot;thejas&quot;&gt;thejas&lt;/a&gt; can you take a look?&lt;/p&gt;</comment>
                            <comment id="14553133" author="mmokhtar" created="Wed, 20 May 2015 21:13:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt;&lt;br/&gt;
Can this be ported to 0.13 as well?&lt;/p&gt;</comment>
                            <comment id="14555094" author="sershe" created="Thu, 21 May 2015 21:31:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sushanth&quot; class=&quot;user-hover&quot; rel=&quot;sushanth&quot;&gt;sushanth&lt;/a&gt; can you take a look?&lt;/p&gt;</comment>
                            <comment id="14555108" author="sushanth" created="Thu, 21 May 2015 21:36:45 +0000"  >&lt;p&gt;Looking through it.&lt;/p&gt;</comment>
                            <comment id="14555128" author="sushanth" created="Thu, 21 May 2015 21:51:11 +0000"  >&lt;p&gt;I&apos;m +1 on the change in general. Would it be possible to add one more test, a negative test for hive.msck.path.validation=throw ?&lt;/p&gt;</comment>
                            <comment id="14563385" author="sershe" created="Thu, 28 May 2015 18:11:13 +0000"  >&lt;p&gt;Seems rather pointless, it&apos;s almost the same functionality and MiniMr tests add a long time to test run cause they take forever in setup. Should I still treat that as +1? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14563782" author="sushanth" created="Thu, 28 May 2015 22:11:30 +0000"  >&lt;p&gt;I don&apos;t know that I see it as pointless - I see value in &quot;throw&quot; as a setting here, as a way of making sure that the process errors if you have invalid partitions.&lt;/p&gt;

&lt;p&gt;And in that case, I was thinking that we should have &quot;proof&quot; that for the strict case, we show that we fail for sure and not silently succeed. The problem with not having a negative test in this case is if someone modifies this later on, and makes the &quot;throw&quot; behaviour also succeed. This is possible, since in your code, you do not explicitly check for &quot;throw&quot;, you explicitly check for &quot;skip&quot; and &quot;ignore&quot;, and default to &quot;throw&quot; if it doesn&apos;t follow that path. And with the lack of explicit checking or comments there, it is easy for someone modifying it later to not realize that that serves a purpose.&lt;/p&gt;

&lt;p&gt;I think I&apos;d still very much like a test case for this, but that can be handled in a separate jira, and can be taken on at a later date. If you&apos;re okay with that, I&apos;m +1.&lt;/p&gt;</comment>
                            <comment id="14563884" author="sershe" created="Thu, 28 May 2015 23:28:45 +0000"  >&lt;p&gt;Added negative test&lt;/p&gt;</comment>
                            <comment id="14563925" author="sushanth" created="Thu, 28 May 2015 23:46:39 +0000"  >&lt;p&gt;Thanks! Sorry to be so finicky.&lt;/p&gt;

&lt;p&gt;+1 on the new patch.&lt;/p&gt;</comment>
                            <comment id="14565471" author="hiveqa" created="Fri, 29 May 2015 21:42:46 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12735994/HIVE-10722.01.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12735994/HIVE-10722.01.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 8980 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_fold_case
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_ql_rewrite_gbtoidx_cbo_2
org.apache.hadoop.hive.thrift.TestHadoop20SAuthBridge.testSaslWithHiveMetaStore
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4095/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4095/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4095/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4095/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4095/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4095/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12735994 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14565685" author="sershe" created="Sat, 30 May 2015 00:08:26 +0000"  >&lt;p&gt;committed to master&lt;/p&gt;</comment>
                            <comment id="14566238" author="lefty@hortonworks.com" created="Sat, 30 May 2015 22:50:56 +0000"  >&lt;p&gt;Doc note:  &lt;b&gt;hive.msck.path.validation&lt;/b&gt; needs to be documented in Configuration Properties.  Should it go in the query &amp;amp; DDL execution section or the metastore section?&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-QueryandDDLExecution&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Configuration Properties &amp;#8211; Query and DDL Execution &lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-MetaStore&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Configuration Properties &amp;#8211; MetaStore &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Where does usage information belong?&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;LanguageManual &amp;#8211; DML &lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-RecoverPartitions(MSCKREPAIRTABLE)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;LanguageManual &amp;#8211; DDL &amp;#8211; Recover Partitions (MSCK REPAIR TABLE) &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14567904" author="sershe" created="Mon, 1 Jun 2015 19:59:45 +0000"  >&lt;p&gt;Added to LanguageManual &#8211; DDL &#8211; Recover Partitions (MSCK REPAIR TABLE) &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12735994" name="HIVE-10722.01.patch" size="24443" author="sershe" created="Thu, 28 May 2015 23:28:45 +0000"/>
                            <attachment id="12733941" name="HIVE-10722.patch" size="22261" author="sershe" created="Tue, 19 May 2015 20:30:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 25 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2esqn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>