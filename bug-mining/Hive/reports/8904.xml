<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:27:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-29175] Wrong Anti join conversion leading to missing results</title>
                <link>https://issues.apache.org/jira/browse/HIVE-29175</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Wrong Anti join conversion leading to missing results.&lt;/p&gt;

&lt;p&gt;Reproduction steps:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;create table tab1 (col1 int, col2 int);
create table tab2 (col1 int, col2 int);

insert into tab1 values
(123, 1000),
(456, 1000),
(123, 5000);

insert into tab2 values
(123, 1000),
(456, 1000),
(788, 1000);

select t1.col1, t1.col2 from tab1 t1
left join tab2 t2
on t2.col1=t1.col1 AND t2.col2=t1.col2
left join tab1 t3
on t3.col1=t1.col1 AND t2.col2=t1.col2
where t3.col1 is null;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When&#160;&lt;br/&gt;
&lt;b&gt;set hive.auto.convert.anti.join=false;&lt;/b&gt;&#160;&lt;br/&gt;
then above select query returning below rows&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+----------+----------+
| t1.col1  | t1.col2  |
+----------+----------+
| 123      | 5000     |
+----------+----------+&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but when&lt;br/&gt;
&lt;b&gt;set hive.auto.convert.anti.join=true;&lt;/b&gt;&lt;br/&gt;
then its returning empty rows.&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13627877">HIVE-29175</key>
            <summary>Wrong Anti join conversion leading to missing results</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Dayakar">Dayakar M</assignee>
                                    <reporter username="Dayakar">Dayakar M</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 2 Sep 2025 12:24:44 +0000</created>
                <updated>Mon, 8 Sep 2025 06:52:16 +0000</updated>
                            <resolved>Mon, 8 Sep 2025 06:51:19 +0000</resolved>
                                                    <fixVersion>4.2.0</fixVersion>
                                    <component>Hive</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="18017704" author="thomas.rebele" created="Tue, 2 Sep 2025 15:33:58 +0000"  >&lt;p&gt;I think this is because of the &lt;tt&gt;t2.col2=t1.col2&lt;/tt&gt; condition when joining t3. The same condition holds when joining t1 and t2. Except if t2 could not be joined. In that case, t2.col2 is NULL, therefore t3 will not be joined either.&lt;/p&gt;

&lt;p&gt;The plain without antijoin:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
HiveProject(col1=[$0], col2=[$1])
  HiveFilter(condition=[IS NULL($4)])
    HiveJoin(condition=[AND(=($4, $0), =($3, $1))], joinType=[left], algorithm=[none], cost=[not available])
      HiveJoin(condition=[AND(=($2, $0), =($3, $1))], joinType=[left], algorithm=[none], cost=[not available])
        HiveProject(col1=[$0], col2=[$1])
          HiveTableScan(table=[[&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;, tab1]], table:alias=[t1])
        HiveProject(col1=[$0], col2=[$1])
          HiveFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($1))])
            HiveTableScan(table=[[&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;, tab2]], table:alias=[t2])
      HiveProject(col1=[$0])
        HiveFilter(condition=[IS NOT NULL($0)])
          HiveTableScan(table=[[&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;, tab1]], table:alias=[t3]) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and with antijoin:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
HiveProject(col1=[$0], col2=[$1])
  HiveAntiJoin(condition=[AND(=($4, $0), =($3, $1))], joinType=[anti])
    HiveJoin(condition=[AND(=($2, $0), =($3, $1))], joinType=[left], algorithm=[none], cost=[not available])
      HiveProject(col1=[$0], col2=[$1])
        HiveTableScan(table=[[&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;, tab1]], table:alias=[t1])
      HiveProject(col1=[$0], col2=[$1])
        HiveFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($1))])
          HiveTableScan(table=[[&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;, tab2]], table:alias=[t2])
    HiveProject(col1=[$0])
      HiveFilter(condition=[IS NOT NULL($0)])
        HiveTableScan(table=[[&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;, tab1]], table:alias=[t3])&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Maybe the antijoin condition needs to be adapted.&lt;/p&gt;</comment>
                            <comment id="18017847" author="zabetak" created="Wed, 3 Sep 2025 08:04:30 +0000"  >&lt;p&gt;The data seem to be missing from the description so it is not clear where the row &quot;123	5000&quot; comes from.&lt;/p&gt;</comment>
                            <comment id="18017853" author="thomas.rebele" created="Wed, 3 Sep 2025 08:25:12 +0000"  >&lt;p&gt;I had simplified the query and forgot to copy-paste the INSERT statements. Fixed.&lt;/p&gt;</comment>
                            <comment id="18018094" author="thomas.rebele" created="Thu, 4 Sep 2025 11:34:02 +0000"  >&lt;p&gt;Just a thought: maybe we can keep the anti-join by pushing the corresponding filter (&lt;tt&gt;t2.col2=t1.col2&lt;/tt&gt;) plus NULL checks to the LHS? To be investigated.&lt;/p&gt;

&lt;p&gt;The ticket is somehow related to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-29176&quot; title=&quot;Wrong result when HiveAntiJoin is replacing an IS NULL filter on a nullable column&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-29176&quot;&gt;HIVE-29176&lt;/a&gt;, so maybe it makes sense to do the PR for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-29176&quot; title=&quot;Wrong result when HiveAntiJoin is replacing an IS NULL filter on a nullable column&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-29176&quot;&gt;HIVE-29176&lt;/a&gt; first.&lt;/p&gt;</comment>
                            <comment id="18018743" author="krisztiankasa" created="Mon, 8 Sep 2025 06:51:19 +0000"  >&lt;p&gt;Merged to master. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Dayakar&quot; class=&quot;user-hover&quot; rel=&quot;Dayakar&quot;&gt;Dayakar&lt;/a&gt; for the patch and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomas.rebele&quot; class=&quot;user-hover&quot; rel=&quot;thomas.rebele&quot;&gt;thomas.rebele&lt;/a&gt; for the review.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13627978">HIVE-29176</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1xikg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>