<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:18:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-22622] Hive allows to create a struct with duplicate attribute names</title>
                <link>https://issues.apache.org/jira/browse/HIVE-22622</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;When you create at table with a struct with twice the same attribute name, hive allow you to create it.&lt;br/&gt;
create table test_struct( duplicateColumn struct&amp;lt;id:int, id:int&amp;gt;);&lt;br/&gt;
You can insert data into it :&lt;br/&gt;
insert into test_struct select named_struct(&quot;id&quot;,1,&quot;id&quot;,1);&lt;/p&gt;

&lt;p&gt;But you can not read it :&lt;br/&gt;
select * from test_struct;&lt;br/&gt;
Return : java.io.IOException: java.io.IOException: Error reading file: hdfs://.../test_struct/delta_0000001_0000001_0000/bucket_00000 ,&lt;/p&gt;

&lt;p&gt;We can create and insert. but fail on read the Struct part of the tables. We can still read all other columns (if we have more than one) but not the struct anymore.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13273795">HIVE-22622</key>
            <summary>Hive allows to create a struct with duplicate attribute names</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kkasa">Krisztian Kasa</assignee>
                                    <reporter username="dkuzmenko">Denys Kuzmenko</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 11 Dec 2019 08:33:51 +0000</created>
                <updated>Tue, 27 Feb 2024 22:24:02 +0000</updated>
                            <resolved>Tue, 1 Sep 2020 22:29:39 +0000</resolved>
                                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="17186410" author="kkasa" created="Fri, 28 Aug 2020 09:32:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jcamachorodriguez&quot; class=&quot;user-hover&quot; rel=&quot;jcamachorodriguez&quot;&gt;jcamachorodriguez&lt;/a&gt;&lt;br/&gt;
It seems that this was fixed already because I was not able to repro: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
create table test_struct( duplicateColumn struct&amp;lt;id:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, id:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;);

insert into test_struct select named_struct(&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;,1,&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;,2);

select * from test_struct;
{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:2}

select duplicateColumn.id from test_struct;
1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Should the field name uniqueness checked when creating the table anyway? Since only one of the fields can be queried directly.&lt;/p&gt;</comment>
                            <comment id="17186750" author="jcamacho" created="Fri, 28 Aug 2020 18:26:31 +0000"  >&lt;p&gt;I think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zabetak&quot; class=&quot;user-hover&quot; rel=&quot;zabetak&quot;&gt;zabetak&lt;/a&gt; has faced similar issue. I think field uniqueness should be checked indeed, otherwise I am not sure how things work.&lt;/p&gt;</comment>
                            <comment id="17186922" author="zabetak" created="Sat, 29 Aug 2020 09:27:48 +0000"  >&lt;p&gt;I just tried the following test on master and it fails.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; person
(
    `id`      &lt;span class=&quot;code-keyword&quot;&gt;int&lt;/span&gt;,
    `address` struct&amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;number&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;int&lt;/span&gt;,street:&lt;span class=&quot;code-keyword&quot;&gt;string&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;number&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;int&lt;/span&gt;&amp;gt;
)
    &lt;span class=&quot;code-keyword&quot;&gt;ROW&lt;/span&gt; FORMAT SERDE
        &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.hadoop.hive.ql.io.orc.OrcSerde&apos;&lt;/span&gt;
    STORED &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; INPUTFORMAT
        &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.hadoop.hive.ql.io.orc.OrcInputFormat&apos;&lt;/span&gt;
        OUTPUTFORMAT
            &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat&apos;&lt;/span&gt;;

&lt;span class=&quot;code-keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;INTO&lt;/span&gt; person
&lt;span class=&quot;code-keyword&quot;&gt;VALUES&lt;/span&gt; (1, named_struct(&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;number&lt;/span&gt;&apos;&lt;/span&gt;, 61, &lt;span class=&quot;code-quote&quot;&gt;&apos;street&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Terrasse&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;number&lt;/span&gt;&apos;&lt;/span&gt;, 62));
&lt;span class=&quot;code-keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;INTO&lt;/span&gt; person
&lt;span class=&quot;code-keyword&quot;&gt;VALUES&lt;/span&gt; (2, named_struct(&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;number&lt;/span&gt;&apos;&lt;/span&gt;, 51, &lt;span class=&quot;code-quote&quot;&gt;&apos;street&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Terrasse&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;number&lt;/span&gt;&apos;&lt;/span&gt;, 52));

&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; address.&lt;span class=&quot;code-keyword&quot;&gt;number&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; person;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And it fails with the following exception when performing the SELECT statement:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.io.IOException: java.io.IOException: Error reading file: file:/home/stamatis/Projects/Apache/hive/itests/qtest/target/localfs/warehouse/person/000000_0
	at org.apache.hadoop.hive.ql.exec.FetchOperator.getNextRow(FetchOperator.java:638)
	at org.apache.hadoop.hive.ql.exec.FetchOperator.pushRow(FetchOperator.java:545)
	at org.apache.hadoop.hive.ql.exec.FetchTask.fetch(FetchTask.java:150)
	at org.apache.hadoop.hive.ql.Driver.getResults(Driver.java:556)
	at org.apache.hadoop.hive.ql.reexec.ReExecDriver.getResults(ReExecDriver.java:243)
	at org.apache.hadoop.hive.cli.CliDriver.processLocalCmd(CliDriver.java:279)
	at org.apache.hadoop.hive.cli.CliDriver.processCmd1(CliDriver.java:203)
	at org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:129)
	at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:424)
	at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:355)
	at org.apache.hadoop.hive.ql.QTestUtil.executeClientInternal(QTestUtil.java:740)
	at org.apache.hadoop.hive.ql.QTestUtil.executeClient(QTestUtil.java:710)
	at org.apache.hadoop.hive.cli.control.CoreCliDriver.runTest(CoreCliDriver.java:170)
	at org.apache.hadoop.hive.cli.control.CliAdapter.runTest(CliAdapter.java:157)
	at org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver(TestMiniLlapLocalCliDriver.java:62)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.apache.hadoop.hive.cli.control.CliAdapter$2$1.evaluate(CliAdapter.java:135)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.BlockJUnit4ClassRunner$1.evaluate(BlockJUnit4ClassRunner.java:100)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:103)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:63)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.junit.runners.Suite.runChild(Suite.java:128)
	at org.junit.runners.Suite.runChild(Suite.java:27)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.apache.hadoop.hive.cli.control.CliAdapter$1$1.evaluate(CliAdapter.java:95)
	at org.junit.rules.RunRules.evaluate(RunRules.java:20)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:377)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:138)
	at org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:465)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:451)
Caused by: java.io.IOException: Error reading file: file:/home/stamatis/Projects/Apache/hive/itests/qtest/target/localfs/warehouse/person/000000_0
	at org.apache.orc.impl.RecordReaderImpl.nextBatch(RecordReaderImpl.java:1329)
	at org.apache.hadoop.hive.ql.io.orc.RecordReaderImpl.ensureBatch(RecordReaderImpl.java:88)
	at org.apache.hadoop.hive.ql.io.orc.RecordReaderImpl.hasNext(RecordReaderImpl.java:104)
	at org.apache.hadoop.hive.ql.io.orc.OrcInputFormat$OrcRecordReader.next(OrcInputFormat.java:256)
	at org.apache.hadoop.hive.ql.io.orc.OrcInputFormat$OrcRecordReader.next(OrcInputFormat.java:231)
	at org.apache.hadoop.hive.ql.exec.FetchOperator.getNextRow(FetchOperator.java:605)
	... 53 more
Caused by: java.io.EOFException: Read past end of RLE integer from compressed stream Stream for column 5 kind DATA position: 6 length: 6 range: 0 offset: 23 limit: 23 range 0 = 0 to 6 uncompressed: 3 to 3
	at org.apache.orc.impl.RunLengthIntegerReaderV2.readValues(RunLengthIntegerReaderV2.java:61)
	at org.apache.orc.impl.RunLengthIntegerReaderV2.next(RunLengthIntegerReaderV2.java:323)
	at org.apache.orc.impl.RunLengthIntegerReaderV2.nextVector(RunLengthIntegerReaderV2.java:373)
	at org.apache.orc.impl.TreeReaderFactory$IntTreeReader.nextVector(TreeReaderFactory.java:570)
	at org.apache.orc.impl.TreeReaderFactory$StructTreeReader.nextVector(TreeReaderFactory.java:2077)
	at org.apache.orc.impl.TreeReaderFactory$StructTreeReader.nextBatch(TreeReaderFactory.java:2059)
	at org.apache.orc.impl.RecordReaderImpl.nextBatch(RecordReaderImpl.java:1322)
	... 58 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Apart from the failure the SELECT statement is also ambiguous since we cannot distinguish between the two attributes of the struct. Due to the above I believe the best solution would be to dissallow duplicate fields in structs. &lt;/p&gt;

&lt;p&gt;Note that if the table is declared to be in JSON format the duplicate checks seem to be in place and the CREATE statement fails so I think the declared format of the table is important for reproducing the problem.&lt;/p&gt;</comment>
                            <comment id="17186923" author="zabetak" created="Sat, 29 Aug 2020 09:35:32 +0000"  >&lt;p&gt;If the queries do not reference the column with the problematic struct there is no exception. This means that a lot of time can pass before realizing that there is a problem which can make the problem hard to debug. &lt;/p&gt;</comment>
                            <comment id="17188842" author="jcamacho" created="Tue, 1 Sep 2020 22:29:39 +0000"  >&lt;p&gt;Pushed to master, thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkasa&quot; class=&quot;user-hover&quot; rel=&quot;kkasa&quot;&gt;kkasa&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 11 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z09jvk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>