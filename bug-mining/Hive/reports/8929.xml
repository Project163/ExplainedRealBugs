<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:27:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-29145] HMS Iceberg REST fails on common HMS</title>
                <link>https://issues.apache.org/jira/browse/HIVE-29145</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;NOTE&lt;/b&gt;: &lt;b&gt;The Iceberg REST Catalog server works properly if it is lanched by &lt;a href=&quot;https://dlcdn.apache.org/hive/hive-standalone-metastore-4.1.0/hive-standalone-metastore-4.1.0-bin.tar.gz&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;standalone HMS&lt;/a&gt;, but it can not work if it is lanched by &lt;a href=&quot;https://dlcdn.apache.org/hive/hive-4.1.0/apache-hive-4.1.0-bin.tar.gz&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;common HMS&lt;/a&gt;.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I tested the HMS iceberg rest catalog against Spark:&lt;/p&gt;

&lt;p&gt;1. HMS configuration&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &amp;lt;property&amp;gt;
    &amp;lt;name&amp;gt;hive.metastore.catalog.servlet.port&amp;lt;/name&amp;gt;
    &amp;lt;value&amp;gt;9088&amp;lt;/value&amp;gt;
    &amp;lt;description&amp;gt;iceberg &lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt; catalog port&amp;lt;/description&amp;gt;
  &amp;lt;/property&amp;gt;

  &amp;lt;property&amp;gt;
    &amp;lt;name&amp;gt;hive.metastore.catalog.servlet.auth&amp;lt;/name&amp;gt;
    &amp;lt;value&amp;gt;none&amp;lt;/value&amp;gt;
    &amp;lt;description&amp;gt;&amp;lt;/description&amp;gt;
  &amp;lt;/property&amp;gt;

  &amp;lt;property&amp;gt;
    &amp;lt;name&amp;gt;hive.metastore.properties.servlet.auth&amp;lt;/name&amp;gt;
    &amp;lt;value&amp;gt;simple&amp;lt;/value&amp;gt;
    &amp;lt;description&amp;gt;&amp;lt;/description&amp;gt;
  &amp;lt;/property&amp;gt;

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;2. Prepare Spark env:&lt;br/&gt;
Download spark package spark-3.5.6-bin-hadoop3.tgz, and put &lt;a href=&quot;https://search.maven.org/remotecontent?filepath=org/apache/iceberg/iceberg-spark-runtime-3.5_2.12/1.9.2/iceberg-spark-runtime-3.5_2.12-1.9.2.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;spark-iceberg&lt;/a&gt; runtime jar into spark jar directory.&lt;/p&gt;

&lt;p&gt;3. Test spark + HMS iceberg rest catalog&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
./spark-3.5.6-bin-hadoop3/bin/spark-sql \
--master local \
--deploy-mode client \
--conf spark.sql.extensions=org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions \
--conf spark.sql.catalog.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;=org.apache.iceberg.spark.SparkCatalog \
--conf spark.sql.catalog.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.type=&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt; \
--conf spark.sql.catalog.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.uri=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:9088/iceberg/
&lt;/span&gt;
spark-sql (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;)&amp;gt; use &lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;4. You will find error log both in spark side and HMS server side:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Spark error log
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Server error: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;: {
&lt;span class=&quot;code-quote&quot;&gt;&quot;servlet&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.iceberg.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.HMSCatalogServlet-7e848aea&quot;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&quot;cause0&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;java.lang.NoSuchMethodError: &amp;amp;apos;com.codahale.metrics.Counter org.apache.hadoop.hive.metastore.metrics.Metrics.getOrCreateCounter(java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)&amp;amp;apos;&quot;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;java.lang.NoSuchMethodError: &amp;amp;apos;com.codahale.metrics.Counter org.apache.hadoop.hive.metastore.metrics.Metrics.getOrCreateCounter(java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)&amp;amp;apos;&quot;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&quot;url&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;/iceberg/v1/config&quot;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;500&quot;&lt;/span&gt;
}
org.apache.iceberg.exceptions.ServiceFailureException: Server error: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;: {
&lt;span class=&quot;code-quote&quot;&gt;&quot;servlet&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.iceberg.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.HMSCatalogServlet-7e848aea&quot;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&quot;cause0&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;java.lang.NoSuchMethodError: &amp;amp;apos;com.codahale.metrics.Counter org.apache.hadoop.hive.metastore.metrics.Metrics.getOrCreateCounter(java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)&amp;amp;apos;&quot;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;java.lang.NoSuchMethodError: &amp;amp;apos;com.codahale.metrics.Counter org.apache.hadoop.hive.metastore.metrics.Metrics.getOrCreateCounter(java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)&amp;amp;apos;&quot;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&quot;url&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;/iceberg/v1/config&quot;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;500&quot;&lt;/span&gt;
}
        at org.apache.iceberg.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.ErrorHandlers$DefaultErrorHandler.accept(ErrorHandlers.java:241)
        at org.apache.iceberg.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.ErrorHandlers$DefaultErrorHandler.accept(ErrorHandlers.java:212)
        at org.apache.iceberg.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.HTTPClient.throwFailure(HTTPClient.java:215)
        at org.apache.iceberg.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.HTTPClient.execute(HTTPClient.java:299)
        at org.apache.iceberg.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.BaseHTTPClient.get(BaseHTTPClient.java:77)
        at org.apache.iceberg.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.RESTSessionCatalog.fetchConfig(RESTSessionCatalog.java:1021)
        at org.apache.iceberg.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.RESTSessionCatalog.initialize(RESTSessionCatalog.java:202)
        at org.apache.iceberg.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.RESTCatalog.initialize(RESTCatalog.java:82)
        at org.apache.iceberg.CatalogUtil.loadCatalog(CatalogUtil.java:277)
        at org.apache.iceberg.CatalogUtil.buildIcebergCatalog(CatalogUtil.java:331)
        at org.apache.iceberg.spark.SparkCatalog.buildIcebergCatalog(SparkCatalog.java:153)
        at org.apache.iceberg.spark.SparkCatalog.initialize(SparkCatalog.java:752)
        at org.apache.spark.sql.connector.catalog.Catalogs$.load(Catalogs.scala:65)
        at org.apache.spark.sql.connector.catalog.CatalogManager.$anonfun$catalog$1(CatalogManager.scala:54)
        at scala.collection.mutable.HashMap.getOrElseUpdate(HashMap.scala:86)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;HMS server error log&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2025-08-14T15:55:47,203  WARN [qtp1558127130-51] server.HttpChannel: /iceberg/v1/config
java.lang.NoSuchMethodError: &lt;span class=&quot;code-quote&quot;&gt;&apos;com.codahale.metrics.Counter org.apache.hadoop.hive.metastore.metrics.Metrics.getOrCreateCounter(java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)&apos;&lt;/span&gt;
        at org.apache.iceberg.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.HMSCatalogAdapter.handleRequest(HMSCatalogAdapter.java:538) ~[hive-standalone-metastore-&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;-catalog-4.1.0.jar:4.1.0]
        at org.apache.iceberg.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.HMSCatalogAdapter.execute(HMSCatalogAdapter.java:632) ~[hive-standalone-metastore-&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;-catalog-4.1.0.jar:4.1.0]
        at org.apache.iceberg.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.HMSCatalogServlet.service(HMSCatalogServlet.java:80) ~[hive-standalone-metastore-&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;-catalog-4.1.0.jar:4.1.0]
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:790) ~[javax.servlet-api-3.1.0.jar:3.1.0]
        at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:799) ~[jetty-servlet-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:554) ~[jetty-servlet-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143) ~[jetty-server-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:772) ~[jetty-server-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127) ~[jetty-server-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:235) ~[jetty-server-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1440) ~[jetty-server-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:188) ~[jetty-server-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:505) ~[jetty-servlet-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:186) ~[jetty-server-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1355) ~[jetty-server-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141) ~[jetty-server-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:191) ~[jetty-server-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127) ~[jetty-server-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.server.Server.handle(Server.java:516) ~[jetty-server-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.server.HttpChannel.lambda$handle$1(HttpChannel.java:487) ~[jetty-server-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.server.HttpChannel.dispatch(HttpChannel.java:732) ~[jetty-server-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:479) ~[jetty-server-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:277) ~[jetty-server-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:311) ~[jetty-io-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:105) ~[jetty-io-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.io.ChannelEndPoint$1.run(ChannelEndPoint.java:104) ~[jetty-io-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:338) ~[jetty-util-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:315) ~[jetty-util-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:173) ~[jetty-util-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.produce(EatWhatYouKill.java:137) ~[jetty-util-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:883) [jetty-util-9.4.57.v20241219.jar:9.4.57.v20241219]
        at org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.run(QueuedThreadPool.java:1034) [jetty-util-9.4.57.v20241219.jar:9.4.57.v20241219]
        at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:833) [?:?]

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13626354">HIVE-29145</key>
            <summary>HMS Iceberg REST fails on common HMS</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="okumin">Shohei Okumiya</assignee>
                                    <reporter username="zhangbutao">Butao Zhang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 14 Aug 2025 08:26:57 +0000</created>
                <updated>Thu, 30 Oct 2025 06:16:11 +0000</updated>
                            <resolved>Wed, 29 Oct 2025 09:18:21 +0000</resolved>
                                    <version>4.1.0</version>
                                    <fixVersion>4.2.0</fixVersion>
                                    <component>Iceberg integration</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="18013860" author="zhangbutao" created="Thu, 14 Aug 2025 08:30:09 +0000"  >&lt;p&gt;Not sure why hit the error ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.NoSuchMethodError: &lt;span class=&quot;code-quote&quot;&gt;&apos;com.codahale.metrics.Counter org.apache.hadoop.hive.metastore.metrics.Metrics.getOrCreateCounter(java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)&apos;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="18022665" author="okumin" created="Thu, 25 Sep 2025 07:25:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhangbutao&quot; class=&quot;user-hover&quot; rel=&quot;zhangbutao&quot;&gt;zhangbutao&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Don&apos;t trust me because I&apos;m less confident with my memory.&lt;/p&gt;

&lt;p&gt;If I remember correctly, `com.codahale.metrics.Counter` is relocated to `org.apache.hive.com.codahale.metrics.Counter` in hive-exec.jar. As hive-exec depends on standalone-metastore, it includes shaded standalone-metastore, which refers to the relocated `com.codahale.metrics.Counter`. When we include both hive-exec.jar and standalone-metastore-*.jar in the CLASSPATH, the wrong one can be picked up. I think users can always use the standalone artifact.&lt;/p&gt;</comment>
                            <comment id="18022702" author="zhangbutao" created="Thu, 25 Sep 2025 08:43:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=okumin&quot; class=&quot;user-hover&quot; rel=&quot;okumin&quot;&gt;okumin&lt;/a&gt; Thanks for the info. Will check this again later.&lt;/p&gt;

&lt;p&gt;BTW, if we are sure that this issue is caused by the CLASSPATH conflicting which is not easy to be fixed. I think we can also remove the `com.codahale.metrics.Counter`&#160; usage from rest catalog code blocks.&lt;/p&gt;</comment>
                            <comment id="18022975" author="okumin" created="Fri, 26 Sep 2025 04:08:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhangbutao&quot; class=&quot;user-hover&quot; rel=&quot;zhangbutao&quot;&gt;zhangbutao&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;When do you think we want to set up standalone-metastore-server with hive-exec? As far as I know, standalone-metastore-* is independent. It does not depend on hive-common or else. Actually, some classes in hive-common are intentionally copy-and-pasted into standalone-metastore-*.&#160;&lt;/p&gt;</comment>
                            <comment id="18024281" author="zhangbutao" created="Thu, 2 Oct 2025 14:04:35 +0000"  >&lt;p&gt;The original intention of the standalone-metastore-server module was to avoid dependencies on hive-exec as much as possible, meaning it should be decoupled from HS2-related dependencies. Therefore, the standalone HMS should never include hive-exec dependencies under any circumstances. However, note that in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-29052&quot; title=&quot;Error starting standalone HMS: &amp;quot;IcebergHouseKeeperService class not found&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-29052&quot;&gt;&lt;del&gt;HIVE-29052&lt;/del&gt;&lt;/a&gt;, we introduced the hive-exec-core dependency into the standalone HMS to temporarily address some background automated tasks in the standalone HMS.&lt;/p&gt;

&lt;p&gt;Currently, the non-standalone HMS still relies on hive-exec, and as you mentioned, the root cause of this issue is that the hive-exec fat jar contains many shaded classes (including com.codahale.metrics.Counter and the standalone-metastore-server module, but not the REST catalog server), leading to classloading issues in the REST catalog.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure how to resolve this problem. Do we need to continue adding the REST catalog module to hive-exec to fix this? This would make hive-exec increasingly heavier, which doesn&#8217;t seem like an ideal solution either...&lt;/p&gt;

&lt;p&gt;BTW, the easier way to fix this is that removing the `com.codahale.metrics.Counter`&#160; usage from rest catalog code blocks. Or try to remove the shade `org.apache.hive.com.codahale.metrics.Counter` in hive-exec.jar.&lt;/p&gt;</comment>
                            <comment id="18024844" author="okumin" created="Mon, 6 Oct 2025 04:27:00 +0000"  >&lt;p&gt;I started thinking removing `com.codahale.metrics.Counter` might be an easy way at this moment. Few or no people are using it today. If it really had a user, the user could contribute to the metrics stuff.&lt;/p&gt;</comment>
                            <comment id="18032803" author="dkuzmenko" created="Fri, 24 Oct 2025 15:32:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=difin&quot; class=&quot;user-hover&quot; rel=&quot;difin&quot;&gt;difin&lt;/a&gt; did you get the same issue while working on itests for RestCatalog ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.NoSuchMethodError: &lt;span class=&quot;code-quote&quot;&gt;&apos;com.codahale.metrics.Counter org.apache.hadoop.hive.metastore.metrics.Metrics.getOrCreateCounter(java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)&apos;&lt;/span&gt;
        at org.apache.iceberg.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.HMSCatalogAdapter.handleRequest(HMSCatalogAdapter.java:538) ~[hive-standalone-metastore-&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;-catalog-4.1.0.jar:4.1.0] &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="18032812" author="JIRAUSER295017" created="Fri, 24 Oct 2025 16:21:50 +0000"  >&lt;p&gt;Yes, I was dealing with the same issue in `hive-it-iceberg-qfile` module when working on &lt;a href=&quot;https://github.com/apache/hive/pull/5995&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/pull/5995&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The root cause was that hive-exec shades `hive-standalone-metastore-server` and the relocated `com.codahale.metrics`, but it doesn&apos;t shade `hive-standalone-metastore-rest-catalog`.&#160;&lt;/p&gt;

&lt;p&gt;`hive-standalone-metastore-rest-catalog` is compiled against `hive-standalone-metastore-server` with non-relocated&#160;`com.codahale.metrics`.&lt;/p&gt;

&lt;p&gt;The error disappeared after I added explicit dependencies on the following artifacts in `hive-it-iceberg-qfile`:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;dependency&amp;gt;
  &amp;lt;groupId&amp;gt;org.apache.hive&amp;lt;/groupId&amp;gt;
  &amp;lt;artifactId&amp;gt;hive-standalone-metastore-server&amp;lt;/artifactId&amp;gt;
  &amp;lt;version&amp;gt;${project.version}&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;

&amp;lt;dependency&amp;gt;
  &amp;lt;groupId&amp;gt;io.dropwizard.metrics&amp;lt;/groupId&amp;gt;
  &amp;lt;artifactId&amp;gt;metrics-core&amp;lt;/artifactId&amp;gt;
  &amp;lt;version&amp;gt;${dropwizard.version}&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Currently, `hive-standalone-metastore-rest-catalog` pom.xml depends on&#160;&lt;br/&gt;
`hive-standalone-metastore-server` with `provided` scope and has no explicit dependency on `metrics-core`. Maybe the issue will be fixed if we change the scope to `compile` and add dependency on `metrics-core`.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;EDIT: I tested changing the scope to `compile` and adding dependency on `metrics-core`, the issue still appeared in docker-compose when trying to create a table using rest catalog.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="18032904" author="JIRAUSER295017" created="Sat, 25 Oct 2025 00:26:56 +0000"  >&lt;p&gt;I reproduced the same issue now while testing the Hive docker-compose setup with the HMS REST Catalog enabled. The failure occurred during table creation using the REST catalog:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: org.apache.iceberg.exceptions.ServiceFailureException: Server error: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;: {
&lt;span class=&quot;code-quote&quot;&gt;&quot;servlet&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.iceberg.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.HMSCatalogServlet-19f02280&quot;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&quot;cause0&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;java.lang.NoSuchMethodError: &amp;amp;apos;com.codahale.metrics.Counter org.apache.hadoop.hive.metastore.metrics.Metrics.getOrCreateCounter(java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)&amp;amp;apos;&quot;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;java.lang.NoSuchMethodError: &amp;amp;apos;com.codahale.metrics.Counter org.apache.hadoop.hive.metastore.metrics.Metrics.getOrCreateCounter(java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)&amp;amp;apos;&quot;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&quot;url&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;/iceberg/v1/config&quot;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;500&quot;&lt;/span&gt;
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="18033177" author="zabetak" created="Mon, 27 Oct 2025 10:39:36 +0000"  >&lt;p&gt;This ticket is a deployment bug but does not seem like a regression so I wouldn&apos;t consider this as a blocker for 4.2.0. Given that nobody is actively working on it, it seems that it will not make it for the next release cut and that is fine with me. Thoughts?&lt;/p&gt;</comment>
                            <comment id="18033473" author="okumin" created="Tue, 28 Oct 2025 08:56:53 +0000"  >&lt;p&gt;Two thoughts. In my environment with standalone-metastore, the feature is working. Therefore, it is not a blocker, I think. As another thought, since Butao&apos;s proposal is small and reasonable enough, I don&apos;t see a reason not to create a pull request today.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hive/pull/6156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/pull/6156&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="18033778" author="dkuzmenko" created="Wed, 29 Oct 2025 09:18:04 +0000"  >&lt;p&gt;Merge to master&lt;/p&gt;

&lt;p&gt;Thanks for the fix &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=okumin&quot; class=&quot;user-hover&quot; rel=&quot;okumin&quot;&gt;okumin&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhangbutao&quot; class=&quot;user-hover&quot; rel=&quot;zhangbutao&quot;&gt;zhangbutao&lt;/a&gt;&#160; for the review!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1x960:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12356025">4.2.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>