<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:21:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-25561] Killed task should not commit file.</title>
                <link>https://issues.apache.org/jira/browse/HIVE-25561</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;For tez engine in our cluster, I found some duplicate line, especially tez speculation is enabled. In partition dir, I found both 000002_0 and 000002_1 exist.&lt;br/&gt;
It&apos;s a very low probability event. &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-10429&quot; title=&quot;LLAP: Abort hive tez processor on interrupts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-10429&quot;&gt;&lt;del&gt;HIVE-10429&lt;/del&gt;&lt;/a&gt; has fix some bug about interrupt, but some exception was not caught.&lt;/p&gt;

&lt;p&gt;In our cluster, Task receive SIGTERM, then ClientFinalizer(Hadoop Class) was called, hdfs client will close. Then will raise exception, but abort may not set to true.&lt;br/&gt;
Then removeTempOrDuplicateFiles may fail because of inconsistency, duplicate file will retain. &lt;br/&gt;
(Notes: Driver first list dir, then Task commit file, then Driver remove duplicate file. It is a inconsistency case)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13403417">HIVE-25561</key>
            <summary>Killed task should not commit file.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zhengchenyu">Chenyu Zheng</assignee>
                                    <reporter username="zhengchenyu">Chenyu Zheng</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 27 Sep 2021 04:04:08 +0000</created>
                <updated>Thu, 17 Nov 2022 08:48:57 +0000</updated>
                            <resolved>Fri, 26 Nov 2021 07:37:50 +0000</resolved>
                                    <version>1.2.1</version>
                    <version>2.3.8</version>
                    <version>2.4.0</version>
                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                                    <component>Tez</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="6600">1h 50m</timespent>
                                <comments>
                            <comment id="17421306" author="zabetak" created="Tue, 28 Sep 2021 10:30:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhengchenyu&quot; class=&quot;user-hover&quot; rel=&quot;zhengchenyu&quot;&gt;zhengchenyu&lt;/a&gt; Did you mean to write &quot;duplicate file&quot; instead of &quot;duplicate line&quot;? Are the contents of the files identical? &lt;/p&gt;</comment>
                            <comment id="17421994" author="zhengchenyu" created="Wed, 29 Sep 2021 07:59:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zabetak&quot; class=&quot;user-hover&quot; rel=&quot;zabetak&quot;&gt;zabetak&lt;/a&gt;&#160;When bug is reproduced, partition contains duplicate file:&#160; 000002_0 and&#160;000002_1. The two file are created by two different task attempt which belong to same task. (One&#160;is normal task attempt, the other is&#160;speculative task attempt.) So we will query duplicated line.&lt;/p&gt;

&lt;p&gt;One file is the subset of the other file. Because the&#160;speculative task is killed, so this file created by killed task is the subset of the&#160;completed file.&lt;/p&gt;

&lt;p&gt;I found the file created by killed task could be committed under some conditions. Once some exception was not caught, abort may be false.&lt;/p&gt;</comment>
                            <comment id="17423199" author="zabetak" created="Fri, 1 Oct 2021 09:13:11 +0000"  >&lt;p&gt;Hey @zhengchenyu, I need a lot of context to review this PR and don&apos;t have much time right now. If nobody else takes in a reasonable time I may have look. Can you clarify what&apos;s the impact of this problem? What happens if we don&apos;t solve the problem? If there is an exception please include it in the description (inside {noformat} tags).&lt;/p&gt;</comment>
                            <comment id="17425939" author="zhengchenyu" created="Fri, 8 Oct 2021 03:54:31 +0000"  >&lt;p&gt;If&#160;tez speculation is enabled, the&#160;probability of this problem will increase. But also a low&#160;probability event.&lt;/p&gt;


&lt;p&gt; If we do not fix this bug, may produce two duplicate file in logical (doesn&apos;t means same file ), When we read table without uniq, may produce duplicated row.&lt;/p&gt;

&lt;p&gt;In fact,&#160;removeTempOrDuplicateFiles aim to solve this problem. But in some&#160;conditions,&#160;removeTempOrDuplicateFiles will fail.&lt;/p&gt;

&lt;p&gt;For this, I think there is no need to commit file which is created by killed task.&lt;/p&gt;</comment>
                            <comment id="17449424" author="kgyrtkirk" created="Fri, 26 Nov 2021 07:37:50 +0000"  >&lt;p&gt;merged into master. Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhengchenyu&quot; class=&quot;user-hover&quot; rel=&quot;zhengchenyu&quot;&gt;zhengchenyu&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 50 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0vb2g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>