<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:37:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-11831] TXN tables in Oracle should be created with ROWDEPENDENCIES</title>
                <link>https://issues.apache.org/jira/browse/HIVE-11831</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;These frequently-updated tables may otherwise suffer from spurious deadlocks.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12864373">HIVE-11831</key>
            <summary>TXN tables in Oracle should be created with ROWDEPENDENCIES</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sershe">Sergey Shelukhin</assignee>
                                    <reporter username="sershe">Sergey Shelukhin</reporter>
                        <labels>
                            <label>TODOC1.3</label>
                            <label>TODOC2.0</label>
                    </labels>
                <created>Tue, 15 Sep 2015 21:15:00 +0000</created>
                <updated>Tue, 1 Oct 2019 22:07:55 +0000</updated>
                            <resolved>Fri, 25 Sep 2015 01:09:08 +0000</resolved>
                                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>Transactions</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14746299" author="sershe" created="Tue, 15 Sep 2015 21:43:04 +0000"  >&lt;p&gt;The patch. There&apos;s no possibility of upgrade, Oracle only allows this option on create&lt;/p&gt;</comment>
                            <comment id="14746304" author="sershe" created="Tue, 15 Sep 2015 21:44:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gates&quot; class=&quot;user-hover&quot; rel=&quot;gates&quot;&gt;gates&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ekoifman&quot; class=&quot;user-hover&quot; rel=&quot;ekoifman&quot;&gt;ekoifman&lt;/a&gt; can  you take a look&lt;/p&gt;</comment>
                            <comment id="14746307" author="sershe" created="Tue, 15 Sep 2015 21:44:41 +0000"  >&lt;p&gt;Also, it appears that these tables are not created anywhere else in the scripts. Is that correct? I wonder how it works for later Hive versions.&lt;/p&gt;</comment>
                            <comment id="14746627" author="ekoifman" created="Wed, 16 Sep 2015 01:17:40 +0000"  >&lt;p&gt;I see 4 .oracle.sql that have create table DDL (for TXN_COMPONENTS for example)&lt;/p&gt;</comment>
                            <comment id="14746629" author="sershe" created="Wed, 16 Sep 2015 01:21:02 +0000"  >&lt;p&gt;Which ones? Actually now that I look there are 4 but they are for 2 versions. Should I update main schema, txn-schema, or both? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
What is executed e.g. for 1.2? &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ find . -name  &apos;*oracle.sql&apos; | grep -v target |xargs grep -i HIVE_LOCK
./metastore/scripts/upgrade/oracle/019-HIVE-7118.oracle.sql:ALTER TABLE HIVE_LOCKS MODIFY (
./metastore/scripts/upgrade/oracle/hive-schema-0.13.0.oracle.sql:CREATE TABLE HIVE_LOCKS (
./metastore/scripts/upgrade/oracle/hive-schema-0.13.0.oracle.sql:CREATE INDEX HL_TXNID_INDEX ON HIVE_LOCKS (HL_TXNID);
./metastore/scripts/upgrade/oracle/hive-schema-0.14.0.oracle.sql:CREATE TABLE HIVE_LOCKS (
./metastore/scripts/upgrade/oracle/hive-schema-0.14.0.oracle.sql:CREATE INDEX HL_TXNID_INDEX ON HIVE_LOCKS (HL_TXNID);
./metastore/scripts/upgrade/oracle/hive-txn-schema-0.13.0.oracle.sql:CREATE TABLE HIVE_LOCKS (
./metastore/scripts/upgrade/oracle/hive-txn-schema-0.13.0.oracle.sql:CREATE INDEX HL_TXNID_INDEX ON HIVE_LOCKS (HL_TXNID);
./metastore/scripts/upgrade/oracle/hive-txn-schema-0.14.0.oracle.sql:CREATE TABLE HIVE_LOCKS (
./metastore/scripts/upgrade/oracle/hive-txn-schema-0.14.0.oracle.sql:CREATE INDEX HL_TXNID_INDEX ON HIVE_LOCKS (HL_TXNID);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14746633" author="sershe" created="Wed, 16 Sep 2015 01:25:39 +0000"  >&lt;p&gt;Updated to change all 4 files. &lt;/p&gt;</comment>
                            <comment id="14746639" author="sershe" created="Wed, 16 Sep 2015 01:27:56 +0000"  >&lt;p&gt;Interesting...&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ f *.sql | grep -v target | grep schema |xargs grep -i HIVE_LOCK | sed -E &quot;s/^([^:]+).*$/\1/&quot; | uniq
./metastore/scripts/upgrade/derby/hive-schema-0.13.0.derby.sql
./metastore/scripts/upgrade/derby/hive-schema-0.14.0.derby.sql
./metastore/scripts/upgrade/derby/hive-txn-schema-0.13.0.derby.sql
./metastore/scripts/upgrade/derby/hive-txn-schema-0.14.0.derby.sql
./metastore/scripts/upgrade/mssql/hive-schema-0.13.0.mssql.sql
./metastore/scripts/upgrade/mssql/hive-schema-0.14.0.mssql.sql
./metastore/scripts/upgrade/mssql/hive-schema-1.1.0.mssql.sql
./metastore/scripts/upgrade/mssql/hive-schema-1.2.0.mssql.sql
./metastore/scripts/upgrade/mssql/hive-schema-1.3.0.mssql.sql
./metastore/scripts/upgrade/mssql/hive-schema-2.0.0.mssql.sql
./metastore/scripts/upgrade/mssql/hive-txn-schema-0.13.0.mssql.sql
./metastore/scripts/upgrade/mssql/hive-txn-schema-0.14.0.mssql.sql
./metastore/scripts/upgrade/mysql/hive-schema-0.13.0.mysql.sql
./metastore/scripts/upgrade/mysql/hive-schema-0.14.0.mysql.sql
./metastore/scripts/upgrade/mysql/hive-txn-schema-0.13.0.mysql.sql
./metastore/scripts/upgrade/mysql/hive-txn-schema-0.14.0.mysql.sql
./metastore/scripts/upgrade/oracle/hive-schema-0.13.0.oracle.sql
./metastore/scripts/upgrade/oracle/hive-schema-0.14.0.oracle.sql
./metastore/scripts/upgrade/oracle/hive-txn-schema-0.13.0.oracle.sql
./metastore/scripts/upgrade/oracle/hive-txn-schema-0.14.0.oracle.sql
./metastore/scripts/upgrade/postgres/hive-schema-0.13.0.postgres.sql
./metastore/scripts/upgrade/postgres/hive-schema-0.14.0.postgres.sql
./metastore/scripts/upgrade/postgres/hive-txn-schema-0.13.0.postgres.sql
./metastore/scripts/upgrade/postgres/hive-txn-schema-0.14.0.postgres.sql
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Should there be a separate JIRA for this? the tables are missing from all the schemas other than mssql.&lt;/p&gt;</comment>
                            <comment id="14769034" author="hiveqa" created="Wed, 16 Sep 2015 14:39:03 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12756135/HIVE-11831.01.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12756135/HIVE-11831.01.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 4 failed/errored test(s), 9445 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
org.apache.hive.hcatalog.streaming.TestStreaming.testEndpointConnection
org.apache.hive.hcatalog.streaming.TestStreaming.testTimeOutReaper
org.apache.hive.hcatalog.streaming.TestStreaming.testTransactionBatchCommit_Json
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5295/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5295/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5295/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5295/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5295/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5295/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12756135 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14876317" author="sershe" created="Fri, 18 Sep 2015 20:23:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gates&quot; class=&quot;user-hover&quot; rel=&quot;gates&quot;&gt;gates&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ekoifman&quot; class=&quot;user-hover&quot; rel=&quot;ekoifman&quot;&gt;ekoifman&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vgumashta&quot; class=&quot;user-hover&quot; rel=&quot;vgumashta&quot;&gt;vgumashta&lt;/a&gt; can you take a look at the patch itself?&lt;/p&gt;</comment>
                            <comment id="14900960" author="alangates" created="Mon, 21 Sep 2015 16:46:43 +0000"  >&lt;p&gt;+1, patch itself looks good.&lt;/p&gt;

&lt;p&gt;When you say no possibility of upgrade, do we need to build a recommended procedure for people to migrate their data so they can fix the deadlocks if they are already using this feature in Oracle?  Something like:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;pause the world&lt;/li&gt;
	&lt;li&gt;create temp table&lt;/li&gt;
	&lt;li&gt;move contents of existing table to temp table&lt;/li&gt;
	&lt;li&gt;drop existing table&lt;/li&gt;
	&lt;li&gt;create new table with ROWDEPENDENCIES&lt;/li&gt;
	&lt;li&gt;move data back from temp table&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="14901772" author="sershe" created="Tue, 22 Sep 2015 01:59:14 +0000"  >&lt;p&gt;Is there a place where to put this? I can add to JIRA release notes&lt;/p&gt;</comment>
                            <comment id="14906750" author="alangates" created="Thu, 24 Sep 2015 18:07:02 +0000"  >&lt;p&gt;Release notes makes sense.  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=leftylev&quot; class=&quot;user-hover&quot; rel=&quot;leftylev&quot;&gt;leftylev&lt;/a&gt;, anywhere else we should put the upgrade notes?&lt;/p&gt;</comment>
                            <comment id="14907327" author="sershe" created="Fri, 25 Sep 2015 01:09:08 +0000"  >&lt;p&gt;Committed to master.&lt;/p&gt;</comment>
                            <comment id="14907487" author="lefty@hortonworks.com" created="Fri, 25 Sep 2015 03:15:52 +0000"  >&lt;p&gt;I suggest a small section in the Transactions wikidoc, with a new Limitations bullet pointing to the section.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Hive+Transactions&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Hive Transactions &lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Hive+Transactions#HiveTransactions-Limitations&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Hive Transactions &amp;#8211; Limitations &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15009983" author="ekoifman" created="Wed, 18 Nov 2015 01:08:59 +0000"  >&lt;p&gt;committed to branch-1 &lt;a href=&quot;https://github.com/apache/hive/commit/236cc2ac9d4b27c6536b1d132b2e7706cb2109f3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/commit/236cc2ac9d4b27c6536b1d132b2e7706cb2109f3&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15020823" author="lefty@hortonworks.com" created="Sun, 22 Nov 2015 03:55:48 +0000"  >&lt;p&gt;I added a TODOC1.3 label but kept the TODOC2.0 label, since 2.0.0 will be released before 1.3.0.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12756135" name="HIVE-11831.01.patch" size="5679" author="sershe" created="Wed, 16 Sep 2015 01:25:39 +0000"/>
                            <attachment id="12756092" name="HIVE-11831.patch" size="2848" author="sershe" created="Tue, 15 Sep 2015 21:43:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2k7xz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>ROWDEPENDENCIES cannot be added to the table after it has already been created. If you hit this issue on an existing database, you might want to (this requires stopping all Hive workloads for the duration), for each table (see the patch for what tables need to be updated; locks and txns table are the ones most affected):&lt;br/&gt;
&lt;br/&gt;
1) create temp table&lt;br/&gt;
2) move contents of existing table to temp table&lt;br/&gt;
3) drop existing table&lt;br/&gt;
4) create new table with ROWDEPENDENCIES, as per the attached patch&lt;br/&gt;
5) move data back from temp table&lt;br/&gt;
</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>