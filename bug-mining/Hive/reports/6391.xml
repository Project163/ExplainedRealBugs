<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:03:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-19231] Beeline generates garbled output when using UnsupportedTerminal</title>
                <link>https://issues.apache.org/jira/browse/HIVE-19231</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;We had a customer that was using some sort of front end that would invoke beeline commands with some query files on a node that that remote to the HS2 node.&lt;/p&gt;

&lt;p&gt;So beeline runs locally on this edge but connects to a remote HS2. Since the fix made in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-14342&quot; title=&quot;Beeline output is garbled when executed from a remote shell&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-14342&quot;&gt;&lt;del&gt;HIVE-14342&lt;/del&gt;&lt;/a&gt;, the beeline started producing garbled line in the output. Something like&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
^Mnull                                                   ^Mnull^Mnull                                                   ^Mnull00-0000	All Occupations	135185230	42270
11-0000	Management occupations	6152650	100310&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I havent been able to reproduce the issue locally as I do not have their system, but with some additional instrumentation I have been able to get some info regarding the beeline process.&lt;/p&gt;

&lt;p&gt;Essentially, such invocation causes beeline process to run with &lt;tt&gt;-Djline.terminal=jline.UnsupportedTerminal&lt;/tt&gt; all the time and thus causes the issue. They can run the same beeline command directly in the shell on the same host and it does not cause this issue.&lt;/p&gt;

&lt;p&gt;PID&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160; TTY&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; TIME COMMAND&lt;br/&gt;
44107&#160; S&#160;&#160;&#160; S&#160; ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; 00:00:00 bash beeline -u ...&lt;/p&gt;

&lt;p&gt;PID&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; S&#160;&#160;&#160;&#160; TTY&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; TIME COMMAND&lt;br/&gt;
48453&#160; S+&#160;&#160; S&#160;&#160;&#160;&#160; pts/4&#160;&#160;&#160; 00:00:00 bash beeline -u ...&lt;/p&gt;

&lt;p&gt;Somehow that process wasnt attached to any local terminals. So the check made for /dev/stdin wouldnt work.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Instead an additional check to check the TTY session of the process before using the UnsupportedTerminal (which really should only be used for backgrounded beeline sessions) seems to resolve the issue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13153153">HIVE-19231</key>
            <summary>Beeline generates garbled output when using UnsupportedTerminal</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ngangam">Naveen Gangam</assignee>
                                    <reporter username="ngangam">Naveen Gangam</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Apr 2018 21:44:11 +0000</created>
                <updated>Wed, 3 Mar 2021 18:24:24 +0000</updated>
                            <resolved>Wed, 2 May 2018 18:39:06 +0000</resolved>
                                    <version>2.1.0</version>
                                    <fixVersion>3.1.0</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                    <component>Beeline</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16454689" author="ngangam" created="Thu, 26 Apr 2018 18:49:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aihuaxu&quot; class=&quot;user-hover&quot; rel=&quot;aihuaxu&quot;&gt;aihuaxu&lt;/a&gt; Could you please review this when you have a chance? Thanks&lt;/p&gt;</comment>
                            <comment id="16455449" author="aihuaxu" created="Thu, 26 Apr 2018 21:58:53 +0000"  >&lt;p&gt;? for TTY means the process is not attached to any TTY (terminal interface). Probably similar to something like daemon. Seems we should add such check for background process. I also notice some platform on mac may show as &quot;??&quot;. The script works for both case, right?&lt;/p&gt;

&lt;p&gt;Probably you can try out cron job calling beeline to simulate this. &lt;/p&gt;

</comment>
                            <comment id="16459875" author="ngangam" created="Tue, 1 May 2018 17:17:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aihuaxu&quot; class=&quot;user-hover&quot; rel=&quot;aihuaxu&quot;&gt;aihuaxu&lt;/a&gt; Running a beeline command using a cron job seems to be resulting in similar output that we were seeing that caused this issue.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160; PID&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; S TTY&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; TIME COMMAND
22756 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; S ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; 00:00:00 bash /usr/lib/hive/bin/beeline -u jdbc:hive2:&lt;span class=&quot;code-comment&quot;&gt;//localhost:10000 -n hive -p hive -e select * from sample_08 where salary &amp;gt; 50000
&lt;/span&gt;Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=512M; support was removed in 8.0
Java HotSpot(TM) 64-Bit Server VM warning: Using incremental CMS is deprecated and will likely be removed in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release
Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=512M; support was removed in 8.0
scan complete in 2ms
Connecting to jdbc:hive2:&lt;span class=&quot;code-comment&quot;&gt;//localhost:10000
&lt;/span&gt;Connected to: Apache Hive (version 1.1.0-cdh5.14.3-SNAPSHOT)
Driver: Hive JDBC (version 1.1.0-cdh5.14.3-SNAPSHOT)
Transaction isolation: TRANSACTION_REPEATABLE_READ
INFO&#160; : Compiling command(queryId=hive_20180501100505_a212817e-e909-4e95-a449-581229c9dbc0): select * from sample_08 where salary &amp;gt; 50000
INFO&#160; : Semantic Analysis Completed
INFO&#160; : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:sample_08.code, type:string, comment:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;), FieldSchema(name:sample_08.description, type:string, comment:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;), FieldSchema(name:samp
le_08.total_emp, type:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, comment:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;), FieldSchema(name:sample_08.salary, type:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, comment:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)], properties:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
INFO&#160; : Completed compiling command(queryId=hive_20180501100505_a212817e-e909-4e95-a449-581229c9dbc0); Time taken: 0.123 seconds
INFO&#160; : Executing command(queryId=hive_20180501100505_a212817e-e909-4e95-a449-581229c9dbc0): select * from sample_08 where salary &amp;gt; 50000
INFO&#160; : Query ID = hive_20180501100505_a212817e-e909-4e95-a449-581229c9dbc0
INFO&#160; : Total jobs = 1
INFO&#160; : Launching Job 1 out of 1
INFO&#160; : Starting task [Stage-1:MAPRED] in serial mode
INFO&#160; : &lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; of reduce tasks is set to 0 since there&apos;s no reduce &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;
INFO&#160; : number of splits:1
INFO&#160; : Submitting tokens &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job: job_1525165852892_0012
INFO&#160; : The url to track the job: http:&lt;span class=&quot;code-comment&quot;&gt;//&amp;lt;SNIPPED&amp;gt;:8088/proxy/application_1525165852892_0012/
&lt;/span&gt;INFO&#160; : Starting Job = job_1525165852892_0012, Tracking URL = http:&lt;span class=&quot;code-comment&quot;&gt;//&amp;lt;SNIPPED&amp;gt;:8088/proxy/application_1525165852892_0012/
&lt;/span&gt;INFO&#160; : Kill Command = /usr/lib/hadoop/bin/hadoop job&#160; -kill job_1525165852892_0012
INFO&#160; : Hadoop job information &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Stage-1: number of mappers: 1; number of reducers: 0
INFO&#160; : 2018-05-01 10:05:10,966 Stage-1 map = 0%,&#160; reduce = 0%
INFO&#160; : 2018-05-01 10:05:18,294 Stage-1 map = 100%,&#160; reduce = 0%, Cumulative CPU 3.89 sec
INFO&#160; : MapReduce Total cumulative CPU time: 3 seconds 890 msec
INFO&#160; : Ended Job = job_1525165852892_0012
INFO&#160; : MapReduce Jobs Launched:
INFO&#160; : Stage-Stage-1: Map: 1&#160;&#160; Cumulative CPU: 3.89 sec&#160;&#160; HDFS Read: 50608 HDFS Write: 16567 SUCCESS
INFO&#160; : Total MapReduce CPU Time Spent: 3 seconds 890 msec
INFO&#160; : Completed executing command(queryId=hive_20180501100505_a212817e-e909-4e95-a449-581229c9dbc0); Time taken: 13.981 seconds
INFO&#160; : OK
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, running as a cron job with or without the fix does not seem to reproduce the issue whether running the script runs beeline in background or foreground (I suspect the way cron is run, it can never be run as a foreground process). So it appears we are good for this usecase as well.&lt;/p&gt;

&lt;p&gt;Do you have additional concerns? Thanks&lt;/p&gt;</comment>
                            <comment id="16459891" author="aihuaxu" created="Tue, 1 May 2018 17:27:37 +0000"  >&lt;p&gt;Sounds good. +1.&lt;/p&gt;</comment>
                            <comment id="16461480" author="ngangam" created="Wed, 2 May 2018 18:39:06 +0000"  >&lt;p&gt;Fix has been pushed to master and branch-3. Thank you for the review &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aihuaxu&quot; class=&quot;user-hover&quot; rel=&quot;aihuaxu&quot;&gt;aihuaxu&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16484796" author="ashutoshc" created="Tue, 22 May 2018 23:12:50 +0000"  >&lt;p&gt;This jira is resolved and released with Hive 3.0 If you find an issue with it, please create a new jira.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12919658" name="HIVE-19231.patch" size="525" author="ngangam" created="Wed, 18 Apr 2018 17:36:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3so8f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12340268">3.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>