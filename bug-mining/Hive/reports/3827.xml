<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:36:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-11583] When PTF is used over a large partitions result could be corrupted</title>
                <link>https://issues.apache.org/jira/browse/HIVE-11583</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Dataset: &lt;br/&gt;
 Window has 50001 record (2 blocks on disk and 1 block in memory)&lt;br/&gt;
 Size of the second block is &amp;gt;32Mb (2 splits)&lt;/p&gt;

&lt;p&gt;Result:&lt;br/&gt;
When the last block is read from the disk only first split is actually loaded. The second split gets missed. The total count of the result dataset is correct, but some records are missing and another are duplicated.&lt;/p&gt;

&lt;p&gt;Example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; ptf_big_src (
  id &lt;span class=&quot;code-keyword&quot;&gt;INT&lt;/span&gt;,
  &lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;STRING&lt;/span&gt;,
  grp &lt;span class=&quot;code-keyword&quot;&gt;STRING&lt;/span&gt;,
  &lt;span class=&quot;code-keyword&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;STRING&lt;/span&gt;
) &lt;span class=&quot;code-keyword&quot;&gt;ROW&lt;/span&gt; FORMAT DELIMITED &lt;span class=&quot;code-keyword&quot;&gt;FIELDS&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TERMINATED&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;\t&apos;&lt;/span&gt;;

&lt;span class=&quot;code-keyword&quot;&gt;LOAD&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;DATA&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;LOCAL&lt;/span&gt; INPATH &lt;span class=&quot;code-quote&quot;&gt;&apos;../../&lt;span class=&quot;code-keyword&quot;&gt;data&lt;/span&gt;/files/ptf_3blocks.txt.gz&apos;&lt;/span&gt; OVERWRITE &lt;span class=&quot;code-keyword&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; ptf_big_src;

&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; grp, &lt;span class=&quot;code-keyword&quot;&gt;COUNT&lt;/span&gt;(1) cnt &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; ptf_big_trg &lt;span class=&quot;code-keyword&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt; grp &lt;span class=&quot;code-keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt; cnt &lt;span class=&quot;code-keyword&quot;&gt;desc&lt;/span&gt;;
&lt;span class=&quot;code-comment&quot;&gt;---
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;-- &lt;span class=&quot;code-keyword&quot;&gt;A&lt;/span&gt;	25000
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;-- B	20000
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;-- &lt;span class=&quot;code-keyword&quot;&gt;C&lt;/span&gt;	5001
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;---
&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; ptf_big_trg &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; *, &lt;span class=&quot;code-keyword&quot;&gt;row_number&lt;/span&gt;() &lt;span class=&quot;code-keyword&quot;&gt;OVER&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;PARTITION&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt; grp) grp_num &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; ptf_big_src;

&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; grp, &lt;span class=&quot;code-keyword&quot;&gt;COUNT&lt;/span&gt;(1) cnt &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; ptf_big_trg &lt;span class=&quot;code-keyword&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt; grp &lt;span class=&quot;code-keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt; cnt &lt;span class=&quot;code-keyword&quot;&gt;desc&lt;/span&gt;;
&lt;span class=&quot;code-comment&quot;&gt;-- 
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;-- &lt;span class=&quot;code-keyword&quot;&gt;A&lt;/span&gt;	34296
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;-- B	15704
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;-- &lt;span class=&quot;code-keyword&quot;&gt;C&lt;/span&gt;	1
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;---&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Counts by &apos;grp&apos; are incorrect!&lt;/p&gt;</description>
                <environment>&lt;p&gt;Hadoop 2.6 + Apache hive built from trunk&lt;/p&gt;</environment>
        <key id="12856704">HIVE-11583</key>
            <summary>When PTF is used over a large partitions result could be corrupted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yalovyyi">Illya Yalovyy</assignee>
                                    <reporter username="yalovyyi">Illya Yalovyy</reporter>
                        <labels>
                    </labels>
                <created>Mon, 17 Aug 2015 19:03:36 +0000</created>
                <updated>Tue, 24 May 2016 19:16:44 +0000</updated>
                            <resolved>Thu, 17 Sep 2015 01:16:20 +0000</resolved>
                                    <version>0.13.1</version>
                    <version>0.14.0</version>
                    <version>0.14.1</version>
                    <version>1.0.0</version>
                    <version>1.2.0</version>
                    <version>1.2.1</version>
                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>PTF-Windowing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14743864" author="yalovyyi" created="Mon, 14 Sep 2015 17:22:43 +0000"  >&lt;p&gt;I have implemented a qtest for this issue, but it requires a rather big data file. What is the best way to submit this file? It is a gzip file, size = 204Kb. I can attach this file to the ticket.&lt;/p&gt;</comment>
                            <comment id="14743882" author="ashutoshc" created="Mon, 14 Sep 2015 17:35:47 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14744582" author="hiveqa" created="Tue, 15 Sep 2015 00:40:54 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12755773/HIVE-11583.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12755773/HIVE-11583.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 2 failed/errored test(s), 9412 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestParseNegative - did not produce a TEST-*.xml file
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5276/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5276/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5276/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5276/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5276/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5276/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12755773 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14791397" author="ashutoshc" created="Thu, 17 Sep 2015 01:16:20 +0000"  >&lt;p&gt;Pushed to master. Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yalovyyi&quot; class=&quot;user-hover&quot; rel=&quot;yalovyyi&quot;&gt;yalovyyi&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14908338" author="yalovyyi" created="Fri, 25 Sep 2015 17:09:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt;, I have a qTest for this issue, but includes rather big gz - compressed file. What is the best way to contribute it? The question is how to create a patch for this big binary file?&lt;/p&gt;</comment>
                            <comment id="14908368" author="ashutoshc" created="Fri, 25 Sep 2015 17:30:12 +0000"  >&lt;p&gt;Spilling is controlled by config &lt;tt&gt;hive.join.cache.size&lt;/tt&gt; Perhaps, you can set that to very low value in q test so as to trigger spilling and thus testing this without needing a large input data.&lt;/p&gt;</comment>
                            <comment id="14908437" author="yalovyyi" created="Fri, 25 Sep 2015 18:10:19 +0000"  >&lt;p&gt;Oh... I was thinking about all possible ways to reduce the size of file. cahce size is only one piece of the puzzle. The important thing is physical file system blocks and it seems like I cannot control it from withing Hive script.&lt;/p&gt;</comment>
                            <comment id="14908457" author="ashutoshc" created="Fri, 25 Sep 2015 18:26:54 +0000"  >&lt;p&gt;Hive q tests use hive-shims-common/src/main/java/org/apache/hadoop/fs/ProxyLocalFileSystem.java I think you can configure its block size via &lt;tt&gt;fs.local.block.size&lt;/tt&gt; &lt;/p&gt;</comment>
                            <comment id="14908480" author="yalovyyi" created="Fri, 25 Sep 2015 18:41:25 +0000"  >&lt;p&gt;I tried, and when I did it from hive script it didn&apos;t take any effect. Is the any way to reconfigure it BEFORE the test? &lt;/p&gt;</comment>
                            <comment id="15001513" author="sershe" created="Thu, 12 Nov 2015 02:12:11 +0000"  >&lt;p&gt;Should this issue be backported to branch-1? It looks like a bug.&lt;/p&gt;</comment>
                            <comment id="15001569" author="yalovyyi" created="Thu, 12 Nov 2015 02:20:55 +0000"  >&lt;p&gt;Yes. It is a quite critical bug. &lt;/p&gt;</comment>
                            <comment id="15002729" author="sershe" created="Thu, 12 Nov 2015 19:34:24 +0000"  >&lt;p&gt;Committed to branch-1&lt;/p&gt;</comment>
                            <comment id="15002949" author="yalovyyi" created="Thu, 12 Nov 2015 21:18:08 +0000"  >&lt;p&gt;What about a qtest for this issue? What is the best course of action?&lt;/p&gt;</comment>
                            <comment id="15002955" author="sershe" created="Thu, 12 Nov 2015 21:21:38 +0000"  >&lt;p&gt;This was committed a while ago... the test can be created in a separate JIRA if needed. I don&apos;t have background on this issue, I bulk commented yesterday on a large list of  issues whose title looks like a bug and that were committed to master but not to branch-1, obtained via a script&lt;/p&gt;</comment>
                            <comment id="15002963" author="yalovyyi" created="Thu, 12 Nov 2015 21:28:51 +0000"  >&lt;p&gt;In  a nutshell the question is what is the best way to upload/provide a rather big binary file to the test? Should I just attach it to a ticket?&lt;/p&gt;</comment>
                            <comment id="15002983" author="sershe" created="Thu, 12 Nov 2015 21:37:57 +0000"  >&lt;p&gt;You could generate it in the test by repeatedly cross joining. Or does the file have to be in a specific form that is not reproducible by the queries? &lt;/p&gt;</comment>
                            <comment id="15003099" author="yalovyyi" created="Thu, 12 Nov 2015 22:40:40 +0000"  >&lt;p&gt;I think it should be possible to generate that data set (size of files matter), but I didn&apos;t want to make qtest even slower... I&apos;ll think about this approach. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12939787">HIVE-13072</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12755773" name="HIVE-11583.patch" size="7780" author="yalovyyi" created="Mon, 14 Sep 2015 17:18:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2j0qn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>