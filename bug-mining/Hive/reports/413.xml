<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:56:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-1271] Case sensitiveness of type information specified when using custom reducer causes type mismatch</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1271</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Type information specified while using a custom reduce script is converted to lower case, and causes type mismatch during query semantic analysis . The following REDUCE query where field name = &quot;userId&quot; failed.&lt;/p&gt;

&lt;p&gt;hive&amp;gt; CREATE TABLE SS (&lt;br/&gt;
&amp;gt; a INT,&lt;br/&gt;
&amp;gt; b INT,&lt;br/&gt;
&amp;gt; vals ARRAY&amp;lt;STRUCT&amp;lt;userId:INT, y:STRING&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt; );&lt;br/&gt;
OK&lt;/p&gt;

&lt;p&gt;hive&amp;gt; FROM (select * from srcTable DISTRIBUTE BY id SORT BY id) s&lt;br/&gt;
&amp;gt; INSERT OVERWRITE TABLE SS&lt;br/&gt;
&amp;gt; REDUCE *&lt;br/&gt;
&amp;gt; USING &apos;myreduce.py&apos;&lt;br/&gt;
&amp;gt; AS&lt;br/&gt;
&amp;gt; (a INT,&lt;br/&gt;
&amp;gt; b INT,&lt;br/&gt;
&amp;gt; vals ARRAY&amp;lt;STRUCT&amp;lt;userId:INT, y:STRING&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt; )&lt;br/&gt;
&amp;gt; ;&lt;br/&gt;
FAILED: Error in semantic analysis: line 2:27 Cannot insert into&lt;br/&gt;
target table because column number/types are different SS: Cannot&lt;br/&gt;
convert column 2 from array&amp;lt;struct&amp;lt;userId:int,y:string&amp;gt;&amp;gt; to&lt;br/&gt;
array&amp;lt;struct&amp;lt;userid:int,y:string&amp;gt;&amp;gt;.&lt;/p&gt;

&lt;p&gt;The same query worked fine after changing &quot;userId&quot; to &quot;userid&quot;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12460017">HIVE-1271</key>
            <summary>Case sensitiveness of type information specified when using custom reducer causes type mismatch</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aprabhakar">Arvind Prabhakar</assignee>
                                    <reporter username="dilipjoseph">Dilip Joseph</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Mar 2010 16:27:04 +0000</created>
                <updated>Wed, 14 Sep 2022 07:36:11 +0000</updated>
                            <resolved>Fri, 25 Jun 2010 23:30:40 +0000</resolved>
                                    <version>0.5.0</version>
                                    <fixVersion>0.6.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="12850463" author="aprabhakar" created="Sat, 27 Mar 2010 02:39:30 +0000"  >&lt;p&gt;&lt;b&gt;Summary&lt;/b&gt;&lt;br/&gt;
The implementation of &lt;tt&gt;equals()&lt;/tt&gt; method of &lt;tt&gt;StructTypeInfo&lt;/tt&gt; was comparing field names as part of the comparison. This is not valid since field namess do not contitute the definition of a type. This patch refactors the &lt;tt&gt;TypedInfo&lt;/tt&gt; hierarchy to address this issue.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Implementation Details&lt;/b&gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Modified the &lt;tt&gt;TypedInfo&lt;/tt&gt; and removed its implementation of the &lt;tt&gt;equals()&lt;/tt&gt; method.&lt;/li&gt;
	&lt;li&gt;Modified all specialized subclasses to make them &lt;tt&gt;final&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;Modified all subclass implementation of &lt;tt&gt;equals()&lt;/tt&gt; to skip category comparison.&lt;/li&gt;
	&lt;li&gt;Modified &lt;tt&gt;StructTypeInfo&lt;/tt&gt; implementation of &lt;tt&gt;equals()&lt;/tt&gt; to not compare field names.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;b&gt;Testing Done&lt;/b&gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Built and tested the usecase identified in this issue. It works now.&lt;/li&gt;
	&lt;li&gt;Ran full set of tests. Out of these two tests - clientpositive for input20.q and input33.q failed for unrelated reasons (these tests are failing on the trunk as well). All other tests passed.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12850785" author="aprabhakar" created="Mon, 29 Mar 2010 03:56:22 +0000"  >&lt;p&gt;Changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1271&quot; title=&quot;Case sensitiveness of type information specified when using custom reducer causes type mismatch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1271&quot;&gt;&lt;del&gt;HIVE-1271&lt;/del&gt;&lt;/a&gt; (patch updated)&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Summary:&lt;/b&gt;&lt;br/&gt;
The previously submitted patch removed the dependence of &lt;tt&gt;StructTypeInfo&lt;/tt&gt; on field names for equivalence comparison. This patch reverts that change and addresses the type equivalence by canonical testing of field names.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Details:&lt;/b&gt;&lt;br/&gt;
The changes to &lt;tt&gt;TypeInfo&lt;/tt&gt; hierarchy made by previous patch assumed that the field names should not be considered part of the &lt;tt&gt;StructTypeInfo&lt;/tt&gt; for testing equivalence. This conflicts with the implementation of &lt;tt&gt;LazyBinarySerDe&lt;/tt&gt; (and others perhaps) which rely on field name distinction for caching purposes. This update changes the implementation so that field names are used as before, but are compared using case-insensitive comparison when testing the equivalence of two {{StructTypeInfo}}s.    &lt;/p&gt;

&lt;p&gt;&lt;b&gt;Testing Done:&lt;/b&gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Built and tested the usecase identified in this issue - it works now.&lt;/li&gt;
	&lt;li&gt;Ran complete set of tests with the previously reported unrelated failures only.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12879962" author="hbasereviewboard" created="Thu, 17 Jun 2010 22:03:13 +0000"  >&lt;p&gt;Message from: &quot;Carl Steinbach&quot; &amp;lt;carl@cloudera.com&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/200/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://review.hbase.org/r/200/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for Hive Developers.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Review for &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12440030/HIVE-1271-1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12440030/HIVE-1271-1.patch&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1271&quot; title=&quot;Case sensitiveness of type information specified when using custom reducer causes type mismatch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1271&quot;&gt;&lt;del&gt;HIVE-1271&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HIVE-1271&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HIVE-1271&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  serde/src/java/org/apache/hadoop/hive/serde2/typeinfo/ListTypeInfo.java cb2fa57 &lt;br/&gt;
  serde/src/java/org/apache/hadoop/hive/serde2/typeinfo/MapTypeInfo.java a426e74 &lt;br/&gt;
  serde/src/java/org/apache/hadoop/hive/serde2/typeinfo/PrimitiveTypeInfo.java 3d1c68e &lt;br/&gt;
  serde/src/java/org/apache/hadoop/hive/serde2/typeinfo/StructTypeInfo.java 87179aa &lt;br/&gt;
  serde/src/java/org/apache/hadoop/hive/serde2/typeinfo/TypeInfo.java 0344718 &lt;br/&gt;
  serde/src/java/org/apache/hadoop/hive/serde2/typeinfo/package-info.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/200/diff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://review.hbase.org/r/200/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Carl&lt;/p&gt;

</comment>
                            <comment id="12881024" author="aprabhakar" created="Tue, 22 Jun 2010 02:23:27 +0000"  >&lt;p&gt;Is anyone reviewing this change? Thanks.&lt;/p&gt;</comment>
                            <comment id="12881306" author="athusoo" created="Tue, 22 Jun 2010 19:10:24 +0000"  >&lt;p&gt;I am looking at this.&lt;/p&gt;</comment>
                            <comment id="12881319" author="athusoo" created="Tue, 22 Jun 2010 19:33:40 +0000"  >&lt;p&gt;Looks good to me. However, why remove the check on Category? Also why drop the default implementation of the equals method for TypeInfo? &lt;/p&gt;</comment>
                            <comment id="12881368" author="aprabhakar" created="Tue, 22 Jun 2010 21:28:25 +0000"  >&lt;p&gt;@Ashish: Thanks for looking at the patch. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;why remove the check on Category?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I modified all the specialized type infos to be &lt;tt&gt;final&lt;/tt&gt; - which in turn ensures that if the test on &lt;tt&gt;instanceof&lt;/tt&gt; succeeds, then they have to be the same category type. Therefore, the check on category was redundant going forward.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also why drop the default implementation of the equals method for TypeInfo?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I did this for two main reasons - first that fact that it was implementing the &lt;tt&gt;equals()&lt;/tt&gt; but not &lt;tt&gt;hashCode()&lt;/tt&gt; method. This could lead to unexpected behavior when &lt;tt&gt;TypeInfo&lt;/tt&gt; instances were put in collections. Second, the implementation was modified to make both &lt;tt&gt;equals()&lt;/tt&gt; and &lt;tt&gt;hashCode()&lt;/tt&gt; methods to be made abstract in order to force any (new) child classes to make sure that they implement both consistently.&lt;/p&gt;

&lt;p&gt;Let me know if you would like to tweak this change as necessary.&lt;/p&gt;</comment>
                            <comment id="12881767" author="athusoo" created="Wed, 23 Jun 2010 17:21:07 +0000"  >&lt;p&gt;sounds good to me. Thanks for the explanations.&lt;/p&gt;

&lt;p&gt;+1. Will commit after running the tests.&lt;/p&gt;

&lt;p&gt;Ashish&lt;/p&gt;</comment>
                            <comment id="12881998" author="athusoo" created="Thu, 24 Jun 2010 01:37:07 +0000"  >&lt;p&gt;I have committed this to trunk and will commit to 0.6.0 soon. One thing I did overlook though. We should add a test case for this. Can you do that as part of another JIRA as this one is already partially committed.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Ashish&lt;/p&gt;</comment>
                            <comment id="12882048" author="aprabhakar" created="Thu, 24 Jun 2010 05:21:02 +0000"  >&lt;p&gt;@Ashish: I created &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1432&quot; title=&quot;Create a test case for case sensitive comparison done during field comparison&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1432&quot;&gt;HIVE-1432&lt;/a&gt; to track the test case creation. I will be submitting a patch for that soon. Thanks for pointing this out.&lt;/p&gt;</comment>
                            <comment id="12882758" author="athusoo" created="Fri, 25 Jun 2010 23:30:40 +0000"  >&lt;p&gt;Committed. Thanks Arvind!&lt;/p&gt;</comment>
                            <comment id="12883051" author="zshao" created="Mon, 28 Jun 2010 07:35:51 +0000"  >&lt;p&gt;I might be too late for the party, but I have a question on removing the field name comparison for struct type info.&lt;/p&gt;

&lt;p&gt;We have 3 choices:&lt;br/&gt;
C1: Compare field names case sensitively.&lt;br/&gt;
C2: Compare field names case insensitively.&lt;br/&gt;
C3: Don&apos;t compare field names at all.&lt;/p&gt;

&lt;p&gt;The old implementation was following C1, and the new one is following C3.&lt;br/&gt;
Is there any reason that we don&apos;t do C2? C2 seems to provide some minimal sanity checks that users will need in practice.&lt;/p&gt;

</comment>
                            <comment id="12883214" author="aprabhakar" created="Mon, 28 Jun 2010 16:56:36 +0000"  >&lt;p&gt;@Zheng: Please see the second comment. This patch uses C2 method - comparing field names in a case insensitive manner.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12440030" name="HIVE-1271-1.patch" size="8370" author="aprabhakar" created="Mon, 29 Mar 2010 03:54:29 +0000"/>
                            <attachment id="12439946" name="HIVE-1271.patch" size="6653" author="aprabhakar" created="Sat, 27 Mar 2010 02:37:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73004</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 22 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0le8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>122957</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>