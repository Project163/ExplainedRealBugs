<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:46:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-14380] Queries on tables with remote HDFS paths fail in &quot;encryption&quot; checks.</title>
                <link>https://issues.apache.org/jira/browse/HIVE-14380</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;If a table has table/partition locations set to remote HDFS paths, querying them will cause the following IAException:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2016-07-26 01:16:27,471 ERROR parse.CalcitePlanner (SemanticAnalyzer.java:getMetaData(1867)) - org.apache.hadoop.hive.ql.metadata.HiveException: Unable to determine if hdfs://foo.ygrid.yahoo.com:8020/projects/my_db/my_table is encrypted: java.lang.IllegalArgumentException: Wrong FS: hdfs://foo.ygrid.yahoo.com:8020/projects/my_db/my_table, expected: hdfs://bar.ygrid.yahoo.com:8020
        at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.isPathEncrypted(SemanticAnalyzer.java:2204)
        at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.getStrongestEncryptedTablePath(SemanticAnalyzer.java:2274)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is because of the following code in &lt;tt&gt;SessionState&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;SessionState.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; HadoopShims.HdfsEncryptionShim getHdfsEncryptionShim() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; HiveException {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hdfsEncryptionShim == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        FileSystem fs = FileSystem.get(sessionConf);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-quote&quot;&gt;&quot;hdfs&quot;&lt;/span&gt;.equals(fs.getUri().getScheme())) {
          hdfsEncryptionShim = ShimLoader.getHadoopShims().createHdfsEncryptionShim(fs, sessionConf);
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
          LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Could not get hdfsEncryptionShim, it is only applicable to hdfs filesystem.&quot;&lt;/span&gt;);
        }
      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HiveException(e);
      }
    }

    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; hdfsEncryptionShim;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When the &lt;tt&gt;FileSystem&lt;/tt&gt; instance is created, using the &lt;tt&gt;sessionConf&lt;/tt&gt; implies that the current HDFS is going to be used. This call should instead fetch the &lt;tt&gt;FileSystem&lt;/tt&gt; instance corresponding to the path being checked.&lt;/p&gt;

&lt;p&gt;A fix is forthcoming...&lt;/p&gt;

&lt;p&gt;(Note to self: YHIVE-860)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12993410">HIVE-14380</key>
            <summary>Queries on tables with remote HDFS paths fail in &quot;encryption&quot; checks.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mithun">Mithun Radhakrishnan</assignee>
                                    <reporter username="mithun">Mithun Radhakrishnan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 Jul 2016 00:14:58 +0000</created>
                <updated>Mon, 11 May 2020 09:33:10 +0000</updated>
                            <resolved>Wed, 3 Aug 2016 15:59:22 +0000</resolved>
                                                    <fixVersion>2.2.0</fixVersion>
                                    <component>Encryption</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15398484" author="mithun" created="Fri, 29 Jul 2016 00:16:52 +0000"  >&lt;p&gt;The tentative fix.&lt;/p&gt;</comment>
                            <comment id="15399600" author="spena" created="Fri, 29 Jul 2016 16:17:00 +0000"  >&lt;p&gt;Cool &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mithun&quot; class=&quot;user-hover&quot; rel=&quot;mithun&quot;&gt;mithun&lt;/a&gt;, thanks for taking a look at this. &lt;br/&gt;
I reviewed the patch and it looks good. +1&lt;/p&gt;

&lt;p&gt;Let&apos;s see what HiveQA says.&lt;/p&gt;</comment>
                            <comment id="15399853" author="mithun" created="Fri, 29 Jul 2016 18:54:04 +0000"  >&lt;p&gt;Thanks for reviewing, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt;. :] Also, yikes. I&apos;m not sure how 2 JIRAs got raised. :/&lt;/p&gt;</comment>
                            <comment id="15400909" author="hiveqa" created="Sun, 31 Jul 2016 01:56:30 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12820842/HIVE-14380.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12820842/HIVE-14380.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 10 failed/errored test(s), 10418 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestMsgBusConnection - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_avro_nullable_union
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_list_bucket
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_multiinsert
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_orc_llap_counters
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_avro_non_nullable_union
org.apache.hadoop.hive.llap.security.TestLlapSignerImpl.testSigning
org.apache.hadoop.hive.llap.tezplugins.TestLlapTaskSchedulerService.testDelayedLocalityNodeCommErrorImmediateAllocation
org.apache.hadoop.hive.metastore.TestHiveMetaStoreTxns.stringifyValidTxns
org.apache.hadoop.hive.metastore.TestHiveMetaStoreTxns.testTxnRange
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/702/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/702/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/702/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/702/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-702/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-702/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 10 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12820842 - PreCommit-HIVE-MASTER-Build&lt;/p&gt;</comment>
                            <comment id="15403411" author="mithun" created="Tue, 2 Aug 2016 05:55:21 +0000"  >&lt;p&gt;I&apos;ll confirm, but I think these failures might be unrelated.&lt;/p&gt;</comment>
                            <comment id="15403482" author="mithun" created="Tue, 2 Aug 2016 06:49:11 +0000"  >&lt;p&gt;Yeah, looks like these tests are busted on master. :/ Just checked on a fresh checkout.&lt;/p&gt;

&lt;p&gt;All except &lt;tt&gt;TestHiveMetaStoreTxns&lt;/tt&gt;. That test seems to run for me (even with my patch applied).&lt;/p&gt;</comment>
                            <comment id="15406123" author="spena" created="Wed, 3 Aug 2016 15:59:22 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mithun&quot; class=&quot;user-hover&quot; rel=&quot;mithun&quot;&gt;mithun&lt;/a&gt; for your contribution. I committed this to master.&lt;/p&gt;</comment>
                            <comment id="15406177" author="mithun" created="Wed, 3 Aug 2016 16:39:06 +0000"  >&lt;p&gt;Thank you very much, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt;. I have a related fix on the metastore server-side. I hope to make time to raise a JIRA for this soon.&lt;/p&gt;</comment>
                            <comment id="16052223" author="mithun" created="Fri, 16 Jun 2017 18:25:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;I have a related fix on the metastore server-side.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Looks like my fix for the &lt;tt&gt;HiveMetaStore&lt;/tt&gt; is obviated by &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-14688&quot; title=&quot;Hive drop call fails in presence of TDE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-14688&quot;&gt;HIVE-14688&lt;/a&gt;. I&apos;ll leave my fix out.&lt;/p&gt;</comment>
                            <comment id="16060064" author="thejas" created="Thu, 22 Jun 2017 21:51:18 +0000"  >&lt;p&gt;Thanks for checking about the metastore fix &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mithun&quot; class=&quot;user-hover&quot; rel=&quot;mithun&quot;&gt;mithun&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="16071133" author="cltlfcjin" created="Sat, 1 Jul 2017 10:02:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mithun&quot; class=&quot;user-hover&quot; rel=&quot;mithun&quot;&gt;mithun&lt;/a&gt;, could you please help to share branch-1.2 patch?&lt;/p&gt;</comment>
                            <comment id="16113779" author="mithun" created="Fri, 4 Aug 2017 01:38:37 +0000"  >&lt;p&gt;Sorry I missed your message, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cltlfcjin&quot; class=&quot;user-hover&quot; rel=&quot;cltlfcjin&quot;&gt;cltlfcjin&lt;/a&gt;. Here&apos;s a patch that applies to &lt;tt&gt;branch-1.2&lt;/tt&gt;. I&apos;ve had to pull in part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-7476&quot; title=&quot;CTAS does not work properly for s3&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-7476&quot;&gt;&lt;del&gt;HIVE-7476&lt;/del&gt;&lt;/a&gt; for this.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12993409">HIVE-14379</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13078758">HIVE-16874</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13304051">SPARK-31675</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13078758">HIVE-16874</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12840640">HIVE-11116</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13002177">HIVE-14688</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12820842" name="HIVE-14380.1.patch" size="8552" author="mithun" created="Fri, 29 Jul 2016 00:16:52 +0000"/>
                            <attachment id="12880331" name="HIVE-14380.branch-1.2.patch" size="17468" author="mithun" created="Fri, 4 Aug 2017 01:36:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 15 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31njj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>