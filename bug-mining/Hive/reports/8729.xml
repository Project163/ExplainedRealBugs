<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:26:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-28480] Disable SMB on partition hash generator mismatch across join branches in previous RS</title>
                <link>https://issues.apache.org/jira/browse/HIVE-28480</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;As SMB replaces last RS op from the joining branches and the JOIN op with MERGEJOIN, we need to ensure the RS before these RS, in both branches, are partitioning using same hash generator.&lt;/p&gt;

&lt;p&gt;Hash code generator differs based on ReducerTraits.UNIFORM i.e. &lt;a href=&quot;https://github.com/apache/hive/blob/master/ql/src/java/org/apache/hadoop/hive/ql/exec/ReduceSinkOperator.java#L340-L344&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ReduceSinkOperator#computeMurmurHash()&#160; or ReduceSinkOperator#computeHashCode()&lt;/a&gt;, leading to different hash code for same value.&lt;/p&gt;

&lt;p&gt;Skip SMB join in such cases.&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;Replication%3A&quot;&gt;&lt;/a&gt;Replication:&lt;/h3&gt;

&lt;p&gt;Consider following query, where join would get converted to SMB. Auto reducer is enabled which ensures more than 1 reducer task.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CREATE TABLE t_asj_18 (k STRING, v INT);
INSERT INTO t_asj_18 values (&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;, 10), (&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;, 10);

set hive.auto.convert.join=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
set hive.tez.auto.reducer.parallelism=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;

EXPLAIN SELECT * FROM (
    SELECT k, COUNT(DISTINCT v), SUM(v)
    FROM t_asj_18 GROUP BY k
) a LEFT JOIN (
    SELECT k, COUNT(v)
    FROM t_asj_18 GROUP BY k
) b ON a.k = b.k; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Expected result is:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
a   1   20  a   2 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but on master branch, it results in&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
a   1   20  NULL    NULL &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Here for COUNT(DISTINCT), the RS key is k, v while partition is still k. In such scenario &lt;a href=&quot;#L99-L104].&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;reducer trait UNIFORM is not set&lt;/a&gt; The hash code for &quot;a&quot; from 2nd subquery is generated using murmurHash (270516725) while 1st is generated using bucketHash (1086686554) and result in rows with &quot;a&quot; key reaching different reducer tasks.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13589958">HIVE-28480</key>
            <summary>Disable SMB on partition hash generator mismatch across join branches in previous RS</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="himanshum">Himanshu Mishra</assignee>
                                    <reporter username="himanshum">Himanshu Mishra</reporter>
                        <labels>
                            <label>hive-4.0.1-merged</label>
                            <label>hive-4.0.1-must</label>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sat, 24 Aug 2024 21:23:46 +0000</created>
                <updated>Wed, 24 Sep 2025 19:14:54 +0000</updated>
                            <resolved>Mon, 9 Sep 2024 08:23:54 +0000</resolved>
                                                    <fixVersion>4.1.0</fixVersion>
                    <fixVersion>4.0.1</fixVersion>
                                    <component>Query Planning</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17876949" author="glapark" created="Tue, 27 Aug 2024 08:29:32 +0000"  >&lt;p&gt;As this is a (critical) correctness problem, I would like to suggest setting Priority to Critical.&lt;/p&gt;</comment>
                            <comment id="17877604" author="himanshum" created="Thu, 29 Aug 2024 06:55:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zabetak&quot; class=&quot;user-hover&quot; rel=&quot;zabetak&quot;&gt;zabetak&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkasa&quot; class=&quot;user-hover&quot; rel=&quot;kkasa&quot;&gt;kkasa&lt;/a&gt; can you please take a look&lt;/p&gt;</comment>
                            <comment id="17880226" author="kkasa" created="Mon, 9 Sep 2024 08:23:54 +0000"  >&lt;p&gt;Merged to master. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=himanshum&quot; class=&quot;user-hover&quot; rel=&quot;himanshum&quot;&gt;himanshum&lt;/a&gt; for the patch and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=okumin&quot; class=&quot;user-hover&quot; rel=&quot;okumin&quot;&gt;okumin&lt;/a&gt; for review.&lt;/p&gt;</comment>
                            <comment id="18022336" author="JIRAUSER311033" created="Wed, 24 Sep 2025 06:39:43 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=himanshum&quot; class=&quot;user-hover&quot; rel=&quot;himanshum&quot;&gt;himanshum&lt;/a&gt; , I see this issue was fixed in 4.1.0 and 4.0.1 only. Can you please help to confirm if this issue also affect Hive 3.1.3? or it only affect Hive 4.0.0?&#160;&#160;&lt;/p&gt;

&lt;p&gt;Thanks a lot.&#160;&lt;/p&gt;</comment>
                            <comment id="18022522" author="himanshum" created="Wed, 24 Sep 2025 19:14:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=longz1005&quot; class=&quot;user-hover&quot; rel=&quot;longz1005&quot;&gt;longz1005&lt;/a&gt; it did affect 3.1.3&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1r1uw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>