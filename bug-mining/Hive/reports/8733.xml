<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:26:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-28366] Iceberg: Concurrent Insert and IOW produce incorrect result </title>
                <link>https://issues.apache.org/jira/browse/HIVE-28366</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;1. create a table and insert some data:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
create table ice_t (i &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, p &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) partitioned by spec (truncate(10, i)) stored by iceberg;

insert into ice_t values (1, 1), (2, 2);
insert into ice_t values (10, 10), (20, 20);
insert into ice_t values (40, 40), (30, 30);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then concurrently execute the following jobs:&lt;br/&gt;
Job 1:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
insert into ice_t select i*100, p*100 from ice_t;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Job 2:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
insert overwrite ice_t select i+1, p+1 from ice_t;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If Job 1 finishes first, Job 2 still succeeds for me, and after that the table content will be the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2      2
3      3
11     11
21     21
31     31
41     41
100    100
200    200
1000   1000
2000   2000
3000   3000
4000   4000
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13585341">HIVE-28366</key>
            <summary>Iceberg: Concurrent Insert and IOW produce incorrect result </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkuzmenko">Denys Kuzmenko</assignee>
                                    <reporter username="dkuzmenko">Denys Kuzmenko</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 10 Jul 2024 16:47:19 +0000</created>
                <updated>Tue, 29 Jul 2025 14:51:16 +0000</updated>
                            <resolved>Tue, 17 Sep 2024 07:24:28 +0000</resolved>
                                    <version>4.0.0</version>
                                    <fixVersion>4.1.0</fixVersion>
                                    <component>Iceberg integration</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17870423" author="lisoda" created="Fri, 2 Aug 2024 09:31:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dkuzmenko&quot; class=&quot;user-hover&quot; rel=&quot;dkuzmenko&quot;&gt;dkuzmenko&lt;/a&gt; :&lt;/p&gt;

&lt;p&gt;Sir, this should be due to the fact that before the commit method is executed, the client calls the refresh method to get the latest snapshot, and uses it to commit.&lt;br/&gt;
Assuming that the insert overwrite is executed first, and then the insert into command starts executing the commit method, this would cause the problem.&lt;br/&gt;
Since read and write are often distributed different physical nodes in large distributed systems, if you want to guarantee a completely reliable commit, you need to pass the snapshotId of the read node the whole time, but almost no one does this in the first place.&lt;/p&gt;</comment>
                            <comment id="17870429" author="lisoda" created="Fri, 2 Aug 2024 09:38:17 +0000"  >&lt;p&gt;For HIVE_CATALOG, can we use the read/write locking mechanism provided by HMS to prevent concurrent commits?The table cannot be read when data is written to it.&lt;/p&gt;</comment>
                            <comment id="17870492" author="dkuzmenko" created="Fri, 2 Aug 2024 12:19:18 +0000"  >&lt;p&gt;For HIVE_CATALOG, can we use the read/write locking mechanism provided by HMS to prevent concurrent commits? - yes, that is exactly what I did: &lt;br/&gt;
IOW would use an `exclusive write` lock, while other write operations - &apos;shared write&apos;.  Same way as it&apos;s done for Hive ACID. I have a draft solution already, just need to polish it before submitting PR.&lt;/p&gt;</comment>
                            <comment id="17882286" author="dkuzmenko" created="Tue, 17 Sep 2024 07:25:15 +0000"  >&lt;p&gt;Merged to master.&lt;br/&gt;
Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ayushsaxena&quot; class=&quot;user-hover&quot; rel=&quot;ayushsaxena&quot;&gt;ayushsaxena&lt;/a&gt; for the review!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 8 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1q9e0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>