<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:56:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-1411] DataNucleus throws NucleusException if core-3.1.1 JAR appears more than once on CLASSPATH</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1411</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;DataNucleus barfs when the core-3.1.1 JAR file appears more than once on the CLASSPATH:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2010-03-06 12:33:25,565 ERROR exec.DDLTask (SessionState.java:printError(279)) - FAILED: Error in metadata: javax.jdo.JDOFatalInter 
nalException: Unexpected exception caught. 
NestedThrowables: 
java.lang.reflect.InvocationTargetException 
org.apache.hadoop.hive.ql.metadata.HiveException: javax.jdo.JDOFatalInternalException: Unexpected exception caught. 
NestedThrowables: 
java.lang.reflect.InvocationTargetException 
at org.apache.hadoop.hive.ql.metadata.Hive.createTable(Hive.java:258) 
at org.apache.hadoop.hive.ql.exec.DDLTask.createTable(DDLTask.java:879) 
at org.apache.hadoop.hive.ql.exec.DDLTask.execute(DDLTask.java:103) 
at org.apache.hadoop.hive.ql.Driver.execute(Driver.java:379) 
at org.apache.hadoop.hive.ql.Driver.run(Driver.java:285) 
at org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:123) 
at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:181) 
at org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:287) 
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) 
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) 
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:597) 
at org.apache.hadoop.util.RunJar.main(RunJar.java:156) 
Caused by: javax.jdo.JDOFatalInternalException: Unexpected exception caught. 
NestedThrowables: 
java.lang.reflect.InvocationTargetException 
at javax.jdo.JDOHelper.invokeGetPersistenceManagerFactoryOnImplementation(JDOHelper.java:1186)
at javax.jdo.JDOHelper.getPersistenceManagerFactory(JDOHelper.java:803) 
at javax.jdo.JDOHelper.getPersistenceManagerFactory(JDOHelper.java:698) 
at org.apache.hadoop.hive.metastore.ObjectStore.getPMF(ObjectStore.java:164) 
at org.apache.hadoop.hive.metastore.ObjectStore.getPersistenceManager(ObjectStore.java:181)
at org.apache.hadoop.hive.metastore.ObjectStore.initialize(ObjectStore.java:125) 
at org.apache.hadoop.hive.metastore.ObjectStore.setConf(ObjectStore.java:104) 
at org.apache.hadoop.util.ReflectionUtils.setConf(ReflectionUtils.java:62) 
at org.apache.hadoop.util.ReflectionUtils.newInstance(ReflectionUtils.java:117) 
at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.getMS(HiveMetaStore.java:130)
at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.createDefaultDB(HiveMetaStore.java:146)
at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.init(HiveMetaStore.java:118) 
at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.(HiveMetaStore.java:100) 
at org.apache.hadoop.hive.metastore.HiveMetaStoreClient.(HiveMetaStoreClient.java:74) 
at org.apache.hadoop.hive.ql.metadata.Hive.createMetaStoreClient(Hive.java:783) 
at org.apache.hadoop.hive.ql.metadata.Hive.getMSC(Hive.java:794) 
at org.apache.hadoop.hive.ql.metadata.Hive.createTable(Hive.java:252) 
... 12 more 
Caused by: java.lang.reflect.InvocationTargetException 
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) 
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) 
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:597) 
at javax.jdo.JDOHelper$16.run(JDOHelper.java:1956) 
at java.security.AccessController.doPrivileged(Native Method) 
at javax.jdo.JDOHelper.invoke(JDOHelper.java:1951) 
at javax.jdo.JDOHelper.invokeGetPersistenceManagerFactoryOnImplementation(JDOHelper.java:1159)
... 28 more 
Caused by: org.datanucleus.exceptions.NucleusException: Plugin (Bundle) &lt;span class=&quot;code-quote&quot;&gt;&quot;org.eclipse.jdt.core&quot;&lt;/span&gt; is already registered. Ensure you &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; 
nt have multiple JAR versions of the same plugin in the classpath. The URL &quot;file:/Users/hadop/hadoop-0.20.1+152/build/ivy/lib/Hadoo 
p/common/core-3.1.1.jar&lt;span class=&quot;code-quote&quot;&gt;&quot; is already registered, and you are trying to register an identical plugin located at URL &quot;&lt;/span&gt;file:/Users/hado 
p/hadoop-0.20.1+152/lib/core-3.1.1.jar.&quot; 
at org.datanucleus.plugin.NonManagedPluginRegistry.registerBundle(NonManagedPluginRegistry.java:437)
at org.datanucleus.plugin.NonManagedPluginRegistry.registerBundle(NonManagedPluginRegistry.java:343)
at org.datanucleus.plugin.NonManagedPluginRegistry.registerExtensions(NonManagedPluginRegistry.java:227)
at org.datanucleus.plugin.NonManagedPluginRegistry.registerExtensionPoints(NonManagedPluginRegistry.java:159)
at org.datanucleus.plugin.PluginManager.registerExtensionPoints(PluginManager.java:82) 
at org.datanucleus.OMFContext.(OMFContext.java:164) 
at org.datanucleus.OMFContext.(OMFContext.java:145) 
at org.datanucleus.ObjectManagerFactoryImpl.initialiseOMFContext(ObjectManagerFactoryImpl.java:143)
at org.datanucleus.jdo.JDOPersistenceManagerFactory.initialiseProperties(JDOPersistenceManagerFactory.java:317)
at org.datanucleus.jdo.JDOPersistenceManagerFactory.(JDOPersistenceManagerFactory.java:261)
at org.datanucleus.jdo.JDOPersistenceManagerFactory.getPersistenceManagerFactory(JDOPersistenceManagerFactory.java:174)
... 36 more 

2010-03-06 12:33:25,575 ERROR ql.Driver (SessionState.java:printError(279)) - FAILED: Execution Error, &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; code 1 from org.apach 
e.hadoop.hive.ql.exec.DDLTask 
2010-03-06 12:42:30,457 ERROR exec.DDLTask (SessionState.java:printError(279)) - FAILED: Error in metadata: javax.jdo.JDOFatalInter 
nalException: Unexpected exception caught. 
NestedThrowables: 
java.lang.reflect.InvocationTargetException 
org.apache.hadoop.hive.ql.metadata.HiveException: javax.jdo.JDOFatalInternalException: Unexpected exception caught. 
NestedThrowables:
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12467046">HIVE-1411</key>
            <summary>DataNucleus throws NucleusException if core-3.1.1 JAR appears more than once on CLASSPATH</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cwsteinbach">Carl Steinbach</assignee>
                                    <reporter username="cwsteinbach">Carl Steinbach</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Jun 2010 23:56:02 +0000</created>
                <updated>Sat, 17 Dec 2011 00:03:58 +0000</updated>
                            <resolved>Fri, 30 Jul 2010 21:59:29 +0000</resolved>
                                    <version>0.4.0</version>
                    <version>0.4.1</version>
                    <version>0.5.0</version>
                                    <fixVersion>0.6.0</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12879198" author="cwsteinbach" created="Wed, 16 Jun 2010 00:11:00 +0000"  >&lt;p&gt;A little background on what DataNucleus is trying to do: &lt;a href=&quot;http://www.datanucleus.org/extensions/plugins.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.datanucleus.org/extensions/plugins.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Definition of pluginRegistryBundleCheck property: &lt;a href=&quot;http://www.datanucleus.org/products/accessplatform_1_0/persistence_properties.html#general&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.datanucleus.org/products/accessplatform_1_0/persistence_properties.html#general&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="12879199" author="cwsteinbach" created="Wed, 16 Jun 2010 00:14:07 +0000"  >&lt;p&gt;This patch adds the property &quot;datanucleus.plugin.pluginRegistryBundleCheck&quot; to hive-site.xml and sets the value to LOG. When not set this property defaults to EXCEPTION, which results in an exception being thrown if the CLASSPATH contains two or more JARs with the same name.&lt;/p&gt;</comment>
                            <comment id="12879218" author="pauly" created="Wed, 16 Jun 2010 01:11:25 +0000"  >&lt;p&gt;Taking a look.&lt;/p&gt;</comment>
                            <comment id="12891299" author="jvs" created="Thu, 22 Jul 2010 19:40:34 +0000"  >&lt;p&gt;Paul, are you still looking at this one?&lt;/p&gt;</comment>
                            <comment id="12891301" author="pauly" created="Thu, 22 Jul 2010 19:44:11 +0000"  >&lt;p&gt;Whoops, got side tracked by another datanucleus issue. I&apos;ll review it today.&lt;/p&gt;</comment>
                            <comment id="12891307" author="pauly" created="Thu, 22 Jul 2010 20:03:09 +0000"  >&lt;p&gt;@Carl - what is the motivation for turning off this exception? Wouldn&apos;t it be good to know if 2 jars were on the CP so that the user would know for sure which version was in use? &lt;/p&gt;</comment>
                            <comment id="12891385" author="cwsteinbach" created="Thu, 22 Jul 2010 23:02:15 +0000"  >&lt;p&gt;Here&apos;s some more background on what is happening:&lt;/p&gt;

&lt;p&gt;When DataNucleus starts up it &lt;a href=&quot;http://www.datanucleus.org/extensions/plugins.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;scans every class that it finds on the CLASSPATH&lt;/a&gt; looking for &lt;a href=&quot;http://www.ibm.com/developerworks/opensource/library/os-ecl-osgi/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;OSGi format plugins&lt;/a&gt;. Hadoop core happens to depend on Eclipse&apos;s core-3.1.1.jar (which contains OSGi format plugins), so this gets included in Hive&apos;s CLASSPATH since bin/hive delegates execution to bin/hadoop. If a user installed Hadoop from a tar ball and set HADOOP_HOME to the install directory we are all good, but if the user also ran &apos;ant&apos; in $HADOOP_HOME we&apos;re in a world of pain since this results in two copies of core-3.1.1.jar (the original copy in $HADOOP_HOME/lib and another copy in $HADOOP_HOME/build/ivy/lib/Hadoop/common/) and bin/hadoop stupidly adds both jars to the CLASSPATH.&lt;/p&gt;

&lt;p&gt;I want to highlight the following points:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Duplicate CLASSPATH entries are a fact of life with Hadoop and Hive due to the screwed up CLASSPATH construction code in bin/hadoop and bin/hive&lt;/li&gt;
	&lt;li&gt;The duplicate CLASSPATH check that DataNucleus enforces by default only applies to JARs that contain OSGi plugins, which in our case seems to only apply to the core-3.1.1 JAR.&lt;/li&gt;
	&lt;li&gt;The patch that I supplied causes this harmless condition to result in a LOG message instead of a fatal exception. I think this preferable.&lt;/li&gt;
	&lt;li&gt;This exception is easy to reproduce on 0.5.0, but the upgrade to datanucleus-2.3 in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1176&quot; title=&quot;&amp;#39;create if not exists&amp;#39; fails for a table name with &amp;#39;select&amp;#39; in it&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1176&quot;&gt;&lt;del&gt;HIVE-1176&lt;/del&gt;&lt;/a&gt; seems to have made it unreproducible on trunk. I think this indicates that there is a bug in datanucleus-2.3 since it is no longer honoring the contract set by datanucleus.plugin.pluginRegistryBundleCheck (the default value is still EXCEPTION). I recommend that we commit this patch anyway lest we encounter this bug in the future after upgrading to a newer version of datanucleus that fixes this problem.&lt;/li&gt;
&lt;/ol&gt;

</comment>
                            <comment id="12891392" author="pauly" created="Thu, 22 Jul 2010 23:28:24 +0000"  >&lt;p&gt;About #4, I was able to reproduce the exception and verify the fix by creating a copy of the datanucleus core jar in hive&apos;s lib directory.&lt;/p&gt;

&lt;p&gt;Makes sense to me. Now that you mention it, I think I ran into a similar problem while using the &apos;hadoop jar&apos; command. It would unpack the jar, but include both the jar and the unpacked classes in the classpath. If the jar contained datanucleus stuff, this would throw an exception.&lt;/p&gt;

&lt;p&gt;Anyway, the fix looks good. +1&lt;/p&gt;</comment>
                            <comment id="12893020" author="jvs" created="Wed, 28 Jul 2010 01:08:13 +0000"  >&lt;p&gt;+1.  Will commit when tests pass.&lt;/p&gt;</comment>
                            <comment id="12894120" author="jvs" created="Fri, 30 Jul 2010 19:29:41 +0000"  >&lt;p&gt;Carl, when you supply patches, please make sure they can be applied with patch -p0.  This one needed patch -p1.&lt;/p&gt;</comment>
                            <comment id="12894171" author="jvs" created="Fri, 30 Jul 2010 21:59:29 +0000"  >&lt;p&gt;Committed to branch and trunk.  Thanks Carl!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12447187" name="HIVE-1411.patch.txt" size="1416" author="cwsteinbach" created="Wed, 16 Jun 2010 00:09:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72918</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 17 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0d3yf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>74417</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>