<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:39:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-12462] DPP: DPP optimizers need to run on the TS predicate not FIL </title>
                <link>https://issues.apache.org/jira/browse/HIVE-12462</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11398&quot; title=&quot;Parse wide OR and wide AND trees to flat OR/AND trees&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11398&quot;&gt;&lt;del&gt;HIVE-11398&lt;/del&gt;&lt;/a&gt; + &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11791&quot; title=&quot;Add unit test for HIVE-10122&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11791&quot;&gt;&lt;del&gt;HIVE-11791&lt;/del&gt;&lt;/a&gt;, the partition-condition-remover became more effective.&lt;/p&gt;

&lt;p&gt;This removes predicates from the FilterExpression which involve partition columns, causing a miss for dynamic-partition pruning if the DPP relies on FilterDesc.&lt;/p&gt;

&lt;p&gt;The TS desc will have the correct predicate in that condition.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$hdt$_0:$hdt$_1:a
  TableScan (TS_2)
    alias: a
    filterExpr: (((account_id = 22) and year(dt) is not &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) and (year(dt)) IN (RS[6])) (type: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;)
    Filter Operator (FIL_20)
      predicate: ((account_id = 22) and year(dt) is not &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) (type: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;)
      Select Operator (SEL_4)
        expressions: dt (type: date)
        outputColumnNames: _col1
        Reduce Output Operator (RS_8)
          key expressions: year(_col1) (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
          sort order: +
          Map-reduce partition columns: year(_col1) (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
          Join Operator (JOIN_9)
            condition map:
                 Inner Join 0 to 1
            keys:
              0 year(_col1) (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
              1 year(_col1) (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12914366">HIVE-12462</key>
            <summary>DPP: DPP optimizers need to run on the TS predicate not FIL </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="gopalv">Gopal Vijayaraghavan</assignee>
                                    <reporter username="gopalv">Gopal Vijayaraghavan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Nov 2015 06:24:36 +0000</created>
                <updated>Tue, 16 Feb 2016 23:53:20 +0000</updated>
                            <resolved>Wed, 6 Jan 2016 19:28:26 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>Tez</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15014205" author="sershe" created="Thu, 19 Nov 2015 19:26:39 +0000"  >&lt;p&gt;+1 pending tests&lt;/p&gt;</comment>
                            <comment id="15020838" author="hiveqa" created="Sun, 22 Nov 2015 05:01:36 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12773190/HIVE-12462.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12773190/HIVE-12462.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 13 failed/errored test(s), 9834 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestHWISessionManager - did not produce a TEST-*.xml file
TestMiniLlapCliDriver - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_notin
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_notin_having
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_dynamic_partition_pruning
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_dynamic_partition_pruning_2
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_explainuser_1
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_tez_dynpart_hashjoin_3
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_tez_smb_empty
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vectorized_dynamic_partition_pruning
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_schemeAuthority
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hive.jdbc.TestSSL.testSSLVersion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6097/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6097/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6097/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6097/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6097/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6097/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 13 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12773190 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="15023228" author="sershe" created="Mon, 23 Nov 2015 22:27:53 +0000"  >&lt;p&gt;Test failures are because of the missing cleanup (currently, the code cleans up TS expr separately and filter expr as part of processing, if TS expr is used in processing noone cleans up the filter). Patch soon&lt;/p&gt;</comment>
                            <comment id="15023290" author="sershe" created="Mon, 23 Nov 2015 23:02:55 +0000"  >&lt;p&gt;Updated the patch.&lt;/p&gt;</comment>
                            <comment id="15026452" author="gopalv" created="Wed, 25 Nov 2015 08:58:34 +0000"  >&lt;p&gt;I think the FIL path is having its Synthetic predicate removed too early. I&apos;ll take another shot at this.&lt;/p&gt;</comment>
                            <comment id="15027451" author="sershe" created="Wed, 25 Nov 2015 19:42:17 +0000"  >&lt;p&gt;Hmm. The previous logic removed it exactly after processing, and then removed the TS one at the end. This one should do the same..&lt;/p&gt;</comment>
                            <comment id="15027709" author="gopalv" created="Wed, 25 Nov 2015 22:20:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt;: yes, you&apos;re right. LGTM - +1.&lt;/p&gt;</comment>
                            <comment id="15032926" author="sershe" created="Tue, 1 Dec 2015 02:08:24 +0000"  >&lt;p&gt;Committed to master.&lt;/p&gt;</comment>
                            <comment id="15054151" author="hagleitn" created="Sat, 12 Dec 2015 08:51:43 +0000"  >&lt;p&gt;I&apos;ve looked into this some more. This should have already worked. There are tests in dynamic_partition_pruner.q that check for this type of join condition (with udf). However these tests no longer work. &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11634&quot; title=&quot;Support partition pruning for IN(STRUCT(partcol, nonpartcol..)...)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11634&quot;&gt;&lt;del&gt;HIVE-11634&lt;/del&gt;&lt;/a&gt; broke them. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hsubramaniyan&quot; class=&quot;user-hover&quot; rel=&quot;hsubramaniyan&quot;&gt;hsubramaniyan&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpullokkaran&quot; class=&quot;user-hover&quot; rel=&quot;jpullokkaran&quot;&gt;jpullokkaran&lt;/a&gt; can you please take a look at this? I don&apos;t think the patch proposed here is the right fix and should probably be reverted.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11634&quot; title=&quot;Support partition pruning for IN(STRUCT(partcol, nonpartcol..)...)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11634&quot;&gt;&lt;del&gt;HIVE-11634&lt;/del&gt;&lt;/a&gt; changes the golden file of the dynamic_partition_pruner.q - it effectively disables the optimization and I&apos;m not sure why. The synthetic predicate in dpp is of the form (col IN (reducesink operator)) which for some reason gets lost in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11634&quot; title=&quot;Support partition pruning for IN(STRUCT(partcol, nonpartcol..)...)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11634&quot;&gt;&lt;del&gt;HIVE-11634&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11634&quot; title=&quot;Support partition pruning for IN(STRUCT(partcol, nonpartcol..)...)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11634&quot;&gt;&lt;del&gt;HIVE-11634&lt;/del&gt;&lt;/a&gt; also seem to leave you with different expressions in the table scan and the filter and I&apos;m thinking this is wrong as well (i.e.: the fix in this patch shouldn&apos;t work either).&lt;/p&gt;</comment>
                            <comment id="15056516" author="sershe" created="Mon, 14 Dec 2015 19:19:35 +0000"  >&lt;p&gt;We should figure out the right fix for the above issue before reverting this. Do you want to track it in  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-12462&quot; title=&quot;DPP: DPP optimizers need to run on the TS predicate not FIL &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-12462&quot;&gt;&lt;del&gt;HIVE-12462&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="15056518" author="sershe" created="Mon, 14 Dec 2015 19:20:48 +0000"  >&lt;p&gt;I think the reason for this patch from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gopalv&quot; class=&quot;user-hover&quot; rel=&quot;gopalv&quot;&gt;gopalv&lt;/a&gt;&apos;s query runs was precisely that TS predicate was a superset of FIL predicate. I was assuming that&apos;s by design.&lt;/p&gt;</comment>
                            <comment id="15056709" author="hsubramaniyan" created="Mon, 14 Dec 2015 20:59:28 +0000"  >&lt;p&gt;Created &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-12666&quot; title=&quot;PCRExprProcFactory.GenericFuncExprProcessor.process() aggressively removes dynamic partition pruner generated synthetic join predicates.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-12666&quot;&gt;&lt;del&gt;HIVE-12666&lt;/del&gt;&lt;/a&gt; to track the issue that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hagleitn&quot; class=&quot;user-hover&quot; rel=&quot;hagleitn&quot;&gt;hagleitn&lt;/a&gt; mentioned. My bad . After going through the change in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11634&quot; title=&quot;Support partition pruning for IN(STRUCT(partcol, nonpartcol..)...)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11634&quot;&gt;&lt;del&gt;HIVE-11634&lt;/del&gt;&lt;/a&gt;, the change in PCRExprProcFactory is the original cause for the dynamic partitioning event operator to disappear from many places since it aggressively removes the IN list predicates.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Hari&lt;/p&gt;</comment>
                            <comment id="15057120" author="hsubramaniyan" created="Tue, 15 Dec 2015 01:17:12 +0000"  >&lt;p&gt;I&apos;ve uploaded the patch with the potential fix on this issue in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-12666&quot; title=&quot;PCRExprProcFactory.GenericFuncExprProcessor.process() aggressively removes dynamic partition pruner generated synthetic join predicates.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-12666&quot;&gt;&lt;del&gt;HIVE-12666&lt;/del&gt;&lt;/a&gt;, will be great if someone can review it. I am also reverting this patch as part of the fix.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Hari&lt;/p&gt;</comment>
                            <comment id="15086079" author="sershe" created="Wed, 6 Jan 2016 19:04:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hagleitn&quot; class=&quot;user-hover&quot; rel=&quot;hagleitn&quot;&gt;hagleitn&lt;/a&gt; what is the status of this, is this relevant anymore?&lt;/p&gt;</comment>
                            <comment id="15086088" author="hsubramaniyan" created="Wed, 6 Jan 2016 19:11:45 +0000"  >&lt;p&gt;I believe this jira is invalid and should be closed as &apos;Not a Problem&apos; or something similar since &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-12666&quot; title=&quot;PCRExprProcFactory.GenericFuncExprProcessor.process() aggressively removes dynamic partition pruner generated synthetic join predicates.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-12666&quot;&gt;&lt;del&gt;HIVE-12666&lt;/del&gt;&lt;/a&gt; tracks the underlying issue. Leaving it to the original owners of the jira, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gopalv&quot; class=&quot;user-hover&quot; rel=&quot;gopalv&quot;&gt;gopalv&lt;/a&gt; / &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt; to take the required action.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Hari&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12921762">HIVE-12666</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12773930" name="HIVE-12462.02.patch" size="18573" author="sershe" created="Mon, 23 Nov 2015 23:02:41 +0000"/>
                            <attachment id="12773190" name="HIVE-12462.1.patch" size="2254" author="gopalv" created="Thu, 19 Nov 2015 06:46:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 45 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2omf3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332641">2.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>