<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:04:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-3913] Possible deadlock in ZK lock manager</title>
                <link>https://issues.apache.org/jira/browse/HIVE-3913</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;ZK Hive lock manager can get into a state when the connection is closed, but no reconnection is attempted.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12628147">HIVE-3913</key>
            <summary>Possible deadlock in ZK lock manager</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikhail">Mikhail Gryzykhin</assignee>
                                    <reporter username="mikhail">Mikhail Gryzykhin</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Jan 2013 02:28:26 +0000</created>
                <updated>Thu, 16 May 2013 21:10:32 +0000</updated>
                            <resolved>Thu, 24 Jan 2013 18:20:16 +0000</resolved>
                                                    <fixVersion>0.11.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13558064" author="ashutoshc" created="Sat, 19 Jan 2013 18:08:18 +0000"  >&lt;p&gt;Mikhail,&lt;br/&gt;
A recent fix went into trunk in this area via &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3537&quot; title=&quot;release locks at the end of move tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3537&quot;&gt;&lt;del&gt;HIVE-3537&lt;/del&gt;&lt;/a&gt;, so you may want to test your scenario on latest trunk. &lt;/p&gt;</comment>
                            <comment id="13559828" author="phabricator@reviews.facebook.net" created="Tue, 22 Jan 2013 18:14:12 +0000"  >&lt;p&gt;mbautin requested code review of &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3913&quot; title=&quot;Possible deadlock in ZK lock manager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3913&quot;&gt;&lt;del&gt;HIVE-3913&lt;/del&gt;&lt;/a&gt; Fix possible deadlock in ZK lock manager&quot;.&lt;br/&gt;
Reviewers: ashutoshc, njain, kevinwilfong, JIRA&lt;/p&gt;

&lt;p&gt;  ZK Hive lock manager can get into a state when the connection is closed, but no reconnection is attempted.&lt;/p&gt;


&lt;p&gt;TEST PLAN&lt;br/&gt;
  Run unit tests&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D8097&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D8097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/lockmgr/zookeeper/ZooKeeperHiveLockManager.java&lt;/p&gt;

&lt;p&gt;MANAGE HERALD DIFFERENTIAL RULES&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/view/differential/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/herald/view/differential/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WHY DID I GET THIS EMAIL?&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/transcript/19533/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/herald/transcript/19533/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: ashutoshc, njain, kevinwilfong, JIRA, mbautin&lt;/p&gt;</comment>
                            <comment id="13559830" author="mikhail" created="Tue, 22 Jan 2013 18:15:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt;: thanks for pointing this out. I took a look at &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3537&quot; title=&quot;release locks at the end of move tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3537&quot;&gt;&lt;del&gt;HIVE-3537&lt;/del&gt;&lt;/a&gt;, and I think this is a much simpler fix for a situation that I observed when the client attempts to acquire a lock, but the ZK connection is closed for some reason and no reconnection is attempted.&lt;/p&gt;</comment>
                            <comment id="13559832" author="phabricator@reviews.facebook.net" created="Tue, 22 Jan 2013 18:16:12 +0000"  >&lt;p&gt;mbautin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3913&quot; title=&quot;Possible deadlock in ZK lock manager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3913&quot;&gt;&lt;del&gt;HIVE-3913&lt;/del&gt;&lt;/a&gt; Fix possible deadlock in ZK lock manager&quot;.&lt;/p&gt;

&lt;p&gt;  This patch also logs some exceptions that were previously ignored for easier debugging.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D8097&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D8097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: ashutoshc, njain, kevinwilfong, JIRA, mbautin&lt;/p&gt;</comment>
                            <comment id="13561010" author="ashutoshc" created="Wed, 23 Jan 2013 19:46:05 +0000"  >&lt;p&gt;Mikhail,&lt;br/&gt;
Change looks alright. But can you explain how you got in this situation, where connection was closed after it was already opened. Any easy way to reproduce the scenario?&lt;/p&gt;</comment>
                            <comment id="13561011" author="phabricator@reviews.facebook.net" created="Wed, 23 Jan 2013 19:47:12 +0000"  >&lt;p&gt;ashutoshc has accepted the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3913&quot; title=&quot;Possible deadlock in ZK lock manager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3913&quot;&gt;&lt;del&gt;HIVE-3913&lt;/del&gt;&lt;/a&gt; Fix possible deadlock in ZK lock manager&quot;.&lt;/p&gt;

&lt;p&gt;  +1&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D8097&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D8097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  trunk-hive-3913-deadlock-in-zk-lock-manager&lt;/p&gt;

&lt;p&gt;To: ashutoshc, njain, kevinwilfong, JIRA, mbautin&lt;/p&gt;</comment>
                            <comment id="13561821" author="ashutoshc" created="Thu, 24 Jan 2013 18:20:17 +0000"  >&lt;p&gt;Committed to trunk. Thanks, Mikhail!&lt;/p&gt;</comment>
                            <comment id="13562010" author="hudson" created="Thu, 24 Jan 2013 21:35:38 +0000"  >&lt;p&gt;Integrated in hive-trunk-hadoop1 #41 (See &lt;a href=&quot;https://builds.apache.org/job/hive-trunk-hadoop1/41/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/hive-trunk-hadoop1/41/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3913&quot; title=&quot;Possible deadlock in ZK lock manager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3913&quot;&gt;&lt;del&gt;HIVE-3913&lt;/del&gt;&lt;/a&gt; : Possible deadlock in ZK lock manager (Mikhail Bautin via Ashutosh Chauhan) (Revision 1438116)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
hashutosh : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1438116&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1438116&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/lockmgr/zookeeper/ZooKeeperHiveLockManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13562546" author="hudson" created="Fri, 25 Jan 2013 08:48:21 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #1935 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/1935/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/1935/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3913&quot; title=&quot;Possible deadlock in ZK lock manager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3913&quot;&gt;&lt;del&gt;HIVE-3913&lt;/del&gt;&lt;/a&gt; : Possible deadlock in ZK lock manager (Mikhail Bautin via Ashutosh Chauhan) (Revision 1438116)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
hashutosh : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1438116&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1438116&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/lockmgr/zookeeper/ZooKeeperHiveLockManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13562698" author="hudson" created="Fri, 25 Jan 2013 14:04:59 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #86 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/86/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/86/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3913&quot; title=&quot;Possible deadlock in ZK lock manager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3913&quot;&gt;&lt;del&gt;HIVE-3913&lt;/del&gt;&lt;/a&gt; : Possible deadlock in ZK lock manager (Mikhail Bautin via Ashutosh Chauhan) (Revision 1438116)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
hashutosh : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1438116&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1438116&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/lockmgr/zookeeper/ZooKeeperHiveLockManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12565980" name="D8097.1.patch" size="2123" author="phabricator@reviews.facebook.net" created="Tue, 22 Jan 2013 18:14:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>304998</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 43 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i17xdj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>254377</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>