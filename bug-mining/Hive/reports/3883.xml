<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:37:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-11982] Some test cases for union all fail with recent changes</title>
                <link>https://issues.apache.org/jira/browse/HIVE-11982</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The tests throw java.lang.IndexOutOfBoundsException again. &lt;br/&gt;
It was supposed to be fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11271&quot; title=&quot;java.lang.IndexOutOfBoundsException when union all with if function&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11271&quot;&gt;&lt;del&gt;HIVE-11271&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12901153">HIVE-11982</key>
            <summary>Some test cases for union all fail with recent changes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ychena">Yongzhi Chen</assignee>
                                    <reporter username="ychena">Yongzhi Chen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Sep 2015 21:37:10 +0000</created>
                <updated>Tue, 16 Feb 2016 23:52:17 +0000</updated>
                            <resolved>Thu, 1 Oct 2015 18:35:21 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14934100" author="ychena" created="Mon, 28 Sep 2015 21:39:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11333&quot; title=&quot;ColumnPruner prunes columns of UnionOperator that should be kept&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11333&quot;&gt;&lt;del&gt;HIVE-11333&lt;/del&gt;&lt;/a&gt; and some other recent changes (not sure which one yet), makes prunedColLists.get(child) sometimes return null.&lt;br/&gt;
Will make the code to use genColLists for union opts. &lt;/p&gt;</comment>
                            <comment id="14934137" author="ychena" created="Mon, 28 Sep 2015 21:57:25 +0000"  >&lt;p&gt;Need code review.&lt;/p&gt;</comment>
                            <comment id="14934279" author="szehon" created="Mon, 28 Sep 2015 23:00:13 +0000"  >&lt;p&gt;Change looks good +1,  Would it be possible to add a test to prevent it from breaking yet again?&lt;/p&gt;</comment>
                            <comment id="14934456" author="ychena" created="Tue, 29 Sep 2015 01:21:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=szehon&quot; class=&quot;user-hover&quot; rel=&quot;szehon&quot;&gt;szehon&lt;/a&gt;, I do not know how to add test. The failed tests can pass in both TestCliDriver and TestMinimrCliDriver without fix; but it will fail in both local test and cluster test if I do manually. It may relate to the sequence of generating the query plan.&lt;br/&gt;
With the fix, manual tests pass.  So I think, after &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11333&quot; title=&quot;ColumnPruner prunes columns of UnionOperator that should be kept&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11333&quot;&gt;&lt;del&gt;HIVE-11333&lt;/del&gt;&lt;/a&gt;,  only genColLists can guarantee to return right prunelist for union.&lt;/p&gt;</comment>
                            <comment id="14936423" author="hiveqa" created="Wed, 30 Sep 2015 06:16:52 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12764116/HIVE-11982.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12764116/HIVE-11982.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 4 failed/errored test(s), 9623 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestMiniTezCliDriver-vectorization_16.q-mapjoin_mapjoin.q-groupby2.q-and-12-more - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_vector_groupby_reduce
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_groupby_reduce
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5465/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5465/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5465/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5465/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5465/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5465/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12764116 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14936975" author="ychena" created="Wed, 30 Sep 2015 15:11:55 +0000"  >&lt;p&gt;The failures are not related. &lt;/p&gt;</comment>
                            <comment id="14938298" author="szehon" created="Wed, 30 Sep 2015 19:11:01 +0000"  >&lt;p&gt;Thanks Yongzhi, would still be good to take a look to see if we can add the test (the difference between local mode vs CliDriver), I believe its the settings as we discussed.  As we are moving towards the policy of needing a test for every change, and plus we don&apos;t want it be broken again as by &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11333&quot; title=&quot;ColumnPruner prunes columns of UnionOperator that should be kept&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11333&quot;&gt;&lt;del&gt;HIVE-11333&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14939062" author="ychena" created="Wed, 30 Sep 2015 23:37:18 +0000"  >&lt;p&gt;I finally figured out the mystery of the query plan difference between unit test and local or cluster manual test:&lt;/p&gt;

&lt;p&gt;The unit tests set hive.in.test to true through data/conf/hive-site.xml. This flag does a lot of magic, one of them is in &lt;br/&gt;
static String canHandleQbForCbo(QueryProperties queryProperties, HiveConf conf,... method.&lt;br/&gt;
If I change the code&lt;br/&gt;
boolean isInTest = conf.getBoolVar(ConfVars.HIVE_IN_TEST);&lt;br/&gt;
to&lt;br/&gt;
boolean isInTest = false;&lt;/p&gt;

&lt;p&gt;The unit test query plan will be same as manual tests. &lt;/p&gt;

&lt;p&gt;The problem is how to control the code in my qfile test.&lt;br/&gt;
I can not set hive.in.test to false in the qfile for it will throw exception on the set statement. Should we add a new property to check in canHandleQbForCbo method? (Something like NeedCheckHiveInTest and default to true?).&lt;/p&gt;



</comment>
                            <comment id="14939086" author="szehon" created="Thu, 1 Oct 2015 00:04:36 +0000"  >&lt;p&gt;That&apos;s unfortunate.  Thanks for looking, it seems we tried our best.  +1&lt;/p&gt;</comment>
                            <comment id="14940199" author="szehon" created="Thu, 1 Oct 2015 18:35:21 +0000"  >&lt;p&gt;Committed to master, thanks Yongzhi!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12845418">HIVE-11271</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12846727">HIVE-11333</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12764116" name="HIVE-11982.1.patch" size="867" author="ychena" created="Mon, 28 Sep 2015 21:55:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 7 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2mdnz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>