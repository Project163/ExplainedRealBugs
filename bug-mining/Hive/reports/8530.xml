<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:24:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-27527] Order of records is not ensured in delete delta files when reduce deduplication is off</title>
                <link>https://issues.apache.org/jira/browse/HIVE-27527</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;When &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
set hive.optimize.reducededuplication=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Reduce sink operators in delete statements are not merged. Delete delta files must be sorted by RowID and this is ensured by the parent Reduce sink operators. In this case the child Reduce sink operator has only partition key column: &lt;tt&gt;UDFToInteger(_col0)&lt;/tt&gt; and sort order may broken and invalid delete delta files are written.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;Reduce Output Operators&lt;/tt&gt; in &lt;tt&gt;Map 1&lt;/tt&gt; has sort keys defined (RowId) but the one in &lt;tt&gt;Reducer 2&lt;/tt&gt; has only Map-reduce partition columns.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
POSTHOOK: query: explain
delete from t1 where a = 3
POSTHOOK: type: QUERY
POSTHOOK: Input: &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;@t1
POSTHOOK: Output: &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;@t1
STAGE DEPENDENCIES:
  Stage-1 is a root stage
  Stage-2 depends on stages: Stage-1
  Stage-0 depends on stages: Stage-2
  Stage-3 depends on stages: Stage-0

STAGE PLANS:
  Stage: Stage-1
    Tez
#### A masked pattern was here ####
      Edges:
        Reducer 2 &amp;lt;- Map 1 (SIMPLE_EDGE)
        Reducer 3 &amp;lt;- Reducer 2 (CUSTOM_SIMPLE_EDGE)
#### A masked pattern was here ####
      Vertices:
        Map 1 
            Map Operator Tree:
                TableScan
                  alias: t1
                  filterExpr: (a = 3) (type: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;)
                  Statistics: Num rows: 30 Data size: 120 Basic stats: COMPLETE Column stats: COMPLETE
                  Filter Operator
                    predicate: (a = 3) (type: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;)
                    Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: COMPLETE
                    Select Operator
                      expressions: ROW__ID (type: struct&amp;lt;writeid:bigint,bucketid:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,rowid:bigint&amp;gt;)
                      outputColumnNames: _col0
                      Statistics: Num rows: 1 Data size: 76 Basic stats: COMPLETE Column stats: COMPLETE
                      Reduce Output Operator
                        key expressions: _col0 (type: struct&amp;lt;writeid:bigint,bucketid:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,rowid:bigint&amp;gt;)
                        &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; sort order: z
                        sort order: +
                        Statistics: Num rows: 1 Data size: 76 Basic stats: COMPLETE Column stats: COMPLETE
            Execution mode: vectorized, llap
            LLAP IO: may be used (ACID table)
        Reducer 2 
            Execution mode: vectorized, llap
            Reduce Operator Tree:
              Select Operator
                expressions: KEY.reducesinkkey0 (type: struct&amp;lt;writeid:bigint,bucketid:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,rowid:bigint&amp;gt;)
                outputColumnNames: _col0
                Statistics: Num rows: 1 Data size: 76 Basic stats: COMPLETE Column stats: COMPLETE
                Reduce Output Operator
                  &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; sort order: 
                  sort order: 
                  Map-reduce partition columns: UDFToInteger(_col0) (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
                  Statistics: Num rows: 1 Data size: 76 Basic stats: COMPLETE Column stats: COMPLETE
                  value expressions: _col0 (type: struct&amp;lt;writeid:bigint,bucketid:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,rowid:bigint&amp;gt;)
        Reducer 3 
            Execution mode: vectorized, llap
            Reduce Operator Tree:
              Select Operator
                expressions: VALUE._col0 (type: struct&amp;lt;writeid:bigint,bucketid:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,rowid:bigint&amp;gt;)
                outputColumnNames: _col0
                Statistics: Num rows: 1 Data size: 76 Basic stats: COMPLETE Column stats: COMPLETE
                File Output Operator
                  compressed: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
                  Statistics: Num rows: 1 Data size: 76 Basic stats: COMPLETE Column stats: COMPLETE
                  table:
                      input format: org.apache.hadoop.hive.ql.io.orc.OrcInputFormat
                      output format: org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat
                      serde: org.apache.hadoop.hive.ql.io.orc.OrcSerde
                      name: &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.t1
                  Write Type: DELETE

  Stage: Stage-2
    Dependency Collection

  Stage: Stage-0
    Move Operator
      tables:
          replace: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
          table:
              input format: org.apache.hadoop.hive.ql.io.orc.OrcInputFormat
              output format: org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat
              serde: org.apache.hadoop.hive.ql.io.orc.OrcSerde
              name: &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.t1
          Write Type: DELETE

  Stage: Stage-3
    Stats Work
      Basic Stats Work:
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Normally reduce sink deduplication optimization merges these Reduce Sink operators. This jira tries to cover the case when this optimization is turned off.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13544663">HIVE-27527</key>
            <summary>Order of records is not ensured in delete delta files when reduce deduplication is off</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kkasa">Krisztian Kasa</assignee>
                                    <reporter username="kkasa">Krisztian Kasa</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 24 Jul 2023 13:43:26 +0000</created>
                <updated>Thu, 27 Jul 2023 16:31:58 +0000</updated>
                            <resolved>Thu, 27 Jul 2023 16:31:58 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17748251" author="kkasa" created="Thu, 27 Jul 2023 16:31:58 +0000"  >&lt;p&gt;Merged to master. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dkuzmenko&quot; class=&quot;user-hover&quot; rel=&quot;dkuzmenko&quot;&gt;dkuzmenko&lt;/a&gt; for review.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 15 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1jc7c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>