<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:06:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-3179] HBase Handler doesn&apos;t handle NULLs properly</title>
                <link>https://issues.apache.org/jira/browse/HIVE-3179</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;We found a quite severe issue in the HBase Handler which actually means that Hive potentially returns incorrect data if a column has NULL values in HBase (which means the cell doesn&apos;t even exist)&lt;/p&gt;

&lt;p&gt;In HBase Shell:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;create &apos;hive_hbase_test&apos;, &apos;test&apos;
put &apos;hive_hbase_test&apos;, &apos;1&apos;, &apos;test:c1&apos;, &apos;c1-1&apos;
put &apos;hive_hbase_test&apos;, &apos;1&apos;, &apos;test:c2&apos;, &apos;c2-1&apos;
put &apos;hive_hbase_test&apos;, &apos;1&apos;, &apos;test:c3&apos;, &apos;c3-1&apos;
put &apos;hive_hbase_test&apos;, &apos;2&apos;, &apos;test:c1&apos;, &apos;c1-2&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In Hive:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;DROP TABLE IF EXISTS hive_hbase_test;
CREATE EXTERNAL TABLE hive_hbase_test (
  id int,
  c1 string,
  c2 string,
  c3 string
)
STORED BY &apos;org.apache.hadoop.hive.hbase.HBaseStorageHandler&apos;
WITH SERDEPROPERTIES (&quot;hbase.columns.mapping&quot; =
&quot;:key#s,test:c1#s,test:c2#s,test:c3#s&quot;)
TBLPROPERTIES(&quot;hbase.table.name&quot; = &quot;hive_hbase_test&quot;);

hive&amp;gt; select * from hive_hbase_test;
OK
1	c1-1	c2-1	c3-1
2	c1-2	NULL	NULL

hive&amp;gt; select c1 from hive_hbase_test;
c1-1
c1-2

hive&amp;gt; select c1, c2 from hive_hbase_test;
c1-1	c2-1
c1-2	NULL
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So far everything is correct but now:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hive&amp;gt; select c1, c2, c2 from hive_hbase_test;
c1-1	c2-1	c2-1
c1-2	NULL	c2-1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Selecting c2 twice works the first time but the second time we&lt;br/&gt;
actually get the value from the previous row.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hive&amp;gt; select c1, c3, c2, c2, c3, c3, c1 from hive_hbase_test;
c1-1	c3-1	c2-1	c2-1	c3-1	c3-1	c1-1
c1-2	NULL	NULL	c2-1	c3-1	c3-1	c1-2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We&apos;ve narrowed this down to an early initialization of &lt;tt&gt;fieldsInited[fieldID] = true&lt;/tt&gt; in &lt;tt&gt;LazyHBaseRow#uncheckedGetField&lt;/tt&gt; and we&apos;ll try to provide a patch which surely needs review.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12595575">HIVE-3179</key>
            <summary>HBase Handler doesn&apos;t handle NULLs properly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="larsfrancke">Lars Francke</assignee>
                                    <reporter username="larsfrancke">Lars Francke</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Jun 2012 12:25:47 +0000</created>
                <updated>Thu, 16 May 2013 21:10:47 +0000</updated>
                            <resolved>Mon, 15 Apr 2013 07:10:44 +0000</resolved>
                                    <version>0.9.0</version>
                    <version>0.10.0</version>
                                    <fixVersion>0.11.0</fixVersion>
                                    <component>HBase Handler</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="13399319" author="lars_francke" created="Fri, 22 Jun 2012 13:54:07 +0000"  >&lt;p&gt;The attached patch fixes the problem as well as changes a unit test that actually tests this behavior. The unit test fails if our fix to &lt;tt&gt;LazyHBaseRow&lt;/tt&gt; is not applied.&lt;/p&gt;

&lt;p&gt;We&apos;re not sure if this is the best way to fix this problem as it circumvents the optimization being done by the fieldsInited field. Ideally instead of returning null on an empty HBase cell this would insert some kind of marker but adding an empty ByteArrayRef is not interpreted as NULL but as an empty value (which makes sense).&lt;/p&gt;

&lt;p&gt;In short: This fixes the bug at the cost of some performance for NULL (non-existing) fields in HBase.&lt;/p&gt;</comment>
                            <comment id="13399322" author="lars_francke" created="Fri, 22 Jun 2012 14:01:37 +0000"  >&lt;p&gt;We could add a second boolean array to go with &lt;tt&gt;fieldsInited&lt;/tt&gt; that&apos;s called &lt;tt&gt;fieldsNull&lt;/tt&gt; that caches those fields. Not sure if that&apos;s needed though.&lt;/p&gt;

&lt;p&gt;Thanks to my colleague Oliver Meyn who actually looked at the code and found the fix, I only packaged it up and added the unit test.&lt;/p&gt;
</comment>
                            <comment id="13400269" author="cwsteinbach" created="Mon, 25 Jun 2012 03:36:09 +0000"  >&lt;p&gt;@Lars: Please post a review request on reviews.apache.org. Thanks.&lt;/p&gt;</comment>
                            <comment id="13400289" author="lars_francke" created="Mon, 25 Jun 2012 05:36:09 +0000"  >&lt;p&gt;@Carl: Sure: &lt;a href=&quot;https://reviews.apache.org/r/5542/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/5542/&lt;/a&gt; thanks for the reminder.&lt;/p&gt;</comment>
                            <comment id="13572282" author="lars_francke" created="Wed, 6 Feb 2013 09:24:42 +0000"  >&lt;p&gt;As far as I can tell this is still an issue. Would anyone mind doing a review on this one?&lt;/p&gt;</comment>
                            <comment id="13573987" author="brocknoland" created="Thu, 7 Feb 2013 22:11:34 +0000"  >&lt;p&gt;I have verified this is an issue with trunk, the patch applies, and the patch addresses the issue.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hive&amp;gt; select c1, c3, c2, c2, c3, c3, c1 from hive_hbase_test;
Total MapReduce jobs = 1
Launching Job 1 out of 1
Number of reduce tasks is set to 0 since there&apos;s no reduce operator
Starting Job = job_201302071609_0002, Tracking URL = http://localhost:50030/jobdetails.jsp?jobid=job_201302071609_0002
Kill Command = /opt/local/hadoop-1.1.1/libexec/../bin/hadoop job  -kill job_201302071609_0002
Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 0
2013-02-07 16:10:31,826 Stage-1 map = 0%,  reduce = 0%
2013-02-07 16:10:34,846 Stage-1 map = 100%,  reduce = 0%
2013-02-07 16:10:36,861 Stage-1 map = 100%,  reduce = 100%
Ended Job = job_201302071609_0002
MapReduce Jobs Launched: 
Job 0: Map: 1   HDFS Read: 260 HDFS Write: 60 SUCCESS
Total MapReduce CPU Time Spent: 0 msec
OK
c1-1	c3-1	c2-1	c2-1	c3-1	c3-1	c1-1
c1-2	NULL	NULL	NULL	NULL	NULL	c1-2
Time taken: 10.702 seconds, Fetched: 2 row(s)
hive&amp;gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13573991" author="shreepadma" created="Thu, 7 Feb 2013 22:22:02 +0000"  >&lt;p&gt;+1.&lt;/p&gt;</comment>
                            <comment id="13574553" author="mgrover" created="Fri, 8 Feb 2013 15:35:15 +0000"  >&lt;p&gt;Running TestHBaseCliDriver tests...&lt;/p&gt;</comment>
                            <comment id="13575232" author="brocknoland" created="Sat, 9 Feb 2013 19:02:43 +0000"  >&lt;p&gt;Mark,&lt;/p&gt;

&lt;p&gt;How did the tests turn out?&lt;/p&gt;</comment>
                            <comment id="13575246" author="mgrover" created="Sat, 9 Feb 2013 19:48:24 +0000"  >&lt;p&gt;They timed out on my pseudo-distributed laptop but that most likely is an environment issue local to me. But looks like Lars mentioned that he had run the tests, so that should be ok.&lt;/p&gt;

&lt;p&gt;I will try to fix the environment, but don&apos;t wait on me.&lt;/p&gt;</comment>
                            <comment id="13575863" author="brocknoland" created="Mon, 11 Feb 2013 16:10:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cwsteinbach&quot; class=&quot;user-hover&quot; rel=&quot;cwsteinbach&quot;&gt;cwsteinbach&lt;/a&gt; do you have time to look at this patch?&lt;/p&gt;</comment>
                            <comment id="13631546" author="navis" created="Mon, 15 Apr 2013 07:10:45 +0000"  >&lt;p&gt;Passed all tests and committed to trunk. Thanks Lars.&lt;/p&gt;</comment>
                            <comment id="13631832" author="hudson" created="Mon, 15 Apr 2013 16:29:57 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #160 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/160/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/160/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3179&quot; title=&quot;HBase Handler doesn&amp;#39;t handle NULLs properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3179&quot;&gt;&lt;del&gt;HIVE-3179&lt;/del&gt;&lt;/a&gt; HBase Handler doesn&apos;t handle NULLs properly (Lars Francke via Navis) (Revision 1467874)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
navis : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1467874&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1467874&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/hbase-handler/src/java/org/apache/hadoop/hive/hbase/LazyHBaseRow.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/hbase-handler/src/test/org/apache/hadoop/hive/hbase/TestLazyHBaseObject.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13632134" author="hudson" created="Mon, 15 Apr 2013 20:27:04 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #2065 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/2065/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/2065/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3179&quot; title=&quot;HBase Handler doesn&amp;#39;t handle NULLs properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3179&quot;&gt;&lt;del&gt;HIVE-3179&lt;/del&gt;&lt;/a&gt; HBase Handler doesn&apos;t handle NULLs properly (Lars Francke via Navis) (Revision 1467874)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
navis : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1467874&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1467874&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/hbase-handler/src/java/org/apache/hadoop/hive/hbase/LazyHBaseRow.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/hbase-handler/src/test/org/apache/hadoop/hive/hbase/TestLazyHBaseObject.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12633563">HIVE-4057</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12533045" name="HIVE-3179.1.patch" size="2204" author="larsfrancke" created="Fri, 22 Jun 2012 13:54:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>240713</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 32 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i014v3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4557</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>