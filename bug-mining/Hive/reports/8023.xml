<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:20:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-25307] Hive Server 2 crashes when Thrift library encounters particular security protocol issue</title>
                <link>https://issues.apache.org/jira/browse/HIVE-25307</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;A RuntimeException is thrown by the Thrift library that causes Hive Server 2 to crash on our customer&apos;s machine. If you Google this the exception has been reported a couple of times over the years but not fixed. A blog (see references below) says it is an occasional security protocol issue between Hive Server 2 and a proxy like a Gateway.&lt;/p&gt;

&lt;p&gt;One challenge in the older 0.9.3 Thrift version was the Thrift TTransportFactory getTransport method declaration had throws no Exceptions. Hence the likely choice of RuntimeException. But that Exception is fatal to Hive Server 2.&lt;/p&gt;

&lt;p&gt;The proposed fix is a work around is we catch RuntimeException in the inner class TUGIAssumingTransportFactory of the&#160;HadoopThriftAuthBridge class in Hive Server 2.&#160; And throw a throw the RuntimeException&apos;s (inner) cause (e.g.&#160;TSaslTransportException) as a TTransportException.&lt;/p&gt;

&lt;p&gt;Once the Thrift library stops throwing RuntimeException or we catch fatal Throwable exceptions in the Thrift library&apos;s TThreadPoolServer&apos;s inner class WorkerProcess run method and display them, the RuntimeException try/catch clause can be removed.&lt;/p&gt;

&lt;p&gt;ExceptionClassName:&lt;br/&gt;
 java.lang.RuntimeException&lt;br/&gt;
 ExceptionStackTrace:&lt;br/&gt;
 java.lang.RuntimeException: org.apache.thrift.transport.TSaslTransportException: No data or no sasl data in the stream&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.thrift.transport.TSaslServerTransport$Factory.getTransport(TSaslServerTransport.java:219)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.hadoop.hive.metastore.security.HadoopThriftAuthBridge$Server$TUGIAssumingTransportFactory$1.run(HadoopThriftAuthBridge.java:694)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.hadoop.hive.metastore.security.HadoopThriftAuthBridge$Server$TUGIAssumingTransportFactory$1.run(HadoopThriftAuthBridge.java:691)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at java.security.AccessController.doPrivileged(Native Method)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at javax.security.auth.Subject.doAs(Subject.java:360)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1710)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.hadoop.hive.metastore.security.HadoopThriftAuthBridge$Server$TUGIAssumingTransportFactory.getTransport(HadoopThriftAuthBridge.java:691)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:269)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at java.lang.Thread.run(Thread.java:748)&lt;/p&gt;

&lt;p&gt;Caused by: org.apache.thrift.transport.TSaslTransportException: No data or no sasl data in the stream&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.thrift.transport.TSaslTransport.open(TSaslTransport.java:326)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.thrift.transport.TSaslServerTransport.open(TSaslServerTransport.java:41)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.thrift.transport.TSaslServerTransport$Factory.getTransport(TSaslServerTransport.java:216)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;... 10 more&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;References:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://community.cloudera.com/t5/Support-Questions/Hive-server-2-thrift-error/td-p/34293&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Hive server 2 thrift error - Cloudera Community - 34293&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Eric Lin blog &quot;&#8220;NO DATA OR NO SASL DATA IN THE STREAM&#8221; ERROR IN HIVESERVER2 LOG&quot;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-12754&quot; title=&quot;AuthTypes.NONE cause exception after HS2 start&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-12754&quot;&gt;HIVE-12754&lt;/a&gt; AuthTypes.NONE cause exception after HS2 start - ASF JIRA (apache.org)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13387813">HIVE-25307</key>
            <summary>Hive Server 2 crashes when Thrift library encounters particular security protocol issue</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mattmccline">Matt McCline</assignee>
                                    <reporter username="mattmccline">Matt McCline</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 6 Jul 2021 01:48:43 +0000</created>
                <updated>Thu, 17 Nov 2022 08:48:18 +0000</updated>
                            <resolved>Mon, 26 Jul 2021 04:29:27 +0000</resolved>
                                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                                    <component>HiveServer2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="17375104" author="mattmccline" created="Tue, 6 Jul 2021 01:52:42 +0000"  >&lt;p&gt;Work-in-progress patch attached. Next step: create a pull request. FYI: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashish-kumar-sharma&quot; class=&quot;user-hover&quot; rel=&quot;ashish-kumar-sharma&quot;&gt;ashish-kumar-sharma&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sankarh&quot; class=&quot;user-hover&quot; rel=&quot;sankarh&quot;&gt;sankarh&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17387037" author="sankarh" created="Mon, 26 Jul 2021 04:29:27 +0000"  >&lt;p&gt;Merged to master. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mattmccline&quot; class=&quot;user-hover&quot; rel=&quot;mattmccline&quot;&gt;mattmccline&lt;/a&gt; for the patch!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13030854" name="hive-thrift-fix2-03-3_1.patch" size="16532" author="mattmccline" created="Mon, 19 Jul 2021 22:38:44 +0000"/>
                            <attachment id="13030855" name="hive-thrift-fix2-04-3_1.patch" size="16536" author="mattmccline" created="Tue, 20 Jul 2021 00:04:32 +0000"/>
                            <attachment id="13030935" name="hive-thrift-fix2-05-3_1.patch" size="16569" author="mattmccline" created="Wed, 21 Jul 2021 22:12:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 16 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0smug:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>