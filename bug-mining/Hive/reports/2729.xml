<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:25:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-8292] Reading from partitioned bucketed tables has high overhead in MapOperator.cleanUpInputFileChangedOp</title>
                <link>https://issues.apache.org/jira/browse/HIVE-8292</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Reading from bucketed partitioned tables has significantly higher overhead compared to non-bucketed non-partitioned files.&lt;/p&gt;


&lt;p&gt;50% of the profile is spent in MapOperator.cleanUpInputFileChangedOp&lt;/p&gt;

&lt;p&gt;5% the CPU in &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; Path onepath = normalizePath(onefile);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And &lt;br/&gt;
45% the CPU in &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; onepath.toUri().relativize(fpath.toUri()).equals(fpath.toUri());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From the profiler &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Stack Trace	Sample Count	Percentage(%)
hive.ql.exec.tez.MapRecordSource.processRow(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)	5,327	62.348
   hive.ql.exec.vector.VectorMapOperator.process(Writable)	5,326	62.336
      hive.ql.exec.Operator.cleanUpInputFileChanged()	4,851	56.777
         hive.ql.exec.MapOperator.cleanUpInputFileChangedOp()	4,849	56.753
                                 java.net.URI.relativize(URI)	3,903	45.681
                                    java.net.URI.relativize(URI, URI)	3,903	45.681
                                       java.net.URI.normalize(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)	2,169	25.386
                                       java.net.URI.equal(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)	526	6.156
                                       java.net.URI.equalIgnoringCase(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)	1	0.012
                                       java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.substring(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)	1	0.012
            hive.ql.exec.MapOperator.normalizePath(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)	506	5.922
            org.apache.commons.logging.impl.Log4JLogger.info(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)	32	0.375
                                 java.net.URI.equals(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)	12	0.14
                                 java.util.HashMap$KeySet.iterator()	5	0.059
                                 java.util.HashMap.get(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)	4	0.047
                                 java.util.LinkedHashMap.get(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)	3	0.035
         hive.ql.exec.Operator.cleanUpInputFileChanged()	1	0.012
      hive.ql.exec.Operator.forward(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;, ObjectInspector)	473	5.536
      hive.ql.exec.mr.ExecMapperContext.inputFileChanged()	1	0.012
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;cn105&lt;/p&gt;</environment>
        <key id="12744750">HIVE-8292</key>
            <summary>Reading from partitioned bucketed tables has high overhead in MapOperator.cleanUpInputFileChangedOp</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gopalv">Gopal Vijayaraghavan</assignee>
                                    <reporter username="mmokhtar">Mostafa Mokhtar</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Sep 2014 18:52:35 +0000</created>
                <updated>Thu, 13 Nov 2014 19:40:03 +0000</updated>
                            <resolved>Mon, 13 Oct 2014 21:37:20 +0000</resolved>
                                    <version>0.14.0</version>
                                    <fixVersion>0.14.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14152060" author="mmokhtar" created="Mon, 29 Sep 2014 18:53:45 +0000"  >&lt;p&gt;Hot function profile&lt;/p&gt;</comment>
                            <comment id="14158966" author="gopalv" created="Sat, 4 Oct 2014 05:19:22 +0000"  >&lt;p&gt;Traced it down to&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  @Override
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; pushRecord() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; HiveException {
    execContext.resetRow(); &amp;lt;-- resets input checks
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is why the cleanup input is being called once per row.&lt;/p&gt;</comment>
                            <comment id="14159293" author="gopalv" created="Sat, 4 Oct 2014 21:30:05 +0000"  >&lt;p&gt;Worse, I printed out the identity hashcode of the ExecMapperContext there.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;resetRow: (1043064988) &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; update to &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
isInputChanged: (773110290) &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; != hdfs:&lt;span class=&quot;code-comment&quot;&gt;//sandbox03.hortonworks.com:8020/user/hive/external/tpch-100/region/data-m-00099.snappy&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Looks like the resetRow and isInputChanged are going to different objects, which is obviously broken.&lt;/p&gt;

&lt;p&gt;There&apos;s a good possibility IOContext doesn&apos;t work correctly when the reader threads are running parallel with the processor threads.&lt;/p&gt;</comment>
                            <comment id="14159815" author="mmokhtar" created="Mon, 6 Oct 2014 02:47:00 +0000"  >&lt;p&gt;Looks like a regression introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-7482&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-7482&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14160682" author="mmokhtar" created="Mon, 6 Oct 2014 18:44:35 +0000"  >&lt;p&gt;This patch addresses the regression but doesn&apos;t handle multiple inputs for SMB join.&lt;/p&gt;</comment>
                            <comment id="14160683" author="mmokhtar" created="Mon, 6 Oct 2014 18:45:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vikram.dixit&quot; class=&quot;user-hover&quot; rel=&quot;vikram.dixit&quot;&gt;vikram.dixit&lt;/a&gt;&lt;br/&gt;
Patch which addresses the regression attached.&lt;/p&gt;</comment>
                            <comment id="14160729" author="gopalv" created="Mon, 6 Oct 2014 19:06:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mmokhtar&quot; class=&quot;user-hover&quot; rel=&quot;mmokhtar&quot;&gt;mmokhtar&lt;/a&gt;: Probably better to just read exec context off mapOp.getExecContext().&lt;/p&gt;</comment>
                            <comment id="14164223" author="gopalv" created="Wed, 8 Oct 2014 21:42:43 +0000"  >&lt;p&gt;The approach is similar to the other patch, but the IOContext is more complex to deal with in case of SMB Joins.&lt;/p&gt;</comment>
                            <comment id="14166941" author="hiveqa" created="Fri, 10 Oct 2014 15:00:51 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12673717/HIVE-8292.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12673717/HIVE-8292.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 4119 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1197/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1197/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1197/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1197/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-1197/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-1197/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12673717&lt;/p&gt;</comment>
                            <comment id="14167363" author="vikram.dixit" created="Fri, 10 Oct 2014 19:32:07 +0000"  >&lt;p&gt;LGTM +1. +1 for 0.14 as well.&lt;/p&gt;</comment>
                            <comment id="14170036" author="gopalv" created="Mon, 13 Oct 2014 21:37:20 +0000"  >&lt;p&gt;Committed to trunk and branch, thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vikram.dixit&quot; class=&quot;user-hover&quot; rel=&quot;vikram.dixit&quot;&gt;vikram.dixit&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="14210289" author="thejas" created="Thu, 13 Nov 2014 19:40:03 +0000"  >&lt;p&gt;This has been fixed in 0.14 release. Please open new jira if you see any issues.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12671842" name="2014_09_29_14_46_04.jfr" size="3334882" author="mmokhtar" created="Mon, 29 Sep 2014 18:53:45 +0000"/>
                            <attachment id="12673155" name="HIVE-8292.1.patch" size="2505" author="mmokhtar" created="Mon, 6 Oct 2014 18:44:35 +0000"/>
                            <attachment id="12673717" name="HIVE-8292.2.patch" size="623" author="gopalv" created="Wed, 8 Oct 2014 21:41:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20lmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-8292&quot; title=&quot;Reading from partitioned bucketed tables has high overhead in MapOperator.cleanUpInputFileChangedOp&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-8292&quot;&gt;&lt;strike&gt;HIVE-8292&lt;/strike&gt;&lt;/a&gt;: MapRecordSource should obtain its ExecContext from a MapOperator (Gopal V, reviewed by Vikram Dixit)</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>