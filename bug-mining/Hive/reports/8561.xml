<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:24:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-24606] Multi-stage materialized CTEs can lose intermediate data</title>
                <link>https://issues.apache.org/jira/browse/HIVE-24606</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;With complex multi-stage CTEs, Hive can start a latter stage before its previous stage finishes.&lt;br/&gt;
 That&apos;s because `SemanticAnalyzer#toRealRootTasks` can fail to resolve dependency between multistage materialized CTEs when a non-materialized CTE cuts in.&lt;br/&gt;
 &lt;a href=&quot;https://github.com/apache/hive/blob/425e1ff7c054f87c4db87e77d004282d529599ae/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java#L1414&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/blob/425e1ff7c054f87c4db87e77d004282d529599ae/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java#L1414&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;For example, when submitting this query,&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;SET&lt;/span&gt; hive.&lt;span class=&quot;code-keyword&quot;&gt;optimize&lt;/span&gt;.cte.materialize.threshold=2;
&lt;span class=&quot;code-keyword&quot;&gt;SET&lt;/span&gt; hive.&lt;span class=&quot;code-keyword&quot;&gt;optimize&lt;/span&gt;.cte.materialize.&lt;span class=&quot;code-keyword&quot;&gt;full&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;aggregate&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;only&lt;/span&gt;=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;

&lt;span class=&quot;code-keyword&quot;&gt;WITH&lt;/span&gt; x &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; ( &lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;x&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; id ), &lt;span class=&quot;code-comment&quot;&gt;-- &lt;span class=&quot;code-keyword&quot;&gt;not&lt;/span&gt; materialized
&lt;/span&gt;a1 &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; ( &lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;a1&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; id ), &lt;span class=&quot;code-comment&quot;&gt;-- materialized &lt;span class=&quot;code-keyword&quot;&gt;by&lt;/span&gt; a2 &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; the root
&lt;/span&gt;a2 &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; ( &lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;a2 &amp;lt;- &apos;&lt;/span&gt; || id &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; id &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; a1) &lt;span class=&quot;code-comment&quot;&gt;-- materialized &lt;span class=&quot;code-keyword&quot;&gt;by&lt;/span&gt; the root
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; * &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; a1
&lt;span class=&quot;code-keyword&quot;&gt;UNION&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;ALL&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; * &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; x
&lt;span class=&quot;code-keyword&quot;&gt;UNION&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;ALL&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; * &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; a2
&lt;span class=&quot;code-keyword&quot;&gt;UNION&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;ALL&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; * &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; a2;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;`toRealRootTask` will traverse the CTEs in order of `a1`, `x`, and `a2`. It means the dependency between `a1` and `a2` will be ignored and `a2` can start without waiting for `a1`. As a result, the above query returns the following result.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+-----+
| id  |
+-----+
| a1  |
| x   |
+-----+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;For your information, I ran this test with revision = 425e1ff7c054f87c4db87e77d004282d529599ae.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13351093">HIVE-24606</key>
            <summary>Multi-stage materialized CTEs can lose intermediate data</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="okumin">Shohei Okumiya</assignee>
                                    <reporter username="okumin">Shohei Okumiya</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 8 Jan 2021 13:50:55 +0000</created>
                <updated>Fri, 29 Mar 2024 17:50:01 +0000</updated>
                            <resolved>Fri, 15 Sep 2023 09:19:46 +0000</resolved>
                                    <version>2.3.7</version>
                    <version>3.1.2</version>
                    <version>4.0.0</version>
                                    <fixVersion>4.0.0</fixVersion>
                                    <component>Query Planning</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="17266507" author="okumin" created="Sat, 16 Jan 2021 05:40:16 +0000"  >&lt;p&gt;CI has passed. This PR would require review by a SemanticAnalyzer expert.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hive/pull/1873&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/pull/1873&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17765521" author="kkasa" created="Fri, 15 Sep 2023 09:19:46 +0000"  >&lt;p&gt;Merged &lt;a href=&quot;https://github.com/apache/hive/pull/4363&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4363&lt;/a&gt; to master. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=okumin&quot; class=&quot;user-hover&quot; rel=&quot;okumin&quot;&gt;okumin&lt;/a&gt; for the patch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 8 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0mdzc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>