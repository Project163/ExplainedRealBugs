<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:20:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-24902] Incorrect result after fold CASE into COALESCE</title>
                <link>https://issues.apache.org/jira/browse/HIVE-24902</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The following sql returns only one record (20210308) but expected two(20210308&lt;br/&gt;
20210309).&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; * &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; (
&lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; 
	&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;when&lt;/span&gt; b.&lt;span class=&quot;code-keyword&quot;&gt;a&lt;/span&gt;=1
		&lt;span class=&quot;code-keyword&quot;&gt;then&lt;/span&gt;  
			&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; (from_unixtime(unix_timestamp(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(20210309 &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;string&lt;/span&gt;),&lt;span class=&quot;code-quote&quot;&gt;&apos;yyyyMMdd&apos;&lt;/span&gt;) - 86400,&lt;span class=&quot;code-quote&quot;&gt;&apos;yyyyMMdd&apos;&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;bigint&lt;/span&gt;)
		&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; 
			20210309 
	   &lt;span class=&quot;code-keyword&quot;&gt;end&lt;/span&gt; 
&lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; col
&lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; 
(&lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; stack(2,1,2) &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;a&lt;/span&gt;))
 &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; b
) t 
&lt;span class=&quot;code-keyword&quot;&gt;where&lt;/span&gt; t.col &lt;span class=&quot;code-keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The query plan has incorrect predict: &lt;br/&gt;
 predicate: COALESCE((col0 = 1),false) (type: boolean)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
STAGE DEPENDENCIES:
  Stage-0 &lt;span class=&quot;code-keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;a&lt;/span&gt; root stage

STAGE PLANS:
  Stage: Stage-0
    &lt;span class=&quot;code-keyword&quot;&gt;Fetch&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;Operator&lt;/span&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;limit&lt;/span&gt;: -1
      Processor Tree:
        TableScan
          &lt;span class=&quot;code-keyword&quot;&gt;alias&lt;/span&gt;: _dummy_table
          &lt;span class=&quot;code-keyword&quot;&gt;Row&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;Limit&lt;/span&gt; Per Split: 1
          &lt;span class=&quot;code-keyword&quot;&gt;Statistics&lt;/span&gt;: Num &lt;span class=&quot;code-keyword&quot;&gt;rows&lt;/span&gt;: 1 &lt;span class=&quot;code-keyword&quot;&gt;Data&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;size&lt;/span&gt;: 10 Basic stats: COMPLETE &lt;span class=&quot;code-keyword&quot;&gt;Column&lt;/span&gt; stats: COMPLETE
          &lt;span class=&quot;code-keyword&quot;&gt;Select&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;Operator&lt;/span&gt;
            expressions: 2 (&lt;span class=&quot;code-keyword&quot;&gt;type&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;int&lt;/span&gt;), 1 (&lt;span class=&quot;code-keyword&quot;&gt;type&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;int&lt;/span&gt;), 2 (&lt;span class=&quot;code-keyword&quot;&gt;type&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;int&lt;/span&gt;)
            outputColumnNames: _col0, _col1, _col2
            &lt;span class=&quot;code-keyword&quot;&gt;Statistics&lt;/span&gt;: Num &lt;span class=&quot;code-keyword&quot;&gt;rows&lt;/span&gt;: 1 &lt;span class=&quot;code-keyword&quot;&gt;Data&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;size&lt;/span&gt;: 12 Basic stats: COMPLETE &lt;span class=&quot;code-keyword&quot;&gt;Column&lt;/span&gt; stats: COMPLETE
            UDTF &lt;span class=&quot;code-keyword&quot;&gt;Operator&lt;/span&gt;
              &lt;span class=&quot;code-keyword&quot;&gt;Statistics&lt;/span&gt;: Num &lt;span class=&quot;code-keyword&quot;&gt;rows&lt;/span&gt;: 1 &lt;span class=&quot;code-keyword&quot;&gt;Data&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;size&lt;/span&gt;: 12 Basic stats: COMPLETE &lt;span class=&quot;code-keyword&quot;&gt;Column&lt;/span&gt; stats: COMPLETE
              &lt;span class=&quot;code-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;name&lt;/span&gt;: stack
              &lt;span class=&quot;code-keyword&quot;&gt;Filter&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;Operator&lt;/span&gt;
                predicate: &lt;span class=&quot;code-keyword&quot;&gt;COALESCE&lt;/span&gt;((col0 = 1),&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;) (&lt;span class=&quot;code-keyword&quot;&gt;type&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;boolean&lt;/span&gt;)
                &lt;span class=&quot;code-keyword&quot;&gt;Statistics&lt;/span&gt;: Num &lt;span class=&quot;code-keyword&quot;&gt;rows&lt;/span&gt;: 1 &lt;span class=&quot;code-keyword&quot;&gt;Data&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;size&lt;/span&gt;: 12 Basic stats: COMPLETE &lt;span class=&quot;code-keyword&quot;&gt;Column&lt;/span&gt; stats: COMPLETE
                &lt;span class=&quot;code-keyword&quot;&gt;Select&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;Operator&lt;/span&gt;
                  expressions: &lt;span class=&quot;code-keyword&quot;&gt;CASE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;WHEN&lt;/span&gt; ((col0 = 1)) &lt;span class=&quot;code-keyword&quot;&gt;THEN&lt;/span&gt; (20210308L) &lt;span class=&quot;code-keyword&quot;&gt;ELSE&lt;/span&gt; (20210309L) &lt;span class=&quot;code-keyword&quot;&gt;END&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;type&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;bigint&lt;/span&gt;)
                  outputColumnNames: _col0
                  &lt;span class=&quot;code-keyword&quot;&gt;Statistics&lt;/span&gt;: Num &lt;span class=&quot;code-keyword&quot;&gt;rows&lt;/span&gt;: 1 &lt;span class=&quot;code-keyword&quot;&gt;Data&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;size&lt;/span&gt;: 8 Basic stats: COMPLETE &lt;span class=&quot;code-keyword&quot;&gt;Column&lt;/span&gt; stats: COMPLETE
                  ListSink

&lt;span class=&quot;code-keyword&quot;&gt;Time&lt;/span&gt; taken: 0.155 seconds, Fetched: 28 &lt;span class=&quot;code-keyword&quot;&gt;row&lt;/span&gt;(s)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13365987">HIVE-24902</key>
            <summary>Incorrect result after fold CASE into COALESCE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nemon">Nemon Lou</assignee>
                                    <reporter username="nemon">Nemon Lou</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 18 Mar 2021 04:03:33 +0000</created>
                <updated>Thu, 17 Nov 2022 08:48:09 +0000</updated>
                            <resolved>Fri, 6 Aug 2021 13:25:49 +0000</resolved>
                                    <version>3.1.2</version>
                    <version>4.0.0</version>
                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                                    <component>CBO</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="17303874" author="nemon" created="Thu, 18 Mar 2021 06:19:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=julianhyde&quot; class=&quot;user-hover&quot; rel=&quot;julianhyde&quot;&gt;julianhyde&lt;/a&gt; Would you mind taking a look? Calcite version is 1.21.0&lt;/p&gt;</comment>
                            <comment id="17304552" author="julianhyde" created="Fri, 19 Mar 2021 00:54:06 +0000"  >&lt;p&gt;Sorry, no.&lt;/p&gt;</comment>
                            <comment id="17304572" author="nemon" created="Fri, 19 Mar 2021 01:26:37 +0000"  >&lt;p&gt;Sorry if I offended you. And thanks for your response.&lt;br/&gt;
I&apos;m trying to figure out what cause this bug and calcite part is difficult for me now.I will dig more.&lt;br/&gt;
If it is a common issue , any help from the community is appreciated.&lt;/p&gt;</comment>
                            <comment id="17304780" author="nemon" created="Fri, 19 Mar 2021 09:53:58 +0000"  >&lt;p&gt;Here is the process how filter expression goes wrong:&lt;br/&gt;
Pre optimize(good):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;IS&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;NULL&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;CASE&lt;/span&gt;(=($0, 1), &lt;span class=&quot;code-keyword&quot;&gt;CAST&lt;/span&gt;(FROM_UNIXTIME(-(UNIX_TIMESTAMP(&lt;span class=&quot;code-keyword&quot;&gt;CAST&lt;/span&gt;(_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;20210309&apos;&lt;/span&gt;):&lt;span class=&quot;code-keyword&quot;&gt;VARCHAR&lt;/span&gt;(2147483647) &lt;span class=&quot;code-keyword&quot;&gt;CHARACTER&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;COLLATE&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;ISO-8859-1$en_US$&lt;span class=&quot;code-keyword&quot;&gt;primary&lt;/span&gt;&quot;&lt;/span&gt;, _UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;yyyyMMdd&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;CAST&lt;/span&gt;(86400):&lt;span class=&quot;code-keyword&quot;&gt;BIGINT&lt;/span&gt;), _UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;yyyyMMdd&apos;&lt;/span&gt;)):&lt;span class=&quot;code-keyword&quot;&gt;BIGINT&lt;/span&gt;, 20210309))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After pushes predicates into CASE(good):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;CASE&lt;/span&gt;(=($0, 1), &lt;span class=&quot;code-keyword&quot;&gt;IS&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;NULL&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;CAST&lt;/span&gt;(FROM_UNIXTIME(-(UNIX_TIMESTAMP(&lt;span class=&quot;code-keyword&quot;&gt;CAST&lt;/span&gt;(_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;20210309&apos;&lt;/span&gt;):&lt;span class=&quot;code-keyword&quot;&gt;VARCHAR&lt;/span&gt;(2147483647) &lt;span class=&quot;code-keyword&quot;&gt;CHARACTER&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;COLLATE&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;ISO-8859-1$en_US$&lt;span class=&quot;code-keyword&quot;&gt;primary&lt;/span&gt;&quot;&lt;/span&gt;, _UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;yyyyMMdd&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;CAST&lt;/span&gt;(86400):&lt;span class=&quot;code-keyword&quot;&gt;BIGINT&lt;/span&gt;), _UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;yyyyMMdd&apos;&lt;/span&gt;)):&lt;span class=&quot;code-keyword&quot;&gt;BIGINT&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After constants folding(good):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;CASE&lt;/span&gt;(=($0, 1), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After Rewrite CASE into COALESCE(bad):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;COALESCE&lt;/span&gt;(=($0, 1),&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The related code of COALESCE rewrite:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/hive/blob/master/ql/src/java/org/apache/hadoop/hive/ql/parse/type/TypeCheckProcFactory.java#L1079&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/blob/master/ql/src/java/org/apache/hadoop/hive/ql/parse/type/TypeCheckProcFactory.java#L1079&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17304810" author="kgyrtkirk" created="Fri, 19 Mar 2021 10:24:36 +0000"  >&lt;p&gt;the bug is in &lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/hive/blob/eed78dfdcb6dfc2de400397a60de12e6f62b96e2/ql/src/java/org/apache/hadoop/hive/ql/parse/type/TypeCheckProcFactory.java#L1080&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/blob/eed78dfdcb6dfc2de400397a60de12e6f62b96e2/ql/src/java/org/apache/hadoop/hive/ql/parse/type/TypeCheckProcFactory.java#L1080&lt;/a&gt;&lt;br/&gt;
because convertCASEIntoCOALESCEFuncCallExpr identifies all CASEs with booleans on both branches as valid candidates&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/hive/blob/eed78dfdcb6dfc2de400397a60de12e6f62b96e2/ql/src/java/org/apache/hadoop/hive/ql/parse/type/ExprNodeDescExprFactory.java#L811&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/blob/eed78dfdcb6dfc2de400397a60de12e6f62b96e2/ql/src/java/org/apache/hadoop/hive/ql/parse/type/ExprNodeDescExprFactory.java#L811&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;actually the whole case could be removed - but it was not done by calcite because it was not able to deduce that&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
is not &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ( &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; (from_unixtime(unix_timestamp(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(20210309 as string),&lt;span class=&quot;code-quote&quot;&gt;&apos;yyyyMMdd&apos;&lt;/span&gt;) - 86400,&lt;span class=&quot;code-quote&quot;&gt;&apos;yyyyMMdd&apos;&lt;/span&gt;) as bigint) ) 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;is essentially true (most likely because &lt;tt&gt;from_unixtime&lt;/tt&gt; and &lt;tt&gt;unix_timestamp&lt;/tt&gt; functions are opaque)&lt;/p&gt;
</comment>
                            <comment id="17304812" author="kgyrtkirk" created="Fri, 19 Mar 2021 10:27:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nemon&quot; class=&quot;user-hover&quot; rel=&quot;nemon&quot;&gt;nemon&lt;/a&gt; seems like we were debugging around the same time &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
I&apos;ll have to jump on something else anyway...so I&apos;ll leave it for you ; let me know if you need any help!&lt;/p&gt;</comment>
                            <comment id="17305966" author="nemon" created="Mon, 22 Mar 2021 08:03:23 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kgyrtkirk&quot; class=&quot;user-hover&quot; rel=&quot;kgyrtkirk&quot;&gt;kgyrtkirk&lt;/a&gt; &lt;br/&gt;
FYI, Hive 2.3.7 can remove the whole case by ProjectReduceExpressionsRule among others.&lt;br/&gt;
An example sql:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;create&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;table&lt;/span&gt; b(&lt;span class=&quot;code-keyword&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;int&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;insert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;into&lt;/span&gt; b &lt;span class=&quot;code-keyword&quot;&gt;values&lt;/span&gt; (1),(2);

&lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; * &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; (
&lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; 
	&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;when&lt;/span&gt; b.&lt;span class=&quot;code-keyword&quot;&gt;a&lt;/span&gt;=1
			&lt;span class=&quot;code-keyword&quot;&gt;then&lt;/span&gt;  
			&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; (from_unixtime(unix_timestamp(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(20210309 &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;string&lt;/span&gt;),&lt;span class=&quot;code-quote&quot;&gt;&apos;yyyyMMdd&apos;&lt;/span&gt;) - 86400,&lt;span class=&quot;code-quote&quot;&gt;&apos;yyyyMMdd&apos;&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;bigint&lt;/span&gt;)
			&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; 
			  20210309 
	   &lt;span class=&quot;code-keyword&quot;&gt;end&lt;/span&gt; 
&lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; col
&lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; 
b
) t 
&lt;span class=&quot;code-keyword&quot;&gt;where&lt;/span&gt; t.col &lt;span class=&quot;code-keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I can not tell why.&lt;/p&gt;

&lt;p&gt;A direct fix is by validating booleans on both branches during COALESCE rewrite.I will submit a PR following this proposal.&lt;/p&gt;</comment>
                            <comment id="17394759" author="kgyrtkirk" created="Fri, 6 Aug 2021 13:25:49 +0000"  >&lt;p&gt;merged into master. Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nemon&quot; class=&quot;user-hover&quot; rel=&quot;nemon&quot;&gt;nemon&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 14 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ox2g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>