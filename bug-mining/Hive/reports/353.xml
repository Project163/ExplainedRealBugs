<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:55:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-1184] Expression Not In Group By Key error is sometimes masked</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1184</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Depending on the order of expressions, the error message for a expression not in group key is not displayed; instead it is null.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;hive&amp;gt; select concat(value, concat(value)) from src group by concat(value);
FAILED: Error in semantic analysis: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;

hive&amp;gt; select concat(concat(value), value) from src group by concat(value);
FAILED: Error in semantic analysis: line 1:29 Expression Not In Group By Key value

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12456879">HIVE-1184</key>
            <summary>Expression Not In Group By Key error is sometimes masked</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pauly">Paul Yang</assignee>
                                    <reporter username="pauly">Paul Yang</reporter>
                        <labels>
                    </labels>
                <created>Sat, 20 Feb 2010 04:20:47 +0000</created>
                <updated>Sat, 17 Dec 2011 00:03:47 +0000</updated>
                            <resolved>Thu, 25 Feb 2010 08:40:17 +0000</resolved>
                                    <version>0.6.0</version>
                                    <fixVersion>0.6.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12837159" author="pauly" created="Tue, 23 Feb 2010 09:18:53 +0000"  >&lt;p&gt;The problem stems from DefaultExprProcessor:process(). During the AST walk, any error is cleared if a node matches a group by expression&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;...
      exprNodeDesc desc = TypeCheckProcFactory.processGByExpr(nd, procCtx);
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (desc != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        ctx.setError(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; desc;
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Clearing the error was probably an attempt to address the generation of false errors during the DFS walk of the AST. Consider the AST fragment from the query&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SELECT concat(src.key) FROM src GROUP BY concat(src.key)

        TOK_FUNCTION
            / \
           /   \
          /     \
     concat      .
                / \ 
               /   \
TOK_TABLE_OR_COL    key
         |
         |
        src
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;During the walk, process() will be called on src before TOK_FUNCTION. Because src is not a group by expression, an error will be set in ctx. However, when process() is called on TOK_FUNCTION, it matches the group by expression &apos;concat(src.key)&apos; and the error is cleared, producing the expected behavior.&lt;/p&gt;

&lt;p&gt;A problem arises with a query like&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;select concat(value, concat(value)) from src group by concat(value)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;as the AST is such that &apos;value&apos; (1st argument of outer concat) is processed before &apos;concat(value)&apos;. When process() acts on &apos;value&apos;, it sets an error because it is not a group by expression. But then the error is cleared when process() is called on &apos;concat(value)&apos;. The error should not really be cleared as it was generated outside of the group by expression.&lt;/p&gt;

&lt;p&gt;The proposed solution is to keep track of the ASTNode that generated the error and only clear the error when it was generated from a node within the group by expression.&lt;/p&gt;</comment>
                            <comment id="12837476" author="zshao" created="Tue, 23 Feb 2010 22:21:56 +0000"  >&lt;p&gt;The explanation looks good to me, but I am not convinced the solution will solve the problem.&lt;/p&gt;

&lt;p&gt;When processing &quot;concat(value, concat(value))&quot;. we will set &quot;error&quot; when processing the first &quot;value&quot;, then overwrite the &quot;error&quot; when processing the second &quot;value&quot;, correct?&lt;br/&gt;
I think the &quot;error&quot; should be part of the &quot;return value&quot; of the &quot;process&quot; function, instead of a global field in the &quot;context&quot;.&lt;/p&gt;

&lt;p&gt;Does that make sense?&lt;/p&gt;</comment>
                            <comment id="12838196" author="pauly" created="Thu, 25 Feb 2010 05:52:14 +0000"  >&lt;p&gt;From an offline conversation - the solution still works for cases like &quot;concat(value, concat(value))&quot; because the error is only set with the first &quot;value&quot; - node processors terminate early when the global error is set. &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Added better comments.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12838250" author="zshao" created="Thu, 25 Feb 2010 08:40:17 +0000"  >&lt;p&gt;Committed. Thanks Paul!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12436691" name="HIVE-1184.1.patch" size="6870" author="pauly" created="Tue, 23 Feb 2010 09:18:53 +0000"/>
                            <attachment id="12436951" name="HIVE-1184.2.patch" size="7920" author="pauly" created="Thu, 25 Feb 2010 05:52:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73046</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 39 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lduf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>122893</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>