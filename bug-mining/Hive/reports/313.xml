<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:55:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-976] test outputs should compare the file/directory for sampling </title>
                <link>https://issues.apache.org/jira/browse/HIVE-976</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Currently, all lines starting with file: are ignored.&lt;/p&gt;

&lt;p&gt;It means that&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;file:/Users/heyongqiang/Documents/workspace/Hive-Test/build/ql/test/data/warehouse/srcbucket/srcbucket0.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/Users/heyongqiang/Documents/workspace/Hive-Test/build/ql/test/data/warehouse/srcbucket/srcbucket0.txt&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;s&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;file:/Users/heyongqiang/Documents/workspace/Hive-Test/build/ql/test/data/warehouse/srcbucket&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/Users/heyongqiang/Documents/workspace/Hive-Test/build/ql/test/data/warehouse/srcbucket&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;s&amp;#93;&lt;/span&gt;&lt;/p&gt;


&lt;p&gt;are same - that is not good because it will hide some of the optimizations of sampling.&lt;br/&gt;
This should be changed to compare the last token.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12442895">HIVE-976</key>
            <summary>test outputs should compare the file/directory for sampling </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jvs">John Sichi</assignee>
                                    <reporter username="namit">Namit Jain</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Dec 2009 19:23:55 +0000</created>
                <updated>Sat, 17 Dec 2011 00:05:59 +0000</updated>
                            <resolved>Thu, 31 Dec 2009 16:05:17 +0000</resolved>
                                                    <fixVersion>0.5.0</fixVersion>
                                    <component>Testing Infrastructure</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12788273" author="zshao" created="Wed, 9 Dec 2009 19:55:22 +0000"  >&lt;p&gt;I am seeing sample6.q and sample7.q test failures due to this.&lt;br/&gt;
When running them by themselves, they are working correctly. But when running all tests together, they are failure because somehow they took the whole srcbucket as input while table sample should really take only srcbucket0.txt.&lt;/p&gt;</comment>
                            <comment id="12789088" author="pauly" created="Fri, 11 Dec 2009 03:05:03 +0000"  >&lt;p&gt;I&apos;m looking at sample7.q.out, which has the lines that are quoted in the description. As I understand it, the test should check lines of the form &apos;file:/[directory]/[file]&apos; and verify that the file part (or the last token) is the same as those in the reference test files. But aren&apos;t there lines in the test output that begin with &apos;file:/&apos; that should be ignored completely?&lt;/p&gt;

&lt;p&gt;Anyway, assuming that we can look at just the last token of lines that begin with &apos;file:/&apos;, it doesn&apos;t seem like there is a way to use only diff to handle this case. The man page for diff does not describe any useful options. I have two ideas &lt;/p&gt;

&lt;p&gt;1. Instead of using diff directly, write a script that uses diff + some additional logic to detect this condition. Probably will be a little slower.&lt;/p&gt;

&lt;p&gt;2. in mapredWork, add an additional function that would display the last token of the paths. Sort of an ugly idea, but would work with diff in the current form.&lt;/p&gt;</comment>
                            <comment id="12789132" author="namit" created="Fri, 11 Dec 2009 06:09:56 +0000"  >&lt;p&gt;I would go with 2. - tests take a long time anyway, slowing them down further will be difficult.&lt;/p&gt;</comment>
                            <comment id="12794975" author="jvs" created="Tue, 29 Dec 2009 00:34:57 +0000"  >&lt;p&gt;I have implemented 2 and am currently running through tests; will submit a patch with updated logs once they pass.&lt;/p&gt;

&lt;p&gt;I added a new derived attribute (normalExplain=false) &quot;base file name&quot; on partitionDesc, and since the whole point is to avoid filtering this information out, I think there will be a lot of log updates required as part of the patch (unless there&apos;s a way to make it selective for only tests that need it).&lt;/p&gt;</comment>
                            <comment id="12795422" author="jvs" created="Wed, 30 Dec 2009 20:06:01 +0000"  >&lt;p&gt;Code changes together with log updates, for review by Namit.  I had to add ORDER BY to a number of existing .q files due to non-determinism in the expected results.&lt;/p&gt;</comment>
                            <comment id="12795460" author="namit" created="Wed, 30 Dec 2009 21:56:39 +0000"  >&lt;p&gt;1. Make the new field in partitionDesc transient.&lt;br/&gt;
2. Are you getting diff in input40.q - if not, remove the order by - it will change the query plan and I think the test was added to run without a map-reduce job.&lt;br/&gt;
3. sample6.q - change the explain plan statement also along with the query in all cases.&lt;/p&gt;</comment>
                            <comment id="12795504" author="jvs" created="Thu, 31 Dec 2009 00:25:33 +0000"  >&lt;p&gt;Regarding input40.q:  yes, I get a diff because the results from this query come out in a different order:&lt;/p&gt;

&lt;p&gt;select * from tmp_insert_test_p where ds = &apos;2009-08-01&apos;;&lt;/p&gt;

&lt;p&gt;A big chunk of rows moves in the output.  Diff-based testing doesn&apos;t really work if it&apos;s not possible to add order by uniformly, does it?&lt;/p&gt;</comment>
                            <comment id="12795507" author="namit" created="Thu, 31 Dec 2009 00:44:46 +0000"  >&lt;p&gt;I agree -  feel free to add order by in input40.q&lt;/p&gt;</comment>
                            <comment id="12795519" author="jvs" created="Thu, 31 Dec 2009 02:37:48 +0000"  >&lt;p&gt;Here&apos;s the updated patch which addresses Namit&apos;s comments (1) and (3).&lt;/p&gt;</comment>
                            <comment id="12795550" author="namit" created="Thu, 31 Dec 2009 06:14:36 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;looks good - will commit if the tests pass&lt;/p&gt;</comment>
                            <comment id="12795609" author="namit" created="Thu, 31 Dec 2009 16:05:17 +0000"  >&lt;p&gt;Committed. Thanks John&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12429191" name="HIVE-976.2.patch" size="645420" author="jvs" created="Thu, 31 Dec 2009 02:37:48 +0000"/>
                            <attachment id="12429161" name="HIVE-976.patch" size="631859" author="jvs" created="Wed, 30 Dec 2009 20:06:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73180</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 47 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lcqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>122713</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>