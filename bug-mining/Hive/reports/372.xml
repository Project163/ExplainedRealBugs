<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:55:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-1253] Fix Date_sub and Date_add in case of daylight saving</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1253</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;date_sub(&apos;2010-03-15&apos;, 7) returns &apos;2010-03-07&apos;. This is because we have time shifts on 2010-03-14 for daylight saving time.&lt;/p&gt;

&lt;p&gt;Looking at ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDateSub.java, it is getting a calendar instance in UTC time zone.&lt;/p&gt;

&lt;p&gt;def calendar = Calendar.getInstance(TimeZone.getTimeZone(&quot;UTC&quot;));&lt;/p&gt;

&lt;p&gt;And use calendar.add() to substract 7 days, then conver the time to &apos;yyyy-MM-dd&apos; format.&lt;/p&gt;

&lt;p&gt;If it simply uses default timezone, the problem is solved: &quot;def calendar = Calendar.getInstance());&quot;&lt;/p&gt;

&lt;p&gt;When people use date_sub(&apos;2010-03-15&apos;, 7), I think they mean substract 7 days, instead of substracting 7*24 hours. So it should be an easy fix. The same changes should go to date_add and date_diff&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12459451">HIVE-1253</key>
            <summary>Fix Date_sub and Date_add in case of daylight saving</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="batalbot">Bryan Talbot</assignee>
                                    <reporter username="miwang">mingran wang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Mar 2010 23:00:14 +0000</created>
                <updated>Sat, 17 Dec 2011 00:04:03 +0000</updated>
                            <resolved>Thu, 1 Apr 2010 22:26:48 +0000</resolved>
                                                    <fixVersion>0.6.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12846669" author="miwang" created="Wed, 17 Mar 2010 23:30:26 +0000"  >&lt;p&gt;To get to the bottom of this, the formatter (SimpleDateFormat) interprets the time string as local time zone, when it sets the calendar, it is PDT time zone (7 hours difference from UTC), and when it substracts 7 days and convert back to formatter string, it converts UTC to PST (still the local time zone, but different time zone now, and 8 hours difference from UTC).&lt;/p&gt;

&lt;p&gt;For the purpose of this function, since it is doing simple date_sub function, there is no need to consider time zone at all, and all time zone should give the same result for this kind of computation. For this reason, using default time zone would be fine, and we have to use default time zone because formatter is using it.&lt;/p&gt;</comment>
                            <comment id="12847663" author="batalbot" created="Sat, 20 Mar 2010 00:11:05 +0000"  >&lt;p&gt;date_sub and date_add used both a Calendar and a SimpleDateFormat object; however, the UTC timezone was only set for the Calendar object.  This causes the computation to sometimes be incorrect when the date ranges cross daylight savings time changes.&lt;/p&gt;

&lt;p&gt;The patch removes specifying the UTC timezone for the Calendar object so that both Calendar and the SimpleDateFormat will use the default timezone.  This should allow the date math to be consistent with other potential date math functions as long as they all use the default timezone.&lt;/p&gt;

&lt;p&gt;If the user wishes to use a specific timezone that is not the system default, it can be set using the normal java ways (e.g. setting user.timezone, etc.).&lt;/p&gt;</comment>
                            <comment id="12847665" author="batalbot" created="Sat, 20 Mar 2010 00:12:26 +0000"  >&lt;p&gt;Patch includes new JUnit tests for UDFDateSub, UDFDateAdd and UDFDateDiff to test correctness over daylight savings time changes.&lt;/p&gt;</comment>
                            <comment id="12852279" author="zshao" created="Thu, 1 Apr 2010 08:07:57 +0000"  >&lt;p&gt;+1. Will test and commit.&lt;/p&gt;</comment>
                            <comment id="12852581" author="zshao" created="Thu, 1 Apr 2010 22:26:48 +0000"  >&lt;p&gt;Committed. Thanks Bryan!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12439339" name="HIVE-1253.patch" size="10487" author="batalbot" created="Sat, 20 Mar 2010 00:12:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73015</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 34 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0le5r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>122944</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>