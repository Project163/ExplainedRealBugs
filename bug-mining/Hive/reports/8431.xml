<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:23:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-26925] MV with iceberg storage format fails when contains &apos;PARTITIONED ON&apos; clause due to column number/types difference.</title>
                <link>https://issues.apache.org/jira/browse/HIVE-26925</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;MV with iceberg storage format fails when contains &apos;PARTITIONED ON&apos; clause due to column number/types difference.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
!!! annotations iceberg
&amp;gt;&amp;gt;&amp;gt; use iceberg_test_db_hive;
No rows affected
&amp;gt;&amp;gt;&amp;gt; set hive.exec.max.dynamic.partitions=2000;
&amp;gt;&amp;gt;&amp;gt; set hive.exec.max.dynamic.partitions.pernode=2000;
&amp;gt;&amp;gt;&amp;gt; drop materialized view &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; exists mv_agg_gby_col_partitioned;
&amp;gt;&amp;gt;&amp;gt; create materialized view mv_agg_gby_col_partitioned PARTITIONED ON (t) stored by iceberg stored as orc tblproperties (&lt;span class=&quot;code-quote&quot;&gt;&apos;format-version&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;) as select b,f,sum(b), sum(f),t from all100k group by b,f,v,c,t;
&amp;gt;&amp;gt;&amp;gt; analyze table mv_agg_gby_col_partitioned compute statistics &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; columns;
&amp;gt;&amp;gt;&amp;gt; set hive.explain.user=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;

&amp;gt;&amp;gt;&amp;gt; explain select b,f,sum(b) from all100k where t=93 group by c,v,f,b;
!!! match row_contains
          alias: iceberg_test_db_hive.mv_agg_gby_col_partitioned

&amp;gt;&amp;gt;&amp;gt; drop materialized view mv_agg_gby_col_partitioned;
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Error&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2023-01-10T20:31:17,514 INFO &#160;[pool-5-thread-1] jdbc.TestDriver: Query: create materialized view mv_agg_gby_col_partitioned PARTITIONED ON (t) stored by iceberg stored as orc tblproperties (&lt;span class=&quot;code-quote&quot;&gt;&apos;format-version&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;) as select b,f,sum(b), sum(f),t from all100k group by b,f,v,c,t
2023-01-10T20:31:18,099 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: INFO &#160;: Compiling command(queryId=hive_20230110203117_6c333b6a-1642-40e7-80bc-e78dede47980): create materialized view mv_agg_gby_col_partitioned PARTITIONED ON (t) stored by iceberg stored as orc tblproperties (&lt;span class=&quot;code-quote&quot;&gt;&apos;format-version&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;) as select b,f,sum(b), sum(f),t from all100k group by b,f,v,c,t
2023-01-10T20:31:18,100 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: INFO &#160;: No Stats &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; iceberg_test_db_hive@all100k, Columns: b, c, t, f, v
2023-01-10T20:31:18,100 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: ERROR : FAILED: SemanticException Line 0:-1 Cannot insert into target table because column number/types are different &lt;span class=&quot;code-quote&quot;&gt;&apos;TOK_TMP_FILE&apos;&lt;/span&gt;: Table insclause-0 has 6 columns, but query has 5 columns.
2023-01-10T20:31:18,100 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: org.apache.hadoop.hive.ql.parse.SemanticException: Line 0:-1 Cannot insert into target table because column number/types are different &lt;span class=&quot;code-quote&quot;&gt;&apos;TOK_TMP_FILE&apos;&lt;/span&gt;: Table insclause-0 has 6 columns, but query has 5 columns.
2023-01-10T20:31:18,100 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.genConversionSelectOperator(SemanticAnalyzer.java:8905)
2023-01-10T20:31:18,100 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.genFileSinkPlan(SemanticAnalyzer.java:8114)
2023-01-10T20:31:18,100 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.genPostGroupByBodyPlan(SemanticAnalyzer.java:11583)
2023-01-10T20:31:18,100 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.genBodyPlan(SemanticAnalyzer.java:11455)
2023-01-10T20:31:18,100 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.genPlan(SemanticAnalyzer.java:12424)
2023-01-10T20:31:18,100 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.genPlan(SemanticAnalyzer.java:12290)
2023-01-10T20:31:18,100 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.genOPTree(SemanticAnalyzer.java:13038)
2023-01-10T20:31:18,100 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at org.apache.hadoop.hive.ql.parse.CalcitePlanner.genOPTree(CalcitePlanner.java:756)
2023-01-10T20:31:18,100 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.analyzeInternal(SemanticAnalyzer.java:13154)
2023-01-10T20:31:18,100 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at org.apache.hadoop.hive.ql.parse.CalcitePlanner.analyzeInternal(CalcitePlanner.java:472)
2023-01-10T20:31:18,100 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:313)
2023-01-10T20:31:18,100 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at org.apache.hadoop.hive.ql.&lt;span class=&quot;code-object&quot;&gt;Compiler&lt;/span&gt;.analyze(&lt;span class=&quot;code-object&quot;&gt;Compiler&lt;/span&gt;.java:222)
2023-01-10T20:31:18,100 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at org.apache.hadoop.hive.ql.&lt;span class=&quot;code-object&quot;&gt;Compiler&lt;/span&gt;.compile(&lt;span class=&quot;code-object&quot;&gt;Compiler&lt;/span&gt;.java:105)
2023-01-10T20:31:18,100 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:201)
2023-01-10T20:31:18,100 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at org.apache.hadoop.hive.ql.Driver.compileInternal(Driver.java:657)
2023-01-10T20:31:18,100 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at org.apache.hadoop.hive.ql.Driver.compileAndRespond(Driver.java:603)
2023-01-10T20:31:18,101 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at org.apache.hadoop.hive.ql.Driver.compileAndRespond(Driver.java:597)
2023-01-10T20:31:18,101 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at org.apache.hadoop.hive.ql.reexec.ReExecDriver.compileAndRespond(ReExecDriver.java:127)
2023-01-10T20:31:18,101 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at org.apache.hive.service.cli.operation.SQLOperation.prepare(SQLOperation.java:206)
2023-01-10T20:31:18,101 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at org.apache.hive.service.cli.operation.SQLOperation$BackgroundWork$1.run(SQLOperation.java:336)
2023-01-10T20:31:18,101 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at java.base/java.security.AccessController.doPrivileged(Native Method)
2023-01-10T20:31:18,101 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at java.base/javax.security.auth.Subject.doAs(Subject.java:423)
2023-01-10T20:31:18,101 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1899)
2023-01-10T20:31:18,101 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at org.apache.hive.service.cli.operation.SQLOperation$BackgroundWork.run(SQLOperation.java:358)
2023-01-10T20:31:18,101 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515)
2023-01-10T20:31:18,101 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
2023-01-10T20:31:18,101 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515)
2023-01-10T20:31:18,101 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
2023-01-10T20:31:18,101 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
2023-01-10T20:31:18,101 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
2023-01-10T20:31:18,101 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: &#160; &#160; at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:829)
2023-01-10T20:31:18,101 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver:
2023-01-10T20:31:18,101 INFO &#160;[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-21] jdbc.TestDriver: INFO &#160;: Completed compiling command(queryId=hive_20230110203117_6c333b6a-1642-40e7-80bc-e78dede47980); Time taken: 0.526 seconds
2023-01-10T20:31:18,306 ERROR [pool-5-thread-1] jdbc.TestDriver: Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; compiling statement: FAILED: SemanticException Line 0:-1 Cannot insert into target table because column number/types are different &lt;span class=&quot;code-quote&quot;&gt;&apos;TOK_TMP_FILE&apos;&lt;/span&gt;: Table insclause-0 has 6 columns, but query has 5 columns. &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Similar query works for Hive native materialized views.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13517496">HIVE-26925</key>
            <summary>MV with iceberg storage format fails when contains &apos;PARTITIONED ON&apos; clause due to column number/types difference.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kkasa">Krisztian Kasa</assignee>
                                    <reporter username="dharmikt">Dharmik Thakkar</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 10 Jan 2023 20:44:31 +0000</created>
                <updated>Fri, 10 Feb 2023 02:45:50 +0000</updated>
                            <resolved>Fri, 20 Jan 2023 03:18:36 +0000</resolved>
                                                                    <component>Iceberg integration</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="9600">2h 40m</timespent>
                                <comments>
                            <comment id="17678966" author="kkasa" created="Fri, 20 Jan 2023 03:18:36 +0000"  >&lt;p&gt;Merged to master. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zabetak&quot; class=&quot;user-hover&quot; rel=&quot;zabetak&quot;&gt;zabetak&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=amansinha100&quot; class=&quot;user-hover&quot; rel=&quot;amansinha100&quot;&gt;amansinha100&lt;/a&gt; for review.&#160;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13524138">HIVE-27066</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1epag:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>