<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:05:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-4302] Fix how RowSchema and RowResolver are set on ReduceSinkOp that precedes PTFOp</title>
                <link>https://issues.apache.org/jira/browse/HIVE-4302</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Currently the RowSchema and RowResolver for the ReduceSinkOp just point to the &apos;input&apos; Op&apos;s structures. This causes issues when input Op&apos;s structures are changed during Optimization. See Jira 2340 of a problem.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12641141">HIVE-4302</key>
            <summary>Fix how RowSchema and RowResolver are set on ReduceSinkOp that precedes PTFOp</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhbutani">Harish Butani</assignee>
                                    <reporter username="rhbutani">Harish Butani</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Apr 2013 22:28:13 +0000</created>
                <updated>Thu, 16 May 2013 21:09:59 +0000</updated>
                            <resolved>Sun, 7 Apr 2013 15:10:10 +0000</resolved>
                                                    <fixVersion>0.11.0</fixVersion>
                                    <component>PTF-Windowing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13624503" author="phabricator@reviews.facebook.net" created="Sat, 6 Apr 2013 21:21:15 +0000"  >&lt;p&gt;hbutani requested code review of &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4302&quot; title=&quot;Fix how RowSchema and RowResolver are set on ReduceSinkOp that precedes PTFOp&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4302&quot;&gt;&lt;del&gt;HIVE-4302&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Fix how RowSchema and RowResolver are set on ReduceSinkOp that precedes PTFOp&quot;.&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;create RS RR during genPTFPlan&lt;/p&gt;

&lt;p&gt;Currently the RowSchema and RowResolver for the ReduceSinkOp just point to the &apos;input&apos; Op&apos;s structures. This causes issues when input Op&apos;s structures are changed during Optimization. See Jira 2340 of a problem.&lt;/p&gt;

&lt;p&gt;TEST PLAN&lt;br/&gt;
  EMPTY&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10005&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10005&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  data/files/flights_tiny.txt&lt;br/&gt;
  data/files/part.rc&lt;br/&gt;
  data/files/part.seq&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;/p&gt;

&lt;p&gt;MANAGE HERALD RULES&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/view/differential/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/herald/view/differential/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WHY DID I GET THIS EMAIL?&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/transcript/23925/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/herald/transcript/23925/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, hbutani&lt;/p&gt;</comment>
                            <comment id="13624504" author="rhbutani" created="Sat, 6 Apr 2013 21:23:30 +0000"  >&lt;p&gt;Haven&apos;t made the change to ColumnPrunerFactory in the patch as 2340 is not resolved yet.&lt;/p&gt;</comment>
                            <comment id="13624513" author="phabricator@reviews.facebook.net" created="Sat, 6 Apr 2013 21:37:14 +0000"  >&lt;p&gt;ashutoshc has requested changes to the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4302&quot; title=&quot;Fix how RowSchema and RowResolver are set on ReduceSinkOp that precedes PTFOp&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4302&quot;&gt;&lt;del&gt;HIVE-4302&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Fix how RowSchema and RowResolver are set on ReduceSinkOp that precedes PTFOp&quot;.&lt;/p&gt;

&lt;p&gt;  Also, it will be good to have a test-case I had in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2340&quot; title=&quot;optimize orderby followed by a groupby&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2340&quot;&gt;&lt;del&gt;HIVE-2340&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
  hive&amp;gt; create table t1 (a1 int, b1 string);&lt;br/&gt;
  hive&amp;gt; create table t2 (a1 int, b1 string);&lt;br/&gt;
  hive&amp;gt; from (select sum&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; over (), s from over10k) tt insert overwrite table t1 select * insert overwrite table t2 select * ;&lt;br/&gt;
  hive&amp;gt; select * from t1 limit 3;&lt;br/&gt;
  hive&amp;gt; select * from t2 limit 3;&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java:10543 Now that we have gotten rid of having support with ptf operator, is this now redundant?&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java:10552 If above statement is correct, than we need to update this comment as well.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java:10554 And remove this if block.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10005&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10005&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4302&quot; title=&quot;Fix how RowSchema and RowResolver are set on ReduceSinkOp that precedes PTFOp&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4302&quot;&gt;&lt;del&gt;HIVE-4302&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, hbutani&lt;/p&gt;</comment>
                            <comment id="13624589" author="phabricator@reviews.facebook.net" created="Sun, 7 Apr 2013 02:07:14 +0000"  >&lt;p&gt;hbutani has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4302&quot; title=&quot;Fix how RowSchema and RowResolver are set on ReduceSinkOp that precedes PTFOp&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4302&quot;&gt;&lt;del&gt;HIVE-4302&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Fix how RowSchema and RowResolver are set on ReduceSinkOp that precedes PTFOp&quot;.&lt;/p&gt;

&lt;p&gt;  Will add the test&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java:10543 No this is not about the having clause for windowing.&lt;br/&gt;
  This has to do with the GroupBy RR that can precede window processing. For Having expressions a Aggregation expression is added twice to the RR. This logic is to preserve this. The comment on line 10566 tries to explain what is going on.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10005&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10005&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4302&quot; title=&quot;Fix how RowSchema and RowResolver are set on ReduceSinkOp that precedes PTFOp&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4302&quot;&gt;&lt;del&gt;HIVE-4302&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, hbutani&lt;/p&gt;</comment>
                            <comment id="13624603" author="phabricator@reviews.facebook.net" created="Sun, 7 Apr 2013 03:13:14 +0000"  >&lt;p&gt;hbutani updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4302&quot; title=&quot;Fix how RowSchema and RowResolver are set on ReduceSinkOp that precedes PTFOp&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4302&quot;&gt;&lt;del&gt;HIVE-4302&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Fix how RowSchema and RowResolver are set on ReduceSinkOp that precedes PTFOp&quot;.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;adding test&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Reviewers: ashutoshc, JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10005&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10005&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10005?vs=31353&amp;amp;id=31383#toc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10005?vs=31353&amp;amp;id=31383#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  data/files/flights_tiny.txt&lt;br/&gt;
  data/files/part.rc&lt;br/&gt;
  data/files/part.seq&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/windowing_expressions.q&lt;br/&gt;
  ql/src/test/results/clientpositive/windowing_expressions.q.out&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, hbutani&lt;/p&gt;</comment>
                            <comment id="13624732" author="phabricator@reviews.facebook.net" created="Sun, 7 Apr 2013 05:41:15 +0000"  >&lt;p&gt;ashutoshc has accepted the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4302&quot; title=&quot;Fix how RowSchema and RowResolver are set on ReduceSinkOp that precedes PTFOp&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4302&quot;&gt;&lt;del&gt;HIVE-4302&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Fix how RowSchema and RowResolver are set on ReduceSinkOp that precedes PTFOp&quot;.&lt;/p&gt;

&lt;p&gt;  +1 will commit if tests pass.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10005&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10005&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4302&quot; title=&quot;Fix how RowSchema and RowResolver are set on ReduceSinkOp that precedes PTFOp&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4302&quot;&gt;&lt;del&gt;HIVE-4302&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, hbutani&lt;/p&gt;</comment>
                            <comment id="13624935" author="ashutoshc" created="Sun, 7 Apr 2013 15:10:10 +0000"  >&lt;p&gt;Committed to trunk. Thanks, Harish!&lt;/p&gt;</comment>
                            <comment id="13624948" author="hudson" created="Sun, 7 Apr 2013 16:05:10 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #2050 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/2050/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/2050/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4302&quot; title=&quot;Fix how RowSchema and RowResolver are set on ReduceSinkOp that precedes PTFOp&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4302&quot;&gt;&lt;del&gt;HIVE-4302&lt;/del&gt;&lt;/a&gt; : Fix how RowSchema and RowResolver are set on ReduceSinkOp that precedes PTFOp (Harish Butani via Ashutosh Chauhan) (Revision 1465408)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
hashutosh : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1465408&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1465408&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/windowing_expressions.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/windowing_expressions.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13625049" author="hudson" created="Sun, 7 Apr 2013 23:39:54 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #144 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/144/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/144/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4302&quot; title=&quot;Fix how RowSchema and RowResolver are set on ReduceSinkOp that precedes PTFOp&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4302&quot;&gt;&lt;del&gt;HIVE-4302&lt;/del&gt;&lt;/a&gt; : Fix how RowSchema and RowResolver are set on ReduceSinkOp that precedes PTFOp (Harish Butani via Ashutosh Chauhan) (Revision 1465408)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
hashutosh : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1465408&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1465408&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/windowing_expressions.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/windowing_expressions.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12577394" name="HIVE-4302.D10005.1.patch" size="3864" author="phabricator@reviews.facebook.net" created="Sat, 6 Apr 2013 21:21:15 +0000"/>
                            <attachment id="12577423" name="HIVE-4302.D10005.2.patch" size="17771" author="phabricator@reviews.facebook.net" created="Sun, 7 Apr 2013 03:13:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>321557</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 33 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1jhbr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>321902</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>