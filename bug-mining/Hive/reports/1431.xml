<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:09:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-5105] HCatSchema.remove(HCatFieldSchema hcatFieldSchema) does not clean up fieldPositionMap</title>
                <link>https://issues.apache.org/jira/browse/HIVE-5105</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;org.apache.hcatalog.data.schema.HCatSchema.remove(HCatFieldSchema hcatFieldSchema) makes the following call:&lt;/p&gt;

&lt;p&gt;fieldPositionMap.remove(hcatFieldSchema);&lt;/p&gt;

&lt;p&gt;but fieldPositionMap is of type Map&amp;lt;String, Integer&amp;gt; so the element is not getting removed&lt;/p&gt;

&lt;p&gt;Here&apos;s a detailed comment from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sushanth&quot; class=&quot;user-hover&quot; rel=&quot;sushanth&quot;&gt;sushanth&lt;/a&gt;&lt;br/&gt;
The result is that that the name will not be removed from fieldPositionMap. This results in 2 things:&lt;br/&gt;
a) If anyone tries to append a field to a hcatschema after having removed that field, it shouldn&apos;t fail, but it will.&lt;br/&gt;
b) If anyone asks for the position of the removed field by name, it will still give the position.&lt;/p&gt;

&lt;p&gt;Now, there is only one place in hcat code where we remove a field, and that is called from HCatOutputFormat.setSchema, where we try to detect if the user specified partition column names in the schema when they shouldn&apos;t have, and if they did, we remove it. Normally, people do not specify this, and this check tends to be superfluous.&lt;/p&gt;

&lt;p&gt;Once we do this, we wind up serializing that new object (after performing some validations), and this does appear to stay through the serialization (and eventual deserialization) which is very worrying.&lt;/p&gt;

&lt;p&gt;However, we are luckily saved by the fact that we do not append that field to it at any time(all appends in hcat code are done on newly initialized HCatSchema objects which have had no removes done on them), and we don&apos;t ask for the position of something we do not expect to be there(harder to verify for certain, but seems to be the case on inspection).&lt;/p&gt;

&lt;p&gt;The main part that gives me worry is that HCatSchema is part of our public interface for HCat, in that M/R programs that use HCat can use it, and thus, they might have more interesting usage patterns that are hitting this bug.&lt;/p&gt;

&lt;p&gt;I can&apos;t think of any currently open bugs that is caused by this because of the rarity of the situation, but nevertheless, something we should fix immediately.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12663961">HIVE-5105</key>
            <summary>HCatSchema.remove(HCatFieldSchema hcatFieldSchema) does not clean up fieldPositionMap</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ekoifman">Eugene Koifman</assignee>
                                    <reporter username="ekoifman">Eugene Koifman</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Aug 2013 00:27:36 +0000</created>
                <updated>Tue, 15 Oct 2013 23:30:54 +0000</updated>
                            <resolved>Sat, 17 Aug 2013 00:42:53 +0000</resolved>
                                    <version>0.12.0</version>
                                    <fixVersion>0.12.0</fixVersion>
                                    <component>HCatalog</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13741985" author="hiveqa" created="Fri, 16 Aug 2013 06:50:19 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12598342/HIVE-5105.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12598342/HIVE-5105.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 2880 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_parallel_orderby
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_udtf_not_supported2
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_infer_bucket_sort_reducers_power_two
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/458/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/458/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/458/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/458/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests failed with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13742626" author="sushanth" created="Fri, 16 Aug 2013 21:36:52 +0000"  >&lt;p&gt;+1, Thanks for the test as well, Eugene. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13742763" author="sushanth" created="Sat, 17 Aug 2013 00:42:47 +0000"  >&lt;p&gt;Committed to hive svn trunk.&lt;/p&gt;</comment>
                            <comment id="13742857" author="hudson" created="Sat, 17 Aug 2013 06:11:17 +0000"  >&lt;p&gt;FAILURE: Integrated in Hive-trunk-hadoop2-ptest #62 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2-ptest/62/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2-ptest/62/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5105&quot; title=&quot;HCatSchema.remove(HCatFieldSchema hcatFieldSchema) does not clean up fieldPositionMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5105&quot;&gt;&lt;del&gt;HIVE-5105&lt;/del&gt;&lt;/a&gt; HCatSchema.remove(HCatFieldSchema hcatFieldSchema) does not clean up fieldPositionMap (Eugene Koifman via Sushanth Sowmyan) (khorgath: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1514929&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1514929&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/hcatalog/core/src/main/java/org/apache/hcatalog/data/schema/HCatSchema.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/hcatalog/core/src/test/java/org/apache/hcatalog/data/schema/TestHCatSchema.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13742877" author="hudson" created="Sat, 17 Aug 2013 07:52:22 +0000"  >&lt;p&gt;FAILURE: Integrated in Hive-trunk-hadoop1-ptest #131 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop1-ptest/131/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop1-ptest/131/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5105&quot; title=&quot;HCatSchema.remove(HCatFieldSchema hcatFieldSchema) does not clean up fieldPositionMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5105&quot;&gt;&lt;del&gt;HIVE-5105&lt;/del&gt;&lt;/a&gt; HCatSchema.remove(HCatFieldSchema hcatFieldSchema) does not clean up fieldPositionMap (Eugene Koifman via Sushanth Sowmyan) (khorgath: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1514929&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1514929&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/hcatalog/core/src/main/java/org/apache/hcatalog/data/schema/HCatSchema.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/hcatalog/core/src/test/java/org/apache/hcatalog/data/schema/TestHCatSchema.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13742894" author="hudson" created="Sat, 17 Aug 2013 10:29:09 +0000"  >&lt;p&gt;FAILURE: Integrated in Hive-trunk-h0.21 #2274 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/2274/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/2274/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5105&quot; title=&quot;HCatSchema.remove(HCatFieldSchema hcatFieldSchema) does not clean up fieldPositionMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5105&quot;&gt;&lt;del&gt;HIVE-5105&lt;/del&gt;&lt;/a&gt; HCatSchema.remove(HCatFieldSchema hcatFieldSchema) does not clean up fieldPositionMap (Eugene Koifman via Sushanth Sowmyan) (khorgath: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1514929&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1514929&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/hcatalog/core/src/main/java/org/apache/hcatalog/data/schema/HCatSchema.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/hcatalog/core/src/test/java/org/apache/hcatalog/data/schema/TestHCatSchema.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13743031" author="hudson" created="Sat, 17 Aug 2013 21:24:46 +0000"  >&lt;p&gt;ABORTED: Integrated in Hive-trunk-hadoop2 #366 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/366/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/366/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5105&quot; title=&quot;HCatSchema.remove(HCatFieldSchema hcatFieldSchema) does not clean up fieldPositionMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5105&quot;&gt;&lt;del&gt;HIVE-5105&lt;/del&gt;&lt;/a&gt; HCatSchema.remove(HCatFieldSchema hcatFieldSchema) does not clean up fieldPositionMap (Eugene Koifman via Sushanth Sowmyan) (khorgath: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1514929&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1514929&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/hcatalog/core/src/main/java/org/apache/hcatalog/data/schema/HCatSchema.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/hcatalog/core/src/test/java/org/apache/hcatalog/data/schema/TestHCatSchema.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13796097" author="ashutoshc" created="Tue, 15 Oct 2013 23:30:54 +0000"  >&lt;p&gt;This issue has been fixed and released as part of 0.12 release. If you find further issues, please create a new jira and link it to this one.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12598342" name="HIVE-5105.patch" size="2385" author="ekoifman" created="Fri, 16 Aug 2013 01:43:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>343962</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 6 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1nbfb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>344264</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>