<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:24:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-27303] select query result is different when enable/disable mapjoin with UNION ALL</title>
                <link>https://issues.apache.org/jira/browse/HIVE-27303</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;select query result is different when enable/disable mapjoin with UNION ALL&lt;/p&gt;

&lt;p&gt;Below are the reproduce steps.&lt;/p&gt;

&lt;p&gt;As per query when map.join is disabled it should not give rows(duplicate). Same is working fine with map.join=true.&lt;/p&gt;

&lt;p&gt;Expected result: Empty rows.&lt;/p&gt;

&lt;p&gt;Problem: returning duplicate rows.&lt;/p&gt;

&lt;p&gt;Steps:&lt;/p&gt;

&lt;p&gt;----------&lt;/p&gt;

&lt;p&gt;SET hive.server2.tez.queue.access.check=true;&lt;br/&gt;
SET tez.queue.name=default&lt;br/&gt;
SET hive.query.results.cache.enabled=false;&lt;br/&gt;
SET hive.fetch.task.conversion=none;&lt;br/&gt;
SET hive.execution.engine=tez;&lt;br/&gt;
SET hive.stats.autogather=true;&lt;br/&gt;
SET hive.server2.enable.doAs=false;&lt;br/&gt;
SET hive.auto.convert.join=false;&lt;/p&gt;

&lt;p&gt;drop table if exists hive1_tbl_data;&lt;br/&gt;
drop table if exists hive2_tbl_data;&lt;br/&gt;
drop table if exists hive3_tbl_data;&lt;br/&gt;
drop table if exists hive4_tbl_data;&lt;/p&gt;

&lt;p&gt;CREATE EXTERNAL TABLE hive1_tbl_data (COLUMID string,COLUMN_FN string,COLUMN_LN string,EMAIL string,COL_UPDATED_DATE timestamp, PK_COLUM string)&#160;&lt;br/&gt;
&#160;ROW FORMAT SERDE &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&lt;br/&gt;
&#160; &#160;&apos;org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe&apos; &#160;&lt;br/&gt;
&#160;STORED AS INPUTFORMAT &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&lt;br/&gt;
&#160; &#160;&apos;org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat&apos; &#160;&lt;br/&gt;
&#160;OUTPUTFORMAT &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&lt;br/&gt;
&#160; &#160;&apos;org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat&apos;&#160;&lt;br/&gt;
&#160;TBLPROPERTIES ( &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&lt;br/&gt;
&#160; &#160;&apos;TRANSLATED_TO_EXTERNAL&apos;=&apos;true&apos;, &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&lt;br/&gt;
&#160; &#160;&apos;bucketing_version&apos;=&apos;2&apos;, &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&lt;br/&gt;
&#160; &#160;&apos;external.table.purge&apos;=&apos;true&apos;, &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&lt;br/&gt;
&#160; &#160;&apos;parquet.compression&apos;=&apos;SNAPPY&apos;);&lt;/p&gt;

&lt;p&gt;CREATE EXTERNAL TABLE hive2_tbl_data (COLUMID string,COLUMN_FN string,COLUMN_LN string,EMAIL string,COL_UPDATED_DATE timestamp, PK_COLUM string)&#160;&lt;br/&gt;
&#160;ROW FORMAT SERDE &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&lt;br/&gt;
&#160; &#160;&apos;org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe&apos; &#160;&lt;br/&gt;
&#160;STORED AS INPUTFORMAT &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&lt;br/&gt;
&#160; &#160;&apos;org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat&apos; &#160;&lt;br/&gt;
&#160;OUTPUTFORMAT &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&lt;br/&gt;
&#160; &#160;&apos;org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat&apos;&#160;&lt;br/&gt;
&#160;TBLPROPERTIES ( &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&lt;br/&gt;
&#160; &#160;&apos;TRANSLATED_TO_EXTERNAL&apos;=&apos;true&apos;, &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&lt;br/&gt;
&#160; &#160;&apos;bucketing_version&apos;=&apos;2&apos;, &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&lt;br/&gt;
&#160; &#160;&apos;external.table.purge&apos;=&apos;true&apos;, &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&lt;br/&gt;
&#160; &#160;&apos;parquet.compression&apos;=&apos;SNAPPY&apos;);&lt;/p&gt;

&lt;p&gt;CREATE EXTERNAL TABLE hive3_tbl_data (COLUMID string,COLUMN_FN string,COLUMN_LN string,EMAIL string,COL_UPDATED_DATE timestamp, PK_COLUM string)&#160;&lt;br/&gt;
&#160;ROW FORMAT SERDE &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&lt;br/&gt;
&#160; &#160;&apos;org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe&apos; &#160;&lt;br/&gt;
&#160;STORED AS INPUTFORMAT &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&lt;br/&gt;
&#160; &#160;&apos;org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat&apos; &#160;&lt;br/&gt;
&#160;OUTPUTFORMAT &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&lt;br/&gt;
&#160; &#160;&apos;org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat&apos;&#160;&lt;br/&gt;
&#160;TBLPROPERTIES ( &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&lt;br/&gt;
&#160; &#160;&apos;TRANSLATED_TO_EXTERNAL&apos;=&apos;true&apos;, &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&lt;br/&gt;
&#160; &#160;&apos;bucketing_version&apos;=&apos;2&apos;, &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&lt;br/&gt;
&#160; &#160;&apos;external.table.purge&apos;=&apos;true&apos;, &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&lt;br/&gt;
&#160; &#160;&apos;parquet.compression&apos;=&apos;SNAPPY&apos;);&lt;/p&gt;

&lt;p&gt;&#160; &#160;CREATE EXTERNAL TABLE hive4_tbl_data (COLUMID string,COLUMN_FN string,COLUMN_LN string,EMAIL string,COL_UPDATED_DATE timestamp, PK_COLUM string)&#160;&lt;br/&gt;
&#160;ROW FORMAT SERDE &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&lt;br/&gt;
&#160; &#160;&apos;org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe&apos; &#160;&lt;br/&gt;
&#160;STORED AS INPUTFORMAT &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&lt;br/&gt;
&#160; &#160;&apos;org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat&apos; &#160;&lt;br/&gt;
&#160;OUTPUTFORMAT &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&lt;br/&gt;
&#160; &#160;&apos;org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat&apos;&#160;&lt;br/&gt;
&#160;TBLPROPERTIES ( &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&lt;br/&gt;
&#160; &#160;&apos;TRANSLATED_TO_EXTERNAL&apos;=&apos;true&apos;, &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&lt;br/&gt;
&#160; &#160;&apos;bucketing_version&apos;=&apos;2&apos;, &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&lt;br/&gt;
&#160; &#160;&apos;external.table.purge&apos;=&apos;true&apos;, &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&lt;br/&gt;
&#160; &#160;&apos;parquet.compression&apos;=&apos;SNAPPY&apos;);&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;insert into table hive1_tbl_data select &apos;00001&apos;,&apos;john&apos;,&apos;doe&apos;,&apos;john@hotmail.com&apos;,&apos;2014-01-01 12:01:02&apos;,&apos;4000-10000&apos;;&lt;/p&gt;

&lt;p&gt;insert into table hive1_tbl_data select &apos;00002&apos;,&apos;john&apos;,&apos;doe&apos;,&apos;john@hotmail.com&apos;,&apos;2014-01-01 12:01:02&apos;,&apos;4000-10000&apos;;insert into table hive2_tbl_data select &apos;00001&apos;,&apos;john&apos;,&apos;doe&apos;,&apos;john@hotmail.com&apos;,&apos;2014-01-01 12:01:02&apos;,&apos;00001&apos;;&#160;&lt;br/&gt;
insert into table hive2_tbl_data select &apos;00002&apos;,&apos;john&apos;,&apos;doe&apos;,&apos;john@hotmail.com&apos;,&apos;2014-01-01 12:01:02&apos;,&apos;00001&apos;;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;select&lt;br/&gt;
&#160; &#160; &#160; &#160;t.COLUMID&lt;br/&gt;
&#160; from (&lt;br/&gt;
&#160; &#160; &#160; select distinct&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; t.COLUMID as COLUMID&lt;br/&gt;
&#160; &#160; &#160; from (SELECT COLUMID FROM hive3_tbl_data UNION ALL SELECT COLUMID FROM hive1_tbl_data) t&lt;br/&gt;
&#160; ) t&lt;br/&gt;
&#160; left join (&lt;br/&gt;
&#160; &#160; &#160; select&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; &#160;distinct t.COLUMID&lt;br/&gt;
&#160; &#160; &#160; from (SELECT COLUMID FROM hive4_tbl_data UNION ALL SELECT COLUMID FROM hive2_tbl_data) t&lt;br/&gt;
&#160; ) t1 on t.COLUMID = t1.COLUMID&lt;br/&gt;
&#160; where t1.COLUMID is null;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13534334">HIVE-27303</key>
            <summary>select query result is different when enable/disable mapjoin with UNION ALL</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="maheshrajus">Mahesh Raju Somalaraju</assignee>
                                    <reporter username="maheshrajus">Mahesh Raju Somalaraju</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 27 Apr 2023 14:52:46 +0000</created>
                <updated>Thu, 15 Aug 2024 08:57:06 +0000</updated>
                            <resolved>Thu, 24 Aug 2023 04:59:16 +0000</resolved>
                                                    <fixVersion>4.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17731454" author="JIRAUSER298608" created="Mon, 12 Jun 2023 06:23:23 +0000"  >&lt;p&gt;Hello, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maheshrajus&quot; class=&quot;user-hover&quot; rel=&quot;maheshrajus&quot;&gt;maheshrajus&lt;/a&gt;. I mistakenly submitted a PR for this issue although it is already assigned to you. I&apos;m sorry for not reading the JIRA page thoroughly and ignoring the current assignee. May I change the assignee to me if you haven&apos;t worked on it yet? I&apos;ll close my PR if you don&apos;t want to change it.&lt;/p&gt;</comment>
                            <comment id="17749470" author="maheshrajus" created="Tue, 1 Aug 2023 06:12:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=seonggon&quot; class=&quot;user-hover&quot; rel=&quot;seonggon&quot;&gt;seonggon&lt;/a&gt; Thanks for your PR, let me verify it. If fix is working fine then you can merge the PR.&lt;/p&gt;</comment>
                            <comment id="17758346" author="maheshrajus" created="Thu, 24 Aug 2023 04:58:48 +0000"  >&lt;p&gt;Merged the PR.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hive/pull/4406&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/pull/4406&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17758354" author="ayushtkn" created="Thu, 24 Aug 2023 05:34:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maheshrajus&quot; class=&quot;user-hover&quot; rel=&quot;maheshrajus&quot;&gt;maheshrajus&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lvegh&quot; class=&quot;user-hover&quot; rel=&quot;lvegh&quot;&gt;lvegh&lt;/a&gt; can you please update the fix version, that is a mandatory field, the fix version is used to prepare the release notes during releases&lt;/p&gt;</comment>
                            <comment id="17758371" author="glapark" created="Thu, 24 Aug 2023 05:57:06 +0000"  >&lt;p&gt;Could someone update the commit log so that Seonggon gets credit for the pull request resolving this JIRA?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310660">
                    <name>Completes</name>
                                            <outwardlinks description="fixes">
                                        <issuelink>
            <issuekey id="13366156">HIVE-24907</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 11 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1hku0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>