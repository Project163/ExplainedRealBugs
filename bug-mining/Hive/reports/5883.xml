<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:57:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-17111] Add TestLocalSparkCliDriver</title>
                <link>https://issues.apache.org/jira/browse/HIVE-17111</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The TestSparkCliDriver sets the spark.master to local-cluster&lt;span class=&quot;error&quot;&gt;&amp;#91;2,2,1024&amp;#93;&lt;/span&gt; but the HoS still uses decides to use the RemoteHiveSparkClient rather than the LocalHiveSparkClient.&lt;/p&gt;

&lt;p&gt;The issue is with the following check in HiveSparkClientFactory:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (master.equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;local&quot;&lt;/span&gt;) || master.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;local[&quot;&lt;/span&gt;)) {
      &lt;span class=&quot;code-comment&quot;&gt;// With local spark context, all user sessions share the same spark context.
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; LocalHiveSparkClient.getInstance(generateSparkConf(sparkConf));
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RemoteHiveSparkClient(hiveconf, sparkConf);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When &lt;tt&gt;master.startsWith(&quot;local[&quot;)&lt;/tt&gt; it checks the value of spark.master and sees that it doesn&apos;t start with &lt;tt&gt;local[&lt;/tt&gt; and then decides to use the RemoteHiveSparkClient.&lt;/p&gt;

&lt;p&gt;We should fix this so that the LocalHiveSparkClient is used. It should speed up some of the tests, and also makes qtests easier to debug since everything will now be run in the same process.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13087721">HIVE-17111</key>
            <summary>Add TestLocalSparkCliDriver</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stakiar">Sahil Takiar</assignee>
                                    <reporter username="stakiar">Sahil Takiar</reporter>
                        <labels>
                    </labels>
                <created>Mon, 17 Jul 2017 20:13:03 +0000</created>
                <updated>Tue, 22 May 2018 23:58:41 +0000</updated>
                            <resolved>Mon, 9 Oct 2017 23:11:21 +0000</resolved>
                                                    <fixVersion>3.0.0</fixVersion>
                                    <component>Spark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="16091008" author="lirui" created="Tue, 18 Jul 2017 02:25:55 +0000"  >&lt;p&gt;I agree our tests should cover LocalHiveSparkClient. But since the remote mode is what we really use in production, shouldn&apos;t we focus on this mode in tests?&lt;br/&gt;
I&apos;m even wondering if it makes sense to move all the tests of TestSparkCliDriver to TestMiniSparkOnYarnCliDriver. I believe the local-cluster mode was used as a &quot;workaround&quot; when we couldn&apos;t run HoS tests on a mini cluster (and didn&apos;t want to use pure local mode).&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=csun&quot; class=&quot;user-hover&quot; rel=&quot;csun&quot;&gt;csun&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;jxiang&lt;/a&gt;, what do you think?&lt;/p&gt;</comment>
                            <comment id="16091045" author="stakiar" created="Tue, 18 Jul 2017 03:14:57 +0000"  >&lt;p&gt;I&apos;m good either way. While TestMiniSparkOnYarnCliDriver is closer to what is used in production, a lot of qtests probably don&apos;t need to be run on a mini-cluster of processes. If everything is run in the same process, the test coverage is probably similar. I think Hive-on-MR qtests is all in process, and some of the LLAP qtests are in process too. The main advantage is reduced time to run the tests.&lt;/p&gt;

&lt;p&gt;That being said, I&apos;m good with either approach. Basically, I think there should just be a way to run a HoS qtest entirely in process (could just be a config option). It can help a lot with debugging.&lt;/p&gt;</comment>
                            <comment id="16092597" author="csun" created="Wed, 19 Jul 2017 05:26:48 +0000"  >&lt;p&gt;I don&apos;t see a strong reason of migrating the tests to the SparkOnYarn driver: besides the remote spark client, is there anything else covered by the &lt;tt&gt;TestMiniSparkOnYarnCliDriver&lt;/tt&gt;? &lt;/p&gt;</comment>
                            <comment id="16092672" author="lirui" created="Wed, 19 Jul 2017 06:44:46 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stakiar&quot; class=&quot;user-hover&quot; rel=&quot;stakiar&quot;&gt;stakiar&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=csun&quot; class=&quot;user-hover&quot; rel=&quot;csun&quot;&gt;csun&lt;/a&gt;, there was some issue specific to yarn-cluster mode, like &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-9425&quot; title=&quot;Add jar/file doesn&amp;#39;t work with yarn-cluster mode [Spark Branch]&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-9425&quot;&gt;&lt;del&gt;HIVE-9425&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-12045&quot; title=&quot;ClassNotFoundException for GenericUDF [Spark Branch]&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-12045&quot;&gt;&lt;del&gt;HIVE-12045&lt;/del&gt;&lt;/a&gt;. I&apos;m not rushing to move from TestSparkCliDriver to TestMiniSparkOnYarnCliDriver. But basically, I think it&apos;s better to keep our tests close to real use case. BTW, even with local-cluster, the executors are still run in separate JVMs, so we can&apos;t have everything in process.&lt;/p&gt;</comment>
                            <comment id="16117628" author="xuefuz" created="Tue, 8 Aug 2017 00:42:33 +0000"  >&lt;p&gt;My take is that local is for dev, local-cluster for precommit test, and miniYarnCluster is for mimicking production. I&apos;m not sure how much it saves by switching to LocalHiveSparkClient. If that&apos;s a problem, we can consider running multiple tests with the same local-cluster.&lt;/p&gt;</comment>
                            <comment id="16179995" author="stakiar" created="Tue, 26 Sep 2017 00:20:24 +0000"  >&lt;p&gt;Attaching a patch that creates a new CLI Driver called &lt;tt&gt;TestLocalSparkCliDriver&lt;/tt&gt; which sets &lt;tt&gt;spark.master=local&lt;span class=&quot;error&quot;&gt;&amp;#91;*&amp;#93;&lt;/span&gt;&lt;/tt&gt;. Adding a very simple q test, with a few basic queries. This provides some test coverage for &lt;tt&gt;LocalHiveSparkClient&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The main advantage is that this new CLI Driver runs the entire HoS query inside a single process. This makes debugging HoS much easier. Users can set breakpoints in portions of the HoS code that are only invoked at runtime. While this does provide some coverage for &lt;tt&gt;LocalHiveSparkClient&lt;/tt&gt;, I think that main advantage is that it makes debugging HoS easier for developers, especially new developers who may not be as familiar with the HoS code and want to debug things via an IDE like IntelliJ.&lt;/p&gt;

&lt;p&gt;The patch doesn&apos;t modify anything related to the other Spark CLI Drivers.&lt;/p&gt;</comment>
                            <comment id="16180154" author="hiveqa" created="Tue, 26 Sep 2017 03:17:24 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12888976/HIVE-17111.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12888976/HIVE-17111.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 2 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 8 failed/errored test(s), 11063 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestAccumuloCliDriver - did not produce a TEST-*.xml file (likely timed out) (batchId=231)
TestDummy - did not produce a TEST-*.xml file (likely timed out) (batchId=231)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[spark_local_queries] (batchId=64)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[unionDistinct_1] (batchId=143)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[union_fast_stats] (batchId=156)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_explainuser_1] (batchId=170)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=235)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query23] (batchId=235)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6982/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6982/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6982/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6982/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-6982/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-6982/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 8 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12888976 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="16184658" author="stakiar" created="Thu, 28 Sep 2017 18:56:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lirui&quot; class=&quot;user-hover&quot; rel=&quot;lirui&quot;&gt;lirui&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pvary&quot; class=&quot;user-hover&quot; rel=&quot;pvary&quot;&gt;pvary&lt;/a&gt; could you take a look?&lt;/p&gt;</comment>
                            <comment id="16188965" author="stakiar" created="Mon, 2 Oct 2017 22:25:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vihangk1&quot; class=&quot;user-hover&quot; rel=&quot;vihangk1&quot;&gt;vihangk1&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aihuaxu&quot; class=&quot;user-hover&quot; rel=&quot;aihuaxu&quot;&gt;aihuaxu&lt;/a&gt; could you take a look?&lt;/p&gt;</comment>
                            <comment id="16195041" author="aihuaxu" created="Fri, 6 Oct 2017 19:01:28 +0000"  >&lt;p&gt;TestSparkCliDriver is testing on local cluster. TestMiniSparkOnYarnCliDriver is testing against yarn. I see the value to add TestLocalSparkCliDriver to cover LocalHiveSparkClient and also it will make debugging Spark  easier. Of course we just need one or two tests to cover it as the patch does. &lt;/p&gt;

&lt;p&gt;+1 from me.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lirui&quot; class=&quot;user-hover&quot; rel=&quot;lirui&quot;&gt;lirui&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt; How do you think?&lt;/p&gt;
</comment>
                            <comment id="16195239" author="xuefuz" created="Fri, 6 Oct 2017 21:01:05 +0000"  >&lt;p&gt;I think this is good. However, I have two questions:&lt;/p&gt;

&lt;p&gt;1. Other test driver class is generated, so I&apos;m wondering why we actually have a nongenerated class for TestLocalSparkCliDriver.&lt;br/&gt;
2. With this change, are we able to run any .q test using this test driver class?&lt;/p&gt;</comment>
                            <comment id="16195249" author="stakiar" created="Fri, 6 Oct 2017 21:09:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;blockquote&gt;&lt;p&gt; 1. Other test driver class is generated, so I&apos;m wondering why we actually have a nongenerated class for TestLocalSparkCliDriver. &lt;/p&gt;&lt;/blockquote&gt; I think that was the old way of making these classes, now you can just directly create a new Java class to make a new CLI Driver. Unless I am misunderstanding the question.&lt;/p&gt;

&lt;p&gt;&lt;blockquote&gt;&lt;p&gt; 2. With this change, are we able to run any .q test using this test driver class? &lt;/p&gt;&lt;/blockquote&gt;. Yes, the idea is that you can run any .q file with these new CLI Driver, which should help developers debug any HoS issues.&lt;/p&gt;</comment>
                            <comment id="16196761" author="pvary" created="Mon, 9 Oct 2017 09:49:11 +0000"  >&lt;p&gt;Sorry for the delay, I had other tasks which took all of my time, and some &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I think it would be useful to have the possibility to run every spark test with the local driver - so that is a plus for the TestLocalSparkCliDriver.&lt;br/&gt;
We should only add more tests, if we can be sure that it significantly improves runtime.&lt;/p&gt;

&lt;p&gt;The old method of adding new driver class is changed by &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-14444&quot; title=&quot;Upgrade qtest execution framework to junit4 - migrate most of them&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-14444&quot;&gt;&lt;del&gt;HIVE-14444&lt;/del&gt;&lt;/a&gt;, so this is the new method.&lt;/p&gt;

&lt;p&gt;So this is a +1 from me too.&lt;/p&gt;</comment>
                            <comment id="16197213" author="xuefuz" created="Mon, 9 Oct 2017 16:10:22 +0000"  >&lt;p&gt;Thanks, guys! This is cool.&lt;br/&gt;
+1&lt;/p&gt;</comment>
                            <comment id="16197846" author="stakiar" created="Mon, 9 Oct 2017 23:11:21 +0000"  >&lt;p&gt;Thanks for the reviews everyone! Pushed to master.&lt;/p&gt;</comment>
                            <comment id="16206945" author="lirui" created="Tue, 17 Oct 2017 03:01:46 +0000"  >&lt;p&gt;I think the new test needs order by to give deterministic output. Besides, should it be included in &lt;tt&gt;master-mr2.properties&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="16486012" author="vgarg" created="Tue, 22 May 2018 23:58:41 +0000"  >&lt;p&gt;Hive 3.0.0 has been released so closing this jira.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12888976" name="HIVE-17111.1.patch" size="19602" author="stakiar" created="Tue, 26 Sep 2017 00:14:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3hmef:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12340268">3.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>