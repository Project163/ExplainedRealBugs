<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:29:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-9310] CLI JLine does not flush history back to ~/.hivehistory</title>
                <link>https://issues.apache.org/jira/browse/HIVE-9310</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Hive CLI does not seem to be saving history anymore.&lt;/p&gt;

&lt;p&gt;In JLine with the PersistentHistory class, to keep history across sessions, you need to do &lt;tt&gt;reader.getHistory().flush()&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12765575">HIVE-9310</key>
            <summary>CLI JLine does not flush history back to ~/.hivehistory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gopalv">Gopal Vijayaraghavan</assignee>
                                    <reporter username="gopalv">Gopal Vijayaraghavan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Jan 2015 08:35:10 +0000</created>
                <updated>Mon, 6 Apr 2015 20:48:49 +0000</updated>
                            <resolved>Tue, 13 Jan 2015 14:59:08 +0000</resolved>
                                    <version>0.15.0</version>
                                    <fixVersion>1.1.0</fixVersion>
                                    <component>CLI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14269008" author="prasanth_j" created="Thu, 8 Jan 2015 09:02:17 +0000"  >&lt;p&gt;LGTM, +1&lt;/p&gt;</comment>
                            <comment id="14270515" author="navis" created="Fri, 9 Jan 2015 03:57:14 +0000"  >&lt;p&gt;Should it be called in shutdown hook or at least in signal handler either?&lt;/p&gt;</comment>
                            <comment id="14270726" author="hiveqa" created="Fri, 9 Jan 2015 08:02:26 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12690748/HIVE-9310.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12690748/HIVE-9310.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 1 failed/errored test(s), 6737 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hive.hcatalog.hbase.TestPigHBaseStorageHandler.org.apache.hive.hcatalog.hbase.TestPigHBaseStorageHandler
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2300/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2300/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2300/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2300/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2300/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2300/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12690748 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14270780" author="gopalv" created="Fri, 9 Jan 2015 08:52:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt;: did not want to leak the implementation out of the same class.&lt;/p&gt;

&lt;p&gt;I saw issues with ShutdownHooks and different classloaders in some other work, didn&apos;t want to go that way because there&apos;s no easy way to test these things for slow leaks.&lt;/p&gt;

&lt;p&gt;My patch is a 5-min safe fix.&lt;/p&gt;</comment>
                            <comment id="14273145" author="navis" created="Mon, 12 Jan 2015 01:48:39 +0000"  >&lt;p&gt;Ok, I got it. But still can we flush history in signal handler(&lt;a href=&quot;https://github.com/apache/hive/blob/trunk/cli/src/java/org/apache/hadoop/hive/cli/CliDriver.java#L325)?&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/blob/trunk/cli/src/java/org/apache/hadoop/hive/cli/CliDriver.java#L325)?&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14275231" author="gopalv" created="Tue, 13 Jan 2015 14:19:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt;: We can, but I had one case where my home dir hit 100% in a very old build.&lt;/p&gt;

&lt;p&gt;What happens to NOSPC IOExceptions thrown from a signal handler?&lt;/p&gt;</comment>
                            <comment id="14275282" author="gopalv" created="Tue, 13 Jan 2015 14:47:12 +0000"  >&lt;p&gt;Actually, I tried to flush in the signal handler + try/catch ignore and annoyingly it looks like it stills needs some thread synchronization.&lt;/p&gt;

&lt;p&gt;The sighandler runs as a different thread and flushes the history from a different thread while interrupting the main thread. The threading looks rather odd, but I&apos;m guessing the processLine() is called from Oozie directly as well (unlike the CLI loop).&lt;/p&gt;

&lt;p&gt;I&apos;m committing this as-is as I&apos;m tired of losing all CLI history in my test runs - need at least parity to 0.14 levels before I introduce new bugs/features.&lt;/p&gt;</comment>
                            <comment id="14275285" author="gopalv" created="Tue, 13 Jan 2015 14:48:28 +0000"  >&lt;p&gt;The test failures look unrelated - the error was a YARN exception setting up a minicluster, due to a missing dir.&lt;/p&gt;</comment>
                            <comment id="14275302" author="gopalv" created="Tue, 13 Jan 2015 14:59:08 +0000"  >&lt;p&gt;Committed to trunk. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14286424" author="prasanth_j" created="Wed, 21 Jan 2015 22:28:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gopalv&quot; class=&quot;user-hover&quot; rel=&quot;gopalv&quot;&gt;gopalv&lt;/a&gt; The flushing of the history does not seem to work. history.flush() is not getting called. Can we flush the history before processing each command? or in some other place which is reliable. &lt;/p&gt;</comment>
                            <comment id="14287088" author="gopalv" created="Thu, 22 Jan 2015 08:02:10 +0000"  >&lt;p&gt;Do you know if the history dir exists? The condition for history seems to be - if ((new File(historyDirectory)).exists()) {&lt;/p&gt;</comment>
                            <comment id="14288028" author="prasanth_j" created="Thu, 22 Jan 2015 19:16:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gopalv&quot; class=&quot;user-hover&quot; rel=&quot;gopalv&quot;&gt;gopalv&lt;/a&gt; Yes. The history dir is the user&apos;s home directory which exists. The history file .hivehistory also exists (will be created if it doesn&apos;t exist). But still the commands are not logged to the hive history file.&lt;/p&gt;

&lt;p&gt;To reproduce&lt;br/&gt;
1) Remove the .hivehistory file&lt;br/&gt;
2) Restart hive cli&lt;br/&gt;
3) Run some commands and quit cli&lt;br/&gt;
4) When we rerun the hive cli again, press up arrow nothing will show up from history. &lt;/p&gt;

&lt;p&gt;I suspect, the flushing doesn&apos;t happen because of quit command which issues System.exit(0) and quits the cli without ever calling the history.flush(). Same happens with SIGINT as well. I think we need to flush the history before processing every command. Adding the history flushing just before executing the command seems to fix the issue. I can put up a patch for it if you can confirm that the current way of flushing does not work.&lt;/p&gt;</comment>
                            <comment id="14288043" author="prasanth_j" created="Thu, 22 Jan 2015 19:21:55 +0000"  >&lt;p&gt;Or we have to flush the history before closing the session (finally block after execute cli driver).&lt;/p&gt;</comment>
                            <comment id="14288090" author="gopalv" created="Thu, 22 Jan 2015 19:45:15 +0000"  >&lt;p&gt;Ah, I exit from the loop from the CLI using a Ctrl+D &amp;amp; that actually saves history with the patch.&lt;/p&gt;

&lt;p&gt;Let me try with a &quot;quit;&quot;&lt;/p&gt;</comment>
                            <comment id="14288128" author="prasanth_j" created="Thu, 22 Jan 2015 20:01:00 +0000"  >&lt;p&gt;Ctrl + D sends EOF to input in which case history gets flushed properly.&lt;br/&gt;
Ctrl + C sends SIGINT which does not flush history. Similarly quit/exit commands does not flush.&lt;/p&gt;</comment>
                            <comment id="14481906" author="thejas" created="Mon, 6 Apr 2015 20:48:49 +0000"  >&lt;p&gt;Created &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-10225&quot; title=&quot;CLI JLine does not flush history on quit/Ctrl-C&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-10225&quot;&gt;&lt;del&gt;HIVE-10225&lt;/del&gt;&lt;/a&gt; for the other cases where the history file is still not created.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12818692">HIVE-10225</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12690748" name="HIVE-9310.1.patch" size="1641" author="gopalv" created="Thu, 8 Jan 2015 08:40:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 33 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i242fz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Flush hive CLI history to disk on exit</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>