<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:53:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-16572] Rename a partition should not drop its column stats</title>
                <link>https://issues.apache.org/jira/browse/HIVE-16572</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The column stats for the table sample_pt partition (dummy=1) is as following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;hive&amp;gt; describe formatted sample_pt partition (dummy=1) code;
OK
# col_name            	data_type           	min                 	max                 	num_nulls           	distinct_count      	avg_col_len         	max_col_len         	num_trues           	num_falses          	comment             
	 	 	 	 	 	 	 	 	 	 
code                	string              	                    	                    	0                   	303                 	6.985               	7                   	                    	                    	from deserializer   
Time taken: 0.259 seconds, Fetched: 3 row(s)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But when this partition is renamed, say&lt;br/&gt;
alter table sample_pt partition (dummy=1) rename to partition (dummy=11);&lt;br/&gt;
The COLUMN_STATS in partition description are true, but column stats are actually all deleted.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;hive&amp;gt; describe formatted sample_pt partition (dummy=11);
OK
# col_name            	data_type           	comment             
	 	 
code                	string              	                    
description         	string              	                    
salary              	&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;                 	                    
total_emp           	&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;                 	                    
	 	 
# Partition Information	 	 
# col_name            	data_type           	comment             
	 	 
dummy               	&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;                 	                    
	 	 
# Detailed Partition Information	 	 
Partition Value:    	[11]                	 
Database:           	&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;             	 
Table:              	sample_pt           	 
CreateTime:         	Thu Mar 30 23:03:59 EDT 2017	 
LastAccessTime:     	UNKNOWN             	 
Location:           	file:/user/hive/warehouse/apache/sample_pt/dummy=11	 
Partition Parameters:	 	 
	COLUMN_STATS_ACCURATE	{\&lt;span class=&quot;code-quote&quot;&gt;&quot;BASIC_STATS\&quot;&lt;/span&gt;:\&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;\&quot;&lt;/span&gt;,\&lt;span class=&quot;code-quote&quot;&gt;&quot;COLUMN_STATS\&quot;&lt;/span&gt;:{\&lt;span class=&quot;code-quote&quot;&gt;&quot;code\&quot;&lt;/span&gt;:\&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;\&quot;&lt;/span&gt;,\&lt;span class=&quot;code-quote&quot;&gt;&quot;description\&quot;&lt;/span&gt;:\&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;\&quot;&lt;/span&gt;,\&lt;span class=&quot;code-quote&quot;&gt;&quot;salary\&quot;&lt;/span&gt;:\&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;\&quot;&lt;/span&gt;,\&lt;span class=&quot;code-quote&quot;&gt;&quot;total_emp\&quot;&lt;/span&gt;:\&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;\&quot;&lt;/span&gt;}}
	numFiles            	1                   
	numRows             	200                 
	rawDataSize         	10228               
	totalSize           	10428               
	transient_lastDdlTime	1490929439          
	 	 
# Storage Information	 	 
SerDe Library:      	org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe	 
InputFormat:        	org.apache.hadoop.mapred.TextInputFormat	 
OutputFormat:       	org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat	 
Compressed:         	No                  	 
Num Buckets:        	-1                  	 
Bucket Columns:     	[]                  	 
Sort Columns:       	[]                  	 
Storage Desc Params:	 	 
	serialization.format	1                   
Time taken: 6.783 seconds, Fetched: 37 row(s)

===
hive&amp;gt; describe formatted sample_pt partition (dummy=11) code;
OK
# col_name            	data_type           	comment             	 	 	 	 	 	 	 	 
	 	 	 	 	 	 	 	 	 	 
code                	string              	from deserializer   	 	 	 	 	 	 	 	 
Time taken: 9.429 seconds, Fetched: 3 row(s)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The column stats should not be drop when a partition is renamed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13068626">HIVE-16572</key>
            <summary>Rename a partition should not drop its column stats</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ctang">Chaoyu Tang</assignee>
                                    <reporter username="ctang">Chaoyu Tang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 May 2017 02:31:42 +0000</created>
                <updated>Tue, 22 May 2018 23:58:41 +0000</updated>
                            <resolved>Tue, 9 May 2017 15:41:22 +0000</resolved>
                                                    <fixVersion>2.4.0</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                    <component>Statistics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15995710" author="ctang.ma" created="Wed, 3 May 2017 21:25:35 +0000"  >&lt;p&gt;The patch is to do following:&lt;br/&gt;
1. keep the partition column stats when a partition is renamed&lt;br/&gt;
2. refactor the partition renaming logic. We move the partition directory before committing the HMS transaction, since it will be easier to revert the data moving in a rename failure.&lt;/p&gt;</comment>
                            <comment id="15995953" author="hiveqa" created="Thu, 4 May 2017 00:25:30 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12866271/HIVE-16572.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12866271/HIVE-16572.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 10648 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[rename_external_partition_location] (batchId=46)
org.apache.hadoop.hive.cli.TestHBaseCliDriver.testCliDriver[external_table_ppd] (batchId=90)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_if_expr] (batchId=143)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/5031/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/5031/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/5031/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/5031/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-5031/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-5031/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12866271 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15996785" author="ctang.ma" created="Thu, 4 May 2017 14:15:27 +0000"  >&lt;p&gt;Fixed the failure for test rename_external_partition_location.q, and added more tests for renaming a partition in an external table.&lt;br/&gt;
The other two test failures are not related to this patch, I was not able to reproduce in my local machine.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pxiong&quot; class=&quot;user-hover&quot; rel=&quot;pxiong&quot;&gt;pxiong&lt;/a&gt; could you help to review the patch? Thanks&lt;/p&gt;</comment>
                            <comment id="15999496" author="hiveqa" created="Sat, 6 May 2017 17:10:47 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12866411/HIVE-16572.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12866411/HIVE-16572.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 2 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 1 failed/errored test(s), 10652 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_if_expr] (batchId=143)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/5079/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/5079/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/5079/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/5079/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-5079/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-5079/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12866411 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15999650" author="ctang.ma" created="Sun, 7 May 2017 01:53:28 +0000"  >&lt;p&gt;The test failure is not related to the patch.&lt;/p&gt;</comment>
                            <comment id="16000866" author="ychena" created="Mon, 8 May 2017 15:00:39 +0000"  >&lt;p&gt;LGTM  +1&lt;/p&gt;</comment>
                            <comment id="16002905" author="ctang.ma" created="Tue, 9 May 2017 15:41:22 +0000"  >&lt;p&gt;Committed to 3.0.0and 2.4.0. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;ychena&lt;/a&gt; for review.&lt;/p&gt;</comment>
                            <comment id="16486010" author="vgarg" created="Tue, 22 May 2018 23:58:41 +0000"  >&lt;p&gt;Hive 3.0.0 has been released so closing this jira.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12866411" name="HIVE-16572.1.patch" size="75762" author="ctang" created="Thu, 4 May 2017 14:15:27 +0000"/>
                            <attachment id="12866271" name="HIVE-16572.patch" size="63428" author="ctang" created="Wed, 3 May 2017 21:25:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3eefr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>