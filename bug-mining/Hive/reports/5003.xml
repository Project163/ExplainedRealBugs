<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:48:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-15139] HoS local mode fails with NumberFormatException</title>
                <link>https://issues.apache.org/jira/browse/HIVE-15139</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;It&apos;s because we store &lt;tt&gt;stageId_attemptNum&lt;/tt&gt; in JobMetricsListener but expect only &lt;tt&gt;stageId&lt;/tt&gt; in LocalSparkJobStatus.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.NumberFormatException: For input string: &quot;0_0&quot;
	at java.lang.NumberFormatException.forInputString(NumberFormatException.java:65)
	at java.lang.Integer.parseInt(Integer.java:580)
	at java.lang.Integer.parseInt(Integer.java:615)
	at org.apache.hadoop.hive.ql.exec.spark.status.impl.LocalSparkJobStatus.getSparkStatistics(LocalSparkJobStatus.java:146)
	at org.apache.hadoop.hive.ql.exec.spark.SparkTask.execute(SparkTask.java:104)
	at org.apache.hadoop.hive.ql.exec.Task.executeTask(Task.java:199)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13018777">HIVE-15139</key>
            <summary>HoS local mode fails with NumberFormatException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lirui">Rui Li</assignee>
                                    <reporter username="lirui">Rui Li</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Nov 2016 08:52:34 +0000</created>
                <updated>Fri, 21 Jul 2017 18:26:25 +0000</updated>
                            <resolved>Wed, 9 Nov 2016 02:34:57 +0000</resolved>
                                                    <fixVersion>2.3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15643558" author="lirui" created="Mon, 7 Nov 2016 09:00:12 +0000"  >&lt;p&gt;I think we can only store the stageId in the map, because that&apos;s what we need later.&lt;br/&gt;
The patch also does some simple refactor.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chinnalalam&quot; class=&quot;user-hover&quot; rel=&quot;chinnalalam&quot;&gt;chinnalalam&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chengxiang+li&quot; class=&quot;user-hover&quot; rel=&quot;chengxiang li&quot;&gt;chengxiang li&lt;/a&gt; could you take a look? Thanks.&lt;/p&gt;</comment>
                            <comment id="15643990" author="hiveqa" created="Mon, 7 Nov 2016 12:04:11 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12837714/HIVE-15139.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12837714/HIVE-15139.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 4 failed/errored test(s), 10628 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[join_acid_non_acid] (batchId=150)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[union_fast_stats] (batchId=145)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_2] (batchId=91)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_5] (batchId=90)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1998/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1998/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1998/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1998/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-1998/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-1998/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12837714 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15644452" author="ctang.ma" created="Mon, 7 Nov 2016 15:18:52 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lirui&quot; class=&quot;user-hover&quot; rel=&quot;lirui&quot;&gt;lirui&lt;/a&gt; for the patch, it looks good to me. I ran into the exactly same issue when playing with the HoS statistics, and worked it around by passing 0 instead of Integer.parseInt(stageId) to metricsCollection.addMetrics just like the taskId. I thought stageId would not be used anyway when we get all metrics from metricsCollection (metricsCollection.getAllMetrics()) in getSparkStatistics. My change is like following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@@ -143,7 +143,7 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; SparkStatistics getSparkStatistics() {
       List&amp;lt;TaskMetrics&amp;gt; taskMetrics = jobMetric.get(stageId);
       &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (TaskMetrics taskMetric : taskMetrics) {
         Metrics metrics = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Metrics(taskMetric);
-        metricsCollection.addMetrics(jobId, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.parseInt(stageId), 0, metrics);
+        metricsCollection.addMetrics(jobId, 0, 0, metrics);
       }
     }
     SparkJobUtils sparkJobUtils = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SparkJobUtils();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Your patch removes the stageAttemptId from jobMetrics, I wonder if it might still be useful for some other metrics (e.g. average times a stage attempted)? It is my first time to look into HoS, I wonder if my question makes sense. Thanks.&lt;/p&gt;</comment>
                            <comment id="15646213" author="lirui" created="Tue, 8 Nov 2016 02:30:47 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ctang.ma&quot; class=&quot;user-hover&quot; rel=&quot;ctang.ma&quot;&gt;ctang.ma&lt;/a&gt;, thanks for the review. Yeah your solution also works, like you said, the stageId is not used when aggregating all the metrics. But it&apos;s also no harm to pass the actual stageId which we have already stored in the map.&lt;br/&gt;
Why I remove the attempt number is because what we expect is just the stageId down the road, e.g. in &lt;tt&gt;TaskInfo&lt;/tt&gt;, &lt;tt&gt;MetricsCollection&lt;/tt&gt; etc. That means currently we don&apos;t differentiate multiple attempts for a single stage, in terms of metrics.&lt;br/&gt;
In remote mode, we also only collect the stageId. You can refer to the &lt;tt&gt;ClientListener&lt;/tt&gt; in RemoteDriver. So this will make local mode consistent with remote mode.&lt;/p&gt;</comment>
                            <comment id="15646367" author="xuefuz" created="Tue, 8 Nov 2016 03:38:32 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lirui&quot; class=&quot;user-hover&quot; rel=&quot;lirui&quot;&gt;lirui&lt;/a&gt;, thanks for working on this. The patch looks good. Just curious, the problem happens just now because of recent changes (on insertion error on task attemps)?&lt;/p&gt;</comment>
                            <comment id="15646369" author="ctang.ma" created="Tue, 8 Nov 2016 03:38:55 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lirui&quot; class=&quot;user-hover&quot; rel=&quot;lirui&quot;&gt;lirui&lt;/a&gt; for the explanation. Yeah, the ClientLister collects both the stageId and taskId.&lt;br/&gt;
LGTM, +1.&lt;/p&gt;</comment>
                            <comment id="15646385" author="lirui" created="Tue, 8 Nov 2016 03:49:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt;, no it&apos;s actually related to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-12205&quot; title=&quot;Spark: unify spark statististics aggregation between local and remote spark client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-12205&quot;&gt;&lt;del&gt;HIVE-12205&lt;/del&gt;&lt;/a&gt;. It only happens with local mode. So I guess it&apos;s not reported because local mode is rarely used. And I happened to hit it when I&apos;m working on &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-14825&quot; title=&quot;Figure out the minimum set of required jars for Hive on Spark after bumping up to Spark 2.0.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-14825&quot;&gt;&lt;del&gt;HIVE-14825&lt;/del&gt;&lt;/a&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15646392" author="ctang.ma" created="Tue, 8 Nov 2016 03:54:19 +0000"  >&lt;p&gt;BTW, what the mode we usually use when we develop something on HoS in local env? Is there a better way other than local mode?&lt;/p&gt;</comment>
                            <comment id="15646403" author="lirui" created="Tue, 8 Nov 2016 04:00:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ctang.ma&quot; class=&quot;user-hover&quot; rel=&quot;ctang.ma&quot;&gt;ctang.ma&lt;/a&gt;, usually we use yarn mode (either yarn-client or yarn-cluster). You can setup a single-node cluster in your local env for development. Local mode is kept only for the purpose of debugging. And it&apos;s been broken for a while: &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-13301&quot; title=&quot;Hive on spark local mode broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-13301&quot;&gt;&lt;del&gt;HIVE-13301&lt;/del&gt;&lt;/a&gt;. But seems I can have it work again with Spark 2.0.&lt;/p&gt;</comment>
                            <comment id="15646423" author="ctang.ma" created="Tue, 8 Nov 2016 04:08:32 +0000"  >&lt;p&gt;Great, many thanks.&lt;/p&gt;</comment>
                            <comment id="15646692" author="lirui" created="Tue, 8 Nov 2016 06:37:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ctang.ma&quot; class=&quot;user-hover&quot; rel=&quot;ctang.ma&quot;&gt;ctang.ma&lt;/a&gt; - no problem.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt;, I&apos;ll commit this if you have no further comments.&lt;/p&gt;</comment>
                            <comment id="15648078" author="xuefuz" created="Tue, 8 Nov 2016 16:51:14 +0000"  >&lt;p&gt;+1. Thanks for fixing this.&lt;/p&gt;</comment>
                            <comment id="15649599" author="lirui" created="Wed, 9 Nov 2016 02:34:57 +0000"  >&lt;p&gt;Committed to master. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ctang.ma&quot; class=&quot;user-hover&quot; rel=&quot;ctang.ma&quot;&gt;ctang.ma&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt; for the review!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12837714" name="HIVE-15139.1.patch" size="14446" author="lirui" created="Mon, 7 Nov 2016 09:00:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35zt3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>