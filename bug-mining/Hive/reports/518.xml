<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:57:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-1830] mappers in group followed by joins may die OOM</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1830</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description></description>
                <environment></environment>
        <key id="12492130">HIVE-1830</key>
            <summary>mappers in group followed by joins may die OOM</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="liyin">Liyin Tang</assignee>
                                    <reporter username="namit">Namit Jain</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Dec 2010 07:01:53 +0000</created>
                <updated>Sun, 25 Jan 2015 00:23:24 +0000</updated>
                            <resolved>Thu, 9 Dec 2010 06:10:07 +0000</resolved>
                                                    <fixVersion>0.7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12967105" author="namit" created="Mon, 6 Dec 2010 07:08:59 +0000"  >&lt;p&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1642&quot; title=&quot;Convert join queries to map-join based on size of table/row&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1642&quot;&gt;&lt;del&gt;HIVE-1642&lt;/del&gt;&lt;/a&gt;, joins are automatically converted into map-joins at physical optimization time.&lt;/p&gt;

&lt;p&gt;However, this may lead to problems.&lt;/p&gt;


&lt;p&gt;For eg:  consider the query:&lt;/p&gt;

&lt;p&gt;select T1.val, count(1) from T1 join T2 on T1.key=T2.key group by T1.val&lt;/p&gt;


&lt;p&gt;This will have 2 map-reduce jobs, one for the join and the other for group by.&lt;/p&gt;

&lt;p&gt;Before &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1642&quot; title=&quot;Convert join queries to map-join based on size of table/row&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1642&quot;&gt;&lt;del&gt;HIVE-1642&lt;/del&gt;&lt;/a&gt;, the partial group for aggregation will be performed in the reducer where the join is performed.&lt;br/&gt;
However, after &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1642&quot; title=&quot;Convert join queries to map-join based on size of table/row&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1642&quot;&gt;&lt;del&gt;HIVE-1642&lt;/del&gt;&lt;/a&gt;, the same will be performed in the mapper. The local task will confirm that there is  just&lt;br/&gt;
enough memory to hold the map-join data. Hoever, it does not take into account the memory needed for partial group&lt;br/&gt;
by.&lt;/p&gt;

&lt;p&gt;So, in case there is group by followed by join, it is a good idea to reduce the memory given to the local task to validate&lt;br/&gt;
if there is enough memory to fit small table - it can be controlled by a new configuration paramter, but it can be some&lt;br/&gt;
default: say 70% of total memory (instead of 90%).&lt;/p&gt;

&lt;p&gt;Also, the group by may still run out of memory, so it might be a good idea to check in group by for free memory and&lt;br/&gt;
periodically flush memory&lt;/p&gt;</comment>
                            <comment id="12968529" author="liyin" created="Tue, 7 Dec 2010 01:18:51 +0000"  >&lt;p&gt;Add a new test: auto_join26.q &lt;/p&gt;</comment>
                            <comment id="12968538" author="liyin" created="Tue, 7 Dec 2010 01:51:29 +0000"  >&lt;p&gt;Carefully measure the memory usage of map side group by.&lt;br/&gt;
Flush frequently, if the left memory is less than a threshold.&lt;/p&gt;</comment>
                            <comment id="12969061" author="namit" created="Tue, 7 Dec 2010 22:56:25 +0000"  >&lt;p&gt;I will take a look &lt;/p&gt;</comment>
                            <comment id="12969070" author="namit" created="Tue, 7 Dec 2010 23:06:36 +0000"  >&lt;p&gt;Add the new parameters description in hive-default.xml.&lt;br/&gt;
Move the memory threshold in the descriptors (for eg. all the needed confs should be copied in groupbydesc.&lt;br/&gt;
and accessed from there, instead of being accessed from HiveConf at runtime) - you already did it from&lt;br/&gt;
HashTableSinkOperator&lt;/p&gt;</comment>
                            <comment id="12969124" author="liyin" created="Wed, 8 Dec 2010 01:22:08 +0000"  >&lt;p&gt;1) Add more descriptions in the config file&lt;br/&gt;
2) Set the memory usage of hashtable sink op and group by op into their desc. &lt;br/&gt;
The memory usage is deterministic after compiling stage.&lt;/p&gt;</comment>
                            <comment id="12969203" author="namit" created="Wed, 8 Dec 2010 06:29:11 +0000"  >&lt;p&gt;      if (groupByOp.getConf() == null) &lt;/p&gt;
{
91	        System.out.println(&quot;Group by desc is null&quot;);
92	        return null;
93	      }




&lt;p&gt;This should never happen&lt;/p&gt;


&lt;p&gt;GroupByOperator:&lt;br/&gt;
    memoryThreshold = HiveConf.getFloatVar(hconf, HiveConf.ConfVars.HIVEMAPAGGRM&#11013;&lt;br/&gt;
EMORYTHRESHOLD);&lt;/p&gt;


&lt;p&gt;This should also be in groupByDesc&lt;/p&gt;
</comment>
                            <comment id="12969433" author="liyin" created="Wed, 8 Dec 2010 19:19:26 +0000"  >&lt;p&gt;1) Remove the debug statements&lt;br/&gt;
2) Add the memory threshold to group by desc.&lt;/p&gt;</comment>
                            <comment id="12969549" author="namit" created="Wed, 8 Dec 2010 23:12:56 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12969634" author="namit" created="Thu, 9 Dec 2010 06:10:06 +0000"  >&lt;p&gt;Committed. Thanks Liyin&lt;/p&gt;</comment>
                            <comment id="14290901" author="lefty@hortonworks.com" created="Sun, 25 Jan 2015 00:23:24 +0000"  >&lt;p&gt;Doc note:  This added three configuration parameters to HiveConf.java, with descriptions in the template file.  They are documented in the wiki.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.mapjoin.followby.map.aggr.hash.percentmemory&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;hive.mapjoin.followby.map.aggr.hash.percentmemory &lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.map.aggr.hash.force.flush.memory.threshold&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;hive.map.aggr.hash.force.flush.memory.threshold &lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.mapjoin.followby.gby.localtask.max.memory.usage&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;hive.mapjoin.followby.gby.localtask.max.memory.usage &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12465645" name="hive-1830-1.patch" size="35642" author="liyin" created="Tue, 7 Dec 2010 01:16:42 +0000"/>
                            <attachment id="12465646" name="hive-1830-2.patch" size="47158" author="liyin" created="Tue, 7 Dec 2010 01:18:51 +0000"/>
                            <attachment id="12465651" name="hive-1830-3.patch" size="49559" author="liyin" created="Tue, 7 Dec 2010 01:51:29 +0000"/>
                            <attachment id="12465767" name="hive-1830-4.patch" size="58024" author="liyin" created="Wed, 8 Dec 2010 01:22:08 +0000"/>
                            <attachment id="12465822" name="hive-1830-5.patch" size="58817" author="liyin" created="Wed, 8 Dec 2010 19:19:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72677</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 43 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lh5r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123430</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>