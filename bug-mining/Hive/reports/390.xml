<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:55:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-1116] bug with alter table rename when table has property EXTERNAL=FALSE</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1116</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;if the location is not an external location - this would be safer.&lt;/p&gt;

&lt;p&gt;the problem right now is that it&apos;s tricky to use the drop and rename way of writing new data into a table. consider:&lt;/p&gt;

&lt;p&gt;Initialization block:&lt;br/&gt;
drop table a_tmp&lt;br/&gt;
create table a_tmp like a;&lt;/p&gt;

&lt;p&gt;Loading block:&lt;br/&gt;
load data &amp;lt;newdata&amp;gt; into a_tmp;&lt;br/&gt;
drop table a;&lt;br/&gt;
alter table a_tmp rename to a;&lt;/p&gt;

&lt;p&gt;this looks safe. but it&apos;s not. if one runs this multiple times - then data is lost (since &apos;a&apos; is pointing to &apos;a_tmp&apos;&apos;s location after any iteration. and dropping table &apos;a&apos; blows away loaded data in the next iteration). &lt;/p&gt;

&lt;p&gt;if the location is being managed by Hive - then &apos;rename&apos; should switch location as well.&lt;/p&gt;






</description>
                <environment></environment>
        <key id="12446926">HIVE-1116</key>
            <summary>bug with alter table rename when table has property EXTERNAL=FALSE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jvs">John Sichi</assignee>
                                    <reporter username="jsensarma">Joydeep Sen Sarma</reporter>
                        <labels>
                    </labels>
                <created>Thu, 28 Jan 2010 16:49:49 +0000</created>
                <updated>Sat, 17 Dec 2011 00:03:32 +0000</updated>
                            <resolved>Wed, 12 May 2010 23:01:46 +0000</resolved>
                                    <version>0.5.0</version>
                                    <fixVersion>0.6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12805985" author="prasadc" created="Thu, 28 Jan 2010 17:03:10 +0000"  >&lt;p&gt;I remember doing this quite sometime ago(only for non-external tables). Are you sure it doesn&apos;t work in any scenario?&lt;/p&gt;</comment>
                            <comment id="12806063" author="zshao" created="Thu, 28 Jan 2010 20:02:18 +0000"  >&lt;p&gt;I think this is fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-592&quot; title=&quot;renaming internal table should rename HDFS and also change path of the table and partitions accordingly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-592&quot;&gt;&lt;del&gt;HIVE-592&lt;/del&gt;&lt;/a&gt;. We need to verify it&apos;s actually fixed or not.&lt;/p&gt;</comment>
                            <comment id="12806073" author="jsensarma" created="Thu, 28 Jan 2010 20:24:03 +0000"  >&lt;p&gt;yeah - positive.  it might work &apos;once&apos;. but if u repeat the recipe - it will fail because &apos;a&apos; points to &apos;a_tmp&apos; next time.&lt;/p&gt;</comment>
                            <comment id="12806074" author="jsensarma" created="Thu, 28 Jan 2010 20:24:36 +0000"  >&lt;p&gt;yeah - positive.  it might work &apos;once&apos;. but if u repeat the recipe - it will fail because &apos;a&apos; points to &apos;a_tmp&apos; next time.&lt;/p&gt;</comment>
                            <comment id="12806075" author="jsensarma" created="Thu, 28 Jan 2010 20:25:14 +0000"  >&lt;p&gt;interesting - i am hitting on our internal clusters. 592 seems pretty old.&lt;/p&gt;</comment>
                            <comment id="12863436" author="jvs" created="Mon, 3 May 2010 18:09:41 +0000"  >&lt;p&gt;Joydeep is correct; there is still a bug here.&lt;/p&gt;

&lt;p&gt;This works:&lt;/p&gt;

&lt;p&gt;create table a(i int);&lt;br/&gt;
alter table a rename to b;&lt;br/&gt;
describe extended a;&lt;/p&gt;

&lt;p&gt;But this does not:&lt;/p&gt;

&lt;p&gt;create table a(i int);&lt;br/&gt;
create table c like a;&lt;br/&gt;
alter table c rename to d;&lt;br/&gt;
describe extended d;&lt;/p&gt;

&lt;p&gt;Nor does this:&lt;/p&gt;

&lt;p&gt;create table a (int);&lt;br/&gt;
alter table a set tblproperties (&apos;EXTERNAL&apos; = &apos;FALSE&apos;);&lt;br/&gt;
alter table a rename to e;&lt;br/&gt;
describe extended e;&lt;/p&gt;

&lt;p&gt;Here&apos;s what is going on.  &lt;/p&gt;

&lt;p&gt;(1) When ALTER TABLE RENAME sees a table with the &apos;EXTERNAL&apos; property (regardless of the value), it treats it as an external table and does not do the relocation.  This is incorrect, since when &apos;EXTERNAL&apos; = &apos;FALSE&apos;, it is not an external table.&lt;/p&gt;

&lt;p&gt;(2) CREATE TABLE LIKE always adds an EXTERNAL property (setting it to FALSE unless the table is an external table).&lt;/p&gt;

&lt;p&gt;So, the bug will typically only show up on a table which was originally created with CREATE TABLE LIKE and then renamed.&lt;/p&gt;</comment>
                            <comment id="12863960" author="jvs" created="Tue, 4 May 2010 19:29:39 +0000"  >&lt;p&gt;Passed tests.&lt;/p&gt;</comment>
                            <comment id="12866671" author="namit" created="Wed, 12 May 2010 18:10:12 +0000"  >&lt;p&gt;+1&lt;/p&gt;
</comment>
                            <comment id="12866779" author="namit" created="Wed, 12 May 2010 23:01:46 +0000"  >&lt;p&gt;Committed. Thanks John&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12429128">HIVE-592</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12443499" name="HIVE-1116.1.patch" size="16097" author="jvs" created="Mon, 3 May 2010 21:04:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73094</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 28 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ldh3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>122833</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>