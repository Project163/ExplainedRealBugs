<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:45:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-13862] org.apache.hadoop.hive.metastore.MetaStoreDirectSql.getNumPartitionsViaSqlFilter falls back to ORM </title>
                <link>https://issues.apache.org/jira/browse/HIVE-13862</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;We are seeing following exception and calls fall back to ORM which make it costly :&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; WARN  org.apache.hadoop.hive.metastore.ObjectStore - Direct SQL failed, falling back to ORM
java.lang.ClassCastException: org.datanucleus.store.rdbms.query.ForwardQueryResult cannot be cast to java.lang.Number
        at org.apache.hadoop.hive.metastore.MetaStoreDirectSql.extractSqlInt(MetaStoreDirectSql.java:892) ~[hive-exec-2.1.2-inm-SNAPSHOT.jar:2.1.2-inm-SNAPSHOT]
        at org.apache.hadoop.hive.metastore.MetaStoreDirectSql.getNumPartitionsViaSqlFilterInternal(MetaStoreDirectSql.java:855) ~[hive-exec-2.1.2-inm-SNAPSHOT.jar:2.1.2-inm-SNAPSHOT]
        at org.apache.hadoop.hive.metastore.MetaStoreDirectSql.getNumPartitionsViaSqlFilter(MetaStoreDirectSql.java:405) ~[hive-exec-2.1.2-inm-SNAPSHOT.jar:2.1.2-inm-SNAPSHOT]
        at org.apache.hadoop.hive.metastore.ObjectStore$5.getSqlResult(ObjectStore.java:2763) ~[hive-exec-2.1.2-inm-SNAPSHOT.jar:2.1.2-inm-SNAPSHOT]
        at org.apache.hadoop.hive.metastore.ObjectStore$5.getSqlResult(ObjectStore.java:2755) ~[hive-exec-2.1.2-inm-SNAPSHOT.jar:2.1.2-inm-SNAPSHOT]
        at org.apache.hadoop.hive.metastore.ObjectStore$GetHelper.run(ObjectStore.java:2606) ~[hive-exec-2.1.2-inm-SNAPSHOT.jar:2.1.2-inm-SNAPSHOT]
        at org.apache.hadoop.hive.metastore.ObjectStore.getNumPartitionsByFilterInternal(ObjectStore.java:2770) [hive-exec-2.1.2-inm-SNAPSHOT.jar:2.1.2-inm-SNAPSHOT]
        at org.apache.hadoop.hive.metastore.ObjectStore.getNumPartitionsByFilter(ObjectStore.java:2746) [hive-exec-2.1.2-inm-SNAPSHOT.jar:2.1.2-inm-SNAPSHOT]

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12973057">HIVE-13862</key>
            <summary>org.apache.hadoop.hive.metastore.MetaStoreDirectSql.getNumPartitionsViaSqlFilter falls back to ORM </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="prongs">Rajat Khandelwal</assignee>
                                    <reporter username="amareshwari">Amareshwari Sriramadasu</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 May 2016 13:05:02 +0000</created>
                <updated>Tue, 27 Feb 2024 22:24:01 +0000</updated>
                            <resolved>Fri, 3 Jun 2016 04:47:30 +0000</resolved>
                                                    <fixVersion>2.1.0</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15302044" author="amareshwari" created="Thu, 26 May 2016 13:08:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jcamachorodriguez&quot; class=&quot;user-hover&quot; rel=&quot;jcamachorodriguez&quot;&gt;jcamachorodriguez&lt;/a&gt;, We would like to get this in 2.1.0 release. &lt;/p&gt;</comment>
                            <comment id="15302046" author="jcamacho" created="Thu, 26 May 2016 13:11:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=amareshwari&quot; class=&quot;user-hover&quot; rel=&quot;amareshwari&quot;&gt;amareshwari&lt;/a&gt;, thanks for letting me know. I plan to create the first RC beginning next week; there should be time to get it in.&lt;/p&gt;</comment>
                            <comment id="15302171" author="prongs" created="Thu, 26 May 2016 14:41:35 +0000"  >&lt;p&gt;Simple enough patch. &lt;/p&gt;</comment>
                            <comment id="15302745" author="sershe" created="Thu, 26 May 2016 19:24:03 +0000"  >&lt;p&gt;Hmm. I wonder how (and if &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;) it ever worked. Could the list result be DB-specific, or is this the bug for all DBs?&lt;br/&gt;
IIRC some methods use a call on the query object that forces a single result, that may be a better option here.&lt;/p&gt;</comment>
                            <comment id="15303484" author="amareshwari" created="Fri, 27 May 2016 04:57:33 +0000"  >&lt;p&gt;Yeah.. seems it was always falling to back to ORM - and never worked with directsql earlier with &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11487&quot; title=&quot;Add getNumPartitionsByFilter api in metastore api&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11487&quot;&gt;&lt;del&gt;HIVE-11487&lt;/del&gt;&lt;/a&gt;. I dont think we have a way to test whether api is answered from directsql vs orm in unit tests.&lt;/p&gt;

&lt;p&gt;btw, we deployed the above fix in our production environment, and it is working fine.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;IIRC some methods use a call on the query object that forces a single result, that may be a better option here.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Didnt find any. Can you give more pointers?&lt;/p&gt;</comment>
                            <comment id="15303586" author="prongs" created="Fri, 27 May 2016 06:07:13 +0000"  >&lt;p&gt;Just to reaffirm the gravity of this fix, in our production, we had a box with both mysql and hive metastore running. Without this fix, both processes are continuously using 500-600 percent cpu each. After deploying this, the total cpu usage for both processes is around 50. &lt;/p&gt;</comment>
                            <comment id="15304549" author="sershe" created="Fri, 27 May 2016 18:49:29 +0000"  >&lt;p&gt;query.setUnique(true);&lt;/p&gt;

&lt;p&gt;See e.g. isViewTable&lt;/p&gt;</comment>
                            <comment id="15305192" author="prongs" created="Sat, 28 May 2016 05:42:39 +0000"  >&lt;p&gt;Updated the patch. &lt;/p&gt;</comment>
                            <comment id="15308361" author="jcamacho" created="Tue, 31 May 2016 19:00:29 +0000"  >&lt;p&gt;Removing 2.1.0 target as issue is not tagged as Critical/Blocker and the RC will be created tomorrow. Please feel free to commit to branch-2.1 anyway and fix for 2.1.0 if this happens before the release.&lt;/p&gt;</comment>
                            <comment id="15308402" author="sershe" created="Tue, 31 May 2016 19:14:04 +0000"  >&lt;p&gt;+1. This should be in 2.1&lt;/p&gt;</comment>
                            <comment id="15309243" author="amareshwari" created="Wed, 1 Jun 2016 04:36:45 +0000"  >&lt;p&gt;+1 for the patch. Waiting for Hive QA builds to happen. But no response from Hive QA for last 3 days.&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jcamachorodriguez&quot; class=&quot;user-hover&quot; rel=&quot;jcamachorodriguez&quot;&gt;jcamachorodriguez&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="15310042" author="prongs" created="Wed, 1 Jun 2016 09:44:26 +0000"  >&lt;p&gt;Some issue in the pre-commit job. This issue wasn&apos;t added to pre-commit queue. This has happened to me before in another hive issue was working on. I&apos;ve added manually now. &lt;/p&gt;</comment>
                            <comment id="15312884" author="hiveqa" created="Thu, 2 Jun 2016 19:08:38 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12806796/HIVE-13862.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12806796/HIVE-13862.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 8 failed/errored test(s), 10197 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestHWISessionManager - did not produce a TEST-*.xml file
TestJdbcWithMiniHA - did not produce a TEST-*.xml file
TestJdbcWithMiniMr - did not produce a TEST-*.xml file
TestOperationLoggingAPIWithTez - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_multiinsert
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_constprog_partitioner
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_index_bitmap3
org.apache.hadoop.hive.llap.security.TestLlapSignerImpl.testSigning
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-54-177-240-2.us-west-1.compute.amazonaws.com/job/PreCommit-HIVE-MASTER-Build/500/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-54-177-240-2.us-west-1.compute.amazonaws.com/job/PreCommit-HIVE-MASTER-Build/500/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-54-177-240-2.us-west-1.compute.amazonaws.com/job/PreCommit-HIVE-MASTER-Build/500/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-54-177-240-2.us-west-1.compute.amazonaws.com/job/PreCommit-HIVE-MASTER-Build/500/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-500/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-500/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 8 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12806796 - PreCommit-HIVE-MASTER-Build&lt;/p&gt;</comment>
                            <comment id="15313570" author="amareshwari" created="Fri, 3 Jun 2016 04:47:31 +0000"  >&lt;p&gt;Committed. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prongs&quot; class=&quot;user-hover&quot; rel=&quot;prongs&quot;&gt;prongs&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jcamachorodriguez&quot; class=&quot;user-hover&quot; rel=&quot;jcamachorodriguez&quot;&gt;jcamachorodriguez&lt;/a&gt;, Have merged in master and branch-2.1, Please include if you are putting up one more RC, if not please change the fix version to 2.1.1.&lt;br/&gt;
Thanks!&lt;/p&gt;</comment>
                            <comment id="15313574" author="amareshwari" created="Fri, 3 Jun 2016 04:49:46 +0000"  >&lt;p&gt;I see release-2.1.0-rc1 tag is already created. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jcamachorodriguez&quot; class=&quot;user-hover&quot; rel=&quot;jcamachorodriguez&quot;&gt;jcamachorodriguez&lt;/a&gt;, Changed fix version to 2.1.1 - Please change if there is another RC for 2.1.0. Thanks&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12852568">HIVE-11487</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12806796" name="HIVE-13862.1.patch" size="787" author="prongs" created="Sat, 28 May 2016 05:42:25 +0000"/>
                            <attachment id="12806389" name="HIVE-13862.patch" size="869" author="prongs" created="Thu, 26 May 2016 14:41:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 24 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2yjev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>