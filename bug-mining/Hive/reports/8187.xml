<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:21:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-25746] Compaction Failure Counter counted incorrectly</title>
                <link>https://issues.apache.org/jira/browse/HIVE-25746</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The count of the below metrics counted incorrectly upon an exception.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;tt&gt;compaction_initator_failure_counter&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;compaction_cleaner_failure_counter&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Reasoning:&lt;br/&gt;
In the &lt;tt&gt;Initator&lt;/tt&gt;/&lt;tt&gt;Cleaner&lt;/tt&gt; class creates a list of &lt;tt&gt;CompletableFuture&lt;/tt&gt; which &lt;tt&gt;Runnable&lt;/tt&gt; core exception is being wrapped to &lt;tt&gt;RuntimeExceptions&lt;/tt&gt;. &lt;br/&gt;
The below code-snippet waits all cleaners to complete (Initiators does it similarly).&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
           ....
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (CompactionInfo compactionInfo : readyToClean) {
              cleanerList.add(CompletableFuture.runAsync(CompactorUtil.ThrowingRunnable.unchecked(() -&amp;gt;
                      clean(compactionInfo, cleanerWaterMark, metricsEnabled)), cleanerExecutor));
            }
            CompletableFuture.allOf(cleanerList.toArray(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CompletableFuture[0])).join();
          }
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable t) {
          &lt;span class=&quot;code-comment&quot;&gt;// the lock timeout on AUX lock, should be ignored.
&lt;/span&gt;          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (metricsEnabled &amp;amp;&amp;amp; handle != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            failuresCounter.inc();
          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If the &lt;tt&gt;CompleteableFututre#join&lt;/tt&gt; throws an Exception then the failure counter is incremented.&lt;/p&gt;

&lt;p&gt;Docs:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

    /**
     * Returns the result value when complete, or &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; an
     * (unchecked) exception &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; completed exceptionally. To better
     * conform with the use of common functional forms, &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; a
     * computation involved in the completion of &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;
     * CompletableFuture threw an exception, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; method &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; an
     * (unchecked) {@link CompletionException} with the underlying
     * exception as its cause.
     *
     * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; the result value
     * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; CancellationException &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the computation was cancelled
     * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; CompletionException &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; completed
     * exceptionally or a completion computation threw an exception
     */
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; T join() {
        &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; r;
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; reportJoin((r = result) == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? waitingGet(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;) : r);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/warning.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Let&apos;s suppose we have 10 cleaners and the 2nd throws an exception. The &lt;tt&gt;catch&lt;/tt&gt; block will be initiated and the &lt;tt&gt;failuresCounter&lt;/tt&gt; will be incremented. If there is any consecutive error amongst the remaining cleaners the counter won&apos;t be incremented. &lt;/p&gt;</description>
                <environment></environment>
        <key id="13414325">HIVE-25746</key>
            <summary>Compaction Failure Counter counted incorrectly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vcsomor">Viktor Csomor</assignee>
                                    <reporter username="vcsomor">Viktor Csomor</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 29 Nov 2021 14:58:26 +0000</created>
                <updated>Thu, 17 Nov 2022 08:48:20 +0000</updated>
                            <resolved>Tue, 1 Feb 2022 15:07:50 +0000</resolved>
                                    <version>4.0.0</version>
                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="8400">2h 20m</timespent>
                                <comments>
                            <comment id="17485308" author="klcopp" created="Tue, 1 Feb 2022 15:07:50 +0000"  >&lt;p&gt;Committed to master branch. Thanks for your contribution &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vcsomor&quot; class=&quot;user-hover&quot; rel=&quot;vcsomor&quot;&gt;vcsomor&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 41 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0x674:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>