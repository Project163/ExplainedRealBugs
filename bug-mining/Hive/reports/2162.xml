<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:18:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-6843] INSTR for UTF-8 returns incorrect position</title>
                <link>https://issues.apache.org/jira/browse/HIVE-6843</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description></description>
                <environment></environment>
        <key id="12706697">HIVE-6843</key>
            <summary>INSTR for UTF-8 returns incorrect position</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="szehon">Szehon Ho</assignee>
                                    <reporter username="ckran">ckran</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Apr 2014 20:09:23 +0000</created>
                <updated>Thu, 13 Nov 2014 19:42:07 +0000</updated>
                            <resolved>Thu, 24 Apr 2014 01:09:26 +0000</resolved>
                                    <version>0.11.0</version>
                    <version>0.12.0</version>
                                    <fixVersion>0.14.0</fixVersion>
                                    <component>UDF</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13960354" author="ckran" created="Fri, 4 Apr 2014 20:12:30 +0000"  >&lt;p&gt;Using the INSTR fuction to find the posistion of a substring for a UTF-8 returns zero&lt;/p&gt;

&lt;p&gt;select INSTR (&#8216;&#1053;&#1040;&#1057;&#1058;&#1056;&#1054;&#1045;&#1085;&#1080;&#1077;&#8217;, &#8216;P&#8217;) from foo-bar &lt;/p&gt;</comment>
                            <comment id="13961551" author="szehon" created="Sun, 6 Apr 2014 22:24:49 +0000"  >&lt;p&gt;Hi, I was going to look at this , but when I tried it looks like that your first P is a Cyrillic P (d0,a0), while the second is a English P (50).  Can you verify?  If you make the second a Cyrlilic P, than it works.&lt;/p&gt;</comment>
                            <comment id="13961957" author="ckran" created="Mon, 7 Apr 2014 16:02:05 +0000"  >&lt;p&gt;Sorry, copy/paste got me. They &lt;em&gt;look&lt;/em&gt; the same. And sorry about the curly quotes, I don&apos;t know where they came from. &lt;/p&gt;

&lt;p&gt;The real issue is that for UTF-8 INSTR returns the position in bytes instead of characters. So this reutrns a 9 where by my count it should be a 5. Thank you for your support. &lt;/p&gt;

&lt;p&gt;select INSTR (&apos;&#1053;&#1040;&#1057;&#1058;&#1056;&#1054;&#1045;&#1085;&#1080;&#1077;&apos;, &apos;&#1056;&apos;) from .... &lt;/p&gt;</comment>
                            <comment id="13962204" author="szehon" created="Mon, 7 Apr 2014 20:16:53 +0000"  >&lt;p&gt;This seems to work, lets see what folks think.&lt;/p&gt;

&lt;p&gt;Original code was trying to avoid encoding the bytes and just doing byte-counting, but not sure if that is possible when doing unicode char calculations.&lt;/p&gt;</comment>
                            <comment id="13962583" author="hiveqa" created="Tue, 8 Apr 2014 05:04:27 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12639052/HIVE-6843.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12639052/HIVE-6843.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 1 failed/errored test(s), 5549 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_bucketizedhiveinputformat
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2170/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2170/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2170/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2170/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12639052&lt;/p&gt;</comment>
                            <comment id="13973566" author="jdere" created="Thu, 17 Apr 2014 23:36:36 +0000"  >&lt;p&gt;Should this also work for unicode characters which require more than one Java character? If you add these checks to TestGenericUDFUtils, the 2nd check fails:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    Assert.assertEquals(3, GenericUDFUtils.findText(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Text(&lt;span class=&quot;code-quote&quot;&gt;&quot;123\uD801\uDC00456&quot;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Text(&lt;span class=&quot;code-quote&quot;&gt;&quot;\uD801\uDC00&quot;&lt;/span&gt;), 0));
    Assert.assertEquals(4, GenericUDFUtils.findText(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Text(&lt;span class=&quot;code-quote&quot;&gt;&quot;123\uD801\uDC00456&quot;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Text(&lt;span class=&quot;code-quote&quot;&gt;&quot;4&quot;&lt;/span&gt;), 0));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This would require using String.codePointCount() on the indexOf() result.&lt;/p&gt;</comment>
                            <comment id="13973730" author="szehon" created="Fri, 18 Apr 2014 02:55:09 +0000"  >&lt;p&gt;Thanks for the review.  As I understand, you are passing in a string literal to Text constructor, so it is not interpreting \uD801 as one char, so there is actually 5 chars there: &apos;\&apos;, &apos;u&apos;, &apos;D&apos;, &apos;8&apos;, &apos;0&apos;, &apos;1&apos;.&lt;/p&gt;

&lt;p&gt;I tried the following test and it seemed to work:&lt;/p&gt;

&lt;p&gt;    char[] chararray = new char[] &lt;/p&gt;
{&apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;\uD801&apos;, &apos;\uDC00&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;}
&lt;p&gt;;&lt;br/&gt;
    String str = new String(chararray);&lt;br/&gt;
    Assert.assertEquals(5, GenericUDFUtils.findText(new Text(str), new Text(&quot;4&quot;), 0));&lt;/p&gt;

&lt;p&gt;I guess the second check was supposed to be 5, not 4.&lt;/p&gt;</comment>
                            <comment id="13973880" author="jdere" created="Fri, 18 Apr 2014 08:21:02 +0000"  >&lt;p&gt;The string literal does interpret &quot;\uD801&quot; as a single character, and &quot;\uD801\uDC00&quot; as a single code point (got the example character from &lt;a href=&quot;http://www.oracle.com/technetwork/articles/javase/supplementary-142654.html):&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.oracle.com/technetwork/articles/javase/supplementary-142654.html):&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    String str1 = &quot;123\uD801\uDC00456&quot;;
    System.out.println(&quot;str1 length=&quot; + str1.length() + &quot;, codePointCount=&quot; + str1.codePointCount(0, str1.length()));

str1 length=8, codePointCount=7
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So if we count things by unicode code points, the &quot;4&quot; would be at index 4 (for 0-based index).&lt;/p&gt;</comment>
                            <comment id="13973882" author="jdere" created="Fri, 18 Apr 2014 08:22:30 +0000"  >&lt;p&gt;From that link, &quot;\uD801\uDC00&quot; would be the representation for U+10400&lt;/p&gt;</comment>
                            <comment id="13974655" author="szehon" created="Sat, 19 Apr 2014 00:07:41 +0000"  >&lt;p&gt;Sorry Jason I missed that.  Made the fix to handle supplementary characters (surrogate pairs), and updated the review board.&lt;/p&gt;</comment>
                            <comment id="13974664" author="jdere" created="Sat, 19 Apr 2014 00:27:18 +0000"  >&lt;p&gt;I think it looks good, +1&lt;/p&gt;</comment>
                            <comment id="13974739" author="hiveqa" created="Sat, 19 Apr 2014 05:30:59 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12640922/HIVE-6843.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12640922/HIVE-6843.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 1 failed/errored test(s), 5406 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_auto_sortmerge_join_16
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/precommit-hive/25/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/precommit-hive/25/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/precommit-hive/25/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/precommit-hive/25/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12640922&lt;/p&gt;</comment>
                            <comment id="13979162" author="jdere" created="Thu, 24 Apr 2014 01:09:26 +0000"  >&lt;p&gt;Committed to trunk, thanks Szehon!&lt;/p&gt;</comment>
                            <comment id="14210699" author="thejas" created="Thu, 13 Nov 2014 19:42:07 +0000"  >&lt;p&gt;This has been fixed in 0.14 release. Please open new jira if you see any issues.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12640922" name="HIVE-6843.2.patch" size="4097" author="szehon" created="Sat, 19 Apr 2014 00:07:41 +0000"/>
                            <attachment id="12639052" name="HIVE-6843.patch" size="3182" author="szehon" created="Mon, 7 Apr 2014 20:16:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>385020</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ubv3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>385287</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>