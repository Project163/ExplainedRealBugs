<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:15:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-6157] Fetching column stats slower than the 101 during rush hour</title>
                <link>https://issues.apache.org/jira/browse/HIVE-6157</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;&quot;hive.stats.fetch.column.stats&quot; controls whether the column stats for a table are fetched during explain (in Tez: during query planning). On my setup (1 table 4000 partitions, 24 columns) the time spent in semantic analyze goes from ~1 second to ~66 seconds when turning the flag on. 65 seconds spent fetching column stats...&lt;/p&gt;

&lt;p&gt;The reason is probably that the APIs force you to make separate metastore calls for each column in each partition. That&apos;s probably the first thing that has to change. The question is if in addition to that we need to cache this in the client or store the stats as a single blob in the database to further cut down on the time. However, the way it stands right now column stats seem unusable.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12687716">HIVE-6157</key>
            <summary>Fetching column stats slower than the 101 during rush hour</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sershe">Sergey Shelukhin</assignee>
                                    <reporter username="hagleitn">Gunther Hagleitner</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Jan 2014 19:45:41 +0000</created>
                <updated>Fri, 1 Aug 2014 06:20:51 +0000</updated>
                            <resolved>Thu, 30 Jan 2014 00:24:37 +0000</resolved>
                                    <version>0.13.0</version>
                                    <fixVersion>0.13.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13875227" author="sershe" created="Fri, 17 Jan 2014 20:19:26 +0000"  >&lt;p&gt;Ok, this took rather longer than expected... initially I tried to make stat fetching part of partition pruning, this can be added as an extra optimization if necessary as this requires too many API changes all over the place.&lt;br/&gt;
The alternative is simple, getting stat calls are all batched. New APIs on thrift use req/resp pattern; requests contain db, table, column list, and partition list (for partitions). The request returns whatever it can find (rather than the full list with some nulls, like the old APIs that built lists using individual calls to metastore). The code then uses this. &lt;br/&gt;
On metastore there&apos;s both JDO and SQL path for speed.&lt;br/&gt;
Also, cleaned up some stuff in StatOptimizer and StatsUtil that was generally suboptimal.&lt;/p&gt;</comment>
                            <comment id="13875228" author="sershe" created="Fri, 17 Jan 2014 20:19:46 +0000"  >&lt;p&gt;Patch coming today barring something surprising happens&lt;/p&gt;</comment>
                            <comment id="13875574" author="sershe" created="Sat, 18 Jan 2014 07:27:39 +0000"  >&lt;p&gt;Well, it looks like I cannot defeat datanucleus today... SQL path seems to work, although I didn&apos;t run all the tests. Let me comment out and check for now.&lt;/p&gt;</comment>
                            <comment id="13876140" author="shreepadma" created="Mon, 20 Jan 2014 04:52:48 +0000"  >&lt;p&gt;Currently, the API fetches statistics for a given column. hive.stats.fetch.column.stats fetches stats for all columns for all partitions in all tables. Bad idea. &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4301&quot; title=&quot;Bulk retrieval API for column stats&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4301&quot;&gt;&lt;del&gt;HIVE-4301&lt;/del&gt;&lt;/a&gt; was filed to support a bulk fetch API so that stats for all columns for all partitions in multiple tables can be fetched with a single call. Feel free to pick up &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4301&quot; title=&quot;Bulk retrieval API for column stats&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4301&quot;&gt;&lt;del&gt;HIVE-4301&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13876591" author="sershe" created="Mon, 20 Jan 2014 17:20:29 +0000"  >&lt;p&gt;Sorry, was not aware of that JIRA. Among other things, this patch adds bulk APIs. They do not support multiple tables as of now, though. Stats are currently fetched on the level of one column (stat optimizer) or one table (table scan stuff), so making use of multi-table API would require more extensive changes on the client (optimizer) side.&lt;/p&gt;</comment>
                            <comment id="13877988" author="sershe" created="Tue, 21 Jan 2014 23:13:24 +0000"  >&lt;p&gt;first patch. There&apos;s one TODO# left where I think some validation code is dead, need to see if any tests fail with it.&lt;/p&gt;

&lt;p&gt;Other than that many tests I ran passed, let&apos;s see what HiveQA says&lt;/p&gt;</comment>
                            <comment id="13877993" author="sershe" created="Tue, 21 Jan 2014 23:17:18 +0000"  >&lt;p&gt;nogen patch omits generated code and is posted to &lt;a href=&quot;https://reviews.apache.org/r/17162/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/17162/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13878009" author="sershe" created="Tue, 21 Jan 2014 23:30:42 +0000"  >&lt;p&gt;hmm, q.out file change may have not been a planned inclusion, let me dbl check&lt;/p&gt;</comment>
                            <comment id="13878209" author="sershe" created="Wed, 22 Jan 2014 03:28:46 +0000"  >&lt;p&gt;HiveQA won&apos;t pick the patch; same file&lt;/p&gt;</comment>
                            <comment id="13878388" author="hiveqa" created="Wed, 22 Jan 2014 08:17:04 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12624267/HIVE-6157.01.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12624267/HIVE-6157.01.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 4943 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_alter_partition_coltype
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_annotate_stats_table
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_metadataonly1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/980/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/980/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/980/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/980/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12624267&lt;/p&gt;</comment>
                            <comment id="13879484" author="hagleitn" created="Thu, 23 Jan 2014 06:24:46 +0000"  >&lt;p&gt;Patch looks good. Some questions/comments on RB. What about the test failures? They seem relevant.&lt;/p&gt;</comment>
                            <comment id="13880286" author="sershe" created="Thu, 23 Jan 2014 19:54:34 +0000"  >&lt;p&gt;RB feedback, also test fixes (02 fixed those but I couldn&apos;t add it to jira). I am running the tez test now&lt;/p&gt;</comment>
                            <comment id="13880385" author="sershe" created="Thu, 23 Jan 2014 21:31:00 +0000"  >&lt;p&gt;metadata_only_queries.q.out got modified for tez test, but it appears that the changes come from unrelated patches. Because it doesn&apos;t run in HiveQA it didn&apos;t get updated at some point. Not including in this patch... the rest passed&lt;/p&gt;</comment>
                            <comment id="13880462" author="hagleitn" created="Thu, 23 Jan 2014 22:38:18 +0000"  >&lt;p&gt;I have &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-6261&quot; title=&quot;Update metadata.q.out file for tez (after change to .q file)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-6261&quot;&gt;&lt;del&gt;HIVE-6261&lt;/del&gt;&lt;/a&gt; open for the metadata_only_queries&lt;/p&gt;</comment>
                            <comment id="13881246" author="sershe" created="Fri, 24 Jan 2014 18:22:00 +0000"  >&lt;p&gt;exact same patch, HiveQA won&apos;t run&lt;/p&gt;</comment>
                            <comment id="13881630" author="hagleitn" created="Sat, 25 Jan 2014 03:01:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt; do you want to also take a look? This would effect the stats annotation too.&lt;/p&gt;</comment>
                            <comment id="13881770" author="hiveqa" created="Sat, 25 Jan 2014 09:12:39 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12625080/HIVE-6157.03.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12625080/HIVE-6157.03.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 6 failed/errored test(s), 4958 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_bucket_num_reducers
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_bucketmapjoin6
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_import_exported_table
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_infer_bucket_sort_reducers_power_two
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_load_hdfs_file_with_space_in_the_name
org.apache.hadoop.hive.cli.TestNegativeMinimrCliDriver.testNegativeCliDriver_file_with_header_footer_negative
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/1010/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/1010/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/1010/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/1010/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 6 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12625080&lt;/p&gt;</comment>
                            <comment id="13883216" author="prasanth_j" created="Mon, 27 Jan 2014 20:02:39 +0000"  >&lt;p&gt;Mostly looks good. Left minor comments on RB.&lt;/p&gt;</comment>
                            <comment id="13883569" author="sershe" created="Tue, 28 Jan 2014 00:41:59 +0000"  >&lt;p&gt;Some of the test failures are also happening in other jiras and some I cannot repro... let me address recent RB feedback and rerun QA&lt;/p&gt;</comment>
                            <comment id="13884484" author="hagleitn" created="Tue, 28 Jan 2014 19:36:48 +0000"  >&lt;p&gt;LGTM +1&lt;/p&gt;</comment>
                            <comment id="13884495" author="sershe" created="Tue, 28 Jan 2014 19:40:55 +0000"  >&lt;p&gt;on some other jira with harmless patch all but one of the same tests failed so I assume they are all broken. I&apos;ll take a look at bucketmapjoin6&lt;/p&gt;</comment>
                            <comment id="13884806" author="sershe" created="Tue, 28 Jan 2014 22:42:35 +0000"  >&lt;p&gt;cannot repro on multiple machines and I see bucketmapjoin6 also fails in some jiras... probably flaky. Will commit tomorrow.&lt;/p&gt;</comment>
                            <comment id="13886074" author="hagleitn" created="Thu, 30 Jan 2014 00:24:37 +0000"  >&lt;p&gt;Committed to trunk. Thanks Sergey!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12690854">HIVE-6289</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12690860">HIVE-6292</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12641099">HIVE-4301</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="12641099">HIVE-4301</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12624267" name="HIVE-6157.01.patch" size="907279" author="sershe" created="Wed, 22 Jan 2014 03:28:46 +0000"/>
                            <attachment id="12624225" name="HIVE-6157.01.patch" size="907279" author="sershe" created="Tue, 21 Jan 2014 23:13:24 +0000"/>
                            <attachment id="12625080" name="HIVE-6157.03.patch" size="913723" author="sershe" created="Fri, 24 Jan 2014 18:22:00 +0000"/>
                            <attachment id="12624888" name="HIVE-6157.03.patch" size="913723" author="sershe" created="Thu, 23 Jan 2014 19:54:34 +0000"/>
                            <attachment id="12624887" name="HIVE-6157.nogen.patch" size="166251" author="sershe" created="Thu, 23 Jan 2014 19:54:34 +0000"/>
                            <attachment id="12624224" name="HIVE-6157.nogen.patch" size="159807" author="sershe" created="Tue, 21 Jan 2014 23:13:24 +0000"/>
                            <attachment id="12623775" name="HIVE-6157.prelim.patch" size="907937" author="sershe" created="Sat, 18 Jan 2014 07:27:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>366716</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 42 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1r7n3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>367027</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>