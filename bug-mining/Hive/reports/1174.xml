<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:05:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-4179] NonBlockingOpDeDup does not merge SEL operators correctly</title>
                <link>https://issues.apache.org/jira/browse/HIVE-4179</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The input columns list for SEL operations isn&apos;t merged properly in the optimization. The best way to see this is running union_remove_22.q with -Dhadoop.mr.rev=23. The plan shows lost UDFs and a broken lineage for one column.&lt;/p&gt;

&lt;p&gt;Note: union_remove tests do not run on hadoop 1 or 0.20.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12637109">HIVE-4179</key>
            <summary>NonBlockingOpDeDup does not merge SEL operators correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hagleitn">Gunther Hagleitner</assignee>
                                    <reporter username="hagleitn">Gunther Hagleitner</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Mar 2013 23:17:39 +0000</created>
                <updated>Thu, 16 May 2013 21:11:01 +0000</updated>
                            <resolved>Wed, 3 Apr 2013 14:28:34 +0000</resolved>
                                                    <fixVersion>0.11.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13602879" author="hagleitn" created="Thu, 14 Mar 2013 23:19:12 +0000"  >&lt;p&gt;replaced standard backtracking with SEL merge function.&lt;/p&gt;</comment>
                            <comment id="13602881" author="hagleitn" created="Thu, 14 Mar 2013 23:19:47 +0000"  >&lt;p&gt;still running tests on patch.&lt;/p&gt;</comment>
                            <comment id="13603970" author="hagleitn" created="Fri, 15 Mar 2013 23:19:15 +0000"  >&lt;p&gt;Query:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;insert overwrite table outputTbl1
SELECT a.key, concat(a.values, a.values), concat(a.values, a.values)
FROM (
  SELECT key, count(1) as values from inputTbl1 group by key
  UNION ALL
  SELECT key, count(1) as values from inputTbl1 group by key
) a;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Before:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;          outputColumnNames: _col0, _col1
          Select Operator
            expressions:
                  expr: _col0
                  type: string
                  expr: UDFToLong(_col1)
                  type: bigint
                  expr: UDFToLong(_col2)
                  type: bigint
            outputColumnNames: _col0, _col1, _col2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        
          outputColumnNames: _col0, _col1
          Select Operator
            expressions:
                  expr: _col0
                  type: string
                  expr: UDFToLong(concat(_col1, _col1))
                  type: bigint
                  expr: UDFToLong(concat(_col1, _col1))
                  type: bigint
            outputColumnNames: _col0, _col1, _col2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13604007" author="hagleitn" created="Fri, 15 Mar 2013 23:59:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.facebook.net/D9471&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D9471&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13606279" author="ashutoshc" created="Tue, 19 Mar 2013 12:37:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; Would you like to review this?&lt;/p&gt;</comment>
                            <comment id="13614279" author="hagleitn" created="Tue, 26 Mar 2013 16:38:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; I think you&apos;d be the best person to take a look. Can you spare a moment?&lt;/p&gt;</comment>
                            <comment id="13614786" author="navis" created="Wed, 27 Mar 2013 01:33:49 +0000"  >&lt;p&gt;I&apos;ve took a look at this. The root cause is from UnionProcessor which does not copy colExprMapping of parent SEL operator. After applying that, I&apos;ve confirmed the result is valid.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hagleitn&quot; class=&quot;user-hover&quot; rel=&quot;hagleitn&quot;&gt;hagleitn&lt;/a&gt; The patch you&apos;ve provided is valid but the missing colExprMap info can make problems in anytime. So I prefer to revise it as suggested above. Could you do that?&lt;/p&gt;</comment>
                            <comment id="13615578" author="hagleitn" created="Wed, 27 Mar 2013 18:14:32 +0000"  >&lt;p&gt;Much better fix! Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt;. Testing it right now, will be up shortly.&lt;/p&gt;</comment>
                            <comment id="13615731" author="hagleitn" created="Wed, 27 Mar 2013 20:37:58 +0000"  >&lt;p&gt;Adjusted fix per Navis&apos; instructions. I&apos;ve also checked other union_remove* testcases and updated their golden file after verifying.&lt;/p&gt;

&lt;p&gt;There are still failures in some of the union_remove testcases - but I think those are unrelated and I will open separate jiras for them (8,9,10,12,13,24)&lt;/p&gt;</comment>
                            <comment id="13616938" author="navis" created="Fri, 29 Mar 2013 01:12:38 +0000"  >&lt;p&gt;minor comments on phabricator&lt;/p&gt;</comment>
                            <comment id="13617123" author="hagleitn" created="Fri, 29 Mar 2013 06:11:55 +0000"  >&lt;p&gt;Addressing comment from phabricator (cloning schema and columnExprMap)&lt;/p&gt;</comment>
                            <comment id="13617197" author="navis" created="Fri, 29 Mar 2013 09:34:45 +0000"  >&lt;p&gt;I&apos;ve ran union_remove_* tests and found mapping information is missing for type casting SEL operator, which is generated in SemanticAnalyzer.genInputSelectForUnion().&lt;/p&gt;

&lt;p&gt;Packing needed colExprMap seemed to fix some part of problems. Could you do that?&lt;/p&gt;</comment>
                            <comment id="13617198" author="navis" created="Fri, 29 Mar 2013 09:37:21 +0000"  >&lt;p&gt;And.. failing of 12, 13 is caused by mis-configuration in data/hive-site.xml (hive.ignore.mapjoin.hint should be true). I don&apos;t know why those are failing if it&apos;s set false.&lt;/p&gt;</comment>
                            <comment id="13617440" author="hagleitn" created="Fri, 29 Mar 2013 15:39:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; I&apos;d be happy to work on those as well. As I said before, there&apos;s additional issues with the union_remove testcases. I think those can/should be handled in follow up jiras though. This one fixes one particular issue and can be committed. Do you agree?&lt;/p&gt;</comment>
                            <comment id="13618648" author="navis" created="Mon, 1 Apr 2013 06:22:05 +0000"  >&lt;p&gt;Am I missing something? I get result of union_remove_5,8,9,14,24 are changed.&lt;/p&gt;</comment>
                            <comment id="13619607" author="hagleitn" created="Tue, 2 Apr 2013 08:00:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt;: Here&apos;s what you should see with this patch:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;failures before: 10, 12, 13, 14, 22, 23, 24, 3, 4, 5, 7, 8, 9
 failures after: 10, 12, 13, 14,         24,       5,    8, 9
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, this patch fixes: 22, 23, 2, 3 and 7&lt;/p&gt;

&lt;p&gt;Is that what you&apos;re asking?&lt;/p&gt;</comment>
                            <comment id="13619609" author="hagleitn" created="Tue, 2 Apr 2013 08:01:55 +0000"  >&lt;p&gt;Oh - yes, I think you&apos;re result is right. The ones you list are still failing because of mismatch with the golden file (fixed in other patches). 10, 12 and 13 actually get an exception before they even get to the diff with golden file.&lt;/p&gt;</comment>
                            <comment id="13620476" author="ashutoshc" created="Wed, 3 Apr 2013 01:11:25 +0000"  >&lt;p&gt;+1 will commit if tests pass.&lt;/p&gt;</comment>
                            <comment id="13620483" author="navis" created="Wed, 3 Apr 2013 01:21:57 +0000"  >&lt;p&gt;I know results of 5,8,9,14,24 would be fixed by other issues. But IMHO, those changes should be included anyway. Isn&apos;t it? And, sorry for slow progress. I&apos;m barely not good reviewer but trying to be like a committer.&lt;/p&gt;</comment>
                            <comment id="13620526" author="ashutoshc" created="Wed, 3 Apr 2013 02:11:58 +0000"  >&lt;p&gt;No worries &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; I dont feel strongly one way or the other. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hagleitn&quot; class=&quot;user-hover&quot; rel=&quot;hagleitn&quot;&gt;hagleitn&lt;/a&gt; would you like to update the results in this patch or in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4259&quot; title=&quot;SEL operator created with missing columnExprMap for unions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4259&quot;&gt;&lt;del&gt;HIVE-4259&lt;/del&gt;&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="13620695" author="hagleitn" created="Wed, 3 Apr 2013 07:32:24 +0000"  >&lt;p&gt;I&apos;ve split the golden file updates to go along with the code changes in the patches. I prefer it this way, but will change if it makes things easier. This is a somewhat special case I think, because the hadoop 2 build is already broken (so even though this fixes some tests others will still fail).&lt;/p&gt;</comment>
                            <comment id="13620950" author="ashutoshc" created="Wed, 3 Apr 2013 14:28:34 +0000"  >&lt;p&gt;Committed to trunk. Thanks, Gunther!&lt;/p&gt;</comment>
                            <comment id="13621673" author="hudson" created="Thu, 4 Apr 2013 02:28:44 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #2043 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/2043/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/2043/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4179&quot; title=&quot;NonBlockingOpDeDup does not merge SEL operators correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4179&quot;&gt;&lt;del&gt;HIVE-4179&lt;/del&gt;&lt;/a&gt; : NonBlockingOpDeDup does not merge SEL operators correctly (Gunther Hagleitner via Ashutosh Chauhan) (Revision 1464042)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
hashutosh : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1464042&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1464042&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/RowSchema.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/unionproc/UnionProcFactory.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/union_remove_22.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/union_remove_23.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/union_remove_3.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/union_remove_4.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/union_remove_7.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13623016" author="hudson" created="Thu, 4 Apr 2013 23:39:50 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #138 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/138/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/138/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4179&quot; title=&quot;NonBlockingOpDeDup does not merge SEL operators correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4179&quot;&gt;&lt;del&gt;HIVE-4179&lt;/del&gt;&lt;/a&gt; : NonBlockingOpDeDup does not merge SEL operators correctly (Gunther Hagleitner via Ashutosh Chauhan) (Revision 1464042)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
hashutosh : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1464042&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1464042&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/OperatorFactory.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/RowSchema.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/unionproc/UnionProcFactory.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/union_remove_22.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/union_remove_23.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/union_remove_3.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/union_remove_4.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/union_remove_7.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12639830">HIVE-4259</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12639831">HIVE-4260</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12639833">HIVE-4261</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12573794" name="HIVE-4179.1.patch" size="11415" author="hagleitn" created="Thu, 14 Mar 2013 23:19:12 +0000"/>
                            <attachment id="12573971" name="HIVE-4179.2.patch" size="11845" author="hagleitn" created="Fri, 15 Mar 2013 23:20:07 +0000"/>
                            <attachment id="12575761" name="HIVE-4179.3.patch" size="25566" author="hagleitn" created="Wed, 27 Mar 2013 20:37:58 +0000"/>
                            <attachment id="12576027" name="HIVE-4179.4.patch" size="27362" author="hagleitn" created="Fri, 29 Mar 2013 06:11:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>317601</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 33 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1isw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>317942</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>