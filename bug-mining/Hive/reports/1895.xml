<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:15:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-5989] Hive metastore authorization check is not threadsafe</title>
                <link>https://issues.apache.org/jira/browse/HIVE-5989</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Metastore-side authorization has a couple of pretty important threadsafety bugs in it:&lt;/p&gt;

&lt;p&gt;a) The HiveMetastoreAuthenticated instantiated by the AuthorizationPreEventListener is static. This is a premature optimization and incorrect, as it will result in Authenticator implementations that store state potentially giving an incorrect result, and this bug very much exists with the DefaultMetastoreAuthenticator.&lt;/p&gt;

&lt;p&gt;b) It assumes HMSHandler.getHiveConf() is itself going to be thread-safe, which it is not. HMSHandler.getConf() is the appropriate thread-safe equivalent.&lt;/p&gt;

&lt;p&gt;The effect of this bug is that if there are two users that are concurrently running jobs on the metastore, we might :&lt;/p&gt;

&lt;p&gt;a) Allow a user to do something they didn&apos;t have permission to, because the other person did. (Security hole)&lt;br/&gt;
b) Disallow a user from doing something they should have permission to (More common - annoying and can cause job failures)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12683702">HIVE-5989</key>
            <summary>Hive metastore authorization check is not threadsafe</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sushanth">Sushanth Sowmyan</assignee>
                                    <reporter username="sushanth">Sushanth Sowmyan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 Dec 2013 22:35:56 +0000</created>
                <updated>Fri, 14 Feb 2014 00:26:36 +0000</updated>
                            <resolved>Fri, 14 Feb 2014 00:26:36 +0000</resolved>
                                    <version>0.11.0</version>
                    <version>0.12.0</version>
                    <version>0.12.1</version>
                                    <fixVersion>0.13.0</fixVersion>
                                    <component>Metastore</component>
                    <component>Security</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13843634" author="sushanth" created="Mon, 9 Dec 2013 22:36:53 +0000"  >&lt;p&gt;I&apos;ll attach the fix patch for now as this is a pretty severe bug. As for testing, it is easy to test from manual tests or with e2e tests, but difficult to test with a unit test. I&apos;ll also attach a &quot;SleepyAuthorizationProvider&quot; that I used to test this manually, so as to elongate the critical section to demonstrate and reproduce this error easily.&lt;/p&gt;</comment>
                            <comment id="13843638" author="sushanth" created="Mon, 9 Dec 2013 22:41:35 +0000"  >&lt;p&gt;SleepyAP.patch attached - Note, before using this for testing, you&apos;ll have to set hive.metastore.client.socket.timeout to an appropriately high amount (I used 60000 for 1 minute) to make sure that we don&apos;t hit a timeout on the client.&lt;/p&gt;</comment>
                            <comment id="13843639" author="sushanth" created="Mon, 9 Dec 2013 22:42:43 +0000"  >&lt;p&gt;Attached patch.&lt;/p&gt;</comment>
                            <comment id="13843648" author="sushanth" created="Mon, 9 Dec 2013 22:47:44 +0000"  >&lt;p&gt;Setting to patch-available so Hive-QA can pick it up to run existing tests with this patch.&lt;/p&gt;</comment>
                            <comment id="13843723" author="hiveqa" created="Mon, 9 Dec 2013 23:56:03 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12617917/HIVE-5989.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12617917/HIVE-5989.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 2 failed/errored test(s), 4761 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_decimal_precision
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_bucket_num_reducers
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/584/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/584/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/584/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/584/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12617917&lt;/p&gt;</comment>
                            <comment id="13899630" author="sushanth" created="Wed, 12 Feb 2014 21:53:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thejas&quot; class=&quot;user-hover&quot; rel=&quot;thejas&quot;&gt;thejas&lt;/a&gt;, could I please get a review on this? I&apos;m not certain if this is affected by any of your newer patches, but this is a pretty important bug at scale.&lt;/p&gt;</comment>
                            <comment id="13899811" author="mithun" created="Thu, 13 Feb 2014 00:10:14 +0000"  >&lt;p&gt;As a matter of fact, I think we&apos;re hitting this right now. I&apos;ll review your patch as well.&lt;/p&gt;</comment>
                            <comment id="13899840" author="vgumashta" created="Thu, 13 Feb 2014 00:40:36 +0000"  >&lt;p&gt;This might be related: &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-6245&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;HS2 creates DBs/Tables with wrong ownership when HMS setugi is true&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13899900" author="sushanth" created="Thu, 13 Feb 2014 01:36:53 +0000"  >&lt;p&gt;Much appreciated Mithun.&lt;/p&gt;

&lt;p&gt;And Vaibhav, I had a look at the jira you linked to - I don&apos;t think the two are related - this bug related to the metastore auth system using a non-threadlocal hiveconf to instantiate itself and test for ownership. It&apos;s not that hive has an idea of incorrect ugi, it&apos;s that the metastore auth system uses it incorrectly.&lt;/p&gt;</comment>
                            <comment id="13899908" author="vgumashta" created="Thu, 13 Feb 2014 01:43:57 +0000"  >&lt;p&gt;Thanks for taking a look &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sushanth&quot; class=&quot;user-hover&quot; rel=&quot;sushanth&quot;&gt;sushanth&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="13899920" author="thejas" created="Thu, 13 Feb 2014 01:55:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sushanth&quot; class=&quot;user-hover&quot; rel=&quot;sushanth&quot;&gt;sushanth&lt;/a&gt; Can you also create a reviewboard link ?&lt;/p&gt;</comment>
                            <comment id="13899935" author="sushanth" created="Thu, 13 Feb 2014 02:14:54 +0000"  >&lt;p&gt;Reviewboard is not responding currently when I attempt to create a new review request, I will try to create it later tonight.&lt;/p&gt;</comment>
                            <comment id="13899972" author="sushanth" created="Thu, 13 Feb 2014 03:15:10 +0000"  >&lt;p&gt;Created now : &lt;a href=&quot;https://reviews.apache.org/r/18054/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/18054/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13899981" author="thejas" created="Thu, 13 Feb 2014 03:35:29 +0000"  >&lt;p&gt;+1 . Just a minor indentation issue in the patch, I can add those 2 spaces before commit.&lt;/p&gt;</comment>
                            <comment id="13900482" author="sushanth" created="Thu, 13 Feb 2014 16:32:35 +0000"  >&lt;p&gt;Thanks, and yup, the indentation is incorrect in those two places. I&apos;ve attached a newer patch with that updated.&lt;/p&gt;</comment>
                            <comment id="13900956" author="thejas" created="Fri, 14 Feb 2014 00:26:36 +0000"  >&lt;p&gt;Patch committed to trunk.&lt;br/&gt;
Thanks for the contribution Sushanth!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12628781" name="HIVE-5989.2.patch" size="9537" author="sushanth" created="Thu, 13 Feb 2014 16:32:35 +0000"/>
                            <attachment id="12617917" name="HIVE-5989.patch" size="9529" author="sushanth" created="Mon, 9 Dec 2013 22:42:43 +0000"/>
                            <attachment id="12617916" name="SleepyAP.patch" size="5613" author="sushanth" created="Mon, 9 Dec 2013 22:41:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>362774</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 40 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1qj6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>363068</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>