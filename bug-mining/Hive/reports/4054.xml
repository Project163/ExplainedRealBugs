<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:39:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-11948] Investigate TxnHandler and CompactionTxnHandler to see where we improve concurrency</title>
                <link>https://issues.apache.org/jira/browse/HIVE-11948</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;at least some operations (or parts of operations) can run at READ_COMMITTED.&lt;br/&gt;
CompactionTxnHandler.setRunAs()&lt;/p&gt;

&lt;p&gt;CompactionTxnHandler.findNextToCompact()&lt;br/&gt;
if update stmt includes cq_state = &apos;&quot; + INITIATED_STATE + &quot;&apos;&quot; in WHERE clause and logic to look for &quot;next&quot; candidate&lt;/p&gt;

&lt;p&gt;CompactionTxnHandler.markCompacted()&lt;br/&gt;
perhaps add cq_state=WORKING_STATE in Where clause (mostly as an extra consistency check)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12896197">HIVE-11948</key>
            <summary>Investigate TxnHandler and CompactionTxnHandler to see where we improve concurrency</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ekoifman">Eugene Koifman</assignee>
                                    <reporter username="ekoifman">Eugene Koifman</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Sep 2015 18:38:13 +0000</created>
                <updated>Tue, 1 Oct 2019 22:07:19 +0000</updated>
                            <resolved>Wed, 18 Nov 2015 01:28:27 +0000</resolved>
                                    <version>0.14.0</version>
                                    <fixVersion>1.3.0</fixVersion>
                                    <component>Transactions</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14995462" author="ekoifman" created="Sat, 7 Nov 2015 23:59:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gates&quot; class=&quot;user-hover&quot; rel=&quot;gates&quot;&gt;gates&lt;/a&gt; could you take a look please?&lt;/p&gt;</comment>
                            <comment id="14995480" author="hiveqa" created="Sun, 8 Nov 2015 01:20:11 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12771209/HIVE-11948.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12771209/HIVE-11948.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 4 failed/errored test(s), 9777 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_udaf_corr
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hadoop.hive.hwi.TestHWISessionManager.testHiveDriver
org.apache.hive.jdbc.TestSSL.testSSLVersion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5964/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5964/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5964/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5964/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5964/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5964/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12771209 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14995500" author="ekoifman" created="Sun, 8 Nov 2015 03:19:30 +0000"  >&lt;p&gt;failure is not related&lt;/p&gt;</comment>
                            <comment id="14996860" author="ekoifman" created="Mon, 9 Nov 2015 16:48:39 +0000"  >&lt;p&gt;this needs a change around TxnManager.lock()&lt;/p&gt;</comment>
                            <comment id="14998118" author="hiveqa" created="Tue, 10 Nov 2015 07:48:02 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12771497/HIVE-11948.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12771497/HIVE-11948.4.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 7 failed/errored test(s), 9778 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestHBaseNegativeCliDriver.testCliDriver_generatehfiles_require_family_path
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hadoop.hive.hwi.TestHWISessionManager.testHiveDriver
org.apache.hadoop.hive.metastore.txn.TestTxnHandler.showLocks
org.apache.hive.hcatalog.streaming.TestStreaming.testHearbeat
org.apache.hive.jdbc.TestJdbcWithMiniHS2.testAddJarDataNucleusUnCaching
org.apache.hive.jdbc.TestSSL.testSSLVersion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5981/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5981/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5981/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5981/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5981/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5981/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 7 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12771497 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14998289" author="hiveqa" created="Tue, 10 Nov 2015 09:18:12 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12771505/HIVE-11948.5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12771505/HIVE-11948.5.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 2 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 5 failed/errored test(s), 9778 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_index_bitmap_auto
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hadoop.hive.hwi.TestHWISessionManager.testHiveDriver
org.apache.hive.hcatalog.streaming.TestStreaming.testHearbeat
org.apache.hive.jdbc.TestSSL.testSSLVersion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5982/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5982/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5982/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5982/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5982/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5982/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 5 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12771505 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14999380" author="hiveqa" created="Tue, 10 Nov 2015 21:31:59 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12771582/HIVE-11948.6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12771582/HIVE-11948.6.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 3 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 4 failed/errored test(s), 9778 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hadoop.hive.hwi.TestHWISessionManager.testHiveDriver
org.apache.hive.hcatalog.streaming.TestStreaming.testHearbeat
org.apache.hive.jdbc.TestSSL.testSSLVersion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5986/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5986/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5986/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5986/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5986/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5986/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12771582 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14999627" author="ekoifman" created="Wed, 11 Nov 2015 00:00:40 +0000"  >&lt;p&gt;one last minor tweak&lt;/p&gt;</comment>
                            <comment id="15000148" author="hiveqa" created="Wed, 11 Nov 2015 09:21:38 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12771654/HIVE-11948.7.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12771654/HIVE-11948.7.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 3 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 4 failed/errored test(s), 9778 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_cbo_rp_annotate_stats_groupby
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hadoop.hive.hwi.TestHWISessionManager.testHiveDriver
org.apache.hive.jdbc.TestSSL.testSSLVersion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5993/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5993/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5993/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5993/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5993/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5993/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12771654 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="15000573" author="ekoifman" created="Wed, 11 Nov 2015 16:05:45 +0000"  >&lt;p&gt;test failures not related&lt;/p&gt;</comment>
                            <comment id="15007498" author="alangates" created="Mon, 16 Nov 2015 22:31:58 +0000"  >&lt;p&gt;In TxnHandler, around line 495:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Why doesn&apos;t this get a txnid as parameter?  The caller should either know the txnid or know there isn&apos;t one.  Either way getTxnIdFromLockId() will not be needed.  This would be a Thrift change.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We should file a JIRA for that.  Same goes for comment at line 501.  We might just want to file an umbrella JIRA saying &quot;take care of TODOs in TxnHandler and CompactionTxnHandler&quot; and then we can file JIRAs for individual ones.&lt;/p&gt;

&lt;p&gt;TxnHandler, line 522:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (txnid &amp;gt; 0) {
        heartbeatTxn(dbConn, txnid);
     }
    &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        heartbeatLock(dbConn, extLockId);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Previously the code was:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; heartbeatLock(dbConn, extLockId);		
 ...
 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (txnid &amp;gt; 0)  heartbeatTxn(dbConn, txnid);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You&apos;ve changed the logic so that locks will only be heartbeat if there is no transaction.  I don&apos;t think that&apos;s what you want.&lt;/p&gt;

&lt;p&gt;TxnHander unlock(), around line 581, you moved the check that a lock is associated with a txn below the failure detection.  Are you depending on the db constraints to catch that the lock entry can&apos;t be deleted because a txn it is associated with still exists?  If so, that should be commented.  If not, this is a logical error as we want to make sure never to unlock a lock associated with a txn.&lt;/p&gt;

&lt;p&gt;TxnHandler.getRequiredIsolationLevel(), line 2270&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(dbProduct == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
  Connection tmp = getDbConn(Connection.TRANSACTION_READ_COMMITTED);
  determineDatabaseProduct(tmp);
  closeDbConn(tmp);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We should modify determineDatabaseProduct to accept null for the connection and create its own rather than repeating this logic anytime we don&apos;t have a connection.&lt;/p&gt;
</comment>
                            <comment id="15008937" author="ekoifman" created="Tue, 17 Nov 2015 16:18:54 +0000"  >&lt;p&gt;There is  a RB link for this patch, it may be easier to add comments there.&lt;/p&gt;

&lt;p&gt;I&apos;ll take care of separate bugs.&lt;/p&gt;

&lt;p&gt;The change in TxnHandler.checkLock() regarding heratbeat is intentional.  When there is a txn, only the txn needs to have heartbeat timestamp updated since that is the only timestamp checked for aborting an expired txn.  There is no way/reason to expire a single lock in a txn.  This simplifies both heartbeat and expiration operations (at least when there is a txn).&lt;/p&gt;


&lt;p&gt;TxnHander unlock(), around line 581.  The statement to remove the lock is &quot;delete from HIVE_LOCKS where hl_lock_ext_id = &quot; + extLockId + &quot; AND hl_txnid = 0&quot;;&lt;br/&gt;
The &quot;hl_txnid=0&quot; ensures that this lock doesn&apos;t belong to a transaction.  So the unlock() operation runs in  a single SQL statement under most circumstances, but if the above SQL &quot;misses&quot;, then there is some additional operations performed to produce a meaningful (best effort) message.  Previously this operation required 3 SQL statements in all cases.&lt;/p&gt;

&lt;p&gt;TxnHandler.getRequiredIsolationLevel(), line 2270.  Since &quot;dbProduct&quot; is only set once per MS start I don&apos;t think this causes any more connections to be taken out...&lt;/p&gt;




</comment>
                            <comment id="15009126" author="alangates" created="Tue, 17 Nov 2015 17:52:42 +0000"  >&lt;blockquote&gt;&lt;p&gt;There is a RB link for this patch, it may be easier to add comments there.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I know, I just don&apos;t like review board.  It&apos;s harder to keep track of comments and feedback because they&apos;re not in the JIRA.  I look forward to moving to pull requests someday so feedback and changes can be tracked in one place conveniently.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The change in TxnHandler.checkLock() regarding heratbeat is intentional...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Makes sense.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;TxnHander unlock(), around line 581...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;My mistake, I was thinking that commit() called unlock(), but looking at the code I see it does the unlocking itself, so only worrying about locks that are not associated with a txn here makes sense.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Since &quot;dbProduct&quot; is only set once per MS start I don&apos;t think this causes any more connections to be taken out...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That&apos;s not what I was saying.  I was saying for programmer convenience it would make sense to change this to be:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;determineDatabaseProduct(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and change determineDataProduct to be:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; DatabaseProduct determineDatabaseProduct(Connection conn) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; MetaException {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (dbProduct == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (conn == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-comment&quot;&gt;// get connection...
&lt;/span&gt;      }
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is purely convenience and not necessary.&lt;/p&gt;

&lt;p&gt;+1 for the patch.&lt;/p&gt;</comment>
                            <comment id="15009996" author="ekoifman" created="Wed, 18 Nov 2015 01:28:27 +0000"  >&lt;p&gt;committed to branch-1 &lt;a href=&quot;https://github.com/apache/hive/commit/a80841b73431de470cd0e53fcee3d04ca85ef7f5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/commit/a80841b73431de470cd0e53fcee3d04ca85ef7f5&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;master &lt;a href=&quot;https://github.com/apache/hive/commit/da947fab4391642f60d46471cc007dc71b840cbd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/commit/da947fab4391642f60d46471cc007dc71b840cbd&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gates&quot; class=&quot;user-hover&quot; rel=&quot;gates&quot;&gt;gates&lt;/a&gt; for the review&lt;/p&gt;</comment>
                            <comment id="15047831" author="ekoifman" created="Wed, 9 Dec 2015 01:21:22 +0000"  >&lt;p&gt;this introduced &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-12585&quot; title=&quot;fix TxnHandler connection leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-12585&quot;&gt;&lt;del&gt;HIVE-12585&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12912381">HIVE-12389</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12937102">HIVE-13013</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12910847">HIVE-12352</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12918137">HIVE-12585</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12913840">HIVE-12439</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12771488" name="HIVE-11948.3.patch" size="64871" author="ekoifman" created="Tue, 10 Nov 2015 04:22:42 +0000"/>
                            <attachment id="12771497" name="HIVE-11948.4.patch" size="64870" author="ekoifman" created="Tue, 10 Nov 2015 05:57:16 +0000"/>
                            <attachment id="12771505" name="HIVE-11948.5.patch" size="67113" author="ekoifman" created="Tue, 10 Nov 2015 06:54:01 +0000"/>
                            <attachment id="12771582" name="HIVE-11948.6.patch" size="68028" author="ekoifman" created="Tue, 10 Nov 2015 16:35:19 +0000"/>
                            <attachment id="12771654" name="HIVE-11948.7.patch" size="68917" author="ekoifman" created="Wed, 11 Nov 2015 00:00:40 +0000"/>
                            <attachment id="12771209" name="HIVE-11948.patch" size="48662" author="ekoifman" created="Sat, 7 Nov 2015 23:12:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 50 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2lj33:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>