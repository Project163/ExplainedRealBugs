<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:04:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-3980] Cleanup after HIVE-3403</title>
                <link>https://issues.apache.org/jira/browse/HIVE-3980</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;There have been a lot of comments on &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3403&quot; title=&quot;user should not specify mapjoin to perform sort-merge bucketed join&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3403&quot;&gt;&lt;del&gt;HIVE-3403&lt;/del&gt;&lt;/a&gt;, which involve changing &lt;br/&gt;
variable names/function names/adding more comments/general cleanup etc.&lt;/p&gt;

&lt;p&gt;Since &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3403&quot; title=&quot;user should not specify mapjoin to perform sort-merge bucketed join&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3403&quot;&gt;&lt;del&gt;HIVE-3403&lt;/del&gt;&lt;/a&gt; involves a lot of refactoring, it was fairly difficult to&lt;br/&gt;
address the comments there, since refreshing becomes impossible. This jira&lt;br/&gt;
is to track those cleanups.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12630612">HIVE-3980</key>
            <summary>Cleanup after HIVE-3403</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="namit">Namit Jain</assignee>
                                    <reporter username="namit">Namit Jain</reporter>
                        <labels>
                    </labels>
                <created>Mon, 4 Feb 2013 05:27:12 +0000</created>
                <updated>Thu, 16 May 2013 21:10:03 +0000</updated>
                            <resolved>Tue, 26 Mar 2013 08:28:35 +0000</resolved>
                                                    <fixVersion>0.11.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13570002" author="namit" created="Mon, 4 Feb 2013 05:55:01 +0000"  >
&lt;p&gt;common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;br/&gt;
503 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
Better name: hive.auto.convert.sortmerge.join?&lt;br/&gt;
504 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
hive.auto.convert.sortmerge.join.bigtable.selection.policy ?&lt;br/&gt;
ql/src/java/org/apache/hadoop/hive/ql/optimizer/AbstractBucketJoinProc.java&lt;br/&gt;
108 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
Why is this needed ? If orders[] = index for all i, this is not needed and if orders[] != index for some i, than we are partially updating orders[] which sounds dangerous.&lt;br/&gt;
114 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
I think it makes more sense to do this check before looping over and comparing orders, since this is a stricter check, in a sense that if all join keys are not bucketed columns there is no point in checking order.&lt;br/&gt;
98 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
Better argument name: joinKeys ?&lt;br/&gt;
99 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
Better argument name: joinKeyOrders?&lt;br/&gt;
80 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
Better function name: getBucketFilePathOfPartition() ?&lt;br/&gt;
Also can you refactor this to return List&amp;lt;Path&amp;gt; instead, we had troubles because of String Vs Path interchangeable usage in Hive code base in past.&lt;br/&gt;
97 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
Comment for function ?&lt;br/&gt;
&quot;This function checks whether all bucketing columns are also in join keys and are in same order.&quot;&lt;br/&gt;
117 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
Better function name: checkNumOfBucketsAgainstBigTable()?&lt;br/&gt;
118 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
Better param name: aliasToNumOfBuckets, NumOfBucketsInPartition ?&lt;br/&gt;
182 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
This function does bunch of checks to determine if join can be converted to bucketmapjoin. It will be good idea to list all the checks it performs in comments for this method.&lt;br/&gt;
190 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
better name: tblAliasToNumOfBucketsInEachPartition ?&lt;br/&gt;
Actually, it seems that you can always derive this info from the next field, it is just the size of the innermost list in next map. If so, please consider getting rid of this map and just use next field wherever this one is required. &lt;br/&gt;
Having too many datastructures makes code harder to follow as well as results in tighter function coupling.&lt;br/&gt;
192 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
better name: tblAliasToListOfBucketedFilePathInEachPartition?&lt;br/&gt;
200&#8211;203 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
Similar comment as the one above applies here as well.&lt;br/&gt;
210 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
In what case, topOp for the alias could be null. Is it a subquery case? Either case, please add a comment when this topOp could be null and why in that case we cannot join to BMJ.&lt;br/&gt;
219 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
Comment:&lt;br/&gt;
We cannot get to root TS operator, likely because there is a join or group-by between topOp and root TS operator. We don&apos;t handle that case, so we simply return.&lt;br/&gt;
226 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
Should this be topOpEntry.getValue().equals(tso) instead ?&lt;br/&gt;
361 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
This function does bunch of checks to determine if mapjoin can be converted to bucketmapjoin. It will be good idea to list all the checks it performs in comments for this method.&lt;br/&gt;
366 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
Better name ?&lt;br/&gt;
205 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
Better name: joinKeyOrder?&lt;br/&gt;
ql/src/java/org/apache/hadoop/hive/ql/optimizer/AbstractSMBJoinProc.java&lt;br/&gt;
87 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
Comment:&lt;br/&gt;
First check if this map-join operator is already a BMJ or not. If not give up we are only trying to convert a BMJ to sort-BMJ.&lt;br/&gt;
121 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
If table is not sorted, we cannot do sortBMJ anyways. Secondly we cannot do sortBMJ for outer joins either. Shouldn&apos;t this check be made much earlier?&lt;br/&gt;
232 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
Early parts of this method performs some of the same checks of checkConvertBucketMapJoin() of AbstractBucketJoinProc.java. Perhaps, we can refactor to avoid code duplication. Further, name isTableSorted is not correct, since it does much more than checking if table is sorted. Better name: isEligibleForSBMJ() ?&lt;br/&gt;
462 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
This should be a checked exception (perhaps of type SemanticException). Certainly, not RuntimeException.&lt;br/&gt;
ql/src/java/org/apache/hadoop/hive/ql/optimizer/AvgPartitionSizeSortMergeJoinBigTableMatcher.java&lt;br/&gt;
41 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
Better name: AvgPartitionSizeBasedTblSelectorForSMJ ?&lt;br/&gt;
41 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
Is there a test for this policy ?&lt;br/&gt;
ql/src/java/org/apache/hadoop/hive/ql/optimizer/BucketJoinOptProcCtx.java&lt;br/&gt;
39 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
Better name: rejectedJoinOps.&lt;br/&gt;
42 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
Better name: convertedJoinOps. Also, update the comment.&lt;br/&gt;
60 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
Name: getRejectedJoinOps ?&lt;br/&gt;
Also can similarly name other getters and setters of this class.&lt;/p&gt;</comment>
                            <comment id="13581931" author="namit" created="Wed, 20 Feb 2013 04:15:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.facebook.net/D8703&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D8703&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13581946" author="namit" created="Wed, 20 Feb 2013 04:51:40 +0000"  >&lt;p&gt;cleanup patch &amp;#8211; only involves comments/changing variable names/function names etc.&lt;/p&gt;</comment>
                            <comment id="13582021" author="namit" created="Wed, 20 Feb 2013 07:55:03 +0000"  >&lt;p&gt;Tests passed&lt;/p&gt;</comment>
                            <comment id="13582267" author="jarcec" created="Wed, 20 Feb 2013 16:00:48 +0000"  >&lt;p&gt;+1 (non-binding)&lt;/p&gt;

&lt;p&gt;Seems as a reasonable changes to me.&lt;/p&gt;

&lt;p&gt;Jacec&lt;/p&gt;</comment>
                            <comment id="13584413" author="ashutoshc" created="Fri, 22 Feb 2013 16:36:35 +0000"  >&lt;p&gt;Current patch doesn&apos;t address all the concerns.&lt;/p&gt;</comment>
                            <comment id="13584520" author="namit" created="Fri, 22 Feb 2013 18:35:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt;, which ones ?&lt;/p&gt;</comment>
                            <comment id="13589241" author="namit" created="Thu, 28 Feb 2013 06:20:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt;, ping&lt;/p&gt;</comment>
                            <comment id="13590275" author="namit" created="Fri, 1 Mar 2013 06:09:53 +0000"  >&lt;p&gt;Tests passed after refresh&lt;/p&gt;</comment>
                            <comment id="13591601" author="ashutoshc" created="Sun, 3 Mar 2013 02:24:52 +0000"  >&lt;p&gt;From the list you posted on this jira, I don&apos;t see any code changes/code comments/explanation for following changes:&lt;/p&gt;

&lt;p&gt;114 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
I think it makes more sense to do this check before looping over and comparing orders, since this is a stricter check, in a sense that if all join keys are not bucketed columns there is no point in checking order.&lt;/p&gt;

&lt;p&gt;Also can you refactor this to return List&amp;lt;Path&amp;gt; instead, we had troubles because of String Vs Path interchangeable usage in Hive code base in past.&lt;/p&gt;

&lt;p&gt;Actually, it seems that you can always derive this info from the next field, it is just the size of the innermost list in next map. If so, please consider getting rid of this map and just use next field wherever this one is required. &lt;br/&gt;
Having too many datastructures makes code harder to follow as well as results in tighter function coupling.&lt;/p&gt;

&lt;p&gt;200&#8211;203 &#8599;&lt;br/&gt;
(On Diff #26877)	&lt;br/&gt;
Similar comment as the one above applies here as well.&lt;/p&gt;

&lt;p&gt;(On Diff #26877)	&lt;br/&gt;
Should this be topOpEntry.getValue().equals(tso) instead ?&lt;/p&gt;

&lt;p&gt;On Diff #26877)	&lt;br/&gt;
If table is not sorted, we cannot do sortBMJ anyways. Secondly we cannot do sortBMJ for outer joins either. Shouldn&apos;t this check be made much earlier?&lt;/p&gt;

&lt;p&gt;Early parts of this method performs some of the same checks of checkConvertBucketMapJoin() of AbstractBucketJoinProc.java. Perhaps, we can refactor to avoid code duplication.&lt;/p&gt;</comment>
                            <comment id="13611144" author="ashutoshc" created="Fri, 22 Mar 2013 19:50:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=namit&quot; class=&quot;user-hover&quot; rel=&quot;namit&quot;&gt;namit&lt;/a&gt; If you don&apos;t intend to work on this any further, lets get this committed as it is. As its already improving on current situation. I checked and current patch does apply. Let me know.&lt;/p&gt;</comment>
                            <comment id="13611562" author="namit" created="Sat, 23 Mar 2013 04:16:26 +0000"  >&lt;p&gt;Since this is a cleanup, let me get the current cleanup in (ofcourse after refreshing etc.)&lt;br/&gt;
Can file a new patch for the remaining items ?&lt;/p&gt;</comment>
                            <comment id="13611564" author="namit" created="Sat, 23 Mar 2013 04:16:41 +0000"  >&lt;p&gt;need to refresh&lt;/p&gt;</comment>
                            <comment id="13611624" author="namit" created="Sat, 23 Mar 2013 05:15:59 +0000"  >&lt;p&gt;refreshed &amp;#8211; running tests again&lt;/p&gt;</comment>
                            <comment id="13611680" author="namit" created="Sat, 23 Mar 2013 11:33:45 +0000"  >&lt;p&gt;test passed&lt;/p&gt;</comment>
                            <comment id="13613613" author="ashutoshc" created="Tue, 26 Mar 2013 08:28:35 +0000"  >&lt;p&gt;Committed to trunk. Thanks, Namit!&lt;/p&gt;</comment>
                            <comment id="13615492" author="hudson" created="Wed, 27 Mar 2013 16:57:51 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #2033 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/2033/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/2033/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3980&quot; title=&quot;Cleanup after HIVE-3403&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3980&quot;&gt;&lt;del&gt;HIVE-3980&lt;/del&gt;&lt;/a&gt; : Cleanup after 3403 (Namit Jain via Ashutosh Chauhan) (Revision 1461012)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
hashutosh : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1461012&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1461012&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/AbstractBucketJoinProc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/AbstractSMBJoinProc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/BucketJoinProcCtx.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapJoinDesc.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13623068" author="hudson" created="Thu, 4 Apr 2013 23:39:59 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #138 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/138/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/138/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3980&quot; title=&quot;Cleanup after HIVE-3403&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3980&quot;&gt;&lt;del&gt;HIVE-3980&lt;/del&gt;&lt;/a&gt; : Cleanup after 3403 (Namit Jain via Ashutosh Chauhan) (Revision 1461012)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
hashutosh : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1461012&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1461012&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/AbstractBucketJoinProc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/AbstractSMBJoinProc.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/BucketJoinProcCtx.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/plan/MapJoinDesc.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12604358">HIVE-3403</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12569968" name="hive.3980.1.patch" size="11700" author="namit" created="Tue, 19 Feb 2013 17:35:02 +0000"/>
                            <attachment id="12570078" name="hive.3980.2.patch" size="25495" author="namit" created="Wed, 20 Feb 2013 04:49:40 +0000"/>
                            <attachment id="12571536" name="hive.3980.3.patch" size="25495" author="namit" created="Fri, 1 Mar 2013 04:15:58 +0000"/>
                            <attachment id="12575160" name="hive.3980.4.patch" size="25495" author="namit" created="Sat, 23 Mar 2013 05:13:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>311108</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 33 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1hovb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>311456</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>