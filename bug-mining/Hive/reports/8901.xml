<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:27:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-29146] Query with WITH clause fails during split generation when CTE materaliazation is enabled</title>
                <link>https://issues.apache.org/jira/browse/HIVE-29146</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Queries with WITH clause over transactional tables fail at runtime during split generation when the CTE materialization is enabled.&lt;/p&gt;

&lt;p&gt;The problem can be reproduced by running TPC-DS query 11 and setting the following properties.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;set&lt;/span&gt; hive.&lt;span class=&quot;code-keyword&quot;&gt;optimize&lt;/span&gt;.cte.materialize.threshold=2;
&lt;span class=&quot;code-keyword&quot;&gt;set&lt;/span&gt; hive.&lt;span class=&quot;code-keyword&quot;&gt;optimize&lt;/span&gt;.cte.materialize.&lt;span class=&quot;code-keyword&quot;&gt;full&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;aggregate&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;only&lt;/span&gt;=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
&lt;span class=&quot;code-keyword&quot;&gt;set&lt;/span&gt; hive.&lt;span class=&quot;code-keyword&quot;&gt;optimize&lt;/span&gt;.shared.&lt;span class=&quot;code-keyword&quot;&gt;work&lt;/span&gt;=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;

&lt;span class=&quot;code-keyword&quot;&gt;with&lt;/span&gt; year_total &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; (
 &lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; c_customer_id customer_id
       ,c_first_name customer_first_name
       ,c_last_name customer_last_name
       ,c_preferred_cust_flag customer_preferred_cust_flag
       ,c_birth_country customer_birth_country
       ,c_login customer_login
       ,c_email_address customer_email_address
       ,d_year dyear
       ,&lt;span class=&quot;code-keyword&quot;&gt;sum&lt;/span&gt;(ss_ext_list_price-ss_ext_discount_amt) year_total
       ,&lt;span class=&quot;code-quote&quot;&gt;&apos;s&apos;&lt;/span&gt; sale_type
 &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; customer
     ,store_sales
     ,date_dim
 &lt;span class=&quot;code-keyword&quot;&gt;where&lt;/span&gt; c_customer_sk = ss_customer_sk
   &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; ss_sold_date_sk = d_date_sk
 &lt;span class=&quot;code-keyword&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;by&lt;/span&gt; c_customer_id
         ,c_first_name
         ,c_last_name
         ,c_preferred_cust_flag
         ,c_birth_country
         ,c_login
         ,c_email_address
         ,d_year
 &lt;span class=&quot;code-keyword&quot;&gt;union&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;all&lt;/span&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; c_customer_id customer_id
       ,c_first_name customer_first_name
       ,c_last_name customer_last_name
       ,c_preferred_cust_flag customer_preferred_cust_flag
       ,c_birth_country customer_birth_country
       ,c_login customer_login
       ,c_email_address customer_email_address
       ,d_year dyear
       ,&lt;span class=&quot;code-keyword&quot;&gt;sum&lt;/span&gt;(ws_ext_list_price-ws_ext_discount_amt) year_total
       ,&lt;span class=&quot;code-quote&quot;&gt;&apos;w&apos;&lt;/span&gt; sale_type
 &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; customer
     ,web_sales
     ,date_dim
 &lt;span class=&quot;code-keyword&quot;&gt;where&lt;/span&gt; c_customer_sk = ws_bill_customer_sk
   &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; ws_sold_date_sk = d_date_sk
 &lt;span class=&quot;code-keyword&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;by&lt;/span&gt; c_customer_id
         ,c_first_name
         ,c_last_name
         ,c_preferred_cust_flag
         ,c_birth_country
         ,c_login
         ,c_email_address
         ,d_year
         )
  &lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt;
                  t_s_secyear.customer_id
                 ,t_s_secyear.customer_first_name
                 ,t_s_secyear.customer_last_name
                 ,t_s_secyear.customer_birth_country
 &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; year_total t_s_firstyear
     ,year_total t_s_secyear
     ,year_total t_w_firstyear
     ,year_total t_w_secyear
 &lt;span class=&quot;code-keyword&quot;&gt;where&lt;/span&gt; t_s_secyear.customer_id = t_s_firstyear.customer_id
         &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; t_s_firstyear.customer_id = t_w_secyear.customer_id
         &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; t_s_firstyear.customer_id = t_w_firstyear.customer_id
         &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; t_s_firstyear.sale_type = &lt;span class=&quot;code-quote&quot;&gt;&apos;s&apos;&lt;/span&gt;
         &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; t_w_firstyear.sale_type = &lt;span class=&quot;code-quote&quot;&gt;&apos;w&apos;&lt;/span&gt;
         &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; t_s_secyear.sale_type = &lt;span class=&quot;code-quote&quot;&gt;&apos;s&apos;&lt;/span&gt;
         &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; t_w_secyear.sale_type = &lt;span class=&quot;code-quote&quot;&gt;&apos;w&apos;&lt;/span&gt;
         &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; t_s_firstyear.dyear = 1999
         &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; t_s_secyear.dyear = 1999+1
         &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; t_w_firstyear.dyear = 1999
         &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; t_w_secyear.dyear = 1999+1
         &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; t_s_firstyear.year_total &amp;gt; 0
         &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; t_w_firstyear.year_total &amp;gt; 0
         &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;when&lt;/span&gt; t_w_firstyear.year_total &amp;gt; 0 &lt;span class=&quot;code-keyword&quot;&gt;then&lt;/span&gt; t_w_secyear.year_total / t_w_firstyear.year_total &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; 0.0 &lt;span class=&quot;code-keyword&quot;&gt;end&lt;/span&gt;
             &amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;when&lt;/span&gt; t_s_firstyear.year_total &amp;gt; 0 &lt;span class=&quot;code-keyword&quot;&gt;then&lt;/span&gt; t_s_secyear.year_total / t_s_firstyear.year_total &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; 0.0 &lt;span class=&quot;code-keyword&quot;&gt;end&lt;/span&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;order&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;by&lt;/span&gt; t_s_secyear.customer_id
         ,t_s_secyear.customer_first_name
         ,t_s_secyear.customer_last_name
         ,t_s_secyear.customer_birth_country
&lt;span class=&quot;code-keyword&quot;&gt;limit&lt;/span&gt; 100;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
Sample error is shown below. There are various occurrences of the same error each with a different table.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2025-08-14T05:10:46,213 ERROR [Dispatcher thread {Central}] impl.VertexImpl: Vertex Input: date_dim initializer failed, vertex=vertex_1755173441322_0001_1_02 [Map 6]
org.apache.tez.dag.app.dag.impl.AMUserCodeException: java.io.IOException: Acid table: default.date_dim is missing from the ValidWriteIdList config: null
        at org.apache.tez.dag.app.dag.RootInputInitializerManager$InputInitializerCallback.onFailure(RootInputInitializerManager.java:330) ~[tez-dag-0.10.5.jar:0.10.5]
        at com.google.common.util.concurrent.Futures$CallbackListener.run(Futures.java:1228) ~[guava-22.0.jar:?]
        at com.google.common.util.concurrent.MoreExecutors$DirectExecutor.execute(MoreExecutors.java:399) ~[guava-22.0.jar:?]
        at com.google.common.util.concurrent.AbstractFuture.executeListener(AbstractFuture.java:911) ~[guava-22.0.jar:?]
        at com.google.common.util.concurrent.AbstractFuture.complete(AbstractFuture.java:822) ~[guava-22.0.jar:?]
        at com.google.common.util.concurrent.AbstractFuture.setException(AbstractFuture.java:686) ~[guava-22.0.jar:?]
        at com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:113) ~[guava-22.0.jar:?]
        at com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:58) ~[guava-22.0.jar:?]
        at com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:75) ~[guava-22.0.jar:?]
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[?:?]
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[?:?]
        at java.base/java.lang.Thread.run(Thread.java:1583) [?:?]
Caused by: java.io.IOException: Acid table: default.date_dim is missing from the ValidWriteIdList config: null
        at org.apache.hadoop.hive.ql.io.HiveInputFormat.addSplitsForGroup(HiveInputFormat.java:536) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]
        at org.apache.hadoop.hive.ql.io.HiveInputFormat.getSplits(HiveInputFormat.java:880) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]
        at org.apache.hadoop.hive.ql.exec.tez.HiveSplitGenerator.initialize(HiveSplitGenerator.java:363) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]
        at org.apache.tez.dag.app.dag.RootInputInitializerManager$InputInitializerCallable$1.run(RootInputInitializerManager.java:280) ~[tez-dag-0.10.5.jar:0.10.5]
        at org.apache.tez.dag.app.dag.RootInputInitializerManager$InputInitializerCallable$1.run(RootInputInitializerManager.java:272) ~[tez-dag-0.10.5.jar:0.10.5]
        at java.base/java.security.AccessController.doPrivileged(AccessController.java:714) ~[?:?]
        at java.base/javax.security.auth.Subject.doAs(Subject.java:525) ~[?:?]
        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1953) ~[hadoop-common-3.4.1.jar:?]
        at org.apache.tez.dag.app.dag.RootInputInitializerManager$InputInitializerCallable.call(RootInputInitializerManager.java:272) ~[tez-dag-0.10.5.jar:0.10.5]
        at org.apache.tez.dag.app.dag.RootInputInitializerManager$InputInitializerCallable.call(RootInputInitializerManager.java:256) ~[tez-dag-0.10.5.jar:0.10.5]
        at com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:111) ~[guava-22.0.jar:?]
        ... 5 more

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem is reproducible in master (commit 243bc97290f12c97a11b840f2723ec50458b198c) using  &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13077980/13077980_repro.q&quot; title=&quot;repro.q attached to HIVE-29146&quot;&gt;repro.q&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
mvn test -Dtest=TestMiniLlapLocalCliDriver -Dqfile=repro.q 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13626374">HIVE-29146</key>
            <summary>Query with WITH clause fails during split generation when CTE materaliazation is enabled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="krisztiankasa">Krisztian Kasa</assignee>
                                    <reporter username="zabetak">Stamatis Zampetakis</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 14 Aug 2025 12:24:24 +0000</created>
                <updated>Tue, 26 Aug 2025 10:59:43 +0000</updated>
                            <resolved>Tue, 26 Aug 2025 10:59:43 +0000</resolved>
                                                    <fixVersion>4.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="18013910" author="zabetak" created="Thu, 14 Aug 2025 12:27:30 +0000"  >&lt;p&gt;I have the impression that the repro test can be simplified even more as long as there is a WITH clause that is materialized. &lt;/p&gt;</comment>
                            <comment id="18013919" author="krisztiankasa" created="Thu, 14 Aug 2025 13:43:52 +0000"  >&lt;p&gt;When executing the CTE materialization the ValidWriteIdList is queried from the JobConf. This is required for reading ACID tables referenced in the CTE. However the value is &lt;tt&gt;null&lt;/tt&gt; because this is populated only if the plan has ACID read/writes. ACID read/writes are addressed in the &lt;a href=&quot;https://github.com/apache/hive/blob/52cfa6fc3455f736dbbe7140eee92ec3c1db65cd/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java#L13719-L13817&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;SemanticAnalyzer.validate()&lt;/a&gt; method but this method checks only the main query plan for ACID tables and ignores materialized CTE plans.&lt;/p&gt;</comment>
                            <comment id="18016259" author="krisztiankasa" created="Tue, 26 Aug 2025 10:59:30 +0000"  >&lt;p&gt;Merged to master. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=InvisibleProgrammer&quot; class=&quot;user-hover&quot; rel=&quot;InvisibleProgrammer&quot;&gt;InvisibleProgrammer&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ayushtkn&quot; class=&quot;user-hover&quot; rel=&quot;ayushtkn&quot;&gt;ayushtkn&lt;/a&gt; for the review.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13077980" name="repro.q" size="8065" author="zabetak" created="Thu, 14 Aug 2025 12:23:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1x9ag:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>