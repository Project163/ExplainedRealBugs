<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:26:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-28851] HiveIcebergMetaHook acquires an HMS lock, regardless of the config and operations</title>
                <link>https://issues.apache.org/jira/browse/HIVE-28851</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;HiveIcebergMetaHook acquires an HMS lock regardless of the config or operation, causing a lock collision.&lt;/p&gt;

&lt;p&gt;As a consequence, stat tasks fail during insert queries.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;How to reproduce:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
set hive.support.concurrency=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
set hive.txn.ext.locking.enabled=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
set hive.txn.manager=org.apache.hadoop.hive.ql.lockmgr.DbTxnManager;
set hive.stats.autogather=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;

create table ice_t (i &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) stored by iceberg tblproperties (&lt;span class=&quot;code-quote&quot;&gt;&apos;engine.hive.lock-enabled&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;&lt;/span&gt;);

insert into ice_t values (1);

2025-03-27T12:54:00,304 INFO [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-108] stats.BasicStatsTask: [Warning] could not update stats.Failed with exception Unable to alter table. org.apache.iceberg.hive.LockException: Timed out after 182005 ms waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; lock on &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.ice_t&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
HIVE_LOCKS Table:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+----------------+---------+----------+---------------+--------------+-----+---------------------+
| HL_LOCK_EXT_ID | HL_DB   | HL_TABLE | HL_LOCK_STATE | HL_LOCK_TYPE | ... | HL_BLOCKEDBY_EXT_ID |
+----------------+---------+----------+---------------+--------------+-----+---------------------+
|            110 | &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; | ice_t    | a             | w            | ... |                NULL |
|            111 | &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; | ice_t    | w             | x            | ... |                 110 |
+----------------+---------+----------+---------------+--------------+-----+---------------------+&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There is no need for a stats task to take an EXCL_WRITE lock in a HiveIcebergMetaHook.&lt;/p&gt;

&lt;p&gt;HiveIcebergMetaHook should be refactored to prevent unnecessary lock acquisitions depending on the config and operation like stats task.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13613410">HIVE-28851</key>
            <summary>HiveIcebergMetaHook acquires an HMS lock, regardless of the config and operations</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="owenpark">owen park</assignee>
                                    <reporter username="owenpark">owen park</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 28 Mar 2025 05:02:15 +0000</created>
                <updated>Tue, 29 Jul 2025 14:51:42 +0000</updated>
                            <resolved>Sun, 6 Apr 2025 17:51:45 +0000</resolved>
                                    <version>4.1.0</version>
                                    <fixVersion>4.1.0</fixVersion>
                                    <component>Iceberg integration</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17941400" author="dkuzmenko" created="Sun, 6 Apr 2025 17:51:32 +0000"  >&lt;p&gt;Merged to master&lt;br/&gt;
Thanks for the fix, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=owenpark&quot; class=&quot;user-hover&quot; rel=&quot;owenpark&quot;&gt;owenpark&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            31 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1v1ns:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12353994">4.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>