<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:37:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-11969] start Tez session in background when starting CLI</title>
                <link>https://issues.apache.org/jira/browse/HIVE-11969</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Tez session spins up AM, which can cause delays, esp. if the cluster is very busy.&lt;br/&gt;
This can be done in background, so the AM might get started while the user is running local commands and doing other things.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12896478">HIVE-11969</key>
            <summary>start Tez session in background when starting CLI</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sershe">Sergey Shelukhin</assignee>
                                    <reporter username="sershe">Sergey Shelukhin</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Sep 2015 20:03:39 +0000</created>
                <updated>Tue, 16 Feb 2016 23:52:12 +0000</updated>
                            <resolved>Wed, 7 Oct 2015 20:58:29 +0000</resolved>
                                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>Tez</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14908606" author="sershe" created="Fri, 25 Sep 2015 20:11:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hagleitn&quot; class=&quot;user-hover&quot; rel=&quot;hagleitn&quot;&gt;hagleitn&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sseth&quot; class=&quot;user-hover&quot; rel=&quot;sseth&quot;&gt;sseth&lt;/a&gt; fyi&lt;/p&gt;</comment>
                            <comment id="14908973" author="sershe" created="Sat, 26 Sep 2015 01:33:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sseth&quot; class=&quot;user-hover&quot; rel=&quot;sseth&quot;&gt;sseth&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hagleitn&quot; class=&quot;user-hover&quot; rel=&quot;hagleitn&quot;&gt;hagleitn&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gopalv&quot; class=&quot;user-hover&quot; rel=&quot;gopalv&quot;&gt;gopalv&lt;/a&gt; fyi &lt;a href=&quot;https://reviews.apache.org/r/38783/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/38783/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14908980" author="sershe" created="Sat, 26 Sep 2015 01:37:34 +0000"  >&lt;p&gt;Will test later to see if it works... also need to see if MiniTez passes&lt;/p&gt;</comment>
                            <comment id="14933778" author="sershe" created="Mon, 28 Sep 2015 18:50:57 +0000"  >&lt;p&gt;Looks like HiveQA never picked this up... trying again with the same patch.&lt;/p&gt;</comment>
                            <comment id="14934312" author="hiveqa" created="Mon, 28 Sep 2015 23:15:50 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12764069/HIVE-11969.01.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12764069/HIVE-11969.01.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 9646 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_vector_groupby_reduce
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_groupby_reduce
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5451/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5451/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5451/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5451/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5451/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5451/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12764069 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14936046" author="sershe" created="Tue, 29 Sep 2015 22:46:48 +0000"  >&lt;p&gt;Seems to work as intended on cluster. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sseth&quot; class=&quot;user-hover&quot; rel=&quot;sseth&quot;&gt;sseth&lt;/a&gt; can you take a look? Esp. wrt the right part of init being async.&lt;/p&gt;</comment>
                            <comment id="14938940" author="hagleitn" created="Wed, 30 Sep 2015 21:54:46 +0000"  >&lt;p&gt;How is this going to work with with container prewarm? If you do that async that actually defeats the purpose of it. &lt;/p&gt;

&lt;p&gt;Also in general I think this is a bad idea, because you&apos;re just covering up that there&apos;s no capacity to run queries and it makes the code more complicated because it has to handle async start. The first query you run will now hang and it will just be less clear to the user what goes on. If the connection establishment hangs you go look for capacity, if query hangs you don&apos;t know if query is slow, if cluster is busy etc.&lt;/p&gt;

&lt;p&gt;I think for instance the establishment of the connection shot up recently which was due to Tez + ATS interaction. With this it&apos;s much harder to find such things.&lt;/p&gt;

&lt;p&gt;A better way to let folks do what you suggest is to connect through beeline and configure HS2 to run a pool. That way AM and shell are decoupled and you&apos;re not paying the overhead in the first query.&lt;/p&gt;</comment>
                            <comment id="14938961" author="sershe" created="Wed, 30 Sep 2015 22:12:31 +0000"  >&lt;p&gt;Container prewarm remains part of the init so it&apos;s not affected.&lt;br/&gt;
The CLI startup should be decoupled from Tez session startup because not all queries use Tez; user can do number of operations like set/describe/create/explain/..., or even just take time typing a query, before the session is even needed. There are also stats queries and local fetches that don&apos;t require the session.&lt;br/&gt;
If the query hangs, it will be visible that the query has not started. IMHO it is actually better because you can then check the state of the cluster to see what&apos;s going on.&lt;/p&gt;</comment>
                            <comment id="14938970" author="sershe" created="Wed, 30 Sep 2015 22:20:02 +0000"  >&lt;p&gt;I can add CLI output to the method that will indicate that session is starting when the query waits for it.&lt;/p&gt;</comment>
                            <comment id="14939055" author="sseth" created="Wed, 30 Sep 2015 23:30:03 +0000"  >&lt;p&gt;With the patch - prewarm is moving into the async initialization. However I don&apos;t think that completely defeats the purpose of prewarm. Containers will still be started in the background if cluster capacity is available. The user query can get delayed though while it waits for the prewarm to complete.&lt;/p&gt;

&lt;p&gt;IMHO, adding a log to the CLI indicating that a query is waiting for cluster resources is better than blocking the entire CLI from starting up. Also, as always, a configuration to fallback to current behaviour - which in this case would be disabled by default. Pre-warm as it exists today, would run with this set appropriately.&lt;/p&gt;</comment>
                            <comment id="14940409" author="sershe" created="Thu, 1 Oct 2015 21:02:39 +0000"  >&lt;p&gt;Updated&lt;/p&gt;</comment>
                            <comment id="14940455" author="sershe" created="Thu, 1 Oct 2015 21:35:35 +0000"  >&lt;p&gt;Forgot to add the config flag, will do in next iteration&lt;/p&gt;</comment>
                            <comment id="14941769" author="sershe" created="Fri, 2 Oct 2015 21:10:27 +0000"  >&lt;p&gt;Hmm, that was a wrong patch&lt;/p&gt;</comment>
                            <comment id="14941783" author="sershe" created="Fri, 2 Oct 2015 21:20:07 +0000"  >&lt;p&gt;Tested the recent patch on cluster, clogging the nodes with spurious llap processes &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
The CLI looks like the attached while the corresponding Tez app is submitted but not running. When I stopped the llap cluster, the query started running.&lt;br/&gt;
I could run queries (such as &quot;use database&quot;) without Tez AM (see OK above the query start).&lt;br/&gt;
Query also compiled without waiting for AM.&lt;/p&gt;


&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12764854/12764854_Screen+Shot+2015-10-02+at+14.23.17+.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

</comment>
                            <comment id="14941997" author="gopalv" created="Sat, 3 Oct 2015 00:31:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt;: LGTM - +1.&lt;/p&gt;

&lt;p&gt;Minor comment on the isOpenOrOpening() - can you split that up into 2 different functions, so that the isOpen() does not change.&lt;/p&gt;

&lt;p&gt;That allows the if(isOpening()) to cancel the future &amp;amp; the isOpen() to close the session.&lt;/p&gt;</comment>
                            <comment id="14944044" author="sershe" created="Mon, 5 Oct 2015 21:07:40 +0000"  >&lt;p&gt;Will do that... but that is actually dangerous for future use, since it&apos;s easy to introduce the same bug that the original patch had - call isOpen() and then open if false.&lt;/p&gt;</comment>
                            <comment id="14944063" author="sershe" created="Mon, 5 Oct 2015 21:16:31 +0000"  >&lt;p&gt;Updated patch.&lt;/p&gt;</comment>
                            <comment id="14944388" author="hiveqa" created="Tue, 6 Oct 2015 01:47:04 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12765062/HIVE-11969.04.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12765062/HIVE-11969.04.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 9652 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
org.apache.hive.jdbc.TestJdbcWithLocalClusterSpark.testTempTable
org.apache.hive.jdbc.TestSSL.testSSLVersion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5540/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5540/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5540/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5540/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5540/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5540/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12765062 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14947567" author="sershe" created="Wed, 7 Oct 2015 20:58:29 +0000"  >&lt;p&gt;committed to master&lt;/p&gt;</comment>
                            <comment id="14947578" author="sershe" created="Wed, 7 Oct 2015 21:03:00 +0000"  >&lt;p&gt;It&apos;s a simple backport to branch-1; should we do that?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12764069" name="HIVE-11969.01.patch" size="13635" author="sershe" created="Mon, 28 Sep 2015 18:50:57 +0000"/>
                            <attachment id="12764685" name="HIVE-11969.02.patch" size="14661" author="sershe" created="Thu, 1 Oct 2015 21:04:14 +0000"/>
                            <attachment id="12764852" name="HIVE-11969.03.patch" size="19109" author="sershe" created="Fri, 2 Oct 2015 21:10:27 +0000"/>
                            <attachment id="12765062" name="HIVE-11969.04.patch" size="19641" author="sershe" created="Mon, 5 Oct 2015 21:16:31 +0000"/>
                            <attachment id="12762485" name="HIVE-11969.patch" size="13635" author="sershe" created="Sat, 26 Sep 2015 01:33:50 +0000"/>
                            <attachment id="12764854" name="Screen Shot 2015-10-02 at 14.23.17 .png" size="14001" author="sershe" created="Fri, 2 Oct 2015 21:21:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 6 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2lktb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>