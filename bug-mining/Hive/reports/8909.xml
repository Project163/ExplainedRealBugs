<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:27:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-28551] Stale results when executing queries over recreated tables</title>
                <link>https://issues.apache.org/jira/browse/HIVE-28551</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;SQL queries return stale results from the cache when the tables involved in the queries are dropped and then recreated with the same name.&lt;/p&gt;

&lt;p&gt;The problem can be reproduced by executing the following sequence of queries.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; author (fname &lt;span class=&quot;code-keyword&quot;&gt;STRING&lt;/span&gt;) STORED &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; ORC TBLPROPERTIES(&lt;span class=&quot;code-quote&quot;&gt;&apos;transactional&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;INTO&lt;/span&gt; author &lt;span class=&quot;code-keyword&quot;&gt;VALUES&lt;/span&gt; (&lt;span class=&quot;code-quote&quot;&gt;&apos;Victor&apos;&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; fname &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; author;

&lt;span class=&quot;code-keyword&quot;&gt;DROP&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; author;

&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; author (fname &lt;span class=&quot;code-keyword&quot;&gt;STRING&lt;/span&gt;) STORED &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; ORC TBLPROPERTIES(&lt;span class=&quot;code-quote&quot;&gt;&apos;transactional&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;INTO&lt;/span&gt; author &lt;span class=&quot;code-keyword&quot;&gt;VALUES&lt;/span&gt; (&lt;span class=&quot;code-quote&quot;&gt;&apos;Alexander&apos;&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; fname &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; author;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The first execution of the SELECT query correctly returns &quot;Victor&quot; as a result.&lt;br/&gt;
The second execution of the SELECT query incorrectly returns &quot;Victor&quot; while it should return &quot;Alexander&quot;.&lt;/p&gt;

&lt;p&gt;The problem manifestates only when the hive.query.results.cache.enabled is set to true.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13594002">HIVE-28551</key>
            <summary>Stale results when executing queries over recreated tables</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thomas.rebele">Thomas Rebele</assignee>
                                    <reporter username="zabetak">Stamatis Zampetakis</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 2 Oct 2024 11:40:56 +0000</created>
                <updated>Fri, 12 Sep 2025 08:42:06 +0000</updated>
                            <resolved>Fri, 12 Sep 2025 08:42:06 +0000</resolved>
                                    <version>4.0.1</version>
                                    <fixVersion>4.2.0</fixVersion>
                                    <component>HiveServer2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17886351" author="zabetak" created="Wed, 2 Oct 2024 11:44:57 +0000"  >&lt;p&gt;Based on the &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-18513?focusedCommentId=16484227&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-16484227&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;initial design&lt;/a&gt; of the query result cache dropping or altering a transactional table should result in automatic invalidation of the cached entries.&lt;/p&gt;

&lt;p&gt;It is OK to return stale results for non-transactional tables (when&#160;hive.query.results.cache.nontransactional.tables.enabled property is true) but it is &lt;b&gt;not&lt;/b&gt; OK to return stale results for transactional tables.&lt;/p&gt;</comment>
                            <comment id="17886357" author="zabetak" created="Wed, 2 Oct 2024 12:09:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-19154&quot; title=&quot;Poll notification events to invalidate the results cache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-19154&quot;&gt;&lt;del&gt;HIVE-19154&lt;/del&gt;&lt;/a&gt; adds an event based cache invalidation mechanism that is able remove stale entries from the cache after certain intervals but this is mostly a performance improvement and not a mechanism to guarantee correctness. The cache should never return stale entries for transactional tables.&lt;/p&gt;</comment>
                            <comment id="17886365" author="zabetak" created="Wed, 2 Oct 2024 12:37:55 +0000"  >&lt;p&gt;The problem can be reproduced on master (commit 6e261a32657d36185654dd05af7215fe33123878) by running &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13071933/13071933_results_cache_invalidation3.q&quot; title=&quot;results_cache_invalidation3.q attached to HIVE-28551&quot;&gt;results_cache_invalidation3.q&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;mvn test -Dtest=TestMiniLlapLocalCliDriver -Dtest.output.overwrite -Dqfile=results_cache_invalidation3.q -pl itests/qtest -Pitests
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17886366" author="zabetak" created="Wed, 2 Oct 2024 12:40:13 +0000"  >&lt;p&gt;It seems that after &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-19820&quot; title=&quot;add ACID stats support to background stats updater and fix bunch of edge cases found in SU tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-19820&quot;&gt;&lt;del&gt;HIVE-19820&lt;/del&gt;&lt;/a&gt; there were changes in some .q.out files related to the invalidation of the query result cache (i.e., results_cache_truncate.q) so this bug could be a regression from that ticket.&lt;/p&gt;</comment>
                            <comment id="17886657" author="ximz" created="Thu, 3 Oct 2024 12:28:06 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zabetak&quot; class=&quot;user-hover&quot; rel=&quot;zabetak&quot;&gt;zabetak&lt;/a&gt; I created a PR but it seems not attaching to this jira. Can you please kindly review? Thanks&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hive/pull/5482&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/pull/5482&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17887029" author="zabetak" created="Fri, 4 Oct 2024 20:17:03 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ximz&quot; class=&quot;user-hover&quot; rel=&quot;ximz&quot;&gt;ximz&lt;/a&gt;, thanks for the PR. I am checking it. I am also trying to understand if the write id conflict that affects the query cache is a more general problem that affects the transactional semantics of ACID tables.&lt;/p&gt;</comment>
                            <comment id="17887349" author="zabetak" created="Mon, 7 Oct 2024 13:55:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ximz&quot; class=&quot;user-hover&quot; rel=&quot;ximz&quot;&gt;ximz&lt;/a&gt;&#160; I added you as a contributor to the Jira project and assigned the ticket to you since you prepared the PR.&#160;&lt;/p&gt;</comment>
                            <comment id="17898263" author="zabetak" created="Thu, 14 Nov 2024 12:20:31 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ximz&quot; class=&quot;user-hover&quot; rel=&quot;ximz&quot;&gt;ximz&lt;/a&gt;, do you have time to address the review comments so that we finalize the PR?&lt;/p&gt;</comment>
                            <comment id="18019797" author="zabetak" created="Fri, 12 Sep 2025 08:42:06 +0000"  >&lt;p&gt;Fixed in &lt;a href=&quot;https://github.com/apache/hive/commit/751fd73db24f4b7e0d34dde2ff698bd8421e83f3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/commit/751fd73db24f4b7e0d34dde2ff698bd8421e83f3&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13151446">HIVE-19154</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13164539">HIVE-19820</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13132888">HIVE-18513</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13628744">HIVE-29193</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13071933" name="results_cache_invalidation3.q" size="581" author="zabetak" created="Wed, 2 Oct 2024 12:11:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1rqrk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>