<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:24:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-27760] WHERE condition on DATE type partitioning column leads to wrong results </title>
                <link>https://issues.apache.org/jira/browse/HIVE-27760</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Filter on date type partitioning columns producing 0 results.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Reproduction steps&lt;/b&gt;:&lt;/p&gt;

&lt;p&gt;1. test.q&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE EXTERNAL TABLE test(a string,b String) PARTITIONED BY(PartitionDate DATE) STORED AS ORC;
INSERT into test(PartitionDate, a,b) VALUES(&apos;2023-01-01&apos;,&apos;2023-01-01&apos;,&apos;2023-01-01&apos;);
INSERT into test(PartitionDate, a,b) VALUES(&apos;2023-01-02&apos;,&apos;2023-01-02&apos;,&apos;2023-01-02&apos;);

select count(*) from test where PartitionDate = &apos;2023-01-01&apos;;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;2. Command to execute (pass different timezone than server)&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;mvn test -Dtest=TestMiniTezCliDriver -Dqfile=test.q -Dtest.output.overwrite=true -Duser.timezone=Asia/Hong_Kong&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;RootCause:&lt;/b&gt; As a part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-27373&quot; title=&quot;Unable to pushdown partition filter with unquoted date literal type to metastore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-27373&quot;&gt;&lt;del&gt;HIVE-27373&lt;/del&gt;&lt;/a&gt; issue fix to parse the string to java.sql.Date object, java.text.SimpleDateFormat is replaced with java.time.format.DateTimeFormatter using java.time.LocalDate which represents a Date without TimeZone.&#160; Here this input is passed &lt;a href=&quot;https://github.com/apache/hive/blob/master/standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/MetaStoreDirectSql.java#L1370&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&#160;&lt;/a&gt; which uses SimpleDateFormat(parsing dates in a locale-sensitive manner) and java.sql.Date. Here user timezone is passed different so actual value is getting changed to a different value (for example 2023-01-01 is changed to 2022-12-31) which is not matching with any partition so nothing gets returned.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Solution:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;1. In MetaStoreDirectSql.java, we should use java.time.format.DateTimeFormatter with java.time.LocalDate so that it will return proper date string.&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; Or&lt;/p&gt;

&lt;p&gt;2. Revert the code changes(only formatter and LocalDate) done for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-27373&quot; title=&quot;Unable to pushdown partition filter with unquoted date literal type to metastore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-27373&quot;&gt;&lt;del&gt;HIVE-27373&lt;/del&gt;&lt;/a&gt; and use SimpleDateFormat and java.sql.Date.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13552399">HIVE-27760</key>
            <summary>WHERE condition on DATE type partitioning column leads to wrong results </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Dayakar">Dayakar M</assignee>
                                    <reporter username="Dayakar">Dayakar M</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 29 Sep 2023 08:50:19 +0000</created>
                <updated>Fri, 29 Mar 2024 17:49:53 +0000</updated>
                            <resolved>Fri, 6 Oct 2023 08:58:28 +0000</resolved>
                                                    <fixVersion>4.0.0</fixVersion>
                                    <component>HiveServer2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17771391" author="dayakar" created="Tue, 3 Oct 2023 09:45:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hive/pull/4760&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;GitHub Pull Request #4760&lt;/a&gt; is for 1st solution.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hive/pull/4766&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;GitHub Pull Request #4766&lt;/a&gt; is for 2nd solution.&lt;/p&gt;</comment>
                            <comment id="17772492" author="zabetak" created="Fri, 6 Oct 2023 08:58:28 +0000"  >&lt;p&gt;Fixed in &lt;a href=&quot;https://github.com/apache/hive/commit/1e919dd98169212ab10d267de0dc25bbbdf96b1e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/commit/1e919dd98169212ab10d267de0dc25bbbdf96b1e&lt;/a&gt;. Thanks for the PR &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Dayakar&quot; class=&quot;user-hover&quot; rel=&quot;Dayakar&quot;&gt;Dayakar&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310760">
                    <name>Testing</name>
                                            <outwardlinks description="Testing discovered">
                                        <issuelink>
            <issuekey id="13553129">HIVE-27775</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 5 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1knk8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>