<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:37:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-11217] CTAS statements throws error, when the table is stored as ORC File format and select clause has NULL/VOID type column </title>
                <link>https://issues.apache.org/jira/browse/HIVE-11217</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;If you try to use create-table-as-select (CTAS) statement and create a ORC File format based table, then you can&apos;t use NULL as a column value in select clause &lt;/p&gt;

&lt;p&gt;CREATE TABLE empty (x int);&lt;/p&gt;

&lt;p&gt;CREATE TABLE orc_table_with_null &lt;br/&gt;
STORED AS ORC &lt;br/&gt;
AS &lt;br/&gt;
SELECT &lt;br/&gt;
x,&lt;br/&gt;
null&lt;br/&gt;
FROM empty;&lt;/p&gt;

&lt;p&gt;Error: &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;347084 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; ERROR hive.ql.exec.DDLTask  - org.apache.hadoop.hive.ql.metadata.HiveException: java.lang.IllegalArgumentException: Unknown primitive type VOID&lt;br/&gt;
	at org.apache.hadoop.hive.ql.metadata.Hive.createTable(Hive.java:643)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.exec.DDLTask.createTable(DDLTask.java:4242)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.exec.DDLTask.execute(DDLTask.java:285)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.exec.Task.executeTask(Task.java:153)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.exec.TaskRunner.runSequential(TaskRunner.java:85)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.Driver.launchTask(Driver.java:1554)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.Driver.execute(Driver.java:1321)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.Driver.runInternal(Driver.java:1139)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.Driver.run(Driver.java:962)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.Driver.run(Driver.java:952)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.processLocalCmd(CliDriver.java:269)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:221)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:431)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:367)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.processReader(CliDriver.java:464)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.processFile(CliDriver.java:474)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.executeDriver(CliDriver.java:756)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.run(CliDriver.java:694)&lt;br/&gt;
	at org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:633)&lt;br/&gt;
	at org.apache.oozie.action.hadoop.HiveMain.runHive(HiveMain.java:323)&lt;br/&gt;
	at org.apache.oozie.action.hadoop.HiveMain.run(HiveMain.java:284)&lt;br/&gt;
	at org.apache.oozie.action.hadoop.LauncherMain.run(LauncherMain.java:39)&lt;br/&gt;
	at org.apache.oozie.action.hadoop.HiveMain.main(HiveMain.java:66)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:606)&lt;br/&gt;
	at org.apache.oozie.action.hadoop.LauncherMapper.map(LauncherMapper.java:227)&lt;br/&gt;
	at org.apache.hadoop.mapred.MapRunner.run(MapRunner.java:54)&lt;br/&gt;
	at org.apache.hadoop.mapred.MapTask.runOldMapper(MapTask.java:450)&lt;br/&gt;
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:343)&lt;br/&gt;
	at org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:168)&lt;br/&gt;
	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
	at javax.security.auth.Subject.doAs(Subject.java:415)&lt;br/&gt;
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1642)&lt;br/&gt;
	at org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:163)&lt;br/&gt;
Caused by: java.lang.IllegalArgumentException: Unknown primitive type VOID&lt;br/&gt;
	at org.apache.hadoop.hive.ql.io.orc.OrcStruct.createObjectInspector(OrcStruct.java:530)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.io.orc.OrcStruct$OrcStructInspector.&amp;lt;init&amp;gt;(OrcStruct.java:195)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.io.orc.OrcStruct.createObjectInspector(OrcStruct.java:534)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.io.orc.OrcSerde.initialize(OrcSerde.java:106)&lt;br/&gt;
	at org.apache.hadoop.hive.serde2.SerDeUtils.initializeSerDe(SerDeUtils.java:519)&lt;br/&gt;
	at org.apache.hadoop.hive.metastore.MetaStoreUtils.getDeserializer(MetaStoreUtils.java:345)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.metadata.Table.getDeserializerFromMetaStore(Table.java:292)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.metadata.Table.checkValidity(Table.java:194)&lt;br/&gt;
	at org.apache.hadoop.hive.ql.metadata.Hive.createTable(Hive.java:621)&lt;br/&gt;
	... 35 more&lt;/p&gt;
&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="12843869">HIVE-11217</key>
            <summary>CTAS statements throws error, when the table is stored as ORC File format and select clause has NULL/VOID type column </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ychena">Yongzhi Chen</assignee>
                                    <reporter username="gauravkohli">Gaurav Kohli</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Jul 2015 14:22:15 +0000</created>
                <updated>Thu, 4 Jan 2018 07:55:47 +0000</updated>
                            <resolved>Wed, 23 Sep 2015 06:02:36 +0000</resolved>
                                    <version>0.13.1</version>
                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>File Formats</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14625508" author="ychena" created="Mon, 13 Jul 2015 22:38:02 +0000"  >&lt;p&gt;Fixing it by change void type in the field schema to string type. &lt;/p&gt;</comment>
                            <comment id="14625514" author="ychena" created="Mon, 13 Jul 2015 22:41:38 +0000"  >&lt;p&gt;Need code review. &lt;/p&gt;</comment>
                            <comment id="14625635" author="ashutoshc" created="Tue, 14 Jul 2015 00:52:19 +0000"  >&lt;p&gt;I am not sure implicitly assuming string type is a good choice. I tested following query:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;create table t2 as select &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; from t1;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;It fails on MS SQL Server and Oracle. Passes on postgres and mysql. But type of column in postgres is &lt;tt&gt;unknown&lt;/tt&gt; and in mysql is &lt;tt&gt;binary&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;My preference is to fail this query in Hive as well, although with a better error message.&lt;/p&gt;</comment>
                            <comment id="14625747" author="hiveqa" created="Tue, 14 Jul 2015 03:11:48 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12745140/HIVE-11217.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12745140/HIVE-11217.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 9191 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4603/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4603/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4603/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4603/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4603/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4603/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12745140 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14625798" author="ychena" created="Tue, 14 Jul 2015 04:32:58 +0000"  >&lt;p&gt;Without the patch, for query create table t2 as select null from t1, hive returns success with type void. I think the void type is not good for we can not create table with type void like create table foo (aaa void). And for CTAS with ORC format, hive throws the error.&lt;/p&gt;

&lt;p&gt;So we have 3 choices:&lt;br/&gt;
1. Fix ORC, let it succeeds with type void.&lt;br/&gt;
2. Fix all the format scenarios, let hive return success with type string. (This patch)&lt;br/&gt;
3. Throw errors for all the formats. &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt;, I am fine with choice 2 or 3. Do you still prefer choice 3? &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gauravkohli&quot; class=&quot;user-hover&quot; rel=&quot;gauravkohli&quot;&gt;gauravkohli&lt;/a&gt;, how do you think? &lt;br/&gt;
Thanks&lt;/p&gt;</comment>
                            <comment id="14633896" author="ychena" created="Mon, 20 Jul 2015 17:52:34 +0000"  >&lt;p&gt;On second thought, maybe we should choose option 1. For option 2 and 3 may conflict with fixes for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4172&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-4172&lt;/a&gt; (JDBC2 does not support VOID type). &lt;br/&gt;
Attach a new patch let orc support void type as other serde such as LazySimpleSerDe. &lt;/p&gt;</comment>
                            <comment id="14634075" author="hiveqa" created="Mon, 20 Jul 2015 21:02:16 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12746140/HIVE-11217.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12746140/HIVE-11217.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 9227 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4668/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4668/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4668/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4668/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4668/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4668/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12746140 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14634244" author="ychena" created="Mon, 20 Jul 2015 23:16:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ctang.ma&quot; class=&quot;user-hover&quot; rel=&quot;ctang.ma&quot;&gt;ctang.ma&lt;/a&gt;, could you review the change? Thanks&lt;/p&gt;</comment>
                            <comment id="14642933" author="aihuaxu" created="Mon, 27 Jul 2015 16:13:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;ychena&lt;/a&gt; This change seems reasonable to let ORC be compatible with the other file formats. We can file followup jira to discuss if we want to throw errors like other database since the customer has been using that for some time. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; How do you think?&lt;/p&gt;</comment>
                            <comment id="14708894" author="ashutoshc" created="Mon, 24 Aug 2015 07:29:14 +0000"  >&lt;p&gt;Patch seems reasonable to me. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt; what do you think ?&lt;/p&gt;</comment>
                            <comment id="14720387" author="prasanth_j" created="Fri, 28 Aug 2015 18:44:09 +0000"  >&lt;p&gt;OrcProto is generated file and should never be modified. Also I don&apos;t think VOID is valid supported type in hive &lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Types&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Types&lt;/a&gt;&lt;br/&gt;
IMO, it should be handled at the hive level. Hive should not pass any type other than the ones supported. &lt;/p&gt;</comment>
                            <comment id="14720391" author="prasanth_j" created="Fri, 28 Aug 2015 18:45:04 +0000"  >&lt;p&gt;For insert queries hive maps null values to destination column types. For CTAS, may be it should default to some type (string?).&lt;/p&gt;</comment>
                            <comment id="14743548" author="ychena" created="Mon, 14 Sep 2015 14:08:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt;, The first patch of this jira is mapping void to string type, do you think, it is a better solution? Thanks&lt;/p&gt;</comment>
                            <comment id="14743833" author="prasanth_j" created="Mon, 14 Sep 2015 17:06:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;ychena&lt;/a&gt; Sorry I didn&apos;t look at the first patch. First patch looks reasonable to me. But I think all typecheck and conversions are happening in TypeCheckProcFactory. Can this change be done there instead?&lt;/p&gt;</comment>
                            <comment id="14790570" author="ychena" created="Wed, 16 Sep 2015 15:39:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt;, I can not find a proper place in TypeCheckProcFactory to put the code. For it is related to TypeInfo, could I put it into&lt;br/&gt;
hive/serde2/typeinfo/TypeInfoUtils ?&lt;br/&gt;
Attached the third patch to use TypeInfoUtils. Please review to see if it makes sense.&lt;br/&gt;
Thanks&lt;/p&gt;</comment>
                            <comment id="14791491" author="hiveqa" created="Thu, 17 Sep 2015 02:43:17 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12756282/HIVE-11217.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12756282/HIVE-11217.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 2 failed/errored test(s), 9448 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ctas_nullvalueorc
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5306/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5306/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5306/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5306/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5306/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5306/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12756282 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14791534" author="ychena" created="Thu, 17 Sep 2015 03:38:32 +0000"  >&lt;p&gt;Very recent changes in master affect the output of the qfile a little bit, patch 4 updated the ctas_nullvalueorc.q.out file. &lt;/p&gt;</comment>
                            <comment id="14791546" author="prasanth_j" created="Thu, 17 Sep 2015 04:01:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;ychena&lt;/a&gt; My suggestion is to change the NullExprProcessor in TypeCheckProcFactory. Specifically, the following change&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ExprNodeConstantDesc(TypeInfoFactory.getPrimitiveTypeInfoFromPrimitiveWritable(Text.class), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This changes NullWritable to Text. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; IIRC, CBO changes void type to string. I recently found that when I was writing a test case for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11836&quot; title=&quot;ORC SARG creation throws NPE for null constants with void type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11836&quot;&gt;&lt;del&gt;HIVE-11836&lt;/del&gt;&lt;/a&gt;. Will there be any consequence of the above change?&lt;/p&gt;</comment>
                            <comment id="14803001" author="ychena" created="Thu, 17 Sep 2015 14:42:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt;, changes in TypeCheckProcFactory will cause assert error in my test case:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  TestCliDriver.testCliDriver_ctas_nullvalueorc:130-&amp;gt;runTest:156 Unexpected exception java.lang.AssertionError
	at org.apache.calcite.rex.RexBuilder.makeLiteral(RexBuilder.java:908)
	at org.apache.hadoop.hive.ql.optimizer.calcite.translator.RexNodeConverter.convert(RexNodeConverter.java:389)
	at org.apache.hadoop.hive.ql.optimizer.calcite.translator.RexNodeConverter.convert(RexNodeConverter.java:129)
	at org.apache.hadoop.hive.ql.parse.CalcitePlanner$CalcitePlannerAction.genSelectLogicalPlan(CalcitePlanner.java:2745)
	at org.apache.hadoop.hive.ql.parse.CalcitePlanner$CalcitePlannerAction.genLogicalPlan(CalcitePlanner.java:2842)
	at org.apache.hadoop.hive.ql.parse.CalcitePlanner$CalcitePlannerAction.apply(CalcitePlanner.java:853)
	at org.apache.hadoop.hive.ql.parse.CalcitePlanner$CalcitePlannerAction.apply(CalcitePlanner.java:814)
	at org.apache.calcite.tools.Frameworks$1.apply(Frameworks.java:113)
	at org.apache.calcite.prepare.CalcitePrepareImpl.perform(CalcitePrepareImpl.java:882)
	at org.apache.calcite.tools.Frameworks.withPrepare(Frameworks.java:149)
	at org.apache.calcite.tools.Frameworks.withPlanner(Frameworks.java:106)
	at org.apache.hadoop.hive.ql.parse.CalcitePlanner.getOptimizedAST(CalcitePlanner.java:617)
	at org.apache.hadoop.hive.ql.parse.CalcitePlanner.genOPTree(CalcitePlanner.java:252)
	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.analyzeInternal(SemanticAnalyzer.java:10137)
	at org.apache.hadoop.hive.ql.parse.CalcitePlanner.analyzeInternal(CalcitePlanner.java:212)
	at org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:240)
	at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:428)
	at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:310)
	at org.apache.hadoop.hive.ql.Driver.compileInternal(Driver.java:1150)
	at org.apache.hadoop.hive.ql.Driver.runInternal(Driver.java:1203)
	at org.apache.hadoop.hive.ql.Driver.run(Driver.java:1079)
	at org.apache.hadoop.hive.ql.Driver.run(Driver.java:1069)
	at org.apache.hadoop.hive.cli.CliDriver.processLocalCmd(CliDriver.java:213)
	at org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:165)
	at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:376)
	at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:311)
	at org.apache.hadoop.hive.ql.QTestUtil.executeClientInternal(QTestUtil.java:1033)
	at org.apache.hadoop.hive.ql.QTestUtil.executeClient(QTestUtil.java:1007)
	at org.apache.hadoop.hive.cli.TestCliDriver.runTest(TestCliDriver.java:146)
	at org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ctas_nullvalueorc(TestCliDriver.java:130)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The failure is in&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    case STRING:
      calciteLiteral = rexBuilder.makeLiteral((String) value);
      break;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;makeLiteral assume the value is not null.&lt;/p&gt;

&lt;p&gt;When I use eclipse debug in my local setup, the code is never called, so it passed. But it failed in the unit test. &lt;/p&gt;</comment>
                            <comment id="14804476" author="ashutoshc" created="Thu, 17 Sep 2015 20:47:49 +0000"  >&lt;p&gt;I am still not convinced that silently assuming string type is a good idea. See, my very first comment on this jira. Further, as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;ychena&lt;/a&gt; noted, with &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4172&quot; title=&quot;JDBC2 does not support VOID type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4172&quot;&gt;&lt;del&gt;HIVE-4172&lt;/del&gt;&lt;/a&gt; we are respecting VOID type. IMHO, either we should make ORC support VOID or throw an exception.&lt;/p&gt;</comment>
                            <comment id="14804516" author="prasanth_j" created="Thu, 17 Sep 2015 21:09:18 +0000"  >&lt;p&gt;Agreed with your initial comment. I also favor to throw exception and fail such queries much early instead of at runtime with ORC throwing exception. &lt;/p&gt;</comment>
                            <comment id="14804809" author="ychena" created="Fri, 18 Sep 2015 01:23:06 +0000"  >&lt;p&gt;For the LazySimpleSerDe already supports void, could we just do the same thing in orc? We&apos;d better not break already supported features. Which means patch 2 is a better solution. &lt;/p&gt;</comment>
                            <comment id="14804929" author="hiveqa" created="Fri, 18 Sep 2015 04:01:53 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12756412/HIVE-11217.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12756412/HIVE-11217.4.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 1 failed/errored test(s), 9450 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5319/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5319/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5319/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5319/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5319/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5319/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12756412 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14804973" author="prasanth_j" created="Fri, 18 Sep 2015 05:02:37 +0000"  >&lt;p&gt;I tried the following &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;TEXT&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;hive&amp;gt; create table test_text as select &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; from loc_orc;
OK
hive&amp;gt; desc test_text;
OK
_c0                 	void     
hive&amp;gt; insert into test_text select &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt; from loc_orc;
FAILED: UDFArgumentException void not found.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;RCFILE&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;hive&amp;gt; create table test_rcfile stored as rcfile as select &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; from loc_orc;
OK
hive&amp;gt; desc test_rcfile;
OK
_c0                 	void      
hive&amp;gt; insert into test_rcfile select &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt; from loc_orc;
FAILED: UDFArgumentException void not found.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;AVRO&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;hive&amp;gt; create table test_avro stored as avro as select &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; from loc_orc;
OK
hive&amp;gt; desc test_avro;
OK
_c0                 	void      
hive&amp;gt; insert into test_avro select &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt; from loc_orc;
FAILED: UDFArgumentException void not found.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;PARQUET&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;hive&amp;gt; create table test_parquet stored as parquet as select &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; from loc_orc;
FAILED: Execution Error, &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; code 1 from org.apache.hadoop.hive.ql.exec.DDLTask. java.lang.UnsupportedOperationException: Unknown field type: void
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;ORC&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;hive&amp;gt; create table test_orc stored as orc as select &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; from loc_orc;
FAILED: Execution Error, &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; code 1 from org.apache.hadoop.hive.ql.exec.DDLTask. java.lang.IllegalArgumentException: Unknown primitive type VOID
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Text, RCFile and Avro succeeds CTAS. The type is void but we cannot add any more rows to that table other than nulls which I don&apos;t find quite useful.&lt;/p&gt;

&lt;p&gt;Parquet and ORC fails the query at runtime. &lt;/p&gt;

&lt;p&gt;I still don&apos;t see the usefulness of supporting void in ORC. I think it&apos;s better to fail (preferably much early) than supporting void type to which we cannot add any non-void type values.&lt;/p&gt;</comment>
                            <comment id="14875738" author="ychena" created="Fri, 18 Sep 2015 15:05:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt;, you make a very good point. &lt;br/&gt;
Do you want a change similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2615&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2615&lt;/a&gt; ?&lt;br/&gt;
The patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2615&quot; title=&quot;CTAS with literal NULL creates VOID type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2615&quot;&gt;&lt;del&gt;HIVE-2615&lt;/del&gt;&lt;/a&gt; is never committed.&lt;/p&gt;
</comment>
                            <comment id="14876026" author="prasanth_j" created="Fri, 18 Sep 2015 17:41:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;ychena&lt;/a&gt; Yes. IMO, that&apos;s the way we should take.&lt;br/&gt;
As Ashutosh mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2615&quot; title=&quot;CTAS with literal NULL creates VOID type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2615&quot;&gt;&lt;del&gt;HIVE-2615&lt;/del&gt;&lt;/a&gt;, its better to the type checking in TypeCheckProcFactory instead of SemanticAnalyzer.&lt;/p&gt;</comment>
                            <comment id="14876635" author="ychena" created="Fri, 18 Sep 2015 22:53:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt;, I do not quite understand why it is better in TypeCheckProcFactory.&lt;br/&gt;
To throw this error, need two conditions:&lt;br/&gt;
1. It is CTAS operation.&lt;br/&gt;
2. It has void type column. &lt;br/&gt;
SemanticAnalyzer has all above information, so it is a reasonable place to change.&lt;br/&gt;
We do not throw error for all void columns. For example &quot;select null, key from src &quot; should return values. &lt;br/&gt;
If we make changes in TypeCheckProcFactory ( for example in NullExprProcessor), it will be difficult to know it is in the context of a CTAS or just a simple select. &lt;br/&gt;
I attach patch 5 to throw error in SemanticAnalyzer, could you review it to see if make sense? Or give me more suggestions. Thanks&lt;/p&gt;</comment>
                            <comment id="14877177" author="hiveqa" created="Sat, 19 Sep 2015 15:26:06 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12761218/HIVE-11271.5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12761218/HIVE-11271.5.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 4 failed/errored test(s), 9453 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
org.apache.hive.hcatalog.streaming.TestStreaming.testEndpointConnection
org.apache.hive.hcatalog.streaming.TestStreaming.testRemainingTransactions
org.apache.hive.hcatalog.streaming.TestStreaming.testTransactionBatchCommit_Json
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5342/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5342/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5342/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5342/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5342/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5342/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12761218 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14877341" author="ychena" created="Sat, 19 Sep 2015 23:37:24 +0000"  >&lt;p&gt;The four failures are not related.&lt;/p&gt;

&lt;p&gt;org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation failed more than 100 times&lt;/p&gt;

&lt;p&gt;The 3 org.apache.hive.hcatalog.streaming.TestStreaming tests is caused by:&lt;/p&gt;

&lt;p&gt;Table/View &apos;TXNS&apos; already exists in Schema &apos;APP&apos;.&lt;/p&gt;</comment>
                            <comment id="14901963" author="prasanth_j" created="Tue, 22 Sep 2015 05:23:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;ychena&lt;/a&gt; SemanticAnalyzer in itself is a huge chunk of code and we really don&apos;t want to add more to it. In TypeCheckProcFactory.NullExprProcessor all you have to do is the following to know if it is a CTAS query&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isCTAS = SessionState.get().getCommandType().equals(HiveOperation.CREATETABLE_AS_SELECT.getOperationName());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14902595" author="ychena" created="Tue, 22 Sep 2015 13:24:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt;, Thanks for review the change. &lt;br/&gt;
I think the error has to be thrown in the context of void will be used as column field schema in the CTAS, if the NullExprProcessor used in subquery and not used in the CTAS column, the query should succeed. The place that I am changing will make sure the void will be used as field schema. &lt;/p&gt;

&lt;p&gt;Give you an example:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;create table foo3 as select b.code from (select null, code from jsmall) b;
create table foo4 as select null, code from jsmall;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The first one should succeed while the second should fail. They both use NullExprProcessor and both are CTAS.&lt;br/&gt;
What I am trying to say that TypeCheckProcFactory may sometimes have difficulty to figure out the context of the expression.&lt;/p&gt;</comment>
                            <comment id="14903372" author="prasanth_j" created="Tue, 22 Sep 2015 20:24:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;ychena&lt;/a&gt; Thanks for the explanation. Make sense now. &lt;br/&gt;
Some minor comments: Few lines below your change there is comment about assigning STRING type if column type is VOID. Since we throw SemanticException earlier the following code will be a dead code. Right? Can you please remove it?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-comment&quot;&gt;// Replace VOID type with string when the output is a temp table or
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// local files.
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// A VOID type can be generated under the query:
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// select NULL from tt;
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// or
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// insert overwrite local directory &lt;span class=&quot;code-quote&quot;&gt;&quot;abc&quot;&lt;/span&gt; select NULL from tt;
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// where there is no column type to which the NULL value should be
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// converted.
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt;        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; tName = colInfo.getType().getTypeName();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (tName.equals(serdeConstants.VOID_TYPE_NAME)) {
          colTypes = colTypes.concat(serdeConstants.STRING_TYPE_NAME);
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
          colTypes = colTypes.concat(tName);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;nit: the colType check that you have added can be moved further up, immediately after the for loop iteration to save some allocation/cpu cycles.&lt;/p&gt;</comment>
                            <comment id="14903424" author="ychena" created="Tue, 22 Sep 2015 21:03:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt;, the place that I put the code to throw exception is within &lt;br/&gt;
if (field_schemas != null) which means will create a CTAS table.&lt;br/&gt;
If the field_schemas is null, the change from void to string code will be reached (this is for the case such as &quot;select NULL from tt&quot;, something more like hive internal use void for temp table...) So we have to keep it. &lt;/p&gt;

&lt;p&gt;I will make more changes to save some cpu time. Thanks&lt;/p&gt;</comment>
                            <comment id="14903576" author="ychena" created="Tue, 22 Sep 2015 22:31:50 +0000"  >&lt;p&gt;change the patch name to use the correct jira number.&lt;/p&gt;</comment>
                            <comment id="14903588" author="ychena" created="Tue, 22 Sep 2015 22:41:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt;, when I try to improve the performance, I find most time before the exception thrown is used to get the colName. But the error message need the colName(it is very useful when use alias for the column). So we can not save much time. Could I just keep the patch as is? How do you think? Thanks&lt;/p&gt;</comment>
                            <comment id="14903612" author="prasanth_j" created="Tue, 22 Sep 2015 22:53:42 +0000"  >&lt;p&gt;Sure. Not a problem. +1. Sorry for going back and forth on this issue. I will commit this patch shortly. &lt;/p&gt;</comment>
                            <comment id="14903844" author="ychena" created="Wed, 23 Sep 2015 02:37:59 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt; for reviewing the patch.&lt;/p&gt;</comment>
                            <comment id="14904015" author="prasanth_j" created="Wed, 23 Sep 2015 06:02:36 +0000"  >&lt;p&gt;Committed to master and branch-1. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;ychena&lt;/a&gt; for the contribution!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="13128421">HIVE-18369</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12745140" name="HIVE-11217.1.patch" size="4747" author="ychena" created="Mon, 13 Jul 2015 22:41:20 +0000"/>
                            <attachment id="12746140" name="HIVE-11217.2.patch" size="8048" author="ychena" created="Mon, 20 Jul 2015 17:53:07 +0000"/>
                            <attachment id="12756282" name="HIVE-11217.3.patch" size="5485" author="ychena" created="Wed, 16 Sep 2015 15:43:24 +0000"/>
                            <attachment id="12756412" name="HIVE-11217.4.patch" size="5510" author="ychena" created="Thu, 17 Sep 2015 03:34:17 +0000"/>
                            <attachment id="12761747" name="HIVE-11217.5.patch" size="3166" author="ychena" created="Tue, 22 Sep 2015 22:31:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 9 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2h1xb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>