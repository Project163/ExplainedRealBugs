<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:33:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-10607] Combination of ReducesinkDedup + TopN optimization yields incorrect result if there are multiple GBY in reducer</title>
                <link>https://issues.apache.org/jira/browse/HIVE-10607</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; ctinyint, &lt;span class=&quot;code-keyword&quot;&gt;count&lt;/span&gt;(cdouble) &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; ctinyint, cdouble &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; alltypesorc &lt;span class=&quot;code-keyword&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;by&lt;/span&gt; ctinyint, cdouble) t1 &lt;span class=&quot;code-keyword&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;by&lt;/span&gt; ctinyint &lt;span class=&quot;code-keyword&quot;&gt;order&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;by&lt;/span&gt; ctinyint &lt;span class=&quot;code-keyword&quot;&gt;limit&lt;/span&gt; 20;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This gives different result set depending on which set of optimizations are on. In particular in .q test environment following two invocations will give you different result set:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;*   mvn test -Phadoop-2 -Dtest.output.overwrite=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtest=TestMiniTezCliDriver -Dqfile=test.q -Dhive.optimize.reducededuplication.min.reducer=1 -Dhive.limit.pushdown.memory.usage=0.3f

*   mvn test -Phadoop-2 -Dtest.output.overwrite=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtest=TestMiniTezCliDriver -Dqfile=test.q 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12827111">HIVE-10607</key>
            <summary>Combination of ReducesinkDedup + TopN optimization yields incorrect result if there are multiple GBY in reducer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ashutoshc">Ashutosh Chauhan</assignee>
                                    <reporter username="ashutoshc">Ashutosh Chauhan</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 May 2015 00:41:24 +0000</created>
                <updated>Mon, 18 May 2015 19:49:07 +0000</updated>
                            <resolved>Wed, 6 May 2015 07:01:07 +0000</resolved>
                                    <version>0.13.0</version>
                    <version>0.14.0</version>
                    <version>1.0.0</version>
                    <version>1.1.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>Logical Optimizer</component>
                    <component>Tez</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14527673" author="ashutoshc" created="Tue, 5 May 2015 00:47:34 +0000"  >&lt;p&gt;Cursory analysis informs me that limit pushdown optimization from reducer to mapper was written with MR style execution in mind where reducer cant have more than one group by operator in its pipeline. Tez can run multiple group-by in its reducer breaks some of the assumption of limit pushdown optimization. In particular, that group by is getting its record from all mappers, whereas second GBY operator of reducer in Tez is only receiving its input from its parent reducer.&lt;/p&gt;

&lt;p&gt;I think we shouldn&apos;t push limits from reducer to mapper, if in Tez, reducer has more than 1 GBY in its pipeline. I am not sure if this is sufficient or we need to be more restrictive or less. Thoughts ?&lt;/p&gt;</comment>
                            <comment id="14527678" author="ashutoshc" created="Tue, 5 May 2015 00:48:41 +0000"  >&lt;p&gt;Discovered while debugging failures of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-10568&quot; title=&quot;Select count(distinct()) can have more optimal execution plan&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-10568&quot;&gt;&lt;del&gt;HIVE-10568&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14527951" author="ashutoshc" created="Tue, 5 May 2015 05:29:19 +0000"  >&lt;p&gt;Turns out problem is independent of Tez vs MR. In MR also, one can have reducer with multiple RS in pipeline.&lt;br/&gt;
Conservative patch which detects this case and turns optimization off in such cases. &lt;/p&gt;</comment>
                            <comment id="14527960" author="ashutoshc" created="Tue, 5 May 2015 05:37:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/33837/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/33837/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I have turned off optimization in such cases. Let me know if it is possible to narrow down the scope of disablement of optimization.&lt;/p&gt;</comment>
                            <comment id="14528875" author="sershe" created="Tue, 5 May 2015 17:42:29 +0000"  >&lt;p&gt;+1. Are you going to commit to 1.2?&lt;/p&gt;</comment>
                            <comment id="14528939" author="ashutoshc" created="Tue, 5 May 2015 18:02:52 +0000"  >&lt;p&gt;yeah.. it will be good to have this in 1.2 too. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sushanth&quot; class=&quot;user-hover&quot; rel=&quot;sushanth&quot;&gt;sushanth&lt;/a&gt; is that OK ?&lt;/p&gt;</comment>
                            <comment id="14529191" author="sushanth" created="Tue, 5 May 2015 20:09:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-10607&quot; title=&quot;Combination of ReducesinkDedup + TopN optimization yields incorrect result if there are multiple GBY in reducer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-10607&quot;&gt;&lt;del&gt;HIVE-10607&lt;/del&gt;&lt;/a&gt; is currently marked as an outage in &lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Hive+1.2+Release+Status&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/Hive/Hive+1.2+Release+Status&lt;/a&gt;, so yes, this is approved. Please go ahead and commit.&lt;/p&gt;</comment>
                            <comment id="14529903" author="hiveqa" created="Wed, 6 May 2015 04:42:05 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12730369/HIVE-10607.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12730369/HIVE-10607.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 25 failed/errored test(s), 8900 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_authorization_parts
org.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver_encryption_insert_partition_dynamic
org.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver_encryption_insert_partition_static
org.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver_encryption_join_unencrypted_tbl
org.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver_encryption_join_with_different_encryption_keys
org.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver_encryption_load_data_to_encrypted_tables
org.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver_encryption_select_read_only_encrypted_tbl
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_disallow_transform
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_droppartition
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_sba_drop_table
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_alterpart_loc
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_limit_pushdown
org.apache.hadoop.hive.ql.security.TestStorageBasedClientSideAuthorizationProvider.testSimplePrivileges
org.apache.hadoop.hive.ql.security.TestStorageBasedMetastoreAuthorizationDrops.testDropDatabase
org.apache.hadoop.hive.ql.security.TestStorageBasedMetastoreAuthorizationDrops.testDropPartition
org.apache.hadoop.hive.ql.security.TestStorageBasedMetastoreAuthorizationDrops.testDropTable
org.apache.hadoop.hive.ql.security.TestStorageBasedMetastoreAuthorizationDrops.testDropView
org.apache.hadoop.hive.ql.security.TestStorageBasedMetastoreAuthorizationProvider.testSimplePrivileges
org.apache.hadoop.hive.ql.security.TestStorageBasedMetastoreAuthorizationProviderWithACL.testSimplePrivileges
org.apache.hadoop.hive.ql.security.TestStorageBasedMetastoreAuthorizationReads.testReadDbFailure
org.apache.hadoop.hive.ql.security.TestStorageBasedMetastoreAuthorizationReads.testReadDbSuccess
org.apache.hadoop.hive.ql.security.TestStorageBasedMetastoreAuthorizationReads.testReadTableFailure
org.apache.hadoop.hive.ql.security.TestStorageBasedMetastoreAuthorizationReads.testReadTableSuccess
org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.TestSQLStdHiveAccessControllerHS2.testConfigProcessing
org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.TestSQLStdHiveAccessControllerHS2.testConfigProcessingCustomSetWhitelistAppend
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3746/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3746/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3746/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3746/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-3746/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-3746/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 25 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12730369 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14530050" author="ashutoshc" created="Wed, 6 May 2015 07:01:07 +0000"  >&lt;p&gt;Committed to master &amp;amp; 1.2&lt;/p&gt;</comment>
                            <comment id="14548669" author="sushanth" created="Mon, 18 May 2015 19:49:07 +0000"  >&lt;p&gt;This issue has been fixed and released as part of the 1.2.0 release. If you find an issue which seems to be related to this one, please create a new jira and link this one with new jira.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12826483">HIVE-10568</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12730369" name="HIVE-10607.patch" size="12614" author="ashutoshc" created="Tue, 5 May 2015 05:29:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 27 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2e9zj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>