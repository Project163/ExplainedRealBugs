<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:24:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-27195] Add database authorization for drop table command</title>
                <link>https://issues.apache.org/jira/browse/HIVE-27195</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Include authorization of the database object during the &quot;drop table&quot; command. Similar to &quot;Create table&quot;, DB permissions should be verified in the case of &quot;drop table&quot; too. Add the database object along with the table object to the list of output objects sent for verifying privileges. This change would ensure that in case of a non-existent table or temporary table (skipped from authorization after &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-20051&quot; title=&quot;Skip authorization for temp tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-20051&quot;&gt;&lt;del&gt;HIVE-20051&lt;/del&gt;&lt;/a&gt;), the authorizer will verify privileges for the database object.&lt;/p&gt;

&lt;p&gt;This would also prevent DROP TABLE IF EXISTS command failure for temporary or non-existing tables with `RangerHiveAuthorizer`. In case of temporary/non-existing table, empty input and output HivePrivilege Objects are sent to Ranger authorizer and after &lt;a href=&quot;https://issues.apache.org/jira/browse/RANGER-3407&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/RANGER-3407&lt;/a&gt; authorization request is built from command in case of empty objects. Hence, the drop table if Exists command fails with &#160;HiveAccessControlException.&lt;/p&gt;

&lt;p&gt;Steps to Repro:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
use test; CREATE TEMPORARY TABLE temp_table (id &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);
drop table &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; exists test.temp_table;
Error: Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; compiling statement: FAILED: HiveAccessControlException Permission denied: user&#160;[rtrivedi]&#160;does not have&#160;[DROP]&#160;privilege on&#160;[test/temp_table]&#160;(state=42000,code=40000)&#160;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13530728">HIVE-27195</key>
            <summary>Add database authorization for drop table command</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rtrivedi12">Riju Trivedi</assignee>
                                    <reporter username="rtrivedi12">Riju Trivedi</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 30 Mar 2023 05:51:06 +0000</created>
                <updated>Tue, 15 Aug 2023 06:33:29 +0000</updated>
                            <resolved>Tue, 1 Aug 2023 13:48:51 +0000</resolved>
                                                    <fixVersion>4.0.0-beta-1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="17716536" author="smajeti" created="Wed, 26 Apr 2023 05:28:55 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rtrivedi12&quot; class=&quot;user-hover&quot; rel=&quot;rtrivedi12&quot;&gt;rtrivedi12&lt;/a&gt; , Is this planned to be fixed in near future ?&lt;/p&gt;</comment>
                            <comment id="17742770" author="zabetak" created="Thu, 13 Jul 2023 11:36:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rtrivedi12&quot; class=&quot;user-hover&quot; rel=&quot;rtrivedi12&quot;&gt;rtrivedi12&lt;/a&gt;Please enrich the description of this ticket with what should be the expected behavior after the changes in the PR. The reference to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-20051&quot; title=&quot;Skip authorization for temp tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-20051&quot;&gt;&lt;del&gt;HIVE-20051&lt;/del&gt;&lt;/a&gt; is a bit misleading since someone may believe that temporary tables will not be authorized while in practice the PR does the opposite and enforces authorization also at the database level.&lt;/p&gt;</comment>
                            <comment id="17744625" author="zabetak" created="Wed, 19 Jul 2023 13:22:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rtrivedi12&quot; class=&quot;user-hover&quot; rel=&quot;rtrivedi12&quot;&gt;rtrivedi12&lt;/a&gt; Thanks for adding more test cases to the PR. Based on what edge cases we have seen so far internally, I think we may need a few more scenarios to consider.&lt;/p&gt;

&lt;p&gt;I created a google &lt;a href=&quot;https://docs.google.com/spreadsheets/d/1CJ1U0LOCpK7TfxY5RSSM4Wmbmt7GiKt5VQrWt1x2tfs/edit?usp=sharing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;spreadsheet&lt;/a&gt; in an attempt to enumerate all the scenarios that we would like to test based on the following boolean questions:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Does the user perform the DROP TABLE statement from the current database?&lt;/li&gt;
	&lt;li&gt;Does the user have the DROP privilege on the database where the table belongs?&lt;/li&gt;
	&lt;li&gt;Does the table (which is being dropped) exist?&lt;/li&gt;
	&lt;li&gt;Is the table temporary or regular?&lt;/li&gt;
	&lt;li&gt;Does the DROP statement contain the IF EXISTS clause?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This totals to 2^5 = 32 test cases (+2 for testing also what happens when database does not exist) that we would like to have. It would be great if we can create these test cases as part of this PR and fill-in the respective spreadsheet. Some of them may exist already so feel free to skip them if that&apos;s the case.&lt;/p&gt;</comment>
                            <comment id="17745509" author="rtrivedi12" created="Fri, 21 Jul 2023 09:36:51 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zabetak&quot; class=&quot;user-hover&quot; rel=&quot;zabetak&quot;&gt;zabetak&lt;/a&gt; for reviewing and consolidating test scenarios. I have updated the test results to the &lt;a href=&quot;https://docs.google.com/spreadsheets/d/1CJ1U0LOCpK7TfxY5RSSM4Wmbmt7GiKt5VQrWt1x2tfs/edit?pli=1#gid=0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;sheet&lt;/a&gt; and uploaded tests to the PR.&lt;/p&gt;</comment>
                            <comment id="17745576" author="zabetak" created="Fri, 21 Jul 2023 12:42:14 +0000"  >&lt;p&gt;Thanks for your hard work Riju! &lt;/p&gt;

&lt;p&gt;I went over the results in the spreadsheet and I have a few questions.&lt;/p&gt;

&lt;p&gt;Q1. Is it normal that when the table or database is missing the behavior of DROP TABLE is the same (NOOP) with and without the IF EXISTS clause? &lt;br/&gt;
The &lt;a href=&quot;https://cwiki.apache.org/confluence/display/hive/languagemanual+ddl#LanguageManualDDL-DropTable&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Hive wiki&lt;/a&gt; mentions the following:&lt;/p&gt;

&lt;p&gt;&quot;In Hive 0.7.0 or later, DROP returns an error if the table doesn&apos;t exist, unless IF EXISTS is specified or the configuration variable hive.exec.drop.ignorenonexistent is set to true.&quot;&lt;/p&gt;

&lt;p&gt;Q2. I noticed that for non-temporary tables there is a &quot;GRANT DROP ON TABLE&quot; statement in the sample test case? Why is this needed? Left also a related comment in the PR.&lt;/p&gt;

&lt;p&gt;Q3. I observed that DROP TABLE &lt;b&gt;IF EXISTS&lt;/b&gt; will throw an authentication error even when the operations is NOOP (i.e., the database/table does not exist). I am wondering what happens with respect to authorization if we do CREATE TABLE &lt;b&gt;IF NOT EXISTS&lt;/b&gt; and the table is already there. Do we perform the authorization anyways or we simply return as NOOP? Maybe it&apos;s worth keeping the behavior of the two operations consistent. Anyways, I am not an authorization expert so will defer the decision about the expected output to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmani&quot; class=&quot;user-hover&quot; rel=&quot;rmani&quot;&gt;rmani&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hemanth619&quot; class=&quot;user-hover&quot; rel=&quot;hemanth619&quot;&gt;hemanth619&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="17746119" author="rtrivedi12" created="Sun, 23 Jul 2023 18:37:28 +0000"  >&lt;p&gt;Thank you Stamatis for reviewing.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;These tests have default `hive.exec.drop.ignorenonexistent` to True hence the behavior of DROP TABLE is the NOOP. I have added one more test with `hive.exec.drop.ignorenonexistent` to False where DROP TABLE WITHOUT IF EXISTS returns an error.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&#160;Agreed, Updated tests to remove grant on tables.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&#160;CREATE TABLE&#160;&lt;b&gt;IF NOT EXISTS&lt;/b&gt; also throws an authentication error in case table is already there. So, it is consistent with the DROP table IF EXISTS for non-existing tables.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17749766" author="ngangam" created="Tue, 1 Aug 2023 13:48:51 +0000"  >&lt;p&gt;Fix has been merged to master for beta1 release. Thank you for the patch.&lt;/p&gt;</comment>
                            <comment id="17749786" author="zabetak" created="Tue, 1 Aug 2023 14:05:38 +0000"  >&lt;p&gt;Thanks for merging this &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ngangam&quot; class=&quot;user-hover&quot; rel=&quot;ngangam&quot;&gt;ngangam&lt;/a&gt;. In the future, please remember to give credits to contributors and reviewers in the commit message since we are mostly gathering stats from there for inviting new committer/PMC members.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13169515">HIVE-20051</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 15 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1gyo8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>