<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:20:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-24920] TRANSLATED_TO_EXTERNAL tables may write to the same location</title>
                <link>https://issues.apache.org/jira/browse/HIVE-24920</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
create table t (a integer);
insert into t values(1);
alter table t rename to t2;
create table t (a integer); -- I expected an exception from &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; command (location already exists) but because its an external table no exception
insert into t values(2);
select * from t;  -- shows 1 and 2
drop table t2;    -- wipes out data location
select * from t;  -- empty resultset
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13366740">HIVE-24920</key>
            <summary>TRANSLATED_TO_EXTERNAL tables may write to the same location</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kgyrtkirk">Zoltan Haindrich</assignee>
                                    <reporter username="kgyrtkirk">Zoltan Haindrich</reporter>
                        <labels>
                            <label>metastore_translator</label>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 22 Mar 2021 14:17:45 +0000</created>
                <updated>Thu, 17 Nov 2022 08:48:58 +0000</updated>
                            <resolved>Tue, 1 Jun 2021 13:50:58 +0000</resolved>
                                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4800">1h 20m</timespent>
                                <comments>
                            <comment id="17342267" author="ngangam" created="Tue, 11 May 2021 03:14:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kgyrtkirk&quot; class=&quot;user-hover&quot; rel=&quot;kgyrtkirk&quot;&gt;kgyrtkirk&lt;/a&gt; an alternate approach which I think might be cleaner is to have AlterTableHandler treat such tables with (&#8220;TRANSLATED_TO_EXTERNAL&#8221; or (type=&#8220;EXTERNAL&#8221; + &#8220;external.table.purge=true&#8221;)) same as Managed/ACID tables? i.e. we relocate these tables on a rename just like we do for managed tables today.&lt;br/&gt;
create table test; --&amp;gt; table located in &quot;test&quot; directory&lt;br/&gt;
alter table test rename to test_renamed; --&amp;gt; because this table has property &quot;TRANSLATED_TO_EXTERNAL&quot; and/or &quot;external.table.purge=true&quot;, we relocate this table data from dir &quot;test&quot; to dir &quot;test_renamed&quot;&lt;br/&gt;
create table test; --&amp;gt; creates a new table with dir &quot;test&quot;  &lt;/p&gt;</comment>
                            <comment id="17342449" author="kgyrtkirk" created="Tue, 11 May 2021 09:27:55 +0000"  >&lt;p&gt;this could also be implemented as an option; but i think this will not solve the problem fully: what should happen if you already have a directory with that name?&lt;br/&gt;
because there is no guarantee that test_renamed doesn&apos;t exists....&lt;/p&gt;</comment>
                            <comment id="17346279" author="thejas" created="Mon, 17 May 2021 17:16:13 +0000"  >&lt;p&gt;For resiliency around issues caused by existing dirs with same name, users should specify custom locations for the external tables (or otherwise ensure that that default dir doesn&#8217;t exist). Other option is to use ACID-Managed tables (where you don&#8217;t have cases of random dirs)&lt;/p&gt;

&lt;p&gt;External tables by definition don&#8217;t have data under management of hive. HDFS backed one is just one example, other examples include hbase, kudu tables etc.&#160;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17347702" author="kgyrtkirk" created="Wed, 19 May 2021 14:08:26 +0000"  >&lt;p&gt;if we are about to do that then an existing external table dir might cause some trouble:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
create external table t (i integer);
-- &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; will create dir WH/t
insert into t values (1);
drop table t;
-- &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; will leave WH/t as is beacuse its a full external table without the purge option
create table t(i integer);
-- &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; will create a table at the same external location; which is now occupied...your current proposal doesn&apos;t handle &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt;
select * from t
1
-- shows the inserted record from the previous table instance...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I don&apos;t think we should just accept the above behaviour the user have used a statement which should have created a normal managed table (create table t) - so it should be empty in any circumstances....if we ant to do the same kind of renames for translated table we should still retain the &quot;existing location dir&quot; avoidance mechanisms of the existing patch - and set the one which throws an exception if it exists the default.&lt;/p&gt;

&lt;p&gt;This could probably enable our users to choose the behaviour they would like to see.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thejas&quot; class=&quot;user-hover&quot; rel=&quot;thejas&quot;&gt;thejas&lt;/a&gt;: what do you think?&lt;/p&gt;</comment>
                            <comment id="17347763" author="kgyrtkirk" created="Wed, 19 May 2021 16:15:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ngangam&quot; class=&quot;user-hover&quot; rel=&quot;ngangam&quot;&gt;ngangam&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thejas&quot; class=&quot;user-hover&quot; rel=&quot;thejas&quot;&gt;thejas&lt;/a&gt;: I&apos;ve updated the PR - and implemented that TRANSLATED_TO_EXTERNAL tables may follow renames&lt;/p&gt;</comment>
                            <comment id="17348993" author="thejas" created="Fri, 21 May 2021 06:05:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;create table t(i integer);&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I agree that this should behave like the old managed table behavior (irrespective of config). If old managed tables would have thrown error if the dir exists, it should do so now as well.&lt;/p&gt;</comment>
                            <comment id="17355120" author="kgyrtkirk" created="Tue, 1 Jun 2021 13:50:59 +0000"  >&lt;p&gt;merged into master. Thank you Naveen for reviewing the changes!&lt;/p&gt;</comment>
                            <comment id="17524983" author="sanguines" created="Wed, 20 Apr 2022 13:13:35 +0000"  >&lt;p&gt;After the patch is updated, the partition table location and hdfs data directory are displayed normally, but the partition location of the table in the SDS in the Hive metabase is still displayed as the location of the old table, resulting in no data in the query partition.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;in beeline:&lt;/p&gt;

&lt;p&gt;------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;set hive.create.as.external.legacy=true;&lt;/p&gt;

&lt;p&gt;CREATE TABLE part_test(&lt;br/&gt;
c1 string&lt;br/&gt;
,c2 string&lt;br/&gt;
)PARTITIONED BY (dat string)&lt;/p&gt;

&lt;p&gt;insert into part_test values (&quot;11&quot;,&quot;th&quot;,&quot;20220101&quot;)&lt;br/&gt;
insert into part_test values (&quot;22&quot;,&quot;th&quot;,&quot;20220102&quot;)&lt;/p&gt;

&lt;p&gt;alter table part_test rename to part_test11;&lt;/p&gt;

&lt;p&gt;--this result is null.&lt;br/&gt;
select * from part_test11 where dat=&quot;20220101&quot;;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;part_test.c1&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;part_test.c2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;part_test.dat&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;---------------------------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;SDS in the Hive metabase:&lt;br/&gt;
select SDS.LOCATION from TBLS,SDS where TBLS.TBL_NAME=&quot;part_test11&quot; AND TBLS.TBL_ID=SDS.CD_ID;&lt;/p&gt;

&lt;p&gt;---------------------------------------------------------------------------------------------------&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;b&gt;LOCATION&lt;/b&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;hdfs://nameservice1/warehouse/tablespace/external/hive/part_test11&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;hdfs://nameservice1/warehouse/tablespace/external/hive/part_test/dat=20220101&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;hdfs://nameservice1/warehouse/tablespace/external/hive/part_test/dat=20220102&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;---------------------------------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We need to modify the partition location of the table in SDS to ensure that the query results are normal:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-26158&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-26158&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12647834">HIVE-4567</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 30 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0p1ps:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>