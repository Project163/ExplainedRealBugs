<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:51:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-318] [Hive] union all queries broken - all kinds of problems</title>
                <link>https://issues.apache.org/jira/browse/HIVE-318</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;1. Map-only job : same input&lt;br/&gt;
   Hangs because mapper tries to same open twice, and hadoop filesystem complains.&lt;/p&gt;

&lt;p&gt;   Fix: Only initialize once - keep state at the Operator level for the same. Should do same for Close.&lt;/p&gt;

&lt;p&gt;2. Map-only job : different inputs&lt;br/&gt;
   Loss of data due to rename.&lt;/p&gt;

&lt;p&gt;   Fix: change rename to move files to the directory.&lt;/p&gt;

&lt;p&gt;3. Map-only job in subquery + RedSink: works currently&lt;/p&gt;

&lt;p&gt;4. 2 variables: so 4 sub-cases&lt;/p&gt;

&lt;p&gt;   Number of sub-queries having map-reduce jobs. (1/2)&lt;br/&gt;
   Operator after Union (RS/FS)&lt;/p&gt;



&lt;p&gt;a.   Number of sub-queries having map-reduce jobs. 1&lt;br/&gt;
     Operator after Union: RS&lt;/p&gt;


&lt;p&gt;     Can be done in 2MR - really difficult with current infrastructure.&lt;br/&gt;
     Should do with 3 MR jobs now - break on top of UNION. &lt;br/&gt;
     Future optimization: move operators between Union and RS before Union.&lt;/p&gt;


&lt;p&gt;b.   Number of sub-queries having map-reduce jobs. 2&lt;br/&gt;
     Operator after Union: RS&lt;/p&gt;


&lt;p&gt;     Needs 3MR - Should do with 3 MR jobs - break on top of UNION. &lt;br/&gt;
     Future optimization: move operators between Union and RS before Union.&lt;/p&gt;


&lt;p&gt;c.   Number of sub-queries having map-reduce jobs. 1&lt;br/&gt;
     Operator after Union: FS&lt;/p&gt;


&lt;p&gt;     Can be done in 1MR - really difficult with current infrastructure.&lt;br/&gt;
     Can be easily done with 2 MR by removing UNION and cloning operators between Union and FS.&lt;br/&gt;
     Should do with 3 MR jobs now - break on top of UNION. &lt;br/&gt;
     Followup optimization: 2MR should be able to handle&lt;/p&gt;


&lt;p&gt;d.   Number of sub-queries having map-reduce jobs. 2&lt;br/&gt;
     Operator after Union: FS&lt;/p&gt;


&lt;p&gt;     Can be easily done with 2 MR by removing UNION and cloning operators between Union and FS.&lt;br/&gt;
     Should do with 3 MR jobs now - break on top of UNION. &lt;br/&gt;
     Followup optimization: 2MR should be able to handle&lt;/p&gt;</description>
                <environment></environment>
        <key id="12416025">HIVE-318</key>
            <summary>[Hive] union all queries broken - all kinds of problems</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="namit">Namit Jain</assignee>
                                    <reporter username="namit">Namit Jain</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Mar 2009 18:44:17 +0000</created>
                <updated>Sat, 17 Dec 2011 00:08:42 +0000</updated>
                            <resolved>Thu, 26 Mar 2009 06:34:09 +0000</resolved>
                                                    <fixVersion>0.3.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12678466" author="hammer" created="Tue, 3 Mar 2009 21:52:33 +0000"  >&lt;p&gt;Hey Namit,&lt;/p&gt;

&lt;p&gt;Quick comment: would it be easier to track these issues if they were filed as separate tickets? Perhaps you are preparing a solution as a single patch, or they are all manifestations of the same root issue, but otherwise, this seems like a ticket that could be busted up.&lt;/p&gt;

&lt;p&gt;Later,&lt;br/&gt;
Jeff&lt;/p&gt;</comment>
                            <comment id="12680570" author="prasadc" created="Tue, 10 Mar 2009 18:25:23 +0000"  >&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/exec/Operator.java:325&lt;br/&gt;
 why are you catching an exception that is never thrown?&lt;/p&gt;

&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/exec/FileSinkOperator.java:67&lt;br/&gt;
 shouldn&apos;t you throw an error if the file exists instead of asserting?&lt;br/&gt;
 convert some of the the info log messages to error&lt;/p&gt;

&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java:134, 153&lt;br/&gt;
 remove the System.out&lt;/p&gt;

&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/lib/DefaultRuleDispatcher.java:80&lt;br/&gt;
 can you make stack to be 3rd parameter to the process function since most process function don&apos;t use this param&lt;/p&gt;

&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/plan/fileSinkDesc.java:35 &amp;amp;47&lt;br/&gt;
 javadoc?&lt;/p&gt;

&lt;p&gt;ql/src/java/org/apache/hadoop/hive/ql/plan/unionDesc.java&lt;br/&gt;
 empty class? add a comment&lt;/p&gt;

&lt;p&gt;unit tests:&lt;br/&gt;
can you add comments so that which unit test so that it is easy to figure out what case of union it is testing&lt;/p&gt;

&lt;p&gt;will add more comments later..&lt;/p&gt;


</comment>
                            <comment id="12680584" author="namit" created="Tue, 10 Mar 2009 18:51:43 +0000"  >&lt;p&gt;Hi Jeff, all the issues are pretty similar, and their fixes would touch the same code. That&apos;s why it would be much easier to merge them in a single fix together. Infact, the fix for all sub-cases&lt;br/&gt;
for 4 is the same - I just listed all the issues for clarity. The basic idea was that union is broken currently, and I was just wanted to list all the scenarios that are not working.&lt;/p&gt;
</comment>
                            <comment id="12680646" author="namit" created="Tue, 10 Mar 2009 22:11:28 +0000"  >&lt;p&gt;incorporate prasad&apos;s comments&lt;/p&gt;</comment>
                            <comment id="12680651" author="prasadc" created="Tue, 10 Mar 2009 22:22:10 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;make the union transform before the column pruner. i will make predicate pushdown to happen after union transform so that it can get the benefit of pushing filters up.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ql/src/java/org/apache/hadoop/hive/ql/optimizer/unionproc/UnionProcFactory.java:42&lt;br/&gt;
use indexOf() instead of for loop to make it simple&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ql/src/java/org/apache/hadoop/hive/ql/lib/PreOrderWalker.java&lt;br/&gt;
should subclass the Default walker and override only the walk() method. all the other code is common to both walkers&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12680938" author="namit" created="Wed, 11 Mar 2009 17:33:59 +0000"  >&lt;p&gt;Will do 2 and 3 in the list above (use indexof and change PreOrderWalker).&lt;/p&gt;

&lt;p&gt;However, 1 cannot be done since ColumnPruner creates the tree again - so state of the union will be lost.&lt;br/&gt;
It doesnt matter - predicate pushdown can happen anywhere (either before of after the union). Union does not change the tree,&lt;br/&gt;
it just stores some state about which branch is map-side and which branch is root&lt;/p&gt;</comment>
                            <comment id="12680946" author="namit" created="Wed, 11 Mar 2009 17:49:44 +0000"  >&lt;p&gt;incorporated Prasad&apos;s comments&lt;/p&gt;</comment>
                            <comment id="12681883" author="athusoo" created="Fri, 13 Mar 2009 20:12:52 +0000"  >&lt;p&gt;There seems to be a conflict in union.q.xml. Can you regenerate the patch.&lt;/p&gt;</comment>
                            <comment id="12681949" author="namit" created="Sat, 14 Mar 2009 00:10:15 +0000"  >&lt;p&gt;resolve conflicts&lt;/p&gt;</comment>
                            <comment id="12682418" author="athusoo" created="Mon, 16 Mar 2009 19:23:58 +0000"  >&lt;p&gt;Looked at this in a lot more detail with Namit. The following are the review comments:&lt;/p&gt;

&lt;p&gt;1. The state maintained in the union operator context can be moved to the ParseContext to be consistent with the model that we have today.&lt;br/&gt;
2. The init and state code can be moved to Operator.java and the reset logic can be refactored to work on those states. There is no need for another reinit state. Init after close should be transparently allowed.&lt;br/&gt;
3. We can change the plan to generate two different file sink operators on the parents of the union operator while breaking the into map/reduce jobs. If we follow that strategy, we can undo the changes to FileSinkOperator&lt;br/&gt;
and remove the special case code.&lt;br/&gt;
4. Please check indentation in UnionProcessor.java &lt;/p&gt;</comment>
                            <comment id="12688877" author="namit" created="Tue, 24 Mar 2009 21:23:39 +0000"  >&lt;p&gt;incorporated comments&lt;/p&gt;</comment>
                            <comment id="12689257" author="namit" created="Wed, 25 Mar 2009 22:15:02 +0000"  >&lt;p&gt;resolve conflicts&lt;/p&gt;</comment>
                            <comment id="12689291" author="namit" created="Thu, 26 Mar 2009 00:09:53 +0000"  >&lt;p&gt;Added comments in various places and uploaded the new patch.&lt;br/&gt;
Also, filed various follow-up jiras&lt;/p&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-368&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-368&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-369&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-369&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-370&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-370&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-371&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-371&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12689301" author="zshao" created="Thu, 26 Mar 2009 00:29:08 +0000"  >&lt;p&gt;+1. Testing now.&lt;/p&gt;</comment>
                            <comment id="12689374" author="zshao" created="Thu, 26 Mar 2009 06:34:09 +0000"  >&lt;p&gt;Committed revision 758494.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12411672">HIVE-205</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12401872" name="hive.318.2.patch" size="169960" author="namit" created="Tue, 10 Mar 2009 22:11:28 +0000"/>
                            <attachment id="12401947" name="hive.318.3.patch" size="169214" author="namit" created="Wed, 11 Mar 2009 17:49:21 +0000"/>
                            <attachment id="12402181" name="hive.318.4.patch" size="166345" author="namit" created="Sat, 14 Mar 2009 00:10:02 +0000"/>
                            <attachment id="12403558" name="hive.318.5.patch" size="171106" author="namit" created="Tue, 24 Mar 2009 21:23:24 +0000"/>
                            <attachment id="12403645" name="hive.318.6.patch" size="3460" author="namit" created="Wed, 25 Mar 2009 22:14:36 +0000"/>
                            <attachment id="12403652" name="hive.318.7.patch" size="172227" author="namit" created="Thu, 26 Mar 2009 00:02:29 +0000"/>
                            <attachment id="12401780" name="hive.318.patch" size="168682" author="namit" created="Mon, 9 Mar 2009 22:19:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73620</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 35 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0l953:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>122131</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-318&quot; title=&quot;[Hive] union all queries broken - all kinds of problems&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-318&quot;&gt;&lt;strike&gt;HIVE-318&lt;/strike&gt;&lt;/a&gt;. Fix union all queries. (Namit Jain via zshao)</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>