<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:43:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-12552] Wrong number of reducer estimation causing job to fail</title>
                <link>https://issues.apache.org/jira/browse/HIVE-12552</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;], TaskAttempt 3 failed, info=[Error: Failure while running task: attempt_1448429572030_1812_1_03_000029_3:java.lang.RuntimeException: java.lang.RuntimeException: Hive Runtime Error while closing operators: java.io.IOException: Illegal partition for 01 6c 6f 61 6e 20 61 63 63 6f 75 6e 74 00 01 80 1f e1 d7 ff (-1)
	at org.apache.hadoop.hive.ql.exec.tez.TezProcessor.initializeAndRunProcessor(TezProcessor.java:195)
	at org.apache.hadoop.hive.ql.exec.tez.TezProcessor.run(TezProcessor.java:160)
	at org.apache.tez.runtime.LogicalIOProcessorRuntimeTask.run(LogicalIOProcessorRuntimeTask.java:348)
	at org.apache.tez.runtime.task.TaskRunner2Callable$1.run(TaskRunner2Callable.java:71)
	at org.apache.tez.runtime.task.TaskRunner2Callable$1.run(TaskRunner2Callable.java:60)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:422)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1657)
	at org.apache.tez.runtime.task.TaskRunner2Callable.callInternal(TaskRunner2Callable.java:60)
	at org.apache.tez.runtime.task.TaskRunner2Callable.callInternal(TaskRunner2Callable.java:35)
	at org.apache.tez.common.CallableWithNdc.call(CallableWithNdc.java:36)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.Thread.run(Thread.java:745)
Caused by: java.lang.RuntimeException: Hive Runtime Error while closing operators: java.io.IOException: Illegal partition for 01 6c 6f 61 6e 20 61 63 63 6f 75 6e 74 00 01 80 1f e1 d7 ff (-1)
	at org.apache.hadoop.hive.ql.exec.tez.ReduceRecordProcessor.close(ReduceRecordProcessor.java:341)
	at org.apache.hadoop.hive.ql.exec.tez.TezProcessor.initializeAndRunProcessor(TezProcessor.java:186)
	... 14 more
Caused by: org.apache.hadoop.hive.ql.metadata.HiveException: java.io.IOException: Illegal partition for 01 6c 6f 61 6e 20 61 63 63 6f 75 6e 74 00 01 80 1f e1 d7 ff (-1)
	at org.apache.hadoop.hive.ql.exec.ReduceSinkOperator.process(ReduceSinkOperator.java:402)
	at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:852)
	at org.apache.hadoop.hive.ql.exec.vector.VectorGroupByOperator.writeSingleRow(VectorGroupByOperator.java:904)
	at org.apache.hadoop.hive.ql.exec.vector.VectorGroupByOperator.access$400(VectorGroupByOperator.java:59)
	at org.apache.hadoop.hive.ql.exec.vector.VectorGroupByOperator$ProcessingModeHashAggregate.flush(VectorGroupByOperator.java:469)
	at org.apache.hadoop.hive.ql.exec.vector.VectorGroupByOperator$ProcessingModeHashAggregate.close(VectorGroupByOperator.java:375)
	at org.apache.hadoop.hive.ql.exec.vector.VectorGroupByOperator.closeOp(VectorGroupByOperator.java:950)
	at org.apache.hadoop.hive.ql.exec.Operator.close(Operator.java:656)
	at org.apache.hadoop.hive.ql.exec.Operator.close(Operator.java:670)
	at org.apache.hadoop.hive.ql.exec.Operator.close(Operator.java:670)
	at org.apache.hadoop.hive.ql.exec.tez.ReduceRecordProcessor.close(ReduceRecordProcessor.java:318)
	... 15 more
Caused by: java.io.IOException: Illegal partition for 01 6c 6f 61 6e 20 61 63 63 6f 75 6e 74 00 01 80 1f e1 d7 ff (-1)
	at org.apache.tez.runtime.library.common.sort.impl.PipelinedSorter.collect(PipelinedSorter.java:379)
	at org.apache.tez.runtime.library.common.sort.impl.PipelinedSorter.write(PipelinedSorter.java:357)
	at org.apache.tez.runtime.library.output.OrderedPartitionedKVOutput$1.write(OrderedPartitionedKVOutput.java:163)
	at org.apache.hadoop.hive.ql.exec.tez.TezProcessor$TezKVOutputCollector.collect(TezProcessor.java:232)
	at org.apache.hadoop.hive.ql.exec.ReduceSinkOperator.collect(ReduceSinkOperator.java:538)
	at org.apache.hadoop.hive.ql.exec.ReduceSinkOperator.process(ReduceSinkOperator.java:385)
	... 25 more
]], Vertex did not succeed due to OWN_TASK_FAILURE, failedTasks:1 killedTasks:277, Vertex vertex_1448429572030_1812_1_03 [Reducer 2] killed/failed due to:OWN_TASK_FAILURE]DAG did not succeed due to VERTEX_FAILURE. failedVertices:1 killedVertices:0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Env: master branch.&lt;/p&gt;

&lt;p&gt;Map 1 &amp;lt;- Map 4 (BROADCAST_EDGE)&lt;br/&gt;
Reducer 2 &amp;lt;- Map 1 (CUSTOM_SIMPLE_EDGE), Map 5 (CUSTOM_SIMPLE_EDGE)&lt;br/&gt;
Reducer 3 &amp;lt;- Reducer 2 (SIMPLE_EDGE)&lt;/p&gt;

&lt;p&gt;set hive.tez.max.partition.factor=0.5f;&lt;/p&gt;

&lt;p&gt;This causes &quot;Reducer 3&quot; to have 0 tasks, causing the job to fail after reducer 2. &lt;/p&gt;

&lt;p&gt;Will attach the plan and screenshot shortly &lt;/p&gt;</description>
                <environment></environment>
        <key id="12917226">HIVE-12552</key>
            <summary>Wrong number of reducer estimation causing job to fail</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajesh.balamohan">Rajesh Balamohan</assignee>
                                    <reporter username="rajesh.balamohan">Rajesh Balamohan</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Dec 2015 11:46:18 +0000</created>
                <updated>Tue, 21 Jun 2016 15:52:51 +0000</updated>
                            <resolved>Fri, 25 Mar 2016 02:27:05 +0000</resolved>
                                                    <fixVersion>2.0.1</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>Physical Optimizer</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15033551" author="rajesh.balamohan" created="Tue, 1 Dec 2015 11:46:48 +0000"  >&lt;p&gt;attaching plan&lt;/p&gt;</comment>
                            <comment id="15033553" author="rajesh.balamohan" created="Tue, 1 Dec 2015 11:48:37 +0000"  >&lt;p&gt;Notice with default setting Reducer 3 getting 2 tasks and with (0.5f), it gets 0 tasks.&lt;/p&gt;</comment>
                            <comment id="15033600" author="rajesh.balamohan" created="Tue, 1 Dec 2015 12:26:05 +0000"  >&lt;p&gt;Attaching the patch for review. Test for the same job; works fine.&lt;/p&gt;</comment>
                            <comment id="15034348" author="hagleitn" created="Tue, 1 Dec 2015 18:51:14 +0000"  >&lt;p&gt;That was done for min but not for max. The implicit assumption was that max &amp;gt; min and max &amp;gt; 1, min &amp;lt; 1. Can you elaborate how a max of 0.5 is actually helping (instead of for instance changing bytes per reducer)?&lt;/p&gt;

&lt;p&gt;Otherwise patch looks good. Would be nice though if you use the same style for both min and max (i.e.: nested Math.max for both or two statements for both).&lt;/p&gt;</comment>
                            <comment id="15034383" author="sershe" created="Tue, 1 Dec 2015 19:11:27 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15034842" author="rajesh.balamohan" created="Tue, 1 Dec 2015 23:25:52 +0000"  >&lt;p&gt;Addressed review comments from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hagleitn&quot; class=&quot;user-hover&quot; rel=&quot;hagleitn&quot;&gt;hagleitn&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;With 2.0f, it was generating 1009 tasks and most of them were not getting enough data; which could have been handled with less tasks. Got around 11-13% improvement with less number of tasks in llap mode (attached images show container mode for debugging purpose).  Haven&apos;t changed bytes per reducer in my run, which could bring down the number of reduce tasks.&lt;/p&gt;
</comment>
                            <comment id="15049283" author="hagleitn" created="Wed, 9 Dec 2015 19:48:32 +0000"  >&lt;p&gt;reupload to trigger tests.&lt;/p&gt;</comment>
                            <comment id="15050969" author="hiveqa" created="Thu, 10 Dec 2015 13:42:02 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12776621/HIVE-12552.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12776621/HIVE-12552.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 11 failed/errored test(s), 9887 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestHWISessionManager - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_cbo_udf_max
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_order2
org.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver_encryption_insert_partition_dynamic
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_dynamic_partition_pruning
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_vectorized_dynamic_partition_pruning
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_mergejoin
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hadoop.hive.metastore.TestHiveMetaStorePartitionSpecs.testGetPartitionSpecs_WithAndWithoutPartitionGrouping
org.apache.hive.jdbc.TestMultiSessionsHS2WithLocalClusterSpark.testSparkQuery
org.apache.hive.jdbc.TestSSL.testSSLVersion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6302/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6302/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6302/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6302/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6302/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6302/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 11 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12776621 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="15208321" author="ashutoshc" created="Wed, 23 Mar 2016 12:19:11 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15211874" author="ashutoshc" created="Fri, 25 Mar 2016 14:23:37 +0000"  >&lt;p&gt;Pushed to master&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12775003" name="6_plan.txt" size="7531" author="rajesh.balamohan" created="Tue, 1 Dec 2015 11:46:48 +0000"/>
                            <attachment id="12775017" name="HIVE-12552.1.patch" size="719" author="rajesh.balamohan" created="Tue, 1 Dec 2015 12:26:05 +0000"/>
                            <attachment id="12776621" name="HIVE-12552.2.patch" size="777" author="hagleitn" created="Wed, 9 Dec 2015 19:48:32 +0000"/>
                            <attachment id="12775150" name="HIVE-12552.2.patch" size="777" author="rajesh.balamohan" created="Tue, 1 Dec 2015 23:25:52 +0000"/>
                            <attachment id="12775006" name="With_max_partition_0.5_setting.png" size="50472" author="rajesh.balamohan" created="Tue, 1 Dec 2015 11:48:01 +0000"/>
                            <attachment id="12775005" name="with_default_setting.png" size="51591" author="rajesh.balamohan" created="Tue, 1 Dec 2015 11:48:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 34 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2p41j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>