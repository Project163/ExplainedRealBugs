<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:54:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-16609] col=&apos;__HIVE_DEFAULT_PARTITION__&apos; condition in select statement may produce wrong result</title>
                <link>https://issues.apache.org/jira/browse/HIVE-16609</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;A variation of alter_partition_change_col.q produces wrong result:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SET hive.exec.dynamic.partition.mode = nonstrict;
create table alter_partition_change_col0 (c1 string, c2 string);
load data local inpath &lt;span class=&quot;code-quote&quot;&gt;&apos;dec.txt&apos;&lt;/span&gt; overwrite into table alter_partition_change_col0;
create table alter_partition_change_col1 (c1 string, c2 string) partitioned by (p1 string comment &lt;span class=&quot;code-quote&quot;&gt;&apos;Column p1&apos;&lt;/span&gt;, p2 string comment &lt;span class=&quot;code-quote&quot;&gt;&apos;Column p2&apos;&lt;/span&gt;);

insert overwrite table alter_partition_change_col1 partition (p1, p2)
  select c1, c2, &lt;span class=&quot;code-quote&quot;&gt;&apos;abc&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;123&apos;&lt;/span&gt; from alter_partition_change_col0
  union all
  select c1, c2, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; as string), &lt;span class=&quot;code-quote&quot;&gt;&apos;123&apos;&lt;/span&gt; from alter_partition_change_col0;
select * from alter_partition_change_col1 where p1=&lt;span class=&quot;code-quote&quot;&gt;&apos;__HIVE_DEFAULT_PARTITION__&apos;&lt;/span&gt; or lower(p1)=&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The &quot;select&quot; statement does not produce the rows containing &quot;_&lt;em&gt;HIVE_DEFAULT_PARTITION&lt;/em&gt;_&quot;.&lt;/p&gt;

&lt;p&gt;We need another condition containing a udf so the condition is not recognized by PartFilterExprUtil.makeExpressionTree in ObjectStore. Looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11208&quot; title=&quot;Can not drop a default partition __HIVE_DEFAULT_PARTITION__ which is not a &amp;quot;string&amp;quot; type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11208&quot;&gt;&lt;del&gt;HIVE-11208&lt;/del&gt;&lt;/a&gt; breaks it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13070192">HIVE-16609</key>
            <summary>col=&apos;__HIVE_DEFAULT_PARTITION__&apos; condition in select statement may produce wrong result</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="daijy">Daniel Dai</reporter>
                        <labels>
                    </labels>
                <created>Mon, 8 May 2017 22:07:45 +0000</created>
                <updated>Tue, 22 May 2018 23:58:30 +0000</updated>
                            <resolved>Wed, 10 May 2017 23:55:12 +0000</resolved>
                                                    <fixVersion>3.0.0</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16002603" author="hiveqa" created="Tue, 9 May 2017 12:27:21 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12867059/HIVE-16609.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12867059/HIVE-16609.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 8 failed/errored test(s), 10657 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestBeeLineDriver.testCliDriver[select_dummy_source] (batchId=235)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[cte_mat_4] (batchId=6)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[pcr] (batchId=56)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[pointlookup4] (batchId=70)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[row__id] (batchId=73)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_if_expr] (batchId=143)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[pcr] (batchId=123)
org.apache.hadoop.hive.ql.txn.compactor.TestWorker2.minorNoBaseLotsOfDeltas (batchId=254)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/5134/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/5134/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/5134/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/5134/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-5134/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-5134/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 8 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12867059 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="16003190" author="daijy" created="Tue, 9 May 2017 18:05:00 +0000"  >&lt;p&gt;Fix UT failures.&lt;/p&gt;</comment>
                            <comment id="16003319" author="hiveqa" created="Tue, 9 May 2017 19:04:51 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12867146/HIVE-16609.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12867146/HIVE-16609.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 10666 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/5139/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/5139/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/5139/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/5139/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-5139/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-5139/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12867146 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="16003404" author="daijy" created="Tue, 9 May 2017 19:48:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aihuaxu&quot; class=&quot;user-hover&quot; rel=&quot;aihuaxu&quot;&gt;aihuaxu&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt;, mind taking a look?&lt;/p&gt;</comment>
                            <comment id="16003439" author="sershe" created="Tue, 9 May 2017 20:09:55 +0000"  >&lt;p&gt;-0.5 for now.&lt;br/&gt;
I don&apos;t think this is a valid query... as in, it should search for the literal string, as it does. The correct way to select &quot;invalid&quot; values is &quot;is null&quot; and that has been fixed recently if I remember correctly.&lt;br/&gt;
Users should not use the magic constant.&lt;/p&gt;</comment>
                            <comment id="16003489" author="daijy" created="Tue, 9 May 2017 20:31:50 +0000"  >&lt;p&gt;If so, we need to fix .q files containing the magic constant in the where statement (eg, alter_partition_change_col.q). How about drop partition statement? Shall we still use magic constant?&lt;/p&gt;</comment>
                            <comment id="16003510" author="daijy" created="Tue, 9 May 2017 20:40:01 +0000"  >&lt;p&gt;Also need to point out&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;select * from alter_partition_change_col1 where p1=&lt;span class=&quot;code-quote&quot;&gt;&apos;__HIVE_DEFAULT_PARTITION__&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;works fine, but&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;select * from alter_partition_change_col1 where p1=&lt;span class=&quot;code-quote&quot;&gt;&apos;__HIVE_DEFAULT_PARTITION__&apos;&lt;/span&gt; or lower(p1)=&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;is wrong. We need a fix to make them consistent.&lt;/p&gt;</comment>
                            <comment id="16005421" author="thejas" created="Wed, 10 May 2017 21:07:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt;&lt;br/&gt;
It looks like we have support for this query type in some scenarios, but it produces wrong result in some others.&lt;br/&gt;
We show this in partition names, and because of the support for this query, users are can be using it.&lt;/p&gt;

&lt;p&gt;We need to have consistent behavior here, not what could be seen as incorrect result. The current state is not right.&lt;br/&gt;
We should either fix this for broken case or make changes to stop supporting this type of predicate completely (which would be backward incompatible). Thoughts ?&lt;/p&gt;</comment>
                            <comment id="16005463" author="sershe" created="Wed, 10 May 2017 21:19:22 +0000"  >&lt;p&gt;Hmm... I remember fixing something like that for drop. Frankly I think this is an ugly pattern that should not exist. Perhaps we should fix it in old branches, and then on master/2.4 change partition display to null when we see the magic value, so that the users would never see it; and emit warning if the partition filter has magic value (and perhaps add type casts checks to make it legitimately fail on any non-string partition column).&lt;br/&gt;
Although I have no strong preferences. If everything is made consistent to work with this value that would make sense too. &lt;/p&gt;</comment>
                            <comment id="16005515" author="daijy" created="Wed, 10 May 2017 21:49:04 +0000"  >&lt;p&gt;Drop statement is still using the magic constant in syntax. DDLSemanticAnalyzer switches the magic constant into &quot;is null&quot;. For select statement, the switch never happen, so underlining code (in metastore) need to deal with mixed inputs (is null and equal to magic constant). That&apos;s what the patch try to fix.&lt;/p&gt;

&lt;p&gt;In general, I totally agree we shall drop the magic constant in syntax. However, this is a long term goal vs short term fix issue. If the query produces wrong result, we shall fix immediately rather than wait for the long term goal settled IMHO.&lt;/p&gt;</comment>
                            <comment id="16005574" author="thejas" created="Wed, 10 May 2017 22:33:44 +0000"  >&lt;p&gt;I agree, it makes sense to have this fix for now.&lt;br/&gt;
We can follow up with other jiras for dropping support for this magic constant in 3.x .&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16005576" author="thejas" created="Wed, 10 May 2017 22:34:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt; can you please review the changes in this patch ?&lt;/p&gt;</comment>
                            <comment id="16005579" author="sershe" created="Wed, 10 May 2017 22:36:21 +0000"  >&lt;p&gt;+1 on that. Is it possible to file a followup to get rid of the constant in user-visible areas? To assume it&apos;s just a magic value for null used internally.&lt;/p&gt;</comment>
                            <comment id="16005617" author="daijy" created="Wed, 10 May 2017 23:22:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt;, are you +1 on the patch or the approach?&lt;/p&gt;</comment>
                            <comment id="16005619" author="sershe" created="Wed, 10 May 2017 23:24:19 +0000"  >&lt;p&gt;The patch.&lt;/p&gt;</comment>
                            <comment id="16005677" author="daijy" created="Wed, 10 May 2017 23:55:12 +0000"  >&lt;p&gt;Created &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-16638&quot; title=&quot;Get rid of magic constant __HIVE_DEFAULT_PARTITION__ in syntax&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-16638&quot;&gt;HIVE-16638&lt;/a&gt; for dropping _&lt;em&gt;HIVE_DEFAULT_PARTITION&lt;/em&gt;_ completely. Patch pushed to master. Thanks Sergey for reviewing!&lt;/p&gt;</comment>
                            <comment id="16485972" author="vgarg" created="Tue, 22 May 2018 23:58:30 +0000"  >&lt;p&gt;Hive 3.0.0 has been released so closing this jira.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12867059" name="HIVE-16609.1.patch" size="7489" author="daijy" created="Tue, 9 May 2017 07:24:11 +0000"/>
                            <attachment id="12867146" name="HIVE-16609.2.patch" size="7542" author="daijy" created="Tue, 9 May 2017 17:55:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3eo3j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12340268">3.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>