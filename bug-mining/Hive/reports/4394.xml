<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:43:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-13286] Query ID is being reused across queries</title>
                <link>https://issues.apache.org/jira/browse/HIVE-13286</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aihuaxu&quot; class=&quot;user-hover&quot; rel=&quot;aihuaxu&quot;&gt;aihuaxu&lt;/a&gt; I see this commit made via &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11488&quot; title=&quot;Add sessionId and queryId info to HS2 log&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11488&quot;&gt;&lt;del&gt;HIVE-11488&lt;/del&gt;&lt;/a&gt;. I see that query id is being reused across queries. This defeats the purpose of a query id. I am not sure what the purpose of the change in that jira is but it breaks the assumption about a query id being unique for each query. Please take a look into this at the earliest.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12950134">HIVE-13286</key>
            <summary>Query ID is being reused across queries</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aihuaxu">Aihua Xu</assignee>
                                    <reporter username="vikram.dixit">Vikram Dixit K</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Mar 2016 01:06:33 +0000</created>
                <updated>Tue, 21 Jun 2016 15:44:11 +0000</updated>
                            <resolved>Tue, 22 Mar 2016 21:05:57 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.1</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>Parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15194509" author="vikram.dixit" created="Tue, 15 Mar 2016 01:12:54 +0000"  >&lt;p&gt;I think it primarily comes down to this: the hive conf object once modified with a generated query id, never resets the query id for a subsequent query.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; queryId = confOverlay.get(HiveConf.ConfVars.HIVEQUERYID.varname);
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (queryId == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || queryId.isEmpty()) {
+      queryId = QueryPlan.makeQueryId();
+      confOverlay.put(HiveConf.ConfVars.HIVEQUERYID.varname, queryId);
+      sessionState.getConf().setVar(HiveConf.ConfVars.HIVEQUERYID, queryId);
+    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Once the query id has been set by a previous query, it never changes. This is incorrect behavior. I am not sure about what the change was trying to do but this needs to get fixed. Thanks!&lt;/p&gt;</comment>
                            <comment id="15194593" author="aihuaxu" created="Tue, 15 Mar 2016 02:21:40 +0000"  >&lt;p&gt;I will take a look. That seems to be an issue and not my intention. &lt;/p&gt;

</comment>
                            <comment id="15195278" author="aihuaxu" created="Tue, 15 Mar 2016 13:18:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vikram.dixit&quot; class=&quot;user-hover&quot; rel=&quot;vikram.dixit&quot;&gt;vikram.dixit&lt;/a&gt; This is to check if we provide queryId from the client. If a client provides a queryId, then we will use that queryId internally, otherwise, we will make a new one since the client could need a meaningful queryId. &lt;/p&gt;

&lt;p&gt;Seems there is a bug in here. We should make a new queryId inside if statement and set it outside the if statement.&lt;/p&gt;</comment>
                            <comment id="15195298" author="aihuaxu" created="Tue, 15 Mar 2016 13:35:05 +0000"  >&lt;p&gt;OK. We had a followup to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-12456&quot; title=&quot;QueryId can&amp;#39;t be stored in the configuration of the SessionState since multiple queries can run in a single session&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-12456&quot;&gt;&lt;del&gt;HIVE-12456&lt;/del&gt;&lt;/a&gt; to avoid storing queryId in SessionState since multiple queries can run in the same session at the same time. Later we will combine session conf and confOverlay conf to the query conf so the query should have the new queryId.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vikram.dixit&quot; class=&quot;user-hover&quot; rel=&quot;vikram.dixit&quot;&gt;vikram.dixit&lt;/a&gt; Did you have the patch-12456 applied?&lt;/p&gt;</comment>
                            <comment id="15195761" author="sseth" created="Tue, 15 Mar 2016 17:38:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aihuaxu&quot; class=&quot;user-hover&quot; rel=&quot;aihuaxu&quot;&gt;aihuaxu&lt;/a&gt; - I&apos;m curious as to why we allow the queryId to be overwritten by users. Isn&apos;t that meant to be unique within HiveServer. If some historic query information were to be retained by HiveServer - that would break. The query name can already be overwritten.&lt;/p&gt;</comment>
                            <comment id="15195794" author="aihuaxu" created="Tue, 15 Mar 2016 17:51:36 +0000"  >&lt;p&gt;QueryId should be unique. The user overwritten queryId is for the user to provide meaningful queryId if the user wants to and the user needs to make sure it&apos;s unique.  &lt;/p&gt;

&lt;p&gt;If the user doesn&apos;t overwrite the queryId, then hive will generate one as before. &lt;/p&gt;</comment>
                            <comment id="15195815" author="aihuaxu" created="Tue, 15 Mar 2016 18:01:55 +0000"  >&lt;p&gt;OK. I think there is an issue there. confOverlay is passed from the client. Seems we need to make a copy of that otherwise if the client reuses the same confOverlay, then queryId is reused. Is that the issue? I will correct that.&lt;/p&gt;</comment>
                            <comment id="15195836" author="vikram.dixit" created="Tue, 15 Mar 2016 18:11:27 +0000"  >&lt;p&gt;The issue here is that if we make a change in the incoming configuration, it remains set for the duration of the session. We need to make sure that the user does not set the query id configuration because there is a chance of them breaking what a query id is - a unique id for each query. I think what you really want is something like the HIVE_LOG_TRACE_ID which could be renamed to something like a HIVE_USER_TRACE_ID - an id that a user can set and trace which can stay constant until the user decides to change it. You could create a separate configuration too for the use case you have. I think allowing the user to mess around with the query id looks like a recipe for bugs. I think we should move the query id to a config that the user cannot change and just put it in the utilities class for e.g. like INPUT_NAME that mapreduce used.&lt;/p&gt;</comment>
                            <comment id="15195987" author="aihuaxu" created="Tue, 15 Mar 2016 19:04:57 +0000"  >&lt;p&gt;Actually what I need is the unique queryId. Think of the scenario that hive is just one of the components in the pipeline. The client could have a queryId (e.g., to trace the generation of the query) and then call hive. Then such queryId can link them together and better for diagnosis. If we create other ids, then seems to defeat that purpose. &lt;/p&gt;

&lt;p&gt;If the user doesn&apos;t provide queryId, then Hive will take care of that. Is the following the actual issue you see?&lt;/p&gt;
{nformat}
&lt;p&gt;I think there is an issue there. confOverlay is passed from the client. Seems we need to make a copy of that otherwise if the client reuses the same confOverlay, then queryId is reused. Is that the issue? I will correct that.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="15196044" author="vikram.dixit" created="Tue, 15 Mar 2016 19:36:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aihuaxu&quot; class=&quot;user-hover&quot; rel=&quot;aihuaxu&quot;&gt;aihuaxu&lt;/a&gt; Consider the following scenario: In Tez/Spark, if we end up caching the small table based on the hive query id. If say the user set the hive query id for 1 query and does not reset it for the subsequent query, we will end up picking the previously cached hash table for the join resulting in incorrect results right? Creating a new conf object would only work if we reset the query id after the query completes. If we allow it to exist in the configuration object after a query has completed running, it will result in incorrect results or some weird behavior.&lt;/p&gt;

&lt;p&gt;Consider hs2 or cli session, if a user in a session assigns a query id and doesn&apos;t reset it, it can result in incorrect results. You are expecting a user to set a query id each time after setting it once? I don&apos;t think that is great behavior.&lt;/p&gt;</comment>
                            <comment id="15196054" author="aihuaxu" created="Tue, 15 Mar 2016 19:40:50 +0000"  >&lt;p&gt;I moved to initialize the queryId earlier so that starting from the beginning of the execution, the workflow will have unique queryId. &lt;/p&gt;

&lt;p&gt;Actually I think your statement makes sense. What I need is really a traceId. Does the same queryId cause the issues? If it does, I can change to disallow the change from the client.&lt;/p&gt;</comment>
                            <comment id="15196097" author="aihuaxu" created="Tue, 15 Mar 2016 20:02:16 +0000"  >&lt;p&gt;I see. I will disallow the input of queryId and generate a new one every time then. &lt;/p&gt;</comment>
                            <comment id="15196100" author="vikram.dixit" created="Tue, 15 Mar 2016 20:03:29 +0000"  >&lt;p&gt;Yeah. The same queryId causes issues. We should disallow a change from the client. &lt;/p&gt;

&lt;p&gt;The HIVE_LOG_TRACE_ID is already present in the hive configuration. You could use that.&lt;/p&gt;</comment>
                            <comment id="15196105" author="vikram.dixit" created="Tue, 15 Mar 2016 20:04:49 +0000"  >&lt;p&gt;Great! Thanks!&lt;/p&gt;</comment>
                            <comment id="15196271" author="aihuaxu" created="Tue, 15 Mar 2016 21:11:59 +0000"  >&lt;p&gt;Attached the patch-1: disallow the input of the queryId. queryId will be regenernated and put in confOverlay for each query. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vikram.dixit&quot; class=&quot;user-hover&quot; rel=&quot;vikram.dixit&quot;&gt;vikram.dixit&lt;/a&gt; Can you take a look?&lt;/p&gt;</comment>
                            <comment id="15197821" author="vikram.dixit" created="Wed, 16 Mar 2016 18:01:22 +0000"  >&lt;p&gt;It looks good to me. I ran a local test for the same. +1 pending tests.&lt;/p&gt;</comment>
                            <comment id="15199635" author="hiveqa" created="Thu, 17 Mar 2016 14:43:42 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12793636/HIVE-13286.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12793636/HIVE-13286.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 5 failed/errored test(s), 9832 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestSparkCliDriver-groupby3_map.q-sample2.q-auto_join14.q-and-12-more - did not produce a TEST-*.xml file
TestSparkCliDriver-groupby_map_ppr_multi_distinct.q-table_access_keys_stats.q-groupby4_noskew.q-and-12-more - did not produce a TEST-*.xml file
TestSparkCliDriver-join_rc.q-insert1.q-vectorized_rcfile_columnar.q-and-12-more - did not produce a TEST-*.xml file
TestSparkCliDriver-ppd_join4.q-join9.q-ppd_join3.q-and-12-more - did not produce a TEST-*.xml file
org.apache.hive.service.cli.session.TestHiveSessionImpl.testLeakOperationHandle
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/7292/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/7292/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/7292/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/7292/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-7292/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-7292/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 5 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12793636 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="15200051" author="aihuaxu" created="Thu, 17 Mar 2016 17:58:03 +0000"  >&lt;p&gt;Attached patch-2: fix the unit test.&lt;/p&gt;</comment>
                            <comment id="15200317" author="vikram.dixit" created="Thu, 17 Mar 2016 20:33:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aihuaxu&quot; class=&quot;user-hover&quot; rel=&quot;aihuaxu&quot;&gt;aihuaxu&lt;/a&gt; I think the bug still exists here. I see that once I set a query id, it never changes. I think you need the following change in the Driver class as well:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;diff --git a/ql/src/java/org/apache/hadoop/hive/ql/Driver.java b/ql/src/java/org/apache/hadoop/hive/ql/Driver.java
index 7327a42..1fac526 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/Driver.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/Driver.java
@@ -403,13 +403,7 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; compile(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; command, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; resetTaskIds) {
     }
     saveSession(queryState);

-    &lt;span class=&quot;code-comment&quot;&gt;// Generate &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; query id &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; it&lt;span class=&quot;code-quote&quot;&gt;&apos;s not set &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; CLI &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt;. If it&apos;&lt;/span&gt;s session based,
&lt;/span&gt;-    &lt;span class=&quot;code-comment&quot;&gt;// query id is passed in from the client or initialized when the session starts.
&lt;/span&gt;-    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; queryId = conf.getVar(HiveConf.ConfVars.HIVEQUERYID);
-    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (queryId == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || queryId.isEmpty()) {
-      queryId = QueryPlan.makeQueryId();
-      conf.setVar(HiveConf.ConfVars.HIVEQUERYID, queryId);
-    }
+    conf.setVar(HiveConf.ConfVars.HIVEQUERYID, QueryPlan.makeQueryId());

     &lt;span class=&quot;code-comment&quot;&gt;//save some info &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; webUI &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; use after plan is freed
&lt;/span&gt;     &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.queryDisplay.setQueryStr(queryStr);

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I ran a test with a lot more queries than earlier and it turned out that the query id did not change.&lt;/p&gt;</comment>
                            <comment id="15200337" author="vikram.dixit" created="Thu, 17 Mar 2016 20:44:37 +0000"  >&lt;p&gt;Actually this is what you need:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;diff --git a/ql/src/java/org/apache/hadoop/hive/ql/Driver.java b/ql/src/java/org/apache/hadoop/hive/ql/Driver.java
index 7327a42..fc10242 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/Driver.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/Driver.java
@@ -402,14 +402,9 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; compile(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; command, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; resetTaskIds) {
       TaskFactory.resetId();
     }
     saveSession(queryState);
+    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; queryId = QueryPlan.makeQueryId();

-    &lt;span class=&quot;code-comment&quot;&gt;// Generate &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; query id &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; it&lt;span class=&quot;code-quote&quot;&gt;&apos;s not set &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; CLI &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt;. If it&apos;&lt;/span&gt;s session based,
&lt;/span&gt;-    &lt;span class=&quot;code-comment&quot;&gt;// query id is passed in from the client or initialized when the session starts.
&lt;/span&gt;-    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; queryId = conf.getVar(HiveConf.ConfVars.HIVEQUERYID);
-    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (queryId == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || queryId.isEmpty()) {
-      queryId = QueryPlan.makeQueryId();
-      conf.setVar(HiveConf.ConfVars.HIVEQUERYID, queryId);
-    }
+    conf.setVar(HiveConf.ConfVars.HIVEQUERYID, queryId);

     &lt;span class=&quot;code-comment&quot;&gt;//save some info &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; webUI &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; use after plan is freed
&lt;/span&gt;     &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.queryDisplay.setQueryStr(queryStr);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15200343" author="vikram.dixit" created="Thu, 17 Mar 2016 20:46:16 +0000"  >&lt;p&gt;Attaching a full version in case hive qa gets to run the test.&lt;/p&gt;</comment>
                            <comment id="15200676" author="aihuaxu" created="Fri, 18 Mar 2016 00:06:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vikram.dixit&quot; class=&quot;user-hover&quot; rel=&quot;vikram.dixit&quot;&gt;vikram.dixit&lt;/a&gt; Seems the fix will get new queryId for the query, but I feel if the query is from the session, then the query will have 2 different ids, first the one generated in HiveSessionImpl.java and then a new one in Driver.java. &lt;/p&gt;

&lt;p&gt;Did you see the issues from hive CLI tests? &lt;/p&gt;</comment>
                            <comment id="15200688" author="aihuaxu" created="Fri, 18 Mar 2016 00:20:33 +0000"  >&lt;p&gt;Let me take a look at CLI cases. &lt;/p&gt;</comment>
                            <comment id="15200729" author="vikram.dixit" created="Fri, 18 Mar 2016 00:54:26 +0000"  >&lt;p&gt;Yeah. In one of the cli tests, I just added this:&lt;/p&gt;

&lt;p&gt;set hive.query.id = abc;&lt;/p&gt;

&lt;p&gt;And added a log in TezTask class. I saw that we were retaining the id in this case.&lt;/p&gt;</comment>
                            <comment id="15201493" author="aihuaxu" created="Fri, 18 Mar 2016 13:56:28 +0000"  >&lt;p&gt;When we set in the session, it&apos;s saved in the session conf and carry over to each query. I guess we should disable setting hive.query.id in the session ideally. I will move the setting new queryId a little earlier in CliDriver.java so both CLI and Session queries should work.&lt;/p&gt;
</comment>
                            <comment id="15201551" author="aihuaxu" created="Fri, 18 Mar 2016 14:32:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vikram.dixit&quot; class=&quot;user-hover&quot; rel=&quot;vikram.dixit&quot;&gt;vikram.dixit&lt;/a&gt; Attached patch-4: we will generate a new queryId for CLI case now. So set hive.query.id=abc; actually won&apos;t take effect.&lt;/p&gt;

&lt;p&gt;Do you think it makes sense to have a follow up to disable setting session properties?&lt;/p&gt;</comment>
                            <comment id="15202683" author="hiveqa" created="Sat, 19 Mar 2016 09:37:46 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12794191/HIVE-13286.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12794191/HIVE-13286.4.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 4 failed/errored test(s), 9835 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestSparkCliDriver-groupby3_map.q-sample2.q-auto_join14.q-and-12-more - did not produce a TEST-*.xml file
TestSparkCliDriver-groupby_map_ppr_multi_distinct.q-table_access_keys_stats.q-groupby4_noskew.q-and-12-more - did not produce a TEST-*.xml file
TestSparkCliDriver-join_rc.q-insert1.q-vectorized_rcfile_columnar.q-and-12-more - did not produce a TEST-*.xml file
TestSparkCliDriver-ppd_join4.q-join9.q-ppd_join3.q-and-12-more - did not produce a TEST-*.xml file
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/7310/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/7310/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/7310/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/7310/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-7310/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-7310/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12794191 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="15205076" author="aihuaxu" created="Mon, 21 Mar 2016 20:41:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vikram.dixit&quot; class=&quot;user-hover&quot; rel=&quot;vikram.dixit&quot;&gt;vikram.dixit&lt;/a&gt; How is the new patch? Can you take a look?&lt;/p&gt;</comment>
                            <comment id="15205308" author="vikram.dixit" created="Mon, 21 Mar 2016 22:42:10 +0000"  >&lt;p&gt;I tested the latest patch. It works as expected. +1&lt;/p&gt;</comment>
                            <comment id="15206870" author="vikram.dixit" created="Tue, 22 Mar 2016 17:45:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aihuaxu&quot; class=&quot;user-hover&quot; rel=&quot;aihuaxu&quot;&gt;aihuaxu&lt;/a&gt; Are the test failures related? Otherwise let me know and I can commit the patch to master and branch-2. I will raise a follow-on jira for disallowing the user to set this configuration.&lt;/p&gt;</comment>
                            <comment id="15207015" author="aihuaxu" created="Tue, 22 Mar 2016 18:45:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vikram.dixit&quot; class=&quot;user-hover&quot; rel=&quot;vikram.dixit&quot;&gt;vikram.dixit&lt;/a&gt; Those tests are not related. Sorry. Forgot to mention that. &lt;/p&gt;</comment>
                            <comment id="15207312" author="vikram.dixit" created="Tue, 22 Mar 2016 21:06:27 +0000"  >&lt;p&gt;Committed to both master and branch-2.0. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aihuaxu&quot; class=&quot;user-hover&quot; rel=&quot;aihuaxu&quot;&gt;aihuaxu&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12952520">HIVE-13329</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12852589">HIVE-11488</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12793636" name="HIVE-13286.1.patch" size="1344" author="aihuaxu" created="Tue, 15 Mar 2016 21:09:22 +0000"/>
                            <attachment id="12794023" name="HIVE-13286.2.patch" size="2541" author="aihuaxu" created="Thu, 17 Mar 2016 17:57:26 +0000"/>
                            <attachment id="12794063" name="HIVE-13286.3.patch" size="3529" author="vikram.dixit" created="Thu, 17 Mar 2016 20:46:16 +0000"/>
                            <attachment id="12794191" name="HIVE-13286.4.patch" size="4411" author="aihuaxu" created="Fri, 18 Mar 2016 14:30:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 35 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2un7b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12334886">2.0.1</customfieldvalue>
    <customfieldvalue id="12334255">2.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>