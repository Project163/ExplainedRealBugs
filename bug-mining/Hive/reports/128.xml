<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:51:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-404] Problems in &quot;SELECT * FROM t SORT BY col1 LIMIT 100&quot;</title>
                <link>https://issues.apache.org/jira/browse/HIVE-404</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Unless the user specify &quot;set mapred.reduce.tasks=1;&quot;, he will see unexpected results with the query of  &quot;SELECT * FROM t SORT BY col1 LIMIT 100&quot;&lt;/p&gt;

&lt;p&gt;Basically, in the first map-reduce job, each reducer will get sorted data and only keep the first 100. In the second map-reduce job, we will distribute and sort the data randomly, before feeding into a single reducer that outputs the first 100.&lt;/p&gt;

&lt;p&gt;In short, the query will output 100 random records in N * 100 top records from each of the reducer in the first map-reduce job.&lt;/p&gt;

&lt;p&gt;This is contradicting to what people expects.&lt;/p&gt;


&lt;p&gt;We should propagate the SORT BY columns to the second map-reduce job.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12422544">HIVE-404</key>
            <summary>Problems in &quot;SELECT * FROM t SORT BY col1 LIMIT 100&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="namit">Namit Jain</assignee>
                                    <reporter username="zshao">Zheng Shao</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Apr 2009 07:51:49 +0000</created>
                <updated>Sat, 17 Dec 2011 00:08:33 +0000</updated>
                            <resolved>Sat, 18 Apr 2009 01:25:26 +0000</resolved>
                                                    <fixVersion>0.3.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12699473" author="zshao" created="Thu, 16 Apr 2009 01:26:26 +0000"  >&lt;p&gt;1. I think the condition on &quot;distributedBy&quot; is not needed. clusterBy = distributeBy and sortBy. distributeBy does not enforce the order.&lt;/p&gt;

&lt;p&gt;2. We need to upgrade the FetchTask to be able to merge multiple sorted stream. This may not be good because there might be thousands of files needed to be opened by a single client. This also does NOT solve the problem when the result is inserted into a table.&lt;/p&gt;

&lt;p&gt;An alternative to 2 is to propagate the sort order to the second map-reduce job. I think that will solve the problem.&lt;/p&gt;
</comment>
                            <comment id="12699737" author="namit" created="Thu, 16 Apr 2009 16:07:41 +0000"  >&lt;p&gt;1. Will do - distributeBy check is not needed&lt;br/&gt;
2. It creates a second map-reduce if it is not a query, so inserts is not a problem. Sort order is propagated to the second map-reduce job.&lt;br/&gt;
    I dont think FetchTask needs any change - the current change performs a second map-reduce job which should fix the problem.&lt;/p&gt;

&lt;p&gt;Will do the changes and reload the patch.&lt;/p&gt;
</comment>
                            <comment id="12699746" author="namit" created="Thu, 16 Apr 2009 16:16:48 +0000"  >&lt;p&gt;incorporated Zheng&apos;s comments&lt;/p&gt;</comment>
                            <comment id="12699858" author="namit" created="Thu, 16 Apr 2009 20:58:13 +0000"  >&lt;p&gt;Forgot to clarify the FetchTask issue. FetchTask does not perform any merge - it opens files one-by-one until limit is reached (if limit is specified).&lt;br/&gt;
It is the responsibility of the server to have the data appropriately sorted.&lt;/p&gt;</comment>
                            <comment id="12699863" author="zshao" created="Thu, 16 Apr 2009 21:06:00 +0000"  >&lt;p&gt;I think the users would expect the results of LIMIT to be sorted in total order - if user says &quot;SORT BY key LIMIT 10&quot;, he probably wants the global top 10, no matter how many reducers we have.&lt;/p&gt;

&lt;p&gt;I think it&apos;s necessary to have the second map-reduce job in case of &quot;SORT BY/CLUSTER BY&quot;, but we also want the second map-reduce job to have the right sort cols between the map-reduce boundary so we can get the global top ones.&lt;/p&gt;
</comment>
                            <comment id="12699867" author="namit" created="Thu, 16 Apr 2009 21:12:32 +0000"  >&lt;p&gt;Thats right - that&apos;s what genReduceSinkPlan does.&lt;/p&gt;

&lt;p&gt;After the change, if a sorting/clustering column is present, a second map-reduce job will sort/cluster by those columns, so that we can get the global order&lt;/p&gt;</comment>
                            <comment id="12699868" author="namit" created="Thu, 16 Apr 2009 21:13:44 +0000"  >&lt;p&gt;The second map-reduce job will have only 1 reducer with the sorting columns preserved - so that will do exactly what you are saying&lt;/p&gt;</comment>
                            <comment id="12700400" author="zshao" created="Sat, 18 Apr 2009 00:59:44 +0000"  >&lt;p&gt;Talked with Namit offline. Apparently I was not aware that the second map-reduce job was already doing the sorting.&lt;br/&gt;
Will test and commit.&lt;/p&gt;</comment>
                            <comment id="12700407" author="zshao" created="Sat, 18 Apr 2009 01:25:26 +0000"  >&lt;p&gt;Trunk only: Committed revision 766196. Thanks Namit.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12405603" name="hive.404.1.patch" size="4457" author="namit" created="Thu, 16 Apr 2009 01:18:25 +0000"/>
                            <attachment id="12405661" name="hive.404.2.patch" size="4578" author="namit" created="Thu, 16 Apr 2009 16:16:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73557</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 32 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0l9m7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>122208</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-404&quot; title=&quot;Problems in &amp;quot;SELECT * FROM t SORT BY col1 LIMIT 100&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-404&quot;&gt;&lt;strike&gt;HIVE-404&lt;/strike&gt;&lt;/a&gt;. Fix ordering in &amp;quot;SELECT * FROM t SORT BY col1 LIMIT 100&amp;quot; when query is a outer-most query.  (Namit Jain via zshao)</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>