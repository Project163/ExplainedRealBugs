<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:19:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-24656] CBO fails for queries with is null on map and array types</title>
                <link>https://issues.apache.org/jira/browse/HIVE-24656</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Currently CBO throws an NPE for queries that have is null or is not null as where clause:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CREATE EXTERNAL TABLE `oft2`(&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 
&#160; `mi` &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 
&#160; `ms` string, &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 
&#160; `mst` struct&amp;lt;`a`:string, `b`:string&amp;gt;,&#160; &#160; &#160; &#160; &#160; &#160; 
&#160; `mm1` map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,string&amp;gt;, &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 
&#160; `mm2` map&amp;lt;string,struct&amp;lt;`c`:string, `d`:string&amp;gt;&amp;gt;,&#160; 
&#160; `ma` array&amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
select * from oft2 where ma is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
select * from oft2 where mm1 is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;will cause NPE and skip CBO:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2021-01-19T04:47:31,696 ERROR [0de7af8c-b9a5-4914-b967-8827e9ea09e4 HiveServer2-Handler-Pool: &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-916] parse.CalcitePlanner: CBO failed, skipping CBO.
java.lang.NullPointerException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&#160; &#160; &#160; &#160; at org.apache.hadoop.hive.ql.optimizer.calcite.translator.ASTConverter$RexVisitor.visitCall(ASTConverter.java:796) ~[hive-exec-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.hadoop.hive.ql.optimizer.calcite.translator.ASTConverter$RexVisitor.visitCall(ASTConverter.java:547) ~[hive-exec-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.calcite.rex.RexCall.accept(RexCall.java:191) ~[hive-exec-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.hadoop.hive.ql.optimizer.calcite.translator.ASTConverter$RexVisitor.visitLiteral(ASTConverter.java:618) ~[hive-exec-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.hadoop.hive.ql.optimizer.calcite.translator.ASTConverter$RexVisitor.visitLiteral(ASTConverter.java:547) ~[hive-exec-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.calcite.rex.RexLiteral.accept(RexLiteral.java:1137) ~[hive-exec-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.hadoop.hive.ql.optimizer.calcite.translator.ASTConverter.convert(ASTConverter.java:226) ~[hive-exec-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.hadoop.hive.ql.optimizer.calcite.translator.ASTConverter.convert(ASTConverter.java:119) ~[hive-exec-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.hadoop.hive.ql.parse.CalcitePlanner.getOptimizedAST(CalcitePlanner.java:1648) ~[hive-exec-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.hadoop.hive.ql.parse.CalcitePlanner.genOPTree(CalcitePlanner.java:577) [hive-exec-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.analyzeInternal(SemanticAnalyzer.java:12526) [hive-exec-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.hadoop.hive.ql.parse.CalcitePlanner.analyzeInternal(CalcitePlanner.java:455) [hive-exec-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:301) [hive-exec-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.hadoop.hive.ql.&lt;span class=&quot;code-object&quot;&gt;Compiler&lt;/span&gt;.analyze(&lt;span class=&quot;code-object&quot;&gt;Compiler&lt;/span&gt;.java:223) [hive-exec-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.hadoop.hive.ql.&lt;span class=&quot;code-object&quot;&gt;Compiler&lt;/span&gt;.compile(&lt;span class=&quot;code-object&quot;&gt;Compiler&lt;/span&gt;.java:104) [hive-exec-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:492) [hive-exec-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.hadoop.hive.ql.Driver.compileInternal(Driver.java:445) [hive-exec-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.hadoop.hive.ql.Driver.compileAndRespond(Driver.java:409) [hive-exec-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.hadoop.hive.ql.Driver.compileAndRespond(Driver.java:403) [hive-exec-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.hadoop.hive.ql.reexec.ReExecDriver.compileAndRespond(ReExecDriver.java:125) [hive-exec-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.hive.service.cli.operation.SQLOperation.prepare(SQLOperation.java:204) [hive-service-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.hive.service.cli.operation.SQLOperation.runInternal(SQLOperation.java:267) [hive-service-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.hive.service.cli.operation.Operation.run(Operation.java:288) [hive-service-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.hive.service.cli.session.HiveSessionImpl.executeStatementInternal(HiveSessionImpl.java:560) [hive-service-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.hive.service.cli.session.HiveSessionImpl.executeStatementAsync(HiveSessionImpl.java:545) [hive-service-4.0.0-SNAPSHOT.jar:4.0.0-SNAPSHOT]
&#160; &#160; &#160; &#160; at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_241] &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13353274">HIVE-24656</key>
            <summary>CBO fails for queries with is null on map and array types</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="szita">&#193;d&#225;m Szita</assignee>
                                    <reporter username="szita">&#193;d&#225;m Szita</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 19 Jan 2021 12:51:01 +0000</created>
                <updated>Thu, 17 Nov 2022 08:48:28 +0000</updated>
                            <resolved>Mon, 25 Jan 2021 13:37:43 +0000</resolved>
                                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                                    <component>CBO</component>
                    <component>Query Planning</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="17268494" author="zabetak" created="Wed, 20 Jan 2021 10:14:44 +0000"  >&lt;p&gt;Interestingly we already have tests that fail (&lt;a href=&quot;http://ci.hive.apache.org/blue/organizations/jenkins/hive-precommit/detail/PR-1875/3/tests&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;analyze_npe&lt;/a&gt;) due to this under certain conditions.&lt;/p&gt;</comment>
                            <comment id="17268499" author="szita" created="Wed, 20 Jan 2021 10:27:00 +0000"  >&lt;p&gt;Actually that test should always produce the NPE when the query goes against either the map or the array column.&lt;/p&gt;

&lt;p&gt;The reason this is not expected to be visible in the test results is that when CBO fails, Hive falls back to the plain old rule based optimizer. So seeing this actually coming up as a failure in the link above is a surprise to me - I was under the impression that this has been a rather sleeping bug.&lt;/p&gt;

&lt;p&gt;I wonder how many more of these do we have though..&lt;/p&gt;</comment>
                            <comment id="17268509" author="zabetak" created="Wed, 20 Jan 2021 10:52:03 +0000"  >&lt;p&gt;Yes, this is one of the reasons for pushing &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-24601&quot; title=&quot;Control CBO fallback behavior via property&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-24601&quot;&gt;&lt;del&gt;HIVE-24601&lt;/del&gt;&lt;/a&gt; forward. Hopefully, it will also tell us if we have more bugs like this one hidden somewhere.&lt;/p&gt;</comment>
                            <comment id="17268554" author="szita" created="Wed, 20 Jan 2021 12:31:30 +0000"  >&lt;p&gt;Ah nice! So that&apos;s why you saw that NPE - cool, I was actually looking for such an option to control CBO fallback, so I think&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-24601&quot; title=&quot;Control CBO fallback behavior via property&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-24601&quot;&gt;&lt;del&gt;HIVE-24601&lt;/del&gt;&lt;/a&gt;&#160;will be very useful to have.&lt;/p&gt;</comment>
                            <comment id="17271311" author="szita" created="Mon, 25 Jan 2021 13:37:43 +0000"  >&lt;p&gt;Committed to master. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kgyrtkirk&quot; class=&quot;user-hover&quot; rel=&quot;kgyrtkirk&quot;&gt;kgyrtkirk&lt;/a&gt;&#160;for reviewing it.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 42 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0mrf4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>