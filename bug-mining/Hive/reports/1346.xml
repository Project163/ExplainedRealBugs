<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:07:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-4502] NPE - subquery smb joins fails</title>
                <link>https://issues.apache.org/jira/browse/HIVE-4502</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Found this issue while running some SMB joins. Attaching test case that causes this error.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12646157">HIVE-4502</key>
            <summary>NPE - subquery smb joins fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="navis">Navis Ryu</assignee>
                                    <reporter username="vikram.dixit">Vikram Dixit K</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 May 2013 05:48:35 +0000</created>
                <updated>Tue, 15 Oct 2013 23:29:30 +0000</updated>
                            <resolved>Tue, 23 Jul 2013 00:53:23 +0000</resolved>
                                    <version>0.11.0</version>
                                    <fixVersion>0.12.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="13649536" author="vikram.dixit" created="Mon, 6 May 2013 06:05:36 +0000"  >&lt;p&gt;java.lang.NullPointerException&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.hadoop.hive.ql.exec.ExprNodeColumnEvaluator.initialize(ExprNodeColumnEvaluator.java:82)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.hadoop.hive.ql.exec.JoinUtil.getObjectInspectorsFromEvaluators(JoinUtil.java:68)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.hadoop.hive.ql.exec.CommonJoinOperator.initializeOp(CommonJoinOperator.java:224)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.hadoop.hive.ql.exec.JoinOperator.initializeOp(JoinOperator.java:61)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.hadoop.hive.ql.exec.Operator.initialize(Operator.java:375)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.hadoop.hive.ql.exec.ExecReducer.configure(ExecReducer.java:154)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:88)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.hadoop.util.ReflectionUtils.setConf(ReflectionUtils.java:64)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.hadoop.util.ReflectionUtils.newInstance(ReflectionUtils.java:117)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.hadoop.mapred.ReduceTask.runOldReducer(ReduceTask.java:486)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:421)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.hadoop.mapred.LocalJobRunner$Job.run(LocalJobRunner.java:262)&lt;/p&gt;</comment>
                            <comment id="13652880" author="phabricator@reviews.facebook.net" created="Thu, 9 May 2013 11:33:15 +0000"  >&lt;p&gt;navis requested code review of &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4502&quot; title=&quot;NPE - subquery smb joins fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4502&quot;&gt;&lt;del&gt;HIVE-4502&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; NPE - subquery smb joins fails&quot;.&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4502&quot; title=&quot;NPE - subquery smb joins fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4502&quot;&gt;&lt;del&gt;HIVE-4502&lt;/del&gt;&lt;/a&gt; NPE - subquery smb joins fails&lt;/p&gt;

&lt;p&gt;Found this issue while running some SMB joins. Attaching test case that causes this error.&lt;/p&gt;

&lt;p&gt;TEST PLAN&lt;br/&gt;
  EMPTY&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10695&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10695&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/lib/DefaultGraphWalker.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMROperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRProcContext.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink2.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink3.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinFactory.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinProcessor.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/GenMapRedWalker.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/smb_mapjoin_25.q&lt;br/&gt;
  ql/src/test/results/clientpositive/auto_smb_mapjoin_14.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/auto_sortmerge_join_6.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/auto_sortmerge_join_9.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin_negative.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin_negative2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_5.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_6.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_7.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_8.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/mapjoin_distinct.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin9.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin_11.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin_12.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin_14.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin_25.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin_6.q.out&lt;/p&gt;

&lt;p&gt;MANAGE HERALD RULES&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/view/differential/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/herald/view/differential/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WHY DID I GET THIS EMAIL?&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/transcript/25653/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/herald/transcript/25653/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, navis&lt;/p&gt;</comment>
                            <comment id="13655799" author="vikram.dixit" created="Mon, 13 May 2013 06:38:19 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;My attached patch actually retains the SMB join and I feel it is a better plan over-all than converting all of the joins to reduce side joins. It would be great if you could take a look and let me know your opinion. All existing unit tests pass with this patch.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Vikram.&lt;/p&gt;</comment>
                            <comment id="13662539" author="vikram.dixit" created="Tue, 21 May 2013 01:02:46 +0000"  >&lt;p&gt;Review board request:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/11082/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/11082/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13673578" author="ashutoshc" created="Mon, 3 Jun 2013 21:12:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; Would you like to take a look at Vikram&apos;s patch? I think if we can retain SMBJoin instead of converting them to reduce-side join, thats better.&lt;/p&gt;</comment>
                            <comment id="13673856" author="navis" created="Tue, 4 Jun 2013 00:28:36 +0000"  >&lt;p&gt;I&apos;ve not converted any SMBJoins to RS-joins and just changed creation order of those. The difference is that my patch adds a root task only when all of the join aliases are handled, which is contrary to trunk (add root whenever possible and remove if it&apos;s not afterwards). The patch I&apos;ve attached seemed easier but it is just my call.&lt;/p&gt;</comment>
                            <comment id="13673946" author="vikram.dixit" created="Tue, 4 Jun 2013 02:09:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; I misread the results of the test case from your patch. I was going through your patch more meticulously and found that a few of the tests have different results. Particularly those in auto_sortmerge_join_6.q. The count results seem to have changed.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3891&quot; title=&quot;physical optimizer changes for auto sort-merge join&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3891&quot;&gt;&lt;del&gt;HIVE-3891&lt;/del&gt;&lt;/a&gt; converts SMB joins to map-joins when possible. Although that seems orthogonal to this change, any idea as to why the join is still SMB?&lt;/p&gt;

&lt;p&gt;Also attached a few more tests for this. The plans seem valid after applying your patch. I will continue to review the patch.&lt;/p&gt;</comment>
                            <comment id="13678314" author="ashutoshc" created="Fri, 7 Jun 2013 19:00:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; Sorry earlier I didnt look at the patch closely. Now, I see you indeed are doing the right thing. We should move forward on this. Did you get a chance to see why results have changed for auto_sortmerge_join_6.q Perhaps, earlier results are wrong ? Also, it will be good to add &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vikram.dixit&quot; class=&quot;user-hover&quot; rel=&quot;vikram.dixit&quot;&gt;vikram.dixit&lt;/a&gt; &apos;s testcases (or some simplified version of it)in the patch, if its easy enough. &lt;/p&gt;</comment>
                            <comment id="13678926" author="brucenelson6655" created="Sun, 9 Jun 2013 03:44:04 +0000"  >&lt;p&gt;I verified that &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4502&quot; title=&quot;NPE - subquery smb joins fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4502&quot;&gt;&lt;del&gt;HIVE-4502&lt;/del&gt;&lt;/a&gt;-1.patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4650&quot; title=&quot;Getting Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.MapRedTask on auto convert to MapJoin after upgrade to Hive-0.11.0.x from hive-0.10.0.x&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4650&quot;&gt;&lt;del&gt;HIVE-4650&lt;/del&gt;&lt;/a&gt; has been applied to HWorx hive-0.11.0.1.3.0.0-170 and the MapJoin issue in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4650&quot; title=&quot;Getting Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.MapRedTask on auto convert to MapJoin after upgrade to Hive-0.11.0.x from hive-0.10.0.x&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4650&quot;&gt;&lt;del&gt;HIVE-4650&lt;/del&gt;&lt;/a&gt; still exits. &lt;/p&gt;</comment>
                            <comment id="13678929" author="brucenelson6655" created="Sun, 9 Jun 2013 03:48:56 +0000"  >&lt;p&gt;Correction - typo on my part its hive-0.11.0.1.3.0.0-107 not *-170&lt;/p&gt;</comment>
                            <comment id="13679262" author="navis" created="Mon, 10 Jun 2013 02:28:08 +0000"  >&lt;p&gt;Sorry to all. I&apos;ve seen this assigned to Vikram days ago and completely forgot.&lt;/p&gt;

&lt;p&gt;It&apos;s my bad to have missed the changed result of auto_sortmerge_join_6.q. And I&apos;ve looked into this today. It seemed another bug in trunk which does not handle joining plan in some particular order. For example,&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;set hive.auto.convert.sortmerge.join=true;
set hive.optimize.bucketmapjoin = true;
set hive.optimize.bucketmapjoin.sortedmerge = true;
set hive.auto.convert.join=true;
set hive.auto.convert.join.noconditionaltask=true;
set hive.auto.convert.join.noconditionaltask.size=200;
set hive.auto.convert.sortmerge.join.to.mapjoin=false;

select * FROM tbl1 a JOIN tbl2 b ON a.key = b.key join src c on c.value = a.value;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The above query is from auto_sortmerge_join_6.q and works well. But if we change alias &apos;c&apos; to &apos;d&apos;, it will fail. The former makes MAPJOIN first and JOIN later but the latter makes JOIN first and MAPJOIN later, making strange plan which does not work. I should fix that, too.&lt;/p&gt;</comment>
                            <comment id="13679305" author="phabricator@reviews.facebook.net" created="Mon, 10 Jun 2013 04:52:20 +0000"  >&lt;p&gt;navis updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4502&quot; title=&quot;NPE - subquery smb joins fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4502&quot;&gt;&lt;del&gt;HIVE-4502&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; NPE - subquery smb joins fails&quot;.&lt;/p&gt;

&lt;p&gt;  Fixed changed results &amp;amp; add test cases for that.&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10695&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10695&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10695?vs=33447&amp;amp;id=34479#toc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10695?vs=33447&amp;amp;id=34479#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/QueryPlan.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/lib/DefaultGraphWalker.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMROperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRProcContext.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink2.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink3.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinFactory.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinProcessor.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/GenMapRedWalker.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/auto_sortmerge_join_6.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/smb_mapjoin_25.q&lt;br/&gt;
  ql/src/test/results/clientpositive/auto_smb_mapjoin_14.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/auto_sortmerge_join_6.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/auto_sortmerge_join_9.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin_negative.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin_negative2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_5.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_6.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_7.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_8.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/mapjoin_distinct.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin9.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin_11.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin_12.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin_14.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin_25.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin_6.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/stats11.q.out&lt;/p&gt;

&lt;p&gt;To: JIRA, navis&lt;/p&gt;</comment>
                            <comment id="13679307" author="navis" created="Mon, 10 Jun 2013 04:58:10 +0000"  >&lt;p&gt;Running test&lt;/p&gt;</comment>
                            <comment id="13679315" author="phabricator@reviews.facebook.net" created="Mon, 10 Jun 2013 05:10:20 +0000"  >&lt;p&gt;brock has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4502&quot; title=&quot;NPE - subquery smb joins fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4502&quot;&gt;&lt;del&gt;HIVE-4502&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; NPE - subquery smb joins fails&quot;.&lt;/p&gt;

&lt;p&gt;  One minor question&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinProcessor.java:265 What do you think of passing the exception into the constructor of the SemanticException instead of printing it to standard error?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10695&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10695&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, navis&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13679321" author="phabricator@reviews.facebook.net" created="Mon, 10 Jun 2013 05:16:22 +0000"  >&lt;p&gt;navis has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4502&quot; title=&quot;NPE - subquery smb joins fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4502&quot;&gt;&lt;del&gt;HIVE-4502&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; NPE - subquery smb joins fails&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinProcessor.java:265 I prefer that way, too. But I&apos;ve just fixed typo because it&apos;s not related to this issue. Can I do that?&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/QueryPlan.java:619 I should de-comment this. Sorry.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10695&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10695&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, navis&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13680090" author="navis" created="Tue, 11 Jun 2013 00:24:06 +0000"  >&lt;p&gt;passed all tests&lt;/p&gt;</comment>
                            <comment id="13707699" author="phabricator@reviews.facebook.net" created="Sat, 13 Jul 2013 08:49:46 +0000"  >&lt;p&gt;navis updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4502&quot; title=&quot;NPE - subquery smb joins fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4502&quot;&gt;&lt;del&gt;HIVE-4502&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; NPE - subquery smb joins fails&quot;.&lt;/p&gt;

&lt;p&gt;  Rebased to trunk&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10695&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10695&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10695?vs=34479&amp;amp;id=35697#toc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10695?vs=34479&amp;amp;id=35697#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/QueryPlan.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/lib/DefaultGraphWalker.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMROperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRProcContext.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink2.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink3.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinFactory.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinProcessor.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/GenMapRedWalker.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/MapReduceCompiler.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/auto_sortmerge_join_6.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/smb_mapjoin_25.q&lt;br/&gt;
  ql/src/test/results/clientpositive/auto_smb_mapjoin_14.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/auto_sortmerge_join_6.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/auto_sortmerge_join_9.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin_negative.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin_negative2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_5.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_6.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_7.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_8.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/mapjoin_distinct.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin9.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin_11.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin_12.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin_14.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin_25.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin_6.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/stats11.q.out&lt;/p&gt;

&lt;p&gt;To: JIRA, navis&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13709352" author="phabricator@reviews.facebook.net" created="Tue, 16 Jul 2013 01:52:48 +0000"  >&lt;p&gt;ashutoshc has requested changes to the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4502&quot; title=&quot;NPE - subquery smb joins fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4502&quot;&gt;&lt;del&gt;HIVE-4502&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; NPE - subquery smb joins fails&quot;.&lt;/p&gt;

&lt;p&gt;  I dont like the idea of tracking operators in the task thereby tasks getting involved in plan manipulation but in absence of alternatives, this may be the way to move forward for now.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/QueryPlan.java:619 I guess this is unintentional.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java:72 I am little hesistant about task being aware of operators. Ideally if we have good demarkation of different layers, task (which is sort of a driver to execute a plan) need not be aware of operators contained in its plan. Planner shouldn&apos;t wait so late that it needs to track operators in task to generate plan correctly. I don&apos;t have a proposal on how to do this better though. At the very least, it will help to add comment explaining the purpose of this list.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink1.java:70 I think its better to do following:&lt;br/&gt;
  If (op.getNumChild() != 1)&lt;/p&gt;
{
    throw new IllegalStateException(&quot;Expecting operator &quot; + op + &quot;to have one child. Found: &quot; + op.getNumChild());
  }
&lt;p&gt;  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:261 It will be good to add comments on what this method intends to do. Also, I guess you can make this protected, since all the callers of this method are in same package.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:281 Does this method need to be public?&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:310 I didnt get this part. Can you add comments why old and curr tasks need to be of type ExecDriver. What about MapredLocalWork?&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:318 Does this method need to be public? Also, please add javadocs for the method.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:851 throw IllegalStateException in case # of parents != 1&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:949 I didnt get why did you remove this if check. We shall be needing tagging only for joins. Right? Removing this check implies we will tag always, is that needed?&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:942 Better name: hasBranchFinished() ?&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinFactory.java:228 Why is this function call needed here? Can you please add comment for it?&lt;br/&gt;
  ql/src/test/results/clientpositive/auto_smb_mapjoin_14.q.out:165 I see that there is no Stage-2 at all. What caused this? Its little weird that we have stages 0,1 and 3 in plan and no stage-2 at all.&lt;br/&gt;
  ql/src/test/results/clientpositive/auto_smb_mapjoin_14.q.out:349 No stage-2 here either. Probably the same cause?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10695&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10695&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4502&quot; title=&quot;NPE - subquery smb joins fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4502&quot;&gt;&lt;del&gt;HIVE-4502&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, navis&lt;br/&gt;
Cc: brock&lt;/p&gt;</comment>
                            <comment id="13710519" author="hiveqa" created="Wed, 17 Jul 2013 00:16:51 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12592133/HIVE-4502.D10695.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12592133/HIVE-4502.D10695.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 all tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/8/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/8/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/8/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/8/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;br/&gt;
Executing org.apache.hive.ptest.execution.CleanupPhase&lt;br/&gt;
Executing org.apache.hive.ptest.execution.PrepPhase&lt;br/&gt;
Executing org.apache.hive.ptest.execution.ExecutionPhase&lt;br/&gt;
Executing org.apache.hive.ptest.execution.ReportingPhase&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13711534" author="phabricator@reviews.facebook.net" created="Wed, 17 Jul 2013 19:46:46 +0000"  >&lt;p&gt;vikram has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4502&quot; title=&quot;NPE - subquery smb joins fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4502&quot;&gt;&lt;del&gt;HIVE-4502&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; NPE - subquery smb joins fails&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java:72 Maybe this can be moved to GenMRProcCtx and a hashmap used there can provide the same functionality.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10695&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10695&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4502&quot; title=&quot;NPE - subquery smb joins fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4502&quot;&gt;&lt;del&gt;HIVE-4502&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, navis&lt;br/&gt;
Cc: brock, vikram&lt;/p&gt;</comment>
                            <comment id="13711560" author="vikram.dixit" created="Wed, 17 Jul 2013 20:16:37 +0000"  >&lt;p&gt;Left some comments on Phabricator. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; could you please take a look.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Vikram.&lt;/p&gt;</comment>
                            <comment id="13711561" author="phabricator@reviews.facebook.net" created="Wed, 17 Jul 2013 20:16:47 +0000"  >&lt;p&gt;vikram has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4502&quot; title=&quot;NPE - subquery smb joins fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4502&quot;&gt;&lt;del&gt;HIVE-4502&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; NPE - subquery smb joins fails&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java:72 You could have a hashmap from task to seenOp in the GenMRProCtx that maps a task to its corresponding operator(s). Map&amp;lt;Task, List&amp;lt;Operator&amp;lt;?&amp;gt;&amp;gt;&amp;gt; should do the trick. This should address Ashutosh&apos;s concern.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10695&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10695&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4502&quot; title=&quot;NPE - subquery smb joins fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4502&quot;&gt;&lt;del&gt;HIVE-4502&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, navis&lt;br/&gt;
Cc: brock, vikram&lt;/p&gt;</comment>
                            <comment id="13711935" author="navis" created="Thu, 18 Jul 2013 02:01:49 +0000"  >&lt;p&gt;Addressing comments&lt;/p&gt;</comment>
                            <comment id="13712016" author="phabricator@reviews.facebook.net" created="Thu, 18 Jul 2013 05:06:47 +0000"  >&lt;p&gt;navis has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4502&quot; title=&quot;NPE - subquery smb joins fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4502&quot;&gt;&lt;del&gt;HIVE-4502&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; NPE - subquery smb joins fails&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/QueryPlan.java:619 Ah sorry. This was throwing NPE when debugging.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java:72 Ok, sure.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink1.java:70 I think it&apos;s not possible to have 2 or more children for RS, but might be possible for Tez. I&apos;ll do that.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:261 ok&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:281 No. Will be changed to package local.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:310 MapRedTask in fact. If any of MapRedTask need BucketizedInputFormat, use BucketizedInputFormat. It&apos;s fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4502?focusedCommentId=13679262&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13679262&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-4502?focusedCommentId=13679262&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13679262&lt;/a&gt;&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:851 ok.&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:942 done&lt;br/&gt;
  ql/src/test/results/clientpositive/auto_smb_mapjoin_14.q.out:165 If Task-A is merged into Task-B, task-A will not be visible anywhere. I&apos;ve changed not to walk further when all parents are not walked, which changed stage-ids in result.&lt;/p&gt;

&lt;p&gt;  TS1  TS2&lt;br/&gt;
      SMB&lt;br/&gt;
       RS&lt;br/&gt;
      GBY&lt;br/&gt;
       RS&lt;br/&gt;
      GBY&lt;br/&gt;
       FS&lt;/p&gt;

&lt;p&gt;  before :&lt;br/&gt;
  TS1(stage-1)-SMB-RS-GBY&lt;span class=&quot;error&quot;&gt;&amp;#91;split&amp;#93;&lt;/span&gt;RS(stage-2)-GBY-FS&lt;br/&gt;
  TS2(stage-3)-SMB&lt;span class=&quot;error&quot;&gt;&amp;#91;merge into stage-1&amp;#93;&lt;/span&gt;-RS-GBY-RS-GBY-RS-FS&lt;/p&gt;

&lt;p&gt;  after :&lt;br/&gt;
  TS1(stage-1)-SMB&lt;br/&gt;
  TS2(stage-2)-SMB&lt;span class=&quot;error&quot;&gt;&amp;#91;merged into stage-1&amp;#93;&lt;/span&gt;-RS-GBY&lt;span class=&quot;error&quot;&gt;&amp;#91;split&amp;#93;&lt;/span&gt;RS(stage-3)-GBY-FS&lt;/p&gt;

&lt;p&gt;  I&apos;ll make a issue for rearranging Stage-IDs. (and order of explain output, too)&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinFactory.java:228 It&apos;s just a refactoring. setupBucketMapJoinInfo() was called both in initMapJoinPlan() and joinMapJoinPlan().&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:318 ok&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java:949 It&apos;s called in join-checked block.&lt;br/&gt;
  if (reducer.getClass() == JoinOperator.class) &lt;/p&gt;
{
    ....
    cplan.setNeedsTagging(true);
  }

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10695&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10695&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4502&quot; title=&quot;NPE - subquery smb joins fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4502&quot;&gt;&lt;del&gt;HIVE-4502&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, navis&lt;br/&gt;
Cc: brock, vikram&lt;/p&gt;</comment>
                            <comment id="13712017" author="phabricator@reviews.facebook.net" created="Thu, 18 Jul 2013 05:08:47 +0000"  >&lt;p&gt;navis updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4502&quot; title=&quot;NPE - subquery smb joins fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4502&quot;&gt;&lt;del&gt;HIVE-4502&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; NPE - subquery smb joins fails&quot;.&lt;/p&gt;

&lt;p&gt;  Addressed comments&lt;/p&gt;

&lt;p&gt;Reviewers: ashutoshc, JIRA&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10695&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10695&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CHANGE SINCE LAST DIFF&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10695?vs=35697&amp;amp;id=35865#toc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10695?vs=35697&amp;amp;id=35865#toc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Task.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/lib/DefaultGraphWalker.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMROperator.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRProcContext.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink2.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink3.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRUnion1.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinFactory.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/optimizer/MapJoinProcessor.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/GenMapRedWalker.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/parse/MapReduceCompiler.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/plan/MapredWork.java&lt;br/&gt;
  ql/src/test/queries/clientpositive/auto_sortmerge_join_6.q&lt;br/&gt;
  ql/src/test/queries/clientpositive/smb_mapjoin_25.q&lt;br/&gt;
  ql/src/test/results/clientpositive/auto_smb_mapjoin_14.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/auto_sortmerge_join_6.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/auto_sortmerge_join_9.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin1.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin3.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin_negative.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketmapjoin_negative2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_2.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_4.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_5.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_6.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_7.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/bucketsortoptimize_insert_8.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/mapjoin_distinct.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin9.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin_11.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin_12.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin_14.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin_25.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/smb_mapjoin_6.q.out&lt;br/&gt;
  ql/src/test/results/clientpositive/stats11.q.out&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, navis&lt;br/&gt;
Cc: brock, vikram&lt;/p&gt;</comment>
                            <comment id="13714573" author="phabricator@reviews.facebook.net" created="Sat, 20 Jul 2013 23:52:48 +0000"  >&lt;p&gt;ashutoshc has accepted the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4502&quot; title=&quot;NPE - subquery smb joins fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4502&quot;&gt;&lt;del&gt;HIVE-4502&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; NPE - subquery smb joins fails&quot;.&lt;/p&gt;

&lt;p&gt;  +1&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D10695&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D10695&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4502&quot; title=&quot;NPE - subquery smb joins fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4502&quot;&gt;&lt;del&gt;HIVE-4502&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ARCANIST PROJECT&lt;br/&gt;
  hive&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, navis&lt;br/&gt;
Cc: brock, vikram&lt;/p&gt;</comment>
                            <comment id="13714575" author="ashutoshc" created="Sun, 21 Jul 2013 00:05:00 +0000"  >&lt;p&gt;Canceling patch to trigger pre-commit test.&lt;/p&gt;</comment>
                            <comment id="13714576" author="ashutoshc" created="Sun, 21 Jul 2013 00:06:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; I rebased your patch on trunk. Attaching here for reference.&lt;/p&gt;</comment>
                            <comment id="13714652" author="hiveqa" created="Sun, 21 Jul 2013 06:24:58 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12593370/HIVE-4502.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12593370/HIVE-4502.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 2 failed/errored test(s), 2647 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_correlationoptimizer6
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_correlationoptimizer3
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/117/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/117/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/117/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/117/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.CleanupPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests failed with: TestsFailedException: 2 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13714656" author="yhuai" created="Sun, 21 Jul 2013 07:08:02 +0000"  >&lt;p&gt;I will take a look at these two failed tests.&lt;/p&gt;</comment>
                            <comment id="13714762" author="yhuai" created="Sun, 21 Jul 2013 18:07:14 +0000"  >&lt;p&gt;The failed query in correlationoptimizer3.q is ...&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;set&lt;/span&gt; hive.&lt;span class=&quot;code-keyword&quot;&gt;optimize&lt;/span&gt;.correlation=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
&lt;span class=&quot;code-keyword&quot;&gt;set&lt;/span&gt; hive.auto.&lt;span class=&quot;code-keyword&quot;&gt;convert&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;join&lt;/span&gt;=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
&lt;span class=&quot;code-keyword&quot;&gt;set&lt;/span&gt; hive.&lt;span class=&quot;code-keyword&quot;&gt;optimize&lt;/span&gt;.mapjoin.mapreduce=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;

&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; d.&lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt;, d.cnt &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; cnt, b.&lt;span class=&quot;code-keyword&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;value&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; x.&lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt;, x.&lt;span class=&quot;code-keyword&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; src1 x &lt;span class=&quot;code-keyword&quot;&gt;JOIN&lt;/span&gt; src y &lt;span class=&quot;code-keyword&quot;&gt;ON&lt;/span&gt; (x.&lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt; = y.&lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt;)) b
&lt;span class=&quot;code-keyword&quot;&gt;JOIN&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; x.&lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;count&lt;/span&gt;(1) &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; cnt &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; src1 x &lt;span class=&quot;code-keyword&quot;&gt;JOIN&lt;/span&gt; src y &lt;span class=&quot;code-keyword&quot;&gt;ON&lt;/span&gt; (x.&lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt; = y.&lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;by&lt;/span&gt; x.&lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt;) d
&lt;span class=&quot;code-keyword&quot;&gt;ON&lt;/span&gt; (b.&lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt; = d.&lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and here is the stack trace ...&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2013-07-21 10:14:04,440 INFO  lazybinary.LazyBinaryStruct (LazyBinaryStruct.java:parse(172)) - Missing fields! Expected 1 fields but only got 0! Ignoring similar problems.
2013-07-21 10:14:04,444 FATAL ExecReducer (ExecReducer.java:reduce(269)) - org.apache.hadoop.hive.ql.metadata.HiveException: Hive &lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt; Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; processing row (tag=0) {&lt;span class=&quot;code-quote&quot;&gt;&quot;key&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;joinkey0&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;128&quot;&lt;/span&gt;},&lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;_col1&quot;&lt;/span&gt;:&quot;&quot;}}
	at org.apache.hadoop.hive.ql.exec.mr.ExecReducer.reduce(ExecReducer.java:258)
	at org.apache.hadoop.mapred.ReduceTask.runOldReducer(ReduceTask.java:520)
	at org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:421)
	at org.apache.hadoop.mapred.LocalJobRunner$Job.run(LocalJobRunner.java:262)
Caused by: java.lang.ArrayIndexOutOfBoundsException
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.arraycopy(Native Method)
	at org.apache.hadoop.io.Text.set(Text.java:205)
	at org.apache.hadoop.hive.serde2.lazybinary.LazyBinaryString.init(LazyBinaryString.java:48)
	at org.apache.hadoop.hive.serde2.lazybinary.LazyBinaryStruct.uncheckedGetField(LazyBinaryStruct.java:216)
	at org.apache.hadoop.hive.serde2.lazybinary.LazyBinaryStruct.getField(LazyBinaryStruct.java:197)
	at org.apache.hadoop.hive.serde2.lazybinary.objectinspector.LazyBinaryStructObjectInspector.getStructFieldData(LazyBinaryStructObjectInspector.java:61)
	at org.apache.hadoop.hive.serde2.SerDeUtils.buildJSONString(SerDeUtils.java:371)
	at org.apache.hadoop.hive.serde2.SerDeUtils.buildJSONString(SerDeUtils.java:371)
	at org.apache.hadoop.hive.serde2.SerDeUtils.getJSONString(SerDeUtils.java:236)
	at org.apache.hadoop.hive.serde2.SerDeUtils.getJSONString(SerDeUtils.java:222)
	at org.apache.hadoop.hive.ql.exec.MuxOperator.processOp(MuxOperator.java:249)
	at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:504)
	at org.apache.hadoop.hive.ql.exec.DemuxOperator.processOp(DemuxOperator.java:245)
	at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:504)
	at org.apache.hadoop.hive.ql.exec.mr.ExecReducer.reduce(ExecReducer.java:249)
	... 3 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;At here, DemuxOperator only replaces the tag (the tag seems correct at here) and forward the row to MuxOperator. Then, MuxOperator will just forward the row to the JoinOperator. Seems we cannot get the value in this case... Still looking for the root cause... Seems related to MapJoin because the query with hive.optimize.correlation=true and hive.auto.convert.join=false is fine.&lt;/p&gt;</comment>
                            <comment id="13714791" author="yhuai" created="Sun, 21 Jul 2013 19:55:14 +0000"  >&lt;p&gt;Problem found. It&apos;s because in &apos;splitTasks&apos; the new patch (uploaded at 20/Jul/13 17:06) did not set needsTagging for the MR job which has DemuxOperator. Will upload a incremental patch later.&lt;/p&gt;</comment>
                            <comment id="13714800" author="yhuai" created="Sun, 21 Jul 2013 20:42:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4502&quot; title=&quot;NPE - subquery smb joins fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4502&quot;&gt;&lt;del&gt;HIVE-4502&lt;/del&gt;&lt;/a&gt;.incremental.patch has extra changes I made based on &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4502&quot; title=&quot;NPE - subquery smb joins fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4502&quot;&gt;&lt;del&gt;HIVE-4502&lt;/del&gt;&lt;/a&gt;.patch (uploaded at 20/Jul/13 17:06). Since in GenMapRedUtils there are three places that we need to check if we need to need to do tagging, I add a utility method to check the class of the reducer. We will set needsTagging when the reducer is JoinOperator or DemuxOperator. Also, some small updates are needed for test results of those queries related to Correlation Optimizer. Those updates just replace &apos;#### A masked pattern was here ####&apos; with &apos;$INTNAME&apos;.&lt;/p&gt;</comment>
                            <comment id="13714802" author="yhuai" created="Sun, 21 Jul 2013 20:46:57 +0000"  >&lt;p&gt;I merged my incremental patch with Ashutosh&apos;s patch. Attaching it (&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4502&quot; title=&quot;NPE - subquery smb joins fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4502&quot;&gt;&lt;del&gt;HIVE-4502&lt;/del&gt;&lt;/a&gt;.1.patch) at here as a reference.&lt;/p&gt;</comment>
                            <comment id="13714876" author="hiveqa" created="Mon, 22 Jul 2013 03:09:59 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12593432/HIVE-4502.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12593432/HIVE-4502.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 2647 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/122/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/122/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/122/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/122/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.CleanupPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13715773" author="ashutoshc" created="Mon, 22 Jul 2013 22:17:57 +0000"  >&lt;p&gt;+1 Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yhuai&quot; class=&quot;user-hover&quot; rel=&quot;yhuai&quot;&gt;yhuai&lt;/a&gt; for taking a look.&lt;/p&gt;</comment>
                            <comment id="13715936" author="ashutoshc" created="Tue, 23 Jul 2013 00:53:23 +0000"  >&lt;p&gt;Committed to trunk. Thanks, Navis for the fix! Thanks, Vikram for review and testcases. Thanks, Yin for fixing failing test cases.&lt;/p&gt;</comment>
                            <comment id="13795904" author="ashutoshc" created="Tue, 15 Oct 2013 23:29:30 +0000"  >&lt;p&gt;This issue has been fixed and released as part of 0.12 release. If you find further issues, please create a new jira and link it to this one.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12650797">HIVE-4650</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12593432" name="HIVE-4502.1.patch" size="136314" author="yhuai" created="Sun, 21 Jul 2013 20:46:57 +0000"/>
                            <attachment id="12582449" name="HIVE-4502.D10695.1.patch" size="98851" author="phabricator@reviews.facebook.net" created="Thu, 9 May 2013 11:33:15 +0000"/>
                            <attachment id="12587021" name="HIVE-4502.D10695.2.patch" size="117284" author="phabricator@reviews.facebook.net" created="Mon, 10 Jun 2013 04:52:20 +0000"/>
                            <attachment id="12592133" name="HIVE-4502.D10695.3.patch" size="117808" author="phabricator@reviews.facebook.net" created="Sat, 13 Jul 2013 08:49:46 +0000"/>
                            <attachment id="12592916" name="HIVE-4502.D10695.4.patch" size="124619" author="phabricator@reviews.facebook.net" created="Thu, 18 Jul 2013 05:08:47 +0000"/>
                            <attachment id="12593431" name="HIVE-4502.incremental.patch" size="5622" author="yhuai" created="Sun, 21 Jul 2013 20:36:15 +0000"/>
                            <attachment id="12593370" name="HIVE-4502.patch" size="126467" author="ashutoshc" created="Sun, 21 Jul 2013 00:06:38 +0000"/>
                            <attachment id="12586024" name="smb_mapjoin_25.q" size="6437" author="vikram.dixit" created="Tue, 4 Jun 2013 02:07:31 +0000"/>
                            <attachment id="12581848" name="smb_mapjoin_25.q" size="2463" author="vikram.dixit" created="Mon, 6 May 2013 05:49:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>326515</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 6 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1kbwf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>326860</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>