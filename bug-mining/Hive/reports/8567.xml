<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:24:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-27649] Support ORDER BY clause in subqueries with set operators</title>
                <link>https://issues.apache.org/jira/browse/HIVE-27649</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Consider the following query:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
select key from ((select key from src order by key) union (select key from src))subq &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Up until 3.1.2, Hive would parse this query without any problems. However, if you try it on the latest versions, you&apos;ll get the following exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.hadoop.hive.ql.parse.ParseException: line 1:60 cannot recognize input near &lt;span class=&quot;code-quote&quot;&gt;&apos;union&apos;&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;(&apos;&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;select&apos;&lt;/span&gt; in subquery source
&#160; &#160; &#160; &#160; at org.apache.hadoop.hive.ql.parse.ParseDriver.parse(ParseDriver.java:125)
&#160; &#160; &#160; &#160; at org.apache.hadoop.hive.ql.parse.ParseDriver.parse(ParseDriver.java:97) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;With the inner exception stack trace being:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
NoViableAltException(367@[])
&#160; &#160; at org.apache.hadoop.hive.ql.parse.HiveParser_IdentifiersParser.identifier(HiveParser_IdentifiersParser.java:14006)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.HiveParser.identifier(HiveParser.java:45086)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.HiveParser_FromClauseParser.subQuerySource(HiveParser_FromClauseParser.java:5411)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.HiveParser_FromClauseParser.atomjoinSource(HiveParser_FromClauseParser.java:1921)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.HiveParser_FromClauseParser.joinSource(HiveParser_FromClauseParser.java:2175)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.HiveParser_FromClauseParser.atomjoinSource(HiveParser_FromClauseParser.java:2110)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.HiveParser_FromClauseParser.joinSource(HiveParser_FromClauseParser.java:2175)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.HiveParser_FromClauseParser.fromSource(HiveParser_FromClauseParser.java:1750)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.HiveParser_FromClauseParser.fromClause(HiveParser_FromClauseParser.java:1593)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.HiveParser.fromClause(HiveParser.java:45094)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.HiveParser.atomSelectStatement(HiveParser.java:38538)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.HiveParser.selectStatement(HiveParser.java:38831)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.HiveParser.regularBody(HiveParser.java:38424)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.HiveParser.queryStatementExpressionBody(HiveParser.java:37686)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.HiveParser.queryStatementExpression(HiveParser.java:37574)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.HiveParser.execStatement(HiveParser.java:2757)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.HiveParser.explainStatement(HiveParser.java:1751)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.HiveParser.statement(HiveParser.java:1614)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.ParseDriver.parse(ParseDriver.java:123)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.ParseDriver.parse(ParseDriver.java:97) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Note that this behavior also happens if the subquery contains a SORT BY, CLUSTER BY, DISTRIBUTE BY or LIMIT clause.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13548552">HIVE-27649</key>
            <summary>Support ORDER BY clause in subqueries with set operators</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nicolasrichard">Nicolas Richard</assignee>
                                    <reporter username="nicolasrichard">Nicolas Richard</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 24 Aug 2023 18:40:43 +0000</created>
                <updated>Fri, 29 Mar 2024 17:49:44 +0000</updated>
                            <resolved>Fri, 29 Sep 2023 15:50:55 +0000</resolved>
                                    <version>3.1.2</version>
                    <version>4.0.0</version>
                                    <fixVersion>4.0.0</fixVersion>
                                    <component>Parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17758701" author="JIRAUSER298135" created="Thu, 24 Aug 2023 18:54:49 +0000"  >&lt;p&gt;I did some investigation to figure out what was going on. In &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-21980&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-21980&lt;/a&gt;, the grammar &lt;a href=&quot;https://github.com/apache/hive/commit/0f39030c3d33b11ae9c14ac81e047b44e8695371&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;changed a bit&lt;/a&gt; from:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
atomjoinSource
@init { gParent.pushMsg(&lt;span class=&quot;code-quote&quot;&gt;&quot;joinSource&quot;&lt;/span&gt;, state); }
@after { gParent.popMsg(state); }
&#160; &#160; :  tableSource (lateralView^)*
&#160; &#160; |  virtualTableSource (lateralView^)*
&#160; &#160; |  (subQuerySource) =&amp;gt; subQuerySource (lateralView^)*
&#160; &#160; |  partitionedTableFunction (lateralView^)*
&#160; &#160; |  LPAREN! joinSource RPAREN!
    ;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
atomjoinSource
@init { gParent.pushMsg(&lt;span class=&quot;code-quote&quot;&gt;&quot;joinSource&quot;&lt;/span&gt;, state); }
@after { gParent.popMsg(state); }
&#160; &#160; : &#160;tableSource (lateralView^)*
&#160; &#160; | &#160;virtualTableSource (lateralView^)*
&#160; &#160; | &#160;(LPAREN (KW_WITH|KW_SELECT|KW_MAP|KW_REDUCE|KW_FROM)) =&amp;gt; subQuerySource (lateralView^)*
&#160; &#160; | &#160;(LPAREN LPAREN atomSelectStatement RPAREN setOperator ) =&amp;gt; subQuerySource (lateralView^)*
&#160; &#160; | &#160;partitionedTableFunction (lateralView^)*
&#160; &#160; | &#160;LPAREN! joinSource RPAREN! 
    ;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When the query is parsed, we end up in the subQuerySource rule because atomSelectStatement, by definition, cannot contain SORT BY, CLUSTER BY, DISTRIBUTE BY or LIMIT clauses. An exception is thrown because subQuerySource requires an identifier which is not present nor needed in this particular scenario.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I tested it locally and changing &lt;em&gt;atomSelectStatement&lt;/em&gt; to &lt;em&gt;selectStatement&lt;/em&gt; solves the issue. However, I still need to validate that it does not have side-effects by running the whole test suite.&lt;/p&gt;</comment>
                            <comment id="17758705" author="JIRAUSER298135" created="Thu, 24 Aug 2023 18:57:49 +0000"  >&lt;p&gt;Proposed fix: &lt;a href=&quot;https://github.com/apache/hive/pull/4628&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/pull/4628&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17770488" author="ayushtkn" created="Fri, 29 Sep 2023 15:50:49 +0000"  >&lt;p&gt;Committed to master.&lt;/p&gt;

&lt;p&gt;Thanx &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nicolasrichard&quot; class=&quot;user-hover&quot; rel=&quot;nicolasrichard&quot;&gt;nicolasrichard&lt;/a&gt; for the contribution!!!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13244039">HIVE-21980</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 6 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1jztk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>