<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:00:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-2758] Metastore is caching too aggressively</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2758</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The metastore is caching values, like table names and locations too aggressively, leading to inconsistencies across Hive clients and metastore Thrift servers.&lt;/p&gt;

&lt;p&gt;For example, open two Hive clients, in each call&lt;br/&gt;
DESCRIBE FORMATTED table_foo;&lt;/p&gt;

&lt;p&gt;Then in one of those clients, execute&lt;br/&gt;
ALTER TABLE table_foo RENAME TO table_bar;&lt;/p&gt;

&lt;p&gt;Then in both clients call&lt;br/&gt;
DESCRIBE FORMATTED table_bar;&lt;/p&gt;

&lt;p&gt;In the client that executed the alter command, the location is correct, however, in the other Hive client, it will still show the original location of table_foo.&lt;/p&gt;

&lt;p&gt;A similar experiment can be done using metastore Thrift servers, substituting get_table for DESCRIBE FORMATTED and alter_table for ALTER TABLE ... RENAME TO.&lt;/p&gt;

&lt;p&gt;On the Thrift server you can see that the one which did not execute the alter command, not only returns the wrong location, despite calling get_table(&apos;table_bar&apos;) it will return a table that still has the name table_foo.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12540176">HIVE-2758</key>
            <summary>Metastore is caching too aggressively</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kevinwilfong">Kevin Wilfong</assignee>
                                    <reporter username="kevinwilfong">Kevin Wilfong</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Jan 2012 18:43:15 +0000</created>
                <updated>Fri, 31 Oct 2014 12:28:07 +0000</updated>
                            <resolved>Wed, 1 Feb 2012 17:50:27 +0000</resolved>
                                                    <fixVersion>0.9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13195005" author="phabricator@reviews.facebook.net" created="Fri, 27 Jan 2012 18:50:09 +0000"  >&lt;p&gt;kevinwilfong requested code review of &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2758&quot; title=&quot;Metastore is caching too aggressively&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2758&quot;&gt;&lt;del&gt;HIVE-2758&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Metastore is caching too aggressively&quot;.&lt;br/&gt;
Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2758&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2758&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  In order to prevent inconsistencies between Hive clients and Hive metastores due to over-aggressive caching, I turned off level 2 caching in datanucleus.  I tried adjusting it to weak caching first, but that did not fix the issue.  I think level 1 caching is the most caching we can have without seeing these issues.&lt;/p&gt;

&lt;p&gt;  The metastore is caching values, like table names and locations too aggressively, leading to inconsistencies across Hive clients and metastore Thrift servers.&lt;/p&gt;

&lt;p&gt;  For example, open two Hive clients, in each call&lt;br/&gt;
  DESCRIBE FORMATTED table_foo;&lt;/p&gt;

&lt;p&gt;  Then in one of those clients, execute&lt;br/&gt;
  ALTER TABLE table_foo RENAME TO table_bar;&lt;/p&gt;

&lt;p&gt;  Then in both clients call&lt;br/&gt;
  DESCRIBE FORMATTED table_bar;&lt;/p&gt;

&lt;p&gt;  In the client that executed the alter command, the location is correct, however, in the other Hive client, it will still show the original location of table_foo.&lt;/p&gt;

&lt;p&gt;  A similar experiment can be done using metastore Thrift servers, substituting get_table for DESCRIBE FORMATTED and alter_table for ALTER TABLE ... RENAME TO.&lt;/p&gt;

&lt;p&gt;  On the Thrift server you can see that the one which did not execute the alter command, not only returns the wrong location, despite calling get_table(&apos;table_bar&apos;) it will return a table that still has the name table_foo.&lt;/p&gt;

&lt;p&gt;TEST PLAN&lt;br/&gt;
  EMPTY&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1491&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D1491&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;/p&gt;

&lt;p&gt;MANAGE HERALD DIFFERENTIAL RULES&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/view/differential/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/herald/view/differential/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WHY DID I GET THIS EMAIL?&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/transcript/3105/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/herald/transcript/3105/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Tip: use the X-Herald-Rules header to filter Herald messages in your client.&lt;/p&gt;</comment>
                            <comment id="13195021" author="phabricator@reviews.facebook.net" created="Fri, 27 Jan 2012 19:04:11 +0000"  >&lt;p&gt;cwsteinbach has requested changes to the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2758&quot; title=&quot;Metastore is caching too aggressively&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2758&quot;&gt;&lt;del&gt;HIVE-2758&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Metastore is caching too aggressively&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java:276 It would be good to have test coverage for this. Can you please add a testcase?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1491&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D1491&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13197037" author="phabricator@reviews.facebook.net" created="Tue, 31 Jan 2012 17:52:10 +0000"  >&lt;p&gt;kevinwilfong updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2758&quot; title=&quot;Metastore is caching too aggressively&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2758&quot;&gt;&lt;del&gt;HIVE-2758&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Metastore is caching too aggressively&quot;.&lt;br/&gt;
Reviewers: JIRA, njain, heyongqiang, cwsteinbach&lt;/p&gt;

&lt;p&gt;  Added a unit test to the metastore tests.  It creates a table using the current HiveMetaStoreClient, then simulates another client renaming the table by changing the value in the db.  It then attempts to get the table again using the new name and verifying the name of the table is correct.  This test is used for both the metastore Thrift server and an embedded metastore.&lt;/p&gt;

&lt;p&gt;  Using the current configuration, it fails with the exception&lt;br/&gt;
  &quot;Client returned table with different name after rename. expected:&amp;lt;[]concurrenttbl&amp;gt; but was:&amp;lt;&lt;span class=&quot;error&quot;&gt;&amp;#91;rename_&amp;#93;&lt;/span&gt;concurrenttbl&amp;gt;&quot;&lt;br/&gt;
  Indicating that the client can retrieve the table with the new name, but when it checks the name stored in the Table object, it is still the old name.&lt;br/&gt;
  Using the update in this patch, however, it succeeds.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1491&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D1491&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  metastore/src/test/org/apache/hadoop/hive/metastore/TestHiveMetaStore.java&lt;br/&gt;
  common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;/p&gt;</comment>
                            <comment id="13197141" author="phabricator@reviews.facebook.net" created="Tue, 31 Jan 2012 19:30:08 +0000"  >&lt;p&gt;cwsteinbach has accepted the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2758&quot; title=&quot;Metastore is caching too aggressively&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2758&quot;&gt;&lt;del&gt;HIVE-2758&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Metastore is caching too aggressively&quot;.&lt;/p&gt;

&lt;p&gt;  +1. Kevin, can you handle testing and committing this change?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1491&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D1491&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13197997" author="phabricator@reviews.facebook.net" created="Wed, 1 Feb 2012 17:54:58 +0000"  >&lt;p&gt;kevinwilfong has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2758&quot; title=&quot;Metastore is caching too aggressively&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2758&quot;&gt;&lt;del&gt;HIVE-2758&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Metastore is caching too aggressively&quot;.&lt;/p&gt;

&lt;p&gt;  Thanks, Carl.  I got it.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1491&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D1491&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13198384" author="hudson" created="Thu, 2 Feb 2012 00:39:01 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #1238 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/1238/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/1238/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2758&quot; title=&quot;Metastore is caching too aggressively&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2758&quot;&gt;&lt;del&gt;HIVE-2758&lt;/del&gt;&lt;/a&gt; Metastore is caching too aggressively (Kevin Wilfong reviewed by Carl Steinbach)&lt;/p&gt;

&lt;p&gt;kevinwilfong : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1239232&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1239232&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestHiveMetaStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13265257" author="ashutoshc" created="Mon, 30 Apr 2012 21:11:21 +0000"  >&lt;p&gt;This issue is closed now. It was released with the fix in 0.9.0. If there is a problem, please open a new jira and link this one with that.&lt;/p&gt;</comment>
                            <comment id="13548287" author="hudson" created="Wed, 9 Jan 2013 10:25:08 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #54 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2758&quot; title=&quot;Metastore is caching too aggressively&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2758&quot;&gt;&lt;del&gt;HIVE-2758&lt;/del&gt;&lt;/a&gt; Metastore is caching too aggressively (Kevin Wilfong reviewed by Carl Steinbach) (Revision 1239232)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
kevinwilfong : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1239232&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1239232&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/metastore/src/test/org/apache/hadoop/hive/metastore/TestHiveMetaStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12751958">HIVE-8684</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12512212" name="ASF.LICENSE.NOT.GRANTED--HIVE-2758.D1491.1.patch" size="934" author="phabricator@reviews.facebook.net" created="Fri, 27 Jan 2012 18:50:09 +0000"/>
                            <attachment id="12512595" name="ASF.LICENSE.NOT.GRANTED--HIVE-2758.D1491.2.patch" size="5900" author="phabricator@reviews.facebook.net" created="Tue, 31 Jan 2012 17:52:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>225591</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 46 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0llfr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>124123</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>