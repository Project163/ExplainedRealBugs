<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:36:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-10880] The bucket number is not respected in insert overwrite.</title>
                <link>https://issues.apache.org/jira/browse/HIVE-10880</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;When hive.enforce.bucketing is true, the bucket number defined in the table is no longer respected in current master and 1.2. &lt;br/&gt;
Reproduce:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;IF&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;EXISTS&lt;/span&gt; buckettestinput( 
&lt;span class=&quot;code-keyword&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;string&lt;/span&gt; 
) 
&lt;span class=&quot;code-keyword&quot;&gt;ROW&lt;/span&gt; FORMAT DELIMITED &lt;span class=&quot;code-keyword&quot;&gt;FIELDS&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TERMINATED&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;;

&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;IF&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;EXISTS&lt;/span&gt; buckettestoutput1( 
&lt;span class=&quot;code-keyword&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;string&lt;/span&gt; 
)&lt;span class=&quot;code-keyword&quot;&gt;CLUSTERED&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;data&lt;/span&gt;) 
&lt;span class=&quot;code-keyword&quot;&gt;INTO&lt;/span&gt; 2 BUCKETS 
&lt;span class=&quot;code-keyword&quot;&gt;ROW&lt;/span&gt; FORMAT DELIMITED &lt;span class=&quot;code-keyword&quot;&gt;FIELDS&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TERMINATED&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;;

&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;IF&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;EXISTS&lt;/span&gt; buckettestoutput2( 
&lt;span class=&quot;code-keyword&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;string&lt;/span&gt; 
)&lt;span class=&quot;code-keyword&quot;&gt;CLUSTERED&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;data&lt;/span&gt;) 
&lt;span class=&quot;code-keyword&quot;&gt;INTO&lt;/span&gt; 2 BUCKETS 
&lt;span class=&quot;code-keyword&quot;&gt;ROW&lt;/span&gt; FORMAT DELIMITED &lt;span class=&quot;code-keyword&quot;&gt;FIELDS&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TERMINATED&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then I inserted the following data into the &quot;buckettestinput&quot; table:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;firstinsert1 
firstinsert2 
firstinsert3 
firstinsert4 
firstinsert5 
firstinsert6 
firstinsert7 
firstinsert8 
secondinsert1 
secondinsert2 
secondinsert3 
secondinsert4 
secondinsert5 
secondinsert6 
secondinsert7 
secondinsert8
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;set&lt;/span&gt; hive.enforce.bucketing = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; 
&lt;span class=&quot;code-keyword&quot;&gt;set&lt;/span&gt; hive.enforce.sorting=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
&lt;span class=&quot;code-keyword&quot;&gt;insert&lt;/span&gt; overwrite &lt;span class=&quot;code-keyword&quot;&gt;table&lt;/span&gt; buckettestoutput1 
&lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; * &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; buckettestinput &lt;span class=&quot;code-keyword&quot;&gt;where&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;like&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;first&lt;/span&gt;%&apos;&lt;/span&gt;;
&lt;span class=&quot;code-keyword&quot;&gt;set&lt;/span&gt; hive.auto.&lt;span class=&quot;code-keyword&quot;&gt;convert&lt;/span&gt;.sortmerge.&lt;span class=&quot;code-keyword&quot;&gt;join&lt;/span&gt;=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; 
&lt;span class=&quot;code-keyword&quot;&gt;set&lt;/span&gt; hive.&lt;span class=&quot;code-keyword&quot;&gt;optimize&lt;/span&gt;.bucketmapjoin = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; 
&lt;span class=&quot;code-keyword&quot;&gt;set&lt;/span&gt; hive.&lt;span class=&quot;code-keyword&quot;&gt;optimize&lt;/span&gt;.bucketmapjoin.sortedmerge = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; 
&lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; * &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; buckettestoutput1 &lt;span class=&quot;code-keyword&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;join&lt;/span&gt; buckettestoutput2 b &lt;span class=&quot;code-keyword&quot;&gt;on&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;a&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;data&lt;/span&gt;=b.&lt;span class=&quot;code-keyword&quot;&gt;data&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Error: Error while compiling statement: FAILED: SemanticException [Error 10141]: Bucketed table metadata is not correct. Fix the metadata or don&apos;t use bucketed mapjoin, by setting hive.enforce.bucketmapjoin to false. The number of buckets for table buckettestoutput1 is 2, whereas the number of files is 1 (state=42000,code=10141)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The related debug information related to insert overwrite:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;0: jdbc:hive2://localhost:10000&amp;gt; insert overwrite table buckettestoutput1 
select * from buckettestinput where data like &apos;first%&apos;insert overwrite table buckettestoutput1 
0: jdbc:hive2://localhost:10000&amp;gt; ;
select * from buckettestinput where data like &apos; 
first%&apos;;
INFO  : Number of reduce tasks determined at compile time: 2
INFO  : In order to change the average load for a reducer (in bytes):
INFO  :   set hive.exec.reducers.bytes.per.reducer=&amp;lt;number&amp;gt;
INFO  : In order to limit the maximum number of reducers:
INFO  :   set hive.exec.reducers.max=&amp;lt;number&amp;gt;
INFO  : In order to set a constant number of reducers:
INFO  :   set mapred.reduce.tasks=&amp;lt;number&amp;gt;
INFO  : Job running in-process (local Hadoop)
INFO  : 2015-06-01 11:09:29,650 Stage-1 map = 86%,  reduce = 100%
INFO  : Ended Job = job_local107155352_0001
INFO  : Loading data to table default.buckettestoutput1 from file:/user/hive/warehouse/buckettestoutput1/.hive-staging_hive_2015-06-01_11-09-28_166_3109203968904090801-1/-ext-10000
INFO  : Table default.buckettestoutput1 stats: [numFiles=1, numRows=4, totalSize=52, rawDataSize=48]
No rows affected (1.692 seconds)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Insert use dynamic partition does not have the issue. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12834265">HIVE-10880</key>
            <summary>The bucket number is not respected in insert overwrite.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ychena">Yongzhi Chen</assignee>
                                    <reporter username="ychena">Yongzhi Chen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Jun 2015 15:24:59 +0000</created>
                <updated>Tue, 16 Feb 2016 23:50:02 +0000</updated>
                            <resolved>Fri, 7 Aug 2015 13:20:36 +0000</resolved>
                                    <version>1.2.0</version>
                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14567438" author="mmokhtar" created="Mon, 1 Jun 2015 15:32:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ekoifman&quot; class=&quot;user-hover&quot; rel=&quot;ekoifman&quot;&gt;ekoifman&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14569750" author="ychena" created="Tue, 2 Jun 2015 20:56:59 +0000"  >&lt;p&gt;The insert overwrite problem happens for table insert or static partition insert, it works fine for dynamic partition insert. So make the code change similar to what is in dynamic partition. &lt;/p&gt;</comment>
                            <comment id="14569753" author="ychena" created="Tue, 2 Jun 2015 20:57:58 +0000"  >&lt;p&gt;Need code review.&lt;/p&gt;</comment>
                            <comment id="14570078" author="hiveqa" created="Wed, 3 Jun 2015 01:02:11 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12737007/HIVE-10880.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12737007/HIVE-10880.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 20 failed/errored test(s), 8991 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_authorization_delete
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_authorization_delete_own_table
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_authorization_update
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_authorization_update_own_table
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketsortoptimize_insert_2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketsortoptimize_insert_6
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketsortoptimize_insert_7
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_bucketsortoptimize_insert_8
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_delete_where_no_match
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby_sort_1_23
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_groupby_sort_skew_1_23
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_udaf_histogram_numeric
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_update_where_no_match
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_bucket5
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_delete_where_no_match
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_update_where_no_match
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_ql_rewrite_gbtoidx_cbo_2
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_groupby_sort_1_23
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_groupby_sort_skew_1_23
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_join_nullsafe
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4147/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4147/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4147/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4147/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4147/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4147/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 20 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12737007 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14571767" author="ychena" created="Wed, 3 Jun 2015 22:30:48 +0000"  >&lt;p&gt;Attach second patch to fix the test failures. &lt;/p&gt;</comment>
                            <comment id="14572076" author="hiveqa" created="Thu, 4 Jun 2015 04:01:47 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12737388/HIVE-10880.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12737388/HIVE-10880.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 8993 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_autogen_colalias
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_udf_nondeterministic
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_ql_rewrite_gbtoidx_cbo_2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4164/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4164/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4164/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4164/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4164/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4164/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12737388 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14572658" author="ychena" created="Thu, 4 Jun 2015 12:13:07 +0000"  >&lt;p&gt;All these failures are not related, their ages are 11 or more. &lt;/p&gt;</comment>
                            <comment id="14572661" author="ychena" created="Thu, 4 Jun 2015 12:14:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=szehon&quot; class=&quot;user-hover&quot; rel=&quot;szehon&quot;&gt;szehon&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ctang.ma&quot; class=&quot;user-hover&quot; rel=&quot;ctang.ma&quot;&gt;ctang.ma&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=csun&quot; class=&quot;user-hover&quot; rel=&quot;csun&quot;&gt;csun&lt;/a&gt;, could you review the code? Thanks&lt;/p&gt;</comment>
                            <comment id="14572804" author="ychena" created="Thu, 4 Jun 2015 14:03:11 +0000"  >&lt;p&gt;The implement of method private static String replaceTaskId(String taskId, int bucketNum) looks not right. For the code is in the source for a while, I am not very confident about that. &lt;br/&gt;
Attached the patch 3 fixes that issue too. If the tests pass, should use patch3, otherwise keep patch2. &lt;/p&gt;</comment>
                            <comment id="14573423" author="hiveqa" created="Thu, 4 Jun 2015 19:22:06 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12737564/HIVE-10880.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12737564/HIVE-10880.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 4 failed/errored test(s), 8999 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_autogen_colalias
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_udf_nondeterministic
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_ql_rewrite_gbtoidx_cbo_2
org.apache.hive.jdbc.TestJdbcWithLocalClusterSpark.testTempTable
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4178/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4178/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4178/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4178/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4178/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4178/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12737564 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14574432" author="ychena" created="Fri, 5 Jun 2015 12:43:39 +0000"  >&lt;p&gt;The failures are not related. &lt;br/&gt;
Following two testes failed age more than 10. &lt;br/&gt;
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_ql_rewrite_gbtoidx_cbo_2&lt;br/&gt;
org.apache.hive.jdbc.TestJdbcWithLocalClusterSpark.testTempTable&lt;/p&gt;

&lt;p&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_autogen_colalias failed in build 4179(the build after this build) too.&lt;/p&gt;

&lt;p&gt;For the spark failure, I tested locally, all pass. And my code change only affect when hive.enforce.bucketing is true, the spark test never set this value. So it is not related. &lt;/p&gt;

&lt;p&gt;-------------------------------------------------------&lt;br/&gt;
 T E S T S&lt;br/&gt;
-------------------------------------------------------&lt;/p&gt;

&lt;p&gt;-------------------------------------------------------&lt;br/&gt;
 T E S T S&lt;br/&gt;
-------------------------------------------------------&lt;br/&gt;
Running org.apache.hive.jdbc.TestJdbcWithLocalClusterSpark&lt;br/&gt;
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 72.272 sec - in org.apache.hive.jdbc.TestJdbcWithLocalClusterSpark&lt;/p&gt;

&lt;p&gt;Results :&lt;/p&gt;

&lt;p&gt;Tests run: 5, Failures: 0, Errors: 0, Skipped: 0&lt;/p&gt;

&lt;p&gt;Could anyone review the code? Thanks&lt;/p&gt;</comment>
                            <comment id="14578293" author="xuefuz" created="Tue, 9 Jun 2015 04:29:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;ychena&lt;/a&gt;, thanks for working on this. Looking at the patch, I wasn&apos;t confident that I know the root cause of the problem and how your patch addresses it. From the problem description, I originally thought that it&apos;s a problem of setting the right number of reducers. However, your patch seems not approaching in that direction. Instead, it appears that your patch &quot;adds&quot; the missing buckets by creating empty files. I&apos;m not sure if this fixes the root cause. In general, the rows should be relatively evenly distributed in different buckets, and so missing or empty bucket files should be rare rather than normal.&lt;/p&gt;

&lt;p&gt;Could you please share your thoughts on this?&lt;/p&gt;</comment>
                            <comment id="14578871" author="ychena" created="Tue, 9 Jun 2015 13:18:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt;, when I debug the issue, I noticed that right number of reducer is used. I also noticed that dynamic partition insert works fine because it adds the missing files. I think we should treat static partition and ordinary table the same way, so I fixed the issue by adding the missing buckets. Following is the code for dynamic partition part:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        taskIDToFile = removeTempOrDuplicateFiles(items, fs);
        // if the table is bucketed and enforce bucketing, we should check and generate all buckets
        if (dpCtx.getNumBuckets() &amp;gt; 0 &amp;amp;&amp;amp; taskIDToFile != null) {
          // refresh the file list
          items = fs.listStatus(parts[i].getPath());
          // get the missing buckets and generate empty buckets
          String taskID1 = taskIDToFile.keySet().iterator().next();
          Path bucketPath = taskIDToFile.values().iterator().next().getPath();
          for (int j = 0; j &amp;lt; dpCtx.getNumBuckets(); ++j) {
            String taskID2 = replaceTaskId(taskID1, j);
            if (!taskIDToFile.containsKey(taskID2)) {
              // create empty bucket, file name should be derived from taskID2
              String path2 = replaceTaskIdFromFilename(bucketPath.toUri().getPath().toString(), j);
              result.add(path2);
            }
          }
        }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14578899" author="xuefuz" created="Tue, 9 Jun 2015 13:50:06 +0000"  >&lt;p&gt;Adding the missing files seems file for inserting into regular tables/partitions. However, I don&apos;t quite follow why in your given example all data rows will go to one bucket while the other bucket is empty. Is this expected? I&apos;m just wondering if there is something else going on.&lt;/p&gt;</comment>
                            <comment id="14579119" author="ychena" created="Tue, 9 Jun 2015 15:46:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt;, I agree with you, there are something more serious than the missing files. I think the bucket algorithm is broken. I just tried to insert overwrite from a very big table, all the data goes to one bucket too. Seems the hash map no longer working. I will try to figure out why. &lt;/p&gt;</comment>
                            <comment id="14580470" author="ychena" created="Wed, 10 Jun 2015 12:43:05 +0000"  >&lt;p&gt;It is hadoop issue. Hive uses hadoop-core-1.2.1.jar, it has a bug. I did a test, I rename a 2.6 version hadoop-core jar to hadoop-core-1.2.1.jar and run HIVE 1.2, the data distribute to all the buckets. &lt;br/&gt;
But I can not use hadoop-core 2.6 to build hive, it will make Hive Shims Common(may be more) fail. So we need lower version to support hadoop-1 (shims 0.20s) &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt;, you said that you read something regarding hadoop bug on localjob which does not respect number of reducers. Could you find the jira number? Thanks&lt;br/&gt;
For now I think my fix is a good workaround for the issue. The buckets are not balanced but they are fully functional. &lt;br/&gt;
How do you think? &lt;/p&gt;</comment>
                            <comment id="14580532" author="xuefuz" created="Wed, 10 Jun 2015 13:41:18 +0000"  >&lt;p&gt;hadoop-core.jar is for Hadoop-1. For Hadoop-2, you don&apos;t need hadoop-core.jar as far as I know. You can just build your Hive using -Phadoop-2.&lt;/p&gt;

&lt;p&gt;The above mentioned problem about the number of reducers appeared in several jiras. Unfortunately I can only find &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-6588&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-6588&lt;/a&gt;. There is one recently also about bucketing but I cannot find it any more.&lt;/p&gt;

&lt;p&gt;Anyway, I don&apos;t quite understand the problem. To make your query work with Hadoop-1, you might need to disable local execution. The fix here might be useful in case of empty bucket, but I&apos;m not sure how users have survived w/o it.&lt;/p&gt;</comment>
                            <comment id="14580759" author="ychena" created="Wed, 10 Jun 2015 16:33:25 +0000"  >&lt;p&gt;My build uses -Phadoop-2, the error is:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 3.693s
[INFO] Finished at: Tue Jun 09 17:00:24 EDT 2015
[INFO] Final Memory: 26M/310M
[INFO] ------------------------------------------------------------------------
[ERROR] Failed to execute goal on project hive-shims-common: Could not resolve dependencies for project org.apache.hive.shims:hive-shims-common:jar:1.2.0: Could not find artifact org.apache.hadoop:hadoop-core:jar:2.6.0 in datanucleus (http://www.datanucleus.org/downloads/maven2) -&amp;gt; [Help 1]
[ERROR] 
[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.
[ERROR] Re-run Maven using the -X switch to enable full debug logging.
[ERROR] 
[ERROR] For more information about the errors and possible solutions, please read the following articles:
[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/DependencyResolutionException
[ERROR] 
[ERROR] After correcting the problems, you can resume the build with the command
[ERROR]   mvn &amp;lt;goals&amp;gt; -rf :hive-shims-common

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And in run time, it does call into functions in hadoop-core.jar. All my test in hadoop-2 env. The problem is that without my fix, hive after insert overwrite bucketed table and partition in local mode, the table can not used to do bucketmapjoin.sortedmerge because of missing files (always 1 vs. bucket number).&lt;/p&gt;</comment>
                            <comment id="14652398" author="ychena" created="Mon, 3 Aug 2015 20:08:26 +0000"  >&lt;p&gt;The patch is fixing following issue:&lt;br/&gt;
In local mode and when enforce.bucketing is true, for bucket table, insert overwrite to table or static partition, bucket number is not respected. &lt;/p&gt;

&lt;p&gt;Because only dynamic partition works fine, this fix uses the same idea as how to handle the dynamic partition scenario.&lt;/p&gt;

&lt;p&gt;Attach patch 4 after rebase. &lt;/p&gt;


</comment>
                            <comment id="14653235" author="hiveqa" created="Tue, 4 Aug 2015 07:59:39 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12748527/HIVE-10880.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12748527/HIVE-10880.4.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 15 failed/errored test(s), 9320 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_convert_enum_to_string
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_dynamic_rdd_cache
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_groupby_bigdata
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_having
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_insert_into2
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_nullgroup2
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_ppd_join5
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_sample5
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_timestamp_1
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_timestamp_lazy
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_transform_ppr2
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_union_remove_11
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_union_remove_19
org.apache.hive.hcatalog.streaming.TestStreaming.testTransactionBatchCommit_Json
org.apache.hive.jdbc.TestSSL.testSSLConnectionWithProperty
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4813/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4813/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4813/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4813/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4813/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4813/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 15 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12748527 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14653693" author="ychena" created="Tue, 4 Aug 2015 14:13:38 +0000"  >&lt;p&gt;Ran the spark tests on my local machine, they passed. Re-Attach the patch. &lt;/p&gt;</comment>
                            <comment id="14654681" author="hiveqa" created="Wed, 5 Aug 2015 02:07:25 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12748670/HIVE-10880.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12748670/HIVE-10880.4.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 1 failed/errored test(s), 9323 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hive.hcatalog.streaming.TestStreaming.testTransactionBatchEmptyCommit
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4826/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4826/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4826/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/4826/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4826/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4826/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12748670 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14655152" author="ychena" created="Wed, 5 Aug 2015 10:33:04 +0000"  >&lt;p&gt;The failure is not related(it is known issue):&lt;br/&gt;
org.apache.hive.hcatalog.streaming.TestStreaming.testTransactionBatchEmptyCommit&lt;br/&gt;
Error Message&lt;br/&gt;
Table/View &apos;TXNS&apos; already exists in Schema &apos;APP&apos;.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt;, could you review the change?  Thanks&lt;/p&gt;

&lt;p&gt;The patch is fixing following issue:&lt;br/&gt;
In local mode and when enforce.bucketing is true, for bucket table, insert overwrite to table or static partition, bucket number is not respected.&lt;br/&gt;
Because only dynamic partition works fine, this fix uses the same idea as how to handle the dynamic partition scenario.&lt;/p&gt;

&lt;p&gt;It seems that &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11360&quot; title=&quot;Bucketing doesn&amp;#39;t work correctly with unpartitioned tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11360&quot;&gt;HIVE-11360&lt;/a&gt; has similar issue. &lt;/p&gt;

</comment>
                            <comment id="14658528" author="xuefuz" created="Wed, 5 Aug 2015 17:08:53 +0000"  >&lt;p&gt;Okay. I will take a look shortly.&lt;/p&gt;</comment>
                            <comment id="14659360" author="xuefuz" created="Thu, 6 Aug 2015 02:25:46 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14661823" author="xuefuz" created="Fri, 7 Aug 2015 13:20:36 +0000"  >&lt;p&gt;Committed to master/branch-1. Thanks, Yongzhi.&lt;/p&gt;</comment>
                            <comment id="14661854" author="ychena" created="Fri, 7 Aug 2015 13:56:19 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt; for reviewing the code.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12834264">HIVE-10879</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12834266">HIVE-10881</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12848717">HIVE-11360</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12737007" name="HIVE-10880.1.patch" size="9607" author="ychena" created="Tue, 2 Jun 2015 20:57:39 +0000"/>
                            <attachment id="12737388" name="HIVE-10880.2.patch" size="63444" author="ychena" created="Wed, 3 Jun 2015 22:32:14 +0000"/>
                            <attachment id="12737564" name="HIVE-10880.3.patch" size="64618" author="ychena" created="Thu, 4 Jun 2015 14:03:33 +0000"/>
                            <attachment id="12748670" name="HIVE-10880.4.patch" size="63444" author="ychena" created="Tue, 4 Aug 2015 14:14:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 15 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fgkn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>