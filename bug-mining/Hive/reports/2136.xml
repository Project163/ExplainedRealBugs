<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:18:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-6883] Dynamic partitioning optimization does not honor sort order or order by</title>
                <link>https://issues.apache.org/jira/browse/HIVE-6883</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-6455&quot; title=&quot;Scalable dynamic partitioning and bucketing optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-6455&quot;&gt;&lt;del&gt;HIVE-6455&lt;/del&gt;&lt;/a&gt; patch does not honor sort order of the output table or order by of select statement. The reason for the former is numDistributionKey in ReduceSinkDesc is set wrongly. It doesn&apos;t take into account the sort columns, because of this RSOp sets the sort columns to null in Key. Since nulls are set in place of sort columns in Key, the sort columns in Value are not sorted. &lt;/p&gt;

&lt;p&gt;The other issue is ORDER BY columns are not honored during insertion. For example&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;insert overwrite table over1k_part_orc partition(ds=&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;, t) select si,i,b,f,t from over1k_orc where t is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; or t=27 order by si;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;the select query performs order by on column &apos;si&apos; in the first MR job. The following MR job (inserted by &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-6455&quot; title=&quot;Scalable dynamic partitioning and bucketing optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-6455&quot;&gt;&lt;del&gt;HIVE-6455&lt;/del&gt;&lt;/a&gt;), sorts the input data on dynamic partition column &apos;t&apos; without taking into account the already sorted &apos;si&apos; column. This results in out of order insertion for &apos;si&apos; column.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12707650">HIVE-6883</key>
            <summary>Dynamic partitioning optimization does not honor sort order or order by</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="prasanth_j">Prasanth Jayachandran</assignee>
                                    <reporter username="prasanth_j">Prasanth Jayachandran</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Apr 2014 06:51:23 +0000</created>
                <updated>Fri, 19 Sep 2014 02:30:47 +0000</updated>
                            <resolved>Sat, 12 Apr 2014 00:39:37 +0000</resolved>
                                    <version>0.13.0</version>
                                    <fixVersion>0.13.1</fixVersion>
                    <fixVersion>0.14.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="13965139" author="prasanth_j" created="Thu, 10 Apr 2014 08:55:20 +0000"  >&lt;p&gt;The fix is small. I added more tests to verify sort by and order by cases. Also replicated the tests for vectorization and tez.&lt;/p&gt;</comment>
                            <comment id="13965141" author="prasanth_j" created="Thu, 10 Apr 2014 08:59:00 +0000"  >&lt;p&gt;Review Board is flaky.. will upload the patch once it is back..&lt;/p&gt;</comment>
                            <comment id="13965142" author="prasanth_j" created="Thu, 10 Apr 2014 09:00:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhbutani&quot; class=&quot;user-hover&quot; rel=&quot;rhbutani&quot;&gt;rhbutani&lt;/a&gt; this is a critical issue as &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-6455&quot; title=&quot;Scalable dynamic partitioning and bucketing optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-6455&quot;&gt;&lt;del&gt;HIVE-6455&lt;/del&gt;&lt;/a&gt; fails to honor sort order in DDL.. Will it be possible to include this in 0.13?&lt;/p&gt;</comment>
                            <comment id="13965154" author="prasanth_j" created="Thu, 10 Apr 2014 09:15:39 +0000"  >&lt;p&gt;Attaching RB link&lt;/p&gt;</comment>
                            <comment id="13965758" author="rhbutani" created="Thu, 10 Apr 2014 19:36:43 +0000"  >&lt;p&gt;I going to say, let&apos;s keep this off 0.13&lt;br/&gt;
The user can turn of the dyn partition optimization in the case of sort/order&lt;/p&gt;</comment>
                            <comment id="13965768" author="prasanth_j" created="Thu, 10 Apr 2014 19:47:00 +0000"  >&lt;p&gt;Thanks. No problem. I will change the fix version then. And yes the user can turn off this optimization.&lt;/p&gt;</comment>
                            <comment id="13965806" author="prasanth_j" created="Thu, 10 Apr 2014 20:30:55 +0000"  >&lt;p&gt;orc_analyze.q test was failing in hadoop-2. Due to inconsistency in between hadoop-1 and hadoop-2 added order by to the test cases.&lt;/p&gt;</comment>
                            <comment id="13965906" author="vikram.dixit" created="Thu, 10 Apr 2014 21:53:18 +0000"  >&lt;p&gt;+1 LGTM&lt;/p&gt;</comment>
                            <comment id="13965930" author="rhbutani" created="Thu, 10 Apr 2014 22:22:06 +0000"  >&lt;p&gt;+1 for 0.13&lt;/p&gt;</comment>
                            <comment id="13966003" author="hiveqa" created="Thu, 10 Apr 2014 23:36:40 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12639645/HIVE-6883.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12639645/HIVE-6883.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 5571 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_auto_sortmerge_join_16
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_bucketmapjoin6
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_infer_bucket_sort_dyn_part
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2209/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2209/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2209/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2209/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12639645&lt;/p&gt;</comment>
                            <comment id="13966125" author="prasanth_j" created="Fri, 11 Apr 2014 01:45:28 +0000"  >&lt;p&gt;Fixed infer_bucket_sort_dyn_part.q. Other failures are unrelated.&lt;/p&gt;</comment>
                            <comment id="13966364" author="hiveqa" created="Fri, 11 Apr 2014 09:35:44 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12639717/HIVE-6883.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12639717/HIVE-6883.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 5613 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_auto_sortmerge_join_16
org.apache.hadoop.hive.cli.TestNegativeMinimrCliDriver.testNegativeCliDriver_mapreduce_stack_trace_hadoop20
org.apache.hive.jdbc.TestJdbcDriver2.testNewConnectionConfiguration
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2218/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2218/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2218/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/2218/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12639717&lt;/p&gt;</comment>
                            <comment id="13966368" author="prasanth_j" created="Fri, 11 Apr 2014 09:39:32 +0000"  >&lt;p&gt;The tests are not related.&lt;/p&gt;</comment>
                            <comment id="13967301" author="sershe" created="Sat, 12 Apr 2014 00:39:37 +0000"  >&lt;p&gt;committed to trunk&lt;/p&gt;</comment>
                            <comment id="13990127" author="prasanth_j" created="Tue, 6 May 2014 00:21:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sushanth&quot; class=&quot;user-hover&quot; rel=&quot;sushanth&quot;&gt;sushanth&lt;/a&gt; fyi.. attaching patch for branch-0.13.&lt;/p&gt;</comment>
                            <comment id="13990132" author="sushanth" created="Tue, 6 May 2014 00:26:11 +0000"  >&lt;p&gt;Thanks for the update, Prashant, I&apos;ll test it now.&lt;/p&gt;</comment>
                            <comment id="13990165" author="sushanth" created="Tue, 6 May 2014 01:07:36 +0000"  >&lt;p&gt;Thanks, Prashant, this merges correctly.&lt;/p&gt;</comment>
                            <comment id="14021690" author="thejas" created="Mon, 9 Jun 2014 06:39:38 +0000"  >&lt;p&gt;This jira has been fixed as part of 0.13.1 release. If you find further issues, please create a new jira and link it to this one.&lt;/p&gt;</comment>
                            <comment id="14135176" author="wzc1989" created="Tue, 16 Sep 2014 09:10:57 +0000"  >&lt;p&gt;@ &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt; , this fix cause some problems when combine dynamic partitioning with group by. Consider the following case:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE TABLE `t1`(  `a` &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,`b` string) PARTITIONED BY (`dt` string);
create table src1 (
  `key` string,
  `val` string
);
explain insert overwrite table t1 partition(dt) select 1, &lt;span class=&quot;code-quote&quot;&gt;&quot;hello&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;20140901&quot;&lt;/span&gt; from src1 group by key;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The key expressions of RS in Stage-2 are wrong. The part of the patch which using the parent RS&apos;s keyCols needs more changes.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (parentRSOpOrder != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !parentRSOpOrder.isEmpty() &amp;amp;&amp;amp; sortPositions.isEmpty()) {
          newKeyCols.addAll(parentRSOp.getConf().getKeyCols());
          orderStr += parentRSOpOrder;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="14136344" author="prasanth_j" created="Tue, 16 Sep 2014 22:12:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wzc1989&quot; class=&quot;user-hover&quot; rel=&quot;wzc1989&quot;&gt;wzc1989&lt;/a&gt; Thanks for reporting the issue. I will look at it and will post back a fix in a new jira.&lt;/p&gt;</comment>
                            <comment id="14139760" author="prasanth_j" created="Thu, 18 Sep 2014 23:53:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wzc1989&quot; class=&quot;user-hover&quot; rel=&quot;wzc1989&quot;&gt;wzc1989&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-8162&quot; title=&quot;Dynamic sort optimization propagates additional columns even in the absence of order by&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-8162&quot;&gt;&lt;del&gt;HIVE-8162&lt;/del&gt;&lt;/a&gt; has fix for the issue.&lt;/p&gt;</comment>
                            <comment id="14139886" author="wzc1989" created="Fri, 19 Sep 2014 02:26:11 +0000"  >&lt;p&gt;@ &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt; , thank you for the fix&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14139889" author="prasanth_j" created="Fri, 19 Sep 2014 02:30:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wzc1989&quot; class=&quot;user-hover&quot; rel=&quot;wzc1989&quot;&gt;wzc1989&lt;/a&gt; The fix needs more revision wrt subqueries. Currently it doesn&apos;t preserve the ordering of records if any subqueries has order by. I am working on it and will post an update to that fix.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12742231">HIVE-8162</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12643461" name="HIVE-6883-branch-0.13.3.patch" size="1881258" author="prasanth_j" created="Tue, 6 May 2014 00:21:35 +0000"/>
                            <attachment id="12639552" name="HIVE-6883.1.patch" size="1534511" author="prasanth_j" created="Thu, 10 Apr 2014 08:55:20 +0000"/>
                            <attachment id="12639645" name="HIVE-6883.2.patch" size="1552571" author="prasanth_j" created="Thu, 10 Apr 2014 20:30:55 +0000"/>
                            <attachment id="12639717" name="HIVE-6883.3.patch" size="1555735" author="prasanth_j" created="Fri, 11 Apr 2014 01:45:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>385973</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 9 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1uhpz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>386237</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>