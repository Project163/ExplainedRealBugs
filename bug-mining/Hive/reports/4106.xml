<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:39:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-11312] ORC format: where clause with CHAR data type not returning any rows</title>
                <link>https://issues.apache.org/jira/browse/HIVE-11312</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Test case:&lt;br/&gt;
Setup: &lt;br/&gt;
create table orc_test( col1 string, col2 char(10)) stored as orc tblproperties (&quot;orc.compress&quot;=&quot;NONE&quot;);&lt;br/&gt;
insert into orc_test values (&apos;val1&apos;, &apos;1&apos;);&lt;br/&gt;
Query:&lt;br/&gt;
select * from orc_test where col2=&apos;1&apos;; &lt;/p&gt;

&lt;p&gt;Query returns no row.&lt;/p&gt;

&lt;p&gt;Problem is introduced with &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-10286&quot; title=&quot;SARGs: Type Safety via PredicateLeaf.type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-10286&quot;&gt;&lt;del&gt;HIVE-10286&lt;/del&gt;&lt;/a&gt;, class RecordReaderImpl.java, method evaluatePredicateRange.&lt;br/&gt;
Old code:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Object baseObj = predicate.getLiteral(PredicateLeaf.FileFormat.ORC);&lt;/li&gt;
	&lt;li&gt;Object minValue = getConvertedStatsObj(min, baseObj);&lt;/li&gt;
	&lt;li&gt;Object maxValue = getConvertedStatsObj(max, baseObj);&lt;/li&gt;
	&lt;li&gt;Object predObj = getBaseObjectForComparison(baseObj, minValue);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;New code:&lt;br/&gt;
+ Object baseObj = predicate.getLiteral();&lt;br/&gt;
+ Object minValue = getBaseObjectForComparison(predicate.getType(), min);&lt;br/&gt;
+ Object maxValue = getBaseObjectForComparison(predicate.getType(), max);&lt;br/&gt;
+ Object predObj = getBaseObjectForComparison(predicate.getType(), baseObj);&lt;/p&gt;

&lt;p&gt;The values for min and max are of type String which contain as many characters as the CHAR column indicated. For example if the type is CHAR(10), and the row has value 1, the value of String min is &quot;1         &quot;;&lt;/p&gt;

&lt;p&gt;Before Hive 1.2, the method getConvertedStatsObj would call StringUtils.stripEnd(statsObj.toString(), null); which would remove the trailing spaces from min and max. Later in the compareToRange method, it was able to compare &quot;1&quot; with &quot;1&quot;.&lt;/p&gt;

&lt;p&gt;In Hive 1.2 with the use getBaseObjectForComparison method, it simply returns obj.String if the data type is String, which means minValue and maxValue are still &quot;1         &quot;.&lt;br/&gt;
As a result, the compareToRange method will return a wrong value (&quot;1&quot;.compareTo(&quot;1         &quot;)  -9 instead of 0.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12846189">HIVE-11312</key>
            <summary>ORC format: where clause with CHAR data type not returning any rows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="prasanth_j">Prasanth Jayachandran</assignee>
                                    <reporter username="tfriedr">Thomas Friedrich</reporter>
                        <labels>
                            <label>orc</label>
                    </labels>
                <created>Sun, 19 Jul 2015 23:13:50 +0000</created>
                <updated>Thu, 2 Jun 2016 10:17:33 +0000</updated>
                            <resolved>Thu, 3 Dec 2015 04:37:13 +0000</resolved>
                                    <version>1.2.0</version>
                    <version>1.2.1</version>
                    <version>1.3.0</version>
                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14632982" author="tfriedr" created="Sun, 19 Jul 2015 23:57:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt; can you take a look at my proposed patch since it&apos;s related to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-10286&quot; title=&quot;SARGs: Type Safety via PredicateLeaf.type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-10286&quot;&gt;&lt;del&gt;HIVE-10286&lt;/del&gt;&lt;/a&gt;. Thank you.&lt;/p&gt;</comment>
                            <comment id="14634349" author="gopalv" created="Tue, 21 Jul 2015 00:51:20 +0000"  >&lt;p&gt;The direct fix would break the bloom filters for someone actually looking for &quot;1 &quot;, since hash(&quot;1 &quot;) != hash(&quot;1&quot;).&lt;/p&gt;

&lt;p&gt;The issue is tied to the fact that the there&apos;s no CHAR sargs, while hashcodes will be incorrect after a trip.&lt;/p&gt;</comment>
                            <comment id="14651445" author="prasanth_j" created="Mon, 3 Aug 2015 05:14:37 +0000"  >&lt;p&gt;We don&apos;t need a CHAR type in sargs. Instead we need to convert the constant literal to column type. For charColumn = &quot;1&quot;, the literal &quot;1&quot; should be padded to the length specified in charColumn type info. ORC stores char columns  as is without stripping off the trailing white spaces. The column stats will also have spaces at the end. If we map the constant literal to the column type then we can get away with not having CHAR type in sargs.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gopalv&quot; class=&quot;user-hover&quot; rel=&quot;gopalv&quot;&gt;gopalv&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=owen.omalley&quot; class=&quot;user-hover&quot; rel=&quot;owen.omalley&quot;&gt;owen.omalley&lt;/a&gt; Can someone take a look at the patch?&lt;/p&gt;</comment>
                            <comment id="14651517" author="gopalv" created="Mon, 3 Aug 2015 06:53:50 +0000"  >&lt;p&gt;The missing type semantic coercion is somewhere deep inside SemanticAnalyzer type inference.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-comment&quot;&gt;// Try to infer the type of the constant only &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; there are two
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// nodes, one of them is column and the other is numeric &lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt;
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (genericUDF &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; GenericUDFBaseCompare
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14652203" author="tfriedr" created="Mon, 3 Aug 2015 18:13:32 +0000"  >&lt;p&gt;Thanks for looking at this, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt;. Feel free to assign the JIRA to yourself.&lt;/p&gt;</comment>
                            <comment id="15033272" author="prasanth_j" created="Tue, 1 Dec 2015 07:42:18 +0000"  >&lt;p&gt;Addressed &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gopalv&quot; class=&quot;user-hover&quot; rel=&quot;gopalv&quot;&gt;gopalv&lt;/a&gt; comments. The conversion of string to char now happens during semantic analysis. ORC expects the string constants to be padded properly, else bloom filters will break. &lt;/p&gt;</comment>
                            <comment id="15034373" author="prasanth_j" created="Tue, 1 Dec 2015 19:06:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt; Can you take a look since Gopal is out?&lt;/p&gt;</comment>
                            <comment id="15034393" author="sershe" created="Tue, 1 Dec 2015 19:15:05 +0000"  >&lt;p&gt;Is &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;olumnType.startsWith(serdeConstants.CHAR_TYPE_NAME) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; a proper way to check the type? Otherwise looks good.&lt;/p&gt;</comment>
                            <comment id="15034417" author="prasanth_j" created="Tue, 1 Dec 2015 19:23:49 +0000"  >&lt;p&gt;I have seen other places using contains() check (ConstantPropagateProcFactory, ColumnStatsSemanticAnalyzer). startswith is better for this case as we care only about char type (StatsUtils uses startswith).&lt;/p&gt;</comment>
                            <comment id="15034468" author="sershe" created="Tue, 1 Dec 2015 19:51:13 +0000"  >&lt;p&gt;It just seems brittle... why not use TypeInfoFactory.getPrimitiveTypeInfo()?&lt;/p&gt;</comment>
                            <comment id="15034508" author="prasanth_j" created="Tue, 1 Dec 2015 20:26:15 +0000"  >&lt;p&gt;Addressed review comments. &lt;/p&gt;</comment>
                            <comment id="15034510" author="prasanth_j" created="Tue, 1 Dec 2015 20:26:33 +0000"  >&lt;p&gt;Make sense. Fixed in latest patch.&lt;/p&gt;</comment>
                            <comment id="15034742" author="prasanth_j" created="Tue, 1 Dec 2015 22:31:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt; Could you take another look?&lt;/p&gt;</comment>
                            <comment id="15034747" author="sershe" created="Tue, 1 Dec 2015 22:33:22 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15035935" author="hiveqa" created="Wed, 2 Dec 2015 15:12:00 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12775112/HIVE-11312.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12775112/HIVE-11312.4.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 10 failed/errored test(s), 9870 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestHWISessionManager - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_auto_partitioned
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_orc_ppd_char
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_parquet_ppd_char
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_dynamic_partition_pruning
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_vectorized_dynamic_partition_pruning
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_mergejoin
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hadoop.hive.metastore.TestHiveMetaStorePartitionSpecs.testGetPartitionSpecs_WithAndWithoutPartitionGrouping
org.apache.hive.jdbc.TestSSL.testSSLVersion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6198/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6198/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6198/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6198/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6198/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6198/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 10 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12775112 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="15036376" author="prasanth_j" created="Wed, 2 Dec 2015 19:00:14 +0000"  >&lt;p&gt;orc_ppd_char.q passes locally for me. Not sure why. Sitll investigating&lt;/p&gt;</comment>
                            <comment id="15036506" author="prasanth_j" created="Wed, 2 Dec 2015 20:07:33 +0000"  >&lt;p&gt;Fixed ppd char test cases&lt;/p&gt;</comment>
                            <comment id="15037237" author="prasanth_j" created="Thu, 3 Dec 2015 04:37:13 +0000"  >&lt;p&gt;Since the latest test failure is just golden file update and other failures are unrelated, I went ahead and committed the patch to branch-1, branch-2.0 and master branch.&lt;/p&gt;</comment>
                            <comment id="15037347" author="tfriedr" created="Thu, 3 Dec 2015 06:24:37 +0000"  >&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt; for getting this fix in!&lt;/p&gt;</comment>
                            <comment id="15038384" author="sershe" created="Thu, 3 Dec 2015 19:16:08 +0000"  >&lt;p&gt;Isn&apos;t it implied that something fixed in 2.0 is also fixed in 2.1?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12775480" name="HIVE-11312-branch-1.patch" size="8655" author="prasanth_j" created="Thu, 3 Dec 2015 04:27:10 +0000"/>
                            <attachment id="12746035" name="HIVE-11312.1.patch" size="891" author="tfriedr" created="Sun, 19 Jul 2015 23:55:13 +0000"/>
                            <attachment id="12748395" name="HIVE-11312.2.patch" size="7623" author="prasanth_j" created="Mon, 3 Aug 2015 05:14:37 +0000"/>
                            <attachment id="12774981" name="HIVE-11312.3.patch" size="7575" author="prasanth_j" created="Tue, 1 Dec 2015 07:42:18 +0000"/>
                            <attachment id="12775112" name="HIVE-11312.4.patch" size="7536" author="prasanth_j" created="Tue, 1 Dec 2015 20:26:15 +0000"/>
                            <attachment id="12775374" name="HIVE-11312.5.patch" size="9732" author="prasanth_j" created="Wed, 2 Dec 2015 20:07:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 50 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2hfqv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332154">1.3.0</customfieldvalue>
    <customfieldvalue id="12332641">2.0.0</customfieldvalue>
    <customfieldvalue id="12334255">2.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>