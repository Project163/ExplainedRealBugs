<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:41:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-11716] Reading ACID table from non-acid session should raise an error</title>
                <link>https://issues.apache.org/jira/browse/HIVE-11716</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;if someone performs a delete using DbTxnManager and than starts a new session with DummyTxnManager, then previously successfully deleted data will show up.&lt;/p&gt;

&lt;p&gt;Once the logic to identify all acid tables being read is there, make sure that&lt;br/&gt;
Driver.recordValidTxns() called iff there ACID tables in the query.&lt;/p&gt;

&lt;p&gt;We should also not allow writing to ACID table from non-acid session&lt;/p&gt;</description>
                <environment></environment>
        <key id="12861186">HIVE-11716</key>
            <summary>Reading ACID table from non-acid session should raise an error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="wzheng">Wei Zheng</assignee>
                                    <reporter username="ekoifman">Eugene Koifman</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Sep 2015 00:12:39 +0000</created>
                <updated>Tue, 1 Oct 2019 22:06:43 +0000</updated>
                            <resolved>Thu, 4 Feb 2016 00:26:42 +0000</resolved>
                                    <version>1.0.0</version>
                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>Transactions</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15113039" author="ekoifman" created="Fri, 22 Jan 2016 20:51:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-12441&quot; title=&quot;Driver.acquireLocksAndOpenTxn() should only call recordValidTxns() when needed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-12441&quot;&gt;&lt;del&gt;HIVE-12441&lt;/del&gt;&lt;/a&gt; is related since in both cases we need to walk the plan and see if there are any ACID tables in it (read or written)&lt;/p&gt;</comment>
                            <comment id="15116835" author="wzheng" created="Tue, 26 Jan 2016 07:08:56 +0000"  >&lt;p&gt;This JIRA solves the problems below:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Explicitly disallow switching hive.txn.manager (This was not allowed always, but we didn&apos;t throw out error, and SET command gives people impression that this entry can be changed because it does show the new value, which is misleading)&lt;/li&gt;
	&lt;li&gt;For queries against ACID table with a transaction manager that doesn&apos;t support ACID, we raise errors. This applies to SELECT, INSERT INTO, INSERT OVERWRITE, UPDATE and DELETE.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15116837" author="wzheng" created="Tue, 26 Jan 2016 07:09:47 +0000"  >&lt;p&gt;I will follow up with &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-12441&quot; title=&quot;Driver.acquireLocksAndOpenTxn() should only call recordValidTxns() when needed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-12441&quot;&gt;&lt;del&gt;HIVE-12441&lt;/del&gt;&lt;/a&gt; once this one is done&lt;/p&gt;</comment>
                            <comment id="15117995" author="hiveqa" created="Tue, 26 Jan 2016 20:56:41 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12784367/HIVE-11716.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12784367/HIVE-11716.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to build exiting with an error&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6749/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6749/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6749/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6749/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6749/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6749/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Tests exited with: NonZeroExitCodeException
Command &apos;bash /data/hive-ptest/working/scratch/source-prep.sh&apos; failed with exit status 1 and output &apos;+ [[ -n /usr/java/jdk1.7.0_45-cloudera ]]
+ export JAVA_HOME=/usr/java/jdk1.7.0_45-cloudera
+ JAVA_HOME=/usr/java/jdk1.7.0_45-cloudera
+ export PATH=/usr/java/jdk1.7.0_45-cloudera/bin/:/usr/local/apache-maven-3.0.5/bin:/usr/java/jdk1.7.0_45-cloudera/bin:/usr/local/apache-ant-1.9.1/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/hiveptest/bin
+ PATH=/usr/java/jdk1.7.0_45-cloudera/bin/:/usr/local/apache-maven-3.0.5/bin:/usr/java/jdk1.7.0_45-cloudera/bin:/usr/local/apache-ant-1.9.1/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/hiveptest/bin
+ export &apos;ANT_OPTS=-Xmx1g -XX:MaxPermSize=256m &apos;
+ ANT_OPTS=&apos;-Xmx1g -XX:MaxPermSize=256m &apos;
+ export &apos;M2_OPTS=-Xmx1g -XX:MaxPermSize=256m -Dhttp.proxyHost=localhost -Dhttp.proxyPort=3128&apos;
+ M2_OPTS=&apos;-Xmx1g -XX:MaxPermSize=256m -Dhttp.proxyHost=localhost -Dhttp.proxyPort=3128&apos;
+ cd /data/hive-ptest/working/
+ tee /data/hive-ptest/logs/PreCommit-HIVE-TRUNK-Build-6749/source-prep.txt
+ [[ false == \t\r\u\e ]]
+ mkdir -p maven ivy
+ [[ git = \s\v\n ]]
+ [[ git = \g\i\t ]]
+ [[ -z master ]]
+ [[ -d apache-github-source-source ]]
+ [[ ! -d apache-github-source-source/.git ]]
+ [[ ! -d apache-github-source-source ]]
+ cd apache-github-source-source
+ git fetch origin
From https://github.com/apache/hive
   eb4a164..27172bc  master     -&amp;gt; origin/master
+ git reset --hard HEAD
HEAD is now at eb4a164 HIVE-12905 : Issue with mapjoin in tez under certain conditions (Vikram Dixit K, reviewed by Sergey Shelukhin)
+ git clean -f -d
Removing metastore/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/metastore/api/GetChangeVersionRequest.java
Removing metastore/src/gen/thrift/gen-javabean/org/apache/hadoop/hive/metastore/api/GetChangeVersionResult.java
Removing metastore/src/model/org/apache/hadoop/hive/metastore/model/MChangeVersion.java
+ git checkout master
Already on &apos;master&apos;
Your branch is behind &apos;origin/master&apos; by 1 commit, and can be fast-forwarded.
+ git reset --hard origin/master
HEAD is now at 27172bc HIVE-12889: Support COUNT(DISTINCT) for partitioning query. (Aihua Xu, reviewed by Szehon Ho)
+ git merge --ff-only origin/master
Already up-to-date.
+ git gc
+ patchCommandPath=/data/hive-ptest/working/scratch/smart-apply-patch.sh
+ patchFilePath=/data/hive-ptest/working/scratch/build.patch
+ [[ -f /data/hive-ptest/working/scratch/build.patch ]]
+ chmod +x /data/hive-ptest/working/scratch/smart-apply-patch.sh
+ /data/hive-ptest/working/scratch/smart-apply-patch.sh /data/hive-ptest/working/scratch/build.patch
The patch does not appear to apply with p0, p1, or p2
+ exit 1
&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12784367 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="15118091" author="ekoifman" created="Tue, 26 Jan 2016 21:37:25 +0000"  >&lt;p&gt;I think you need to use AcidUtil.isTablePropertyTransactional() to see if table is transactional rather than AcidUtils.isAcidTable(tab).  The later will return false for table that was non-acid-to-acid upgraded but w/o major compaction having been run.  Maybe even better to define a new isAcidTable(Table t) method which checks that it&apos;s bucketed, implements AcidInput/AcidOutputFormat and has the transactional=true.&lt;/p&gt;

&lt;p&gt;Also, SemanticAnalyzer.isAcidTable() should delegate to new method (or be removed) or at minimum not check the which TxnManager is installed&lt;/p&gt;</comment>
                            <comment id="15118097" author="ekoifman" created="Tue, 26 Jan 2016 21:40:04 +0000"  >&lt;p&gt;one other comment: now that you&apos;ve implemented logic to raise an error when Acid table is accessed from non-acid session, it&apos;s seems like it&apos;s safe to allow user to change TxnManager within a Session.  Since it can no longer do any harm.  So maybe using HIV_IN_TEST isn&apos;t needed...&lt;/p&gt;</comment>
                            <comment id="15118134" author="ekoifman" created="Tue, 26 Jan 2016 21:56:21 +0000"  >&lt;p&gt;Nit: &quot;Cannot query an ACID table using a non-ACID transaction manager&quot; - maybe should read &quot;This command is not allowed on an ACID.... &quot;&lt;/p&gt;</comment>
                            <comment id="15118150" author="wzheng" created="Tue, 26 Jan 2016 22:07:22 +0000"  >&lt;p&gt;How about &quot;This command is not allowed on an ACID table with a non-ACID transaction manager&quot;?&lt;/p&gt;</comment>
                            <comment id="15118160" author="wzheng" created="Tue, 26 Jan 2016 22:11:34 +0000"  >&lt;p&gt;Sounds good. Now users can change the TxnManager for real. But one issue is, initialize a TxnManager for every query might be a little slower than reusing the same one in a session (because we will check conf every time and init a TxnManager)&lt;/p&gt;</comment>
                            <comment id="15118165" author="wzheng" created="Tue, 26 Jan 2016 22:13:28 +0000"  >&lt;p&gt;Unless I compare the original conf and the passed-in conf, and only initialize a new TxnManger if hive.txn.manager field is changed?&lt;/p&gt;</comment>
                            <comment id="15118166" author="ekoifman" created="Tue, 26 Jan 2016 22:14:41 +0000"  >&lt;p&gt;I think it should only initialized if it is not already set or if there is explicit &quot;set hive.txn.manager...&quot; command.  In the later case, the previous instance must be shutdown first.&lt;/p&gt;</comment>
                            <comment id="15118183" author="wzheng" created="Tue, 26 Jan 2016 22:26:21 +0000"  >&lt;p&gt;But I think set hive.txn.manager= ... will make changes to conf, and we will only know this if we do a comparison between confs&lt;/p&gt;</comment>
                            <comment id="15118194" author="ekoifman" created="Tue, 26 Jan 2016 22:33:27 +0000"  >&lt;p&gt;in that case you are right, you should keep track of hive.txn.manager field&lt;/p&gt;</comment>
                            <comment id="15120102" author="hiveqa" created="Wed, 27 Jan 2016 20:21:16 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12784545/HIVE-11716.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12784545/HIVE-11716.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 2 failed/errored test(s), 10035 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hive.jdbc.TestSSL.testSSLVersion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6762/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6762/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6762/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6762/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6762/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6762/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12784545 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="15120261" author="wzheng" created="Wed, 27 Jan 2016 22:08:52 +0000"  >&lt;p&gt;Placeholder for QA run. Will update this patch 4 later today.&lt;/p&gt;</comment>
                            <comment id="15122531" author="hiveqa" created="Thu, 28 Jan 2016 23:35:08 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12784780/HIVE-11716.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12784780/HIVE-11716.4.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 5 failed/errored test(s), 10022 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestSparkCliDriver-timestamp_lazy.q-bucketsortoptimize_insert_4.q-date_udf.q-and-12-more - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_delete_not_bucketed
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_update_not_bucketed
org.apache.hive.jdbc.TestSSL.testSSLVersion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6782/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6782/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6782/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6782/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6782/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6782/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 5 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12784780 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="15122616" author="wzheng" created="Fri, 29 Jan 2016 00:34:09 +0000"  >&lt;p&gt;Both delete_not_bucketed.q and update_not_bucketed.q passed locally for me.&lt;/p&gt;</comment>
                            <comment id="15122676" author="alangates" created="Fri, 29 Jan 2016 01:09:45 +0000"  >&lt;p&gt;Those tests don&apos;t generally fail and given that you&apos;re working exactly in that space I wouldn&apos;t ignore those failures.&lt;/p&gt;</comment>
                            <comment id="15123118" author="wzheng" created="Fri, 29 Jan 2016 07:17:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gates&quot; class=&quot;user-hover&quot; rel=&quot;gates&quot;&gt;gates&lt;/a&gt; You&apos;re right. The mismatch is caused by my change, but in a good way &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Basically the test result mismatch is like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt; FAILED: SemanticException [Error 10297]: Attempt to &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; update or delete on table &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.acid_notbucketed that does not use an AcidOutputFormat or is not bucketed
---
&amp;gt; FAILED: SemanticException [Error 10297]: Attempt to &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; update or delete on table acid_notbucketed that does not use an AcidOutputFormat or is not bucketed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Without patch the error was thrown by SemanticAnalyzer#checkAcidConstraints, there we have&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (table.getNumBuckets() &amp;lt; 1) {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SemanticException(ErrorMsg.ACID_OP_ON_NONACID_TABLE, table.getTableName());
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;where table.getTableName() just returns tablename acid_notbucketed.&lt;/p&gt;

&lt;p&gt;With patch the error was caught earlier and thrown by SemanticAnalyzer#getMetaData()&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-comment&quot;&gt;// Disallow update and delete on non-acid tables
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((updating() || deleting()) &amp;amp;&amp;amp; !isAcid &amp;amp;&amp;amp; isTableWrittenTo) {
          &lt;span class=&quot;code-comment&quot;&gt;//isTableWrittenTo: delete from acidTbl where a in (select id from nonAcidTable)
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;//so only &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we are actually writing to &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; table
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// isAcidTable above also checks &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; whether we are using an acid compliant
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// transaction manager.  But that has already been caught in
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// UpdateDeleteSemanticAnalyzer, so &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we are updating or deleting and getting nonAcid
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// here, it means the table itself doesn&apos;t support it.
&lt;/span&gt;          &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SemanticException(ErrorMsg.ACID_OP_ON_NONACID_TABLE, tab_name);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;where tab_name is default.acid_notbucketed&lt;/p&gt;

&lt;p&gt;Here isAcid flag was true without patch, which is wrong, because isAcidTable() has a bug as it only checked &apos;transactional&apos;=&apos;true&apos;, but didn&apos;t check whether the table is bucketed or whether it&apos;s ORC. The patch fixed isAcidTable(), so isAcid is false now, thus we can trigger this logic.&lt;/p&gt;</comment>
                            <comment id="15125238" author="hiveqa" created="Sun, 31 Jan 2016 06:39:50 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12785122/HIVE-11716.5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12785122/HIVE-11716.5.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 5 failed/errored test(s), 10032 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestSparkCliDriver-timestamp_lazy.q-bucketsortoptimize_insert_4.q-date_udf.q-and-12-more - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hive.jdbc.TestMultiSessionsHS2WithLocalClusterSpark.testSparkQuery
org.apache.hive.jdbc.TestSSL.testSSLVersion
org.apache.hive.service.cli.TestEmbeddedThriftBinaryCLIService.testExecuteStatementAsync
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6809/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6809/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6809/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6809/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6809/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6809/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 5 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12785122 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="15126748" author="wzheng" created="Mon, 1 Feb 2016 18:35:19 +0000"  >&lt;p&gt;Mismatches are unrelated&lt;/p&gt;</comment>
                            <comment id="15127452" author="ekoifman" created="Tue, 2 Feb 2016 02:12:29 +0000"  >&lt;p&gt;ErrorMsg.TXNMGR_NOT_ACID - this should be a parametrized message.  At minimum, it should include db_name.table_name.  Perhaps it should also include first 10 or 20 chars of the command itself to make easier to read the logs down the road.&lt;/p&gt;

&lt;p&gt;I don&apos;t think SessionState.initTxnMgr() works long term.  What if we add BetterTxnManger later?  I would, in addition to txnMgr also add txnMgrName to remember the last property name or perhaps better add HiveTxnManager.getTxnManagerName() so that you can query currently installed manager for its name.&lt;/p&gt;

&lt;p&gt;Nit: In TestDbTxnManager2.testDummyTxnManagerOnAcidTable().  Instead of 10265, etc could you use ErrorMsg.TXNMGR_NOT_ACID, etc&lt;/p&gt;
</comment>
                            <comment id="15127702" author="wzheng" created="Tue, 2 Feb 2016 05:44:46 +0000"  >&lt;p&gt;Good advice. Will follow up with new patch.&lt;/p&gt;</comment>
                            <comment id="15129020" author="wzheng" created="Tue, 2 Feb 2016 20:59:30 +0000"  >&lt;p&gt;Patch 6 for test. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ekoifman&quot; class=&quot;user-hover&quot; rel=&quot;ekoifman&quot;&gt;ekoifman&lt;/a&gt; Can you take a look?&lt;/p&gt;</comment>
                            <comment id="15129337" author="ekoifman" created="Tue, 2 Feb 2016 23:32:39 +0000"  >&lt;p&gt;+1 pending tests&lt;/p&gt;</comment>
                            <comment id="15130736" author="hiveqa" created="Wed, 3 Feb 2016 17:36:59 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12785860/HIVE-11716.6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12785860/HIVE-11716.6.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 7 failed/errored test(s), 10034 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestMiniTezCliDriver-vector_decimal_2.q-schema_evol_text_fetchwork_table.q-vector_null_projection.q-and-12-more - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hadoop.hive.metastore.TestHiveMetaStorePartitionSpecs.testAddPartitions
org.apache.hadoop.hive.metastore.TestHiveMetaStorePartitionSpecs.testFetchingPartitionsWithDifferentSchemas
org.apache.hadoop.hive.metastore.TestHiveMetaStorePartitionSpecs.testGetPartitionSpecs_WithAndWithoutPartitionGrouping
org.apache.hive.jdbc.TestSSL.testSSLVersion
org.apache.hive.service.cli.TestEmbeddedThriftBinaryCLIService.testExecuteStatementAsync
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6852/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6852/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6852/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6852/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6852/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6852/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 7 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12785860 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="15130854" author="wzheng" created="Wed, 3 Feb 2016 18:43:40 +0000"  >&lt;p&gt;TestHiveMetaStorePartitionSpecs passed locally for me without any failures. My change shouldn&apos;t have impact on that test.&lt;/p&gt;</comment>
                            <comment id="15130958" author="ekoifman" created="Wed, 3 Feb 2016 19:31:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wzheng&quot; class=&quot;user-hover&quot; rel=&quot;wzheng&quot;&gt;wzheng&lt;/a&gt; could you make a branch-1 patch&lt;/p&gt;</comment>
                            <comment id="15131030" author="ekoifman" created="Wed, 3 Feb 2016 20:02:10 +0000"  >&lt;p&gt;committed to master &lt;a href=&quot;https://github.com/apache/hive/commit/f2e9edbc2d81e32f5da700cd7024959184aeaebf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/commit/f2e9edbc2d81e32f5da700cd7024959184aeaebf&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15131156" author="wzheng" created="Wed, 3 Feb 2016 21:23:23 +0000"  >&lt;p&gt;branch-1 patch has been attached&lt;/p&gt;</comment>
                            <comment id="15131437" author="ekoifman" created="Thu, 4 Feb 2016 00:26:32 +0000"  >&lt;p&gt;branch-1: caf4b516b74201633e25d99bfcf5d69eacc8a617&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12913849">HIVE-12441</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="12935816">HIVE-12979</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12784367" name="HIVE-11716.1.patch" size="9723" author="wzheng" created="Tue, 26 Jan 2016 07:04:19 +0000"/>
                            <attachment id="12784496" name="HIVE-11716.2.patch" size="9230" author="wzheng" created="Tue, 26 Jan 2016 21:11:00 +0000"/>
                            <attachment id="12784545" name="HIVE-11716.3.patch" size="9892" author="wzheng" created="Wed, 27 Jan 2016 01:50:09 +0000"/>
                            <attachment id="12784780" name="HIVE-11716.4.patch" size="10532" author="wzheng" created="Wed, 27 Jan 2016 23:53:30 +0000"/>
                            <attachment id="12785711" name="HIVE-11716.5.patch" size="13130" author="wzheng" created="Tue, 2 Feb 2016 06:19:26 +0000"/>
                            <attachment id="12785860" name="HIVE-11716.6.patch" size="15581" author="wzheng" created="Tue, 2 Feb 2016 20:59:30 +0000"/>
                            <attachment id="12786114" name="HIVE-11716.branch-1.patch" size="15268" author="wzheng" created="Wed, 3 Feb 2016 21:23:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 41 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2jokf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332154">1.3.0</customfieldvalue>
    <customfieldvalue id="12334255">2.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>