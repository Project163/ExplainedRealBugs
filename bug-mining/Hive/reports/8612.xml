<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:25:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-25803] URL Mapping appends default Fs scheme even for LOCAL DIRECTORY ops</title>
                <link>https://issues.apache.org/jira/browse/HIVE-25803</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Repro steps:&lt;/p&gt;

&lt;p&gt;Connect to beeline&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
beeline -u &lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:hive2:&lt;span class=&quot;code-comment&quot;&gt;//quasar-pxlypi-2.quasar-pxlypi.root.hwx.site:10001/;principal=hive/_HOST@ROOT.HWX.SITE;ssl=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;sslTrustStore=/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/lib/cloudera-scm-agent/agent-cert/cm-auto-global_truststore.jks;trustStorePassword=VOAnRk5l4oXsg0upJ1ApscSuNksirOKgyhJvoPv2o4j;transportMode=http;httpPath=cliservice;&quot;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;



&lt;p&gt;Create a test table and run insert on local&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;gt; create table dual (id &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;); 
&amp;gt; insert overwrite local directory &lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/&quot;&lt;/span&gt; select * from dual;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Error: Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; compiling statement: FAILED: HiveAccessControlException Permission denied: user [hrt_qa] does not have [ALL] privilege on [hdfs:&lt;span class=&quot;code-comment&quot;&gt;//ns1/tmp] (state=42000,code=40000)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;It always appends hdfs:// to the path even if the operation is meant for local directory.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13417307">HIVE-25803</key>
            <summary>URL Mapping appends default Fs scheme even for LOCAL DIRECTORY ops</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ayushtkn">Ayush Saxena</assignee>
                                    <reporter username="ssulav">Soumitra Sulav</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 14 Dec 2021 07:51:40 +0000</created>
                <updated>Fri, 29 Mar 2024 17:49:54 +0000</updated>
                            <resolved>Thu, 21 Dec 2023 19:39:17 +0000</resolved>
                                    <version>4.0.0</version>
                                    <fixVersion>4.0.0</fixVersion>
                                    <component>Authorization</component>
                    <component>HiveServer2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17793610" author="dkuzmenko" created="Wed, 6 Dec 2023 10:11:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hemanth619&quot; class=&quot;user-hover&quot; rel=&quot;hemanth619&quot;&gt;hemanth619&lt;/a&gt;, is still valid?&lt;/p&gt;</comment>
                            <comment id="17794389" author="hemanth619" created="Thu, 7 Dec 2023 18:48:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dkuzmenko&quot; class=&quot;user-hover&quot; rel=&quot;dkuzmenko&quot;&gt;dkuzmenko&lt;/a&gt; - Yeah, it is still a problem. This needs to be addressed.&lt;/p&gt;</comment>
                            <comment id="17798113" author="ayushtkn" created="Mon, 18 Dec 2023 10:32:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hemanth619&quot; class=&quot;user-hover&quot; rel=&quot;hemanth619&quot;&gt;hemanth619&lt;/a&gt; Did some investigation&lt;/p&gt;

&lt;p&gt;This should be the fix&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
index 0823b6d9ba..9ab3569c20 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
@@ -8051,8 +8051,14 @@ protected Operator genFileSinkPlan(String dest, QB qb, Operator input)
&#160; &#160; &#160; &#160; &#160;loadFileDesc.setMoveTaskId(moveTaskId);
&#160; &#160; &#160; &#160; &#160;loadFileWork.add(loadFileDesc);
&#160; &#160; &#160; &#160; &#160;try {
+ &#160; &#160; &#160; &#160; &#160;FileSystem fs;
+ &#160; &#160; &#160; &#160; &#160;if (!isDfsDir) {
+ &#160; &#160; &#160; &#160; &#160; &#160;fs = FileSystem.getLocal(conf);
+ &#160; &#160; &#160; &#160; &#160;} else {
+ &#160; &#160; &#160; &#160; &#160; &#160;fs = destinationPath.getFileSystem(conf);
+ &#160; &#160; &#160; &#160; &#160;}
&#160; &#160; &#160; &#160; &#160; &#160;Path qualifiedPath = conf.getBoolVar(ConfVars.HIVE_RANGER_USE_FULLY_QUALIFIED_URL) ?
- &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;destinationPath.getFileSystem(conf).makeQualified(destinationPath) : destinationPath;
+ &#160; &#160; &#160; &#160; &#160; &#160; &#160;fs.makeQualified(destinationPath) : destinationPath;
&#160; &#160; &#160; &#160; &#160; &#160;if (!outputs.add(new WriteEntity(qualifiedPath, !isDfsDir, isDestTempFile))) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160;throw new SemanticException(ErrorMsg.OUTPUT_SPECIFIED_MULTIPLE_TIMES
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;.getMsg(destinationPath.toUri().toString()));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The FileSystem in case full path isn&apos;t specified is getting resolved to DefaultFs, but in case of Local it should use the LocalFileSystem rather than the Default FileSystem.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;It isn&apos;t HDFS specific but DefaultFs specific, I am changing the title of the ticket&lt;/p&gt;</comment>
                            <comment id="17798163" author="ayushtkn" created="Mon, 18 Dec 2023 12:02:06 +0000"  >&lt;p&gt;or better&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
index 0823b6d9ba..8bb7f20067 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
@@ -8051,8 +8051,9 @@ protected Operator genFileSinkPlan(String dest, QB qb, Operator input)
&#160; &#160; &#160; &#160; &#160;loadFileDesc.setMoveTaskId(moveTaskId);
&#160; &#160; &#160; &#160; &#160;loadFileWork.add(loadFileDesc);
&#160; &#160; &#160; &#160; &#160;try {
+ &#160; &#160; &#160; &#160; &#160;FileSystem fs = isDfsDir ? &#160;destinationPath.getFileSystem(conf) : FileSystem.getLocal(conf);
&#160; &#160; &#160; &#160; &#160; &#160;Path qualifiedPath = conf.getBoolVar(ConfVars.HIVE_RANGER_USE_FULLY_QUALIFIED_URL) ?
- &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;destinationPath.getFileSystem(conf).makeQualified(destinationPath) : destinationPath;
+ &#160; &#160; &#160; &#160; &#160; &#160; &#160;fs.makeQualified(destinationPath) : destinationPath;
&#160; &#160; &#160; &#160; &#160; &#160;if (!outputs.add(new WriteEntity(qualifiedPath, !isDfsDir, isDestTempFile))) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160;throw new SemanticException(ErrorMsg.OUTPUT_SPECIFIED_MULTIPLE_TIMES
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;.getMsg(destinationPath.toUri().toString()));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17798377" author="hemanth619" created="Mon, 18 Dec 2023 22:59:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ayushtkn&quot; class=&quot;user-hover&quot; rel=&quot;ayushtkn&quot;&gt;ayushtkn&lt;/a&gt; &#8211; Please feel free to assign this to you to work on this.&lt;/p&gt;</comment>
                            <comment id="17799547" author="ayushtkn" created="Thu, 21 Dec 2023 19:38:58 +0000"  >&lt;p&gt;Committed to master.&lt;br/&gt;
Thanx &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dkuzmenko&quot; class=&quot;user-hover&quot; rel=&quot;dkuzmenko&quot;&gt;dkuzmenko&lt;/a&gt; for the review!!!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 46 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0xo34:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>