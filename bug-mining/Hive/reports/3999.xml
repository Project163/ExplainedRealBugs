<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:38:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-11985] don&apos;t store type names in metastore when metastore type names are not used</title>
                <link>https://issues.apache.org/jira/browse/HIVE-11985</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description></description>
                <environment></environment>
        <key id="12901190">HIVE-11985</key>
            <summary>don&apos;t store type names in metastore when metastore type names are not used</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sershe">Sergey Shelukhin</assignee>
                                    <reporter username="sershe">Sergey Shelukhin</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Sep 2015 00:15:37 +0000</created>
                <updated>Tue, 1 Oct 2019 22:07:52 +0000</updated>
                            <resolved>Fri, 30 Oct 2015 21:53:38 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="14934474" author="sershe" created="Tue, 29 Sep 2015 01:52:31 +0000"  >&lt;p&gt;A patch that attempts to replace the long name under the assumption that they are not used for deserializer-based serdes. I&apos;ll test it tomorrow.&lt;/p&gt;</comment>
                            <comment id="14934475" author="sershe" created="Tue, 29 Sep 2015 01:53:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;jxiang&lt;/a&gt; are you familiar with Avro stuff? I&apos;ve no idea who knows that serde but you fixed some JIRAs &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14935413" author="jxiang" created="Tue, 29 Sep 2015 16:36:14 +0000"  >&lt;p&gt;I am not familiar with Avro serde either &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14935699" author="sershe" created="Tue, 29 Sep 2015 19:28:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sachingoyal&quot; class=&quot;user-hover&quot; rel=&quot;sachingoyal&quot;&gt;sachingoyal&lt;/a&gt; are you familiar with it? I wonder who is. most commits on these files are pretty old, you have one in 2014 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14935943" author="sershe" created="Tue, 29 Sep 2015 21:45:34 +0000"  >&lt;p&gt;Need to change the type name to keep metastore happy. Tested this on cluster with a giant Avro schema, I can create the table, query it (it&apos;s empty though) and describe correctly. At any rate, it&apos;s an improvement over existing truncated type name. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; do you want to review or suggest a reviewer? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Btw, this case will also fail on Oracle (before the patch), as it doesn&apos;t allow the data to be truncated on insert.&lt;/p&gt;</comment>
                            <comment id="14935949" author="sershe" created="Tue, 29 Sep 2015 21:48:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/38862/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/38862/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14936729" author="hiveqa" created="Wed, 30 Sep 2015 11:28:09 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12764326/HIVE-11985.01.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12764326/HIVE-11985.01.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 9638 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_vector_groupby_reduce
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_groupby_reduce
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5468/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5468/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5468/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5468/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5468/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5468/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12764326 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14943638" author="ashutoshc" created="Mon, 5 Oct 2015 16:50:28 +0000"  >&lt;p&gt;I would like to have other&apos;s opinion on this. &lt;br/&gt;
Patch arbitrarily replaces a long type name (&amp;gt; 2K chars) with a typename &lt;tt&gt;struct&amp;lt;&amp;gt;&lt;/tt&gt; for serde supplied schemas under the assumption that this typename is not used for anything for query processing (now and in &lt;b&gt;future&lt;/b&gt;).  This lossy information (stored permanently in metastore) for type might not be a good idea, because this prevents us from using type information reliably in future. We can never be sure whether type info is correct or truncated one. Secondly, for its current use case (of describe table) it will atleast be confusing for user to see struct&amp;lt;&amp;gt; in type info in describe output, as oppose to actual type info.&lt;br/&gt;
IMHO, throwing an error for type name (&amp;gt; 2K) which is also part of the patch, should be sufficient.&lt;br/&gt;
 &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gates&quot; class=&quot;user-hover&quot; rel=&quot;gates&quot;&gt;gates&lt;/a&gt; your thoughts?&lt;/p&gt;</comment>
                            <comment id="14943775" author="sershe" created="Mon, 5 Oct 2015 18:13:44 +0000"  >&lt;p&gt;The describe command correctly gets the type information from deserializer.&lt;br/&gt;
I can increase the limit to 4000 (length of column); at that point it&apos;s no worse than having incorrect, truncated type info in terms of usage - if it&apos;s used for anything it will fail anyway.&lt;br/&gt;
Throwing an error will make it impossible to use Hive with complex Avro schemas.&lt;/p&gt;</comment>
                            <comment id="14947406" author="sershe" created="Wed, 7 Oct 2015 19:14:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; ping?&lt;/p&gt;</comment>
                            <comment id="14948922" author="alangates" created="Thu, 8 Oct 2015 16:12:09 +0000"  >&lt;p&gt;+1 to Ashutosh&apos;s comment, I don&apos;t think blowing off the type name is a good idea.  &lt;/p&gt;

&lt;p&gt;Could we resolve the Avro case by having the option to store long type names in a separate column that&apos;s unbounded (text or clob depending on the RDBMS type).  This would take extra work on our side to detect the case and retrieve the name from the proper location but it should only penalize tables with very long column names.&lt;/p&gt;</comment>
                            <comment id="14949045" author="sershe" created="Thu, 8 Oct 2015 17:49:20 +0000"  >&lt;p&gt;the key question is why would we do that. As far as I see column type should never be used for these serdes. If anything, I&apos;d rather change the logic to write nothing, or a fixed coded type, for these cases. It&apos;s pointless to write it into the column, and error prone in case someone thinks that type in the column is actually a real thing and comes to rely on it, when real type is always derived from the schema, regardless of what&apos;s in the column.&lt;/p&gt;</comment>
                            <comment id="14949475" author="sershe" created="Thu, 8 Oct 2015 22:05:22 +0000"  >&lt;p&gt;Updated the patch in accordance with the new description&lt;/p&gt;</comment>
                            <comment id="14949665" author="xuefuz" created="Fri, 9 Oct 2015 00:27:59 +0000"  >&lt;p&gt;First I have to admit that I don&apos;t have the enough knowledge to conclude if the approach here causes a problem. As far as I know, 4000 character limit is only a problem for Oracle, yet the patch seems rejecting any schema that is more than 2000 long. This sounds rather harsh, and a long of times users get around the problem by changing Oracle settings.&lt;/p&gt;

&lt;p&gt;On a high level, I&apos;d echo &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gates&quot; class=&quot;user-hover&quot; rel=&quot;gates&quot;&gt;gates&lt;/a&gt;&apos;s concerns. If we spend time on this, I&apos;d rather solve the problem in the generic way, regardless the serde type and db type. The obvious inconsistency I see here is that we store for avro the schema if it&apos;s less than 2000 while storing a constant string for anything over that. If we determine that it&apos;s not necessary to store it for avro, don&apos;t store it at all. Or if we can solve the length problem for all serdes, then that&apos;s probably the the right way to go.&lt;/p&gt;</comment>
                            <comment id="14949678" author="sershe" created="Fri, 9 Oct 2015 00:36:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt; the updated patch takes the route of not storing it at all.&lt;br/&gt;
Also, it&apos;s also problem for other RDBMSes (if it is ever used); Oracle fails, MySQL truncates it silently in my setup, others I haven&apos;t tested, probably one of the two.&lt;/p&gt;</comment>
                            <comment id="14950976" author="sershe" created="Fri, 9 Oct 2015 18:48:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt; does the updated patch address your concern? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14951251" author="xuefuz" created="Fri, 9 Oct 2015 21:43:26 +0000"  >&lt;p&gt;I&apos;m not sure if not storing the types in metastore poses a problem for the following use case: user is able to create an ARVO table without giving an external schema, such as &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;create table j2 (a &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) stored as avro;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;See some comments in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11827&quot; title=&quot;STORED AS AVRO fails SELECT COUNT(*) when empty&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11827&quot;&gt;&lt;del&gt;HIVE-11827&lt;/del&gt;&lt;/a&gt;. However, I guess the test will catch it if so.&lt;/p&gt;

&lt;p&gt;On the other hand, I really think that we should address the 4000 character limitation somehow as the problem can happen to serdes other than AVRO. &lt;/p&gt;</comment>
                            <comment id="14951778" author="hiveqa" created="Sat, 10 Oct 2015 10:44:43 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12765687/HIVE-11985.02.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12765687/HIVE-11985.02.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 10 failed/errored test(s), 9657 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_alter1
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_avro_add_column
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_avro_add_column2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_avro_add_column3
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_index_serde
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_partition_wise_fileformat17
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_schemeAuthority2
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
org.apache.hive.hcatalog.hbase.TestPigHBaseStorageHandler.org.apache.hive.hcatalog.hbase.TestPigHBaseStorageHandler
org.apache.hive.jdbc.TestSSL.testSSLVersion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5594/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5594/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5594/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5594/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5594/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5594/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 10 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12765687 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14958049" author="sershe" created="Thu, 15 Oct 2015 00:05:08 +0000"  >&lt;p&gt;Account for serdes that allow both options&lt;/p&gt;</comment>
                            <comment id="14959575" author="hiveqa" created="Thu, 15 Oct 2015 20:39:26 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12766685/HIVE-11985.03.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12766685/HIVE-11985.03.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 5 failed/errored test(s), 9697 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_alter1
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_explainuser_1
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_explainuser_3
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
org.apache.hive.jdbc.TestSSL.testSSLVersion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5665/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5665/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5665/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5665/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5665/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5665/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 5 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12766685 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14959943" author="sershe" created="Fri, 16 Oct 2015 00:39:49 +0000"  >&lt;p&gt;I don&apos;t understand the (old) alter serde logic at all... it only sets fields if the new serde doesn&apos;t have metastore-based schema. That doesn&apos;t make any sense.&lt;/p&gt;</comment>
                            <comment id="14961849" author="hiveqa" created="Sat, 17 Oct 2015 11:14:32 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12766940/HIVE-11985.05.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12766940/HIVE-11985.05.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 5 failed/errored test(s), 9700 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_udf_explode
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_udtf_explode
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
org.apache.hive.hcatalog.hbase.TestPigHBaseStorageHandler.org.apache.hive.hcatalog.hbase.TestPigHBaseStorageHandler
org.apache.hive.jdbc.TestSSL.testSSLVersion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5688/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5688/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5688/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5688/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5688/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5688/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 5 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12766940 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14967498" author="sershe" created="Wed, 21 Oct 2015 17:24:28 +0000"  >&lt;p&gt;The HCatalog test failed due to some unrelated cluster setup issue:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caused by: java.io.FileNotFoundException: File file:/tmp/hadoop-yarn/staging/history/done does not exist
	at org.apache.hadoop.fs.RawLocalFileSystem.listStatus(RawLocalFileSystem.java:376)
	at org.apache.hadoop.fs.DelegateToFileSystem.listStatus(DelegateToFileSystem.java:149)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It passes locally. The others were broken on master at the time.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gates&quot; class=&quot;user-hover&quot; rel=&quot;gates&quot;&gt;gates&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; can you take a look at the latest patch?&lt;/p&gt;</comment>
                            <comment id="14968111" author="xuefuz" created="Wed, 21 Oct 2015 22:50:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt;, could you explained a little on your new approach. I cannot follow through the patch to the extent of full understanding. It would be nice if a RB entry can be provided as the changes have become non-trial.&lt;/p&gt;</comment>
                            <comment id="14968117" author="sershe" created="Wed, 21 Oct 2015 22:56:02 +0000"  >&lt;p&gt;RB is available at &lt;a href=&quot;https://reviews.apache.org/r/38862/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/38862/&lt;/a&gt;.&lt;br/&gt;
The recent changes only fix the corner case like alter table add serde, otherwise approach is the same; when the serde is deserializer-based for schema, it doesn&apos;t store columns in Metastore. For Avro, based on how table is set up, both storing and not storing the schema is supported.&lt;/p&gt;</comment>
                            <comment id="14968510" author="xuefuz" created="Thu, 22 Oct 2015 04:14:34 +0000"  >&lt;p&gt;Let me try to summarize what we get from this: we error out in case of long type names (&amp;gt;2000c) with this patch, while previously we just store whatever the user gives, which may end up with truncation. In previous case, user may be able to avoid the truncation by manipulating DB configuration, but now w/ this patch, such manipulation will not work any more.&lt;/p&gt;

&lt;p&gt;Correct me if I&apos;m off.&lt;/p&gt;</comment>
                            <comment id="14968519" author="sershe" created="Thu, 22 Oct 2015 04:24:41 +0000"  >&lt;p&gt;In the previous case, we stored what was in the schema; on some DBs it could be truncated and on some DBs it would make it impossible to create the table (Oracle). In the former case the truncation will not actually be visible to the user, because metastore values are never used, wrong data is stored in metastore. In any case, it is not always possible to get rid of truncation because varchar (e.g. in Oracle) is limited, you cannot make the column bigger than the limit.&lt;br/&gt;
I think there&apos;s also a risk from storing values in metastore in this case, because if someone were to actually use the values, it would be incorrect.&lt;br/&gt;
For example, if schema is changed, and someone takes the type from metastore, type will be incorrect; or, if someone tries to make changes in metastore as normal from some new code in Hive, these changes will be ignored because schema comes from deserializer.&lt;br/&gt;
The patch changes logic to not store values when they should not be used.&lt;/p&gt;</comment>
                            <comment id="14969610" author="xuefuz" created="Thu, 22 Oct 2015 18:37:02 +0000"  >&lt;p&gt;Thanks for the explanation. I reviewed the patch, but I&apos;m afraid my knowledge is not good enough to grant a +1. It would be great if others can also review.&lt;/p&gt;

&lt;p&gt;Nevertheless, I do favor A solution that solves the long type name issue.&lt;/p&gt;</comment>
                            <comment id="14975583" author="sershe" created="Tue, 27 Oct 2015 02:55:37 +0000"  >&lt;p&gt;Filed &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-12269&quot; title=&quot;workaround for the issue with schema-based serdes storing types in metastore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-12269&quot;&gt;&lt;del&gt;HIVE-12269&lt;/del&gt;&lt;/a&gt; to truncate the type name. I don&apos;t think it makes sense to add blob type column, which is handled differently between most rdbms-es, with upgrade scripts, doing a lot of work, testing, and adding support burden, for the problem that doesn&apos;t exist (these types in metastore are utterly pointless)&lt;/p&gt;</comment>
                            <comment id="14977157" author="sushanth" created="Tue, 27 Oct 2015 20:58:34 +0000"  >&lt;p&gt;For most things that muck with the typesystem in hive, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdere&quot; class=&quot;user-hover&quot; rel=&quot;jdere&quot;&gt;jdere&lt;/a&gt; is my go-to person to check with. Tagging him here.&lt;/p&gt;</comment>
                            <comment id="14977331" author="ashutoshc" created="Tue, 27 Oct 2015 23:00:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt; Can you confirm my understanding of the patch?&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;If serde doesnt belong in config &lt;tt&gt;hive.serdes.using.metastore.for.schema&lt;/tt&gt; schema is always stored in metastore. Patch introduces a check which will disallow type &amp;gt; 2K for this case.&lt;/li&gt;
	&lt;li&gt;If serde doesn&apos;t belong in that config, then we enquire serde whether he wants to store its schema or not in metastore. If it say yes, then we store it with the above check.  Else, we store &lt;tt&gt;erived from deserializer&lt;/tt&gt; as type for it.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think this strategy does make sense. We can additionally get rid of  config &lt;tt&gt;hive.serdes.using.metastore.for.schema&lt;/tt&gt; now that a method of same effect has been added.&lt;/p&gt;</comment>
                            <comment id="14977371" author="sershe" created="Tue, 27 Oct 2015 23:37:26 +0000"  >&lt;p&gt;The method requires one to instantiate the SerDe. I wonder if it makes sense to keep it for the quick check. Btw there&apos;s also &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-12269&quot; title=&quot;workaround for the issue with schema-based serdes storing types in metastore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-12269&quot;&gt;&lt;del&gt;HIVE-12269&lt;/del&gt;&lt;/a&gt; for less intrusive patch for now.&lt;/p&gt;</comment>
                            <comment id="14977377" author="ashutoshc" created="Tue, 27 Oct 2015 23:40:26 +0000"  >&lt;p&gt;I think we should proceed with this patch, rather than workaround unless someone feels otherwise. &lt;br/&gt;
We instantiate Serde anyways, I think it makes sense to remove that config. But that we can take up on follow-on jira.&lt;br/&gt;
+1&lt;/p&gt;</comment>
                            <comment id="14978538" author="xuefuz" created="Wed, 28 Oct 2015 14:48:36 +0000"  >&lt;p&gt;Shouldn&apos;t we wait for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-12274&quot; title=&quot;Increase width of columns used for general configuration in the metastore.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-12274&quot;&gt;&lt;del&gt;HIVE-12274&lt;/del&gt;&lt;/a&gt;, which would solve root cause of the problem as well for this?&lt;/p&gt;</comment>
                            <comment id="14978697" author="ashutoshc" created="Wed, 28 Oct 2015 16:34:04 +0000"  >&lt;p&gt;Although &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-12274&quot; title=&quot;Increase width of columns used for general configuration in the metastore.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-12274&quot;&gt;&lt;del&gt;HIVE-12274&lt;/del&gt;&lt;/a&gt; will ameliorate the problem, we will still need checks for max length, since on all RDBMS there is a limit on max length for varchar. In particular, Oracle where this problem was found length is limited to 4K, where we already are at. We can update length check for other DBs once, &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-12274&quot; title=&quot;Increase width of columns used for general configuration in the metastore.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-12274&quot;&gt;&lt;del&gt;HIVE-12274&lt;/del&gt;&lt;/a&gt; lands, but check is still needed, so I think this patch makes sense.&lt;/p&gt;</comment>
                            <comment id="14983406" author="sershe" created="Fri, 30 Oct 2015 21:53:38 +0000"  >&lt;p&gt;Committed to master.&lt;/p&gt;</comment>
                            <comment id="14983903" author="lefty@hortonworks.com" created="Sat, 31 Oct 2015 08:25:46 +0000"  >&lt;p&gt;No-doc note:  The configuration parameter &lt;b&gt;hive.serdes.using.metastore.for.schema&lt;/b&gt; (which gets changed by this patch) is deliberately undocumented because it&apos;s for internal use only.  See the comments on &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-6681&quot; title=&quot;Describe table sometimes shows &amp;quot;from deserializer&amp;quot; for column comments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-6681&quot;&gt;&lt;del&gt;HIVE-6681&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12908093">HIVE-12269</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13073283">HIVE-16710</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12908275">HIVE-12274</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12909079">HIVE-12299</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12919124">HIVE-12601</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12764326" name="HIVE-11985.01.patch" size="10765" author="sershe" created="Tue, 29 Sep 2015 21:45:34 +0000"/>
                            <attachment id="12765687" name="HIVE-11985.02.patch" size="10163" author="sershe" created="Thu, 8 Oct 2015 22:04:46 +0000"/>
                            <attachment id="12766685" name="HIVE-11985.03.patch" size="17970" author="sershe" created="Thu, 15 Oct 2015 00:05:08 +0000"/>
                            <attachment id="12766940" name="HIVE-11985.05.patch" size="20246" author="sershe" created="Fri, 16 Oct 2015 01:20:26 +0000"/>
                            <attachment id="12764155" name="HIVE-11985.patch" size="10797" author="sershe" created="Tue, 29 Sep 2015 01:52:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 3 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2mdw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>