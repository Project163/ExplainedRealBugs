<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:38:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-12189] The list in pushdownPreds of ppd.ExprWalkerInfo should not be allowed to grow very large</title>
                <link>https://issues.apache.org/jira/browse/HIVE-12189</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Some queries are very slow in compile time, for example following query&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;select * from tt1 nf 
join tt2 a1 on (nf.col1 = a1.col1 and nf.hdp_databaseid = a1.hdp_databaseid) 
join tt3 a2 on        (a2.col2 = a1.col2 and a2.col3 = nf.col3 and a2.hdp_databaseid = nf.hdp_databaseid) 
join tt4 a3 on              (a3.col4 = a2.col4 and a3.col3 = a2.col3) 
join tt5 a4 on     (a4.col4 = a2.col4 and a4.col5 = a2.col5 and a4.col3 = a2.col3 and a4.hdp_databaseid = nf.hdp_databaseid) 
join tt6 a5 on              (a5.col3 = a2.col3 and a5.col2 = a2.col2 and a5.hdp_databaseid = nf.hdp_databaseid) 
JOIN tt7 a6 ON (a2.col3 = a6.col3 and a2.col2 = a6.col2 and a6.hdp_databaseid = nf.hdp_databaseid) 
JOIN tt8 a7 ON (a2.col3 = a7.col3 and a2.col2 = a7.col2 and a7.hdp_databaseid = nf.hdp_databaseid)
where nf.hdp_databaseid = 102 limit 10;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;takes around 120 seconds to compile in hive 1.1 when&lt;br/&gt;
hive.mapred.mode=strict;&lt;br/&gt;
hive.optimize.ppd=true;&lt;br/&gt;
and hive is not in test mode.&lt;br/&gt;
All the above tables are tables with one column as partition. But all the tables are empty table. If the tables are not empty, it is reported that the compile so slow that it looks like hive is hanging. &lt;br/&gt;
In hive 2.0, the compile is much faster, explain takes 6.6 seconds. But it is still a lot of time. One of the problem slows ppd down is that list in pushdownPreds can grow very large which makes extractPushdownPreds bad performance:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;public static ExprWalkerInfo extractPushdownPreds(OpWalkerInfo opContext,
    Operator&amp;lt;? extends OperatorDesc&amp;gt; op, List&amp;lt;ExprNodeDesc&amp;gt; preds)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;During run the query above, in the following break point preds  has size of 12051, and most entry of the list is: GenericUDFOPEqual(Column&lt;span class=&quot;error&quot;&gt;&amp;#91;hdp_databaseid&amp;#93;&lt;/span&gt;, Const int 102), GenericUDFOPEqual(Column&lt;span class=&quot;error&quot;&gt;&amp;#91;hdp_databaseid&amp;#93;&lt;/span&gt;, Const int 102), GenericUDFOPEqual(Column&lt;span class=&quot;error&quot;&gt;&amp;#91;hdp_databaseid&amp;#93;&lt;/span&gt;, Const int 102), GenericUDFOPEqual(Column&lt;span class=&quot;error&quot;&gt;&amp;#91;hdp_databaseid&amp;#93;&lt;/span&gt;, Const int 102), ....&lt;br/&gt;
Following code in extractPushdownPreds will clone all the nodes in preds and do the walk. Hive 2.0 is faster because &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11652&quot; title=&quot;Avoid expensive call to removeAll in DefaultGraphWalker&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11652&quot;&gt;&lt;del&gt;HIVE-11652&lt;/del&gt;&lt;/a&gt;(and other jiras) makes startWalking much faster, but we still clone thousands of nodes with same expression. Should we store so many same predicates in the list or just one is good enough?  &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    List&amp;lt;Node&amp;gt; startNodes = new ArrayList&amp;lt;Node&amp;gt;();
    List&amp;lt;ExprNodeDesc&amp;gt; clonedPreds = new ArrayList&amp;lt;ExprNodeDesc&amp;gt;();
    for (ExprNodeDesc node : preds) {
      ExprNodeDesc clone = node.clone();
      clonedPreds.add(clone);
      exprContext.getNewToOldExprMap().put(clone, node);
    }
    startNodes.addAll(clonedPreds);

    egw.startWalking(startNodes, null);

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Should we change java/org/apache/hadoop/hive/ql/ppd/ExprWalkerInfo.java&lt;br/&gt;
method &lt;br/&gt;
public void addFinalCandidate(String alias, ExprNodeDesc expr) &lt;br/&gt;
and&lt;br/&gt;
public void addPushDowns(String alias, List&amp;lt;ExprNodeDesc&amp;gt; pushDowns) &lt;/p&gt;

&lt;p&gt;to only add expr which is not in the PushDown list for an alias?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12905281">HIVE-12189</key>
            <summary>The list in pushdownPreds of ppd.ExprWalkerInfo should not be allowed to grow very large</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ychena">Yongzhi Chen</assignee>
                                    <reporter username="ychena">Yongzhi Chen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 Oct 2015 18:15:44 +0000</created>
                <updated>Tue, 16 Feb 2016 23:53:20 +0000</updated>
                            <resolved>Mon, 26 Oct 2015 06:26:07 +0000</resolved>
                                    <version>1.1.0</version>
                    <version>2.0.0</version>
                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>Logical Optimizer</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14960959" author="ychena" created="Fri, 16 Oct 2015 16:22:19 +0000"  >&lt;p&gt;With the patch, the explain drop to 2.* seconds.&lt;/p&gt;</comment>
                            <comment id="14962014" author="hiveqa" created="Sat, 17 Oct 2015 17:54:26 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12767094/HIVE-12189.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12767094/HIVE-12189.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 4 failed/errored test(s), 9702 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_udf_explode
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_udtf_explode
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
org.apache.hive.jdbc.TestSSL.testSSLVersion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5693/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5693/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5693/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5693/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5693/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5693/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12767094 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14962169" author="ychena" created="Sun, 18 Oct 2015 03:58:23 +0000"  >&lt;p&gt;The 4 failures are not related. Their ages are more than 14. &lt;/p&gt;</comment>
                            <comment id="14963281" author="ychena" created="Mon, 19 Oct 2015 13:14:36 +0000"  >&lt;p&gt;I did some comparing tests:&lt;br/&gt;
1. Backported &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11652&quot; title=&quot;Avoid expensive call to removeAll in DefaultGraphWalker&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11652&quot;&gt;&lt;del&gt;HIVE-11652&lt;/del&gt;&lt;/a&gt; to HIVE 1.1 version, does not make compile much faster, it still took 102 seconds. So &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11652&quot; title=&quot;Avoid expensive call to removeAll in DefaultGraphWalker&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11652&quot;&gt;&lt;del&gt;HIVE-11652&lt;/del&gt;&lt;/a&gt; alone can not make egw.startWalking as fast as HIVE 2.0. I need find more jiras to backport.&lt;br/&gt;
2. Only apply the patch for this jira(&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-12189&quot; title=&quot;The list in pushdownPreds of ppd.ExprWalkerInfo should not be allowed to grow very large&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-12189&quot;&gt;&lt;del&gt;HIVE-12189&lt;/del&gt;&lt;/a&gt;), the compile time for the query drop to 6.2 seconds for HIVE 1.1. &lt;br/&gt;
3. For HIVE 2.0, this patch help drop the compile time from 6.6 second to 2.3&lt;/p&gt;</comment>
                            <comment id="14965444" author="ychena" created="Tue, 20 Oct 2015 17:41:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=csun&quot; class=&quot;user-hover&quot; rel=&quot;csun&quot;&gt;csun&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ctang.ma&quot; class=&quot;user-hover&quot; rel=&quot;ctang.ma&quot;&gt;ctang.ma&lt;/a&gt; could you review the change? Thanks&lt;/p&gt;</comment>
                            <comment id="14967713" author="csun" created="Wed, 21 Oct 2015 19:21:49 +0000"  >&lt;p&gt;Sorry, didn&apos;t see this. I&apos;ll take a look at the patch today.&lt;/p&gt;</comment>
                            <comment id="14967804" author="ashutoshc" created="Wed, 21 Oct 2015 20:21:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jcamachorodriguez&quot; class=&quot;user-hover&quot; rel=&quot;jcamachorodriguez&quot;&gt;jcamachorodriguez&lt;/a&gt; This one might interest you.&lt;/p&gt;</comment>
                            <comment id="14968542" author="csun" created="Thu, 22 Oct 2015 04:41:33 +0000"  >&lt;p&gt;Patch looks good to me. +1. I don&apos;t think we should add predicates that are semantically the same.&lt;/p&gt;</comment>
                            <comment id="14973803" author="csun" created="Mon, 26 Oct 2015 06:26:07 +0000"  >&lt;p&gt;Committed to branch-1 and master. Thanks Yongzhi.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12767094" name="HIVE-12189.1.patch" size="1400" author="ychena" created="Fri, 16 Oct 2015 16:22:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 4 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2n2r3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>