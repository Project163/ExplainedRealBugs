<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:56:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-16886] HMS log notifications may have duplicated event IDs if multiple HMS are running concurrently</title>
                <link>https://issues.apache.org/jira/browse/HIVE-16886</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;When running multiple Hive Metastore servers and DB notifications are enabled, I could see that notifications can be persisted with a duplicated event ID. &lt;/p&gt;

&lt;p&gt;This does not happen when running multiple threads in a single HMS node due to the locking acquired on the DbNotificationsLog class, but multiple HMS could cause conflicts.&lt;/p&gt;

&lt;p&gt;The issue is in the ObjectStore#addNotificationEvent() method. The event ID fetched from the datastore is used for the new notification, incremented in the server itself, then persisted or updated back to the datastore. If 2 servers read the same ID, then these 2 servers write a new notification with the same ID.&lt;/p&gt;

&lt;p&gt;The event ID is not unique nor a primary key.&lt;/p&gt;

&lt;p&gt;Here&apos;s a test case using the TestObjectStore class that confirms this issue:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;@Test
  public void testConcurrentAddNotifications() throws ExecutionException, InterruptedException {
    final int NUM_THREADS = 2;
    CountDownLatch countIn = new CountDownLatch(NUM_THREADS);
    CountDownLatch countOut = new CountDownLatch(1);

    HiveConf conf = new HiveConf();
    conf.setVar(HiveConf.ConfVars.METASTORE_EXPRESSION_PROXY_CLASS, MockPartitionExpressionProxy.class.getName());

    ExecutorService executorService = Executors.newFixedThreadPool(NUM_THREADS);
    FutureTask&amp;lt;Void&amp;gt; tasks[] = new FutureTask[NUM_THREADS];
    for (int i=0; i&amp;lt;NUM_THREADS; i++) {
      final int n = i;

      tasks[i] = new FutureTask&amp;lt;Void&amp;gt;(new Callable&amp;lt;Void&amp;gt;() {
        @Override
        public Void call() throws Exception {
          ObjectStore store = new ObjectStore();
          store.setConf(conf);

          NotificationEvent dbEvent =
              new NotificationEvent(0, 0, EventMessage.EventType.CREATE_DATABASE.toString(), &quot;CREATE DATABASE DB&quot; + n);

          System.out.println(&quot;ADDING NOTIFICATION&quot;);
          countIn.countDown();
          countOut.await();
          store.addNotificationEvent(dbEvent);
          System.out.println(&quot;FINISH NOTIFICATION&quot;);

          return null;
        }
      });

      executorService.execute(tasks[i]);
    }

    countIn.await();
    countOut.countDown();

    for (int i = 0; i &amp;lt; NUM_THREADS; ++i) {
      tasks[i].get();
    }

    NotificationEventResponse eventResponse = objectStore.getNextNotification(new NotificationEventRequest());
    Assert.assertEquals(2, eventResponse.getEventsSize());
    Assert.assertEquals(1, eventResponse.getEvents().get(0).getEventId());

    // This fails because the next notification has an event ID = 1
    Assert.assertEquals(2, eventResponse.getEvents().get(1).getEventId());
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The last assertion fails expecting an event ID 1 instead of 2. &lt;/p&gt;</description>
                <environment></environment>
        <key id="13079310">HIVE-16886</key>
            <summary>HMS log notifications may have duplicated event IDs if multiple HMS are running concurrently</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anishek">Anishek Agarwal</assignee>
                                    <reporter username="spena">Sergio Pe&#241;a</reporter>
                        <labels>
                            <label>TODOC3.0</label>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 12 Jun 2017 21:00:12 +0000</created>
                <updated>Fri, 27 Jul 2018 05:14:21 +0000</updated>
                            <resolved>Mon, 11 Sep 2017 08:14:45 +0000</resolved>
                                    <version>2.3.2</version>
                    <version>2.3.3</version>
                    <version>3.0.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>Hive</component>
                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                                                                                                            <comments>
                            <comment id="16047058" author="spena" created="Mon, 12 Jun 2017 21:01:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thejas&quot; class=&quot;user-hover&quot; rel=&quot;thejas&quot;&gt;thejas&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sushanth&quot; class=&quot;user-hover&quot; rel=&quot;sushanth&quot;&gt;sushanth&lt;/a&gt; Have you experience this issue before? Do you have multiple HMS running in parallel?&lt;/p&gt;</comment>
                            <comment id="16047344" author="thejas" created="Tue, 13 Jun 2017 02:20:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anishek&quot; class=&quot;user-hover&quot; rel=&quot;anishek&quot;&gt;anishek&lt;/a&gt; created &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-16738&quot; title=&quot;Notification ID generation in DBNotification might not be unique across HS2 instances.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-16738&quot;&gt;&lt;del&gt;HIVE-16738&lt;/del&gt;&lt;/a&gt; where he commented that this is possible in a single metastore case itself. However, I am not sure if we have seen that in practice so far.&lt;br/&gt;
I guess you are right about the multi-metastore case as well. &lt;/p&gt;

&lt;p&gt;What happens when the table goes into that state ? Does DbNotifcationListener start erroring out ?&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anishek&quot; class=&quot;user-hover&quot; rel=&quot;anishek&quot;&gt;anishek&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sushanth&quot; class=&quot;user-hover&quot; rel=&quot;sushanth&quot;&gt;sushanth&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sankarh&quot; class=&quot;user-hover&quot; rel=&quot;sankarh&quot;&gt;sankarh&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="16047347" author="thejas" created="Tue, 13 Jun 2017 02:25:59 +0000"  >&lt;p&gt;FYI, A different issue that we observed in a production system was slowness in UPDATE queries in this table. We haven&apos;t got to the bottom of that issue yet -&lt;/p&gt;

&lt;p&gt;There was slowness seen around the following query -&lt;/p&gt;

&lt;p&gt;Pasting from slow query logs in that jira -&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;UPDATE `NOTIFICATION_SEQUENCE` SET `NEXT_EVENT_ID`=XXXX94 WHERE `NNI_ID`=1;
# Query_time: 236.294821  Lock_time: 0.000044 Rows_sent: 0  Rows_examined: 1
UPDATE `NOTIFICATION_SEQUENCE` SET `NEXT_EVENT_ID`=XXXX94 WHERE `NNI_ID`=1;
# Query_time: 222.241997  Lock_time: 0.000049 Rows_sent: 0  Rows_examined: 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There is also lot updates that was happening with same next_event_id seen in that -&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;grep NOTIFICATION_SEQUENCE  mysql-slowquery.log  |sort | uniq -c
 830 UPDATE `NOTIFICATION_SEQUENCE` SET `NEXT_EVENT_ID`=XXXX43 WHERE `NNI_ID`=1;
  13 UPDATE `NOTIFICATION_SEQUENCE` SET `NEXT_EVENT_ID`=XXXX44 WHERE `NNI_ID`=1;
..
..
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(masked some digits in what is pasted above)&lt;/p&gt;</comment>
                            <comment id="16047409" author="anishek" created="Tue, 13 Jun 2017 04:38:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-16738&quot; title=&quot;Notification ID generation in DBNotification might not be unique across HS2 instances.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-16738&quot;&gt;&lt;del&gt;HIVE-16738&lt;/del&gt;&lt;/a&gt; also refers to the problem of multiple events getting same id in case of multiple Hive metastore instances. The lock has to be at the db level to get unique ids.&lt;/p&gt;</comment>
                            <comment id="16047411" author="akolb" created="Tue, 13 Jun 2017 04:42:45 +0000"  >&lt;p&gt;The problem when this happens is that some events are lost and consumers who depend on them may get into an inconsistent state.&lt;/p&gt;

&lt;p&gt;The slowness may be caused by the fact that such Read-Modify-Write on a single row involves a row lock, so concurrent threads doing updates contend on the same row lock.&lt;/p&gt;</comment>
                            <comment id="16047678" author="anishek" created="Tue, 13 Jun 2017 10:06:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akolb&quot; class=&quot;user-hover&quot; rel=&quot;akolb&quot;&gt;akolb&lt;/a&gt; In DBNotificationListener the events will still get logged with some of them having the same id, If the consumer of the events is using the event id (which is reasonable) and processing them assuming there is going to be unique event ids per event then such consumers will lead to inconsistent data. We definitely need this fixing as part of replication v2.&lt;/p&gt;</comment>
                            <comment id="16048558" author="akolb" created="Wed, 14 Jun 2017 00:43:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anishek&quot; class=&quot;user-hover&quot; rel=&quot;anishek&quot;&gt;anishek&lt;/a&gt; This means that some events may not have a defined order - correct? This also makes consumer job very tricky since it doesn&apos;t know whether it processed all events or not. Consumers may be running on different processes - the only thing they may know is what event ID they processed. If we have multiple events with the same ID they will not know that.&lt;/p&gt;</comment>
                            <comment id="16048694" author="anishek" created="Wed, 14 Jun 2017 04:27:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akolb&quot; class=&quot;user-hover&quot; rel=&quot;akolb&quot;&gt;akolb&lt;/a&gt; yeh agree with it.&lt;/p&gt;</comment>
                            <comment id="16048842" author="akolb" created="Wed, 14 Jun 2017 08:16:03 +0000"  >&lt;p&gt;A reasonable way to make it unique is &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Declare a unique constraint&lt;/li&gt;
	&lt;li&gt;Add a new value into a separate row&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It would be good to have some retry transaction logic, but it may be a bigger change. &lt;/p&gt;</comment>
                            <comment id="16050043" author="anishek" created="Thu, 15 Jun 2017 06:13:23 +0000"  >&lt;p&gt;Another mode to achieve the same would be the way hibernate versioning works, there seems to be a jdo versioning available which looks the same. &lt;/p&gt;</comment>
                            <comment id="16050065" author="akolb" created="Thu, 15 Jun 2017 06:39:44 +0000"  >&lt;p&gt;Can you clarify what versioning scheme you have in mind?&lt;/p&gt;</comment>
                            <comment id="16050122" author="anishek" created="Thu, 15 Jun 2017 07:57:40 +0000"  >&lt;p&gt;&lt;a href=&quot;http://www.datanucleus.org/products/accessplatform_4_1/jdo/versioning.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.datanucleus.org/products/accessplatform_4_1/jdo/versioning.html&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="16051154" author="akolb" created="Thu, 15 Jun 2017 22:14:37 +0000"  >&lt;p&gt;This is used in connection with Optimistic transactions are they used by ObjectStore? I was investigating the use of application-based versioning a while ago but couldn&apos;t find a single example of how it could be used.&lt;/p&gt;</comment>
                            <comment id="16051390" author="anishek" created="Fri, 16 Jun 2017 05:19:24 +0000"  >&lt;p&gt;Not sure which transaction isolation level across sql db&apos;s (that metastore supports) translates to optimistic transactions. I have used this with hibernate versioning and it worked very well. I saw this on DataNucleus as well so I think will require some work to identify how well it fits our use case. &lt;/p&gt;
</comment>
                            <comment id="16051394" author="akolb" created="Fri, 16 Jun 2017 05:25:56 +0000"  >&lt;p&gt;For DataNucleus this is orthogonal to transaction isolation level and can be enabled for specific transactions. &lt;/p&gt;</comment>
                            <comment id="16051522" author="anishek" created="Fri, 16 Jun 2017 07:31:44 +0000"  >&lt;p&gt;just to understand it better, isolation level is for updates where as locking seems to be for reads and i can get later with specific sql constructs within a isolation level. &lt;/p&gt;

&lt;p&gt;for ex with mysql:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &amp;lt;name&amp;gt;datanucleus.transactionIsolation&amp;lt;/name&amp;gt;
    &amp;lt;value&amp;gt;read-committed&amp;lt;/value&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but then fire a &lt;tt&gt;select ... for lock in share mode&lt;/tt&gt;  rather than &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &amp;lt;name&amp;gt;datanucleus.transactionIsolation&amp;lt;/name&amp;gt;
    &amp;lt;value&amp;gt;serializable&amp;lt;/value&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;would be same right ?&lt;/p&gt;

&lt;p&gt;anyways jdo versioning &lt;br/&gt;
&lt;a href=&quot;http://www.datanucleus.org/products/accessplatform_4_1/jdo/versioning.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.datanucleus.org/products/accessplatform_4_1/jdo/versioning.html&lt;/a&gt;&lt;br/&gt;
with transaction locking &lt;em&gt;&lt;b&gt;&quot;Optimistic Locking&quot;&lt;/b&gt;&lt;/em&gt; in&lt;br/&gt;
&lt;a href=&quot;http://www.datanucleus.org/products/accessplatform_4_1/jdo/transactions.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.datanucleus.org/products/accessplatform_4_1/jdo/transactions.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;so we should be able to get it by adding a column &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;      &amp;lt;version strategy=&lt;span class=&quot;code-quote&quot;&gt;&quot;version-number&quot;&lt;/span&gt; column=&lt;span class=&quot;code-quote&quot;&gt;&quot;VERSION&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;field name=&lt;span class=&quot;code-quote&quot;&gt;&quot;version&quot;&lt;/span&gt;&amp;gt;
              &amp;lt;column name=&lt;span class=&quot;code-quote&quot;&gt;&quot;VERSION&quot;&lt;/span&gt; jdbc-type=&lt;span class=&quot;code-quote&quot;&gt;&quot;BIGINT&quot;&lt;/span&gt; allows-&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;
            &amp;lt;/field&amp;gt;
      &amp;lt;/version&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;in  &lt;tt&gt;MNotificationNextId&lt;/tt&gt;&lt;/p&gt;
</comment>
                            <comment id="16065643" author="akolb" created="Tue, 27 Jun 2017 23:09:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anishek&quot; class=&quot;user-hover&quot; rel=&quot;anishek&quot;&gt;anishek&lt;/a&gt; What is the default isolation used by HMS? I think it is read-committed - right?&lt;br/&gt;
I suspect that select ... for update is pretty heavy lock. In similar situations in Apache Sentry we rely on uniqueness constraint on the primary key (or on the unique key), effectively simulating optimistic locking.&lt;/p&gt;

&lt;p&gt;When I looked at DataNucleus optimistic support, it wasn&apos;t clear how to use it with the column that is managed by the application rather then DN itself.&lt;/p&gt;</comment>
                            <comment id="16105271" author="spena" created="Fri, 28 Jul 2017 16:39:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anishek&quot; class=&quot;user-hover&quot; rel=&quot;anishek&quot;&gt;anishek&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thejas&quot; class=&quot;user-hover&quot; rel=&quot;thejas&quot;&gt;thejas&lt;/a&gt; While running some tests with duplicated events IDs in HMS HA mode, I see that the NL_ID is never duplicated and is always consecutive and in order. Do you know why we&apos;re not using this ID instead? Seems more consistent and better to use.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akolb&quot; class=&quot;user-hover&quot; rel=&quot;akolb&quot;&gt;akolb&lt;/a&gt; FYI&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[hive1]&amp;gt; select NL_ID, EVENT_ID, EVENT_TIME, EVENT_TYPE, DB_NAME from NOTIFICATION_LOG where NL_ID &amp;gt;= 5431 and NL_ID &amp;lt;= 5440;
+-------+----------+------------+-----------------+----------------------------------------+
| NL_ID | EVENT_ID | EVENT_TIME | EVENT_TYPE      | DB_NAME                                |
+-------+----------+------------+-----------------+----------------------------------------+
|  5431 |     5094 | 1501109698 | CREATE_DATABASE | metastore_test_db_HIVE_HIVEMETASTORE_2 |
|  5432 |     5097 | 1501109698 | CREATE_TABLE    | metastore_test_db_HIVE_HIVEMETASTORE_2 |
|  5433 |     5098 | 1501109699 | ADD_PARTITION   | metastore_test_db_HIVE_HIVEMETASTORE_2 |
|  5434 |     5101 | 1501109791 | DROP_TABLE      | metastore_test_db_HIVE_HIVEMETASTORE_2 |
|  5435 |     5104 | 1501109792 | DROP_DATABASE   | metastore_test_db_HIVE_HIVEMETASTORE_2 |
|  5436 |     5096 | 1501109698 | CREATE_DATABASE | metastore_test_db_HIVE_HIVEMETASTORE_1 |
|  5437 |     5097 | 1501109698 | CREATE_TABLE    | metastore_test_db_HIVE_HIVEMETASTORE_1 |
|  5438 |     5100 | 1501109699 | ADD_PARTITION   | metastore_test_db_HIVE_HIVEMETASTORE_1 |
|  5439 |     5102 | 1501109791 | DROP_TABLE      | metastore_test_db_HIVE_HIVEMETASTORE_1 |
|  5440 |     5105 | 1501109792 | DROP_DATABASE   | metastore_test_db_HIVE_HIVEMETASTORE_1 |
+-------+----------+------------+-----------------+----------------------------------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16105274" author="spena" created="Fri, 28 Jul 2017 16:40:31 +0000"  >&lt;p&gt;Btw, the getNextNotification() method fetches all notifications after an EVENT_ID &amp;gt; X, so if we already fetched EVENT_ID = 5098, then the getNextNotification won&apos;t fetch those events after 5098 that are less than 5098. Seems we can get it better with NL_ID&lt;/p&gt;</comment>
                            <comment id="16106834" author="anishek" created="Mon, 31 Jul 2017 05:51:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt; I am not exactly sure why we dont use the NotificationLog Id, i think there is some limitation when we use ORACLE db as metastore RDBMS, I think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thejas&quot; class=&quot;user-hover&quot; rel=&quot;thejas&quot;&gt;thejas&lt;/a&gt; might be able to provide a more definitive answer, but &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;the test above would be more comprehensive if you can provide an example of unique NL_ID with duplicate EVENT_ID.&lt;/li&gt;
	&lt;li&gt;looking at the mapping NL_ID is generated using &lt;b&gt;native&lt;/b&gt; strategy which falls back to sequence/identity/increment for different DB, the default values for these strategies will differ based on which underlying db is used, if &lt;b&gt;increment&lt;/b&gt; gets used anywhere then in HMS HA mode there will be a cache of 10 sequence numbers that Datanuclues will maintain and this will definitely lead to duplicates / failues( since we have PK constraint), we might want to add additional retry logic in that case.&lt;/li&gt;
	&lt;li&gt;if we can move to &lt;b&gt;sequence&lt;/b&gt; based identity strategy generation for NL_ID that will be great, though might have to look if all supported rdbms will work with them.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16107393" author="spena" created="Mon, 31 Jul 2017 15:00:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anishek&quot; class=&quot;user-hover&quot; rel=&quot;anishek&quot;&gt;anishek&lt;/a&gt; Got it, I will run some tests with ORACLE db as well to see if we have the same behavior. Btw, the above example has a duplicated EVENT_ID with a different NL_ID, here&apos;re the lines:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;|  5432 |     5097 | 1501109698 | CREATE_TABLE    | metastore_test_db_HIVE_HIVEMETASTORE_2 |

|  5437 |     5097 | 1501109698 | CREATE_TABLE    | metastore_test_db_HIVE_HIVEMETASTORE_1 |
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;tt&gt;HIVE_HIVEMETASTORE_N&lt;/tt&gt; is a row written by a different HMS. In this cases we have HMS 1 and HMS 2 writing the same event ID.&lt;/p&gt;</comment>
                            <comment id="16111172" author="anishek" created="Wed, 2 Aug 2017 16:09:56 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt; i didnt realize there were additional rows in between the two.&lt;/p&gt;</comment>
                            <comment id="16111366" author="akolb" created="Wed, 2 Aug 2017 17:26:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lina.li&quot; class=&quot;user-hover&quot; rel=&quot;lina.li&quot;&gt;lina.li&lt;/a&gt; This issue may be interesting for you as well.&lt;/p&gt;</comment>
                            <comment id="16119497" author="anishek" created="Wed, 9 Aug 2017 06:52:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt; are you working on this one ? if not i am planning to have a go at it.&lt;/p&gt;</comment>
                            <comment id="16121179" author="anishek" created="Thu, 10 Aug 2017 07:10:31 +0000"  >&lt;p&gt;for the supported database NL_ID will be generated either using the &lt;b&gt;auto_increment&lt;/b&gt; or &lt;b&gt;identity&lt;/b&gt; column, the problem though is column mappings of type &lt;b&gt;datastore-identity&lt;/b&gt; cannot be mapped by datanucleus to the java representation of the notification log member variable, which means replication will not work since the event id is serialized to a file.  hence we cant use NL_ID.&lt;/p&gt;</comment>
                            <comment id="16126371" author="spena" created="Mon, 14 Aug 2017 20:50:09 +0000"  >&lt;p&gt;I read on the datanucleus doc that those datastore-identity objects may be accessed by something like &lt;tt&gt;Object id = pm.getObjectId(obj);&lt;/tt&gt;, do you know how if that would work? can we read and add the NL_ID into the object to be returned back to the client?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.datanucleus.org/products/datanucleus/jdo/datastore_identity.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.datanucleus.org/products/datanucleus/jdo/datastore_identity.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16128384" author="anishek" created="Wed, 16 Aug 2017 06:20:45 +0000"  >&lt;p&gt;Yeh we can do that though  we have to explicitly parse and typecast the data-store identity in metastore code. Additionally sql query in datanuclues has to be used instead of object query for &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; NotificationEventResponse getNextNotification(NotificationEventRequest rqst)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; in object store. &lt;/p&gt;

&lt;p&gt;I have the code in place which will address the current issue with the use of &lt;tt&gt;NL_ID&lt;/tt&gt; as event id and remove the use of &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;MNotificationNextId&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;EVENT_ID&lt;/tt&gt; from &lt;tt&gt;MNotificationLog&lt;/tt&gt; such that without modifying the metastore db schema, we just populate a default of value &quot;0&quot; for this column in db.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;though the problem is how do we manage deployments who are using repl v1 who are dependent on &lt;tt&gt;EVENT_ID&lt;/tt&gt; and with the new release suddenly will move to &lt;tt&gt;NL_ID&lt;/tt&gt;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;del&gt;one way is we map both &lt;tt&gt;NL_ID&lt;/tt&gt; and &lt;tt&gt;EVENT_ID&lt;/tt&gt;  in &lt;tt&gt;MNotificationLog&lt;/tt&gt; and the external tool based on the value of &lt;tt&gt;EVENT_ID=0&lt;/tt&gt; switches to using id&apos;s from &lt;tt&gt;NL_ID&lt;/tt&gt;&lt;/del&gt; looking at the code dont think this is possible as for getCurrentNotificationId we wont be able to make a distinction.&lt;/li&gt;
	&lt;li&gt;other way is to completely redo the whole replication deployment with repl v2 rather than repl v1.&lt;/li&gt;
	&lt;li&gt;if we make an assumption that the &lt;tt&gt;NL_ID&lt;/tt&gt; is always  &amp;gt; &lt;tt&gt;EVENT_ID&lt;/tt&gt; in existing metastore rdbms then we can do something to automatically shift user to new mapping by writing some additional code in the hivemetastore which looks at all previous events and if nothing found start using the new mapping.&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="16133389" author="spena" created="Fri, 18 Aug 2017 18:18:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anishek&quot; class=&quot;user-hover&quot; rel=&quot;anishek&quot;&gt;anishek&lt;/a&gt; I think we should keep the EVENT_ID as it is for now, and can add a new variable to the MNotificationLog that tracks the NL_ID. Then when getting new notifications, we can check for the NL_ID if the new variable has a value or fall back to the EVENT_ID if not. This way we can keep the compatibility with current clients using these notifications.&lt;/p&gt;

&lt;p&gt;Btw, in the Sentry side, we&apos;re going to request HMS notifications in a time window so that we can fetch these duplicated events IDs and reapply them in the client. Currently, HMS guarantees that IDs are committed in order but duplicated events could exist and committed later if an HMS server has delayed the transaction commit on the DB. &lt;/p&gt;</comment>
                            <comment id="16133437" author="thejas" created="Fri, 18 Aug 2017 18:39:22 +0000"  >&lt;p&gt;I think due to the flaws with current EVENT_ID, the NL_ID would be right value (from db) to use. Longer term we should just have one value and remove the EVENT_ID sourced information.&lt;br/&gt;
There are two possible approaches to switch to the new &apos;fixed&apos; value.&lt;br/&gt;
One is to introduce a new NL_ID field at api level (maybe EVENT_ID_V2 for clarity ?) and eventually drop EVENT_ID field from API. Other option is to just switch EVENT_ID field to values sourced from NL_ID. With second approach, no changes to applications are needed for the deprecation. Applications would get a bump in the event id numbers due to it being sourced from NL_ID which would be &amp;gt;= EVENT_ID nos (due to the duplicate issue).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt; What are your thoughts ? &lt;/p&gt;</comment>
                            <comment id="16135433" author="anishek" created="Mon, 21 Aug 2017 16:58:27 +0000"  >&lt;p&gt;I am just going to provide some more detail information so that we all get to understand what is happening with this bug.&lt;/p&gt;

&lt;p&gt;As of now the plan is to hopefully have a backward compatibility with replication v1, though primary focus is going to be fixing the issue of duplicate event ids with multiple HMS, which is specifically detrimental for replication v2, which is now going to replication point-in-time state of the database rather than the latest state as was  in repl v1. &lt;/p&gt;

&lt;p&gt;As for the fix, there are few tests i am going to fix and have a patch for all of you, hopefully today/tomorrow,  to review. &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;mapping for &lt;tt&gt;NOTIFICATION_SEQUENCE&lt;/tt&gt;  has been removed.&lt;/li&gt;
	&lt;li&gt;there are effectively two class mappings for &lt;tt&gt;NOTIFICATION_LOG&lt;/tt&gt; , one representing the current state namely using &lt;tt&gt;EVENT_ID&lt;/tt&gt; as event id and new implementation that will use &lt;tt&gt;NL_ID&lt;/tt&gt;, with the new mapping putting a default value of 0 for &lt;tt&gt;EVENT_ID&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;Backward compatibility in terms of replication v1 not being broken, should be possible if the following assumption holds in the metastore rdmbs : &lt;cite&gt;value of NL_ID is greater than the EVENT_ID for same rows, including only events that are not yet replicated to replica warehouse.&lt;/cite&gt;&lt;/li&gt;
	&lt;li&gt;Code to switch mappings in the metastore from &lt;tt&gt;EVENT_ID&lt;/tt&gt; to &lt;tt&gt;ND_ID&lt;/tt&gt; is in place, depending on what is required, For ex for existing repl v1, it will first provide all the events using the &lt;tt&gt;EVENT_ID&lt;/tt&gt; and post that start providing events with &lt;tt&gt;NL_ID&lt;/tt&gt; since &lt;tt&gt;NL_ID &amp;gt; EVENT_ID&lt;/tt&gt; it would allow existing setup to continue working.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16135733" author="spena" created="Mon, 21 Aug 2017 20:07:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anishek&quot; class=&quot;user-hover&quot; rel=&quot;anishek&quot;&gt;anishek&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thejas&quot; class=&quot;user-hover&quot; rel=&quot;thejas&quot;&gt;thejas&lt;/a&gt; Thanks for starting working on this. I have a few of comments about using NL_ID that we should keep in mind on the patch. This is based on some other tests we have done with datastore incremental IDs.&lt;/p&gt;

&lt;p&gt;1. Use the &lt;tt&gt;sequence&lt;/tt&gt; strategy on the NL_ID. This should keep increments atomic. However, we have found that these increments do not guarantee an order when committing them. We have seen commits ID of order 1,3,2 because of some delay in the transaction commit. We call this out-of-order as &apos;holes&apos; because when fetching updates we may get 1,3 only (2 is not there because will be committed later).&lt;/p&gt;

&lt;p&gt;2. To solve the holes problem on our client requests when getting new notifications, we should request them in a temporal order instead of ID order. To do that, we should write a new API to get notifications based on a timestamp instead of an ID. Timestamps will keep the order correctly.&lt;/p&gt;

&lt;p&gt;3. Use a SQL timestamp instead of using the one on DbNotificationListener#now() method. If possible, use a milliseconds timestamp, such as &lt;tt&gt;current_timestamp(6)&lt;/tt&gt; from SQL. The now() method run in different HMS servers may be different and may be out-of-sync having a weird order sometimes. We found that &lt;tt&gt;current_timestamp(6)&lt;/tt&gt; is executed at the moment of the SQL execution; so it is the best time we can get of the transaction.&lt;/p&gt;

&lt;p&gt;This next section only applies to what we do as a client requesting notifications (not part for the patch, but useful to know).&lt;/p&gt;

&lt;p&gt;On the client side, we sometimes do not request notifications for a period higher than the HMS clean-up thread. This means that we may miss notifications that were removed during that time. To avoid this issue on our side, we&apos;re requesting HMS notifications for a time window period and reapplying all of them for that time. If for some reason we get fewer notifications than expected, then we assume that older events were purged, and we may request a new HMS snapshot if necessary.&lt;/p&gt;</comment>
                            <comment id="16135840" author="anishek" created="Mon, 21 Aug 2017 21:09:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt; thanks for your insights.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Sequence is not present in Mysql 5.6 and MS SQL and hence using that as the datastore-identity strategy will not work for all supported databases (&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/AdminManual+MetastoreAdmin&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/Hive/AdminManual+MetastoreAdmin&lt;/a&gt;).&lt;/li&gt;
	&lt;li&gt;leaving it to &quot;native&quot; should work for us since the underlying column is a bigint and should result in numeric generation, I am not aware of a database generating, out of order numeric values when using &quot;auto-increment&quot;, do you know of any such use case ?&lt;/li&gt;
	&lt;li&gt;I like the sequential guarantee that point 3, provides, but this should happen only for concurrent transactions / queries / modifying disjoint operations. In such cases it should not matter if one is applied before the other or vice versa, the database would still be in valid state ? even if we use the current_timestamp from db it would result in similar order of events as we do currently such that you can get 1,3,2 because it will be enforced at database insert time and not when the operation started. From what I see point 1, looks like clients want the order of events to be the order in which they were started rather than the order which they were committed, where in the latter makes sense since at the database level that is how the events were applied.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Please let me know what you think ?&lt;/p&gt;</comment>
                            <comment id="16136027" author="anishek" created="Mon, 21 Aug 2017 23:43:26 +0000"  >&lt;p&gt;attaching patch for test run.&lt;/p&gt;</comment>
                            <comment id="16136029" author="akolb" created="Mon, 21 Aug 2017 23:46:47 +0000"  >&lt;p&gt;From what I saw all mechanisms supported by DataNucleus can not guarantee that there are no holes (although tehy deal with duplicates). There may be two kinds of holes - temporary ones (that will be filled later when transaction is committed) and permanent ones (which will be never filled in). &lt;/p&gt;

&lt;p&gt;MySQL InnoDB has a mechanism to provide no-holes semantics (&lt;a href=&quot;https://dev.mysql.com/doc/refman/5.7/en/innodb-auto-increment-handling.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.mysql.com/doc/refman/5.7/en/innodb-auto-increment-handling.html&lt;/a&gt;) but ir seems that Oracle and PostgreSQL don&apos;t have similar mechanisms.&lt;/p&gt;

&lt;p&gt;Holes create troubles for consumers. E.g. when consumer reads notification ID 10 some earlier IDs may be committed later so they may be skipped or not processed properly. Also, consumers have no way of knowing whether the hole will be filled in later (when corresponding transaction commits) or never (if the transaction that allocated ID fails).&lt;/p&gt;

&lt;p&gt;There is a way to guarantee that there re no holes and duplicates:&lt;/p&gt;

&lt;p&gt;a) Make the ID primary key (which doesn&apos;t allow duplicates)&lt;br/&gt;
b) As part of the transaction, read the value of ID, increment it by 1 and persist it.&lt;/p&gt;

&lt;p&gt;This approach guarantees that there are no holes or duplicates, but transactions can fail because of the ID conflicts, so it is important to retry such transactions. HMS doesn&apos;t provide per-transaction retries, but may be per-operation retries are Ok as well.&lt;/p&gt;</comment>
                            <comment id="16136555" author="hiveqa" created="Tue, 22 Aug 2017 09:22:52 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12883016/HIVE-16886.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12883016/HIVE-16886.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 2 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 26 failed/errored test(s), 10995 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[unionDistinct_1] (batchId=143)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=235)
org.apache.hadoop.hive.common.TestFileUtils.testCopyWithDistCpAs (batchId=250)
org.apache.hadoop.hive.common.TestFileUtils.testCopyWithDistcp (batchId=250)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testAlters (batchId=218)
org.apache.hive.hcatalog.api.TestHCatClient.testPartitionRegistrationWithCustomSchema (batchId=180)
org.apache.hive.hcatalog.api.TestHCatClient.testPartitionSpecRegistrationWithCustomSchema (batchId=180)
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation (batchId=180)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.addPartition (batchId=233)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.alterIndex (batchId=233)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.alterPartition (batchId=233)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.alterTable (batchId=233)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.createDatabase (batchId=233)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.createFunction (batchId=233)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.createIndex (batchId=233)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.createTable (batchId=233)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.dropDatabase (batchId=233)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.dropFunction (batchId=233)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.dropIndex (batchId=233)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.dropPartition (batchId=233)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.dropTable (batchId=233)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.exchangePartition (batchId=233)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.filter (batchId=233)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.insertPartition (batchId=233)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.insertTable (batchId=233)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6480/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6480/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6480/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6480/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-6480/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-6480/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 26 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12883016 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="16137459" author="spena" created="Tue, 22 Aug 2017 21:43:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anishek&quot; class=&quot;user-hover&quot; rel=&quot;anishek&quot;&gt;anishek&lt;/a&gt; I attached a patch that probes we can have holes when using datastore identity IF delays happen during the commit() transaction call. I made some modifications on the ObjectStore to allow seeing this behavior:&lt;/p&gt;

&lt;p&gt;getNextNotification() reads the NL_ID and replaces EVENT_ID with NL_ID so that I can read what the actual NL_ID was persisted.&lt;/p&gt;

&lt;p&gt;addNotificationEvent() has some count down latches that signal the persist and commit order. &lt;/p&gt;

&lt;p&gt;The problem we saw is that NL_ID is created on the &lt;tt&gt;makePersistent&lt;/tt&gt; call (sql execution), but it is not seen by getNextNotification() until is committed. This commit() may be delayed due to issues on network, GC or anything else. We run into this problem in Sentry when we were running several stress tests on a cluster with Sentry HA.&lt;/p&gt;

&lt;p&gt;Apply the patch on master, and run the test case:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ mvn test -Dtest=TestObjectStore#testDatanucleusHoles
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The test case have assertions to probe the hole, but to look at the actual holes, you can take a look at the log:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ cat metastore/target/surefire-reports/org.apache.hadoop.hive.metastore.TestObjectStore-output.txt

2017-08-22T14:36:06,090  INFO [main] metastore.TestObjectStore: 1st notification request will get only one event with ID = 2
2017-08-22T14:36:06,090  INFO [main] metastore.TestObjectStore: ID = 2, TYPE = null
2017-08-22T14:36:06,092  INFO [main] metastore.TestObjectStore: 2nd notification request should get last event ID = 2 and a new event with ID = 1
2017-08-22T14:36:06,092  INFO [main] metastore.TestObjectStore: ID = 1, TYPE = null
2017-08-22T14:36:06,092  INFO [main] metastore.TestObjectStore: ID = 2, TYPE = null
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16137596" author="anishek" created="Tue, 22 Aug 2017 23:27:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akolb&quot; class=&quot;user-hover&quot; rel=&quot;akolb&quot;&gt;akolb&lt;/a&gt; I agree to the  points you have made and i have been thinking, if we introduce another column with auto-increment and primary key constraint  at the db level and datanuclues having no mapping for the field, in this case the id will be given at commit time and not at makePersistent done in our code. only thing that kept me from doing this was doing db schema change for metastore but i think we need it here.&lt;/p&gt;</comment>
                            <comment id="16137616" author="akolb" created="Tue, 22 Aug 2017 23:40:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anishek&quot; class=&quot;user-hover&quot; rel=&quot;anishek&quot;&gt;anishek&lt;/a&gt; I was investigating this some time ago and seems like only MySQL with InnoDB has a mechanism to guarantee precise auto-increment without holes. Seems that neither Oracle nor PostgreSQL provide such mechanisms (please correct me if I am wrong - I am in no way a DB expert). I didn&apos;t find any generic way to achieve this without manually simulating &quot;optimistic transactions&quot; which means a combination of defining ID as a primary key and using something along these lines:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;OPEN TRANSACTION
perform_some_work()
id = retrieve max(id)
persist(id+1)
CLOSE TRANSACTION
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Because of the uniqueness constraint, this either succeeds and increments the value or fails due to a duplicate value. In both cases we have neither duplicates nor holes. We can never have a case where fort two IDs K and N where K &amp;lt; N, and K is committed after N.&lt;/p&gt;

&lt;p&gt;The current situation is bad not only because we have duplicates but also because when we read some value N, a smaller value K&amp;lt;N may still appear later and go undetected.&lt;/p&gt;</comment>
                            <comment id="16137620" author="akolb" created="Tue, 22 Aug 2017 23:42:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anishek&quot; class=&quot;user-hover&quot; rel=&quot;anishek&quot;&gt;anishek&lt;/a&gt; To clarify - what we discovered is that auto-increment allocates IDs not at commit time, so later values may be committed earlier then earlier values.&lt;/p&gt;</comment>
                            <comment id="16137621" author="akolb" created="Tue, 22 Aug 2017 23:44:36 +0000"  >&lt;p&gt;There is some discussions of pros and cons of alternative approaches in &lt;a href=&quot;https://issues.apache.org/jira/browse/SENTRY-1855&quot; title=&quot;Improve scalability of permission delta updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SENTRY-1855&quot;&gt;SENTRY-1855&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16137642" author="hiveqa" created="Wed, 23 Aug 2017 00:01:57 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12883195/datastore-identity-holes.diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12883195/datastore-identity-holes.diff&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 33 failed/errored test(s), 10860 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestCommands - did not produce a TEST-*.xml file (likely timed out) (batchId=180)
TestDbNotificationListener - did not produce a TEST-*.xml file (likely timed out) (batchId=233)
TestEximReplicationTasks - did not produce a TEST-*.xml file (likely timed out) (batchId=180)
TestExport - did not produce a TEST-*.xml file (likely timed out) (batchId=218)
TestHCatClient - did not produce a TEST-*.xml file (likely timed out) (batchId=180)
TestHCatClientNotification - did not produce a TEST-*.xml file (likely timed out) (batchId=233)
TestHCatHiveCompatibility - did not produce a TEST-*.xml file (likely timed out) (batchId=233)
TestHCatHiveThriftCompatibility - did not produce a TEST-*.xml file (likely timed out) (batchId=233)
TestLocationQueries - did not produce a TEST-*.xml file (likely timed out) (batchId=218)
TestNoopCommand - did not produce a TEST-*.xml file (likely timed out) (batchId=180)
TestObjectStore - did not produce a TEST-*.xml file (likely timed out) (batchId=201)
TestReplicationScenarios - did not produce a TEST-*.xml file (likely timed out) (batchId=218)
TestReplicationScenariosAcrossInstances - did not produce a TEST-*.xml file (likely timed out) (batchId=218)
TestReplicationTask - did not produce a TEST-*.xml file (likely timed out) (batchId=180)
TestRetriesInRetryingHMSHandler - did not produce a TEST-*.xml file (likely timed out) (batchId=201)
TestSemanticAnalyzerHookLoading - did not produce a TEST-*.xml file (likely timed out) (batchId=218)
TestSequenceFileReadWrite - did not produce a TEST-*.xml file (likely timed out) (batchId=233)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_dynamic_partition_pruning] (batchId=169)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[repl_dump_requires_admin] (batchId=90)
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[repl_load_requires_admin] (batchId=90)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=235)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query23] (batchId=235)
org.apache.hadoop.hive.common.TestFileUtils.testCopyWithDistCpAs (batchId=250)
org.apache.hadoop.hive.common.TestFileUtils.testCopyWithDistcp (batchId=250)
org.apache.hive.jdbc.TestJdbcWithMiniHS2.testReplDumpResultSet (batchId=228)
org.apache.hive.minikdc.TestJdbcWithDBTokenStore.testConnection (batchId=241)
org.apache.hive.minikdc.TestJdbcWithDBTokenStore.testIsValid (batchId=241)
org.apache.hive.minikdc.TestJdbcWithDBTokenStore.testIsValidNeg (batchId=241)
org.apache.hive.minikdc.TestJdbcWithDBTokenStore.testNegativeProxyAuth (batchId=241)
org.apache.hive.minikdc.TestJdbcWithDBTokenStore.testNegativeTokenAuth (batchId=241)
org.apache.hive.minikdc.TestJdbcWithDBTokenStore.testProxyAuth (batchId=241)
org.apache.hive.minikdc.TestJdbcWithDBTokenStore.testTokenAuth (batchId=241)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6492/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6492/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6492/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6492/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-6492/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-6492/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 33 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12883195 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="16138741" author="anishek" created="Wed, 23 Aug 2017 17:45:58 +0000"  >&lt;p&gt;auto increments can have holes if&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;a transaction was aborted.&lt;/li&gt;
	&lt;li&gt;or the sequence generation is happening in code by explicitly calling the next_val on the sequence behind the auto increment and then doing the insert from the application in which case the problem mentioned by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt; with GC in app can cause holes or unordered inserts.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;holes can happen and are not guaranteed because of the above cases, however we should not care about the case 1 of aborted transactions until we get increasing ordered unique numbers. &lt;/p&gt;

&lt;p&gt;as for the second case if we use the auto_increment at DB and not use datanuclues datastore-identity with auto-increment, we should be able to get them in order. &lt;/p&gt;

&lt;p&gt;the test provided by  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt;  works on mysql with both positive and negative mapping. &lt;/p&gt;

&lt;p&gt;negative mapping &amp;#8211; existing mapping with mysql.&lt;br/&gt;
positive mapping &amp;#8211; auto increment as part of create table for notification log, on NL_ID, on a fresh db. &lt;/p&gt;

&lt;p&gt;for the patch rather than using the existing columns i think i will create another column that will be auto increment at db level.  I will try the fix on a postgres sql db also to see if there is separate behavior, however if the race condition happens at the db level such that two transactions are committed from the application (HMS) at the same time but the db will order them depending on which acquires the lock to auto_increment first. how ever since replication is not realtime this lag of a few nano/micro secs should not be a problem. &lt;/p&gt;

&lt;p&gt;retrying the whole metastore operation with optimistic locking in application code is just calling for a lot of retries on HMS side with the possibility of retrying complete metastore operations to be redone if something fails when one commit is larger than other commits. additionally this will need us to do perfect distributed transactions on rdbms + hdfs. &lt;/p&gt;</comment>
                            <comment id="16138864" author="akolb" created="Wed, 23 Aug 2017 18:42:45 +0000"  >&lt;p&gt;There are two types of holes that can be observed:&lt;/p&gt;

&lt;p&gt;1. Temporary hole - the transaction allocated the ID and is in progress but not committed yet. The hole will be filled at some time in the future when transaction commits.&lt;br/&gt;
2. Persistent hole in case when transaction was aborted.&lt;/p&gt;

&lt;p&gt;Both cases present some problems for consumers. Suppose consumers process IDs in order and they read 1, 3. What should they do? If they continue going forward, ID 2 will not be handled at all. They don&apos;t know whether 2 will appear later or will never appear. Usually it will appear (in most cases transactions go through) but clients don&apos;t know when. Should they process 3 or not? If they do and 2 appears later and they detect it, they will apply operations out of order.&lt;/p&gt;

&lt;p&gt;That said, it is better then having duplicate IDs. But this still creates hard problems for consumers who rely on accurate stream of IDs.&lt;/p&gt;</comment>
                            <comment id="16138921" author="anishek" created="Wed, 23 Aug 2017 19:22:26 +0000"  >&lt;p&gt;1. this will not happen as the id will &lt;b&gt;not&lt;/b&gt; be allocated before commit, its at DB commit level, that id is generated and &lt;b&gt;not&lt;/b&gt; at some future time when commit is happening.&lt;br/&gt;
2. this can happen.&lt;/p&gt;

&lt;p&gt;since 1 is not happening consumers should keep processing elements in order 1,3 etc and not wait for 2 to appear later. &lt;/p&gt;</comment>
                            <comment id="16138927" author="akolb" created="Wed, 23 Aug 2017 19:30:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anishek&quot; class=&quot;user-hover&quot; rel=&quot;anishek&quot;&gt;anishek&lt;/a&gt; We actually observed this behavior. Seems that DBs allocate this ID not at commit time.&lt;/p&gt;</comment>
                            <comment id="16138939" author="akolb" created="Wed, 23 Aug 2017 19:36:28 +0000"  >&lt;p&gt;Here is some discussion of the issue on the Oracle side - I don&apos;t know how accurate this is. &lt;a href=&quot;https://dba.stackexchange.com/questions/3945/can-i-implement-a-gapless-identity-column-in-oracle&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dba.stackexchange.com/questions/3945/can-i-implement-a-gapless-identity-column-in-oracle&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The statement there is that not only it is impossible to have gapless sequence, it is also impossible to guarantee ordering which means that earlier ID values may appear after later ones.&lt;/p&gt;</comment>
                            <comment id="16139246" author="anishek" created="Wed, 23 Aug 2017 22:26:38 +0000"  >&lt;p&gt;link seems to be discussing sequences and like i mentioned earlier the subsequent transactions will be in commit phase in db when ids get generated so unless something is happening as a trigger on new insert into notification log there is no problem with replication.&lt;/p&gt;

&lt;p&gt;Doing retry with optimistic transactions in application code is not something we want to do since it will affect performance of straggle some users. do you have any other ideas ?&lt;/p&gt;</comment>
                            <comment id="16139346" author="anishek" created="Wed, 23 Aug 2017 23:55:42 +0000"  >&lt;p&gt;Thinking more on this, might be we just do &quot;select for update&apos; for getting the next event id from notification_sequence. this should work on most of the problems we have but will make metastore operations slow. &lt;/p&gt;

&lt;p&gt;also just wondering even in single standalone HMS we can have this issue, as the NOTIFICATION_TBL_LOCK is within a nested transaction and multiple threads can still read the same value across threads and update it separately.&lt;/p&gt;</comment>
                            <comment id="16139403" author="akolb" created="Thu, 24 Aug 2017 00:48:27 +0000"  >&lt;p&gt;&lt;tt&gt;select for update&lt;/tt&gt; will work, but is, indeed a hammer, plus now we might have deadlocks. But I am not aware of any solution that guarantees the semantics we need and doesn&apos;t hurt performance.&lt;/p&gt;</comment>
                            <comment id="16140650" author="anishek" created="Thu, 24 Aug 2017 20:37:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akolb&quot; class=&quot;user-hover&quot; rel=&quot;akolb&quot;&gt;akolb&lt;/a&gt; the &lt;tt&gt;select for update&lt;/tt&gt; will be on &lt;tt&gt;notification_sequence&lt;/tt&gt; and since its an &lt;b&gt;exclusive&lt;/b&gt; lock ,so why would there be deadlocks ?&lt;/p&gt;</comment>
                            <comment id="16140668" author="akolb" created="Thu, 24 Aug 2017 20:45:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anishek&quot; class=&quot;user-hover&quot; rel=&quot;anishek&quot;&gt;anishek&lt;/a&gt; I am not saying there would be a deadlock, it all depends on specifics - the notification id is updated as part of a larger transaction where lock ordering may be not that easy to enforce - but it may be a non-issue here.&lt;/p&gt;</comment>
                            <comment id="16142585" author="hiveqa" created="Sat, 26 Aug 2017 03:14:07 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12883836/HIVE-16886.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12883836/HIVE-16886.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 2 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 15 failed/errored test(s), 11005 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=61)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_2] (batchId=100)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=235)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query23] (batchId=235)
org.apache.hadoop.hive.ql.parse.TestExport.shouldExportImportATemporaryTable (batchId=218)
org.apache.hive.beeline.TestSchemaTool.testHiveMetastoreDbPropertiesTable (batchId=222)
org.apache.hive.beeline.TestSchemaTool.testMetastoreDbPropertiesAfterUpgrade (batchId=222)
org.apache.hive.beeline.TestSchemaTool.testSchemaInit (batchId=222)
org.apache.hive.beeline.TestSchemaTool.testSchemaUpgrade (batchId=222)
org.apache.hive.beeline.TestSchemaTool.testValidateLocations (batchId=222)
org.apache.hive.beeline.TestSchemaTool.testValidateNullValues (batchId=222)
org.apache.hive.beeline.TestSchemaTool.testValidateSchemaTables (batchId=222)
org.apache.hive.beeline.TestSchemaTool.testValidateSchemaVersions (batchId=222)
org.apache.hive.beeline.TestSchemaTool.testValidateSequences (batchId=222)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6550/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6550/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6550/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6550/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-6550/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-6550/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 15 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12883836 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="16143221" author="linaataustin" created="Sun, 27 Aug 2017 20:59:08 +0000"  >&lt;p&gt;We did testing and it shows when executing SQL command in transactions concurrently, the result is determined by the order of SQL execution order (if SQL1 is executed before SQL2 and both set value of the same column in the same row and same table, the result is the same as the value set by SQL2, i.e., the last executed wins). The result is NOT determined by the transaction commit order.&lt;/p&gt;

&lt;p&gt;When Sentry gets notifications and apply them, it should apply them in the same order as hive applies those changes. Otherwise, sentry may end up getting different path state from what hive has. It is undesirable.&lt;/p&gt;

&lt;p&gt;In order to achieve consistent synchronization, could hive make sure that the event ID order is the same as the path sql execution order? One way to achieve this is to keep the notification log in the same transaction of the path sql statement, and the order in the transaction is to persist notification log after the path SQL statement&lt;br/&gt;
{&lt;br/&gt;
Execute path SQL statements,&lt;br/&gt;
Persist notification log&lt;br/&gt;
}&lt;/p&gt;</comment>
                            <comment id="16143952" author="anishek" created="Mon, 28 Aug 2017 16:12:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lina.li&quot; class=&quot;user-hover&quot; rel=&quot;lina.li&quot;&gt;lina.li&lt;/a&gt; changes to notification log are in nested transactions with enclosing transaction executing the necessary statements for the user initiated operations, its as you have stated in you example &lt;/p&gt;
{ Execute path SQL statements, Persist notification log }
&lt;p&gt;.&lt;/p&gt;
</comment>
                            <comment id="16144191" author="anishek" created="Mon, 28 Aug 2017 18:47:51 +0000"  >&lt;p&gt;fixing errors for derby schema and removing the java lock for updating notification logs since we do a db lock for multiple HMS&lt;/p&gt;</comment>
                            <comment id="16144269" author="hiveqa" created="Mon, 28 Aug 2017 20:11:33 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12884096/HIVE-16886.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12884096/HIVE-16886.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 2 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 11013 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestTxnCommandsBase - did not produce a TEST-*.xml file (likely timed out) (batchId=280)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=61)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6565/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6565/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6565/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6565/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-6565/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-6565/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12884096 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="16144586" author="anishek" created="Tue, 29 Aug 2017 00:21:47 +0000"  >&lt;p&gt;fixing oracle schema upgrades&lt;/p&gt;</comment>
                            <comment id="16144587" author="anishek" created="Tue, 29 Aug 2017 00:22:58 +0000"  >&lt;p&gt;Failing tests are from older builds.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thejas&quot; class=&quot;user-hover&quot; rel=&quot;thejas&quot;&gt;thejas&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sankarh&quot; class=&quot;user-hover&quot; rel=&quot;sankarh&quot;&gt;sankarh&lt;/a&gt; please review.&lt;/p&gt;</comment>
                            <comment id="16144590" author="akolb" created="Tue, 29 Aug 2017 00:24:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anishek&quot; class=&quot;user-hover&quot; rel=&quot;anishek&quot;&gt;anishek&lt;/a&gt; Would you mind adding a link to reviewboard?&lt;/p&gt;</comment>
                            <comment id="16144596" author="githubbot" created="Tue, 29 Aug 2017 00:33:22 +0000"  >&lt;p&gt;GitHub user anishek opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/hive/pull/237&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/pull/237&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-16886&quot; title=&quot;HMS log notifications may have duplicated event IDs if multiple HMS are running concurrently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-16886&quot;&gt;&lt;del&gt;HIVE-16886&lt;/del&gt;&lt;/a&gt;: HMS log notifications may have duplicated event IDs if multiple HMS are running concurrently&lt;/p&gt;

&lt;p&gt;    &#8230;ltiple HMS are running concurrently&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/anishek/hive&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/anishek/hive&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-16886&quot; title=&quot;HMS log notifications may have duplicated event IDs if multiple HMS are running concurrently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-16886&quot;&gt;&lt;del&gt;HIVE-16886&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/hive/pull/237.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/pull/237.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #237&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 1d358291c5c5fc46e3d921d74967e51d1a7418b5&lt;br/&gt;
Author: Anishek Agarwal &amp;lt;anishek@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-24T00:10:00Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-16886&quot; title=&quot;HMS log notifications may have duplicated event IDs if multiple HMS are running concurrently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-16886&quot;&gt;&lt;del&gt;HIVE-16886&lt;/del&gt;&lt;/a&gt;: HMS log notifications may have duplicated event IDs if multiple HMS are running concurrently&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16144623" author="akolb" created="Tue, 29 Aug 2017 01:11:02 +0000"  >&lt;p&gt;Is there any reason you don&apos;t want to use&lt;/p&gt;

&lt;p&gt;Query q = pm.newQuery(...);&lt;br/&gt;
q.setSerializeRead(true);&lt;/p&gt;

&lt;p&gt;which does convert to appropriate SELECT FOR UPDATE statements? See &lt;a href=&quot;http://www.datanucleus.org/products/accessplatform_3_0/jdo/transaction_types.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.datanucleus.org/products/accessplatform_3_0/jdo/transaction_types.html&lt;/a&gt; for some description.&lt;/p&gt;</comment>
                            <comment id="16144682" author="hiveqa" created="Tue, 29 Aug 2017 03:07:17 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12884156/HIVE-16886.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12884156/HIVE-16886.4.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 2 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 4 failed/errored test(s), 11014 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestTxnCommandsBase - did not produce a TEST-*.xml file (likely timed out) (batchId=280)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[auto_sortmerge_join_2] (batchId=46)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=61)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6572/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6572/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6572/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6572/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-6572/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-6572/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12884156 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="16145772" author="anishek" created="Tue, 29 Aug 2017 17:51:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akolb&quot; class=&quot;user-hover&quot; rel=&quot;akolb&quot;&gt;akolb&lt;/a&gt; the transaction for handling the dbnotification update is a nested transaction and i didnt want to set the whole transaction to setSerializedRead, as even though currently this is done as the last set of actions in HMS, it might change in future and then every additional queries run in the transaction will be serializedRead. Setting the same on the query was again confusing as the result of change should not be visible to other transactions till commit and hence even though we are setting is on the query object, it might just be internally doing it on the current open transactions which brings us back to the first problem.&lt;/p&gt;

&lt;p&gt;Also since code to handle &lt;tt&gt;select.. for update&lt;/tt&gt; was already there as part of ACID, i just reused the same, as it gives more confidence that there are no problems with this semantics rather than the setSerializedRead on Datanucleus.&lt;/p&gt;</comment>
                            <comment id="16145843" author="anishek" created="Tue, 29 Aug 2017 18:26:19 +0000"  >&lt;p&gt;adding configurations to manage retry limit and sleep time for acquiring the lock on the notification sequence.&lt;/p&gt;</comment>
                            <comment id="16145845" author="anishek" created="Tue, 29 Aug 2017 18:26:58 +0000"  >&lt;p&gt;add &lt;tt&gt;NOTIFICATION_SEQUENCE_LOCK_MAX_RETRIES&lt;/tt&gt; and &lt;tt&gt;NOTIFICATION_SEQUENCE_LOCK_RETRY_SLEEP_INTERVAL&lt;/tt&gt; to docs&lt;/p&gt;</comment>
                            <comment id="16145883" author="anishek" created="Tue, 29 Aug 2017 18:42:37 +0000"  >&lt;p&gt;configurations for sleep and retry intervals for notification sequence lock&lt;/p&gt;</comment>
                            <comment id="16146028" author="hiveqa" created="Tue, 29 Aug 2017 20:14:45 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12884316/HIVE-16886.5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12884316/HIVE-16886.5.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 2 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 80 failed/errored test(s), 11000 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestTxnCommandsBase - did not produce a TEST-*.xml file (likely timed out) (batchId=280)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=61)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=234)
org.apache.hadoop.hive.cli.TestSparkCliDriver.org.apache.hadoop.hive.cli.TestSparkCliDriver (batchId=109)
org.apache.hadoop.hive.metastore.TestObjectStore.testNotificationOps (batchId=201)
org.apache.hadoop.hive.ql.parse.TestExport.shouldExportImportATemporaryTable (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testAlters (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testBasic (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testBasicWithCM (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testBootstrapLoadOnExistingDb (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testBootstrapWithConcurrentDropPartition (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testBootstrapWithConcurrentDropTable (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testConcatenatePartitionedTable (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testConcatenateTable (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testConstraints (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testDrops (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testDropsWithCM (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testDumpLimit (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testEventTypesForDynamicAddPartitionByInsert (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testExchangePartition (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testIncrementalAdds (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testIncrementalInsertDropPartitionedTable (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testIncrementalInsertDropUnpartitionedTable (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testIncrementalInsertToPartition (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testIncrementalInserts (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testIncrementalLoad (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testIncrementalLoadFailAndRetry (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testIncrementalLoadWithVariableLengthEventId (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testIncrementalRepeatEventOnExistingObject (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testIncrementalRepeatEventOnMissingObject (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testInsertOverwriteOnPartitionedTableWithCM (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testInsertOverwriteOnUnpartitionedTableWithCM (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testInsertToMultiKeyPartition (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testRenamePartitionWithCM (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testRenameTableWithCM (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testStatus (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testTruncatePartitionedTable (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testTruncateTable (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testTruncateWithCM (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenarios.testViewsReplication (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcrossInstances.testBootstrapFunctionReplication (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcrossInstances.testCreateFunctionIncrementalReplication (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcrossInstances.testCreateFunctionWithFunctionBinaryJarsOnHDFS (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcrossInstances.testDropFunctionIncrementalReplication (batchId=218)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcrossInstances.testMultipleStagesOfReplicationLoadTask (batchId=218)
org.apache.hive.hcatalog.api.TestHCatClient.testReplicationTaskIter (batchId=180)
org.apache.hive.hcatalog.api.TestHCatClientNotification.addPartition (batchId=232)
org.apache.hive.hcatalog.api.TestHCatClientNotification.createDatabase (batchId=232)
org.apache.hive.hcatalog.api.TestHCatClientNotification.createTable (batchId=232)
org.apache.hive.hcatalog.api.TestHCatClientNotification.dropDatabase (batchId=232)
org.apache.hive.hcatalog.api.TestHCatClientNotification.dropPartition (batchId=232)
org.apache.hive.hcatalog.api.TestHCatClientNotification.dropTable (batchId=232)
org.apache.hive.hcatalog.api.TestHCatClientNotification.filter (batchId=232)
org.apache.hive.hcatalog.api.TestHCatClientNotification.filterWithMax (batchId=232)
org.apache.hive.hcatalog.api.TestHCatClientNotification.getOnlyMaxEvents (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.addPartition (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.alterIndex (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.alterPartition (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.alterTable (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.cleanupNotifs (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.createDatabase (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.createFunction (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.createIndex (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.createTable (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.dropDatabase (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.dropFunction (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.dropIndex (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.dropPartition (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.dropTable (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.exchangePartition (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.filter (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.filterWithMax (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.getOnlyMaxEvents (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.insertPartition (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.insertTable (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.sqlCTAS (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.sqlDb (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.sqlInsertPartition (batchId=232)
org.apache.hive.hcatalog.listener.TestDbNotificationListener.sqlInsertTable (batchId=232)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6586/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6586/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6586/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6586/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-6586/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-6586/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 80 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12884316 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="16146113" author="anishek" created="Tue, 29 Aug 2017 20:59:47 +0000"  >&lt;p&gt;fixing the Configuration object reference&lt;/p&gt;</comment>
                            <comment id="16146116" author="anishek" created="Tue, 29 Aug 2017 21:00:33 +0000"  >&lt;p&gt;fixing configuration object reference&lt;/p&gt;</comment>
                            <comment id="16146257" author="hiveqa" created="Tue, 29 Aug 2017 22:30:23 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12884341/HIVE-16886.6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12884341/HIVE-16886.6.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 2 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 6 failed/errored test(s), 11014 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestTxnCommandsBase - did not produce a TEST-*.xml file (likely timed out) (batchId=280)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=61)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union_remove_15] (batchId=82)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=234)
org.apache.hive.jdbc.TestJdbcWithMiniHS2.testHttpRetryOnServerIdleTimeout (batchId=227)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6588/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6588/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6588/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6588/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-6588/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-6588/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 6 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12884341 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="16146384" author="akolb" created="Wed, 30 Aug 2017 00:12:06 +0000"  >&lt;p&gt;Looks like SQLGenerator.createInsertValuesStmt() may be subject to SQL injection attack since it uses provided values to generate SQL statements. Perhaps it should use prepared statements instead?&lt;/p&gt;</comment>
                            <comment id="16146512" author="hiveqa" created="Wed, 30 Aug 2017 02:56:27 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12884341/HIVE-16886.6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12884341/HIVE-16886.6.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 2 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 7 failed/errored test(s), 11000 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestTxnCommandsBase - did not produce a TEST-*.xml file (likely timed out) (batchId=280)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=61)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[transform_acid] (batchId=19)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=234)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query23] (batchId=234)
org.apache.hadoop.hive.cli.TestSparkCliDriver.org.apache.hadoop.hive.cli.TestSparkCliDriver (batchId=102)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6592/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6592/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6592/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6592/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-6592/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-6592/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 7 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12884341 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="16147592" author="anishek" created="Wed, 30 Aug 2017 16:47:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akolb&quot; class=&quot;user-hover&quot; rel=&quot;akolb&quot;&gt;akolb&lt;/a&gt; &lt;tt&gt;SQLGenerator&lt;/tt&gt; is a artifact of the ACID implementation and we are just reusing the clause, from the looks of it SQL injection might be possible but i am not an expert in that area so I will let &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ekoifman&quot; class=&quot;user-hover&quot; rel=&quot;ekoifman&quot;&gt;ekoifman&lt;/a&gt; have a look at it, also may be track this as a separate bug.&lt;/p&gt;

&lt;p&gt;I am just running the failed test to see if there are any problems, will upload a patch soon with log comment fixes suggested by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16147667" author="anishek" created="Wed, 30 Aug 2017 17:40:53 +0000"  >&lt;ul&gt;
	&lt;li&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver&lt;span class=&quot;error&quot;&gt;&amp;#91;transform_acid&amp;#93;&lt;/span&gt; : works fine on local machine&lt;/li&gt;
	&lt;li&gt;org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver&lt;span class=&quot;error&quot;&gt;&amp;#91;query23&amp;#93;&lt;/span&gt; : fails on local, only order of the first two statements is in correct which was specifically changed as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-17037&quot; title=&quot;Use 1-to-1 Tez edge to avoid unnecessary input data shuffle&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-17037&quot;&gt;&lt;del&gt;HIVE-17037&lt;/del&gt;&lt;/a&gt; not sure why its failing now and its not part of the current set of changes.&lt;/li&gt;
	&lt;li&gt;org.apache.hadoop.hive.cli.TestSparkCliDriver.org.apache.hadoop.hive.cli.TestSparkCliDriver : seems like a disk IO operation that failed, not a test failure, running this on local machine for the last 10 mins and there is no end to it, so stopping it.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Other tests are failing from older build&lt;/p&gt;</comment>
                            <comment id="16147669" author="anishek" created="Wed, 30 Aug 2017 17:41:20 +0000"  >&lt;p&gt;fixing log comments&lt;/p&gt;</comment>
                            <comment id="16147865" author="hiveqa" created="Wed, 30 Aug 2017 19:13:26 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12884510/HIVE-16886.7.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12884510/HIVE-16886.7.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 2 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 7 failed/errored test(s), 11014 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestTxnCommandsBase - did not produce a TEST-*.xml file (likely timed out) (batchId=280)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[auto_sortmerge_join_5] (batchId=84)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=61)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[load_dyn_part5] (batchId=154)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver[spark_vectorized_dynamic_partition_pruning] (batchId=169)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=234)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query23] (batchId=234)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6606/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6606/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6606/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6606/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-6606/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-6606/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 7 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12884510 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="16154054" author="ekoifman" created="Tue, 5 Sep 2017 17:48:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anishek&quot; class=&quot;user-hover&quot; rel=&quot;anishek&quot;&gt;anishek&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akolb&quot; class=&quot;user-hover&quot; rel=&quot;akolb&quot;&gt;akolb&lt;/a&gt; I think SQL injection would be an issue if the class allowed you to run a query.  It does not.  It just manipulates text.&lt;/p&gt;</comment>
                            <comment id="16157813" author="daijy" created="Thu, 7 Sep 2017 22:52:28 +0000"  >&lt;p&gt;Patch looks good to me. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akolb&quot; class=&quot;user-hover&quot; rel=&quot;akolb&quot;&gt;akolb&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lina.li&quot; class=&quot;user-hover&quot; rel=&quot;lina.li&quot;&gt;lina.li&lt;/a&gt;, I am going to commit in next 24h if I don&apos;t hear further comments from you.&lt;/p&gt;</comment>
                            <comment id="16159113" author="spena" created="Fri, 8 Sep 2017 18:59:17 +0000"  >&lt;p&gt;It looks good &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anishek&quot; class=&quot;user-hover&quot; rel=&quot;anishek&quot;&gt;anishek&lt;/a&gt;. I run the Mysql tests in a cluster with HMS HA and execute several DDL statements. There are no duplicates nor gaps, this is a good approach. I haven&apos;t tested the performance, though, but that&apos;s something we would handle later if we see something bad with it.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="16159467" author="daijy" created="Fri, 8 Sep 2017 22:35:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anishek&quot; class=&quot;user-hover&quot; rel=&quot;anishek&quot;&gt;anishek&lt;/a&gt;, the patch is out of sync especially in TestObjectStore.java. Can you rebase?&lt;/p&gt;</comment>
                            <comment id="16160686" author="anishek" created="Mon, 11 Sep 2017 04:56:16 +0000"  >&lt;p&gt;rebased from master &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="16160853" author="hiveqa" created="Mon, 11 Sep 2017 07:47:00 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12886343/HIVE-16886.8.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12886343/HIVE-16886.8.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 2 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 6 failed/errored test(s), 11033 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestAccumuloCliDriver - did not produce a TEST-*.xml file (likely timed out) (batchId=230)
TestDummy - did not produce a TEST-*.xml file (likely timed out) (batchId=230)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[char_udf1] (batchId=86)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[insert_values_orig_table_use_metadata] (batchId=61)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query14] (batchId=234)
org.apache.hadoop.hive.cli.TestPerfCliDriver.testCliDriver[query23] (batchId=234)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6763/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6763/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/6763/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/6763/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-6763/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-6763/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 6 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12886343 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="16160901" author="daijy" created="Mon, 11 Sep 2017 08:14:45 +0000"  >&lt;p&gt;Patch pushed to master.&lt;/p&gt;</comment>
                            <comment id="16169484" author="lefty@hortonworks.com" created="Mon, 18 Sep 2017 00:19:47 +0000"  >&lt;p&gt;Doc note:  This adds &lt;b&gt;hive.notification.sequence.lock.max.retries&lt;/b&gt; and &lt;b&gt;hive.notification.sequence.lock.retry.sleep.interval&lt;/b&gt; to HiveConf.java, so they need to be documented in the wiki.&lt;/p&gt;

&lt;p&gt;Apparently they belong in the metastore section.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-MetaStore&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Configuration Properties &amp;#8211; MetaStore &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Added a TODOC3.0 label.&lt;/p&gt;</comment>
                            <comment id="16340466" author="akolb" created="Fri, 26 Jan 2018 02:17:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anishek&quot; class=&quot;user-hover&quot; rel=&quot;anishek&quot;&gt;anishek&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thejas&quot; class=&quot;user-hover&quot; rel=&quot;thejas&quot;&gt;thejas&lt;/a&gt; What do you think about implementing SELECT FOR UPDATE using the mechanism from&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-18526&quot; title=&quot;Backport HIVE-16886 to Hive 2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-18526&quot;&gt;&lt;del&gt;HIVE-18526&lt;/del&gt;&lt;/a&gt;? It is much simpler and uses documented DataNucleus semantics.&lt;/p&gt;</comment>
                            <comment id="16342893" author="anishek" created="Mon, 29 Jan 2018 04:31:43 +0000"  >&lt;p&gt;&lt;a href=&quot;http://www.datanucleus.org/products/accessplatform_4_1/jdo/transactions.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.datanucleus.org/products/accessplatform_4_1/jdo/transactions.html&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;By default DataNucleus does not currently lock the objects fetched with pessimistic locking, but you can configure this behaviour for RDBMS datastores by setting the persistence property datanucleus.SerializeRead to true. This will result in all &quot;SELECT ... FROM ...&quot; statements being changed to be &quot;SELECT ... FROM ... FOR UPDATE&quot;. &lt;b&gt;This will be applied only where the underlying RDBMS supports the &quot;FOR UPDATE&quot; syntax.&lt;/b&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;for SQLServer this will not work since the syntax is different. the code shows us using datanuclues 4.1 version btw.&lt;/p&gt;</comment>
                            <comment id="16343724" author="linaataustin" created="Mon, 29 Jan 2018 18:02:02 +0000"  >&lt;ul&gt;
	&lt;li&gt;This will be effective only where the underlying RDBMS supports the &quot;FOR UPDATE&quot; syntax.&#160;&lt;a href=&quot;http://www.datanucleus.org/products/accessplatform_4_1/jdo/transactions.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.datanucleus.org/products/accessplatform_4_1/jdo/transactions.html&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;font color=&quot;#0000ff&quot;&gt;MySql, Oracle,&#160; DB2, Derby&lt;/font&gt;&#160;&lt;font color=&quot;#0000ff&quot;&gt;support this &quot;SELECT FOR UPDATE&quot; syntax.&lt;/font&gt;&lt;/li&gt;
	&lt;li&gt;&lt;font color=&quot;#333333&quot;&gt;&lt;a href=&quot;https://dev.mysql.com/doc/refman/5.7/en/innodb-locking-reads.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.mysql.com/doc/refman/5.7/en/innodb-locking-reads.html&lt;/a&gt;&lt;/font&gt;&lt;/li&gt;
	&lt;li&gt;&lt;font color=&quot;#333333&quot;&gt;&lt;a href=&quot;https://www.toadworld.com/platforms/oracle/w/wiki/1875.select-for-update&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.toadworld.com/platforms/oracle/w/wiki/1875.select-for-update&lt;/a&gt;&lt;/font&gt;&lt;/li&gt;
	&lt;li&gt;&lt;font color=&quot;#333333&quot;&gt;&lt;a href=&quot;https://www.ibm.com/support/knowledgecenter/en/SSEPEK_11.0.0/sqlref/src/tpc/db2z_sql_selectstatementexamples.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.ibm.com/support/knowledgecenter/en/SSEPEK_11.0.0/sqlref/src/tpc/db2z_sql_selectstatementexamples.html&lt;/a&gt;&lt;/font&gt;&lt;/li&gt;
	&lt;li&gt;&lt;font color=&quot;#333333&quot;&gt;&lt;a href=&quot;https://www.postgresql.org/docs/9.0/static/sql-select.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.postgresql.org/docs/9.0/static/sql-select.html&lt;/a&gt;&lt;/font&gt;&lt;/li&gt;
	&lt;li&gt;&lt;font color=&quot;#333333&quot;&gt;&lt;a href=&quot;https://db.apache.org/derby/docs/10.2/ref/rrefsqlj31783.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://db.apache.org/derby/docs/10.2/ref/rrefsqlj31783.html&lt;/a&gt;&lt;/font&gt;&lt;/li&gt;
	&lt;li&gt;&lt;font color=&quot;#333333&quot;&gt;The SQL standard specifies a&#160;&lt;tt&gt;FOR UPDATE&lt;/tt&gt;&#160;clause to be applicable for cursors. Most databases interpret this as being applicable for all&#160;{{SELECT}}statements. An&#160;&lt;font color=&quot;#ff9900&quot;&gt;&lt;/font&gt;exception&lt;/font&gt;&#160;to this rule are the&#160;&lt;font color=&quot;#ff9900&quot;&gt;CUBRID&lt;/font&gt;&#160;and&#160;&lt;font color=&quot;#ff9900&quot;&gt;SQL Server&lt;/font&gt;&#160;databases, that do not allow for any&#160;&lt;tt&gt;FOR UPDATE&lt;/tt&gt;&#160;clause in a regular SQL&#160;&lt;a href=&quot;https://www.jooq.org/doc/3.6/manual/sql-building/sql-statements/select-statement/for-update-clause/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.jooq.org/doc/3.6/manual/sql-building/sql-statements/select-statement/for-update-clause/&lt;/a&gt;&lt;font color=&quot;&quot;&gt;&lt;/font&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16343970" author="akolb" created="Mon, 29 Jan 2018 20:30:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anishek&quot; class=&quot;user-hover&quot; rel=&quot;anishek&quot;&gt;anishek&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=LinaAtAustin&quot; class=&quot;user-hover&quot; rel=&quot;linaataustin&quot;&gt;LinaAtAustin&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;The documentation isn&apos;t telling the whole story. Actual MSSQLServerAdapter does implement it. Looking at&#160;&lt;/p&gt;

&lt;p&gt;getSelectStatement() we see:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (lock &amp;amp;&amp;amp; dba.supportsOption(DatastoreAdapter.LOCK_OPTION_PLACED_AFTER_FROM))
{
    sql.append(&lt;span class=&quot;code-quote&quot;&gt;&quot; WITH &quot;&lt;/span&gt;).append(dba.getSelectWithLockOption());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Now, looking at MSSQLServerAdapter, it has:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getSelectWithLockOption()
{
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;(UPDLOCK, ROWLOCK)&quot;&lt;/span&gt;;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So it is implemented for MS SQL Server as well by Data Nucleus.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;And MS SQL adapter does define&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
LOCK_OPTION_PLACED_AFTER_FROM&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16344530" author="anishek" created="Tue, 30 Jan 2018 05:41:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akolb&quot; class=&quot;user-hover&quot; rel=&quot;akolb&quot;&gt;akolb&lt;/a&gt; seems to work based on code as you suggest, if you could test this as well against a mssqlserver that will be great, I am ok with reimplementing this patch.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thejas&quot; class=&quot;user-hover&quot; rel=&quot;thejas&quot;&gt;thejas&lt;/a&gt; anything else we need to take care of ?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16344546" author="akolb" created="Tue, 30 Jan 2018 06:05:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anishek&quot; class=&quot;user-hover&quot; rel=&quot;anishek&quot;&gt;anishek&lt;/a&gt; I don&apos;t have access to MS SQL server - do you have something? The test requires tables created for HMS (at least two notification tables, the rest are irrelevant).&lt;/p&gt;</comment>
                            <comment id="16344606" author="anishek" created="Tue, 30 Jan 2018 07:22:05 +0000"  >&lt;p&gt;nope i dont have one either.&lt;/p&gt;</comment>
                            <comment id="16346006" author="akolb" created="Tue, 30 Jan 2018 23:50:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anishek&quot; class=&quot;user-hover&quot; rel=&quot;anishek&quot;&gt;anishek&lt;/a&gt; I verified that the DataNucleus based patch works on MS SQL server (and that test fails without the patch). How should we proceed?&lt;/p&gt;

&lt;p&gt;I&apos;m mostly interested in branch-2 patch for now, but it would be best to have similar code in branch-2 and branch-3. Would the following work for you:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;We put DataNucleus based patch in branch-2&lt;/li&gt;
	&lt;li&gt;We figure out the way to update branch 3 to have the same fix.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Or you&apos;d rather prefer some other way forward?&lt;/p&gt;</comment>
                            <comment id="16348354" author="anishek" created="Thu, 1 Feb 2018 10:30:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akolb&quot; class=&quot;user-hover&quot; rel=&quot;akolb&quot;&gt;akolb&lt;/a&gt; i would rather not have difference between the two branches, if you could make sure that the branch 3 is also updated with the fix very soon, in near future that would be great, assuming you are doing branch-2 fix first. &lt;/p&gt;</comment>
                            <comment id="16349622" author="akolb" created="Fri, 2 Feb 2018 01:17:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anishek&quot; class=&quot;user-hover&quot; rel=&quot;anishek&quot;&gt;anishek&lt;/a&gt; I am fine with updating branch 3 as well. Do you want to do it yourself or you&apos;d like me to do it? I think we need to do the following:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Make sure you are Ok with the suggested fix&lt;/li&gt;
	&lt;li&gt;Revert the original fix&lt;/li&gt;
	&lt;li&gt;Apply new fix.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So this will be two commits on branch-3 and one commit on branch-2.&lt;/p&gt;

&lt;p&gt;Please4 let me know what you think about it.&lt;/p&gt;</comment>
                            <comment id="16486441" author="vgarg" created="Wed, 23 May 2018 00:00:41 +0000"  >&lt;p&gt;Hive 3.0.0 has been released so closing this jira.&lt;/p&gt;</comment>
                            <comment id="16559265" author="githubbot" created="Fri, 27 Jul 2018 05:14:21 +0000"  >&lt;p&gt;Github user anishek closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/hive/pull/237&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/pull/237&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310361">
                    <name>Blocked</name>
                                                                <inwardlinks description="Blocked">
                                        <issuelink>
            <issuekey id="13095122">SENTRY-1885</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13074098">HIVE-16738</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13088777">SENTRY-1855</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13126846">SENTRY-2109</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13125770">HIVE-18300</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13096782">SENTRY-1895</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13144595">HIVE-18940</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13140102">HIVE-18768</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13074098">HIVE-16738</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13107663">HIVE-17735</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13108283">HIVE-17758</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13126340">SENTRY-2106</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12883016" name="HIVE-16886.1.patch" size="41461" author="anishek" created="Mon, 21 Aug 2017 23:43:14 +0000"/>
                            <attachment id="12883836" name="HIVE-16886.2.patch" size="55457" author="anishek" created="Sat, 26 Aug 2017 00:06:50 +0000"/>
                            <attachment id="12884096" name="HIVE-16886.3.patch" size="59014" author="anishek" created="Mon, 28 Aug 2017 18:47:16 +0000"/>
                            <attachment id="12884156" name="HIVE-16886.4.patch" size="59034" author="anishek" created="Tue, 29 Aug 2017 00:21:38 +0000"/>
                            <attachment id="12884316" name="HIVE-16886.5.patch" size="61156" author="anishek" created="Tue, 29 Aug 2017 18:42:19 +0000"/>
                            <attachment id="12884341" name="HIVE-16886.6.patch" size="61318" author="anishek" created="Tue, 29 Aug 2017 21:00:27 +0000"/>
                            <attachment id="12884510" name="HIVE-16886.7.patch" size="61846" author="anishek" created="Wed, 30 Aug 2017 17:41:16 +0000"/>
                            <attachment id="12886343" name="HIVE-16886.8.patch" size="61019" author="anishek" created="Mon, 11 Sep 2017 04:56:02 +0000"/>
                            <attachment id="12883195" name="datastore-identity-holes.diff" size="6876" author="spena" created="Tue, 22 Aug 2017 21:36:53 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="13133481">HIVE-18526</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 16 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3g6nz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>