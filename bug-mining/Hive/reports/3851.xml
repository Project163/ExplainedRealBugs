<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:37:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-11748] HivePreparedStatement&apos;s setTimestamp() does not quote value as required</title>
                <link>https://issues.apache.org/jira/browse/HIVE-11748</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://hive.apache.org/javadocs/r1.2.1/api/org/apache/hive/jdbc/HivePreparedStatement.html#setTimestamp(int,%20java.sql.Timestamp)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;HivePreparedStatement.setTimestamp(int parameterIndex, Timestamp x)&lt;/a&gt; does not quote the Timestamp value when generating the HQL statement, resulting in a HiveSqlException on execution.&lt;/p&gt;

&lt;h5&gt;&lt;a name=&quot;Reproducing&quot;&gt;&lt;/a&gt;Reproducing&lt;/h5&gt;
&lt;p&gt;If we add the following unit test to &lt;tt&gt;itests/hive-unit/src/test/java/org/apache/hive/jdbc/TestJdbcDriver2.java&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  @Test
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testPrepareSetTimestamp() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException, ParseException {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; sql = &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT * FROM %s WHERE c20 = ?&quot;&lt;/span&gt;, dataTypeTableName);
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (PreparedStatement ps = con.prepareStatement(sql)) {
      Timestamp timestamp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Timestamp(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SimpleDateFormat(&lt;span class=&quot;code-quote&quot;&gt;&quot;yyyy-MM-dd&quot;&lt;/span&gt;).parse(&lt;span class=&quot;code-quote&quot;&gt;&quot;2013-01-01&quot;&lt;/span&gt;).getTime());
      ps.setTimestamp(1, timestamp);
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (ResultSet resultSet = ps.executeQuery()) {
        assertTrue(resultSet.next());
        assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;2013-01-01&quot;&lt;/span&gt;, resultSet.getString(20));
      }
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The test fails:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hive.service.cli.HiveSQLException: Error while compiling statement: FAILED: ParseException line 1:55 cannot recognize input near &apos;00&apos; &apos;:&apos; &apos;00&apos; in expression specification
  at org.apache.hadoop.hive.ql.parse.ParseDriver.parse(ParseDriver.java:205)
  at org.apache.hadoop.hive.ql.parse.ParseDriver.parse(ParseDriver.java:166)
	at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:401)
	at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:310)
	at org.apache.hadoop.hive.ql.Driver.compileInternal(Driver.java:1150)
	at org.apache.hadoop.hive.ql.Driver.compileAndRespond(Driver.java:1136)
	at org.apache.hive.service.cli.operation.SQLOperation.prepare(SQLOperation.java:109)
	at org.apache.hive.service.cli.operation.SQLOperation.runInternal(SQLOperation.java:180)
	at org.apache.hive.service.cli.operation.Operation.run(Operation.java:257)
	at org.apache.hive.service.cli.session.HiveSessionImpl.executeStatementInternal(HiveSessionImpl.java:405)
	at org.apache.hive.service.cli.session.HiveSessionImpl.executeStatementAsync(HiveSessionImpl.java:392)
	at org.apache.hive.service.cli.CLIService.executeStatementAsync(CLIService.java:261)
	at org.apache.hive.service.cli.thrift.ThriftCLIService.ExecuteStatement(ThriftCLIService.java:509)
	at sun.reflect.GeneratedMethodAccessor15.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.apache.hive.jdbc.HiveConnection$SynchronizedHandler.invoke(HiveConnection.java:1400)
	at com.sun.proxy.$Proxy32.ExecuteStatement(Unknown Source)
	at org.apache.hive.jdbc.HiveStatement.execute(HiveStatement.java:246)
	at org.apache.hive.jdbc.HiveStatement.executeQuery(HiveStatement.java:378)
	at org.apache.hive.jdbc.HivePreparedStatement.executeQuery(HivePreparedStatement.java:109)
	at org.apache.hive.jdbc.TestJdbcDriver2.testPrepareSetTimestamp(TestJdbcDriver2.java:2395)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The failure is because the following HQL is generated/executed by calling toString() on the Timestamp value:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SELECT * FROM testdatatypetable WHERE c20 = 2013-01-01 00:00:00.0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We should be quoting the value of Timestamp.toString(), so that the following HQL is generated/executed:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SELECT * FROM testdatatypetable WHERE c20 = &apos;2013-01-01 00:00:00.0&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12862107">HIVE-11748</key>
            <summary>HivePreparedStatement&apos;s setTimestamp() does not quote value as required</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="awsmithson">Angus Smithson</assignee>
                                    <reporter username="awsmithson">Angus Smithson</reporter>
                        <labels>
                    </labels>
                <created>Sun, 6 Sep 2015 15:21:30 +0000</created>
                <updated>Tue, 16 Feb 2016 23:50:56 +0000</updated>
                            <resolved>Wed, 23 Sep 2015 19:19:56 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14732424" author="awsmithson" created="Sun, 6 Sep 2015 15:31:05 +0000"  >&lt;p&gt;Attaching &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11748&quot; title=&quot;HivePreparedStatement&amp;#39;s setTimestamp() does not quote value as required&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11748&quot;&gt;&lt;del&gt;HIVE-11748&lt;/del&gt;&lt;/a&gt;.patch.  This is similar to the changes under &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11024&quot; title=&quot;Error inserting a date value via parameter marker (PreparedStatement.setDate)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11024&quot;&gt;&lt;del&gt;HIVE-11024&lt;/del&gt;&lt;/a&gt;, which fixed the same bug in setDate().  It simply quotes the value of Timestamp.toString().&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff --git jdbc/src/java/org/apache/hive/jdbc/HivePreparedStatement.java jdbc/src/java/org/apache/hive/jdbc/HivePreparedStatement.java
index 7687537..81c3d5d 100644
--- jdbc/src/java/org/apache/hive/jdbc/HivePreparedStatement.java
+++ jdbc/src/java/org/apache/hive/jdbc/HivePreparedStatement.java
@@ -728,7 +728,7 @@ public void setTime(int parameterIndex, Time x, Calendar cal) throws SQLExceptio
    */
 
   public void setTimestamp(int parameterIndex, Timestamp x) throws SQLException {
-    this.parameters.put(parameterIndex, x.toString());
+    this.parameters.put(parameterIndex, &quot;&apos;&quot; + x.toString() + &quot;&apos;&quot;);
   }
 
   /*
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ve also added a unit test and some Dell SecureWorks license information to the NOTICE file.&lt;/p&gt;</comment>
                            <comment id="14732481" author="hiveqa" created="Sun, 6 Sep 2015 17:59:25 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12754399/HIVE-11748.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12754399/HIVE-11748.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 5 failed/errored test(s), 9421 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_stats_counter
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
org.apache.hive.hcatalog.streaming.TestStreaming.testEndpointConnection
org.apache.hive.hcatalog.streaming.TestStreaming.testTimeOutReaper
org.apache.hive.jdbc.TestJdbcDriver2.testPrepareSetTimestamp
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5190/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5190/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5190/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5190/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5190/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5190/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 5 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12754399 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14733743" author="awsmithson" created="Mon, 7 Sep 2015 14:01:37 +0000"  >&lt;p&gt;Attaching &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11748&quot; title=&quot;HivePreparedStatement&amp;#39;s setTimestamp() does not quote value as required&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11748&quot;&gt;&lt;del&gt;HIVE-11748&lt;/del&gt;&lt;/a&gt;.2.patch.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added support for Timestamp to HivePreparedStatement.setObject(int parameterIndex, Object x)&lt;/li&gt;
	&lt;li&gt;Added coverage of setTimestamp() and setObject(Timestamp x) to TestJdbcDriver2.testPrepareStatement()&lt;/li&gt;
	&lt;li&gt;General tidy-up of TestJdbcDriver2.testPrepareStatement()
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;fixed resource leaks&lt;/li&gt;
		&lt;li&gt;made useful (it was incorrectly passing even if no results returned!)&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Rewrote TestJdbcDriver2&#183;testPrepareSetTimestamp() to use Timestamp objects rather than Date.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I suggest someone with edit privileges on &lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/HowToContribute&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/Hive/HowToContribute&lt;/a&gt; changes the &lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/HowToContribute#HowToContribute-UnitTests&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;unit tests&lt;/a&gt; section.  It&apos;s confusing for new contributors.  Currently it reads:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;gt; cd hive-trunk
&amp;gt; mvn clean install -DskipTests -Phadoop-1
&amp;gt; mvn test -Dtest=SomeTest -Phadoop-1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There isn&apos;t a &quot;hive-trunk&quot; anymore.  I think&amp;#42; the correct procedure is:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;mvn clean install -DskipTests -Phadoop-1
cd itests
mvn test -Dtest=SomeTest -Phadoop-1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;&amp;#42; This is how I executed TestJdbcDriver2 locally - please comment if there&apos;s a better way&lt;/em&gt;&lt;/p&gt;</comment>
                            <comment id="14733889" author="hiveqa" created="Mon, 7 Sep 2015 16:27:46 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12754494/HIVE-11748.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12754494/HIVE-11748.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 1 failed/errored test(s), 9421 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5191/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5191/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5191/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5191/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5191/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5191/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12754494 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14733905" author="awsmithson" created="Mon, 7 Sep 2015 16:43:39 +0000"  >&lt;p&gt;The &lt;tt&gt;org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation&lt;/tt&gt; test failure is unrelated, it was failing prior to my changes.&lt;/p&gt;</comment>
                            <comment id="14745321" author="awsmithson" created="Tue, 15 Sep 2015 12:14:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=szehon&quot; class=&quot;user-hover&quot; rel=&quot;szehon&quot;&gt;szehon&lt;/a&gt; / &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt; - are you willing/able to review this change?&lt;/p&gt;</comment>
                            <comment id="14804451" author="spena" created="Thu, 17 Sep 2015 20:33:09 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=awsmithson&quot; class=&quot;user-hover&quot; rel=&quot;awsmithson&quot;&gt;awsmithson&lt;/a&gt; for the patch.&lt;br/&gt;
Just one question:&lt;/p&gt;

&lt;p&gt;I see this line was replaced &lt;tt&gt;setString(parameterIndex, x.toString());&lt;/tt&gt; by &lt;tt&gt;setTimestamp(parameterIndex, (Timestamp) x);&lt;/tt&gt; And internally, &lt;tt&gt;setString&lt;/tt&gt; wraps the string with single-qutoes:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setString(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; parameterIndex, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; x) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
     x=x.replace(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-quote&quot;&gt;&apos;&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;\\&apos;&lt;/span&gt;&quot;&lt;/span&gt;);
     &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.parameters.put(parameterIndex,&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-quote&quot;&gt;&apos;&quot;&lt;/span&gt;+x+&lt;span class=&quot;code-quote&quot;&gt;&quot;&apos;&lt;/span&gt;&quot;&lt;/span&gt;);
  }

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setTimestamp(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; parameterIndex, Timestamp x) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.parameters.put(parameterIndex, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-quote&quot;&gt;&apos;&quot;&lt;/span&gt; + x.toString() + &lt;span class=&quot;code-quote&quot;&gt;&quot;&apos;&lt;/span&gt;&quot;&lt;/span&gt;);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What is the difference between setString and setTimestamp? I run the test &lt;tt&gt;testPrepareSetTimestamp&lt;/tt&gt; with and without the above line replaced, and it seems to work.&lt;/p&gt;</comment>
                            <comment id="14852716" author="awsmithson" created="Fri, 18 Sep 2015 12:40:45 +0000"  >&lt;p&gt;Thanks for taknig a look &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt;.&lt;/p&gt;


&lt;p&gt;I assume you&apos;re refering to this part of the diff, in &lt;tt&gt;setObject(int parameterIndex, Object x)&lt;/tt&gt;?&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;     } else if (x instanceof Timestamp) {
-      setString(parameterIndex, x.toString());
+      setTimestamp(parameterIndex, (Timestamp) x);
     } else if (x instanceof BigDecimal) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I updated it to call setTimestamp so that if anyone modifies &lt;tt&gt;setTimestamp(...)&lt;/tt&gt; in future, we get the same behaviour...&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;HivePreparedStatement hps = &amp;lt;whatever&amp;gt;;
Timestamp timestamp = &amp;lt;whatever&amp;gt;;

&lt;span class=&quot;code-comment&quot;&gt;// The following two method calls should result in exactly the same behavior.
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// The caller should be able to call either, depending on the situation.
&lt;/span&gt;hps.setObject(1, timestamp);
hps.setTimestamp(1, timestamp);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Prior to this (&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11748&quot; title=&quot;HivePreparedStatement&amp;#39;s setTimestamp() does not quote value as required&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11748&quot;&gt;&lt;del&gt;HIVE-11748&lt;/del&gt;&lt;/a&gt;) fix, those two calls resulted in different behavior, which I think constitutes a bug.  If we leave &lt;tt&gt;setObject()&lt;/tt&gt; calling &lt;tt&gt;setString(...)&lt;/tt&gt; and someone modifies &lt;tt&gt;setTimestamp(...)&lt;/tt&gt; in future, we are back in a place where each provides different behavior (IMO, a bug).&lt;/p&gt;</comment>
                            <comment id="14901110" author="spena" created="Mon, 21 Sep 2015 18:08:08 +0000"  >&lt;p&gt;Got it.&lt;br/&gt;
Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=awsmithson&quot; class=&quot;user-hover&quot; rel=&quot;awsmithson&quot;&gt;awsmithson&lt;/a&gt; for the explanation.&lt;/p&gt;

&lt;p&gt;Then there&apos;s no issue right now, but we&apos;re fixing the API to avoid an issue in the future.&lt;br/&gt;
The change looks good. +1&lt;/p&gt;</comment>
                            <comment id="14901184" author="awsmithson" created="Mon, 21 Sep 2015 18:52:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt; - just to be clear, there are two changes to HivePreparedStatement.java, from the diff:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff --git jdbc/src/java/org/apache/hive/jdbc/HivePreparedStatement.java jdbc/src/java/org/apache/hive/jdbc/HivePreparedStatement.java
index 7687537..c28b7d6 100644
--- jdbc/src/java/org/apache/hive/jdbc/HivePreparedStatement.java
+++ jdbc/src/java/org/apache/hive/jdbc/HivePreparedStatement.java
@@ -607,7 +607,7 @@ public void setObject(int parameterIndex, Object x) throws SQLException {
     } else if (x instanceof Character) {
       setString(parameterIndex, x.toString());
     } else if (x instanceof Timestamp) {
-      setString(parameterIndex, x.toString());
+      setTimestamp(parameterIndex, (Timestamp) x);
     } else if (x instanceof BigDecimal) {
       setString(parameterIndex, x.toString());
     } else {
@@ -728,7 +728,7 @@ public void setTime(int parameterIndex, Time x, Calendar cal) throws SQLExceptio
    */
 
   public void setTimestamp(int parameterIndex, Timestamp x) throws SQLException {
-    this.parameters.put(parameterIndex, x.toString());
+    this.parameters.put(parameterIndex, &quot;&apos;&quot; + x.toString() + &quot;&apos;&quot;);
   }
 
   /*
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The first change makes &lt;tt&gt;setObject(int parameterIndex, Object x)&lt;/tt&gt; call &lt;tt&gt;setTimestamp(int parameterIndex, Timestamp x)&lt;/tt&gt; when passed a Timestamp.  That change is simply to maintain consistency in future.&lt;/p&gt;

&lt;p&gt;The second change is modifying &lt;tt&gt;setTimestamp(int parameterIndex, Timestamp x)&lt;/tt&gt; to quote the value it is passed.  Prior to this change it was broken (see the issue description).&lt;/p&gt;</comment>
                            <comment id="14901273" author="spena" created="Mon, 21 Sep 2015 19:45:38 +0000"  >&lt;p&gt;Got it. Thanks for explaining.&lt;br/&gt;
Still +1. &lt;/p&gt;</comment>
                            <comment id="14905076" author="spena" created="Wed, 23 Sep 2015 19:19:56 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=awsmithson&quot; class=&quot;user-hover&quot; rel=&quot;awsmithson&quot;&gt;awsmithson&lt;/a&gt; for your contribution.&lt;br/&gt;
I committed this to master.&lt;/p&gt;</comment>
                            <comment id="15001539" author="sershe" created="Thu, 12 Nov 2015 02:12:18 +0000"  >&lt;p&gt;Should this issue be backported to branch-1? It looks like a bug.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12838246">HIVE-11024</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12551228">HIVE-2957</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12754494" name="HIVE-11748.2.patch" size="9020" author="awsmithson" created="Mon, 7 Sep 2015 14:01:37 +0000"/>
                            <attachment id="12754399" name="HIVE-11748.patch" size="2354" author="awsmithson" created="Sun, 6 Sep 2015 15:31:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ju53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332154">1.3.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>