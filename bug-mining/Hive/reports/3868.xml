<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:37:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-11945] ORC with non-local reads may not be reusing connection to DN</title>
                <link>https://issues.apache.org/jira/browse/HIVE-11945</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;When &#8220;seek + readFully(buffer, offset, length)&#8221; is used,  DFSInputStream ends up going via &#8220;readWithStrategy()&#8221;.  This sets up BlockReader with length equivalent to that of the block size. So until this position is reached, RemoteBlockReader2.peer would not be added to the PeerCache (Plz refer RemoteBlockReader2.close() in HDFS).  So eventually the next call to the same DN would end opening a new socket.  In ORC, when it is not a data local read, this has a the possibility of opening/closing lots of connections with DN.  &lt;/p&gt;

&lt;p&gt;In random reads, it would be good to set this length to the amount of data that is to be read (e.g pread call in DFSInputStream which sets up the BlockReader&#8217;s length correctly &amp;amp; the code path returns the Peer back to peer cache properly).  &#8220;readFully(position, buffer, offset, length)&#8221; follows this code path and ends up reusing the connections properly. Creating this JIRA to fix this issue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12896062">HIVE-11945</key>
            <summary>ORC with non-local reads may not be reusing connection to DN</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajesh.balamohan">Rajesh Balamohan</assignee>
                                    <reporter username="rajesh.balamohan">Rajesh Balamohan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Sep 2015 10:15:50 +0000</created>
                <updated>Tue, 16 Feb 2016 23:50:12 +0000</updated>
                            <resolved>Tue, 29 Sep 2015 15:52:01 +0000</resolved>
                                    <version>1.3.0</version>
                    <version>2.0.0</version>
                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14906164" author="rajesh.balamohan" created="Thu, 24 Sep 2015 10:17:50 +0000"  >&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gopalv&quot; class=&quot;user-hover&quot; rel=&quot;gopalv&quot;&gt;gopalv&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14906867" author="sershe" created="Thu, 24 Sep 2015 19:26:55 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;if (zcr != null) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;branch after the removed seek in RecordReaderUtils is not changed. Does it depend on this seek?&lt;/p&gt;

&lt;p&gt;Other than that, the patch makes sense. Did you test that it fixes the issue?&lt;/p&gt;</comment>
                            <comment id="14907063" author="prasanth_j" created="Thu, 24 Sep 2015 21:28:23 +0000"  >&lt;p&gt;Looking at the implementation of readFully(long offset, byte[] buffer, int offset, int length) in FSInputStream, it seems like there are 2 seeks + 1 read with this method. The second seek is to restore the position to the old position. I am guessing this additional seek will be a significant overhead for some filesystems (S3?) right? &lt;/p&gt;</comment>
                            <comment id="14907277" author="rajesh.balamohan" created="Fri, 25 Sep 2015 00:10:46 +0000"  >&lt;p&gt;Thanks for the review comments &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt;.  I will upload revised patch with review comments addressed (to fix zcr &amp;amp; s3 case). &lt;/p&gt;</comment>
                            <comment id="14907635" author="rajesh.balamohan" created="Fri, 25 Sep 2015 05:52:34 +0000"  >&lt;p&gt;Uploading the patch with zcr changes.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt; - S3AInputStream should actually have a lazy seek() implementation which can work well with readFully.  This is followed in PrestoS3FileSystem as well. Will create a separate bug in HDFS to track this.&lt;/p&gt;</comment>
                            <comment id="14908400" author="sershe" created="Fri, 25 Sep 2015 17:52:34 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14908413" author="prasanth_j" created="Fri, 25 Sep 2015 17:57:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rajesh.balamohan&quot; class=&quot;user-hover&quot; rel=&quot;rajesh.balamohan&quot;&gt;rajesh.balamohan&lt;/a&gt; Thanks for the S3 analysis. Can you link the new HDFS jira to this patch? &lt;/p&gt;

&lt;p&gt;The latest patch LGTM as well, +1&lt;/p&gt;</comment>
                            <comment id="14909907" author="hiveqa" created="Sun, 27 Sep 2015 22:02:28 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12762321/HIVE-11945.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12762321/HIVE-11945.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 4 failed/errored test(s), 9616 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestSchedulerQueue - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_vector_groupby_reduce
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_groupby_reduce
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5440/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5440/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5440/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5440/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5440/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5440/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12762321 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14909949" author="rajesh.balamohan" created="Mon, 28 Sep 2015 00:57:13 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt; for the reviews.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt; - I have linked the HDFS jira here.&lt;/p&gt;</comment>
                            <comment id="14934446" author="prasanth_j" created="Tue, 29 Sep 2015 01:12:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rajesh.balamohan&quot; class=&quot;user-hover&quot; rel=&quot;rajesh.balamohan&quot;&gt;rajesh.balamohan&lt;/a&gt; Patch does not apply cleanly on branch-1. Can you reupload a different patch for branch-1? Committed .3 patch to master.&lt;/p&gt;</comment>
                            <comment id="14934944" author="rajesh.balamohan" created="Tue, 29 Sep 2015 10:01:44 +0000"  >&lt;p&gt;Attaching rebased patch for branch-1.&lt;/p&gt;</comment>
                            <comment id="14935351" author="prasanth_j" created="Tue, 29 Sep 2015 15:52:01 +0000"  >&lt;p&gt;Committed to branch-1 and master. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rajesh.balamohan&quot; class=&quot;user-hover&quot; rel=&quot;rajesh.balamohan&quot;&gt;rajesh.balamohan&lt;/a&gt; for the contribution!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12896685">HADOOP-12444</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12896475">HDFS-9146</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12762124" name="HIVE-11945.1.patch" size="4536" author="rajesh.balamohan" created="Thu, 24 Sep 2015 10:17:50 +0000"/>
                            <attachment id="12762320" name="HIVE-11945.2.patch" size="7442" author="rajesh.balamohan" created="Fri, 25 Sep 2015 05:52:34 +0000"/>
                            <attachment id="12764216" name="HIVE-11945.3.branch-1.patch" size="4951" author="rajesh.balamohan" created="Tue, 29 Sep 2015 10:01:44 +0000"/>
                            <attachment id="12762321" name="HIVE-11945.3.patch" size="4944" author="rajesh.balamohan" created="Fri, 25 Sep 2015 05:52:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 8 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2li9b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>