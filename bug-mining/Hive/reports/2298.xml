<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:20:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-7188] sum(if()) returns wrong results with vectorization</title>
                <link>https://issues.apache.org/jira/browse/HIVE-7188</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;1. The tgz file containing the setup is attached.&lt;br/&gt;
2. Run the following query&lt;br/&gt;
select&lt;br/&gt;
    sum(if(is_returning=true and is_free=false,1,0)) as unpaid_returning&lt;br/&gt;
    from hike_error.ttr_day0;&lt;/p&gt;

&lt;p&gt;returns 0 rows with vectorization turned on whereas it return 131 rows with vectorization turned off.&lt;/p&gt;



&lt;p&gt;hive&amp;gt; source insert.sql&lt;br/&gt;
    &amp;gt; ;&lt;br/&gt;
OK&lt;br/&gt;
Time taken: 0.359 seconds&lt;br/&gt;
OK&lt;br/&gt;
Time taken: 0.015 seconds&lt;br/&gt;
OK&lt;br/&gt;
Time taken: 0.069 seconds&lt;br/&gt;
OK&lt;br/&gt;
Time taken: 0.176 seconds&lt;br/&gt;
Loading data to table hike_error.ttr_day0&lt;br/&gt;
Table hike_error.ttr_day0 stats: &lt;span class=&quot;error&quot;&gt;&amp;#91;numFiles=1, numRows=0, totalSize=3581, rawDataSize=0&amp;#93;&lt;/span&gt;&lt;br/&gt;
OK&lt;br/&gt;
Time taken: 0.33 seconds&lt;br/&gt;
hive&amp;gt; select&lt;br/&gt;
    &amp;gt;     sum(if(is_returning=true and is_free=false,1,0)) as unpaid_returning&lt;br/&gt;
    &amp;gt;     from hike_error.ttr_day0;&lt;br/&gt;
Query ID = hsubramaniyan_20140606134646_04790d3d-ca9a-427a-8cf9-3174536114ed&lt;br/&gt;
Total jobs = 1&lt;br/&gt;
Launching Job 1 out of 1&lt;br/&gt;
Number of reduce tasks determined at compile time: 1&lt;br/&gt;
In order to change the average load for a reducer (in bytes):&lt;br/&gt;
  set hive.exec.reducers.bytes.per.reducer=&amp;lt;number&amp;gt;&lt;br/&gt;
In order to limit the maximum number of reducers:&lt;br/&gt;
  set hive.exec.reducers.max=&amp;lt;number&amp;gt;&lt;br/&gt;
In order to set a constant number of reducers:&lt;br/&gt;
  set mapred.reduce.tasks=&amp;lt;number&amp;gt;&lt;br/&gt;
Execution log at: /var/folders/r0/9x0wltgx2nv4m4b18m71z1y40000gr/T//hsubramaniyan/hsubramaniyan_20140606134646_04790d3d-ca9a-427a-8cf9-3174536114ed.log&lt;br/&gt;
Job running in-process (local Hadoop)&lt;br/&gt;
Hadoop job information for null: number of mappers: 0; number of reducers: 0&lt;br/&gt;
2014-06-06 13:47:02,043 null map = 0%,  reduce = 100%&lt;br/&gt;
Ended Job = job_local773704964_0001&lt;br/&gt;
Execution completed successfully&lt;br/&gt;
MapredLocal task succeeded&lt;br/&gt;
OK&lt;br/&gt;
131&lt;br/&gt;
Time taken: 5.325 seconds, Fetched: 1 row(s)&lt;br/&gt;
hive&amp;gt; set hive.vectorized.execution.enabled=true;                                                                &lt;br/&gt;
hive&amp;gt; select&lt;br/&gt;
    &amp;gt;     sum(if(is_returning=true and is_free=false,1,0)) as unpaid_returning&lt;br/&gt;
    &amp;gt;     from hike_error.ttr_day0;&lt;br/&gt;
Query ID = hsubramaniyan_20140606134747_1182c765-90ac-4a33-a8b1-760adca6bf38&lt;br/&gt;
Total jobs = 1&lt;br/&gt;
Launching Job 1 out of 1&lt;br/&gt;
Number of reduce tasks determined at compile time: 1&lt;br/&gt;
In order to change the average load for a reducer (in bytes):&lt;br/&gt;
  set hive.exec.reducers.bytes.per.reducer=&amp;lt;number&amp;gt;&lt;br/&gt;
In order to limit the maximum number of reducers:&lt;br/&gt;
  set hive.exec.reducers.max=&amp;lt;number&amp;gt;&lt;br/&gt;
In order to set a constant number of reducers:&lt;br/&gt;
  set mapred.reduce.tasks=&amp;lt;number&amp;gt;&lt;br/&gt;
Execution log at: /var/folders/r0/9x0wltgx2nv4m4b18m71z1y40000gr/T//hsubramaniyan/hsubramaniyan_20140606134747_1182c765-90ac-4a33-a8b1-760adca6bf38.log&lt;br/&gt;
Job running in-process (local Hadoop)&lt;br/&gt;
Hadoop job information for null: number of mappers: 0; number of reducers: 0&lt;br/&gt;
2014-06-06 13:47:18,604 null map = 0%,  reduce = 100%&lt;br/&gt;
Ended Job = job_local701415676_0001&lt;br/&gt;
Execution completed successfully&lt;br/&gt;
MapredLocal task succeeded&lt;br/&gt;
OK&lt;br/&gt;
0&lt;br/&gt;
Time taken: 5.52 seconds, Fetched: 1 row(s)&lt;br/&gt;
hive&amp;gt; explain select&lt;br/&gt;
    &amp;gt;     sum(if(is_returning=true and is_free=false,1,0)) as unpaid_returning&lt;br/&gt;
    &amp;gt;     from hike_error.ttr_day0;&lt;br/&gt;
OK&lt;br/&gt;
STAGE DEPENDENCIES:&lt;br/&gt;
  Stage-1 is a root stage&lt;br/&gt;
  Stage-0 depends on stages: Stage-1&lt;/p&gt;

&lt;p&gt;STAGE PLANS:&lt;br/&gt;
  Stage: Stage-1&lt;br/&gt;
    Map Reduce&lt;br/&gt;
      Map Operator Tree:&lt;br/&gt;
          TableScan&lt;br/&gt;
            alias: ttr_day0&lt;br/&gt;
            Statistics: Num rows: 447 Data size: 3581 Basic stats: COMPLETE Column stats: NONE&lt;br/&gt;
            Select Operator&lt;br/&gt;
              expressions: is_returning (type: boolean), is_free (type: boolean)&lt;br/&gt;
              outputColumnNames: is_returning, is_free&lt;br/&gt;
              Statistics: Num rows: 447 Data size: 3581 Basic stats: COMPLETE Column stats: NONE&lt;br/&gt;
              Group By Operator&lt;br/&gt;
                aggregations: sum(if(((is_returning = true) and (is_free = false)), 1, 0))&lt;br/&gt;
                mode: hash&lt;br/&gt;
                outputColumnNames: _col0&lt;br/&gt;
                Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE&lt;br/&gt;
                Reduce Output Operator&lt;br/&gt;
                  sort order: &lt;br/&gt;
                  Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE&lt;br/&gt;
                  value expressions: _col0 (type: bigint)&lt;br/&gt;
      Execution mode: vectorized&lt;br/&gt;
      Reduce Operator Tree:&lt;br/&gt;
        Group By Operator&lt;br/&gt;
          aggregations: sum(VALUE._col0)&lt;br/&gt;
          mode: mergepartial&lt;br/&gt;
          outputColumnNames: _col0&lt;br/&gt;
          Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE&lt;br/&gt;
          Select Operator&lt;br/&gt;
            expressions: _col0 (type: bigint)&lt;br/&gt;
            outputColumnNames: _col0&lt;br/&gt;
            Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE&lt;br/&gt;
            File Output Operator&lt;br/&gt;
              compressed: false&lt;br/&gt;
              Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE&lt;br/&gt;
              table:&lt;br/&gt;
                  input format: org.apache.hadoop.mapred.TextInputFormat&lt;br/&gt;
                  output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&lt;br/&gt;
                  serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe&lt;/p&gt;

&lt;p&gt;  Stage: Stage-0&lt;br/&gt;
    Fetch Operator&lt;br/&gt;
      limit: -1&lt;br/&gt;
      Processor Tree:&lt;br/&gt;
        ListSink&lt;/p&gt;

&lt;p&gt;Time taken: 0.079 seconds, Fetched: 49 row(s)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12718935">HIVE-7188</key>
            <summary>sum(if()) returns wrong results with vectorization</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hsubramaniyan">Hari Sankar Sivarama Subramaniyan</assignee>
                                    <reporter username="hsubramaniyan">Hari Sankar Sivarama Subramaniyan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Jun 2014 20:54:03 +0000</created>
                <updated>Thu, 13 Nov 2014 19:42:43 +0000</updated>
                            <resolved>Thu, 19 Jun 2014 23:01:48 +0000</resolved>
                                                    <fixVersion>0.14.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14027561" author="hsubramaniyan" created="Wed, 11 Jun 2014 09:04:27 +0000"  >&lt;p&gt;The current implementation of ColAndCol is buggy. I am modifying the evaluate() of ColAndCol. Will add test cases in the next patch and upload for review.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Hari&lt;/p&gt;</comment>
                            <comment id="14028416" author="hsubramaniyan" created="Wed, 11 Jun 2014 21:24:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/22478&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/22478&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14028525" author="hiveqa" created="Wed, 11 Jun 2014 22:45:37 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12649762/HIVE-7188.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12649762/HIVE-7188.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 5535 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_root_dir_external_table
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_ctas
org.apache.hive.hcatalog.templeton.tool.TestTempletonUtils.testPropertiesParsing
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/440/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/440/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/440/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/440/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-Build-440/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-Build-440/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12649762&lt;/p&gt;</comment>
                            <comment id="14028579" author="jnp" created="Wed, 11 Jun 2014 23:27:14 +0000"  >&lt;p&gt;I have a minor comment on the review board.&lt;br/&gt;
The patch looks good. +1.&lt;/p&gt;

&lt;p&gt;I think similar issues may exist in ColOrCol as well, please file a jira for that too.&lt;/p&gt;</comment>
                            <comment id="14028718" author="hsubramaniyan" created="Thu, 12 Jun 2014 01:48:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jnp&quot; class=&quot;user-hover&quot; rel=&quot;jnp&quot;&gt;jnp&lt;/a&gt; Looked at ColOrCol and it seems to cover all the corner cases with sufficient unit tests. &lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Hari&lt;/p&gt;</comment>
                            <comment id="14028832" author="jnp" created="Thu, 12 Jun 2014 05:14:06 +0000"  >&lt;p&gt;Sounds good. +1&lt;/p&gt;</comment>
                            <comment id="14029123" author="hiveqa" created="Thu, 12 Jun 2014 13:08:01 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12649883/HIVE-7188.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12649883/HIVE-7188.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 4 failed/errored test(s), 5536 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_root_dir_external_table
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_ctas
org.apache.hive.hcatalog.pig.TestHCatLoader.testReadDataPrimitiveTypes
org.apache.hive.hcatalog.templeton.tool.TestTempletonUtils.testPropertiesParsing
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/444/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/444/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/444/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/444/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-Build-444/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-Build-444/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12649883&lt;/p&gt;</comment>
                            <comment id="14031400" author="hsubramaniyan" created="Sat, 14 Jun 2014 02:01:47 +0000"  >&lt;p&gt;The failures are unrelated to the changes.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Hari&lt;/p&gt;</comment>
                            <comment id="14038069" author="jnp" created="Thu, 19 Jun 2014 23:01:48 +0000"  >&lt;p&gt;Committed to trunk. Thanks to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hsubramaniyan&quot; class=&quot;user-hover&quot; rel=&quot;hsubramaniyan&quot;&gt;hsubramaniyan&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="14210813" author="thejas" created="Thu, 13 Nov 2014 19:42:43 +0000"  >&lt;p&gt;This has been fixed in 0.14 release. Please open new jira if you see any issues.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12649762" name="HIVE-7188.1.patch" size="11382" author="hsubramaniyan" created="Wed, 11 Jun 2014 09:04:27 +0000"/>
                            <attachment id="12649883" name="HIVE-7188.2.patch" size="14105" author="hsubramaniyan" created="Wed, 11 Jun 2014 21:18:59 +0000"/>
                            <attachment id="12648721" name="hike-vector-sum-bug.tgz" size="4304" author="hsubramaniyan" created="Fri, 6 Jun 2014 20:54:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>397134</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1wdev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>397257</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>