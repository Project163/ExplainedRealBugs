<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:30:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-8626] Extend HDFS super-user checks to dropPartitions</title>
                <link>https://issues.apache.org/jira/browse/HIVE-8626</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-6392&quot; title=&quot;Hive (and HCatalog) don&amp;#39;t allow super-users to add partitions to tables.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-6392&quot;&gt;&lt;del&gt;HIVE-6392&lt;/del&gt;&lt;/a&gt; takes care of allowing HDFS super-user accounts to register partitions in tables whose HDFS paths don&apos;t explicitly grant write-permissions to the super-user.&lt;/p&gt;

&lt;p&gt;However, the dropPartitions()/dropTable()/dropDatabase() use-cases don&apos;t handle this at all. i.e. An HDFS super-user (&lt;tt&gt;kal_el@DEV.GRID.MYTH.NET&lt;/tt&gt;) can&apos;t drop the very partitions that were added to a table-directory owned by the user (&lt;tt&gt;mithunr&lt;/tt&gt;). The following error is the result:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.DDLTask. MetaException(message:Table metadata not deleted since hdfs://mythcluster-nn1.grid.myth.net:8020/user/mithunr/myth.db/myth_table is not writable by kal_el@DEV.GRID.MYTH.NET)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is the result of redundant checks in &lt;tt&gt;HiveMetaStore::dropPartitionsAndGetLocations()&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;HiveMetaStore.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!wh.isWritable(partPath.getParent())) {
  &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MetaException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Table metadata not deleted since the partition &quot;&lt;/span&gt;
            + Warehouse.makePartName(partitionKeys, part.getValues()) 
            +  &lt;span class=&quot;code-quote&quot;&gt;&quot; has parent location &quot;&lt;/span&gt; + partPath.getParent() 
            + &lt;span class=&quot;code-quote&quot;&gt;&quot; which is not writable &quot;&lt;/span&gt; 
            + &lt;span class=&quot;code-quote&quot;&gt;&quot;by &quot;&lt;/span&gt; + hiveConf.getUser());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This check is already made in StorageBasedAuthorizationProvider. If the argument is that the SBAP isn&apos;t guaranteed to be in play, then this shouldn&apos;t be checked in HMS either. If HDFS permissions need to be checked in addition to say, ACLs, then perhaps a recursively-composed auth-provider ought to be used.&lt;/p&gt;

&lt;p&gt;For the moment, I&apos;ll get &lt;tt&gt;Warehouse.isWritable()&lt;/tt&gt; to handle HDFS super-users. But I think &lt;tt&gt;isWritable()&lt;/tt&gt; checks oughtn&apos;t to be in HiveMetaStore. (Perhaps fix this in another JIRA?)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12750935">HIVE-8626</key>
            <summary>Extend HDFS super-user checks to dropPartitions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mithun">Mithun Radhakrishnan</assignee>
                                    <reporter username="mithun">Mithun Radhakrishnan</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Oct 2014 00:03:02 +0000</created>
                <updated>Mon, 18 May 2015 19:55:06 +0000</updated>
                            <resolved>Sat, 7 Mar 2015 02:37:34 +0000</resolved>
                                    <version>0.14.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14190959" author="mithun" created="Thu, 30 Oct 2014 22:33:18 +0000"  >&lt;p&gt;Attaching a patch for trunk/.&lt;/p&gt;

&lt;p&gt;While working on this JIRA, I noticed that &lt;tt&gt;HadoopShims.checkFileAccess()&lt;/tt&gt; returns &lt;tt&gt;void&lt;/tt&gt; and indicates access-failures using exceptions. Please correct me if I&apos;m wrong, but wouldn&apos;t returning a boolean be less clumsy? There is currently no way to distinguish between a legitimate &quot;false&quot; return from an actual exception condition.&lt;/p&gt;</comment>
                            <comment id="14191544" author="hiveqa" created="Fri, 31 Oct 2014 07:44:22 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12678333/HIVE-8626.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12678333/HIVE-8626.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 6607 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hive.hcatalog.streaming.TestStreaming.testInterleavedTransactionBatchCommits
org.apache.hive.hcatalog.streaming.TestStreaming.testTransactionBatchEmptyCommit
org.apache.hive.minikdc.TestJdbcWithMiniKdc.testNegativeTokenAuth
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1567/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1567/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1567/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1567/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-1567/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-1567/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12678333 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14288109" author="mithun" created="Thu, 22 Jan 2015 19:53:05 +0000"  >&lt;p&gt;Could someone kindly have a look at this one?&lt;/p&gt;</comment>
                            <comment id="14335678" author="thejas" created="Tue, 24 Feb 2015 23:47:06 +0000"  >&lt;p&gt;Patch looks good. +1&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I noticed that HadoopShims.checkFileAccess() returns void and indicates access-failures using exceptions.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;In the use cases that were in mind when it was implemented, it is useful to have an error message detailing why the permission was denied. I would argue that isWritable() should also return an exception and we should log that in the error  that is getting logged when it returns false.&lt;/p&gt;

&lt;p&gt;Regarding the duplicate check in HMS, I agree we should at least have a config to turn it off. The purpose of adding it there i believe was to prevent cases where metadata change is made but it is not possible to make the file change.&lt;/p&gt;</comment>
                            <comment id="14338798" author="thejas" created="Thu, 26 Feb 2015 17:55:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mithun&quot; class=&quot;user-hover&quot; rel=&quot;mithun&quot;&gt;mithun&lt;/a&gt; Can you please rebase this patch ?&lt;/p&gt;</comment>
                            <comment id="14338824" author="mithun" created="Thu, 26 Feb 2015 18:11:42 +0000"  >&lt;p&gt;Yes, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thejas&quot; class=&quot;user-hover&quot; rel=&quot;thejas&quot;&gt;thejas&lt;/a&gt;, will do.&lt;/p&gt;</comment>
                            <comment id="14342807" author="mithun" created="Mon, 2 Mar 2015 06:09:15 +0000"  >&lt;p&gt;Rebased, and simplified slightly. Removed unused imports, etc.&lt;/p&gt;</comment>
                            <comment id="14342974" author="hiveqa" created="Mon, 2 Mar 2015 09:33:25 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12701799/HIVE-8626.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12701799/HIVE-8626.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 7576 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2915/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2915/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2915/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2915/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2915/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2915/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12701799 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14351338" author="thejas" created="Sat, 7 Mar 2015 02:37:34 +0000"  >&lt;p&gt;Thanks for the patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mithun&quot; class=&quot;user-hover&quot; rel=&quot;mithun&quot;&gt;mithun&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="14549000" author="sushanth" created="Mon, 18 May 2015 19:55:06 +0000"  >&lt;p&gt;This issue has been fixed and released as part of the 1.2.0 release. If you find an issue which seems to be related to this one, please create a new jira and link this one with new jira.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12678333" name="HIVE-8626.1.patch" size="2454" author="mithun" created="Thu, 30 Oct 2014 22:33:18 +0000"/>
                            <attachment id="12701799" name="HIVE-8626.2.patch" size="2836" author="mithun" created="Mon, 2 Mar 2015 06:09:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 27 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21n67:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>