<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:07:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-4781] LEFT SEMI JOIN generates wrong results when the number of rows belonging to a single key of the right table exceed hive.join.emit.interval</title>
                <link>https://issues.apache.org/jira/browse/HIVE-4781</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Suppose that we have a query shown below&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; t1 &lt;span class=&quot;code-keyword&quot;&gt;LEFT&lt;/span&gt; SEMI &lt;span class=&quot;code-keyword&quot;&gt;JOIN&lt;/span&gt; t2 &lt;span class=&quot;code-keyword&quot;&gt;ON&lt;/span&gt; (t1.&lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt;=t2.&lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When the number of rows of t2 is larger than hive.join.emit.interval, JoinOperator will emit rows from t1, which will result in redundant output.&lt;/p&gt;

&lt;p&gt;Let&apos;s say t1 is&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and t2 is&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;1
1
1
1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When hive.join.emit.interval=1, the output of above query will be&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;1
1
1
1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The correct result should be &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This problem cannot be found in unit test. Because there is a GBY operator inserted before JoinOperator and we have only 1 mapper, the output of map phase only has distinct keys.&lt;/p&gt;

&lt;p&gt;Please apply the patch &apos;wrong_semi_join.txt&apos; attached below and use &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ant test -Dtestcase=TestMinimrCliDriver -Dqfile=&lt;span class=&quot;code-quote&quot;&gt;&quot;left_semi_join.q&quot;&lt;/span&gt; -Dtest.silent=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; to replay the problem. The wrong result can be found in &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;hive_root_dir&amp;gt;/build/ql/test/logs/clientpositive
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12654282">HIVE-4781</key>
            <summary>LEFT SEMI JOIN generates wrong results when the number of rows belonging to a single key of the right table exceed hive.join.emit.interval</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yhuai">Yin Huai</assignee>
                                    <reporter username="yhuai">Yin Huai</reporter>
                        <labels>
                    </labels>
                <created>Sat, 22 Jun 2013 00:04:50 +0000</created>
                <updated>Tue, 15 Oct 2013 23:29:58 +0000</updated>
                            <resolved>Sun, 30 Jun 2013 16:45:20 +0000</resolved>
                                    <version>0.12.0</version>
                                    <fixVersion>0.12.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13690941" author="yhuai" created="Sat, 22 Jun 2013 00:24:43 +0000"  >&lt;p&gt;Based on my code reading, for LEFT SEMI JOIN, JoinOperator will also put rows from right table (assuming we have a 2-way join at here) into the row container. But for LEFT SEMI JOIN, I think that we can just put the first row from the right table into the container and drop future incoming rows from the right table.&lt;/p&gt;</comment>
                            <comment id="13692198" author="yhuai" created="Mon, 24 Jun 2013 18:10:29 +0000"  >&lt;p&gt;Link this jira to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4689&quot; title=&quot;For outerjoins, joinEmitInterval might make wrong result&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4689&quot;&gt;&lt;del&gt;HIVE-4689&lt;/del&gt;&lt;/a&gt; since joinEmitInterval also introduces problems in outer joins.&lt;/p&gt;</comment>
                            <comment id="13694523" author="yhuai" created="Thu, 27 Jun 2013 06:28:11 +0000"  >&lt;p&gt;got an error when using arc&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Parse Exception: Expected a hunk header, like &apos;Index: /path/to/file.ext&apos; (svn), &apos;Property changes on: /path/to/file.ext&apos; (svn properties), &apos;commit 59bcc3ad6775562f845953cf01624225&apos; (git show), &apos;diff -&lt;del&gt;git&apos; (git diff), or &apos;&lt;/del&gt;-- filename&apos; (unified diff).&lt;/p&gt;

&lt;p&gt;   &amp;gt;&amp;gt;&amp;gt;        1   &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;seems caused by data added for the new test query?&lt;/p&gt;

&lt;p&gt;So, I upload this patch.&lt;/p&gt;</comment>
                            <comment id="13694524" author="yhuai" created="Thu, 27 Jun 2013 06:31:13 +0000"  >&lt;p&gt;I tested all unit tests before the commit of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4496&quot; title=&quot;JDBC2 won&amp;#39;t compile with JDK7&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4496&quot;&gt;&lt;del&gt;HIVE-4496&lt;/del&gt;&lt;/a&gt;. all unit tests pass&lt;/p&gt;</comment>
                            <comment id="13696284" author="ashutoshc" created="Sun, 30 Jun 2013 06:16:11 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13696370" author="ashutoshc" created="Sun, 30 Jun 2013 16:45:20 +0000"  >&lt;p&gt;Committed to trunk. Thanks, Yin!&lt;/p&gt;</comment>
                            <comment id="13696592" author="hudson" created="Mon, 1 Jul 2013 05:25:49 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #2171 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/2171/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/2171/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4781&quot; title=&quot;LEFT SEMI JOIN generates wrong results when the number of rows belonging to a single key of the right table exceed hive.join.emit.interval&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4781&quot;&gt;&lt;del&gt;HIVE-4781&lt;/del&gt;&lt;/a&gt; : LEFT SEMI JOIN generates wrong results when the number of rows belonging to a single key of the right table exceed hive.join.emit.interval (Yin Huai via Ashutosh Chauhan) (Revision 1498150)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
hashutosh : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1498150&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1498150&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/build-common.xml&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/JoinOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/leftsemijoin_mr.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/leftsemijoin_mr.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13696597" author="yhuai" created="Mon, 1 Jul 2013 05:47:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; Seems you did not check in data files for the new unit test (&lt;a href=&quot;https://github.com/apache/hive/commit/f3da9ff4876dc4066776700122075248884031b0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/commit/f3da9ff4876dc4066776700122075248884031b0&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="13696602" author="ashutoshc" created="Mon, 1 Jul 2013 06:14:52 +0000"  >&lt;p&gt;yeah... Thanks for letting me know. Added now.&lt;/p&gt;</comment>
                            <comment id="13696736" author="hudson" created="Mon, 1 Jul 2013 11:21:00 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #266 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/266/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/266/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4781&quot; title=&quot;LEFT SEMI JOIN generates wrong results when the number of rows belonging to a single key of the right table exceed hive.join.emit.interval&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4781&quot;&gt;&lt;del&gt;HIVE-4781&lt;/del&gt;&lt;/a&gt; : LEFT SEMI JOIN generates wrong results when the number of rows belonging to a single key of the right table exceed hive.join.emit.interval (Yin Huai via Ashutosh Chauhan) (Revision 1498150)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
hashutosh : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1498150&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1498150&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/build-common.xml&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/JoinOperator.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/leftsemijoin_mr.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/leftsemijoin_mr.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13696951" author="hudson" created="Mon, 1 Jul 2013 16:50:19 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #2172 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/2172/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/2172/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4781&quot; title=&quot;LEFT SEMI JOIN generates wrong results when the number of rows belonging to a single key of the right table exceed hive.join.emit.interval&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4781&quot;&gt;&lt;del&gt;HIVE-4781&lt;/del&gt;&lt;/a&gt; : Adding new data files for tests. Missed in original commit. (Revision 1498238)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
hashutosh : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1498238&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1498238&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/data/files/leftsemijoin_mr_t1.txt&lt;/li&gt;
	&lt;li&gt;/hive/trunk/data/files/leftsemijoin_mr_t2.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13697440" author="hudson" created="Tue, 2 Jul 2013 02:53:33 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #267 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/267/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/267/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4781&quot; title=&quot;LEFT SEMI JOIN generates wrong results when the number of rows belonging to a single key of the right table exceed hive.join.emit.interval&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4781&quot;&gt;&lt;del&gt;HIVE-4781&lt;/del&gt;&lt;/a&gt; : Adding new data files for tests. Missed in original commit. (Revision 1498238)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
hashutosh : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1498238&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1498238&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/data/files/leftsemijoin_mr_t1.txt&lt;/li&gt;
	&lt;li&gt;/hive/trunk/data/files/leftsemijoin_mr_t2.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13795947" author="ashutoshc" created="Tue, 15 Oct 2013 23:29:58 +0000"  >&lt;p&gt;This issue has been fixed and released as part of 0.12 release. If you find further issues, please create a new jira and link it to this one.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12651896">HIVE-4689</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12589844" name="HIVE-4781.txt" size="6957" author="yhuai" created="Thu, 27 Jun 2013 06:28:11 +0000"/>
                            <attachment id="12589201" name="wrong_semi_join.txt" size="3264" author="yhuai" created="Sat, 22 Jun 2013 00:05:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>334559</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 6 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1lpnb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>334885</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>