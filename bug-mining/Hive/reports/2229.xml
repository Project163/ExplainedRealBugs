<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:19:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-7066] hive-exec jar is missing avro core</title>
                <link>https://issues.apache.org/jira/browse/HIVE-7066</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Running a simple query that reads an Avro table caused the following exception to be thrown on the cluster side:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.RuntimeException: org.apache.hive.com.esotericsoftware.kryo.KryoException: java.lang.IllegalArgumentException: Unable to create serializer &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.hive.com.esotericsoftware.kryo.serializers.FieldSerializer&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; class: org.apache.hadoop.hive.ql.io.avro.AvroContainerOutputFormat
Serialization trace:
outputFileFormatClass (org.apache.hadoop.hive.ql.plan.PartitionDesc)
aliasToPartnInfo (org.apache.hadoop.hive.ql.plan.MapWork)
	at org.apache.hadoop.hive.ql.exec.Utilities.getBaseWork(Utilities.java:365)
	at org.apache.hadoop.hive.ql.exec.Utilities.getMapWork(Utilities.java:276)
	at org.apache.hadoop.hive.ql.io.HiveInputFormat.init(HiveInputFormat.java:254)
	at org.apache.hadoop.hive.ql.io.HiveInputFormat.pushProjectionsAndFilters(HiveInputFormat.java:445)
	at org.apache.hadoop.hive.ql.io.HiveInputFormat.pushProjectionsAndFilters(HiveInputFormat.java:438)
	at org.apache.hadoop.hive.ql.io.CombineHiveInputFormat.getRecordReader(CombineHiveInputFormat.java:587)
	at org.apache.hadoop.mapred.MapTask$TrackedRecordReader.&amp;lt;init&amp;gt;(MapTask.java:191)
	at org.apache.hadoop.mapred.MapTask.runOldMapper(MapTask.java:412)
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:366)
	at org.apache.hadoop.mapred.Child$4.run(Child.java:255)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:394)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1190)
	at org.apache.hadoop.mapred.Child.main(Child.java:249)
Caused by: org.apache.hive.com.esotericsoftware.kryo.KryoException: java.lang.IllegalArgumentException: Unable to create serializer &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.hive.com.esotericsoftware.kryo.serializers.FieldSerializer&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; class: org.apache.hadoop.hive.ql.io.avro.AvroContainerOutputFormat
Serialization trace:
outputFileFormatClass (org.apache.hadoop.hive.ql.plan.PartitionDesc)
aliasToPartnInfo (org.apache.hadoop.hive.ql.plan.MapWork)
	at org.apache.hive.com.esotericsoftware.kryo.serializers.ObjectField.read(ObjectField.java:125)
	at org.apache.hive.com.esotericsoftware.kryo.serializers.FieldSerializer.read(FieldSerializer.java:507)
	at org.apache.hive.com.esotericsoftware.kryo.Kryo.readClassAndObject(Kryo.java:776)
	at org.apache.hive.com.esotericsoftware.kryo.serializers.MapSerializer.read(MapSerializer.java:139)
	at org.apache.hive.com.esotericsoftware.kryo.serializers.MapSerializer.read(MapSerializer.java:17)
	at org.apache.hive.com.esotericsoftware.kryo.Kryo.readObject(Kryo.java:694)
	at org.apache.hive.com.esotericsoftware.kryo.serializers.ObjectField.read(ObjectField.java:106)
	at org.apache.hive.com.esotericsoftware.kryo.serializers.FieldSerializer.read(FieldSerializer.java:507)
	at org.apache.hive.com.esotericsoftware.kryo.Kryo.readObject(Kryo.java:672)
	at org.apache.hadoop.hive.ql.exec.Utilities.deserializeObjectByKryo(Utilities.java:942)
	at org.apache.hadoop.hive.ql.exec.Utilities.deserializePlan(Utilities.java:850)
	at org.apache.hadoop.hive.ql.exec.Utilities.deserializePlan(Utilities.java:864)
	at org.apache.hadoop.hive.ql.exec.Utilities.getBaseWork(Utilities.java:334)
	... 13 more
Caused by: java.lang.IllegalArgumentException: Unable to create serializer &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.hive.com.esotericsoftware.kryo.serializers.FieldSerializer&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; class: org.apache.hadoop.hive.ql.io.avro.AvroContainerOutputFormat
	at org.apache.hive.com.esotericsoftware.kryo.factories.ReflectionSerializerFactory.makeSerializer(ReflectionSerializerFactory.java:45)
	at org.apache.hive.com.esotericsoftware.kryo.factories.ReflectionSerializerFactory.makeSerializer(ReflectionSerializerFactory.java:26)
	at org.apache.hive.com.esotericsoftware.kryo.Kryo.newDefaultSerializer(Kryo.java:343)
	at org.apache.hive.com.esotericsoftware.kryo.Kryo.getDefaultSerializer(Kryo.java:336)
	at org.apache.hive.com.esotericsoftware.kryo.util.DefaultClassResolver.registerImplicit(DefaultClassResolver.java:56)
	at org.apache.hive.com.esotericsoftware.kryo.Kryo.getRegistration(Kryo.java:476)
	at org.apache.hive.com.esotericsoftware.kryo.util.DefaultClassResolver.readName(DefaultClassResolver.java:148)
	at org.apache.hive.com.esotericsoftware.kryo.util.DefaultClassResolver.readClass(DefaultClassResolver.java:115)
	at org.apache.hive.com.esotericsoftware.kryo.Kryo.readClass(Kryo.java:656)
	at org.apache.hive.com.esotericsoftware.kryo.serializers.DefaultSerializers$ClassSerializer.read(DefaultSerializers.java:238)
	at org.apache.hive.com.esotericsoftware.kryo.serializers.DefaultSerializers$ClassSerializer.read(DefaultSerializers.java:226)
	at org.apache.hive.com.esotericsoftware.kryo.Kryo.readObjectOrNull(Kryo.java:745)
	at org.apache.hive.com.esotericsoftware.kryo.serializers.ObjectField.read(ObjectField.java:113)
	... 25 more
Caused by: java.lang.reflect.InvocationTargetException
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:513)
	at org.apache.hive.com.esotericsoftware.kryo.factories.ReflectionSerializerFactory.makeSerializer(ReflectionSerializerFactory.java:32)
	... 37 more
Caused by: java.lang.NoClassDefFoundError: org/apache/avro/io/DatumWriter
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.getDeclaredFields0(Native Method)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.privateGetDeclaredFields(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:2348)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.getDeclaredFields(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:1779)
	at org.apache.hive.com.esotericsoftware.kryo.serializers.FieldSerializer.rebuildCachedFields(FieldSerializer.java:150)
	at org.apache.hive.com.esotericsoftware.kryo.serializers.FieldSerializer.&amp;lt;init&amp;gt;(FieldSerializer.java:109)
	... 42 more
Caused by: java.lang.ClassNotFoundException: org.apache.avro.io.DatumWriter
	at java.net.URLClassLoader$1.run(URLClassLoader.java:202)
	at java.security.AccessController.doPrivileged(Native Method)
	at java.net.URLClassLoader.findClass(URLClassLoader.java:190)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:306)
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:301)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:247)
	... 47 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I took a look at the hive-exec jar and found that the Avro core jar was not included, though avro-mapred is included.&lt;/p&gt;

&lt;p&gt;I confirmed that Avro core was included in the Hive 0.12 hive-exec jar. Was there a reason why this was removed in trunk? It seems that this would break the AvroSerDe.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12714343">HIVE-7066</key>
            <summary>hive-exec jar is missing avro core</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davidzchen">David Chen</assignee>
                                    <reporter username="davidzchen">David Chen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 May 2014 23:05:20 +0000</created>
                <updated>Thu, 13 Nov 2014 19:44:00 +0000</updated>
                            <resolved>Wed, 21 May 2014 21:18:44 +0000</resolved>
                                    <version>0.13.0</version>
                    <version>0.13.1</version>
                                    <fixVersion>0.14.0</fixVersion>
                                    <component>Build Infrastructure</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13998274" author="davidzchen" created="Wed, 14 May 2014 23:41:05 +0000"  >&lt;p&gt;I have posted a patch for a fix. I have tested this on trunk by confirming that Avro core is in the hive-exec jar and successfully running a simple Hive query against a table registered with the AvroSerDe. The fix was a simple 1 line change. It looks like this issue was caused by the Ant -&amp;gt; Maven switch and the avro core jar was inadvertently left out when creating the hive-exec  jar.&lt;/p&gt;

&lt;p&gt;I am not able to create an RB right now because RB is giving me a 502 error when I try to create a new review request, both using &lt;tt&gt;rbt post&lt;/tt&gt; and manually via the RB web UI. I will try to create a RB later. &lt;/p&gt;</comment>
                            <comment id="13998278" author="davidzchen" created="Wed, 14 May 2014 23:47:10 +0000"  >&lt;p&gt;RB: &lt;a href=&quot;https://reviews.apache.org/r/21471&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/21471&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13998771" author="xuefuz" created="Thu, 15 May 2014 13:42:41 +0000"  >&lt;p&gt;Thanks for the patch. What query are you running that demonstrates the problem? Recently I worked on &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5823&quot; title=&quot;Support for DECIMAL primitive type in AvroSerDe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5823&quot;&gt;&lt;del&gt;HIVE-5823&lt;/del&gt;&lt;/a&gt;, and didn&apos;t hit the problem you described. I&apos;d like to reproduce the problem in order to verify your fix.&lt;/p&gt;</comment>
                            <comment id="13999251" author="hiveqa" created="Thu, 15 May 2014 21:02:13 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 no tests executed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12644913/HIVE-7066.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12644913/HIVE-7066.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/204/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/204/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/204/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/204/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12644913&lt;/p&gt;</comment>
                            <comment id="14000456" author="davidzchen" created="Fri, 16 May 2014 23:00:37 +0000"  >&lt;p&gt;Hi Xuefu, I simply ran &lt;tt&gt;select count(1) from avro-table;&lt;/tt&gt;. I ran &lt;tt&gt;mvn clean install -DskipTests -Phadoop-1 -Pdist&lt;/tt&gt; to build Hive, create the tarball, unzipped it and set up a local metastore and ran the query.&lt;/p&gt;</comment>
                            <comment id="14002601" author="davidzchen" created="Mon, 19 May 2014 23:53:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt;, were you able to reproduce the problem? Do you have any more feedback on this patch before it can be merged?&lt;/p&gt;</comment>
                            <comment id="14003576" author="xuefuz" created="Tue, 20 May 2014 16:20:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davidzchen&quot; class=&quot;user-hover&quot; rel=&quot;davidzchen&quot;&gt;davidzchen&lt;/a&gt; I ran your mvn command and built a tarball. I unzipped it, and found in the lib directory there is a jar named avro-1.7.5.jar. Is this what you need? I thought all jars under /lib will be shipped to the cluster. BTW, I was able to run avro query from this build, though my cluster may already have the avro jar.&lt;/p&gt;

&lt;p&gt;Your change seems to shade the avro jar in Hive libexec jar, but the JIRA&apos;s title mentiones avro-mapred. I&apos;m little confused.&lt;/p&gt;</comment>
                            <comment id="14003871" author="davidzchen" created="Tue, 20 May 2014 19:32:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt; Sorry for the confusion. The title should be referring to avro core and not avro-mapred. avro-mapred is already included but avro core is not.&lt;/p&gt;

&lt;p&gt;From what I understand, only the hive-exec jar is shipped to the cluster. The jars under /lib are used by Hive locally before firing the MapReduce jobs. If your cluster already has the Avro jar, then the query would work. In this case, I was simply running a local instance; further, we do not install Avro on each node but rather expect jobs to provide the jars. Based on the testing that I have done, if avro core is not present in the hive-exec jar, then queries that read tables registered with the AvroSerDe fails with the above exception.&lt;/p&gt;</comment>
                            <comment id="14003993" author="xuefuz" created="Tue, 20 May 2014 21:23:13 +0000"  >&lt;p&gt;Okay. +1&lt;/p&gt;</comment>
                            <comment id="14005251" author="cwsteinbach" created="Wed, 21 May 2014 21:18:44 +0000"  >&lt;p&gt;Committed to trunk. Thanks David!&lt;/p&gt;</comment>
                            <comment id="14211077" author="thejas" created="Thu, 13 Nov 2014 19:44:00 +0000"  >&lt;p&gt;This has been fixed in 0.14 release. Please open new jira if you see any issues.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12644913" name="HIVE-7066.1.patch" size="887" author="davidzchen" created="Wed, 14 May 2014 23:36:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>392656</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1vmav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>392836</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>