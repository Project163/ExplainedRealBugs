<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:43:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-13255] FloatTreeReader.nextVector is expensive </title>
                <link>https://issues.apache.org/jira/browse/HIVE-13255</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Some TPCDS queries on 1TB scale shows FloatTreeReader on profile samples. It is most likely because of multiple branching and polymorphic dispatch in FloatTreeReader.nextVector() implementation. See attached image for sampling profile output.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12948623">HIVE-13255</key>
            <summary>FloatTreeReader.nextVector is expensive </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="prasanth_j">Prasanth Jayachandran</assignee>
                                    <reporter username="prasanth_j">Prasanth Jayachandran</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Mar 2016 01:40:46 +0000</created>
                <updated>Tue, 21 Jun 2016 15:44:07 +0000</updated>
                            <resolved>Thu, 31 Mar 2016 09:54:29 +0000</resolved>
                                    <version>2.1.0</version>
                                    <fixVersion>2.0.1</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>ORC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15216925" author="prasanth_j" created="Tue, 29 Mar 2016 22:00:08 +0000"  >&lt;p&gt;3 perf related issues found in FloatTreeReader.nextVector(). &lt;br/&gt;
1) i2l java bytecode found in inner loop. batchSize is long and loop index is int. This inserts integer 2 long casts in inner loop&lt;br/&gt;
2) SerializationUtils.readFloat() has 4 invokevirtual whereas a readDouble has only one as readFloat is not buffered&lt;br/&gt;
3) The JVM bytecode size for FloatTreeReader.nextVector() is 334 bytes which will prevent this method from being inlined though being hot (has to less than 325 bytes for hot method inlining)&lt;/p&gt;

&lt;p&gt;After the patch the bytecode size is reduced to 300 bytes and float reader perf is &amp;lt;10% in perf-map&lt;/p&gt;

&lt;p&gt;cc/ &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gopalv&quot; class=&quot;user-hover&quot; rel=&quot;gopalv&quot;&gt;gopalv&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15217509" author="gopalv" created="Wed, 30 Mar 2016 06:42:33 +0000"  >&lt;p&gt;LGTM - +1.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;in.read(readBuffer, 0, 4);&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;does this need a check for the return value? &lt;/p&gt;

&lt;p&gt;I know that InStream always returns the asked size, but that&apos;s not in the contract of InputStream.&lt;/p&gt;</comment>
                            <comment id="15218883" author="prasanth_j" created="Wed, 30 Mar 2016 21:21:02 +0000"  >&lt;p&gt;Updated readFloat and readDouble to honor InputStream read() contract.&lt;/p&gt;</comment>
                            <comment id="15218897" author="prasanth_j" created="Wed, 30 Mar 2016 21:29:31 +0000"  >&lt;p&gt;It definitely needs &amp;lt;0 check. But might not need the looping until requested size satisfied logic. Since we are passing the InputStream instead of InStream (does not need looping logic), I added that as well to the latest patch. Branch prediction + inlining should mitigate the branch cost. &lt;/p&gt;</comment>
                            <comment id="15219465" author="hiveqa" created="Thu, 31 Mar 2016 06:42:47 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12796165/HIVE-13255.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12796165/HIVE-13255.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 6 failed/errored test(s), 9893 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestSparkCliDriver-groupby3_map.q-sample2.q-auto_join14.q-and-12-more - did not produce a TEST-*.xml file
TestSparkCliDriver-groupby_map_ppr_multi_distinct.q-table_access_keys_stats.q-groupby4_noskew.q-and-12-more - did not produce a TEST-*.xml file
TestSparkCliDriver-join_rc.q-insert1.q-vectorized_rcfile_columnar.q-and-12-more - did not produce a TEST-*.xml file
TestSparkCliDriver-parallel_join0.q-union_remove_9.q-smb_mapjoin_21.q-and-12-more - did not produce a TEST-*.xml file
TestSparkCliDriver-ppd_join4.q-join9.q-ppd_join3.q-and-12-more - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_index_bitmap3
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/7421/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/7421/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/7421/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/7421/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-7421/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-7421/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 6 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12796165 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="15219685" author="prasanth_j" created="Thu, 31 Mar 2016 09:55:00 +0000"  >&lt;p&gt;Committed to branch-2.0 because of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-13397&quot; title=&quot;ORC CompressedStream.read implementation not compatible with SerializationUtils in exceptional case&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-13397&quot;&gt;&lt;del&gt;HIVE-13397&lt;/del&gt;&lt;/a&gt; and also to master.&lt;/p&gt;</comment>
                            <comment id="15219686" author="prasanth_j" created="Thu, 31 Mar 2016 09:55:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=melode11&quot; class=&quot;user-hover&quot; rel=&quot;melode11&quot;&gt;melode11&lt;/a&gt; This is fixed as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-13255&quot; title=&quot;FloatTreeReader.nextVector is expensive &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-13255&quot;&gt;&lt;del&gt;HIVE-13255&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12795939" name="HIVE-13255.1.patch" size="19015" author="prasanth_j" created="Tue, 29 Mar 2016 22:00:47 +0000"/>
                            <attachment id="12796165" name="HIVE-13255.2.patch" size="20020" author="prasanth_j" created="Wed, 30 Mar 2016 21:21:02 +0000"/>
                            <attachment id="12795936" name="bytecode-size-after.png" size="73052" author="prasanth_j" created="Tue, 29 Mar 2016 22:00:24 +0000"/>
                            <attachment id="12795937" name="bytecode-size-before.png" size="74709" author="prasanth_j" created="Tue, 29 Mar 2016 22:00:24 +0000"/>
                            <attachment id="12795938" name="float-reader-perf.png" size="147530" author="prasanth_j" created="Tue, 29 Mar 2016 22:00:24 +0000"/>
                            <attachment id="12792413" name="q1-bottleneck.png" size="109333" author="prasanth_j" created="Thu, 10 Mar 2016 01:41:35 +0000"/>
                            <attachment id="12792414" name="q1-warm-perf-map.png" size="141643" author="prasanth_j" created="Thu, 10 Mar 2016 01:41:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 33 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uftr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12334886">2.0.1</customfieldvalue>
    <customfieldvalue id="12334255">2.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>