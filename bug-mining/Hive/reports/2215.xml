<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:19:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-7012] Wrong RS de-duplication in the ReduceSinkDeDuplication Optimizer</title>
                <link>https://issues.apache.org/jira/browse/HIVE-7012</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;With HIVE 0.13.0, run the following test case:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;create&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;table&lt;/span&gt; src(&lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;bigint&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;string&lt;/span&gt;);

&lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt;  
   &lt;span class=&quot;code-keyword&quot;&gt;count&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;distinct&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; col0
&lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; src
&lt;span class=&quot;code-keyword&quot;&gt;order&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;by&lt;/span&gt; col0;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The following exception will be thrown:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.RuntimeException: Error in configuring object
	at org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:93)
	at org.apache.hadoop.util.ReflectionUtils.setConf(ReflectionUtils.java:64)
	at org.apache.hadoop.util.ReflectionUtils.newInstance(ReflectionUtils.java:117)
	at org.apache.hadoop.mapred.ReduceTask.runOldReducer(ReduceTask.java:485)
	at org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:420)
	at org.apache.hadoop.mapred.Child$4.run(Child.java:255)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:396)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1121)
	at org.apache.hadoop.mapred.Child.main(Child.java:249)
Caused by: java.lang.reflect.InvocationTargetException
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.apache.hadoop.util.ReflectionUtils.setJobConf(ReflectionUtils.java:88)
	... 9 more
Caused by: java.lang.RuntimeException: Reduce operator initialization failed
	at org.apache.hadoop.hive.ql.exec.mr.ExecReducer.configure(ExecReducer.java:173)
	... 14 more
Caused by: java.lang.RuntimeException: cannot find field _col0 from [0:reducesinkkey0]
	at org.apache.hadoop.hive.serde2.objectinspector.ObjectInspectorUtils.getStandardStructFieldRef(ObjectInspectorUtils.java:415)
	at org.apache.hadoop.hive.serde2.objectinspector.StandardStructObjectInspector.getStructFieldRef(StandardStructObjectInspector.java:150)
	at org.apache.hadoop.hive.ql.exec.ExprNodeColumnEvaluator.initialize(ExprNodeColumnEvaluator.java:79)
	at org.apache.hadoop.hive.ql.exec.GroupByOperator.initializeOp(GroupByOperator.java:288)
	at org.apache.hadoop.hive.ql.exec.Operator.initialize(Operator.java:376)
	at org.apache.hadoop.hive.ql.exec.mr.ExecReducer.configure(ExecReducer.java:166)
	... 14 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This issue is related to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-6455&quot; title=&quot;Scalable dynamic partitioning and bucketing optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-6455&quot;&gt;&lt;del&gt;HIVE-6455&lt;/del&gt;&lt;/a&gt;. When hive.optimize.reducededuplication is set to false, then this issue will be gone.&lt;/p&gt;

&lt;p&gt;Logical plan when hive.optimize.reducededuplication=false;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;src 
  TableScan (TS_0)
    alias: src
    Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: NONE
    Select Operator (SEL_1)
      expressions: key (type: bigint)
      outputColumnNames: key
      Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: NONE
      Group By Operator (GBY_2)
        aggregations: count(DISTINCT key)
        keys: key (type: bigint)
        mode: hash
        outputColumnNames: _col0, _col1
        Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: NONE
        Reduce Output Operator (RS_3)
          istinctColumnIndices:
          key expressions: _col0 (type: bigint)
          DistributionKeys: 0
          sort order: +
          OutputKeyColumnNames: _col0
          Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: NONE
          Group By Operator (GBY_4)
            aggregations: count(DISTINCT KEY._col0:0._col0)
            mode: mergepartial
            outputColumnNames: _col0
            Statistics: Num rows: 1 Data size: 16 Basic stats: COMPLETE Column stats: NONE
            Select Operator (SEL_5)
              expressions: _col0 (type: bigint)
              outputColumnNames: _col0
              Statistics: Num rows: 1 Data size: 16 Basic stats: COMPLETE Column stats: NONE
              Reduce Output Operator (RS_6)
                key expressions: _col0 (type: bigint)
                DistributionKeys: 1
                sort order: +
                OutputKeyColumnNames: reducesinkkey0
                OutputVAlueColumnNames: _col0
                Statistics: Num rows: 1 Data size: 16 Basic stats: COMPLETE Column stats: NONE
                value expressions: _col0 (type: bigint)
                Extract (EX_7)
                  Statistics: Num rows: 1 Data size: 16 Basic stats: COMPLETE Column stats: NONE
                  File Output Operator (FS_8)
                    compressed: false
                    Statistics: Num rows: 1 Data size: 16 Basic stats: COMPLETE Column stats: NONE
                    table:
                        input format: org.apache.hadoop.mapred.TextInputFormat
                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You will see that RS_3 and RS_6 are not merged.&lt;/p&gt;

&lt;p&gt;Logical plan when hive.optimize.reducededuplication=true;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;src 
  TableScan (TS_0)
    alias: src
    Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: NONE
    Select Operator (SEL_1)
      expressions: key (type: bigint)
      outputColumnNames: key
      Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: NONE
      Group By Operator (GBY_2)
        aggregations: count(DISTINCT key)
        keys: key (type: bigint)
        mode: hash
        outputColumnNames: _col0, _col1
        Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: NONE
        Reduce Output Operator (RS_3)
          istinctColumnIndices:
          key expressions: _col0 (type: bigint)
          DistributionKeys: 1
          sort order: +
          OutputKeyColumnNames: reducesinkkey0
          Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: NONE
          Group By Operator (GBY_4)
            aggregations: count(DISTINCT KEY._col0:0._col0)
            mode: mergepartial
            outputColumnNames: _col0
            Statistics: Num rows: 1 Data size: 16 Basic stats: COMPLETE Column stats: NONE
            Select Operator (SEL_5)
              expressions: _col0 (type: bigint)
              outputColumnNames: _col0
              Statistics: Num rows: 1 Data size: 16 Basic stats: COMPLETE Column stats: NONE
              File Output Operator (FS_8)
                compressed: false
                Statistics: Num rows: 1 Data size: 16 Basic stats: COMPLETE Column stats: NONE
                table:
                    input format: org.apache.hadoop.mapred.TextInputFormat
                    output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
                    serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You will see that RS_6 has been merged into RS_3. However, Obviously the merge is incorrect because RS_3 and RS_6 have different sort keys. (The sort key for RS_3 is&lt;br/&gt;
key and the sort key for RS_6 is count(distinct key)).&lt;/p&gt;

&lt;p&gt;The problem is that the method sameKeys() returns the result that both RS have same keys. sameKeys() depends ExprNodeDescUtils.backtrack() to backtrack a key expr of cRS to pRS.&lt;/p&gt;

&lt;p&gt;I don&apos;t understand the logical behind the following logic in ExprNodeDescUtils: &lt;br/&gt;
  Why still backtrack when there is no mapping for the column of the current operator?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; ExprNodeDesc backtrack(ExprNodeColumnDesc column, Operator&amp;lt;?&amp;gt; current,
      Operator&amp;lt;?&amp;gt; terminal) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SemanticException {
    ...
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (mapping == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || !mapping.containsKey(column.getColumn())) {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; backtrack((ExprNodeDesc)column, current, terminal);
    }
    ...
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The process of backtracking _col0 of cRS to pRS:&lt;br/&gt;
RS_6:_col0 --&amp;gt; SEL_5:_col0 --&amp;gt; GBY_4:_col0 (because the colExprMap is null for GBY_4) --&amp;gt; RS_3:_col0 (No mapping for output column _col0), which is a wrong backtrack.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12712105">HIVE-7012</key>
            <summary>Wrong RS de-duplication in the ReduceSinkDeDuplication Optimizer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sunrui">Sun Rui</reporter>
                        <labels>
                    </labels>
                <created>Sat, 3 May 2014 09:20:49 +0000</created>
                <updated>Tue, 9 Aug 2022 06:03:29 +0000</updated>
                            <resolved>Tue, 13 May 2014 16:18:00 +0000</resolved>
                                    <version>0.13.0</version>
                                    <fixVersion>0.14.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13988631" author="sunrui" created="Sat, 3 May 2014 09:28:17 +0000"  >&lt;p&gt;I am thinking about the following fix, but not sure if right:&lt;/p&gt;

&lt;p&gt;sameKeys():&lt;/p&gt;

&lt;p&gt;        ExprNodeDesc pexpr = pexprs.get&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;;&lt;br/&gt;
        ExprNodeDesc cexpr = ExprNodeDescUtils.backtrack(cexprs.get&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, child, parent);&lt;br/&gt;
        // check if cexpr is from the parent&lt;br/&gt;
        if (cexpr == null || (cexpr not contained in the colExprMap of the parent operator) || !pexpr.isSame(cexpr)) &lt;/p&gt;
{
          return null;
        }</comment>
                            <comment id="13991672" author="navis" created="Wed, 7 May 2014 08:48:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sunrui&quot; class=&quot;user-hover&quot; rel=&quot;sunrui&quot;&gt;sunrui&lt;/a&gt; You&apos;re right. It&apos;s wrong assumption. I think there was some historical issue for things done like that. Let&apos;s see what will happen with the patch.&lt;/p&gt;</comment>
                            <comment id="13993301" author="hiveqa" created="Fri, 9 May 2014 01:42:12 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12643724/HIVE-7012.1.patch.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12643724/HIVE-7012.1.patch.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 8 failed/errored test(s), 5433 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_fetch_aggregation
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ppd2
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_reduce_deduplicate_extended
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_partscan_1_23
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_root_dir_external_table
org.apache.hadoop.hive.ql.parse.TestParse.testParse_input20
org.apache.hadoop.hive.ql.parse.TestParse.testParse_input4
org.apache.hadoop.hive.ql.parse.TestParse.testParse_input5
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/148/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/148/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/148/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/148/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 8 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12643724&lt;/p&gt;</comment>
                            <comment id="13993768" author="ashutoshc" created="Fri, 9 May 2014 18:07:12 +0000"  >&lt;p&gt;reduce_deduplicate_extended.q, ppd.q, fetch_aggregation.q failures might be relevant. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; can you take a look?&lt;/p&gt;</comment>
                            <comment id="13993937" author="ashutoshc" created="Fri, 9 May 2014 21:32:04 +0000"  >&lt;p&gt;Please ignore my previous comment, it seems your new patch takes care of those failures.&lt;/p&gt;</comment>
                            <comment id="13993941" author="ashutoshc" created="Fri, 9 May 2014 21:36:01 +0000"  >&lt;p&gt;In ppd2.q.out looks like new MR stage got added, looks like RS-dedup optimization got disabled for it. That looks like performance regression. Was that intentional ?&lt;/p&gt;</comment>
                            <comment id="13994368" author="sunrui" created="Sun, 11 May 2014 01:30:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; I verified that your patch solved my problem. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yhuai&quot; class=&quot;user-hover&quot; rel=&quot;yhuai&quot;&gt;yhuai&lt;/a&gt; However, I suspect that the optimizer may still have bug when there are distinct expressions. It seems that the optimizer has not taken support for distinct keys into consideration when it was being implemented. Note that keyCols in ReduceSinkDesc is composed of groupby keys and possibly distinct keys. For example, assume cRS and pRS both have KeyCols as (a, b, c, d) and numDistributionKeys=2. cRS may have distinct expressions like distinct(c, d) while pRS may have distinct expressions like distinct(c), distinct(d). In this case, they have different sort keys while their KeyCols are same. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yhuai&quot; class=&quot;user-hover&quot; rel=&quot;yhuai&quot;&gt;yhuai&lt;/a&gt; what do you think?&lt;/p&gt;</comment>
                            <comment id="13994580" author="hiveqa" created="Sun, 11 May 2014 15:30:53 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12644076/HIVE-7012.2.patch.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12644076/HIVE-7012.2.patch.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 2 failed/errored test(s), 5503 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_partscan_1_23
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_root_dir_external_table
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/174/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/174/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/174/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/174/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12644076&lt;/p&gt;</comment>
                            <comment id="13994895" author="navis" created="Mon, 12 May 2014 07:41:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; Yes, it&apos;s intended. In the query ppd2.q&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;select a.*
  from (
    select key, count(value) as cc
    from srcpart a
    where a.ds = &lt;span class=&quot;code-quote&quot;&gt;&apos;2008-04-08&apos;&lt;/span&gt; and a.hr = &lt;span class=&quot;code-quote&quot;&gt;&apos;11&apos;&lt;/span&gt;
    group by key
  )a
  distribute by a.key
  sort by a.key,a.cc desc
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;cc is generated field by GBY operator, so It&apos;s semantically wrong to merge the RS for GBY with any following RS. But the same time, sort on &quot;a.cc&quot; is meaningless so it can be removed in optimizing, but not in here (maybe in SemanticAnalyzer?).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sunrui&quot; class=&quot;user-hover&quot; rel=&quot;sunrui&quot;&gt;sunrui&lt;/a&gt; Yes, RS for distinct should be avoided from any dedup process. Could you take this issue? I think you knows better than me.&lt;/p&gt;</comment>
                            <comment id="13995204" author="ashutoshc" created="Mon, 12 May 2014 16:15:03 +0000"  >&lt;p&gt;+1 Issue raised by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sunrui&quot; class=&quot;user-hover&quot; rel=&quot;sunrui&quot;&gt;sunrui&lt;/a&gt; if exists will probably require a different fix, which we shall take up in separate jira. &lt;/p&gt;</comment>
                            <comment id="13995846" author="sunrui" created="Tue, 13 May 2014 00:09:05 +0000"  >&lt;p&gt;For the issue about distinct, I will investigate it later and if I can find a real test case, I will submit a separate jira.&lt;/p&gt;</comment>
                            <comment id="13996551" author="ashutoshc" created="Tue, 13 May 2014 16:18:00 +0000"  >&lt;p&gt;Committed to trunk. Thanks, Navis!&lt;/p&gt;</comment>
                            <comment id="14210995" author="thejas" created="Thu, 13 Nov 2014 19:43:34 +0000"  >&lt;p&gt;This has been fixed in 0.14 release. Please open new jira if you see any issues.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12695620">HIVE-6455</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12643724" name="HIVE-7012.1.patch.txt" size="2059" author="navis" created="Wed, 7 May 2014 08:45:25 +0000"/>
                            <attachment id="12644076" name="HIVE-7012.2.patch.txt" size="19280" author="navis" created="Fri, 9 May 2014 05:55:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>390424</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1v90n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>390677</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>