<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:26:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-28770] Unused Downloaded Resources Directory Persisting After HiveServer2 Shutdown</title>
                <link>https://issues.apache.org/jira/browse/HIVE-28770</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;When &lt;b&gt;HiveServer2 (HS2)&lt;/b&gt; starts, it creates multiple &lt;tt&gt;SessionState&lt;/tt&gt; objects as part of its initialization and background processes. Specifically, the following components instantiate &lt;tt&gt;SessionState&lt;/tt&gt;:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&lt;b&gt;&lt;tt&gt;CliService.applyAuthorizationConfigPolicy&lt;/tt&gt;&lt;/b&gt; &#8211; This method is responsible for applying authorization policies during HS2 startup. It creates a new &lt;tt&gt;SessionState&lt;/tt&gt;, which in turn creates session directories&#160;for that session.&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;&lt;tt&gt;HiveMaterializedViewsRegistry&lt;/tt&gt;&lt;/b&gt; &#8211; This component maintains metadata for &lt;b&gt;materialized views&lt;/b&gt; and runs in a &lt;b&gt;background thread&lt;/b&gt;. It also creates a &lt;tt&gt;SessionState&lt;/tt&gt;,&#160;which in turn creates session directories&#160;for that session.&lt;/li&gt;
&lt;/ol&gt;


&lt;h4&gt;&lt;a name=&quot;TheProblem&quot;&gt;&lt;/a&gt;&lt;b&gt;The Problem&lt;/b&gt;&lt;/h4&gt;

&lt;p&gt;Each &lt;tt&gt;SessionState&lt;/tt&gt; dynamically generates a temporary directory for &lt;b&gt;&lt;tt&gt;hive.downloaded.resources.dir&lt;/tt&gt;&lt;/b&gt; &lt;tt&gt;and&lt;/tt&gt;&#160;&lt;b&gt;&lt;tt&gt;}}&lt;/b&gt;&#160;&lt;b&gt;hive.exec.local.scratchdir&lt;/b&gt;, typically located in {{/tmp&lt;/tt&gt; or /tmp/{user.dir} or another location configured in &lt;tt&gt;hive-site.xml&lt;/tt&gt;.&lt;br/&gt;
However, &lt;b&gt;these directories are not automatically cleaned up when HiveServer2 shuts down&lt;/b&gt;. This leads to the following issues:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;b&gt;Accumulation of orphaned directories&lt;/b&gt; (e.g., &lt;tt&gt;/tmp/b0aa54f0-3ca7-4897-abd7-5fb79bcafd2b_resources&lt;/tt&gt;), consuming disk space unnecessarily.&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;Performance degradation&lt;/b&gt; over time due to an excessive number of leftover directories.&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;Potential security risks&lt;/b&gt; if sensitive downloaded JARs or resources are left behind.&lt;/li&gt;
&lt;/ul&gt;


&lt;h4&gt;&lt;a name=&quot;RootCause&quot;&gt;&lt;/a&gt;&lt;b&gt;Root Cause&lt;/b&gt;&lt;/h4&gt;
&lt;ul&gt;
	&lt;li&gt;The &lt;tt&gt;SessionState&lt;/tt&gt; objects &lt;b&gt;do not trigger cleanup logic&lt;/b&gt; for &lt;tt&gt;hive.downloaded.resources.dir and hive.exec.local.scratchdir&lt;/tt&gt; when they are created in &lt;b&gt;HS2 startup methods or background threads&lt;/b&gt;.&lt;/li&gt;
	&lt;li&gt;Unlike interactive Hive CLI sessions, which naturally terminate and clean up their resources, these startup sessions remain active as long as HS2 runs and &lt;b&gt;do not remove their associated directories upon shutdown&lt;/b&gt;.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13609212">HIVE-28770</key>
            <summary>Unused Downloaded Resources Directory Persisting After HiveServer2 Shutdown</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Indhumathi27">Indhumathi Muthumurugesh</assignee>
                                    <reporter username="Indhumathi27">Indhumathi Muthumurugesh</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 20 Feb 2025 11:41:49 +0000</created>
                <updated>Tue, 29 Jul 2025 14:51:43 +0000</updated>
                            <resolved>Wed, 2 Apr 2025 08:38:50 +0000</resolved>
                                                    <fixVersion>4.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17940298" author="dkuzmenko" created="Wed, 2 Apr 2025 08:38:42 +0000"  >&lt;p&gt;Merged  to master&lt;br/&gt;
Thanks for the fix , &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Indhumathi27&quot; class=&quot;user-hover&quot; rel=&quot;Indhumathi27&quot;&gt;Indhumathi27&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=abstractdog&quot; class=&quot;user-hover&quot; rel=&quot;abstractdog&quot;&gt;abstractdog&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkasa&quot; class=&quot;user-hover&quot; rel=&quot;kkasa&quot;&gt;kkasa&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=okumin&quot; class=&quot;user-hover&quot; rel=&quot;okumin&quot;&gt;okumin&lt;/a&gt; for the review!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1uc6g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>