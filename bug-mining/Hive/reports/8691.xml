<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:25:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-27498] Support custom delimiter in SkippingTextInputFormat</title>
                <link>https://issues.apache.org/jira/browse/HIVE-27498</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Simple select is returning results as expected when there are configs&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&apos;skip.header.line.count&apos;=&apos;1&apos;, &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;
&apos;textinputformat.record.delimiter&apos;=&apos;|&apos;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but if we execute select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; or any query that launches a tez job is considering the whole text as single line&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Test case&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;data.csv&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Code    Name|A AAAA|B BBBB
CCCC|C  DDDD&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;DDL&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;create external table test(code string,name string)
ROW FORMAT SERDE
   &apos;org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe&apos;
 WITH SERDEPROPERTIES (
   &apos;field.delim&apos;=&apos;\t&apos;)
 STORED AS INPUTFORMAT
   &apos;org.apache.hadoop.mapred.TextInputFormat&apos;
 OUTPUTFORMAT
   &apos;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&apos;
   location &apos;${system:test.tmp.dir}/test&apos;
 TBLPROPERTIES (
   &apos;skip.header.line.count&apos;=&apos;1&apos;,
   &apos;textinputformat.record.delimiter&apos;=&apos;|&apos;);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Query result&lt;br/&gt;
select code,name from test;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;A AAAA
B BBBB
CCCC
C DDDD&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;Problem:&lt;/b&gt; But query &lt;em&gt;&lt;ins&gt;select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from test&lt;/ins&gt;&lt;/em&gt;&#160; is returning 1 instead of 3&lt;/p&gt;

&lt;p&gt;It used to work in older hive versions.&lt;/p&gt;

&lt;p&gt;The difference in behaviour started to happen after the introduction of feature&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-21924&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-21924&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The feature aims at splitting the text files while reading even though the table has configuration to skip headers. There by increasing the number of mappers to process the query there by improving throughput of the query.&lt;/p&gt;

&lt;p&gt;The actual problem lies in how new feature is reading a file. It does not consider &apos;textinputformat.record.delimiter&apos; property and tries to read the file looking for new line characters. Since the input file does not have a new line for every record, it is reading the whole file as single line and count is returned as 1&lt;/p&gt;

&lt;p&gt;Ref: &lt;a href=&quot;https://github.com/apache/hive/blob/24a82a65f96b65eeebe4e23b2fec425037a70216/ql/src/java/org/apache/hadoop/hive/ql/io/HiveInputFormat.java#L548&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/blob/24a82a65f96b65eeebe4e23b2fec425037a70216/ql/src/java/org/apache/hadoop/hive/ql/io/HiveInputFormat.java#L548&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;b&gt;Workaround&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;If we can remove headers in the data and skip header config in table properties or compress the files, then we will not get into this issue&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13543243">HIVE-27498</key>
            <summary>Support custom delimiter in SkippingTextInputFormat</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mkunwar">Mayank Kunwar</assignee>
                                    <reporter username="tarak271">Taraka Rama Rao Lethavadla</reporter>
                        <labels>
                            <label>hive-4.0.1-merged</label>
                            <label>hive-4.0.1-must</label>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 12 Jul 2023 09:25:38 +0000</created>
                <updated>Tue, 29 Jul 2025 14:51:18 +0000</updated>
                            <resolved>Thu, 6 Jun 2024 07:58:06 +0000</resolved>
                                                    <fixVersion>4.1.0</fixVersion>
                    <fixVersion>4.0.1</fixVersion>
                                    <component>Hive</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17844902" author="JIRAUSER291741" created="Thu, 9 May 2024 07:46:06 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tarak271&quot; class=&quot;user-hover&quot; rel=&quot;tarak271&quot;&gt;tarak271&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;I tried running the query, using hive &lt;b&gt;master&lt;/b&gt; branch, but it works fine by returning the result as 3 for the &lt;ins&gt;select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from test&lt;/ins&gt; query.&lt;/p&gt;</comment>
                            <comment id="17849013" author="JIRAUSER291741" created="Thu, 23 May 2024 15:33:42 +0000"  >&lt;p&gt;The issue is hitting again, so reopening the ticket&lt;/p&gt;</comment>
                            <comment id="17852674" author="abstractdog" created="Thu, 6 Jun 2024 07:58:01 +0000"  >&lt;p&gt;merged to master, thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkunwar&quot; class=&quot;user-hover&quot; rel=&quot;mkunwar&quot;&gt;mkunwar&lt;/a&gt; for the patch!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 22 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1j3g0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>