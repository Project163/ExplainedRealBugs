<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:06:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-4486] FetchOperator slows down SMB map joins by 50% when there are many partitions</title>
                <link>https://issues.apache.org/jira/browse/HIVE-4486</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;While looking at log files for SMB joins in hive, it was noticed that the actual join op didn&apos;t show up as a significant fraction of the time spent. Most of the time was spent parsing configuration files.&lt;/p&gt;

&lt;p&gt;To confirm, I put log lines in the HiveConf constructor and eventually made the following edit to the code&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;--- ql/src/java/org/apache/hadoop/hive/ql/exec/FetchOperator.java
+++ ql/src/java/org/apache/hadoop/hive/ql/exec/FetchOperator.java
@@ -648,8 +648,7 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; ObjectInspector getOutputObjectInspector() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; HiveException {
    * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; list of file status entries
    */
   &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; FileStatus[] listStatusUnderPath(FileSystem fs, Path p) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
-    HiveConf hiveConf = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HiveConf(job, FetchOperator.class);
-    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; recursive = hiveConf.getBoolVar(HiveConf.ConfVars.HADOOPMAPREDINPUTDIRRECURSIVE);
+    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; recursive = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!recursive) {
       &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; fs.listStatus(p);
     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And re-ran my query to compare timings.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Before&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;After&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Cumulative CPU&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 731.07 sec&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;386.0 sec&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Total time &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 347.66 seconds &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 218.855 seconds &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;The query used was &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;INSERT OVERWRITE LOCAL DIRECTORY
&lt;span class=&quot;code-quote&quot;&gt;&apos;/grid/0/smb/&apos;&lt;/span&gt;
select inv_item_sk
from
     inventory inv
     join store_sales ss on (ss.ss_item_sk = inv.inv_item_sk)
limit 100000
;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On a scale=2 tpcds data-set, where both store_sales &amp;amp; inventory are bucketed into 4 buckets, with store_sales split into 7 partitions and inventory into 261 partitions.&lt;/p&gt;

&lt;p&gt;78% of all CPU time was spent within new HiveConf(). The yourkit profiler runs are attached.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu LXC 12.10&lt;/p&gt;</environment>
        <key id="12645966">HIVE-4486</key>
            <summary>FetchOperator slows down SMB map joins by 50% when there are many partitions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gopalv">Gopal Vijayaraghavan</assignee>
                                    <reporter username="gopalv">Gopal Vijayaraghavan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 May 2013 13:55:18 +0000</created>
                <updated>Tue, 15 Oct 2013 23:30:19 +0000</updated>
                            <resolved>Fri, 17 May 2013 15:45:16 +0000</resolved>
                                    <version>0.12.0</version>
                                    <fixVersion>0.12.0</fixVersion>
                    <fixVersion>0.11.1</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13648425" author="gopalv" created="Fri, 3 May 2013 14:03:27 +0000"  >&lt;p&gt;attach yourkit profile (HTML)&lt;/p&gt;</comment>
                            <comment id="13652262" author="gopalv" created="Wed, 8 May 2013 19:49:47 +0000"  >&lt;p&gt;Root caused to the following code in HiveConf&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void initialize(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; cls) {
    hiveJar = (&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JobConf(cls)).getJar();

    &lt;span class=&quot;code-comment&quot;&gt;// preserve the original configuration
&lt;/span&gt;    origProp = getAllProperties();

    &lt;span class=&quot;code-comment&quot;&gt;// Overlay the ConfVars. Note that &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; ignores ConfVars with &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; values
&lt;/span&gt;    addResource(getConfVarInputStream());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;addResource() calls reloadConfiguration() eventually, causing each new HiveConf(job) to parse all the conf xml files again.&lt;/p&gt;</comment>
                            <comment id="13654367" author="navis" created="Fri, 10 May 2013 10:52:33 +0000"  >&lt;p&gt;In above, &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;HiveConf hiveConf = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HiveConf(job, FetchOperator.class);
&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; recursive = hiveConf.getBoolVar(HiveConf.ConfVars.HADOOPMAPREDINPUTDIRRECURSIVE);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;could be replaced by&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; recursive = HiveConf.getBoolVar(job, HiveConf.ConfVars.HADOOPMAPREDINPUTDIRRECURSIVE);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Could you make a patch for review?&lt;/p&gt;</comment>
                            <comment id="13654477" author="gopalv" created="Fri, 10 May 2013 14:00:54 +0000"  >&lt;p&gt;Running it through the benchmarks now.&lt;/p&gt;

&lt;p&gt;That looked like it did the trick. I will put up a patch for review &lt;/p&gt;</comment>
                            <comment id="13654653" author="gopalv" created="Fri, 10 May 2013 17:44:08 +0000"  >&lt;p&gt;Patch based on Navis&apos; suggestions.&lt;/p&gt;</comment>
                            <comment id="13654658" author="gopalv" created="Fri, 10 May 2013 17:48:24 +0000"  >&lt;p&gt;Opened &lt;a href=&quot;https://reviews.apache.org/r/11047/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/11047/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13654668" author="gopalv" created="Fri, 10 May 2013 17:57:01 +0000"  >&lt;p&gt;Closed that (wrong diff), opened as &lt;a href=&quot;https://reviews.apache.org/r/11048/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/11048/diff/&lt;/a&gt; instead.&lt;/p&gt;</comment>
                            <comment id="13659762" author="owen.omalley" created="Thu, 16 May 2013 17:50:11 +0000"  >&lt;p&gt;+1 can you run the unit tests?&lt;/p&gt;</comment>
                            <comment id="13659785" author="gopalv" created="Thu, 16 May 2013 18:09:53 +0000"  >&lt;p&gt;I have already run all of tests in ql/ against svn (Wed May 8) already.&lt;/p&gt;

&lt;p&gt;Will run all tests in some time &amp;amp; report back.&lt;/p&gt;</comment>
                            <comment id="13660745" author="gopalv" created="Fri, 17 May 2013 14:24:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=owen.omalley&quot; class=&quot;user-hover&quot; rel=&quot;owen.omalley&quot;&gt;owen.omalley&lt;/a&gt; - all test pass on (bdd257f71bc0b65100dbd41425d7f8250ae27e57 + patch)&lt;/p&gt;</comment>
                            <comment id="13660801" author="owen.omalley" created="Fri, 17 May 2013 15:45:16 +0000"  >&lt;p&gt;I just committed this to branch-0.11 and trunk. Thanks, Gopal!&lt;/p&gt;</comment>
                            <comment id="13661271" author="hudson" created="Sat, 18 May 2013 04:28:26 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #201 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/201/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/201/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4486&quot; title=&quot;FetchOperator slows down SMB map joins by 50% when there are many partitions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4486&quot;&gt;&lt;del&gt;HIVE-4486&lt;/del&gt;&lt;/a&gt; FetchOperator slows down SMB map joins by 50% when there are many &lt;br/&gt;
partitions (Gopal V via omalley) (Revision 1483874)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
omalley : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1483874&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1483874&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/FetchOperator.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13661276" author="gopalv" created="Sat, 18 May 2013 04:39:38 +0000"  >&lt;p&gt;HBase errors in trunk tests?&lt;/p&gt;

&lt;p&gt;Caused by: java.lang.RuntimeException: Master not initialized after 200 seconds&lt;br/&gt;
	at org.apache.hadoop.hbase.util.JVMClusterUtil.startup(JVMClusterUtil.java:206)&lt;br/&gt;
	at org.apache.hadoop.hbase.LocalHBaseCluster.startup(LocalHBaseCluster.java:420)&lt;br/&gt;
	at org.apache.hadoop.hbase.MiniHBaseCluster.init(MiniHBaseCluster.java:216)&lt;/p&gt;</comment>
                            <comment id="13661295" author="hudson" created="Sat, 18 May 2013 05:17:59 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #2107 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/2107/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/2107/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4486&quot; title=&quot;FetchOperator slows down SMB map joins by 50% when there are many partitions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4486&quot;&gt;&lt;del&gt;HIVE-4486&lt;/del&gt;&lt;/a&gt; FetchOperator slows down SMB map joins by 50% when there are many &lt;br/&gt;
partitions (Gopal V via omalley) (Revision 1483874)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
omalley : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1483874&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1483874&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/FetchOperator.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13796006" author="ashutoshc" created="Tue, 15 Oct 2013 23:30:19 +0000"  >&lt;p&gt;This issue has been fixed and released as part of 0.12 release. If you find further issues, please create a new jira and link it to this one.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12648218">HADOOP-9570</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12582648" name="HIVE-4486.patch" size="849" author="gopalv" created="Fri, 10 May 2013 17:44:08 +0000"/>
                            <attachment id="12581692" name="smb-profile.html" size="281932" author="gopalv" created="Fri, 3 May 2013 14:03:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>326325</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 6 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1kaq7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>326670</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Avoid creating new HiveConf() within the FetchOperator loop</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>