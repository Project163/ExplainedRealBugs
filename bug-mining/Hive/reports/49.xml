<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:50:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-222] Group by on a combination of disitinct and non distinct aggregates can return serialization errors with map side aggregations.</title>
                <link>https://issues.apache.org/jira/browse/HIVE-222</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;For queries of the form (groupby2_map.q in the source)&lt;/p&gt;

&lt;p&gt;SELECT x, count(DISTINCT y), SUM&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; FROM t GROUP BY x&lt;/p&gt;

&lt;p&gt;when map side aggregation is on &lt;/p&gt;

&lt;p&gt;hive.map.aggr=true (This is off by default)&lt;/p&gt;

&lt;p&gt;The following exception can occur:&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Caused by: java.lang.ClassCastException: java.lang.Long cannot be cast to java.lang.Double&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDeTypeDouble.serialize(DynamicSerDeTypeDouble.java:60)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDeFieldList.serialize(DynamicSerDeFieldList.java:235)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDeStructBase.serialize(DynamicSerDeStructBase.java:81)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe.serialize(DynamicSerDe.java:174)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12412118">HIVE-222</key>
            <summary>Group by on a combination of disitinct and non distinct aggregates can return serialization errors with map side aggregations.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="athusoo">Ashish Thusoo</assignee>
                                    <reporter username="athusoo">Ashish Thusoo</reporter>
                        <labels>
                    </labels>
                <created>Sat, 10 Jan 2009 15:24:22 +0000</created>
                <updated>Sat, 17 Dec 2011 00:08:37 +0000</updated>
                            <resolved>Tue, 13 Jan 2009 03:53:14 +0000</resolved>
                                                    <fixVersion>0.3.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12662674" author="athusoo" created="Sat, 10 Jan 2009 17:21:34 +0000"  >&lt;p&gt;Fix for the bug.&lt;/p&gt;

&lt;p&gt;There was a bug in way the the aggregation list was being generated for the map side aggregation. As a result the ordering of the aggregations in the map side groupby operator and the reduce side groupby operator would differ leading to this problem. Ideally, we should be using the row schema information to generate the order but that needs a much larger refactor of  how we generate plans in the group by case. For now this patch should fix the problem.&lt;/p&gt;

&lt;p&gt;There are prexisting tests that test this (groupby2_map.q and groupby3_map.q). The test case however relies on an internal hashmap giving the keys in a certain order. The bug was easily reproducible with the patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-179&quot; title=&quot;SUBSTR function should work like other databases&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-179&quot;&gt;&lt;del&gt;HIVE-179&lt;/del&gt;&lt;/a&gt;. I have tested it with that patch.&lt;/p&gt;</comment>
                            <comment id="12662675" author="athusoo" created="Sat, 10 Jan 2009 17:21:55 +0000"  >&lt;p&gt;submitting patch.&lt;/p&gt;</comment>
                            <comment id="12663056" author="prasadc" created="Mon, 12 Jan 2009 19:23:26 +0000"  >&lt;p&gt;looks good +1&lt;/p&gt;

&lt;p&gt;though it doesn&apos;t guarantee that HashMap will return objects in the same order in both the functions. &lt;/p&gt;</comment>
                            <comment id="12663210" author="zshao" created="Tue, 13 Jan 2009 03:53:14 +0000"  >&lt;p&gt;Committed revision 734008. Thanks Ashish!&lt;/p&gt;</comment>
                            <comment id="12664854" author="electrum" created="Sat, 17 Jan 2009 18:20:04 +0000"  >&lt;p&gt;Is there any value to adding the testcase from &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-215&quot; title=&quot;Map-side aggregate with DISTINCT generates bad intermediate table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-215&quot;&gt;&lt;del&gt;HIVE-215&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12410745">HIVE-179</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12411832">HIVE-215</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12397608" name="patch-222.txt" size="5337" author="athusoo" created="Sat, 10 Jan 2009 17:21:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73696</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 45 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0l8l3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>122041</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-222&quot; title=&quot;Group by on a combination of disitinct and non distinct aggregates can return serialization errors with map side aggregations.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-222&quot;&gt;&lt;strike&gt;HIVE-222&lt;/strike&gt;&lt;/a&gt;. Fixed Group by on a combination of disitinct and non distinct aggregates. (Ashish Thusoo via zshao)</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>