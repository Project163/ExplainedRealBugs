<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:57:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-2011] upgrade-0.6.0.mysql.sql script attempts to increase size of PK COLUMNS.TYPE_NAME to 4000</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2011</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;# mysql flumenewresearch &amp;lt; upgrade-0.6.0.mysql.sql 
ERROR 1071 (42000) at line 16: Specified key was too &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;; max key length is 767 bytes
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here&apos;s the cause of the problem from upgrade-0.6.0.mysql.sql:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;...
ALTER TABLE `COLUMNS` MODIFY `TYPE_NAME` VARCHAR(4000);
...
ALTER TABLE `COLUMNS` DROP PRIMARY KEY;
ALTER TABLE `COLUMNS` ADD PRIMARY KEY (`SD_ID`, `COLUMN_NAME`);
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We need to make sure that the PK on COLUMNS.TYPE_NAME is dropped before the size of the column is bumped to 4000.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12499956">HIVE-2011</key>
            <summary>upgrade-0.6.0.mysql.sql script attempts to increase size of PK COLUMNS.TYPE_NAME to 4000</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cwsteinbach">Carl Steinbach</assignee>
                                    <reporter username="cwsteinbach">Carl Steinbach</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Feb 2011 18:10:25 +0000</created>
                <updated>Fri, 16 Dec 2011 23:59:26 +0000</updated>
                            <resolved>Sat, 19 Mar 2011 04:04:11 +0000</resolved>
                                    <version>0.6.0</version>
                                    <fixVersion>0.7.0</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13003334" author="cwsteinbach" created="Mon, 7 Mar 2011 12:33:16 +0000"  >&lt;p&gt;This is a patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2011&quot; title=&quot;upgrade-0.6.0.mysql.sql script attempts to increase size of PK COLUMNS.TYPE_NAME to 4000&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2011&quot;&gt;&lt;del&gt;HIVE-2011&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2010&quot; title=&quot;Improve naming and README files for MetaStore upgrade scripts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2010&quot;&gt;&lt;del&gt;HIVE-2010&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Change the name of the upgrade scripts from &apos;upgrade-x.y.z.&amp;lt;dbname&amp;gt;.sql&apos; to &apos;upgrade-x.y.z-to-a.b.c.&amp;lt;dbname&amp;gt;.sql&apos;&lt;/li&gt;
	&lt;li&gt;Splits the contents of the upgrade-x.y.z.&amp;lt;dbname&amp;gt;.sql files into individual SQL files corresponding to each Hive ticket.&lt;/li&gt;
	&lt;li&gt;Fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2011&quot; title=&quot;upgrade-0.6.0.mysql.sql script attempts to increase size of PK COLUMNS.TYPE_NAME to 4000&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2011&quot;&gt;&lt;del&gt;HIVE-2011&lt;/del&gt;&lt;/a&gt; by rearranging the order of DDL statements in 004-&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1364&quot; title=&quot;Increase the maximum length of various metastore fields, and remove TYPE_NAME from COLUMNS primary key&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1364&quot;&gt;&lt;del&gt;HIVE-1364&lt;/del&gt;&lt;/a&gt;.&amp;lt;dbname&amp;gt;.sql&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13003613" author="jvs" created="Mon, 7 Mar 2011 21:08:44 +0000"  >&lt;p&gt;I gave this one a try using MySQL.  First, I started with an 0.6 build and got it to autocreate a schema there.  (I don&apos;t know of a way to force creation of all tables, so the schema was incomplete.)&lt;/p&gt;

&lt;p&gt;Then I applied this patch to 0.7, built there, and ran the upgrade script.  It failed because the PARTS table hadn&apos;t been created in 0.6 (I had only created an unpartitioned table there).  This is fine; the only part which could be improved is that the script did not stop after the errors, so the tail looks like this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;...
Query OK, 0 rows affected (0.00 sec)

ERROR 1005 (HY000): Can&apos;t create table &apos;./jsichi_hive_upgrade_test/PART_PRIVS.frm&apos; (errno: 150)
ERROR 1005 (HY000): Can&apos;t create table &apos;./jsichi_hive_upgrade_test/PART_COL_PRIVS.frm&apos; (errno: 150)
+---------------------------------------------------------+
|                                                         |
+---------------------------------------------------------+
| Finished upgrading MetaStore schema from 0.6.0 to 0.7.0 | 
+---------------------------------------------------------+
1 row in set, 1 warning (0.00 sec)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Should we change the README instructions to use something which will abort on exception?  Otherwise, for an error in the middle of a long upgrade sequence, the administrator might miss it and think all was well.&lt;/p&gt;</comment>
                            <comment id="13007620" author="cwsteinbach" created="Wed, 16 Mar 2011 18:47:48 +0000"  >&lt;p&gt;Updated the patch with more extensive instructions and official schemas for Hive 0.3.0 through 0.7.0&lt;/p&gt;</comment>
                            <comment id="13008609" author="cwsteinbach" created="Fri, 18 Mar 2011 20:09:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2011&quot; title=&quot;upgrade-0.6.0.mysql.sql script attempts to increase size of PK COLUMNS.TYPE_NAME to 4000&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2011&quot;&gt;&lt;del&gt;HIVE-2011&lt;/del&gt;&lt;/a&gt;.3.patch.txt: &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Fixed errors in Derby schema scripts caused by accidentally picking up wrong DataNucleus (and wrong IdentifierFactory) during original schema generation run.&lt;/li&gt;
	&lt;li&gt;Added a couple usage notes to the Derby and MySQL READMEs related to the ij and mysqldump utilities.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Testing:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Created Derby and MySQL schemas for 0.3.0 through 0.7.0 by starting Hive with autoCreateSchema=true.&lt;/li&gt;
	&lt;li&gt;Applied hive-schema-x.y.z.xxx.sql scripts to each of the previously created DBs. Verified that these scripts complete without error, and that the resulting DB schemas contain all tables.&lt;/li&gt;
	&lt;li&gt;Applied the upgrade scripts to validated 0.5.0 and 0.6.0 DBs for Derby and MySQL, and verified that all scripts complete without error.&lt;/li&gt;
	&lt;li&gt;Validated the upgraded DBs by running Hive against the upgraded DB schema with datanucleus.autoCreateSchema=false and datanucleus.validateSchema=true&lt;/li&gt;
&lt;/ol&gt;


</comment>
                            <comment id="13008690" author="jvs" created="Sat, 19 Mar 2011 00:03:27 +0000"  >&lt;p&gt;@Carl, I ran hive-schema-0.6.0.mysql.sql and two of the tablenames (dbs and types) came out in lowercase; they should be ALLCAPS.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;mysql&amp;gt; show tables;
+-------------------------+
| Tables_in_jvs_metastore |
+-------------------------+
| BUCKETING_COLS          | 
| COLUMNS                 | 
| PARTITIONS              | 
| PARTITION_KEYS          | 
| PARTITION_KEY_VALS      | 
| PARTITION_PARAMS        | 
| SDS                     | 
| SD_PARAMS               | 
| SERDES                  | 
| SERDE_PARAMS            | 
| SORT_COLS               | 
| TABLE_PARAMS            | 
| TBLS                    | 
| TYPE_FIELDS             | 
| dbs                     | 
| types                   | 
+-------------------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13008696" author="cwsteinbach" created="Sat, 19 Mar 2011 00:23:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2011&quot; title=&quot;upgrade-0.6.0.mysql.sql script attempts to increase size of PK COLUMNS.TYPE_NAME to 4000&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2011&quot;&gt;&lt;del&gt;HIVE-2011&lt;/del&gt;&lt;/a&gt;.4.patch.txt:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Fix capitalization of table names in MySQL schema dumps.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@John: I created these schemas using DataNucleus&apos;s schematool utility. I think this capitalization issue is actually a bug in DataNucleus.&lt;/p&gt;</comment>
                            <comment id="13008699" author="cwsteinbach" created="Sat, 19 Mar 2011 00:30:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2011&quot; title=&quot;upgrade-0.6.0.mysql.sql script attempts to increase size of PK COLUMNS.TYPE_NAME to 4000&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2011&quot;&gt;&lt;del&gt;HIVE-2011&lt;/del&gt;&lt;/a&gt;.5.patch.txt:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Backout whitespace changes to package.jdo (not sure how those slipped in...)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13008716" author="jvs" created="Sat, 19 Mar 2011 02:39:13 +0000"  >&lt;p&gt;The latest patch still has lowercase in all of the REFERENCES clauses, e.g.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  CONSTRAINT `SDS_FK1` FOREIGN KEY (`SERDE_ID`) REFERENCES `serdes` (`SERDE_ID`)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This causes inserts to fail.&lt;/p&gt;</comment>
                            <comment id="13008719" author="cwsteinbach" created="Sat, 19 Mar 2011 02:56:31 +0000"  >&lt;p&gt;Ugh. HFS+&apos;s case insensitivity bites me again: &lt;a href=&quot;http://dev.mysql.com/doc/refman/5.0/en/identifier-case-sensitivity.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://dev.mysql.com/doc/refman/5.0/en/identifier-case-sensitivity.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m making the changes right now. Sorry for the inconvenience.&lt;/p&gt;</comment>
                            <comment id="13008722" author="cwsteinbach" created="Sat, 19 Mar 2011 03:18:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2011&quot; title=&quot;upgrade-0.6.0.mysql.sql script attempts to increase size of PK COLUMNS.TYPE_NAME to 4000&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2011&quot;&gt;&lt;del&gt;HIVE-2011&lt;/del&gt;&lt;/a&gt;.6.patch.txt:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Fix identifier capitalization issues in MySQL schema scripts.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13008723" author="cwsteinbach" created="Sat, 19 Mar 2011 03:19:46 +0000"  >&lt;p&gt;Review request: &lt;a href=&quot;https://reviews.apache.org/r/471/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/471/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13008728" author="jvs" created="Sat, 19 Mar 2011 04:04:11 +0000"  >&lt;p&gt;Committed to branch and trunk.  Thanks Carl!&lt;/p&gt;

&lt;p&gt;p.s. ship it!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12499892">HIVE-2010</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12502315">HIVE-2076</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12472813" name="HIVE-2011.1.patch.txt" size="45976" author="cwsteinbach" created="Mon, 7 Mar 2011 12:28:57 +0000"/>
                            <attachment id="12474029" name="HIVE-2011.2.patch.txt" size="206814" author="cwsteinbach" created="Fri, 18 Mar 2011 20:02:19 +0000"/>
                            <attachment id="12473828" name="HIVE-2011.2.patch.txt" size="206286" author="cwsteinbach" created="Wed, 16 Mar 2011 18:47:01 +0000"/>
                            <attachment id="12474031" name="HIVE-2011.3.patch.txt" size="206814" author="cwsteinbach" created="Fri, 18 Mar 2011 20:09:34 +0000"/>
                            <attachment id="12474049" name="HIVE-2011.4.patch.txt" size="206814" author="cwsteinbach" created="Sat, 19 Mar 2011 00:23:52 +0000"/>
                            <attachment id="12474050" name="HIVE-2011.5.patch.txt" size="204485" author="cwsteinbach" created="Sat, 19 Mar 2011 00:30:08 +0000"/>
                            <attachment id="12474057" name="HIVE-2011.6.patch.txt" size="204485" author="cwsteinbach" created="Sat, 19 Mar 2011 03:18:37 +0000"/>
                            <attachment id="12474480" name="HIVE-2011.postgres.1.patch" size="81094" author="yourchanges" created="Thu, 24 Mar 2011 07:40:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72578</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 36 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lhzr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123565</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>