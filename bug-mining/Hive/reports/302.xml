<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:55:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-1001] CombinedHiveInputFormat should parse the inputpath correctly</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1001</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;From David Lerman:&lt;br/&gt;
&quot;&lt;br/&gt;
I&apos;m running into errors where CombinedHiveInputFormat is combining data from&lt;br/&gt;
two different tables which is causing problems because the tables have&lt;br/&gt;
different input formats.&lt;/p&gt;

&lt;p&gt;It looks like the problem is in&lt;br/&gt;
org.apache.hadoop.hive.shims.Hadoop20Shims.getInputPathsShim.  It calls&lt;br/&gt;
CombineFileInputFormat.getInputPaths which returns the list of input paths&lt;br/&gt;
and then chops off the first 5 characters to remove file: from the&lt;br/&gt;
beginning, but the return value I&apos;m getting from getInputPaths is actually&lt;br/&gt;
hdfs://domain/path.  So then when it creates the pools using these paths,&lt;br/&gt;
none of the input paths match the pools (since they&apos;re just the file path&lt;br/&gt;
which protocol or domain).&lt;br/&gt;
&quot;&lt;/p&gt;

&lt;p&gt;We should use Path.getPath() to get the path part of an URI instead of just chopping off 5 chars.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12443894">HIVE-1001</key>
            <summary>CombinedHiveInputFormat should parse the inputpath correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="namit">Namit Jain</assignee>
                                    <reporter username="zshao">Zheng Shao</reporter>
                        <labels>
                    </labels>
                <created>Mon, 21 Dec 2009 07:43:17 +0000</created>
                <updated>Sat, 17 Dec 2011 00:05:41 +0000</updated>
                            <resolved>Sat, 2 Jan 2010 07:55:41 +0000</resolved>
                                    <version>0.5.0</version>
                                    <fixVersion>0.5.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12793305" author="namit" created="Mon, 21 Dec 2009 19:15:31 +0000"  >&lt;p&gt;This is a blocker for 0.5&lt;/p&gt;</comment>
                            <comment id="12793389" author="he yongqiang" created="Mon, 21 Dec 2009 22:20:36 +0000"  >&lt;p&gt;+1. Looks good. Will commit if tests pass.&lt;/p&gt;</comment>
                            <comment id="12793414" author="he yongqiang" created="Mon, 21 Dec 2009 23:30:39 +0000"  >&lt;p&gt;I just committed. Thanks Namit!&lt;/p&gt;</comment>
                            <comment id="12794912" author="dlerman" created="Mon, 28 Dec 2009 20:17:00 +0000"  >&lt;p&gt;This patch appears to affect other functionality.  Without the patch, &quot;insert overwrite directory &apos;out&apos; select ... from ...&quot; yields 1 MR job, but with the patch, it yields 2 MR jobs.  At first glance, it looks like the second job in the insert overwrite plan is a conditional operation where it either does an HDFS move to move the data from the temp output directory to its final destination, or runs a MR job to copy the data (maybe if it needs to copy across clusters?).  Before the patch, it just does the HDFS copy, but after it, it does the MR copy.  Maybe the paths its comparing to determine which task to run are getting screwed up by the patch?&lt;/p&gt;

&lt;p&gt;Steps to reproduce:&lt;/p&gt;

&lt;p&gt;Using Cloudera&apos;s Hadoop 0.20.1+152 (since the CombineFile functionality doesn&apos;t work in 0.20.1 without the extra patches):&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Create a data file twolines.dat containing:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;key1^Avalue1&lt;br/&gt;
key2^Avalue2&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Create a table with two partitions each containing that data:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;CREATE TABLE fourlinestest(KEY STRING, VALUE STRING) PARTITIONED BY (part int) STORED AS TEXTFILE;&lt;br/&gt;
load data local inpath &apos;twolines.dat&apos; into table fourlinestest partition (part=1);&lt;br/&gt;
load data local inpath &apos;twolines.dat&apos; into table fourlinestest partition (part=2);&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Using Hive r888452 (before this patch was applied):&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;set hive.input.format=org.apache.hadoop.hive.ql.io.CombineHiveInputFormat;&lt;br/&gt;
insert overwrite directory &apos;out&apos; select key from fourlinestest;&lt;/p&gt;

&lt;p&gt;--&amp;gt; The log shows that that the pools are getting created with corrupt paths (which was the bug that was fixed), but the job runs successfully with 1 MR job:&lt;/p&gt;

&lt;p&gt;Total MapReduce jobs = 2&lt;br/&gt;
Launching Job 1 out of 2&lt;br/&gt;
Number of reduce tasks is set to 0 since there&apos;s no reduce operator&lt;br/&gt;
Starting Job = job_200912240057_7597, Tracking URL = &lt;a href=&quot;http://REMOVED:50030/jobdetails.jsp?jobid=job_200912240057_7597&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://REMOVED:50030/jobdetails.jsp?jobid=job_200912240057_7597&lt;/a&gt;&lt;br/&gt;
Kill Command = REMOVED/bin/hadoop job  -Dmapred.job.tracker=REMOVED:8021 -kill job_200912240057_7597&lt;br/&gt;
2009-12-28 14:47:02,350 Stage-1 map = 0%,  reduce = 0%&lt;br/&gt;
2009-12-28 14:47:14,189 Stage-1 map = 100%,  reduce = 0%&lt;br/&gt;
2009-12-28 14:47:18,404 Stage-1 map = 100%,  reduce = 100%&lt;br/&gt;
Ended Job = job_200912240057_7597&lt;br/&gt;
Launching Job 2 out of 2&lt;br/&gt;
Moving data to: hdfs://REMOVED/561636114/10000&lt;br/&gt;
Moving data to: out&lt;br/&gt;
4 Rows loaded to out&lt;br/&gt;
OK&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Apply the patch, rebuild, and rerun&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;patch -p0 &amp;lt; hive.1001.1.patch&lt;br/&gt;
ant package&lt;br/&gt;
bin/hive&lt;br/&gt;
set hive.input.format=org.apache.hadoop.hive.ql.io.CombineHiveInputFormat;&lt;br/&gt;
insert overwrite directory &apos;out&apos; select key from fourlinestest;&lt;/p&gt;

&lt;p&gt;--&amp;gt; This time the second job actually runs a MR job (which then fails because of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1006&quot; title=&quot;getPartitionDescFromPath failing from CombineHiveInputFormat&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1006&quot;&gt;&lt;del&gt;HIVE-1006&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Total MapReduce jobs = 2&lt;br/&gt;
Launching Job 1 out of 2&lt;br/&gt;
Number of reduce tasks is set to 0 since there&apos;s no reduce operator&lt;br/&gt;
Starting Job = job_200912240057_7616, Tracking URL = &lt;a href=&quot;http://REMOVED:50030/jobdetails.jsp?jobid=job_200912240057_7616&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://REMOVED:50030/jobdetails.jsp?jobid=job_200912240057_7616&lt;/a&gt;&lt;br/&gt;
Kill Command = REMOVED/bin/hadoop job  -Dmapred.job.tracker=REMOVED:8021 -kill job_200912240057_7616&lt;br/&gt;
2009-12-28 14:54:39,414 Stage-1 map = 0%,  reduce = 0%&lt;br/&gt;
2009-12-28 14:54:51,224 Stage-1 map = 100%,  reduce = 0%&lt;br/&gt;
Ended Job = job_200912240057_7616&lt;br/&gt;
Launching Job 2 out of 2&lt;br/&gt;
Number of reduce tasks determined at compile time: 1&lt;br/&gt;
In order to change the average load for a reducer (in bytes):&lt;br/&gt;
  set hive.exec.reducers.bytes.per.reducer=&amp;lt;number&amp;gt;&lt;br/&gt;
In order to limit the maximum number of reducers:&lt;br/&gt;
  set hive.exec.reducers.max=&amp;lt;number&amp;gt;&lt;br/&gt;
In order to set a constant number of reducers:&lt;br/&gt;
  set mapred.reduce.tasks=&amp;lt;number&amp;gt;&lt;br/&gt;
java.io.IOException: cannot find dir = hdfs://RMOVED/1656362434/10001/attempt_200912240057_7616_m_000000_0 in partToPartitionInfo!&lt;/p&gt;</comment>
                            <comment id="12794968" author="he yongqiang" created="Mon, 28 Dec 2009 23:52:24 +0000"  >&lt;p&gt;Hi Dave,&lt;/p&gt;

&lt;p&gt;How many mappers in the map-reduce job before applying this patch?  It is strange that the merge job was not running. The merge job is started according to average result file size produced by the first job, and the merge job always uses a map-reduce job.&lt;/p&gt;

&lt;p&gt;And also discussed with Namit, we may need to add another parameter &quot;number of files&quot; to determine whether to start the merge job or not (this will be a different issue).&lt;/p&gt;</comment>
                            <comment id="12795788" author="dlerman" created="Fri, 1 Jan 2010 20:03:54 +0000"  >&lt;p&gt;Okay, that makes sense then.  Without the patch, the two input pools have corrupt paths so the input files don&apos;t match either pool and get processed together in one pool of non-matching paths.  This yields one split and one mapper, so the merge step doesn&apos;t run (since there&apos;s only one output file).&lt;/p&gt;

&lt;p&gt;With the patch, the pools get created correctly, so the two files are processed in separate pools, which yields two splits and two mappers, so the merge step runs.&lt;/p&gt;

&lt;p&gt;Thanks for the help.&lt;/p&gt;</comment>
                            <comment id="12795841" author="namit" created="Sat, 2 Jan 2010 07:55:41 +0000"  >&lt;p&gt;Closing the jira as per the clarification&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12428661" name="hive.1001.1.patch" size="6736" author="namit" created="Mon, 21 Dec 2009 22:04:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73161</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 47 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lcvz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>122738</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>