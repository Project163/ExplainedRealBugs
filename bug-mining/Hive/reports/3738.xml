<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:36:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-11466] HIVE-10166 generates more data on hive.log causing Jenkins to fill all the disk.</title>
                <link>https://issues.apache.org/jira/browse/HIVE-11466</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;An issue with &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-10166&quot; title=&quot;Merge Spark branch to master 7/30/2015&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-10166&quot;&gt;&lt;del&gt;HIVE-10166&lt;/del&gt;&lt;/a&gt; patch is increasing the size of hive.log and  causing jenkins to fail because it does not have more space.&lt;/p&gt;

&lt;p&gt;Here&apos;s a test I run when running TestJdbcWithMiniHS2 before the patch, with the patch, and after other commits.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;BEFORE HIVE-10166
13M Aug  5 11:57 ./hive-unit/target/tmp/log/hive.log

WITH HIVE-10166
2.4G Aug  5 12:07 ./hive-unit/target/tmp/log/hive.log

CURRENT HEAD
3.2G Aug  5 12:36 ./hive-unit/target/tmp/log/hive.log
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is just a single test, but on Jenkins, hive.log is more than 13G of size.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12852319">HIVE-11466</key>
            <summary>HIVE-10166 generates more data on hive.log causing Jenkins to fill all the disk.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xuefuz">Xuefu Zhang</assignee>
                                    <reporter username="spena">Sergio Pe&#241;a</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Aug 2015 17:48:24 +0000</created>
                <updated>Tue, 16 Feb 2016 23:51:38 +0000</updated>
                            <resolved>Sat, 8 Aug 2015 00:40:08 +0000</resolved>
                                                    <fixVersion>spark-branch</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14658579" author="spena" created="Wed, 5 Aug 2015 17:48:55 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt; and me found this issue with the patch at &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-10166&quot; title=&quot;Merge Spark branch to master 7/30/2015&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-10166&quot;&gt;&lt;del&gt;HIVE-10166&lt;/del&gt;&lt;/a&gt;. &lt;br/&gt;
Could you help us take a look to know what&apos;s the problem?&lt;/p&gt;</comment>
                            <comment id="14658626" author="xuefuz" created="Wed, 5 Aug 2015 18:15:14 +0000"  >&lt;p&gt;Sure. How can I access the hive.log file that has an excessive size?&lt;/p&gt;</comment>
                            <comment id="14658733" author="spena" created="Wed, 5 Aug 2015 19:33:43 +0000"  >&lt;p&gt;Just run this test on your machine.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;mvn test -Phadoop-2 -Dtest=TestJdbcWithMiniHS2&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Then search for the hive.log, and you will see it is big. &lt;/p&gt;</comment>
                            <comment id="14660089" author="xuefuz" created="Thu, 6 Aug 2015 14:28:06 +0000"  >&lt;p&gt;It seems using thrift 0.9.2 for the code generation has caused the problem. I ran the test before and after &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-9152&quot; title=&quot;Dynamic Partition Pruning [Spark Branch]&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-9152&quot;&gt;&lt;del&gt;HIVE-9152&lt;/del&gt;&lt;/a&gt; commit on Spark branch and can see the behavior difference. Basically, you will either see or not see the following in hive.log after or before the commit when you run the test above.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2015-08-06 07:17:08,960 WARN  [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-17]: server.TThreadPoolServer (TThreadPoolServer.java:serve(206)) - Transport error occurred during acceptance of message.
org.apache.thrift.transport.TTransportException: No underlying server socket.
	at org.apache.thrift.transport.TServerSocket.acceptImpl(TServerSocket.java:126)
	at org.apache.thrift.transport.TServerSocket.acceptImpl(TServerSocket.java:35)
	at org.apache.thrift.transport.TServerTransport.accept(TServerTransport.java:60)
	at org.apache.thrift.server.TThreadPoolServer.serve(TThreadPoolServer.java:161)
	at org.apache.hive.service.cli.thrift.ThriftBinaryCLIService.run(ThriftBinaryCLIService.java:100)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:722)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I don&apos;t see anything obviously wrong though. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=csun&quot; class=&quot;user-hover&quot; rel=&quot;csun&quot;&gt;csun&lt;/a&gt;, could you take a look? We can either find a fix (if that&apos;s easy), or simply regenerate thrift code using 0.9.0.&lt;/p&gt;</comment>
                            <comment id="14660231" author="csun" created="Thu, 6 Aug 2015 16:13:49 +0000"  >&lt;p&gt;OK, I&apos;ll take a look.&lt;/p&gt;</comment>
                            <comment id="14660249" author="csun" created="Thu, 6 Aug 2015 16:24:44 +0000"  >&lt;p&gt;Let&apos;s see if using Thrift 0.9.0 solve the problem.&lt;/p&gt;</comment>
                            <comment id="14660277" author="csun" created="Thu, 6 Aug 2015 16:40:59 +0000"  >&lt;p&gt;Hmm, seems like with Thrift 0.9.0 it still have this message in the log.&lt;/p&gt;</comment>
                            <comment id="14660822" author="thejas" created="Thu, 6 Aug 2015 21:24:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=csun&quot; class=&quot;user-hover&quot; rel=&quot;csun&quot;&gt;csun&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt; So you think its some other change in spark merge patch that is causing the problem ?&lt;/p&gt;</comment>
                            <comment id="14662168" author="xuefuz" created="Fri, 7 Aug 2015 18:04:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thejas&quot; class=&quot;user-hover&quot; rel=&quot;thejas&quot;&gt;thejas&lt;/a&gt;, in spark branch itself, it seems that some change in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-9152&quot; title=&quot;Dynamic Partition Pruning [Spark Branch]&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-9152&quot;&gt;&lt;del&gt;HIVE-9152&lt;/del&gt;&lt;/a&gt; itself exposed this problem. Besides the thrift version change for code generation, there doesn&apos;t seem to be anything that can causes this. I guess some investigation is needed. In the meantime, second eye helps. Maybe you can take a look at the patch there as well to see if you spot anything suspicious.&lt;/p&gt;</comment>
                            <comment id="14662249" author="csun" created="Fri, 7 Aug 2015 18:46:14 +0000"  >&lt;p&gt;I&apos;m still investigating this.. the strange thing is the issue happens even after switching back to 0.9.0.&lt;br/&gt;
Looks like something unrelated to thrift in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-9152&quot; title=&quot;Dynamic Partition Pruning [Spark Branch]&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-9152&quot;&gt;&lt;del&gt;HIVE-9152&lt;/del&gt;&lt;/a&gt; caused this issue. More latter..&lt;/p&gt;</comment>
                            <comment id="14662448" author="jdere" created="Fri, 7 Aug 2015 21:00:49 +0000"  >&lt;p&gt;Looks like there was a bad merge of ThriftBinaryCLIService.java, and server.serve() is called twice. I commented out the first invocation and it looks like the log size isn&apos;t huge anymore.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        // TCP Server
        server = new TThreadPoolServer(sargs);
 +      server.setServerEventHandler(serverEventHandler);
 +      server.serve();
-       String msg = &quot;Started &quot; + ThriftBinaryCLIService.class.getSimpleName() + &quot; on port &quot;
+       String msg = &quot;Starting &quot; + ThriftBinaryCLIService.class.getSimpleName() + &quot; on port &quot;
            + portNum + &quot; with &quot; + minWorkerThreads + &quot;...&quot; + maxWorkerThreads + &quot; worker threads&quot;;
        LOG.info(msg);
+       server.serve();
      } catch (Throwable t) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14662450" author="jdere" created="Fri, 7 Aug 2015 21:01:57 +0000"  >&lt;p&gt;eh, spoke to soon .. still seem to be getting errors in my test. I&apos;ll take a look when the test finishes&lt;/p&gt;</comment>
                            <comment id="14662537" author="thejas" created="Fri, 7 Aug 2015 22:12:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=csun&quot; class=&quot;user-hover&quot; rel=&quot;csun&quot;&gt;csun&lt;/a&gt; What do you think of reverting the &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-9152&quot; title=&quot;Dynamic Partition Pruning [Spark Branch]&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-9152&quot;&gt;&lt;del&gt;HIVE-9152&lt;/del&gt;&lt;/a&gt; change temporarily while the issue with the change is investigated, so that we can get the precommit tests going again ?&lt;/p&gt;</comment>
                            <comment id="14662655" author="xuefuz" created="Fri, 7 Aug 2015 23:36:57 +0000"  >&lt;p&gt;I think this could be it. When I debugged it, it seems that the errors started showing up after the service is stopped. It seemed that the &quot;service&quot; didn&apos;t stop completely, but now I realized that there might be two services and only one was stopped.&lt;/p&gt;</comment>
                            <comment id="14662666" author="csun" created="Fri, 7 Aug 2015 23:47:21 +0000"  >&lt;p&gt;Yes, I&apos;m OK with it. &lt;/p&gt;</comment>
                            <comment id="14662684" author="xuefuz" created="Sat, 8 Aug 2015 00:10:03 +0000"  >&lt;p&gt;My test shows that by removing one of the line &quot;server.serve()&quot;, the problem goes away. Thanks to Jason for eying that out. How is your test coming out?&lt;/p&gt;</comment>
                            <comment id="14662685" author="csun" created="Sat, 8 Aug 2015 00:14:13 +0000"  >&lt;p&gt;I removed &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-9152&quot; title=&quot;Dynamic Partition Pruning [Spark Branch]&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-9152&quot;&gt;&lt;del&gt;HIVE-9152&lt;/del&gt;&lt;/a&gt; on my local machine, but the exception messages are still in the log. I&apos;m not quite sure if &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-9152&quot; title=&quot;Dynamic Partition Pruning [Spark Branch]&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-9152&quot;&gt;&lt;del&gt;HIVE-9152&lt;/del&gt;&lt;/a&gt; caused the problem.&lt;/p&gt;</comment>
                            <comment id="14662699" author="xuefuz" created="Sat, 8 Aug 2015 00:26:41 +0000"  >&lt;p&gt;Yeah, it might not be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-9152&quot; title=&quot;Dynamic Partition Pruning [Spark Branch]&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-9152&quot;&gt;&lt;del&gt;HIVE-9152&lt;/del&gt;&lt;/a&gt;. I&apos;m not sure why I saw the behavior difference previously. To me now &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-10330&quot; title=&quot;Merge trunk to spark 4/14/2015 [Spark Branch]&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-10330&quot;&gt;&lt;del&gt;HIVE-10330&lt;/del&gt;&lt;/a&gt; seems to be the problem. I&apos;m going to submit a patch to fix that. We can probably commit this w/o a precommit run, but +1 from someone will be good.&lt;/p&gt;</comment>
                            <comment id="14662706" author="prasanth_j" created="Sat, 8 Aug 2015 00:34:16 +0000"  >&lt;p&gt;+1 for .1 patch.&lt;/p&gt;</comment>
                            <comment id="14662712" author="xuefuz" created="Sat, 8 Aug 2015 00:40:08 +0000"  >&lt;p&gt;Committed to master and spark branch. Thanks to Jason for the identifying the fix and Prasanth for the review.&lt;/p&gt;</comment>
                            <comment id="14662976" author="xuefuz" created="Sat, 8 Aug 2015 13:20:47 +0000"  >&lt;p&gt;The latest run showed that the problem went away. The log file size went down to 13M in the lastest QA run: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4869/succeeded/TestJdbcWithMiniHS2/hive.log&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-4869/succeeded/TestJdbcWithMiniHS2/hive.log&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14680562" author="thejas" created="Mon, 10 Aug 2015 18:58:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdere&quot; class=&quot;user-hover&quot; rel=&quot;jdere&quot;&gt;jdere&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=csun&quot; class=&quot;user-hover&quot; rel=&quot;csun&quot;&gt;csun&lt;/a&gt;&lt;br/&gt;
Thanks for the great team work  ! &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12749389" name="HIVE-11466.1.patch" size="768" author="xuefuz" created="Sat, 8 Aug 2015 00:32:05 +0000"/>
                            <attachment id="12749091" name="HIVE-11466.patch" size="6662894" author="csun" created="Thu, 6 Aug 2015 16:29:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 15 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2idkv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>