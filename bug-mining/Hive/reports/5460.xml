<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:53:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-16368] Unexpected java.lang.ArrayIndexOutOfBoundsException from query with LaterView Operation for hive on MR.</title>
                <link>https://issues.apache.org/jira/browse/HIVE-16368</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Unexpected java.lang.ArrayIndexOutOfBoundsException from query. It happened in LaterView Operation. It happened for hive-on-mr. The reason is because the column prune change the column order in LaterView operation, for back-back reducesink operators using MR engine, FileSinkOperator and TableScanOperator are added before the second ReduceSink operator, The serialization column order used by FileSinkOperator in LazyBinarySerDe of previous reducer is different from deserialization column order from table desc used by MapOperator/TableScanOperator in LazyBinarySerDe of current failed mapper.&lt;br/&gt;
The serialization is decided by the outputObjInspector from LateralViewJoinOperator,&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    ArrayList&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; fieldNames = conf.getOutputInternalColNames();
    outputObjInspector = ObjectInspectorFactory
        .getStandardStructObjectInspector(fieldNames, ois);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So the column order for serialization is decided by getOutputInternalColNames in LateralViewJoinOperator.&lt;/p&gt;

&lt;p&gt;The deserialization is decided by TableScanOperator which is created at  GenMapRedUtils.splitTasks. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    TableDesc tt_desc = PlanUtils.getIntermediateFileTableDesc(PlanUtils
        .getFieldSchemasFromRowSchema(parent.getSchema(), &lt;span class=&quot;code-quote&quot;&gt;&quot;temporarycol&quot;&lt;/span&gt;));
    &lt;span class=&quot;code-comment&quot;&gt;// Create the temporary file, its corresponding FileSinkOperaotr, and
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// its corresponding TableScanOperator.
&lt;/span&gt;    TableScanOperator tableScanOp =
        createTemporaryFile(parent, op, taskTmpDir, tt_desc, parseCtx);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The column order for deserialization is decided by rowSchema of LateralViewJoinOperator.&lt;br/&gt;
But ColumnPrunerLateralViewJoinProc changed the order of outputInternalColNames but still keep the original order of rowSchema,&lt;br/&gt;
Which cause the mismatch between serialization and deserialization for two back-to-back MR jobs.&lt;br/&gt;
Similar issue for ColumnPrunerLateralViewForwardProc which change the column order of its child selector colList but not rowSchema.&lt;br/&gt;
The exception is &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Caused by: java.lang.ArrayIndexOutOfBoundsException: 875968094
	at org.apache.hadoop.hive.serde2.lazybinary.LazyBinaryUtils.byteArrayToLong(LazyBinaryUtils.java:78)
	at org.apache.hadoop.hive.serde2.lazybinary.LazyBinaryDouble.init(LazyBinaryDouble.java:43)
	at org.apache.hadoop.hive.serde2.lazybinary.LazyBinaryStruct.uncheckedGetField(LazyBinaryStruct.java:264)
	at org.apache.hadoop.hive.serde2.lazybinary.LazyBinaryStruct.getField(LazyBinaryStruct.java:201)
	at org.apache.hadoop.hive.serde2.lazybinary.objectinspector.LazyBinaryStructObjectInspector.getStructFieldData(LazyBinaryStructObjectInspector.java:64)
	at org.apache.hadoop.hive.ql.exec.ExprNodeColumnEvaluator._evaluate(ExprNodeColumnEvaluator.java:94)
	at org.apache.hadoop.hive.ql.exec.ExprNodeEvaluator.evaluate(ExprNodeEvaluator.java:77)
	at org.apache.hadoop.hive.ql.exec.ExprNodeEvaluator.evaluate(ExprNodeEvaluator.java:65)
	at org.apache.hadoop.hive.ql.exec.ReduceSinkOperator.makeValueWritable(ReduceSinkOperator.java:554)
	at org.apache.hadoop.hive.ql.exec.ReduceSinkOperator.processOp(ReduceSinkOperator.java:381)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13061309">HIVE-16368</key>
            <summary>Unexpected java.lang.ArrayIndexOutOfBoundsException from query with LaterView Operation for hive on MR.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zxu">Zhihai Xu</assignee>
                                    <reporter username="zxu">Zhihai Xu</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Apr 2017 01:19:41 +0000</created>
                <updated>Wed, 23 May 2018 00:00:07 +0000</updated>
                            <resolved>Mon, 10 Apr 2017 01:24:27 +0000</resolved>
                                                    <fixVersion>3.0.0</fixVersion>
                                    <component>Query Planning</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="15954570" author="zxu" created="Tue, 4 Apr 2017 05:25:41 +0000"  >&lt;p&gt;Without the patch, the query plan of Reduce Operator Tree for the MR job with LateralViewJoinOperator  is&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;|   Stage: Stage-3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|     Map Reduce                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|       Map Operator Tree:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |       ......

|       Reduce Operator Tree:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|         Join Operator                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|           condition map:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                Inner Join 0 to 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|           keys:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|             0 _col7 (type: string)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|             1 msg.chain_uuid (type: string)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|           outputColumnNames: _col0, _col3, _col4, _col5, _col7, _col8, _col9, _col10, _col11, _col12, _col14, _col15, _col16, _col17, _col18, _col19, _col20, _col21, _col22, _col26, _col27, _col28, _col31, _col32, _col33, _col34, _col35, _col36, _col44                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|           Statistics: Num rows: 35439950 Data size: 1169518365 Basic stats: COMPLETE Column stats: NONE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|           Select Operator                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|             expressions: _col0 (type: string), _col3 (type: string), _col4 (type: bigint), _col5 (type: bigint), _col7 (type: string), _col8 (type: string), _col9 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;), _col10 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;), _col11 (type: string), _col12 (type: string), _col14 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col15 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col16 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col17 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col18 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col19 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col20 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col21 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col22 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col26 (type: timestamp), _col27 (type: string), _col28 (type: array&amp;lt;string&amp;gt;), _col31 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col32 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col33 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col34 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col35 (type: string), _col36 (type: bigint), _col44.all_points (type: array&amp;lt;struct&amp;lt;ts:bigint,duration:bigint,lat:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,lng:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,on_uuids:array&amp;lt;string&amp;gt;,speed:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,assigned_uuids:array&amp;lt;string&amp;gt;&amp;gt;&amp;gt;)                                                                                                                                                                                                                                                                                                                  |
|             outputColumnNames: _col0, _col3, _col4, _col5, _col7, _col8, _col9, _col10, _col11, _col12, _col14, _col15, _col16, _col17, _col18, _col19, _col20, _col21, _col22, _col26, _col27, _col28, _col31, _col32, _col33, _col34, _col35, _col36, _col37                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|             Statistics: Num rows: 35439950 Data size: 1169518365 Basic stats: COMPLETE Column stats: NONE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|             Lateral View Forward                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               Statistics: Num rows: 35439950 Data size: 1169518365 Basic stats: COMPLETE Column stats: NONE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               Select Operator                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                 expressions: _col0 (type: string), _col10 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;), _col11 (type: string), _col12 (type: string), _col14 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col15 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col16 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col17 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col18 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col19 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col20 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col21 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col22 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col26 (type: timestamp), _col27 (type: string), _col28 (type: array&amp;lt;string&amp;gt;), _col3 (type: string), _col31 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col32 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col33 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col34 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col35 (type: string), _col36 (type: bigint), _col4 (type: bigint), _col5 (type: bigint), _col7 (type: string), _col8 (type: string), _col9 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                 outputColumnNames: _col0, _col10, _col11, _col12, _col14, _col15, _col16, _col17, _col18, _col19, _col20, _col21, _col22, _col26, _col27, _col28, _col3, _col31, _col32, _col33, _col34, _col35, _col36, _col4, _col5, _col7, _col8, _col9                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|                 Statistics: Num rows: 35439950 Data size: 1169518365 Basic stats: COMPLETE Column stats: NONE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                 Lateral View Join Operator                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|                   outputColumnNames: _col0, _col10, _col11, _col12, _col14, _col15, _col16, _col17, _col18, _col19, _col20, _col21, _col22, _col26, _col27, _col28, _col3, _col31, _col32, _col33, _col34, _col35, _col36, _col4, _col5, _col7, _col8, _col9, _col38                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                   Statistics: Num rows: 70879900 Data size: 2339036730 Basic stats: COMPLETE Column stats: NONE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|                   File Output Operator                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|                     compressed: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|                     table:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|                         input format: org.apache.hadoop.mapred.SequenceFileInputFormat                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|                         output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|                         serde: org.apache.hadoop.hive.serde2.lazybinary.LazyBinarySerDe                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               Select Operator                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                 expressions: _col37 (type: array&amp;lt;struct&amp;lt;ts:bigint,duration:bigint,lat:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,lng:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,on_uuids:array&amp;lt;string&amp;gt;,speed:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,assigned_uuids:array&amp;lt;string&amp;gt;&amp;gt;&amp;gt;)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                 outputColumnNames: _col0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                 Statistics: Num rows: 35439950 Data size: 1169518365 Basic stats: COMPLETE Column stats: NONE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                 UDTF Operator                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                   Statistics: Num rows: 35439950 Data size: 1169518365 Basic stats: COMPLETE Column stats: NONE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|                   function name: explode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                   Lateral View Join Operator                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                     outputColumnNames: _col0, _col10, _col11, _col12, _col14, _col15, _col16, _col17, _col18, _col19, _col20, _col21, _col22, _col26, _col27, _col28, _col3, _col31, _col32, _col33, _col34, _col35, _col36, _col4, _col5, _col7, _col8, _col9, _col38                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|                     Statistics: Num rows: 70879900 Data size: 2339036730 Basic stats: COMPLETE Column stats: NONE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                     File Output Operator                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                       compressed: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                       table:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                           input format: org.apache.hadoop.mapred.SequenceFileInputFormat                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                           output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|                           serde: org.apache.hadoop.hive.serde2.lazybinary.LazyBinarySerDe                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The query plan of Map Operator Tree  for the MR job with the TableScanOperator is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;|   Stage: Stage-4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|     Map Reduce                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|       Map Operator Tree:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|           TableScan                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|             Reduce Output Operator                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               key expressions: _col27 (type: string), _col7 (type: string), _col38.ts (type: bigint)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               sort order: +++                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               Map-reduce partition columns: _col27 (type: string), _col7 (type: string)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               Statistics: Num rows: 70879900 Data size: 2339036730 Basic stats: COMPLETE Column stats: NONE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               value expressions: _col0 (type: string), _col3 (type: string), _col4 (type: bigint), _col5 (type: bigint), _col8 (type: string), _col9 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;), _col10 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;), _col11 (type: string), _col12 (type: string), _col14 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col15 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col16 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col17 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col18 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col19 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col20 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col21 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col22 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col26 (type: timestamp), _col28 (type: array&amp;lt;string&amp;gt;), _col31 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col32 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col33 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col34 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col35 (type: string), _col36 (type: bigint), _col38 (type: struct&amp;lt;ts:bigint,duration:bigint,lat:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,lng:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,on_uuids:array&amp;lt;string&amp;gt;,speed:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,assigned_uuids:array&amp;lt;string&amp;gt;&amp;gt;)                                                                                                                                                                                                                                                                                                                                                                         |
|       Reduce Operator Tree:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15954583" author="zxu" created="Tue, 4 Apr 2017 05:45:23 +0000"  >&lt;p&gt;With the patch,  the query plan of Reduce Operator Tree for the MR job with LateralViewJoinOperator is&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;|   Stage: Stage-3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|     Map Reduce                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|       Map Operator Tree:      
|       ......
|       Reduce Operator Tree:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|         Join Operator                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|           condition map:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                Inner Join 0 to 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|           keys:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|             0 _col7 (type: string)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|             1 msg.chain_uuid (type: string)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|           outputColumnNames: _col0, _col3, _col4, _col5, _col7, _col8, _col9, _col10, _col11, _col12, _col14, _col15, _col16, _col17, _col18, _col19, _col20, _col21, _col22, _col26, _col27, _col28, _col31, _col32, _col33, _col34, _col35, _col36, _col44                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|           Statistics: Num rows: 35439950 Data size: 1169518365 Basic stats: COMPLETE Column stats: NONE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|           Select Operator                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|             expressions: _col0 (type: string), _col3 (type: string), _col4 (type: bigint), _col5 (type: bigint), _col7 (type: string), _col8 (type: string), _col9 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;), _col10 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;), _col11 (type: string), _col12 (type: string), _col14 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col15 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col16 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col17 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col18 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col19 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col20 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col21 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col22 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col26 (type: timestamp), _col27 (type: string), _col28 (type: array&amp;lt;string&amp;gt;), _col31 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col32 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col33 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col34 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col35 (type: string), _col36 (type: bigint), _col44.all_points (type: array&amp;lt;struct&amp;lt;ts:bigint,duration:bigint,lat:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,lng:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,on_uuids:array&amp;lt;string&amp;gt;,speed:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,assigned_uuids:array&amp;lt;string&amp;gt;&amp;gt;&amp;gt;)                                                                                                                                                                                                                                                                                                                  |
|             outputColumnNames: _col0, _col3, _col4, _col5, _col7, _col8, _col9, _col10, _col11, _col12, _col14, _col15, _col16, _col17, _col18, _col19, _col20, _col21, _col22, _col26, _col27, _col28, _col31, _col32, _col33, _col34, _col35, _col36, _col37                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|             Statistics: Num rows: 35439950 Data size: 1169518365 Basic stats: COMPLETE Column stats: NONE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|             Lateral View Forward                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|               Statistics: Num rows: 35439950 Data size: 1169518365 Basic stats: COMPLETE Column stats: NONE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               Select Operator                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                 expressions: _col0 (type: string), _col3 (type: string), _col4 (type: bigint), _col5 (type: bigint), _col7 (type: string), _col8 (type: string), _col9 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;), _col10 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;), _col11 (type: string), _col12 (type: string), _col14 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col15 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col16 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col17 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col18 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col19 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col20 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col21 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col22 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col26 (type: timestamp), _col27 (type: string), _col28 (type: array&amp;lt;string&amp;gt;), _col31 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col32 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col33 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col34 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col35 (type: string), _col36 (type: bigint)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                 outputColumnNames: _col0, _col3, _col4, _col5, _col7, _col8, _col9, _col10, _col11, _col12, _col14, _col15, _col16, _col17, _col18, _col19, _col20, _col21, _col22, _col26, _col27, _col28, _col31, _col32, _col33, _col34, _col35, _col36                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|                 Statistics: Num rows: 35439950 Data size: 1169518365 Basic stats: COMPLETE Column stats: NONE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                 Lateral View Join Operator                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|                   outputColumnNames: _col0, _col3, _col4, _col5, _col7, _col8, _col9, _col10, _col11, _col12, _col14, _col15, _col16, _col17, _col18, _col19, _col20, _col21, _col22, _col26, _col27, _col28, _col31, _col32, _col33, _col34, _col35, _col36, _col38                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                   Statistics: Num rows: 70879900 Data size: 2339036730 Basic stats: COMPLETE Column stats: NONE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|                   File Output Operator                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|                     compressed: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|                     table:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|                         input format: org.apache.hadoop.mapred.SequenceFileInputFormat                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|                         output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|                         serde: org.apache.hadoop.hive.serde2.lazybinary.LazyBinarySerDe                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               Select Operator                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                 expressions: _col37 (type: array&amp;lt;struct&amp;lt;ts:bigint,duration:bigint,lat:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,lng:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,on_uuids:array&amp;lt;string&amp;gt;,speed:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,assigned_uuids:array&amp;lt;string&amp;gt;&amp;gt;&amp;gt;)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                 outputColumnNames: _col0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                 Statistics: Num rows: 35439950 Data size: 1169518365 Basic stats: COMPLETE Column stats: NONE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                 UDTF Operator                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                   Statistics: Num rows: 35439950 Data size: 1169518365 Basic stats: COMPLETE Column stats: NONE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|                   function name: explode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                   Lateral View Join Operator                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                     outputColumnNames: _col0, _col3, _col4, _col5, _col7, _col8, _col9, _col10, _col11, _col12, _col14, _col15, _col16, _col17, _col18, _col19, _col20, _col21, _col22, _col26, _col27, _col28, _col31, _col32, _col33, _col34, _col35, _col36, _col38                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|                     Statistics: Num rows: 70879900 Data size: 2339036730 Basic stats: COMPLETE Column stats: NONE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                     File Output Operator                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                       compressed: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                       table:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                           input format: org.apache.hadoop.mapred.SequenceFileInputFormat                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                           output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|                           serde: org.apache.hadoop.hive.serde2.lazybinary.LazyBinarySerDe                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The query plan of Map Operator Tree for the MR job with the TableScanOperator is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;|   Stage: Stage-4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|     Map Reduce                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|       Map Operator Tree:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|           TableScan                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|             Reduce Output Operator                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|               key expressions: _col27 (type: string), _col7 (type: string), _col38.ts (type: bigint)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|               sort order: +++                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|               Map-reduce partition columns: _col27 (type: string), _col7 (type: string)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|               Statistics: Num rows: 70879900 Data size: 2339036730 Basic stats: COMPLETE Column stats: NONE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|               value expressions: _col0 (type: string), _col3 (type: string), _col4 (type: bigint), _col5 (type: bigint), _col8 (type: string), _col9 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;), _col10 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;), _col11 (type: string), _col12 (type: string), _col14 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col15 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col16 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col17 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col18 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col19 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col20 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col21 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col22 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col26 (type: timestamp), _col28 (type: array&amp;lt;string&amp;gt;), _col31 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col32 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col33 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col34 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), _col35 (type: string), _col36 (type: bigint), _col38 (type: struct&amp;lt;ts:bigint,duration:bigint,lat:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,lng:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,on_uuids:array&amp;lt;string&amp;gt;,speed:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,assigned_uuids:array&amp;lt;string&amp;gt;&amp;gt;)                                                                                                                                                                                                                                                                                                                                                                         
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15954912" author="hiveqa" created="Tue, 4 Apr 2017 09:35:13 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12861826/HIVE-16368.000.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12861826/HIVE-16368.000.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 4 failed/errored test(s), 10574 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestBeeLineDriver.testCliDriver[drop_with_concurrency] (batchId=234)
org.apache.hadoop.hive.cli.TestBeeLineDriver.testCliDriver[escape_comments] (batchId=234)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[lateral_view_onview] (batchId=55)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_if_expr] (batchId=142)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/4535/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/4535/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/4535/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/4535/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-4535/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-4535/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12861826 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15955461" author="ashutoshc" created="Tue, 4 Apr 2017 17:26:57 +0000"  >&lt;p&gt;Can you please add a .q test case with the patch?&lt;/p&gt;</comment>
                            <comment id="15955718" author="zxu" created="Tue, 4 Apr 2017 20:05:05 +0000"  >&lt;p&gt;Yes, thanks for the review, I will add a .q test case.&lt;/p&gt;</comment>
                            <comment id="15958235" author="zxu" created="Thu, 6 Apr 2017 03:35:35 +0000"  >&lt;p&gt;I added a test case to lateral_view_onview.q in the second patch &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-16368&quot; title=&quot;Unexpected java.lang.ArrayIndexOutOfBoundsException from query with LaterView Operation for hive on MR.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-16368&quot;&gt;&lt;del&gt;HIVE-16368&lt;/del&gt;&lt;/a&gt;.001.patch.&lt;/p&gt;</comment>
                            <comment id="15959706" author="hiveqa" created="Thu, 6 Apr 2017 20:35:15 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12862218/HIVE-16368.001.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12862218/HIVE-16368.001.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 4 failed/errored test(s), 10579 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestBeeLineDriver.testCliDriver[drop_with_concurrency] (batchId=235)
org.apache.hadoop.hive.cli.TestBeeLineDriver.testCliDriver[escape_comments] (batchId=235)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_if_expr] (batchId=143)
org.apache.hive.jdbc.TestJdbcDriver2.testResultSetMetaData (batchId=221)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/4586/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/4586/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/4586/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/4586/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-4586/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-4586/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12862218 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15960253" author="ashutoshc" created="Fri, 7 Apr 2017 04:21:29 +0000"  >&lt;p&gt;Added test cases pass even without the fix in the patch. &lt;br/&gt;
May be the issue is no longer present in master or test case need to improve.&lt;/p&gt;</comment>
                            <comment id="15961604" author="zxu" created="Sat, 8 Apr 2017 00:44:54 +0000"  >&lt;p&gt;Thanks for the review, My mistake, yes, this test case can&apos;t reproduce the issue. I thought the plan is similar, but after debug it further, the reason is there are two Select Operators are added after the Lateral View Join Operator before ReduceSinkOperator So ColumnPrunerSelectProc is called before ColumnPrunerLateralViewJoinProc is called, then ColumnPrunerSelectProc change the column order to the correct order at the following code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;      cppCtx.getPrunedColLists().put(op,
          cppCtx.getSelectColsFromChildren(op, cols));
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; List&amp;lt;FieldNode&amp;gt; getSelectColsFromChildren(SelectOperator op,
      List&amp;lt;FieldNode&amp;gt; colList) {
    List&amp;lt;FieldNode&amp;gt; cols = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
    SelectDesc conf = op.getConf();

    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (colList != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;  &amp;amp;&amp;amp; conf.isSelStarNoCompute()) {
      cols.addAll(colList);
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; cols;
    }

    List&amp;lt;ExprNodeDesc&amp;gt; selectExprs = conf.getColList();

    &lt;span class=&quot;code-comment&quot;&gt;// The colList is the output columns used by child operators, they are
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// different
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// from input columns of the current &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;. we need to find out which
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// input columns are used.
&lt;/span&gt;    List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; outputColumnNames = conf.getOutputColumnNames();
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; outputColumnNames.size(); i++) {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (colList == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        cols = mergeFieldNodesWithDesc(cols, selectExprs.get(i));
      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        FieldNode childFn = lookupColumn(colList, outputColumnNames.get(i));
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (childFn != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
          &lt;span class=&quot;code-comment&quot;&gt;// In SemanticAnalyzer we inject SEL op before aggregation. The columns
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// in &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; SEL are derived from the table schema, and &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not reflect the
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// actual columns being selected in the current query.
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// In &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt;, we skip the merge and just use the path from the child ops.
&lt;/span&gt;          ExprNodeDesc desc = selectExprs.get(i);
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (desc &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; ExprNodeColumnDesc &amp;amp;&amp;amp; ((ExprNodeColumnDesc) desc).getIsGenerated()) {
            FieldNode fn = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FieldNode(((ExprNodeColumnDesc) desc).getColumn());
            fn.setNodes(childFn.getNodes());
            cols = mergeFieldNodes(cols, fn);
          } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            cols = mergeFieldNodesWithDesc(cols, selectExprs.get(i));
          }
        }
      }
    }

    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; cols;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then after column pruning finished, the two redundant Select Operators between the Lateral View Join Operator and ReduceSinkOperator are removed.&lt;/p&gt;

&lt;p&gt;We have a very complicated query which can trigger this issue in our internal hive branch: there are no Select Operators between the Lateral View Join Operator and ReduceSinkOperator before ColumnPrunerLateralViewJoinProc is called. So this issue may potentially exist but currently I can&apos;t find a test case to trigger this error. I will keep looking for a good test case to reproduce this issue.&lt;/p&gt;</comment>
                            <comment id="15961695" author="ashutoshc" created="Sat, 8 Apr 2017 05:40:29 +0000"  >&lt;p&gt;I see that patch indeed is an improvement. Column Pruner should not change the order of columns. If you can find a testcase that will be great, else this still is worth checking in. &lt;br/&gt;
lookupColumn() should not return null in this case. Can you change null check to assert col != null instead.?&lt;/p&gt;</comment>
                            <comment id="15961948" author="zxu" created="Sat, 8 Apr 2017 21:17:23 +0000"  >&lt;p&gt;Many thanks for the review! Looks like currently &lt;tt&gt;cols&lt;/tt&gt; parameter for lookupColumn is the columns after column pruning, &lt;tt&gt;colName&lt;/tt&gt; from outputCols and &lt;tt&gt;colInfo&lt;/tt&gt; from rs is the column before column pruning, so it may be possible constant columns in outputCols or rs are not in &lt;tt&gt;cols&lt;/tt&gt;, which cause lookupColumn return null.&lt;/p&gt;</comment>
                            <comment id="15961974" author="hiveqa" created="Sat, 8 Apr 2017 22:32:36 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12862595/HIVE-16368.002.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12862595/HIVE-16368.002.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 10561 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestBeeLineDriver.testCliDriver[drop_with_concurrency] (batchId=234)
org.apache.hadoop.hive.cli.TestBeeLineDriver.testCliDriver[escape_comments] (batchId=234)
org.apache.hive.jdbc.TestJdbcDriver2.testResultSetMetaData (batchId=221)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/4620/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/4620/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/4620/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/4620/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-4620/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-4620/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12862595 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15962340" author="ashutoshc" created="Mon, 10 Apr 2017 01:24:27 +0000"  >&lt;p&gt;Pushed to master. Thanks, Zhihai!&lt;/p&gt;</comment>
                            <comment id="15963862" author="zxu" created="Tue, 11 Apr 2017 05:42:43 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;ashutoshc&lt;/a&gt; for reviewing and committing the patch!&lt;/p&gt;</comment>
                            <comment id="16486316" author="vgarg" created="Wed, 23 May 2018 00:00:07 +0000"  >&lt;p&gt;Hive 3.0.0 has been released so closing this jira.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12861826" name="HIVE-16368.000.patch" size="2201" author="zxu" created="Tue, 4 Apr 2017 05:31:06 +0000"/>
                            <attachment id="12862218" name="HIVE-16368.001.patch" size="18781" author="zxu" created="Thu, 6 Apr 2017 03:32:35 +0000"/>
                            <attachment id="12862595" name="HIVE-16368.002.patch" size="18781" author="zxu" created="Sat, 8 Apr 2017 21:18:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3d5wv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>