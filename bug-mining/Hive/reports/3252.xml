<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:31:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-3454] Problem with CAST(BIGINT as TIMESTAMP)</title>
                <link>https://issues.apache.org/jira/browse/HIVE-3454</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Ran into an issue while working with timestamp conversion.&lt;br/&gt;
CAST(unix_timestamp() as TIMESTAMP) should create a timestamp for the current time from the BIGINT returned by unix_timestamp()&lt;/p&gt;

&lt;p&gt;Instead, however, a 1970-01-16 timestamp is returned.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12607355">HIVE-3454</key>
            <summary>Problem with CAST(BIGINT as TIMESTAMP)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aihuaxu">Aihua Xu</assignee>
                                    <reporter username="rharris">Ryan Harris</reporter>
                        <labels>
                            <label>newbie</label>
                            <label>newdev</label>
                            <label>patch</label>
                    </labels>
                <created>Wed, 12 Sep 2012 22:40:05 +0000</created>
                <updated>Mon, 23 Nov 2015 19:26:30 +0000</updated>
                            <resolved>Tue, 24 Mar 2015 18:24:02 +0000</resolved>
                                    <version>0.8.0</version>
                    <version>0.8.1</version>
                    <version>0.9.0</version>
                    <version>0.10.0</version>
                    <version>0.11.0</version>
                    <version>0.12.0</version>
                    <version>0.13.0</version>
                    <version>0.13.1</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>Types</component>
                    <component>UDF</component>
                        <due></due>
                            <votes>6</votes>
                                    <watches>20</watches>
                                                                                                                <comments>
                            <comment id="13457329" author="parepidemos" created="Mon, 17 Sep 2012 21:11:49 +0000"  >&lt;p&gt;Additional information/workaround:&lt;/p&gt;

&lt;p&gt;This looks like a nanosecond bug similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3090&quot; title=&quot;Timestamp type values not having nano-second part breaks row&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3090&quot;&gt;&lt;del&gt;HIVE-3090&lt;/del&gt;&lt;/a&gt;, so I tried this:&lt;/p&gt;

&lt;p&gt;cast((unix_timestamp() * 1.0) as TIMESTAMP)&lt;/p&gt;

&lt;p&gt;and got this:&lt;/p&gt;

&lt;p&gt;2012-09-17 14:49:39.0&lt;/p&gt;

&lt;p&gt;Which is what it should be, but I would have expected this to be handled without the &quot;conversion&quot;.&lt;/p&gt;

&lt;p&gt;cast(round(unix_timestamp(),3) as TIMESTAMP)&lt;/p&gt;

&lt;p&gt;Will also work.&lt;/p&gt;
</comment>
                            <comment id="13463534" author="navis" created="Wed, 26 Sep 2012 05:22:33 +0000"  >&lt;p&gt;unix_timestamp() returns seconds but Timestamp expects millisecond value if input type is integer or long. I think you should multiply the value with 1000 for proper converting.&lt;/p&gt;</comment>
                            <comment id="13463545" author="rharris" created="Wed, 26 Sep 2012 05:42:30 +0000"  >&lt;p&gt;These are both valid options to work around the bug.  However from the Hive wiki:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://cwiki.apache.org/Hive/languagemanual-types.html#LanguageManualTypes-Timestamps&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/Hive/languagemanual-types.html#LanguageManualTypes-Timestamps&lt;/a&gt;&lt;br/&gt;
&quot;Supports traditional UNIX timestamp with optional nanosecond precision.&lt;/p&gt;

&lt;p&gt;Supported conversions:&lt;/p&gt;

&lt;p&gt;Integer numeric types: Interpreted as UNIX timestamp in seconds&quot;&lt;/p&gt;


&lt;p&gt;The documentation is stating that TIMESTAMP is &lt;b&gt;supposed&lt;/b&gt; to accept integer numeric types.  Nanosecond is optional.&lt;/p&gt;

&lt;p&gt;I assume that the documentation in the wiki is the intended behavior.  It isn&apos;t working as described in the wiki, that is why I have marked this as a bug.&lt;/p&gt;</comment>
                            <comment id="13465385" author="navis" created="Fri, 28 Sep 2012 05:46:05 +0000"  >&lt;p&gt;You are right. It&apos;s not consistent with description in wiki. This should be fixed ASAP but backward compatibility also be considered. I don&apos;t know how to resolve.&lt;/p&gt;</comment>
                            <comment id="13544647" author="rharris" created="Sat, 5 Jan 2013 09:51:42 +0000"  >&lt;p&gt;After commenting on &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3822&quot; title=&quot;Casting from double to timestamp type seems inconsistent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3822&quot;&gt;HIVE-3822&lt;/a&gt; I&apos;ve realized that even with this quasi-workaround, the cast(int/float/double as timestamp) is fundamentally broken.&lt;br/&gt;
When an epoch (assumed GMT) timestamp is passed through the cast() function it is converted to a different time based on the local timezone...this doesn&apos;t happen if the timestamp is cast from a formatted date string....this behavior is inconsistent.&lt;/p&gt;

&lt;p&gt;Furthermore, when attempting to use the to_utc_timestamp() function with a epoch date value the implicit cast() poisons the result of the timestamp that is stored by to_utc_timestamp()&lt;/p&gt;

&lt;p&gt;Something is definitely wrong.&lt;/p&gt;</comment>
                            <comment id="13599548" author="dinedal" created="Tue, 12 Mar 2013 01:14:08 +0000"  >&lt;p&gt;Using java.sql.Date instead of java.util.Date because java.sql.Date implements a timezone agnostic method of representing timestamps (always UTC, which is what a unix epoch timestamp is defined as)&lt;/p&gt;</comment>
                            <comment id="13686330" author="ariforu" created="Tue, 18 Jun 2013 03:05:57 +0000"  >&lt;p&gt;I think a good approach would be to fix it in a way that it can work with both double and long values. This is what I did and works for me. Let me know what you think.&lt;/p&gt;

&lt;p&gt;In org.apache.hadoop.hive.serde2.objectinspector.primitive PrimitiveObjectInspectorUtils.java edit getTimestamp method and convert the long object to double.&lt;/p&gt;

&lt;p&gt;getTimestamp(Object o, PrimitiveObjectInspector oi) &lt;/p&gt;

&lt;p&gt;case LONG:&lt;br/&gt;
      //Timestamp conversion from LONG is messy. Converting to double.&lt;br/&gt;
      long tsLongPrimitive=((LongObjectInspector) oi).get(o);&lt;br/&gt;
      result =TimestampWritable.doubleToTimestamp(tsLongPrimitive*1.0);&lt;br/&gt;
      break;&lt;/p&gt;</comment>
                            <comment id="13686834" author="ariforu" created="Tue, 18 Jun 2013 15:35:55 +0000"  >&lt;p&gt;Adding a patch for fixing the issue. Apply to trunk&apos;s serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/primitive/PrimitiveObjectInspectorUtils.java.&lt;/p&gt;</comment>
                            <comment id="13686845" author="ariforu" created="Tue, 18 Jun 2013 15:48:01 +0000"  >&lt;p&gt;Query : select cast(unix_timestamp()*1.0 as timestamp) , cast(unix_timestamp() as timestamp) from mycrime limit 1;&lt;/p&gt;

&lt;p&gt;Output(After patching with &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3454&quot; title=&quot;Problem with CAST(BIGINT as TIMESTAMP)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3454&quot;&gt;&lt;del&gt;HIVE-3454&lt;/del&gt;&lt;/a&gt;.patch) - both returns same and correct timestamps.&lt;/p&gt;

&lt;p&gt;2013-06-18 11:45:04	2013-06-18 11:45:04&lt;/p&gt;</comment>
                            <comment id="13850867" author="kostiantyn" created="Tue, 17 Dec 2013 20:39:19 +0000"  >&lt;p&gt;Hi there, when is this patch going to be applied to trunk? it seems it&apos;s enough important issue to be included&lt;/p&gt;</comment>
                            <comment id="13850993" author="hiveqa" created="Tue, 17 Dec 2013 22:15:59 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12588389/HIVE-3454.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12588389/HIVE-3454.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 4789 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/671/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/671/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/671/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bigtop01.cloudera.org:8080/job/PreCommit-HIVE-Build/671/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12588389&lt;/p&gt;</comment>
                            <comment id="13988610" author="ariforu" created="Sat, 3 May 2014 07:26:16 +0000"  >&lt;p&gt;Could this patch be checked in?&lt;/p&gt;</comment>
                            <comment id="14107602" author="bigdatamoore" created="Fri, 22 Aug 2014 22:18:08 +0000"  >&lt;p&gt;I see that this is still an issue.  I found this today when trying to convert from integer to timestamp.  In order to get this to work I had to add milliseconds (3 digits after the unix epoch) and also use a bigint intstead of int.  &lt;/p&gt;

&lt;p&gt;I am using version 0.12.  Any idea when this will be put in the main trunk?&lt;/p&gt;</comment>
                            <comment id="14152792" author="gvramana" created="Tue, 30 Sep 2014 04:46:56 +0000"  >&lt;p&gt;I am using 0.12 release still this problems exists. Inconsistancy in casting.&lt;/p&gt;

&lt;p&gt;select cast(cast(cast(1000 as INT) as TIMESTAMP) as INT) from src limit 1;                       result:  1&lt;br/&gt;
select cast(cast(cast(1000 as BIGINT) as TIMESTAMP) as BIGINT) from src limit 1;           result:  1&lt;br/&gt;
select cast(cast(cast(1000.0 as DOUBLE) as TIMESTAMP) as DOUBLE) from src limit 1;   result:  1000.0&lt;/p&gt;

&lt;p&gt;converting int/bigint/tinyint to timestamp and back to int/bigint/tinyint changes the value.&lt;br/&gt;
 int/bigint/tinyint/boolean conversion to timestamp, should take input in seconds, just like double.&lt;/p&gt;

&lt;p&gt;Issue raised in sep/2012, still problem persists. This requires a fix.&lt;/p&gt;</comment>
                            <comment id="14310914" author="aihuaxu" created="Sat, 7 Feb 2015 20:25:28 +0000"  >&lt;p&gt;Update the primitive types including boolean, byte, short ,int, long to be consistently represent the time in seconds when we convert them into timestamp.&lt;/p&gt;</comment>
                            <comment id="14311104" author="hiveqa" created="Sun, 8 Feb 2015 04:14:16 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12697289/HIVE-3454.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12697289/HIVE-3454.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 6 failed/errored test(s), 7526 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestCustomAuthentication - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_vectorization_decimal_date
org.apache.hadoop.hive.cli.TestHBaseCliDriver.testCliDriver_hbase_timestamp
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vectorization_decimal_date
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vectorized_casts
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_vectorization_decimal_date
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2705/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2705/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2705/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2705/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2705/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2705/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 6 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12697289 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14312618" author="aihuaxu" created="Mon, 9 Feb 2015 18:51:05 +0000"  >&lt;p&gt;Unit tests baseline updated.&lt;/p&gt;</comment>
                            <comment id="14313632" author="hiveqa" created="Tue, 10 Feb 2015 05:48:14 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12697536/HIVE-3454.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12697536/HIVE-3454.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 7541 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2732/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2732/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2732/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2732/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2732/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2732/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12697536 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14314342" author="aihuaxu" created="Tue, 10 Feb 2015 15:33:30 +0000"  >&lt;p&gt;+&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brocknoland&quot; class=&quot;user-hover&quot; rel=&quot;brocknoland&quot;&gt;brocknoland&lt;/a&gt; Can you take a look at the code? &lt;/p&gt;</comment>
                            <comment id="14314474" author="brocknoland" created="Tue, 10 Feb 2015 17:09:16 +0000"  >&lt;p&gt;Seems reasonable to me! &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt; could you look as you have more experience here than I do.&lt;/p&gt;</comment>
                            <comment id="14314699" author="jdere" created="Tue, 10 Feb 2015 19:12:03 +0000"  >&lt;p&gt;We may need to mark this as an incompatible change - folks have been using this behavior (inconsistent as it is) for a while now.&lt;br/&gt;
Also, &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-9298&quot; title=&quot;Support reading alternate timestamp formats&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-9298&quot;&gt;&lt;del&gt;HIVE-9298&lt;/del&gt;&lt;/a&gt; added TimestampParser capable of interpreting numeric text input as milliseconds since Unix epoch. Should we change this to seconds to make it consistent with the changes done here?&lt;/p&gt;</comment>
                            <comment id="14314773" author="aihuaxu" created="Tue, 10 Feb 2015 19:49:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdere&quot; class=&quot;user-hover&quot; rel=&quot;jdere&quot;&gt;jdere&lt;/a&gt; Thanks for pointing that out. I marked it as incompatible change (of course technically it&apos;s not incompatible). &lt;br/&gt;
Regarding the TimestampParser, since MillisDateFormatParser is just one of the parser to support, I think it should be good without any change. Probably we can support SecondsDateFormatParser in the future if it&apos;s necessary.&lt;/p&gt;</comment>
                            <comment id="14314780" author="brocknoland" created="Tue, 10 Feb 2015 19:53:01 +0000"  >&lt;p&gt;I hate new configuration...but if people are depending on this should we make the behavior change configurable?&lt;/p&gt;</comment>
                            <comment id="14314804" author="aihuaxu" created="Tue, 10 Feb 2015 20:04:46 +0000"  >&lt;p&gt;Me either and I feel a new configuration may make things more complicated. From the comments above, actually the users are more using workarounds (converting int/bigint to float/double first before interpreting it as timestamp). My opinion is not to add a new configuration and keep things simple. &lt;/p&gt;</comment>
                            <comment id="14314805" author="aihuaxu" created="Tue, 10 Feb 2015 20:04:49 +0000"  >&lt;p&gt;Me either and I feel a new configuration may make things more complicated. From the comments above, actually the users are more using workarounds (converting int/bigint to float/double first before interpreting it as timestamp). My opinion is not to add a new configuration and keep things simple. &lt;/p&gt;</comment>
                            <comment id="14316521" author="spena" created="Wed, 11 Feb 2015 16:56:48 +0000"  >&lt;p&gt;It looks very good.&lt;/p&gt;

&lt;p&gt;I agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aihuaxu&quot; class=&quot;user-hover&quot; rel=&quot;aihuaxu&quot;&gt;aihuaxu&lt;/a&gt;, if users were using workarounds, then they shouldn&apos;t have any problem with this change, as float/double would work fine.The only thing is what if users are using integer values to get the timestamp? If they know that they need to pass milliseconds, they they could have these values in their queries; and now this change would give them unexpected values. However, the wiki states that seconds is the allowed number, so these users are using it incorrectly.&lt;/p&gt;

&lt;p&gt;I agree with this change so that it fixes the bug, and complies with the wiki page.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14324973" author="aihuaxu" created="Tue, 17 Feb 2015 22:00:58 +0000"  >&lt;p&gt;Discussed with Brock offline, seems more reasonable to make it configurable so that we won&apos;t break existing customers. Set &quot;int.timestamp.conversion.in.seconds&quot; to true in hive-site.xml to make the behavior consistent. We will gradually switch to the seconds interpretation.&lt;/p&gt;</comment>
                            <comment id="14325250" author="jdere" created="Wed, 18 Feb 2015 01:13:24 +0000"  >&lt;p&gt;Can you make the naming of the HiveConf parameter more consistent with the rest of the HiveConf variable names (starts with &quot;hive.&quot;).&lt;/p&gt;</comment>
                            <comment id="14325252" author="hiveqa" created="Wed, 18 Feb 2015 01:13:54 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12699343/HIVE-3454.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12699343/HIVE-3454.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 7553 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2817/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2817/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2817/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2817/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2817/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2817/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12699343 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14325867" author="aihuaxu" created="Wed, 18 Feb 2015 13:57:12 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdere&quot; class=&quot;user-hover&quot; rel=&quot;jdere&quot;&gt;jdere&lt;/a&gt; for reviewing. Just updated the parameter name.&lt;/p&gt;</comment>
                            <comment id="14325868" author="aihuaxu" created="Wed, 18 Feb 2015 13:57:14 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdere&quot; class=&quot;user-hover&quot; rel=&quot;jdere&quot;&gt;jdere&lt;/a&gt; for reviewing. Just updated the parameter name.&lt;/p&gt;</comment>
                            <comment id="14326065" author="hiveqa" created="Wed, 18 Feb 2015 15:46:02 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12699474/HIVE-3454.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12699474/HIVE-3454.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 1 failed/errored test(s), 7557 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_schemeAuthority
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2820/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2820/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2820/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2820/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2820/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2820/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12699474 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14326137" author="aihuaxu" created="Wed, 18 Feb 2015 16:26:51 +0000"  >&lt;p&gt;The test failure is unrelated to the change.&lt;/p&gt;</comment>
                            <comment id="14326158" author="brocknoland" created="Wed, 18 Feb 2015 16:39:53 +0000"  >&lt;p&gt;Have we tested this as part of an MR job? I don&apos;t think that the hive-site.xml is shipped as part of MR jobs. If that is true, how about we do as follows:&lt;/p&gt;

&lt;p&gt;1) Add method &lt;tt&gt;public static void initialize(Configuration)&lt;/tt&gt; to &lt;tt&gt;TimestampWritable&lt;/tt&gt;&lt;br/&gt;
2) Call this method from &lt;tt&gt;AbstractSerDe.initialize&lt;/tt&gt; which should be called, with configuration, in all the right places.&lt;br/&gt;
3) In &lt;tt&gt;TimestampWritable.initialize&lt;/tt&gt; you can use the static &lt;tt&gt;HiveConf.getBoolVar&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;a bit kludgy but it should work. This all assuming the current impl doesn&apos;t work.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&quot;timestamp conversion.&quot;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think we need a space after this.&lt;/p&gt;</comment>
                            <comment id="14326352" author="aihuaxu" created="Wed, 18 Feb 2015 18:43:29 +0000"  >&lt;p&gt;Yeah. I have tested with an MR job and it picks up the hive-site.xml without the problem with hiveserver2 or CLI.&lt;/p&gt;</comment>
                            <comment id="14327096" author="jdere" created="Thu, 19 Feb 2015 08:06:00 +0000"  >&lt;p&gt;If this config setting is initialized once in a static block, then for hiveserver2 all subsequent sessions would be stuck with the initial setting regardless of the config settings of the session, right? During the MR jobs, would we then see the sec/msec behavior flip to use the session&apos;s config settings since the static variable is being initialized for the first time in MR task?&lt;/p&gt;</comment>
                            <comment id="14329011" author="aihuaxu" created="Fri, 20 Feb 2015 14:57:30 +0000"  >&lt;p&gt;Yeah. Thanks for pointing that out. I also notice that problem. We won&apos;t be able to override during the session with that approach and also we could have problem if we run in the real cluster as Brock pointed out. I&apos;m trying a different approach. &lt;/p&gt;</comment>
                            <comment id="14329503" author="aihuaxu" created="Fri, 20 Feb 2015 20:30:02 +0000"  >&lt;p&gt;Read the configuration from passed in Configuration object from the initialize() in AbstractSerDe class. Since AvroSerDe overrides the function and OrcSerDe doesn&apos;t inherit from AbstractSerDe right now, added in these two classes as well. It will support the session override.&lt;/p&gt;</comment>
                            <comment id="14329802" author="hiveqa" created="Sat, 21 Feb 2015 00:07:47 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12699952/HIVE-3454.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12699952/HIVE-3454.4.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 1 failed/errored test(s), 7568 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_udaf_percentile_approx_23
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2836/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2836/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2836/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2836/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2836/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2836/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12699952 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14329857" author="brocknoland" created="Sat, 21 Feb 2015 00:44:28 +0000"  >&lt;p&gt;+1 LGTM&lt;/p&gt;

&lt;p&gt;best we can do in this situation.&lt;/p&gt;</comment>
                            <comment id="14329876" author="jdere" created="Sat, 21 Feb 2015 01:00:47 +0000"  >&lt;p&gt;TimestampWritable.intToTimeStampInSeconds is still static, which means we could run into issues in HiveServer2 with concurrent queries. Maybe this should be thread-local.&lt;br/&gt;
Hmm, yeah I&apos;m not sure where the best place is to call TimestampWritable.initialize() .. I was going to recommend Driver.compile(), though we would also have to add it to MR task initialization somewhere if there is such a place.&lt;/p&gt;</comment>
                            <comment id="14333554" author="aihuaxu" created="Mon, 23 Feb 2015 17:34:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdere&quot; class=&quot;user-hover&quot; rel=&quot;jdere&quot;&gt;jdere&lt;/a&gt; I spent some time looking into the parallel in Hive. Hive can handle queries in parallel or a complex query breaking into subtasks executed in parallel. In both cases, Hive hands over the multiple jobs to hadoop and those jobs won&apos;t affect each other. I have simulated the cases by debugging them from different sessions and it works as expected. &lt;/p&gt;</comment>
                            <comment id="14335874" author="aihuaxu" created="Wed, 25 Feb 2015 02:23:30 +0000"  >&lt;p&gt;The unit test failure is unrelated to the change. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdere&quot; class=&quot;user-hover&quot; rel=&quot;jdere&quot;&gt;jdere&lt;/a&gt; More comments on my input above?&lt;/p&gt;</comment>
                            <comment id="14335946" author="jdere" created="Wed, 25 Feb 2015 03:49:06 +0000"  >&lt;p&gt;I guess the only possible issue here might be for expressions that get evaluated during compilation as opposed to during the tasks, something like cast(0 as timestamp) which would get evaluated by constant folding. Not sure if there is any other possible work/tasks that happen locally in-process.&lt;/p&gt;</comment>
                            <comment id="14336537" author="aihuaxu" created="Wed, 25 Feb 2015 14:22:55 +0000"  >&lt;p&gt;If the job runs locally in-process, like cast(0 as timestamp), SerDe is still used for intermediate output and thus the property still gets set and works fine.  &lt;/p&gt;</comment>
                            <comment id="14337027" author="jdere" created="Wed, 25 Feb 2015 19:27:26 +0000"  >&lt;p&gt;If concurrent compilation is possible, then there is still the possibility of multiple threads setting/accessing the same static variable and messing up the config setting for the other threads. You&apos;re adding this to TimestampWritable - there is even a member in that class that was changed to thread-local as a result of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4516&quot; title=&quot;Fix concurrency bug in serde/src/java/org/apache/hadoop/hive/serde2/io/TimestampWritable.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4516&quot;&gt;&lt;del&gt;HIVE-4516&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14340221" author="aihuaxu" created="Fri, 27 Feb 2015 14:57:22 +0000"  >&lt;p&gt;I see your points that multiple threads run in single mapper or reducer access that class and that may cause concurrency issue. I will try to call the initialize() from Mapper and Reducer&apos;s initialization function to make sure it initializes once. And also Driver.compile() (I will check what would be the good place for the local mode). &lt;/p&gt;</comment>
                            <comment id="14343913" author="aihuaxu" created="Mon, 2 Mar 2015 22:34:47 +0000"  >&lt;p&gt;Updated to initialize for local mode in Driver.runInternal() and configure() of ExecMapper and ExecReducer.&lt;/p&gt;</comment>
                            <comment id="14344253" author="hiveqa" created="Tue, 3 Mar 2015 01:27:04 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12701998/HIVE-3454.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12701998/HIVE-3454.4.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 7580 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2921/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2921/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2921/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2921/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2921/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2921/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12701998 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14345766" author="aihuaxu" created="Tue, 3 Mar 2015 21:27:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdere&quot; class=&quot;user-hover&quot; rel=&quot;jdere&quot;&gt;jdere&lt;/a&gt; Can you review the latest patch? Right now it should be set once for each Mapper and Reducer.&lt;/p&gt;</comment>
                            <comment id="14346047" author="jdere" created="Wed, 4 Mar 2015 00:04:45 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Can you make intToTimeStampInSeconds thread-local?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;According to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vikram.dixit&quot; class=&quot;user-hover&quot; rel=&quot;vikram.dixit&quot;&gt;vikram.dixit&lt;/a&gt;, Tez uses separate classes, the equivalent to ExecMapper/ExecReducer are MapRecordProcessor/ReduceRecordProcessor. It looks like Spark also has its own equivalents (SparkMapRecordHandler/SparkMapReduceHandler). If you want we can defer those changes and open a follow-up Jira to do that work.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14346115" author="aihuaxu" created="Wed, 4 Mar 2015 00:40:55 +0000"  >&lt;p&gt;#Actually we don&apos;t want it to be thread-local since we want all threads, e.g, within Mapper to have the same settings. If we set to be thread-local, the threads within the same mapper which don&apos;t set intToTimeStampInSeconds will have incorrect behaviors. Of course, the original problem was that we can&apos;t access hive properties from TimestampWritable class and we have to set from outside. &lt;/p&gt;

&lt;p&gt;#I will create a follow-up jira to do the rest (Tez and Spark). &lt;/p&gt;
</comment>
                            <comment id="14346156" author="sershe" created="Wed, 4 Mar 2015 01:14:14 +0000"  >&lt;p&gt;Please don&apos;t use the static intToTimeStampInSeconds, it is not thread-safe&lt;/p&gt;</comment>
                            <comment id="14346184" author="jdere" created="Wed, 4 Mar 2015 01:31:52 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Actually we don&apos;t want it to be thread-local since we want all threads, e.g, within Mapper to have the same settings. If we set to be thread-local, the threads within the same mapper which don&apos;t set intToTimeStampInSeconds will have incorrect behaviors. Of course, the original problem was that we can&apos;t access hive properties from TimestampWritable class and we have to set from outside.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Asking around a bit about &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-7926&quot; title=&quot;long-lived daemons for query fragment execution, I/O and caching&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-7926&quot;&gt;&lt;del&gt;HIVE-7926&lt;/del&gt;&lt;/a&gt;, it sounds like LLAP will potentially have multiple queries running at the same time in different threads, which would make a single static variable problematic. It also sounds like each thread should in theory have the equivalent of something like ExecMapper.configure() where thread-local context is initialized, so I think that any threads running map/reduce work should have an opportunity to set intToTimeStampInSeconds. I would think that things would be similar for Spark as well, though someone with more familiarity with Hive-Spark execution would be better suited to answer that question.&lt;/p&gt;</comment>
                            <comment id="14346302" author="brocknoland" created="Wed, 4 Mar 2015 03:07:56 +0000"  >&lt;p&gt;HOS won&apos;t have this issue as the executors are tied to a user session. I think we should commit the patch as is and create a follow-up to address the issue with LLAP.&lt;/p&gt;</comment>
                            <comment id="14346318" author="jdere" created="Wed, 4 Mar 2015 03:23:45 +0000"  >&lt;p&gt;I&apos;m willing to defer that work to a different Jira. +1&lt;/p&gt;

&lt;p&gt;But I&apos;m surprised this would not be an issue with HOS as well .. can HOS have multiple threads doing work for more than one query at the same time? If so then HOS would get hit by this too since this setting is relying on a static variable.&lt;/p&gt;</comment>
                            <comment id="14346454" author="brocknoland" created="Wed, 4 Mar 2015 06:06:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;an HOS have multiple threads doing work for more than one query at the same time? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;no it cannot. HOS does do concurrent tasks but not across queries.&lt;/p&gt;</comment>
                            <comment id="14347042" author="aihuaxu" created="Wed, 4 Mar 2015 15:47:24 +0000"  >&lt;p&gt;Was not aware of LLAP. Seems reasonable to defer the issue since I guess LLAP needs to handle many other similar thread-safe problems like this. Correct me if I&apos;m wrong with the hadoop execution: currently (without LLAP) each ExecMapper and ExecReducer runs in its own JVM and it could spin off new threads. Each ExecMapper and ExecReducer handles one job from a query and we want those threads to share that same static variable value. &lt;/p&gt;

&lt;p&gt;With LLAP, if ExecMapper runs in a thread and doesn&apos;t spin off new threads, then thread-local would work, but we still need to handle current existing scenario. If new threads are spun off, thread-local actually won&apos;t work.&lt;/p&gt;</comment>
                            <comment id="14347540" author="sershe" created="Wed, 4 Mar 2015 20:38:15 +0000"  >&lt;p&gt;It just seems like a bad design pattern irrespective of LLAP. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hagleitn&quot; class=&quot;user-hover&quot; rel=&quot;hagleitn&quot;&gt;hagleitn&lt;/a&gt; did some work in operator pipeline to clean up statics and such, he can comment. What is the real scope of this variable? It should be scoped accordingly. Even a singleton map would be better...&lt;/p&gt;</comment>
                            <comment id="14347582" author="hagleitn" created="Wed, 4 Mar 2015 21:20:25 +0000"  >&lt;p&gt;I agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt;. These statics aren&apos;t just a pain w/ multi threading, they also hurt if you just re-use the same jvm for multiple things. This can happen in tez, spark and if we decide to run stuff on the client/in hs2 afaik.&lt;/p&gt;

&lt;p&gt;More specifically though: This config should take effect at compile time. There is no reason to evaluate the condition for each value in each row at run time. We should be able to just install the appropriate udf when we compile the query, no?&lt;/p&gt;</comment>
                            <comment id="14347905" author="aihuaxu" created="Thu, 5 Mar 2015 01:25:40 +0000"  >&lt;p&gt;I agree that for non thread-safe statics, it will cause problems for multi-threading, while for constants or immutable objects, I guess you would share across threads rather than creating each copy for each thread. This is the case of a java primitive that we initialize once and use/read later by threads.&lt;/p&gt;

&lt;p&gt;Regarding UDF approach, I looked into that and it seems promising, while the current approach actually only evaluates the value when the type is timestamp. I guess it would be the same as UDF approach. &lt;/p&gt;</comment>
                            <comment id="14348023" author="aihuaxu" created="Thu, 5 Mar 2015 02:38:39 +0000"  >&lt;p&gt;Of course, since we need to support LLAP, UDF approach seems to be the right approach.&lt;/p&gt;</comment>
                            <comment id="14355763" author="aihuaxu" created="Tue, 10 Mar 2015 21:30:36 +0000"  >&lt;p&gt;I&apos;m looking into the solution &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hagleitn&quot; class=&quot;user-hover&quot; rel=&quot;hagleitn&quot;&gt;hagleitn&lt;/a&gt; suggested.  I will break the tasks into separate tasks, so that this jira will focus on the right/simple behavior and a followup to focus on making it configurable so that we can easily revert in the future and also focus on that only.&lt;/p&gt;</comment>
                            <comment id="14355789" author="aihuaxu" created="Tue, 10 Mar 2015 21:48:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brocknoland&quot; class=&quot;user-hover&quot; rel=&quot;brocknoland&quot;&gt;brocknoland&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdere&quot; class=&quot;user-hover&quot; rel=&quot;jdere&quot;&gt;jdere&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hagleitn&quot; class=&quot;user-hover&quot; rel=&quot;hagleitn&quot;&gt;hagleitn&lt;/a&gt; I created &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-9917&quot; title=&quot;After HIVE-3454 is done, make int to timestamp conversion configurable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-9917&quot;&gt;&lt;del&gt;HIVE-9917&lt;/del&gt;&lt;/a&gt; for the followup change. I will mark the current change as incompatible. How does that sound?&lt;/p&gt;</comment>
                            <comment id="14358988" author="csun" created="Thu, 12 Mar 2015 17:10:41 +0000"  >&lt;p&gt;+1. Breaking into separate tasks makes sense to me, but it&apos;s better to have others&apos; inputs (I&apos;m no expert on this matter), before we commit this.&lt;/p&gt;</comment>
                            <comment id="14359144" author="jdere" created="Thu, 12 Mar 2015 18:39:05 +0000"  >&lt;p&gt;That&apos;s fine to break into separate tasks, we&apos;ll just need to make sure the followup config task gets in before the next release.&lt;/p&gt;</comment>
                            <comment id="14359383" author="jdere" created="Thu, 12 Mar 2015 20:54:47 +0000"  >&lt;p&gt;This has been marked patch available - which one should we be looking at - &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3454&quot; title=&quot;Problem with CAST(BIGINT as TIMESTAMP)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3454&quot;&gt;&lt;del&gt;HIVE-3454&lt;/del&gt;&lt;/a&gt;.3.patch?&lt;/p&gt;</comment>
                            <comment id="14359406" author="aihuaxu" created="Thu, 12 Mar 2015 21:02:44 +0000"  >&lt;p&gt;Yes. That&apos;s right. That patch is to change in the correct way to interpreting all the datatypes as seconds. Thanks for looking.&lt;/p&gt;</comment>
                            <comment id="14359502" author="jdere" created="Thu, 12 Mar 2015 21:57:11 +0000"  >&lt;p&gt;I&apos;ve just started looking at vectorized code .. looks like the corresponding change to make for the vectorized path will be in MathExpr.doubleToTimestamp(). CC&apos;ing &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mmccline&quot; class=&quot;user-hover&quot; rel=&quot;mmccline&quot;&gt;mmccline&lt;/a&gt; in case there is any more details to add here.&lt;/p&gt;</comment>
                            <comment id="14363355" author="aihuaxu" created="Mon, 16 Mar 2015 15:34:57 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdere&quot; class=&quot;user-hover&quot; rel=&quot;jdere&quot;&gt;jdere&lt;/a&gt;. We need to correct MathErpr.longToTimestamp() function since we have inconsistency with the int/long type, Correct?&lt;/p&gt;</comment>
                            <comment id="14363650" author="jdere" created="Mon, 16 Mar 2015 18:22:19 +0000"  >&lt;p&gt;Whoops, yes it is longToTimestamp() that should be fixed, since the point of this is to correct the int/long to timestamp behavior.&lt;/p&gt;</comment>
                            <comment id="14371436" author="aihuaxu" created="Fri, 20 Mar 2015 15:10:39 +0000"  >&lt;p&gt;Made additional changes to vectorized functions and unit tests.&lt;/p&gt;</comment>
                            <comment id="14371672" author="hiveqa" created="Fri, 20 Mar 2015 17:23:51 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12705949/HIVE-3454.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12705949/HIVE-3454.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 1 failed/errored test(s), 7820 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hive.jdbc.TestMultiSessionsHS2WithLocalClusterSpark.testSparkQuery
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3091/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3091/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3091/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3091/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-3091/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-3091/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12705949 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14372089" author="jdere" created="Fri, 20 Mar 2015 20:58:27 +0000"  >&lt;p&gt;So this patch did not require any changes to MathExpr? How does the behavior of the vectorized cast change?&lt;/p&gt;</comment>
                            <comment id="14372840" author="aihuaxu" created="Sat, 21 Mar 2015 15:18:22 +0000"  >&lt;p&gt;Attached should be the right patch now. Maybe I uploaded the right patch first but I worried test run was not started (but seems the test was run against the right patch), so I uploaded again but the wrong one. Thanks for catching it. &lt;/p&gt;</comment>
                            <comment id="14372897" author="hiveqa" created="Sat, 21 Mar 2015 17:03:39 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12706162/HIVE-3454.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12706162/HIVE-3454.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 7819 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_between_in
org.apache.hadoop.hive.ql.exec.vector.expressions.TestVectorTypeCasts.testCastLongToTimestamp
org.apache.hive.jdbc.TestMultiSessionsHS2WithLocalClusterSpark.testSparkQuery
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3105/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3105/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3105/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3105/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-3105/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-3105/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12706162 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14374774" author="hiveqa" created="Sun, 22 Mar 2015 03:54:51 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12706362/HIVE-3454.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12706362/HIVE-3454.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 1 failed/errored test(s), 7819 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_udaf_percentile_approx_23
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3107/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3107/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3107/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3107/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-3107/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-3107/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12706362 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14375082" author="aihuaxu" created="Sun, 22 Mar 2015 17:42:12 +0000"  >&lt;p&gt;This error is unrelated to the change and seems random. &lt;/p&gt;</comment>
                            <comment id="14376863" author="jdere" created="Mon, 23 Mar 2015 23:04:46 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14378321" author="csun" created="Tue, 24 Mar 2015 18:24:02 +0000"  >&lt;p&gt;Committed to trunk. Thanks Aihua!&lt;/p&gt;</comment>
                            <comment id="14378367" author="aihuaxu" created="Tue, 24 Mar 2015 18:53:02 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=csun&quot; class=&quot;user-hover&quot; rel=&quot;csun&quot;&gt;csun&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdere&quot; class=&quot;user-hover&quot; rel=&quot;jdere&quot;&gt;jdere&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14548997" author="sushanth" created="Mon, 18 May 2015 19:54:55 +0000"  >&lt;p&gt;This issue has been fixed and released as part of the 1.2.0 release. If you find an issue which seems to be related to this one, please create a new jira and link this one with new jira.&lt;/p&gt;</comment>
                            <comment id="15014538" author="yhuai" created="Thu, 19 Nov 2015 22:23:23 +0000"  >&lt;p&gt;Seems this issue has not been fixe completely. I still see&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;hive&amp;gt; SELECT CAST(CAST(-1200.0 AS TIMESTAMP) AS DOUBLE);
OK
-1200.0
Time taken: 0.047 seconds, Fetched: 1 row(s)
hive&amp;gt; SELECT CAST(CAST(-1200 AS TIMESTAMP) AS INT);
OK
-2
Time taken: 0.044 seconds, Fetched: 1 row(s)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15022402" author="aihuaxu" created="Mon, 23 Nov 2015 16:29:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yhuai&quot; class=&quot;user-hover&quot; rel=&quot;yhuai&quot;&gt;yhuai&lt;/a&gt; Which version are you running on?  I tried on the latest and it seems to be fine. &lt;/p&gt;</comment>
                            <comment id="15022420" author="yhuai" created="Mon, 23 Nov 2015 16:37:43 +0000"  >&lt;p&gt;I was using 1.2.1. &lt;/p&gt;</comment>
                            <comment id="15022785" author="aihuaxu" created="Mon, 23 Nov 2015 19:17:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yhuai&quot; class=&quot;user-hover&quot; rel=&quot;yhuai&quot;&gt;yhuai&lt;/a&gt; In 1.2.1, you need to &lt;tt&gt;set hive.int.timestamp.conversion.in.seconds=true;&lt;/tt&gt; to get the correct behavior, see &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-9917&quot; title=&quot;After HIVE-3454 is done, make int to timestamp conversion configurable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-9917&quot;&gt;&lt;del&gt;HIVE-9917&lt;/del&gt;&lt;/a&gt;.  We kept the existing behavior for backward compatibility. In 2.0.0, we default   hive.int.timestamp.conversion.in.seconds to true. &lt;/p&gt;</comment>
                            <comment id="15022804" author="yhuai" created="Mon, 23 Nov 2015 19:26:30 +0000"  >&lt;p&gt;OK. Thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12624690">HIVE-3822</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12842350">HIVE-11168</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12780996">HIVE-9917</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12573223" name="HIVE-3454.1.patch.txt" size="547" author="dinedal" created="Tue, 12 Mar 2013 01:14:52 +0000"/>
                            <attachment id="12706362" name="HIVE-3454.3.patch" size="309027" author="aihuaxu" created="Sun, 22 Mar 2015 02:01:00 +0000"/>
                            <attachment id="12588389" name="HIVE-3454.patch" size="941" author="ariforu" created="Tue, 18 Jun 2013 15:35:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>259252</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10342"><![CDATA[Incompatible change]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lns7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>124503</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>The behaviors of converting from BOOLEAN/TINYINT/SMALLINT/INT/BIGINT and converting from FLOAT/DOUBLE to TIMESTAMP were inconsistent. The value of a BOOLEAN/TINYINT/SMALLINT/INT/BIGINT was treated as the time in milliseconds while  the value of a FLOAT/DOUBLE was treated as the time in seconds. After the change, all the types during the conversion are interpreted in seconds.&lt;br/&gt;
</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>timestamp</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>