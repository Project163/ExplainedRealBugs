<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:53:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-16061] When hive.async.log.enabled is set to true, some output is not printed to the beeline console</title>
                <link>https://issues.apache.org/jira/browse/HIVE-16061</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Run a hiveserver2 instance &quot;hive --service hiveserver2&quot;.&lt;br/&gt;
Then from another console, connect to hiveserver2 &quot;beeline -u &quot;jdbc:hive2://localhost:10000&quot;&lt;/p&gt;

&lt;p&gt;When you run a MR job like &quot;select t1.key from src t1 join src t2 on t1.key=t2.key&quot;, some of the console logs like MR job info are not printed to the console while it just print to the hiveserver2 console.&lt;/p&gt;

&lt;p&gt;When hive.async.log.enabled is set to false and restarts the HiveServer2, then the output will be printed to the beeline console.&lt;/p&gt;

&lt;p&gt;OperationLog implementation uses the ThreadLocal variable to store associated the log file. When the hive.async.log.enabled is set to true, the logs will be processed by a ThreadPool and  the actual threads from the pool which prints the message won&apos;t be able to access the log file stored in the original thread. &lt;/p&gt;</description>
                <environment></environment>
        <key id="13047079">HIVE-16061</key>
            <summary>When hive.async.log.enabled is set to true, some output is not printed to the beeline console</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aihuaxu">Aihua Xu</assignee>
                                    <reporter username="aihuaxu">Aihua Xu</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Feb 2017 20:01:14 +0000</created>
                <updated>Wed, 23 May 2018 00:00:49 +0000</updated>
                            <resolved>Mon, 3 Apr 2017 20:02:42 +0000</resolved>
                                    <version>2.1.1</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>Logging</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                                                            <comments>
                            <comment id="15889215" author="muxin" created="Wed, 1 Mar 2017 00:39:26 +0000"  >&lt;p&gt;we met and resolved it in issue &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-15821&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-15821&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15890274" author="aihuaxu" created="Wed, 1 Mar 2017 14:32:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=muxin&quot; class=&quot;user-hover&quot; rel=&quot;muxin&quot;&gt;muxin&lt;/a&gt; Thanks for the info. Your analysis makes sense and the direction looks good. Seems we are not printing some info to OperationLog so the client can&apos;t query it.&lt;/p&gt;

&lt;p&gt;Seems you are focusing on a different part of logging in JobDebugger. I tried your patch, seems it&apos;s still not printing MR progress.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;0: jdbc:hive2://localhost:10000&amp;gt; select t1.key from src t1 join src t2 on t1.key=t2.key limit 10;
WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. tez, spark) or using Hive 1.X releases.
+---------+
| t1.key  |
+---------+
| 0       |
| 10      |
+---------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15895036" author="aihuaxu" created="Fri, 3 Mar 2017 21:14:03 +0000"  >&lt;p&gt;The issue is: we are printing the log to server console while we need to print to OperationLog so it will pass to the client. &lt;/p&gt;

&lt;p&gt;Patch-1: create a ClientConsole class and uses the class when we need to pass the info to the client.&lt;/p&gt;</comment>
                            <comment id="15895041" author="aihuaxu" created="Fri, 3 Mar 2017 21:16:03 +0000"  >&lt;p&gt;Verified with beeline. Here is the output in beeline now.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2017-03-03T16:15:16,081 INFO [main] org.apache.hadoop.hive.conf.HiveConf - Found configuration file null
2017-03-03T16:15:17,432 WARN [main] org.apache.hadoop.hive.common.LogUtils - hive-site.xml not found on CLASSPATH
2017-03-03 16:15:17     Starting to launch local task to process map join;      maximum memory = 932184064
2017-03-03 16:15:18     Dump the side-table for tag: 0 with group count: 309 into file: file:/tmp/hive/anonymous/19c9aac1-1992-4061-b6ba-6eb4b9605656/hive_2017-03-03_16-15-12_037_6838673076291140467-1/-local-10004/HashTable-Stage-3/MapJoin-mapfile00--.hashtable
2017-03-03 16:15:18     Uploaded 1 File to: file:/tmp/hive/anonymous/19c9aac1-1992-4061-b6ba-6eb4b9605656/hive_2017-03-03_16-15-12_037_6838673076291140467-1/-local-10004/HashTable-Stage-3/MapJoin-mapfile00--.hashtable (7485 bytes)
2017-03-03 16:15:18     End of local task; Time Taken: 0.555 sec.
Execution completed successfully
MapredLocal task succeeded
Number of reduce tasks is set to 0 since there&apos;s no reduce operator
Starting Job = job_local1477220543_0001, Tracking URL = http://localhost:8080/
Kill Command = /Users/axu/Documents/workspaces/tools/hadoop/hadoop-2.6.0/bin/hadoop job  -kill job_local1477220543_0001
Hadoop job information for Stage-3: number of mappers: 0; number of reducers: 0
2017-03-03 16:15:19,904 Stage-3 map = 0%,  reduce = 0%
Ended Job = job_local1477220543_0001 with errors
Error during job, obtaining debugging information...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15895604" author="hiveqa" created="Sat, 4 Mar 2017 09:33:37 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12855969/HIVE-16061.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12855969/HIVE-16061.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 48 failed/errored test(s), 10281 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestCommandProcessorFactory - did not produce a TEST-*.xml file (likely timed out) (batchId=272)
TestDbTxnManager - did not produce a TEST-*.xml file (likely timed out) (batchId=272)
TestDummyTxnManager - did not produce a TEST-*.xml file (likely timed out) (batchId=272)
TestHiveInputSplitComparator - did not produce a TEST-*.xml file (likely timed out) (batchId=272)
TestIndexType - did not produce a TEST-*.xml file (likely timed out) (batchId=272)
TestSplitFilter - did not produce a TEST-*.xml file (likely timed out) (batchId=272)
org.apache.hadoop.hive.cli.TestBeeLineDriver.testCliDriver[escape_comments] (batchId=229)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[stats_aggregator_error_1] (batchId=68)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[stats_publisher_error_1] (batchId=74)
org.apache.hadoop.hive.cli.TestContribNegativeCliDriver.testCliDriver[case_with_row_sequence] (batchId=226)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[schema_evol_text_vec_table] (batchId=147)
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[avro_non_nullable_union] (batchId=86)
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[create_function_nonexistent_class] (batchId=85)
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[create_function_nonudf_class] (batchId=85)
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[create_unknown_genericudf] (batchId=86)
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[create_unknown_udf_udaf] (batchId=86)
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[dyn_part3] (batchId=85)
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[dyn_part_max] (batchId=85)
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[dyn_part_max_per_node] (batchId=85)
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[dynamic_partitions_with_whitelist] (batchId=86)
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[index_compact_entry_limit] (batchId=85)
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[index_compact_size_limit] (batchId=85)
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[ivyDownload] (batchId=85)
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[stats_aggregator_error_1] (batchId=86)
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[stats_aggregator_error_2] (batchId=86)
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[stats_publisher_error_1] (batchId=86)
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[stats_publisher_error_2] (batchId=85)
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[udf_function_does_not_implement_udf] (batchId=86)
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testCliDriver[udf_nonexistent_resource] (batchId=85)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[vector_between_in] (batchId=119)
org.apache.hadoop.hive.cli.TestSparkNegativeCliDriver.org.apache.hadoop.hive.cli.TestSparkNegativeCliDriver (batchId=231)
org.apache.hive.beeline.TestSchemaTool.testNestedScriptsForDerby (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testNestedScriptsForMySQL (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testNestedScriptsForOracle (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testPostgresFilter (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testSchemaInit (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testSchemaInitDryRun (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testSchemaUpgrade (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testSchemaUpgradeDryRun (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testScriptMultiRowComment (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testScriptWithDelimiter (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testScripts (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testValidateLocations (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testValidateNullValues (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testValidateSchemaTables (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testValidateSchemaVersions (batchId=212)
org.apache.hive.beeline.TestSchemaTool.testValidateSequences (batchId=212)
org.apache.hive.service.cli.operation.TestOperationLoggingLayout.testSwitchLogLayout (batchId=214)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/3936/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/3936/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/3936/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/3936/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-3936/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-3936/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 48 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12855969 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15903235" author="aihuaxu" created="Thu, 9 Mar 2017 15:40:47 +0000"  >&lt;p&gt;patch-2: change LogHelper to output to OperationLog so the console output also output to the beeline client console. We still keep the output to server console since it&apos;s used by HiveCLI. &lt;/p&gt;
</comment>
                            <comment id="15903508" author="hiveqa" created="Thu, 9 Mar 2017 18:05:01 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12857027/HIVE-16061.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12857027/HIVE-16061.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 10 failed/errored test(s), 10335 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_if_expr] (batchId=141)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[auto_join_without_localtask] (batchId=96)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[auto_sortmerge_join_3] (batchId=96)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[date_join1] (batchId=96)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[groupby6_noskew] (batchId=96)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[mapjoin_test_outer] (batchId=96)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[merge2] (batchId=96)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[smb_mapjoin_11] (batchId=96)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[vectorization_9] (batchId=96)
org.apache.hive.service.cli.operation.TestOperationLoggingLayout.testSwitchLogLayout (batchId=215)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/4053/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/4053/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/4053/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/4053/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-4053/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-4053/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 10 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12857027 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15935217" author="aihuaxu" created="Tue, 21 Mar 2017 20:04:24 +0000"  >&lt;p&gt;Please ignore the patches since technically we should not call OperationLog.write() directly as I understand the original design. DivertLogAppender should handle the message append to the operation log file which will be read by the beeline.&lt;/p&gt;

&lt;p&gt;+ &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt;  log4j expert and you worked on the log4j2 for hive. &lt;/p&gt;



</comment>
                            <comment id="15935256" author="prasanth_j" created="Tue, 21 Mar 2017 20:25:03 +0000"  >&lt;p&gt;This was observed earlier in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-14183&quot; title=&quot;hive 2.1.0 beeline cannot show verbose log&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-14183&quot;&gt;HIVE-14183&lt;/a&gt;. Ideally, we want to use MDC based log redirection to operation log files and move away from the current threadlocal because of the exact issue you had mentioned. MDC based routing is safe in the context of Async logger and we currently use it in LLAP. &lt;/p&gt;</comment>
                            <comment id="15935272" author="aihuaxu" created="Tue, 21 Mar 2017 20:30:33 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt;  Agree. I was checking MDC related and RoutingAppender as well. Can you point me the code in LLAP which uses MDC based routing?  &lt;/p&gt;</comment>
                            <comment id="15935315" author="prasanth_j" created="Tue, 21 Mar 2017 20:52:48 +0000"  >&lt;p&gt;&lt;b&gt;Configuration:&lt;/b&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/hive/blob/master/llap-server/src/main/resources/llap-daemon-log4j2.properties#L79-L100&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/blob/master/llap-server/src/main/resources/llap-daemon-log4j2.properties#L79-L100&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;MDC put for new threads:&lt;/b&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/hive/blob/master/llap-server/src/java/org/apache/hadoop/hive/llap/io/api/impl/LlapRecordReader.java#L108-L111&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/blob/master/llap-server/src/java/org/apache/hadoop/hive/llap/io/api/impl/LlapRecordReader.java#L108-L111&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;MDC put/reset for threadpools (cache/reuse of threads):&lt;/b&gt;&lt;br/&gt;
This is required for inheriting MDC when new threads are spawned.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/hive/blob/master/llap-server/src/java/org/apache/hadoop/hive/llap/daemon/impl/LlapDaemon.java#L336&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/blob/master/llap-server/src/java/org/apache/hadoop/hive/llap/daemon/impl/LlapDaemon.java#L336&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;For the case where a threadpool already exists and MDC has to be inherited (in case of cached thread pools or core thread reuse), we use custom threadpool that copies the IDs to MDC and clears it after executing the thread. There is some reflection happening in custom threadpool (NDC to MDC copying) which is LLAP specific and is not required for HS2.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/hive/blob/master/llap-server/src/java/org/apache/hadoop/hive/llap/daemon/impl/StatsRecordingThreadPool.java#L108-L149&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/blob/master/llap-server/src/java/org/apache/hadoop/hive/llap/daemon/impl/StatsRecordingThreadPool.java#L108-L149&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15935321" author="aihuaxu" created="Tue, 21 Mar 2017 20:55:25 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt; I will take a look.&lt;/p&gt;</comment>
                            <comment id="15949391" author="aihuaxu" created="Thu, 30 Mar 2017 16:49:53 +0000"  >&lt;p&gt;patch-3: switching to use Log4j2 RoutingAppender to automatically output the log for each query into each individual file (operation log) and then it will be picked up and delivered to the beeline. One change which is different from existing OperationLog: the operation log file name now is /sessionId/queryId instead of /sessionId/operationHandle. Seems it&apos;s better to use queryId since operationHandle is completely internal and also we are using queryId in the other log places. &lt;/p&gt;
</comment>
                            <comment id="15949505" author="hiveqa" created="Thu, 30 Mar 2017 17:53:57 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12861269/HIVE-16061.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12861269/HIVE-16061.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 6 failed/errored test(s), 10540 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestBeeLineDriver.testCliDriver[drop_with_concurrency] (batchId=231)
org.apache.hadoop.hive.cli.TestBeeLineDriver.testCliDriver[escape_comments] (batchId=231)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[comments] (batchId=35)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_if_expr] (batchId=141)
org.apache.hive.hcatalog.api.TestHCatClient.testTransportFailure (batchId=172)
org.apache.hive.service.cli.operation.TestOperationLoggingLayout.testSwitchLogLayout (batchId=216)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/4467/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/4467/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/4467/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/4467/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-4467/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-4467/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 6 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12861269 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15949831" author="aihuaxu" created="Thu, 30 Mar 2017 21:08:20 +0000"  >&lt;p&gt;patch-4: Address the comments and fix the unit test failures.&lt;/p&gt;

&lt;p&gt;from the test, I noticed that before switching operation log level (execution, verbose ...) in runtime would also change change the layout format, not only changing the output content. But now we can&apos;t support that since the layout is initialized during the appender initialization, but it&apos;s the same for the logging (console, or file logging), so I guess it&apos;s OK.&lt;/p&gt;

</comment>
                            <comment id="15950283" author="hiveqa" created="Fri, 31 Mar 2017 03:57:50 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12861332/HIVE-16061.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12861332/HIVE-16061.4.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 10540 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[comments] (batchId=35)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[vector_if_expr] (batchId=141)
org.apache.hive.hcatalog.api.TestHCatClient.testTransportFailure (batchId=172)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/4478/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/4478/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/4478/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/4478/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-4478/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-4478/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12861332 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15952898" author="ctang.ma" created="Mon, 3 Apr 2017 00:13:39 +0000"  >&lt;p&gt;LGTM, +1&lt;/p&gt;</comment>
                            <comment id="15954078" author="aihuaxu" created="Mon, 3 Apr 2017 20:02:42 +0000"  >&lt;p&gt;Pushed to master. Thanks Chaoyu and Peter for reviewing.&lt;/p&gt;</comment>
                            <comment id="16486470" author="vgarg" created="Wed, 23 May 2018 00:00:49 +0000"  >&lt;p&gt;Hive 3.0.0 has been released so closing this jira.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13049262">HIVE-16146</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13059851">HIVE-16320</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12855969" name="HIVE-16061.1.patch" size="16813" author="aihuaxu" created="Fri, 3 Mar 2017 21:09:03 +0000"/>
                            <attachment id="12857027" name="HIVE-16061.2.patch" size="2068" author="aihuaxu" created="Thu, 9 Mar 2017 15:38:37 +0000"/>
                            <attachment id="12861269" name="HIVE-16061.3.patch" size="47788" author="aihuaxu" created="Thu, 30 Mar 2017 16:42:24 +0000"/>
                            <attachment id="12861332" name="HIVE-16061.4.patch" size="94798" author="aihuaxu" created="Thu, 30 Mar 2017 21:01:46 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="13062160">HIVE-16400</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ar0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>