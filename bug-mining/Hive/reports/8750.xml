<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:26:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-28564] AssertionError for jdbc queries when JDBCExpandExpressionsRule produces non flat Filter conditions</title>
                <link>https://issues.apache.org/jira/browse/HIVE-28564</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;To repro this, create four tpcds table in postgres by copying &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13072063/13072063_q_test_tpcds_tables_schema.postgres.sql&quot; title=&quot;q_test_tpcds_tables_schema.postgres.sql attached to HIVE-28564&quot;&gt;q_test_tpcds_tables_schema.postgres.sql&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; to &lt;tt&gt;hive/data/scripts/&lt;/tt&gt; directory.&lt;/p&gt;

&lt;p&gt;Add &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13072062/13072062_jdbc_non_flat_filter_condition.q&quot; title=&quot;jdbc_non_flat_filter_condition.q attached to HIVE-28564&quot;&gt;jdbc_non_flat_filter_condition.q&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; to &lt;tt&gt;ql/src/test/queries/clientpositive/&lt;/tt&gt;&#160;and run&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;mvn test -pl itests/qtest &#160;-Pitests -Dtest=TestMiniLlapLocalCliDriver -Dtest.output.overwrite=true -Dqfile=jdbc_non_flat_filter_condition.q&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Error stack:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[INFO] Running org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver
[ERROR] Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 15.238 s &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver
[ERROR] org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[jdbc_non_flat_filter_condition] &#160;Time elapsed: 8.409 s &#160;&amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError: AND(IN($1, 2000, 1999, 2001), OR(=($1, 2000), OR(AND(=($1, 1999), =($2, 12)), AND(=($1, 2001), =($2, 1)))), IS NOT NULL($0))
&#160; &#160; at org.apache.calcite.rel.core.Filter.&amp;lt;init&amp;gt;(Filter.java:76)
&#160; &#160; at org.apache.calcite.adapter.jdbc.JdbcRules$JdbcFilter.&amp;lt;init&amp;gt;(JdbcRules.java:629)
&#160; &#160; at org.apache.calcite.adapter.jdbc.JdbcRules$JdbcFilter.copy(JdbcRules.java:635)
&#160; &#160; at org.apache.hadoop.hive.ql.optimizer.calcite.rules.jdbc.JDBCExpandExpressionsRule$FilterCondition.onMatch(JDBCExpandExpressionsRule.java:85)
&#160; &#160; at org.apache.calcite.plan.AbstractRelOptPlanner.fireRule(AbstractRelOptPlanner.java:333)
&#160; &#160; at org.apache.calcite.plan.hep.HepPlanner.applyRule(HepPlanner.java:542)
&#160; &#160; at org.apache.calcite.plan.hep.HepPlanner.applyRules(HepPlanner.java:407)
&#160; &#160; at org.apache.calcite.plan.hep.HepPlanner.executeInstruction(HepPlanner.java:271)
&#160; &#160; at org.apache.calcite.plan.hep.HepInstruction$RuleCollection.execute(HepInstruction.java:74)
&#160; &#160; at org.apache.calcite.plan.hep.HepPlanner.executeProgram(HepPlanner.java:202)
&#160; &#160; at org.apache.calcite.plan.hep.HepPlanner.findBestExp(HepPlanner.java:189)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.CalcitePlanner$CalcitePlannerAction.executeProgram(CalcitePlanner.java:2469)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.CalcitePlanner$CalcitePlannerAction.executeProgram(CalcitePlanner.java:2428)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.CalcitePlanner$CalcitePlannerAction.applyPostJoinOrderingTransform(CalcitePlanner.java:2347)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.CalcitePlanner$CalcitePlannerAction.apply(CalcitePlanner.java:1739)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.CalcitePlanner$CalcitePlannerAction.apply(CalcitePlanner.java:1573)
&#160; &#160; at org.apache.calcite.tools.Frameworks.lambda$withPlanner$0(Frameworks.java:131)
&#160; &#160; at org.apache.calcite.prepare.CalcitePrepareImpl.perform(CalcitePrepareImpl.java:914)
&#160; &#160; at org.apache.calcite.tools.Frameworks.withPrepare(Frameworks.java:180)
&#160; &#160; at org.apache.calcite.tools.Frameworks.withPlanner(Frameworks.java:126)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.CalcitePlanner.logicalPlan(CalcitePlanner.java:1325)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.CalcitePlanner.genOPTree(CalcitePlanner.java:573)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.analyzeInternal(SemanticAnalyzer.java:13164)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.CalcitePlanner.analyzeInternal(CalcitePlanner.java:466)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:332)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.ExplainSemanticAnalyzer.analyzeInternal(ExplainSemanticAnalyzer.java:180)
&#160; &#160; at org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:332)
&#160; &#160; at org.apache.hadoop.hive.ql.Compiler.analyze(Compiler.java:224)
&#160; &#160; at org.apache.hadoop.hive.ql.Compiler.compile(Compiler.java:109)
&#160; &#160; at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:499)
&#160; &#160; at org.apache.hadoop.hive.ql.Driver.compileInternal(Driver.java:451)
&#160; &#160; at org.apache.hadoop.hive.ql.Driver.compileAndRespond(Driver.java:415)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;In non jdbc Hive query (&lt;a href=&quot;https://github.com/apache/hive/blob/6f7c55ab9bc4fd7c3d0c2a6ba3095275b17b3d2d/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query47.q.out#L59&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cbo_query47.q.out&lt;/a&gt;), the condition is:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;AND(IN($6, 2000, 1999, 2001), OR(=($6, 2000), IN(ROW($6, $8), ROW(1999, 12), ROW(2001, 1))))&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hive/blob/6f7c55ab9bc4fd7c3d0c2a6ba3095275b17b3d2d/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/jdbc/JDBCExpandExpressionsRule.java#L209&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JDBCExpandExpressionsRule&lt;/a&gt; converts it to:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;AND(IN($1, 2000, 1999, 2001), OR(=($1, 2000), OR(AND(=($1, 1999), =($2, 12)), AND(=($1, 2001), =($2, 1)))), IS NOT NULL($0))&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which is not flat as there is an OR within an OR which can be simplified using &lt;tt&gt;RexSimplify&lt;/tt&gt; to:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;AND(OR(=($1, 2000), AND(=($1, 1999), =($2, 12)), AND(=($1, 2001), =($2, 1))), IN($1, 2000, 1999, 2001), IS NOT NULL($0))&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This can also be reproduced with:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;--! qt:database:postgres:q_test_book_table.sql

CREATE EXTERNAL TABLE book (id int, title varchar(100), author int)
STORED BY &apos;org.apache.hive.storage.jdbc.JdbcStorageHandler&apos;
TBLPROPERTIES (
    &quot;hive.sql.database.type&quot; = &quot;POSTGRES&quot;,
    &quot;hive.sql.jdbc.driver&quot; = &quot;org.postgresql.Driver&quot;,
    &quot;hive.sql.jdbc.url&quot; = &quot;jdbc:postgresql://localhost:5432/qtestDB&quot;,
    &quot;hive.sql.dbcp.username&quot; = &quot;qtestuser&quot;,
    &quot;hive.sql.dbcp.password&quot; = &quot;qtestpassword&quot;,
    &quot;hive.sql.table&quot; = &quot;book&quot;);

explain cbo
select * from book 
where id = 0 or (id = 1 and author = 11) or (id = 2 and author = 22);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13594711">HIVE-28564</key>
            <summary>AssertionError for jdbc queries when JDBCExpandExpressionsRule produces non flat Filter conditions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="soumyakanti.das">Soumyakanti Das</assignee>
                                    <reporter username="soumyakanti.das">Soumyakanti Das</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 8 Oct 2024 23:01:02 +0000</created>
                <updated>Tue, 29 Jul 2025 14:51:38 +0000</updated>
                            <resolved>Mon, 21 Oct 2024 09:29:26 +0000</resolved>
                                    <version>4.1.0</version>
                                    <fixVersion>4.1.0</fixVersion>
                                    <component>CBO</component>
                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17891461" author="zabetak" created="Mon, 21 Oct 2024 09:29:26 +0000"  >&lt;p&gt;Fixed in &lt;a href=&quot;https://github.com/apache/hive/commit/b2a5933c0f396ade25273ac75cbf35e205969b21&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/commit/b2a5933c0f396ade25273ac75cbf35e205969b21&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Thanks for the PR &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=soumyakanti.das&quot; class=&quot;user-hover&quot; rel=&quot;soumyakanti.das&quot;&gt;soumyakanti.das&lt;/a&gt; !&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13072062" name="jdbc_non_flat_filter_condition.q" size="6444" author="soumyakanti.das" created="Tue, 8 Oct 2024 22:44:25 +0000"/>
                            <attachment id="13072063" name="q_test_tpcds_tables_schema.postgres.sql" size="2482" author="soumyakanti.das" created="Tue, 8 Oct 2024 22:41:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 3 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1rv54:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>