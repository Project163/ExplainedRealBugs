<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:31:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-9976] Possible race condition in DynamicPartitionPruner for &lt;200ms tasks</title>
                <link>https://issues.apache.org/jira/browse/HIVE-9976</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Race condition in the DynamicPartitionPruner between DynamicPartitionPruner::processVertex() and DynamicPartitionpruner::addEvent() for tasks which respond with both the result and success in a single heartbeat sequence.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2015-03-16 07:05:01,589 ERROR [InputInitializer [Map 1] #0] tez.DynamicPartitionPruner: Expecting: 1, received: 0
2015-03-16 07:05:01,590 ERROR [Dispatcher thread: Central] impl.VertexImpl: Vertex Input: store_sales initializer failed, vertex=vertex_1424502260528_1113_4_04 [Map 1]
org.apache.tez.dag.app.dag.impl.AMUserCodeException: org.apache.hadoop.hive.ql.metadata.HiveException: Incorrect event count in dynamic parition pruning
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12704791/12704791_llap_vertex_200ms.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;All 4 upstream vertices of Map 1 need to finish within ~200ms to trigger this, which seems to be consistently happening with LLAP.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12782225">HIVE-9976</key>
            <summary>Possible race condition in DynamicPartitionPruner for &lt;200ms tasks</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sseth">Siddharth Seth</assignee>
                                    <reporter username="gopalv">Gopal Vijayaraghavan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Mar 2015 15:04:43 +0000</created>
                <updated>Mon, 18 May 2015 19:51:02 +0000</updated>
                            <resolved>Thu, 26 Mar 2015 06:10:22 +0000</resolved>
                                    <version>1.0.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>Tez</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14363839" author="hagleitn" created="Mon, 16 Mar 2015 20:21:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sseth&quot; class=&quot;user-hover&quot; rel=&quot;sseth&quot;&gt;sseth&lt;/a&gt; I thought this can&apos;t happen. The Tez API was supposed to guarantee delivery of events before completion. Should I open a Tez issue?&lt;/p&gt;</comment>
                            <comment id="14363909" author="sseth" created="Mon, 16 Mar 2015 20:50:51 +0000"  >&lt;p&gt;I&apos;ll take a look. Assuming this was run with Tez 0.7 snapshot ?&lt;/p&gt;</comment>
                            <comment id="14364039" author="hagleitn" created="Mon, 16 Mar 2015 21:54:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gopalv&quot; class=&quot;user-hover&quot; rel=&quot;gopalv&quot;&gt;gopalv&lt;/a&gt; said that it was on tez 0.7.&lt;/p&gt;</comment>
                            <comment id="14378766" author="sseth" created="Tue, 24 Mar 2015 22:13:10 +0000"  >&lt;p&gt;This is not limited to LLAP. Assigning to myself - to change the handling of vertex success / init events.&lt;/p&gt;</comment>
                            <comment id="14378786" author="sseth" created="Tue, 24 Mar 2015 22:22:20 +0000"  >&lt;p&gt;Patch to handle out of order events. Also initializes the pruner during Input construction - so that events don&apos;t show up before the pruner is initialized. Adds a bunch of tests.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hagleitn&quot; class=&quot;user-hover&quot; rel=&quot;hagleitn&quot;&gt;hagleitn&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vikram.dixit&quot; class=&quot;user-hover&quot; rel=&quot;vikram.dixit&quot;&gt;vikram.dixit&lt;/a&gt; - please review.&lt;/p&gt;</comment>
                            <comment id="14379185" author="hiveqa" created="Wed, 25 Mar 2015 02:40:31 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12707029/HIVE-9976.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12707029/HIVE-9976.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 1 failed/errored test(s), 8347 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_schemeAuthority
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3139/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3139/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3139/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3139/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-3139/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-3139/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12707029 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14380407" author="hagleitn" created="Wed, 25 Mar 2015 18:20:52 +0000"  >&lt;p&gt;Not your fault - but there are 2 paths through HiveSplitGenerator. The class is used once without calling init and once being properly init&apos;d. The reason is that some other code needs to use the &quot;group splits&quot; method. Since you&apos;ve moved init to the constr now, this has gotten even uglier. Could you move the split grouper methods to a separate util class (static) and leave the pruner to just prune.&lt;/p&gt;

&lt;p&gt;Also - I think you&apos;ve moved the initialization of the dynamic pruner to the constr of the input initializer, in order to not miss any events. Can you add a comment to the code explaining this?&lt;/p&gt;

&lt;p&gt;Very cool to see a real unit test  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; thanks.&lt;/p&gt;</comment>
                            <comment id="14380426" author="hagleitn" created="Wed, 25 Mar 2015 18:27:23 +0000"  >&lt;p&gt;i see you&apos;ve fixed calling close consistently on the data input stream. maybe use try{}finally there?&lt;/p&gt;</comment>
                            <comment id="14380438" author="hagleitn" created="Wed, 25 Mar 2015 18:30:40 +0000"  >&lt;p&gt;it seems you&apos;re setting numexpectedevents to 0 first and then turn around and call decrement. Why not just set to -1? Also - why atomic integers? as far as i can tell all access to these maps is synchronized.&lt;/p&gt;</comment>
                            <comment id="14380446" author="hagleitn" created="Wed, 25 Mar 2015 18:34:21 +0000"  >&lt;p&gt;does it make sense to make initialize in the pruner private now? (can&apos;t be used to init anymore - only from the constr). Also, the parameters aren&apos;t used anymore, right?&lt;/p&gt;</comment>
                            <comment id="14380451" author="hagleitn" created="Wed, 25 Mar 2015 18:36:02 +0000"  >&lt;p&gt;other than the above looks good to me. like the extra comments and conditions you&apos;ve put in!&lt;/p&gt;</comment>
                            <comment id="14380683" author="sseth" created="Wed, 25 Mar 2015 20:20:51 +0000"  >&lt;p&gt;Thanks for the review. Updated patch with comments addressed, and some more changes.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Not your fault - but there are 2 paths through HiveSplitGenerator.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Moved the methods into SplitGrouper. There&apos;s a static cache in there which seems a little strange. Will create a follow up jira to investigate this. For now I&apos;ve changed that to a ConcurrentMap since split generation can run in parallel.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;i see you&apos;ve fixed calling close consistently on the data input stream. maybe use try{}finally there?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Fixed. There was a bug with some of the other conditions which I&apos;d changed. Fixed that as well.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;it seems you&apos;re setting numexpectedevents to 0 first and then turn around and call decrement. Why not just set to -1? Also - why atomic integers? as far as i can tell all access to these maps is synchronized.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;numExpectedEvents is decremented for each column for which a source will send events. That&apos;s used to track total number of expected events from that source. Added a comment for this.&lt;br/&gt;
Moved from AtomicIntegers to MutableInt - this was just to avoid re-inserting the Integer into the map, and not for thread safety.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;does it make sense to make initialize in the pruner private now? (can&apos;t be used to init anymore - only from the constr). Also, the parameters aren&apos;t used anymore, right?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Done, along with some other methods.&lt;/p&gt;</comment>
                            <comment id="14380740" author="hagleitn" created="Wed, 25 Mar 2015 20:49:30 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14381320" author="hiveqa" created="Thu, 26 Mar 2015 04:04:39 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12707303/HIVE-9976.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12707303/HIVE-9976.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 8347 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3159/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3159/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3159/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3159/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-3159/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-3159/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12707303 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14381434" author="hagleitn" created="Thu, 26 Mar 2015 06:10:22 +0000"  >&lt;p&gt;Committed to trunk. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sseth&quot; class=&quot;user-hover&quot; rel=&quot;sseth&quot;&gt;sseth&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="14548766" author="sushanth" created="Mon, 18 May 2015 19:51:02 +0000"  >&lt;p&gt;This issue has been fixed and released as part of the 1.2.0 release. If you find an issue which seems to be related to this one, please create a new jira and link this one with new jira.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12707029" name="HIVE-9976.1.patch" size="35487" author="sseth" created="Tue, 24 Mar 2015 22:22:20 +0000"/>
                            <attachment id="12707303" name="HIVE-9976.2.patch" size="53589" author="sseth" created="Wed, 25 Mar 2015 20:20:51 +0000"/>
                            <attachment id="12704791" name="llap_vertex_200ms.png" size="14595" author="gopalv" created="Mon, 16 Mar 2015 15:06:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 27 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i26t73:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>