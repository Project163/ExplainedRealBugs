<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:18:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-24342] isPathEncrypted should make sure resolved path also from HDFS</title>
                <link>https://issues.apache.org/jira/browse/HIVE-24342</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Currently&#160;isPathEncrypted will make sure path is from hdfs by checking the path scheme is &quot;hdfs&quot;&lt;/p&gt;

&lt;p&gt;In the case if mounted ViewFileSystem based files systems like ViewFSOverloadScheme or ViewHDFS (&lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-15289&quot; title=&quot;Allow viewfs mounts with HDFS/HCFS scheme and centralized mount table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-15289&quot;&gt;HDFS-15289&lt;/a&gt;) may need o check resolved path is really hdfs.&lt;/p&gt;

&lt;p&gt;In ViewHDFS case, we can mount hdfs://ns1/test ---&amp;gt; o3fs://b.v.ozone1/test&lt;/p&gt;

&lt;p&gt;When user calling queries with the path&#160;hdfs://ns1/test,&#160;isPathEncrypted will think the path is from hdfs only as its checking path scheme.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
0: jdbc:hive2:&lt;span class=&quot;code-comment&quot;&gt;//umag-1.umag.root.xxx.site:218&amp;gt; select * from test30;
&lt;/span&gt;Error: Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; compiling statement: FAILED: SemanticException Unable to determine &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; hdfs:&lt;span class=&quot;code-comment&quot;&gt;//ns1/test is encrypted: java.lang.UnsupportedOperationException: This API:getEZForPath is specific to DFS. Can&apos;t run on other fs:o3fs://bucket.volume.ozone1 (state=42000,code=40000)
&lt;/span&gt;0: jdbc:hive2:&lt;span class=&quot;code-comment&quot;&gt;//umag-1.umag.root.xxx.site:218&amp;gt; cd Closing: 0: jdbc:hive2://umag-1.umag.root.xxx.site:2181,umag-2.umag.root.xxx.site:2181,umag-5.umag.root.xxx.site:2181/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;;password=root;principal=hive/umag-5.umag.root.xxx.site@ROOT.HWX.SITE;retries=5;serviceDiscoveryMode=zooKeeper;user=root;zooKeeperNamespace=hiveserver2&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;So, here we should use resolvePath to make sure the resolved path really in hdfs. If the resolved path is not from hdfs (in above case, it o3fs path), then it will return false.&lt;/p&gt;

&lt;p&gt;After fixing this, the query is passing.:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
0: jdbc:hive2:&lt;span class=&quot;code-comment&quot;&gt;//umag-1.umag.root.xxx.site:218&amp;gt; select * from test30;
&lt;/span&gt;INFO&#160; : Compiling command(queryId=hive_20201031002253_1691548f-6fa8-4ea9-9cd4-87b70fe8f6bb): select * from test30
INFO&#160; : No Stats &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;@test30, Columns: item, user_id, state, order_id
INFO&#160; : Semantic Analysis Completed (retrial = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
INFO&#160; : Created Hive schema: Schema(fieldSchemas:[FieldSchema(name:test30.order_id, type:bigint, comment:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;), FieldSchema(name:test30.user_id, type:string, comment:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;), FieldSchema(name:test30.item, type:string, comment:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;), FieldSchema(name:test30.state, type:string, comment:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)], properties:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
INFO&#160; : Completed compiling command(queryId=hive_20201031002253_1691548f-6fa8-4ea9-9cd4-87b70fe8f6bb); Time taken: 4.47 seconds
INFO&#160; : Executing command(queryId=hive_20201031002253_1691548f-6fa8-4ea9-9cd4-87b70fe8f6bb): select * from test30
INFO&#160; : Completed executing command(queryId=hive_20201031002253_1691548f-6fa8-4ea9-9cd4-87b70fe8f6bb); Time taken: 0.09 seconds
INFO&#160; : OK
+------------------+-----------------+--------------+---------------+
| test30.order_id&#160; | test30.user_id&#160; | test30.item&#160; | test30.state&#160; |
+------------------+-----------------+--------------+---------------+
| 1234 &#160; &#160; &#160; &#160; &#160; &#160; | u1&#160; &#160; &#160; &#160; &#160; &#160; &#160; | iphone7&#160; &#160; &#160; | CA&#160; &#160; &#160; &#160; &#160; &#160; |
| 2345 &#160; &#160; &#160; &#160; &#160; &#160; | u1&#160; &#160; &#160; &#160; &#160; &#160; &#160; | ipad &#160; &#160; &#160; &#160; | CA&#160; &#160; &#160; &#160; &#160; &#160; |
| 3456 &#160; &#160; &#160; &#160; &#160; &#160; | u2&#160; &#160; &#160; &#160; &#160; &#160; &#160; | desktop&#160; &#160; &#160; | NY&#160; &#160; &#160; &#160; &#160; &#160; |
&#160;
&#160;
+------------------+-----------------+--------------+---------------+
11 rows selected (6.975 seconds)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13338228">HIVE-24342</key>
            <summary>isPathEncrypted should make sure resolved path also from HDFS</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="umamaheswararao">Uma Maheswara Rao G</assignee>
                                    <reporter username="umamaheswararao">Uma Maheswara Rao G</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sat, 31 Oct 2020 21:25:20 +0000</created>
                <updated>Fri, 8 Mar 2024 08:41:15 +0000</updated>
                            <resolved>Wed, 4 Nov 2020 07:26:29 +0000</resolved>
                                    <version>3.1.2</version>
                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                                    <component>HiveServer2</component>
                    <component>Shims</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4200">1h 10m</timespent>
                                <comments>
                            <comment id="17224193" author="umamaheswararao" created="Sat, 31 Oct 2020 21:28:15 +0000"  >&lt;p&gt;Here is the full trace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[e0a63527-ef51-40fa-9644-e08db4a310ce HiveServer2-Handler-Pool: &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-3468]: FAILED: SemanticException Unable to determine &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; hdfs:&lt;span class=&quot;code-comment&quot;&gt;//ns1/test is encrypted: java.lang.UnsupportedOperationException: This API:getEZForPath is specific to DFS. Can&apos;t run on other fs:o3fs://bucket.volume.ozone1
&lt;/span&gt;org.apache.hadoop.hive.ql.parse.SemanticException: Unable to determine &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; hdfs:&lt;span class=&quot;code-comment&quot;&gt;//ns1/test is encrypted: java.lang.UnsupportedOperationException: This API:getEZForPath is specific to DFS. Can&apos;t run on other fs:o3fs://bucket.volume.ozone1
&lt;/span&gt;	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.getMetaData(SemanticAnalyzer.java:2078)
	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.genResolvedParseTree(SemanticAnalyzer.java:12540)
	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.analyzeInternal(SemanticAnalyzer.java:12634)
	at org.apache.hadoop.hive.ql.parse.CalcitePlanner.analyzeInternal(CalcitePlanner.java:428)
	at org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:288)
	at org.apache.hadoop.hive.ql.&lt;span class=&quot;code-object&quot;&gt;Compiler&lt;/span&gt;.analyze(&lt;span class=&quot;code-object&quot;&gt;Compiler&lt;/span&gt;.java:221)
	at org.apache.hadoop.hive.ql.&lt;span class=&quot;code-object&quot;&gt;Compiler&lt;/span&gt;.compile(&lt;span class=&quot;code-object&quot;&gt;Compiler&lt;/span&gt;.java:104)
	at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:188)
	at org.apache.hadoop.hive.ql.Driver.compileInternal(Driver.java:600)
	at org.apache.hadoop.hive.ql.Driver.compileAndRespond(Driver.java:546)
	at org.apache.hadoop.hive.ql.Driver.compileAndRespond(Driver.java:540)
	at org.apache.hadoop.hive.ql.reexec.ReExecDriver.compileAndRespond(ReExecDriver.java:127)
	at org.apache.hive.service.cli.operation.SQLOperation.prepare(SQLOperation.java:199)
	at org.apache.hive.service.cli.operation.SQLOperation.runInternal(SQLOperation.java:260)
	at org.apache.hive.service.cli.operation.Operation.run(Operation.java:274)
	at org.apache.hive.service.cli.session.HiveSessionImpl.executeStatementInternal(HiveSessionImpl.java:565)
	at org.apache.hive.service.cli.session.HiveSessionImpl.executeStatementAsync(HiveSessionImpl.java:551)
	at org.apache.hive.service.cli.CLIService.executeStatementAsync(CLIService.java:315)
	at org.apache.hive.service.cli.thrift.ThriftCLIService.ExecuteStatement(ThriftCLIService.java:567)
	at org.apache.hive.service.rpc.thrift.TCLIService$Processor$ExecuteStatement.getResult(TCLIService.java:1557)
	at org.apache.hive.service.rpc.thrift.TCLIService$Processor$ExecuteStatement.getResult(TCLIService.java:1542)
	at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:39)
	at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:39)
	at org.apache.hadoop.hive.metastore.security.HadoopThriftAuthBridge$Server$TUGIAssumingProcessor.process(HadoopThriftAuthBridge.java:654)
	at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:286)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
Caused by: org.apache.hadoop.hive.ql.metadata.HiveException: Unable to determine &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; hdfs:&lt;span class=&quot;code-comment&quot;&gt;//ns1/test is encrypted: java.lang.UnsupportedOperationException: This API:getEZForPath is specific to DFS. Can&apos;t run on other fs:o3fs://bucket.volume.ozone1
&lt;/span&gt;	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.isPathEncrypted(SemanticAnalyzer.java:2447)
	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.getStrongestEncryptedTablePath(SemanticAnalyzer.java:2523)
	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.getStagingDirectoryPathname(SemanticAnalyzer.java:2556)
	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.getMetaData(SemanticAnalyzer.java:2369)
	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.getMetaData(SemanticAnalyzer.java:2070)
	... 27 more
Caused by: java.lang.UnsupportedOperationException: This API:getEZForPath is specific to DFS. Can&apos;t run on other fs:o3fs:&lt;span class=&quot;code-comment&quot;&gt;//bucket.volume.ozone1
&lt;/span&gt;	at org.apache.hadoop.hdfs.ViewDistributedFileSystem.checkDFS(ViewDistributedFileSystem.java:397)
	at org.apache.hadoop.hdfs.ViewDistributedFileSystem.getEZForPath(ViewDistributedFileSystem.java:1605)
	at org.apache.hadoop.hdfs.client.HdfsAdmin.getEncryptionZoneForPath(HdfsAdmin.java:375)
	at org.apache.hadoop.hive.shims.Hadoop23Shims$HdfsEncryptionShim.getEncryptionZoneForPath(Hadoop23Shims.java:1238)
	at org.apache.hadoop.hive.shims.Hadoop23Shims$HdfsEncryptionShim.isPathEncrypted(Hadoop23Shims.java:1233)
	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.isPathEncrypted(SemanticAnalyzer.java:2442)
	... 31 more&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17225905" author="umamaheswararao" created="Wed, 4 Nov 2020 07:26:29 +0000"  >&lt;p&gt;This has been merged into master!&lt;/p&gt;</comment>
                            <comment id="17824661" author="JIRAUSER302593" created="Fri, 8 Mar 2024 08:41:15 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=umamaheswararao&quot; class=&quot;user-hover&quot; rel=&quot;umamaheswararao&quot;&gt;umamaheswararao&lt;/a&gt;,&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://blog.cloudera.com/global-view-distributed-file-system-with-mount-points/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://blog.cloudera.com/global-view-distributed-file-system-with-mount-points/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I have been referring to the above article of yours and testing hive operations with hdfs and s3 using viewfs overload scheme.&lt;/p&gt;

&lt;p&gt;However, without encryption enabled, Hive insert into fails during hive staging with below error:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Error: Error while processing statement: FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.MoveTask. Unable to move source hdfs://s3cluster/warehouse/tablespace/external/hive/test_tablehdfs/state=CA/.hive-staging_hive_2024-02-23_10-20-55_735_9094747688901732278-1/-ext-10002 to destination hdfs://s3cluster/warehouse/tablespace/external/hive/test_tablehdfs/state=CA/.hive-staging_hive_2024-02-23_10-20-55_735_9094747688901732278-1/-ext-10000 (state=,code=0)&lt;/p&gt;

&lt;p&gt;Caused by: java.io.FileNotFoundException: File does not exist: /warehouse/tablespace/external/hive/test_tablehdfs/state=CA/.hive-staging_hive_2024-02-23_10-20-55_735_9094747688901732278-1/-ext-10000&lt;br/&gt;
&#160; &#160; &#160; &#160; at org.apache.hadoop.hdfs.DistributedFileSystem$29.doCall(DistributedFileSystem.java:1833)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;isPathEncrypted call in needToCopy (in Hive.java), leads to resolvePath call which checks for file existence even for dest file hence the error thrown. In HDFS, rename strategy is used to move files during hive staging.&#160;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13299780">HDFS-15289</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 35 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0k6hk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12346277">3.1.3</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>