<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:28:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-9141] HiveOnTez: mix of union all, distinct, group by generates error</title>
                <link>https://issues.apache.org/jira/browse/HIVE-9141</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Here is the way to produce it:&lt;br/&gt;
in Hive q test setting (with src table)&lt;br/&gt;
set hive.execution.engine=tez;&lt;/p&gt;

&lt;p&gt;SELECT key, value FROM&lt;br/&gt;
  (&lt;br/&gt;
  	SELECT key, value FROM src&lt;/p&gt;

&lt;p&gt;    UNION ALL&lt;/p&gt;

&lt;p&gt;  	SELECT key, key as value FROM &lt;/p&gt;

&lt;p&gt;  		(  &lt;br/&gt;
  		    SELECT distinct key FROM (&lt;/p&gt;

&lt;p&gt;      		SELECT key, value FROM&lt;br/&gt;
      		(SELECT key, value FROM src&lt;br/&gt;
        		UNION ALL&lt;br/&gt;
      		SELECT key, value FROM src&lt;br/&gt;
      		)t1 &lt;br/&gt;
      		group by  key, value&lt;br/&gt;
      		)t2&lt;br/&gt;
        )t3 &lt;/p&gt;

&lt;p&gt;   )t4&lt;br/&gt;
   group by  key, value;&lt;/p&gt;

&lt;p&gt;will generate&lt;/p&gt;

&lt;p&gt;2014-12-16 23:19:13,593 ERROR ql.Driver (SessionState.java:printError(834)) - FAILED: ClassCastException org.apache.hadoop.hive.ql.plan.MapWork cannot be cast to org.apache.hadoop.hive.ql.plan.ReduceWork&lt;br/&gt;
java.lang.ClassCastException: org.apache.hadoop.hive.ql.plan.MapWork cannot be cast to org.apache.hadoop.hive.ql.plan.ReduceWork&lt;br/&gt;
        at org.apache.hadoop.hive.ql.parse.GenTezWork.process(GenTezWork.java:361)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.lib.DefaultRuleDispatcher.dispatch(DefaultRuleDispatcher.java:90)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.lib.DefaultGraphWalker.dispatchAndReturn(DefaultGraphWalker.java:94)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.parse.GenTezWorkWalker.walk(GenTezWorkWalker.java:87)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.parse.GenTezWorkWalker.walk(GenTezWorkWalker.java:103)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.parse.GenTezWorkWalker.walk(GenTezWorkWalker.java:103)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.parse.GenTezWorkWalker.walk(GenTezWorkWalker.java:103)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.parse.GenTezWorkWalker.walk(GenTezWorkWalker.java:103)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.parse.GenTezWorkWalker.startWalking(GenTezWorkWalker.java:69)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.parse.TezCompiler.generateTaskTree(TezCompiler.java:368)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.parse.TaskCompiler.compile(TaskCompiler.java:202)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.analyzeInternal(SemanticAnalyzer.java:10202)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:224)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:419)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:305)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.Driver.compileInternal(Driver.java:1107)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.Driver.runInternal(Driver.java:1155)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.Driver.run(Driver.java:1044)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.Driver.run(Driver.java:1034)&lt;br/&gt;
        at org.apache.hadoop.hive.cli.CliDriver.processLocalCmd(CliDriver.java:206)&lt;br/&gt;
        at org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:158)&lt;br/&gt;
        at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:369)&lt;br/&gt;
        at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:304)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.QTestUtil.executeClient(QTestUtil.java:834)&lt;br/&gt;
        at org.apache.hadoop.hive.cli.TestMiniTezCliDriver.runTest(TestMiniTezCliDriver.java:136)&lt;br/&gt;
        at org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_uniontez2(TestMiniTezCliDriver.java:120)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12762215">HIVE-9141</key>
            <summary>HiveOnTez: mix of union all, distinct, group by generates error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="navis">Navis Ryu</assignee>
                                    <reporter username="pxiong">Pengcheng Xiong</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Dec 2014 07:23:05 +0000</created>
                <updated>Thu, 19 Feb 2015 18:21:56 +0000</updated>
                            <resolved>Fri, 19 Dec 2014 00:28:53 +0000</resolved>
                                    <version>0.15.0</version>
                                    <fixVersion>1.0.0</fixVersion>
                                    <component>Tez</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14249575" author="pxiong" created="Wed, 17 Dec 2014 07:26:38 +0000"  >&lt;p&gt;This will block &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-9039&quot; title=&quot;Support Union Distinct&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-9039&quot;&gt;&lt;del&gt;HIVE-9039&lt;/del&gt;&lt;/a&gt;. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpullokkaran&quot; class=&quot;user-hover&quot; rel=&quot;jpullokkaran&quot;&gt;jpullokkaran&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vikram.dixit&quot; class=&quot;user-hover&quot; rel=&quot;vikram.dixit&quot;&gt;vikram.dixit&lt;/a&gt;, could you please take a look? The error remains in the most recent trunk (that is, after &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-9055&quot; title=&quot;Tez: union all followed by group by followed by another union all gives error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-9055&quot;&gt;&lt;del&gt;HIVE-9055&lt;/del&gt;&lt;/a&gt; is checked in).&lt;/p&gt;</comment>
                            <comment id="14249577" author="pxiong" created="Wed, 17 Dec 2014 07:27:15 +0000"  >&lt;p&gt;There is no error when it is run on MR.&lt;/p&gt;</comment>
                            <comment id="14249580" author="pxiong" created="Wed, 17 Dec 2014 07:28:26 +0000"  >&lt;p&gt;And, the following queries got no error when they are run on Tez:&lt;/p&gt;

&lt;p&gt;SELECT key, value FROM(&lt;/p&gt;

&lt;p&gt;      SELECT key, value FROM src&lt;/p&gt;

&lt;p&gt;        UNION ALL&lt;/p&gt;

&lt;p&gt;      SELECT key, value FROM src&lt;/p&gt;

&lt;p&gt;      )t1 group by  key, value;&lt;/p&gt;

&lt;p&gt;SELECT distinct key FROM (&lt;/p&gt;

&lt;p&gt;      SELECT key, value FROM(&lt;/p&gt;

&lt;p&gt;      SELECT key, value FROM src&lt;/p&gt;

&lt;p&gt;        UNION ALL&lt;/p&gt;

&lt;p&gt;      SELECT key, value FROM src&lt;/p&gt;

&lt;p&gt;      )t1 group by  key, value)t2;&lt;/p&gt;</comment>
                            <comment id="14249615" author="vikram.dixit" created="Wed, 17 Dec 2014 08:10:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pxiong&quot; class=&quot;user-hover&quot; rel=&quot;pxiong&quot;&gt;pxiong&lt;/a&gt; I was able to run the query you mentioned above only getting a diff in the result. Can you try again with the latest changes and see it it works?&lt;/p&gt;</comment>
                            <comment id="14251034" author="navis" created="Thu, 18 Dec 2014 02:21:13 +0000"  >&lt;p&gt;Quick shot.&lt;/p&gt;</comment>
                            <comment id="14251267" author="pxiong" created="Thu, 18 Dec 2014 06:13:48 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt;. I also tested the patch with other test cases and it works so far so good. &lt;/p&gt;</comment>
                            <comment id="14251273" author="hiveqa" created="Thu, 18 Dec 2014 06:22:00 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12687926/HIVE-9141.1.patch.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12687926/HIVE-9141.1.patch.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 2 failed/errored test(s), 6714 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_optimize_nullscan
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_schemeAuthority
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2121/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2121/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2121/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/2121/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2121/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-2121/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12687926 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14251356" author="vikram.dixit" created="Thu, 18 Dec 2014 08:03:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;navis&lt;/a&gt; Nice patch. Simplifies the code as well. However, it looks like with this change, the followingWork can never be a union work because of moving the code. Do you see any way followingWork can be union work? I think we can remove that piece of the code as well as remove the getFollowingWorkIndex method as well. Thoughts?&lt;/p&gt;</comment>
                            <comment id="14251668" author="ashutoshc" created="Thu, 18 Dec 2014 14:05:43 +0000"  >&lt;p&gt;+1 This also fixes &lt;tt&gt;optimize_nullscan.q&lt;/tt&gt; breakage introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-9055&quot; title=&quot;Tez: union all followed by group by followed by another union all gives error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-9055&quot;&gt;&lt;del&gt;HIVE-9055&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14252637" author="ashutoshc" created="Fri, 19 Dec 2014 00:28:53 +0000"  >&lt;p&gt;Committed to trunk. Thanks, Navis!&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vikram.dixit&quot; class=&quot;user-hover&quot; rel=&quot;vikram.dixit&quot;&gt;vikram.dixit&lt;/a&gt; I have committed this since this one was also blocking &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-9106&quot; title=&quot;improve the performance of null scan optimizer when several table scans share a physical path&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-9106&quot;&gt;&lt;del&gt;HIVE-9106&lt;/del&gt;&lt;/a&gt; in addition to resulting a breakage of test. If there is a way to improve on patch we can take that up on follow-on.&lt;/p&gt;</comment>
                            <comment id="14252656" author="navis" created="Fri, 19 Dec 2014 00:38:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vikram.dixit&quot; class=&quot;user-hover&quot; rel=&quot;vikram.dixit&quot;&gt;vikram.dixit&lt;/a&gt; My patch was just a quick shot (as I stated submitting the patch) thinking that parents of root should reference the work of root operator instead of currently evolving work. As it&apos;s committed already, you can try that in following issue. Frankly, I don&apos;t know well on tez compiling.&lt;/p&gt;</comment>
                            <comment id="14281154" author="thejas" created="Sat, 17 Jan 2015 02:20:33 +0000"  >&lt;p&gt;Should we include this in hive 0.14.1 ?&lt;br/&gt;
cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vikram.dixit&quot; class=&quot;user-hover&quot; rel=&quot;vikram.dixit&quot;&gt;vikram.dixit&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14327533" author="thejas" created="Thu, 19 Feb 2015 14:44:51 +0000"  >&lt;p&gt;Updating release version for jiras resolved in 1.0.0 .&lt;/p&gt;</comment>
                            <comment id="14327865" author="thejas" created="Thu, 19 Feb 2015 18:21:56 +0000"  >&lt;p&gt;This issue has been fixed in Apache Hive 1.0.0. If there is any issue with the fix, please open a new jira to address it.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                            <outwardlinks description="contains">
                                        <issuelink>
            <issuekey id="12762409">HIVE-9150</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12760526">HIVE-9055</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12760071">HIVE-9039</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="12762106">HIVE-9131</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12687926" name="HIVE-9141.1.patch.txt" size="19249" author="navis" created="Thu, 18 Dec 2014 02:27:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i23iin:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>