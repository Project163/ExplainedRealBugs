<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:57:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-1376] Simple UDAFs with more than 1 parameter crash on empty row query </title>
                <link>https://issues.apache.org/jira/browse/HIVE-1376</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Simple UDAFs with more than 1 parameter crash when the query returns no rows. Currently, this only seems to affect the percentile() UDAF where the second parameter is the percentile to be computed (of type double). I&apos;ve also verified the bug by adding a dummy parameter to ExampleMin in contrib. &lt;/p&gt;

&lt;p&gt;On an empty query, Hive seems to be trying to resolve an iterate() method with signature &lt;/p&gt;
{null,null}
&lt;p&gt; instead of &lt;/p&gt;
{null,double}
&lt;p&gt;. You can reproduce this bug using:&lt;/p&gt;

&lt;p&gt;CREATE TABLE pct_test ( val INT );&lt;br/&gt;
SELECT percentile(val, 0.5) FROM pct_test;&lt;/p&gt;

&lt;p&gt;which produces a lot of errors like: &lt;/p&gt;

&lt;p&gt;Caused by: org.apache.hadoop.hive.ql.metadata.HiveException: Unable to execute method public boolean org.apache.hadoop.hive.ql.udf.UDAFPercentile$PercentileLongEvaluator.iterate(org.apache.hadoop.io.LongWritable,double)  on object org.apache.hadoop.hive.ql.udf.UDAFPercentile$PercentileLongEvaluator@11d13272 of class org.apache.hadoop.hive.ql.udf.UDAFPercentile$PercentileLongEvaluator with arguments &lt;/p&gt;
{null, null}
&lt;p&gt; of size 2&lt;/p&gt;</description>
                <environment></environment>
        <key id="12465676">HIVE-1376</key>
            <summary>Simple UDAFs with more than 1 parameter crash on empty row query </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nzhang">Ning Zhang</assignee>
                                    <reporter username="mayanklahiri">Mayank Lahiri</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 May 2010 21:10:01 +0000</created>
                <updated>Sat, 17 Dec 2011 00:01:14 +0000</updated>
                            <resolved>Thu, 7 Oct 2010 17:02:18 +0000</resolved>
                                    <version>0.6.0</version>
                                    <fixVersion>0.7.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="12874232" author="jvs" created="Tue, 1 Jun 2010 20:50:46 +0000"  >&lt;p&gt;Some more details on this:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;In the case of a full-table aggregation (no group by key) where no rows exist (or all get filtered out), the aggregation framework sends a row of all nulls to the aggregator.  I don&apos;t know why this is necessary, since all of the existing aggregators ignore the null anyway.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Since the percentile UDAF uses a primitive double for the parameter type to the iterate method (rather than a Double or a DoubleWritable), Java reflection throws an IllegalArgumentException because it can&apos;t convert a null to a primitive.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;There are three possible solutions:&lt;/p&gt;

&lt;p&gt;(1) change percentile to use a non-primitive type&lt;/p&gt;

&lt;p&gt;(2) add more reflection and skip the attempt to send the null to iterate in the case where the parameter type is primitive&lt;/p&gt;

&lt;p&gt;(3) avoid sending the null in the first place (unless someone can explain why it&apos;s needed, or some regression test fails when we try it)&lt;/p&gt;</comment>
                            <comment id="12916573" author="zshao" created="Thu, 30 Sep 2010 17:48:34 +0000"  >&lt;p&gt;I think (3) makes the most sense.  If (3) does not work for whatever hard-to-fix reason, we can do (1).&lt;br/&gt;
In any case, the change should be pretty simple.&lt;/p&gt;</comment>
                            <comment id="12916711" author="nzhang" created="Thu, 30 Sep 2010 22:09:47 +0000"  >&lt;p&gt;Attaching a patch for review. This patch also fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1674&quot; title=&quot;count(*) returns wrong result when a mapper returns empty results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1674&quot;&gt;&lt;del&gt;HIVE-1674&lt;/del&gt;&lt;/a&gt; (count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; returning wrong results). &lt;/p&gt;

&lt;p&gt;Tests are still running. Will upload a new patch if there are more changes. &lt;/p&gt;

&lt;p&gt;This patch implements 3) as suggest and SELECT PERCENTILE(col, 0.5) from src where false; will return a single row with NULL as value. &lt;/p&gt;</comment>
                            <comment id="12916989" author="nzhang" created="Fri, 1 Oct 2010 18:19:00 +0000"  >&lt;p&gt;The previous patch failed on several test, particularly count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; queries. Attaching a new patch for percentile only and will update a patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1674&quot; title=&quot;count(*) returns wrong result when a mapper returns empty results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1674&quot;&gt;&lt;del&gt;HIVE-1674&lt;/del&gt;&lt;/a&gt; separately. &lt;/p&gt;</comment>
                            <comment id="12918716" author="he yongqiang" created="Wed, 6 Oct 2010 22:37:21 +0000"  >&lt;p&gt;will take a look. &lt;/p&gt;</comment>
                            <comment id="12918767" author="he yongqiang" created="Thu, 7 Oct 2010 02:12:15 +0000"  >&lt;p&gt;the patch looks good. is there the same problem in other udafs? If yes, should we fix them one by one or fix them in the group by operator?&lt;/p&gt;</comment>
                            <comment id="12918771" author="he yongqiang" created="Thu, 7 Oct 2010 02:23:00 +0000"  >&lt;p&gt;sorry, did not see the previous comments. John and Zheng have already discussed this problem. I will start running tests.&lt;/p&gt;</comment>
                            <comment id="12918973" author="he yongqiang" created="Thu, 7 Oct 2010 17:02:18 +0000"  >&lt;p&gt;I just committed! Thanks Ning!&lt;/p&gt;</comment>
                            <comment id="12923090" author="jvs" created="Wed, 20 Oct 2010 18:51:32 +0000"  >&lt;p&gt;This patch only did (1), not (3).  I think we&apos;ll still need a followup to avoid the problem for arbitrary UDAF&apos;s (unless we require them to avoid primitive types).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12456151" name="HIVE-1376.2.patch" size="9455" author="nzhang" created="Fri, 1 Oct 2010 18:19:00 +0000"/>
                            <attachment id="12456069" name="HIVE-1376.patch" size="19488" author="nzhang" created="Thu, 30 Sep 2010 22:09:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72936</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 5 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0letb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123050</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>