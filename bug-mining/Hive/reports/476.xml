<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:56:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-1678] NPE in MapJoin </title>
                <link>https://issues.apache.org/jira/browse/HIVE-1678</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The query with two map joins and a group by fails with following NPE:&lt;/p&gt;

&lt;p&gt;Caused by: java.lang.NullPointerException&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.MapJoinOperator.processOp(MapJoinOperator.java:177)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:457)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:697)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.SelectOperator.processOp(SelectOperator.java:84)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:457)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:697)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.MapOperator.process(MapOperator.java:464)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12475577">HIVE-1678</key>
            <summary>NPE in MapJoin </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="amareshwari">Amareshwari Sriramadasu</assignee>
                                    <reporter username="amareshwari">Amareshwari Sriramadasu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Oct 2010 05:41:21 +0000</created>
                <updated>Fri, 16 Dec 2011 23:59:53 +0000</updated>
                            <resolved>Mon, 4 Oct 2010 21:36:48 +0000</resolved>
                                                    <fixVersion>0.7.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12916789" author="amareshwari" created="Fri, 1 Oct 2010 05:45:12 +0000"  >&lt;p&gt;The following query :&lt;br/&gt;
select /*+MAPJOIN(src, myinput1) */ count(srcpart.key) from srcpart join src on (srcpart.value=src.value) join myinput1 on (srcpart.key=myinput1.key);&lt;br/&gt;
launches three MapReduce jobs in which third one fails with NPE.&lt;/p&gt;

&lt;p&gt;The task logs : &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2010-10-01 11:07:02,324 INFO ExecMapper: 
&amp;lt;MAP&amp;gt;Id =11
  &amp;lt;Children&amp;gt;
    &amp;lt;SEL&amp;gt;Id =0
      &amp;lt;Children&amp;gt;
        &amp;lt;MAPJOIN&amp;gt;Id =1
          &amp;lt;Children&amp;gt;
            &amp;lt;FS&amp;gt;Id =2
              &amp;lt;Parent&amp;gt;Id = 1 null&amp;lt;\Parent&amp;gt;
            &amp;lt;\FS&amp;gt;
          &amp;lt;\Children&amp;gt;
          &amp;lt;Parent&amp;gt;Id = 0 nullId = 3 
        &amp;lt;TS&amp;gt;Id =3
          &amp;lt;Children&amp;gt;null
          &amp;lt;\Children&amp;gt;
        &amp;lt;\TS&amp;gt;&amp;lt;\Parent&amp;gt;
        &amp;lt;\MAPJOIN&amp;gt;
      &amp;lt;\Children&amp;gt;
      &amp;lt;Parent&amp;gt;Id = 11 null&amp;lt;\Parent&amp;gt;
    &amp;lt;\SEL&amp;gt;
  &amp;lt;\Children&amp;gt;
&amp;lt;\MAP&amp;gt;
2010-10-01 11:07:02,324 INFO org.apache.hadoop.hive.ql.exec.MapOperator: Initializing Self 11 MAP
2010-10-01 11:07:02,324 INFO org.apache.hadoop.hive.ql.exec.SelectOperator: Initializing Self 0 SEL
2010-10-01 11:07:02,327 INFO org.apache.hadoop.hive.ql.exec.SelectOperator: SELECT struct&amp;lt;_col0:int&amp;gt;
2010-10-01 11:07:02,332 INFO org.apache.hadoop.hive.ql.exec.SelectOperator: Operator 0 SEL initialized
2010-10-01 11:07:02,332 INFO org.apache.hadoop.hive.ql.exec.SelectOperator: Initializing children of 0 SEL
2010-10-01 11:07:02,332 INFO org.apache.hadoop.hive.ql.exec.MapJoinOperator: Initializing child 1 MAPJOIN
2010-10-01 11:07:02,332 INFO org.apache.hadoop.hive.ql.exec.SelectOperator: Initialization Done 0 SEL
2010-10-01 11:07:02,332 INFO org.apache.hadoop.hive.ql.exec.MapOperator: Initialization Done 11 MAP
2010-10-01 11:07:02,334 INFO org.apache.hadoop.hive.ql.exec.MapOperator: 11 forwarding 1 rows
2010-10-01 11:07:02,334 INFO org.apache.hadoop.hive.ql.exec.SelectOperator: 0 forwarding 1 rows
2010-10-01 11:07:02,338 FATAL ExecMapper: org.apache.hadoop.hive.ql.metadata.HiveException: Hive Runtime Error while processing row {&quot;_col0&quot;:238}
	at org.apache.hadoop.hive.ql.exec.MapOperator.process(MapOperator.java:483)
	at org.apache.hadoop.hive.ql.exec.ExecMapper.map(ExecMapper.java:180)
	at org.apache.hadoop.mapred.MapRunner.run(MapRunner.java:50)
	at org.apache.hadoop.mapred.MapTask.runOldMapper(MapTask.java:395)
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:329)
	at org.apache.hadoop.mapred.Child$4.run(Child.java:219)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:396)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1021)
	at org.apache.hadoop.mapred.Child.main(Child.java:213)
Caused by: java.lang.NullPointerException
	at org.apache.hadoop.hive.ql.exec.MapJoinOperator.processOp(MapJoinOperator.java:177)
	at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:459)
	at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:710)
	at org.apache.hadoop.hive.ql.exec.SelectOperator.processOp(SelectOperator.java:84)
	at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:459)
	at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:710)
	at org.apache.hadoop.hive.ql.exec.MapOperator.process(MapOperator.java:464)
	... 9 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From the logs we can see that MapJoinOperator is not intialized at all.&lt;/p&gt;</comment>
                            <comment id="12916794" author="amareshwari" created="Fri, 1 Oct 2010 06:03:58 +0000"  >&lt;p&gt;The same query succeeds when no MapJoin is used.&lt;/p&gt;

&lt;p&gt;Looks like plan generation went wrong in MapJoinProcessor. explain output for the query:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;explain 
select /*+MAPJOIN(src, myinput1) */ count(srcpart.key) from srcpart join src on (srcpart.value=src.value) join myinput1 on (srcpart.key=myinput1.key);

OK
ABSTRACT SYNTAX TREE:
  (TOK_QUERY (TOK_FROM (TOK_JOIN (TOK_JOIN (TOK_TABREF srcpart) (TOK_TABREF src) (= (. (TOK_TABLE_OR_COL srcpart) value) (. (TOK_TABLE_OR_COL src) value))) (TOK_TABREF myinput1) (= (. (TOK_TABLE_OR_COL srcpart) key) (. (TOK_TABLE_OR_COL myinput1) key)))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_HINTLIST (TOK_HINT TOK_MAPJOIN (TOK_HINTARGLIST src myinput1))) (TOK_SELEXPR (TOK_FUNCTION count (. (TOK_TABLE_OR_COL srcpart) key))))))

STAGE DEPENDENCIES:
  Stage-1 is a root stage
  Stage-2 depends on stages: Stage-1
  Stage-3 depends on stages: Stage-2
  Stage-0 is a root stage

STAGE PLANS:
  Stage: Stage-1
    Map Reduce
      Alias -&amp;gt; Map Operator Tree:
        srcpart
          TableScan
            alias: srcpart
            Common Join Operator
              condition map:
                   Inner Join 0 to 1
              condition expressions:
                0 {key}
                1
              handleSkewJoin: false
              keys:
                0 [Column[value]]
                1 [Column[value]]
              outputColumnNames: _col0
              Position of Big Table: 0
              File Output Operator
                compressed: false
                GlobalTableId: 0
                table:
                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                    output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
      Local Work:
        Map Reduce Local Work
          Alias -&amp;gt; Map Local Tables:
            src
              Fetch Operator
                limit: -1
          Alias -&amp;gt; Map Local Operator Tree:
            src
              TableScan
                alias: src
                Common Join Operator
                  condition map:
                       Inner Join 0 to 1
                  condition expressions:
                    0 {key}
                    1
                  handleSkewJoin: false
                  keys:
                    0 [Column[value]]
                    1 [Column[value]]
                  outputColumnNames: _col0
                  Position of Big Table: 0
                  File Output Operator
                    compressed: false
                    GlobalTableId: 0
                    table:
                        input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                        output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat

  Stage: Stage-2
    Map Reduce
      Alias -&amp;gt; Map Operator Tree:
        hdfs://localhost:19000/tmp/hive-amarsri/hive_2010-10-01_11-24-15_198_629889728835692043/-mr-10002
          Select Operator
            expressions:
                  expr: _col0
                  type: int
            outputColumnNames: _col0
            Common Join Operator
              condition map:
                   Inner Join 0 to 1
              condition expressions:
                0 {_col0}
                1
              handleSkewJoin: false
              keys:
                0 [Column[_col0]]
                1 [Column[key]]
              outputColumnNames: _col0
              Position of Big Table: 0
              File Output Operator
                compressed: false
                GlobalTableId: 0
                table:
                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                    output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
      Local Work:
        Map Reduce Local Work
          Alias -&amp;gt; Map Local Tables:
            myinput1
              Fetch Operator
                limit: -1
          Alias -&amp;gt; Map Local Operator Tree:
            myinput1
              TableScan
                alias: myinput1
                Common Join Operator
                  condition map:
                       Inner Join 0 to 1
                  condition expressions:
                    0 {_col0}
                    1
                  handleSkewJoin: false
                  keys:
                    0 [Column[_col0]]
                    1 [Column[key]]
                  outputColumnNames: _col0
                  Position of Big Table: 0
                  File Output Operator
                    compressed: false
                    GlobalTableId: 0
                    table:
                        input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                        output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat

  Stage: Stage-3
    Map Reduce
      Alias -&amp;gt; Map Operator Tree:
        hdfs://localhost:19000/tmp/hive-amarsri/hive_2010-10-01_11-24-15_198_629889728835692043/-mr-10002
          Select Operator
            expressions:
                  expr: _col0
                  type: int
            outputColumnNames: _col0
            Common Join Operator
              condition map:
                   Inner Join 0 to 1
              condition expressions:
                0 {_col0}
                1
              handleSkewJoin: false
              keys:
                0 [Column[_col0]]
                1 [Column[key]]
              outputColumnNames: _col0
              Position of Big Table: 0
              File Output Operator
                compressed: false
                GlobalTableId: 0
                table:
                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                    output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
      Reduce Operator Tree:
        Group By Operator
          aggregations:
                expr: count(VALUE._col0)
          bucketGroup: false
          mode: mergepartial
          outputColumnNames: _col0
          Select Operator
            expressions:
                  expr: _col0
                  type: bigint
            outputColumnNames: _col0
            File Output Operator
              compressed: false
              GlobalTableId: 0
              table:
                  input format: org.apache.hadoop.mapred.TextInputFormat
                  output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat

  Stage: Stage-0
    Fetch Operator
      limit: -1

Time taken: 0.202 seconds
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If I&apos;m not wrong, Join operation should not be there in 3rd stage.&lt;/p&gt;</comment>
                            <comment id="12917494" author="amareshwari" created="Mon, 4 Oct 2010 06:39:12 +0000"  >&lt;p&gt;The bug is in plan generation when MapJoin is followed MapJoin, and is followed by ReduceSink. ReduceSink operator reads the input from oldMapJoin instead of current MapJoin.&lt;/p&gt;

&lt;p&gt;Attached patch has one line fix in GenMapRedUtils.initMapJoinPlan to fix the bug. Also includes the testcase.&lt;/p&gt;</comment>
                            <comment id="12917684" author="namit" created="Mon, 4 Oct 2010 17:57:05 +0000"  >&lt;p&gt;Nice catch - Thanks&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;will commit if the tests pass&lt;/p&gt;</comment>
                            <comment id="12917779" author="namit" created="Mon, 4 Oct 2010 21:36:48 +0000"  >&lt;p&gt;Committed. Thanks Amareshwari&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12456273" name="patch-1678.txt" size="15611" author="amareshwari" created="Mon, 4 Oct 2010 06:39:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72774</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 8 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lgcf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123298</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>