<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:25:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-27775] DirectSQL and JDO results are different when fetching partitions by timestamp in DST shift</title>
                <link>https://issues.apache.org/jira/browse/HIVE-27775</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;DirectSQL and JDO results are different when fetching partitions by timestamp in DST shift.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;--! qt:timezone:Europe/Paris
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;EXTERNAL&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; payments (card &lt;span class=&quot;code-keyword&quot;&gt;string&lt;/span&gt;) PARTITIONED &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt;(txn_datetime &lt;span class=&quot;code-keyword&quot;&gt;TIMESTAMP&lt;/span&gt;) STORED &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; ORC;
&lt;span class=&quot;code-keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;into&lt;/span&gt; payments &lt;span class=&quot;code-keyword&quot;&gt;VALUES&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&apos;3333-4444-2222-9999&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;2023-03-26 02:30:00&apos;&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; * &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; payments &lt;span class=&quot;code-keyword&quot;&gt;WHERE&lt;/span&gt; txn_datetime = &lt;span class=&quot;code-quote&quot;&gt;&apos;2023-03-26 02:30:00&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &apos;2023-03-26 02:30:00&apos; is a timestamp that in Europe/Paris timezone falls exactly in the middle of the DST shift. In this particular timezone this date time never really exists since we are jumping directly from 02:00:00 to 03:00:00. However, the TIMESTAMP data type in Hive is timezone agnostic (&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Different+TIMESTAMP+types&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/Hive/Different+TIMESTAMP+types&lt;/a&gt;) so it is a perfectly valid timestamp that can be inserted in a table and we must be able to recover it back.&lt;/p&gt;

&lt;p&gt;For the SELECT query above, partition pruning kicks in and calls the ObjectStore#getPartitionsByExpr method in order to fetch the respective partitions matching the timestamp from HMS.&lt;/p&gt;

&lt;p&gt;The tests however reveal that DirectSQL and JDO paths are not returning the same results leading to an exception when VerifyingObjectStore is used. According to the error below DirectSQL is able to recover one partition from HMS (expected) while JDO/ORM returns empty (not expected).&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2023-10-06T03:51:19,406 ERROR [80252df4-3fdc-4971-badf-ad67ce8567c7 main] metastore.VerifyingObjectStore: Lists are not the same size: SQL 1, ORM 0
2023-10-06T03:51:19,409 ERROR [80252df4-3fdc-4971-badf-ad67ce8567c7 main] metastore.RetryingHMSHandler: MetaException(message:Lists are not the same size: SQL 1, ORM 0)
	at org.apache.hadoop.hive.metastore.VerifyingObjectStore.verifyLists(VerifyingObjectStore.java:148)
	at org.apache.hadoop.hive.metastore.VerifyingObjectStore.getPartitionsByExpr(VerifyingObjectStore.java:88)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.hadoop.hive.metastore.RawStoreProxy.invoke(RawStoreProxy.java:97)
	at com.sun.proxy.$Proxy57.getPartitionsByExpr(Unknown Source)
	at org.apache.hadoop.hive.metastore.HMSHandler.get_partitions_spec_by_expr(HMSHandler.java:7330)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.hadoop.hive.metastore.RetryingHMSHandler.invokeInternal(RetryingHMSHandler.java:98)
	at org.apache.hadoop.hive.metastore.AbstractHMSHandlerProxy.invoke(AbstractHMSHandlerProxy.java:82)
	at com.sun.proxy.$Proxy59.get_partitions_spec_by_expr(Unknown Source)
	at org.apache.hadoop.hive.metastore.HiveMetaStoreClient.getPartitionsSpecByExprInternal(HiveMetaStoreClient.java:2472)
	at org.apache.hadoop.hive.ql.metadata.HiveMetaStoreClientWithLocalCache.getPartitionsSpecByExprInternal(HiveMetaStoreClientWithLocalCache.java:396)
	at org.apache.hadoop.hive.ql.metadata.SessionHiveMetaStoreClient.getPartitionsSpecByExprInternal(SessionHiveMetaStoreClient.java:2279)
	at org.apache.hadoop.hive.metastore.HiveMetaStoreClient.listPartitionsSpecByExpr(HiveMetaStoreClient.java:2484)
	at org.apache.hadoop.hive.ql.metadata.SessionHiveMetaStoreClient.listPartitionsSpecByExpr(SessionHiveMetaStoreClient.java:1346)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.hadoop.hive.metastore.RetryingMetaStoreClient.invoke(RetryingMetaStoreClient.java:213)
	at com.sun.proxy.$Proxy60.listPartitionsSpecByExpr(Unknown Source)
	at org.apache.hadoop.hive.ql.metadata.Hive.getPartitionsByExpr(Hive.java:4507)
	at org.apache.hadoop.hive.ql.optimizer.ppr.PartitionPruner.getPartitionsFromServer(PartitionPruner.java:457)
	at org.apache.hadoop.hive.ql.optimizer.ppr.PartitionPruner.prune(PartitionPruner.java:230)
	at org.apache.hadoop.hive.ql.optimizer.calcite.RelOptHiveTable.computePartitionList(RelOptHiveTable.java:480)
	at org.apache.hadoop.hive.ql.optimizer.calcite.rules.HivePartitionPruneRule.perform(HivePartitionPruneRule.java:63)
	at org.apache.hadoop.hive.ql.optimizer.calcite.rules.HivePartitionPruneRule.onMatch(HivePartitionPruneRule.java:46)
	at org.apache.calcite.plan.AbstractRelOptPlanner.fireRule(AbstractRelOptPlanner.java:333)
	at org.apache.calcite.plan.hep.HepPlanner.applyRule(HepPlanner.java:542)
	at org.apache.calcite.plan.hep.HepPlanner.applyRules(HepPlanner.java:407)
	at org.apache.calcite.plan.hep.HepPlanner.executeInstruction(HepPlanner.java:243)
	at org.apache.calcite.plan.hep.HepInstruction$RuleInstance.execute(HepInstruction.java:127)
	at org.apache.calcite.plan.hep.HepPlanner.executeProgram(HepPlanner.java:202)
	at org.apache.calcite.plan.hep.HepPlanner.findBestExp(HepPlanner.java:189)
	at org.apache.hadoop.hive.ql.parse.CalcitePlanner$CalcitePlannerAction.executeProgram(CalcitePlanner.java:2471)
	at org.apache.hadoop.hive.ql.parse.CalcitePlanner$CalcitePlannerAction.executeProgram(CalcitePlanner.java:2430)
	at org.apache.hadoop.hive.ql.parse.CalcitePlanner$CalcitePlannerAction.applyPreJoinOrderingTransforms(CalcitePlanner.java:1968)
	at org.apache.hadoop.hive.ql.parse.CalcitePlanner$CalcitePlannerAction.apply(CalcitePlanner.java:1712)
	at org.apache.hadoop.hive.ql.parse.CalcitePlanner$CalcitePlannerAction.apply(CalcitePlanner.java:1593)
	at org.apache.calcite.tools.Frameworks.lambda$withPlanner$0(Frameworks.java:131)
	at org.apache.calcite.prepare.CalcitePrepareImpl.perform(CalcitePrepareImpl.java:914)
	at org.apache.calcite.tools.Frameworks.withPrepare(Frameworks.java:180)
	at org.apache.calcite.tools.Frameworks.withPlanner(Frameworks.java:126)
	at org.apache.hadoop.hive.ql.parse.CalcitePlanner.logicalPlan(CalcitePlanner.java:1345)
	at org.apache.hadoop.hive.ql.parse.CalcitePlanner.genOPTree(CalcitePlanner.java:572)
	at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.analyzeInternal(SemanticAnalyzer.java:13048)
	at org.apache.hadoop.hive.ql.parse.CalcitePlanner.analyzeInternal(CalcitePlanner.java:467)
	at org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:327)
	at org.apache.hadoop.hive.ql.Compiler.analyze(Compiler.java:224)
	at org.apache.hadoop.hive.ql.Compiler.compile(Compiler.java:107)
	at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:519)
	at org.apache.hadoop.hive.ql.Driver.compileInternal(Driver.java:471)
	at org.apache.hadoop.hive.ql.Driver.compileAndRespond(Driver.java:436)
	at org.apache.hadoop.hive.ql.Driver.compileAndRespond(Driver.java:430)
	at org.apache.hadoop.hive.ql.reexec.ReExecDriver.compileAndRespond(ReExecDriver.java:121)
	at org.apache.hadoop.hive.ql.reexec.ReExecDriver.run(ReExecDriver.java:227)
	at org.apache.hadoop.hive.cli.CliDriver.processLocalCmd(CliDriver.java:257)
	at org.apache.hadoop.hive.cli.CliDriver.processCmd1(CliDriver.java:201)
	at org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:127)
	at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:425)
	at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:356)
	at org.apache.hadoop.hive.ql.QTestUtil.executeClientInternal(QTestUtil.java:733)
	at org.apache.hadoop.hive.ql.QTestUtil.executeClient(QTestUtil.java:703)
	at org.apache.hadoop.hive.cli.control.CoreCliDriver.runTest(CoreCliDriver.java:115)
	at org.apache.hadoop.hive.cli.control.CliAdapter.runTest(CliAdapter.java:157)
	at org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver(TestMiniLlapLocalCliDriver.java:62)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13553129">HIVE-27775</key>
            <summary>DirectSQL and JDO results are different when fetching partitions by timestamp in DST shift</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dengzh">Zhihua Deng</assignee>
                                    <reporter username="zabetak">Stamatis Zampetakis</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 6 Oct 2023 12:04:43 +0000</created>
                <updated>Fri, 29 Mar 2024 17:49:48 +0000</updated>
                            <resolved>Fri, 1 Mar 2024 12:57:54 +0000</resolved>
                                    <version>4.0.0-beta-1</version>
                                    <fixVersion>4.0.0</fixVersion>
                                    <component>Standalone Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17772556" author="zabetak" created="Fri, 6 Oct 2023 12:39:20 +0000"  >&lt;p&gt;We have discovered this bug while writting tests for &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-27760&quot; title=&quot;WHERE condition on DATE type partitioning column leads to wrong results &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-27760&quot;&gt;&lt;del&gt;HIVE-27760&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17793653" author="dkuzmenko" created="Wed, 6 Dec 2023 11:27:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dengzh&quot; class=&quot;user-hover&quot; rel=&quot;dengzh&quot;&gt;dengzh&lt;/a&gt;, could you please share any updates, we are considering this as a blocker for 4.0&lt;/p&gt;</comment>
                            <comment id="17794502" author="dengzh" created="Fri, 8 Dec 2023 03:31:17 +0000"  >&lt;p&gt;On Jdo path, we use the partition name to fetch the matched partitions,&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SELECT DISTINCT &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.hadoop.hive.metastore.model.MPartition&apos;&lt;/span&gt; AS DN_TYPE,A0.CREATE_TIME,A0.LAST_ACCESS_TIME,A0.PART_NAME AS NUCORDER0,A0.WRITE_ID,A0.PART_ID FROM PARTITIONS A0 LEFT OUTER JOIN TBLS B0 ON A0.TBL_ID = B0.TBL_ID LEFT OUTER JOIN DBS C0 ON B0.DB_ID = C0.DB_ID WHERE B0.TBL_NAME = &amp;lt;&lt;span class=&quot;code-quote&quot;&gt;&apos;payments&apos;&lt;/span&gt;&amp;gt; AND C0.&lt;span class=&quot;code-quote&quot;&gt;&quot;NAME&quot;&lt;/span&gt; = &amp;lt;&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;&apos;&lt;/span&gt;&amp;gt; AND C0.CTLG_NAME = &amp;lt;&lt;span class=&quot;code-quote&quot;&gt;&apos;hive&apos;&lt;/span&gt;&amp;gt; AND A0.PART_NAME = &amp;lt;&lt;span class=&quot;code-quote&quot;&gt;&apos;txn_datetime=2023-03-26 03%3A30%3A00&apos;&lt;/span&gt;&amp;gt; ORDER BY NUCORDER0 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In the above example, the filter A0.PART_NAME = &amp;lt;&apos;txn_datetime=2023-03-26 03%3A30%3A00&apos;&amp;gt; A0.PART_NAME is timezone agnostic, this could lead to wrong result if &amp;lt;&apos;txn_datetime=2023-03-26 03%3A30%3A00&apos;&amp;gt; is timezone based partition name.&lt;/p&gt;

&lt;p&gt;Compared to direct mode,&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
select &lt;span class=&quot;code-quote&quot;&gt;&quot;PARTITIONS&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;PART_ID&quot;&lt;/span&gt; from &lt;span class=&quot;code-quote&quot;&gt;&quot;PARTITIONS&quot;&lt;/span&gt;&#160; &lt;span class=&quot;code-keyword&quot;&gt;inner&lt;/span&gt; join &lt;span class=&quot;code-quote&quot;&gt;&quot;TBLS&quot;&lt;/span&gt; on &lt;span class=&quot;code-quote&quot;&gt;&quot;PARTITIONS&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;TBL_ID&quot;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&quot;TBLS&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;TBL_ID&quot;&lt;/span&gt; &#160; &#160; and &lt;span class=&quot;code-quote&quot;&gt;&quot;TBLS&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;TBL_NAME&quot;&lt;/span&gt; = &amp;lt;&lt;span class=&quot;code-quote&quot;&gt;&apos;payments&apos;&lt;/span&gt;&amp;gt; &#160; &lt;span class=&quot;code-keyword&quot;&gt;inner&lt;/span&gt; join &lt;span class=&quot;code-quote&quot;&gt;&quot;DBS&quot;&lt;/span&gt; on &lt;span class=&quot;code-quote&quot;&gt;&quot;TBLS&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;DB_ID&quot;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&quot;DBS&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;DB_ID&quot;&lt;/span&gt;&#160; &#160; &#160; and &lt;span class=&quot;code-quote&quot;&gt;&quot;DBS&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;NAME&quot;&lt;/span&gt; = &amp;lt;&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;&apos;&lt;/span&gt;&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;inner&lt;/span&gt; join &lt;span class=&quot;code-quote&quot;&gt;&quot;PARTITION_KEY_VALS&quot;&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;FILTER0&quot;&lt;/span&gt; on &lt;span class=&quot;code-quote&quot;&gt;&quot;FILTER0&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;PART_ID&quot;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&quot;PARTITIONS&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;PART_ID&quot;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&quot;FILTER0&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;INTEGER_IDX&quot;&lt;/span&gt; = 0 where &lt;span class=&quot;code-quote&quot;&gt;&quot;DBS&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;CTLG_NAME&quot;&lt;/span&gt; = &amp;lt;&lt;span class=&quot;code-quote&quot;&gt;&apos;hive&apos;&lt;/span&gt;&amp;gt;&#160; and ((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;((&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; when &lt;span class=&quot;code-quote&quot;&gt;&quot;FILTER0&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;PART_KEY_VAL&quot;&lt;/span&gt; &amp;lt;&amp;gt; &amp;lt;&lt;span class=&quot;code-quote&quot;&gt;&apos;__HIVE_DEFAULT_PARTITION__&apos;&lt;/span&gt;&amp;gt; and &lt;span class=&quot;code-quote&quot;&gt;&quot;TBLS&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;TBL_NAME&quot;&lt;/span&gt; = &amp;lt;&lt;span class=&quot;code-quote&quot;&gt;&apos;payments&apos;&lt;/span&gt;&amp;gt; and &lt;span class=&quot;code-quote&quot;&gt;&quot;DBS&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;NAME&quot;&lt;/span&gt; = &amp;lt;&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;&apos;&lt;/span&gt;&amp;gt; and &lt;span class=&quot;code-quote&quot;&gt;&quot;DBS&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;CTLG_NAME&quot;&lt;/span&gt; = &amp;lt;&lt;span class=&quot;code-quote&quot;&gt;&apos;hive&apos;&lt;/span&gt;&amp;gt; and &lt;span class=&quot;code-quote&quot;&gt;&quot;FILTER0&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;PART_ID&quot;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&quot;PARTITIONS&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;PART_ID&quot;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&quot;FILTER0&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;INTEGER_IDX&quot;&lt;/span&gt; = 0 then &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;FILTER0&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;PART_KEY_VAL&quot;&lt;/span&gt; as TIMESTAMP) &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; end) as TIMESTAMP) = &amp;lt;&lt;span class=&quot;code-quote&quot;&gt;&apos;2023-03-26 03:30:00&apos;&lt;/span&gt;&amp;gt;)) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;the filter is cast(&quot;FILTER0&quot;.&quot;PART_KEY_VAL&quot; as TIMESTAMP) else null end) as TIMESTAMP) = &amp;lt;&apos;2023-03-26 03:30:00&apos;&amp;gt;, so if we push a timezone based &amp;lt;&apos;2023-03-26 03:30:00&apos;&amp;gt; and the underlying database can handle cast(&quot;FILTER0&quot;.&quot;PART_KEY_VAL&quot; as TIMESTAMP) else null end) as TIMESTAMP) properly, then we could get the expected result.&lt;/p&gt;

&lt;p&gt;However when I switch the backing db to Postgres, the direct sql throws an exception:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caused by: org.postgresql.util.PSQLException: ERROR: operator does not exist: timestamp without time zone = character varying
&#160; Hint: No operator matches the given name and argument types. You might need to add explicit type casts.
&#160; Position: 662&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;MySQL as well:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.sql.SQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the right syntax to use near &lt;span class=&quot;code-quote&quot;&gt;&apos;TIMESTAMP) &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; end) as TIMESTAMP) = &apos;&lt;/span&gt;2023-03-26 03:30:00&lt;span class=&quot;code-quote&quot;&gt;&apos;))&apos;&lt;/span&gt; at line 1 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So I think we should fix the errors on direct sql path and make the timestamp/date timezone agnostic on JDO path.&lt;/p&gt;</comment>
                            <comment id="17800453" author="wechar" created="Tue, 26 Dec 2023 09:33:08 +0000"  >&lt;p&gt;+1. We also noticed this bug that jdo query would return empty result for timestamp filter in the benchmark test of&#160; &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-27827&quot; title=&quot;Improve performance of direct SQL implement for getPartitionsByFilter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-27827&quot;&gt;&lt;del&gt;HIVE-27827&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17808086" author="zabetak" created="Thu, 18 Jan 2024 08:40:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dengzh&quot; class=&quot;user-hover&quot; rel=&quot;dengzh&quot;&gt;dengzh&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wechar&quot; class=&quot;user-hover&quot; rel=&quot;wechar&quot;&gt;wechar&lt;/a&gt; Have we confirmed that this bug is something that can affect production? It seems that direct SQL returns the correct result so my question is actually the following. Is it possible to disable direct SQL for this code path and hit the JDO bug?&lt;/p&gt;</comment>
                            <comment id="17808855" author="dengzh" created="Sat, 20 Jan 2024 02:27:02 +0000"  >&lt;p&gt;Not sure how many users cloud use timestamp as the type for the partition column, looks like this is a new feature introduced in Hive 4.0.&lt;/p&gt;

&lt;p&gt;From the Jira description, the partition predicate in the query&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SELECT * FROM payments WHERE txn_datetime = &lt;span class=&quot;code-quote&quot;&gt;&apos;2023-03-26 02:30:00&apos;&lt;/span&gt;; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;returns an empty result on direct sql, while a partition(&apos;2023-03-26 02:30:00&apos;) on the JDO, provided the TIMESTAMP data type in Hive is timezone agnostic, so I assume the result from JDO is correct.&lt;/p&gt;

&lt;p&gt;Besides this difference, when I tested the date/timestamp partition column against Postgres and MySQL, there&apos;re some problems:&lt;/p&gt;

&lt;p&gt;Postgres(direct sql):&lt;/p&gt;

&lt;p&gt;operator does not exist: timestamp without time zone = character varying&lt;/p&gt;

&lt;p&gt;MySQL(direct sql):&lt;/p&gt;

&lt;p&gt;You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &apos;TIMESTAMP) else null end) as TIMESTAMP) = &apos;2023-03-26 03:30:00&apos;))&apos; at line 1&#160;&lt;/p&gt;</comment>
                            <comment id="17809883" author="zabetak" created="Tue, 23 Jan 2024 10:43:44 +0000"  >&lt;p&gt;To help advance the resolution of this ticket let&apos;s focus on the issue reported in the description. For sure there are more bugs around this but let&apos;s handle one at the time.&lt;/p&gt;

&lt;p&gt;The bug shows up in the tests cause they use the &lt;tt&gt;VerifyingObjectStore&lt;/tt&gt;. The &lt;tt&gt;VerifyingObjectStore&lt;/tt&gt; is not used in production and that&apos;s why I am asking if there is a way for this bug to manifestate without using this implementation. Typically, if direct SQL returns the correct result then we are not going to go through JDO. IS there a way (via config or otherwise) to bypass the direct SQL mechanism and use JDO exclusively?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17822550" author="dkuzmenko" created="Fri, 1 Mar 2024 12:58:18 +0000"  >&lt;p&gt;Merged to master.&lt;br/&gt;
Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dengzh&quot; class=&quot;user-hover&quot; rel=&quot;dengzh&quot;&gt;dengzh&lt;/a&gt; for the patch!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310760">
                    <name>Testing</name>
                                                                <inwardlinks description="Discovered while testing">
                                        <issuelink>
            <issuekey id="13552399">HIVE-27760</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 36 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ks1c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>