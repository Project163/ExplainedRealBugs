<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:25:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-26018] The result of UNIQUEJOIN on Hive on Tez is inconsistent with that of MR</title>
                <link>https://issues.apache.org/jira/browse/HIVE-26018</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The result of UNIQUEJOIN on Hive on Tez is inconsistent with that of MR, and the result Is not correct, for example:&lt;/p&gt;

&lt;p&gt;CREATE TABLE T1_n1x(key STRING, val STRING) STORED AS orc;&lt;br/&gt;
CREATE TABLE T2_n1x(key STRING, val STRING) STORED AS orc;&lt;/p&gt;

&lt;p&gt;insert into T1_n1x values(&apos;aaa&apos;, &apos;111&apos;),(&apos;bbb&apos;, &apos;222&apos;),(&apos;ccc&apos;, &apos;333&apos;);&lt;br/&gt;
insert into T2_n1x values(&apos;aaa&apos;, &apos;111&apos;),(&apos;ddd&apos;, &apos;444&apos;),(&apos;ccc&apos;, &apos;333&apos;);&lt;/p&gt;

&lt;p&gt;SELECT a.key, b.key FROM UNIQUEJOIN PRESERVE T1_n1x a (a.key), PRESERVE &#160;T2_n1x b (b.key);&lt;/p&gt;

&lt;p&gt;Hive on Tez result: wrong&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a.key &#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;b.key &#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;aaa &#160; &#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;aaa &#160; &#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;bbb &#160; &#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;NULL &#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ccc &#160; &#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ccc &#160; &#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;NULL &#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ddd &#160; &#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&lt;ins&gt;------------------&lt;/ins&gt;&lt;br/&gt;
Hive on MR result: right&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a.key &#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;b.key &#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;aaa &#160; &#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;aaa &#160; &#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;bbb &#160; &#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;NULL &#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ccc &#160; &#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ccc &#160; &#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&lt;ins&gt;-----------------&lt;/ins&gt;&lt;/p&gt;

&lt;p&gt;SELECT a.key, b.key FROM UNIQUEJOIN T1_n1x a (a.key), T2_n1x b (b.key);&lt;/p&gt;

&lt;p&gt;Hive on Tez result: wrong&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;-------------------&lt;/ins&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a.key &#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;b.key &#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;aaa &#160; &#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;aaa &#160; &#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;bbb &#160; &#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;NULL &#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ccc &#160; &#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ccc &#160; &#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;NULL &#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ddd &#160; &#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&lt;ins&gt;-----------------&lt;/ins&gt;&lt;/p&gt;

&lt;p&gt;Hive on MR result: right&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a.key &#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;b.key &#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;aaa &#160; &#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;aaa &#160; &#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ccc &#160; &#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ccc &#160; &#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13432869">HIVE-26018</key>
            <summary>The result of UNIQUEJOIN on Hive on Tez is inconsistent with that of MR</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="seonggon">Seonggon Namgung</assignee>
                                    <reporter username="luguangming">GuangMing Lu</reporter>
                        <labels>
                            <label>hive-4.0.1-merged</label>
                            <label>hive-4.0.1-must</label>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 9 Mar 2022 13:15:08 +0000</created>
                <updated>Tue, 29 Jul 2025 14:51:58 +0000</updated>
                            <resolved>Fri, 28 Jun 2024 08:42:58 +0000</resolved>
                                    <version>3.1.0</version>
                    <version>4.0.0</version>
                                    <fixVersion>4.1.0</fixVersion>
                    <fixVersion>4.0.1</fixVersion>
                                    <component>Tez</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17849421" author="glapark" created="Sat, 25 May 2024 03:02:45 +0000"  >&lt;p&gt;Currently uniquejoin.q passes because it uses MapReduce execution engine. If Tez execution engine is used, uniquejoin.q fails for the same reason described in this JIRA.&lt;/p&gt;

&lt;p&gt;The difference in the outcome is due to different representations of empty rows in MapReduce and Tez. If there is no row for the given key,&lt;/p&gt;

&lt;p&gt;1. MapReduce&apos;s JoinOperator: the storage is empty&lt;br/&gt;
2. Tez&apos;s MapJoinOperator/CommonMergeJoinOperator: the storage contains an dummy row.&lt;/p&gt;

&lt;p&gt;Does anyone still use UNIQUEJOIN in production? This is a correctness issue, so we would like to investigate further if UNIQUEJOIN is still used.&lt;/p&gt;

&lt;p&gt;cc. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=seonggon&quot; class=&quot;user-hover&quot; rel=&quot;seonggon&quot;&gt;seonggon&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17855915" author="glapark" created="Tue, 18 Jun 2024 12:15:41 +0000"  >&lt;p&gt;The correctness issue of unique join is fixed in the pull request. It would be great if someone could review the pull request.&lt;/p&gt;</comment>
                            <comment id="17860755" author="dkuzmenko" created="Fri, 28 Jun 2024 08:42:51 +0000"  >&lt;p&gt;Merged to master.&lt;br/&gt;
Thanks for the fix &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=seonggon&quot; class=&quot;user-hover&quot; rel=&quot;seonggon&quot;&gt;seonggon&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkasa&quot; class=&quot;user-hover&quot; rel=&quot;kkasa&quot;&gt;kkasa&lt;/a&gt; for the review!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 19 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z10bq0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>