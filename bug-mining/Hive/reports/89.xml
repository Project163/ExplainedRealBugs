<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:51:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-285] UNION ALL does not allow different types in the same column</title>
                <link>https://issues.apache.org/jira/browse/HIVE-285</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;explain INSERT OVERWRITE TABLE t
    SELECT s.r, s.c, sum(s.v) FROM
    (
      SELECT a.r AS r, a.c AS c, a.v AS v FROM t1 a
      UNION ALL
      SELECT b.r AS r, b.c AS c, 0 + b.v AS v FROM t2 b
    ) s
    GROUP BY s.r, s.c;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Both a and b have 3 string columns: r, c, and v.&lt;/p&gt;

&lt;p&gt;It compiled successfully but failed during runtime.&lt;br/&gt;
&quot;Explain&quot; shows that the plan for the 2 union-all operands have different output types that are converged to STRING, but there is no UDFToString inserted for &quot;0 + b.v AS v&quot; and as a result, SerDe was failing because it expects a String but is passed a Double.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12414435">HIVE-285</key>
            <summary>UNION ALL does not allow different types in the same column</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rsm">Raghotham Murthy</assignee>
                                    <reporter username="zshao">Zheng Shao</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 Feb 2009 01:49:40 +0000</created>
                <updated>Sat, 17 Dec 2011 00:09:00 +0000</updated>
                            <resolved>Wed, 18 Mar 2009 18:29:49 +0000</resolved>
                                    <version>0.3.0</version>
                    <version>0.6.0</version>
                                    <fixVersion>0.3.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12672112" author="zshao" created="Tue, 10 Feb 2009 01:52:01 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 
ABSTRACT SYNTAX TREE:
  (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_UNION (TOK_QUERY (TOK_FROM (TOK_TABREF t1 a)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF a r) r) (TOK_SELEXPR (TOK_COLREF a c) c) (TOK_SELEXPR (TOK_COLREF a v) v)))) (TOK_QUERY (TOK_FROM (TOK_TABREF t2 b)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF b r) r) (TOK_SELEXPR (TOK_COLREF b c) c) (TOK_SELEXPR (+ 0 (TOK_COLREF b v)) v))))) s)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB t)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF s r)) (TOK_SELEXPR (TOK_COLREF s c)) (TOK_SELEXPR (TOK_FUNCTION sum (TOK_COLREF s v)))) (TOK_GROUPBY (TOK_COLREF s r) (TOK_COLREF s c))))

STAGE DEPENDENCIES:
  Stage-1 is a root stage
  Stage-2 depends on stages: Stage-1
  Stage-0 depends on stages: Stage-2

STAGE PLANS:
  Stage: Stage-1
    Map Reduce
      Alias -&amp;gt; Map Operator Tree:
        &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;-subquery2:s-subquery2:b
            Select Operator
              expressions:
                    expr: r
                    type: string
                    expr: c
                    type: string
                    expr: (UDFToDouble(0) + UDFToDouble(v))
                    type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;
                Reduce Output Operator
                  key expressions:
                        expr: 0
                        type: string
                        expr: 1
                        type: string
                  sort order: ++
                  Map-reduce partition columns:
                        expr: rand()
                        type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;
                  tag: -1
                  value expressions:
                        expr: 2
                        type: string
        &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;-subquery1:s-subquery1:a
            Select Operator
              expressions:
                    expr: r
                    type: string
                    expr: c
                    type: string
                    expr: v
                    type: string
                Reduce Output Operator
                  key expressions:
                        expr: 0
                        type: string
                        expr: 1
                        type: string
                  sort order: ++
                  Map-reduce partition columns:
                        expr: rand()
                        type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;
                  tag: -1
                  value expressions:
                        expr: 2
                        type: string
      Reduce Operator Tree:
        Group By Operator
          aggregations:
                expr: sum(UDFToDouble(VALUE.0))
          keys:
                expr: KEY.0
                type: string
                expr: KEY.1
                type: string
          mode: partial1
          File Output Operator
            compressed: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
            table:
                input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
                name: binary_table

  Stage: Stage-2
    Map Reduce
      Alias -&amp;gt; Map Operator Tree:
        /tmp/hive-zshao/20312763/835544260.10001
          Reduce Output Operator
            key expressions:
                  expr: 0
                  type: string
                  expr: 1
                  type: string
            sort order: ++
            Map-reduce partition columns:
                  expr: 0
                  type: string
                  expr: 1
                  type: string
            tag: -1
            value expressions:
                  expr: 2
                  type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;
      Reduce Operator Tree:
        Group By Operator
          aggregations:
                expr: sum(VALUE.0)
          keys:
                expr: KEY.0
                type: string
                expr: KEY.1
                type: string
          mode: &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt;
          Select Operator
            expressions:
                  expr: 0
                  type: string
                  expr: 1
                  type: string
                  expr: 2
                  type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;
            File Output Operator
              compressed: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
              table:
                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                  output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
                  serde: org.apache.hadoop.hive.serde2.MetadataTypedColumnsetSerDe
                  name: t

  Stage: Stage-0
    Move Operator
      tables:
            replace: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
            table:
                input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                output format: org.apache.hadoop.mapred.SequenceFileOutputFormat
                serde: org.apache.hadoop.hive.serde2.MetadataTypedColumnsetSerDe
                name: t
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 


&lt;p&gt;Note that:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                    expr: (UDFToDouble(0) + UDFToDouble(v))
                    type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;
                    ...
                  value expressions:
                        expr: 2
                        type: string
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12677002" author="rsm" created="Thu, 26 Feb 2009 14:11:47 +0000"  >&lt;p&gt;Union should reject mismatched schemas. genUnionPlan was not checking for types (only number and names of columns). I have now added checking for types as well. Also added a negative test case.&lt;/p&gt;</comment>
                            <comment id="12677149" author="namit" created="Thu, 26 Feb 2009 21:37:57 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;maybe, we can file a extension later on if someone asks for a type conversion in UNION&lt;/p&gt;</comment>
                            <comment id="12680803" author="rsm" created="Wed, 11 Mar 2009 08:40:45 +0000"  >&lt;p&gt;type conversion in UNION will lead to confusing behavior. &lt;/p&gt;

&lt;p&gt;for a query like the following on two tables R(a int) and S(a string)&lt;/p&gt;

&lt;p&gt;select a from R&lt;br/&gt;
union all&lt;br/&gt;
select a from S&lt;/p&gt;

&lt;p&gt;What will the schema of the result of the join be? int or string?&lt;/p&gt;</comment>
                            <comment id="12680911" author="jsensarma" created="Wed, 11 Mar 2009 16:25:54 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12680935" author="prasadc" created="Wed, 11 Mar 2009 17:23:42 +0000"  >&lt;p&gt;i think it will be double. users can use cast to a specific type&lt;/p&gt;</comment>
                            <comment id="12680979" author="athusoo" created="Wed, 11 Mar 2009 18:50:33 +0000"  >&lt;p&gt;Just checked this on Oracle and mysql with Rama..&lt;/p&gt;

&lt;p&gt;Oracle does not do any implict conversion and gives a type mismatch.&lt;/p&gt;

&lt;p&gt;on the other hand&lt;/p&gt;

&lt;p&gt;mysql does an implicit converion to varbinary which I think is equivalent to blob.&lt;/p&gt;

&lt;p&gt;Given that we do not have blobs as data types I am perfectly fine with throwing a type mismatch for now.&lt;/p&gt;</comment>
                            <comment id="12682974" author="rsm" created="Wed, 18 Mar 2009 09:51:15 +0000"  >&lt;p&gt;ping&lt;/p&gt;</comment>
                            <comment id="12682992" author="rsm" created="Wed, 18 Mar 2009 11:11:38 +0000"  >&lt;p&gt;Looks like some other test was creating a table named t2 with a different schema. Dropping the table now.&lt;/p&gt;</comment>
                            <comment id="12683110" author="namit" created="Wed, 18 Mar 2009 17:56:09 +0000"  >&lt;p&gt;running tests now to commit&lt;/p&gt;</comment>
                            <comment id="12683122" author="namit" created="Wed, 18 Mar 2009 18:29:49 +0000"  >&lt;p&gt;committed. Thanks Raghu&lt;/p&gt;</comment>
                            <comment id="12778503" author="akramer" created="Mon, 16 Nov 2009 20:18:31 +0000"  >&lt;p&gt;I am the guy asking for type conversion.&lt;/p&gt;

&lt;p&gt;I think that the right thing to do in all cases with a UNION ALL command is to convert mismatched types to STRING.&lt;/p&gt;

&lt;p&gt;The main argument for this is that the output of a UNION ALL is never actually used for anything-&lt;del&gt;it must be wrapped in a SELECT statement which will then make use of the columns. If the SELECT statement selects the UNIONed item as a string (say, for output to local directory or the terminal) everything is converted to string anyway&lt;/del&gt;-or if not, it&apos;s used in a way that would cause one or both of the original column types to be converted in some way...and conversion to STRING and back does not lose information.&lt;/p&gt;

&lt;p&gt;Certainly, data should stay in the appropriate type if possible, though. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12415297">HIVE-297</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12401045" name="hive-285.1.patch" size="1892" author="rsm" created="Thu, 26 Feb 2009 14:11:47 +0000"/>
                            <attachment id="12402475" name="hive-285.2.patch" size="1945" author="rsm" created="Wed, 18 Mar 2009 11:11:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73646</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 2 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0l8y7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>122100</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>