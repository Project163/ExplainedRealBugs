<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:22:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-26350] IndexOutOfBoundsException when generating splits for external JDBC table with partition columns</title>
                <link>https://issues.apache.org/jira/browse/HIVE-26350</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Create the following table in some JDBC database (e.g., Postgres).&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; country
(
    id   &lt;span class=&quot;code-keyword&quot;&gt;int&lt;/span&gt;,
    &lt;span class=&quot;code-keyword&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;varchar&lt;/span&gt;(20)
);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Create the following tables in Hive ensuring that the external JDBC table has the &lt;tt&gt;hive.sql.partitionColumn&lt;/tt&gt; table property set.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; city (id &lt;span class=&quot;code-keyword&quot;&gt;int&lt;/span&gt;);

&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;EXTERNAL&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; country
(
    id &lt;span class=&quot;code-keyword&quot;&gt;int&lt;/span&gt;,
    &lt;span class=&quot;code-keyword&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;varchar&lt;/span&gt;(20)
)
STORED &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt;                                          
&lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.hive.&lt;span class=&quot;code-keyword&quot;&gt;storage&lt;/span&gt;.jdbc.JdbcStorageHandler&apos;&lt;/span&gt;
TBLPROPERTIES (                                    
    &lt;span class=&quot;code-quote&quot;&gt;&quot;hive.&lt;span class=&quot;code-keyword&quot;&gt;sql&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;database&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;type&lt;/span&gt;&quot;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&quot;POSTGRES&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;hive.&lt;span class=&quot;code-keyword&quot;&gt;sql&lt;/span&gt;.jdbc.driver&quot;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&quot;org.postgresql.Driver&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;hive.&lt;span class=&quot;code-keyword&quot;&gt;sql&lt;/span&gt;.jdbc.url&quot;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:postgresql://localhost:5432/qtestDB&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;hive.&lt;span class=&quot;code-keyword&quot;&gt;sql&lt;/span&gt;.dbcp.username&quot;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&quot;qtestuser&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;hive.&lt;span class=&quot;code-keyword&quot;&gt;sql&lt;/span&gt;.dbcp.&lt;span class=&quot;code-keyword&quot;&gt;password&lt;/span&gt;&quot;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&quot;qtestpassword&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;hive.&lt;span class=&quot;code-keyword&quot;&gt;sql&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;table&lt;/span&gt;&quot;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&quot;country&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;hive.&lt;span class=&quot;code-keyword&quot;&gt;sql&lt;/span&gt;.partitionColumn&quot;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;name&lt;/span&gt;&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;hive.&lt;span class=&quot;code-keyword&quot;&gt;sql&lt;/span&gt;.numPartitions&quot;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;
);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The query below fails with IndexOutOfBoundsException when the mapper scanning the JDBC table tries to generate the splits by exploiting the partitioning column.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; country.id &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; country &lt;span class=&quot;code-keyword&quot;&gt;cross&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;join&lt;/span&gt; city;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The full stack trace is given below.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.IndexOutOfBoundsException: Index: 1, Size: 1
        at java.util.ArrayList.rangeCheck(ArrayList.java:659) ~[?:1.8.0_261]
        at java.util.ArrayList.get(ArrayList.java:435) ~[?:1.8.0_261]
        at org.apache.hive.storage.jdbc.JdbcInputFormat.getSplits(JdbcInputFormat.java:102) [hive-jdbc-handler-4.0.0-alpha-2-SNAPSHOT.jar:4.0.0-alpha-2-SNAPSHOT]
        at org.apache.hadoop.hive.ql.io.HiveInputFormat.addSplitsForGroup(HiveInputFormat.java:564) [hive-exec-4.0.0-alpha-2-SNAPSHOT.jar:4.0.0-alpha-2-SNAPSHOT]
        at org.apache.hadoop.hive.ql.io.HiveInputFormat.getSplits(HiveInputFormat.java:858) [hive-exec-4.0.0-alpha-2-SNAPSHOT.jar:4.0.0-alpha-2-SNAPSHOT]
        at org.apache.hadoop.hive.ql.exec.tez.HiveSplitGenerator.initialize(HiveSplitGenerator.java:263) [hive-exec-4.0.0-alpha-2-SNAPSHOT.jar:4.0.0-alpha-2-SNAPSHOT]
        at org.apache.tez.dag.app.dag.RootInputInitializerManager$InputInitializerCallable$1.run(RootInputInitializerManager.java:281) [tez-dag-0.10.1.jar:0.10.1]
        at org.apache.tez.dag.app.dag.RootInputInitializerManager$InputInitializerCallable$1.run(RootInputInitializerManager.java:272) [tez-dag-0.10.1.jar:0.10.1]
        at java.security.AccessController.doPrivileged(Native Method) ~[?:1.8.0_261]
        at javax.security.auth.Subject.doAs(Subject.java:422) [?:1.8.0_261]
        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1682) [hadoop-common-3.1.0.jar:?]
        at org.apache.tez.dag.app.dag.RootInputInitializerManager$InputInitializerCallable.call(RootInputInitializerManager.java:272) [tez-dag-0.10.1.jar:0.10.1]
        at org.apache.tez.dag.app.dag.RootInputInitializerManager$InputInitializerCallable.call(RootInputInitializerManager.java:256) [tez-dag-0.10.1.jar:0.10.1]
        at com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:108) [guava-19.0.jar:?]
        at com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:41) [guava-19.0.jar:?]
        at com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:77) [guava-19.0.jar:?]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_261]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_261]
        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_261]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13458595">HIVE-26350</key>
            <summary>IndexOutOfBoundsException when generating splits for external JDBC table with partition columns</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zabetak">Stamatis Zampetakis</assignee>
                                    <reporter username="zabetak">Stamatis Zampetakis</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 22 Jun 2022 15:09:17 +0000</created>
                <updated>Wed, 16 Nov 2022 13:50:12 +0000</updated>
                            <resolved>Tue, 2 Aug 2022 10:57:06 +0000</resolved>
                                                    <fixVersion>4.0.0-alpha-2</fixVersion>
                                    <component>CBO</component>
                    <component>JDBC storage handler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4800">1h 20m</timespent>
                                <comments>
                            <comment id="17557514" author="zabetak" created="Wed, 22 Jun 2022 15:15:14 +0000"  >&lt;p&gt;A qtest reproducer is attached in  &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13045461/13045461_jdbc_join_with_partition_table.q&quot; title=&quot;jdbc_join_with_partition_table.q attached to HIVE-26350&quot;&gt;jdbc_join_with_partition_table.q&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;.  The problem can be reproduced by running:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;mvn test -Dtest=TestMiniLlapLocalCliDriver -Dqfile=jdbc_join_with_partition_table.q -Dtest.output.overwrite
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17557529" author="zabetak" created="Wed, 22 Jun 2022 15:30:25 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;HiveProject(id=[$0])
      HiveJdbcConverter(convention=[JDBC.POSTGRES])
        JdbcProject(id=[$0])
          JdbcHiveTableScan(table=[[default, country]], table:alias=[country])
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem seems to start from the subplan above and the fact that HiveProject is executed in the same mapper with the Jdbc operators. It appears that due to the projection the column type list has one entry (int) &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
List&amp;lt;TypeInfo&amp;gt; hiveColumnTypesList = TypeInfoUtils.getTypeInfosFromTypeString(job.get(serdeConstants.LIST_COLUMN_TYPES));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and basically does not contain the partitioning column leading to the &lt;tt&gt;IndexOutOfBoundsException&lt;/tt&gt; when we attempt to find its type.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
TypeInfo typeInfo = hiveColumnTypesList.get(columnNames.indexOf(partitionColumn));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="17574175" author="zabetak" created="Tue, 2 Aug 2022 10:57:06 +0000"  >&lt;p&gt;Fixed in &lt;a href=&quot;https://github.com/apache/hive/commit/a0c500ba668a74be4acafaf76a4b94eb5353268c.&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/commit/a0c500ba668a74be4acafaf76a4b94eb5353268c.&lt;/a&gt; Thanks for the initial patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=soumyakanti.das&quot; class=&quot;user-hover&quot; rel=&quot;soumyakanti.das&quot;&gt;soumyakanti.das&lt;/a&gt; and for the reviews &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=amansinha100&quot; class=&quot;user-hover&quot; rel=&quot;amansinha100&quot;&gt;amansinha100&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkasa&quot; class=&quot;user-hover&quot; rel=&quot;kkasa&quot;&gt;kkasa&lt;/a&gt; !&lt;/p&gt;</comment>
                            <comment id="17576971" author="zabetak" created="Mon, 8 Aug 2022 20:00:15 +0000"  >&lt;p&gt;The tests added as part of the fix require a recent version of H2 (&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-25945&quot; title=&quot;Upgrade H2 database version to 2.1.210&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-25945&quot;&gt;&lt;del&gt;HIVE-25945&lt;/del&gt;&lt;/a&gt;) in order to function properly.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="13427600">HIVE-25945</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13045459" name="cbo_plan.txt" size="395" author="zabetak" created="Wed, 22 Jun 2022 15:11:23 +0000"/>
                            <attachment id="13045460" name="explain_plan.txt" size="2868" author="zabetak" created="Wed, 22 Jun 2022 15:11:23 +0000"/>
                            <attachment id="13045461" name="jdbc_join_with_partition_table.q" size="721" author="zabetak" created="Wed, 22 Jun 2022 15:13:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 14 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z14obc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12351489">4.0.0-alpha-2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>