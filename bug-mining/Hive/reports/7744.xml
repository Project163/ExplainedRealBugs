<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:18:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-23454] Querying hive table which has Materialized view fails with HiveAccessControlException</title>
                <link>https://issues.apache.org/jira/browse/HIVE-23454</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Query fails with HiveAccessControlException against table when there is  Materialized view pointing to that table which end user does not have access to, but the actual table user has all the privileges.&lt;/p&gt;

&lt;p&gt;From the HiveServer2 logs - it looks as part of optimization Hive uses materialized view to query the data instead of table and since end user does not have access on MV we receive HiveAccessControlException.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hive/blob/master/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/cost/HiveVolcanoPlanner.java#L99&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/blob/master/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/cost/HiveVolcanoPlanner.java#L99&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The Simplest reproducer for this issue is as below.&lt;br/&gt;
1. Create a table using hive user and insert some data&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
create table db1.testmvtable(id &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, name string) partitioned by(year &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);
insert into db1.testmvtable partition(year=2020) values(1,&lt;span class=&quot;code-quote&quot;&gt;&apos;Name1&apos;&lt;/span&gt;);
insert into db1.testmvtable partition(year=2020) values(1,&lt;span class=&quot;code-quote&quot;&gt;&apos;Name2&apos;&lt;/span&gt;);
insert into db1.testmvtable partition(year=2016) values(1,&lt;span class=&quot;code-quote&quot;&gt;&apos;Name1&apos;&lt;/span&gt;);
insert into db1.testmvtable partition(year=2016) values(1,&lt;span class=&quot;code-quote&quot;&gt;&apos;Name2&apos;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;2. Create Materialized view on top of above table with partitioned and where clause as hive user.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CREATE MATERIALIZED VIEW db2.testmv PARTITIONED ON(year) as select * from db1.testmvtable tmv where year &amp;gt;= 2018;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3. Grant all (Select to be minimum) access to user &apos;chiran&apos; via Ranger on database db1.&lt;/p&gt;

&lt;p&gt;4. Run select on base table db1.testmvtable as &apos;chiran&apos; with where clause having partition value &amp;gt;=2018, it runs into HiveAccessControlException on db2.testmv&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
eg:- (select * from db1.testmvtable where year=2020;)
0: jdbc:hive2:&lt;span class=&quot;code-comment&quot;&gt;//node2&amp;gt; select * from db1.testmvtable where year=2020;
&lt;/span&gt;Error: Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; compiling statement: FAILED: HiveAccessControlException Permission denied: user [chiran] does not have [SELECT] privilege on [db2/testmv/*] (state=42000,code=40000)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;5. This works when partition column is not in MV&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
0: jdbc:hive2:&lt;span class=&quot;code-comment&quot;&gt;//node2&amp;gt; select * from db1.testmvtable where year=2016;
&lt;/span&gt;DEBUG : Acquired the compile lock.
INFO  : Compiling command(queryId=hive_20200507130248_841458fe-7048-4727-8816-3f9472d2a67a): select * from db1.testmvtable where year=2016
DEBUG : Encoding valid txns info 897:9223372036854775807::893,895,896 txnid:897
INFO  : Semantic Analysis Completed (retrial = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
INFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:testmvtable.id, type:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, comment:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;), FieldSchema(name:testmvtable.name, type:string, comment:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;), FieldSchema(name:testmvtable.year, type:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, comment:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)], properties:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
INFO  : Completed compiling command(queryId=hive_20200507130248_841458fe-7048-4727-8816-3f9472d2a67a); Time taken: 0.222 seconds
DEBUG : Encoding valid txn write ids info 897$db1.testmvtable:4:9223372036854775807:: txnid:897
INFO  : Executing command(queryId=hive_20200507130248_841458fe-7048-4727-8816-3f9472d2a67a): select * from db1.testmvtable where year=2016
INFO  : Completed executing command(queryId=hive_20200507130248_841458fe-7048-4727-8816-3f9472d2a67a); Time taken: 0.008 seconds
INFO  : OK
DEBUG : Shutting down query select * from db1.testmvtable where year=2016
+-----------------+-------------------+-------------------+
| testmvtable.id  | testmvtable.name  | testmvtable.year  |
+-----------------+-------------------+-------------------+
| 1               | Name1             | 2016              |
| 1               | Name2             | 2016              |
+-----------------+-------------------+-------------------+
2 rows selected (0.302 seconds)
0: jdbc:hive2:&lt;span class=&quot;code-comment&quot;&gt;//node2&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13304428">HIVE-23454</key>
            <summary>Querying hive table which has Materialized view fails with HiveAccessControlException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vgarg">Vineet Garg</assignee>
                                    <reporter username="chiran54321">Chiran Ravani</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 12 May 2020 18:22:12 +0000</created>
                <updated>Thu, 17 Nov 2022 08:47:42 +0000</updated>
                            <resolved>Tue, 15 Sep 2020 16:13:41 +0000</resolved>
                                    <version>3.0.0</version>
                    <version>3.2.0</version>
                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                                    <component>Authorization</component>
                    <component>HiveServer2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="5400">1.5h</timespent>
                                <comments>
                            <comment id="17189573" author="vgarg" created="Wed, 2 Sep 2020 17:27:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nisgoel&quot; class=&quot;user-hover&quot; rel=&quot;nisgoel&quot;&gt;nisgoel&lt;/a&gt;&#160;Are you working on this? If you aren&apos;t I would like to take it over.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 11 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0engg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>