<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:49:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-15355] Concurrency issues during parallel moveFile due to HDFSUtils.setFullFileStatus</title>
                <link>https://issues.apache.org/jira/browse/HIVE-15355</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;It is possible to run into concurrency issues during multi-threaded moveFile issued when processing queries like &lt;tt&gt;INSERT OVERWRITE TABLE ... SELECT ..&lt;/tt&gt; when there are multiple files in the staging directory which is a subdirectory of the target directory. The issue is hard to reproduce but following stacktrace is one such example:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;INFO  : Loading data to table functional_text_gzip.alltypesaggmultifilesnopart from hdfs://localhost:20500/test-warehouse/alltypesaggmultifilesnopart_text_gzip/.hive-staging_hive_2016-12-01_19-58-21_712_8968735301422943318-1/-ext-10000
ERROR : Failed with exception java.lang.ArrayIndexOutOfBoundsException
org.apache.hadoop.hive.ql.metadata.HiveException: java.lang.ArrayIndexOutOfBoundsException
        at org.apache.hadoop.hive.ql.metadata.Hive.moveFile(Hive.java:2858)
        at org.apache.hadoop.hive.ql.metadata.Hive.replaceFiles(Hive.java:3124)
        at org.apache.hadoop.hive.ql.metadata.Hive.loadTable(Hive.java:1701)
        at org.apache.hadoop.hive.ql.exec.MoveTask.execute(MoveTask.java:313)
        at org.apache.hadoop.hive.ql.exec.Task.executeTask(Task.java:214)
        at org.apache.hadoop.hive.ql.exec.TaskRunner.runSequential(TaskRunner.java:100)
        at org.apache.hadoop.hive.ql.Driver.launchTask(Driver.java:1976)
        at org.apache.hadoop.hive.ql.Driver.execute(Driver.java:1689)
        at org.apache.hadoop.hive.ql.Driver.runInternal(Driver.java:1421)
        at org.apache.hadoop.hive.ql.Driver.run(Driver.java:1205)
        at org.apache.hadoop.hive.ql.Driver.run(Driver.java:1200)
        at org.apache.hive.service.cli.operation.SQLOperation.runQuery(SQLOperation.java:237)
        at org.apache.hive.service.cli.operation.SQLOperation.access$300(SQLOperation.java:88)
        at org.apache.hive.service.cli.operation.SQLOperation$3$1.run(SQLOperation.java:293)
        at java.security.AccessController.doPrivileged(Native Method)
        at javax.security.auth.Subject.doAs(Subject.java:415)
        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1796)
Getting log thread is interrupted, since query is done!
        at org.apache.hive.service.cli.operation.SQLOperation$3.run(SQLOperation.java:306)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
        at java.util.concurrent.FutureTask.run(FutureTask.java:262)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
        at java.lang.Thread.run(Thread.java:745)
Caused by: java.lang.ArrayIndexOutOfBoundsException
        at java.lang.System.arraycopy(Native Method)
        at java.util.ArrayList.removeRange(ArrayList.java:616)
        at java.util.ArrayList$SubList.removeRange(ArrayList.java:1021)
        at java.util.AbstractList.clear(AbstractList.java:234)
        at com.google.common.collect.Iterables.removeIfFromRandomAccessList(Iterables.java:213)
        at com.google.common.collect.Iterables.removeIf(Iterables.java:184)
        at org.apache.hadoop.hive.shims.Hadoop23Shims.removeBaseAclEntries(Hadoop23Shims.java:865)
        at org.apache.hadoop.hive.shims.Hadoop23Shims.setFullFileStatus(Hadoop23Shims.java:757)
        at org.apache.hadoop.hive.ql.metadata.Hive$3.call(Hive.java:2835)
        at org.apache.hadoop.hive.ql.metadata.Hive$3.call(Hive.java:2828)
        ... 4 more

ERROR : FAILED: Execution Error, return code 1 from org.apache.hadoop.hive.ql.exec.MoveTask
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Quick online search also shows some other instances like the one mentioned in &lt;a href=&quot;http://stackoverflow.com/questions/38900333/get-concurrentmodificationexception-in-step-2-create-intermediate-flat-hive-tab&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/38900333/get-concurrentmodificationexception-in-step-2-create-intermediate-flat-hive-tab&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The issue seems to be coming from the below code :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (aclEnabled) {
      aclStatus =  sourceStatus.getAclStatus();
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (aclStatus != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        LOG.trace(aclStatus.toString());
        aclEntries = aclStatus.getEntries();
        removeBaseAclEntries(aclEntries);

        &lt;span class=&quot;code-comment&quot;&gt;//the ACL api&apos;s also expect the tradition user/group/other permission in the form of ACL
&lt;/span&gt;        aclEntries.add(newAclEntry(AclEntryScope.ACCESS, AclEntryType.USER, sourcePerm.getUserAction()));
        aclEntries.add(newAclEntry(AclEntryScope.ACCESS, AclEntryType.GROUP, sourcePerm.getGroupAction()));
        aclEntries.add(newAclEntry(AclEntryScope.ACCESS, AclEntryType.OTHER, sourcePerm.getOtherAction()));
      }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;removeBaseAclEntries removes objects from &lt;tt&gt;List&amp;lt;AclEntry&amp;gt; aclEntries&lt;/tt&gt; When HDFSUtils.setFullFileStatus() method is called from multiple threads like from &lt;a href=&quot;https://github.com/apache/hive/blob/master/ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java#L2835&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/blob/master/ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java#L2835&lt;/a&gt; it is possible that multiple threads try to modify the &lt;tt&gt;List&amp;lt;AclEntry&amp;gt; aclEntries&lt;/tt&gt; leading to concurrency issues. &lt;/p&gt;

&lt;p&gt;We should either move that block into a thread-safe region or call setFullFileStatus when all the threads converge.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13025446">HIVE-15355</key>
            <summary>Concurrency issues during parallel moveFile due to HDFSUtils.setFullFileStatus</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vihangk1">Vihang Karajgaonkar</assignee>
                                    <reporter username="vihangk1">Vihang Karajgaonkar</reporter>
                        <labels>
                    </labels>
                <created>Sun, 4 Dec 2016 21:47:54 +0000</created>
                <updated>Wed, 20 Feb 2019 11:57:06 +0000</updated>
                            <resolved>Tue, 6 Dec 2016 20:58:50 +0000</resolved>
                                    <version>2.1.0</version>
                    <version>2.2.0</version>
                                    <fixVersion>2.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="15720961" author="rajesh.balamohan" created="Mon, 5 Dec 2016 01:46:47 +0000"  >&lt;p&gt;Thanks for reporting the issue &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vihangk1&quot; class=&quot;user-hover&quot; rel=&quot;vihangk1&quot;&gt;vihangk1&lt;/a&gt;. &quot;aclEntries&quot; can be precomputed for the destination file status and can be passed on to &quot;HdfsUtils.setFullFileStatus&quot; with minor refactoring.&lt;/p&gt;</comment>
                            <comment id="15722637" author="vihangk1" created="Mon, 5 Dec 2016 16:10:50 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rajesh.balamohan&quot; class=&quot;user-hover&quot; rel=&quot;rajesh.balamohan&quot;&gt;rajesh.balamohan&lt;/a&gt; for the suggestion. I had a similar solution which worked fine in our testing. I had created a synchronized method in Hadoop23Shims which gets a copy of aclEntries and setFullFileStatus calls it. I think your solution may be better. I will try it out and create a patch for it today. &lt;/p&gt;</comment>
                            <comment id="15723457" author="vihangk1" created="Mon, 5 Dec 2016 21:45:03 +0000"  >&lt;p&gt;Attaching the patch for the issue. The patch uses an idea similar to what &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rajesh.balamohan&quot; class=&quot;user-hover&quot; rel=&quot;rajesh.balamohan&quot;&gt;rajesh.balamohan&lt;/a&gt; suggested but instead of passing a copy of List&amp;lt;AclEntry&amp;gt; to &lt;tt&gt;setFullFileStatus&lt;/tt&gt;, the list is derived from within the method itself. Passing the List&amp;lt;AclEntry&amp;gt; might not be very helpful considering that it is possible to still access it from &lt;tt&gt;sourceStatus.getAclStatus().getEntries()&lt;/tt&gt;. Also, &lt;tt&gt;sourceStatus&lt;/tt&gt; argument cannot be removed since it is required for obtaining other information from within the method.&lt;/p&gt;</comment>
                            <comment id="15723583" author="stakiar" created="Mon, 5 Dec 2016 22:34:31 +0000"  >&lt;p&gt;Some comments:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Is &lt;tt&gt;Collections.unmodifiableList(...)&lt;/tt&gt; null safe, what happens if &lt;tt&gt;aclStatus.getEntries()&lt;/tt&gt; returns null&lt;/li&gt;
	&lt;li&gt;Test &lt;tt&gt;HdfsUtils.HadoopStatus.getAclEntries()&lt;/tt&gt; could be as simple as invoking the method, trying the modify it, and then expecting an &lt;tt&gt;UnsupportedOperationException&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Tests for &lt;tt&gt;HdfsUtils.setFullFileStatus&lt;/tt&gt; may be trickier, one idea is to pass in a mock &lt;tt&gt;HadoopFileStatus&lt;/tt&gt; and ensure that &lt;tt&gt;getAclEntries&lt;/tt&gt; is invoked, but not &lt;tt&gt;getAclStatus().getEntries()&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15723636" author="vihangk1" created="Mon, 5 Dec 2016 22:53:40 +0000"  >&lt;p&gt;&lt;tt&gt;Collections.unmodifiableList(...)&lt;/tt&gt; is not null safe but &lt;tt&gt;aclStatus.getEntries()&lt;/tt&gt; should never return null. AclStatus objects can only be created using &lt;tt&gt;AclStatus.Builder&lt;/tt&gt; class and it initializes entries to a newArrayList(). I can add the check if you think its still a good idea but seems like a redundant check to me.&lt;/p&gt;

&lt;p&gt;I will look into the testing ideas you gave above. Thanks a lot.&lt;/p&gt;</comment>
                            <comment id="15724006" author="hiveqa" created="Tue, 6 Dec 2016 01:52:06 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12841819/HIVE-15355.01.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12841819/HIVE-15355.01.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 8 failed/errored test(s), 10766 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample2] (batchId=5)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample4] (batchId=15)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample6] (batchId=61)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample7] (batchId=60)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample9] (batchId=38)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[transform_ppr2] (batchId=134)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[stats_based_fetch_decision] (batchId=150)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_2] (batchId=92)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/2426/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/2426/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/2426/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/2426/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-2426/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-2426/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 8 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12841819 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15724353" author="vihangk1" created="Tue, 6 Dec 2016 04:53:44 +0000"  >&lt;p&gt;Updating the patch with a simple test case to check that AclEntries within HadoopFileStatus is unmodifiable. This will prevent inadvertent  future code changes which directly try to modify List&amp;lt;AclEntries&amp;gt; from setFullFileStatus.&lt;/p&gt;

&lt;p&gt;Also, checked the test failures above. They seem be to be unrelated since they are failing without the patch on the master too. Also, some of the other recent JIRAs also show the same test failures.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rajesh.balamohan&quot; class=&quot;user-hover&quot; rel=&quot;rajesh.balamohan&quot;&gt;rajesh.balamohan&lt;/a&gt; Can you please review the patch? Thanks.&lt;/p&gt;</comment>
                            <comment id="15724815" author="hiveqa" created="Tue, 6 Dec 2016 08:38:20 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12841883/HIVE-15355.02.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12841883/HIVE-15355.02.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 9 failed/errored test(s), 10769 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[auto_sortmerge_join_2] (batchId=44)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample2] (batchId=5)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample4] (batchId=15)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample6] (batchId=61)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample7] (batchId=60)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[sample9] (batchId=38)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver[transform_ppr2] (batchId=134)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[columnstats_part_coltype] (batchId=149)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[stats_based_fetch_decision] (batchId=150)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/2435/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/2435/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/2435/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/2435/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-2435/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-2435/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 9 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12841883 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15726055" author="spena" created="Tue, 6 Dec 2016 17:01:02 +0000"  >&lt;p&gt;The patch looks good. I see you are creating a copy of &lt;tt&gt;List&amp;lt;AclEntry&amp;gt;&lt;/tt&gt; so that it is modified only by the thread calling &lt;tt&gt;setFullFileStatus&lt;/tt&gt;. This avoids concurrency issues.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;The tests are not related. I had issues with them in another patch.&lt;/p&gt;</comment>
                            <comment id="15726275" author="vihangk1" created="Tue, 6 Dec 2016 18:20:18 +0000"  >&lt;p&gt;Thanks for the review &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15726688" author="spena" created="Tue, 6 Dec 2016 20:58:50 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vihangk1&quot; class=&quot;user-hover&quot; rel=&quot;vihangk1&quot;&gt;vihangk1&lt;/a&gt; for your contribution. I committed this patch to master.&lt;/p&gt;</comment>
                            <comment id="16331356" author="sershe" created="Thu, 18 Jan 2018 22:37:16 +0000"  >&lt;p&gt;Hmm... doesn&apos;t the latest patch have a race because the list is accessed twice, so it can be changed to null after the null check?&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+      if (sourceStatus.getAclEntries() != null) {
+        LOG.trace(sourceStatus.aclStatus.toString());
+        aclEntries = new ArrayList&amp;lt;&amp;gt;(sourceStatus.getAclEntries());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16333619" author="vihangk1" created="Sun, 21 Jan 2018 18:17:59 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt; Do you mean &lt;tt&gt;if (sourceStatus.getAclEntries() != null) }} check? If you look at the implementation of {{HadoopFileStatus&lt;/tt&gt; its the aclEntries is derived from &lt;tt&gt;aclStatus&lt;/tt&gt; which is a final member of the object and it returns a unmodifiable collection. Can you give an example of the race condition? Also, interestingly enough, I don&apos;t see the code which calls this method in parallel now. Not sure if some patch changed the parallel implementation later.&lt;/p&gt;</comment>
                            <comment id="16334790" author="sershe" created="Mon, 22 Jan 2018 19:38:59 +0000"  >&lt;p&gt;This bugfix seems to imply that aclStatus can change; calling sourceStatus.getAclEntries() twice may return lists derived from different aclStatus.&lt;br/&gt;
So, if ... gets some list, background thread sets aclStatus to null, so aclEntries = ... line gets the null value.&lt;/p&gt;</comment>
                            <comment id="16772944" author="dhirensk@gmail.com" created="Wed, 20 Feb 2019 11:57:06 +0000"  >&lt;p&gt;Hi, We are having this issue in Hive 1.2.1.2.5 as well. Dont know if the patch is going to be applicable for our case, appreciate any possible workarounds.&lt;/p&gt;

&lt;p&gt;Caused by: java.util.ConcurrentModificationException&lt;br/&gt;
&#160;&#160; &#160;at java.util.ArrayList$SubList.checkForComodification(ArrayList.java:1231)&lt;br/&gt;
&#160;&#160; &#160;at java.util.ArrayList$SubList.removeRange(ArrayList.java:1062)&lt;br/&gt;
&#160;&#160; &#160;at java.util.AbstractList.clear(AbstractList.java:234)&lt;br/&gt;
&#160;&#160; &#160;at com.google.common.collect.Iterables.removeIfFromRandomAccessList(Iterables.java:209)&lt;br/&gt;
&#160;&#160; &#160;at com.google.common.collect.Iterables.removeIf(Iterables.java:180)&lt;br/&gt;
&#160;&#160; &#160;at org.apache.hadoop.hive.shims.Hadoop23Shims.removeBaseAclEntries(Hadoop23Shims.java:855)&lt;br/&gt;
&#160;&#160; &#160;at org.apache.hadoop.hive.shims.Hadoop23Shims.setFullFileStatus(Hadoop23Shims.java:751)&lt;br/&gt;
&#160;&#160; &#160;at org.apache.hadoop.hive.ql.metadata.Hive$2.call(Hive.java:2625)&lt;br/&gt;
&#160;&#160; &#160;at org.apache.hadoop.hive.ql.metadata.Hive$2.call(Hive.java:2611)&lt;br/&gt;
&#160;&#160; &#160;... 4 more&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12841819" name="HIVE-15355.01.patch" size="2042" author="vihangk1" created="Mon, 5 Dec 2016 21:45:03 +0000"/>
                            <attachment id="12841883" name="HIVE-15355.02.patch" size="6389" author="vihangk1" created="Tue, 6 Dec 2016 04:53:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 39 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i374z3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>