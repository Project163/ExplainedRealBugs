<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:06:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-4315] enable doAs in unsecure mode for hive server2, when MR job runs locally</title>
                <link>https://issues.apache.org/jira/browse/HIVE-4315</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;When MR job is run locally by hive (instead of hadoop cluster), the MR job ends up running as hiveserver user instead of the user submitting the query, even if doAs configuration is enabled.&lt;/p&gt;

&lt;p&gt;In case of map-side join (see &lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/MapJoinOptimization&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;map join optimization&lt;/a&gt;) , MapredLocalTask is spawned in child process to process the map-side file before adding it to distributed cache. When hive.server2.enable.doAs is enabled, MapredLocalTask should run as the user submitting the query. But by default, in case of unsecure (ie without kerberos security) mode hadoop considers user the process runs as the user.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12641514">HIVE-4315</key>
            <summary>enable doAs in unsecure mode for hive server2, when MR job runs locally</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thejas">Thejas Nair</assignee>
                                    <reporter username="thejas">Thejas Nair</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Apr 2013 02:35:53 +0000</created>
                <updated>Thu, 16 May 2013 21:10:02 +0000</updated>
                            <resolved>Tue, 16 Apr 2013 14:36:46 +0000</resolved>
                                                    <fixVersion>0.11.0</fixVersion>
                                    <component>HiveServer2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13631526" author="thejas" created="Mon, 15 Apr 2013 06:15:30 +0000"  >&lt;p&gt;The patch sets HADOOP_USER_NAME env variable, so that in unsecure mode, the effective user for hadoop is the user submitting the query.&lt;/p&gt;</comment>
                            <comment id="13631989" author="ashutoshc" created="Mon, 15 Apr 2013 18:31:16 +0000"  >&lt;p&gt;I think &lt;tt&gt;if(isSecureImpl)&lt;/tt&gt; is not required.&lt;/p&gt;

&lt;p&gt;Also, it will be pretty hard to write a testcase for this, so can you describe in a bit more detail the setup and query where this might manifest. Using that description, if someone later hits this same bug and search jiras, they will know which hive version contains this fix.&lt;/p&gt;</comment>
                            <comment id="13632207" author="thejas" created="Mon, 15 Apr 2013 21:16:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think if(isSecureImpl) is not required.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, you are right, it does not matter if it is security enabled. Will update the patch.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;.. so can you describe in a bit more detail the setup and query where this might manifest.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Updated the description. Do let me know if any other details need to be added.&lt;/p&gt;</comment>
                            <comment id="13632240" author="thejas" created="Mon, 15 Apr 2013 21:44:42 +0000"  >&lt;p&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4315&quot; title=&quot;enable doAs in unsecure mode for hive server2, when MR job runs locally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4315&quot;&gt;&lt;del&gt;HIVE-4315&lt;/del&gt;&lt;/a&gt;.2.patch - removed  if(shim.isSecureShimImpl()), added comments&lt;/p&gt;</comment>
                            <comment id="13632258" author="ashutoshc" created="Mon, 15 Apr 2013 21:55:35 +0000"  >&lt;p&gt;Thanks Thejas for providing more details.&lt;br/&gt;
+1 will commit if tests pass.&lt;/p&gt;</comment>
                            <comment id="13632879" author="ashutoshc" created="Tue, 16 Apr 2013 14:36:46 +0000"  >&lt;p&gt;Committed to trunk and 0.11. Thanks, Thejas!&lt;/p&gt;</comment>
                            <comment id="13633054" author="hudson" created="Tue, 16 Apr 2013 17:41:15 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #162 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/162/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/162/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4315&quot; title=&quot;enable doAs in unsecure mode for hive server2, when MR job runs locally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4315&quot;&gt;&lt;del&gt;HIVE-4315&lt;/del&gt;&lt;/a&gt; : enable doAs in unsecure mode for hive server2, when MR job runs locally (Thejas Nair via Ashutosh Chauhan) (Revision 1468438)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
hashutosh : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1468438&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1468438&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/MapredLocalTask.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13633653" author="hudson" created="Wed, 17 Apr 2013 01:28:42 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #2067 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/2067/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/2067/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4315&quot; title=&quot;enable doAs in unsecure mode for hive server2, when MR job runs locally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4315&quot;&gt;&lt;del&gt;HIVE-4315&lt;/del&gt;&lt;/a&gt; : enable doAs in unsecure mode for hive server2, when MR job runs locally (Thejas Nair via Ashutosh Chauhan) (Revision 1468438)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
hashutosh : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1468438&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1468438&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/MapredLocalTask.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12578551" name="HIVE-4315.1.patch" size="1270" author="thejas" created="Fri, 12 Apr 2013 23:44:04 +0000"/>
                            <attachment id="12578819" name="HIVE-4315.2.patch" size="1454" author="thejas" created="Mon, 15 Apr 2013 21:44:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>321930</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1jjmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>322275</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>