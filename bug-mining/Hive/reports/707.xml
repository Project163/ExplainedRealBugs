<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:59:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-1975] &quot;insert overwrite directory&quot; Not able to insert data with multi level directory path</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1975</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Below query execution is failed&lt;/p&gt;

&lt;p&gt;Ex:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   insert overwrite directory &apos;/HIVEFT25686/chinna/&apos; select * from dept_j;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Hadoop 0.20.1, Hive0.5.0 and SUSE Linux Enterprise Server 10 SP2 (i586) - Kernel 2.6.16.60-0.21-smp (5).&lt;/p&gt;</environment>
        <key id="12497995">HIVE-1975</key>
            <summary>&quot;insert overwrite directory&quot; Not able to insert data with multi level directory path</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chinnalalam">Chinna Rao Lalam</assignee>
                                    <reporter username="chinnalalam">Chinna Rao Lalam</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Feb 2011 15:34:46 +0000</created>
                <updated>Mon, 25 Nov 2013 20:13:45 +0000</updated>
                            <resolved>Sat, 29 Oct 2011 00:51:33 +0000</resolved>
                                    <version>0.5.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13015309" author="samuel_db" created="Mon, 4 Apr 2011 08:17:28 +0000"  >&lt;p&gt;Any update on this particular issue? &lt;/p&gt;

&lt;p&gt;I am trying to do the same but using s3 storage and it seems hive can only create one new directory and not a full structure. Is this a limitation? &lt;/p&gt;</comment>
                            <comment id="13015473" author="appodictic" created="Mon, 4 Apr 2011 15:58:41 +0000"  >&lt;p&gt;Are you asking if hive can export a partitioned table to a flat directory? please include more details in your report. Such as describe extended dept_j;&lt;/p&gt;</comment>
                            <comment id="13103160" author="he yongqiang" created="Mon, 12 Sep 2011 22:58:02 +0000"  >&lt;p&gt;what&apos;s the use case here?  the user can always first create the parent dir. But users misspell the dir name, they may not want the dirs created. Or worse, the data got loaded to some other place they not noticed.&lt;/p&gt;</comment>
                            <comment id="13103707" author="chinnalalam" created="Tue, 13 Sep 2011 15:48:53 +0000"  >&lt;p&gt;Use case is if we want to insert into multilevel directory like &apos;/HIVEFT25686/chinna/&apos;&lt;br/&gt;
(insert overwrite directory &apos;/HIVEFT25686/chinna/&apos; select * from dept_j) this is failing because  &quot;fs.rename(sourcePath, targetPath)&quot; is failing rename to multilevel directories, so first created the target path.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt; But users misspell the dir name, they may not want the dirs created.Or worse, the data got loaded to some other place they not noticed.&lt;/p&gt;

&lt;p&gt;This one will happen in the normal scenario also  what ever the location user specifies it will move the data to that location.&lt;/p&gt;

&lt;p&gt;But as u said if the rename operation fails it should delete the created directory. I will update the patch with this case. &lt;/p&gt;</comment>
                            <comment id="13103799" author="jiraposter@reviews.apache.org" created="Tue, 13 Sep 2011 17:31:10 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1829/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/1829/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hive and Yongqiang He.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;If insert into multilevel directory like &apos;/HIVEFT25686/chinna/&apos;&lt;br/&gt;
 (insert overwrite directory &apos;/HIVEFT25686/chinna/&apos; select * from dept_j) is failing because &quot;fs.rename(sourcePath, targetPath)&quot; is failing rename to multilevel directories, so first created the target path.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1975&quot; title=&quot;&amp;quot;insert overwrite directory&amp;quot; Not able to insert data with multi level directory path&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1975&quot;&gt;&lt;del&gt;HIVE-1975&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1975&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-1975&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/MoveTask.java 1170044 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1829/diff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/1829/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Ran all testcases&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;chinna&lt;/p&gt;
</comment>
                            <comment id="13132830" author="jiraposter@reviews.apache.org" created="Fri, 21 Oct 2011 17:08:32 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1829/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/1829/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-10-21 17:09:08.230077)&lt;/p&gt;


&lt;p&gt;Review request for hive and Yongqiang He.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Reworked on the comments&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;If insert into multilevel directory like &apos;/HIVEFT25686/chinna/&apos;&lt;br/&gt;
 (insert overwrite directory &apos;/HIVEFT25686/chinna/&apos; select * from dept_j) is failing because &quot;fs.rename(sourcePath, targetPath)&quot; is failing rename to multilevel directories, so first created the target path.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1975&quot; title=&quot;&amp;quot;insert overwrite directory&amp;quot; Not able to insert data with multi level directory path&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1975&quot;&gt;&lt;del&gt;HIVE-1975&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1975&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-1975&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/MoveTask.java 1186875 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1829/diff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/1829/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Ran all testcases&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;chinna&lt;/p&gt;
</comment>
                            <comment id="13134265" author="namit" created="Mon, 24 Oct 2011 17:22:11 +0000"  >&lt;p&gt;Some minor comments:&lt;/p&gt;

&lt;p&gt;1. Can you add a testcase  - use build as a temporary directory to add data ?&lt;br/&gt;
2. Add some comments explaining that the multi-level directory move is not atomic.&lt;br/&gt;
   In your example, it is possible that /x/y/z/1/2/3 is created, but /x/y/z/1/2/4.&lt;br/&gt;
   It is same as any multi-partition insert (dynamic insert), but would be good to &lt;br/&gt;
   explicitly call it out.&lt;/p&gt;</comment>
                            <comment id="13134548" author="he yongqiang" created="Mon, 24 Oct 2011 21:59:08 +0000"  >&lt;p&gt;it is good to add a conf for this, and by default disable it.&lt;/p&gt;</comment>
                            <comment id="13138379" author="chinnalalam" created="Fri, 28 Oct 2011 13:51:52 +0000"  >&lt;p&gt;Addressed  Namit &amp;amp; He Yongqiang comments&lt;/p&gt;</comment>
                            <comment id="13138380" author="jiraposter@reviews.apache.org" created="Fri, 28 Oct 2011 13:52:32 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1829/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/1829/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-10-28 13:53:07.086932)&lt;/p&gt;


&lt;p&gt;Review request for hive and Yongqiang He.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Addressed  Namit &amp;amp; He Yongqiang comments&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;If insert into multilevel directory like &apos;/HIVEFT25686/chinna/&apos;&lt;br/&gt;
 (insert overwrite directory &apos;/HIVEFT25686/chinna/&apos; select * from dept_j) is failing because &quot;fs.rename(sourcePath, targetPath)&quot; is failing rename to multilevel directories, so first created the target path.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1975&quot; title=&quot;&amp;quot;insert overwrite directory&amp;quot; Not able to insert data with multi level directory path&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1975&quot;&gt;&lt;del&gt;HIVE-1975&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1975&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-1975&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java 1190202 &lt;br/&gt;
  trunk/conf/hive-default.xml 1190202 &lt;br/&gt;
  trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/MoveTask.java 1190202 &lt;br/&gt;
  trunk/ql/src/test/queries/clientpositive/input45.q PRE-CREATION &lt;br/&gt;
  trunk/ql/src/test/results/clientpositive/input45.q.out PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1829/diff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/1829/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Ran all testcases&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;chinna&lt;/p&gt;
</comment>
                            <comment id="13138537" author="namit" created="Fri, 28 Oct 2011 17:08:38 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13139028" author="namit" created="Sat, 29 Oct 2011 00:51:33 +0000"  >&lt;p&gt;Committed. Thanks Chinna&lt;/p&gt;</comment>
                            <comment id="13139115" author="hudson" created="Sat, 29 Oct 2011 05:09:23 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #1042 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/1042/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/1042/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1975&quot; title=&quot;&amp;quot;insert overwrite directory&amp;quot; Not able to insert data with multi level directory path&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1975&quot;&gt;&lt;del&gt;HIVE-1975&lt;/del&gt;&lt;/a&gt; &quot;insert overwrite directory&quot; Not able to insert data with multi level&lt;br/&gt;
directory path (Chinna Rao Lalam via namit)&lt;/p&gt;

&lt;p&gt;namit : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1190719&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1190719&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/conf/hive-default.xml&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/MoveTask.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/input45.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/input45.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13831862" author="vratnagiri" created="Mon, 25 Nov 2013 20:13:45 +0000"  >&lt;p&gt;Hey Guys,&lt;/p&gt;

&lt;p&gt;I&apos;m using hive 0.11.0 and I just verified that I&apos;m facing this exact problem.&lt;/p&gt;

&lt;p&gt;I first tried to ask hive to create a multilevel path and I got: &quot;return code 1 from org.apache.hadoop.hive.ql.exec.MoveTask&quot; &lt;/p&gt;

&lt;p&gt;When I switched to using a simple one level directory, my query succeded and I could seem my data written out.&lt;/p&gt;

&lt;p&gt;Can anyone else corroborate?&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12494276" name="HIVE-1975.1.patch" size="951" author="chinnalalam" created="Tue, 13 Sep 2011 17:24:01 +0000"/>
                            <attachment id="12500209" name="HIVE-1975.2.patch" size="1681" author="chinnalalam" created="Fri, 21 Oct 2011 17:04:10 +0000"/>
                            <attachment id="12501295" name="HIVE-1975.3.patch" size="11159" author="chinnalalam" created="Fri, 28 Oct 2011 13:48:36 +0000"/>
                            <attachment id="12491759" name="HIVE-1975.patch" size="764" author="chinnalalam" created="Fri, 26 Aug 2011 09:01:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35815</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lhuv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123543</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>