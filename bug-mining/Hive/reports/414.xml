<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:56:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-1176] &apos;create if not exists&apos; fails for a table name with &apos;select&apos; in it</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1176</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;hive&amp;gt; create table if not exists tmp_select(s string, c string, n int);&lt;br/&gt;
org.apache.hadoop.hive.ql.metadata.HiveException: MetaException(message:Got exception: javax.jdo.JDOUserException JDOQL Single-String query should always start with SELECT)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.metadata.Hive.getTablesForDb(Hive.java:441)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.metadata.Hive.getTablesByPattern(Hive.java:423)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.analyzeCreateTable(SemanticAnalyzer.java:5538)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.analyzeInternal(SemanticAnalyzer.java:5192)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:105)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:275)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.Driver.runCommand(Driver.java:320)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.Driver.run(Driver.java:312)&lt;br/&gt;
        at org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:123)&lt;br/&gt;
        at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:181)&lt;br/&gt;
        at org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:287)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
        at org.apache.hadoop.util.RunJar.main(RunJar.java:156)&lt;br/&gt;
Caused by: MetaException(message:Got exception: javax.jdo.JDOUserException JDOQL Single-String query should always start with SELECT)&lt;br/&gt;
        at org.apache.hadoop.hive.metastore.MetaStoreUtils.logAndThrowMetaException(MetaStoreUtils.java:612)&lt;br/&gt;
        at org.apache.hadoop.hive.metastore.HiveMetaStoreClient.getTables(HiveMetaStoreClient.java:450)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.metadata.Hive.getTablesForDb(Hive.java:439)&lt;br/&gt;
        ... 15 more&lt;/p&gt;</description>
                <environment></environment>
        <key id="12456570">HIVE-1176</key>
            <summary>&apos;create if not exists&apos; fails for a table name with &apos;select&apos; in it</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aprabhakar">Arvind Prabhakar</assignee>
                                    <reporter username="prasadc">Prasad Chakka</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Feb 2010 18:15:00 +0000</created>
                <updated>Thu, 2 May 2013 02:29:33 +0000</updated>
                            <resolved>Thu, 24 Jun 2010 05:23:29 +0000</resolved>
                                                    <fixVersion>0.6.0</fixVersion>
                                    <component>Metastore</component>
                    <component>Query Processor</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="12835323" author="athusoo" created="Thu, 18 Feb 2010 18:28:30 +0000"  >&lt;p&gt;Can you provide a reproducible test case for this bug?&lt;/p&gt;</comment>
                            <comment id="12835324" author="athusoo" created="Thu, 18 Feb 2010 18:31:43 +0000"  >&lt;p&gt;my bad. There is already a test case &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12858616" author="aprabhakar" created="Mon, 19 Apr 2010 18:15:03 +0000"  >&lt;p&gt;This problem is due to &lt;a href=&quot;http://www.jpox.org/servlet/jira/browse/NUCCORE-427&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;a bug in Datanucleus JDOQL&lt;/a&gt; implementation and has been fixed in version 2.0.x.&lt;/p&gt;

&lt;p&gt;The fix is therefore to upgrade datanucleus plugins to the latest stable release.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Details:&lt;/b&gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Replaced the old datanucleus plugins version 1.1.2 with the latest stable release.&lt;/li&gt;
	&lt;li&gt;Updated jdo2-api library with the version required by datanucleus - 2.3-0ec, available from datanucleus maven repository at &lt;a href=&quot;http://www.datanucleus.org/downloads/maven2/javax/jdo/jdo2-api/2.3-ec/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.datanucleus.org/downloads/maven2/javax/jdo/jdo2-api/2.3-ec/&lt;/a&gt;, Apache licensed&lt;/li&gt;
	&lt;li&gt;Modified the build files to suppress auto-enhancement of all complied classes, a new feature introduced in the latest version.&lt;/li&gt;
	&lt;li&gt;Modified the HiveMetaStoreClient implementation to create deep-copies of non-primitive objects being returned from the thrift server. Without this change, some collections were being fetched as semi-populated proxies with missing session context leading to NPEs.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;b&gt;Testing Done:&lt;/b&gt;&lt;br/&gt;
Built and ran all tests. Only two failures were reported - clientpositive test for input20.q and input33.q. These tests appear to be failing on the trunk as well.&lt;/p&gt;</comment>
                            <comment id="12873555" author="aprabhakar" created="Mon, 31 May 2010 06:27:18 +0000"  >&lt;p&gt;This patch replaces the patch submitted before (&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1176&quot; title=&quot;&amp;#39;create if not exists&amp;#39; fails for a table name with &amp;#39;select&amp;#39; in it&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1176&quot;&gt;&lt;del&gt;HIVE-1176&lt;/del&gt;&lt;/a&gt;.lib-files.tar.gz and &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1176&quot; title=&quot;&amp;#39;create if not exists&amp;#39; fails for a table name with &amp;#39;select&amp;#39; in it&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1176&quot;&gt;&lt;del&gt;HIVE-1176&lt;/del&gt;&lt;/a&gt;.patch).&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;HIVE-1176-1.patch:

#	modified:   build.properties
#	modified:   build.xml
#	modified:   eclipse-templates/.classpath
#	modified:   ivy/ivysettings.xml
#	deleted:    lib/datanucleus-core-1.1.2.LICENSE
#	deleted:    lib/datanucleus-core-1.1.2.jar
#	deleted:    lib/datanucleus-enhancer-1.1.2.LICENSE
#	deleted:    lib/datanucleus-enhancer-1.1.2.jar
#	deleted:    lib/datanucleus-rdbms-1.1.2.LICENSE
#	deleted:    lib/datanucleus-rdbms-1.1.2.jar
#	deleted:    lib/jdo2-api-2.3-SNAPSHOT.LICENSE
#	deleted:    lib/jdo2-api-2.3-SNAPSHOT.jar
#	modified:   metastore/ivy.xml
#	modified:   metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStoreClient.java
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12873557" author="aprabhakar" created="Mon, 31 May 2010 06:39:47 +0000"  >&lt;p&gt;Updated the patch so that it cleanly applies to the trunk. &lt;/p&gt;

&lt;p&gt;&lt;b&gt;Changes from Previous Patch:&lt;/b&gt;&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;This patch uses ivy to download the updated datanucleus plugins and other dependent libraries. There is no need to use the previously supplied tar.gz anymore.&lt;/li&gt;
	&lt;li&gt;At the time the previous patch was written, the enhancer plugin version was 2.0.1 which by default would enable annotation processing. Since then version 2.0.3 has been released which &lt;a href=&quot;http://www.datanucleus.org/servlet/jira/browse/NUCENHANCER-56&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;disables this behavior&lt;/a&gt;. Hence the previously submitted changes to &lt;tt&gt;javac.args&lt;/tt&gt; in build.properties file are no longer necessary. This patch uses the updated version of the datanucleus enhancer plugin.&lt;/li&gt;
	&lt;li&gt;The JDO2 API library used by datanucleus plugin is distributed by the datanucleus&apos;s public maven repository. This repository has been added to ivy configuration to automate the download.&lt;/li&gt;
	&lt;li&gt;The connection pool libraries have been updated to work with the newer datanucleus plugins. Library &lt;tt&gt;commons-dbcp&lt;/tt&gt; has been updated from 1.2.2 to 1.4, &lt;tt&gt;commons-pool&lt;/tt&gt; from 1.2 to 1.5.4, and &lt;tt&gt;datanucleus-connectionpool&lt;/tt&gt; from 1.0.2 to 2.0.1.&lt;/li&gt;
	&lt;li&gt;As with the previously submitted patch, &lt;tt&gt;HiveMetaStoreClient&lt;/tt&gt; implementation has been modified to create deep-copies of non-primitive objects being returned from the thrift server in order to avoid semi-populated proxies causing NPEs downstream.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;b&gt;Testing Done:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Built and ran all tests. Only two failures were reported as before - clientpositive test for input20.q and input33.q. These tests appear to be failing on the trunk as well.&lt;/p&gt;</comment>
                            <comment id="12874262" author="jvs" created="Tue, 1 Jun 2010 21:55:41 +0000"  >&lt;p&gt;What failures are you seeing on trunk for input20.q and input33.q?  I do see recent Hudson sporadic failures for the flaky negative tests script_broken_pipe1 and loadpart_err, but not input20.q and input33.q.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hive-trunk-h0.20/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hive-trunk-h0.20/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12875960" author="aprabhakar" created="Sat, 5 Jun 2010 22:38:29 +0000"  >&lt;p&gt;John - I debugged the failures that I was seeing for input20 and input33 and it turns out to be a subtle difference in the way the stream editor &lt;tt&gt;sed&lt;/tt&gt; works on Mac vs the regular linux distribution. I installed the GNU port for &lt;tt&gt;sed&lt;/tt&gt; and the failures no longer occur.&lt;/p&gt;

&lt;p&gt;I don&apos;t think this is related to the sporadic failures that are reported on hudson.&lt;/p&gt;</comment>
                            <comment id="12876106" author="cwsteinbach" created="Mon, 7 Jun 2010 01:22:25 +0000"  >&lt;p&gt;@Arvind: Can you explain what the difference is between OSX sed and GNU sed? Can we rewrite the sed script so that it works on both platforms? Seems like we are probably relying on a non-POSIX feature that is present in the GNU version.&lt;/p&gt;</comment>
                            <comment id="12876127" author="aprabhakar" created="Mon, 7 Jun 2010 05:13:09 +0000"  >&lt;p&gt;I think the difference is more likely a bug in Mac OSX version of &lt;tt&gt;sed&lt;/tt&gt;. Specifically, it fails to process directives with escaped tab sequence characters and instead treats it as unescaped. For example, the command to replace first occurrence of &lt;b&gt;b&lt;/b&gt; in the string &lt;b&gt;abc&lt;/b&gt; with a tab character &lt;b&gt;\t&lt;/b&gt; fails as shown below:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ echo &lt;span class=&quot;code-quote&quot;&gt;&quot;abc&quot;&lt;/span&gt; | /usr/bin/sed &lt;span class=&quot;code-quote&quot;&gt;&quot;s@b@\t@&quot;&lt;/span&gt;
atc
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Whereas this works fine with the GNU distribution of sed&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ echo &lt;span class=&quot;code-quote&quot;&gt;&quot;abc&quot;&lt;/span&gt; | /opt/local/bin/sed &lt;span class=&quot;code-quote&quot;&gt;&quot;s@b@\t@&quot;&lt;/span&gt;
a	c
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12879208" author="pauly" created="Wed, 16 Jun 2010 00:41:32 +0000"  >&lt;p&gt;Can you elaborate on what you mean by &apos;some collections were being fetched as semi-populated proxies with missing session context leading to NPEs&apos;? Is there something I can do to reproduce this?&lt;/p&gt;</comment>
                            <comment id="12879428" author="aprabhakar" created="Wed, 16 Jun 2010 18:03:06 +0000"  >&lt;p&gt;Updating the patch with latest trunk image. This is necessary since &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1373&quot; title=&quot;Missing connection pool plugin in Eclipse classpath&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1373&quot;&gt;&lt;del&gt;HIVE-1373&lt;/del&gt;&lt;/a&gt; updated the eclipse classpath with connection pool libraries which will be outdated with the application of this patch. The updated version of the patch takes care of this problem by updating eclipse classpath to use the updated libraries instead. Tested out launch configuration via eclipse to make sure it is working.&lt;/p&gt;</comment>
                            <comment id="12879432" author="aprabhakar" created="Wed, 16 Jun 2010 18:12:34 +0000"  >&lt;p&gt;The updated patch &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1176&quot; title=&quot;&amp;#39;create if not exists&amp;#39; fails for a table name with &amp;#39;select&amp;#39; in it&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1176&quot;&gt;&lt;del&gt;HIVE-1176&lt;/del&gt;&lt;/a&gt;-2.patch contains the following changes:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;modified:   build.properties&lt;/li&gt;
	&lt;li&gt;modified:   build.xml&lt;/li&gt;
	&lt;li&gt;modified:   eclipse-templates/.classpath&lt;/li&gt;
	&lt;li&gt;modified:   ivy/ivysettings.xml&lt;/li&gt;
	&lt;li&gt;deleted:    lib/datanucleus-core-1.1.2.LICENSE&lt;/li&gt;
	&lt;li&gt;deleted:    lib/datanucleus-core-1.1.2.jar&lt;/li&gt;
	&lt;li&gt;deleted:    lib/datanucleus-enhancer-1.1.2.LICENSE&lt;/li&gt;
	&lt;li&gt;deleted:    lib/datanucleus-enhancer-1.1.2.jar&lt;/li&gt;
	&lt;li&gt;deleted:    lib/datanucleus-rdbms-1.1.2.LICENSE&lt;/li&gt;
	&lt;li&gt;deleted:    lib/datanucleus-rdbms-1.1.2.jar&lt;/li&gt;
	&lt;li&gt;deleted:    lib/jdo2-api-2.3-SNAPSHOT.LICENSE&lt;/li&gt;
	&lt;li&gt;deleted:    lib/jdo2-api-2.3-SNAPSHOT.jar&lt;/li&gt;
	&lt;li&gt;modified:   metastore/ivy.xml&lt;/li&gt;
	&lt;li&gt;modified:   metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStoreClient.java&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="12879441" author="aprabhakar" created="Wed, 16 Jun 2010 18:36:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;Can you elaborate on what you mean by &apos;some collections were being fetched as semi-populated proxies with missing session context leading to NPEs&apos;? Is there something I can do to reproduce this?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;@Paul: Here are the steps to reproduce this problem:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Startout with a clean workspace checkout and apply the updated patch &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1176&quot; title=&quot;&amp;#39;create if not exists&amp;#39; fails for a table name with &amp;#39;select&amp;#39; in it&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1176&quot;&gt;&lt;del&gt;HIVE-1176&lt;/del&gt;&lt;/a&gt;-2.patch.&lt;/li&gt;
	&lt;li&gt;Manually revert the file &lt;tt&gt;metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStoreClient.java&lt;/tt&gt; to its previous state&lt;/li&gt;
	&lt;li&gt;run &lt;tt&gt;ant package&lt;/tt&gt; from the root of the workspace&lt;/li&gt;
	&lt;li&gt;run &lt;tt&gt;ant test&lt;/tt&gt; from within metastore&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;You should see failures like the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    [junit] testPartition() failed.
    [junit] java.lang.NullPointerException
    [junit] 	at org.datanucleus.store.mapped.scostore.AbstractMapStore.validateKeyForWriting(AbstractMapStore.java:333)
    [junit] 	at org.datanucleus.store.mapped.scostore.JoinMapStore.put(JoinMapStore.java:252)
    [junit] 	at org.datanucleus.sco.backed.Map.put(Map.java:640)
    [junit] 	at org.apache.hadoop.hive.metastore.api.Table.putToParameters(Table.java:359)
    [junit] 	at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.alter_table(HiveMetaStore.java:1281)
    [junit] 	at org.apache.hadoop.hive.metastore.HiveMetaStoreClient.alter_table(HiveMetaStoreClient.java:140)
    [junit] 	at org.apache.hadoop.hive.metastore.TestHiveMetaStore.testAlterTable(TestHiveMetaStore.java:728)
    [junit] 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you look at &lt;tt&gt;src/gen-javabean/org/apache/hadoop/hive/metastore/api/Table.java&lt;/tt&gt; you would notice that the line causing this exception should ideally be a &lt;tt&gt;HashMap&lt;/tt&gt; and not an &lt;tt&gt;org.datanucleus.store.mapped.scostore.AbstractMapStore&lt;/tt&gt; as indicated by the stack trace. This happens because the datanucleus JDO framework replaces collections with its own implementation in order to allow lazy-dereferencing and optimize for database connections/queries/memory consumption etc.&lt;/p&gt;

&lt;p&gt;Lazy loading of collections (and second class objects in general) can be disabled at a global level or at entity level. Disabling this globally is generally not recommended unless there is evidence backed by extensive testing that supports that change. Disabling at an entity level is still OK provided the entity object graph is fully dereferenced at all times. This could lead to extensive memory consumption in the system in case the entity graph is huge. &lt;/p&gt;

&lt;p&gt;My approach towards fixing the problem was to &lt;b&gt;not&lt;/b&gt; change the default behavior in the general case. Instead I felt that it was better to circumvent this problem in the case of a remote metastore by creating a copy explicitly. If you have other suggestions on how to address this, please let me know.&lt;/p&gt;

&lt;p&gt;Also - more information on the lazy dereferencing mechanism used by datanucleus framework can be found &lt;a href=&quot;http://www.datanucleus.org/plugins/core/sco.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12881023" author="aprabhakar" created="Tue, 22 Jun 2010 02:22:39 +0000"  >&lt;p&gt;@Paul: Any updates on this from your end? Thanks.&lt;/p&gt;</comment>
                            <comment id="12881026" author="pauly" created="Tue, 22 Jun 2010 02:26:12 +0000"  >&lt;p&gt;I was going to look at it again today, but looks like I&apos;ll get to it around mid-day tomorrow? Will keep this posted.&lt;/p&gt;</comment>
                            <comment id="12881293" author="pauly" created="Tue, 22 Jun 2010 18:50:00 +0000"  >&lt;p&gt;For some reason, I don&apos;t see the JDO files being deleted after applying the patch:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;?      build.xml.orig
?      HIVE-1176-2.patch
?      test.log
M      eclipse-templates/.classpath
M      build.properties
M      build.xml
?      metastore/test.log
M      metastore/ivy.xml
M      metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStoreClient.java
!      lib/jdo2-api-2.3-SNAPSHOT.LICENSE
!      lib/datanucleus-rdbms-1.1.2.LICENSE
!      lib/datanucleus-enhancer-1.1.2.LICENSE
!      lib/datanucleus-core-1.1.2.LICENSE
M      ivy/ivysettings.xml
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also, the patch works for branch 0.6 but not for trunk. Can you regenerate it?&lt;/p&gt;</comment>
                            <comment id="12881296" author="pauly" created="Tue, 22 Jun 2010 18:55:13 +0000"  >&lt;p&gt;To clarify, I am referring to the jars under /lib that should be deleted along with the *.LICENSE files.&lt;/p&gt;</comment>
                            <comment id="12881304" author="pauly" created="Tue, 22 Jun 2010 19:09:48 +0000"  >&lt;p&gt;Nevermind - JVS pointed out that jars are skipped as they are binary files.&lt;/p&gt;</comment>
                            <comment id="12881381" author="aprabhakar" created="Tue, 22 Jun 2010 21:51:10 +0000"  >&lt;p&gt;@Paul: I just tested the patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1176&quot; title=&quot;&amp;#39;create if not exists&amp;#39; fails for a table name with &amp;#39;select&amp;#39; in it&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1176&quot;&gt;&lt;del&gt;HIVE-1176&lt;/del&gt;&lt;/a&gt;-2.patch) on latest trunk and it seems to apply cleanly. Can you please try again and see if it works? Also, can you post the errors that you are seeing? If necessary, I can break down the patch into single-file units to help with applying it. Just let me know either way.&lt;/p&gt;</comment>
                            <comment id="12881446" author="pauly" created="Tue, 22 Jun 2010 23:21:24 +0000"  >&lt;p&gt;Tried it again, and yep, it works. Not sure what happened before. Anyway though, yeah I do see the NPE&apos;s that you mentioned. Why did this not occur before? Just changes in behavior between major versions?&lt;/p&gt;</comment>
                            <comment id="12881472" author="aprabhakar" created="Wed, 23 Jun 2010 00:09:07 +0000"  >&lt;p&gt;Yes - it appears that the change in behavior can be attributed to the difference in major versions.&lt;/p&gt;</comment>
                            <comment id="12881484" author="pauly" created="Wed, 23 Jun 2010 00:31:55 +0000"  >&lt;p&gt;One last thing, can you include a unit test to verify the fix?&lt;/p&gt;</comment>
                            <comment id="12881486" author="aprabhakar" created="Wed, 23 Jun 2010 00:35:47 +0000"  >&lt;p&gt;Sorry - it is not clear to me what unit test should I be writing. Can you give an example perhaps?&lt;/p&gt;

&lt;p&gt;From my perspective, any test that uses the metastore exercises this change. And together, all the tests form an exhaustive layer that ensures that there is no regression seeping into the system. Note that this is not a functionality change, only a change of underlying libraries. &lt;/p&gt;</comment>
                            <comment id="12881488" author="aprabhakar" created="Wed, 23 Jun 2010 00:37:32 +0000"  >&lt;p&gt;Also, for the specific change to &lt;tt&gt;HiveMetaStoreClient.java&lt;/tt&gt; - the tests under &lt;tt&gt;metastore&lt;/tt&gt; validate that the new libraries are working correctly. &lt;/p&gt;</comment>
                            <comment id="12881497" author="pauly" created="Wed, 23 Jun 2010 00:47:02 +0000"  >&lt;p&gt;Oh, but I thought the original problem (as per title) was an exception with &apos;create table if not exists tmp_select(s string, c string, n int)&apos;?&lt;/p&gt;

&lt;p&gt;So maybe something like:&lt;/p&gt;

&lt;p&gt;CREATE TABLE IF NOT EXISTS tmp_select(s STRING, c STRING, n INT);&lt;br/&gt;
DROP TABLE tmp_select;&lt;/p&gt;</comment>
                            <comment id="12881499" author="aprabhakar" created="Wed, 23 Jun 2010 00:49:00 +0000"  >&lt;p&gt;Makes sense. Will add a test case and update the patch soon. Sorry for the misunderstanding.&lt;/p&gt;</comment>
                            <comment id="12881538" author="aprabhakar" created="Wed, 23 Jun 2010 04:33:43 +0000"  >&lt;p&gt;Updated patch with a test case attached. Please use &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1176&quot; title=&quot;&amp;#39;create if not exists&amp;#39; fails for a table name with &amp;#39;select&amp;#39; in it&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1176&quot;&gt;&lt;del&gt;HIVE-1176&lt;/del&gt;&lt;/a&gt;-3.patch. The changed files in this patch are as follows:&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;modified:   build.properties&lt;/li&gt;
	&lt;li&gt;modified:   build.xml&lt;/li&gt;
	&lt;li&gt;new file:   data/files/simple.txt&lt;/li&gt;
	&lt;li&gt;modified:   eclipse-templates/.classpath&lt;/li&gt;
	&lt;li&gt;modified:   ivy/ivysettings.xml&lt;/li&gt;
	&lt;li&gt;deleted:    lib/datanucleus-core-1.1.2.LICENSE&lt;/li&gt;
	&lt;li&gt;deleted:    lib/datanucleus-core-1.1.2.jar&lt;/li&gt;
	&lt;li&gt;deleted:    lib/datanucleus-enhancer-1.1.2.LICENSE&lt;/li&gt;
	&lt;li&gt;deleted:    lib/datanucleus-enhancer-1.1.2.jar&lt;/li&gt;
	&lt;li&gt;deleted:    lib/datanucleus-rdbms-1.1.2.LICENSE&lt;/li&gt;
	&lt;li&gt;deleted:    lib/datanucleus-rdbms-1.1.2.jar&lt;/li&gt;
	&lt;li&gt;deleted:    lib/jdo2-api-2.3-SNAPSHOT.LICENSE&lt;/li&gt;
	&lt;li&gt;deleted:    lib/jdo2-api-2.3-SNAPSHOT.jar&lt;/li&gt;
	&lt;li&gt;modified:   metastore/ivy.xml&lt;/li&gt;
	&lt;li&gt;modified:   metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStoreClient.java&lt;/li&gt;
	&lt;li&gt;new file:   ql/src/test/queries/clientpositive/hive_1176.q&lt;/li&gt;
	&lt;li&gt;new file:   ql/src/test/results/clientpositive/hive_1176.q.out&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="12881559" author="pauly" created="Wed, 23 Jun 2010 06:04:37 +0000"  >&lt;p&gt;@Arvind - While the test that you added is thorough, I think for this case, we might be able to get by with something simpler / faster? &lt;/p&gt;

&lt;p&gt;e.g.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Use one of the existing source files or insert from an existing table like &apos;src&apos;.&lt;/li&gt;
	&lt;li&gt;Limit to one select statement / table as we test select more extensively in other unit tests.&lt;/li&gt;
	&lt;li&gt;Remove the drop table statements in the beginning, as other tests aren&apos;t supposed to leave tables around at the end of their run.&lt;/li&gt;
	&lt;li&gt;Rename the query file to something more descriptive. This would help developers browsing the list of tests.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;We don&apos;t want to sacrifice coverage, but at the same time, the whole suite of tests take quite a while to execute.&lt;/p&gt;</comment>
                            <comment id="12881562" author="jvs" created="Wed, 23 Jun 2010 06:10:06 +0000"  >&lt;p&gt;Paul, we currently do pre-drops in the test to avoid collisions in case other tests fail, or if a negative test happens to use the same table name since there&apos;s currently no way for a negative test to clean up after itself.  It would be better if our test framework automatically cleaned out the catalog at the beginning of each test, but until we have that, pre-drop is required.&lt;/p&gt;</comment>
                            <comment id="12881566" author="aprabhakar" created="Wed, 23 Jun 2010 06:32:49 +0000"  >&lt;p&gt;@Paul: You suggestions are fair enough. I have incorporated all changes you suggested except for the pre-drop based on @John&apos;s response. Let me know if you guys need any further tweaking of this patch.&lt;/p&gt;</comment>
                            <comment id="12881568" author="pauly" created="Wed, 23 Jun 2010 06:35:36 +0000"  >&lt;p&gt;@John - good point! In which case, we&apos;ll probably need to fix up some of the other unit tests with a create table.&lt;/p&gt;</comment>
                            <comment id="12881572" author="pauly" created="Wed, 23 Jun 2010 06:41:29 +0000"  >&lt;p&gt;Looks good to me&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12881936" author="jvs" created="Wed, 23 Jun 2010 22:44:25 +0000"  >&lt;p&gt;Just one more change needed...please add an ORDER BY to the select in the testcase.  This is required to avoid spurious diffs later since without ORDER BY, the query result order is non-deterministic.&lt;/p&gt;

&lt;p&gt;After that I&apos;ll run through tests and commit.&lt;/p&gt;</comment>
                            <comment id="12881946" author="aprabhakar" created="Wed, 23 Jun 2010 23:16:49 +0000"  >&lt;p&gt;@John: done. Please see the new patch attachment -  &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1176&quot; title=&quot;&amp;#39;create if not exists&amp;#39; fails for a table name with &amp;#39;select&amp;#39; in it&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1176&quot;&gt;&lt;del&gt;HIVE-1176&lt;/del&gt;&lt;/a&gt;-5.patch&lt;/p&gt;

&lt;p&gt;Since a lot of good points came out of the discussion on this jira, I took the liberty of adding them to the Hive wiki for posterity. You can find it &lt;a href=&quot;http://wiki.apache.org/hadoop/Hive/TipsForAddingNewTests&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. Please add to it any other points that you feel contributors should take into consideration while adding new tests.&lt;/p&gt;</comment>
                            <comment id="12881950" author="jvs" created="Wed, 23 Jun 2010 23:24:37 +0000"  >&lt;p&gt;Thanks for the doc Arvind.  &lt;/p&gt;

&lt;p&gt;But for the patch:  we need the ORDER BY on the SELECT that produces results in the output log (not the INSERT).&lt;/p&gt;</comment>
                            <comment id="12881956" author="aprabhakar" created="Wed, 23 Jun 2010 23:35:09 +0000"  >&lt;p&gt;yes - thats what my intention was. Thanks for catching it.&lt;/p&gt;</comment>
                            <comment id="12881967" author="jvs" created="Wed, 23 Jun 2010 23:58:48 +0000"  >&lt;p&gt;+1.  Will commit when tests pass.&lt;/p&gt;</comment>
                            <comment id="12882049" author="jvs" created="Thu, 24 Jun 2010 05:23:29 +0000"  >&lt;p&gt;Committed.  Thanks Arvind!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12434107">HIVE-802</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12434107">HIVE-802</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12445905" name="HIVE-1176-1.patch" size="61160" author="aprabhakar" created="Mon, 31 May 2010 06:27:17 +0000"/>
                            <attachment id="12447244" name="HIVE-1176-2.patch" size="62323" author="aprabhakar" created="Wed, 16 Jun 2010 18:03:06 +0000"/>
                            <attachment id="12447794" name="HIVE-1176-3.patch" size="67830" author="aprabhakar" created="Wed, 23 Jun 2010 04:32:02 +0000"/>
                            <attachment id="12447803" name="HIVE-1176-4.patch" size="70594" author="aprabhakar" created="Wed, 23 Jun 2010 06:31:41 +0000"/>
                            <attachment id="12447902" name="HIVE-1176-5.patch" size="70633" author="aprabhakar" created="Wed, 23 Jun 2010 23:14:21 +0000"/>
                            <attachment id="12447905" name="HIVE-1176-6.patch" size="70627" author="aprabhakar" created="Wed, 23 Jun 2010 23:34:29 +0000"/>
                            <attachment id="12442204" name="HIVE-1176.lib-files.tar.gz" size="3356113" author="aprabhakar" created="Mon, 19 Apr 2010 18:11:09 +0000"/>
                            <attachment id="12442203" name="HIVE-1176.patch" size="101450" author="aprabhakar" created="Mon, 19 Apr 2010 18:11:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73052</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 22 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ldt3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>122887</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>