<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:33:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-10595] Dropping a table can cause NPEs in the compactor</title>
                <link>https://issues.apache.org/jira/browse/HIVE-10595</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Reproduction:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;start metastore with compactor off&lt;/li&gt;
	&lt;li&gt;insert enough entries in a table to trigger a compaction&lt;/li&gt;
	&lt;li&gt;drop the table&lt;/li&gt;
	&lt;li&gt;stop metastore&lt;/li&gt;
	&lt;li&gt;restart metastore with compactor on&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Result:  NPE in the compactor threads.  I suspect this would also happen if the inserts and drops were done in between a run of the compactor, but I haven&apos;t proven it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12826979">HIVE-10595</key>
            <summary>Dropping a table can cause NPEs in the compactor</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gates">Alan Gates</assignee>
                                    <reporter username="gates">Alan Gates</reporter>
                        <labels>
                    </labels>
                <created>Mon, 4 May 2015 17:36:08 +0000</created>
                <updated>Tue, 29 Sep 2015 21:20:59 +0000</updated>
                            <resolved>Thu, 7 May 2015 12:00:02 +0000</resolved>
                                    <version>0.14.0</version>
                    <version>1.0.0</version>
                    <version>1.1.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>Metastore</component>
                    <component>Transactions</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14528863" author="alangates" created="Tue, 5 May 2015 17:39:05 +0000"  >&lt;p&gt;More details:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Dropping a table did not impact the initiator thread, as it could already handle not finding a table.  However, it was assuming that all such cases were temp tables.&lt;/li&gt;
	&lt;li&gt;Dropping a table before the worker thread or cleaner thread got to it caused bogus error messages.  In the case of the worker it also prevented forward progress on compacting any other requests, as the dropped table stayed at the head of the queue.&lt;/li&gt;
	&lt;li&gt;Dropping a partition before any of the threads got to it caused the compaction do to be done against the table rather than the partition, which would result in an error once the compaction work started.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="14528874" author="alangates" created="Tue, 5 May 2015 17:42:18 +0000"  >&lt;p&gt;The attached patch makes the following changes:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The info message for initiator when it discovers a missing table now says that the table may have been a temp or may have been dropped.&lt;/li&gt;
	&lt;li&gt;Worker and cleaner threads now properly check for the table to be compacting being null, and give an info message saying they assume the table has been dropped.&lt;/li&gt;
	&lt;li&gt;All three threads now properly handle the case where the partition is dropped and give an info message rather than attempt to compact the table.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="14529230" author="alangates" created="Tue, 5 May 2015 20:39:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sushanth&quot; class=&quot;user-hover&quot; rel=&quot;sushanth&quot;&gt;sushanth&lt;/a&gt;, I&apos;d like to add this to 1.2 as it can jam the compactor.  It&apos;s already patch available, so I should be able to get it in quickly.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ekoifman&quot; class=&quot;user-hover&quot; rel=&quot;ekoifman&quot;&gt;ekoifman&lt;/a&gt;, would you have time to review this?&lt;/p&gt;</comment>
                            <comment id="14529235" author="sushanth" created="Tue, 5 May 2015 20:47:33 +0000"  >&lt;p&gt;From the description, this is an NPE in a pretty core feature, so this qualifies as an outage. Added to &lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Hive+1.2+Release+Status&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/Hive/Hive+1.2+Release+Status&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14529236" author="sushanth" created="Tue, 5 May 2015 20:48:04 +0000"  >&lt;p&gt;And by that, I mean +1 for inclusion to branch-1.2&lt;/p&gt;</comment>
                            <comment id="14529725" author="ekoifman" created="Wed, 6 May 2015 01:34:03 +0000"  >&lt;p&gt;I&apos;m not sure I understand how this works.&lt;br/&gt;
The Initiator (if the table/partition is no longer there) will not add anything to compaction queue.&lt;br/&gt;
So then there is nothing for Worker/Cleaner to do in this case.&lt;/p&gt;

&lt;p&gt;How will data from TXNS, COMPLETED_TXN_COMPONENTS, TXN_COMPONENTS which relates to these table get cleaned up?&lt;/p&gt;</comment>
                            <comment id="14531062" author="alangates" created="Wed, 6 May 2015 18:04:01 +0000"  >&lt;blockquote&gt;&lt;p&gt;So then there is nothing for Worker/Cleaner to do in this case.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Unless the table get&apos;s dropped between when the initiator initiates it and the worker picks it up, same for worker-&amp;gt; cleaner.  The issue with the worker can also be seen if a user initiates compactions of a deleted or non-existent table.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;How will data from TXNS, COMPLETED_TXN_COMPONENTS, TXN_COMPONENTS which relates to these table get cleaned up?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Hmm, that might be a general issue, but it isn&apos;t introduced by this.  We need to explore separately whether when compactions get dropped without being done (for whatever reason) that everything in TXNS etc. get&apos;s properly cleaned up.&lt;/p&gt;</comment>
                            <comment id="14531154" author="ekoifman" created="Wed, 6 May 2015 18:39:26 +0000"  >&lt;p&gt;I filed a ticket to investigate the more general issue.&lt;br/&gt;
+1 this patch&lt;/p&gt;</comment>
                            <comment id="14531473" author="sushanth" created="Wed, 6 May 2015 21:35:00 +0000"  >&lt;p&gt;Duplicating &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-10595&quot; title=&quot;Dropping a table can cause NPEs in the compactor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-10595&quot;&gt;&lt;del&gt;HIVE-10595&lt;/del&gt;&lt;/a&gt;.patch as &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-10595&quot; title=&quot;Dropping a table can cause NPEs in the compactor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-10595&quot;&gt;&lt;del&gt;HIVE-10595&lt;/del&gt;&lt;/a&gt;.1.patch to submit through precommit.&lt;/p&gt;</comment>
                            <comment id="14532467" author="hiveqa" created="Thu, 7 May 2015 11:19:09 +0000"  >

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall&lt;/font&gt;: +1 all checks pass&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12730973/HIVE-10595.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12730973/HIVE-10595.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 8912 tests passed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3795/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3795/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3795/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/3795/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-3795/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-3795/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12730973 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14532511" author="alangates" created="Thu, 7 May 2015 12:00:02 +0000"  >&lt;p&gt;Patch 1 committed.  Thanks Eugene for the review.&lt;/p&gt;</comment>
                            <comment id="14548778" author="sushanth" created="Mon, 18 May 2015 19:51:15 +0000"  >&lt;p&gt;This issue has been fixed and released as part of the 1.2.0 release. If you find an issue which seems to be related to this one, please create a new jira and link this one with new jira.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12827764">HIVE-10632</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12730973" name="HIVE-10595.1.patch" size="15351" author="sushanth" created="Wed, 6 May 2015 21:35:00 +0000"/>
                            <attachment id="12730548" name="HIVE-10595.patch" size="15351" author="gates" created="Tue, 5 May 2015 17:42:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 27 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2e96v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>