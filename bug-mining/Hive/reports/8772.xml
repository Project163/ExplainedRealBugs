<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:26:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-28702] Iceberg: Statistics are inconsistent on time travel queries</title>
                <link>https://issues.apache.org/jira/browse/HIVE-28702</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Time-travel queries using a snapshot id, timestamp, branching, or tagging can run with incorrect statistics.&lt;/p&gt;

&lt;p&gt;This set of queries reproduces the problem.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SET hive.fetch.task.conversion=none;
CREATE TABLE &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.test (i1 INT, i2 INT) STORED BY ICEBERG;
INSERT INTO &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.test VALUES (1, 11), (2, 22);
ALTER TABLE &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.test CREATE TAG with_2_records;

EXPLAIN SELECT * FROM &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.test.tag_with_2_records;

INSERT INTO &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.test VALUES (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;), (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;), (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;), (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;), (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;), (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;), (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;), (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;), (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;), (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;), (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;), (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
EXPLAIN SELECT * FROM &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.test.tag_with_2_records; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The first EXPLAIN shows the correct size of statistics, with 2 records.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
| &#160; &#160; &#160; &#160; Map 1 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;|
| &#160; &#160; &#160; &#160; &#160; &#160; Map Operator Tree: &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; |
| &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; TableScan &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;|
| &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; alias: test &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;|
| &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Snapshot ref: tag_with_2_records |
| &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE |
| &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Select Operator &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;|
| &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; expressions: i1 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;), i2 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) |
| &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; outputColumnNames: _col0, _col1 |
| &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE | &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The size is broken after I ran the second INSERT query.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
| &#160; &#160; &#160; &#160; Map 1 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;|
| &#160; &#160; &#160; &#160; &#160; &#160; Map Operator Tree: &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; |
| &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; TableScan &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;|
| &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; alias: test &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;|
| &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Snapshot ref: tag_with_2_records |
| &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Statistics: Num rows: 2 Data size: 6610 Basic stats: COMPLETE Column stats: COMPLETE |
| &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Select Operator &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;|
| &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; expressions: i1 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;), i2 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) |
| &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; outputColumnNames: _col0, _col1 |
| &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Statistics: Num rows: 2 Data size: -72 Basic stats: COMPLETE Column stats: COMPLETE | &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13604611">HIVE-28702</key>
            <summary>Iceberg: Statistics are inconsistent on time travel queries</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="okumin">Shohei Okumiya</assignee>
                                    <reporter username="okumin">Shohei Okumiya</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sun, 12 Jan 2025 12:17:31 +0000</created>
                <updated>Tue, 29 Jul 2025 14:51:15 +0000</updated>
                            <resolved>Mon, 13 Jan 2025 15:31:50 +0000</resolved>
                                    <version>4.0.1</version>
                                    <fixVersion>4.1.0</fixVersion>
                                    <component>Iceberg integration</component>
                    <component>Statistics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17912260" author="okumin" created="Sun, 12 Jan 2025 12:24:10 +0000"  >&lt;p&gt;I guess the basic stats, i.e., # of rows, are correctly retrieved based on the snapshot, but column stats(column statistics) are retrieved from the current snapshot. I see # of nulls is greater than the number of rows in the case.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13073925/13073925_image-2025-01-12-21-23-02-639.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17912264" author="okumin" created="Sun, 12 Jan 2025 13:53:53 +0000"  >&lt;p&gt;I identified the root cause.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hive/pull/5607&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/pull/5607&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&amp;gt; Currently, HiveIcebergStorageHandler#canProvideColStatistics and HiveIcebergStorageHandler#getColStatistics retrieve statistics based on the current snapshot id while HiveIcebergStorageHandler#getBasicStatistics respects conditions of time travel features. It causes column statistics to be inconsistent with basic stats. For example, column stats can say there are 100 null values even though basic stats say the number of total rows is only 10. Hive can get confused when it builds an execution plan.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17912576" author="dkuzmenko" created="Mon, 13 Jan 2025 15:31:40 +0000"  >&lt;p&gt;Merged to master&lt;br/&gt;
Thanks for the fix &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=okumin&quot; class=&quot;user-hover&quot; rel=&quot;okumin&quot;&gt;okumin&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13073925" name="image-2025-01-12-21-23-02-639.png" size="48786" author="okumin" created="Sun, 12 Jan 2025 12:23:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            43 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1tjv4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>