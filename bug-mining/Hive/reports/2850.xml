<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:27:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-8671] Overflow in estimate row count and data size with fetch column stats</title>
                <link>https://issues.apache.org/jira/browse/HIVE-8671</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Overflow in row counts and data size for several TPC-DS queries.&lt;br/&gt;
Interestingly the operators which have overflow end up running with a small parallelism.&lt;/p&gt;

&lt;p&gt;For instance Reducer 2 has an overflow but it only runs with parallelism of 2.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;       Reducer 2 
            Reduce Operator Tree:
              Group By Operator
                aggregations: sum(VALUE._col0)
                keys: KEY._col0 (type: string), KEY._col1 (type: string), KEY._col2 (type: string), KEY._col3 (type: string), KEY._col4 (type: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;)
                mode: mergepartial
                outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5
                Statistics: Num rows: 9223372036854775807 Data size: 9223372036854775341 Basic stats: COMPLETE Column stats: COMPLETE
                Reduce Output Operator
                  key expressions: _col3 (type: string), _col3 (type: string)
                  sort order: ++
                  Map-reduce partition columns: _col3 (type: string)
                  Statistics: Num rows: 9223372036854775807 Data size: 9223372036854775341 Basic stats: COMPLETE Column stats: COMPLETE
                  value expressions: _col0 (type: string), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;), _col5 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;)
            Execution mode: vectorized
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;VERTEX       TOTAL_TASKS    DURATION_SECONDS     CPU_TIME_MILLIS INPUT_RECORDS   OUTPUT_RECORDS 
Map 1                 62               26.41           1,779,510   211,978,502       60,628,390
Map 5                  1                4.28               6,950       138,098          138,098
Map 6                  1                2.44               3,910            31               31
Reducer 2              2               22.69              61,320    60,628,390           69,182
Reducer 3              1                2.63               3,910        69,182              100
Reducer 4              1                1.01               1,180           100              100
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Query&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;explain  
select  i_item_desc 
      ,i_category 
      ,i_class 
      ,i_current_price
      ,i_item_id
      ,sum(ws_ext_sales_price) as itemrevenue 
      ,sum(ws_ext_sales_price)*100/sum(sum(ws_ext_sales_price)) over
          (partition by i_class) as revenueratio
from	
	web_sales
    	,item 
    	,date_dim
where 
	web_sales.ws_item_sk = item.i_item_sk 
  	and item.i_category in (&lt;span class=&quot;code-quote&quot;&gt;&apos;Jewelry&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Sports&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Books&apos;&lt;/span&gt;)
  	and web_sales.ws_sold_date_sk = date_dim.d_date_sk
	and date_dim.d_date between &lt;span class=&quot;code-quote&quot;&gt;&apos;2001-01-12&apos;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&apos;2001-02-11&apos;&lt;/span&gt;
group by 
	i_item_id
        ,i_item_desc 
        ,i_category
        ,i_class
        ,i_current_price
order by 
	i_category
        ,i_class
        ,i_item_id
        ,i_item_desc
        ,revenueratio
limit 100
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Explain &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;STAGE PLANS:
  Stage: Stage-1
    Tez
      Edges:
        Map 1 &amp;lt;- Map 5 (BROADCAST_EDGE), Map 6 (BROADCAST_EDGE)
        Reducer 2 &amp;lt;- Map 1 (SIMPLE_EDGE)
        Reducer 3 &amp;lt;- Reducer 2 (SIMPLE_EDGE)
        Reducer 4 &amp;lt;- Reducer 3 (SIMPLE_EDGE)
      DagName: mmokhtar_20141019164343_854cb757-01bd-40cb-843e-9ada7c5e6f38:1
      Vertices:
        Map 1 
            Map Operator Tree:
                TableScan
                  alias: web_sales
                  filterExpr: ws_item_sk is not &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; (type: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;)
                  Statistics: Num rows: 21594638446 Data size: 2850189889652 Basic stats: COMPLETE Column stats: COMPLETE
                  Filter Operator
                    predicate: ws_item_sk is not &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; (type: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;)
                    Statistics: Num rows: 21594638446 Data size: 172746300152 Basic stats: COMPLETE Column stats: COMPLETE
                    Select Operator
                      expressions: ws_item_sk (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;), ws_ext_sales_price (type: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;), ws_sold_date_sk (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
                      outputColumnNames: _col0, _col1, _col2
                      Statistics: Num rows: 21594638446 Data size: 172746300152 Basic stats: COMPLETE Column stats: COMPLETE
                      Map Join Operator
                        condition map:
                             Inner Join 0 to 1
                        condition expressions:
                          0 {_col0} {_col1}
                          1 
                        keys:
                          0 _col2 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
                          1 _col0 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
                        outputColumnNames: _col0, _col1
                        input vertices:
                          1 Map 6
                        Statistics: Num rows: 24145061366 Data size: 193160490928 Basic stats: COMPLETE Column stats: COMPLETE
                        Map Join Operator
                          condition map:
                               Inner Join 0 to 1
                          condition expressions:
                            0 {_col1}
                            1 {_col1} {_col2} {_col3} {_col4} {_col5}
                          keys:
                            0 _col0 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
                            1 _col0 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
                          outputColumnNames: _col1, _col6, _col7, _col8, _col9, _col10
                          input vertices:
                            1 Map 5
                          Statistics: Num rows: 25381041158 Data size: 11929089344260 Basic stats: COMPLETE Column stats: COMPLETE
                          Select Operator
                            expressions: _col6 (type: string), _col7 (type: string), _col10 (type: string), _col9 (type: string), _col8 (type: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;), _col1 (type: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;)
                            outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5
                            Statistics: Num rows: 25381041158 Data size: 11929089344260 Basic stats: COMPLETE Column stats: COMPLETE
                            Group By Operator
                              aggregations: sum(_col5)
                              keys: _col0 (type: string), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;)
                              mode: hash
                              outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5
                              Statistics: Num rows: 119291 Data size: 954328 Basic stats: COMPLETE Column stats: COMPLETE
                              Reduce Output Operator
                                key expressions: _col0 (type: string), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;)
                                sort order: +++++
                                Map-reduce partition columns: _col0 (type: string), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;)
                                Statistics: Num rows: 119291 Data size: 954328 Basic stats: COMPLETE Column stats: COMPLETE
                                value expressions: _col5 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;)
            Execution mode: vectorized
        Map 5 
            Map Operator Tree:
                TableScan
                  alias: item
                  filterExpr: ((i_category) IN (&lt;span class=&quot;code-quote&quot;&gt;&apos;Jewelry&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Sports&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Books&apos;&lt;/span&gt;) and i_item_sk is not &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) (type: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;)
                  Statistics: Num rows: 462000 Data size: 663862160 Basic stats: COMPLETE Column stats: COMPLETE
                  Filter Operator
                    predicate: ((i_category) IN (&lt;span class=&quot;code-quote&quot;&gt;&apos;Jewelry&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Sports&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Books&apos;&lt;/span&gt;) and i_item_sk is not &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) (type: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;)
                    Statistics: Num rows: 231000 Data size: 109491664 Basic stats: COMPLETE Column stats: COMPLETE
                    Select Operator
                      expressions: i_item_sk (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;), i_item_id (type: string), i_item_desc (type: string), i_current_price (type: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;), i_class (type: string), i_category (type: string)
                      outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5
                      Statistics: Num rows: 231000 Data size: 109491664 Basic stats: COMPLETE Column stats: COMPLETE
                      Reduce Output Operator
                        key expressions: _col0 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
                        sort order: +
                        Map-reduce partition columns: _col0 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
                        Statistics: Num rows: 231000 Data size: 109491664 Basic stats: COMPLETE Column stats: COMPLETE
                        value expressions: _col1 (type: string), _col2 (type: string), _col3 (type: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;), _col4 (type: string), _col5 (type: string)
            Execution mode: vectorized
        Map 6 
            Map Operator Tree:
                TableScan
                  alias: date_dim
                  filterExpr: (d_date BETWEEN &lt;span class=&quot;code-quote&quot;&gt;&apos;2001-01-12&apos;&lt;/span&gt; AND &lt;span class=&quot;code-quote&quot;&gt;&apos;2001-02-11&apos;&lt;/span&gt; and d_date_sk is not &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) (type: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;)
                  Statistics: Num rows: 73049 Data size: 81741831 Basic stats: COMPLETE Column stats: COMPLETE
                  Filter Operator
                    predicate: (d_date BETWEEN &lt;span class=&quot;code-quote&quot;&gt;&apos;2001-01-12&apos;&lt;/span&gt; AND &lt;span class=&quot;code-quote&quot;&gt;&apos;2001-02-11&apos;&lt;/span&gt; and d_date_sk is not &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) (type: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;)
                    Statistics: Num rows: 36524 Data size: 3579352 Basic stats: COMPLETE Column stats: COMPLETE
                    Select Operator
                      expressions: d_date_sk (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
                      outputColumnNames: _col0
                      Statistics: Num rows: 36524 Data size: 146096 Basic stats: COMPLETE Column stats: COMPLETE
                      Reduce Output Operator
                        key expressions: _col0 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
                        sort order: +
                        Map-reduce partition columns: _col0 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
                        Statistics: Num rows: 36524 Data size: 146096 Basic stats: COMPLETE Column stats: COMPLETE
                      Select Operator
                        expressions: _col0 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
                        outputColumnNames: _col0
                        Statistics: Num rows: 36524 Data size: 0 Basic stats: PARTIAL Column stats: COMPLETE
                        Group By Operator
                          keys: _col0 (type: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
                          mode: hash
                          outputColumnNames: _col0
                          Statistics: Num rows: 36524 Data size: 0 Basic stats: PARTIAL Column stats: COMPLETE
                          Dynamic Partitioning Event Operator
                            Target Input: web_sales
                            Partition key expr: ws_sold_date_sk
                            Statistics: Num rows: 36524 Data size: 0 Basic stats: PARTIAL Column stats: COMPLETE
                            Target column: ws_sold_date_sk
                            Target Vertex: Map 1
            Execution mode: vectorized
        Reducer 2 
            Reduce Operator Tree:
              Group By Operator
                aggregations: sum(VALUE._col0)
                keys: KEY._col0 (type: string), KEY._col1 (type: string), KEY._col2 (type: string), KEY._col3 (type: string), KEY._col4 (type: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;)
                mode: mergepartial
                outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5
                Statistics: Num rows: 119291 Data size: 1908656 Basic stats: COMPLETE Column stats: COMPLETE
                Reduce Output Operator
                  key expressions: _col3 (type: string), _col3 (type: string)
                  sort order: ++
                  Map-reduce partition columns: _col3 (type: string)
                  Statistics: Num rows: 119291 Data size: 1908656 Basic stats: COMPLETE Column stats: COMPLETE
                  value expressions: _col0 (type: string), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;), _col5 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;)
            Execution mode: vectorized
        Reducer 3 
            Reduce Operator Tree:
              Extract
                Statistics: Num rows: 119291 Data size: 1908656 Basic stats: COMPLETE Column stats: COMPLETE
                PTF Operator
                  Statistics: Num rows: 119291 Data size: 1908656 Basic stats: COMPLETE Column stats: COMPLETE
                  Select Operator
                    expressions: _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;), _col0 (type: string), _col5 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), ((_col5 * 100.0) / _wcol0) (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;)
                    outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6
                    Statistics: Num rows: 119291 Data size: 954328 Basic stats: COMPLETE Column stats: COMPLETE
                    Reduce Output Operator
                      key expressions: _col1 (type: string), _col2 (type: string), _col4 (type: string), _col0 (type: string), _col6 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;)
                      sort order: +++++
                      Statistics: Num rows: 119291 Data size: 954328 Basic stats: COMPLETE Column stats: COMPLETE
                      TopN Hash Memory Usage: 0.04
                      value expressions: _col3 (type: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;), _col5 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;)
        Reducer 4 
            Reduce Operator Tree:
              Select Operator
                expressions: KEY.reducesinkkey3 (type: string), KEY.reducesinkkey0 (type: string), KEY.reducesinkkey1 (type: string), VALUE._col0 (type: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;), KEY.reducesinkkey2 (type: string), VALUE._col1 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), KEY.reducesinkkey4 (type: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;)
                outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6
                Statistics: Num rows: 119291 Data size: 954328 Basic stats: COMPLETE Column stats: COMPLETE
                Limit
                  &lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; of rows: 100
                  Statistics: Num rows: 100 Data size: 800 Basic stats: COMPLETE Column stats: COMPLETE
                  File Output Operator
                    compressed: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
                    Statistics: Num rows: 100 Data size: 800 Basic stats: COMPLETE Column stats: COMPLETE
                    table:
                        input format: org.apache.hadoop.mapred.TextInputFormat
                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
            Execution mode: vectorized

  Stage: Stage-0
    Fetch Operator
      limit: 100
      Processor Tree:
        ListSink

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12751705">HIVE-8671</key>
            <summary>Overflow in estimate row count and data size with fetch column stats</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="prasanth_j">Prasanth Jayachandran</assignee>
                                    <reporter username="mmokhtar">Mostafa Mokhtar</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Oct 2014 15:53:43 +0000</created>
                <updated>Thu, 13 Nov 2014 19:44:15 +0000</updated>
                            <resolved>Sat, 1 Nov 2014 19:31:52 +0000</resolved>
                                    <version>0.14.0</version>
                                    <fixVersion>0.14.0</fixVersion>
                                    <component>Physical Optimizer</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14191274" author="mmokhtar" created="Fri, 31 Oct 2014 03:33:00 +0000"  >&lt;p&gt;This is where the bug is :&lt;/p&gt;

&lt;p&gt;Since we hit an overflow before data size is set to Log.MAX_VALUE, then when we add 1 to that it overflows and reducers ends up being 1&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; estimateReducers(&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; totalInputFileSize, &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; bytesPerReducer,
      &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; maxReducers, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; powersOfTwo) {

    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; reducers = (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) ((totalInputFileSize + bytesPerReducer - 1) / bytesPerReducer);
    reducers = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.max(1, reducers);
    reducers = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.min(maxReducers, reducers);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14191285" author="mmokhtar" created="Fri, 31 Oct 2014 03:45:25 +0000"  >&lt;p&gt;For the code below the query had the following inputs:&lt;br/&gt;
totalInputFileSize = 9223372036854775341&lt;br/&gt;
bytesPerReducer = 100000000&lt;/p&gt;

&lt;p&gt;9223372036854775341 + 100000000 -&amp;gt; Overflow.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; estimateReducers(&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; totalInputFileSize, &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; bytesPerReducer,
      &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; maxReducers, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; powersOfTwo) {

    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; reducers = (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) ((totalInputFileSize + bytesPerReducer - 1) / bytesPerReducer);
    reducers = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.max(1, reducers);
    reducers = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.min(maxReducers, reducers);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I recommend changing to &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; reducers = (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) ((&lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.max(totalInputFileSize,bytesPerReducer )) / bytesPerReducer);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14191964" author="mmokhtar" created="Fri, 31 Oct 2014 15:53:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt;&lt;br/&gt;
Patch attached handles the overflow in the physical planning but not why the overflow happens in the first place&lt;/p&gt;</comment>
                            <comment id="14192251" author="mmokhtar" created="Fri, 31 Oct 2014 18:54:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14192512" author="prasanth_j" created="Fri, 31 Oct 2014 21:24:18 +0000"  >&lt;p&gt;The issue is related to ReduceSink&apos;s stats annotation rule. It does not rename the column statistics properly. The group by key column names gets overwritten with column stats of aggregate column since both of the have same suffix but different prefix (KEY, VALUE).. This is the reason for the overflow. I am still working on a fix. Will put up a patch shortly.&lt;/p&gt;</comment>
                            <comment id="14192647" author="sershe" created="Fri, 31 Oct 2014 22:34:28 +0000"  >&lt;p&gt;I am adding handling for overflows, there seem to be many potential overflows with large number of values. Should I open separate JIRA for that?&lt;br/&gt;
As a side note overflow needs to be handled before operation, not after, because it can conceivably overflow into positive in case of multiplication&lt;/p&gt;</comment>
                            <comment id="14192679" author="prasanth_j" created="Fri, 31 Oct 2014 22:54:05 +0000"  >&lt;p&gt;I am ok with doing it in separate JIRA. I just rebased my patch with Mostafa&apos;s changes in this JIRA. Adding again to it will be induce more conflicts.&lt;/p&gt;</comment>
                            <comment id="14192695" author="prasanth_j" created="Fri, 31 Oct 2014 23:08:38 +0000"  >&lt;p&gt;Added fix for overflow issue. Merged with changes from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mmokhtar&quot; class=&quot;user-hover&quot; rel=&quot;mmokhtar&quot;&gt;mmokhtar&lt;/a&gt;&apos;s patch. Tested the query on TPCDS 30000 scale and the stats looks good without overflow.&lt;/p&gt;</comment>
                            <comment id="14192782" author="sershe" created="Sat, 1 Nov 2014 00:00:57 +0000"  >&lt;p&gt;some comments on RB&lt;/p&gt;</comment>
                            <comment id="14192851" author="prasanth_j" created="Sat, 1 Nov 2014 01:09:08 +0000"  >&lt;p&gt;Addressed &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt;&apos;s code review changes.&lt;/p&gt;</comment>
                            <comment id="14192856" author="sershe" created="Sat, 1 Nov 2014 01:10:37 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14192951" author="hiveqa" created="Sat, 1 Nov 2014 04:05:06 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12678637/HIVE-8671.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12678637/HIVE-8671.4.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 14 failed/errored test(s), 6609 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_udf_explode
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_udtf_explode
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union11
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union14
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union15
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union17
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union19
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union21
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union5
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_union7
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_optimize_nullscan
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_union5
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_union7
org.apache.hive.minikdc.TestJdbcWithMiniKdc.testNegativeTokenAuth
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1584/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1584/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1584/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1584/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-1584/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-1584/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 14 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12678637 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14192967" author="prasanth_j" created="Sat, 1 Nov 2014 05:19:08 +0000"  >&lt;p&gt;Fixes test failures.&lt;/p&gt;</comment>
                            <comment id="14193142" author="hiveqa" created="Sat, 1 Nov 2014 13:04:54 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12678665/HIVE-8671.5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12678665/HIVE-8671.5.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 2 failed/errored test(s), 6609 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hive.hcatalog.streaming.TestStreaming.testRemainingTransactions
org.apache.hive.minikdc.TestJdbcWithMiniKdc.testNegativeTokenAuth
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1594/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1594/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1594/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/1594/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-1594/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-1594/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12678665 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14193351" author="prasanth_j" created="Sat, 1 Nov 2014 18:53:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hagleitn&quot; class=&quot;user-hover&quot; rel=&quot;hagleitn&quot;&gt;hagleitn&lt;/a&gt; Can we have this is 0.14?&lt;/p&gt;</comment>
                            <comment id="14193366" author="hagleitn" created="Sat, 1 Nov 2014 19:07:02 +0000"  >&lt;p&gt;+1 for 0.14&lt;/p&gt;</comment>
                            <comment id="14193387" author="prasanth_j" created="Sat, 1 Nov 2014 19:31:52 +0000"  >&lt;p&gt;Patch committed to trunk and branch-0.14.&lt;/p&gt;</comment>
                            <comment id="14211125" author="thejas" created="Thu, 13 Nov 2014 19:44:15 +0000"  >&lt;p&gt;This has been fixed in 0.14 release. Please open new jira if you see any issues.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12752112">HIVE-8689</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12678487" name="HIVE-8671.1.patch" size="2708" author="mmokhtar" created="Fri, 31 Oct 2014 15:46:44 +0000"/>
                            <attachment id="12678524" name="HIVE-8671.2.patch" size="3044" author="mmokhtar" created="Fri, 31 Oct 2014 18:54:48 +0000"/>
                            <attachment id="12678598" name="HIVE-8671.3.patch" size="23734" author="prasanth_j" created="Fri, 31 Oct 2014 23:08:38 +0000"/>
                            <attachment id="12678637" name="HIVE-8671.4.patch" size="23860" author="prasanth_j" created="Sat, 1 Nov 2014 01:09:08 +0000"/>
                            <attachment id="12678665" name="HIVE-8671.5.patch" size="46183" author="prasanth_j" created="Sat, 1 Nov 2014 05:19:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21rv3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>