<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:56:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-1561] smb_mapjoin_8.q returns different results in miniMr mode</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1561</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;follow on to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1523&quot; title=&quot;ql tests no longer work in miniMR mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1523&quot;&gt;&lt;del&gt;HIVE-1523&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;ant -Dclustermode=miniMR -Dtestcase=TestCliDriver -Dqfile=smb_mapjoin_8.q test&lt;/p&gt;

&lt;p&gt;POSTHOOK: query: select /&lt;b&gt;+mapjoin(a)&lt;/b&gt;/ * from smb_bucket4_1 a full outer join smb_bucket4_2 b on a.key = b.key&lt;/p&gt;

&lt;p&gt;official results:&lt;br/&gt;
4 val_356 NULL  NULL&lt;br/&gt;
NULL  NULL  484 val_169&lt;br/&gt;
2000  val_169 NULL  NULL&lt;br/&gt;
NULL  NULL  3000  val_169&lt;br/&gt;
4000  val_125 NULL  NULL&lt;/p&gt;


&lt;p&gt;in minimr mode:&lt;br/&gt;
2000  val_169 NULL  NULL&lt;br/&gt;
4 val_356 NULL  NULL&lt;br/&gt;
2000  val_169 NULL  NULL&lt;br/&gt;
4000  val_125 NULL  NULL&lt;br/&gt;
NULL  NULL  5000  val_125&lt;/p&gt;</description>
                <environment></environment>
        <key id="12471952">HIVE-1561</key>
            <summary>smb_mapjoin_8.q returns different results in miniMr mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="he yongqiang">He Yongqiang</assignee>
                                    <reporter username="jsensarma">Joydeep Sen Sarma</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Aug 2010 22:05:01 +0000</created>
                <updated>Sat, 17 Dec 2011 00:01:09 +0000</updated>
                            <resolved>Thu, 19 Aug 2010 23:42:17 +0000</resolved>
                                                    <fixVersion>0.7.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12900138" author="namit" created="Thu, 19 Aug 2010 01:12:35 +0000"  >&lt;p&gt;Looked at the data in detail:&lt;/p&gt;

&lt;p&gt;The tables should be:&lt;/p&gt;

&lt;p&gt;smb_bucket4_1 &lt;/p&gt;

&lt;p&gt;4             v356&lt;br/&gt;
2000      v169&lt;br/&gt;
4000     v125&lt;/p&gt;

&lt;p&gt;smb_bucket4_2&lt;/p&gt;

&lt;p&gt;484      v169&lt;br/&gt;
3000    v169&lt;br/&gt;
5000    v125&lt;/p&gt;


&lt;p&gt;So, the above query should result in 6 rows - both the results are wrong&lt;/p&gt;</comment>
                            <comment id="12900161" author="he yongqiang" created="Thu, 19 Aug 2010 03:11:08 +0000"  >&lt;p&gt;This is the complete result from Hive&apos;s smb_mapjoin_8.q.out, it&apos;s correct:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;POSTHOOK: query: select /*+mapjoin(a)*/ * from smb_bucket4_1 a full outer join smb_bucket4_2 b on a.key = b.key
POSTHOOK: type: QUERY
POSTHOOK: Input: default@smb_bucket4_2
POSTHOOK: Input: default@smb_bucket4_1
POSTHOOK: Output: file:/tmp/jssarma/hive_2010-07-21_12-02-34_137_8141051139723931378/10000
POSTHOOK: Lineage: smb_bucket4_1.key SIMPLE [(smb_bucket_input)smb_bucket_input.FieldSchema(name:key, type:int, comment:from deserializer), ]
POSTHOOK: Lineage: smb_bucket4_1.value SIMPLE [(smb_bucket_input)smb_bucket_input.FieldSchema(name:value, type:string, comment:from deserializer), ]
POSTHOOK: Lineage: smb_bucket4_2.key SIMPLE [(smb_bucket_input)smb_bucket_input.FieldSchema(name:key, type:int, comment:from deserializer), ]
POSTHOOK: Lineage: smb_bucket4_2.value SIMPLE [(smb_bucket_input)smb_bucket_input.FieldSchema(name:value, type:string, comment:from deserializer), ]
4	val_356	NULL	NULL
NULL	NULL	484	val_169
2000	val_169	NULL	NULL
NULL	NULL	3000	val_169
4000	val_125	NULL	NULL
NULL	NULL	5000	val_125
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</comment>
                            <comment id="12900176" author="namit" created="Thu, 19 Aug 2010 05:39:55 +0000"  >&lt;p&gt;My bad, I did not see the entire results - so, based on what Joy is saying, it does not work in minimr mode&lt;/p&gt;</comment>
                            <comment id="12900178" author="amareshwari" created="Thu, 19 Aug 2010 05:51:23 +0000"  >&lt;p&gt;When I tried SMB join on local machine (pseudo distributed mode) I&apos;m seeing wrong results for the join. I think if there are more than one mapper, the join logic does not work correctly.&lt;br/&gt;
Here is my run:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hive&amp;gt; describe extended smb_input;
OK
key     int
value   int

Detailed Table Information      Table(tableName:smb_input, dbName:default, owner:amarsri, createTime:1282026968, lastAccessTime:0, retention:0, sd:StorageDescriptor(cols:[FieldSchema(name:key, type:int, comment:null), FieldSchema(name:value, type:int, comment:null)], location:hdfs://localhost:19000/user/hive/warehouse/smb_input, inputFormat:org.apache.hadoop.mapred.TextInputFormat, outputFormat:org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat, compressed:false, numBuckets:1, serdeInfo:SerDeInfo(name:null, serializationLib:org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe, parameters:{serialization.format=1}), bucketCols:[key], sortCols:[Order(col:key, order:1)], parameters:{}), partitionKeys:[], parameters:{SORTBUCKETCOLSPREFIX=TRUE, transient_lastDdlTime=1282027032}, viewOriginalText:null, viewExpandedText:null, tableType:MANAGED_TABLE)
Time taken: 0.05 seconds

hive&amp;gt; select * from smb_input;
OK
12      35
48      40
100     100
Time taken: 0.343 seconds

hive&amp;gt; set hive.optimize.bucketmapjoin = true;
hive&amp;gt; set hive.optimize.bucketmapjoin.sortedmerge = true;

hive&amp;gt; select /*+ MAPJOIN(a) */ * from smb_input a join smb_input b on a.key=b.key;
Total MapReduce jobs = 1
Launching Job 1 out of 1
Number of reduce tasks is set to 0 since there&apos;s no reduce operator
Starting Job = job_201008031340_0170, Tracking URL = http://localhost:50030/jobdetails.jsp?jobid=job_201008031340_0170
Kill Command = /home/amarsri/workspace/Yahoo20/bin/../bin/hadoop job  -Dmapred.job.tracker=localhost:19101 -kill job_201008031340_0170
2010-08-19 11:04:00,040 Stage-1 map = 0%,  reduce = 0%
2010-08-19 11:04:10,253 Stage-1 map = 50%,  reduce = 0%
2010-08-19 11:04:13,271 Stage-1 map = 100%,  reduce = 0%
2010-08-19 11:05:13,636 Stage-1 map = 100%,  reduce = 0%
2010-08-19 11:05:19,664 Stage-1 map = 50%,  reduce = 0%
2010-08-19 11:05:25,733 Stage-1 map = 100%,  reduce = 0%
2010-08-19 11:05:28,762 Stage-1 map = 100%,  reduce = 100%
Ended Job = job_201008031340_0170
OK
12      35      12      35
48      40      48      40
Time taken: 100.056 seconds

Expected output:
12      35      12      35
48      40      48      40
100     100     100     100
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;The MapReduce Job launched for the join has 2 maps. Second map&apos;s first attempt (attempt_201008031340_0170_m_000001_0)  fails with following expetion:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2010-08-19 11:04:07,195 INFO org.apache.hadoop.hive.ql.exec.FileSinkOperator: replace taskId from execContext 
2010-08-19 11:04:07,195 INFO org.apache.hadoop.hive.ql.exec.FileSinkOperator: new taskId: FS 000000_0
2010-08-19 11:04:07,195 INFO org.apache.hadoop.hive.ql.exec.FileSinkOperator: Final Path: FS hdfs://localhost:19000/tmp/hive-amarsri/hive_2010-08-19_11-03-49_024_6433980309871155022/_tmp.-ext-10001/000000_0
2010-08-19 11:04:07,195 INFO org.apache.hadoop.hive.ql.exec.FileSinkOperator: Writing to temp file: FS hdfs://localhost:19000/tmp/hive-amarsri/hive_2010-08-19_11-03-49_024_6433980309871155022/_tmp.-ext-10001/_tmp.000000_0
2010-08-19 11:04:07,196 INFO org.apache.hadoop.hive.ql.exec.FileSinkOperator: New Final Path: FS hdfs://localhost:19000/tmp/hive-amarsri/hive_2010-08-19_11-03-49_024_6433980309871155022/_tmp.-ext-10001/000000_0
2010-08-19 11:05:08,290 INFO org.apache.hadoop.hive.ql.exec.TableScanOperator: 5 finished. closing... 
2010-08-19 11:05:08,290 INFO org.apache.hadoop.hive.ql.exec.TableScanOperator: 5 forwarded 5 rows
2010-08-19 11:05:08,290 INFO org.apache.hadoop.hive.ql.exec.TableScanOperator: 5 Close done
2010-08-19 11:05:08,290 INFO org.apache.hadoop.hive.ql.exec.SelectOperator: 2 finished. closing... 
2010-08-19 11:05:08,290 INFO org.apache.hadoop.hive.ql.exec.SelectOperator: 2 forwarded 1 rows
2010-08-19 11:05:08,290 INFO org.apache.hadoop.hive.ql.exec.SelectOperator: 3 finished. closing... 
2010-08-19 11:05:08,290 INFO org.apache.hadoop.hive.ql.exec.SelectOperator: 3 forwarded 1 rows
2010-08-19 11:05:08,290 INFO org.apache.hadoop.hive.ql.exec.FileSinkOperator: 4 finished. closing... 
2010-08-19 11:05:08,290 INFO org.apache.hadoop.hive.ql.exec.FileSinkOperator: 4 forwarded 0 rows
2010-08-19 11:05:08,656 ERROR ExecMapper: Hit error while closing operators - failing tree
2010-08-19 11:05:08,658 WARN org.apache.hadoop.mapred.Child: Error running child
java.lang.RuntimeException: Hive Runtime Error while closing operators
	at org.apache.hadoop.hive.ql.exec.ExecMapper.close(ExecMapper.java:253)
	at org.apache.hadoop.mapred.MapRunner.run(MapRunner.java:57)
	at org.apache.hadoop.mapred.MapTask.runOldMapper(MapTask.java:395)
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:329)
	at org.apache.hadoop.mapred.Child$4.run(Child.java:219)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:396)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1021)
	at org.apache.hadoop.mapred.Child.main(Child.java:213)
Caused by: org.apache.hadoop.hive.ql.metadata.HiveException: Unable to rename output to: hdfs://localhost:19000/tmp/hive-amarsri/hive_2010-08-19_11-03-49_024_6433980309871155022/_tmp.-ext-10001/000000_0
	at org.apache.hadoop.hive.ql.exec.FileSinkOperator$FSPaths.commit(FileSinkOperator.java:179)
	at org.apache.hadoop.hive.ql.exec.FileSinkOperator$FSPaths.access$200(FileSinkOperator.java:98)
	at org.apache.hadoop.hive.ql.exec.FileSinkOperator.closeOp(FileSinkOperator.java:636)
	at org.apache.hadoop.hive.ql.exec.Operator.close(Operator.java:540)
	at org.apache.hadoop.hive.ql.exec.Operator.close(Operator.java:549)
	at org.apache.hadoop.hive.ql.exec.Operator.close(Operator.java:549)
	at org.apache.hadoop.hive.ql.exec.Operator.close(Operator.java:549)
	at org.apache.hadoop.hive.ql.exec.Operator.close(Operator.java:549)
	at org.apache.hadoop.hive.ql.exec.Operator.close(Operator.java:549)
	at org.apache.hadoop.hive.ql.exec.ExecMapper.close(ExecMapper.java:230)
	... 8 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And second attempt(attempt_201008031340_0170_m_000001_1) passes :&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2010-08-19 11:05:21,384 INFO org.apache.hadoop.hive.ql.exec.FileSinkOperator: new taskId: FS 000000_1
2010-08-19 11:05:21,384 INFO org.apache.hadoop.hive.ql.exec.FileSinkOperator: Final Path: FS hdfs://localhost:19000/tmp/hive-amarsri/hive_2010-08-19_11-03-49_024_6433980309871155022/_tmp.-ext-10001/000000_1
2010-08-19 11:05:21,385 INFO org.apache.hadoop.hive.ql.exec.FileSinkOperator: Writing to temp file: FS hdfs://localhost:19000/tmp/hive-amarsri/hive_2010-08-19_11-03-49_024_6433980309871155022/_tmp.-ext-10001/_tmp.000000_1
2010-08-19 11:05:21,385 INFO org.apache.hadoop.hive.ql.exec.FileSinkOperator: New Final Path: FS hdfs://localhost:19000/tmp/hive-amarsri/hive_2010-08-19_11-03-49_024_6433980309871155022/_tmp.-ext-10001/000000_1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;attempt_201008031340_0170_m_000000_0 passes and output goes to :&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2010-08-19 11:04:06,198 INFO org.apache.hadoop.hive.ql.exec.FileSinkOperator: new taskId: FS 000000_0
2010-08-19 11:04:06,198 INFO org.apache.hadoop.hive.ql.exec.FileSinkOperator: Final Path: FS hdfs://localhost:19000/tmp/hive-amarsri/hive_2010-08-19_11-03-49_024_6433980309871155022/_tmp.-ext-10001/000000_0
2010-08-19 11:04:06,199 INFO org.apache.hadoop.hive.ql.exec.FileSinkOperator: Writing to temp file: FS hdfs://localhost:19000/tmp/hive-amarsri/hive_2010-08-19_11-03-49_024_6433980309871155022/_tmp.-ext-10001/_tmp.000000_0
2010-08-19 11:04:06,199 INFO org.apache.hadoop.hive.ql.exec.FileSinkOperator: New Final Path: FS hdfs://localhost:19000/tmp/hive-amarsri/hive_2010-08-19_11-03-49_024_6433980309871155022/_tmp.-ext-10001/000000_0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think the problem is both the attempt&apos;s attempt_201008031340_0170_m_000000_0 and attempt_201008031340_0170_m_000001_0 are trying to write to the same location. Also, though attempt_201008031340_0170_m_000001_1 writes to file 000000_1, it is not read? &lt;br/&gt;
Should attempt_201008031340_0170_m_000001_0 write to file 000001_0?&lt;/p&gt;</comment>
                            <comment id="12900384" author="he yongqiang" created="Thu, 19 Aug 2010 18:14:55 +0000"  >&lt;p&gt;Amareshwari, did you use BucketizedHiveInputFormat for your query? SMBJoin can only work with BucketizedHiveInputFormat.&lt;/p&gt;</comment>
                            <comment id="12900525" author="namit" created="Thu, 19 Aug 2010 23:22:23 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12900529" author="namit" created="Thu, 19 Aug 2010 23:42:17 +0000"  >&lt;p&gt;Committed. Thanks Yongqiang&lt;/p&gt;</comment>
                            <comment id="12900577" author="amareshwari" created="Fri, 20 Aug 2010 05:39:48 +0000"  >&lt;blockquote&gt;&lt;p&gt;Amareshwari, did you use BucketizedHiveInputFormat for your query? &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;No, I did not use BucketizedHiveInputFormat. After using it, I see correct results now. Thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12471157">HIVE-1523</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12452580" name="hive-1561.1.patch" size="5589" author="he yongqiang" created="Thu, 19 Aug 2010 22:03:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72838</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 14 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lfpr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123196</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>