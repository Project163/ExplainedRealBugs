<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:38:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-12025] refactor bucketId generating code</title>
                <link>https://issues.apache.org/jira/browse/HIVE-12025</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-11983&quot; title=&quot;Hive streaming API uses incorrect logic to assign buckets to incoming records&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-11983&quot;&gt;&lt;del&gt;HIVE-11983&lt;/del&gt;&lt;/a&gt; adds ObjectInspectorUtils.getBucketHashCode() and getBucketNumber().&lt;/p&gt;

&lt;p&gt;There are several (at least) places in Hive that perform this computation:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;ReduceSinkOperator.computeBucketNumber&lt;/li&gt;
	&lt;li&gt;ReduceSinkOperator.computeHashCode&lt;/li&gt;
	&lt;li&gt;BucketIdResolverImpl - only in 2.0.0 ASF line&lt;/li&gt;
	&lt;li&gt;FileSinkOperator.findWriterOffset&lt;/li&gt;
	&lt;li&gt;GenericUDFHash&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Should refactor it and make sure they all call methods from ObjectInspectorUtils.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12902190">HIVE-12025</key>
            <summary>refactor bucketId generating code</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ekoifman">Eugene Koifman</assignee>
                                    <reporter username="ekoifman">Eugene Koifman</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Oct 2015 19:41:11 +0000</created>
                <updated>Sat, 10 Oct 2015 18:33:50 +0000</updated>
                            <resolved>Sat, 10 Oct 2015 18:33:50 +0000</resolved>
                                    <version>1.0.1</version>
                                    <fixVersion>1.3.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14945974" author="ekoifman" created="Tue, 6 Oct 2015 23:11:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;prasanth_j&lt;/a&gt; could you review?&lt;/p&gt;</comment>
                            <comment id="14945984" author="sershe" created="Tue, 6 Oct 2015 23:20:39 +0000"  >&lt;p&gt;Can you post RB? it appears that the logic has changed for computeBucketNumber first branch&lt;/p&gt;</comment>
                            <comment id="14945998" author="ekoifman" created="Tue, 6 Oct 2015 23:30:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/39065/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/39065/&lt;/a&gt;&lt;br/&gt;
there is no logic changes - this purely refactoring&lt;/p&gt;</comment>
                            <comment id="14946048" author="ekoifman" created="Wed, 7 Oct 2015 00:14:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=teabot&quot; class=&quot;user-hover&quot; rel=&quot;teabot&quot;&gt;teabot&lt;/a&gt;, could you look at BucketIdResolverImpl changes?  I assume that making it consistent with the rest of Hive is the right thing to do.&lt;/p&gt;</comment>
                            <comment id="14947706" author="prasanth_j" created="Wed, 7 Oct 2015 22:23:24 +0000"  >&lt;p&gt;The changes introduced in this patch in BucketIdResolverImpl is the correct way to compute bucket number. ReduceSinkOperator had a bug in bucket number computation regarding negative hashcodes (multiplying by -1 vs mast with Int.MAX). There might be some test failures related to this change but that is the expected change. Since these are util methods, it will be good to have unit tests for these (if one doesnot exist).&lt;/p&gt;

&lt;p&gt;Other than that, lgtm +1. Pending tests.&lt;/p&gt;</comment>
                            <comment id="14948024" author="hiveqa" created="Thu, 8 Oct 2015 03:43:33 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12765297/HIVE-12025.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12765297/HIVE-12025.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 5 failed/errored test(s), 9638 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestMarkPartition - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.initializationError
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
org.apache.hive.hcatalog.streaming.mutate.worker.TestBucketIdResolverImpl.testAttachBucketIdToRecord
org.apache.hive.jdbc.TestSSL.testSSLVersion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5564/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5564/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5564/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5564/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5564/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5564/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 5 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12765297 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14948498" author="teabot" created="Thu, 8 Oct 2015 11:23:18 +0000"  >&lt;p&gt;This is definitely an improvement. It has broken a test but I suspect this is because the &lt;tt&gt;bucket_id&lt;/tt&gt; calculation in &lt;tt&gt;BucketIdResolverImpl&lt;/tt&gt; is currently incorrect and thus the expectations are also incorrect. This in itself underlines why this refactoring is desirable.&lt;/p&gt;

&lt;p&gt;May I suggest the following patch to fix the failing test:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;diff --git hcatalog/streaming/src/test/org/apache/hive/hcatalog/streaming/mutate/worker/TestBucketIdResolverImpl.java hcatalog/streaming/src/test/org/apache/hive/hcatalog/streaming/mutate/worker/TestBucketIdResolverImpl.java
index f81373e..5297c5d 100644
--- hcatalog/streaming/src/test/org/apache/hive/hcatalog/streaming/mutate/worker/TestBucketIdResolverImpl.java
+++ hcatalog/streaming/src/test/org/apache/hive/hcatalog/streaming/mutate/worker/TestBucketIdResolverImpl.java
@@ -23,7 +23,7 @@
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testAttachBucketIdToRecord() {
     MutableRecord record = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MutableRecord(1, &lt;span class=&quot;code-quote&quot;&gt;&quot;hello&quot;&lt;/span&gt;);
     capturingBucketIdResolver.attachBucketIdToRecord(record);
-    assertThat(record.rowId, is(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RecordIdentifier(-1L, 8, -1L)));
+    assertThat(record.rowId, is(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RecordIdentifier(-1L, 1, -1L)));
     assertThat(record.id, is(1));
     assertThat(record.msg.toString(), is(&lt;span class=&quot;code-quote&quot;&gt;&quot;hello&quot;&lt;/span&gt;));
   }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14949189" author="ekoifman" created="Thu, 8 Oct 2015 19:14:24 +0000"  >&lt;p&gt;patch 3 with new unit tests and fix to broken UT&lt;/p&gt;</comment>
                            <comment id="14951420" author="hiveqa" created="Fri, 9 Oct 2015 23:55:22 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12765658/HIVE-12025.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12765658/HIVE-12025.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 3 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 9645 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestMiniTezCliDriver-update_orig_table.q-vectorization_13.q-mapreduce2.q-and-12-more - did not produce a TEST-*.xml file
org.apache.hive.hcatalog.api.TestHCatClient.testTableSchemaPropagation
org.apache.hive.jdbc.TestSSL.testSSLVersion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5588/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5588/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5588/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/5588/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5588/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-5588/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12765658 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                            <comment id="14951424" author="ekoifman" created="Sat, 10 Oct 2015 00:01:56 +0000"  >&lt;p&gt;the 2 UT failures are not related.&lt;/p&gt;
</comment>
                            <comment id="14951979" author="ekoifman" created="Sat, 10 Oct 2015 18:33:50 +0000"  >&lt;p&gt;committed to branch-1 and master&lt;br/&gt;
thanks everyone for reviews&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12901161">HIVE-11983</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12765297" name="HIVE-12025.2.patch" size="9698" author="ekoifman" created="Wed, 7 Oct 2015 00:14:07 +0000"/>
                            <attachment id="12765658" name="HIVE-12025.3.patch" size="13940" author="ekoifman" created="Thu, 8 Oct 2015 19:14:24 +0000"/>
                            <attachment id="12765279" name="HIVE-12025.patch" size="9705" author="ekoifman" created="Tue, 6 Oct 2015 23:09:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 6 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2mjvr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>