<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:20:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-7190] WebHCat launcher task failure can cause two concurent user jobs to run</title>
                <link>https://issues.apache.org/jira/browse/HIVE-7190</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Templeton uses launcher jobs to launch the actual user jobs. Launcher jobs are 1-map jobs (a single task jobs) which kick off the actual user job and monitor it until it finishes. Given that the launcher is a task, like any other MR task, it has a retry policy in case it fails (due to a task crash, tasktracker/nodemanager crash, machine level outage, etc.). Further, when launcher task is retried, it will again launch the same user job, &lt;b&gt;however&lt;/b&gt; the previous attempt user job is already running. What this means is that we can have two identical user jobs running in parallel. &lt;/p&gt;

&lt;p&gt;In case of MRv2, there will be an MRAppMaster and the launcher task, which are subject to failure. In case any of the two fails, another instance of a user job will be launched again in parallel. &lt;/p&gt;

&lt;p&gt;Above situation is already a bug.&lt;/p&gt;

&lt;p&gt;Now going further to RM HA, what RM does on failover/restart is that it kills all containers, and it restarts all applications. This means that if our customer had 10 jobs on the cluster (this is 10 launcher jobs and 10 user jobs), on RM failover, all 20 jobs will be restarted, and launcher jobs will queue user jobs again. There are two issues with this design:&lt;br/&gt;
1. There are &lt;b&gt;possible&lt;/b&gt; chances for corruption of job outputs (it would be useful to analyze this scenario more and confirm this statement).&lt;br/&gt;
2. Cluster resources are spent on jobs redundantly&lt;/p&gt;

&lt;p&gt;To address the issue at least on Yarn (Hadoop 2.0) clusters, webhcat should do the same thing Oozie does in this scenario, and that is to tag all its child jobs with an id, and kill those jobs on task restart before they are kicked off again.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12718938">HIVE-7190</key>
            <summary>WebHCat launcher task failure can cause two concurent user jobs to run</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ivanmi">Ivan Mitic</assignee>
                                    <reporter username="ivanmi">Ivan Mitic</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Jun 2014 20:56:07 +0000</created>
                <updated>Tue, 9 Jun 2015 02:03:48 +0000</updated>
                            <resolved>Tue, 17 Jun 2014 20:47:47 +0000</resolved>
                                    <version>0.13.0</version>
                                    <fixVersion>0.14.0</fixVersion>
                                    <component>WebHCat</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14020358" author="ivanmi" created="Fri, 6 Jun 2014 20:57:07 +0000"  >&lt;p&gt;Will attach a patch in a bit, feel free to assign the Jira to me as I don&apos;t have the right to do so yet.&lt;/p&gt;</comment>
                            <comment id="14020393" author="ivanmi" created="Fri, 6 Jun 2014 21:15:55 +0000"  >&lt;p&gt;Attaching the initial patch.&lt;/p&gt;

&lt;p&gt;Approach in the patch is similar to what Oozie does to handle this situation. Specifically, all child map jobs get tagged with the launcher MR job id. On launcher task restart, launcher queries RM for the list of jobs that have the tag and kills them. After that it moves on to start the same child job again. Again, similarly to what Oozie does, a new &lt;tt&gt;templeton.job.launch.time&lt;/tt&gt; property is introduced that captures the launcher job submit timestamp and later used to reduce the search window when RM is queried. &lt;/p&gt;

&lt;p&gt;I have validated that MR, Pig and Hive jobs do get tagged appropriately. I have also validated that previous child jobs do get killed on RM failover/task failure.&lt;/p&gt;

&lt;p&gt;To validate the patch, you will need to add webhcat shim jars to templeton.libjars as now webhcat launcher also has a dependency on hadoop shims. &lt;/p&gt;

&lt;p&gt;I have noticed that in case of the SqoopDelegator webhcat currently does not set the MR delegation token when optionsFile flag is used. This also creates the problem in this scenario. This looks like something that should be handled via a separate Jira.&lt;/p&gt;</comment>
                            <comment id="14020435" author="ivanmi" created="Fri, 6 Jun 2014 22:03:29 +0000"  >&lt;p&gt;Review board: &lt;a href=&quot;https://reviews.apache.org/r/22329/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/22329/&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="14020437" author="ivanmi" created="Fri, 6 Jun 2014 22:03:58 +0000"  >&lt;p&gt;Rebasing patch against latest hive trunk.&lt;/p&gt;</comment>
                            <comment id="14028618" author="ivanmi" created="Thu, 12 Jun 2014 00:02:52 +0000"  >&lt;p&gt;Addressing Eugene&apos;s feedback. &lt;/p&gt;</comment>
                            <comment id="14030933" author="ekoifman" created="Fri, 13 Jun 2014 18:10:36 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14031391" author="thejas" created="Sat, 14 Jun 2014 01:44:36 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14033726" author="hiveqa" created="Tue, 17 Jun 2014 12:27:02 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12649960/HIVE-7190.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12649960/HIVE-7190.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 6 failed/errored test(s), 5537 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_parquet_columnar
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_root_dir_external_table
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_ctas
org.apache.hadoop.hive.ql.exec.tez.TestTezTask.testSubmit
org.apache.hive.hcatalog.pig.TestHCatLoader.testReadDataPrimitiveTypes
org.apache.hive.jdbc.miniHS2.TestHiveServer2.testConnection
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/489/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/489/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/489/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-Build/489/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-Build-489/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-Build-489/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 6 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12649960&lt;/p&gt;</comment>
                            <comment id="14034346" author="thejas" created="Tue, 17 Jun 2014 20:47:48 +0000"  >&lt;p&gt;Patch committed to trunk. Thanks for the contribution Ivan, thanks for the review Eugene!&lt;/p&gt;</comment>
                            <comment id="14034698" author="ivanmi" created="Wed, 18 Jun 2014 01:21:21 +0000"  >&lt;p&gt;Thanks Thejas and Eugene for the review and commit!&lt;/p&gt;</comment>
                            <comment id="14210876" author="thejas" created="Thu, 13 Nov 2014 19:43:02 +0000"  >&lt;p&gt;This has been fixed in 0.14 release. Please open new jira if you see any issues.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12836063">HIVE-10959</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12648742" name="HIVE-7190.2.patch" size="17182" author="ivanmi" created="Fri, 6 Jun 2014 22:03:58 +0000"/>
                            <attachment id="12649960" name="HIVE-7190.3.patch" size="23441" author="ivanmi" created="Thu, 12 Jun 2014 00:02:52 +0000"/>
                            <attachment id="12648728" name="HIVE-7190.patch" size="17262" author="ivanmi" created="Fri, 6 Jun 2014 21:15:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>397137</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1wdfj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>397260</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>