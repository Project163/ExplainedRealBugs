<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:02:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-3306] SMBJoin/BucketMapJoin should be allowed only when join key expression is exactly matches with sort/cluster key</title>
                <link>https://issues.apache.org/jira/browse/HIVE-3306</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;CREATE TABLE bucket_small (key int, value string) CLUSTERED BY (key) SORTED BY (key) INTO 2 BUCKETS STORED AS TEXTFILE;&lt;br/&gt;
load data local inpath &apos;/home/navis/apache/oss-hive/data/files/srcsortbucket1outof4.txt&apos; INTO TABLE bucket_small;&lt;br/&gt;
load data local inpath &apos;/home/navis/apache/oss-hive/data/files/srcsortbucket2outof4.txt&apos; INTO TABLE bucket_small;&lt;/p&gt;

&lt;p&gt;CREATE TABLE bucket_big (key int, value string) CLUSTERED BY (key) SORTED BY (key) INTO 4 BUCKETS STORED AS TEXTFILE;&lt;br/&gt;
load data local inpath &apos;/home/navis/apache/oss-hive/data/files/srcsortbucket1outof4.txt&apos; INTO TABLE bucket_big;&lt;br/&gt;
load data local inpath &apos;/home/navis/apache/oss-hive/data/files/srcsortbucket2outof4.txt&apos; INTO TABLE bucket_big;&lt;br/&gt;
load data local inpath &apos;/home/navis/apache/oss-hive/data/files/srcsortbucket3outof4.txt&apos; INTO TABLE bucket_big;&lt;br/&gt;
load data local inpath &apos;/home/navis/apache/oss-hive/data/files/srcsortbucket4outof4.txt&apos; INTO TABLE bucket_big;&lt;/p&gt;

&lt;p&gt;select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; FROM bucket_small a JOIN bucket_big b ON a.key + a.key = b.key;&lt;br/&gt;
select /* + MAPJOIN(a) */ count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; FROM bucket_small a JOIN bucket_big b ON a.key + a.key = b.key;&lt;br/&gt;
returns 116 (same) &lt;/p&gt;

&lt;p&gt;But with BucketMapJoin or SMBJoin, it returns 61. But this should not be allowed cause hash(a.key) != hash(a.key + a.key). &lt;br/&gt;
Bucket context should be utilized only with exact matching join expression with sort/cluster key.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12600430">HIVE-3306</key>
            <summary>SMBJoin/BucketMapJoin should be allowed only when join key expression is exactly matches with sort/cluster key</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="navis">Navis Ryu</assignee>
                                    <reporter username="navis">Navis Ryu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Jul 2012 06:20:48 +0000</created>
                <updated>Thu, 10 Jan 2013 19:53:36 +0000</updated>
                            <resolved>Thu, 6 Sep 2012 16:35:33 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.10.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13426335" author="navis" created="Wed, 1 Aug 2012 05:21:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.facebook.net/D4461&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D4461&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13426489" author="namit" created="Wed, 1 Aug 2012 10:11:51 +0000"  >&lt;p&gt;comments&lt;/p&gt;</comment>
                            <comment id="13427069" author="lianhuiwang" created="Thu, 2 Aug 2012 01:55:09 +0000"  >&lt;p&gt;also i think there have another context.&lt;br/&gt;
example:ON (a.key = b.key and a.key=10)&lt;br/&gt;
this should scan the 10 bucket&apos;s file.not all bucket&apos;s file in the table&apos;s path.&lt;/p&gt;</comment>
                            <comment id="13427110" author="namit" created="Thu, 2 Aug 2012 04:57:08 +0000"  >&lt;p&gt;@Lianhui, that is a separate (and important) issue.&lt;br/&gt;
Can you file a new jira for that ?&lt;/p&gt;</comment>
                            <comment id="13427127" author="lianhuiwang" created="Thu, 2 Aug 2012 05:47:34 +0000"  >&lt;p&gt;@Namit, i created a new jira &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3329&quot; title=&quot;Support bucket filtering when where expression or join key expression has the bucket key &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3329&quot;&gt;HIVE-3329&lt;/a&gt;, maybe there has some tasks.&lt;br/&gt;
now i finish the work that the table is not partition table.&lt;br/&gt;
next i will work for the partition table.&lt;/p&gt;</comment>
                            <comment id="13449427" author="namit" created="Thu, 6 Sep 2012 05:16:02 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Running tests&lt;/p&gt;</comment>
                            <comment id="13449787" author="namit" created="Thu, 6 Sep 2012 16:35:33 +0000"  >&lt;p&gt;Committed. Thanks Navis&lt;/p&gt;</comment>
                            <comment id="13450184" author="hudson" created="Thu, 6 Sep 2012 23:57:10 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #1652 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/1652/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/1652/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3306&quot; title=&quot;SMBJoin/BucketMapJoin should be allowed only when join key expression is exactly matches with sort/cluster key&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3306&quot;&gt;&lt;del&gt;HIVE-3306&lt;/del&gt;&lt;/a&gt; SMBJoin/BucketMapJoin should be allowed only when join key expression is exactly matches&lt;br/&gt;
with sort/cluster key (Navis via namit) (Revision 1381669)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
namit : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1381669&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1381669&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/BucketMapJoinOptimizer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/bucket_map_join_1.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/bucket_map_join_2.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/bucketmapjoin_negative3.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/bucket_map_join_1.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/bucket_map_join_2.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/bucketmapjoin_negative3.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13548023" author="hudson" created="Wed, 9 Jan 2013 10:23:59 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #54 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3306&quot; title=&quot;SMBJoin/BucketMapJoin should be allowed only when join key expression is exactly matches with sort/cluster key&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3306&quot;&gt;&lt;del&gt;HIVE-3306&lt;/del&gt;&lt;/a&gt; SMBJoin/BucketMapJoin should be allowed only when join key expression is exactly matches&lt;br/&gt;
with sort/cluster key (Navis via namit) (Revision 1381669)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
namit : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1381669&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1381669&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/BucketMapJoinOptimizer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/bucket_map_join_1.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/bucket_map_join_2.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/bucketmapjoin_negative3.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/bucket_map_join_1.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/bucket_map_join_2.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/bucketmapjoin_negative3.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13550156" author="ashutoshc" created="Thu, 10 Jan 2013 19:53:36 +0000"  >&lt;p&gt;This issue is fixed and released as part of 0.10.0 release. If you find an issue which seems to be related to this one, please create a new jira and link this one with new jira.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12543972" name="HIVE-3306.1.patch.txt" size="61571" author="navis" created="Thu, 6 Sep 2012 02:24:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>259177</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 45 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lnav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>124425</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>