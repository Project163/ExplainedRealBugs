<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:03:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-3640] Reducer allocation is incorrect if enforce bucketing and mapred.reduce.tasks are both set</title>
                <link>https://issues.apache.org/jira/browse/HIVE-3640</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;When I enforce bucketing and fix the number of reducers via mapred.reduce.tasks Hive ignores my input and instead takes the largest value &amp;lt;= hive.exec.reducers.max that is also an even divisor of num_buckets. In other words, if I set 1024 buckets and set mapred.reduce.tasks=1024 I&apos;ll get. . . 256 reducers. If I set 1997 buckets and set mapred.reduce.tasks=1997 I&apos;ll get. . . 1 reducer. &lt;/p&gt;

&lt;p&gt;This is totally crazy, and it&apos;s far, far crazier when the data inputs get large. In the latter case the bucketing job will almost certainly fail because we&apos;ll most likely try to stuff several TB of input through a single reducer. We&apos;ll also drastically reduce the effectiveness of bucketing, since the buckets themselves will be larger.&lt;/p&gt;

&lt;p&gt;If the user sets mapred.reduce.tasks in a query that inserts into a bucketed table we should either accept that value or raise an exception if it&apos;s invalid relative to the number of buckets. We should absolutely NOT override the user&apos;s direction and fall back on automatically allocating reducers based on some obscure logic dictated by completely different setting. &lt;/p&gt;

&lt;p&gt;I have yet to encounter a single person who expected this the first time, so it&apos;s clearly a bug.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12614001">HIVE-3640</key>
            <summary>Reducer allocation is incorrect if enforce bucketing and mapred.reduce.tasks are both set</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vighnesh.avadhani">Vighnesh Avadhani</assignee>
                                    <reporter username="vighnesh.avadhani">Vighnesh Avadhani</reporter>
                        <labels>
                    </labels>
                <created>Tue, 30 Oct 2012 08:03:57 +0000</created>
                <updated>Thu, 10 Jan 2013 19:52:58 +0000</updated>
                            <resolved>Sat, 3 Nov 2012 00:27:36 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.10.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="172800">48h</timeoriginalestimate>
                            <timeestimate seconds="172800">48h</timeestimate>
                                        <comments>
                            <comment id="13486729" author="vighnesh.avadhani" created="Tue, 30 Oct 2012 08:24:17 +0000"  >&lt;p&gt;Fixd bug and added corresponding unit test&lt;/p&gt;</comment>
                            <comment id="13486736" author="namit" created="Tue, 30 Oct 2012 08:32:15 +0000"  >&lt;p&gt;Can you create a review request using&lt;br/&gt;
&lt;a href=&quot;https://cwiki.apache.org/Hive/phabricatorcodereview.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/Hive/phabricatorcodereview.html&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="13487061" author="vighnesh.avadhani" created="Tue, 30 Oct 2012 17:50:10 +0000"  >&lt;p&gt;Done: &lt;a href=&quot;https://reviews.facebook.net/D6327&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D6327&lt;/a&gt;&lt;br/&gt;
I could not use arc diff --jira &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3640&quot; title=&quot;Reducer allocation is incorrect if enforce bucketing and mapred.reduce.tasks are both set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3640&quot;&gt;&lt;del&gt;HIVE-3640&lt;/del&gt;&lt;/a&gt; as it was throwing:&lt;br/&gt;
PHP Fatal error:  Call to undefined method ArcanistGitAPI::amendGitHeadCommit() in /Users/vighnesh/hive/.arc_jira_lib/arcanist/ArcJIRAConfiguration.php on line 173&lt;/p&gt;</comment>
                            <comment id="13488862" author="kevinwilfong" created="Thu, 1 Nov 2012 17:32:24 +0000"  >&lt;p&gt;Couple minor comments on the diff.&lt;/p&gt;

&lt;p&gt;Could you also hit the &quot;Submit Patch&quot; button to mark the JIRA &quot;Patch Available&quot; so reviewers know to review the diff.&lt;/p&gt;</comment>
                            <comment id="13488962" author="kevinwilfong" created="Thu, 1 Nov 2012 19:31:30 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13489871" author="kevinwilfong" created="Sat, 3 Nov 2012 00:27:36 +0000"  >&lt;p&gt;Committed, thanks Vighnesh.&lt;/p&gt;</comment>
                            <comment id="13489883" author="vighnesh.avadhani" created="Sat, 3 Nov 2012 00:47:32 +0000"  >&lt;p&gt;Thanks for committing Kevin.&lt;/p&gt;</comment>
                            <comment id="13489996" author="hudson" created="Sat, 3 Nov 2012 11:36:38 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #1771 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/1771/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/1771/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3640&quot; title=&quot;Reducer allocation is incorrect if enforce bucketing and mapred.reduce.tasks are both set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3640&quot;&gt;&lt;del&gt;HIVE-3640&lt;/del&gt;&lt;/a&gt;. Reducer allocation is incorrect if enforce bucketing and mapred.reduce.tasks are both set. (Vighnesh Avadhani via kevinwilfong) (Revision 1405240)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
kevinwilfong : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1405240&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1405240&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/build-common.xml&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/org/apache/hadoop/hive/ql/hooks/VerifyNumReducersForBucketsHook.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/bucket_num_reducers.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/bucket_num_reducers.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13548343" author="hudson" created="Wed, 9 Jan 2013 10:25:22 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #54 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3640&quot; title=&quot;Reducer allocation is incorrect if enforce bucketing and mapred.reduce.tasks are both set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3640&quot;&gt;&lt;del&gt;HIVE-3640&lt;/del&gt;&lt;/a&gt;. Reducer allocation is incorrect if enforce bucketing and mapred.reduce.tasks are both set. (Vighnesh Avadhani via kevinwilfong) (Revision 1405240)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
kevinwilfong : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1405240&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1405240&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/build-common.xml&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/org/apache/hadoop/hive/ql/hooks/VerifyNumReducersForBucketsHook.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/bucket_num_reducers.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/bucket_num_reducers.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13549991" author="ashutoshc" created="Thu, 10 Jan 2013 19:52:58 +0000"  >&lt;p&gt;This issue is fixed and released as part of 0.10.0 release. If you find an issue which seems to be related to this one, please create a new jira and link this one with new jira.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12551321" name="HIVE-3640.1.patch.txt" size="5512" author="vighnesh.avadhani" created="Tue, 30 Oct 2012 08:24:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253115</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 45 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0dblr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>75809</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>