<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:22:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-26373] ClassCastException when reading timestamps from HBase table with Avro data</title>
                <link>https://issues.apache.org/jira/browse/HIVE-26373</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Consider an HBase table (e.g., HiveAvroTable) that has column with Avro data and there are timestamps nested under complex/struct types.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;EXTERNAL&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; hbase_avro_table(
`&lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt;` &lt;span class=&quot;code-keyword&quot;&gt;string&lt;/span&gt; COMMENT &apos;&apos;,
`data_frv4` struct&amp;lt;`id`:&lt;span class=&quot;code-keyword&quot;&gt;string&lt;/span&gt;, `dischargedate`:struct&amp;lt;`&lt;span class=&quot;code-keyword&quot;&gt;value&lt;/span&gt;`:&lt;span class=&quot;code-keyword&quot;&gt;timestamp&lt;/span&gt;&amp;gt;&amp;gt;)
&lt;span class=&quot;code-keyword&quot;&gt;ROW&lt;/span&gt; FORMAT SERDE
  &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.hadoop.hive.hbase.HBaseSerDe&apos;&lt;/span&gt;
STORED &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.hadoop.hive.hbase.HBaseStorageHandler&apos;&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;WITH&lt;/span&gt; SERDEPROPERTIES (
&lt;span class=&quot;code-quote&quot;&gt;&apos;serialization.format&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&apos;hbase.&lt;span class=&quot;code-keyword&quot;&gt;columns&lt;/span&gt;.mapping&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;:&lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;data&lt;/span&gt;:frV4&apos;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;data&lt;/span&gt;.frV4.serialization.&lt;span class=&quot;code-keyword&quot;&gt;type&lt;/span&gt;&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;avro&apos;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;data&lt;/span&gt;.frV4.avro.&lt;span class=&quot;code-keyword&quot;&gt;schema&lt;/span&gt;.url&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;path&lt;/span&gt;/&lt;span class=&quot;code-keyword&quot;&gt;to&lt;/span&gt;/avro/&lt;span class=&quot;code-keyword&quot;&gt;schema&lt;/span&gt;/&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;/&lt;span class=&quot;code-keyword&quot;&gt;column&lt;/span&gt;/filename.avsc&apos;&lt;/span&gt;
)
TBLPROPERTIES (
&lt;span class=&quot;code-quote&quot;&gt;&apos;hbase.&lt;span class=&quot;code-keyword&quot;&gt;table&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;name&lt;/span&gt;&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;HiveAvroTable&apos;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&apos;hbase.struct.autogenerate&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Any attempt to read the timestamp value from the nested struct leads to a &lt;tt&gt;ClassCastException&lt;/tt&gt;.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; data_frV4.dischargedate.&lt;span class=&quot;code-keyword&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; hbase_avro_table;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Below you can find the stack trace for the previous query:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2022-07-05T08:40:51,572 ERROR [LocalJobRunner Map Task Executor #0] mr.ExecMapper: org.apache.hadoop.hive.ql.metadata.HiveException: Hive Runtime Error while processing row
        at org.apache.hadoop.hive.ql.exec.MapOperator.process(MapOperator.java:573)
        at org.apache.hadoop.hive.ql.exec.mr.ExecMapper.map(ExecMapper.java:148)
        at org.apache.hadoop.mapred.MapRunner.run(MapRunner.java:54)
        at org.apache.hadoop.hive.ql.exec.mr.ExecMapRunner.run(ExecMapRunner.java:37)
        at org.apache.hadoop.mapred.MapTask.runOldMapper(MapTask.java:465)
        at org.apache.hadoop.mapred.MapTask.run(MapTask.java:349)
        at org.apache.hadoop.mapred.LocalJobRunner$Job$MapTaskRunnable.run(LocalJobRunner.java:271)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
        at java.util.concurrent.FutureTask.run(FutureTask.java:266)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
        at java.lang.Thread.run(Thread.java:748)
Caused by: java.lang.ClassCastException: org.apache.hadoop.hive.common.type.Timestamp cannot be cast to org.apache.hadoop.hive.serde2.lazy.LazyPrimitive
        at org.apache.hadoop.hive.serde2.lazy.objectinspector.primitive.AbstractPrimitiveLazyObjectInspector.getPrimitiveWritableObject(AbstractPrimitiveLazyObjectInspector.java:40)
        at org.apache.hadoop.hive.serde2.lazy.objectinspector.primitive.LazyTimestampObjectInspector.getPrimitiveWritableObject(LazyTimestampObjectInspector.java:29)
        at org.apache.hadoop.hive.serde2.lazy.LazyUtils.writePrimitiveUTF8(LazyUtils.java:308)
        at org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe.serialize(LazySimpleSerDe.java:292)
        at org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe.serializeField(LazySimpleSerDe.java:247)
        at org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe.doSerialize(LazySimpleSerDe.java:231)
        at org.apache.hadoop.hive.serde2.AbstractEncodingAwareSerDe.serialize(AbstractEncodingAwareSerDe.java:55)
        at org.apache.hadoop.hive.ql.exec.FileSinkOperator.process(FileSinkOperator.java:1059)
        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:937)
        at org.apache.hadoop.hive.ql.exec.SelectOperator.process(SelectOperator.java:95)
        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:937)
        at org.apache.hadoop.hive.ql.exec.TableScanOperator.process(TableScanOperator.java:128)
        at org.apache.hadoop.hive.ql.exec.MapOperator$MapOpCtx.forward(MapOperator.java:152)
        at org.apache.hadoop.hive.ql.exec.MapOperator.process(MapOperator.java:552)
        ... 11 more 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The problem starts in&#160;&lt;tt&gt;toLazyObject&lt;/tt&gt;&#160;method of&#160;&lt;b&gt;AvroLazyObjectInspector.java&lt;/b&gt;, when&#160;&lt;a href=&quot;https://github.com/apache/hive/blob/53009126f6fe7ccf24cf052fd6c156542f38b19d/serde/src/java/org/apache/hadoop/hive/serde2/avro/AvroLazyObjectInspector.java#L347&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this&lt;/a&gt;&#160;condition&#160;returns false for&#160;&lt;b&gt;Timestamp&lt;/b&gt;, preventing the conversion of&#160;&lt;b&gt;Timestamp&lt;/b&gt;&#160;to&#160;&lt;b&gt;LazyTimestamp&lt;/b&gt;&#160;&lt;a href=&quot;https://github.com/apache/hive/blob/53009126f6fe7ccf24cf052fd6c156542f38b19d/serde/src/java/org/apache/hadoop/hive/serde2/lazy/LazyFactory.java#L132&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The solution is to return &lt;tt&gt;true&lt;/tt&gt; for Timestamps in the &lt;tt&gt;isPrimitive&lt;/tt&gt; method.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13470402">HIVE-26373</key>
            <summary>ClassCastException when reading timestamps from HBase table with Avro data</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="soumyakanti.das">Soumyakanti Das</assignee>
                                    <reporter username="soumyakanti.das">Soumyakanti Das</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 6 Jul 2022 16:53:13 +0000</created>
                <updated>Wed, 16 Nov 2022 13:50:17 +0000</updated>
                            <resolved>Fri, 8 Jul 2022 10:52:56 +0000</resolved>
                                                    <fixVersion>4.0.0-alpha-2</fixVersion>
                                    <component>Hive</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4200">1h 10m</timespent>
                                <comments>
                            <comment id="17563363" author="zabetak" created="Wed, 6 Jul 2022 18:04:47 +0000"  >&lt;p&gt;Thanks for working on this &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=soumyakanti.das&quot; class=&quot;user-hover&quot; rel=&quot;soumyakanti.das&quot;&gt;soumyakanti.das&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;The summary is a bit misleading; the error does not appear while inserting data into HBase but rather when we are getting data out as shown in the stacktrace. Moreover not all queries will fail.&lt;/p&gt;

&lt;p&gt;Please rephrase the summary and add more details in the description so that someone not familiar with the problem can understand better what is happening. &lt;/p&gt;</comment>
                            <comment id="17563716" author="zabetak" created="Thu, 7 Jul 2022 11:25:16 +0000"  >&lt;p&gt;This bug probably exists from the very beginning that Hive added support for Avro data in HBase (&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-6147&quot; title=&quot;Support avro data stored in HBase columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-6147&quot;&gt;&lt;del&gt;HIVE-6147&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="17564233" author="zabetak" created="Fri, 8 Jul 2022 10:51:43 +0000"  >&lt;p&gt;I updated the summary and description to better reflect the problem.&lt;/p&gt;</comment>
                            <comment id="17564234" author="zabetak" created="Fri, 8 Jul 2022 10:52:56 +0000"  >&lt;p&gt;Fixed in &lt;a href=&quot;https://github.com/apache/hive/commit/97d7630bca10e96229519ab397f5cf122e5622e3.&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/commit/97d7630bca10e96229519ab397f5cf122e5622e3.&lt;/a&gt; Thanks for the PR &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=soumyakanti.das&quot; class=&quot;user-hover&quot; rel=&quot;soumyakanti.das&quot;&gt;soumyakanti.das&lt;/a&gt; !&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13470580">HIVE-26379</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12687501">HIVE-6147</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 18 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z16ntc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>