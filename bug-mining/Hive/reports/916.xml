<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:02:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-3242] Fix cascade_dbdrop.q when building hive on hadoop0.23</title>
                <link>https://issues.apache.org/jira/browse/HIVE-3242</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;cascade_dbdrop.q is failing when building hive on hadoop0.23:&lt;/p&gt;

&lt;p&gt;Failing with the following diff:&lt;br/&gt;
-Command failed with exit code = -1&lt;br/&gt;
+Command failed with exit code = 1&lt;/p&gt;</description>
                <environment></environment>
        <key id="12597876">HIVE-3242</key>
            <summary>Fix cascade_dbdrop.q when building hive on hadoop0.23</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zhenxiao">Zhenxiao Luo</assignee>
                                    <reporter username="zhenxiao">Zhenxiao Luo</reporter>
                        <labels>
                    </labels>
                <created>Sat, 7 Jul 2012 00:57:55 +0000</created>
                <updated>Thu, 10 Jan 2013 19:53:14 +0000</updated>
                            <resolved>Mon, 20 Aug 2012 23:25:44 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.10.0</fixVersion>
                                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13408505" author="zhenxiao" created="Sat, 7 Jul 2012 00:59:01 +0000"  >&lt;p&gt;if dfs -ls file, when the file does not exist, hadoop0.20 returns exit&lt;br/&gt;
code -1, and hadoop0.23 returns exit code 1. Is this correct?&lt;br/&gt;
For example, in hive, for the following dfs command:&lt;br/&gt;
dfs -ls ../build/ql/tmp/hbase/hbase_table_0;&lt;br/&gt;
If the file does not exist, get exit code -1 on hadoop0.20, and exit&lt;br/&gt;
code 1 on hadoop0.23.&lt;br/&gt;
A brief read of hadoop code, on hadoop 0.20(FsShell.java):&lt;br/&gt;
private int ls(String srcf, boolean recursive) throws IOException {&lt;br/&gt;
Path srcPath = new Path(srcf);&lt;br/&gt;
FileSystem srcFs = srcPath.getFileSystem(this.getConf());&lt;br/&gt;
FileStatus[] srcs = srcFs.globStatus(srcPath);&lt;br/&gt;
if (srcs==null || srcs.length==0) &lt;/p&gt;
{ throw new FileNotFoundException(&quot;Cannot access &quot; + srcf + &quot;: No such file or directory.&quot;); }
&lt;p&gt;boolean printHeader = (srcs.length == 1) ? true: false;&lt;br/&gt;
int numOfErrors = 0;&lt;br/&gt;
for(int i=0; i&amp;lt;srcs.length; i++) &lt;/p&gt;
{ numOfErrors += ls(srcs[i], srcFs, recursive, printHeader); }
&lt;p&gt;return numOfErrors == 0 ? 0 : -1;&lt;br/&gt;
}&lt;br/&gt;
So, it returns -1 on non-exist file.&lt;br/&gt;
While, on hadoop0.23(Command.java):&lt;br/&gt;
public int run(String...argv) {&lt;br/&gt;
LinkedList&amp;lt;String&amp;gt; args = new LinkedList&amp;lt;String&amp;gt;(Arrays.asList(argv));&lt;br/&gt;
try {&lt;br/&gt;
if (isDeprecated()) &lt;/p&gt;
{ displayWarning( &quot;DEPRECATED: Please use &apos;&quot;+ getReplacementCommand() + &quot;&apos; instead.&quot;); }
&lt;p&gt;processOptions(args);&lt;br/&gt;
processRawArguments(args);&lt;br/&gt;
} catch (IOException e) &lt;/p&gt;
{ displayError(e); }
&lt;p&gt;return (numErrors == 0) ? exitCode : exitCodeForError();&lt;br/&gt;
}&lt;br/&gt;
/**&lt;br/&gt;
The exit code to be returned if any errors occur during execution.&lt;br/&gt;
This method is needed to account for the inconsistency in the exit&lt;br/&gt;
codes returned by various commands.&lt;br/&gt;
@return a non-zero exit code&lt;br/&gt;
*/&lt;br/&gt;
protected int exitCodeForError() &lt;/p&gt;
{ return 1; }
&lt;p&gt;So, it returns 1 on non-exist file.&lt;br/&gt;
The return exit code is always non-zero on non-exist file, while, it&lt;br/&gt;
is 1 on hadoop0.23, and -1 on hadoop0.20.&lt;/p&gt;

&lt;p&gt;Plan to have separate qfile and expected output for hadoop0.20 and hadoop0.23&lt;/p&gt;</comment>
                            <comment id="13408519" author="zhenxiao" created="Sat, 7 Jul 2012 01:29:19 +0000"  >&lt;p&gt;review request submitted:&lt;br/&gt;
&lt;a href=&quot;https://reviews.facebook.net/D4047&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D4047&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13408541" author="zhenxiao" created="Sat, 7 Jul 2012 02:16:15 +0000"  >&lt;p&gt;updated review request submitted:&lt;br/&gt;
&lt;a href=&quot;https://reviews.facebook.net/D4047&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D4047&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13409052" author="kannakar@microsoft.com" created="Sun, 8 Jul 2012 19:51:15 +0000"  >&lt;p&gt;@Zhenxiao - if possible, can you please update &quot;TestHBaseCliDriver.vm&quot; with the same changes to keep all VM files in sync for better maintenance. Thanks&lt;/p&gt;</comment>
                            <comment id="13409110" author="zhenxiao" created="Mon, 9 Jul 2012 00:02:19 +0000"  >&lt;p&gt;@Kanna: Thanks a lot. My patch is updated, and re-submitted at:&lt;br/&gt;
&lt;a href=&quot;https://reviews.facebook.net/D4047&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D4047&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13409140" author="kannakar@microsoft.com" created="Mon, 9 Jul 2012 02:52:05 +0000"  >&lt;p&gt;Thanks Zhenxiao. The changes look good to me but I am not 100% sure with forking of .q files for different Hadoop versions. I will leave it for experts to comment.&lt;/p&gt;</comment>
                            <comment id="13410673" author="zhenxiao" created="Tue, 10 Jul 2012 18:30:55 +0000"  >&lt;p&gt;New patch submitted for review at:&lt;br/&gt;
&lt;a href=&quot;https://reviews.facebook.net/D4077&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D4077&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13410819" author="cwsteinbach" created="Tue, 10 Jul 2012 20:20:57 +0000"  >&lt;p&gt;+1. Will commit if tests pass.&lt;/p&gt;</comment>
                            <comment id="13425559" author="ashutoshc" created="Tue, 31 Jul 2012 06:22:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhenxiao&quot; class=&quot;user-hover&quot; rel=&quot;zhenxiao&quot;&gt;zhenxiao&lt;/a&gt; Patch doesnt apply cleanly anymore. Can you rebase it?&lt;/p&gt;</comment>
                            <comment id="13426013" author="zhenxiao" created="Tue, 31 Jul 2012 18:48:15 +0000"  >&lt;p&gt;updated patch submitted at:&lt;br/&gt;
&lt;a href=&quot;https://reviews.facebook.net/D4455&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D4455&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13426273" author="ashutoshc" created="Wed, 1 Aug 2012 01:47:41 +0000"  >&lt;p&gt;+1 Running tests.&lt;/p&gt;</comment>
                            <comment id="13426791" author="ashutoshc" created="Wed, 1 Aug 2012 18:17:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhenxiao&quot; class=&quot;user-hover&quot; rel=&quot;zhenxiao&quot;&gt;zhenxiao&lt;/a&gt; See my comments on phabricator.&lt;/p&gt;</comment>
                            <comment id="13426823" author="zhenxiao" created="Wed, 1 Aug 2012 19:02:05 +0000"  >&lt;p&gt;@Ashutosh: thanks a lot for the comments. updated patch submitted at:&lt;br/&gt;
&lt;a href=&quot;https://reviews.facebook.net/D4455&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D4455&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13426962" author="ashutoshc" created="Wed, 1 Aug 2012 22:28:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhenxiao&quot; class=&quot;user-hover&quot; rel=&quot;zhenxiao&quot;&gt;zhenxiao&lt;/a&gt; I think include/exclude hadoop version combination is still not correct. For 1.x line, exit code = -1, so cascade_dbdrop.q will fail for it and cascade_dbdrop20.q will not run on 1.x&lt;/p&gt;</comment>
                            <comment id="13426967" author="zhenxiao" created="Wed, 1 Aug 2012 22:36:26 +0000"  >&lt;p&gt;@Ashutosh:&lt;/p&gt;

&lt;p&gt;My idea is:&lt;br/&gt;
For 1.x line(hadoop20), cascade_dbdrop.q does not run, so it EXCLUDE 0.20, cascade_dbdrop_hadoop20.q will be running, so it INCLUDE 0.20.&lt;br/&gt;
And, cascade_dbdrop_hadoop20.q.out is having exit code -1.&lt;/p&gt;

&lt;p&gt;For 2.x line(hadoop23), cascade_dbdrop.q will be running. (it EXCLUDE 0.20, so will be running for 0.23), cascade_dbdrop_hadoop20.q does not run(it only INCLUDE 0.20, not running for 0.23).&lt;br/&gt;
And, cascade_dbdrop.q.out is having exit code 1.&lt;/p&gt;

&lt;p&gt;INCLUDE only runs the test if the hadoop version is included in the INCLUDE macro&lt;br/&gt;
EXCLUDE only runs the test if the hadoop version is not excluded in the EXCLUDE macro&lt;/p&gt;

&lt;p&gt;Is my understanding correct?&lt;br/&gt;
Any comments are appreciated.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Zhenxiao&lt;/p&gt;</comment>
                            <comment id="13429539" author="cwsteinbach" created="Mon, 6 Aug 2012 22:53:31 +0000"  >&lt;p&gt;@Zhenxiao: Yes, your understanding is correct, but Ashutosh&apos;s point is that this test doesn&apos;t work for Hadoop 1.x. Please update the patch so that it passes by adding &quot;1.0&quot; to one of the macros.&lt;/p&gt;</comment>
                            <comment id="13429624" author="zhenxiao" created="Tue, 7 Aug 2012 00:46:54 +0000"  >&lt;p&gt;@Ashutosh and Carl:&lt;br/&gt;
Get it. Thanks for your comments. I updated my patch and submitted for review at:&lt;br/&gt;
&lt;a href=&quot;https://reviews.facebook.net/D4545&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.facebook.net/D4545&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Zhenxiao&lt;/p&gt;</comment>
                            <comment id="13437699" author="cwsteinbach" created="Mon, 20 Aug 2012 07:17:56 +0000"  >&lt;p&gt;+1. Will commit if tests pass.&lt;/p&gt;</comment>
                            <comment id="13438303" author="cwsteinbach" created="Mon, 20 Aug 2012 23:25:44 +0000"  >&lt;p&gt;Committed to trunk. Thanks Zhenxiao!&lt;/p&gt;</comment>
                            <comment id="13438469" author="hudson" created="Tue, 21 Aug 2012 05:37:34 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #1619 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/1619/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/1619/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3242&quot; title=&quot;Fix cascade_dbdrop.q when building hive on hadoop0.23&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3242&quot;&gt;&lt;del&gt;HIVE-3242&lt;/del&gt;&lt;/a&gt;. Fix cascade_dbdrop.q when building hive on hadoop0.23 (Zhenxiao Luo via cws) (Revision 1375313)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
cws : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1375313&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1375313&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/hbase-handler/src/test/queries/negative/cascade_dbdrop.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/hbase-handler/src/test/queries/negative/cascade_dbdrop_hadoop20.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/hbase-handler/src/test/results/negative/cascade_dbdrop.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/hbase-handler/src/test/results/negative/cascade_dbdrop_hadoop20.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/hbase-handler/src/test/templates/TestHBaseCliDriver.vm&lt;/li&gt;
	&lt;li&gt;/hive/trunk/hbase-handler/src/test/templates/TestHBaseNegativeCliDriver.vm&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13548302" author="hudson" created="Wed, 9 Jan 2013 10:25:12 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #54 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3242&quot; title=&quot;Fix cascade_dbdrop.q when building hive on hadoop0.23&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3242&quot;&gt;&lt;del&gt;HIVE-3242&lt;/del&gt;&lt;/a&gt;. Fix cascade_dbdrop.q when building hive on hadoop0.23 (Zhenxiao Luo via cws) (Revision 1375313)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
cws : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1375313&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1375313&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/hbase-handler/src/test/queries/negative/cascade_dbdrop.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/hbase-handler/src/test/queries/negative/cascade_dbdrop_hadoop20.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/hbase-handler/src/test/results/negative/cascade_dbdrop.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/hbase-handler/src/test/results/negative/cascade_dbdrop_hadoop20.q.out&lt;/li&gt;
	&lt;li&gt;/hive/trunk/hbase-handler/src/test/templates/TestHBaseCliDriver.vm&lt;/li&gt;
	&lt;li&gt;/hive/trunk/hbase-handler/src/test/templates/TestHBaseNegativeCliDriver.vm&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13550064" author="ashutoshc" created="Thu, 10 Jan 2013 19:53:14 +0000"  >&lt;p&gt;This issue is fixed and released as part of 0.10.0 release. If you find an issue which seems to be related to this one, please create a new jira and link this one with new jira.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12600246">HIVE-3301</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12535497" name="HIVE-3242.1.patch.txt" size="2585" author="zhenxiao" created="Sat, 7 Jul 2012 01:29:32 +0000"/>
                            <attachment id="12535503" name="HIVE-3242.2.patch.txt" size="6658" author="zhenxiao" created="Sat, 7 Jul 2012 02:15:22 +0000"/>
                            <attachment id="12535604" name="HIVE-3242.3.patch.txt" size="7744" author="zhenxiao" created="Mon, 9 Jul 2012 00:01:17 +0000"/>
                            <attachment id="12535892" name="HIVE-3242.4.patch.txt" size="8007" author="zhenxiao" created="Tue, 10 Jul 2012 18:31:12 +0000"/>
                            <attachment id="12538596" name="HIVE-3242.5.patch.txt" size="7765" author="zhenxiao" created="Tue, 31 Jul 2012 18:48:35 +0000"/>
                            <attachment id="12538822" name="HIVE-3242.6.patch.txt" size="8120" author="zhenxiao" created="Wed, 1 Aug 2012 19:02:17 +0000"/>
                            <attachment id="12539390" name="HIVE-3242.7.patch.txt" size="8150" author="zhenxiao" created="Tue, 7 Aug 2012 00:48:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>242368</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 45 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02u5b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14485</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>