<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:26:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-28194] Fix flaky tests in TestRetryingThriftCLIServiceClient (Failed to start HS2)</title>
                <link>https://issues.apache.org/jira/browse/HIVE-28194</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The following testcases are flaky in this test class:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&lt;b&gt;org.apache.hive.service.cli.TestRetryingThriftCLIServiceClient.testTransportClose&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;org.apache.hive.service.cli.TestRetryingThriftCLIServiceClient.testRetryBehaviour&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;org.apache.hive.service.cli.TestRetryingThriftCLIServiceClient.testSessionLifeAfterTransportClose&lt;/b&gt;&lt;b&gt;{&lt;/b&gt;}&lt;/li&gt;
&lt;/ol&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.hive.service.ServiceException: Failed to Start HiveServer2
at org.apache.hive.service.CompositeService.start(CompositeService.java:80)
at org.apache.hive.service.server.HiveServer2.start(HiveServer2.java:715)
at
org.apache.hive.service.cli.TestRetryingThriftCLIServiceClient.startHiveServer(TestRetryingThriftCLIServiceClient.java:72)
at
org.apache.hive.service.cli.TestRetryingThriftCLIServiceClient.testRetryBehaviour(TestRetryingThriftCLIServiceClient.java:1
19)
at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.base/java.lang.reflect.Method.invoke(Method.java:568)
at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:379)
at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:340)
at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:125)
at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:413)
Caused by: java.lang.RuntimeException: Failed to init thrift server
at org.apache.hive.service.cli.thrift.ThriftBinaryCLIService.initServer(ThriftBinaryCLIService.java:159)
at org.apache.hive.service.cli.thrift.ThriftCLIService.start(ThriftCLIService.java:226)
at org.apache.hive.service.CompositeService.start(CompositeService.java:70)
... 29 more
Caused by: org.apache.thrift.transport.TTransportException: Could not create ServerSocket on address 0.0.0.0/0.0.0.0:15000.
at org.apache.thrift.transport.TServerSocket.&amp;lt;init&amp;gt;(TServerSocket.java:109)
at org.apache.thrift.transport.TServerSocket.&amp;lt;init&amp;gt;(TServerSocket.java:91)
at org.apache.thrift.transport.TServerSocket.&amp;lt;init&amp;gt;(TServerSocket.java:87)
at org.apache.hadoop.hive.common.auth.HiveAuthUtils.getServerSocket(HiveAuthUtils.java:159)
at org.apache.hive.service.cli.thrift.ThriftBinaryCLIService.initServer(ThriftBinaryCLIService.java:80)
... 31 more
Caused by: java.net.BindException: Address already in use
at java.base/sun.nio.ch.Net.bind0(Native Method)
at java.base/sun.nio.ch.Net.bind(Net.java:555)
at java.base/sun.nio.ch.Net.bind(Net.java:544)
at java.base/sun.nio.ch.NioSocketImpl.bind(NioSocketImpl.java:648)
at java.base/java.net.ServerSocket.bind(ServerSocket.java:388)
at org.apache.thrift.transport.TServerSocket.&amp;lt;init&amp;gt;(TServerSocket.java:106)
... 35 more &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13575346">HIVE-28194</key>
            <summary>Fix flaky tests in TestRetryingThriftCLIServiceClient (Failed to start HS2)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="araika">Araika Singh</assignee>
                                    <reporter username="araika">Araika Singh</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 10 Apr 2024 12:51:18 +0000</created>
                <updated>Tue, 29 Jul 2025 14:52:05 +0000</updated>
                            <resolved>Wed, 13 Nov 2024 08:59:04 +0000</resolved>
                                                    <fixVersion>4.1.0</fixVersion>
                                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17835746" author="zhangbutao" created="Wed, 10 Apr 2024 13:57:54 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=araika&quot; class=&quot;user-hover&quot; rel=&quot;araika&quot;&gt;araika&lt;/a&gt; , thanks for reporting this issue.&lt;/p&gt;

&lt;p&gt;How did you find these flaky tests?&lt;/p&gt;

&lt;p&gt;It is better to run the flaky-check CI &lt;a href=&quot;http://ci.hive.apache.org/job/hive-flaky-check/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ci.hive.apache.org/job/hive-flaky-check/&lt;/a&gt; to confirm that these tests are indeed flaky. The flaky-check CI can repeatedly run the tests many times and you can easily get the tests report to check if the tests are flaky.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="17837067" author="JIRAUSER301024" created="Mon, 15 Apr 2024 05:18:43 +0000"  >&lt;p&gt;Hi&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhangbutao&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Butao Zhang !&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I came across this error in our pipelines, and I am not sure who is holding the particular port. I did run the flaky check pipeline as you have mentioned, but this issue is hard to reproduce.&lt;/p&gt;

&lt;p&gt;Hence, in order to improve this test I have come across a solution that is similar to the following jira&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-18147&quot; title=&quot;Tests can fail with java.net.BindException: Address already in use&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-18147&quot;&gt;&lt;del&gt;HIVE-18147&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17838875" author="JIRAUSER301024" created="Fri, 19 Apr 2024 06:52:54 +0000"  >&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13068306/13068306_image-2024-04-19-12-21-57-577.png&quot; height=&quot;508&quot; width=&quot;786&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13068307/13068307_image-2024-04-19-12-22-47-006.png&quot; height=&quot;508&quot; width=&quot;786&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17838876" author="JIRAUSER301024" created="Fri, 19 Apr 2024 06:55:52 +0000"  >&lt;p&gt;I was able to replicate this issue in my local on running the same test on parallel, one of them failed with the same exact error.&lt;/p&gt;</comment>
                            <comment id="17838904" author="zhangbutao" created="Fri, 19 Apr 2024 08:11:34 +0000"  >&lt;p&gt;If you run all three tests simultaneously, you may encounter the flaky case as the three will launch HS2 server and they will try to use the same address port.&lt;/p&gt;

&lt;p&gt;But in the normal test situation, we only run the root test class &lt;b&gt;&lt;em&gt;TestRetryingThriftCLIServiceClient,&lt;/em&gt;&lt;/b&gt; and it will run the three tests one by one, so we won&apos;t encounter the issue. Hive CI also uses this way to run class test.&lt;/p&gt;

&lt;p&gt;I want to know why you want to run the tests on parallel? Running one by one can not fit your situation?&lt;/p&gt;</comment>
                            <comment id="17838911" author="JIRAUSER301024" created="Fri, 19 Apr 2024 08:36:21 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhangbutao&quot; class=&quot;user-hover&quot; rel=&quot;zhangbutao&quot;&gt;zhangbutao&lt;/a&gt; ,&lt;br/&gt;
Thanks for replying!&lt;/p&gt;

&lt;p&gt;Here we are not trying to solve this issue for the same test class, but for several classes/group of classes. There is a time gap between when we have chosen the port vs when actually the HS2 is started. By that time, some other test in parallel test split execution may pick it up as free port.&#160;&lt;br/&gt;
Similar issues were fixed for other classes in the following jiras:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-18147&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-18147&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-19595&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-19595&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Moreover, test class&#160;&lt;em&gt;TestRetryingThriftCLIServiceClient&lt;/em&gt; was missed, and this Jira is just an extension of the same.&lt;/p&gt;</comment>
                            <comment id="17838912" author="zhangbutao" created="Fri, 19 Apr 2024 08:41:55 +0000"  >&lt;p&gt;OK, if you have the solution to fix this, please feel free to submit a PR.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="17897860" author="dkuzmenko" created="Wed, 13 Nov 2024 08:58:34 +0000"  >&lt;p&gt;Merged to master&lt;br/&gt;
Thanks for the contribution, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=araika&quot; class=&quot;user-hover&quot; rel=&quot;araika&quot;&gt;araika&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13068306" name="image-2024-04-19-12-21-57-577.png" size="983174" author="araika" created="Fri, 19 Apr 2024 06:52:03 +0000"/>
                            <attachment id="13068307" name="image-2024-04-19-12-22-47-006.png" size="770424" author="araika" created="Fri, 19 Apr 2024 06:52:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ojwo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>