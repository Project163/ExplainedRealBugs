<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 17:57:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-1959] Potential memory leak when same connection used for long time. TaskInfo and QueryInfo objects are getting accumulated on executing more queries on the same connection.</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1959</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;&lt;b&gt;org.apache.hadoop.hive.ql.history.HiveHistory$TaskInfo&lt;/b&gt; and &lt;b&gt;org.apache.hadoop.hive.ql.history.HiveHistory$QueryInfo&lt;/b&gt; these two objects are getting accumulated on executing more number of queries on the same connection. These objects are getting released only when the connection is closed.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Hadoop 0.20.1, Hive0.5.0 and SUSE Linux Enterprise Server 10 SP2 (i586) - Kernel 2.6.16.60-0.21-smp (5).&lt;/p&gt;</environment>
        <key id="12497681">HIVE-1959</key>
            <summary>Potential memory leak when same connection used for long time. TaskInfo and QueryInfo objects are getting accumulated on executing more queries on the same connection.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chinnalalam">Chinna Rao Lalam</assignee>
                                    <reporter username="chinnalalam">Chinna Rao Lalam</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Feb 2011 13:58:09 +0000</created>
                <updated>Fri, 16 Dec 2011 23:55:39 +0000</updated>
                            <resolved>Thu, 17 Mar 2011 19:26:40 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>Server Infrastructure</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13000896" author="chinnalalam" created="Tue, 1 Mar 2011 14:52:38 +0000"  >&lt;p&gt;In startQuery() of HiveHistory.java  QueryInfo object  put in to  queryInfoMap and while executing the query QueryInfo object is used after getting from the queryInfoMap But this object is not removed from the map so these objects are keep on increasing in the map and resulted the memory leak. This object can be removed from the map in endQuery() of HiveHistory.java&lt;/p&gt;

&lt;p&gt;Same thing is happening for TaskInfo objects also.&lt;br/&gt;
The TaskInfo objects can be removed from the map in endTask() of HiveHistory.java&lt;/p&gt;</comment>
                            <comment id="13000970" author="mis" created="Tue, 1 Mar 2011 17:17:42 +0000"  >&lt;p&gt;How about using WeakHashMap in place of using HashMap instead of explicitly removing from the map! The WeakHashMap can be used for both the fields- queryInfoMap and taskInfoMap of HiveHistory.java class.&lt;/p&gt;</comment>
                            <comment id="13001085" author="nzhang" created="Tue, 1 Mar 2011 20:07:39 +0000"  >&lt;p&gt;+1 on WeakHashMap. HiveHistory.endQuery() is called at the finally clause of Driver.execute(). There are some early exits (should be changed in my opinion. I will file another JIRA to fix this) in the loop of execute() which will bypass the finally clause. Using WeakHashMap can prevent leaks in this case.  &lt;/p&gt;</comment>
                            <comment id="13002542" author="chinnalalam" created="Fri, 4 Mar 2011 11:07:42 +0000"  >&lt;p&gt;Thanks Ning Zhang &amp;amp; &#3221;&#3248;&#3263;&#3247;  for the comments. &lt;/p&gt;

&lt;p&gt;If we use WeakHashMap when no one have the reference for the QueryInfo or TaskInfo objects other than weakhashmap if GC happens these objects will be garbage collected.&lt;/p&gt;

&lt;p&gt;But in our case the QueryInfo or TaskInfo objects will be accessed in different stages like StartQuery ,setQueryProperty and  EndQuery etc.&lt;/p&gt;

&lt;p&gt;For Ex some queries will execute more time (May be some hours), At the time of start query it will put the data in to weakhashmap after long time endQuery() is executed in between some times it will accesses the weakhashmap from the methods like &lt;br/&gt;
setQueryProperty().&lt;/p&gt;

&lt;p&gt;But by that time if GC triggered there is a chance to garbage collect these objects(QueryInfo &amp;amp; TaskInfo). This case we will lose the information of QueryInfo &amp;amp; TaskInfo objects. Here we don&apos;t have control, GC will have the control to remove the objects.&lt;/p&gt;

&lt;p&gt;Using HashMap and removing objects from the map through code, this case we will have control.&lt;/p&gt;

&lt;p&gt;@Ning Zhang : There are some early exits (should be changed in my opinion. I will file another JIRA to fix this) in the loop of execute() which will bypass the finally clause.&lt;br/&gt;
This case we have to change the implementation, present implementation is calling System.exit(9) it will exit from JVM. I will provide a patch for this issue.&lt;/p&gt;</comment>
                            <comment id="13007828" author="nzhang" created="Thu, 17 Mar 2011 05:56:04 +0000"  >&lt;p&gt;Sorry Chinna, I must have missed your last comment. &lt;/p&gt;

&lt;p&gt;Yeah, I think it will work with the current patch. I will start testing and commit if it passes. &lt;/p&gt;</comment>
                            <comment id="13007928" author="appodictic" created="Thu, 17 Mar 2011 14:28:27 +0000"  >&lt;p&gt;While WeakHashMap may work logically it may not be our best option. If we only find one instance of a class in the entire code base I generally believe that is breaking some un-established internal coding standards and introducing a behaviour that is not in line with the rest of the systems. (A two mile view)&lt;/p&gt;</comment>
                            <comment id="13008084" author="nzhang" created="Thu, 17 Mar 2011 19:26:40 +0000"  >&lt;p&gt;Comitted. Thanks Chinna!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12472309" name="HIVE-1959.patch" size="565" author="chinnalalam" created="Tue, 1 Mar 2011 14:10:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72604</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 36 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lhrr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123529</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>