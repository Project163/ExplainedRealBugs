<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 18:08:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HIVE-5048] StorageBasedAuthorization provider causes an NPE when asked to authorize from client side.</title>
                <link>https://issues.apache.org/jira/browse/HIVE-5048</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;StorageBasedAuthorizationProvider(henceforth referred to as SBAP) is a HiveMetastoreAuthorizationProvider (henceforth referred to as HMAP, and HiveAuthorizationProvider as HAP) that was introduced as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3705&quot; title=&quot;Adding authorization capability to the metastore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3705&quot;&gt;&lt;del&gt;HIVE-3705&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;As long as it&apos;s used as a HMAP, i.e. from the metastore-side, as was its initial implementation intent, everything&apos;s great. However, HMAP extends HAP, and there is no reason SBAP shouldn&apos;t be expected to work as a HAP as well. However, it uses a wh variable that is never initialized if it is called as a HAP, and hence, it will always fail when authorize is called on it.&lt;/p&gt;

&lt;p&gt;We should change SBAP so that it correctly initiazes wh so that it can be run as a HAP as well.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12662972">HIVE-5048</key>
            <summary>StorageBasedAuthorization provider causes an NPE when asked to authorize from client side.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sushanth">Sushanth Sowmyan</assignee>
                                    <reporter username="sushanth">Sushanth Sowmyan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Aug 2013 21:59:47 +0000</created>
                <updated>Mon, 5 May 2014 09:45:07 +0000</updated>
                            <resolved>Fri, 16 Aug 2013 03:54:52 +0000</resolved>
                                                    <fixVersion>0.12.0</fixVersion>
                                    <component>Security</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13735560" author="sushanth" created="Sat, 10 Aug 2013 00:05:53 +0000"  >&lt;p&gt;Note on reproduction, you&apos;d hit this issue only if you have hive.security.authorization.enabled set to true, and hive.security.authorization.manager set to &quot;org.apache.hadoop.hive.ql.security.authorization.StorageBasedAuthorizationProvider&quot;.&lt;/p&gt;

&lt;p&gt;If anyone is experiencing this issue, the work around till this bug is fixed is one of the following :&lt;/p&gt;

&lt;p&gt;a) If you would like to turn off the client-side authorization provider, set &quot;hive.security.authorization.enabled&quot; to false.&lt;br/&gt;
b) If you desire another client-side authorization instead, set &quot;hive.security.authorization.manager&quot; to something SBAP&lt;br/&gt;
c) If you want SBAP behaviour for your authorization, you can use this from the metastore-side, by setting &quot;hive.security.metastore.authorization.manager&quot; to &quot;org.apache.hadoop.hive.ql.security.authorization.StorageBasedAuthorizationProvider&quot; (sets HMAP as SBAP) and &quot;hive.metastore.pre.event.listeners&quot; to &quot;org.apache.hadoop.hive.ql.security.AuthorizationPreEventListener&quot; (turns on metastore-side auth)&lt;/p&gt;


</comment>
                            <comment id="13739093" author="sushanth" created="Wed, 14 Aug 2013 00:48:57 +0000"  >&lt;p&gt;Attached patch to make sure that wh is instantiated whether called from the client side or the metastore side.&lt;/p&gt;</comment>
                            <comment id="13739774" author="ashutoshc" created="Wed, 14 Aug 2013 15:34:04 +0000"  >&lt;p&gt;I think your checks are masking underlying problem. IMO correct fix for this is that Warehouse should always be initialized. If it so happens that metastore is up and warehouse isn&apos;t, thats illegal state, doesn&apos;t matter if calls are made from client or server. This has been discussed before as well : &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2079?focusedCommentId=13104063&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13104063&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-2079?focusedCommentId=13104063&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13104063&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13740017" author="sushanth" created="Wed, 14 Aug 2013 18:37:47 +0000"  >&lt;p&gt;Ashutosh, I&apos;m afraid I don&apos;t understand what problem I&apos;m masking, the fix I add is doing exactly that - making sure a wh variable is always instantiated.&lt;/p&gt;

&lt;p&gt;In the current form, SBAP is usable only from the metastore-side, and wasn&apos;t initially written to be initializable from the client-side. When initialized from the metastore, the setMetaStoreHandler call is called, and the wh variable is initialized from handler.getWh() and all is good.&lt;/p&gt;

&lt;p&gt;This patch addresses the case where it is called from the client-side, in which case we do not have a wh object (which we were previously getting from the metastore) and so, with this patch, we initialize it.&lt;/p&gt;

&lt;p&gt;I added the else{} block for the sake of completeness/documentation, but realistically, that can never/will never be entered. I can change the MetaException to an IllegalStateException to make that more strict, if that&apos;s what you mean.&lt;/p&gt;</comment>
                            <comment id="13740282" author="sushanth" created="Wed, 14 Aug 2013 22:16:58 +0000"  >&lt;p&gt;Replaced MetaException with IllegalStateException, which is a more accurate representation for a code block that should never be reached.&lt;/p&gt;</comment>
                            <comment id="13740812" author="ashutoshc" created="Thu, 15 Aug 2013 08:46:22 +0000"  >&lt;p&gt;I see what you mean. My comment on &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2079&quot; title=&quot;The warehouse directory shouldn&amp;#39;t be 777&amp;#39;ed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2079&quot;&gt;HIVE-2079&lt;/a&gt; needs to be resolved too, but thats a different issue. +1 Can you upload in correct format and mark it Patch Available to get HIVE QA to run on it.&lt;/p&gt;</comment>
                            <comment id="13741312" author="sushanth" created="Thu, 15 Aug 2013 18:36:26 +0000"  >&lt;p&gt;Updating patch name from &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5048&quot; title=&quot;StorageBasedAuthorization provider causes an NPE when asked to authorize from client side.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5048&quot;&gt;&lt;del&gt;HIVE-5048&lt;/del&gt;&lt;/a&gt;.patch.2 to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5048&quot; title=&quot;StorageBasedAuthorization provider causes an NPE when asked to authorize from client side.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5048&quot;&gt;&lt;del&gt;HIVE-5048&lt;/del&gt;&lt;/a&gt;.2.patch &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13741448" author="hiveqa" created="Thu, 15 Aug 2013 20:41:05 +0000"  >

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall&lt;/font&gt;: -1 at least one tests failed&lt;/p&gt;

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12598266/HIVE-5048.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12598266/HIVE-5048.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 1 failed/errored test(s), 2859 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_udtf_not_supported2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/454/testReport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/454/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/454/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/454/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests failed with: TestsFailedException: 1 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13741879" author="ashutoshc" created="Fri, 16 Aug 2013 03:54:52 +0000"  >&lt;p&gt;Committed to trunk. Thanks, Sushanth!&lt;/p&gt;</comment>
                            <comment id="13741901" author="hudson" created="Fri, 16 Aug 2013 04:31:41 +0000"  >&lt;p&gt;FAILURE: Integrated in Hive-trunk-hadoop2 #364 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/364/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/364/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5048&quot; title=&quot;StorageBasedAuthorization provider causes an NPE when asked to authorize from client side.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5048&quot;&gt;&lt;del&gt;HIVE-5048&lt;/del&gt;&lt;/a&gt; : StorageBasedAuthorization provider causes an NPE when asked to authorize from client side. (Sushanth Sowmyan via Ashutosh Chauhan) (hashutosh: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1514569&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1514569&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/HiveAuthorizationProviderBase.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/StorageBasedAuthorizationProvider.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13742154" author="hudson" created="Fri, 16 Aug 2013 12:15:42 +0000"  >&lt;p&gt;FAILURE: Integrated in Hive-trunk-hadoop2-ptest #60 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2-ptest/60/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2-ptest/60/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5048&quot; title=&quot;StorageBasedAuthorization provider causes an NPE when asked to authorize from client side.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5048&quot;&gt;&lt;del&gt;HIVE-5048&lt;/del&gt;&lt;/a&gt; : StorageBasedAuthorization provider causes an NPE when asked to authorize from client side. (Sushanth Sowmyan via Ashutosh Chauhan) (hashutosh: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1514569&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1514569&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/HiveAuthorizationProviderBase.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/StorageBasedAuthorizationProvider.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13742223" author="hudson" created="Fri, 16 Aug 2013 13:54:56 +0000"  >&lt;p&gt;FAILURE: Integrated in Hive-trunk-hadoop1-ptest #129 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop1-ptest/129/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop1-ptest/129/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5048&quot; title=&quot;StorageBasedAuthorization provider causes an NPE when asked to authorize from client side.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5048&quot;&gt;&lt;del&gt;HIVE-5048&lt;/del&gt;&lt;/a&gt; : StorageBasedAuthorization provider causes an NPE when asked to authorize from client side. (Sushanth Sowmyan via Ashutosh Chauhan) (hashutosh: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1514569&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1514569&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/HiveAuthorizationProviderBase.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/StorageBasedAuthorizationProvider.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13742362" author="hudson" created="Fri, 16 Aug 2013 16:29:07 +0000"  >&lt;p&gt;FAILURE: Integrated in Hive-trunk-h0.21 #2272 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/2272/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/2272/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5048&quot; title=&quot;StorageBasedAuthorization provider causes an NPE when asked to authorize from client side.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5048&quot;&gt;&lt;del&gt;HIVE-5048&lt;/del&gt;&lt;/a&gt; : StorageBasedAuthorization provider causes an NPE when asked to authorize from client side. (Sushanth Sowmyan via Ashutosh Chauhan) (hashutosh: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1514569&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1514569&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/HiveAuthorizationProviderBase.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/StorageBasedAuthorizationProvider.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13795956" author="ashutoshc" created="Tue, 15 Oct 2013 23:30:01 +0000"  >&lt;p&gt;This issue has been fixed and released as part of 0.12 release. If you find further issues, please create a new jira and link it to this one.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12671467">HIVE-5402</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12615862">HIVE-3705</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12598266" name="HIVE-5048.2.patch" size="3370" author="sushanth" created="Thu, 15 Aug 2013 18:36:26 +0000"/>
                            <attachment id="12597867" name="HIVE-5048.patch" size="3362" author="sushanth" created="Wed, 14 Aug 2013 00:47:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>342974</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 6 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1n5c7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>343278</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>