diff --git a/build.xml b/build.xml
index 2a361c6c06..047d432bae 100644
--- a/build.xml
+++ b/build.xml
@@ -429,7 +429,7 @@
       <fileset dir="${hive.root}/bin/ext" excludes="${vcs.excludes}"/>
     </copy>
     <copy file="${hive.root}/bin/hive-config.sh" todir="${target.bin.dir}"/>
-    <copy file="${basedir}/conf/hive-default.xml" todir="${target.conf.dir}">
+    <copy file="${basedir}/conf/hive-default.xml.template" todir="${target.conf.dir}">
       <filterset>
         <filter token="VERSION" value="${version}"/>
       </filterset>
diff --git a/common/build.xml b/common/build.xml
index 15a0e39362..0d0665f3c4 100755
--- a/common/build.xml
+++ b/common/build.xml
@@ -44,5 +44,30 @@ to call at top-level: ant deploy-contrib compile-core-test
       <fileset dir="${src.dir}/conf"/>
     </copy>
   </target>
+
+  <!-- target to run the tests -->
+  <target name="test"
+  	depends="test-conditions,gen-test,compile-test,test-jar,test-init">
+    <echo message="Project: ${ant.project.name}"/>
+    <junit showoutput="${test.output}" printsummary="yes" haltonfailure="no"
+           fork="yes" maxmemory="512m" dir="${basedir}" timeout="${test.timeout}"
+           errorProperty="tests.failed" failureProperty="tests.failed" filtertrace="off">
+      <sysproperty key="test.build.resources" value="${test.build.resources}"/>            
+      <classpath refid="${test.classpath.id}"/>
+      <formatter type="${test.junit.output.format}" usefile="${test.junit.output.usefile}" />
+      <batchtest todir="${test.build.dir}" unless="testcase">
+        <fileset dir="${test.build.classes}"
+                 includes="**/${test.include}.class"
+                 excludes="**/*$*.class" />
+      </batchtest>
+      <batchtest todir="${test.build.dir}" if="testcase">
+        <fileset dir="${test.build.classes}" includes="**/${testcase}.class"/>
+      </batchtest>
+      <assertions>
+        <enable />
+      </assertions>
+    </junit>
+    <fail if="tests.failed">Tests failed!</fail>
+  </target>
   
 </project>
diff --git a/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java b/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java
index 897ec3cec7..6c879c0c0d 100644
--- a/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java
+++ b/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java
@@ -138,10 +138,20 @@ public class HiveConf extends Configuration {
   /**
    * ConfVars.
    *
+   * These are the default configuration properties for Hive. Each HiveConf
+   * object is initialized as follows:
+   *
+   * 1) Hadoop configuration properties are applied.
+   * 2) ConfVar properties with non-null values are overlayed.
+   * 3) hive-site.xml properties are overlayed.
+   *
+   * WARNING: think twice before adding any Hadoop configuration properties
+   * with non-null values to this list as they will override any values defined
+   * in the underlying Hadoop configuration.
    */
   public static enum ConfVars {
     // QL execution stuff
-    SCRIPTWRAPPER("hive.exec.script.wrapper", ""),
+    SCRIPTWRAPPER("hive.exec.script.wrapper", null),
     PLAN("hive.exec.plan", ""),
     SCRATCHDIR("hive.exec.scratchdir", "/tmp/hive-" + System.getProperty("user.name")),
     SUBMITVIACHILD("hive.exec.submitviachild", false),
@@ -173,7 +183,7 @@ public static enum ConfVars {
     SHOW_JOB_FAIL_DEBUG_INFO("hive.exec.show.job.failure.debug.info", true),
     JOB_DEBUG_TIMEOUT("hive.exec.job.debug.timeout", 30000),
     TASKLOG_DEBUG_TIMEOUT("hive.exec.tasklog.debug.timeout", 20000),
-    OUTPUT_FILE_EXTENSION("hive.output.file.extension", ""),
+    OUTPUT_FILE_EXTENSION("hive.output.file.extension", null),
 
     // should hive determine whether to run in local mode automatically ?
     LOCALMODEAUTO("hive.exec.mode.local.auto", false),
@@ -187,17 +197,28 @@ public static enum ConfVars {
     // not specified
     DROPIGNORESNONEXISTENT("hive.exec.drop.ignorenonexistent", true),
 
-    // hadoop stuff
+    // Hadoop Configuration Properties
+    // Properties with null values are ignored and exist only for the purpose of giving us
+    // a symbolic name to reference in the Hive source code. Properties with non-null
+    // values will override any values set in the underlying Hadoop configuration.
     HADOOPBIN("hadoop.bin.path", System.getenv("HADOOP_HOME") + "/bin/hadoop"),
     HADOOPCONF("hadoop.config.dir", System.getenv("HADOOP_HOME") + "/conf"),
-    HADOOPFS("fs.default.name", "file:///"),
-    HADOOPMAPFILENAME("map.input.file", ""),
-    HADOOPMAPREDINPUTDIR("mapred.input.dir", ""),
+    HADOOPFS("fs.default.name", null),
+    HIVE_FS_HAR_IMPL("fs.har.impl", "org.apache.hadoop.hive.shims.HiveHarFileSystem"),
+    HADOOPMAPFILENAME("map.input.file", null),
+    HADOOPMAPREDINPUTDIR("mapred.input.dir", null),
     HADOOPMAPREDINPUTDIRRECURSIVE("mapred.input.dir.recursive", false),
-    HADOOPJT("mapred.job.tracker", "local"),
+    HADOOPJT("mapred.job.tracker", null),
+    MAPREDMAXSPLITSIZE("mapred.max.split.size", 256000000L),
+    MAPREDMINSPLITSIZE("mapred.min.split.size", 1L),
+    MAPREDMINSPLITSIZEPERNODE("mapred.min.split.size.per.rack", 1L),
+    MAPREDMINSPLITSIZEPERRACK("mapred.min.split.size.per.node", 1L),
+    // The number of reduce tasks per job. Hadoop sets this value to 1 by default
+    // By setting this property to -1, Hive will automatically determine the correct
+    // number of reducers.
     HADOOPNUMREDUCERS("mapred.reduce.tasks", -1),
-    HADOOPJOBNAME("mapred.job.name", ""),
-    HADOOPSPECULATIVEEXECREDUCERS("mapred.reduce.tasks.speculative.execution", false),
+    HADOOPJOBNAME("mapred.job.name", null),
+    HADOOPSPECULATIVEEXECREDUCERS("mapred.reduce.tasks.speculative.execution", true),
 
     // Metastore stuff. Be sure to update HiveConf.metaVars when you add
     // something here!
@@ -351,9 +372,7 @@ public static enum ConfVars {
     // HWI
     HIVEHWILISTENHOST("hive.hwi.listen.host", "0.0.0.0"),
     HIVEHWILISTENPORT("hive.hwi.listen.port", "9999"),
-    HIVEHWIWARFILE("hive.hwi.war.file",
-        (System.getenv("HWI_WAR_FILE") != null) ?
-            System.getenv("HWI_WAR_FILE") : ""),
+    HIVEHWIWARFILE("hive.hwi.war.file", System.getenv("HWI_WAR_FILE")),
 
     // mapper/reducer memory in local mode
     HIVEHADOOPMAXMEM("hive.mapred.local.mem", 0),
@@ -385,10 +404,6 @@ public static enum ConfVars {
     HIVESKEWJOINKEY("hive.skewjoin.key", 100000),
     HIVESKEWJOINMAPJOINNUMMAPTASK("hive.skewjoin.mapjoin.map.tasks", 10000),
     HIVESKEWJOINMAPJOINMINSPLIT("hive.skewjoin.mapjoin.min.split", 33554432L), //32M
-    MAPREDMAXSPLITSIZE("mapred.max.split.size", 256000000L),
-    MAPREDMINSPLITSIZE("mapred.min.split.size", 1L),
-    MAPREDMINSPLITSIZEPERNODE("mapred.min.split.size.per.rack", 1L),
-    MAPREDMINSPLITSIZEPERRACK("mapred.min.split.size.per.node", 1L),
     HIVEMERGEMAPONLY("hive.mergejob.maponly", true),
 
     HIVESENDHEARTBEAT("hive.heartbeat.interval", 1000),
@@ -534,7 +549,6 @@ public static enum ConfVars {
     // The class responsible for logging client side performance metrics
     // Must be a subclass of org.apache.hadoop.hive.ql.log.PerfLogger
     HIVE_PERF_LOGGER("hive.exec.perf.logger", "org.apache.hadoop.hive.ql.log.PerfLogger"),
-    HIVE_FS_HAR_IMPL("fs.har.impl", "org.apache.hadoop.hive.shims.HiveHarFileSystem"),
     // Whether to delete the scratchdir while startup
     HIVE_START_CLEANUP_SCRATCHDIR("hive.start.cleanup.scratchdir", false),
     HIVE_INSERT_INTO_MULTILEVEL_DIRS("hive.insert.into.multilevel.dirs", false),
@@ -561,7 +575,7 @@ public static enum ConfVars {
     ConfVars(String varname, int defaultIntVal) {
       this.varname = varname;
       this.valClass = Integer.class;
-      this.defaultVal = null;
+      this.defaultVal = Integer.toString(defaultIntVal);
       this.defaultIntVal = defaultIntVal;
       this.defaultLongVal = -1;
       this.defaultFloatVal = -1;
@@ -571,7 +585,7 @@ public static enum ConfVars {
     ConfVars(String varname, long defaultLongVal) {
       this.varname = varname;
       this.valClass = Long.class;
-      this.defaultVal = null;
+      this.defaultVal = Long.toString(defaultLongVal);
       this.defaultIntVal = -1;
       this.defaultLongVal = defaultLongVal;
       this.defaultFloatVal = -1;
@@ -581,7 +595,7 @@ public static enum ConfVars {
     ConfVars(String varname, float defaultFloatVal) {
       this.varname = varname;
       this.valClass = Float.class;
-      this.defaultVal = null;
+      this.defaultVal = Float.toString(defaultFloatVal);
       this.defaultIntVal = -1;
       this.defaultLongVal = -1;
       this.defaultFloatVal = defaultFloatVal;
@@ -591,7 +605,7 @@ public static enum ConfVars {
     ConfVars(String varname, boolean defaultBoolVal) {
       this.varname = varname;
       this.valClass = Boolean.class;
-      this.defaultVal = null;
+      this.defaultVal = Boolean.toString(defaultBoolVal);
       this.defaultIntVal = -1;
       this.defaultLongVal = -1;
       this.defaultFloatVal = -1;
@@ -608,16 +622,21 @@ public String toString() {
    * Writes the default ConfVars out to a temporary File and returns
    * a URL pointing to the temporary file.
    * We need this in order to initialize the ConfVar properties
-   * in the underling Configuration object using the addResource()
+   * in the underling Configuration object using the addResource(URL)
    * method.
+   *
+   * Using Configuration.addResource(InputStream) would be a preferable
+   * approach, but it turns out that method is broken since Configuration
+   * tries to read the entire contents of the same InputStream repeatedly.
    */
   private static synchronized URL getConfVarURL() {
     if (confVarURL == null) {
       try {
+        Configuration conf = new Configuration();
         File confVarFile = File.createTempFile("hive-default-", ".xml");
-        Configuration conf = new Configuration(false);
+        confVarFile.deleteOnExit();
 
-        applyDefaultConfVars(conf);
+        applyDefaultNonNullConfVars(conf);
 
         FileOutputStream fout = new FileOutputStream(confVarFile);
         conf.writeXml(fout);
@@ -625,7 +644,7 @@ private static synchronized URL getConfVarURL() {
         confVarURL = confVarFile.toURI().toURL();
       } catch (Exception e) {
         // We're pretty screwed if we can't load the default conf vars
-        throw new RuntimeException(e);
+        throw new RuntimeException("Failed to initialize default Hive configuration variables!", e);
       }
     }
     return confVarURL;
@@ -654,6 +673,10 @@ public static long getLongVar(Configuration conf, ConfVars var) {
     return conf.getLong(var.varname, var.defaultLongVal);
   }
 
+  public static long getLongVar(Configuration conf, ConfVars var, long defaultVal) {
+    return conf.getLong(var.varname, defaultVal);
+  }
+
   public static void setLongVar(Configuration conf, ConfVars var, long val) {
     assert (var.valClass == Long.class);
     conf.setLong(var.varname, val);
@@ -672,6 +695,10 @@ public static float getFloatVar(Configuration conf, ConfVars var) {
     return conf.getFloat(var.varname, var.defaultFloatVal);
   }
 
+  public static float getFloatVar(Configuration conf, ConfVars var, float defaultVal) {
+    return conf.getFloat(var.varname, defaultVal);
+  }
+
   public static void setFloatVar(Configuration conf, ConfVars var, float val) {
     assert (var.valClass == Float.class);
     ShimLoader.getHadoopShims().setFloatConf(conf, var.varname, val);
@@ -690,6 +717,10 @@ public static boolean getBoolVar(Configuration conf, ConfVars var) {
     return conf.getBoolean(var.varname, var.defaultBoolVal);
   }
 
+  public static boolean getBoolVar(Configuration conf, ConfVars var, boolean defaultVal) {
+    return conf.getBoolean(var.varname, defaultVal);
+  }
+
   public static void setBoolVar(Configuration conf, ConfVars var, boolean val) {
     assert (var.valClass == Boolean.class);
     conf.setBoolean(var.varname, val);
@@ -708,6 +739,10 @@ public static String getVar(Configuration conf, ConfVars var) {
     return conf.get(var.varname, var.defaultVal);
   }
 
+  public static String getVar(Configuration conf, ConfVars var, String defaultVal) {
+    return conf.get(var.varname, defaultVal);
+  }
+
   public static void setVar(Configuration conf, ConfVars var, String val) {
     assert (var.valClass == String.class);
     conf.set(var.varname, val);
@@ -772,7 +807,7 @@ private void initialize(Class<?> cls) {
     // preserve the original configuration
     origProp = getAllProperties();
 
-    // Overlay the default ConfVars
+    // Overlay the ConfVars. Note that this ignores ConfVars with null values
     addResource(getConfVarURL());
 
     // Overlay hive-site.xml if it exists
@@ -788,7 +823,7 @@ private void initialize(Class<?> cls) {
       this.setVar(ConfVars.HADOOPCONF, conffile.substring(0, conffile.lastIndexOf('/')));
     }
 
-    // Overlay system properties
+    // Overlay the values of any system properties whose names appear in the list of ConfVars
     applySystemProperties();
 
     // if the running class was loaded directly (through eclipse) rather than through a
@@ -802,6 +837,10 @@ private void initialize(Class<?> cls) {
     }
   }
 
+  /**
+   * Apply system properties to this object if the property name is defined in ConfVars
+   * and the value is non-null and not an empty string.
+   */
   private void applySystemProperties() {
     for (ConfVars oneVar : ConfVars.values()) {
       if (System.getProperty(oneVar.varname) != null) {
@@ -812,21 +851,20 @@ private void applySystemProperties() {
     }
   }
 
-  private static void applyDefaultConfVars(Configuration conf) {
+  /**
+   * Overlays ConfVar properties with non-null values
+   */
+  private static void applyDefaultNonNullConfVars(Configuration conf) {
     for (ConfVars var : ConfVars.values()) {
-      if (String.class.equals(var.valClass)) {
-        conf.set(var.varname, var.defaultVal);
-      } else if (Integer.class.equals(var.valClass)) {
-        conf.setInt(var.varname, var.defaultIntVal);
-      } else if (Long.class.equals(var.valClass)) {
-        conf.setLong(var.varname, var.defaultLongVal);
-      } else if (Float.class.equals(var.valClass)) {
-        conf.setFloat(var.varname, var.defaultFloatVal);
-      } else if (Boolean.class.equals(var.valClass)) {
-        conf.setBoolean(var.varname, var.defaultBoolVal);
-      } else {
-        l4j.warn("Unable to set default configuration value for " + var.varname);
+      if (var.defaultVal == null) {
+        // Don't override ConfVars with null values
+        continue;
+      }
+      if (conf.get(var.varname) != null) {
+        l4j.debug("Overriding Hadoop conf property " + var.varname + "='" + conf.get(var.varname)
+                  + "' with Hive default value '" + var.defaultVal +"'");
       }
+      conf.set(var.varname, var.defaultVal);
     }
   }
 
diff --git a/common/src/test/org/apache/hadoop/hive/conf/TestHiveConf.java b/common/src/test/org/apache/hadoop/hive/conf/TestHiveConf.java
index 73c788cffc..7fa0eac767 100644
--- a/common/src/test/org/apache/hadoop/hive/conf/TestHiveConf.java
+++ b/common/src/test/org/apache/hadoop/hive/conf/TestHiveConf.java
@@ -19,12 +19,15 @@
 
 import junit.framework.TestCase;
 
+import org.apache.hadoop.conf.Configuration;
 import org.apache.hadoop.hive.conf.HiveConf.ConfVars;
 
 
 /**
  * TestHiveConf
  *
+ * Test cases for HiveConf. Loads configuration files located
+ * in common/src/test/resources.
  */
 public class TestHiveConf extends TestCase {
 
@@ -33,22 +36,44 @@ public void testHiveSitePath() throws Exception {
     assertEquals(expectedPath, new HiveConf().getHiveSitePath());
   }
 
-  public void testHiveSiteProperties() throws Exception {
-    HiveConf conf = new HiveConf();
+  private void checkHadoopConf(String name, String expectedHadoopVal) throws Exception {
+    assertEquals(expectedHadoopVal, new Configuration().get(name));
+  }
+
+  private void checkConfVar(ConfVars var, String expectedConfVarVal) throws Exception {
+    assertEquals(expectedConfVarVal, var.defaultVal);
+  }
+
+  private void checkHiveConf(String name, String expectedHiveVal) throws Exception {
+    assertEquals(expectedHiveVal, new HiveConf().get(name));
+  }
+
+  public void testConfProperties() throws Exception {
+    // Make sure null-valued ConfVar properties do not override the Hadoop Configuration
+    checkHadoopConf(ConfVars.HADOOPFS.varname, "core-site.xml");
+    checkConfVar(ConfVars.HADOOPFS, null);
+    checkHiveConf(ConfVars.HADOOPFS.varname, "core-site.xml");
 
-    // ConfVar only defined in HiveConf
-    assertEquals(ConfVars.HIVESKEWJOINKEY.defaultIntVal, conf.getIntVar(ConfVars.HIVESKEWJOINKEY));
+    // Make sure non-null-valued ConfVar properties *do* override the Hadoop Configuration
+    checkHadoopConf(ConfVars.HADOOPNUMREDUCERS.varname, "1");
+    checkConfVar(ConfVars.HADOOPNUMREDUCERS, "-1");
+    checkHiveConf(ConfVars.HADOOPNUMREDUCERS.varname, "-1");
 
-    // ConfVar overridden in local hive-site.xml
-    assertEquals("hive-site.xml", conf.get("javax.jdo.option.ConnectionDriverName"));
+    // Non-null ConfVar only defined in ConfVars
+    checkHadoopConf(ConfVars.HIVESKEWJOINKEY.varname, null);
+    checkConfVar(ConfVars.HIVESKEWJOINKEY, "100000");
+    checkHiveConf(ConfVars.HIVESKEWJOINKEY.varname, "100000");
 
-    // Hadoop property overridden in ConfVars and hive-site.xml
-    assertEquals("hive-site.xml", conf.get("mapred.reduce.tasks"));
+    // ConfVar overridden in in hive-site.xml
+    checkHadoopConf(ConfVars.METASTORE_CONNECTION_DRIVER.varname, null);
+    checkConfVar(ConfVars.METASTORE_CONNECTION_DRIVER, "org.apache.derby.jdbc.EmbeddedDriver");
+    checkHiveConf(ConfVars.METASTORE_CONNECTION_DRIVER.varname, "hive-site.xml");
 
-    // Test property defined in hive-site.xml only
-    assertEquals("hive-site.xml", conf.get("test.property1"));
+    // Property defined in hive-site.xml only
+    checkHadoopConf("test.property1", null);
+    checkHiveConf("test.property1", "hive-site.xml");
 
-    // Test Hive conf property variable substitution in hive-site.xml
-    assertEquals(conf.get("hive.exec.default.partition.name"), conf.get("test.var.hiveconf.property"));
+    // Test HiveConf property variable substitution in hive-site.xml
+    checkHiveConf("test.var.hiveconf.property", ConfVars.DEFAULTPARTITIONNAME.defaultVal);
   }
 }
diff --git a/common/src/test/resources/core-site.xml b/common/src/test/resources/core-site.xml
new file mode 100644
index 0000000000..ffe9747c38
--- /dev/null
+++ b/common/src/test/resources/core-site.xml
@@ -0,0 +1,27 @@
+<?xml version="1.0"?>
+<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one or more
+   contributor license agreements.  See the NOTICE file distributed with
+   this work for additional information regarding copyright ownership.
+   The ASF licenses this file to You under the Apache License, Version 2.0
+   (the "License"); you may not use this file except in compliance with
+   the License.  You may obtain a copy of the License at
+
+       http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing, software
+   distributed under the License is distributed on an "AS IS" BASIS,
+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+   See the License for the specific language governing permissions and
+   limitations under the License.
+-->
+
+<!-- Test file for TestHiveConf -->
+
+<configuration>
+  <property>
+    <name>fs.default.name</name>
+    <value>core-site.xml</value>
+  </property>
+</configuration>
diff --git a/common/src/test/resources/hive-site.xml b/common/src/test/resources/hive-site.xml
index d4d72a1af4..0d5c834b5d 100644
--- a/common/src/test/resources/hive-site.xml
+++ b/common/src/test/resources/hive-site.xml
@@ -17,6 +17,8 @@
    limitations under the License.
 -->
 
+<!-- Test file for TestHiveConf -->
+
 <configuration>
 
 <property>
@@ -25,12 +27,6 @@
   <description>Override ConfVar defined in HiveConf</description>
 </property>
 
-<property>
-  <name>mapred.reduce.tasks</name>
-  <value>hive-site.xml</value>
-  <description>Override mapred ConfVar defined in HiveConf</description>
-</property>
-
 <property>
   <name>test.property1</name>
   <value>hive-site.xml</value>
diff --git a/conf/hive-default.xml b/conf/hive-default.xml.template
similarity index 100%
rename from conf/hive-default.xml
rename to conf/hive-default.xml.template
diff --git a/conf/hive-site.xml b/conf/hive-site.xml
new file mode 100644
index 0000000000..dab494e4bd
--- /dev/null
+++ b/conf/hive-site.xml
@@ -0,0 +1,22 @@
+<?xml version="1.0"?>
+<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
+<!--
+   Licensed to the Apache Software Foundation (ASF) under one or more
+   contributor license agreements.  See the NOTICE file distributed with
+   this work for additional information regarding copyright ownership.
+   The ASF licenses this file to You under the Apache License, Version 2.0
+   (the "License"); you may not use this file except in compliance with
+   the License.  You may obtain a copy of the License at
+
+       http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing, software
+   distributed under the License is distributed on an "AS IS" BASIS,
+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+   See the License for the specific language governing permissions and
+   limitations under the License.
+-->
+
+<configuration>
+
+</configuration>
