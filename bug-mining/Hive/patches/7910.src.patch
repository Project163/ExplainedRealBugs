diff --git a/itests/src/test/resources/testconfiguration.properties b/itests/src/test/resources/testconfiguration.properties
index 48b156e360..a8207d5525 100644
--- a/itests/src/test/resources/testconfiguration.properties
+++ b/itests/src/test/resources/testconfiguration.properties
@@ -9,7 +9,8 @@ minitez.query.files.shared=\
   compressed_skip_header_footer_aggr.q,\
   dynpart_sort_optimization_distribute_by.q,\
   hybridgrace_hashjoin_1.q,\
-  hybridgrace_hashjoin_2.q
+  hybridgrace_hashjoin_2.q,\
+  substr_estimate_range.q
 
 # NOTE: Add tests to minitez only if it is very
 # specific to tez and cannot be added to minillap.
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFSubstr.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFSubstr.java
index cb28cf6cde..f9168a99b8 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFSubstr.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFSubstr.java
@@ -174,8 +174,10 @@ public Optional<ColStatistics> estimate(List<ColStatistics> csList) {
     }
 
     private Optional<Double> getRangeWidth(Range range) {
-      if (range.minValue != null && range.maxValue != null) {
-        return Optional.of(range.maxValue.doubleValue() - range.minValue.doubleValue());
+      if (range != null) {
+        if (range.minValue != null && range.maxValue != null) {
+          return Optional.of(range.maxValue.doubleValue() - range.minValue.doubleValue());
+        }
       }
       return Optional.empty();
     }
diff --git a/ql/src/test/queries/clientpositive/substr_estimate_range.q b/ql/src/test/queries/clientpositive/substr_estimate_range.q
new file mode 100644
index 0000000000..85327b4073
--- /dev/null
+++ b/ql/src/test/queries/clientpositive/substr_estimate_range.q
@@ -0,0 +1,5 @@
+create table t0 (s string);
+create table t1 (s string, i int);
+insert into t0 select "abc";
+insert into t1 select "abc", 4;
+select substr(t0.s, t1.i-1) from t0 join t1 on t0.s=t1.s;
diff --git a/ql/src/test/results/clientpositive/llap/substr_estimate_range.q.out b/ql/src/test/results/clientpositive/llap/substr_estimate_range.q.out
new file mode 100644
index 0000000000..89d4cf5a9e
--- /dev/null
+++ b/ql/src/test/results/clientpositive/llap/substr_estimate_range.q.out
@@ -0,0 +1,46 @@
+PREHOOK: query: create table t0 (s string)
+PREHOOK: type: CREATETABLE
+PREHOOK: Output: database:default
+PREHOOK: Output: default@t0
+POSTHOOK: query: create table t0 (s string)
+POSTHOOK: type: CREATETABLE
+POSTHOOK: Output: database:default
+POSTHOOK: Output: default@t0
+PREHOOK: query: create table t1 (s string, i int)
+PREHOOK: type: CREATETABLE
+PREHOOK: Output: database:default
+PREHOOK: Output: default@t1
+POSTHOOK: query: create table t1 (s string, i int)
+POSTHOOK: type: CREATETABLE
+POSTHOOK: Output: database:default
+POSTHOOK: Output: default@t1
+PREHOOK: query: insert into t0 select "abc"
+PREHOOK: type: QUERY
+PREHOOK: Input: _dummy_database@_dummy_table
+PREHOOK: Output: default@t0
+POSTHOOK: query: insert into t0 select "abc"
+POSTHOOK: type: QUERY
+POSTHOOK: Input: _dummy_database@_dummy_table
+POSTHOOK: Output: default@t0
+POSTHOOK: Lineage: t0.s SIMPLE []
+PREHOOK: query: insert into t1 select "abc", 4
+PREHOOK: type: QUERY
+PREHOOK: Input: _dummy_database@_dummy_table
+PREHOOK: Output: default@t1
+POSTHOOK: query: insert into t1 select "abc", 4
+POSTHOOK: type: QUERY
+POSTHOOK: Input: _dummy_database@_dummy_table
+POSTHOOK: Output: default@t1
+POSTHOOK: Lineage: t1.i SIMPLE []
+POSTHOOK: Lineage: t1.s SIMPLE []
+PREHOOK: query: select substr(t0.s, t1.i-1) from t0 join t1 on t0.s=t1.s
+PREHOOK: type: QUERY
+PREHOOK: Input: default@t0
+PREHOOK: Input: default@t1
+#### A masked pattern was here ####
+POSTHOOK: query: select substr(t0.s, t1.i-1) from t0 join t1 on t0.s=t1.s
+POSTHOOK: type: QUERY
+POSTHOOK: Input: default@t0
+POSTHOOK: Input: default@t1
+#### A masked pattern was here ####
+c
diff --git a/ql/src/test/results/clientpositive/tez/substr_estimate_range.q.out b/ql/src/test/results/clientpositive/tez/substr_estimate_range.q.out
new file mode 100644
index 0000000000..041f06e02d
--- /dev/null
+++ b/ql/src/test/results/clientpositive/tez/substr_estimate_range.q.out
@@ -0,0 +1,46 @@
+PREHOOK: query: create table t0 (s string)
+PREHOOK: type: CREATETABLE
+PREHOOK: Output: database:default
+PREHOOK: Output: default@t0
+POSTHOOK: query: create table t0 (s string)
+POSTHOOK: type: CREATETABLE
+POSTHOOK: Output: database:default
+POSTHOOK: Output: default@t0
+PREHOOK: query: create table t1 (s string, i int)
+PREHOOK: type: CREATETABLE
+PREHOOK: Output: database:default
+PREHOOK: Output: default@t1
+POSTHOOK: query: create table t1 (s string, i int)
+POSTHOOK: type: CREATETABLE
+POSTHOOK: Output: database:default
+POSTHOOK: Output: default@t1
+PREHOOK: query: insert into t0 select "abc"
+PREHOOK: type: QUERY
+PREHOOK: Input: _dummy_database@_dummy_table
+PREHOOK: Output: default@t0
+POSTHOOK: query: insert into t0 select "abc"
+POSTHOOK: type: QUERY
+POSTHOOK: Input: _dummy_database@_dummy_table
+POSTHOOK: Output: default@t0
+POSTHOOK: Lineage: t0.s SIMPLE []
+PREHOOK: query: insert into t1 select "abc", 4
+PREHOOK: type: QUERY
+PREHOOK: Input: _dummy_database@_dummy_table
+PREHOOK: Output: default@t1
+POSTHOOK: query: insert into t1 select "abc", 4
+POSTHOOK: type: QUERY
+POSTHOOK: Input: _dummy_database@_dummy_table
+POSTHOOK: Output: default@t1
+POSTHOOK: Lineage: t1.i SIMPLE []
+POSTHOOK: Lineage: t1.s SIMPLE []
+PREHOOK: query: select substr(t0.s, t1.i-1) from t0 join t1 on t0.s=t1.s
+PREHOOK: type: QUERY
+PREHOOK: Input: default@t0
+PREHOOK: Input: default@t1
+PREHOOK: Output: hdfs://### HDFS PATH ###
+POSTHOOK: query: select substr(t0.s, t1.i-1) from t0 join t1 on t0.s=t1.s
+POSTHOOK: type: QUERY
+POSTHOOK: Input: default@t0
+POSTHOOK: Input: default@t1
+POSTHOOK: Output: hdfs://### HDFS PATH ###
+c
