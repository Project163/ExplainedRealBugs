diff --git a/CHANGES.txt b/CHANGES.txt
index d6a3f1bece..b37a5964b9 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -138,6 +138,8 @@ Trunk - Unreleased
     HIVE-488. Fix load partition for table with multiple partition columns.
     (Prasad Chakka via athusoo)
 
+    HIVE-496. UDFDate fails on null. (Zheng Shao via pchakka)
+
 Release 0.3.1 - Unreleased
 
   INCOMPATIBLE CHANGES
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFConcat.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFConcat.java
index dc4b7c2d72..c0c64cd33f 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFConcat.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFConcat.java
@@ -29,6 +29,9 @@ public UDFConcat() {
 
   Text text = new Text();
   public Text evaluate(Text a, Text b) {
+    if (a == null || b == null) {
+      return null;
+    }
     text.clear();
     text.set(a);
     text.append(b.getBytes(), 0, b.getLength());
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDate.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDate.java
index 5ee9596308..9f9cc184f5 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDate.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDate.java
@@ -47,6 +47,10 @@ public UDFDate() {
    */
   public Text evaluate(Text dateString)  {
     
+    if (dateString == null) {
+      return null;
+    }
+    
     try {
       Date date = formatter.parse(dateString.toString());
       t.set(formatter.format(date));
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDateAdd.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDateAdd.java
index 1f6a2df3be..55e4daac36 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDateAdd.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDateAdd.java
@@ -56,6 +56,10 @@ public UDFDateAdd() {
    */
   public Text evaluate(Text dateString1, IntWritable days)  {
     
+    if (dateString1 == null || days == null) {
+      return null;
+    }
+    
     try {
       calendar.setTime(formatter.parse(dateString1.toString()));
       calendar.add(Calendar.DAY_OF_MONTH, days.get());
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDateDiff.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDateDiff.java
index 859102283b..bb792c2089 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDateDiff.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDateDiff.java
@@ -51,6 +51,11 @@ public UDFDateDiff() {
    * @return the difference in days.
    */
   public IntWritable evaluate(Text dateString1, Text dateString2)  {
+    
+    if (dateString1 == null || dateString2 == null) {
+      return null;
+    }
+    
     try {
       // NOTE: This implementation avoids the extra-second problem
       // by comparing with UTC epoch and integer division.
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDateSub.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDateSub.java
index 1b1f1d71b2..12917b9ad2 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDateSub.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDateSub.java
@@ -55,6 +55,10 @@ public UDFDateSub() {
    */
   public Text evaluate(Text dateString1, IntWritable days)  {
     
+    if (dateString1 == null || days == null) {
+      return null;
+    }
+    
     try {
       calendar.setTime(formatter.parse(dateString1.toString()));
       calendar.add(Calendar.DAY_OF_MONTH, -days.get());
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDayOfMonth.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDayOfMonth.java
index 81639d38ce..5088d42878 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDayOfMonth.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDayOfMonth.java
@@ -49,6 +49,10 @@ public UDFDayOfMonth() {
    */
   public IntWritable evaluate(Text dateString)  {
     
+    if (dateString == null) {
+      return null;
+    }
+    
     try {
       Date date = formatter.parse(dateString.toString());
       calendar.setTime(date);
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDefaultSampleHashFn.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDefaultSampleHashFn.java
index f019175ced..8d140bbb4b 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDefaultSampleHashFn.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDefaultSampleHashFn.java
@@ -33,14 +33,14 @@ public UDFDefaultSampleHashFn() {
   }
 
   public IntWritable evaluate(Object o) {
-    result.set(o.hashCode());
+    result.set(o == null ? 0 : o.hashCode());
     return result;
   }
   
   // TODO: For now, only allow up to two columns on which to sample
   // Going forward we will allow sampling on an arbitrary number of columns
   public IntWritable evaluate(Object o1, Object o2) {
-    result.set(o1.hashCode() ^ o2.hashCode());
+    result.set((o1 == null ? 0 : o1.hashCode()) ^ (o2 == null ? 0 : o2.hashCode()));
     return result;
   }
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFMonth.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFMonth.java
index 331d4fd5c5..5b36fc6e80 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFMonth.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFMonth.java
@@ -48,7 +48,9 @@ public UDFMonth() {
    * @return an int from 1 to 12. null if the dateString is not a valid date string.
    */
   public IntWritable evaluate(Text dateString)  {
-    
+    if (dateString == null) {
+      return null;
+    }
     try {
       Date date = formatter.parse(dateString.toString());
       calendar.setTime(date);
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFYear.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFYear.java
index 67caaaa2a1..7c46fd6801 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFYear.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFYear.java
@@ -49,6 +49,10 @@ public UDFYear() {
    */
   public IntWritable evaluate(Text dateString)  {
     
+    if (dateString == null) {
+      return null;
+    }
+    
     try {
       Date date = formatter.parse(dateString.toString());
       calendar.setTime(date);
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDFWhen.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDFWhen.java
index 83ab7da5cd..5ca3b1e4f4 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDFWhen.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDFWhen.java
@@ -86,7 +86,7 @@ public ObjectInspector initialize(ObjectInspector[] arguments)
   public Object evaluate(DeferredObject[] arguments) throws HiveException {
     for (int i=0; i+1<arguments.length; i+=2) {
       Object caseKey = arguments[i].get();
-      if (((BooleanObjectInspector)argumentOIs[i]).get(caseKey)) {
+      if (caseKey != null && ((BooleanObjectInspector)argumentOIs[i]).get(caseKey)) {
         Object caseValue = arguments[i+1].get();
         return returnOIResolver.convertIfNecessary(caseValue,
             argumentOIs[i+1]);
