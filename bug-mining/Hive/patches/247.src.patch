diff --git a/CHANGES.txt b/CHANGES.txt
index 13279c677c..8e4ca613cb 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -609,6 +609,9 @@ Release 0.4.0 -  Unreleased
 
     HIVE-794. MergeTask should use COMPRESSRESULT. (Saurabh Nanda via zshao)
 
+    HIVE-726. Make "ant package -Dhadoop.version=0.17.0" work.
+    (Todd Lipcon via zshao)
+
 Release 0.3.1 - Unreleased
 
   INCOMPATIBLE CHANGES
diff --git a/build-common.xml b/build-common.xml
index c014365558..887e55b39f 100644
--- a/build-common.xml
+++ b/build-common.xml
@@ -79,12 +79,12 @@
     <ivy:retrieve pattern="${build.dir.hadoop}/[artifact]-[revision].[ext]"/>
   </target>
 
-  <available property="hadoopcore.${hadoop.version}.install.done" file="${build.dir.hadoop}/hadoop-${hadoop.version}.installed"/>
+  <available property="hadoopcore.${hadoop.version.ant-internal}.install.done" file="${build.dir.hadoop}/hadoop-${hadoop.version.ant-internal}.installed"/>
 
-  <target name="install-hadoopcore-internal" depends="resolve" unless="hadoopcore.${hadoop.version}.install.done">
-    <untar src="${build.dir.hadoop}/hadoop-${hadoop.version}.tar.gz" dest="${build.dir.hadoop}" compression="gzip"/>
+  <target name="install-hadoopcore-internal" depends="resolve" unless="hadoopcore.${hadoop.version.ant-internal}.install.done">
+    <untar src="${build.dir.hadoop}/hadoop-${hadoop.version.ant-internal}.tar.gz" dest="${build.dir.hadoop}" compression="gzip"/>
     <chmod file="${hadoop.root}/bin/hadoop" perm="+x"/>
-    <touch file="${build.dir.hadoop}/hadoop-${hadoop.version}.installed"/>
+    <touch file="${build.dir.hadoop}/hadoop-${hadoop.version.ant-internal}.installed"/>
   </target>
 
   <target name="install-hadoopcore-default" unless="hadoop.root.nondefault">
diff --git a/build.properties b/build.properties
index 90f6378d8c..0b812b5ecf 100644
--- a/build.properties
+++ b/build.properties
@@ -9,10 +9,12 @@ hadoop.mirror=http://archive.apache.org/dist
 build.dir.hive=${hive.root}/build
 build.dir.hadoop=${build.dir.hive}/hadoopcore
 
-hadoop.root.default=${build.dir.hadoop}/hadoop-${hadoop.version}
+
+hadoop.version.ant-internal=${hadoop.version}
+hadoop.root.default=${build.dir.hadoop}/hadoop-${hadoop.version.ant-internal}
 hadoop.root=${hadoop.root.default}
-hadoop.jar=${hadoop.root}/hadoop-${hadoop.version}-core.jar
-hadoop.test.jar=${hadoop.root}/hadoop-${hadoop.version}-test.jar
+hadoop.jar=${hadoop.root}/hadoop-${hadoop.version.ant-internal}-core.jar
+hadoop.test.jar=${hadoop.root}/hadoop-${hadoop.version.ant-internal}-test.jar
 jetty.test.jar=${hadoop.root}/lib/jetty-5.1.4.jar
 servlet.test.jar=${hadoop.root}/lib/servlet-api.jar
 jasper.test.jar=${hadoop.root}/lib/jetty-ext/jasper-runtime.jar
diff --git a/build.xml b/build.xml
index 44085af1f6..7264d02a61 100644
--- a/build.xml
+++ b/build.xml
@@ -45,7 +45,7 @@
   <property name="images.src" value="${docs.src}/images"/>
   <property name="javadoc.link.java"
             value="http://java.sun.com/javase/6/docs/api/"/>
-  <property name="final.name" value="${name}-${version}-hadoop-${hadoop.version}"/>
+  <property name="final.name" value="${name}-${version}-hadoop-${hadoop.version.ant-internal}"/>
   <property name="dev.final.name" value="${final.name}-dev"/>
   <property name="bin.final.name" value="${final.name}-bin"/>
 
@@ -267,17 +267,17 @@
   <target name="eclipse-files" depends="init"
           description="Generate files for Eclipse">
 
-    <condition property="hadoop.version" value="0.19">
+    <condition property="hadoop.version.ant-internal" value="0.19">
       <not>
-        <isset property="hadoop.version"/>
+        <isset property="hadoop.version.ant-internal"/>
       </not>
     </condition>
-    <echo message="Using hadoop version ${hadoop.version}"/>
+    <echo message="Using hadoop version ${hadoop.version.ant-internal}"/>
 
     <taskdef name="getversionpref" classname="org.apache.hadoop.hive.ant.GetVersionPref"
              classpath="${build.dir.hive}/anttasks/hive_anttasks.jar"/>
 
-    <getversionpref property="hadoop.version.prefix" input="${hadoop.version}"/>
+    <getversionpref property="hadoop.version.ant-internal.prefix" input="${hadoop.version.ant-internal}"/>
 
     <pathconvert property="eclipse.project">
       <path path="${basedir}"/>
@@ -290,8 +290,8 @@
       </fileset>
       <filterset>
         <filter token="PROJECT" value="${eclipse.project}"/>
-        <filter token="HADOOPVER" value="${hadoop.version}"/>
-        <filter token="HADOOPVERPREF" value="${hadoop.version.prefix}"/>
+        <filter token="HADOOPVER" value="${hadoop.version.ant-internal}"/>
+        <filter token="HADOOPVERPREF" value="${hadoop.version.ant-internal.prefix}"/>
       </filterset>
     </copy>
     <move todir="." includeemptydirs="false">
diff --git a/cli/ivy.xml b/cli/ivy.xml
index 5d55dc9216..86ad1eeb2d 100644
--- a/cli/ivy.xml
+++ b/cli/ivy.xml
@@ -1,7 +1,7 @@
 <ivy-module version="2.0">
     <info organisation="org.apache.hadoop.hive" module="cli"/>
     <dependencies>
-        <dependency org="hadoop" name="core" rev="${hadoop.version}">
+        <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
           <artifact name="hadoop" type="source" ext="tar.gz"/>
         </dependency> 
     </dependencies>
diff --git a/common/ivy.xml b/common/ivy.xml
index da26c2f5ed..7c8cb75498 100644
--- a/common/ivy.xml
+++ b/common/ivy.xml
@@ -1,7 +1,7 @@
 <ivy-module version="2.0">
     <info organisation="org.apache.hadoop.hive" module="common"/>
     <dependencies>
-        <dependency org="hadoop" name="core" rev="${hadoop.version}">
+        <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
           <artifact name="hadoop" type="source" ext="tar.gz"/>
         </dependency> 
     </dependencies>
diff --git a/contrib/ivy.xml b/contrib/ivy.xml
index 025375eb79..899ca705c7 100644
--- a/contrib/ivy.xml
+++ b/contrib/ivy.xml
@@ -1,7 +1,7 @@
 <ivy-module version="2.0">
     <info organisation="org.apache.hadoop.hive" module="contrib"/>
     <dependencies>
-        <dependency org="hadoop" name="core" rev="${hadoop.version}">
+        <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
           <artifact name="hadoop" type="source" ext="tar.gz"/>
         </dependency> 
     </dependencies>
diff --git a/metastore/ivy.xml b/metastore/ivy.xml
index aa4450229f..c9b302b2b8 100644
--- a/metastore/ivy.xml
+++ b/metastore/ivy.xml
@@ -1,7 +1,7 @@
 <ivy-module version="2.0">
     <info organisation="org.apache.hadoop.hive" module="metastore"/>
     <dependencies>
-        <dependency org="hadoop" name="core" rev="${hadoop.version}">
+        <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
           <artifact name="hadoop" type="source" ext="tar.gz"/>
         </dependency> 
     </dependencies>
diff --git a/ql/ivy.xml b/ql/ivy.xml
index eaefe4bac8..e72a450622 100644
--- a/ql/ivy.xml
+++ b/ql/ivy.xml
@@ -1,7 +1,7 @@
 <ivy-module version="2.0">
     <info organisation="org.apache.hadoop.hive" module="ql"/>
     <dependencies>
-        <dependency org="hadoop" name="core" rev="${hadoop.version}">
+        <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
           <artifact name="hadoop" type="source" ext="tar.gz"/>
         </dependency> 
     </dependencies>
diff --git a/serde/ivy.xml b/serde/ivy.xml
index e1e6e4d418..da693426b2 100644
--- a/serde/ivy.xml
+++ b/serde/ivy.xml
@@ -1,7 +1,7 @@
 <ivy-module version="2.0">
     <info organisation="org.apache.hadoop.hive" module="serde"/>
     <dependencies>
-        <dependency org="hadoop" name="core" rev="${hadoop.version}">
+        <dependency org="hadoop" name="core" rev="${hadoop.version.ant-internal}">
           <artifact name="hadoop" type="source" ext="tar.gz"/>
         </dependency> 
     </dependencies>
diff --git a/shims/build.xml b/shims/build.xml
index 5eb5a12940..f5aa1227ce 100644
--- a/shims/build.xml
+++ b/shims/build.xml
@@ -35,8 +35,8 @@ to call at top-level: ant deploy-contrib compile-core-test
   </path>
 
   <target name="build_shims" description="Build shims against a particular hadoop version" depends="install-hadoopcore-internal, resolve">
-    <getversionpref property="hadoop.version.prefix" input="${hadoop.version}" />
-    <echo message="Compiling shims against hadoop ${hadoop.version}"/>
+    <getversionpref property="hadoop.version.ant-internal.prefix" input="${hadoop.version.ant-internal}" />
+    <echo message="Compiling shims against hadoop ${hadoop.version.ant-internal} (${hadoop.root})"/>
     <javac
      encoding="${build.encoding}"
      includes="**/*.java"
@@ -45,23 +45,23 @@ to call at top-level: ant deploy-contrib compile-core-test
      deprecation="${javac.deprecation}">
       <compilerarg line="${javac.args} ${javac.args.warnings}" />
       <classpath refid="classpath"/>
-      <src path="${basedir}/src/${hadoop.version.prefix}/java" />
+      <src path="${basedir}/src/${hadoop.version.ant-internal.prefix}/java" />
       <src path="${basedir}/src/common/java" />
     </javac>
   </target>
 
-  <target name="compile" depends="init, install-hadoopcore, setup">
+  <target name="compile" depends="init">
     <antcall target="build_shims" inheritRefs="false" inheritAll="false">
-      <param name="hadoop.version" value="0.17.2.1" />
+      <param name="hadoop.version.ant-internal" value="0.17.2.1" />
     </antcall>
     <antcall target="build_shims" inheritRefs="false" inheritAll="false">
-      <param name="hadoop.version" value="0.18.3" />
+      <param name="hadoop.version.ant-internal" value="0.18.3" />
     </antcall>
     <antcall target="build_shims" inheritRefs="false" inheritAll="false">
-      <param name="hadoop.version" value="0.19.0" />
+      <param name="hadoop.version.ant-internal" value="0.19.0" />
     </antcall>
     <antcall target="build_shims" inheritRefs="false" inheritAll="false">
-      <param name="hadoop.version" value="0.20.0" />
+      <param name="hadoop.version.ant-internal" value="0.20.0" />
     </antcall>
   </target>
 
