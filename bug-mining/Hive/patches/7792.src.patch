diff --git a/llap-server/src/java/org/apache/hadoop/hive/llap/cache/LowLevelCacheImpl.java b/llap-server/src/java/org/apache/hadoop/hive/llap/cache/LowLevelCacheImpl.java
index 87c6e5cd93..4b77361988 100644
--- a/llap-server/src/java/org/apache/hadoop/hive/llap/cache/LowLevelCacheImpl.java
+++ b/llap-server/src/java/org/apache/hadoop/hive/llap/cache/LowLevelCacheImpl.java
@@ -343,7 +343,7 @@ public long[] putFileData(Object fileKey, DiskRange[] ranges, MemoryBuffer[] buf
             if (result == null) {
               result = new long[align64(buffers.length) >>> 6];
             }
-            result[i >>> 6] |= (1 << (i & 63)); // indicate that we've replaced the value
+            result[i >>> 6] |= (1L << (i & 63)); // indicate that we've replaced the value
             break;
           }
           // We found some old value but couldn't incRef it; remove it.
diff --git a/llap-server/src/test/org/apache/hadoop/hive/llap/cache/TestLowLevelCacheImpl.java b/llap-server/src/test/org/apache/hadoop/hive/llap/cache/TestLowLevelCacheImpl.java
index 33afe8691f..77c379c21d 100644
--- a/llap-server/src/test/org/apache/hadoop/hive/llap/cache/TestLowLevelCacheImpl.java
+++ b/llap-server/src/test/org/apache/hadoop/hive/llap/cache/TestLowLevelCacheImpl.java
@@ -31,6 +31,7 @@
 import java.util.concurrent.FutureTask;
 import java.util.concurrent.atomic.AtomicInteger;
 import java.util.function.Predicate;
+import java.util.stream.IntStream;
 
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
@@ -206,6 +207,28 @@ private void verifyCacheGet(LowLevelCacheImpl cache, long fileId, Object... stuf
     }
   }
 
+  @Test
+  public void testBitmaskHandling() {
+    LowLevelCacheImpl cache = new LowLevelCacheImpl(
+            LlapDaemonCacheMetrics.create("test", "1"), new DummyCachePolicy(),
+            new DummyAllocator(), true, -1); // no cleanup thread
+    long fn1 = 1;
+
+    LlapDataBuffer[] buffs1 = IntStream.range(0, 5).mapToObj(i -> fb()).toArray(LlapDataBuffer[]::new);
+    DiskRange[] drs1 = drs(1, 2, 31, 32, 33);
+
+    LlapDataBuffer[] buffs2 = IntStream.range(0, 41).mapToObj(i -> fb()).toArray(LlapDataBuffer[]::new);
+    DiskRange[] drs2 = drs(IntStream.range(1, 42).toArray());
+
+
+    assertNull(cache.putFileData(fn1, drs1, buffs1, 0, Priority.NORMAL, null, null));
+
+    long[] mask = cache.putFileData(fn1, drs2, buffs2, 0, Priority.NORMAL, null, null);
+    assertEquals(1, mask.length);
+    long expected = Long.parseLong("111000000000000000000000000000011", 2);
+    assertEquals(expected, mask[0]);
+  }
+
   @Test
   public void testMultiMatch() {
     LowLevelCacheImpl cache = new LowLevelCacheImpl(
