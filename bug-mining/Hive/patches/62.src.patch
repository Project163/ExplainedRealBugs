diff --git a/CHANGES.txt b/CHANGES.txt
index 7d7c378267..8c25e37936 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -243,3 +243,6 @@ Trunk (unreleased changes)
 
     HIVE-248. Create file path names properly during the load command
     in case relative path names were specified. (Prasad Chakka via athusoo)
+
+    HIVE-179. Make substr behavior similar to other RDBMS.
+    (David Phillips via athusoo)
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFSubstr.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFSubstr.java
index 5510f61495..eef2301837 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFSubstr.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFSubstr.java
@@ -26,15 +26,31 @@ public class UDFSubstr extends UDF {
   public UDFSubstr() {
   }
 
-  public String evaluate(String a, int start, int len)  {
-    if (start >= a.length()) return "";
-    if (start + len > a.length()) len = a.length() - start;
-    return a.substring(start, start + len);
+  public String evaluate(String s, Integer pos, Integer len)  {
+    int start, end;
+
+    if ((s == null) || (pos == null) || (len == null))
+      return null;
+    if ((len <= 0) || (Math.abs(pos) > s.length()))
+      return "";
+
+    if (pos > 0)
+      start = pos - 1;
+    else if (pos < 0)
+      start = s.length() + pos;
+    else
+      start = 0;
+
+    if ((s.length() - start) < len)
+      end = s.length();
+    else
+      end = start + len;
+
+    return s.substring(start, end);
   }
-  
-  public String evaluate(String a, int start)  {
-    if (start >= a.length()) return "";
-    return a.substring(start);
+
+  public String evaluate(String s, Integer pos)  {
+    return evaluate(s, pos, Integer.MAX_VALUE);
   }
 
 }
diff --git a/ql/src/test/queries/clientpositive/groupby1.q b/ql/src/test/queries/clientpositive/groupby1.q
index 2c65e4b441..c735c6ce91 100755
--- a/ql/src/test/queries/clientpositive/groupby1.q
+++ b/ql/src/test/queries/clientpositive/groupby1.q
@@ -1,8 +1,8 @@
 CREATE TABLE dest_g1(key INT, value DOUBLE) STORED AS TEXTFILE;
 
 EXPLAIN
-FROM src INSERT OVERWRITE TABLE dest_g1 SELECT src.key, sum(substr(src.value,4)) GROUP BY src.key;
+FROM src INSERT OVERWRITE TABLE dest_g1 SELECT src.key, sum(substr(src.value,5)) GROUP BY src.key;
 
-FROM src INSERT OVERWRITE TABLE dest_g1 SELECT src.key, sum(substr(src.value,4)) GROUP BY src.key;
+FROM src INSERT OVERWRITE TABLE dest_g1 SELECT src.key, sum(substr(src.value,5)) GROUP BY src.key;
 
 SELECT dest_g1.* FROM dest_g1;
diff --git a/ql/src/test/queries/clientpositive/groupby1_limit.q b/ql/src/test/queries/clientpositive/groupby1_limit.q
index fa42c9576a..0c8e12a0ad 100644
--- a/ql/src/test/queries/clientpositive/groupby1_limit.q
+++ b/ql/src/test/queries/clientpositive/groupby1_limit.q
@@ -3,8 +3,8 @@ set mapred.reduce.tasks=31;
 CREATE TABLE dest1(key INT, value DOUBLE) STORED AS TEXTFILE;
 
 EXPLAIN
-FROM src INSERT OVERWRITE TABLE dest1 SELECT src.key, sum(substr(src.value,4)) GROUP BY src.key LIMIT 5;
+FROM src INSERT OVERWRITE TABLE dest1 SELECT src.key, sum(substr(src.value,5)) GROUP BY src.key LIMIT 5;
 
-FROM src INSERT OVERWRITE TABLE dest1 SELECT src.key, sum(substr(src.value,4)) GROUP BY src.key LIMIT 5;
+FROM src INSERT OVERWRITE TABLE dest1 SELECT src.key, sum(substr(src.value,5)) GROUP BY src.key LIMIT 5;
 
 SELECT dest1.* FROM dest1;
diff --git a/ql/src/test/queries/clientpositive/groupby1_map.q b/ql/src/test/queries/clientpositive/groupby1_map.q
index 6ca1073c8a..a7ce7afe8e 100644
--- a/ql/src/test/queries/clientpositive/groupby1_map.q
+++ b/ql/src/test/queries/clientpositive/groupby1_map.q
@@ -3,8 +3,8 @@ set hive.map.aggr=true;
 CREATE TABLE dest1(key INT, value DOUBLE) STORED AS TEXTFILE;
 
 EXPLAIN
-FROM src INSERT OVERWRITE TABLE dest1 SELECT src.key, sum(substr(src.value,4)) GROUP BY src.key;
+FROM src INSERT OVERWRITE TABLE dest1 SELECT src.key, sum(substr(src.value,5)) GROUP BY src.key;
 
-FROM src INSERT OVERWRITE TABLE dest1 SELECT src.key, sum(substr(src.value,4)) GROUP BY src.key;
+FROM src INSERT OVERWRITE TABLE dest1 SELECT src.key, sum(substr(src.value,5)) GROUP BY src.key;
 
 SELECT dest1.* FROM dest1;
diff --git a/ql/src/test/queries/clientpositive/groupby2.q b/ql/src/test/queries/clientpositive/groupby2.q
index 90c95647c3..3feddd1836 100755
--- a/ql/src/test/queries/clientpositive/groupby2.q
+++ b/ql/src/test/queries/clientpositive/groupby2.q
@@ -2,9 +2,9 @@ CREATE TABLE dest_g2(key STRING, c1 INT, c2 STRING) STORED AS TEXTFILE;
 
 EXPLAIN
 FROM src
-INSERT OVERWRITE TABLE dest_g2 SELECT substr(src.key,0,1), count(DISTINCT substr(src.value,4)), concat(substr(src.key,0,1),sum(substr(src.value,4))) GROUP BY substr(src.key,0,1);
+INSERT OVERWRITE TABLE dest_g2 SELECT substr(src.key,1,1), count(DISTINCT substr(src.value,5)), concat(substr(src.key,1,1),sum(substr(src.value,5))) GROUP BY substr(src.key,1,1);
 
 FROM src
-INSERT OVERWRITE TABLE dest_g2 SELECT substr(src.key,0,1), count(DISTINCT substr(src.value,4)), concat(substr(src.key,0,1),sum(substr(src.value,4))) GROUP BY substr(src.key,0,1);
+INSERT OVERWRITE TABLE dest_g2 SELECT substr(src.key,1,1), count(DISTINCT substr(src.value,5)), concat(substr(src.key,1,1),sum(substr(src.value,5))) GROUP BY substr(src.key,1,1);
 
 SELECT dest_g2.* FROM dest_g2;
diff --git a/ql/src/test/queries/clientpositive/groupby2_limit.q b/ql/src/test/queries/clientpositive/groupby2_limit.q
index 7064438b7b..4bc263c77f 100644
--- a/ql/src/test/queries/clientpositive/groupby2_limit.q
+++ b/ql/src/test/queries/clientpositive/groupby2_limit.q
@@ -1,7 +1,7 @@
 set mapred.reduce.tasks=31;
 
 EXPLAIN
-SELECT src.key, sum(substr(src.value,4)) FROM src GROUP BY src.key LIMIT 5;
+SELECT src.key, sum(substr(src.value,5)) FROM src GROUP BY src.key LIMIT 5;
 
-SELECT src.key, sum(substr(src.value,4)) FROM src GROUP BY src.key LIMIT 5;
+SELECT src.key, sum(substr(src.value,5)) FROM src GROUP BY src.key LIMIT 5;
 
diff --git a/ql/src/test/queries/clientpositive/groupby2_map.q b/ql/src/test/queries/clientpositive/groupby2_map.q
index f818c81e57..e05f84b657 100644
--- a/ql/src/test/queries/clientpositive/groupby2_map.q
+++ b/ql/src/test/queries/clientpositive/groupby2_map.q
@@ -4,9 +4,9 @@ CREATE TABLE dest1(key STRING, c1 INT, c2 STRING) STORED AS TEXTFILE;
 
 EXPLAIN
 FROM src
-INSERT OVERWRITE TABLE dest1 SELECT substr(src.key,0,1), count(DISTINCT substr(src.value,4)), concat(substr(src.key,0,1),sum(substr(src.value,4))) GROUP BY substr(src.key,0,1);
+INSERT OVERWRITE TABLE dest1 SELECT substr(src.key,1,1), count(DISTINCT substr(src.value,5)), concat(substr(src.key,1,1),sum(substr(src.value,5))) GROUP BY substr(src.key,1,1);
 
 FROM src
-INSERT OVERWRITE TABLE dest1 SELECT substr(src.key,0,1), count(DISTINCT substr(src.value,4)), concat(substr(src.key,0,1),sum(substr(src.value,4))) GROUP BY substr(src.key,0,1);
+INSERT OVERWRITE TABLE dest1 SELECT substr(src.key,1,1), count(DISTINCT substr(src.value,5)), concat(substr(src.key,1,1),sum(substr(src.value,5))) GROUP BY substr(src.key,1,1);
 
 SELECT dest1.* FROM dest1;
diff --git a/ql/src/test/queries/clientpositive/groupby3.q b/ql/src/test/queries/clientpositive/groupby3.q
index 1cb4af6c19..af7cd062ef 100755
--- a/ql/src/test/queries/clientpositive/groupby3.q
+++ b/ql/src/test/queries/clientpositive/groupby3.q
@@ -2,9 +2,9 @@ CREATE TABLE dest1(c1 DOUBLE, c2 DOUBLE, c3 DOUBLE, c4 DOUBLE, c5 DOUBLE) STORED
 
 EXPLAIN
 FROM src
-INSERT OVERWRITE TABLE dest1 SELECT sum(substr(src.value,4)), avg(substr(src.value,4)), avg(DISTINCT substr(src.value,4)), max(substr(src.value,4)), min(substr(src.value,4));
+INSERT OVERWRITE TABLE dest1 SELECT sum(substr(src.value,5)), avg(substr(src.value,5)), avg(DISTINCT substr(src.value,5)), max(substr(src.value,5)), min(substr(src.value,5));
 
 FROM src
-INSERT OVERWRITE TABLE dest1 SELECT sum(substr(src.value,4)), avg(substr(src.value,4)), avg(DISTINCT substr(src.value,4)), max(substr(src.value,4)), min(substr(src.value,4));
+INSERT OVERWRITE TABLE dest1 SELECT sum(substr(src.value,5)), avg(substr(src.value,5)), avg(DISTINCT substr(src.value,5)), max(substr(src.value,5)), min(substr(src.value,5));
 
 SELECT dest1.* FROM dest1;
diff --git a/ql/src/test/queries/clientpositive/groupby3_map.q b/ql/src/test/queries/clientpositive/groupby3_map.q
index 746f6ab78e..943e103a7c 100644
--- a/ql/src/test/queries/clientpositive/groupby3_map.q
+++ b/ql/src/test/queries/clientpositive/groupby3_map.q
@@ -4,9 +4,9 @@ CREATE TABLE dest1(c1 DOUBLE, c2 DOUBLE, c3 DOUBLE, c4 DOUBLE, c5 DOUBLE) STORED
 
 EXPLAIN
 FROM src
-INSERT OVERWRITE TABLE dest1 SELECT sum(substr(src.value,4)), avg(substr(src.value,4)), avg(DISTINCT substr(src.value,4)), max(substr(src.value,4)), min(substr(src.value,4));
+INSERT OVERWRITE TABLE dest1 SELECT sum(substr(src.value,5)), avg(substr(src.value,5)), avg(DISTINCT substr(src.value,5)), max(substr(src.value,5)), min(substr(src.value,5));
 
 FROM src
-INSERT OVERWRITE TABLE dest1 SELECT sum(substr(src.value,4)), avg(substr(src.value,4)), avg(DISTINCT substr(src.value,4)), max(substr(src.value,4)), min(substr(src.value,4));
+INSERT OVERWRITE TABLE dest1 SELECT sum(substr(src.value,5)), avg(substr(src.value,5)), avg(DISTINCT substr(src.value,5)), max(substr(src.value,5)), min(substr(src.value,5));
 
 SELECT dest1.* FROM dest1;
diff --git a/ql/src/test/queries/clientpositive/groupby4.q b/ql/src/test/queries/clientpositive/groupby4.q
index a6b224c566..429d179200 100755
--- a/ql/src/test/queries/clientpositive/groupby4.q
+++ b/ql/src/test/queries/clientpositive/groupby4.q
@@ -2,10 +2,10 @@ CREATE TABLE dest1(c1 STRING) STORED AS TEXTFILE;
 
 EXPLAIN
 FROM src
-INSERT OVERWRITE TABLE dest1 SELECT substr(src.key,0,1) GROUP BY substr(src.key,0,1);
+INSERT OVERWRITE TABLE dest1 SELECT substr(src.key,1,1) GROUP BY substr(src.key,1,1);
 
 FROM src
-INSERT OVERWRITE TABLE dest1 SELECT substr(src.key,0,1) GROUP BY substr(src.key,0,1);
+INSERT OVERWRITE TABLE dest1 SELECT substr(src.key,1,1) GROUP BY substr(src.key,1,1);
 
 SELECT dest1.* FROM dest1;
 
diff --git a/ql/src/test/queries/clientpositive/groupby5.q b/ql/src/test/queries/clientpositive/groupby5.q
index bf80d6a874..e06974d513 100755
--- a/ql/src/test/queries/clientpositive/groupby5.q
+++ b/ql/src/test/queries/clientpositive/groupby5.q
@@ -2,12 +2,12 @@ CREATE TABLE dest1(key INT, value STRING) STORED AS TEXTFILE;
 
 EXPLAIN
 INSERT OVERWRITE TABLE dest1 
-SELECT src.key, sum(substr(src.value,4)) 
+SELECT src.key, sum(substr(src.value,5)) 
 FROM src
 GROUP BY src.key;
 
 INSERT OVERWRITE TABLE dest1 
-SELECT src.key, sum(substr(src.value,4)) 
+SELECT src.key, sum(substr(src.value,5)) 
 FROM src
 GROUP BY src.key;
 
diff --git a/ql/src/test/queries/clientpositive/groupby6.q b/ql/src/test/queries/clientpositive/groupby6.q
index d0b310fa38..60f14b683b 100755
--- a/ql/src/test/queries/clientpositive/groupby6.q
+++ b/ql/src/test/queries/clientpositive/groupby6.q
@@ -2,10 +2,10 @@ CREATE TABLE dest1(c1 STRING) STORED AS TEXTFILE;
 
 EXPLAIN
 FROM src
-INSERT OVERWRITE TABLE dest1 SELECT DISTINCT substr(src.value,4,1);
+INSERT OVERWRITE TABLE dest1 SELECT DISTINCT substr(src.value,5,1);
 
 FROM src
-INSERT OVERWRITE TABLE dest1 SELECT DISTINCT substr(src.value,4,1);
+INSERT OVERWRITE TABLE dest1 SELECT DISTINCT substr(src.value,5,1);
 
 SELECT dest1.* FROM dest1;
 
diff --git a/ql/src/test/queries/clientpositive/groupby7.q b/ql/src/test/queries/clientpositive/groupby7.q
index cad4dbd79c..c45e301195 100644
--- a/ql/src/test/queries/clientpositive/groupby7.q
+++ b/ql/src/test/queries/clientpositive/groupby7.q
@@ -5,8 +5,8 @@ SET hive.exec.compress.intermediate=true;
 SET hive.exec.compress.output=true; 
 
 FROM SRC
-INSERT OVERWRITE TABLE DEST1 SELECT SRC.key, sum(SUBSTR(SRC.value,4)) GROUP BY SRC.key
-INSERT OVERWRITE TABLE DEST2 SELECT SRC.key, sum(SUBSTR(SRC.value,4)) GROUP BY SRC.key;
+INSERT OVERWRITE TABLE DEST1 SELECT SRC.key, sum(SUBSTR(SRC.value,5)) GROUP BY SRC.key
+INSERT OVERWRITE TABLE DEST2 SELECT SRC.key, sum(SUBSTR(SRC.value,5)) GROUP BY SRC.key;
 
 SELECT DEST1.* FROM DEST1;
 SELECT DEST2.* FROM DEST2;
diff --git a/ql/src/test/queries/clientpositive/groupby8.q b/ql/src/test/queries/clientpositive/groupby8.q
index 79249ede37..f273bfde4c 100644
--- a/ql/src/test/queries/clientpositive/groupby8.q
+++ b/ql/src/test/queries/clientpositive/groupby8.q
@@ -2,8 +2,8 @@ CREATE TABLE DEST1(key INT, value STRING) STORED AS TEXTFILE;
 CREATE TABLE DEST2(key INT, value STRING) STORED AS TEXTFILE;
 
 FROM SRC
-INSERT OVERWRITE TABLE DEST1 SELECT SRC.key, COUNT(DISTINCT SUBSTR(SRC.value,4)) GROUP BY SRC.key
-INSERT OVERWRITE TABLE DEST2 SELECT SRC.key, COUNT(DISTINCT SUBSTR(SRC.value,4)) GROUP BY SRC.key;
+INSERT OVERWRITE TABLE DEST1 SELECT SRC.key, COUNT(DISTINCT SUBSTR(SRC.value,5)) GROUP BY SRC.key
+INSERT OVERWRITE TABLE DEST2 SELECT SRC.key, COUNT(DISTINCT SUBSTR(SRC.value,5)) GROUP BY SRC.key;
 
 SELECT DEST1.* FROM DEST1;
 SELECT DEST2.* FROM DEST2;
diff --git a/ql/src/test/queries/clientpositive/udf_substr.q b/ql/src/test/queries/clientpositive/udf_substr.q
new file mode 100644
index 0000000000..4d93b3140d
--- /dev/null
+++ b/ql/src/test/queries/clientpositive/udf_substr.q
@@ -0,0 +1,37 @@
+SELECT
+  substr(null, 1), substr(null, 1, 1),
+  substr('ABC', null), substr('ABC', null, 1),
+  substr('ABC', 1, null)
+FROM src LIMIT 1;
+
+SELECT
+  substr('ABC', 1, 0), substr('ABC', 1, -1), substr('ABC', 2, -100),
+  substr('ABC', 4), substr('ABC', 4, 100),
+  substr('ABC', -4), substr('ABC', -4, 100),
+  substr('ABC', 100), substr('ABC', 100, 100),
+  substr('ABC', -100), substr('ABC', -100, 100),
+  substr('ABC', 2147483647), substr('ABC', 2147483647, 2147483647)
+FROM src LIMIT 1;
+
+SELECT
+  substr('ABCDEFG', 3, 4), substr('ABCDEFG', -5, 4),
+  substr('ABCDEFG', 3), substr('ABCDEFG', -5),
+  substr('ABC', 0), substr('ABC', 1), substr('ABC', 2), substr('ABC', 3),
+  substr('ABC', 1, 2147483647), substr('ABC', 2, 2147483647),
+  substr('A', 0), substr('A', 1), substr('A', -1)
+FROM src LIMIT 1;
+
+SELECT
+  substr('ABC', 0, 1), substr('ABC', 0, 2), substr('ABC', 0, 3), substr('ABC', 0, 4),
+  substr('ABC', 1, 1), substr('ABC', 1, 2), substr('ABC', 1, 3), substr('ABC', 1, 4),
+  substr('ABC', 2, 1), substr('ABC', 2, 2), substr('ABC', 2, 3), substr('ABC', 2, 4),
+  substr('ABC', 3, 1), substr('ABC', 3, 2), substr('ABC', 3, 3), substr('ABC', 3, 4),
+  substr('ABC', 4, 1)
+FROM src LIMIT 1;
+
+SELECT
+  substr('ABC', -1, 1), substr('ABC', -1, 2), substr('ABC', -1, 3), substr('ABC', -1, 4),
+  substr('ABC', -2, 1), substr('ABC', -2, 2), substr('ABC', -2, 3), substr('ABC', -2, 4),
+  substr('ABC', -3, 1), substr('ABC', -3, 2), substr('ABC', -3, 3), substr('ABC', -3, 4),
+  substr('ABC', -4, 1)
+FROM src LIMIT 1;
diff --git a/ql/src/test/queries/positive/groupby1.q b/ql/src/test/queries/positive/groupby1.q
index de4ed5ca38..96b29b05cc 100755
--- a/ql/src/test/queries/positive/groupby1.q
+++ b/ql/src/test/queries/positive/groupby1.q
@@ -1,2 +1,2 @@
 FROM src
-INSERT OVERWRITE TABLE dest1 SELECT src.key, sum(substr(src.value,4)) GROUP BY src.key
+INSERT OVERWRITE TABLE dest1 SELECT src.key, sum(substr(src.value,5)) GROUP BY src.key
diff --git a/ql/src/test/queries/positive/groupby2.q b/ql/src/test/queries/positive/groupby2.q
index d4064382e7..d741eb60b6 100755
--- a/ql/src/test/queries/positive/groupby2.q
+++ b/ql/src/test/queries/positive/groupby2.q
@@ -1,2 +1,2 @@
 FROM src
-SELECT substr(src.key,0,1), count(DISTINCT substr(src.value,4)), concat(substr(src.key,0,1),sum(substr(src.value,4))) GROUP BY substr(src.key,0,1)
+SELECT substr(src.key,1,1), count(DISTINCT substr(src.value,5)), concat(substr(src.key,1,1),sum(substr(src.value,5))) GROUP BY substr(src.key,1,1)
diff --git a/ql/src/test/queries/positive/groupby3.q b/ql/src/test/queries/positive/groupby3.q
index 29fe4a1366..03b1248a11 100755
--- a/ql/src/test/queries/positive/groupby3.q
+++ b/ql/src/test/queries/positive/groupby3.q
@@ -1,2 +1,2 @@
 FROM src
-SELECT sum(substr(src.value,4)), avg(substr(src.value,4)), avg(DISTINCT substr(src.value,4)), max(substr(src.value,4)), min(substr(src.value,4))
+SELECT sum(substr(src.value,5)), avg(substr(src.value,5)), avg(DISTINCT substr(src.value,5)), max(substr(src.value,5)), min(substr(src.value,5))
diff --git a/ql/src/test/queries/positive/groupby4.q b/ql/src/test/queries/positive/groupby4.q
index d421cb6a08..85271a9caf 100755
--- a/ql/src/test/queries/positive/groupby4.q
+++ b/ql/src/test/queries/positive/groupby4.q
@@ -1,2 +1,2 @@
 FROM src
-SELECT substr(src.key,0,1) GROUP BY substr(src.key,0,1)
+SELECT substr(src.key,1,1) GROUP BY substr(src.key,1,1)
diff --git a/ql/src/test/queries/positive/groupby5.q b/ql/src/test/queries/positive/groupby5.q
index c20e4fa401..ebd65b3069 100755
--- a/ql/src/test/queries/positive/groupby5.q
+++ b/ql/src/test/queries/positive/groupby5.q
@@ -1,4 +1,4 @@
 
-SELECT src.key, sum(substr(src.value,4)) 
+SELECT src.key, sum(substr(src.value,5)) 
 FROM src
 GROUP BY src.key
diff --git a/ql/src/test/queries/positive/groupby6.q b/ql/src/test/queries/positive/groupby6.q
index c12f6a92de..80654f2a9c 100755
--- a/ql/src/test/queries/positive/groupby6.q
+++ b/ql/src/test/queries/positive/groupby6.q
@@ -1,2 +1,2 @@
 FROM src
-SELECT DISTINCT substr(src.value,4,1)
+SELECT DISTINCT substr(src.value,5,1)
diff --git a/ql/src/test/results/clientpositive/groupby1.q.out b/ql/src/test/results/clientpositive/groupby1.q.out
index 33aaeca64d..e69e2320a9 100644
--- a/ql/src/test/results/clientpositive/groupby1.q.out
+++ b/ql/src/test/results/clientpositive/groupby1.q.out
@@ -1,5 +1,5 @@
 ABSTRACT SYNTAX TREE:
-  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest_g1)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF src key)) (TOK_SELEXPR (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 4)))) (TOK_GROUPBY (TOK_COLREF src key))))
+  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest_g1)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF src key)) (TOK_SELEXPR (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 5)))) (TOK_GROUPBY (TOK_COLREF src key))))
 
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
@@ -21,7 +21,7 @@ STAGE PLANS:
                     type: double
               tag: -1
               value expressions:
-                    expr: substr(value, 4)
+                    expr: substr(value, 5)
                     type: string
       Reduce Operator Tree:
         Group By Operator
diff --git a/ql/src/test/results/clientpositive/groupby1_limit.q.out b/ql/src/test/results/clientpositive/groupby1_limit.q.out
index 86dd788bd6..27774ead00 100644
--- a/ql/src/test/results/clientpositive/groupby1_limit.q.out
+++ b/ql/src/test/results/clientpositive/groupby1_limit.q.out
@@ -1,5 +1,5 @@
 ABSTRACT SYNTAX TREE:
-  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest1)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF src key)) (TOK_SELEXPR (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 4)))) (TOK_GROUPBY (TOK_COLREF src key)) (TOK_LIMIT 5)))
+  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest1)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF src key)) (TOK_SELEXPR (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 5)))) (TOK_GROUPBY (TOK_COLREF src key)) (TOK_LIMIT 5)))
 
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
@@ -22,7 +22,7 @@ STAGE PLANS:
                     type: double
               tag: -1
               value expressions:
-                    expr: substr(value, 4)
+                    expr: substr(value, 5)
                     type: string
       Reduce Operator Tree:
         Group By Operator
diff --git a/ql/src/test/results/clientpositive/groupby1_map.q.out b/ql/src/test/results/clientpositive/groupby1_map.q.out
index a5babcd98c..049fe17a28 100644
--- a/ql/src/test/results/clientpositive/groupby1_map.q.out
+++ b/ql/src/test/results/clientpositive/groupby1_map.q.out
@@ -1,5 +1,5 @@
 ABSTRACT SYNTAX TREE:
-  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest1)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF src key)) (TOK_SELEXPR (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 4)))) (TOK_GROUPBY (TOK_COLREF src key))))
+  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest1)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF src key)) (TOK_SELEXPR (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 5)))) (TOK_GROUPBY (TOK_COLREF src key))))
 
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
@@ -13,7 +13,7 @@ STAGE PLANS:
         src 
             Group By Operator
               aggregations:
-                    expr: sum(UDFToDouble(substr(value, 4)))
+                    expr: sum(UDFToDouble(substr(value, 5)))
               keys:
                     expr: key
                     type: string
diff --git a/ql/src/test/results/clientpositive/groupby2.q.out b/ql/src/test/results/clientpositive/groupby2.q.out
index f5d62dc5fd..4adf0b7bcf 100644
--- a/ql/src/test/results/clientpositive/groupby2.q.out
+++ b/ql/src/test/results/clientpositive/groupby2.q.out
@@ -1,5 +1,5 @@
 ABSTRACT SYNTAX TREE:
-  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest_g2)) (TOK_SELECT (TOK_SELEXPR (TOK_FUNCTION substr (TOK_COLREF src key) 0 1)) (TOK_SELEXPR (TOK_FUNCTIONDI count (TOK_FUNCTION substr (TOK_COLREF src value) 4))) (TOK_SELEXPR (TOK_FUNCTION concat (TOK_FUNCTION substr (TOK_COLREF src key) 0 1) (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 4))))) (TOK_GROUPBY (TOK_FUNCTION substr (TOK_COLREF src key) 0 1))))
+  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest_g2)) (TOK_SELECT (TOK_SELEXPR (TOK_FUNCTION substr (TOK_COLREF src key) 1 1)) (TOK_SELEXPR (TOK_FUNCTIONDI count (TOK_FUNCTION substr (TOK_COLREF src value) 5))) (TOK_SELEXPR (TOK_FUNCTION concat (TOK_FUNCTION substr (TOK_COLREF src key) 1 1) (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 5))))) (TOK_GROUPBY (TOK_FUNCTION substr (TOK_COLREF src key) 1 1))))
 
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
@@ -13,22 +13,22 @@ STAGE PLANS:
         src 
             Reduce Output Operator
               key expressions:
-                    expr: substr(key, 0, 1)
+                    expr: substr(key, 1, 1)
                     type: string
-                    expr: substr(value, 4)
+                    expr: substr(value, 5)
                     type: string
               sort order: ++
               Map-reduce partition columns:
-                    expr: substr(key, 0, 1)
+                    expr: substr(key, 1, 1)
                     type: string
-                    expr: substr(value, 4)
+                    expr: substr(value, 5)
                     type: string
               tag: -1
       Reduce Operator Tree:
         Group By Operator
           aggregations:
-                expr: count(DISTINCT KEY.1)
                 expr: sum(UDFToDouble(KEY.1))
+                expr: count(DISTINCT KEY.1)
           keys:
                 expr: KEY.0
                 type: string
@@ -55,14 +55,14 @@ STAGE PLANS:
             tag: -1
             value expressions:
                   expr: 1
-                  type: bigint
-                  expr: 2
                   type: double
+                  expr: 2
+                  type: bigint
       Reduce Operator Tree:
         Group By Operator
           aggregations:
-                expr: count(VALUE.0)
-                expr: sum(VALUE.1)
+                expr: sum(VALUE.0)
+                expr: count(VALUE.1)
           keys:
                 expr: KEY.0
                 type: string
@@ -71,9 +71,9 @@ STAGE PLANS:
             expressions:
                   expr: 0
                   type: string
-                  expr: 1
+                  expr: 2
                   type: bigint
-                  expr: concat(0, UDFToString(2))
+                  expr: concat(0, UDFToString(1))
                   type: string
             Select Operator
               expressions:
diff --git a/ql/src/test/results/clientpositive/groupby2_limit.q.out b/ql/src/test/results/clientpositive/groupby2_limit.q.out
index d02ce31bde..fb855cf2ae 100644
--- a/ql/src/test/results/clientpositive/groupby2_limit.q.out
+++ b/ql/src/test/results/clientpositive/groupby2_limit.q.out
@@ -1,5 +1,5 @@
 ABSTRACT SYNTAX TREE:
-  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF src key)) (TOK_SELEXPR (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 4)))) (TOK_GROUPBY (TOK_COLREF src key)) (TOK_LIMIT 5)))
+  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF src key)) (TOK_SELEXPR (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 5)))) (TOK_GROUPBY (TOK_COLREF src key)) (TOK_LIMIT 5)))
 
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
@@ -21,7 +21,7 @@ STAGE PLANS:
                     type: double
               tag: -1
               value expressions:
-                    expr: substr(value, 4)
+                    expr: substr(value, 5)
                     type: string
       Reduce Operator Tree:
         Group By Operator
diff --git a/ql/src/test/results/clientpositive/groupby2_map.q.out b/ql/src/test/results/clientpositive/groupby2_map.q.out
index df42def1c0..4771e46e74 100644
--- a/ql/src/test/results/clientpositive/groupby2_map.q.out
+++ b/ql/src/test/results/clientpositive/groupby2_map.q.out
@@ -1,5 +1,5 @@
 ABSTRACT SYNTAX TREE:
-  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest1)) (TOK_SELECT (TOK_SELEXPR (TOK_FUNCTION substr (TOK_COLREF src key) 0 1)) (TOK_SELEXPR (TOK_FUNCTIONDI count (TOK_FUNCTION substr (TOK_COLREF src value) 4))) (TOK_SELEXPR (TOK_FUNCTION concat (TOK_FUNCTION substr (TOK_COLREF src key) 0 1) (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 4))))) (TOK_GROUPBY (TOK_FUNCTION substr (TOK_COLREF src key) 0 1))))
+  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest1)) (TOK_SELECT (TOK_SELEXPR (TOK_FUNCTION substr (TOK_COLREF src key) 1 1)) (TOK_SELEXPR (TOK_FUNCTIONDI count (TOK_FUNCTION substr (TOK_COLREF src value) 5))) (TOK_SELEXPR (TOK_FUNCTION concat (TOK_FUNCTION substr (TOK_COLREF src key) 1 1) (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 5))))) (TOK_GROUPBY (TOK_FUNCTION substr (TOK_COLREF src key) 1 1))))
 
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
@@ -13,12 +13,12 @@ STAGE PLANS:
         src 
             Group By Operator
               aggregations:
-                    expr: count(DISTINCT substr(value, 4))
-                    expr: sum(UDFToDouble(substr(value, 4)))
+                    expr: sum(UDFToDouble(substr(value, 5)))
+                    expr: count(DISTINCT substr(value, 5))
               keys:
-                    expr: substr(key, 0, 1)
+                    expr: substr(key, 1, 1)
                     type: string
-                    expr: substr(value, 4)
+                    expr: substr(value, 5)
                     type: string
               mode: hash
               Reduce Output Operator
@@ -36,14 +36,14 @@ STAGE PLANS:
                 tag: -1
                 value expressions:
                       expr: 2
-                      type: bigint
-                      expr: 3
                       type: double
+                      expr: 3
+                      type: bigint
       Reduce Operator Tree:
         Group By Operator
           aggregations:
+                expr: sum(VALUE.0)
                 expr: count(DISTINCT KEY.1)
-                expr: sum(VALUE.1)
           keys:
                 expr: KEY.0
                 type: string
@@ -58,7 +58,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /tmp/hive-zshao/107370008/1090440963.10001 
+        /data/users/athusoo/commits/hive_trunk_ws3/build/ql/tmp/435212851/489689211.10001 
           Reduce Output Operator
             key expressions:
                   expr: 0
@@ -70,14 +70,14 @@ STAGE PLANS:
             tag: -1
             value expressions:
                   expr: 1
-                  type: bigint
-                  expr: 2
                   type: double
+                  expr: 2
+                  type: bigint
       Reduce Operator Tree:
         Group By Operator
           aggregations:
-                expr: count(VALUE.0)
-                expr: sum(VALUE.1)
+                expr: sum(VALUE.0)
+                expr: count(VALUE.1)
           keys:
                 expr: KEY.0
                 type: string
@@ -86,9 +86,9 @@ STAGE PLANS:
             expressions:
                   expr: 0
                   type: string
-                  expr: 1
+                  expr: 2
                   type: bigint
-                  expr: concat(0, UDFToString(2))
+                  expr: concat(0, UDFToString(1))
                   type: string
             Select Operator
               expressions:
diff --git a/ql/src/test/results/clientpositive/groupby3.q.out b/ql/src/test/results/clientpositive/groupby3.q.out
index 52cb02aa3e..a3ebafb148 100644
--- a/ql/src/test/results/clientpositive/groupby3.q.out
+++ b/ql/src/test/results/clientpositive/groupby3.q.out
@@ -1,5 +1,5 @@
 ABSTRACT SYNTAX TREE:
-  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest1)) (TOK_SELECT (TOK_SELEXPR (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 4))) (TOK_SELEXPR (TOK_FUNCTION avg (TOK_FUNCTION substr (TOK_COLREF src value) 4))) (TOK_SELEXPR (TOK_FUNCTIONDI avg (TOK_FUNCTION substr (TOK_COLREF src value) 4))) (TOK_SELEXPR (TOK_FUNCTION max (TOK_FUNCTION substr (TOK_COLREF src value) 4))) (TOK_SELEXPR (TOK_FUNCTION min (TOK_FUNCTION substr (TOK_COLREF src value) 4))))))
+  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest1)) (TOK_SELECT (TOK_SELEXPR (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 5))) (TOK_SELEXPR (TOK_FUNCTION avg (TOK_FUNCTION substr (TOK_COLREF src value) 5))) (TOK_SELEXPR (TOK_FUNCTIONDI avg (TOK_FUNCTION substr (TOK_COLREF src value) 5))) (TOK_SELEXPR (TOK_FUNCTION max (TOK_FUNCTION substr (TOK_COLREF src value) 5))) (TOK_SELEXPR (TOK_FUNCTION min (TOK_FUNCTION substr (TOK_COLREF src value) 5))))))
 
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
@@ -17,21 +17,21 @@ STAGE PLANS:
                     type: string
               Reduce Output Operator
                 key expressions:
-                      expr: substr(0, 4)
+                      expr: substr(0, 5)
                       type: string
                 sort order: +
                 Map-reduce partition columns:
-                      expr: substr(0, 4)
+                      expr: substr(0, 5)
                       type: string
                 tag: -1
       Reduce Operator Tree:
         Group By Operator
           aggregations:
-                expr: avg(DISTINCT UDFToDouble(KEY.0))
                 expr: sum(UDFToDouble(KEY.0))
-                expr: avg(UDFToDouble(KEY.0))
-                expr: min(KEY.0)
                 expr: max(KEY.0)
+                expr: avg(DISTINCT UDFToDouble(KEY.0))
+                expr: min(KEY.0)
+                expr: avg(UDFToDouble(KEY.0))
           mode: partial1
           File Output Operator
             compressed: false
@@ -43,15 +43,15 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/tmp/191882138/597396542.10001 
+        /data/users/athusoo/commits/hive_trunk_ws3/build/ql/tmp/1302296/900109453.10001 
           Reduce Output Operator
             sort order: 
             tag: -1
             value expressions:
                   expr: 0
-                  type: string
-                  expr: 1
                   type: double
+                  expr: 1
+                  type: string
                   expr: 2
                   type: string
                   expr: 3
@@ -61,21 +61,21 @@ STAGE PLANS:
       Reduce Operator Tree:
         Group By Operator
           aggregations:
-                expr: avg(UDFToDouble(VALUE.0))
-                expr: sum(VALUE.1)
+                expr: sum(VALUE.0)
+                expr: max(VALUE.1)
                 expr: avg(UDFToDouble(VALUE.2))
                 expr: min(VALUE.3)
-                expr: max(VALUE.4)
+                expr: avg(UDFToDouble(VALUE.4))
           mode: final
           Select Operator
             expressions:
-                  expr: 1
-                  type: double
-                  expr: 2
-                  type: double
                   expr: 0
                   type: double
                   expr: 4
+                  type: double
+                  expr: 2
+                  type: double
+                  expr: 1
                   type: string
                   expr: 3
                   type: string
diff --git a/ql/src/test/results/clientpositive/groupby3_map.q.out b/ql/src/test/results/clientpositive/groupby3_map.q.out
index 2ac3c3ecdf..590635641c 100644
--- a/ql/src/test/results/clientpositive/groupby3_map.q.out
+++ b/ql/src/test/results/clientpositive/groupby3_map.q.out
@@ -1,5 +1,5 @@
 ABSTRACT SYNTAX TREE:
-  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest1)) (TOK_SELECT (TOK_SELEXPR (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 4))) (TOK_SELEXPR (TOK_FUNCTION avg (TOK_FUNCTION substr (TOK_COLREF src value) 4))) (TOK_SELEXPR (TOK_FUNCTIONDI avg (TOK_FUNCTION substr (TOK_COLREF src value) 4))) (TOK_SELEXPR (TOK_FUNCTION max (TOK_FUNCTION substr (TOK_COLREF src value) 4))) (TOK_SELEXPR (TOK_FUNCTION min (TOK_FUNCTION substr (TOK_COLREF src value) 4))))))
+  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest1)) (TOK_SELECT (TOK_SELEXPR (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 5))) (TOK_SELEXPR (TOK_FUNCTION avg (TOK_FUNCTION substr (TOK_COLREF src value) 5))) (TOK_SELEXPR (TOK_FUNCTIONDI avg (TOK_FUNCTION substr (TOK_COLREF src value) 5))) (TOK_SELEXPR (TOK_FUNCTION max (TOK_FUNCTION substr (TOK_COLREF src value) 5))) (TOK_SELEXPR (TOK_FUNCTION min (TOK_FUNCTION substr (TOK_COLREF src value) 5))))))
 
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
@@ -17,13 +17,13 @@ STAGE PLANS:
                     type: string
               Group By Operator
                 aggregations:
-                      expr: avg(DISTINCT UDFToDouble(substr(0, 4)))
-                      expr: sum(UDFToDouble(substr(0, 4)))
-                      expr: avg(UDFToDouble(substr(0, 4)))
-                      expr: min(substr(0, 4))
-                      expr: max(substr(0, 4))
+                      expr: sum(UDFToDouble(substr(0, 5)))
+                      expr: max(substr(0, 5))
+                      expr: avg(DISTINCT UDFToDouble(substr(0, 5)))
+                      expr: min(substr(0, 5))
+                      expr: avg(UDFToDouble(substr(0, 5)))
                 keys:
-                      expr: substr(0, 4)
+                      expr: substr(0, 5)
                       type: string
                 mode: hash
                 Reduce Output Operator
@@ -37,9 +37,9 @@ STAGE PLANS:
                   tag: -1
                   value expressions:
                         expr: 1
-                        type: string
-                        expr: 2
                         type: double
+                        expr: 2
+                        type: string
                         expr: 3
                         type: string
                         expr: 4
@@ -49,11 +49,11 @@ STAGE PLANS:
       Reduce Operator Tree:
         Group By Operator
           aggregations:
+                expr: sum(VALUE.0)
+                expr: max(VALUE.1)
                 expr: avg(DISTINCT UDFToDouble(KEY.0))
-                expr: sum(VALUE.1)
-                expr: avg(UDFToDouble(VALUE.2))
                 expr: min(VALUE.3)
-                expr: max(VALUE.4)
+                expr: avg(UDFToDouble(VALUE.4))
           mode: partial2
           File Output Operator
             compressed: false
@@ -65,15 +65,15 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/tmp/885399493/544614010.10001 
+        /data/users/athusoo/commits/hive_trunk_ws3/build/ql/tmp/1389629365/204290894.10001 
           Reduce Output Operator
             sort order: 
             tag: -1
             value expressions:
                   expr: 0
-                  type: string
-                  expr: 1
                   type: double
+                  expr: 1
+                  type: string
                   expr: 2
                   type: string
                   expr: 3
@@ -83,21 +83,21 @@ STAGE PLANS:
       Reduce Operator Tree:
         Group By Operator
           aggregations:
-                expr: avg(UDFToDouble(VALUE.0))
-                expr: sum(VALUE.1)
+                expr: sum(VALUE.0)
+                expr: max(VALUE.1)
                 expr: avg(UDFToDouble(VALUE.2))
                 expr: min(VALUE.3)
-                expr: max(VALUE.4)
+                expr: avg(UDFToDouble(VALUE.4))
           mode: final
           Select Operator
             expressions:
-                  expr: 1
-                  type: double
-                  expr: 2
-                  type: double
                   expr: 0
                   type: double
                   expr: 4
+                  type: double
+                  expr: 2
+                  type: double
+                  expr: 1
                   type: string
                   expr: 3
                   type: string
diff --git a/ql/src/test/results/clientpositive/groupby4.q.out b/ql/src/test/results/clientpositive/groupby4.q.out
index 163786d15e..1e31fa1097 100644
--- a/ql/src/test/results/clientpositive/groupby4.q.out
+++ b/ql/src/test/results/clientpositive/groupby4.q.out
@@ -1,5 +1,5 @@
 ABSTRACT SYNTAX TREE:
-  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest1)) (TOK_SELECT (TOK_SELEXPR (TOK_FUNCTION substr (TOK_COLREF src key) 0 1))) (TOK_GROUPBY (TOK_FUNCTION substr (TOK_COLREF src key) 0 1))))
+  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest1)) (TOK_SELECT (TOK_SELEXPR (TOK_FUNCTION substr (TOK_COLREF src key) 1 1))) (TOK_GROUPBY (TOK_FUNCTION substr (TOK_COLREF src key) 1 1))))
 
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
@@ -17,7 +17,7 @@ STAGE PLANS:
                     type: string
               Reduce Output Operator
                 key expressions:
-                      expr: substr(0, 0, 1)
+                      expr: substr(0, 1, 1)
                       type: string
                 sort order: +
                 Map-reduce partition columns:
diff --git a/ql/src/test/results/clientpositive/groupby5.q.out b/ql/src/test/results/clientpositive/groupby5.q.out
index 0ef8c99a64..34ff031263 100644
--- a/ql/src/test/results/clientpositive/groupby5.q.out
+++ b/ql/src/test/results/clientpositive/groupby5.q.out
@@ -1,5 +1,5 @@
 ABSTRACT SYNTAX TREE:
-  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest1)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF src key)) (TOK_SELEXPR (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 4)))) (TOK_GROUPBY (TOK_COLREF src key))))
+  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest1)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF src key)) (TOK_SELEXPR (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 5)))) (TOK_GROUPBY (TOK_COLREF src key))))
 
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
@@ -21,7 +21,7 @@ STAGE PLANS:
                     type: double
               tag: -1
               value expressions:
-                    expr: substr(value, 4)
+                    expr: substr(value, 5)
                     type: string
       Reduce Operator Tree:
         Group By Operator
diff --git a/ql/src/test/results/clientpositive/groupby6.q.out b/ql/src/test/results/clientpositive/groupby6.q.out
index 7521396f01..6e58a333ed 100644
--- a/ql/src/test/results/clientpositive/groupby6.q.out
+++ b/ql/src/test/results/clientpositive/groupby6.q.out
@@ -1,5 +1,5 @@
 ABSTRACT SYNTAX TREE:
-  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest1)) (TOK_SELECTDI (TOK_SELEXPR (TOK_FUNCTION substr (TOK_COLREF src value) 4 1)))))
+  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest1)) (TOK_SELECTDI (TOK_SELEXPR (TOK_FUNCTION substr (TOK_COLREF src value) 5 1)))))
 
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
@@ -17,7 +17,7 @@ STAGE PLANS:
                     type: string
               Reduce Output Operator
                 key expressions:
-                      expr: substr(0, 4, 1)
+                      expr: substr(0, 5, 1)
                       type: string
                 sort order: +
                 Map-reduce partition columns:
diff --git a/ql/src/test/results/clientpositive/udf_substr.q.out b/ql/src/test/results/clientpositive/udf_substr.q.out
new file mode 100644
index 0000000000..6a9ce0db38
--- /dev/null
+++ b/ql/src/test/results/clientpositive/udf_substr.q.out
@@ -0,0 +1,5 @@
+NULL	NULL	NULL	NULL	NULL
+												
+CDEF	CDEF	CDEFG	CDEFG	ABC	ABC	BC	C	ABC	BC	A	A	A
+A	AB	ABC	ABC	A	AB	ABC	ABC	B	BC	BC	BC	C	C	C	C	
+C	C	C	C	B	BC	BC	BC	A	AB	ABC	ABC	
diff --git a/ql/src/test/results/compiler/parse/groupby1.q.out b/ql/src/test/results/compiler/parse/groupby1.q.out
index cf6d263343..90497c32ab 100755
--- a/ql/src/test/results/compiler/parse/groupby1.q.out
+++ b/ql/src/test/results/compiler/parse/groupby1.q.out
@@ -1 +1 @@
-(TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest1)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF src key)) (TOK_SELEXPR (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 4)))) (TOK_GROUPBY (TOK_COLREF src key)))) null
\ No newline at end of file
+(TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest1)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF src key)) (TOK_SELEXPR (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 5)))) (TOK_GROUPBY (TOK_COLREF src key)))) null
\ No newline at end of file
diff --git a/ql/src/test/results/compiler/parse/groupby2.q.out b/ql/src/test/results/compiler/parse/groupby2.q.out
index 286b362414..79b69fa5ec 100755
--- a/ql/src/test/results/compiler/parse/groupby2.q.out
+++ b/ql/src/test/results/compiler/parse/groupby2.q.out
@@ -1 +1 @@
-(TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_FUNCTION substr (TOK_COLREF src key) 0 1)) (TOK_SELEXPR (TOK_FUNCTIONDI count (TOK_FUNCTION substr (TOK_COLREF src value) 4))) (TOK_SELEXPR (TOK_FUNCTION concat (TOK_FUNCTION substr (TOK_COLREF src key) 0 1) (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 4))))) (TOK_GROUPBY (TOK_FUNCTION substr (TOK_COLREF src key) 0 1)))) null
\ No newline at end of file
+(TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_FUNCTION substr (TOK_COLREF src key) 1 1)) (TOK_SELEXPR (TOK_FUNCTIONDI count (TOK_FUNCTION substr (TOK_COLREF src value) 5))) (TOK_SELEXPR (TOK_FUNCTION concat (TOK_FUNCTION substr (TOK_COLREF src key) 1 1) (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 5))))) (TOK_GROUPBY (TOK_FUNCTION substr (TOK_COLREF src key) 1 1)))) null
\ No newline at end of file
diff --git a/ql/src/test/results/compiler/parse/groupby3.q.out b/ql/src/test/results/compiler/parse/groupby3.q.out
index a7d0fda5a6..80be30eb09 100644
--- a/ql/src/test/results/compiler/parse/groupby3.q.out
+++ b/ql/src/test/results/compiler/parse/groupby3.q.out
@@ -1 +1 @@
-(TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 4))) (TOK_SELEXPR (TOK_FUNCTION avg (TOK_FUNCTION substr (TOK_COLREF src value) 4))) (TOK_SELEXPR (TOK_FUNCTIONDI avg (TOK_FUNCTION substr (TOK_COLREF src value) 4))) (TOK_SELEXPR (TOK_FUNCTION max (TOK_FUNCTION substr (TOK_COLREF src value) 4))) (TOK_SELEXPR (TOK_FUNCTION min (TOK_FUNCTION substr (TOK_COLREF src value) 4)))))) null
\ No newline at end of file
+(TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 5))) (TOK_SELEXPR (TOK_FUNCTION avg (TOK_FUNCTION substr (TOK_COLREF src value) 5))) (TOK_SELEXPR (TOK_FUNCTIONDI avg (TOK_FUNCTION substr (TOK_COLREF src value) 5))) (TOK_SELEXPR (TOK_FUNCTION max (TOK_FUNCTION substr (TOK_COLREF src value) 5))) (TOK_SELEXPR (TOK_FUNCTION min (TOK_FUNCTION substr (TOK_COLREF src value) 5)))))) null
\ No newline at end of file
diff --git a/ql/src/test/results/compiler/parse/groupby4.q.out b/ql/src/test/results/compiler/parse/groupby4.q.out
index 94bd83ea41..7db163da38 100644
--- a/ql/src/test/results/compiler/parse/groupby4.q.out
+++ b/ql/src/test/results/compiler/parse/groupby4.q.out
@@ -1 +1 @@
-(TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_FUNCTION substr (TOK_COLREF src key) 0 1))) (TOK_GROUPBY (TOK_FUNCTION substr (TOK_COLREF src key) 0 1)))) null
\ No newline at end of file
+(TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_FUNCTION substr (TOK_COLREF src key) 1 1))) (TOK_GROUPBY (TOK_FUNCTION substr (TOK_COLREF src key) 1 1)))) null
\ No newline at end of file
diff --git a/ql/src/test/results/compiler/parse/groupby5.q.out b/ql/src/test/results/compiler/parse/groupby5.q.out
index 261cf76e44..a18f5d5a19 100644
--- a/ql/src/test/results/compiler/parse/groupby5.q.out
+++ b/ql/src/test/results/compiler/parse/groupby5.q.out
@@ -1 +1 @@
-(TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF src key)) (TOK_SELEXPR (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 4)))) (TOK_GROUPBY (TOK_COLREF src key)))) null
\ No newline at end of file
+(TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_COLREF src key)) (TOK_SELEXPR (TOK_FUNCTION sum (TOK_FUNCTION substr (TOK_COLREF src value) 5)))) (TOK_GROUPBY (TOK_COLREF src key)))) null
\ No newline at end of file
diff --git a/ql/src/test/results/compiler/parse/groupby6.q.out b/ql/src/test/results/compiler/parse/groupby6.q.out
index 31e94d100d..28b761dfde 100644
--- a/ql/src/test/results/compiler/parse/groupby6.q.out
+++ b/ql/src/test/results/compiler/parse/groupby6.q.out
@@ -1 +1 @@
-(TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECTDI (TOK_SELEXPR (TOK_FUNCTION substr (TOK_COLREF src value) 4 1))))) null
\ No newline at end of file
+(TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECTDI (TOK_SELEXPR (TOK_FUNCTION substr (TOK_COLREF src value) 5 1))))) null
\ No newline at end of file
diff --git a/ql/src/test/results/compiler/plan/groupby1.q.xml b/ql/src/test/results/compiler/plan/groupby1.q.xml
index e9031aade7..861dcab837 100755
--- a/ql/src/test/results/compiler/plan/groupby1.q.xml
+++ b/ql/src/test/results/compiler/plan/groupby1.q.xml
@@ -486,7 +486,7 @@
                               <class>java.lang.String</class> 
                              </void> 
                              <void index="1"> 
-                              <class>int</class> 
+                              <class>java.lang.Integer</class> 
                              </void> 
                             </array> 
                            </object> 
@@ -513,7 +513,7 @@
                                </object> 
                               </void> 
                               <void property="value"> 
-                               <int>4</int> 
+                               <int>5</int> 
                               </void> 
                              </object> 
                             </void> 
diff --git a/ql/src/test/results/compiler/plan/groupby2.q.xml b/ql/src/test/results/compiler/plan/groupby2.q.xml
index d26597a160..9a570b05ff 100755
--- a/ql/src/test/results/compiler/plan/groupby2.q.xml
+++ b/ql/src/test/results/compiler/plan/groupby2.q.xml
@@ -97,7 +97,7 @@
                   <void property="typeInfo"> 
                    <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
                     <void property="primitiveClass"> 
-                     <class>java.lang.Long</class> 
+                     <class>java.lang.Double</class> 
                     </void> 
                    </object> 
                   </void> 
@@ -111,7 +111,7 @@
                   <void property="typeInfo"> 
                    <object id="PrimitiveTypeInfo2" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
                     <void property="primitiveClass"> 
-                     <class>java.lang.Double</class> 
+                     <class>java.lang.Long</class> 
                     </void> 
                    </object> 
                   </void> 
@@ -138,7 +138,7 @@
                   </void> 
                   <void method="put"> 
                    <string>serialization.ddl</string> 
-                   <string>struct binary_table { i64 reducesinkvalue0, double reducesinkvalue1}</string> 
+                   <string>struct binary_table { double reducesinkvalue0, i64 reducesinkvalue1}</string> 
                   </void> 
                   <void method="put"> 
                    <string>serialization.format</string> 
@@ -182,7 +182,7 @@
                           </void> 
                           <void method="put"> 
                            <string>serialization.ddl</string> 
-                           <string>struct binary_table { string temporarycol0, i64 temporarycol1, double temporarycol2}</string> 
+                           <string>struct binary_table { string temporarycol0, double temporarycol1, i64 temporarycol2}</string> 
                           </void> 
                           <void method="put"> 
                            <string>serialization.format</string> 
@@ -247,30 +247,6 @@
                  <object class="org.apache.hadoop.hive.ql.plan.groupByDesc"> 
                   <void property="aggregators"> 
                    <object class="java.util.ArrayList"> 
-                    <void method="add"> 
-                     <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
-                      <void property="aggregationClass"> 
-                       <class>org.apache.hadoop.hive.ql.udf.UDAFCount</class> 
-                      </void> 
-                      <void property="distinct"> 
-                       <boolean>true</boolean> 
-                      </void> 
-                      <void property="parameters"> 
-                       <object class="java.util.ArrayList"> 
-                        <void method="add"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                          <void property="column"> 
-                           <string>KEY.1</string> 
-                          </void> 
-                          <void property="typeInfo"> 
-                           <object idref="PrimitiveTypeInfo0"/> 
-                          </void> 
-                         </object> 
-                        </void> 
-                       </object> 
-                      </void> 
-                     </object> 
-                    </void> 
                     <void method="add"> 
                      <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
                       <void property="aggregationClass"> 
@@ -308,7 +284,31 @@
                            </object> 
                           </void> 
                           <void property="typeInfo"> 
-                           <object idref="PrimitiveTypeInfo2"/> 
+                           <object idref="PrimitiveTypeInfo1"/> 
+                          </void> 
+                         </object> 
+                        </void> 
+                       </object> 
+                      </void> 
+                     </object> 
+                    </void> 
+                    <void method="add"> 
+                     <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
+                      <void property="aggregationClass"> 
+                       <class>org.apache.hadoop.hive.ql.udf.UDAFCount</class> 
+                      </void> 
+                      <void property="distinct"> 
+                       <boolean>true</boolean> 
+                      </void> 
+                      <void property="parameters"> 
+                       <object class="java.util.ArrayList"> 
+                        <void method="add"> 
+                         <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                          <void property="column"> 
+                           <string>KEY.1</string> 
+                          </void> 
+                          <void property="typeInfo"> 
+                           <object idref="PrimitiveTypeInfo0"/> 
                           </void> 
                          </object> 
                         </void> 
@@ -360,10 +360,10 @@
                               <class>java.lang.String</class> 
                              </void> 
                              <void index="1"> 
-                              <class>int</class> 
+                              <class>java.lang.Integer</class> 
                              </void> 
                              <void index="2"> 
-                              <class>int</class> 
+                              <class>java.lang.Integer</class> 
                              </void> 
                             </array> 
                            </object> 
@@ -390,7 +390,7 @@
                                </object> 
                               </void> 
                               <void property="value"> 
-                               <int>0</int> 
+                               <int>1</int> 
                               </void> 
                              </object> 
                             </void> 
@@ -424,7 +424,7 @@
                               <class>java.lang.String</class> 
                              </void> 
                              <void index="1"> 
-                              <class>int</class> 
+                              <class>java.lang.Integer</class> 
                              </void> 
                             </array> 
                            </object> 
@@ -447,7 +447,7 @@
                                <object idref="PrimitiveTypeInfo3"/> 
                               </void> 
                               <void property="value"> 
-                               <int>4</int> 
+                               <int>5</int> 
                               </void> 
                              </object> 
                             </void> 
@@ -759,7 +759,7 @@
                          <string>1</string> 
                         </void> 
                         <void property="type"> 
-                         <object idref="PrimitiveTypeInfo1"/> 
+                         <object idref="PrimitiveTypeInfo2"/> 
                         </void> 
                        </object> 
                       </void> 
@@ -798,10 +798,10 @@
                   <void method="add"> 
                    <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
                     <void property="column"> 
-                     <string>1</string> 
+                     <string>2</string> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo1"/> 
+                     <object idref="PrimitiveTypeInfo2"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -855,10 +855,10 @@
                           <void method="add"> 
                            <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
                             <void property="column"> 
-                             <string>2</string> 
+                             <string>1</string> 
                             </void> 
                             <void property="typeInfo"> 
-                             <object idref="PrimitiveTypeInfo2"/> 
+                             <object idref="PrimitiveTypeInfo1"/> 
                             </void> 
                            </object> 
                           </void> 
@@ -905,7 +905,7 @@
               <void method="add"> 
                <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
                 <void property="aggregationClass"> 
-                 <class>org.apache.hadoop.hive.ql.udf.UDAFCount</class> 
+                 <class>org.apache.hadoop.hive.ql.udf.UDAFSum</class> 
                 </void> 
                 <void property="parameters"> 
                  <object class="java.util.ArrayList"> 
@@ -926,7 +926,7 @@
               <void method="add"> 
                <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
                 <void property="aggregationClass"> 
-                 <class>org.apache.hadoop.hive.ql.udf.UDAFSum</class> 
+                 <class>org.apache.hadoop.hive.ql.udf.UDAFCount</class> 
                 </void> 
                 <void property="parameters"> 
                  <object class="java.util.ArrayList"> 
diff --git a/ql/src/test/results/compiler/plan/groupby3.q.xml b/ql/src/test/results/compiler/plan/groupby3.q.xml
index 433779b85b..fe0f1105f8 100644
--- a/ql/src/test/results/compiler/plan/groupby3.q.xml
+++ b/ql/src/test/results/compiler/plan/groupby3.q.xml
@@ -20,7 +20,7 @@
         <void property="aliasToWork"> 
          <object class="java.util.HashMap"> 
           <void method="put"> 
-           <string>/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/tmp/39762029/165173809.10002</string> 
+           <string>/data/users/athusoo/commits/hive_trunk_ws3/build/ql/tmp/221218874/81025690.10002</string> 
            <object id="ReduceSinkOperator0" class="org.apache.hadoop.hive.ql.exec.ReduceSinkOperator"> 
             <void property="conf"> 
              <object class="org.apache.hadoop.hive.ql.plan.reduceSinkDesc"> 
@@ -82,7 +82,7 @@
                   <void property="typeInfo"> 
                    <object id="PrimitiveTypeInfo0" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
                     <void property="primitiveClass"> 
-                     <class>java.lang.String</class> 
+                     <class>java.lang.Double</class> 
                     </void> 
                    </object> 
                   </void> 
@@ -96,7 +96,7 @@
                   <void property="typeInfo"> 
                    <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
                     <void property="primitiveClass"> 
-                     <class>java.lang.Double</class> 
+                     <class>java.lang.String</class> 
                     </void> 
                    </object> 
                   </void> 
@@ -108,7 +108,7 @@
                    <string>2</string> 
                   </void> 
                   <void property="typeInfo"> 
-                   <object idref="PrimitiveTypeInfo0"/> 
+                   <object idref="PrimitiveTypeInfo1"/> 
                   </void> 
                  </object> 
                 </void> 
@@ -118,7 +118,7 @@
                    <string>3</string> 
                   </void> 
                   <void property="typeInfo"> 
-                   <object idref="PrimitiveTypeInfo0"/> 
+                   <object idref="PrimitiveTypeInfo1"/> 
                   </void> 
                  </object> 
                 </void> 
@@ -128,7 +128,7 @@
                    <string>4</string> 
                   </void> 
                   <void property="typeInfo"> 
-                   <object idref="PrimitiveTypeInfo0"/> 
+                   <object idref="PrimitiveTypeInfo1"/> 
                   </void> 
                  </object> 
                 </void> 
@@ -153,7 +153,7 @@
                   </void> 
                   <void method="put"> 
                    <string>serialization.ddl</string> 
-                   <string>struct binary_table { string reducesinkvalue0, double reducesinkvalue1, string reducesinkvalue2, string reducesinkvalue3, string reducesinkvalue4}</string> 
+                   <string>struct binary_table { double reducesinkvalue0, string reducesinkvalue1, string reducesinkvalue2, string reducesinkvalue3, string reducesinkvalue4}</string> 
                   </void> 
                   <void method="put"> 
                    <string>serialization.format</string> 
@@ -176,7 +176,7 @@
                     <void property="conf"> 
                      <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                       <void property="dirName"> 
-                       <string>/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/tmp/39762029/165173809.10002</string> 
+                       <string>/data/users/athusoo/commits/hive_trunk_ws3/build/ql/tmp/221218874/81025690.10002</string> 
                       </void> 
                       <void property="tableInfo"> 
                        <object id="tableDesc2" class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -197,7 +197,7 @@
                           </void> 
                           <void method="put"> 
                            <string>serialization.ddl</string> 
-                           <string>struct binary_table { string temporarycol0, double temporarycol1, string temporarycol2, string temporarycol3, string temporarycol4}</string> 
+                           <string>struct binary_table { double temporarycol0, string temporarycol1, string temporarycol2, string temporarycol3, string temporarycol4}</string> 
                           </void> 
                           <void method="put"> 
                            <string>serialization.format</string> 
@@ -246,7 +246,7 @@
                            <string>2</string> 
                           </void> 
                           <void property="type"> 
-                           <object idref="PrimitiveTypeInfo0"/> 
+                           <object idref="PrimitiveTypeInfo1"/> 
                           </void> 
                          </object> 
                         </void> 
@@ -256,7 +256,7 @@
                            <string>3</string> 
                           </void> 
                           <void property="type"> 
-                           <object idref="PrimitiveTypeInfo0"/> 
+                           <object idref="PrimitiveTypeInfo1"/> 
                           </void> 
                          </object> 
                         </void> 
@@ -266,7 +266,7 @@
                            <string>4</string> 
                           </void> 
                           <void property="type"> 
-                           <object idref="PrimitiveTypeInfo0"/> 
+                           <object idref="PrimitiveTypeInfo1"/> 
                           </void> 
                          </object> 
                         </void> 
@@ -285,10 +285,7 @@
                     <void method="add"> 
                      <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
                       <void property="aggregationClass"> 
-                       <class>org.apache.hadoop.hive.ql.udf.UDAFAvg</class> 
-                      </void> 
-                      <void property="distinct"> 
-                       <boolean>true</boolean> 
+                       <class>org.apache.hadoop.hive.ql.udf.UDAFSum</class> 
                       </void> 
                       <void property="parameters"> 
                        <object class="java.util.ArrayList"> 
@@ -315,14 +312,14 @@
                                <string>KEY.0</string> 
                               </void> 
                               <void property="typeInfo"> 
-                               <object idref="PrimitiveTypeInfo0"/> 
+                               <object idref="PrimitiveTypeInfo1"/> 
                               </void> 
                              </object> 
                             </void> 
                            </object> 
                           </void> 
                           <void property="typeInfo"> 
-                           <object idref="PrimitiveTypeInfo1"/> 
+                           <object idref="PrimitiveTypeInfo0"/> 
                           </void> 
                          </object> 
                         </void> 
@@ -333,38 +330,14 @@
                     <void method="add"> 
                      <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
                       <void property="aggregationClass"> 
-                       <class>org.apache.hadoop.hive.ql.udf.UDAFSum</class> 
+                       <class>org.apache.hadoop.hive.ql.udf.UDAFMax$MaxStringEvaluator</class> 
                       </void> 
                       <void property="parameters"> 
                        <object class="java.util.ArrayList"> 
                         <void method="add"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
-                          <void property="UDFClass"> 
-                           <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
-                          </void> 
-                          <void property="UDFMethod"> 
-                           <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
-                            <string>evaluate</string> 
-                            <array class="java.lang.Class" length="1"> 
-                             <void index="0"> 
-                              <class>java.lang.String</class> 
-                             </void> 
-                            </array> 
-                           </object> 
-                          </void> 
-                          <void property="children"> 
-                           <object class="java.util.ArrayList"> 
-                            <void method="add"> 
-                             <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                              <void property="column"> 
-                               <string>KEY.0</string> 
-                              </void> 
-                              <void property="typeInfo"> 
-                               <object idref="PrimitiveTypeInfo0"/> 
-                              </void> 
-                             </object> 
-                            </void> 
-                           </object> 
+                         <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                          <void property="column"> 
+                           <string>KEY.0</string> 
                           </void> 
                           <void property="typeInfo"> 
                            <object idref="PrimitiveTypeInfo1"/> 
@@ -380,6 +353,9 @@
                       <void property="aggregationClass"> 
                        <class>org.apache.hadoop.hive.ql.udf.UDAFAvg</class> 
                       </void> 
+                      <void property="distinct"> 
+                       <boolean>true</boolean> 
+                      </void> 
                       <void property="parameters"> 
                        <object class="java.util.ArrayList"> 
                         <void method="add"> 
@@ -405,14 +381,14 @@
                                <string>KEY.0</string> 
                               </void> 
                               <void property="typeInfo"> 
-                               <object idref="PrimitiveTypeInfo0"/> 
+                               <object idref="PrimitiveTypeInfo1"/> 
                               </void> 
                              </object> 
                             </void> 
                            </object> 
                           </void> 
                           <void property="typeInfo"> 
-                           <object idref="PrimitiveTypeInfo1"/> 
+                           <object idref="PrimitiveTypeInfo0"/> 
                           </void> 
                          </object> 
                         </void> 
@@ -433,7 +409,7 @@
                            <string>KEY.0</string> 
                           </void> 
                           <void property="typeInfo"> 
-                           <object idref="PrimitiveTypeInfo0"/> 
+                           <object idref="PrimitiveTypeInfo1"/> 
                           </void> 
                          </object> 
                         </void> 
@@ -444,14 +420,38 @@
                     <void method="add"> 
                      <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
                       <void property="aggregationClass"> 
-                       <class>org.apache.hadoop.hive.ql.udf.UDAFMax$MaxStringEvaluator</class> 
+                       <class>org.apache.hadoop.hive.ql.udf.UDAFAvg</class> 
                       </void> 
                       <void property="parameters"> 
                        <object class="java.util.ArrayList"> 
                         <void method="add"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                          <void property="column"> 
-                           <string>KEY.0</string> 
+                         <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                          <void property="UDFClass"> 
+                           <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                          </void> 
+                          <void property="UDFMethod"> 
+                           <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                            <string>evaluate</string> 
+                            <array class="java.lang.Class" length="1"> 
+                             <void index="0"> 
+                              <class>java.lang.String</class> 
+                             </void> 
+                            </array> 
+                           </object> 
+                          </void> 
+                          <void property="children"> 
+                           <object class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                              <void property="column"> 
+                               <string>KEY.0</string> 
+                              </void> 
+                              <void property="typeInfo"> 
+                               <object idref="PrimitiveTypeInfo1"/> 
+                              </void> 
+                             </object> 
+                            </void> 
+                           </object> 
                           </void> 
                           <void property="typeInfo"> 
                            <object idref="PrimitiveTypeInfo0"/> 
@@ -495,7 +495,7 @@
                               <class>java.lang.String</class> 
                              </void> 
                              <void index="1"> 
-                              <class>int</class> 
+                              <class>java.lang.Integer</class> 
                              </void> 
                             </array> 
                            </object> 
@@ -508,7 +508,7 @@
                                <string>0</string> 
                               </void> 
                               <void property="typeInfo"> 
-                               <object idref="PrimitiveTypeInfo0"/> 
+                               <object idref="PrimitiveTypeInfo1"/> 
                               </void> 
                              </object> 
                             </void> 
@@ -522,14 +522,14 @@
                                </object> 
                               </void> 
                               <void property="value"> 
-                               <int>4</int> 
+                               <int>5</int> 
                               </void> 
                              </object> 
                             </void> 
                            </object> 
                           </void> 
                           <void property="typeInfo"> 
-                           <object idref="PrimitiveTypeInfo0"/> 
+                           <object idref="PrimitiveTypeInfo1"/> 
                           </void> 
                          </object> 
                         </void> 
@@ -632,7 +632,7 @@
                                <string>value</string> 
                               </void> 
                               <void property="typeInfo"> 
-                               <object idref="PrimitiveTypeInfo0"/> 
+                               <object idref="PrimitiveTypeInfo1"/> 
                               </void> 
                              </object> 
                             </void> 
@@ -661,7 +661,7 @@
                                    <string>key</string> 
                                   </void> 
                                   <void property="type"> 
-                                   <object idref="PrimitiveTypeInfo0"/> 
+                                   <object idref="PrimitiveTypeInfo1"/> 
                                   </void> 
                                  </object> 
                                 </void> 
@@ -671,7 +671,7 @@
                                    <string>value</string> 
                                   </void> 
                                   <void property="type"> 
-                                   <object idref="PrimitiveTypeInfo0"/> 
+                                   <object idref="PrimitiveTypeInfo1"/> 
                                   </void> 
                                  </object> 
                                 </void> 
@@ -693,7 +693,7 @@
                                <string>0</string> 
                               </void> 
                               <void property="type"> 
-                               <object idref="PrimitiveTypeInfo0"/> 
+                               <object idref="PrimitiveTypeInfo1"/> 
                               </void> 
                              </object> 
                             </void> 
@@ -715,7 +715,7 @@
                            <string>KEY.0</string> 
                           </void> 
                           <void property="type"> 
-                           <object idref="PrimitiveTypeInfo0"/> 
+                           <object idref="PrimitiveTypeInfo1"/> 
                           </void> 
                          </object> 
                         </void> 
@@ -764,7 +764,7 @@
                    <string>VALUE.2</string> 
                   </void> 
                   <void property="type"> 
-                   <object idref="PrimitiveTypeInfo0"/> 
+                   <object idref="PrimitiveTypeInfo1"/> 
                   </void> 
                  </object> 
                 </void> 
@@ -774,7 +774,7 @@
                    <string>VALUE.3</string> 
                   </void> 
                   <void property="type"> 
-                   <object idref="PrimitiveTypeInfo0"/> 
+                   <object idref="PrimitiveTypeInfo1"/> 
                   </void> 
                  </object> 
                 </void> 
@@ -784,7 +784,7 @@
                    <string>VALUE.4</string> 
                   </void> 
                   <void property="type"> 
-                   <object idref="PrimitiveTypeInfo0"/> 
+                   <object idref="PrimitiveTypeInfo1"/> 
                   </void> 
                  </object> 
                 </void> 
@@ -805,10 +805,10 @@
         <void property="pathToAliases"> 
          <object class="java.util.LinkedHashMap"> 
           <void method="put"> 
-           <string>/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/tmp/39762029/165173809.10002</string> 
+           <string>/data/users/athusoo/commits/hive_trunk_ws3/build/ql/tmp/221218874/81025690.10002</string> 
            <object class="java.util.ArrayList"> 
             <void method="add"> 
-             <string>/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/tmp/39762029/165173809.10002</string> 
+             <string>/data/users/athusoo/commits/hive_trunk_ws3/build/ql/tmp/221218874/81025690.10002</string> 
             </void> 
            </object> 
           </void> 
@@ -817,7 +817,7 @@
         <void property="pathToPartitionInfo"> 
          <object class="java.util.LinkedHashMap"> 
           <void method="put"> 
-           <string>/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/tmp/39762029/165173809.10002</string> 
+           <string>/data/users/athusoo/commits/hive_trunk_ws3/build/ql/tmp/221218874/81025690.10002</string> 
            <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
             <void property="tableDesc"> 
              <object idref="tableDesc2"/> 
@@ -839,7 +839,7 @@
                   <void property="conf"> 
                    <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                     <void property="dirName"> 
-                     <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/579206814.10001.insclause-0</string> 
+                     <string>/data/users/athusoo/commits/hive_trunk_ws3/ql/../build/ql/tmp/482395674.10001.insclause-0</string> 
                     </void> 
                     <void property="tableInfo"> 
                      <object class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -885,7 +885,7 @@
                          <string>0</string> 
                         </void> 
                         <void property="type"> 
-                         <object idref="PrimitiveTypeInfo1"/> 
+                         <object idref="PrimitiveTypeInfo0"/> 
                         </void> 
                        </object> 
                       </void> 
@@ -895,7 +895,7 @@
                          <string>1</string> 
                         </void> 
                         <void property="type"> 
-                         <object idref="PrimitiveTypeInfo1"/> 
+                         <object idref="PrimitiveTypeInfo0"/> 
                         </void> 
                        </object> 
                       </void> 
@@ -905,7 +905,7 @@
                          <string>2</string> 
                         </void> 
                         <void property="type"> 
-                         <object idref="PrimitiveTypeInfo1"/> 
+                         <object idref="PrimitiveTypeInfo0"/> 
                         </void> 
                        </object> 
                       </void> 
@@ -915,7 +915,7 @@
                          <string>3</string> 
                         </void> 
                         <void property="type"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
@@ -925,7 +925,7 @@
                          <string>4</string> 
                         </void> 
                         <void property="type"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
@@ -944,40 +944,40 @@
                   <void method="add"> 
                    <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
                     <void property="column"> 
-                     <string>1</string> 
+                     <string>0</string> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo1"/> 
+                     <object idref="PrimitiveTypeInfo0"/> 
                     </void> 
                    </object> 
                   </void> 
                   <void method="add"> 
                    <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
                     <void property="column"> 
-                     <string>2</string> 
+                     <string>4</string> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo1"/> 
+                     <object idref="PrimitiveTypeInfo0"/> 
                     </void> 
                    </object> 
                   </void> 
                   <void method="add"> 
                    <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
                     <void property="column"> 
-                     <string>0</string> 
+                     <string>2</string> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo1"/> 
+                     <object idref="PrimitiveTypeInfo0"/> 
                     </void> 
                    </object> 
                   </void> 
                   <void method="add"> 
                    <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
                     <void property="column"> 
-                     <string>4</string> 
+                     <string>1</string> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo0"/> 
+                     <object idref="PrimitiveTypeInfo1"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -987,7 +987,7 @@
                      <string>3</string> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo0"/> 
+                     <object idref="PrimitiveTypeInfo1"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -1020,41 +1020,17 @@
               <void method="add"> 
                <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
                 <void property="aggregationClass"> 
-                 <class>org.apache.hadoop.hive.ql.udf.UDAFAvg</class> 
+                 <class>org.apache.hadoop.hive.ql.udf.UDAFSum</class> 
                 </void> 
                 <void property="parameters"> 
                  <object class="java.util.ArrayList"> 
                   <void method="add"> 
-                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
-                    <void property="UDFClass"> 
-                     <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
-                    </void> 
-                    <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
-                      <string>evaluate</string> 
-                      <array class="java.lang.Class" length="1"> 
-                       <void index="0"> 
-                        <class>java.lang.String</class> 
-                       </void> 
-                      </array> 
-                     </object> 
-                    </void> 
-                    <void property="children"> 
-                     <object class="java.util.ArrayList"> 
-                      <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>VALUE.0</string> 
-                        </void> 
-                        <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
-                        </void> 
-                       </object> 
-                      </void> 
-                     </object> 
+                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                    <void property="column"> 
+                     <string>VALUE.0</string> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo1"/> 
+                     <object idref="PrimitiveTypeInfo0"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -1065,7 +1041,7 @@
               <void method="add"> 
                <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
                 <void property="aggregationClass"> 
-                 <class>org.apache.hadoop.hive.ql.udf.UDAFSum</class> 
+                 <class>org.apache.hadoop.hive.ql.udf.UDAFMax$MaxStringEvaluator</class> 
                 </void> 
                 <void property="parameters"> 
                  <object class="java.util.ArrayList"> 
@@ -1113,14 +1089,14 @@
                          <string>VALUE.2</string> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo1"/> 
+                     <object idref="PrimitiveTypeInfo0"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -1141,7 +1117,7 @@
                      <string>VALUE.3</string> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo0"/> 
+                     <object idref="PrimitiveTypeInfo1"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -1152,14 +1128,38 @@
               <void method="add"> 
                <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
                 <void property="aggregationClass"> 
-                 <class>org.apache.hadoop.hive.ql.udf.UDAFMax$MaxStringEvaluator</class> 
+                 <class>org.apache.hadoop.hive.ql.udf.UDAFAvg</class> 
                 </void> 
                 <void property="parameters"> 
                  <object class="java.util.ArrayList"> 
                   <void method="add"> 
-                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                    <void property="column"> 
-                     <string>VALUE.4</string> 
+                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                    <void property="UDFClass"> 
+                     <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                    </void> 
+                    <void property="UDFMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                      <string>evaluate</string> 
+                      <array class="java.lang.Class" length="1"> 
+                       <void index="0"> 
+                        <class>java.lang.String</class> 
+                       </void> 
+                      </array> 
+                     </object> 
+                    </void> 
+                    <void property="children"> 
+                     <object class="java.util.ArrayList"> 
+                      <void method="add"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                        <void property="column"> 
+                         <string>VALUE.4</string> 
+                        </void> 
+                        <void property="typeInfo"> 
+                         <object idref="PrimitiveTypeInfo1"/> 
+                        </void> 
+                       </object> 
+                      </void> 
+                     </object> 
                     </void> 
                     <void property="typeInfo"> 
                      <object idref="PrimitiveTypeInfo0"/> 
@@ -1199,7 +1199,7 @@
                  <string>0</string> 
                 </void> 
                 <void property="type"> 
-                 <object idref="PrimitiveTypeInfo1"/> 
+                 <object idref="PrimitiveTypeInfo0"/> 
                 </void> 
                </object> 
               </void> 
@@ -1219,7 +1219,7 @@
                  <string>2</string> 
                 </void> 
                 <void property="type"> 
-                 <object idref="PrimitiveTypeInfo1"/> 
+                 <object idref="PrimitiveTypeInfo0"/> 
                 </void> 
                </object> 
               </void> 
@@ -1229,7 +1229,7 @@
                  <string>3</string> 
                 </void> 
                 <void property="type"> 
-                 <object idref="PrimitiveTypeInfo0"/> 
+                 <object idref="PrimitiveTypeInfo1"/> 
                 </void> 
                </object> 
               </void> 
@@ -1281,7 +1281,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/commits/hive_trunk_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>src</string> 
@@ -1293,7 +1293,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/commits/hive_trunk_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -1345,7 +1345,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/athusoo/commits/hive_trunk_ws3/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
diff --git a/ql/src/test/results/compiler/plan/groupby4.q.xml b/ql/src/test/results/compiler/plan/groupby4.q.xml
index 0658907e88..fb88b77b77 100644
--- a/ql/src/test/results/compiler/plan/groupby4.q.xml
+++ b/ql/src/test/results/compiler/plan/groupby4.q.xml
@@ -241,10 +241,10 @@
                               <class>java.lang.String</class> 
                              </void> 
                              <void index="1"> 
-                              <class>int</class> 
+                              <class>java.lang.Integer</class> 
                              </void> 
                              <void index="2"> 
-                              <class>int</class> 
+                              <class>java.lang.Integer</class> 
                              </void> 
                             </array> 
                            </object> 
@@ -271,7 +271,7 @@
                                </object> 
                               </void> 
                               <void property="value"> 
-                               <int>0</int> 
+                               <int>1</int> 
                               </void> 
                              </object> 
                             </void> 
diff --git a/ql/src/test/results/compiler/plan/groupby5.q.xml b/ql/src/test/results/compiler/plan/groupby5.q.xml
index f935385d95..2798706ab8 100644
--- a/ql/src/test/results/compiler/plan/groupby5.q.xml
+++ b/ql/src/test/results/compiler/plan/groupby5.q.xml
@@ -388,7 +388,7 @@
                               <class>java.lang.String</class> 
                              </void> 
                              <void index="1"> 
-                              <class>int</class> 
+                              <class>java.lang.Integer</class> 
                              </void> 
                             </array> 
                            </object> 
@@ -415,7 +415,7 @@
                                </object> 
                               </void> 
                               <void property="value"> 
-                               <int>4</int> 
+                               <int>5</int> 
                               </void> 
                              </object> 
                             </void> 
diff --git a/ql/src/test/results/compiler/plan/groupby6.q.xml b/ql/src/test/results/compiler/plan/groupby6.q.xml
index 11b0f764e3..971643c72d 100644
--- a/ql/src/test/results/compiler/plan/groupby6.q.xml
+++ b/ql/src/test/results/compiler/plan/groupby6.q.xml
@@ -241,10 +241,10 @@
                               <class>java.lang.String</class> 
                              </void> 
                              <void index="1"> 
-                              <class>int</class> 
+                              <class>java.lang.Integer</class> 
                              </void> 
                              <void index="2"> 
-                              <class>int</class> 
+                              <class>java.lang.Integer</class> 
                              </void> 
                             </array> 
                            </object> 
@@ -271,7 +271,7 @@
                                </object> 
                               </void> 
                               <void property="value"> 
-                               <int>4</int> 
+                               <int>5</int> 
                               </void> 
                              </object> 
                             </void> 
