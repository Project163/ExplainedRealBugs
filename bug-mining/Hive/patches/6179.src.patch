diff --git a/standalone-metastore/src/main/java/org/apache/hadoop/hive/metastore/ObjectStore.java b/standalone-metastore/src/main/java/org/apache/hadoop/hive/metastore/ObjectStore.java
index d58ed677f3..edabaa15ff 100644
--- a/standalone-metastore/src/main/java/org/apache/hadoop/hive/metastore/ObjectStore.java
+++ b/standalone-metastore/src/main/java/org/apache/hadoop/hive/metastore/ObjectStore.java
@@ -3941,13 +3941,13 @@ private void removeUnusedColumnDescriptor(MColumnDescriptor oldCD) {
     }
 
     boolean success = false;
-    QueryWrapper queryWrapper = new QueryWrapper();
+    Query query = null;
 
     try {
       openTransaction();
       LOG.debug("execute removeUnusedColumnDescriptor");
 
-      Query query = pm.newQuery("select count(1) from " +
+      query = pm.newQuery("select count(1) from " +
         "org.apache.hadoop.hive.metastore.model.MStorageDescriptor where (this.cd == inCD)");
       query.declareParameters("MColumnDescriptor inCD");
       long count = ((Long)query.execute(oldCD)).longValue();
@@ -3960,7 +3960,7 @@ private void removeUnusedColumnDescriptor(MColumnDescriptor oldCD) {
       success = commitTransaction();
       LOG.debug("successfully deleted a CD in removeUnusedColumnDescriptor");
     } finally {
-      rollbackAndCleanup(success, queryWrapper);
+      rollbackAndCleanup(success, query);
     }
   }
 
@@ -8819,14 +8819,13 @@ private MFunction getMFunction(String db, String function) {
   public Function getFunction(String dbName, String funcName) throws MetaException {
     boolean commited = false;
     Function func = null;
+    Query query = null;
     try {
       openTransaction();
       func = convertToFunction(getMFunction(dbName, funcName));
       commited = commitTransaction();
     } finally {
-      if (!commited) {
-        rollbackTransaction();
-      }
+      rollbackAndCleanup(commited, query);
     }
     return func;
   }
@@ -8834,17 +8833,16 @@ public Function getFunction(String dbName, String funcName) throws MetaException
   @Override
   public List<Function> getAllFunctions() throws MetaException {
     boolean commited = false;
+    Query query = null;
     try {
       openTransaction();
-      Query query = pm.newQuery(MFunction.class);
+      query = pm.newQuery(MFunction.class);
       List<MFunction> allFunctions = (List<MFunction>) query.execute();
       pm.retrieveAll(allFunctions);
       commited = commitTransaction();
       return convertToFunctions(allFunctions);
     } finally {
-      if (!commited) {
-        rollbackTransaction();
-      }
+      rollbackAndCleanup(commited, query);
     }
   }
 
@@ -8905,10 +8903,7 @@ public NotificationEventResponse getNextNotification(NotificationEventRequest rq
       }
       return result;
     } finally {
-      if (!commited) {
-        rollbackAndCleanup(commited, query);
-        return null;
-      }
+      rollbackAndCleanup(commited, query);
     }
   }
 
@@ -8938,6 +8933,7 @@ private void lockForUpdate() throws MetaException {
       query.setUnique(true);
       // only need to execute it to get db Lock
       query.execute();
+      query.closeAll();
     }).run();
   }
 
@@ -9003,8 +8999,8 @@ public void addNotificationEvent(NotificationEvent entry) {
     try {
       openTransaction();
       lockForUpdate();
-      Query objectQuery = pm.newQuery(MNotificationNextId.class);
-      Collection<MNotificationNextId> ids = (Collection) objectQuery.execute();
+      query = pm.newQuery(MNotificationNextId.class);
+      Collection<MNotificationNextId> ids = (Collection) query.execute();
       MNotificationNextId mNotificationNextId = null;
       boolean needToPersistId;
       if (CollectionUtils.isEmpty(ids)) {
@@ -9533,12 +9529,7 @@ private List<SQLUniqueConstraint> getUniqueConstraintsViaJdo(String db_name, Str
       }
       commited = commitTransaction();
     } finally {
-      if (!commited) {
-        rollbackTransaction();
-      }
-      if (query != null) {
-        query.closeAll();
-      }
+      rollbackAndCleanup(commited, query);
     }
     return uniqueConstraints;
   }
@@ -9603,12 +9594,7 @@ private List<SQLNotNullConstraint> getNotNullConstraintsViaJdo(String db_name, S
       }
       commited = commitTransaction();
     } finally {
-      if (!commited) {
-        rollbackTransaction();
-      }
-      if (query != null) {
-        query.closeAll();
-      }
+      rollbackAndCleanup(commited, query);
     }
     return notNullConstraints;
   }
diff --git a/standalone-metastore/src/test/java/org/apache/hadoop/hive/metastore/TestObjectStore.java b/standalone-metastore/src/test/java/org/apache/hadoop/hive/metastore/TestObjectStore.java
index 372dee6369..ee5b3e0716 100644
--- a/standalone-metastore/src/test/java/org/apache/hadoop/hive/metastore/TestObjectStore.java
+++ b/standalone-metastore/src/test/java/org/apache/hadoop/hive/metastore/TestObjectStore.java
@@ -442,7 +442,7 @@ public void testQueryCloseOnError() throws Exception {
     spy.getAllFunctions();
     spy.getAllTables(DB1);
     spy.getPartitionCount();
-    Mockito.verify(spy, Mockito.times(2))
+    Mockito.verify(spy, Mockito.times(3))
         .rollbackAndCleanup(Mockito.anyBoolean(), Mockito.<Query>anyObject());
   }
 
