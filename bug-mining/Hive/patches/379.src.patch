diff --git a/CHANGES.txt b/CHANGES.txt
index 220bf32001..7b37aada83 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -372,6 +372,9 @@ Trunk -  Unreleased
     HIVE-1308. Bug in boolean datatypes comparison
     (Paul Yang via namit)
 
+    HIVE-1312. hive trunk does not compile with 0.17 any more
+    (John Sichi via Ning Zhang)
+
 Release 0.5.0 -  Unreleased
 
   INCOMPATIBLE CHANGES
diff --git a/ql/build.xml b/ql/build.xml
index 8f4a1f3d05..ab832d72cd 100644
--- a/ql/build.xml
+++ b/ql/build.xml
@@ -48,7 +48,6 @@
     <pathelement location="${common.jar}"/>
     <fileset dir="${hive.root}" includes="testlibs/*.jar"/>
     <fileset dir="${hadoop.root}/lib" includes="*.jar"/>
-    <fileset dir="${hadoop.root}/lib/jsp-2.1" includes="*.jar"/>
     <path refid="classpath"/>
   </path>
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/io/HiveNullValueSequenceFileOutputFormat.java b/ql/src/java/org/apache/hadoop/hive/ql/io/HiveNullValueSequenceFileOutputFormat.java
index e3a57c20c2..ec2676dc75 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/io/HiveNullValueSequenceFileOutputFormat.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/io/HiveNullValueSequenceFileOutputFormat.java
@@ -66,7 +66,10 @@ public void write(Writable r) throws IOException {
           keyWritable.set(text.getBytes(), 0, text.getLength());
         } else {
           BytesWritable bw = (BytesWritable) r;
-          keyWritable.set(bw.getBytes(), 0, bw.getLength());
+          // Once we drop support for old Hadoop versions, change these
+          // to getBytes() and getLength() to fix the deprecation warnings.
+          // Not worth a shim.
+          keyWritable.set(bw.get(), 0, bw.getSize());
         }
         keyWritable.setHashCode(r.hashCode());
         outStream.append(keyWritable, NULL_WRITABLE);
