diff --git a/CHANGES.txt b/CHANGES.txt
index c168de551a..14277f2b0e 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -228,3 +228,7 @@ Trunk (unreleased changes)
 
     HIVE-242. Fix to allow CLI to interpret line breaks in any CLI
     command (Prasad Chakka via athusoo)
+
+    HIVE-65. Rewrite typechecking to use the walker interface and add
+    Resolvers to UDF and UDAF to support proper implicit casting
+    in a manner similar to other RDBMSs (athusoo)
diff --git a/build-common.xml b/build-common.xml
index 3ef83ee7b3..e2caae3990 100644
--- a/build-common.xml
+++ b/build-common.xml
@@ -241,6 +241,7 @@
       <jvmarg value="-Xdebug"/>
       <jvmarg value="-Xrunjdwp:transport=dt_socket,address=8000,server=y,suspend=y"/> -->
       <env key="HADOOP_HOME" value="${hadoop.root}"/>
+      <env key="TZ" value="US/Pacific"/>
       <sysproperty key="test.output.overwrite" value="${overwrite}"/>
       <sysproperty key="test.service.standalone.server" value="${standalone}"/>
       <sysproperty key="log4j.configuration" value="file://${test.data.dir}/conf/hive-log4j.properties"/>
diff --git a/eclipse-templates/TestMTQueries.launchtemplate b/eclipse-templates/TestMTQueries.launchtemplate
new file mode 100644
index 0000000000..2095f28a6a
--- /dev/null
+++ b/eclipse-templates/TestMTQueries.launchtemplate
@@ -0,0 +1,23 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<launchConfiguration type="org.eclipse.jdt.junit.launchconfig">
+<mapAttribute key="org.eclipse.debug.core.environmentVariables">
+<mapEntry key="HADOOP_HOME" value="${workspace_loc:@PROJECT@}/build/hadoopcore/hadoop-@HADOOPVER@"/>
+</mapAttribute>
+<stringAttribute key="org.eclipse.jdt.junit.CONTAINER" value=""/>
+<booleanAttribute key="org.eclipse.jdt.junit.KEEPRUNNING_ATTR" value="false"/>
+<stringAttribute key="org.eclipse.jdt.junit.TESTNAME" value=""/>
+<stringAttribute key="org.eclipse.jdt.junit.TEST_KIND" value="org.eclipse.jdt.junit.loader.junit3"/>
+<listAttribute key="org.eclipse.jdt.launching.CLASSPATH">
+<listEntry value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;runtimeClasspathEntry containerPath=&quot;org.eclipse.jdt.launching.JRE_CONTAINER&quot; javaProject=&quot;@PROJECT@&quot; path=&quot;1&quot; type=&quot;4&quot;/&gt;&#10;"/>
+<listEntry value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;runtimeClasspathEntry internalArchive=&quot;/@PROJECT@/build/metastore/metastore_model.jar&quot; path=&quot;3&quot; type=&quot;2&quot;/&gt;&#10;"/>
+<listEntry value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;runtimeClasspathEntry internalArchive=&quot;/@PROJECT@/metastore/src/model&quot; path=&quot;3&quot; type=&quot;2&quot;/&gt;&#10;"/>
+<listEntry value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;runtimeClasspathEntry internalArchive=&quot;/@PROJECT@/build/hadoopcore/hadoop-@HADOOPVER@/conf&quot; path=&quot;3&quot; type=&quot;2&quot;/&gt;&#10;"/>
+<listEntry value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;runtimeClasspathEntry internalArchive=&quot;/@PROJECT@/data/conf&quot; path=&quot;3&quot; type=&quot;2&quot;/&gt;&#10;"/>
+<listEntry value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;runtimeClasspathEntry id=&quot;org.eclipse.jdt.launching.classpathentry.defaultClasspath&quot;&gt;&#10;&lt;memento exportedEntriesOnly=&quot;false&quot; project=&quot;@PROJECT@&quot;/&gt;&#10;&lt;/runtimeClasspathEntry&gt;&#10;"/>
+<listEntry value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;runtimeClasspathEntry internalArchive=&quot;/@PROJECT@/conf&quot; path=&quot;3&quot; type=&quot;2&quot;/&gt;&#10;"/>
+</listAttribute>
+<booleanAttribute key="org.eclipse.jdt.launching.DEFAULT_CLASSPATH" value="false"/>
+<stringAttribute key="org.eclipse.jdt.launching.MAIN_TYPE" value="org.apache.hadoop.hive.ql.TestMTQueries"/>
+<stringAttribute key="org.eclipse.jdt.launching.PROJECT_ATTR" value="@PROJECT@"/>
+<stringAttribute key="org.eclipse.jdt.launching.WORKING_DIRECTORY" value="${workspace_loc:@PROJECT@}/ql"/>
+</launchConfiguration>
diff --git a/eclipse-templates/TestTruncate.launchtemplate b/eclipse-templates/TestTruncate.launchtemplate
new file mode 100644
index 0000000000..d1c54531f8
--- /dev/null
+++ b/eclipse-templates/TestTruncate.launchtemplate
@@ -0,0 +1,23 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<launchConfiguration type="org.eclipse.jdt.junit.launchconfig">
+<mapAttribute key="org.eclipse.debug.core.environmentVariables">
+<mapEntry key="HADOOP_HOME" value="${workspace_loc:@PROJECT@}/build/hadoopcore/hadoop-@HADOOPVER@"/>
+</mapAttribute>
+<stringAttribute key="org.eclipse.jdt.junit.CONTAINER" value=""/>
+<booleanAttribute key="org.eclipse.jdt.junit.KEEPRUNNING_ATTR" value="false"/>
+<stringAttribute key="org.eclipse.jdt.junit.TESTNAME" value=""/>
+<stringAttribute key="org.eclipse.jdt.junit.TEST_KIND" value="org.eclipse.jdt.junit.loader.junit3"/>
+<listAttribute key="org.eclipse.jdt.launching.CLASSPATH">
+<listEntry value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;runtimeClasspathEntry containerPath=&quot;org.eclipse.jdt.launching.JRE_CONTAINER&quot; javaProject=&quot;@PROJECT@&quot; path=&quot;1&quot; type=&quot;4&quot;/&gt;&#10;"/>
+<listEntry value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;runtimeClasspathEntry internalArchive=&quot;/@PROJECT@/build/metastore/metastore_model.jar&quot; path=&quot;3&quot; type=&quot;2&quot;/&gt;&#10;"/>
+<listEntry value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;runtimeClasspathEntry internalArchive=&quot;/@PROJECT@/metastore/src/model&quot; path=&quot;3&quot; type=&quot;2&quot;/&gt;&#10;"/>
+<listEntry value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;runtimeClasspathEntry internalArchive=&quot;/@PROJECT@/build/hadoopcore/hadoop-@HADOOPVER@/conf&quot; path=&quot;3&quot; type=&quot;2&quot;/&gt;&#10;"/>
+<listEntry value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;runtimeClasspathEntry internalArchive=&quot;/@PROJECT@/data/conf&quot; path=&quot;3&quot; type=&quot;2&quot;/&gt;&#10;"/>
+<listEntry value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;runtimeClasspathEntry id=&quot;org.eclipse.jdt.launching.classpathentry.defaultClasspath&quot;&gt;&#10;&lt;memento exportedEntriesOnly=&quot;false&quot; project=&quot;@PROJECT@&quot;/&gt;&#10;&lt;/runtimeClasspathEntry&gt;&#10;"/>
+<listEntry value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;runtimeClasspathEntry internalArchive=&quot;/@PROJECT@/conf&quot; path=&quot;3&quot; type=&quot;2&quot;/&gt;&#10;"/>
+</listAttribute>
+<booleanAttribute key="org.eclipse.jdt.launching.DEFAULT_CLASSPATH" value="false"/>
+<stringAttribute key="org.eclipse.jdt.launching.MAIN_TYPE" value="org.apache.hadoop.hive.metastore.TestTruncate"/>
+<stringAttribute key="org.eclipse.jdt.launching.PROJECT_ATTR" value="@PROJECT@"/>
+<stringAttribute key="org.eclipse.jdt.launching.WORKING_DIRECTORY" value="${workspace_loc:@PROJECT@}/ql"/>
+</launchConfiguration>
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/AmbiguousMethodException.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/AmbiguousMethodException.java
new file mode 100644
index 0000000000..b803e0667e
--- /dev/null
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/AmbiguousMethodException.java
@@ -0,0 +1,62 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.hadoop.hive.ql.exec;
+
+import java.util.List;
+
+/**
+ * Exception thrown by the UDF and UDAF method resolvers in case a unique method is not found.
+ *
+ */
+public class AmbiguousMethodException extends Exception {
+
+  /**
+   * 
+   */
+  private static final long serialVersionUID = 1L;
+
+  /**
+   * The UDF or UDAF class that has the ambiguity.
+   */
+  Class<?> funcClass;
+  
+  /**
+   * The list of parameter types.
+   */
+  List<Class<?>> argClasses;
+  
+  /**
+   * Constructor.
+   * 
+   * @param funcClass The UDF or UDAF class.
+   * @param argClasses The list of argument types that lead to an ambiguity.
+   */
+  AmbiguousMethodException(Class<?> funcClass, List<Class<?>> argClasses) {
+    this.funcClass = funcClass;
+    this.argClasses = argClasses;
+  }
+  
+  Class<?> getFunctionClass() {
+    return funcClass;
+  }
+  
+  List<Class<?>> getArgTypeList() {
+    return argClasses;
+  }
+}
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/ComparisonOpMethodResolver.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/ComparisonOpMethodResolver.java
new file mode 100644
index 0000000000..c03b74718a
--- /dev/null
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/ComparisonOpMethodResolver.java
@@ -0,0 +1,109 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.hadoop.hive.ql.exec;
+
+import java.lang.reflect.Method;
+import java.util.ArrayList;
+import java.util.Arrays;
+import java.util.List;
+
+import org.apache.hadoop.hive.serde2.objectinspector.ObjectInspectorUtils;
+
+/**
+ * The class implements the method resolution for overloaded comparison operators. The
+ * resolution logic is as follows:
+ * 1. The resolver first tries to find an exact parameter match.
+ * 2. If 1 fails and any of the parameters is a date, it converts the other to the date.
+ * 3. If 1 and 3 fail then it returns the evaluate(Double, Double) method.
+ */
+public class ComparisonOpMethodResolver implements UDFMethodResolver {
+
+  /**
+   * The udfclass for which resolution is needed.
+   */
+  private Class<? extends UDF> udfClass;
+  
+  /**
+   * Constuctor.
+   */
+  public ComparisonOpMethodResolver(Class<? extends UDF> udfClass) {
+    this.udfClass = udfClass;
+  }
+  
+
+  /* (non-Javadoc)
+   * @see org.apache.hadoop.hive.ql.exec.UDFMethodResolver#getEvalMethod(java.util.List)
+   */
+  @Override
+  public Method getEvalMethod(List<Class<?>> argClasses)
+      throws AmbiguousMethodException {
+    assert(argClasses.size() == 2);
+
+    List<Class<?>> pClasses = null;
+    if (argClasses.get(0) == Void.class ||
+        argClasses.get(1) == Void.class) {
+      pClasses = new ArrayList<Class<?>>();
+      pClasses.add(Double.class);
+      pClasses.add(Double.class);
+    }
+    else if (argClasses.get(0) == argClasses.get(1)) {
+      pClasses = argClasses;
+    }
+    else if (argClasses.get(0) == java.sql.Date.class ||
+             argClasses.get(1) == java.sql.Date.class) {
+      pClasses = new ArrayList<Class<?>>();
+      pClasses.add(java.sql.Date.class);
+      pClasses.add(java.sql.Date.class);
+    }
+    else {
+      pClasses = new ArrayList<Class<?>>();
+      pClasses.add(Double.class);
+      pClasses.add(Double.class);
+    }
+
+    Method udfMethod = null;
+
+    for(Method m: Arrays.asList(udfClass.getMethods())) {
+      if (m.getName().equals("evaluate")) {
+
+        Class<?>[] argumentTypeInfos = m.getParameterTypes();
+
+        boolean match = (argumentTypeInfos.length == pClasses.size());
+
+        for(int i=0; i<pClasses.size() && match; i++) {
+          Class<?> accepted = ObjectInspectorUtils.generalizePrimitive(argumentTypeInfos[i]);
+          if (accepted != pClasses.get(i)) {
+            match = false;
+          }
+        }
+
+        if (match) {
+          if (udfMethod != null) {
+            throw new AmbiguousMethodException(udfClass, argClasses);
+          }
+          else {
+            udfMethod = m;
+          }
+        }
+      }
+    }
+    return udfMethod;      
+  }
+
+}
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/DefaultUDAFEvaluatorResolver.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/DefaultUDAFEvaluatorResolver.java
new file mode 100644
index 0000000000..24fad89cb3
--- /dev/null
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/DefaultUDAFEvaluatorResolver.java
@@ -0,0 +1,93 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.hadoop.hive.ql.exec;
+
+import java.lang.reflect.Method;
+import java.util.ArrayList;
+import java.util.List;
+
+/**
+ * The default UDAF Method resolver. This resolver is used for resolving the UDAF methods are
+ * used for partial and final evaluation given the list of the argument types. The getEvalMethod goes through all the
+ * evaluate methods and returns the one that matches the argument signature or is the closest match.
+ * Closest match is defined as the one that requires the least number of arguments to be converted.
+ * In case more than one matches are found, the method throws an ambiguous method exception.
+ */
+public class DefaultUDAFEvaluatorResolver implements UDAFEvaluatorResolver {
+
+  /**
+   * The class of the UDAF.
+   */
+  private Class<? extends UDAF> udafClass;
+  
+  /**
+   * Constructor.
+   * This constructor sets the resolver to be used for comparison operators.
+   * See {@link UDAFEvaluatorResolver}
+   */
+  public DefaultUDAFEvaluatorResolver(Class<? extends UDAF> udafClass) {
+    this.udafClass = udafClass;
+  }
+  
+  /**
+   * Gets the evaluator class for the UDAF given the parameter types.
+   * 
+   * @param argClasses The list of the parameter types.
+   */
+  public Class<? extends UDAFEvaluator> getEvaluatorClass(List<Class<?>> argClasses)
+    throws AmbiguousMethodException {
+    
+    ArrayList<Class<? extends UDAFEvaluator>> classList = new ArrayList<Class<? extends UDAFEvaluator>>();
+    
+    // Add the udaf class if it implements and evaluator
+    for(Class<?> iface: udafClass.getInterfaces()) {
+      if (iface == UDAFEvaluator.class) {
+        Class<? extends UDAFEvaluator> udafClass2 = (Class<? extends UDAFEvaluator>) udafClass;
+        classList.add(udafClass2);
+      }
+    }
+    
+    // Add all the public member classes that implement an evaluator
+    for(Class<?> enclClass: udafClass.getClasses()) {
+      for(Class<?> iface: enclClass.getInterfaces()) {
+        if (iface == UDAFEvaluator.class) {
+          classList.add((Class<? extends UDAFEvaluator>)enclClass);
+        }
+      }
+    }
+    
+    // Next we locate all the iterate methods for each of these classes.
+    ArrayList<Method> mList = new ArrayList<Method>();
+    for(Class<? extends UDAFEvaluator> evaluator: classList) {
+      for(Method m: evaluator.getMethods()) {
+        if (m.getName().equalsIgnoreCase("iterate")) {
+          mList.add(m);
+        }
+      }
+    }
+    
+    Method m = FunctionRegistry.getMethodInternal(mList, false, argClasses);
+    if (m == null) {
+      throw new AmbiguousMethodException(udafClass, argClasses);
+    }
+    
+    return (Class<? extends UDAFEvaluator>)m.getDeclaringClass();
+  }
+  
+}
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/DefaultUDFMethodResolver.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/DefaultUDFMethodResolver.java
new file mode 100644
index 0000000000..050787b89a
--- /dev/null
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/DefaultUDFMethodResolver.java
@@ -0,0 +1,61 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.hadoop.hive.ql.exec;
+
+import java.lang.reflect.Method;
+import java.util.List;
+
+/**
+ * The default UDF Method resolver. This resolver is used for resolving the UDF method that is to be
+ * used for evaluation given the list of the argument types. The getEvalMethod goes through all the
+ * evaluate methods and returns the one that matches the argument signature or is the closest match.
+ * Closest match is defined as the one that requires the least number of arguments to be converted.
+ * In case more than one matches are found, the method throws an ambiguous method exception.
+ */
+public class DefaultUDFMethodResolver implements UDFMethodResolver {
+
+  /**
+   * The class of the UDF.
+   */
+  private Class<? extends UDF> udfClass;
+  
+  /**
+   * Constructor.
+   * This constructor sets the resolver to be used for comparison operators.
+   * See {@link UDFMethodResolver}
+   */
+  public DefaultUDFMethodResolver(Class<? extends UDF> udfClass) {
+    this.udfClass = udfClass;
+  }
+  
+  /**
+   * Gets the evaluate method for the UDF given the parameter types.
+   * 
+   * @param argClasses The list of the argument types that need to matched with the evaluate
+   *                   function signature.
+   */
+  public Method getEvalMethod(List<Class<?>> argClasses) 
+    throws AmbiguousMethodException {
+    Method m = FunctionRegistry.getMethodInternal(udfClass, "evaluate", false, argClasses);
+    if (m == null) {
+      throw new AmbiguousMethodException(udfClass, argClasses);
+    }
+    return m;
+  }
+}
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/FunctionRegistry.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/FunctionRegistry.java
index 71cba48349..42566bd81e 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/exec/FunctionRegistry.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/FunctionRegistry.java
@@ -49,12 +49,6 @@ public class FunctionRegistry {
                 OperatorType.PREFIX, false);
     registerUDF("concat", UDFConcat.class, OperatorType.PREFIX, false);
     registerUDF("substr", UDFSubstr.class, OperatorType.PREFIX, false);
-    registerUDF("str_eq", UDFStrEq.class, OperatorType.PREFIX, false);
-    registerUDF("str_ne", UDFStrNe.class, OperatorType.PREFIX, false);
-    registerUDF("str_gt", UDFStrGt.class, OperatorType.PREFIX, false);
-    registerUDF("str_lt", UDFStrLt.class, OperatorType.PREFIX, false);
-    registerUDF("str_ge", UDFStrGe.class, OperatorType.PREFIX, false);
-    registerUDF("str_le", UDFStrLe.class, OperatorType.PREFIX, false);
     
     registerUDF("size", UDFSize.class, OperatorType.PREFIX, false);
 
@@ -150,15 +144,26 @@ public class FunctionRegistry {
   public static FunctionInfo getInfo(Class<?> fClass) {
     for(Map.Entry<String, FunctionInfo> ent: mFunctions.entrySet()) {
       FunctionInfo val = ent.getValue();
-      if (val.getUDFClass() == fClass ||
-          val.getUDAFClass() == fClass) {
+      if (val.getUDFClass() == fClass) {
         return val;
       }
+      // Otherwise this is potentially an aggregate evaluator
+      if (val.getUDAFClass() == fClass) {
+        return val;
+      }
+      // Otherwise check if the aggregator is one of the classes within the UDAF
+      if (val.getUDAFClass() != null) {
+        for(Class<?> c: val.getUDAFClass().getClasses()) {
+          if (c == fClass) {
+            return val;
+          }
+        }
+      }
     }
-    
+
     return null;
   }
-  
+
   public static void registerUDF(String functionName, Class<? extends UDF> UDFClass,
                                  FunctionInfo.OperatorType opt, boolean isOperator) {
     if (UDF.class.isAssignableFrom(UDFClass)) { 
@@ -254,14 +259,44 @@ public static boolean implicitConvertable(Class<?> from, Class<?> to) {
   /**
    * Get the UDF method for the name and argumentClasses. 
    * @param name the name of the UDF
-   * @param argumentClasses 
-   * @param exact  if true, we don't allow implicit type conversions. 
+   * @param argumentClasses
    * @return
    */
-  public static Method getUDFMethod(String name, boolean exact, List<Class<?>> argumentClasses) {
+  public static Method getUDFMethod(String name, List<Class<?>> argumentClasses) {
     Class<? extends UDF> udf = getUDFClass(name);
     if (udf == null) return null;
-    return getMethodInternal(udf, "evaluate", exact, argumentClasses);    
+    Method udfMethod = null;
+    try {
+      udfMethod = udf.newInstance().getResolver().getEvalMethod(argumentClasses);
+    }
+    catch (AmbiguousMethodException e) {
+    }
+    catch (Exception e) {
+      throw new RuntimeException("getUDFMethod exception: " + e.getMessage());
+    }
+    return udfMethod;    
+  }
+
+  /**
+   * Get the UDAF evaluator for the name and argumentClasses. 
+   * @param name the name of the UDAF
+   * @param argumentClasses
+   * @return
+   */
+  public static Class<? extends UDAFEvaluator> getUDAFEvaluator(String name, List<Class<?>> argumentClasses) {
+    Class<? extends UDAF> udf = getUDAF(name);
+    if (udf == null) return null;
+    
+    Class<? extends UDAFEvaluator> evalClass = null;
+    try {
+      evalClass = udf.newInstance().getResolver().getEvaluatorClass(argumentClasses);
+    }
+    catch (AmbiguousMethodException e) {
+    }
+    catch (Exception e) {
+      throw new RuntimeException("getUADFEvaluator exception: " + e.getMessage());
+    }
+    return evalClass;    
   }
 
   /**
@@ -269,50 +304,20 @@ public static Method getUDFMethod(String name, boolean exact, List<Class<?>> arg
    * methodName will be "evaluate" for UDFRegistry, and "aggregate"/"evaluate"/"evaluatePartial" for UDAFRegistry. 
    */
   public static <T> Method getMethodInternal(Class<? extends T> udfClass, String methodName, boolean exact, List<Class<?>> argumentClasses) {
-    int leastImplicitConversions = Integer.MAX_VALUE;
-    Method udfMethod = null;
 
+    ArrayList<Method> mlist = new ArrayList<Method>();
+    
     for(Method m: Arrays.asList(udfClass.getMethods())) {
       if (m.getName().equals(methodName)) {
-
-        Class<?>[] argumentTypeInfos = m.getParameterTypes();
-
-        boolean match = (argumentTypeInfos.length == argumentClasses.size());
-        int implicitConversions = 0;
-
-        for(int i=0; i<argumentClasses.size() && match; i++) {
-          if (argumentClasses.get(i) == Void.class) continue;
-          Class<?> accepted = ObjectInspectorUtils.generalizePrimitive(argumentTypeInfos[i]);
-          if (accepted.isAssignableFrom(argumentClasses.get(i))) {
-            // do nothing if match
-          } else if (!exact && implicitConvertable(argumentClasses.get(i), accepted)) {
-            implicitConversions ++;
-          } else {
-            match = false;
-          }
-        }
-
-        if (match) {
-          // Always choose the function with least implicit conversions.
-          if (implicitConversions < leastImplicitConversions) {
-            udfMethod = m;
-            leastImplicitConversions = implicitConversions;
-            // Found an exact match
-            if (leastImplicitConversions == 0) break;
-          } else if (implicitConversions == leastImplicitConversions){
-            // Ambiguous call: two methods with the same number of implicit conversions 
-            udfMethod = null;
-          } else {
-            // do nothing if implicitConversions > leastImplicitConversions
-          }
-        }
+        mlist.add(m);
       }
     }
-    return udfMethod;
+    
+    return getMethodInternal(mlist, exact, argumentClasses);
   }
 
-  public static Method getUDFMethod(String name, boolean exact, Class<?> ... argumentClasses) {
-    return getUDFMethod(name, exact, Arrays.asList(argumentClasses));
+  public static Method getUDFMethod(String name, Class<?> ... argumentClasses) {
+    return getUDFMethod(name, Arrays.asList(argumentClasses));
   }
 
   public static void registerUDAF(String functionName, Class<? extends UDAF> UDAFClass) {
@@ -345,7 +350,7 @@ public static Method getUDAFMethod(String name, List<Class<?>> argumentClasses)
     Class<? extends UDAF> udaf = getUDAF(name);
     if (udaf == null)
       return null;
-    return FunctionRegistry.getMethodInternal(udaf, "aggregate", false,
+    return FunctionRegistry.getMethodInternal(udaf, "iterate", false,
                                          argumentClasses);
   }
 
@@ -363,7 +368,7 @@ public static Method getUDAFEvaluateMethod(String name, groupByDesc.Mode mode) {
       return null;
     return FunctionRegistry.getMethodInternal(udaf, 
         (mode == groupByDesc.Mode.COMPLETE || mode == groupByDesc.Mode.FINAL) 
-        ? "evaluate" : "evaluatePartial", true,
+        ? "terminate" : "terminatePartial", true,
         new ArrayList<Class<?>>() );
   }
 
@@ -407,4 +412,53 @@ public static Object invoke(Method m, Object thisObject, Object[] arguments) thr
     }
     return o;
   }
+
+  /**
+   * Gets the closest matching method corresponding to the argument list from a list of methods.
+   * 
+   * @param mlist The list of methods to inspect.
+   * @param exact Boolean to indicate whether this is an exact match or not.
+   * @param argumentClasses The classes for the argument.
+   * @return The matching method.
+   */
+  public static Method getMethodInternal(ArrayList<Method> mlist, boolean exact,
+      List<Class<?>> argumentClasses) {
+    int leastImplicitConversions = Integer.MAX_VALUE;
+    Method udfMethod = null;
+
+    for(Method m: mlist) {
+      Class<?>[] argumentTypeInfos = m.getParameterTypes();
+
+      boolean match = (argumentTypeInfos.length == argumentClasses.size());
+      int implicitConversions = 0;
+
+      for(int i=0; i<argumentClasses.size() && match; i++) {
+        if (argumentClasses.get(i) == Void.class) continue;
+        Class<?> accepted = ObjectInspectorUtils.generalizePrimitive(argumentTypeInfos[i]);
+        if (accepted.isAssignableFrom(argumentClasses.get(i))) {
+          // do nothing if match
+        } else if (!exact && implicitConvertable(argumentClasses.get(i), accepted)) {
+          implicitConversions ++;
+        } else {
+          match = false;
+        }
+      }
+
+      if (match) {
+        // Always choose the function with least implicit conversions.
+        if (implicitConversions < leastImplicitConversions) {
+          udfMethod = m;
+          leastImplicitConversions = implicitConversions;
+          // Found an exact match
+          if (leastImplicitConversions == 0) break;
+        } else if (implicitConversions == leastImplicitConversions){
+          // Ambiguous call: two methods with the same number of implicit conversions 
+          udfMethod = null;
+        } else {
+          // do nothing if implicitConversions > leastImplicitConversions
+        }
+      }
+    }
+    return udfMethod;
+  }
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java
index f7cc55c57e..e745f65b94 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/GroupByOperator.java
@@ -18,7 +18,6 @@
 
 package org.apache.hadoop.hive.ql.exec;
 
-import java.util.Arrays;
 import java.util.HashMap;
 import java.util.ArrayList;
 import java.util.List;
@@ -37,7 +36,6 @@
 import org.apache.hadoop.hive.serde2.objectinspector.ObjectInspector;
 import org.apache.hadoop.hive.serde2.objectinspector.ObjectInspectorFactory;
 import org.apache.hadoop.conf.Configuration;
-import org.apache.hadoop.hive.ql.parse.RowResolver;
 import org.apache.hadoop.hive.ql.parse.OpParseContext;
 import org.apache.hadoop.hive.ql.typeinfo.TypeInfo;
 import org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo;
@@ -62,7 +60,7 @@ public class GroupByOperator extends Operator <groupByDesc> implements Serializa
   // so aggregationIsDistinct is a boolean array instead of a single number. 
   transient protected boolean[] aggregationIsDistinct;
 
-  transient Class<? extends UDAF>[] aggregationClasses; 
+  transient Class<? extends UDAFEvaluator>[] aggregationClasses; 
   transient protected Method[] aggregationsAggregateMethods;
   transient protected Method[] aggregationsEvaluateMethods;
 
@@ -71,11 +69,11 @@ public class GroupByOperator extends Operator <groupByDesc> implements Serializa
 
   // Used by sort-based GroupBy: Mode = COMPLETE, PARTIAL1, PARTIAL2
   transient protected ArrayList<Object> currentKeys;
-  transient protected UDAF[] aggregations;
+  transient protected UDAFEvaluator[] aggregations;
   transient protected Object[][] aggregationsParametersLastInvoke;
 
   // Used by hash-based GroupBy: Mode = HASH
-  transient protected HashMap<ArrayList<Object>, UDAF[]> hashAggregations;
+  transient protected HashMap<ArrayList<Object>, UDAFEvaluator[]> hashAggregations;
   
   transient boolean firstRow;
   transient long    totalMemory;
@@ -139,7 +137,7 @@ public void initialize(Configuration hconf, Reporter reporter) throws HiveExcept
     }
 
     // init aggregationClasses  
-    aggregationClasses = (Class<? extends UDAF>[]) new Class[conf.getAggregators().size()];
+    aggregationClasses = (Class<? extends UDAFEvaluator>[]) new Class[conf.getAggregators().size()];
     for (int i = 0; i < conf.getAggregators().size(); i++) {
       aggregationDesc agg = conf.getAggregators().get(i);
       aggregationClasses[i] = agg.getAggregationClass();
@@ -151,13 +149,13 @@ public void initialize(Configuration hconf, Reporter reporter) throws HiveExcept
     aggregationsEvaluateMethods = new Method[aggregationClasses.length];
     String evaluateMethodName = ((conf.getMode() == groupByDesc.Mode.PARTIAL1 || conf.getMode() == groupByDesc.Mode.HASH ||
                                   conf.getMode() == groupByDesc.Mode.PARTIAL2)
-                                 ? "evaluatePartial" : "evaluate");
+                                 ? "terminatePartial" : "terminate");
 
     for(int i=0; i<aggregationClasses.length; i++) {
-      String aggregateMethodName = (((conf.getMode() == groupByDesc.Mode.PARTIAL1) || (conf.getMode() == groupByDesc.Mode.HASH)) ? "aggregate" : "aggregatePartial");
+      String aggregateMethodName = (((conf.getMode() == groupByDesc.Mode.PARTIAL1) || (conf.getMode() == groupByDesc.Mode.HASH)) ? "iterate" : "merge");
 
       if (aggregationIsDistinct[i] && (conf.getMode() != groupByDesc.Mode.FINAL))
-        aggregateMethodName = "aggregate";
+        aggregateMethodName = "iterate";
       // aggregationsAggregateMethods
       for( Method m : aggregationClasses[i].getMethods() ){
         if( m.getName().equals( aggregateMethodName ) 
@@ -191,7 +189,7 @@ public void initialize(Configuration hconf, Reporter reporter) throws HiveExcept
       aggregations = newAggregations();
       hashAggr = false;
     } else {
-      hashAggregations = new HashMap<ArrayList<Object>, UDAF[]>();
+      hashAggregations = new HashMap<ArrayList<Object>, UDAFEvaluator[]>();
       hashAggr = true;
       keyPositionsSize = new ArrayList<Integer>();
     }
@@ -329,19 +327,20 @@ private void estimateRowSize() {
     // fields in these aggregation classes.
     for(int i=0; i < aggregationClasses.length; i++) {
       fixedRowSize += javaObjectOverHead;
-      Class<? extends UDAF> agg = aggregationClasses[i];
+      Class<? extends UDAFEvaluator> agg = aggregationClasses[i];
       Field[] fArr = agg.getFields();
       for (Field f : fArr) 
         fixedRowSize += getSize(i, agg, f);
     }
   }
 
-  protected UDAF[] newAggregations() throws HiveException {      
-    UDAF[] aggs = new UDAF[aggregationClasses.length];
+  protected UDAFEvaluator[] newAggregations() throws HiveException {      
+    UDAFEvaluator[] aggs = new UDAFEvaluator[aggregationClasses.length];
     for(int i=0; i<aggregationClasses.length; i++) {
       try {
         aggs[i] = aggregationClasses[i].newInstance();
       } catch (Exception e) {
+        e.printStackTrace();
         throw new HiveException("Unable to create an instance of class " + aggregationClasses[i] + ": " + e.getMessage());
       }
       aggs[i].init();
@@ -351,7 +350,7 @@ protected UDAF[] newAggregations() throws HiveException {
 
   InspectableObject tempInspectableObject = new InspectableObject();
   
-  protected void updateAggregations(UDAF[] aggs, Object row, ObjectInspector rowInspector, boolean hashAggr, boolean newEntry,
+  protected void updateAggregations(UDAFEvaluator[] aggs, Object row, ObjectInspector rowInspector, boolean hashAggr, boolean newEntry,
                                     Object[][] lastInvoke) throws HiveException {
     for(int ai=0; ai<aggs.length; ai++) {
 
@@ -429,7 +428,7 @@ public void process(Object row, ObjectInspector rowInspector) throws HiveExcepti
 
   private void processHashAggr(Object row, ObjectInspector rowInspector, ArrayList<Object> newKeys) throws HiveException {
     // Prepare aggs for updating
-    UDAF[] aggs = null;
+    UDAFEvaluator[] aggs = null;
     boolean newEntry = false;
 
     // hash-based aggregations
@@ -451,7 +450,7 @@ private void processHashAggr(Object row, ObjectInspector rowInspector, ArrayList
 
   private void processAggr(Object row, ObjectInspector rowInspector, ArrayList<Object> newKeys) throws HiveException {
     // Prepare aggs for updating
-    UDAF[] aggs = null;
+    UDAFEvaluator[] aggs = null;
     Object[][] lastInvoke = null;
     boolean keysAreEqual = newKeys.equals(currentKeys);
     
@@ -464,7 +463,7 @@ private void processAggr(Object row, ObjectInspector rowInspector, ArrayList<Obj
       currentKeys = newKeys;
       
       // init aggregations
-      for(UDAF aggregation: aggregations)
+      for(UDAFEvaluator aggregation: aggregations)
         aggregation.init();
       
       // clear parameters in last-invoke
@@ -493,14 +492,14 @@ private boolean shouldBeFlushed(ArrayList<Object> newKeys) {
         totalVariableSize += ((String)key).length();
       }
 
-      UDAF[] aggs = null;
+      UDAFEvaluator[] aggs = null;
       if (aggrPositions.size() > 0)
         aggs = hashAggregations.get(newKeys);
 
       for (varLenFields v : aggrPositions) {
         int     aggrPos          = v.getAggrPos();
         List<Field> fieldsVarLen = v.getFields();
-        UDAF    agg              = aggs[aggrPos];
+        UDAFEvaluator    agg              = aggs[aggrPos];
 
         try 
         {
@@ -532,7 +531,7 @@ private void flush() throws HiveException {
     Iterator iter = hashAggregations.entrySet().iterator();
     int numDel = 0;
     while (iter.hasNext()) {
-      Map.Entry<ArrayList<Object>, UDAF[]> m = (Map.Entry)iter.next();
+      Map.Entry<ArrayList<Object>, UDAFEvaluator[]> m = (Map.Entry)iter.next();
       forward(m.getKey(), m.getValue());
       iter.remove();
       numDel++;
@@ -548,7 +547,7 @@ private void flush() throws HiveException {
    *          The keys in the record
    * @throws HiveException
    */
-  protected void forward(ArrayList<Object> keys, UDAF[] aggs) throws HiveException {
+  protected void forward(ArrayList<Object> keys, UDAFEvaluator[] aggs) throws HiveException {
     int totalFields = keys.size() + aggs.length;
     List<Object> a = new ArrayList<Object>(totalFields);
     for(int i=0; i<keys.size(); i++) {
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/NumericOpMethodResolver.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/NumericOpMethodResolver.java
new file mode 100644
index 0000000000..9022cc42c8
--- /dev/null
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/NumericOpMethodResolver.java
@@ -0,0 +1,103 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.hadoop.hive.ql.exec;
+
+import java.lang.reflect.Method;
+import java.util.ArrayList;
+import java.util.Arrays;
+import java.util.List;
+
+import org.apache.hadoop.hive.serde2.objectinspector.ObjectInspectorUtils;
+
+/**
+ * The class implements the method resolution for operators like (+, -, *, /, %, |, &, ^). The
+ * resolution logic is as follows:
+ * 1. The resolver first tries to find an exact parameter match.
+ * 2. If 1 fails then it returns the evaluate(Double, Double) method.
+ */
+public class NumericOpMethodResolver implements UDFMethodResolver {
+
+  /**
+   * The udfclass for which resolution is needed.
+   */
+  Class<? extends UDF> udfClass;
+  
+  /**
+   * Constuctor.
+   */
+  public NumericOpMethodResolver(Class<? extends UDF> udfClass) {
+    this.udfClass = udfClass;
+  }
+  
+  /* (non-Javadoc)
+   * @see org.apache.hadoop.hive.ql.exec.UDFMethodResolver#getEvalMethod(java.util.List)
+   */
+  @Override
+  public Method getEvalMethod(List<Class<?>> argClasses)
+  throws AmbiguousMethodException {
+    assert(argClasses.size() == 2);
+
+    List<Class<?>> pClasses = null;
+    if (argClasses.get(0) == Void.class ||
+        argClasses.get(1) == Void.class) {
+      pClasses = new ArrayList<Class<?>>();
+      pClasses.add(Double.class);
+      pClasses.add(Double.class);      
+    } else if (argClasses.get(0) == String.class ||
+        argClasses.get(1) == String.class) {
+      pClasses = new ArrayList<Class<?>>();
+      pClasses.add(Double.class);
+      pClasses.add(Double.class);
+    } else if (argClasses.get(0) == argClasses.get(1)) {
+      pClasses = argClasses;
+    } else {
+      pClasses = new ArrayList<Class<?>>();
+      pClasses.add(Double.class);
+      pClasses.add(Double.class);
+    }
+
+    Method udfMethod = null;
+
+    for(Method m: Arrays.asList(udfClass.getMethods())) {
+      if (m.getName().equals("evaluate")) {
+
+        Class<?>[] argumentTypeInfos = m.getParameterTypes();
+
+        boolean match = (argumentTypeInfos.length == pClasses.size());
+
+        for(int i=0; i<pClasses.size() && match; i++) {
+          Class<?> accepted = ObjectInspectorUtils.generalizePrimitive(argumentTypeInfos[i]);
+          if (accepted != pClasses.get(i)) {
+            match = false;
+          }
+        }
+
+        if (match) {
+          if (udfMethod != null) {
+            throw new AmbiguousMethodException(udfClass, argClasses);
+          }
+          else {
+            udfMethod = m;
+          }
+        }
+      }
+    }
+    return udfMethod;      
+  }
+}
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFStrNe.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/NumericUDAF.java
old mode 100755
new mode 100644
similarity index 72%
rename from ql/src/java/org/apache/hadoop/hive/ql/udf/UDFStrNe.java
rename to ql/src/java/org/apache/hadoop/hive/ql/exec/NumericUDAF.java
index 7086172cfd..736f91006c
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFStrNe.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/NumericUDAF.java
@@ -16,19 +16,17 @@
  * limitations under the License.
  */
 
-package org.apache.hadoop.hive.ql.udf;
+package org.apache.hadoop.hive.ql.exec;
 
-import org.apache.commons.logging.Log;
-import org.apache.commons.logging.LogFactory;
-import org.apache.hadoop.hive.ql.exec.UDF;
-
-
-public class UDFStrNe implements UDF {
-
-  public UDFStrNe() {
-  }
+/**
+ * Base class of numeric UDAFs like sum and avg which need a NumericUDAFEvaluatorResolver.
+ */
+public class NumericUDAF extends UDAF {
 
-  public boolean evaluate(String a, String b)  {
-    return !a.equals(b);
+  /**
+   * Constructor.
+   */
+  public NumericUDAF() {
+    setResolver(new NumericUDAFEvaluatorResolver(this.getClass()));
   }
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/NumericUDAFEvaluatorResolver.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/NumericUDAFEvaluatorResolver.java
new file mode 100644
index 0000000000..865139bfda
--- /dev/null
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/NumericUDAFEvaluatorResolver.java
@@ -0,0 +1,57 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.hadoop.hive.ql.exec;
+
+import java.sql.Date;
+import java.util.ArrayList;
+import java.util.List;
+
+/**
+ * Resolver for Numeric UDAFs like sum and avg. If the input argument is string or date,
+ * the resolver returns the evaluator whose iterate function operates on doubles.
+ */
+public class NumericUDAFEvaluatorResolver extends DefaultUDAFEvaluatorResolver {
+
+  /**
+   * Constructor.
+   */
+  public NumericUDAFEvaluatorResolver(Class<? extends UDAF> udafClass) {
+    super(udafClass);
+  }
+  
+  /* (non-Javadoc)
+   * @see org.apache.hadoop.hive.ql.exec.UDAFMethodResolver#getEvaluatorClass(java.util.List)
+   */
+  @Override
+  public Class<? extends UDAFEvaluator> getEvaluatorClass(
+      List<Class<?>> argClasses) throws AmbiguousMethodException {
+    // Go through the argClasses and for any string, void or date time, start looking for doubles
+    ArrayList<Class<?>> args = new ArrayList<Class<?>>();
+    for(Class<?>arg: argClasses) {
+      if (arg == Void.class || arg == String.class || arg == Date.class) {
+        args.add(Double.class);
+      }
+      else {
+        args.add(arg);
+      }
+    }
+    
+    return super.getEvaluatorClass(args);
+  }
+}
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/UDAF.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/UDAF.java
index 0d1e5ab39f..9b99b981fc 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/exec/UDAF.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/UDAF.java
@@ -17,9 +17,6 @@
  */
 
 package org.apache.hadoop.hive.ql.exec;
-
-
-import org.apache.hadoop.hive.ql.metadata.HiveException;
 //import org.apache.hadoop.hive.serde.ReflectionSerDe;
 
 /**
@@ -60,12 +57,40 @@
  *    public boolean aggregatePartial(String partial);
  *
  */
-public abstract class UDAF {
+public class UDAF {
 
-  public UDAF() { }
+  /**
+   * The resolver used for method resolution.
+   */
+  UDAFEvaluatorResolver rslv;
+  
+  /**
+   * The default constructor.
+   */
+  public UDAF() { 
+    rslv = new DefaultUDAFEvaluatorResolver(this.getClass());
+  }
 
-  /** Initialize the aggregation object.
-   *  The class should reset the status of the aggregation if aggregate() was called before.
+  /**
+   * The constructor with a particular type of resolver.
+   */
+  public UDAF(UDAFEvaluatorResolver rslv) {
+    this.rslv = rslv;
+  }
+  
+  /**
+   * Sets the resolver
+   * 
+   * @param The method resolver to use for method resolution.
+   */
+  public void setResolver(UDAFEvaluatorResolver rslv) {
+    this.rslv = rslv;
+  }
+  
+  /**
+   * Gets the resolver.
    */
-  public abstract void init();
+  public UDAFEvaluatorResolver getResolver() {
+    return rslv;
+  }
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFStrEq.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/UDAFEvaluator.java
old mode 100755
new mode 100644
similarity index 63%
rename from ql/src/java/org/apache/hadoop/hive/ql/udf/UDFStrEq.java
rename to ql/src/java/org/apache/hadoop/hive/ql/exec/UDAFEvaluator.java
index 5df605813e..481fca1bf7
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFStrEq.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/UDAFEvaluator.java
@@ -16,21 +16,18 @@
  * limitations under the License.
  */
 
-package org.apache.hadoop.hive.ql.udf;
+package org.apache.hadoop.hive.ql.exec;
 
-import org.apache.commons.logging.Log;
-import org.apache.commons.logging.LogFactory;
-import org.apache.hadoop.hive.ql.exec.UDF;
-
-
-public class UDFStrEq implements UDF {
-
-  private static Log LOG = LogFactory.getLog("org.apache.hadoop.hive.ql.udf.UDFStrEq");
-
-  public UDFStrEq() {
-  }
+/**
+ * Interface that encapsulates the evaluation logic of a UDAF. One evaluator is needed
+ * for every overloaded form of a UDAF .e.g max and min UDAFs would have evaluators for
+ * integer, string and other types. On the other hand avg would have an evaluator only
+ * for the double type.
+ */
+public interface UDAFEvaluator {
 
-  public boolean evaluate(String a, String b)  {
-    return a.equals(b);
-  }
+  /**
+   * Initializer. Initializes the state for the evaluator.
+   */
+  public void init();
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/UDAFEvaluatorResolver.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/UDAFEvaluatorResolver.java
new file mode 100644
index 0000000000..59df208e57
--- /dev/null
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/UDAFEvaluatorResolver.java
@@ -0,0 +1,42 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.hadoop.hive.ql.exec;
+
+import java.util.List;
+
+/**
+ * The UDF Method resolver interface. A user can plugin a resolver to their UDF by implementing the
+ * functions in this interface. Note that the resolver is stored in the UDF class as an instance
+ * variable. We did not use a static variable because many resolvers maintain the class of the 
+ * enclosing UDF as state and are called from a base class e.g. UDFBaseCompare. This makes it very
+ * easy to write UDFs that want to do resolution similar to the comparison operators. Such UDFs
+ * just need to extend UDFBaseCompare and do not have to care about the UDFMethodResolver interface.
+ * Same is true for UDFs that want to do resolution similar to that done by the numeric operators.
+ * Such UDFs simply have to extend UDFBaseNumericOp class. For the default resolution the UDF
+ * implementation simply needs to extend the UDF class.
+ */
+public interface UDAFEvaluatorResolver {
+  
+  /**
+   * Gets the evaluator class corresponding to the passed parameter list.
+   */
+  Class<? extends UDAFEvaluator> getEvaluatorClass(List<Class<?>> argClasses)
+    throws AmbiguousMethodException;
+  
+}
\ No newline at end of file
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/UDF.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/UDF.java
index a7befefa93..61e5bfbc1a 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/exec/UDF.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/UDF.java
@@ -33,6 +33,33 @@
  * 
  *    "evaluate" should never be a void method.  However it can return "null" if needed.
  */
-public interface UDF {
+public class UDF {
+  
+  /**
+   * The resolver to use for method resolution.
+   */
+  private UDFMethodResolver rslv;
 
+  /**
+   * The constructor
+   */
+  public UDF() {
+    rslv = new DefaultUDFMethodResolver(this.getClass());
+  }
+  
+  /**
+   * Sets the resolver
+   * 
+   * @param The method resolver to use for method resolution.
+   */
+  public void setResolver(UDFMethodResolver rslv) {
+    this.rslv = rslv;
+  }
+  
+  /**
+   * Get the method resolver.
+   */
+  public UDFMethodResolver getResolver() {
+    return rslv;
+  }
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/UDFMethodResolver.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/UDFMethodResolver.java
new file mode 100644
index 0000000000..75723eeaf7
--- /dev/null
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/UDFMethodResolver.java
@@ -0,0 +1,45 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.hadoop.hive.ql.exec;
+
+import java.lang.reflect.Method;
+import java.util.List;
+
+/**
+ * The UDF Method resolver interface. A user can plugin a resolver to their UDF by implementing the
+ * functions in this interface. Note that the resolver is stored in the UDF class as an instance
+ * variable. We did not use a static variable because many resolvers maintain the class of the 
+ * enclosing UDF as state and are called from a base class e.g. UDFBaseCompare. This makes it very
+ * easy to write UDFs that want to do resolution similar to the comparison operators. Such UDFs
+ * just need to extend UDFBaseCompare and do not have to care about the UDFMethodResolver interface.
+ * Same is true for UDFs that want to do resolution similar to that done by the numeric operators.
+ * Such UDFs simply have to extend UDFBaseNumericOp class. For the default resolution the UDF
+ * implementation simply needs to extend the UDF class.
+ */
+public interface UDFMethodResolver {
+  
+  /**
+   * Gets the evaluate method for the UDF given the parameter types.
+   * 
+   * @param argClasses The list of the argument types that need to matched with the evaluate
+   *                   function signature.
+   */
+  public Method getEvalMethod(List<Class<?>> argClasses) 
+    throws AmbiguousMethodException;
+}
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/lib/DefaultGraphWalker.java b/ql/src/java/org/apache/hadoop/hive/ql/lib/DefaultGraphWalker.java
index 60dca46465..ad0ab2b88b 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/lib/DefaultGraphWalker.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/lib/DefaultGraphWalker.java
@@ -20,14 +20,12 @@
 
 import java.util.ArrayList;
 import java.util.Collection;
+import java.util.HashMap;
 import java.util.HashSet;
 import java.util.List;
 import java.util.Set;
 import java.util.Stack;
 
-import org.apache.hadoop.hive.ql.exec.FileSinkOperator;
-import org.apache.hadoop.hive.ql.exec.ScriptOperator;
-import org.apache.hadoop.hive.ql.exec.SelectOperator;
 import org.apache.hadoop.hive.ql.parse.SemanticException;
 
 /**
@@ -39,7 +37,7 @@ public class DefaultGraphWalker implements GraphWalker {
 
   protected Stack<Node> opStack;
   private List<Node> toWalk = new ArrayList<Node>();
-  private Set<Node> dispatchedList = new HashSet<Node>();
+  private HashMap<Node, Object> retMap = new HashMap<Node, Object>();
   private Dispatcher dispatcher;
 
   /**
@@ -63,7 +61,7 @@ public List<Node> getToWalk() {
    * @return the doneList
    */
   public Set<Node> getDispatchedList() {
-    return dispatchedList;
+    return retMap.keySet();
   }
 
   /**
@@ -73,18 +71,32 @@ public Set<Node> getDispatchedList() {
    * @throws SemanticException
    */
   public void dispatch(Node nd, Stack<Node> ndStack) throws SemanticException {
-    this.dispatcher.dispatch(nd, ndStack);
-    this.dispatchedList.add(nd);
+    Object[] nodeOutputs = null;
+    if (nd.getChildren() != null) {
+      nodeOutputs = new Object[nd.getChildren().size()];
+      int i = 0;
+      for(Node child: nd.getChildren()) {
+        nodeOutputs[i++] = retMap.get(child);
+      }
+    }
+    
+    Object retVal = dispatcher.dispatch(nd, ndStack, nodeOutputs);
+    retMap.put(nd, retVal);
   }
 
   /**
    * starting point for walking
    * @throws SemanticException
    */
-  public void startWalking(Collection<Node> startNodes) throws SemanticException {
+  public void startWalking(Collection<Node> startNodes, HashMap<Node, Object> nodeOutput) throws SemanticException {
     toWalk.addAll(startNodes);
-    while(toWalk.size() > 0)
-      walk(toWalk.remove(0));
+    while(toWalk.size() > 0) {
+      Node nd = toWalk.remove(0);
+      walk(nd);
+      if (nodeOutput != null) {
+        nodeOutput.put(nd, retMap.get(nd));
+      }
+    }
   }
 
   /**
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/lib/DefaultRuleDispatcher.java b/ql/src/java/org/apache/hadoop/hive/ql/lib/DefaultRuleDispatcher.java
index f0dacf93f2..b8a73e0ad2 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/lib/DefaultRuleDispatcher.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/lib/DefaultRuleDispatcher.java
@@ -52,7 +52,7 @@ public DefaultRuleDispatcher(NodeProcessor defaultProc,
    * @param ndStack the operators encountered so far
    * @throws SemanticException
    */
-  public void dispatch(Node nd, Stack<Node> ndStack) 
+  public Object dispatch(Node nd, Stack<Node> ndStack, Object... nodeOutputs) 
     throws SemanticException {
 
     // find the firing rule
@@ -75,8 +75,11 @@ public void dispatch(Node nd, Stack<Node> ndStack)
       proc = procRules.get(rule);
 
     // Do nothing in case proc is null
-    if (proc != null)
+    if (proc != null) {
       // Call the process function
-      proc.process(nd, procCtx);
+      return proc.process(nd, procCtx, nodeOutputs);
+    }
+    else
+      return null;
   }
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/lib/Dispatcher.java b/ql/src/java/org/apache/hadoop/hive/ql/lib/Dispatcher.java
index 48c997d9f9..077a4bab7c 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/lib/Dispatcher.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/lib/Dispatcher.java
@@ -29,11 +29,14 @@
 public interface Dispatcher {
 
   /**
-   * dispatcher function
-   * @param nd operator to process
-   * @param Stack operator stack to process
+   * Dispatcher function.
+   * @param nd operator to process.
+   * @param Stack operator stack to process.
+   * @param nodeOutputs The argument list of outputs from processing other nodes that are
+   * passed to this dispatcher from the walker.
+   * @return Object The return object from the processing call.
    * @throws SemanticException
    */
-  public abstract void dispatch(Node nd, Stack<Node> stack) 
+  public Object dispatch(Node nd, Stack<Node> stack, Object... nodeOutputs) 
     throws SemanticException;
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/lib/GraphWalker.java b/ql/src/java/org/apache/hadoop/hive/ql/lib/GraphWalker.java
index 21f03b0f66..ccb9c0c5d3 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/lib/GraphWalker.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/lib/GraphWalker.java
@@ -19,6 +19,7 @@
 package org.apache.hadoop.hive.ql.lib;
 
 import java.util.Collection;
+import java.util.HashMap;
 
 import org.apache.hadoop.hive.ql.parse.SemanticException;
 
@@ -31,9 +32,11 @@ public interface GraphWalker {
    * starting point for walking.
    * 
    * @param startNodes list of starting operators
+   * @param nodeOutput If this parameter is not null, the call to the function returns the 
+   * map from node to objects returned by the processors.
    * @throws SemanticException
    */
-  public void startWalking(Collection<Node> startNodes)
+  public void startWalking(Collection<Node> startNodes, HashMap<Node, Object> nodeOutput)
       throws SemanticException;
 
 }
\ No newline at end of file
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/lib/NodeProcessor.java b/ql/src/java/org/apache/hadoop/hive/ql/lib/NodeProcessor.java
index 29a55a333e..febb81846a 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/lib/NodeProcessor.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/lib/NodeProcessor.java
@@ -30,8 +30,10 @@ public interface NodeProcessor {
    * generic process for all ops that don't have specific implementations
    * @param nd operator to process
    * @param procCtx operator processor context
+   * @param nodeOutputs A variable argument list of outputs from other nodes in the walk
+   * @return Object to be returned by the process call
    * @throws SemanticException
    */
-  public void process(Node nd, NodeProcessorCtx procCtx) 
+  public Object process(Node nd, NodeProcessorCtx procCtx, Object... nodeOutputs) 
     throws SemanticException;
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/lib/NodeProcessorCtx.java b/ql/src/java/org/apache/hadoop/hive/ql/lib/NodeProcessorCtx.java
index af421c6c0a..c34f4f0091 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/lib/NodeProcessorCtx.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/lib/NodeProcessorCtx.java
@@ -21,5 +21,5 @@
 /**
  * Operator Processor Context
  */
-public abstract class NodeProcessorCtx {
+public interface NodeProcessorCtx {
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPruner.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPruner.java
index 30fa60ca4d..6216605bbf 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPruner.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPruner.java
@@ -171,7 +171,7 @@ public ParseContext transform(ParseContext pactx) throws SemanticException {
     // Create a list of topop nodes
     ArrayList<Node> topNodes = new ArrayList<Node>();
     topNodes.addAll(pGraphContext.getTopOps().values());
-    ogw.startWalking(topNodes);
+    ogw.startWalking(topNodes, null);
 
     // create a new select operator if any of input tables' columns can be pruned
     for (String alias_id : pGraphContext.getTopOps().keySet()) {
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcCtx.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcCtx.java
index 4e0dfd55fa..4e32288636 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcCtx.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcCtx.java
@@ -36,7 +36,7 @@
 /**
  * This class implements the processor context for Column Pruner.
  */
-public class ColumnPrunerProcCtx extends NodeProcessorCtx {
+public class ColumnPrunerProcCtx implements NodeProcessorCtx {
   
   private  Map<Operator<? extends Serializable>,List<String>> prunedColLists;
   
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcFactory.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcFactory.java
index 26f394d412..7b12dd80c3 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcFactory.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/ColumnPrunerProcFactory.java
@@ -54,7 +54,7 @@ public class ColumnPrunerProcFactory {
    * Node Processor for Column Pruning on Filter Operators.
    */
   public static class ColumnPrunerFilterProc implements NodeProcessor {  
-    public void process(Node nd, NodeProcessorCtx ctx) throws SemanticException {
+    public Object process(Node nd, NodeProcessorCtx ctx, Object... nodeOutputs) throws SemanticException {
       FilterOperator op = (FilterOperator)nd;
       ColumnPrunerProcCtx cppCtx = (ColumnPrunerProcCtx)ctx;
       exprNodeDesc condn = op.getConf().getPredicate();
@@ -62,6 +62,7 @@ public void process(Node nd, NodeProcessorCtx ctx) throws SemanticException {
       List<String> cl = condn.getCols();
       // merge it with the downstream col list
       cppCtx.getPrunedColLists().put(op, Utilities.mergeUniqElems(cppCtx.genColLists(op), cl));
+      return null;
     }
   }
   
@@ -77,7 +78,7 @@ public static ColumnPrunerFilterProc getFilterProc() {
    * Node Processor for Column Pruning on Group By Operators.
    */
   public static class ColumnPrunerGroupByProc implements NodeProcessor {
-    public void process(Node nd, NodeProcessorCtx ctx) throws SemanticException {
+    public Object process(Node nd, NodeProcessorCtx ctx, Object... nodeOutputs) throws SemanticException {
       GroupByOperator op = (GroupByOperator)nd;
       ColumnPrunerProcCtx cppCtx = (ColumnPrunerProcCtx)ctx;
       List<String> colLists = new ArrayList<String>();
@@ -94,6 +95,7 @@ public void process(Node nd, NodeProcessorCtx ctx) throws SemanticException {
       }
 
       cppCtx.getPrunedColLists().put(op, colLists);
+      return null;
     }
   }
 
@@ -109,10 +111,12 @@ public static ColumnPrunerGroupByProc getGroupByProc() {
    * The Default Node Processor for Column Pruning.
    */
   public static class ColumnPrunerDefaultProc implements NodeProcessor {
-    public void process(Node nd, NodeProcessorCtx ctx) throws SemanticException {
+    public Object process(Node nd, NodeProcessorCtx ctx, Object... nodeOutputs) throws SemanticException {
       ColumnPrunerProcCtx cppCtx = (ColumnPrunerProcCtx)ctx;
       cppCtx.getPrunedColLists().put((Operator<? extends Serializable>)nd, 
           cppCtx.genColLists((Operator<? extends Serializable>)nd));
+      
+      return null;
     }
   }
 
@@ -128,7 +132,7 @@ public static ColumnPrunerDefaultProc getDefaultProc() {
    * The Node Processor for Column Pruning on Reduce Sink Operators.
    */
   public static class ColumnPrunerReduceSinkProc implements NodeProcessor {
-    public void process(Node nd, NodeProcessorCtx ctx) throws SemanticException {
+    public Object process(Node nd, NodeProcessorCtx ctx, Object... nodeOutputs) throws SemanticException {
       ReduceSinkOperator op = (ReduceSinkOperator)nd;
       ColumnPrunerProcCtx cppCtx = (ColumnPrunerProcCtx)ctx;
       HashMap<Operator<? extends Serializable>, OpParseContext> opToParseCtxMap = 
@@ -171,6 +175,7 @@ public void process(Node nd, NodeProcessorCtx ctx) throws SemanticException {
       }
 
       cppCtx.getPrunedColLists().put(op, colLists);
+      return null;
     }
   }
 
@@ -186,7 +191,7 @@ public static ColumnPrunerReduceSinkProc getReduceSinkProc() {
    * The Node Processor for Column Pruning on Select Operators.
    */
   public static class ColumnPrunerSelectProc implements NodeProcessor {
-    public void process(Node nd, NodeProcessorCtx ctx) throws SemanticException {
+    public Object process(Node nd, NodeProcessorCtx ctx, Object... nodeOutputs) throws SemanticException {
       SelectOperator op = (SelectOperator)nd;
       ColumnPrunerProcCtx cppCtx = (ColumnPrunerProcCtx)ctx;
       List<String> cols = new ArrayList<String>();
@@ -198,7 +203,7 @@ public void process(Node nd, NodeProcessorCtx ctx) throws SemanticException {
           // which should be fixed before remove this
           if ((child instanceof FileSinkOperator) || (child instanceof ScriptOperator)) {
             cppCtx.getPrunedColLists().put(op, cppCtx.getColsFromSelectExpr(op));
-            return;
+            return null;
           }
           cols = Utilities.mergeUniqElems(cols, cppCtx.getPrunedColLists().get(child));
         }
@@ -209,9 +214,10 @@ public void process(Node nd, NodeProcessorCtx ctx) throws SemanticException {
         // The input to the select does not matter. Go over the expressions 
         // and return the ones which have a marked column
         cppCtx.getPrunedColLists().put(op, cppCtx.getSelectColsFromChildren(op, cols));
-        return;
+        return null;
       }
       cppCtx.getPrunedColLists().put(op, cppCtx.getColsFromSelectExpr(op));
+      return null;
     }
   }
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java
index 08731a11f9..c54f80c565 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRFileSink1.java
@@ -44,7 +44,7 @@ public GenMRFileSink1() {
    * @param nd the file sink operator encountered
    * @param opProcCtx context
    */
-  public void process(Node nd, NodeProcessorCtx opProcCtx) throws SemanticException {
+  public Object process(Node nd, NodeProcessorCtx opProcCtx, Object... nodeOutputs) throws SemanticException {
     FileSinkOperator op = (FileSinkOperator)nd;
     GenMRProcContext ctx = (GenMRProcContext)opProcCtx;
     boolean ret = false;
@@ -82,5 +82,6 @@ public void process(Node nd, NodeProcessorCtx opProcCtx) throws SemanticExceptio
           currTask.removeDependentTask(mvTask);
       }
     }
+    return null;
   }
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMROperator.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMROperator.java
index b716ece108..e9a77d828f 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMROperator.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMROperator.java
@@ -41,10 +41,11 @@ public GenMROperator() {
    * @param nd the reduce sink operator encountered
    * @param procCtx context
    */
-  public void process(Node nd, NodeProcessorCtx procCtx) throws SemanticException {
+  public Object process(Node nd, NodeProcessorCtx procCtx, Object... nodeOutputs) throws SemanticException {
     GenMRProcContext ctx = (GenMRProcContext)procCtx;
 
     Map<Operator<? extends Serializable>, GenMapRedCtx> mapCurrCtx = ctx.getMapCurrCtx();
     mapCurrCtx.put((Operator<? extends Serializable>)nd, new GenMapRedCtx(ctx.getCurrTask(), ctx.getCurrTopOp(), ctx.getCurrAliasId()));
+    return null;
   }
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRProcContext.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRProcContext.java
index a831c2b9fb..dfc723afd4 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRProcContext.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRProcContext.java
@@ -55,7 +55,7 @@
  * Processor Context for creating map reduce task. Walk the tree in a DFS manner and process the nodes. Some state is 
  * maintained about the current nodes visited so far.
  */
-public class GenMRProcContext extends NodeProcessorCtx {
+public class GenMRProcContext implements NodeProcessorCtx {
 
   /** 
    * GenMapRedCtx is used to keep track of the current state. 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink1.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink1.java
index 802167b728..0a4d059a54 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink1.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink1.java
@@ -45,7 +45,7 @@ public GenMRRedSink1() {
    * @param nd the reduce sink operator encountered
    * @param opProcCtx context
    */
-  public void process(Node nd, NodeProcessorCtx opProcCtx) throws SemanticException {
+  public Object process(Node nd, NodeProcessorCtx opProcCtx, Object... nodeOutputs) throws SemanticException {
     ReduceSinkOperator op = (ReduceSinkOperator)nd;
     GenMRProcContext ctx = (GenMRProcContext)opProcCtx;
 
@@ -79,6 +79,7 @@ public void process(Node nd, NodeProcessorCtx opProcCtx) throws SemanticExceptio
     }
 
     mapCurrCtx.put(op, new GenMapRedCtx(ctx.getCurrTask(), ctx.getCurrTopOp(), ctx.getCurrAliasId()));
+    return null;
   }
 
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink2.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink2.java
index 149783907f..9001e64ff4 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink2.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRRedSink2.java
@@ -43,7 +43,7 @@ public GenMRRedSink2() {
    * @param nd the reduce sink operator encountered
    * @param opProcCtx context
    */
-  public void process(Node nd, NodeProcessorCtx opProcCtx) throws SemanticException {
+  public Object process(Node nd, NodeProcessorCtx opProcCtx, Object... nodeOutputs) throws SemanticException {
     ReduceSinkOperator op = (ReduceSinkOperator)nd;
     GenMRProcContext ctx = (GenMRProcContext)opProcCtx;
 
@@ -69,6 +69,7 @@ public void process(Node nd, NodeProcessorCtx opProcCtx) throws SemanticExceptio
     }
 
     mapCurrCtx.put(op, new GenMapRedCtx(ctx.getCurrTask(), ctx.getCurrTopOp(), ctx.getCurrAliasId()));
+    return null;
   }
 
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java
index 013f24a5cf..77778bec57 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMRTableScan1.java
@@ -44,7 +44,7 @@ public GenMRTableScan1() {
    * @param nd the table sink operator encountered
    * @param opProcCtx context
    */
-  public void process(Node nd, NodeProcessorCtx opProcCtx) throws SemanticException {
+  public Object process(Node nd, NodeProcessorCtx opProcCtx, Object... nodeOutputs) throws SemanticException {
     TableScanOperator op = (TableScanOperator)nd;
     GenMRProcContext ctx = (GenMRProcContext)opProcCtx;
     ParseContext parseCtx = ctx.getParseCtx();
@@ -62,10 +62,11 @@ public void process(Node nd, NodeProcessorCtx opProcCtx) throws SemanticExceptio
         String currAliasId = alias;
         ctx.setCurrAliasId(currAliasId);
         mapCurrCtx.put(op, new GenMapRedCtx(currTask, currTopOp, currAliasId));
-        return;
+        return null;
       }
     }
     assert false;
+    return null;
   }
 
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/ASTEvent.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/ASTEvent.java
deleted file mode 100644
index e69de29bb2..0000000000
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/ASTEventDispatcher.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/ASTEventDispatcher.java
deleted file mode 100644
index e69de29bb2..0000000000
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/ASTEventProcessor.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/ASTEventProcessor.java
deleted file mode 100644
index e69de29bb2..0000000000
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/ASTProcessor.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/ASTProcessor.java
deleted file mode 100644
index e69de29bb2..0000000000
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/DefaultASTEventDispatcher.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/DefaultASTEventDispatcher.java
deleted file mode 100644
index e69de29bb2..0000000000
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/DefaultASTProcessor.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/DefaultASTProcessor.java
deleted file mode 100644
index e69de29bb2..0000000000
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/DefaultDispatcher.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/DefaultDispatcher.java
deleted file mode 100644
index e69de29bb2..0000000000
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/PartitionPruner.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/PartitionPruner.java
index aeb9cc30dc..85785084b9 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/PartitionPruner.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/PartitionPruner.java
@@ -154,7 +154,7 @@ private exprNodeDesc genExprNodeDesc(ASTNode expr)
         }
 
         // Create function desc
-        desc = SemanticAnalyzer.getXpathOrFuncExprNodeDesc(expr, isFunction, children);
+        desc = TypeCheckProcFactory.DefaultExprProcessor.getXpathOrFuncExprNodeDesc(expr, isFunction, children);
         
         if (desc instanceof exprNodeFuncDesc && (
             ((exprNodeFuncDesc)desc).getUDFMethod().getDeclaringClass().equals(UDFOPAnd.class) 
@@ -245,7 +245,7 @@ public void addExpression(ASTNode expr) throws SemanticException {
       if (this.prunerExpr == null)
         this.prunerExpr = desc;
       else
-        this.prunerExpr = SemanticAnalyzer.getFuncExprNodeDesc("OR", this.prunerExpr, desc);
+        this.prunerExpr = TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("OR", this.prunerExpr, desc);
     }
   }
 
@@ -264,7 +264,7 @@ public void addJoinOnExpression(ASTNode expr) throws SemanticException {
       if (this.prunerExpr == null)
         this.prunerExpr = desc;
       else
-        this.prunerExpr = SemanticAnalyzer.getFuncExprNodeDesc("AND", this.prunerExpr, desc);
+        this.prunerExpr = TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("AND", this.prunerExpr, desc);
     }
   }
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/PrintOpTreeProcessor.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/PrintOpTreeProcessor.java
index eb43eba87b..8153d78ec9 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/PrintOpTreeProcessor.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/PrintOpTreeProcessor.java
@@ -70,14 +70,15 @@ private String getChildren(Operator<? extends Serializable> op) {
     return ret.toString();
   }
   
-  public void process(Node nd, NodeProcessorCtx ctx) throws SemanticException {
+  public Object process(Node nd, NodeProcessorCtx ctx, Object... nodeOutputs) throws SemanticException {
     Operator<? extends Serializable> op = (Operator<? extends Serializable>)nd;
     if (opMap.get(op) == null) {
       opMap.put(op, curNum++);
     }
     out.println("[" + opMap.get(op) + "] " + op.getClass().getName() + " =p=> " + getParents(op) + " =c=> " + getChildren(op));
     if(op.getConf() == null) {
-      return;
+      return null;
     }
+    return null;
   }
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
index 188aef4c14..296f79c8db 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java
@@ -23,7 +23,6 @@
 import java.io.Serializable;
 import java.lang.reflect.Method;
 
-import org.antlr.runtime.tree.*;
 import org.apache.hadoop.hive.serde2.Deserializer;
 import org.apache.hadoop.hive.serde2.MetadataTypedColumnsetSerDe;
 import org.apache.hadoop.hive.serde2.SerDeException;
@@ -35,6 +34,7 @@
 import org.apache.hadoop.hive.metastore.api.FieldSchema;
 import org.apache.hadoop.hive.ql.Context;
 import org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat;
+import org.apache.hadoop.hive.ql.lib.DefaultGraphWalker;
 import org.apache.hadoop.hive.ql.lib.DefaultRuleDispatcher;
 import org.apache.hadoop.hive.ql.lib.Dispatcher;
 import org.apache.hadoop.hive.ql.lib.GraphWalker;
@@ -901,7 +901,7 @@ private Operator genFilterPlan(String dest, QB qb,
 
     Operator output = putOpInsertMap(
       OperatorFactory.getAndMakeChild(
-        new filterDesc(genExprNodeDesc(qb.getMetaData(), (ASTNode)whereExpr.getChild(0), inputRR)),
+        new filterDesc(genExprNodeDesc((ASTNode)whereExpr.getChild(0), inputRR)),
           new RowSchema(inputRR.getColumnInfos()), input), inputRR);
  
     LOG.debug("Created Filter Plan for " + qb.getId() + ":" + dest + " row schema: " + inputRR.toString());
@@ -921,7 +921,7 @@ private Operator genFilterPlan(QB qb, ASTNode condn, Operator input) throws Sema
     RowResolver inputRR = inputCtx.getRR();
     Operator output = putOpInsertMap(
       OperatorFactory.getAndMakeChild(
-        new filterDesc(genExprNodeDesc(qb.getMetaData(), condn, inputRR)),
+        new filterDesc(genExprNodeDesc(condn, inputRR)),
           new RowSchema(inputRR.getColumnInfos()), input), inputRR);
  
     LOG.debug("Created Filter Plan for " + qb.getId() + " row schema: " + inputRR.toString());
@@ -1150,7 +1150,7 @@ private Operator genSelectPlan(String dest, QB qb,
             genColList(tabAlias, alias, expr, col_list, inputRR, pos, out_rwsch);
             selectStar = true;
           } else {
-            exprNodeDesc exp = genExprNodeDesc(qb.getMetaData(), expr, inputRR);
+            exprNodeDesc exp = genExprNodeDesc(expr, inputRR);
             col_list.add(exp);
             if (!StringUtils.isEmpty(alias) &&
                 (out_rwsch.get(null, colAlias) != null)) {
@@ -1164,7 +1164,7 @@ private Operator genSelectPlan(String dest, QB qb,
         }
       } else {
         // Case when this is an expression
-        exprNodeDesc exp = genExprNodeDesc(qb.getMetaData(), sel, inputRR);
+        exprNodeDesc exp = genExprNodeDesc(sel, inputRR);
         col_list.add(exp);
         if (!StringUtils.isEmpty(alias) &&
             (out_rwsch.get(null, colAlias) != null)) {
@@ -1203,36 +1203,58 @@ private Operator genSelectPlan(String dest, QB qb,
    */
   static class UDAFInfo {
     ArrayList<exprNodeDesc> convertedParameters;
-    Method aggregateMethod;
-    Method evaluateMethod;
+    Class<?> retType;
+    Class<? extends UDAFEvaluator> evalClass;
   }
 
   /**
    * Returns the UDAFInfo struct for the aggregation
    * @param aggName  The name of the UDAF.
    * @param mode     The mode of the aggregation. This affects the evaluate method.
-   * @param aggClasses  The classes of the parameters to the UDAF. 
    * @param aggParameters  The actual exprNodeDesc of the parameters.
    * @param aggTree   The ASTNode node of the UDAF in the query.
    * @return UDAFInfo
    * @throws SemanticException when the UDAF is not found or has problems.
    */
-  UDAFInfo getUDAFInfo(String aggName, groupByDesc.Mode mode, ArrayList<Class<?>> aggClasses,
+  UDAFInfo getUDAFInfo(String aggName, groupByDesc.Mode mode,
       ArrayList<exprNodeDesc> aggParameters, ASTNode aggTree) throws SemanticException {
     UDAFInfo r = new UDAFInfo();
-    r.aggregateMethod = FunctionRegistry.getUDAFMethod(aggName, aggClasses);
-    if (null == r.aggregateMethod) {
-      String reason = "Looking for UDAF \"" + aggName + "\" with parameters " + aggClasses;
+    ArrayList<Class<?>> aggClasses = new ArrayList<Class<?>>();
+    for(exprNodeDesc expr: aggParameters) {
+      aggClasses.add(expr.getTypeInfo().getPrimitiveClass());
+    }
+    r.evalClass = FunctionRegistry.getUDAFEvaluator(aggName, aggClasses);
+    if (null == r.evalClass) {
+      String reason = "Looking for UDAF Evaluator\"" + aggName + "\" with parameters " + aggClasses;
+      throw new SemanticException(ErrorMsg.INVALID_FUNCTION_SIGNATURE.getMsg((ASTNode)aggTree.getChild(0), reason));
+    }
+    
+    Method aggregateMethod = null;
+    for(Method m: r.evalClass.getMethods()) {
+      if (m.getName().equalsIgnoreCase("iterate")) {
+        aggregateMethod = m;
+      }
+    }
+    
+    if (null == aggregateMethod) {
+      String reason = "Looking for UDAF Evaluator Iterator\"" + aggName + "\" with parameters " + aggClasses;
       throw new SemanticException(ErrorMsg.INVALID_FUNCTION_SIGNATURE.getMsg((ASTNode)aggTree.getChild(0), reason));
     }
 
-    r.convertedParameters = convertParameters(r.aggregateMethod, aggParameters);
+    r.convertedParameters = convertParameters(aggregateMethod, aggParameters);
     
-    r.evaluateMethod = FunctionRegistry.getUDAFEvaluateMethod(aggName, mode);
-    if (r.evaluateMethod == null) {
-      String reason = "UDAF \"" + aggName + "\" does not have evaluate()/evaluatePartial() methods.";
+    Method evaluateMethod = FunctionRegistry.getUDAFEvaluateMethod(aggName, mode);
+    String funcName = (mode == groupByDesc.Mode.COMPLETE || mode == groupByDesc.Mode.FINAL) ? "terminate" : "terminatePartial";
+    for(Method m: r.evalClass.getMethods()) {
+      if (m.getName().equalsIgnoreCase(funcName)) {
+        evaluateMethod = m;
+      }
+    }
+    if (evaluateMethod == null) {
+      String reason = "UDAF \"" + aggName + "\" does not have terminate()/terminatePartial() methods.";
       throw new SemanticException(ErrorMsg.INVALID_FUNCTION.getMsg((ASTNode)aggTree.getChild(0), reason)); 
     }
+    r.retType = evaluateMethod.getReturnType();
     
     return r;
   }
@@ -1279,7 +1301,6 @@ private Operator genGroupByPlanGroupByOperator(
       Class<? extends UDAF> aggClass = FunctionRegistry.getUDAF(aggName);
       assert (aggClass != null);
       ArrayList<exprNodeDesc> aggParameters = new ArrayList<exprNodeDesc>();
-      ArrayList<Class<?>> aggClasses = new ArrayList<Class<?>>();
       // 0 is the function name
       for (int i = 1; i < value.getChildCount(); i++) {
         String text = value.getChild(i).toStringTree();
@@ -1292,16 +1313,15 @@ private Operator genGroupByPlanGroupByOperator(
         String paraExpression = paraExprInfo.getInternalName();
         assert(paraExpression != null);
         aggParameters.add(new exprNodeColumnDesc(paraExprInfo.getType(), paraExprInfo.getInternalName()));
-        aggClasses.add(paraExprInfo.getType().getPrimitiveClass());
       }
 
-      UDAFInfo udaf = getUDAFInfo(aggName, mode, aggClasses, aggParameters, value);
+      UDAFInfo udaf = getUDAFInfo(aggName, mode, aggParameters, value);
       
-      aggregations.add(new aggregationDesc(aggClass, udaf.convertedParameters,
+      aggregations.add(new aggregationDesc(udaf.evalClass, udaf.convertedParameters,
           value.getToken().getType() == HiveParser.TOK_FUNCTIONDI));
       groupByOutputRowResolver.put("",value.toStringTree(),
                                    new ColumnInfo(Integer.valueOf(groupByKeys.size() + aggregations.size() -1).toString(),
-                                       udaf.evaluateMethod.getReturnType()));
+                                       udaf.retType));
     }
 
     return 
@@ -1352,12 +1372,9 @@ private Operator genGroupByPlanGroupByOperator1(
       String aggName = value.getChild(0).getText();
       Class<? extends UDAF> aggClass = FunctionRegistry.getUDAF(aggName);
       assert (aggClass != null);
-      Method aggEvaluateMethod = null;
-      ArrayList<exprNodeDesc> aggParameters = null;
+      ArrayList<exprNodeDesc> aggParameters = new ArrayList<exprNodeDesc>();
 
       if (value.getToken().getType() == HiveParser.TOK_FUNCTIONDI) {
-        ArrayList<Class<?>> aggClasses = new ArrayList<Class<?>>();
-        ArrayList<exprNodeDesc> params = new ArrayList<exprNodeDesc>();
         // 0 is the function name
         for (int i = 1; i < value.getChildCount(); i++) {
           String text = value.getChild(i).toStringTree();
@@ -1369,17 +1386,11 @@ private Operator genGroupByPlanGroupByOperator1(
 
           String paraExpression = paraExprInfo.getInternalName();
           assert(paraExpression != null);
-          params.add(new exprNodeColumnDesc(paraExprInfo.getType(), paraExprInfo.getInternalName()));
-          aggClasses.add(paraExprInfo.getType().getPrimitiveClass());
+          aggParameters.add(new exprNodeColumnDesc(paraExprInfo.getType(), paraExprInfo.getInternalName()));
         }
         
-        UDAFInfo udaf = getUDAFInfo(aggName, mode, aggClasses, params, value);
-        aggParameters = udaf.convertedParameters;
-        aggEvaluateMethod = udaf.evaluateMethod;
       }
       else {
-        aggParameters = new ArrayList<exprNodeDesc>();
-        aggEvaluateMethod = FunctionRegistry.getUDAFEvaluateMethod(aggName, mode);
         String text = entry.getKey();
         ColumnInfo paraExprInfo = groupByInputRowResolver.get("",text);
         if (paraExprInfo == null) {
@@ -1390,10 +1401,12 @@ private Operator genGroupByPlanGroupByOperator1(
         aggParameters.add(new exprNodeColumnDesc(paraExprInfo.getType(), paraExpression));
       }
 
-      aggregations.add(new aggregationDesc(aggClass, aggParameters, ((mode == groupByDesc.Mode.FINAL) ? false : (value.getToken().getType() == HiveParser.TOK_FUNCTIONDI))));
+      UDAFInfo udaf = getUDAFInfo(aggName, mode, aggParameters, value);
+      aggregations.add(new aggregationDesc(udaf.evalClass, udaf.convertedParameters, 
+          ((mode == groupByDesc.Mode.FINAL) ? false : (value.getToken().getType() == HiveParser.TOK_FUNCTIONDI))));
       groupByOutputRowResolver.put("", value.toStringTree(),
                                     new ColumnInfo(Integer.valueOf(groupByKeys.size() + aggregations.size() - 1).toString(),
-                                        aggEvaluateMethod.getReturnType()));
+                                        udaf.retType));
     }
 
     return putOpInsertMap(
@@ -1423,7 +1436,7 @@ private Operator genGroupByPlanMapGroupByOperator(QB qb, String dest, Operator i
     List<ASTNode> grpByExprs = getGroupByForClause(parseInfo, dest);
     for (int i = 0; i < grpByExprs.size(); ++i) {
       ASTNode grpbyExpr = grpByExprs.get(i);
-      exprNodeDesc grpByExprNode = genExprNodeDesc(qb.getMetaData(), grpbyExpr, groupByInputRowResolver);
+      exprNodeDesc grpByExprNode = genExprNodeDesc(grpbyExpr, groupByInputRowResolver);
 
       groupByKeys.add(grpByExprNode);
       String field = (Integer.valueOf(i)).toString();
@@ -1440,7 +1453,7 @@ private Operator genGroupByPlanMapGroupByOperator(QB qb, String dest, Operator i
         ASTNode parameter = (ASTNode) value.getChild(i);
         String text = parameter.toStringTree();
         if (groupByOutputRowResolver.get("",text) == null) {
-          exprNodeDesc distExprNode = genExprNodeDesc(qb.getMetaData(), parameter, groupByInputRowResolver);
+          exprNodeDesc distExprNode = genExprNodeDesc(parameter, groupByInputRowResolver);
           groupByKeys.add(distExprNode);
           numDistn++;
           String field = (Integer.valueOf(grpByExprs.size() + numDistn -1)).toString();
@@ -1464,19 +1477,18 @@ private Operator genGroupByPlanMapGroupByOperator(QB qb, String dest, Operator i
       // 0 is the function name
       for (int i = 1; i < value.getChildCount(); i++) {
         ASTNode paraExpr = (ASTNode)value.getChild(i);
-        exprNodeDesc paraExprNode = genExprNodeDesc(qb.getMetaData(), paraExpr, groupByInputRowResolver);
+        exprNodeDesc paraExprNode = genExprNodeDesc(paraExpr, groupByInputRowResolver);
 
         aggParameters.add(paraExprNode);
-        aggClasses.add(paraExprNode.getTypeInfo().getPrimitiveClass());
       }
 
-      UDAFInfo udaf = getUDAFInfo(aggName, mode, aggClasses, aggParameters, value);
+      UDAFInfo udaf = getUDAFInfo(aggName, mode, aggParameters, value);
       
-      aggregations.add(new aggregationDesc(aggClass, udaf.convertedParameters,
+      aggregations.add(new aggregationDesc(udaf.evalClass, udaf.convertedParameters,
                                            value.getToken().getType() == HiveParser.TOK_FUNCTIONDI));
       groupByOutputRowResolver.put("",value.toStringTree(),
                                    new ColumnInfo(Integer.valueOf(groupByKeys.size() + aggregations.size() -1).toString(),
-                                       udaf.evaluateMethod.getReturnType()));
+                                       udaf.retType));
     }
 
     return putOpInsertMap(
@@ -1506,7 +1518,7 @@ private ArrayList<exprNodeDesc> convertParameters(Method m, ArrayList<exprNodeDe
         Class<?> from = desc.getTypeInfo().getPrimitiveClass();
         Class<?> to = pType;
         assert(FunctionRegistry.implicitConvertable(from, to));
-        Method conv = FunctionRegistry.getUDFMethod(to.getName(), true, from);
+        Method conv = FunctionRegistry.getUDFMethod(to.getName(), from);
         assert(conv != null);
         Class<? extends UDF> c = FunctionRegistry.getUDFClass(to.getName());
         assert(c != null);
@@ -1635,7 +1647,7 @@ private Operator genGroupByPlanReduceSinkOperator(QB qb,
     List<ASTNode> grpByExprs = getGroupByForClause(parseInfo, dest);
     for (int i = 0; i < grpByExprs.size(); ++i) {
       ASTNode grpbyExpr = grpByExprs.get(i);
-      reduceKeys.add(genExprNodeDesc(qb.getMetaData(), grpbyExpr, reduceSinkInputRowResolver));
+      reduceKeys.add(genExprNodeDesc(grpbyExpr, reduceSinkInputRowResolver));
       String text = grpbyExpr.toStringTree();
       if (reduceSinkOutputRowResolver.get("", text) == null) {
         reduceSinkOutputRowResolver.put("", text,
@@ -1654,7 +1666,7 @@ private Operator genGroupByPlanReduceSinkOperator(QB qb,
         ASTNode parameter = (ASTNode) value.getChild(i);
         String text = parameter.toStringTree();
         if (reduceSinkOutputRowResolver.get("",text) == null) {
-          reduceKeys.add(genExprNodeDesc(qb.getMetaData(), parameter, reduceSinkInputRowResolver));
+          reduceKeys.add(genExprNodeDesc(parameter, reduceSinkInputRowResolver));
           reduceSinkOutputRowResolver.put("", text,
                                           new ColumnInfo(Utilities.ReduceField.KEY.toString() + "." + Integer.valueOf(reduceKeys.size() - 1).toString(),
                                               reduceKeys.get(reduceKeys.size()-1).getTypeInfo()));
@@ -1673,7 +1685,7 @@ private Operator genGroupByPlanReduceSinkOperator(QB qb,
         ASTNode parameter = (ASTNode) value.getChild(i);
         String text = parameter.toStringTree();
         if (reduceSinkOutputRowResolver.get("",text) == null) {
-          reduceValues.add(genExprNodeDesc(qb.getMetaData(), parameter, reduceSinkInputRowResolver));
+          reduceValues.add(genExprNodeDesc(parameter, reduceSinkInputRowResolver));
           reduceSinkOutputRowResolver.put("", text,
                                           new ColumnInfo(Utilities.ReduceField.VALUE.toString() + "." + Integer.valueOf(reduceValues.size() - 1).toString(),
                                               reduceValues.get(reduceValues.size()-1).getTypeInfo()));
@@ -1783,12 +1795,9 @@ private Operator genGroupByPlanGroupByOperator2MR(
     HashMap<String, ASTNode> aggregationTrees = parseInfo
         .getAggregationExprsForClause(dest);
     for (Map.Entry<String, ASTNode> entry : aggregationTrees.entrySet()) {
-      ASTNode value = entry.getValue();
-      String aggName = value.getChild(0).getText();
-      Class<? extends UDAF> aggClass = FunctionRegistry.getUDAF(aggName);
-      Method aggEvaluateMethod = FunctionRegistry.getUDAFEvaluateMethod(aggName, mode);
-      assert (aggClass != null);
       ArrayList<exprNodeDesc> aggParameters = new ArrayList<exprNodeDesc>();
+      ArrayList<Class<?>> aggParamTypes = new ArrayList<Class<?>>();
+      ASTNode value = entry.getValue();
       String text = entry.getKey();
       ColumnInfo paraExprInfo = groupByInputRowResolver2.get("",text);
       if (paraExprInfo == null) {
@@ -1797,10 +1806,18 @@ private Operator genGroupByPlanGroupByOperator2MR(
       String paraExpression = paraExprInfo.getInternalName();
       assert(paraExpression != null);
       aggParameters.add(new exprNodeColumnDesc(paraExprInfo.getType(), paraExpression));
-      aggregations.add(new aggregationDesc(aggClass, aggParameters, ((mode == groupByDesc.Mode.FINAL) ? false : (value.getToken().getType() == HiveParser.TOK_FUNCTIONDI))));
+      aggParamTypes.add(paraExprInfo.getType().getPrimitiveClass());
+
+      String aggName = value.getChild(0).getText();
+      Class<? extends UDAF> aggClass = FunctionRegistry.getUDAF(aggName);
+      assert (aggClass != null);
+
+      UDAFInfo udaf = getUDAFInfo(aggName, mode, aggParameters, value);      
+      aggregations.add(new aggregationDesc(udaf.evalClass, udaf.convertedParameters, 
+                                           ((mode == groupByDesc.Mode.FINAL) ? false : (value.getToken().getType() == HiveParser.TOK_FUNCTIONDI))));
       groupByOutputRowResolver2.put("", value.toStringTree(),
                                     new ColumnInfo(Integer.valueOf(groupByKeys.size() + aggregations.size() - 1).toString(),
-                                        aggEvaluateMethod.getReturnType()));
+                                        udaf.retType));
     }
 
     return putOpInsertMap(
@@ -2099,7 +2116,7 @@ Operator genConversionSelectOperator(String dest, QB qb,
             // cannot convert to complex types
             column = null; 
           } else {
-            column = getFuncExprNodeDesc(tableFieldTypeInfo.getPrimitiveClass().getName(), column);
+            column = TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc(tableFieldTypeInfo.getPrimitiveClass().getName(), column);
           }
           if (column == null) {
             String reason = "Cannot convert column " + i + " from " + rowFieldTypeInfo + " to " 
@@ -2183,7 +2200,7 @@ private Operator genReduceSinkPlan(String dest, QB qb,
       int ccount = partitionExprs.getChildCount();
       for(int i=0; i<ccount; ++i) {
         ASTNode cl = (ASTNode)partitionExprs.getChild(i);
-        partitionCols.add(genExprNodeDescFromColRef(cl, inputRR));
+        partitionCols.add(genExprNodeDesc(cl, inputRR));
       }
     }
 
@@ -2212,7 +2229,7 @@ private Operator genReduceSinkPlan(String dest, QB qb,
           order.append("+");
         }
 
-        sortCols.add(genExprNodeDescFromColRef(cl, inputRR));
+        sortCols.add(genExprNodeDesc(cl, inputRR));
       }
     }
 
@@ -2312,7 +2329,7 @@ private Operator genJoinReduceSinkChild(QB qb, QBJoinTree joinTree,
     Vector<ASTNode> exprs = joinTree.getExpressions().get(pos);
     for (int i = 0; i < exprs.size(); i++) {
       ASTNode expr = exprs.get(i);
-      reduceKeys.add(genExprNodeDesc(qb.getMetaData(), expr, inputRS));
+      reduceKeys.add(genExprNodeDesc(expr, inputRS));
     }
 
     // Walk over the input row resolver and copy in the output
@@ -2403,7 +2420,7 @@ private void genJoinOperatorTypeCheck(Operator left, Operator[] right) throws Se
       // Add implicit type conversion if necessary
       for(int i=0; i<right.length; i++) {
         if (!commonClass.isAssignableFrom(keys.get(i).get(k).getTypeInfo().getPrimitiveClass())) {
-          keys.get(i).set(k, getFuncExprNodeDesc(commonClass.getName(), keys.get(i).get(k)));
+          keys.get(i).set(k, TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc(commonClass.getName(), keys.get(i).get(k)));
         }
       }
     }
@@ -2842,21 +2859,21 @@ private exprNodeDesc genSamplePredicate(TableSample ts, List<String> bucketCols,
     }
     else {
       for(ASTNode expr: ts.getExprs()) {
-    	  args.add(genExprNodeDesc(qbm, expr, rwsch));
+    	  args.add(genExprNodeDesc(expr, rwsch));
       }
     }
 
-    exprNodeDesc hashfnExpr = getFuncExprNodeDesc("default_sample_hashfn", args);
+    exprNodeDesc hashfnExpr = TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("default_sample_hashfn", args);
     assert(hashfnExpr != null);
     LOG.info("hashfnExpr = " + hashfnExpr);
-    exprNodeDesc andExpr = getFuncExprNodeDesc("&", hashfnExpr, intMaxExpr);
+    exprNodeDesc andExpr = TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("&", hashfnExpr, intMaxExpr);
     assert(andExpr != null);
     LOG.info("andExpr = " + andExpr);
-    exprNodeDesc modExpr = getFuncExprNodeDesc("%", andExpr, denominatorExpr);
+    exprNodeDesc modExpr = TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("%", andExpr, denominatorExpr);
     assert(modExpr != null);
     LOG.info("modExpr = " + modExpr);
     LOG.info("numeratorExpr = " + numeratorExpr);
-    exprNodeDesc equalsExpr = getFuncExprNodeDesc("==", modExpr, numeratorExpr);
+    exprNodeDesc equalsExpr = TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("==", modExpr, numeratorExpr);
     LOG.info("equalsExpr = " + equalsExpr);
     assert(equalsExpr != null);
     return equalsExpr;
@@ -3159,7 +3176,7 @@ private void genMapRedTasks(QB qb) throws SemanticException {
     GraphWalker ogw = new GenMapRedWalker(disp);
     ArrayList<Node> topNodes = new ArrayList<Node>();
     topNodes.addAll(this.topOps.values());
-    ogw.startWalking(topNodes);
+    ogw.startWalking(topNodes, null);
 
     // reduce sink does not have any kids
     breakOperatorTree(procCtx.getRootOps());
@@ -3240,379 +3257,65 @@ public void analyzeInternal(ASTNode ast, Context ctx) throws SemanticException {
 
     return;
   }
-  
-  /**
-   * Get the exprNodeDesc
-   * @param name
-   * @param children
-   * @return
-   */
-  public static exprNodeDesc getFuncExprNodeDesc(String name, exprNodeDesc... children) {
-    return getFuncExprNodeDesc(name, Arrays.asList(children));
-  }
-  
-  /**
-   * This function create an ExprNodeDesc for a UDF function given the children (arguments).
-   * It will insert implicit type conversion functions if necessary. 
-   * @throws SemanticException 
-   */
-  public static exprNodeDesc getFuncExprNodeDesc(String udfName, List<exprNodeDesc> children) {
-    // Find the corresponding method
-    ArrayList<Class<?>> argumentClasses = new ArrayList<Class<?>>(children.size());
-    for(int i=0; i<children.size(); i++) {
-      exprNodeDesc child = children.get(i);
-      assert(child != null);
-      TypeInfo childTypeInfo = child.getTypeInfo();
-      assert(childTypeInfo != null);
-      
-      // Note: we don't pass the element types of MAP/LIST to UDF.
-      // That will work for null test and size but not other more complex functionalities like list slice etc.
-      // For those more complex functionalities, we plan to have a ComplexUDF interface which has an evaluate
-      // method that accepts a list of objects and a list of objectinspectors. 
-      switch (childTypeInfo.getCategory()) {
-        case PRIMITIVE: {
-          argumentClasses.add(childTypeInfo.getPrimitiveClass());
-          break;
-        }
-        case MAP: {
-          argumentClasses.add(Map.class);
-          break;
-        }
-        case LIST: {
-          argumentClasses.add(List.class);
-          break;
-        }
-        case STRUCT: {
-          argumentClasses.add(Object.class);
-          break;
-        }
-        default: {
-          // should never happen
-          assert(false);
-        }
-      }
-    }
-    Method udfMethod = FunctionRegistry.getUDFMethod(udfName, false, argumentClasses);
-    if (udfMethod == null) return null;
-
-    ArrayList<exprNodeDesc> ch = new ArrayList<exprNodeDesc>();
-    Class<?>[] pTypes = udfMethod.getParameterTypes();
-
-    for (int i = 0; i < children.size(); i++)
-    {
-      exprNodeDesc desc = children.get(i);
-      Class<?> pType = ObjectInspectorUtils.generalizePrimitive(pTypes[i]);
-      if (desc instanceof exprNodeNullDesc) {
-        exprNodeConstantDesc newCh = new exprNodeConstantDesc(TypeInfoFactory.getPrimitiveTypeInfo(pType), null);
-        ch.add(newCh);
-      } else if (pType.isAssignableFrom(argumentClasses.get(i))) {
-        // no type conversion needed
-        ch.add(desc);
-      } else {
-        // must be implicit type conversion
-        Class<?> from = argumentClasses.get(i);
-        Class<?> to = pType;
-        assert(FunctionRegistry.implicitConvertable(from, to));
-        Method m = FunctionRegistry.getUDFMethod(to.getName(), true, from);
-        assert(m != null);
-        Class<? extends UDF> c = FunctionRegistry.getUDFClass(to.getName());
-        assert(c != null);
-
-        // get the conversion method
-        ArrayList<exprNodeDesc> conversionArg = new ArrayList<exprNodeDesc>(1);
-        conversionArg.add(desc);
-        ch.add(new exprNodeFuncDesc(
-              TypeInfoFactory.getPrimitiveTypeInfo(pType),
-              c, m, conversionArg));
-      }
-    }
-
-    exprNodeFuncDesc desc = new exprNodeFuncDesc(
-      TypeInfoFactory.getPrimitiveTypeInfo(udfMethod.getReturnType()),
-      FunctionRegistry.getUDFClass(udfName),
-      udfMethod, ch);
-    return desc;
-  }
-
 
   /**
    * Generates and expression node descriptor for the expression passed in the arguments. This
    * function uses the row resolver and the metadata informatinon that are passed as arguments
    * to resolve the column names to internal names.
-   * @param qbm The metadata infromation for the query block
    * @param expr The expression
    * @param input The row resolver
    * @return exprNodeDesc
    * @throws SemanticException
    */
   @SuppressWarnings("nls")
-  private exprNodeDesc genExprNodeDesc(QBMetaData qbm, ASTNode expr, RowResolver input)
+  private exprNodeDesc genExprNodeDesc(ASTNode expr, RowResolver input)
   throws SemanticException {
     //  We recursively create the exprNodeDesc.  Base cases:  when we encounter 
     //  a column ref, we convert that into an exprNodeColumnDesc;  when we encounter 
     //  a constant, we convert that into an exprNodeConstantDesc.  For others we just 
     //  build the exprNodeFuncDesc with recursively built children.
     
-    exprNodeDesc desc = null;
-
     //  If the current subExpression is pre-calculated, as in Group-By etc.
     ColumnInfo colInfo = input.get("", expr.toStringTree());
     if (colInfo != null) {
-      desc = new exprNodeColumnDesc(colInfo.getType(), colInfo.getInternalName()); 
-      return desc;
+      return new exprNodeColumnDesc(colInfo.getType(), colInfo.getInternalName());
     }
 
-    //  Is this a simple expr node (not a TOK_COLREF or a TOK_FUNCTION or an operator)?
-    desc = genSimpleExprNodeDesc(expr);
-    if (desc != null) {
-      return desc;
-    }
+    // Create the walker, the rules dispatcher and the context.
+    TypeCheckCtx tcCtx = new TypeCheckCtx(input);
     
-    int tokType = expr.getType();
-    switch (tokType) {
-      case HiveParser.TOK_COLREF: {
-        desc = genExprNodeDescFromColRef(expr, input);
-        break;
-      }
-  
-      default: {
-        boolean isFunction = (expr.getType() == HiveParser.TOK_FUNCTION);
-        
-        // Create all children
-        int childrenBegin = (isFunction ? 1 : 0);
-        ArrayList<exprNodeDesc> children = new ArrayList<exprNodeDesc>(expr.getChildCount() - childrenBegin);
-        for (int ci=childrenBegin; ci<expr.getChildCount(); ci++) {
-          children.add(genExprNodeDesc(qbm, (ASTNode)expr.getChild(ci), input));
-        }
-        
-        // Create function desc
-        desc = getXpathOrFuncExprNodeDesc(expr, isFunction, children);
-        break;
-      }
-    }
-    assert(desc != null);
-    return desc;
-  }
-
-  /**
-   * Generates expression node from a TOK_COLREF AST Node
-   * @param expr Antrl node
-   * @param input row resolver for this col reference
-   * @return exprNodeDesc or null if ASTNode is not a TOK_COLREF
-   * @throws SemanticException
-   */
-  private exprNodeDesc genExprNodeDescFromColRef(ASTNode expr, RowResolver input)
-      throws SemanticException {
-    if(expr.getType() != HiveParser.TOK_COLREF) {
-      throw new SemanticException(ErrorMsg.INVALID_COLUMN.getMsg(expr));
-    }
-    exprNodeDesc desc;
-    ColumnInfo colInfo;
-    String tabAlias = null;
-    String colName = null;
-    if (expr.getChildCount() != 1) {
-      tabAlias = unescapeIdentifier(expr.getChild(0).getText());
-      colName = unescapeIdentifier(expr.getChild(1).getText());
-    }
-    else {
-      colName = unescapeIdentifier(expr.getChild(0).getText());
-    }
-
-    if (colName == null) {
-      throw new SemanticException(ErrorMsg.INVALID_XPATH.getMsg(expr));
-    }
-
-    colInfo = input.get(tabAlias, colName);
+    // create a walker which walks the tree in a DFS manner while maintaining the operator stack. The dispatcher
+    // generates the plan from the operator tree
+    Map<Rule, NodeProcessor> opRules = new LinkedHashMap<Rule, NodeProcessor>();
+    StringBuilder sb = new StringBuilder();
+    Formatter fm = new Formatter(sb);
+    opRules.put(new RuleRegExp("R1", HiveParser.TOK_NULL + "%"), TypeCheckProcFactory.getNullExprProcessor());
+    opRules.put(new RuleRegExp("R2", HiveParser.Number + "%"), TypeCheckProcFactory.getNumExprProcessor());
+    opRules.put(new RuleRegExp("R3", HiveParser.Identifier + "%|" + 
+                                     HiveParser.StringLiteral + "%|" + 
+                                     HiveParser.TOK_CHARSETLITERAL + "%"), 
+                               TypeCheckProcFactory.getStrExprProcessor());
+    opRules.put(new RuleRegExp("R4", HiveParser.KW_TRUE + "%|" + HiveParser.KW_FALSE + "%"), 
+                               TypeCheckProcFactory.getBoolExprProcessor());
+    opRules.put(new RuleRegExp("R4", HiveParser.TOK_COLREF + "%"), TypeCheckProcFactory.getColumnExprProcessor());
 
-    if (colInfo == null && input.getIsExprResolver()) {
-      throw new SemanticException(ErrorMsg.NON_KEY_EXPR_IN_GROUPBY.getMsg(expr));
-    }         
-    else if (tabAlias != null && !input.hasTableAlias(tabAlias)) {
-      throw new SemanticException(ErrorMsg.INVALID_TABLE_ALIAS.getMsg(expr.getChild(0)));
-    } else if (colInfo == null) {
-      throw new SemanticException(ErrorMsg.INVALID_COLUMN.getMsg(tabAlias == null? expr.getChild(0) : expr.getChild(1)));
+    // The dispatcher fires the processor corresponding to the closest matching rule and passes the context along
+    Dispatcher disp = new DefaultRuleDispatcher(TypeCheckProcFactory.getDefaultExprProcessor(), opRules, tcCtx);
+    GraphWalker ogw = new DefaultGraphWalker(disp);
+   
+    // Create a list of topop nodes
+    ArrayList<Node> topNodes = new ArrayList<Node>();
+    topNodes.add(expr);
+    HashMap<Node, Object> nodeOutputs = new HashMap<Node, Object>();
+    ogw.startWalking(topNodes, nodeOutputs);
+    exprNodeDesc desc = (exprNodeDesc)nodeOutputs.get(expr);
+    if (desc == null) {
+      throw new SemanticException(tcCtx.getError());
     }
 
-    desc = new exprNodeColumnDesc(colInfo.getType(), colInfo.getInternalName());
     return desc;
   }
-
-  static HashMap<Integer, String> specialUnaryOperatorTextHashMap;
-  static HashMap<Integer, String> specialFunctionTextHashMap;
-  static HashMap<Integer, String> conversionFunctionTextHashMap;
-  static {
-    specialUnaryOperatorTextHashMap = new HashMap<Integer, String>();
-    specialUnaryOperatorTextHashMap.put(HiveParser.PLUS, "positive");
-    specialUnaryOperatorTextHashMap.put(HiveParser.MINUS, "negative");
-    specialFunctionTextHashMap = new HashMap<Integer, String>();
-    specialFunctionTextHashMap.put(HiveParser.TOK_ISNULL, "isnull");
-    specialFunctionTextHashMap.put(HiveParser.TOK_ISNOTNULL, "isnotnull");
-    conversionFunctionTextHashMap = new HashMap<Integer, String>();
-    conversionFunctionTextHashMap.put(HiveParser.TOK_BOOLEAN, Boolean.class.getName());
-    conversionFunctionTextHashMap.put(HiveParser.TOK_TINYINT, Byte.class.getName());
-    conversionFunctionTextHashMap.put(HiveParser.TOK_SMALLINT, Short.class.getName());
-    conversionFunctionTextHashMap.put(HiveParser.TOK_INT, Integer.class.getName());
-    conversionFunctionTextHashMap.put(HiveParser.TOK_BIGINT, Long.class.getName());
-    conversionFunctionTextHashMap.put(HiveParser.TOK_FLOAT, Float.class.getName());
-    conversionFunctionTextHashMap.put(HiveParser.TOK_DOUBLE, Double.class.getName());
-    conversionFunctionTextHashMap.put(HiveParser.TOK_STRING, String.class.getName());
-    conversionFunctionTextHashMap.put(HiveParser.TOK_DATE, java.sql.Date.class.getName());
-  }
-  
-  public static boolean isRedundantConversionFunction(ASTNode expr, boolean isFunction, ArrayList<exprNodeDesc> children) {
-    if (!isFunction) return false;
-    // children is always one less than the expr.getChildCount(), since the latter contains function name.
-    assert(children.size() == expr.getChildCount() - 1);
-    // conversion functions take a single parameter
-    if (children.size() != 1) return false;
-    String funcText = conversionFunctionTextHashMap.get(((ASTNode)expr.getChild(0)).getType());
-    // not a conversion function 
-    if (funcText == null) return false;
-    // return true when the child type and the conversion target type is the same
-    return children.get(0).getTypeInfo().getPrimitiveClass().getName().equals(funcText);
-  }
-  
-  public static String getFunctionText(ASTNode expr, boolean isFunction) {
-    String funcText = null;
-    if (!isFunction) {
-      // For operator, the function name is the operator text, unless it's in our special dictionary
-      if (expr.getChildCount() == 1) {
-        funcText = specialUnaryOperatorTextHashMap.get(expr.getType());
-      }
-      if (funcText == null) {
-        funcText = expr.getText();
-      }
-    } else {
-      // For TOK_FUNCTION, the function name is stored in the first child, unless it's in our
-      // special dictionary.
-      assert(expr.getChildCount() >= 1);
-      int funcType = ((ASTNode)expr.getChild(0)).getType();
-      funcText = specialFunctionTextHashMap.get(funcType);
-      if (funcText == null) {
-        funcText = conversionFunctionTextHashMap.get(funcType);
-      }
-      if (funcText == null) {
-        funcText = ((ASTNode)expr.getChild(0)).getText();
-      }
-    }
-    return funcText;
-  }
   
-  static exprNodeDesc getXpathOrFuncExprNodeDesc(ASTNode expr, boolean isFunction,
-      ArrayList<exprNodeDesc> children)
-      throws SemanticException {
-    // return the child directly if the conversion is redundant.
-    if (isRedundantConversionFunction(expr, isFunction, children)) {
-      assert(children.size() == 1);
-      assert(children.get(0) != null);
-      return children.get(0);
-    }
-    String funcText = getFunctionText(expr, isFunction);
-    exprNodeDesc desc;
-    if (funcText.equals(".")) {
-      // "." :  FIELD Expression
-      assert(children.size() == 2);
-      // Only allow constant field name for now
-      assert(children.get(1) instanceof exprNodeConstantDesc);
-      exprNodeDesc object = children.get(0);
-      exprNodeConstantDesc fieldName = (exprNodeConstantDesc)children.get(1);
-      assert(fieldName.getValue() instanceof String);
-      
-      // Calculate result TypeInfo
-      String fieldNameString = (String)fieldName.getValue();
-      TypeInfo objectTypeInfo = object.getTypeInfo();
-      
-      // Allow accessing a field of list element structs directly from a list  
-      boolean isList = (object.getTypeInfo().getCategory() == ObjectInspector.Category.LIST);
-      if (isList) {
-        objectTypeInfo = objectTypeInfo.getListElementTypeInfo();
-      }
-      if (objectTypeInfo.getCategory() != Category.STRUCT) {
-        throw new SemanticException(ErrorMsg.INVALID_DOT.getMsg(expr));
-      }
-      TypeInfo t = objectTypeInfo.getStructFieldTypeInfo(fieldNameString);
-      if (isList) {
-        t = TypeInfoFactory.getListTypeInfo(t);
-      }
-      
-      desc = new exprNodeFieldDesc(t, children.get(0), fieldNameString, isList);
-      
-    } else if (funcText.equals("[")){
-      // "[]" : LSQUARE/INDEX Expression
-      assert(children.size() == 2);
-      
-      // Check whether this is a list or a map
-      TypeInfo myt = children.get(0).getTypeInfo();
-
-      if (myt.getCategory() == Category.LIST) {
-        // Only allow constant integer index for now
-        if (!(children.get(1) instanceof exprNodeConstantDesc)
-            || !(((exprNodeConstantDesc)children.get(1)).getValue() instanceof Integer)) {
-          throw new SemanticException(ErrorMsg.INVALID_ARRAYINDEX_CONSTANT.getMsg(expr));
-        }
-      
-        // Calculate TypeInfo
-        TypeInfo t = myt.getListElementTypeInfo();
-        desc = new exprNodeIndexDesc(t, children.get(0), children.get(1));
-      }
-      else if (myt.getCategory() == Category.MAP) {
-        // Only allow only constant indexes for now
-        if (!(children.get(1) instanceof exprNodeConstantDesc)) {
-          throw new SemanticException(ErrorMsg.INVALID_MAPINDEX_CONSTANT.getMsg(expr));
-        }
-        if (!(((exprNodeConstantDesc)children.get(1)).getValue().getClass() == 
-              myt.getMapKeyTypeInfo().getPrimitiveClass())) {
-          throw new SemanticException(ErrorMsg.INVALID_MAPINDEX_TYPE.getMsg(expr));
-        }
-        // Calculate TypeInfo
-        TypeInfo t = myt.getMapValueTypeInfo();
-        
-        desc = new exprNodeIndexDesc(t, children.get(0), children.get(1));
-      }
-      else {
-        throw new SemanticException(ErrorMsg.NON_COLLECTION_TYPE.getMsg(expr, 
-            myt.getTypeName()));
-      }
-    } else {
-      // other operators or functions
-      Class<? extends UDF> udf = FunctionRegistry.getUDFClass(funcText);
-      if (udf == null) {
-      	if (isFunction)
-          throw new SemanticException(ErrorMsg.INVALID_FUNCTION.getMsg((ASTNode)expr.getChild(0)));
-      	else
-          throw new SemanticException(ErrorMsg.INVALID_FUNCTION.getMsg((ASTNode)expr));
-      }
-      
-      desc = getFuncExprNodeDesc(funcText, children);
-      if (desc == null) {
-        ArrayList<Class<?>> argumentClasses = new ArrayList<Class<?>>(children.size());
-        for(int i=0; i<children.size(); i++) {
-          argumentClasses.add(children.get(i).getTypeInfo().getPrimitiveClass());
-        }
-  
-        if (isFunction) {
-          String reason = "Looking for UDF \"" + expr.getChild(0).getText() + "\" with parameters " + argumentClasses;
-          throw new SemanticException(ErrorMsg.INVALID_FUNCTION_SIGNATURE.getMsg((ASTNode)expr.getChild(0), reason));
-        } else {
-          String reason = "Looking for Operator \"" + expr.getText() + "\" with parameters " + argumentClasses;
-          throw new SemanticException(ErrorMsg.INVALID_OPERATOR_SIGNATURE.getMsg(expr, reason));
-        }
-      }
-    }
-    // UDFOPPositive is a no-op.
-    // However, we still create it, and then remove it here, to make sure we only allow
-    // "+" for numeric types.
-    if (desc instanceof exprNodeFuncDesc) {
-      exprNodeFuncDesc funcDesc = (exprNodeFuncDesc)desc;
-      if (funcDesc.getUDFClass().equals(UDFOPPositive.class)) {
-        assert(funcDesc.getChildren().size() == 1);
-        desc = funcDesc.getChildren().get(0);
-      }
-    }
-    assert(desc != null);
-    return desc;
-  }
-
   static exprNodeDesc genSimpleExprNodeDesc(ASTNode expr) throws SemanticException {
     exprNodeDesc desc = null;
     switch(expr.getType()) {
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/TopoWalker.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/TopoWalker.java
deleted file mode 100644
index e69de29bb2..0000000000
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/TypeCheckCtx.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/TypeCheckCtx.java
new file mode 100644
index 0000000000..499c4b9384
--- /dev/null
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/TypeCheckCtx.java
@@ -0,0 +1,78 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.hadoop.hive.ql.parse;
+
+import org.apache.hadoop.hive.ql.lib.NodeProcessorCtx;
+
+/**
+ * This class implements the context information that is used for typechecking phase
+ * in query compilation.
+ */
+public class TypeCheckCtx implements NodeProcessorCtx {
+  
+  /**
+   * The row resolver of the previous operator. This field is used to generate expression
+   * descriptors from the expression ASTs.
+   */
+  private RowResolver inputRR;
+
+  /**
+   * Potential typecheck error reason.
+   */
+  private String error;
+  
+  /**
+   * Constructor.
+   * 
+   * @param inputRR The input row resolver of the previous operator.
+   */
+  public TypeCheckCtx(RowResolver inputRR) {
+    this.setInputRR(inputRR);
+    this.error = null;
+  }
+
+  /**
+   * @param inputRR the inputRR to set
+   */
+  public void setInputRR(RowResolver inputRR) {
+    this.inputRR = inputRR;
+  }
+
+  /**
+   * @return the inputRR
+   */
+  public RowResolver getInputRR() {
+    return inputRR;
+  }
+
+  /**
+   * @param error the error to set
+   */
+  public void setError(String error) {
+    this.error = error;
+  }
+
+  /**
+   * @return the error
+   */
+  public String getError() {
+    return error;
+  }
+
+}
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/TypeCheckProcFactory.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/TypeCheckProcFactory.java
new file mode 100644
index 0000000000..e860a3d6ac
--- /dev/null
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/TypeCheckProcFactory.java
@@ -0,0 +1,628 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.hadoop.hive.ql.parse;
+
+import java.lang.reflect.Method;
+import java.util.Arrays;
+import java.util.ArrayList;
+import java.util.HashMap;
+import java.util.List;
+import java.util.Map;
+
+import org.apache.hadoop.hive.ql.exec.ColumnInfo;
+import org.apache.hadoop.hive.ql.exec.FunctionRegistry;
+import org.apache.hadoop.hive.ql.exec.UDF;
+import org.apache.hadoop.hive.ql.lib.Node;
+import org.apache.hadoop.hive.ql.lib.NodeProcessor;
+import org.apache.hadoop.hive.ql.lib.NodeProcessorCtx;
+import org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc;
+import org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc;
+import org.apache.hadoop.hive.ql.plan.exprNodeDesc;
+import org.apache.hadoop.hive.ql.plan.exprNodeFieldDesc;
+import org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc;
+import org.apache.hadoop.hive.ql.plan.exprNodeIndexDesc;
+import org.apache.hadoop.hive.ql.plan.exprNodeNullDesc;
+import org.apache.hadoop.hive.ql.typeinfo.TypeInfo;
+import org.apache.hadoop.hive.ql.typeinfo.TypeInfoFactory;
+import org.apache.hadoop.hive.ql.udf.UDFOPPositive;
+import org.apache.hadoop.hive.serde2.objectinspector.ObjectInspector;
+import org.apache.hadoop.hive.serde2.objectinspector.ObjectInspectorUtils;
+import org.apache.hadoop.hive.serde2.objectinspector.ObjectInspector.Category;
+
+/**
+ * The Factory for creating typecheck processors. The typecheck processors are used to
+ * processes the syntax trees for expressions and convert them into expression Node
+ * Descriptor trees. They also introduce the correct conversion functions to do proper
+ * implicit conversion.
+ */
+public class TypeCheckProcFactory {
+
+  /**
+   * Function to do groupby subexpression elimination. This is called by all the processors initially.
+   * As an example, consider the query
+   *   select a+b, count(1) from T group by a+b;
+   * Then a+b is already precomputed in the group by operators key, so we substitute a+b in the select
+   * list with the internal column name of the a+b expression that appears in the in input row resolver.
+   * 
+   * @param nd The node that is being inspected.
+   * @param procCtx The processor context.
+   * 
+   * @return exprNodeColumnDesc.
+   */
+  public static exprNodeDesc processGByExpr(Node nd, Object procCtx) 
+    throws SemanticException {
+    //  We recursively create the exprNodeDesc.  Base cases:  when we encounter 
+    //  a column ref, we convert that into an exprNodeColumnDesc;  when we encounter 
+    //  a constant, we convert that into an exprNodeConstantDesc.  For others we just 
+    //  build the exprNodeFuncDesc with recursively built children.
+    ASTNode expr = (ASTNode)nd;
+    TypeCheckCtx ctx = (TypeCheckCtx) procCtx;
+    RowResolver input = ctx.getInputRR();
+    exprNodeDesc desc = null;
+
+    //  If the current subExpression is pre-calculated, as in Group-By etc.
+    ColumnInfo colInfo = input.get("", expr.toStringTree());
+    if (colInfo != null) {
+      desc = new exprNodeColumnDesc(colInfo.getType(), colInfo.getInternalName()); 
+      return desc;
+    }    
+    return desc;
+  }
+  
+  /**
+   * Processor for processing NULL expression.
+   */
+  public static class NullExprProcessor implements NodeProcessor {
+
+    @Override
+    public Object process(Node nd, NodeProcessorCtx procCtx,
+        Object... nodeOutputs) throws SemanticException {
+
+      exprNodeDesc desc = TypeCheckProcFactory.processGByExpr(nd, procCtx);
+      if (desc != null) {
+        return desc;
+      }
+      
+      return new exprNodeNullDesc();
+    }
+    
+  }
+  
+  /**
+   * Factory method to get NullExprProcessor.
+   * @return NullExprProcessor.
+   */
+  public static NullExprProcessor getNullExprProcessor() {
+    return new NullExprProcessor();
+  }
+  
+  /**
+   * Processor for processing numeric constants.
+   */
+  public static class NumExprProcessor implements NodeProcessor {
+
+    @Override
+    public Object process(Node nd, NodeProcessorCtx procCtx,
+        Object... nodeOutputs) throws SemanticException {
+
+      exprNodeDesc desc = TypeCheckProcFactory.processGByExpr(nd, procCtx);
+      if (desc != null) {
+        return desc;
+      }
+      
+      Number v = null;
+      ASTNode expr = (ASTNode)nd;
+      // The expression can be any one of Double, Long and Integer. We
+      // try to parse the expression in that order to ensure that the
+      // most specific type is used for conversion.
+      try {
+        v = Double.valueOf(expr.getText());
+        v = Long.valueOf(expr.getText());
+        v = Integer.valueOf(expr.getText());
+      } catch (NumberFormatException e) {
+        // do nothing here, we will throw an exception in the following block
+      }
+      if (v == null) {
+        throw new SemanticException(ErrorMsg.INVALID_NUMERICAL_CONSTANT.getMsg(expr));
+      }
+      return new exprNodeConstantDesc(v);
+    }
+    
+  }
+  
+  /**
+   * Factory method to get NumExprProcessor.
+   * @return NumExprProcessor.
+   */
+  public static NumExprProcessor getNumExprProcessor() {
+    return new NumExprProcessor();
+  }
+  
+  /**
+   * Processor for processing string constants.
+   */
+  public static class StrExprProcessor implements NodeProcessor {
+
+    @Override
+    public Object process(Node nd, NodeProcessorCtx procCtx,
+        Object... nodeOutputs) throws SemanticException {
+
+      exprNodeDesc desc = TypeCheckProcFactory.processGByExpr(nd, procCtx);
+      if (desc != null) {
+        return desc;
+      }
+      
+      ASTNode expr = (ASTNode)nd;
+      String str = null;
+      
+      switch (expr.getToken().getType()) {
+      case HiveParser.Identifier:
+        str = BaseSemanticAnalyzer.unescapeIdentifier(expr.getText());
+        break;
+      case HiveParser.StringLiteral:
+        str = BaseSemanticAnalyzer.unescapeSQLString(expr.getText());
+        break;
+      case HiveParser.TOK_CHARSETLITERAL:
+        str = BaseSemanticAnalyzer.charSetString(expr.getChild(0).getText(), expr.getChild(1).getText());
+        break;
+      default:
+        assert false;
+      }
+      return new exprNodeConstantDesc(String.class, str);
+    }
+    
+  }
+  
+  /**
+   * Factory method to get StrExprProcessor.
+   * @return StrExprProcessor.
+   */
+  public static StrExprProcessor getStrExprProcessor() {
+    return new StrExprProcessor();
+  }
+  
+  /**
+   * Processor for boolean constants.
+   */
+  public static class BoolExprProcessor implements NodeProcessor {
+
+    @Override
+    public Object process(Node nd, NodeProcessorCtx procCtx,
+        Object... nodeOutputs) throws SemanticException {
+
+      exprNodeDesc desc = TypeCheckProcFactory.processGByExpr(nd, procCtx);
+      if (desc != null) {
+        return desc;
+      }
+
+      ASTNode expr = (ASTNode)nd;
+      Boolean bool = null;
+
+      switch (expr.getToken().getType()) {
+      case HiveParser.KW_TRUE:
+        bool = Boolean.TRUE;
+        break;
+      case HiveParser.KW_FALSE:
+        bool = Boolean.FALSE;
+        break;
+      default:
+        assert false;
+      }
+      return new exprNodeConstantDesc(Boolean.class, bool);      
+    }
+    
+  }
+  
+  /**
+   * Factory method to get BoolExprProcessor.
+   * @return BoolExprProcessor.
+   */
+  public static BoolExprProcessor getBoolExprProcessor() {
+    return new BoolExprProcessor();
+  }
+  
+  /**
+   * Processor for table columns
+   */
+  public static class ColumnExprProcessor implements NodeProcessor {
+
+    @Override
+    public Object process(Node nd, NodeProcessorCtx procCtx,
+        Object... nodeOutputs) throws SemanticException {
+
+      exprNodeDesc desc = TypeCheckProcFactory.processGByExpr(nd, procCtx);
+      if (desc != null) {
+        return desc;
+      }
+
+      ASTNode expr = (ASTNode)nd;
+      TypeCheckCtx ctx = (TypeCheckCtx)procCtx;
+      RowResolver input = ctx.getInputRR();
+
+      if(expr.getType() != HiveParser.TOK_COLREF) {
+        ctx.setError(ErrorMsg.INVALID_COLUMN.getMsg(expr));
+        return null;
+      }
+      
+      String tabAlias = null;
+      String colName = null;
+      
+      if (expr.getChildCount() != 1) {
+        tabAlias = BaseSemanticAnalyzer.unescapeIdentifier(expr.getChild(0).getText());
+        colName = BaseSemanticAnalyzer.unescapeIdentifier(expr.getChild(1).getText());
+      }
+      else {
+        colName = BaseSemanticAnalyzer.unescapeIdentifier(expr.getChild(0).getText());
+      }
+
+      if (colName == null) {
+        ctx.setError(ErrorMsg.INVALID_XPATH.getMsg(expr));
+        return null;
+      }
+
+      ColumnInfo colInfo = input.get(tabAlias, colName);
+
+      if (colInfo == null && input.getIsExprResolver()) {
+        ctx.setError(ErrorMsg.NON_KEY_EXPR_IN_GROUPBY.getMsg(expr));
+        return null;
+      }         
+      else if (tabAlias != null && !input.hasTableAlias(tabAlias)) {
+        ctx.setError(ErrorMsg.INVALID_TABLE_ALIAS.getMsg(expr.getChild(0)));
+        return null;
+      } else if (colInfo == null) {
+        ctx.setError(ErrorMsg.INVALID_COLUMN.getMsg(tabAlias == null? expr.getChild(0) : expr.getChild(1)));
+        return null;
+      }
+
+      return new exprNodeColumnDesc(colInfo.getType(), colInfo.getInternalName());
+    }
+    
+  }
+  
+  /**
+   * Factory method to get ColumnExprProcessor.
+   * @return ColumnExprProcessor.
+   */
+  public static ColumnExprProcessor getColumnExprProcessor() {
+    return new ColumnExprProcessor();
+  }
+  
+  /**
+   * The default processor for typechecking.
+   */
+  public static class DefaultExprProcessor implements NodeProcessor {
+
+    static HashMap<Integer, String> specialUnaryOperatorTextHashMap;
+    static HashMap<Integer, String> specialFunctionTextHashMap;
+    static HashMap<Integer, String> conversionFunctionTextHashMap;
+    static {
+      specialUnaryOperatorTextHashMap = new HashMap<Integer, String>();
+      specialUnaryOperatorTextHashMap.put(HiveParser.PLUS, "positive");
+      specialUnaryOperatorTextHashMap.put(HiveParser.MINUS, "negative");
+      specialFunctionTextHashMap = new HashMap<Integer, String>();
+      specialFunctionTextHashMap.put(HiveParser.TOK_ISNULL, "isnull");
+      specialFunctionTextHashMap.put(HiveParser.TOK_ISNOTNULL, "isnotnull");
+      conversionFunctionTextHashMap = new HashMap<Integer, String>();
+      conversionFunctionTextHashMap.put(HiveParser.TOK_BOOLEAN, Boolean.class.getName());
+      conversionFunctionTextHashMap.put(HiveParser.TOK_TINYINT, Byte.class.getName());
+      conversionFunctionTextHashMap.put(HiveParser.TOK_SMALLINT, Short.class.getName());
+      conversionFunctionTextHashMap.put(HiveParser.TOK_INT, Integer.class.getName());
+      conversionFunctionTextHashMap.put(HiveParser.TOK_BIGINT, Long.class.getName());
+      conversionFunctionTextHashMap.put(HiveParser.TOK_FLOAT, Float.class.getName());
+      conversionFunctionTextHashMap.put(HiveParser.TOK_DOUBLE, Double.class.getName());
+      conversionFunctionTextHashMap.put(HiveParser.TOK_STRING, String.class.getName());
+      conversionFunctionTextHashMap.put(HiveParser.TOK_DATE, java.sql.Date.class.getName());
+    }
+
+    public static boolean isRedundantConversionFunction(ASTNode expr, boolean isFunction, ArrayList<exprNodeDesc> children) {
+      if (!isFunction) return false;
+      // children is always one less than the expr.getChildCount(), since the latter contains function name.
+      assert(children.size() == expr.getChildCount() - 1);
+      // conversion functions take a single parameter
+      if (children.size() != 1) return false;
+      String funcText = conversionFunctionTextHashMap.get(((ASTNode)expr.getChild(0)).getType());
+      // not a conversion function 
+      if (funcText == null) return false;
+      // return true when the child type and the conversion target type is the same
+      return children.get(0).getTypeInfo().getPrimitiveClass().getName().equals(funcText);
+    }
+    
+    public static String getFunctionText(ASTNode expr, boolean isFunction) {
+      String funcText = null;
+      if (!isFunction) {
+        // For operator, the function name is the operator text, unless it's in our special dictionary
+        if (expr.getChildCount() == 1) {
+          funcText = specialUnaryOperatorTextHashMap.get(expr.getType());
+        }
+        if (funcText == null) {
+          funcText = expr.getText();
+        }
+      } else {
+        // For TOK_FUNCTION, the function name is stored in the first child, unless it's in our
+        // special dictionary.
+        assert(expr.getChildCount() >= 1);
+        int funcType = ((ASTNode)expr.getChild(0)).getType();
+        funcText = specialFunctionTextHashMap.get(funcType);
+        if (funcText == null) {
+          funcText = conversionFunctionTextHashMap.get(funcType);
+        }
+        if (funcText == null) {
+          funcText = ((ASTNode)expr.getChild(0)).getText();
+        }
+      }
+      return funcText;
+    }
+
+
+    /**
+     * Get the exprNodeDesc
+     * @param name
+     * @param children
+     * @return
+     */
+    public static exprNodeDesc getFuncExprNodeDesc(String name, exprNodeDesc... children) {
+      return getFuncExprNodeDesc(name, Arrays.asList(children));
+    }
+    
+    /**
+     * This function create an ExprNodeDesc for a UDF function given the children (arguments).
+     * It will insert implicit type conversion functions if necessary. 
+     * @throws SemanticException 
+     */
+    public static exprNodeDesc getFuncExprNodeDesc(String udfName, List<exprNodeDesc> children) {
+      // Find the corresponding method
+      ArrayList<Class<?>> argumentClasses = new ArrayList<Class<?>>(children.size());
+      for(int i=0; i<children.size(); i++) {
+        exprNodeDesc child = children.get(i);
+        assert(child != null);
+        TypeInfo childTypeInfo = child.getTypeInfo();
+        assert(childTypeInfo != null);
+        
+        // Note: we don't pass the element types of MAP/LIST to UDF.
+        // That will work for null test and size but not other more complex functionalities like list slice etc.
+        // For those more complex functionalities, we plan to have a ComplexUDF interface which has an evaluate
+        // method that accepts a list of objects and a list of objectinspectors. 
+        switch (childTypeInfo.getCategory()) {
+          case PRIMITIVE: {
+            argumentClasses.add(childTypeInfo.getPrimitiveClass());
+            break;
+          }
+          case MAP: {
+            argumentClasses.add(Map.class);
+            break;
+          }
+          case LIST: {
+            argumentClasses.add(List.class);
+            break;
+          }
+          case STRUCT: {
+            argumentClasses.add(Object.class);
+            break;
+          }
+          default: {
+            // should never happen
+            assert(false);
+          }
+        }
+      }
+      Method udfMethod = FunctionRegistry.getUDFMethod(udfName, argumentClasses);
+      if (udfMethod == null) return null;
+
+      ArrayList<exprNodeDesc> ch = new ArrayList<exprNodeDesc>();
+      Class<?>[] pTypes = udfMethod.getParameterTypes();
+
+      for (int i = 0; i < children.size(); i++)
+      {
+        exprNodeDesc desc = children.get(i);
+        Class<?> pType = ObjectInspectorUtils.generalizePrimitive(pTypes[i]);
+        if (desc instanceof exprNodeNullDesc) {
+          exprNodeConstantDesc newCh = new exprNodeConstantDesc(TypeInfoFactory.getPrimitiveTypeInfo(pType), null);
+          ch.add(newCh);
+        } else if (pType.isAssignableFrom(argumentClasses.get(i))) {
+          // no type conversion needed
+          ch.add(desc);
+        } else {
+          // must be implicit type conversion
+          Class<?> from = argumentClasses.get(i);
+          Class<?> to = pType;
+          assert(FunctionRegistry.implicitConvertable(from, to));
+          Method m = FunctionRegistry.getUDFMethod(to.getName(), from);
+          assert(m != null);
+          Class<? extends UDF> c = FunctionRegistry.getUDFClass(to.getName());
+          assert(c != null);
+
+          // get the conversion method
+          ArrayList<exprNodeDesc> conversionArg = new ArrayList<exprNodeDesc>(1);
+          conversionArg.add(desc);
+          ch.add(new exprNodeFuncDesc(
+                TypeInfoFactory.getPrimitiveTypeInfo(pType),
+                c, m, conversionArg));
+        }
+      }
+
+      exprNodeFuncDesc desc = new exprNodeFuncDesc(
+        TypeInfoFactory.getPrimitiveTypeInfo(udfMethod.getReturnType()),
+        FunctionRegistry.getUDFClass(udfName),
+        udfMethod, ch);
+      return desc;
+    }
+
+    static exprNodeDesc getXpathOrFuncExprNodeDesc(ASTNode expr, boolean isFunction,
+        ArrayList<exprNodeDesc> children)
+        throws SemanticException {
+      // return the child directly if the conversion is redundant.
+      if (isRedundantConversionFunction(expr, isFunction, children)) {
+        assert(children.size() == 1);
+        assert(children.get(0) != null);
+        return children.get(0);
+      }
+      String funcText = getFunctionText(expr, isFunction);
+      exprNodeDesc desc;
+      if (funcText.equals(".")) {
+        // "." :  FIELD Expression
+        assert(children.size() == 2);
+        // Only allow constant field name for now
+        assert(children.get(1) instanceof exprNodeConstantDesc);
+        exprNodeDesc object = children.get(0);
+        exprNodeConstantDesc fieldName = (exprNodeConstantDesc)children.get(1);
+        assert(fieldName.getValue() instanceof String);
+        
+        // Calculate result TypeInfo
+        String fieldNameString = (String)fieldName.getValue();
+        TypeInfo objectTypeInfo = object.getTypeInfo();
+        
+        // Allow accessing a field of list element structs directly from a list  
+        boolean isList = (object.getTypeInfo().getCategory() == ObjectInspector.Category.LIST);
+        if (isList) {
+          objectTypeInfo = objectTypeInfo.getListElementTypeInfo();
+        }
+        if (objectTypeInfo.getCategory() != Category.STRUCT) {
+          throw new SemanticException(ErrorMsg.INVALID_DOT.getMsg(expr));
+        }
+        TypeInfo t = objectTypeInfo.getStructFieldTypeInfo(fieldNameString);
+        if (isList) {
+          t = TypeInfoFactory.getListTypeInfo(t);
+        }
+        
+        desc = new exprNodeFieldDesc(t, children.get(0), fieldNameString, isList);
+        
+      } else if (funcText.equals("[")){
+        // "[]" : LSQUARE/INDEX Expression
+        assert(children.size() == 2);
+        
+        // Check whether this is a list or a map
+        TypeInfo myt = children.get(0).getTypeInfo();
+
+        if (myt.getCategory() == Category.LIST) {
+          // Only allow constant integer index for now
+          if (!(children.get(1) instanceof exprNodeConstantDesc)
+              || !(((exprNodeConstantDesc)children.get(1)).getValue() instanceof Integer)) {
+            throw new SemanticException(ErrorMsg.INVALID_ARRAYINDEX_CONSTANT.getMsg(expr));
+          }
+        
+          // Calculate TypeInfo
+          TypeInfo t = myt.getListElementTypeInfo();
+          desc = new exprNodeIndexDesc(t, children.get(0), children.get(1));
+        }
+        else if (myt.getCategory() == Category.MAP) {
+          // Only allow only constant indexes for now
+          if (!(children.get(1) instanceof exprNodeConstantDesc)) {
+            throw new SemanticException(ErrorMsg.INVALID_MAPINDEX_CONSTANT.getMsg(expr));
+          }
+          if (!(((exprNodeConstantDesc)children.get(1)).getValue().getClass() == 
+                myt.getMapKeyTypeInfo().getPrimitiveClass())) {
+            throw new SemanticException(ErrorMsg.INVALID_MAPINDEX_TYPE.getMsg(expr));
+          }
+          // Calculate TypeInfo
+          TypeInfo t = myt.getMapValueTypeInfo();
+          
+          desc = new exprNodeIndexDesc(t, children.get(0), children.get(1));
+        }
+        else {
+          throw new SemanticException(ErrorMsg.NON_COLLECTION_TYPE.getMsg(expr, 
+              myt.getTypeName()));
+        }
+      } else {
+        // other operators or functions
+        Class<? extends UDF> udf = FunctionRegistry.getUDFClass(funcText);
+        if (udf == null) {
+          if (isFunction)
+            throw new SemanticException(ErrorMsg.INVALID_FUNCTION.getMsg((ASTNode)expr.getChild(0)));
+          else
+            throw new SemanticException(ErrorMsg.INVALID_FUNCTION.getMsg((ASTNode)expr));
+        }
+        
+        desc = getFuncExprNodeDesc(funcText, children);
+        if (desc == null) {
+          ArrayList<Class<?>> argumentClasses = new ArrayList<Class<?>>(children.size());
+          for(int i=0; i<children.size(); i++) {
+            argumentClasses.add(children.get(i).getTypeInfo().getPrimitiveClass());
+          }
+    
+          if (isFunction) {
+            String reason = "Looking for UDF \"" + expr.getChild(0).getText() + "\" with parameters " + argumentClasses;
+            throw new SemanticException(ErrorMsg.INVALID_FUNCTION_SIGNATURE.getMsg((ASTNode)expr.getChild(0), reason));
+          } else {
+            String reason = "Looking for Operator \"" + expr.getText() + "\" with parameters " + argumentClasses;
+            throw new SemanticException(ErrorMsg.INVALID_OPERATOR_SIGNATURE.getMsg(expr, reason));
+          }
+        }
+      }
+      // UDFOPPositive is a no-op.
+      // However, we still create it, and then remove it here, to make sure we only allow
+      // "+" for numeric types.
+      if (desc instanceof exprNodeFuncDesc) {
+        exprNodeFuncDesc funcDesc = (exprNodeFuncDesc)desc;
+        if (funcDesc.getUDFClass().equals(UDFOPPositive.class)) {
+          assert(funcDesc.getChildren().size() == 1);
+          desc = funcDesc.getChildren().get(0);
+        }
+      }
+      assert(desc != null);
+      return desc;
+    }
+
+    @Override
+    public Object process(Node nd, NodeProcessorCtx procCtx,
+        Object... nodeOutputs) throws SemanticException {
+
+      ASTNode expr = (ASTNode)nd;
+      
+      // Return nulls for conversion operators
+      if (conversionFunctionTextHashMap.keySet().contains(expr.getType()) ||
+          specialFunctionTextHashMap.keySet().contains(expr.getType()) ||
+          expr.getToken().getType() == HiveParser.CharSetName ||
+          expr.getToken().getType() == HiveParser.CharSetLiteral) {
+        return null;
+      }
+      
+      exprNodeDesc desc = TypeCheckProcFactory.processGByExpr(nd, procCtx);
+      if (desc != null) {
+        return desc;
+      }
+
+      boolean isFunction = (expr.getType() == HiveParser.TOK_FUNCTION);
+      
+      // Create all children
+      int childrenBegin = (isFunction ? 1 : 0);
+      ArrayList<exprNodeDesc> children = new ArrayList<exprNodeDesc>(expr.getChildCount() - childrenBegin);
+      for (int ci=childrenBegin; ci<expr.getChildCount(); ci++) {
+        children.add((exprNodeDesc)nodeOutputs[ci]);
+      }
+      
+      // If any of the children contains null, then return a null
+      // this is a hack for now to handle the group by case
+      if (children.contains(null)) {
+        return null;
+      }
+      
+      // Create function desc
+      return getXpathOrFuncExprNodeDesc(expr, isFunction, children);
+    }
+    
+  }
+  
+  /**
+   * Factory method to get DefaultExprProcessor.
+   * @return DefaultExprProcessor.
+   */
+  public static DefaultExprProcessor getDefaultExprProcessor() {
+    return new DefaultExprProcessor();
+  }
+}
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/plan/PlanUtils.java b/ql/src/java/org/apache/hadoop/hive/ql/plan/PlanUtils.java
index d87c13b6a1..d2ee0e2817 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/plan/PlanUtils.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/plan/PlanUtils.java
@@ -29,6 +29,7 @@
 import org.apache.hadoop.hive.ql.exec.Utilities;
 import org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat;
 import org.apache.hadoop.hive.ql.parse.SemanticAnalyzer;
+import org.apache.hadoop.hive.ql.parse.TypeCheckProcFactory;
 import org.apache.hadoop.hive.ql.typeinfo.TypeInfoUtils;
 import org.apache.hadoop.hive.serde.Constants;
 import org.apache.hadoop.hive.serde2.MetadataTypedColumnsetSerDe;
@@ -222,7 +223,7 @@ public static reduceSinkDesc getReduceSinkDesc(ArrayList<exprNodeDesc> keyCols,
     } else {
       // numPartitionFields = -1 means random partitioning
       partitionCols = new ArrayList<exprNodeDesc>(1);
-      partitionCols.add(SemanticAnalyzer.getFuncExprNodeDesc("rand"));
+      partitionCols.add(TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("rand"));
     }
     
     StringBuilder order = new StringBuilder();
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/plan/aggregationDesc.java b/ql/src/java/org/apache/hadoop/hive/ql/plan/aggregationDesc.java
index bf886ce032..55192c9a84 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/plan/aggregationDesc.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/plan/aggregationDesc.java
@@ -21,25 +21,26 @@
 import org.apache.hadoop.hive.ql.exec.FunctionInfo;
 import org.apache.hadoop.hive.ql.exec.FunctionRegistry;
 import org.apache.hadoop.hive.ql.exec.UDAF;
+import org.apache.hadoop.hive.ql.exec.UDAFEvaluator;
 
 public class aggregationDesc implements java.io.Serializable {
   private static final long serialVersionUID = 1L;
-  private Class<? extends UDAF> aggregationClass;
+  private Class<? extends UDAFEvaluator> aggregationClass;
   private java.util.ArrayList<exprNodeDesc> parameters;
   private boolean distinct;
   public aggregationDesc() {}
   public aggregationDesc(
-    final Class<? extends UDAF> aggregationClass,
+    final Class<? extends UDAFEvaluator> aggregationClass,
     final java.util.ArrayList<exprNodeDesc> parameters,
     final boolean distinct) {
     this.aggregationClass = aggregationClass;
     this.parameters = parameters;
     this.distinct = distinct;
   }
-  public Class<? extends UDAF> getAggregationClass() {
+  public Class<? extends UDAFEvaluator> getAggregationClass() {
     return this.aggregationClass;
   }
-  public void setAggregationClass(final Class<? extends UDAF> aggregationClass) {
+  public void setAggregationClass(final Class<? extends UDAFEvaluator> aggregationClass) {
     this.aggregationClass = aggregationClass;
   }
   public java.util.ArrayList<exprNodeDesc> getParameters() {
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/plan/exprNodeColumnDesc.java b/ql/src/java/org/apache/hadoop/hive/ql/plan/exprNodeColumnDesc.java
index 2e126e8880..69b0525f1b 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/plan/exprNodeColumnDesc.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/plan/exprNodeColumnDesc.java
@@ -24,8 +24,6 @@
 
 import org.apache.hadoop.hive.ql.typeinfo.TypeInfo;
 import org.apache.hadoop.hive.ql.typeinfo.TypeInfoFactory;
-import org.apache.hadoop.hive.ql.parse.RowResolver;
-import org.apache.hadoop.hive.ql.exec.ColumnInfo;
 
 public class exprNodeColumnDesc extends exprNodeDesc implements Serializable {
   private static final long serialVersionUID = 1L;
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/plan/exprNodeDesc.java b/ql/src/java/org/apache/hadoop/hive/ql/plan/exprNodeDesc.java
index 8ecff1e30b..de37d96722 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/plan/exprNodeDesc.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/plan/exprNodeDesc.java
@@ -22,8 +22,6 @@
 import java.util.List;
 
 import org.apache.hadoop.hive.ql.typeinfo.TypeInfo;
-import org.apache.hadoop.hive.serde2.objectinspector.ObjectInspectorUtils;
-import org.apache.hadoop.hive.ql.parse.RowResolver;
 
 public class exprNodeDesc implements Serializable {  
   private static final long serialVersionUID = 1L;
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/plan/exprNodeFuncDesc.java b/ql/src/java/org/apache/hadoop/hive/ql/plan/exprNodeFuncDesc.java
index 30b991b441..7ebab8190b 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/plan/exprNodeFuncDesc.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/plan/exprNodeFuncDesc.java
@@ -23,13 +23,11 @@
 import java.util.ArrayList;
 import java.util.List;
 
-import org.apache.commons.logging.Log;
-import org.apache.commons.logging.LogFactory;
 import org.apache.hadoop.hive.ql.typeinfo.TypeInfo;
 import org.apache.hadoop.hive.ql.exec.FunctionInfo;
 import org.apache.hadoop.hive.ql.exec.FunctionRegistry;
+import org.apache.hadoop.hive.ql.exec.UDF;
 import org.apache.hadoop.hive.ql.exec.Utilities;
-import org.apache.hadoop.hive.ql.parse.RowResolver;
 
 /**
  * The reason that we have to store UDFClass as well as UDFMethod is because
@@ -39,12 +37,13 @@
 public class exprNodeFuncDesc extends exprNodeDesc implements Serializable {
 
   private static final long serialVersionUID = 1L;
-  private Class UDFClass;
+  private Class<? extends UDF> UDFClass;
   private Method UDFMethod;
   private ArrayList<exprNodeDesc> children; 
   
   public exprNodeFuncDesc() {}
-  public exprNodeFuncDesc(TypeInfo typeInfo, Class UDFClass, Method UDFMethod, ArrayList<exprNodeDesc> children) {
+  public exprNodeFuncDesc(TypeInfo typeInfo, Class<? extends UDF> UDFClass, 
+                          Method UDFMethod, ArrayList<exprNodeDesc> children) {
     super(typeInfo);
     assert(UDFClass != null);
     this.UDFClass = UDFClass;
@@ -53,10 +52,11 @@ public exprNodeFuncDesc(TypeInfo typeInfo, Class UDFClass, Method UDFMethod, Arr
     this.children = children;
   }
   
-  public Class getUDFClass() {
+  public Class<? extends UDF> getUDFClass() {
     return UDFClass;
   }
-  public void setUDFClass(Class UDFClass) {
+  
+  public void setUDFClass(Class<? extends UDF> UDFClass) {
     this.UDFClass = UDFClass;
   }
   public Method getUDFMethod() {
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/tools/LineageInfo.java b/ql/src/java/org/apache/hadoop/hive/ql/tools/LineageInfo.java
index 5d8a2c8790..73b7733827 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/tools/LineageInfo.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/tools/LineageInfo.java
@@ -30,8 +30,8 @@
 import org.apache.hadoop.hive.ql.lib.Dispatcher;
 import org.apache.hadoop.hive.ql.lib.Node;
 import org.apache.hadoop.hive.ql.lib.NodeProcessor;
-import org.apache.hadoop.hive.ql.lib.NodeProcessorCtx;
 import org.apache.hadoop.hive.ql.lib.GraphWalker;
+import org.apache.hadoop.hive.ql.lib.NodeProcessorCtx;
 import org.apache.hadoop.hive.ql.lib.Rule;
 import org.apache.hadoop.hive.ql.parse.ASTNode;
 import org.apache.hadoop.hive.ql.parse.HiveParser;
@@ -76,7 +76,7 @@ public TreeSet<String> getOutputTableList() {
   /**
    * Implements the process method for the NodeProcessor interface.
    */
-  public void process(Node nd, NodeProcessorCtx procCtx)
+  public Object process(Node nd, NodeProcessorCtx procCtx, Object... nodeOutputs)
   throws SemanticException {
     ASTNode pt = (ASTNode)nd;
 
@@ -91,7 +91,7 @@ public void process(Node nd, NodeProcessorCtx procCtx)
       inputTableList.add(table_name);
       break;
     }
-
+    return null;
   }
 
   /**
@@ -128,7 +128,7 @@ public void getLineageInfo(String query) throws ParseException, SemanticExceptio
     // Create a list of topop nodes
     ArrayList<Node> topNodes = new ArrayList<Node>();
     topNodes.add(tree);
-    ogw.startWalking(topNodes);
+    ogw.startWalking(topNodes, null);
   }
 
   public static void main(String[] args) throws IOException, ParseException,
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFAvg.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFAvg.java
index 5ddba05758..11cdd1680c 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFAvg.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFAvg.java
@@ -18,11 +18,12 @@
 
 package org.apache.hadoop.hive.ql.udf;
 
-import org.apache.hadoop.hive.ql.exec.UDAF;
+import org.apache.hadoop.hive.ql.exec.NumericUDAF;
+import org.apache.hadoop.hive.ql.exec.UDAFEvaluator;
 
 
 
-public class UDAFAvg extends UDAF {
+public class UDAFAvg extends NumericUDAF implements UDAFEvaluator {
 
   private long mCount;
   private double mSum;
@@ -37,7 +38,7 @@ public void init() {
     mCount = 0;
   }
 
-  public boolean aggregate(Double o) {
+  public boolean iterate(Double o) {
     if (o != null) {
       mSum += o;
       mCount ++;
@@ -45,12 +46,12 @@ public boolean aggregate(Double o) {
     return true;
   }
   
-  public String evaluatePartial() {
+  public String terminatePartial() {
     // This is SQL standard - average of zero items should be null.
     return mCount == 0 ? null : String.valueOf(mSum) + '/' + String.valueOf(mCount);
   }
 
-  public boolean aggregatePartial(String o) {
+  public boolean merge(String o) {
     if (o != null && !o.isEmpty()) {
       int pos = o.indexOf('/');
       assert(pos != -1);
@@ -60,7 +61,7 @@ public boolean aggregatePartial(String o) {
     return true;
   }
 
-  public Double evaluate() {
+  public Double terminate() {
     // This is SQL standard - average of zero items should be null.
     return mCount == 0 ? null : Double.valueOf(mSum / mCount);
   }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFCount.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFCount.java
index 28115448e8..5e664a774e 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFCount.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFCount.java
@@ -19,9 +19,10 @@
 package org.apache.hadoop.hive.ql.udf;
 
 import org.apache.hadoop.hive.ql.exec.UDAF;
+import org.apache.hadoop.hive.ql.exec.UDAFEvaluator;
 
 
-public class UDAFCount extends UDAF {
+public class UDAFCount extends UDAF implements UDAFEvaluator {
 
   private long mCount;
   
@@ -34,7 +35,7 @@ public void init() {
     mCount = 0;
   }
   
-  public boolean aggregate(Object o) {
+  public boolean iterate(Object o) {
     // Our SerDe between map/reduce boundary may convert MetadataTypedSerDe to 
     if (o != null && !o.equals("")) {
       mCount ++;
@@ -42,18 +43,17 @@ public boolean aggregate(Object o) {
     return true;
   }
 
-  public Long evaluatePartial() {
+  public Long terminatePartial() {
     return Long.valueOf(mCount);
   }
 
-  public boolean aggregatePartial(Long count) {
+  public boolean merge(Long count) {
     mCount += count;
     return true;
   }
 
-  public Long evaluate() {
+  public Long terminate() {
     return Long.valueOf(mCount);
   }
 
-  
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFMax.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFMax.java
index 787cb5766c..87fa200e80 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFMax.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFMax.java
@@ -18,47 +18,286 @@
 
 package org.apache.hadoop.hive.ql.udf;
 
+import java.sql.Date;
+
 import org.apache.hadoop.hive.ql.exec.UDAF;
+import org.apache.hadoop.hive.ql.exec.UDAFEvaluator;
 
 
 
 public class UDAFMax extends UDAF {
 
-  private double mMax;
-  private boolean mEmpty;
-  
-  public UDAFMax() {
-    super();
-    init();
+  static public class MaxShortEvaluator implements UDAFEvaluator {
+    private short mMax;
+    private boolean mEmpty;
+
+    public MaxShortEvaluator() {
+      super();
+      init();
+    }
+
+    public void init() {
+      mMax = 0;
+      mEmpty = true;
+    }
+
+    public boolean iterate(Short o) {
+      if (o != null) {
+        if (mEmpty) {
+          mMax = o;
+          mEmpty = false;
+        } else {
+          mMax = (short) Math.max(mMax, o);
+        }
+      }
+      return true;
+    }
+
+    public Short terminatePartial() {
+      return mEmpty ? null : Short.valueOf(mMax);
+    }
+
+    public boolean merge(Short o) {
+      return iterate(o);
+    }
+
+    public Short terminate() {
+      return mEmpty ? null : Short.valueOf(mMax);
+    }
   }
 
-  public void init() {
-    mMax = 0;
-    mEmpty = true;
+  static public class MaxIntEvaluator implements UDAFEvaluator {
+    private int mMax;
+    private boolean mEmpty;
+
+    public MaxIntEvaluator() {
+      super();
+      init();
+    }
+
+    public void init() {
+      mMax = 0;
+      mEmpty = true;
+    }
+
+    public boolean iterate(Integer o) {
+      if (o != null) {
+        if (mEmpty) {
+          mMax = o;
+          mEmpty = false;
+        } else {
+          mMax = Math.max(mMax, o);
+        }
+      }
+      return true;
+    }
+
+    public Integer terminatePartial() {
+      return mEmpty ? null : Integer.valueOf(mMax);
+    }
+
+    public boolean merge(Integer o) {
+      return iterate(o);
+    }
+
+    public Integer terminate() {
+      return mEmpty ? null : Integer.valueOf(mMax);
+    }
   }
 
-  public boolean aggregate(Double o) {
-    if (o != null) {
-      if (mEmpty) {
-        mMax = o;
-        mEmpty = false;
-      } else {
-        mMax = Math.max(mMax, o);
+  static public class MaxLongEvaluator implements UDAFEvaluator {
+    private long mMax;
+    private boolean mEmpty;
+
+    public MaxLongEvaluator() {
+      super();
+      init();
+    }
+
+    public void init() {
+      mMax = 0;
+      mEmpty = true;
+    }
+
+    public boolean iterate(Long o) {
+      if (o != null) {
+        if (mEmpty) {
+          mMax = o;
+          mEmpty = false;
+        } else {
+          mMax = Math.max(mMax, o);
+        }
       }
+      return true;
+    }
+
+    public Long terminatePartial() {
+      return mEmpty ? null : Long.valueOf(mMax);
+    }
+
+    public boolean merge(Long o) {
+      return iterate(o);
+    }
+
+    public Long terminate() {
+      return mEmpty ? null : Long.valueOf(mMax);
     }
-    return true;
   }
-  
-  public Double evaluatePartial() {
-    return mEmpty ? null : Double.valueOf(mMax);
+
+  static public class MaxFloatEvaluator implements UDAFEvaluator {
+    private float mMax;
+    private boolean mEmpty;
+
+    public MaxFloatEvaluator() {
+      super();
+      init();
+    }
+
+    public void init() {
+      mMax = 0;
+      mEmpty = true;
+    }
+
+    public boolean iterate(Float o) {
+      if (o != null) {
+        if (mEmpty) {
+          mMax = o;
+          mEmpty = false;
+        } else {
+          mMax = Math.max(mMax, o);
+        }
+      }
+      return true;
+    }
+
+    public Float terminatePartial() {
+      return mEmpty ? null : Float.valueOf(mMax);
+    }
+
+    public boolean merge(Float o) {
+      return iterate(o);
+    }
+
+    public Float terminate() {
+      return mEmpty ? null : Float.valueOf(mMax);
+    }
   }
 
-  public boolean aggregatePartial(Double o) {
-    return aggregate(o);
+  static public class MaxDoubleEvaluator implements UDAFEvaluator {
+    private double mMax;
+    private boolean mEmpty;
+
+    public MaxDoubleEvaluator() {
+      super();
+      init();
+    }
+
+    public void init() {
+      mMax = 0;
+      mEmpty = true;
+    }
+
+    public boolean iterate(Double o) {
+      if (o != null) {
+        if (mEmpty) {
+          mMax = o;
+          mEmpty = false;
+        } else {
+          mMax = Math.max(mMax, o);
+        }
+      }
+      return true;
+    }
+
+    public Double terminatePartial() {
+      return mEmpty ? null : Double.valueOf(mMax);
+    }
+
+    public boolean merge(Double o) {
+      return iterate(o);
+    }
+
+    public Double terminate() {
+      return mEmpty ? null : Double.valueOf(mMax);
+    }
+  }
+
+  static public class MaxStringEvaluator implements UDAFEvaluator {
+    private String mMax;
+    private boolean mEmpty;
+
+    public MaxStringEvaluator() {
+      super();
+      init();
+    }
+
+    public void init() {
+      mMax = null;
+      mEmpty = true;
+    }
+
+    public boolean iterate(String o) {
+      if (o != null) {
+        if (mEmpty) {
+          mMax = o;
+          mEmpty = false;
+        } else if (mMax.compareTo(o) < 0) {
+          mMax = o;
+        }
+      }
+      return true;
+    }
+
+    public String terminatePartial() {
+      return mEmpty ? null : mMax;
+    }
+
+    public boolean merge(String o) {
+      return iterate(o);
+    }
+
+    public String terminate() {
+      return mEmpty ? null : mMax;
+    }
   }
 
-  public Double evaluate() {
-    return mEmpty ? null : Double.valueOf(mMax);
+  static public class MaxDateEvaluator implements UDAFEvaluator {
+    private Date mMax;
+    private boolean mEmpty;
+
+    public MaxDateEvaluator() {
+      super();
+      init();
+    }
+
+    public void init() {
+      mMax = null;
+      mEmpty = true;
+    }
+
+    public boolean iterate(Date o) {
+      if (o != null) {
+        if (mEmpty) {
+          mMax = o;
+          mEmpty = false;
+        } else if (mMax.compareTo(o) < 0){
+          mMax = o;
+        }
+      }
+      return true;
+    }
+
+    public Date terminatePartial() {
+      return mEmpty ? null : mMax;
+    }
+
+    public boolean merge(Date o) {
+      return iterate(o);
+    }
+
+    public Date terminate() {
+      return mEmpty ? null : mMax;
+    }
   }
 
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFMin.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFMin.java
index 6f33bbd7fb..77089d0e5b 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFMin.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFMin.java
@@ -18,47 +18,284 @@
 
 package org.apache.hadoop.hive.ql.udf;
 
-import org.apache.hadoop.hive.ql.exec.UDAF;
+import java.sql.Date;
 
+import org.apache.hadoop.hive.ql.exec.UDAF;
+import org.apache.hadoop.hive.ql.exec.UDAFEvaluator;
 
 
 public class UDAFMin extends UDAF {
 
-  private double mMin;
-  private boolean mEmpty;
-  
-  public UDAFMin() {
-    super();
-    init();
+  static public class MinShortEvaluator implements UDAFEvaluator {
+    private short mMin;
+    private boolean mEmpty;
+
+    public MinShortEvaluator() {
+      super();
+      init();
+    }
+
+    public void init() {
+      mMin = 0;
+      mEmpty = true;
+    }
+
+    public boolean iterate(Short o) {
+      if (o != null) {
+        if (mEmpty) {
+          mMin = o;
+          mEmpty = false;
+        } else {
+          mMin = (short) Math.min(mMin, o);
+        }
+      }
+      return true;
+    }
+
+    public Short terminatePartial() {
+      return mEmpty ? null : Short.valueOf(mMin);
+    }
+
+    public boolean merge(Short o) {
+      return iterate(o);
+    }
+
+    public Short terminate() {
+      return mEmpty ? null : Short.valueOf(mMin);
+    }
   }
 
-  public void init() {
-    mMin = 0;
-    mEmpty = true;
+  static public class MinIntEvaluator implements UDAFEvaluator {
+    private int mMin;
+    private boolean mEmpty;
+
+    public MinIntEvaluator() {
+      super();
+      init();
+    }
+
+    public void init() {
+      mMin = 0;
+      mEmpty = true;
+    }
+
+    public boolean iterate(Integer o) {
+      if (o != null) {
+        if (mEmpty) {
+          mMin = o;
+          mEmpty = false;
+        } else {
+          mMin = Math.min(mMin, o);
+        }
+      }
+      return true;
+    }
+
+    public Integer terminatePartial() {
+      return mEmpty ? null : Integer.valueOf(mMin);
+    }
+
+    public boolean merge(Integer o) {
+      return iterate(o);
+    }
+
+    public Integer terminate() {
+      return mEmpty ? null : Integer.valueOf(mMin);
+    }
   }
 
-  public boolean aggregate(Double o) {
-    if (o != null) {
-      if (mEmpty) {
-        mMin = o;
-        mEmpty = false;
-      } else {
-        mMin = Math.min(mMin, o);
+  static public class MinLongEvaluator implements UDAFEvaluator {
+    private long mMin;
+    private boolean mEmpty;
+
+    public MinLongEvaluator() {
+      super();
+      init();
+    }
+
+    public void init() {
+      mMin = 0;
+      mEmpty = true;
+    }
+
+    public boolean iterate(Long o) {
+      if (o != null) {
+        if (mEmpty) {
+          mMin = o;
+          mEmpty = false;
+        } else {
+          mMin = Math.min(mMin, o);
+        }
       }
+      return true;
+    }
+
+    public Long terminatePartial() {
+      return mEmpty ? null : Long.valueOf(mMin);
+    }
+
+    public boolean merge(Long o) {
+      return iterate(o);
+    }
+
+    public Long terminate() {
+      return mEmpty ? null : Long.valueOf(mMin);
     }
-    return true;
   }
-  
-  public Double evaluatePartial() {
-    return mEmpty ? null : Double.valueOf(mMin);
+
+  static public class MinFloatEvaluator implements UDAFEvaluator {
+    private float mMin;
+    private boolean mEmpty;
+
+    public MinFloatEvaluator() {
+      super();
+      init();
+    }
+
+    public void init() {
+      mMin = 0;
+      mEmpty = true;
+    }
+
+    public boolean iterate(Float o) {
+      if (o != null) {
+        if (mEmpty) {
+          mMin = o;
+          mEmpty = false;
+        } else {
+          mMin = Math.min(mMin, o);
+        }
+      }
+      return true;
+    }
+
+    public Float terminatePartial() {
+      return mEmpty ? null : Float.valueOf(mMin);
+    }
+
+    public boolean merge(Float o) {
+      return iterate(o);
+    }
+
+    public Float terminate() {
+      return mEmpty ? null : Float.valueOf(mMin);
+    }
   }
 
-  public boolean aggregatePartial(Double o) {
-    return aggregate(o);
+  static public class MinDoubleEvaluator implements UDAFEvaluator {
+    private double mMin;
+    private boolean mEmpty;
+
+    public MinDoubleEvaluator() {
+      super();
+      init();
+    }
+
+    public void init() {
+      mMin = 0;
+      mEmpty = true;
+    }
+
+    public boolean iterate(Double o) {
+      if (o != null) {
+        if (mEmpty) {
+          mMin = o;
+          mEmpty = false;
+        } else {
+          mMin = Math.min(mMin, o);
+        }
+      }
+      return true;
+    }
+
+    public Double terminatePartial() {
+      return mEmpty ? null : Double.valueOf(mMin);
+    }
+
+    public boolean merge(Double o) {
+      return iterate(o);
+    }
+
+    public Double terminate() {
+      return mEmpty ? null : Double.valueOf(mMin);
+    }
   }
 
-  public Double evaluate() {
-    return mEmpty ? null : Double.valueOf(mMin);
+  static public class MinStringEvaluator implements UDAFEvaluator {
+    private String mMin;
+    private boolean mEmpty;
+
+    public MinStringEvaluator() {
+      super();
+      init();
+    }
+
+    public void init() {
+      mMin = null;
+      mEmpty = true;
+    }
+
+    public boolean iterate(String o) {
+      if (o != null) {
+        if (mEmpty) {
+          mMin = o;
+          mEmpty = false;
+        } else if (mMin.compareTo(o) < 0) {
+          mMin = o;
+        }
+      }
+      return true;
+    }
+
+    public String terminatePartial() {
+      return mEmpty ? null : mMin;
+    }
+
+    public boolean merge(String o) {
+      return iterate(o);
+    }
+
+    public String terminate() {
+      return mEmpty ? null : mMin;
+    }
   }
 
+  static public class MinDateEvaluator implements UDAFEvaluator {
+    private Date mMin;
+    private boolean mEmpty;
+
+    public MinDateEvaluator() {
+      super();
+      init();
+    }
+
+    public void init() {
+      mMin = null;
+      mEmpty = true;
+    }
+
+    public boolean iterate(Date o) {
+      if (o != null) {
+        if (mEmpty) {
+          mMin = o;
+          mEmpty = false;
+        } else if (mMin.compareTo(o) < 0){
+          mMin = o;
+        }
+      }
+      return true;
+    }
+
+    public Date terminatePartial() {
+      return mEmpty ? null : mMin;
+    }
+
+    public boolean merge(Date o) {
+      return iterate(o);
+    }
+
+    public Date terminate() {
+      return mEmpty ? null : mMin;
+    }
+  }
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFSum.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFSum.java
index a35080696b..70283b93a8 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFSum.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDAFSum.java
@@ -18,11 +18,12 @@
 
 package org.apache.hadoop.hive.ql.udf;
 
-import org.apache.hadoop.hive.ql.exec.UDAF;
+import org.apache.hadoop.hive.ql.exec.NumericUDAF;
+import org.apache.hadoop.hive.ql.exec.UDAFEvaluator;
 
 
 
-public class UDAFSum extends UDAF {
+public class UDAFSum extends NumericUDAF implements UDAFEvaluator {
 
   private double mSum;
   private boolean mEmpty;
@@ -37,7 +38,7 @@ public void init() {
     mEmpty = true;
   }
 
-  public boolean aggregate(Double o) {
+  public boolean iterate(Double o) {
     if (o != null) {
       mSum += o;
       mEmpty = false;
@@ -45,12 +46,12 @@ public boolean aggregate(Double o) {
     return true;
   }
   
-  public Double evaluatePartial() {
+  public Double terminatePartial() {
     // This is SQL standard - sum of zero items should be null.
     return mEmpty ? null : new Double(mSum);
   }
 
-  public boolean aggregatePartial(Double o) {
+  public boolean merge(Double o) {
     if (o != null) {
       mSum += o;
       mEmpty = false;
@@ -58,7 +59,7 @@ public boolean aggregatePartial(Double o) {
     return true;
   }
 
-  public Double evaluate() {
+  public Double terminate() {
     // This is SQL standard - sum of zero items should be null.
     return mEmpty ? null : new Double(mSum);
   }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFBaseCompare.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFBaseCompare.java
index df583674ee..8d84c4c863 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFBaseCompare.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFBaseCompare.java
@@ -18,46 +18,18 @@
 
 package org.apache.hadoop.hive.ql.udf;
 
-import java.sql.Date;
-
-import org.apache.commons.logging.Log;
-import org.apache.commons.logging.LogFactory;
+import org.apache.hadoop.hive.ql.exec.ComparisonOpMethodResolver;
 import org.apache.hadoop.hive.ql.exec.UDF;
 
+public abstract class UDFBaseCompare extends UDF {
 
-public abstract class UDFBaseCompare implements UDF {
-
-  private static Log LOG = LogFactory.getLog(UDFBaseCompare.class.getName());
-
-  public UDFBaseCompare() {
-  }
-
-  public abstract Boolean evaluate(Double a, Double b);
-  
-  /** If one of the argument is a String and the other is a Number, convert
-   *  String to double and the Number to double, and then compare.
+  /**
+   * This constructor sets the resolver to be used for comparison operators.
+   * See {@link UDFMethodResolver}
    */
-  public Boolean evaluate(String a, Number b)  {
-    Double aDouble = null;
-    try {
-      aDouble = Double.valueOf(a);
-    } catch (Exception e){
-      // do nothing: aDouble will be null.
-    }
-    return evaluate(aDouble, new Double(b.doubleValue()));
+  public UDFBaseCompare() {
+    setResolver(new ComparisonOpMethodResolver(this.getClass()));
   }
 
-  /** If one of the argument is a String and the other is a Number, convert
-   *  String to double and the Number to double, and then compare.
-   */
-  public Boolean evaluate(Number a, String b)  {
-    Double bDouble = null;
-    try {
-      bDouble = Double.valueOf(b);
-    } catch (Exception e){
-      // do nothing: bDouble will be null.
-    }
-    return evaluate(new Double(a.doubleValue()), bDouble);
-  }
-  
+  public abstract Boolean evaluate(Double a, Double b);  
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFStrGe.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFBaseNumericOp.java
old mode 100755
new mode 100644
similarity index 54%
rename from ql/src/java/org/apache/hadoop/hive/ql/udf/UDFStrGe.java
rename to ql/src/java/org/apache/hadoop/hive/ql/udf/UDFBaseNumericOp.java
index 0dfb0fdde5..9c9683fe57
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFStrGe.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFBaseNumericOp.java
@@ -18,18 +18,28 @@
 
 package org.apache.hadoop.hive.ql.udf;
 
-import org.apache.commons.logging.Log;
-import org.apache.commons.logging.LogFactory;
+import org.apache.hadoop.hive.ql.exec.NumericOpMethodResolver;
 import org.apache.hadoop.hive.ql.exec.UDF;
 
+/**
+ * Base class for numeric operators like +, -, / etc. All these operators
+ * share a common method resolver (NumericOpMethodResolver).
+ */
+public abstract class UDFBaseNumericOp extends UDF {
 
-public class UDFStrGe implements UDF {
-
-  public UDFStrGe() {
+  /**
+   * Constructor.
+   * This constructor sets the resolver to be used for comparison operators.
+   * See {@link UDFMethodResolver}
+   */
+  public UDFBaseNumericOp() {
+    setResolver(new NumericOpMethodResolver(this.getClass()));
   }
 
-  public boolean evaluate(String a, String b)  {
-    int code = a.compareTo(b);
-    return (code >= 0);
-  }
+  public abstract Byte evaluate(Byte a, Byte b);  
+  public abstract Integer evaluate(Integer a, Integer b);  
+  public abstract Long evaluate(Long a, Long b);  
+  public abstract Float evaluate(Float a, Float b);  
+  public abstract Double evaluate(Double a, Double b);  
+
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFCeil.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFCeil.java
index b0dd679732..4855b4ee28 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFCeil.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFCeil.java
@@ -22,7 +22,7 @@
 import org.apache.commons.logging.LogFactory;
 import org.apache.hadoop.hive.ql.exec.UDF;
 
-public class UDFCeil implements UDF {
+public class UDFCeil extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFCeil.class.getName());
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFConcat.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFConcat.java
index 499bfcedb6..20bced185b 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFConcat.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFConcat.java
@@ -21,7 +21,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFConcat implements UDF {
+public class UDFConcat extends UDF {
 
   public UDFConcat() {
   }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDate.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDate.java
index 04725c89ca..0c95107b0e 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDate.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDate.java
@@ -28,7 +28,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFDate implements UDF {
+public class UDFDate extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFDate.class.getName());
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDayOfMonth.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDayOfMonth.java
index 433ded3669..41c8bd3870 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDayOfMonth.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDayOfMonth.java
@@ -28,7 +28,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFDayOfMonth implements UDF {
+public class UDFDayOfMonth extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFDayOfMonth.class.getName());
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDefaultSampleHashFn.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDefaultSampleHashFn.java
index 68b21128be..8d67f6bc72 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDefaultSampleHashFn.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFDefaultSampleHashFn.java
@@ -22,7 +22,7 @@
 import org.apache.commons.logging.Log;
 import org.apache.commons.logging.LogFactory;
 
-public class UDFDefaultSampleHashFn implements UDF {
+public class UDFDefaultSampleHashFn extends UDF {
   protected final Log LOG;
 
   public UDFDefaultSampleHashFn() {
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFFloor.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFFloor.java
index edc2413312..76a217eb28 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFFloor.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFFloor.java
@@ -23,7 +23,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFFloor implements UDF {
+public class UDFFloor extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFFloor.class.getName());
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFFromUnixTime.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFFromUnixTime.java
index 66dbea9c87..25fa01d4d2 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFFromUnixTime.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFFromUnixTime.java
@@ -26,7 +26,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFFromUnixTime implements UDF {
+public class UDFFromUnixTime extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFFromUnixTime.class.getName());
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFJson.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFJson.java
index bb0355a6b0..f7038bfda4 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFJson.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFJson.java
@@ -33,7 +33,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFJson implements UDF {
+public class UDFJson extends UDF {
   private static Log LOG = LogFactory.getLog(UDFJson.class.getName());
   private Pattern pattern_key = Pattern.compile("^([a-zA-Z0-9_\\-]+).*");
   private Pattern pattern_index = Pattern.compile("\\[([0-9]+|\\*)\\]");
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFLTrim.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFLTrim.java
index 333c9317f6..26807c0a8b 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFLTrim.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFLTrim.java
@@ -24,7 +24,7 @@
 import java.util.regex.Pattern;
 import java.util.regex.Matcher;
 
-public class UDFLTrim implements UDF {
+public class UDFLTrim extends UDF {
 
   public UDFLTrim() {
   }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFLike.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFLike.java
index 2bc69ae947..4f659410e6 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFLike.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFLike.java
@@ -24,7 +24,7 @@
 import java.util.regex.Pattern;
 import java.util.regex.Matcher;
 
-public class UDFLike implements UDF {
+public class UDFLike extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFLike.class.getName());
   private String lastLikePattern = null;
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFLower.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFLower.java
index 2c314d9fae..73599964bf 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFLower.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFLower.java
@@ -22,7 +22,7 @@
 import java.util.regex.Pattern;
 import java.util.regex.Matcher;
 
-public class UDFLower implements UDF {
+public class UDFLower extends UDF {
 
   public UDFLower() {
   }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFMonth.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFMonth.java
index 8bc3300d3f..cef392c532 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFMonth.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFMonth.java
@@ -28,7 +28,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFMonth implements UDF {
+public class UDFMonth extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFMonth.class.getName());
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPAnd.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPAnd.java
index 27a121bd5c..347e25136c 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPAnd.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPAnd.java
@@ -23,7 +23,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFOPAnd implements UDF {
+public class UDFOPAnd extends UDF {
 
   private static Log LOG = LogFactory.getLog("org.apache.hadoop.hive.ql.udf.UDFOPAnd");
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPBitAnd.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPBitAnd.java
index 9771e74107..02f849d52f 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPBitAnd.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPBitAnd.java
@@ -23,7 +23,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFOPBitAnd implements UDF {
+public class UDFOPBitAnd extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFOPBitAnd.class.getName());
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPBitNot.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPBitNot.java
index c2fe9a4c70..dbe139d529 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPBitNot.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPBitNot.java
@@ -23,7 +23,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFOPBitNot implements UDF {
+public class UDFOPBitNot extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFOPBitNot.class.getName());
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPBitOr.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPBitOr.java
index ea3f77f012..5543d04eb9 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPBitOr.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPBitOr.java
@@ -23,7 +23,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFOPBitOr implements UDF {
+public class UDFOPBitOr extends UDF {
 
   private static Log LOG = LogFactory.getLog("org.apache.hadoop.hive.ql.udf.UDFOPBitOr");
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPBitXor.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPBitXor.java
index 767da33dd6..e0cee34097 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPBitXor.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPBitXor.java
@@ -23,7 +23,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFOPBitXor implements UDF {
+public class UDFOPBitXor extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFOPBitXor.class.getName());
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPDivide.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPDivide.java
index 579c5296cb..dceb6e3f42 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPDivide.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPDivide.java
@@ -23,7 +23,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFOPDivide implements UDF {
+public class UDFOPDivide extends UDFBaseNumericOp {
 
   private static Log LOG = LogFactory.getLog("org.apache.hadoop.hive.ql.udf.UDFOPDivide");
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPMinus.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPMinus.java
index 4dc86f56ca..758577156e 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPMinus.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPMinus.java
@@ -23,7 +23,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFOPMinus implements UDF {
+public class UDFOPMinus extends UDFBaseNumericOp {
 
   private static Log LOG = LogFactory.getLog("org.apache.hadoop.hive.ql.udf.UDFOPMinus");
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPMod.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPMod.java
index 50e27fff65..ba55adbdf8 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPMod.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPMod.java
@@ -23,7 +23,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFOPMod implements UDF {
+public class UDFOPMod extends UDFBaseNumericOp {
 
   private static Log LOG = LogFactory.getLog("org.apache.hadoop.hive.ql.udf.UDFOPMod");
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPMultiply.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPMultiply.java
index 6542552a58..c8dc741b0f 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPMultiply.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPMultiply.java
@@ -23,7 +23,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFOPMultiply implements UDF {
+public class UDFOPMultiply extends UDFBaseNumericOp {
 
   private static Log LOG = LogFactory.getLog("org.apache.hadoop.hive.ql.udf.UDFOPMultiply");
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPNegative.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPNegative.java
index d69951c1c1..5f8b947233 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPNegative.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPNegative.java
@@ -23,7 +23,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFOPNegative implements UDF {
+public class UDFOPNegative extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFOPNegative.class.getName());
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPNot.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPNot.java
index 2a9d6e927b..102b9c3267 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPNot.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPNot.java
@@ -23,7 +23,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFOPNot implements UDF {
+public class UDFOPNot extends UDF {
 
   private static Log LOG = LogFactory.getLog("org.apache.hadoop.hive.ql.udf.UDFOPNot");
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPNotNull.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPNotNull.java
index 8d0a1ed0cc..9cc40dd97d 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPNotNull.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPNotNull.java
@@ -23,7 +23,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFOPNotNull implements UDF {
+public class UDFOPNotNull extends UDF {
 
   private static Log LOG = LogFactory.getLog("org.apache.hadoop.hive.ql.udf.UDFOPNotNull");
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPNull.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPNull.java
index 720a7a1a88..472bad505a 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPNull.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPNull.java
@@ -23,7 +23,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFOPNull implements UDF {
+public class UDFOPNull extends UDF {
 
   private static Log LOG = LogFactory.getLog("org.apache.hadoop.hive.ql.udf.UDFOPNull");
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPOr.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPOr.java
index 1797dae1bd..984e5414fa 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPOr.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPOr.java
@@ -23,7 +23,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFOPOr implements UDF {
+public class UDFOPOr extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFOPOr.class.getName());
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPPlus.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPPlus.java
index fd5f4f2093..15f233df0f 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPPlus.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPPlus.java
@@ -32,7 +32,7 @@
  * The case of int + double will be handled by implicit type casting using 
  * UDFRegistry.implicitConvertable method. 
  */
-public class UDFOPPlus implements UDF {
+public class UDFOPPlus extends UDFBaseNumericOp {
 
   private static Log LOG = LogFactory.getLog("org.apache.hadoop.hive.ql.udf.UDFOPPlus");
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPPositive.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPPositive.java
index 63d30b1994..1d17585292 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPPositive.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFOPPositive.java
@@ -23,7 +23,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFOPPositive implements UDF {
+public class UDFOPPositive extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFOPPositive.class.getName());
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRTrim.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRTrim.java
index 9c065af1e3..5fb9e6576b 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRTrim.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRTrim.java
@@ -24,7 +24,7 @@
 import java.util.regex.Pattern;
 import java.util.regex.Matcher;
 
-public class UDFRTrim implements UDF {
+public class UDFRTrim extends UDF {
 
   public UDFRTrim() {
   }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRand.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRand.java
index 5d368af090..5b8470f695 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRand.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRand.java
@@ -23,7 +23,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 import java.util.Random;
 
-public class UDFRand implements UDF {
+public class UDFRand extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFRand.class.getName());
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRegExp.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRegExp.java
index 5f6d87e553..e03afbeabe 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRegExp.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRegExp.java
@@ -22,7 +22,7 @@
 import java.util.regex.Pattern;
 import java.util.regex.Matcher;
 
-public class UDFRegExp implements UDF {
+public class UDFRegExp extends UDF {
 
   private String lastRegex = null;
   private Pattern p = null;
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRegExpReplace.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRegExpReplace.java
index 83779c8b7c..5623c2de74 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRegExpReplace.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRegExpReplace.java
@@ -22,7 +22,7 @@
 import java.util.regex.Pattern;
 import java.util.regex.Matcher;
 
-public class UDFRegExpReplace implements UDF {
+public class UDFRegExpReplace extends UDF {
 
   private String lastRegex = null;
   private Pattern p = null;
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRound.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRound.java
index 02db90ae5c..6c06548ee8 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRound.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRound.java
@@ -24,7 +24,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFRound implements UDF {
+public class UDFRound extends UDF {
 
   public UDFRound() {
   }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFSize.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFSize.java
index 45ee1c3414..ba57952746 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFSize.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFSize.java
@@ -23,7 +23,7 @@
 import java.util.Map;
 import java.util.List;
 
-public class UDFSize implements UDF {
+public class UDFSize extends UDF {
 
   public UDFSize() {
   }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFStrGt.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFStrGt.java
deleted file mode 100755
index d407aa2238..0000000000
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFStrGt.java
+++ /dev/null
@@ -1,35 +0,0 @@
-/**
- * Licensed to the Apache Software Foundation (ASF) under one
- * or more contributor license agreements.  See the NOTICE file
- * distributed with this work for additional information
- * regarding copyright ownership.  The ASF licenses this file
- * to you under the Apache License, Version 2.0 (the
- * "License"); you may not use this file except in compliance
- * with the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.apache.hadoop.hive.ql.udf;
-
-import org.apache.commons.logging.Log;
-import org.apache.commons.logging.LogFactory;
-import org.apache.hadoop.hive.ql.exec.UDF;
-
-
-public class UDFStrGt implements UDF {
-
-  public UDFStrGt() {
-  }
-
-  public boolean evaluate(String a, String b)  {
-    int code = a.compareTo(b);
-    return (code > 0);
-  }
-}
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFStrLe.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFStrLe.java
deleted file mode 100755
index 8449b496ce..0000000000
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFStrLe.java
+++ /dev/null
@@ -1,35 +0,0 @@
-/**
- * Licensed to the Apache Software Foundation (ASF) under one
- * or more contributor license agreements.  See the NOTICE file
- * distributed with this work for additional information
- * regarding copyright ownership.  The ASF licenses this file
- * to you under the Apache License, Version 2.0 (the
- * "License"); you may not use this file except in compliance
- * with the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.apache.hadoop.hive.ql.udf;
-
-import org.apache.commons.logging.Log;
-import org.apache.commons.logging.LogFactory;
-import org.apache.hadoop.hive.ql.exec.UDF;
-
-
-public class UDFStrLe implements UDF {
-
-  public UDFStrLe() {
-  }
-
-  public boolean evaluate(String a, String b)  {
-    int code = a.compareTo(b);
-    return (code <= 0);
-  }
-}
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFStrLt.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFStrLt.java
deleted file mode 100755
index 198e3181bf..0000000000
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFStrLt.java
+++ /dev/null
@@ -1,35 +0,0 @@
-/**
- * Licensed to the Apache Software Foundation (ASF) under one
- * or more contributor license agreements.  See the NOTICE file
- * distributed with this work for additional information
- * regarding copyright ownership.  The ASF licenses this file
- * to you under the Apache License, Version 2.0 (the
- * "License"); you may not use this file except in compliance
- * with the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.apache.hadoop.hive.ql.udf;
-
-import org.apache.commons.logging.Log;
-import org.apache.commons.logging.LogFactory;
-import org.apache.hadoop.hive.ql.exec.UDF;
-
-
-public class UDFStrLt implements UDF {
-
-  public UDFStrLt() {
-  }
-
-  public boolean evaluate(String a, String b)  {
-    int code = a.compareTo(b);
-    return (code < 0);
-  }
-}
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFSubstr.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFSubstr.java
index 70e0d5e17d..5510f61495 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFSubstr.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFSubstr.java
@@ -16,25 +16,25 @@
  * limitations under the License.
  */
 
-package org.apache.hadoop.hive.ql.udf;
-
-import org.apache.hadoop.hive.ql.exec.UDF;
-
-
-public class UDFSubstr implements UDF {
-
-  public UDFSubstr() {
-  }
-
-  public String evaluate(String a, int start, int len)  {
-    if (start >= a.length()) return "";
-    if (start + len > a.length()) len = a.length() - start;
-    return a.substring(start, start + len);
-  }
-  
-  public String evaluate(String a, int start)  {
-    if (start >= a.length()) return "";
-    return a.substring(start);
-  }
-
+package org.apache.hadoop.hive.ql.udf;
+
+import org.apache.hadoop.hive.ql.exec.UDF;
+
+
+public class UDFSubstr extends UDF {
+
+  public UDFSubstr() {
+  }
+
+  public String evaluate(String a, int start, int len)  {
+    if (start >= a.length()) return "";
+    if (start + len > a.length()) len = a.length() - start;
+    return a.substring(start, start + len);
+  }
+  
+  public String evaluate(String a, int start)  {
+    if (start >= a.length()) return "";
+    return a.substring(start);
+  }
+
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToBoolean.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToBoolean.java
index 1947943d80..c429345708 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToBoolean.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToBoolean.java
@@ -23,13 +23,23 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFToBoolean implements UDF {
+public class UDFToBoolean extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFToBoolean.class.getName());
 
   public UDFToBoolean() {
   }
 
+  /**
+   * Convert a void to boolean. This is called for CAST(... AS BOOLEAN)
+   *
+   * @param i The value of a void type
+   * @return Boolean
+   */
+  public Boolean evaluate(Void i)  {
+      return null;
+  }
+
   /**
    * Convert from a byte to boolean. This is called for CAST(... AS BOOLEAN)
    *
@@ -114,4 +124,18 @@ public Boolean evaluate(Double i)  {
     }
   }
 
+  /**
+   * Convert from a string to boolean. This is called for CAST(... AS BOOLEAN)
+   *
+   * @param i The string value to convert
+   * @return Boolean
+   */
+  public Boolean evaluate(String i)  {
+    if (i == null) {
+      return null;
+    } else {
+      return Boolean.valueOf(i.length() != 0);
+    }
+  }
+
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToByte.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToByte.java
index 2f837e73ae..7b947b5dc0 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToByte.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToByte.java
@@ -23,13 +23,23 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFToByte implements UDF {
+public class UDFToByte extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFToByte.class.getName());
 
   public UDFToByte() {
   }
 
+  /**
+   * Convert from void to a byte. This is called for CAST(... AS TINYINT)
+   *
+   * @param i The void value to convert
+   * @return Byte
+   */
+  public Byte evaluate(Void i)  {
+    return null;
+  }  
+
   /**
    * Convert from boolean to a byte. This is called for CAST(... AS TINYINT)
    *
@@ -135,4 +145,17 @@ public Byte evaluate(String i)  {
     }
   }
   
+  /**
+   * Convert from date to a Byte. This is called for CAST(... AS TINYINT)
+   *
+   * @param i The date value to convert
+   * @return Byte
+   */
+  public Byte evaluate(java.sql.Date i)  {
+    if (i == null) {
+      return null;
+    } else {
+        return Long.valueOf(i.getTime()).byteValue();
+    }
+  }  
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToDate.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToDate.java
index 74cc122fab..3957089253 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToDate.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToDate.java
@@ -23,7 +23,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFToDate implements UDF {
+public class UDFToDate extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFToDate.class.getName());
 
@@ -44,4 +44,62 @@ public java.sql.Date evaluate(String i)  {
     }
   }
   
+  public java.sql.Date evaluate(Void i) {
+    return null;
+  }
+  
+  public java.sql.Date evaluate(Byte i) {
+    if (i == null) {
+      return null;
+    }
+    else {
+      return new java.sql.Date(i.longValue());
+    }
+  }
+  
+  public java.sql.Date evaluate(Short i) {
+    if (i == null) {
+      return null;
+    }
+    else {
+      return new java.sql.Date(i.longValue());
+    }
+  }
+  
+  public java.sql.Date evaluate(Integer i) {
+    if (i == null) {
+      return null;
+    }
+    else {
+      return new java.sql.Date(i.longValue());
+    }
+  }
+  
+  public java.sql.Date evaluate(Long i) {
+    if (i == null) {
+      return null;
+    }
+    else {
+      return new java.sql.Date(i.longValue());
+    }
+  }
+  
+  public java.sql.Date evaluate(Float i) {
+    if (i == null) {
+      return null;
+    }
+    else {
+      return new java.sql.Date(i.longValue());
+    }
+  }
+  
+  public java.sql.Date evaluate(Double i) {
+    if (i == null) {
+      return null;
+    }
+    else {
+      return new java.sql.Date(i.longValue());
+    }
+  }
+  
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToDouble.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToDouble.java
index 1942456251..ca8869d0d7 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToDouble.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToDouble.java
@@ -23,13 +23,23 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFToDouble implements UDF {
+public class UDFToDouble extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFToDouble.class.getName());
 
   public UDFToDouble() {
   }
 
+  /**
+   * Convert from void to a double. This is called for CAST(... AS DOUBLE)
+   *
+   * @param i The void value to convert
+   * @return Double
+   */
+  public Double evaluate(Void i)  {
+    return null;
+  }
+
   /**
    * Convert from boolean to a double. This is called for CAST(... AS DOUBLE)
    *
@@ -135,4 +145,18 @@ public Double evaluate(String i)  {
     }
   }
   
+  /**
+   * Convert from date to a double. This is called for CAST(... AS DOUBLE)
+   *
+   * @param i The date value to convert
+   * @return Double
+   */
+  public Double evaluate(java.sql.Date i)  {
+    if (i == null) {
+      return null;
+    } else {
+        return Double.valueOf(i.getTime());
+    }
+  }
+  
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToFloat.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToFloat.java
index 816e2c9df6..5c007e8c84 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToFloat.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToFloat.java
@@ -23,13 +23,23 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFToFloat implements UDF {
+public class UDFToFloat extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFToFloat.class.getName());
 
   public UDFToFloat() {
   }
 
+  /**
+   * Convert from void to a float. This is called for CAST(... AS FLOAT)
+   *
+   * @param i The void value to convert
+   * @return Float
+   */
+  public Float evaluate(Void i)  {
+    return null;
+  }
+
   /**
    * Convert from boolean to a float. This is called for CAST(... AS FLOAT)
    *
@@ -131,4 +141,17 @@ public Float evaluate(String i)  {
     }
   }
   
+  /**
+   * Convert from date to a float. This is called for CAST(... AS FLOAT)
+   *
+   * @param i The date value to convert
+   * @return Float
+   */
+  public Float evaluate(java.sql.Date i)  {
+    if (i == null) {
+      return null;
+    } else {
+        return Float.valueOf(i.getTime());
+    }
+  }  
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToInteger.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToInteger.java
index 7683af4053..7f314801ac 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToInteger.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToInteger.java
@@ -23,13 +23,23 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFToInteger implements UDF {
+public class UDFToInteger extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFToInteger.class.getName());
 
   public UDFToInteger() {
   }
 
+  /**
+   * Convert from void to an integer. This is called for CAST(... AS INT)
+   *
+   * @param i The void value to convert
+   * @return Integer
+   */
+  public Integer evaluate(Void i)  {
+    return null;
+  }
+
   /**
    * Convert from boolean to an integer. This is called for CAST(... AS INT)
    *
@@ -135,4 +145,17 @@ public Integer evaluate(String i)  {
     }
   }
   
+  /**
+   * Convert from date to an integer. This is called for CAST(... AS INT)
+   *
+   * @param i The date value to convert
+   * @return Integer
+   */
+  public Integer evaluate(java.sql.Date i)  {
+    if (i == null) {
+      return null;
+    } else {
+        return Long.valueOf(i.getTime()).intValue();
+    }
+  }  
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToLong.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToLong.java
index 53e76015a9..817c692f01 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToLong.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToLong.java
@@ -23,13 +23,23 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFToLong implements UDF {
+public class UDFToLong extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFToLong.class.getName());
 
   public UDFToLong() {
   }
 
+  /**
+   * Convert from void to a long. This is called for CAST(... AS BIGINT)
+   *
+   * @param i The void value to convert
+   * @return Long
+   */
+  public Long evaluate(Void i)  {
+    return null;
+  }
+
   /**
    * Convert from boolean to a long. This is called for CAST(... AS BIGINT)
    *
@@ -145,4 +155,17 @@ public Long evaluate(String i)  {
     }
   }
   
+  /**
+   * Convert from date to a long. This is called for CAST(... AS BIGINT)
+   *
+   * @param i The date value to convert
+   * @return Long
+   */
+  public Long evaluate(java.sql.Date i)  {
+    if (i == null) {
+      return null;
+    } else {
+        return Long.valueOf(i.getTime());
+    }
+  }  
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToShort.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToShort.java
index 1663f580ef..b06ee8aaac 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToShort.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToShort.java
@@ -23,13 +23,23 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFToShort implements UDF {
+public class UDFToShort extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFToByte.class.getName());
 
   public UDFToShort() {
   }
 
+  /**
+   * Convert from void to a short. This is called for CAST(... AS SMALLINT)
+   *
+   * @param i The void value to convert
+   * @return Short
+   */
+  public Short evaluate(Void i)  {
+    return null;
+  }
+
   /**
    * Convert from boolean to a short. This is called for CAST(... AS SMALLINT)
    *
@@ -135,4 +145,17 @@ public Short evaluate(String i)  {
     }
   }
   
+  /**
+   * Convert from date to a short. This is called for CAST(... AS SMALLINT)
+   *
+   * @param i The date value to convert
+   * @return Short
+   */
+  public Short evaluate(java.sql.Date i)  {
+    if (i == null) {
+      return null;
+    } else {
+        return Long.valueOf(i.getTime()).shortValue();
+    }
+  }  
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToString.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToString.java
index ae16e98612..4e7d5a8a9c 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToString.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFToString.java
@@ -23,13 +23,17 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFToString implements UDF {
+public class UDFToString extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFToString.class.getName());
 
   public UDFToString() {
   }
 
+  public String evaluate(Void i)  {
+    return null;
+  }
+
   public String evaluate(Boolean i)  {
     if (i == null) {
       return null;
@@ -86,4 +90,17 @@ public String evaluate(Double i)  {
     }
   }
   
+  /**
+   * Convert from date to a string. This is called for CAST(... AS STRING)
+   *
+   * @param i The date value to convert
+   * @return String
+   */
+  public String evaluate(java.sql.Date i)  {
+    if (i == null) {
+      return null;
+    } else {
+        return i.toString();
+    }
+  }  
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFTrim.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFTrim.java
index 1a11cf94d3..2915fafe56 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFTrim.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFTrim.java
@@ -24,7 +24,7 @@
 import java.util.regex.Pattern;
 import java.util.regex.Matcher;
 
-public class UDFTrim implements UDF {
+public class UDFTrim extends UDF {
 
   public UDFTrim() {
   }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFUpper.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFUpper.java
index f1c3ab9adb..3e73c5e34f 100755
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFUpper.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFUpper.java
@@ -22,7 +22,7 @@
 import java.util.regex.Pattern;
 import java.util.regex.Matcher;
 
-public class UDFUpper implements UDF {
+public class UDFUpper extends UDF {
 
   public UDFUpper() {
   }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFYear.java b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFYear.java
index dba1bec8c2..3406b83fa5 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFYear.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFYear.java
@@ -28,7 +28,7 @@
 import org.apache.hadoop.hive.ql.exec.UDF;
 
 
-public class UDFYear implements UDF {
+public class UDFYear extends UDF {
 
   private static Log LOG = LogFactory.getLog(UDFYear.class.getName());
 
diff --git a/ql/src/test/org/apache/hadoop/hive/ql/exec/TestExecDriver.java b/ql/src/test/org/apache/hadoop/hive/ql/exec/TestExecDriver.java
index 9333192097..9463a6eef0 100644
--- a/ql/src/test/org/apache/hadoop/hive/ql/exec/TestExecDriver.java
+++ b/ql/src/test/org/apache/hadoop/hive/ql/exec/TestExecDriver.java
@@ -146,16 +146,32 @@ private static void fileDiff(String datafile, String testdir) throws Exception {
 
 
   private filterDesc getTestFilterDesc(String column) {
-    ArrayList<exprNodeDesc> children = new ArrayList<exprNodeDesc>();
-    children.add(new exprNodeColumnDesc(TypeInfoFactory.getPrimitiveTypeInfo(String.class), column));
-    children.add(new exprNodeConstantDesc(TypeInfoFactory.getPrimitiveTypeInfo(Number.class), Long.valueOf(100)));
-
+    ArrayList<exprNodeDesc> children1 = new ArrayList<exprNodeDesc>();
+    children1.add(new exprNodeColumnDesc(TypeInfoFactory.getPrimitiveTypeInfo(String.class), column));
+    exprNodeDesc lhs = new exprNodeFuncDesc(
+        TypeInfoFactory.getPrimitiveTypeInfo(Double.class),
+        FunctionRegistry.getUDFClass(Double.class.getName()),
+        FunctionRegistry.getUDFMethod(Double.class.getName(), String.class),
+        children1);
+    
+    ArrayList<exprNodeDesc> children2 = new ArrayList<exprNodeDesc>();
+    children2.add(new exprNodeConstantDesc(TypeInfoFactory.getPrimitiveTypeInfo(Long.class), Long.valueOf(100)));
+    exprNodeDesc rhs = new exprNodeFuncDesc(
+        TypeInfoFactory.getPrimitiveTypeInfo(Double.class),
+        FunctionRegistry.getUDFClass(Double.class.getName()),
+        FunctionRegistry.getUDFMethod(Double.class.getName(), Long.class),
+        children2);
+    
+    ArrayList<exprNodeDesc> children3 = new ArrayList<exprNodeDesc>();
+    children3.add(lhs);
+    children3.add(rhs);
+    
     exprNodeDesc desc = new exprNodeFuncDesc(
         TypeInfoFactory.getPrimitiveTypeInfo(Boolean.class),
         FunctionRegistry.getUDFClass("<"),
-        FunctionRegistry.getUDFMethod("<", true, String.class, Number.class),
-        children
-    );
+        FunctionRegistry.getUDFMethod("<", Double.class, Double.class),
+        children3);
+    
     return new filterDesc(desc);
   }
 
diff --git a/ql/src/test/org/apache/hadoop/hive/ql/exec/TestExpressionEvaluator.java b/ql/src/test/org/apache/hadoop/hive/ql/exec/TestExpressionEvaluator.java
index 4f31212f47..1ac16f869b 100644
--- a/ql/src/test/org/apache/hadoop/hive/ql/exec/TestExpressionEvaluator.java
+++ b/ql/src/test/org/apache/hadoop/hive/ql/exec/TestExpressionEvaluator.java
@@ -25,6 +25,7 @@
 import org.apache.hadoop.hive.serde2.objectinspector.InspectableObject;
 import org.apache.hadoop.hive.ql.metadata.HiveException;
 import org.apache.hadoop.hive.ql.parse.SemanticAnalyzer;
+import org.apache.hadoop.hive.ql.parse.TypeCheckProcFactory;
 import org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc;
 import org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc;
 import org.apache.hadoop.hive.ql.plan.exprNodeDesc;
@@ -111,7 +112,7 @@ public void testExprNodeFuncEvaluator() throws Throwable {
       exprNodeDesc coladesc = new exprNodeColumnDesc(colaType, "cola");
       exprNodeDesc col11desc = new exprNodeIndexDesc(col1desc, new exprNodeConstantDesc(new Integer(1)));
       exprNodeDesc cola0desc = new exprNodeIndexDesc(coladesc, new exprNodeConstantDesc(new Integer(0)));
-      exprNodeDesc func1 = SemanticAnalyzer.getFuncExprNodeDesc("concat", col11desc, cola0desc);
+      exprNodeDesc func1 = TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("concat", col11desc, cola0desc);
       ExprNodeEvaluator eval = ExprNodeEvaluatorFactory.get(func1);
 
       // evaluate on row
@@ -130,7 +131,7 @@ public void testExprNodeConversionEvaluator() throws Throwable {
       // get a evaluator for a string concatenation expression
       exprNodeDesc col1desc = new exprNodeColumnDesc(col1Type, "col1");
       exprNodeDesc col11desc = new exprNodeIndexDesc(col1desc, new exprNodeConstantDesc(new Integer(1)));
-      exprNodeDesc func1 = SemanticAnalyzer.getFuncExprNodeDesc(Double.class.getName(), col11desc);
+      exprNodeDesc func1 = TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc(Double.class.getName(), col11desc);
       ExprNodeEvaluator eval = ExprNodeEvaluatorFactory.get(func1);
 
       // evaluate on row
@@ -164,7 +165,7 @@ public void testExprNodeSpeed() throws Throwable {
       measureSpeed("1 + 2",
           basetimes * 100,
           ExprNodeEvaluatorFactory.get(
-              SemanticAnalyzer.getFuncExprNodeDesc("+", 
+              TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("+", 
                   new exprNodeConstantDesc(1), 
                   new exprNodeConstantDesc(2))),
           r,
@@ -172,8 +173,8 @@ public void testExprNodeSpeed() throws Throwable {
       measureSpeed("1 + 2 - 3",
           basetimes * 100,
           ExprNodeEvaluatorFactory.get(
-              SemanticAnalyzer.getFuncExprNodeDesc("-", 
-                  SemanticAnalyzer.getFuncExprNodeDesc("+",
+              TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("-", 
+                  TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("+",
                       new exprNodeConstantDesc(1), 
                       new exprNodeConstantDesc(2)),
                   new exprNodeConstantDesc(3))),
@@ -182,9 +183,9 @@ public void testExprNodeSpeed() throws Throwable {
       measureSpeed("1 + 2 - 3 + 4",
           basetimes * 100,
           ExprNodeEvaluatorFactory.get(
-              SemanticAnalyzer.getFuncExprNodeDesc("+",
-                  SemanticAnalyzer.getFuncExprNodeDesc("-", 
-                      SemanticAnalyzer.getFuncExprNodeDesc("+",
+              TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("+",
+                  TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("-", 
+                      TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("+",
                           new exprNodeConstantDesc(1), 
                           new exprNodeConstantDesc(2)),
                       new exprNodeConstantDesc(3)),
@@ -194,7 +195,7 @@ public void testExprNodeSpeed() throws Throwable {
       measureSpeed("concat(\"1\", \"2\")",
           basetimes * 100,
           ExprNodeEvaluatorFactory.get(
-              SemanticAnalyzer.getFuncExprNodeDesc("concat", 
+              TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("concat", 
                   new exprNodeConstantDesc("1"), 
                   new exprNodeConstantDesc("2"))),
           r,
@@ -202,8 +203,8 @@ public void testExprNodeSpeed() throws Throwable {
       measureSpeed("concat(concat(\"1\", \"2\"), \"3\")",
           basetimes * 100,
           ExprNodeEvaluatorFactory.get(
-              SemanticAnalyzer.getFuncExprNodeDesc("concat", 
-                  SemanticAnalyzer.getFuncExprNodeDesc("concat",
+              TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("concat", 
+                  TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("concat",
                       new exprNodeConstantDesc("1"), 
                       new exprNodeConstantDesc("2")),
                   new exprNodeConstantDesc("3"))),
@@ -212,9 +213,9 @@ public void testExprNodeSpeed() throws Throwable {
       measureSpeed("concat(concat(concat(\"1\", \"2\"), \"3\"), \"4\")",
           basetimes * 100,
           ExprNodeEvaluatorFactory.get(
-              SemanticAnalyzer.getFuncExprNodeDesc("concat", 
-                SemanticAnalyzer.getFuncExprNodeDesc("concat", 
-                    SemanticAnalyzer.getFuncExprNodeDesc("concat",
+              TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("concat", 
+                TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("concat", 
+                    TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("concat",
                         new exprNodeConstantDesc("1"), 
                         new exprNodeConstantDesc("2")),
                     new exprNodeConstantDesc("3")),
@@ -226,7 +227,7 @@ public void testExprNodeSpeed() throws Throwable {
       measureSpeed("concat(col1[1], cola[1])", 
           basetimes * 10,
           ExprNodeEvaluatorFactory.get(
-              SemanticAnalyzer.getFuncExprNodeDesc("concat",
+              TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("concat",
                   new exprNodeIndexDesc(new exprNodeColumnDesc(col1Type, "col1"), constant1), 
                   new exprNodeIndexDesc(new exprNodeColumnDesc(colaType, "cola"), constant1))),
           r,
@@ -234,8 +235,8 @@ public void testExprNodeSpeed() throws Throwable {
       measureSpeed("concat(concat(col1[1], cola[1]), col1[2])", 
           basetimes * 10,
           ExprNodeEvaluatorFactory.get(
-              SemanticAnalyzer.getFuncExprNodeDesc("concat", 
-                  SemanticAnalyzer.getFuncExprNodeDesc("concat", 
+              TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("concat", 
+                  TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("concat", 
                       new exprNodeIndexDesc(new exprNodeColumnDesc(col1Type, "col1"), constant1), 
                       new exprNodeIndexDesc(new exprNodeColumnDesc(colaType, "cola"), constant1)),
                   new exprNodeIndexDesc(new exprNodeColumnDesc(col1Type, "col1"), constant2))),
@@ -244,9 +245,9 @@ public void testExprNodeSpeed() throws Throwable {
       measureSpeed("concat(concat(concat(col1[1], cola[1]), col1[2]), cola[2])", 
           basetimes * 10,
           ExprNodeEvaluatorFactory.get(
-              SemanticAnalyzer.getFuncExprNodeDesc("concat", 
-                  SemanticAnalyzer.getFuncExprNodeDesc("concat", 
-                      SemanticAnalyzer.getFuncExprNodeDesc("concat", 
+              TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("concat", 
+                  TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("concat", 
+                      TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("concat", 
                           new exprNodeIndexDesc(new exprNodeColumnDesc(col1Type, "col1"), constant1), 
                           new exprNodeIndexDesc(new exprNodeColumnDesc(colaType, "cola"), constant1)),
                       new exprNodeIndexDesc(new exprNodeColumnDesc(col1Type, "col1"), constant2)),
diff --git a/ql/src/test/org/apache/hadoop/hive/ql/exec/TestOperators.java b/ql/src/test/org/apache/hadoop/hive/ql/exec/TestOperators.java
index c7601ac93c..ea0c88aa58 100644
--- a/ql/src/test/org/apache/hadoop/hive/ql/exec/TestOperators.java
+++ b/ql/src/test/org/apache/hadoop/hive/ql/exec/TestOperators.java
@@ -29,6 +29,7 @@
 
 
 import org.apache.hadoop.hive.ql.parse.SemanticAnalyzer;
+import org.apache.hadoop.hive.ql.parse.TypeCheckProcFactory;
 import org.apache.hadoop.hive.ql.plan.*;
 import org.apache.hadoop.hive.ql.typeinfo.TypeInfoFactory;
 import org.apache.hadoop.hive.conf.HiveConf;
@@ -74,10 +75,10 @@ public void testBaseFilterOperator() throws Throwable {
       exprNodeDesc col0 = new exprNodeColumnDesc(String.class, "col0");
       exprNodeDesc col1 = new exprNodeColumnDesc(String.class, "col1");
       exprNodeDesc col2 = new exprNodeColumnDesc(String.class, "col2");
-      exprNodeDesc zero = new exprNodeConstantDesc(Number.class, Long.valueOf(0));
-      exprNodeDesc func1 = SemanticAnalyzer.getFuncExprNodeDesc(">", col2, col1);
-      exprNodeDesc func2 = SemanticAnalyzer.getFuncExprNodeDesc("==", col0, zero);
-      exprNodeDesc func3 = SemanticAnalyzer.getFuncExprNodeDesc("&&", func1, func2); 
+      exprNodeDesc zero = new exprNodeConstantDesc(String.class, "0");
+      exprNodeDesc func1 = TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc(">", col2, col1);
+      exprNodeDesc func2 = TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("==", col0, zero);
+      exprNodeDesc func3 = TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("&&", func1, func2); 
       assert(func3 != null);
       filterDesc filterCtx = new filterDesc(func3);
 
@@ -122,7 +123,7 @@ public void testFileSinkOperator() throws Throwable {
       ArrayList<exprNodeDesc> exprDesc2children = new ArrayList<exprNodeDesc>();
       exprNodeDesc expr1 = new exprNodeColumnDesc(String.class, "col0");
       exprNodeDesc expr2 = new exprNodeConstantDesc("1");
-      exprNodeDesc exprDesc2 = SemanticAnalyzer.getFuncExprNodeDesc("concat", expr1, expr2);
+      exprNodeDesc exprDesc2 = TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("concat", expr1, expr2);
 
       // select operator to project these two columns
       ArrayList<exprNodeDesc> earr = new ArrayList<exprNodeDesc> ();
@@ -167,7 +168,7 @@ public void testScriptOperator() throws Throwable {
       // col2
       exprNodeDesc expr1 = new exprNodeColumnDesc(String.class, "col0");
       exprNodeDesc expr2 = new exprNodeConstantDesc("1");
-      exprNodeDesc exprDesc2 = SemanticAnalyzer.getFuncExprNodeDesc("concat", expr1, expr2);
+      exprNodeDesc exprDesc2 = TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("concat", expr1, expr2);
 
       // select operator to project these two columns
       ArrayList<exprNodeDesc> earr = new ArrayList<exprNodeDesc> ();
diff --git a/ql/src/test/org/apache/hadoop/hive/ql/exec/TestPlan.java b/ql/src/test/org/apache/hadoop/hive/ql/exec/TestPlan.java
index 660e90979e..36427675b6 100644
--- a/ql/src/test/org/apache/hadoop/hive/ql/exec/TestPlan.java
+++ b/ql/src/test/org/apache/hadoop/hive/ql/exec/TestPlan.java
@@ -26,6 +26,7 @@
 import org.apache.hadoop.mapred.TextInputFormat;
 
 import org.apache.hadoop.hive.ql.parse.SemanticAnalyzer;
+import org.apache.hadoop.hive.ql.parse.TypeCheckProcFactory;
 import org.apache.hadoop.hive.ql.plan.*;
 import org.apache.hadoop.hive.ql.typeinfo.TypeInfoFactory;
 import org.apache.hadoop.hive.ql.exec.Utilities;
@@ -44,7 +45,7 @@ public void testPlan() throws Exception {
       // initialize a complete map reduce configuration
       exprNodeDesc expr1 = new exprNodeColumnDesc(TypeInfoFactory.getPrimitiveTypeInfo(String.class), F1);
       exprNodeDesc expr2 = new exprNodeColumnDesc(TypeInfoFactory.getPrimitiveTypeInfo(String.class), F2);
-      exprNodeDesc filterExpr = SemanticAnalyzer.getFuncExprNodeDesc("==", expr1, expr2);
+      exprNodeDesc filterExpr = TypeCheckProcFactory.DefaultExprProcessor.getFuncExprNodeDesc("==", expr1, expr2);
 
       filterDesc filterCtx = new filterDesc(filterExpr);
       Operator<filterDesc> op = OperatorFactory.get(filterDesc.class);
diff --git a/ql/src/test/org/apache/hadoop/hive/ql/udf/UDFTestLength.java b/ql/src/test/org/apache/hadoop/hive/ql/udf/UDFTestLength.java
index 151710a16b..3c13b17302 100644
--- a/ql/src/test/org/apache/hadoop/hive/ql/udf/UDFTestLength.java
+++ b/ql/src/test/org/apache/hadoop/hive/ql/udf/UDFTestLength.java
@@ -23,7 +23,7 @@
 /**
  * A UDF for testing, which evaluates the length of a string.
  */
-public class UDFTestLength implements UDF {
+public class UDFTestLength extends UDF {
   public Integer evaluate(String s) {
     return s == null ? null : s.length();
   }
diff --git a/ql/src/test/queries/clientpositive/implicit_cast1.q b/ql/src/test/queries/clientpositive/implicit_cast1.q
new file mode 100644
index 0000000000..72a055a6ec
--- /dev/null
+++ b/ql/src/test/queries/clientpositive/implicit_cast1.q
@@ -0,0 +1,13 @@
+CREATE TABLE implicit_test1(a BIGINT, b STRING) ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe' WITH SERDEPROPERTIES('serialization.format'= 'org.apache.hadoop.hive.serde2.thrift.TCTLSeparatedProtocol') STORED AS TEXTFILE;
+
+EXPLAIN
+SELECT implicit_test1.*
+FROM implicit_test1
+WHERE implicit_test1.a <> 0;
+
+SELECT implicit_test1.*
+FROM implicit_test1
+WHERE implicit_test1.a <> 0;
+
+DROP TABLE implicit_test1;
+
diff --git a/ql/src/test/results/clientpositive/cast1.q.out b/ql/src/test/results/clientpositive/cast1.q.out
index 8273558930..8e440b3420 100644
--- a/ql/src/test/results/clientpositive/cast1.q.out
+++ b/ql/src/test/results/clientpositive/cast1.q.out
@@ -16,7 +16,7 @@ STAGE PLANS:
                     type: string
               Filter Operator
                 predicate:
-                    expr: (0 = 86)
+                    expr: (UDFToDouble(0) = UDFToDouble(86))
                     type: boolean
                 Select Operator
                   expressions:
diff --git a/ql/src/test/results/clientpositive/cluster.q.out b/ql/src/test/results/clientpositive/cluster.q.out
index e3ddf0d0f6..dacc7ea164 100644
--- a/ql/src/test/results/clientpositive/cluster.q.out
+++ b/ql/src/test/results/clientpositive/cluster.q.out
@@ -12,7 +12,7 @@ STAGE PLANS:
         x 
             Filter Operator
               predicate:
-                  expr: (key = 10)
+                  expr: (UDFToDouble(key) = UDFToDouble(10))
                   type: boolean
               Select Operator
                 expressions:
@@ -62,7 +62,7 @@ STAGE PLANS:
         x 
             Filter Operator
               predicate:
-                  expr: (key = 20)
+                  expr: (UDFToDouble(key) = UDFToDouble(20))
                   type: boolean
               Select Operator
                 expressions:
@@ -112,7 +112,7 @@ STAGE PLANS:
         x 
             Filter Operator
               predicate:
-                  expr: (key = 20)
+                  expr: (UDFToDouble(key) = UDFToDouble(20))
                   type: boolean
               Select Operator
                 expressions:
@@ -162,7 +162,7 @@ STAGE PLANS:
         x 
             Filter Operator
               predicate:
-                  expr: (key = 20)
+                  expr: (UDFToDouble(key) = UDFToDouble(20))
                   type: boolean
               Select Operator
                 expressions:
@@ -212,7 +212,7 @@ STAGE PLANS:
         x 
             Filter Operator
               predicate:
-                  expr: (key = 20)
+                  expr: (UDFToDouble(key) = UDFToDouble(20))
                   type: boolean
               Select Operator
                 expressions:
@@ -262,7 +262,7 @@ STAGE PLANS:
         x 
             Filter Operator
               predicate:
-                  expr: (key = 20)
+                  expr: (UDFToDouble(key) = UDFToDouble(20))
                   type: boolean
               Select Operator
                 expressions:
@@ -312,7 +312,7 @@ STAGE PLANS:
         x 
             Filter Operator
               predicate:
-                  expr: (key = 20)
+                  expr: (UDFToDouble(key) = UDFToDouble(20))
                   type: boolean
               Select Operator
                 expressions:
@@ -384,7 +384,7 @@ STAGE PLANS:
         Extract
           Filter Operator
             predicate:
-                expr: (0 = 20)
+                expr: (UDFToDouble(0) = UDFToDouble(20))
                 type: boolean
             Select Operator
               expressions:
@@ -457,7 +457,7 @@ STAGE PLANS:
             1 {VALUE.0}
           Filter Operator
             predicate:
-                expr: (0 = 20)
+                expr: (UDFToDouble(0) = UDFToDouble(20))
                 type: boolean
             Select Operator
               expressions:
@@ -477,7 +477,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /data/users/pchakka/workspace/oshive/build/ql/tmp/4095681/630596716.10002 
+        /data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/268129150/10750666.10002 
           Reduce Output Operator
             key expressions:
                   expr: 1
@@ -559,7 +559,7 @@ STAGE PLANS:
             1 {VALUE.0} {VALUE.1}
           Filter Operator
             predicate:
-                expr: (0 = 20)
+                expr: (UDFToDouble(0) = UDFToDouble(20))
                 type: boolean
             Select Operator
               expressions:
@@ -581,7 +581,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /data/users/pchakka/workspace/oshive/build/ql/tmp/462292647/163669153.10002 
+        /data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/223878920/107499083.10002 
           Reduce Output Operator
             key expressions:
                   expr: 1
@@ -665,7 +665,7 @@ STAGE PLANS:
             1 {VALUE.0} {VALUE.1}
           Filter Operator
             predicate:
-                expr: (0 = 20)
+                expr: (UDFToDouble(0) = UDFToDouble(20))
                 type: boolean
             Select Operator
               expressions:
@@ -687,7 +687,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /data/users/pchakka/workspace/oshive/build/ql/tmp/72781939/1364102870.10002 
+        /data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/273045729/75938714.10002 
           Reduce Output Operator
             key expressions:
                   expr: 0
@@ -773,7 +773,7 @@ STAGE PLANS:
             1 {VALUE.0}
           Filter Operator
             predicate:
-                expr: (0 = 20)
+                expr: (UDFToDouble(0) = UDFToDouble(20))
                 type: boolean
             Select Operator
               expressions:
@@ -793,7 +793,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /data/users/pchakka/workspace/oshive/build/ql/tmp/808635/840293573.10002 
+        /data/users/athusoo/commits/hive_trunk_ws2/build/ql/tmp/294539045/192652633.10002 
           Reduce Output Operator
             key expressions:
                   expr: 0
@@ -838,7 +838,7 @@ STAGE PLANS:
         null-subquery1:unioninput-subquery1:src 
             Filter Operator
               predicate:
-                  expr: (key < 100)
+                  expr: (UDFToDouble(key) < UDFToDouble(100))
                   type: boolean
               Select Operator
                 expressions:
@@ -869,7 +869,7 @@ STAGE PLANS:
         null-subquery2:unioninput-subquery2:src 
             Filter Operator
               predicate:
-                  expr: (key > 100)
+                  expr: (UDFToDouble(key) > UDFToDouble(100))
                   type: boolean
               Select Operator
                 expressions:
diff --git a/ql/src/test/results/clientpositive/groupby3.q.out b/ql/src/test/results/clientpositive/groupby3.q.out
index 182f773525..52cb02aa3e 100644
--- a/ql/src/test/results/clientpositive/groupby3.q.out
+++ b/ql/src/test/results/clientpositive/groupby3.q.out
@@ -30,8 +30,8 @@ STAGE PLANS:
                 expr: avg(DISTINCT UDFToDouble(KEY.0))
                 expr: sum(UDFToDouble(KEY.0))
                 expr: avg(UDFToDouble(KEY.0))
-                expr: min(UDFToDouble(KEY.0))
-                expr: max(UDFToDouble(KEY.0))
+                expr: min(KEY.0)
+                expr: max(KEY.0)
           mode: partial1
           File Output Operator
             compressed: false
@@ -43,7 +43,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /tmp/hive-zshao/695280947/659390410.10001 
+        /data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/tmp/191882138/597396542.10001 
           Reduce Output Operator
             sort order: 
             tag: -1
@@ -55,15 +55,15 @@ STAGE PLANS:
                   expr: 2
                   type: string
                   expr: 3
-                  type: double
+                  type: string
                   expr: 4
-                  type: double
+                  type: string
       Reduce Operator Tree:
         Group By Operator
           aggregations:
-                expr: avg(VALUE.0)
+                expr: avg(UDFToDouble(VALUE.0))
                 expr: sum(VALUE.1)
-                expr: avg(VALUE.2)
+                expr: avg(UDFToDouble(VALUE.2))
                 expr: min(VALUE.3)
                 expr: max(VALUE.4)
           mode: final
@@ -76,16 +76,28 @@ STAGE PLANS:
                   expr: 0
                   type: double
                   expr: 4
-                  type: double
+                  type: string
                   expr: 3
-                  type: double
-            File Output Operator
-              compressed: false
-              table:
-                  input format: org.apache.hadoop.mapred.TextInputFormat
-                  output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
-                  serde: org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe
-                  name: dest1
+                  type: string
+            Select Operator
+              expressions:
+                    expr: 0
+                    type: double
+                    expr: 1
+                    type: double
+                    expr: 2
+                    type: double
+                    expr: UDFToDouble(3)
+                    type: double
+                    expr: UDFToDouble(4)
+                    type: double
+              File Output Operator
+                compressed: false
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+                    serde: org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe
+                    name: dest1
 
   Stage: Stage-0
     Move Operator
@@ -98,4 +110,4 @@ STAGE PLANS:
                 name: dest1
 
 
-130091.0	260.182	256.10355987055016	498.0	0.0
+130091.0	NULL	NULL	98.0	98.0
diff --git a/ql/src/test/results/clientpositive/groupby3_map.q.out b/ql/src/test/results/clientpositive/groupby3_map.q.out
index e2b007ad78..2ac3c3ecdf 100644
--- a/ql/src/test/results/clientpositive/groupby3_map.q.out
+++ b/ql/src/test/results/clientpositive/groupby3_map.q.out
@@ -20,8 +20,8 @@ STAGE PLANS:
                       expr: avg(DISTINCT UDFToDouble(substr(0, 4)))
                       expr: sum(UDFToDouble(substr(0, 4)))
                       expr: avg(UDFToDouble(substr(0, 4)))
-                      expr: min(UDFToDouble(substr(0, 4)))
-                      expr: max(UDFToDouble(substr(0, 4)))
+                      expr: min(substr(0, 4))
+                      expr: max(substr(0, 4))
                 keys:
                       expr: substr(0, 4)
                       type: string
@@ -43,15 +43,15 @@ STAGE PLANS:
                         expr: 3
                         type: string
                         expr: 4
-                        type: double
+                        type: string
                         expr: 5
-                        type: double
+                        type: string
       Reduce Operator Tree:
         Group By Operator
           aggregations:
                 expr: avg(DISTINCT UDFToDouble(KEY.0))
                 expr: sum(VALUE.1)
-                expr: avg(VALUE.2)
+                expr: avg(UDFToDouble(VALUE.2))
                 expr: min(VALUE.3)
                 expr: max(VALUE.4)
           mode: partial2
@@ -65,7 +65,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /tmp/hive-zshao/151053238/135596442.10001 
+        /data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/tmp/885399493/544614010.10001 
           Reduce Output Operator
             sort order: 
             tag: -1
@@ -77,15 +77,15 @@ STAGE PLANS:
                   expr: 2
                   type: string
                   expr: 3
-                  type: double
+                  type: string
                   expr: 4
-                  type: double
+                  type: string
       Reduce Operator Tree:
         Group By Operator
           aggregations:
-                expr: avg(VALUE.0)
+                expr: avg(UDFToDouble(VALUE.0))
                 expr: sum(VALUE.1)
-                expr: avg(VALUE.2)
+                expr: avg(UDFToDouble(VALUE.2))
                 expr: min(VALUE.3)
                 expr: max(VALUE.4)
           mode: final
@@ -98,16 +98,28 @@ STAGE PLANS:
                   expr: 0
                   type: double
                   expr: 4
-                  type: double
+                  type: string
                   expr: 3
-                  type: double
-            File Output Operator
-              compressed: false
-              table:
-                  input format: org.apache.hadoop.mapred.TextInputFormat
-                  output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
-                  serde: org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe
-                  name: dest1
+                  type: string
+            Select Operator
+              expressions:
+                    expr: 0
+                    type: double
+                    expr: 1
+                    type: double
+                    expr: 2
+                    type: double
+                    expr: UDFToDouble(3)
+                    type: double
+                    expr: UDFToDouble(4)
+                    type: double
+              File Output Operator
+                compressed: false
+                table:
+                    input format: org.apache.hadoop.mapred.TextInputFormat
+                    output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+                    serde: org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe
+                    name: dest1
 
   Stage: Stage-0
     Move Operator
@@ -120,4 +132,4 @@ STAGE PLANS:
                 name: dest1
 
 
-130091.0	260.182	256.10355987055016	498.0	0.0
+130091.0	NULL	NULL	98.0	98.0
diff --git a/ql/src/test/results/clientpositive/implicit_cast1.q.out b/ql/src/test/results/clientpositive/implicit_cast1.q.out
new file mode 100644
index 0000000000..ce0090c23f
--- /dev/null
+++ b/ql/src/test/results/clientpositive/implicit_cast1.q.out
@@ -0,0 +1,33 @@
+ABSTRACT SYNTAX TREE:
+  (TOK_QUERY (TOK_FROM (TOK_TABREF implicit_test1)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_ALLCOLREF implicit_test1))) (TOK_WHERE (<> (TOK_COLREF implicit_test1 a) 0))))
+
+STAGE DEPENDENCIES:
+  Stage-1 is a root stage
+  Stage-0 is a root stage
+
+STAGE PLANS:
+  Stage: Stage-1
+    Map Reduce
+      Alias -> Map Operator Tree:
+        implicit_test1 
+            Filter Operator
+              predicate:
+                  expr: (UDFToDouble(a) <> UDFToDouble(0))
+                  type: boolean
+              Select Operator
+                expressions:
+                      expr: a
+                      type: bigint
+                      expr: b
+                      type: string
+                File Output Operator
+                  compressed: false
+                  table:
+                      input format: org.apache.hadoop.mapred.TextInputFormat
+                      output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
+
+  Stage: Stage-0
+    Fetch Operator
+      limit: -1
+
+
diff --git a/ql/src/test/results/clientpositive/input11.q.out b/ql/src/test/results/clientpositive/input11.q.out
index 6acb5ab520..bd5dc0d94f 100644
--- a/ql/src/test/results/clientpositive/input11.q.out
+++ b/ql/src/test/results/clientpositive/input11.q.out
@@ -12,7 +12,7 @@ STAGE PLANS:
         src 
             Filter Operator
               predicate:
-                  expr: (key < 100)
+                  expr: (UDFToDouble(key) < UDFToDouble(100))
                   type: boolean
               Select Operator
                 expressions:
diff --git a/ql/src/test/results/clientpositive/input11_limit.q.out b/ql/src/test/results/clientpositive/input11_limit.q.out
index 2656847533..9d2e569a8c 100644
--- a/ql/src/test/results/clientpositive/input11_limit.q.out
+++ b/ql/src/test/results/clientpositive/input11_limit.q.out
@@ -12,7 +12,7 @@ STAGE PLANS:
         src 
             Filter Operator
               predicate:
-                  expr: (key < 100)
+                  expr: (UDFToDouble(key) < UDFToDouble(100))
                   type: boolean
               Select Operator
                 expressions:
diff --git a/ql/src/test/results/clientpositive/input12.q.out b/ql/src/test/results/clientpositive/input12.q.out
index 252138464b..54d77c765b 100644
--- a/ql/src/test/results/clientpositive/input12.q.out
+++ b/ql/src/test/results/clientpositive/input12.q.out
@@ -12,7 +12,7 @@ STAGE PLANS:
         src 
             Filter Operator
               predicate:
-                  expr: (key < 100)
+                  expr: (UDFToDouble(key) < UDFToDouble(100))
                   type: boolean
               Select Operator
                 expressions:
@@ -35,7 +35,7 @@ STAGE PLANS:
                         name: dest1
             Filter Operator
               predicate:
-                  expr: ((key >= 100) and (key < 200))
+                  expr: ((UDFToDouble(key) >= UDFToDouble(100)) and (UDFToDouble(key) < UDFToDouble(200)))
                   type: boolean
               Select Operator
                 expressions:
@@ -58,7 +58,7 @@ STAGE PLANS:
                         name: dest2
             Filter Operator
               predicate:
-                  expr: (key >= 200)
+                  expr: (UDFToDouble(key) >= UDFToDouble(200))
                   type: boolean
               Select Operator
                 expressions:
diff --git a/ql/src/test/results/clientpositive/input13.q.out b/ql/src/test/results/clientpositive/input13.q.out
index 7ed39d5aad..bf6fa9a7a4 100644
--- a/ql/src/test/results/clientpositive/input13.q.out
+++ b/ql/src/test/results/clientpositive/input13.q.out
@@ -12,7 +12,7 @@ STAGE PLANS:
         src 
             Filter Operator
               predicate:
-                  expr: (key < 100)
+                  expr: (UDFToDouble(key) < UDFToDouble(100))
                   type: boolean
               Select Operator
                 expressions:
@@ -35,7 +35,7 @@ STAGE PLANS:
                         name: dest1
             Filter Operator
               predicate:
-                  expr: ((key >= 100) and (key < 200))
+                  expr: ((UDFToDouble(key) >= UDFToDouble(100)) and (UDFToDouble(key) < UDFToDouble(200)))
                   type: boolean
               Select Operator
                 expressions:
@@ -58,7 +58,7 @@ STAGE PLANS:
                         name: dest2
             Filter Operator
               predicate:
-                  expr: ((key >= 200) and (key < 300))
+                  expr: ((UDFToDouble(key) >= UDFToDouble(200)) and (UDFToDouble(key) < UDFToDouble(300)))
                   type: boolean
               Select Operator
                 expressions:
@@ -77,7 +77,7 @@ STAGE PLANS:
                         name: dest3
             Filter Operator
               predicate:
-                  expr: (key >= 300)
+                  expr: (UDFToDouble(key) >= UDFToDouble(300))
                   type: boolean
               Select Operator
                 expressions:
diff --git a/ql/src/test/results/clientpositive/input14.q.out b/ql/src/test/results/clientpositive/input14.q.out
index 351976ee62..340c17c244 100644
--- a/ql/src/test/results/clientpositive/input14.q.out
+++ b/ql/src/test/results/clientpositive/input14.q.out
@@ -39,7 +39,7 @@ STAGE PLANS:
         Extract
           Filter Operator
             predicate:
-                expr: (0 < 100)
+                expr: (UDFToDouble(0) < UDFToDouble(100))
                 type: boolean
             Select Operator
               expressions:
diff --git a/ql/src/test/results/clientpositive/input14_limit.q.out b/ql/src/test/results/clientpositive/input14_limit.q.out
index a3a0c18cc2..dbffa326dd 100644
--- a/ql/src/test/results/clientpositive/input14_limit.q.out
+++ b/ql/src/test/results/clientpositive/input14_limit.q.out
@@ -49,7 +49,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /data/users/pchakka/workspace/oshive/build/ql/tmp/557187098/238412176.10001 
+        /data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/tmp/456652865/144848153.10001 
           Reduce Output Operator
             key expressions:
                   expr: 0
@@ -70,7 +70,7 @@ STAGE PLANS:
           Limit
             Filter Operator
               predicate:
-                  expr: (0 < 100)
+                  expr: (UDFToDouble(0) < UDFToDouble(100))
                   type: boolean
               Select Operator
                 expressions:
diff --git a/ql/src/test/results/clientpositive/input18.q.out b/ql/src/test/results/clientpositive/input18.q.out
index dd886a20d1..39fd15a1b7 100644
--- a/ql/src/test/results/clientpositive/input18.q.out
+++ b/ql/src/test/results/clientpositive/input18.q.out
@@ -43,7 +43,7 @@ STAGE PLANS:
         Extract
           Filter Operator
             predicate:
-                expr: (0 < 100)
+                expr: (UDFToDouble(0) < UDFToDouble(100))
                 type: boolean
             Select Operator
               expressions:
diff --git a/ql/src/test/results/clientpositive/input1_limit.q.out b/ql/src/test/results/clientpositive/input1_limit.q.out
index d18d5966f3..204e678aa1 100644
--- a/ql/src/test/results/clientpositive/input1_limit.q.out
+++ b/ql/src/test/results/clientpositive/input1_limit.q.out
@@ -14,7 +14,7 @@ STAGE PLANS:
         src 
             Filter Operator
               predicate:
-                  expr: (key < 100)
+                  expr: (UDFToDouble(key) < UDFToDouble(100))
                   type: boolean
               Select Operator
                 expressions:
@@ -33,7 +33,7 @@ STAGE PLANS:
                           type: string
             Filter Operator
               predicate:
-                  expr: (key < 100)
+                  expr: (UDFToDouble(key) < UDFToDouble(100))
                   type: boolean
               Select Operator
                 expressions:
@@ -85,7 +85,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /tmp/hive-zshao/196681773/625336699.10002 
+        /data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/tmp/2110365113/704872924.10002 
           Reduce Output Operator
             sort order: 
             tag: -1
diff --git a/ql/src/test/results/clientpositive/input2_limit.q.out b/ql/src/test/results/clientpositive/input2_limit.q.out
index 194c761b86..9af5cfe441 100644
--- a/ql/src/test/results/clientpositive/input2_limit.q.out
+++ b/ql/src/test/results/clientpositive/input2_limit.q.out
@@ -12,7 +12,7 @@ STAGE PLANS:
         x 
             Filter Operator
               predicate:
-                  expr: (key < 300)
+                  expr: (UDFToDouble(key) < UDFToDouble(300))
                   type: boolean
               Select Operator
                 expressions:
diff --git a/ql/src/test/results/clientpositive/input7.q.out b/ql/src/test/results/clientpositive/input7.q.out
index ef104ae0d6..b1fcfeead4 100644
--- a/ql/src/test/results/clientpositive/input7.q.out
+++ b/ql/src/test/results/clientpositive/input7.q.out
@@ -22,7 +22,7 @@ STAGE PLANS:
                       type: string
                 Select Operator
                   expressions:
-                        expr: UDFToDouble(UDFToBoolean(0))
+                        expr: UDFToDouble(0)
                         type: double
                         expr: UDFToInteger(1)
                         type: int
diff --git a/ql/src/test/results/clientpositive/input8.q.out b/ql/src/test/results/clientpositive/input8.q.out
index ab62341ef4..60c17aa61b 100644
--- a/ql/src/test/results/clientpositive/input8.q.out
+++ b/ql/src/test/results/clientpositive/input8.q.out
@@ -16,19 +16,19 @@ STAGE PLANS:
                     type: string
               Select Operator
                 expressions:
-                      expr: (4 + null)
-                      type: int
+                      expr: (UDFToDouble(4) + null)
+                      type: double
                       expr: (UDFToDouble(0) - null)
                       type: double
                       expr: (null + null)
-                      type: tinyint
+                      type: double
                 Select Operator
                   expressions:
                         expr: UDFToString(0)
                         type: string
                         expr: UDFToInteger(1)
                         type: int
-                        expr: UDFToDouble(2)
+                        expr: 2
                         type: double
                   File Output Operator
                     compressed: false
diff --git a/ql/src/test/results/clientpositive/input9.q.out b/ql/src/test/results/clientpositive/input9.q.out
index df008bd9a8..1f92942ab6 100644
--- a/ql/src/test/results/clientpositive/input9.q.out
+++ b/ql/src/test/results/clientpositive/input9.q.out
@@ -26,7 +26,7 @@ STAGE PLANS:
                         type: string
                   Select Operator
                     expressions:
-                          expr: UDFToString(UDFToBoolean(0))
+                          expr: UDFToString(0)
                           type: string
                           expr: UDFToInteger(1)
                           type: int
diff --git a/ql/src/test/results/clientpositive/input_part1.q.out b/ql/src/test/results/clientpositive/input_part1.q.out
index 4b51030bbe..12bd068928 100644
--- a/ql/src/test/results/clientpositive/input_part1.q.out
+++ b/ql/src/test/results/clientpositive/input_part1.q.out
@@ -12,7 +12,7 @@ STAGE PLANS:
         srcpart 
             Filter Operator
               predicate:
-                  expr: (((key < 100) and (ds = '2008-04-08')) and (hr = '12'))
+                  expr: (((UDFToDouble(key) < UDFToDouble(100)) and (ds = '2008-04-08')) and (hr = '12'))
                   type: boolean
               Select Operator
                 expressions:
@@ -36,7 +36,7 @@ STAGE PLANS:
                         type: string
                   File Output Operator
                     compressed: false
-                    directory: /tmp/hive-zshao/293656751/393363001.10000.insclause-0
+                    directory: /data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/1332023401/49833095.10000.insclause-0
                     table:
                         input format: org.apache.hadoop.mapred.TextInputFormat
                         output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
@@ -49,14 +49,14 @@ STAGE PLANS:
                           serialization.lib org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe
                           file.inputformat org.apache.hadoop.mapred.TextInputFormat
                           file.outputformat org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
-                          location file:/data/users/zshao/sync/apache-trunk-HIVE-104/build/ql/test/data/warehouse/dest1
+                          location file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/dest1
                         serde: org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe
                         name: dest1
       Needs Tagging: false
       Path -> Alias:
-        file:/data/users/zshao/sync/apache-trunk-HIVE-104/build/ql/test/data/warehouse/srcpart/ds=2008-04-08/hr=12 
+        file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/srcpart/ds=2008-04-08/hr=12 
       Path -> Partition:
-        file:/data/users/zshao/sync/apache-trunk-HIVE-104/build/ql/test/data/warehouse/srcpart/ds=2008-04-08/hr=12 
+        file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/srcpart/ds=2008-04-08/hr=12 
           Partition
             partition values:
               ds 2008-04-08
@@ -74,7 +74,7 @@ STAGE PLANS:
                 serialization.lib org.apache.hadoop.hive.serde2.MetadataTypedColumnsetSerDe
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
-                location file:/data/users/zshao/sync/apache-trunk-HIVE-104/build/ql/test/data/warehouse/srcpart
+                location file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/srcpart
               serde: org.apache.hadoop.hive.serde2.MetadataTypedColumnsetSerDe
               name: srcpart
 
@@ -82,7 +82,7 @@ STAGE PLANS:
     Move Operator
       tables:
             replace: true
-            source: /tmp/hive-zshao/293656751/393363001.10000.insclause-0
+            source: /data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/1332023401/49833095.10000.insclause-0
             table:
                 input format: org.apache.hadoop.mapred.TextInputFormat
                 output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
@@ -95,7 +95,7 @@ STAGE PLANS:
                   serialization.lib org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe
                   file.inputformat org.apache.hadoop.mapred.TextInputFormat
                   file.outputformat org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
-                  location file:/data/users/zshao/sync/apache-trunk-HIVE-104/build/ql/test/data/warehouse/dest1
+                  location file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/dest1
                 serde: org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe
                 name: dest1
 
diff --git a/ql/src/test/results/clientpositive/input_part2.q.out b/ql/src/test/results/clientpositive/input_part2.q.out
index c6587ff7e2..e7c977fb54 100644
--- a/ql/src/test/results/clientpositive/input_part2.q.out
+++ b/ql/src/test/results/clientpositive/input_part2.q.out
@@ -12,7 +12,7 @@ STAGE PLANS:
         srcpart 
             Filter Operator
               predicate:
-                  expr: (((key < 100) and (ds = '2008-04-08')) and (hr = '12'))
+                  expr: (((UDFToDouble(key) < UDFToDouble(100)) and (ds = '2008-04-08')) and (hr = '12'))
                   type: boolean
               Select Operator
                 expressions:
@@ -36,7 +36,7 @@ STAGE PLANS:
                         type: string
                   File Output Operator
                     compressed: false
-                    directory: /tmp/hive-zshao/591856793/204210378.10000.insclause-0
+                    directory: /data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/108623150/305040120.10000.insclause-0
                     table:
                         input format: org.apache.hadoop.mapred.TextInputFormat
                         output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
@@ -49,12 +49,12 @@ STAGE PLANS:
                           serialization.lib org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe
                           file.inputformat org.apache.hadoop.mapred.TextInputFormat
                           file.outputformat org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
-                          location file:/data/users/zshao/sync/apache-trunk-HIVE-104/build/ql/test/data/warehouse/dest1
+                          location file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/dest1
                         serde: org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe
                         name: dest1
             Filter Operator
               predicate:
-                  expr: (((key < 100) and (ds = '2008-04-09')) and (hr = '12'))
+                  expr: (((UDFToDouble(key) < UDFToDouble(100)) and (ds = '2008-04-09')) and (hr = '12'))
                   type: boolean
               Select Operator
                 expressions:
@@ -78,7 +78,7 @@ STAGE PLANS:
                         type: string
                   File Output Operator
                     compressed: false
-                    directory: /tmp/hive-zshao/591856793/204210378.10001.insclause-1
+                    directory: /data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/108623150/305040120.10001.insclause-1
                     table:
                         input format: org.apache.hadoop.mapred.TextInputFormat
                         output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
@@ -91,15 +91,15 @@ STAGE PLANS:
                           serialization.lib org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe
                           file.inputformat org.apache.hadoop.mapred.TextInputFormat
                           file.outputformat org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
-                          location file:/data/users/zshao/sync/apache-trunk-HIVE-104/build/ql/test/data/warehouse/dest2
+                          location file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/dest2
                         serde: org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe
                         name: dest2
       Needs Tagging: false
       Path -> Alias:
-        file:/data/users/zshao/sync/apache-trunk-HIVE-104/build/ql/test/data/warehouse/srcpart/ds=2008-04-08/hr=12 
-        file:/data/users/zshao/sync/apache-trunk-HIVE-104/build/ql/test/data/warehouse/srcpart/ds=2008-04-09/hr=12 
+        file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/srcpart/ds=2008-04-08/hr=12 
+        file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/srcpart/ds=2008-04-09/hr=12 
       Path -> Partition:
-        file:/data/users/zshao/sync/apache-trunk-HIVE-104/build/ql/test/data/warehouse/srcpart/ds=2008-04-08/hr=12 
+        file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/srcpart/ds=2008-04-08/hr=12 
           Partition
             partition values:
               ds 2008-04-08
@@ -117,10 +117,10 @@ STAGE PLANS:
                 serialization.lib org.apache.hadoop.hive.serde2.MetadataTypedColumnsetSerDe
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
-                location file:/data/users/zshao/sync/apache-trunk-HIVE-104/build/ql/test/data/warehouse/srcpart
+                location file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/srcpart
               serde: org.apache.hadoop.hive.serde2.MetadataTypedColumnsetSerDe
               name: srcpart
-        file:/data/users/zshao/sync/apache-trunk-HIVE-104/build/ql/test/data/warehouse/srcpart/ds=2008-04-09/hr=12 
+        file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/srcpart/ds=2008-04-09/hr=12 
           Partition
             partition values:
               ds 2008-04-09
@@ -138,7 +138,7 @@ STAGE PLANS:
                 serialization.lib org.apache.hadoop.hive.serde2.MetadataTypedColumnsetSerDe
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
-                location file:/data/users/zshao/sync/apache-trunk-HIVE-104/build/ql/test/data/warehouse/srcpart
+                location file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/srcpart
               serde: org.apache.hadoop.hive.serde2.MetadataTypedColumnsetSerDe
               name: srcpart
 
@@ -146,7 +146,7 @@ STAGE PLANS:
     Move Operator
       tables:
             replace: true
-            source: /tmp/hive-zshao/591856793/204210378.10000.insclause-0
+            source: /data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/108623150/305040120.10000.insclause-0
             table:
                 input format: org.apache.hadoop.mapred.TextInputFormat
                 output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
@@ -159,11 +159,11 @@ STAGE PLANS:
                   serialization.lib org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe
                   file.inputformat org.apache.hadoop.mapred.TextInputFormat
                   file.outputformat org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
-                  location file:/data/users/zshao/sync/apache-trunk-HIVE-104/build/ql/test/data/warehouse/dest1
+                  location file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/dest1
                 serde: org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe
                 name: dest1
             replace: true
-            source: /tmp/hive-zshao/591856793/204210378.10001.insclause-1
+            source: /data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/108623150/305040120.10001.insclause-1
             table:
                 input format: org.apache.hadoop.mapred.TextInputFormat
                 output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
@@ -176,7 +176,7 @@ STAGE PLANS:
                   serialization.lib org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe
                   file.inputformat org.apache.hadoop.mapred.TextInputFormat
                   file.outputformat org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
-                  location file:/data/users/zshao/sync/apache-trunk-HIVE-104/build/ql/test/data/warehouse/dest2
+                  location file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/dest2
                 serde: org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe
                 name: dest2
 
diff --git a/ql/src/test/results/clientpositive/input_part5.q.out b/ql/src/test/results/clientpositive/input_part5.q.out
index e3b0ad3564..0078e7ef79 100644
--- a/ql/src/test/results/clientpositive/input_part5.q.out
+++ b/ql/src/test/results/clientpositive/input_part5.q.out
@@ -12,7 +12,7 @@ STAGE PLANS:
         x 
             Filter Operator
               predicate:
-                  expr: ((ds = '2008-04-08') and (key < 100))
+                  expr: ((ds = '2008-04-08') and (UDFToDouble(key) < UDFToDouble(100)))
                   type: boolean
               Select Operator
                 expressions:
diff --git a/ql/src/test/results/clientpositive/input_part6.q.out b/ql/src/test/results/clientpositive/input_part6.q.out
index 55f4000cfd..11a18e4af8 100644
--- a/ql/src/test/results/clientpositive/input_part6.q.out
+++ b/ql/src/test/results/clientpositive/input_part6.q.out
@@ -12,7 +12,7 @@ STAGE PLANS:
         x 
             Filter Operator
               predicate:
-                  expr: (ds = ((2008 - 4) - 8))
+                  expr: (UDFToDouble(ds) = UDFToDouble(((2008 - 4) - 8)))
                   type: boolean
               Select Operator
                 expressions:
diff --git a/ql/src/test/results/clientpositive/join0.q.out b/ql/src/test/results/clientpositive/join0.q.out
index 83134cfefc..798b8f98b2 100644
--- a/ql/src/test/results/clientpositive/join0.q.out
+++ b/ql/src/test/results/clientpositive/join0.q.out
@@ -13,7 +13,7 @@ STAGE PLANS:
         src2:src 
             Filter Operator
               predicate:
-                  expr: (key < 10)
+                  expr: (UDFToDouble(key) < UDFToDouble(10))
                   type: boolean
               Select Operator
                 expressions:
@@ -32,7 +32,7 @@ STAGE PLANS:
         src1:src 
             Filter Operator
               predicate:
-                  expr: (key < 10)
+                  expr: (UDFToDouble(key) < UDFToDouble(10))
                   type: boolean
               Select Operator
                 expressions:
@@ -75,7 +75,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /data/users/pchakka/workspace/oshive/build/ql/tmp/1608930740/15144587.10002 
+        /data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/tmp/143976251/534107059.10002 
           Reduce Output Operator
             key expressions:
                   expr: 0
diff --git a/ql/src/test/results/clientpositive/join11.q.out b/ql/src/test/results/clientpositive/join11.q.out
index c573655ac3..b8255b4ffe 100644
--- a/ql/src/test/results/clientpositive/join11.q.out
+++ b/ql/src/test/results/clientpositive/join11.q.out
@@ -39,7 +39,7 @@ STAGE PLANS:
                     type: string
               Filter Operator
                 predicate:
-                    expr: (0 < 100)
+                    expr: (UDFToDouble(0) < UDFToDouble(100))
                     type: boolean
                 Reduce Output Operator
                   key expressions:
diff --git a/ql/src/test/results/clientpositive/join12.q.out b/ql/src/test/results/clientpositive/join12.q.out
index d52c710f04..38a0a05e5a 100644
--- a/ql/src/test/results/clientpositive/join12.q.out
+++ b/ql/src/test/results/clientpositive/join12.q.out
@@ -39,7 +39,7 @@ STAGE PLANS:
                     type: string
               Filter Operator
                 predicate:
-                    expr: (0 < 100)
+                    expr: (UDFToDouble(0) < UDFToDouble(100))
                     type: boolean
                 Reduce Output Operator
                   key expressions:
@@ -64,7 +64,7 @@ STAGE PLANS:
                     type: string
               Filter Operator
                 predicate:
-                    expr: (0 < 80)
+                    expr: (UDFToDouble(0) < UDFToDouble(80))
                     type: boolean
                 Reduce Output Operator
                   key expressions:
diff --git a/ql/src/test/results/clientpositive/join13.q.out b/ql/src/test/results/clientpositive/join13.q.out
index 8dc24a6ba1..14f68c2ae2 100644
--- a/ql/src/test/results/clientpositive/join13.q.out
+++ b/ql/src/test/results/clientpositive/join13.q.out
@@ -40,7 +40,7 @@ STAGE PLANS:
                     type: string
               Filter Operator
                 predicate:
-                    expr: (0 < 100)
+                    expr: (UDFToDouble(0) < UDFToDouble(100))
                     type: boolean
                 Reduce Output Operator
                   key expressions:
@@ -101,7 +101,7 @@ STAGE PLANS:
                     type: string
               Filter Operator
                 predicate:
-                    expr: (0 < 200)
+                    expr: (UDFToDouble(0) < UDFToDouble(200))
                     type: boolean
                 Reduce Output Operator
                   key expressions:
diff --git a/ql/src/test/results/clientpositive/join14.q.out b/ql/src/test/results/clientpositive/join14.q.out
index c369c075f5..d1ab0508eb 100644
--- a/ql/src/test/results/clientpositive/join14.q.out
+++ b/ql/src/test/results/clientpositive/join14.q.out
@@ -45,7 +45,7 @@ STAGE PLANS:
                     type: string
               Filter Operator
                 predicate:
-                    expr: (0 > 100)
+                    expr: (UDFToDouble(0) > UDFToDouble(100))
                     type: boolean
                 Reduce Output Operator
                   key expressions:
diff --git a/ql/src/test/results/clientpositive/join16.q.out b/ql/src/test/results/clientpositive/join16.q.out
index 29ff0585cd..7dc983d03d 100644
--- a/ql/src/test/results/clientpositive/join16.q.out
+++ b/ql/src/test/results/clientpositive/join16.q.out
@@ -12,7 +12,7 @@ STAGE PLANS:
         subq:a 
             Filter Operator
               predicate:
-                  expr: (key > 10)
+                  expr: (UDFToDouble(key) > UDFToDouble(10))
                   type: boolean
               Select Operator
                 expressions:
@@ -22,7 +22,7 @@ STAGE PLANS:
                       type: string
                 Filter Operator
                   predicate:
-                      expr: (0 > 20)
+                      expr: (UDFToDouble(0) > UDFToDouble(20))
                       type: boolean
                   Reduce Output Operator
                     key expressions:
@@ -70,7 +70,7 @@ STAGE PLANS:
             1 {VALUE.0} {VALUE.1}
           Filter Operator
             predicate:
-                expr: (3 < 200)
+                expr: (UDFToDouble(3) < UDFToDouble(200))
                 type: boolean
             Select Operator
               expressions:
diff --git a/ql/src/test/results/clientpositive/join4.q.out b/ql/src/test/results/clientpositive/join4.q.out
index b2c35a8ae5..b394c3ad7b 100644
--- a/ql/src/test/results/clientpositive/join4.q.out
+++ b/ql/src/test/results/clientpositive/join4.q.out
@@ -12,7 +12,7 @@ STAGE PLANS:
         c:b:src2 
             Filter Operator
               predicate:
-                  expr: ((key > 15) and (key < 25))
+                  expr: ((UDFToDouble(key) > UDFToDouble(15)) and (UDFToDouble(key) < UDFToDouble(25)))
                   type: boolean
               Select Operator
                 expressions:
@@ -37,7 +37,7 @@ STAGE PLANS:
         c:a:src1 
             Filter Operator
               predicate:
-                  expr: ((key > 10) and (key < 20))
+                  expr: ((UDFToDouble(key) > UDFToDouble(10)) and (UDFToDouble(key) < UDFToDouble(20)))
                   type: boolean
               Select Operator
                 expressions:
diff --git a/ql/src/test/results/clientpositive/join5.q.out b/ql/src/test/results/clientpositive/join5.q.out
index 47ebc07055..d446a9de8b 100644
--- a/ql/src/test/results/clientpositive/join5.q.out
+++ b/ql/src/test/results/clientpositive/join5.q.out
@@ -12,7 +12,7 @@ STAGE PLANS:
         c:b:src2 
             Filter Operator
               predicate:
-                  expr: ((key > 15) and (key < 25))
+                  expr: ((UDFToDouble(key) > UDFToDouble(15)) and (UDFToDouble(key) < UDFToDouble(25)))
                   type: boolean
               Select Operator
                 expressions:
@@ -37,7 +37,7 @@ STAGE PLANS:
         c:a:src1 
             Filter Operator
               predicate:
-                  expr: ((key > 10) and (key < 20))
+                  expr: ((UDFToDouble(key) > UDFToDouble(10)) and (UDFToDouble(key) < UDFToDouble(20)))
                   type: boolean
               Select Operator
                 expressions:
diff --git a/ql/src/test/results/clientpositive/join6.q.out b/ql/src/test/results/clientpositive/join6.q.out
index f353424264..61db3bb154 100644
--- a/ql/src/test/results/clientpositive/join6.q.out
+++ b/ql/src/test/results/clientpositive/join6.q.out
@@ -12,7 +12,7 @@ STAGE PLANS:
         c:b:src2 
             Filter Operator
               predicate:
-                  expr: ((key > 15) and (key < 25))
+                  expr: ((UDFToDouble(key) > UDFToDouble(15)) and (UDFToDouble(key) < UDFToDouble(25)))
                   type: boolean
               Select Operator
                 expressions:
@@ -37,7 +37,7 @@ STAGE PLANS:
         c:a:src1 
             Filter Operator
               predicate:
-                  expr: ((key > 10) and (key < 20))
+                  expr: ((UDFToDouble(key) > UDFToDouble(10)) and (UDFToDouble(key) < UDFToDouble(20)))
                   type: boolean
               Select Operator
                 expressions:
diff --git a/ql/src/test/results/clientpositive/join7.q.out b/ql/src/test/results/clientpositive/join7.q.out
index a01831f827..49ac2f2aac 100644
--- a/ql/src/test/results/clientpositive/join7.q.out
+++ b/ql/src/test/results/clientpositive/join7.q.out
@@ -12,7 +12,7 @@ STAGE PLANS:
         c:b:src2 
             Filter Operator
               predicate:
-                  expr: ((key > 15) and (key < 25))
+                  expr: ((UDFToDouble(key) > UDFToDouble(15)) and (UDFToDouble(key) < UDFToDouble(25)))
                   type: boolean
               Select Operator
                 expressions:
@@ -37,7 +37,7 @@ STAGE PLANS:
         c:a:src1 
             Filter Operator
               predicate:
-                  expr: ((key > 10) and (key < 20))
+                  expr: ((UDFToDouble(key) > UDFToDouble(10)) and (UDFToDouble(key) < UDFToDouble(20)))
                   type: boolean
               Select Operator
                 expressions:
@@ -62,7 +62,7 @@ STAGE PLANS:
         c:c:src3 
             Filter Operator
               predicate:
-                  expr: ((key > 20) and (key < 25))
+                  expr: ((UDFToDouble(key) > UDFToDouble(20)) and (UDFToDouble(key) < UDFToDouble(25)))
                   type: boolean
               Select Operator
                 expressions:
diff --git a/ql/src/test/results/clientpositive/join8.q.out b/ql/src/test/results/clientpositive/join8.q.out
index 2c41eebcd9..9af2249753 100644
--- a/ql/src/test/results/clientpositive/join8.q.out
+++ b/ql/src/test/results/clientpositive/join8.q.out
@@ -12,7 +12,7 @@ STAGE PLANS:
         c:b:src2 
             Filter Operator
               predicate:
-                  expr: ((key > 15) and (key < 25))
+                  expr: ((UDFToDouble(key) > UDFToDouble(15)) and (UDFToDouble(key) < UDFToDouble(25)))
                   type: boolean
               Select Operator
                 expressions:
@@ -37,7 +37,7 @@ STAGE PLANS:
         c:a:src1 
             Filter Operator
               predicate:
-                  expr: ((key > 10) and (key < 20))
+                  expr: ((UDFToDouble(key) > UDFToDouble(10)) and (UDFToDouble(key) < UDFToDouble(20)))
                   type: boolean
               Select Operator
                 expressions:
diff --git a/ql/src/test/results/clientpositive/noalias_subq1.q.out b/ql/src/test/results/clientpositive/noalias_subq1.q.out
index 3069244c87..10d5e515c9 100644
--- a/ql/src/test/results/clientpositive/noalias_subq1.q.out
+++ b/ql/src/test/results/clientpositive/noalias_subq1.q.out
@@ -18,7 +18,7 @@ STAGE PLANS:
                     type: string
               Filter Operator
                 predicate:
-                    expr: (1 < 100)
+                    expr: (UDFToDouble(1) < UDFToDouble(100))
                     type: boolean
                 Select Operator
                   expressions:
diff --git a/ql/src/test/results/clientpositive/notable_alias1.q.out b/ql/src/test/results/clientpositive/notable_alias1.q.out
index c184d06638..1178703bff 100644
--- a/ql/src/test/results/clientpositive/notable_alias1.q.out
+++ b/ql/src/test/results/clientpositive/notable_alias1.q.out
@@ -17,7 +17,7 @@ STAGE PLANS:
                     type: string
               Filter Operator
                 predicate:
-                    expr: (0 < 100)
+                    expr: (UDFToDouble(0) < UDFToDouble(100))
                     type: boolean
                 Reduce Output Operator
                   key expressions:
@@ -49,7 +49,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /tmp/hive-zshao/10020404/161743246.10001 
+        /data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/tmp/562761632/249466954.10001 
           Reduce Output Operator
             key expressions:
                   expr: 0
diff --git a/ql/src/test/results/clientpositive/notable_alias2.q.out b/ql/src/test/results/clientpositive/notable_alias2.q.out
index c30acb922f..600825a5fb 100644
--- a/ql/src/test/results/clientpositive/notable_alias2.q.out
+++ b/ql/src/test/results/clientpositive/notable_alias2.q.out
@@ -17,7 +17,7 @@ STAGE PLANS:
                     type: string
               Filter Operator
                 predicate:
-                    expr: (0 < 100)
+                    expr: (UDFToDouble(0) < UDFToDouble(100))
                     type: boolean
                 Reduce Output Operator
                   key expressions:
@@ -49,7 +49,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /tmp/hive-zshao/55994326/602553370.10001 
+        /data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/tmp/903914190/338096343.10001 
           Reduce Output Operator
             key expressions:
                   expr: 0
diff --git a/ql/src/test/results/clientpositive/quote1.q.out b/ql/src/test/results/clientpositive/quote1.q.out
index 3728a61e11..750d3ba973 100644
--- a/ql/src/test/results/clientpositive/quote1.q.out
+++ b/ql/src/test/results/clientpositive/quote1.q.out
@@ -12,7 +12,7 @@ STAGE PLANS:
         src 
             Filter Operator
               predicate:
-                  expr: ((key >= 200) and (key < 300))
+                  expr: ((UDFToDouble(key) >= UDFToDouble(200)) and (UDFToDouble(key) < UDFToDouble(300)))
                   type: boolean
               Select Operator
                 expressions:
diff --git a/ql/src/test/results/clientpositive/sample7.q.out b/ql/src/test/results/clientpositive/sample7.q.out
index 2355f2c72c..50a051b45a 100644
--- a/ql/src/test/results/clientpositive/sample7.q.out
+++ b/ql/src/test/results/clientpositive/sample7.q.out
@@ -16,7 +16,7 @@ STAGE PLANS:
                   type: boolean
               Filter Operator
                 predicate:
-                    expr: (key > 100)
+                    expr: (UDFToDouble(key) > UDFToDouble(100))
                     type: boolean
                 Select Operator
                   expressions:
@@ -32,7 +32,7 @@ STAGE PLANS:
                           type: string
                     File Output Operator
                       compressed: false
-                      directory: /tmp/hive-zshao/444520495/211065154.10000.insclause-0
+                      directory: /data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/390012861/922014023.10000.insclause-0
                       table:
                           input format: org.apache.hadoop.mapred.TextInputFormat
                           output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
@@ -45,14 +45,14 @@ STAGE PLANS:
                             serialization.lib org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe
                             file.inputformat org.apache.hadoop.mapred.TextInputFormat
                             file.outputformat org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
-                            location file:/data/users/zshao/sync/apache-trunk-HIVE-104/build/ql/test/data/warehouse/dest1
+                            location file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/dest1
                           serde: org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe
                           name: dest1
       Needs Tagging: false
       Path -> Alias:
-        file:/data/users/zshao/sync/apache-trunk-HIVE-104/build/ql/test/data/warehouse/srcbucket/kv1.txt 
+        file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/srcbucket/kv1.txt 
       Path -> Partition:
-        file:/data/users/zshao/sync/apache-trunk-HIVE-104/build/ql/test/data/warehouse/srcbucket/kv1.txt 
+        file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/srcbucket/kv1.txt 
           Partition
           
               input format: org.apache.hadoop.mapred.TextInputFormat
@@ -67,7 +67,7 @@ STAGE PLANS:
                 serialization.lib org.apache.hadoop.hive.serde2.MetadataTypedColumnsetSerDe
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
-                location file:/data/users/zshao/sync/apache-trunk-HIVE-104/build/ql/test/data/warehouse/srcbucket
+                location file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/srcbucket
               serde: org.apache.hadoop.hive.serde2.MetadataTypedColumnsetSerDe
               name: srcbucket
 
@@ -75,7 +75,7 @@ STAGE PLANS:
     Move Operator
       tables:
             replace: true
-            source: /tmp/hive-zshao/444520495/211065154.10000.insclause-0
+            source: /data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/390012861/922014023.10000.insclause-0
             table:
                 input format: org.apache.hadoop.mapred.TextInputFormat
                 output format: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
@@ -88,7 +88,7 @@ STAGE PLANS:
                   serialization.lib org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe
                   file.inputformat org.apache.hadoop.mapred.TextInputFormat
                   file.outputformat org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat
-                  location file:/data/users/zshao/sync/apache-trunk-HIVE-104/build/ql/test/data/warehouse/dest1
+                  location file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/dest1
                 serde: org.apache.hadoop.hive.serde2.dynamic_type.DynamicSerDe
                 name: dest1
 
diff --git a/ql/src/test/results/clientpositive/subq.q.out b/ql/src/test/results/clientpositive/subq.q.out
index adeb0cf1f7..8105f10763 100644
--- a/ql/src/test/results/clientpositive/subq.q.out
+++ b/ql/src/test/results/clientpositive/subq.q.out
@@ -12,7 +12,7 @@ STAGE PLANS:
         unioninput:src 
             Filter Operator
               predicate:
-                  expr: (key < 100)
+                  expr: (UDFToDouble(key) < UDFToDouble(100))
                   type: boolean
               Select Operator
                 expressions:
diff --git a/ql/src/test/results/clientpositive/subq2.q.out b/ql/src/test/results/clientpositive/subq2.q.out
index 48f0ad9252..21f169a0cd 100644
--- a/ql/src/test/results/clientpositive/subq2.q.out
+++ b/ql/src/test/results/clientpositive/subq2.q.out
@@ -45,7 +45,7 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /tmp/hive-zshao/368989435/823759952.10002 
+        /data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/tmp/217677179/137363579.10002 
           Reduce Output Operator
             key expressions:
                   expr: 0
@@ -74,7 +74,7 @@ STAGE PLANS:
                   type: bigint
             Filter Operator
               predicate:
-                  expr: (0 >= 90)
+                  expr: (UDFToDouble(0) >= UDFToDouble(90))
                   type: boolean
               Select Operator
                 expressions:
diff --git a/ql/src/test/results/clientpositive/udf1.q.out b/ql/src/test/results/clientpositive/udf1.q.out
index 616d337d44..e98b0a01af 100644
--- a/ql/src/test/results/clientpositive/udf1.q.out
+++ b/ql/src/test/results/clientpositive/udf1.q.out
@@ -16,7 +16,7 @@ STAGE PLANS:
                     type: string
               Filter Operator
                 predicate:
-                    expr: (0 = 86)
+                    expr: (UDFToDouble(0) = UDFToDouble(86))
                     type: boolean
                 Select Operator
                   expressions:
diff --git a/ql/src/test/results/clientpositive/udf3.q.out b/ql/src/test/results/clientpositive/udf3.q.out
index 9252d8f5ab..a56065e8cb 100644
--- a/ql/src/test/results/clientpositive/udf3.q.out
+++ b/ql/src/test/results/clientpositive/udf3.q.out
@@ -24,11 +24,11 @@ STAGE PLANS:
       Reduce Operator Tree:
         Group By Operator
           aggregations:
-                expr: max(UDFToDouble(VALUE.0))
+                expr: max(VALUE.0)
                 expr: avg(UDFToDouble(VALUE.0))
                 expr: count(VALUE.0)
                 expr: sum(UDFToDouble(VALUE.0))
-                expr: min(UDFToDouble(VALUE.0))
+                expr: min(VALUE.0)
           mode: partial1
           File Output Operator
             compressed: false
@@ -40,13 +40,13 @@ STAGE PLANS:
   Stage: Stage-2
     Map Reduce
       Alias -> Map Operator Tree:
-        /tmp/hive-zshao/546652046/1647731334.10001 
+        /data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/tmp/68854306/763012378.10001 
           Reduce Output Operator
             sort order: 
             tag: -1
             value expressions:
                   expr: 0
-                  type: double
+                  type: int
                   expr: 1
                   type: string
                   expr: 2
@@ -54,12 +54,12 @@ STAGE PLANS:
                   expr: 3
                   type: double
                   expr: 4
-                  type: double
+                  type: int
       Reduce Operator Tree:
         Group By Operator
           aggregations:
                 expr: max(VALUE.0)
-                expr: avg(VALUE.1)
+                expr: avg(UDFToDouble(VALUE.1))
                 expr: count(VALUE.2)
                 expr: sum(VALUE.3)
                 expr: min(VALUE.4)
@@ -73,9 +73,9 @@ STAGE PLANS:
                   expr: 1
                   type: double
                   expr: 4
-                  type: double
+                  type: int
                   expr: 0
-                  type: double
+                  type: int
             File Output Operator
               compressed: false
               table:
diff --git a/ql/src/test/results/clientpositive/union.q.out b/ql/src/test/results/clientpositive/union.q.out
index d7317e45c8..2cd29405fd 100644
--- a/ql/src/test/results/clientpositive/union.q.out
+++ b/ql/src/test/results/clientpositive/union.q.out
@@ -12,7 +12,7 @@ STAGE PLANS:
         null-subquery1:unioninput-subquery1:src 
             Filter Operator
               predicate:
-                  expr: (key < 100)
+                  expr: (UDFToDouble(key) < UDFToDouble(100))
                   type: boolean
               Select Operator
                 expressions:
@@ -34,7 +34,7 @@ STAGE PLANS:
         null-subquery2:unioninput-subquery2:src 
             Filter Operator
               predicate:
-                  expr: (key > 100)
+                  expr: (UDFToDouble(key) > UDFToDouble(100))
                   type: boolean
               Select Operator
                 expressions:
diff --git a/ql/src/test/results/compiler/plan/cast1.q.xml b/ql/src/test/results/compiler/plan/cast1.q.xml
index d80dd5700f..167d280802 100644
--- a/ql/src/test/results/compiler/plan/cast1.q.xml
+++ b/ql/src/test/results/compiler/plan/cast1.q.xml
@@ -30,7 +30,7 @@
                         <void property="conf"> 
                          <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                           <void property="dirName"> 
-                           <string>/tmp/hive-njain/802827123.10001.insclause-0</string> 
+                           <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/1339188432.10001.insclause-0</string> 
                           </void> 
                           <void property="tableInfo"> 
                            <object class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -569,14 +569,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPEqual</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPEqual" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -584,26 +584,74 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>0</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
                         </void> 
-                        <void property="typeInfo"> 
-                         <object id="PrimitiveTypeInfo3" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
-                          <void property="primitiveClass"> 
-                           <class>java.lang.String</class> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>0</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object id="PrimitiveTypeInfo3" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                              <void property="primitiveClass"> 
+                               <class>java.lang.String</class> 
+                              </void> 
+                             </object> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
+                        <void property="typeInfo"> 
+                         <object idref="PrimitiveTypeInfo1"/> 
+                        </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
-                        <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>86</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
-                        <void property="value"> 
-                         <int>86</int> 
+                        <void property="typeInfo"> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
@@ -716,7 +764,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>src</string> 
@@ -728,7 +776,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -780,7 +828,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
diff --git a/ql/src/test/results/compiler/plan/groupby3.q.xml b/ql/src/test/results/compiler/plan/groupby3.q.xml
index 4ec6eea476..433779b85b 100644
--- a/ql/src/test/results/compiler/plan/groupby3.q.xml
+++ b/ql/src/test/results/compiler/plan/groupby3.q.xml
@@ -20,7 +20,7 @@
         <void property="aliasToWork"> 
          <object class="java.util.HashMap"> 
           <void method="put"> 
-           <string>/tmp/hive-zshao/1268121/343796403.10002</string> 
+           <string>/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/tmp/39762029/165173809.10002</string> 
            <object id="ReduceSinkOperator0" class="org.apache.hadoop.hive.ql.exec.ReduceSinkOperator"> 
             <void property="conf"> 
              <object class="org.apache.hadoop.hive.ql.plan.reduceSinkDesc"> 
@@ -118,7 +118,7 @@
                    <string>3</string> 
                   </void> 
                   <void property="typeInfo"> 
-                   <object idref="PrimitiveTypeInfo1"/> 
+                   <object idref="PrimitiveTypeInfo0"/> 
                   </void> 
                  </object> 
                 </void> 
@@ -128,7 +128,7 @@
                    <string>4</string> 
                   </void> 
                   <void property="typeInfo"> 
-                   <object idref="PrimitiveTypeInfo1"/> 
+                   <object idref="PrimitiveTypeInfo0"/> 
                   </void> 
                  </object> 
                 </void> 
@@ -153,7 +153,7 @@
                   </void> 
                   <void method="put"> 
                    <string>serialization.ddl</string> 
-                   <string>struct binary_table { string reducesinkvalue0, double reducesinkvalue1, string reducesinkvalue2, double reducesinkvalue3, double reducesinkvalue4}</string> 
+                   <string>struct binary_table { string reducesinkvalue0, double reducesinkvalue1, string reducesinkvalue2, string reducesinkvalue3, string reducesinkvalue4}</string> 
                   </void> 
                   <void method="put"> 
                    <string>serialization.format</string> 
@@ -176,7 +176,7 @@
                     <void property="conf"> 
                      <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                       <void property="dirName"> 
-                       <string>/tmp/hive-zshao/1268121/343796403.10002</string> 
+                       <string>/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/tmp/39762029/165173809.10002</string> 
                       </void> 
                       <void property="tableInfo"> 
                        <object id="tableDesc2" class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -197,7 +197,7 @@
                           </void> 
                           <void method="put"> 
                            <string>serialization.ddl</string> 
-                           <string>struct binary_table { string temporarycol0, double temporarycol1, string temporarycol2, double temporarycol3, double temporarycol4}</string> 
+                           <string>struct binary_table { string temporarycol0, double temporarycol1, string temporarycol2, string temporarycol3, string temporarycol4}</string> 
                           </void> 
                           <void method="put"> 
                            <string>serialization.format</string> 
@@ -256,7 +256,7 @@
                            <string>3</string> 
                           </void> 
                           <void property="type"> 
-                           <object idref="PrimitiveTypeInfo1"/> 
+                           <object idref="PrimitiveTypeInfo0"/> 
                           </void> 
                          </object> 
                         </void> 
@@ -266,7 +266,7 @@
                            <string>4</string> 
                           </void> 
                           <void property="type"> 
-                           <object idref="PrimitiveTypeInfo1"/> 
+                           <object idref="PrimitiveTypeInfo0"/> 
                           </void> 
                          </object> 
                         </void> 
@@ -423,41 +423,17 @@
                     <void method="add"> 
                      <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
                       <void property="aggregationClass"> 
-                       <class>org.apache.hadoop.hive.ql.udf.UDAFMin</class> 
+                       <class>org.apache.hadoop.hive.ql.udf.UDAFMin$MinStringEvaluator</class> 
                       </void> 
                       <void property="parameters"> 
                        <object class="java.util.ArrayList"> 
                         <void method="add"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
-                          <void property="UDFClass"> 
-                           <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
-                          </void> 
-                          <void property="UDFMethod"> 
-                           <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
-                            <string>evaluate</string> 
-                            <array class="java.lang.Class" length="1"> 
-                             <void index="0"> 
-                              <class>java.lang.String</class> 
-                             </void> 
-                            </array> 
-                           </object> 
-                          </void> 
-                          <void property="children"> 
-                           <object class="java.util.ArrayList"> 
-                            <void method="add"> 
-                             <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                              <void property="column"> 
-                               <string>KEY.0</string> 
-                              </void> 
-                              <void property="typeInfo"> 
-                               <object idref="PrimitiveTypeInfo0"/> 
-                              </void> 
-                             </object> 
-                            </void> 
-                           </object> 
+                         <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                          <void property="column"> 
+                           <string>KEY.0</string> 
                           </void> 
                           <void property="typeInfo"> 
-                           <object idref="PrimitiveTypeInfo1"/> 
+                           <object idref="PrimitiveTypeInfo0"/> 
                           </void> 
                          </object> 
                         </void> 
@@ -468,41 +444,17 @@
                     <void method="add"> 
                      <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
                       <void property="aggregationClass"> 
-                       <class>org.apache.hadoop.hive.ql.udf.UDAFMax</class> 
+                       <class>org.apache.hadoop.hive.ql.udf.UDAFMax$MaxStringEvaluator</class> 
                       </void> 
                       <void property="parameters"> 
                        <object class="java.util.ArrayList"> 
                         <void method="add"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
-                          <void property="UDFClass"> 
-                           <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
-                          </void> 
-                          <void property="UDFMethod"> 
-                           <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
-                            <string>evaluate</string> 
-                            <array class="java.lang.Class" length="1"> 
-                             <void index="0"> 
-                              <class>java.lang.String</class> 
-                             </void> 
-                            </array> 
-                           </object> 
-                          </void> 
-                          <void property="children"> 
-                           <object class="java.util.ArrayList"> 
-                            <void method="add"> 
-                             <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                              <void property="column"> 
-                               <string>KEY.0</string> 
-                              </void> 
-                              <void property="typeInfo"> 
-                               <object idref="PrimitiveTypeInfo0"/> 
-                              </void> 
-                             </object> 
-                            </void> 
-                           </object> 
+                         <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                          <void property="column"> 
+                           <string>KEY.0</string> 
                           </void> 
                           <void property="typeInfo"> 
-                           <object idref="PrimitiveTypeInfo1"/> 
+                           <object idref="PrimitiveTypeInfo0"/> 
                           </void> 
                          </object> 
                         </void> 
@@ -822,7 +774,7 @@
                    <string>VALUE.3</string> 
                   </void> 
                   <void property="type"> 
-                   <object idref="PrimitiveTypeInfo1"/> 
+                   <object idref="PrimitiveTypeInfo0"/> 
                   </void> 
                  </object> 
                 </void> 
@@ -832,7 +784,7 @@
                    <string>VALUE.4</string> 
                   </void> 
                   <void property="type"> 
-                   <object idref="PrimitiveTypeInfo1"/> 
+                   <object idref="PrimitiveTypeInfo0"/> 
                   </void> 
                  </object> 
                 </void> 
@@ -853,10 +805,10 @@
         <void property="pathToAliases"> 
          <object class="java.util.LinkedHashMap"> 
           <void method="put"> 
-           <string>/tmp/hive-zshao/1268121/343796403.10002</string> 
+           <string>/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/tmp/39762029/165173809.10002</string> 
            <object class="java.util.ArrayList"> 
             <void method="add"> 
-             <string>/tmp/hive-zshao/1268121/343796403.10002</string> 
+             <string>/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/tmp/39762029/165173809.10002</string> 
             </void> 
            </object> 
           </void> 
@@ -865,7 +817,7 @@
         <void property="pathToPartitionInfo"> 
          <object class="java.util.LinkedHashMap"> 
           <void method="put"> 
-           <string>/tmp/hive-zshao/1268121/343796403.10002</string> 
+           <string>/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/tmp/39762029/165173809.10002</string> 
            <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
             <void property="tableDesc"> 
              <object idref="tableDesc2"/> 
@@ -887,7 +839,7 @@
                   <void property="conf"> 
                    <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                     <void property="dirName"> 
-                     <string>/tmp/hive-zshao/147248168.10001.insclause-0</string> 
+                     <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/579206814.10001.insclause-0</string> 
                     </void> 
                     <void property="tableInfo"> 
                      <object class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -963,7 +915,7 @@
                          <string>3</string> 
                         </void> 
                         <void property="type"> 
-                         <object idref="PrimitiveTypeInfo1"/> 
+                         <object idref="PrimitiveTypeInfo0"/> 
                         </void> 
                        </object> 
                       </void> 
@@ -973,7 +925,7 @@
                          <string>4</string> 
                         </void> 
                         <void property="type"> 
-                         <object idref="PrimitiveTypeInfo1"/> 
+                         <object idref="PrimitiveTypeInfo0"/> 
                         </void> 
                        </object> 
                       </void> 
@@ -1025,7 +977,7 @@
                      <string>4</string> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo1"/> 
+                     <object idref="PrimitiveTypeInfo0"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -1035,7 +987,7 @@
                      <string>3</string> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo1"/> 
+                     <object idref="PrimitiveTypeInfo0"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -1073,12 +1025,36 @@
                 <void property="parameters"> 
                  <object class="java.util.ArrayList"> 
                   <void method="add"> 
-                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                    <void property="column"> 
-                     <string>VALUE.0</string> 
+                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                    <void property="UDFClass"> 
+                     <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                    </void> 
+                    <void property="UDFMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                      <string>evaluate</string> 
+                      <array class="java.lang.Class" length="1"> 
+                       <void index="0"> 
+                        <class>java.lang.String</class> 
+                       </void> 
+                      </array> 
+                     </object> 
+                    </void> 
+                    <void property="children"> 
+                     <object class="java.util.ArrayList"> 
+                      <void method="add"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                        <void property="column"> 
+                         <string>VALUE.0</string> 
+                        </void> 
+                        <void property="typeInfo"> 
+                         <object idref="PrimitiveTypeInfo0"/> 
+                        </void> 
+                       </object> 
+                      </void> 
+                     </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo0"/> 
+                     <object idref="PrimitiveTypeInfo1"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -1115,12 +1091,36 @@
                 <void property="parameters"> 
                  <object class="java.util.ArrayList"> 
                   <void method="add"> 
-                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                    <void property="column"> 
-                     <string>VALUE.2</string> 
+                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                    <void property="UDFClass"> 
+                     <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                    </void> 
+                    <void property="UDFMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                      <string>evaluate</string> 
+                      <array class="java.lang.Class" length="1"> 
+                       <void index="0"> 
+                        <class>java.lang.String</class> 
+                       </void> 
+                      </array> 
+                     </object> 
+                    </void> 
+                    <void property="children"> 
+                     <object class="java.util.ArrayList"> 
+                      <void method="add"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                        <void property="column"> 
+                         <string>VALUE.2</string> 
+                        </void> 
+                        <void property="typeInfo"> 
+                         <object idref="PrimitiveTypeInfo0"/> 
+                        </void> 
+                       </object> 
+                      </void> 
+                     </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo0"/> 
+                     <object idref="PrimitiveTypeInfo1"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -1131,7 +1131,7 @@
               <void method="add"> 
                <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
                 <void property="aggregationClass"> 
-                 <class>org.apache.hadoop.hive.ql.udf.UDAFMin</class> 
+                 <class>org.apache.hadoop.hive.ql.udf.UDAFMin$MinStringEvaluator</class> 
                 </void> 
                 <void property="parameters"> 
                  <object class="java.util.ArrayList"> 
@@ -1141,7 +1141,7 @@
                      <string>VALUE.3</string> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo1"/> 
+                     <object idref="PrimitiveTypeInfo0"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -1152,7 +1152,7 @@
               <void method="add"> 
                <object class="org.apache.hadoop.hive.ql.plan.aggregationDesc"> 
                 <void property="aggregationClass"> 
-                 <class>org.apache.hadoop.hive.ql.udf.UDAFMax</class> 
+                 <class>org.apache.hadoop.hive.ql.udf.UDAFMax$MaxStringEvaluator</class> 
                 </void> 
                 <void property="parameters"> 
                  <object class="java.util.ArrayList"> 
@@ -1162,7 +1162,7 @@
                      <string>VALUE.4</string> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo1"/> 
+                     <object idref="PrimitiveTypeInfo0"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -1229,7 +1229,7 @@
                  <string>3</string> 
                 </void> 
                 <void property="type"> 
-                 <object idref="PrimitiveTypeInfo1"/> 
+                 <object idref="PrimitiveTypeInfo0"/> 
                 </void> 
                </object> 
               </void> 
@@ -1239,7 +1239,7 @@
                  <string>4</string> 
                 </void> 
                 <void property="type"> 
-                 <object idref="PrimitiveTypeInfo1"/> 
+                 <object idref="PrimitiveTypeInfo0"/> 
                 </void> 
                </object> 
               </void> 
@@ -1281,7 +1281,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/zshao/sync/apache-trunk-HIVE-104/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>src</string> 
@@ -1293,7 +1293,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/zshao/sync/apache-trunk-HIVE-104/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -1345,7 +1345,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/data/users/zshao/sync/apache-trunk-HIVE-104/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
diff --git a/ql/src/test/results/compiler/plan/input1.q.xml b/ql/src/test/results/compiler/plan/input1.q.xml
index 5778b255dc..61c4e91903 100755
--- a/ql/src/test/results/compiler/plan/input1.q.xml
+++ b/ql/src/test/results/compiler/plan/input1.q.xml
@@ -31,7 +31,7 @@
              <boolean>true</boolean> 
             </void> 
             <void property="sourceDir"> 
-             <string>/tmp/hive-njain/202548334/480112542.10000.insclause-0</string> 
+             <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/265277901/92421267.10000.insclause-0</string> 
             </void> 
             <void property="table"> 
              <object id="tableDesc0" class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -80,7 +80,7 @@
                 </void> 
                 <void method="put"> 
                  <string>location</string> 
-                 <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/dest1</string> 
+                 <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/dest1</string> 
                 </void> 
                </object> 
               </void> 
@@ -124,7 +124,7 @@
                     <void property="conf"> 
                      <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                       <void property="dirName"> 
-                       <string>/tmp/hive-njain/202548334/480112542.10000.insclause-0</string> 
+                       <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/265277901/92421267.10000.insclause-0</string> 
                       </void> 
                       <void property="tableInfo"> 
                        <object idref="tableDesc0"/> 
@@ -228,14 +228,14 @@
                  <class>org.apache.hadoop.hive.ql.udf.UDFOPLessThan</class> 
                 </void> 
                 <void property="UDFMethod"> 
-                 <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                 <object class="org.apache.hadoop.hive.ql.udf.UDFOPLessThan" method="getMethod"> 
                   <string>evaluate</string> 
                   <array class="java.lang.Class" length="2"> 
                    <void index="0"> 
-                    <class>java.lang.String</class> 
+                    <class>java.lang.Double</class> 
                    </void> 
                    <void index="1"> 
-                    <class>java.lang.Number</class> 
+                    <class>java.lang.Double</class> 
                    </void> 
                   </array> 
                  </object> 
@@ -243,26 +243,78 @@
                 <void property="children"> 
                  <object class="java.util.ArrayList"> 
                   <void method="add"> 
-                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                    <void property="column"> 
-                     <string>key</string> 
+                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                    <void property="UDFClass"> 
+                     <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                    </void> 
+                    <void property="UDFMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                      <string>evaluate</string> 
+                      <array class="java.lang.Class" length="1"> 
+                       <void index="0"> 
+                        <class>java.lang.String</class> 
+                       </void> 
+                      </array> 
+                     </object> 
+                    </void> 
+                    <void property="children"> 
+                     <object class="java.util.ArrayList"> 
+                      <void method="add"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                        <void property="column"> 
+                         <string>key</string> 
+                        </void> 
+                        <void property="typeInfo"> 
+                         <object idref="PrimitiveTypeInfo0"/> 
+                        </void> 
+                       </object> 
+                      </void> 
+                     </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo0"/> 
+                     <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                      <void property="primitiveClass"> 
+                       <class>java.lang.Double</class> 
+                      </void> 
+                     </object> 
                     </void> 
                    </object> 
                   </void> 
                   <void method="add"> 
-                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
-                    <void property="typeInfo"> 
-                     <object class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
-                      <void property="primitiveClass"> 
-                       <class>java.lang.Integer</class> 
+                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                    <void property="UDFClass"> 
+                     <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                    </void> 
+                    <void property="UDFMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                      <string>evaluate</string> 
+                      <array class="java.lang.Class" length="1"> 
+                       <void index="0"> 
+                        <class>java.lang.Integer</class> 
+                       </void> 
+                      </array> 
+                     </object> 
+                    </void> 
+                    <void property="children"> 
+                     <object class="java.util.ArrayList"> 
+                      <void method="add"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                        <void property="typeInfo"> 
+                         <object class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                          <void property="primitiveClass"> 
+                           <class>java.lang.Integer</class> 
+                          </void> 
+                         </object> 
+                        </void> 
+                        <void property="value"> 
+                         <int>100</int> 
+                        </void> 
+                       </object> 
                       </void> 
                      </object> 
                     </void> 
-                    <void property="value"> 
-                     <int>100</int> 
+                    <void property="typeInfo"> 
+                     <object idref="PrimitiveTypeInfo1"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -332,7 +384,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>src</string> 
@@ -344,7 +396,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -396,7 +448,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
diff --git a/ql/src/test/results/compiler/plan/input2.q.xml b/ql/src/test/results/compiler/plan/input2.q.xml
index f882be3e9b..f1039a68a6 100755
--- a/ql/src/test/results/compiler/plan/input2.q.xml
+++ b/ql/src/test/results/compiler/plan/input2.q.xml
@@ -31,7 +31,7 @@
              <boolean>true</boolean> 
             </void> 
             <void property="sourceDir"> 
-             <string>/tmp/hive-njain/104100889/1367774772.10000.insclause-0</string> 
+             <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/238674319/24398083.10000.insclause-0</string> 
             </void> 
             <void property="table"> 
              <object id="tableDesc0" class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -80,7 +80,7 @@
                 </void> 
                 <void method="put"> 
                  <string>location</string> 
-                 <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/dest1</string> 
+                 <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/dest1</string> 
                 </void> 
                </object> 
               </void> 
@@ -100,7 +100,7 @@
              <boolean>true</boolean> 
             </void> 
             <void property="sourceDir"> 
-             <string>/tmp/hive-njain/104100889/1367774772.10001.insclause-1</string> 
+             <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/238674319/24398083.10001.insclause-1</string> 
             </void> 
             <void property="table"> 
              <object id="tableDesc1" class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -149,7 +149,7 @@
                 </void> 
                 <void method="put"> 
                  <string>location</string> 
-                 <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/dest2</string> 
+                 <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/dest2</string> 
                 </void> 
                </object> 
               </void> 
@@ -178,7 +178,7 @@
              <boolean>true</boolean> 
             </void> 
             <void property="sourceDir"> 
-             <string>/tmp/hive-njain/104100889/1367774772.10002.insclause-2</string> 
+             <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/238674319/24398083.10002.insclause-2</string> 
             </void> 
             <void property="table"> 
              <object id="tableDesc2" class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -231,7 +231,7 @@
                 </void> 
                 <void method="put"> 
                  <string>location</string> 
-                 <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/dest3</string> 
+                 <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/dest3</string> 
                 </void> 
                </object> 
               </void> 
@@ -275,7 +275,7 @@
                     <void property="conf"> 
                      <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                       <void property="dirName"> 
-                       <string>/tmp/hive-njain/104100889/1367774772.10000.insclause-0</string> 
+                       <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/238674319/24398083.10000.insclause-0</string> 
                       </void> 
                       <void property="tableInfo"> 
                        <object idref="tableDesc0"/> 
@@ -382,14 +382,14 @@
                  <class>org.apache.hadoop.hive.ql.udf.UDFOPLessThan</class> 
                 </void> 
                 <void property="UDFMethod"> 
-                 <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                 <object class="org.apache.hadoop.hive.ql.udf.UDFOPLessThan" method="getMethod"> 
                   <string>evaluate</string> 
                   <array class="java.lang.Class" length="2"> 
                    <void index="0"> 
-                    <class>java.lang.String</class> 
+                    <class>java.lang.Double</class> 
                    </void> 
                    <void index="1"> 
-                    <class>java.lang.Number</class> 
+                    <class>java.lang.Double</class> 
                    </void> 
                   </array> 
                  </object> 
@@ -397,33 +397,85 @@
                 <void property="children"> 
                  <object class="java.util.ArrayList"> 
                   <void method="add"> 
-                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                    <void property="column"> 
-                     <string>key</string> 
+                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                    <void property="UDFClass"> 
+                     <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                    </void> 
+                    <void property="UDFMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                      <string>evaluate</string> 
+                      <array class="java.lang.Class" length="1"> 
+                       <void index="0"> 
+                        <class>java.lang.String</class> 
+                       </void> 
+                      </array> 
+                     </object> 
+                    </void> 
+                    <void property="children"> 
+                     <object class="java.util.ArrayList"> 
+                      <void method="add"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                        <void property="column"> 
+                         <string>key</string> 
+                        </void> 
+                        <void property="typeInfo"> 
+                         <object idref="PrimitiveTypeInfo0"/> 
+                        </void> 
+                       </object> 
+                      </void> 
+                     </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo0"/> 
+                     <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                      <void property="primitiveClass"> 
+                       <class>java.lang.Double</class> 
+                      </void> 
+                     </object> 
                     </void> 
                    </object> 
                   </void> 
                   <void method="add"> 
-                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
-                    <void property="typeInfo"> 
-                     <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
-                      <void property="primitiveClass"> 
-                       <class>java.lang.Integer</class> 
+                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                    <void property="UDFClass"> 
+                     <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                    </void> 
+                    <void property="UDFMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                      <string>evaluate</string> 
+                      <array class="java.lang.Class" length="1"> 
+                       <void index="0"> 
+                        <class>java.lang.Integer</class> 
+                       </void> 
+                      </array> 
+                     </object> 
+                    </void> 
+                    <void property="children"> 
+                     <object class="java.util.ArrayList"> 
+                      <void method="add"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                        <void property="typeInfo"> 
+                         <object id="PrimitiveTypeInfo2" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                          <void property="primitiveClass"> 
+                           <class>java.lang.Integer</class> 
+                          </void> 
+                         </object> 
+                        </void> 
+                        <void property="value"> 
+                         <int>100</int> 
+                        </void> 
+                       </object> 
                       </void> 
                      </object> 
                     </void> 
-                    <void property="value"> 
-                     <int>100</int> 
+                    <void property="typeInfo"> 
+                     <object idref="PrimitiveTypeInfo1"/> 
                     </void> 
                    </object> 
                   </void> 
                  </object> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object id="PrimitiveTypeInfo2" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                 <object id="PrimitiveTypeInfo3" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
                   <void property="primitiveClass"> 
                    <class>java.lang.Boolean</class> 
                   </void> 
@@ -483,7 +535,7 @@
                     <void property="conf"> 
                      <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                       <void property="dirName"> 
-                       <string>/tmp/hive-njain/104100889/1367774772.10001.insclause-1</string> 
+                       <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/238674319/24398083.10001.insclause-1</string> 
                       </void> 
                       <void property="tableInfo"> 
                        <object idref="tableDesc1"/> 
@@ -603,14 +655,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPEqualOrGreaterThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPEqualOrGreaterThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -618,29 +670,77 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo2"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>100</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
+                        </void> 
                         <void property="typeInfo"> 
                          <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
-                        <void property="value"> 
-                         <int>100</int> 
-                        </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo3"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -650,14 +750,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPLessThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPLessThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -665,36 +765,84 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo2"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>200</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
+                        </void> 
                         <void property="typeInfo"> 
                          <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
-                        <void property="value"> 
-                         <int>200</int> 
-                        </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo3"/> 
                     </void> 
                    </object> 
                   </void> 
                  </object> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object idref="PrimitiveTypeInfo2"/> 
+                 <object idref="PrimitiveTypeInfo3"/> 
                 </void> 
                </object> 
               </void> 
@@ -729,7 +877,7 @@
                     <void property="conf"> 
                      <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                       <void property="dirName"> 
-                       <string>/tmp/hive-njain/104100889/1367774772.10002.insclause-2</string> 
+                       <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/238674319/24398083.10002.insclause-2</string> 
                       </void> 
                       <void property="tableInfo"> 
                        <object idref="tableDesc2"/> 
@@ -763,7 +911,7 @@
                            <string>1</string> 
                           </void> 
                           <void property="type"> 
-                           <object idref="PrimitiveTypeInfo1"/> 
+                           <object idref="PrimitiveTypeInfo2"/> 
                           </void> 
                          </object> 
                         </void> 
@@ -792,7 +940,7 @@
                     <void method="add"> 
                      <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
                       <void property="typeInfo"> 
-                       <object idref="PrimitiveTypeInfo1"/> 
+                       <object idref="PrimitiveTypeInfo2"/> 
                       </void> 
                       <void property="value"> 
                        <int>2</int> 
@@ -829,14 +977,14 @@
                  <class>org.apache.hadoop.hive.ql.udf.UDFOPEqualOrGreaterThan</class> 
                 </void> 
                 <void property="UDFMethod"> 
-                 <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                 <object class="org.apache.hadoop.hive.ql.udf.UDFOPEqualOrGreaterThan" method="getMethod"> 
                   <string>evaluate</string> 
                   <array class="java.lang.Class" length="2"> 
                    <void index="0"> 
-                    <class>java.lang.String</class> 
+                    <class>java.lang.Double</class> 
                    </void> 
                    <void index="1"> 
-                    <class>java.lang.Number</class> 
+                    <class>java.lang.Double</class> 
                    </void> 
                   </array> 
                  </object> 
@@ -844,29 +992,77 @@
                 <void property="children"> 
                  <object class="java.util.ArrayList"> 
                   <void method="add"> 
-                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                    <void property="column"> 
-                     <string>key</string> 
+                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                    <void property="UDFClass"> 
+                     <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                    </void> 
+                    <void property="UDFMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                      <string>evaluate</string> 
+                      <array class="java.lang.Class" length="1"> 
+                       <void index="0"> 
+                        <class>java.lang.String</class> 
+                       </void> 
+                      </array> 
+                     </object> 
+                    </void> 
+                    <void property="children"> 
+                     <object class="java.util.ArrayList"> 
+                      <void method="add"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                        <void property="column"> 
+                         <string>key</string> 
+                        </void> 
+                        <void property="typeInfo"> 
+                         <object idref="PrimitiveTypeInfo0"/> 
+                        </void> 
+                       </object> 
+                      </void> 
+                     </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo0"/> 
+                     <object idref="PrimitiveTypeInfo1"/> 
                     </void> 
                    </object> 
                   </void> 
                   <void method="add"> 
-                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                    <void property="UDFClass"> 
+                     <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                    </void> 
+                    <void property="UDFMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                      <string>evaluate</string> 
+                      <array class="java.lang.Class" length="1"> 
+                       <void index="0"> 
+                        <class>java.lang.Integer</class> 
+                       </void> 
+                      </array> 
+                     </object> 
+                    </void> 
+                    <void property="children"> 
+                     <object class="java.util.ArrayList"> 
+                      <void method="add"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                        <void property="typeInfo"> 
+                         <object idref="PrimitiveTypeInfo2"/> 
+                        </void> 
+                        <void property="value"> 
+                         <int>200</int> 
+                        </void> 
+                       </object> 
+                      </void> 
+                     </object> 
+                    </void> 
                     <void property="typeInfo"> 
                      <object idref="PrimitiveTypeInfo1"/> 
                     </void> 
-                    <void property="value"> 
-                     <int>200</int> 
-                    </void> 
                    </object> 
                   </void> 
                  </object> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object idref="PrimitiveTypeInfo2"/> 
+                 <object idref="PrimitiveTypeInfo3"/> 
                 </void> 
                </object> 
               </void> 
@@ -904,7 +1100,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>src</string> 
@@ -916,7 +1112,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -968,7 +1164,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
diff --git a/ql/src/test/results/compiler/plan/input3.q.xml b/ql/src/test/results/compiler/plan/input3.q.xml
index bce18a84d2..b33db84dd4 100755
--- a/ql/src/test/results/compiler/plan/input3.q.xml
+++ b/ql/src/test/results/compiler/plan/input3.q.xml
@@ -28,7 +28,7 @@
              <boolean>true</boolean> 
             </void> 
             <void property="sourceDir"> 
-             <string>/data/users/pchakka/workspace/oshive/ql/../build/ql/tmp/382185459/89077292.10003.insclause-3</string> 
+             <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/48576025/763323393.10003.insclause-3</string> 
             </void> 
             <void property="targetDir"> 
              <string>../../../../build/contrib/hive/ql/test/data/warehouse/dest4.out</string> 
@@ -48,7 +48,7 @@
              <boolean>true</boolean> 
             </void> 
             <void property="sourceDir"> 
-             <string>/data/users/pchakka/workspace/oshive/ql/../build/ql/tmp/382185459/89077292.10000.insclause-0</string> 
+             <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/48576025/763323393.10000.insclause-0</string> 
             </void> 
             <void property="table"> 
              <object id="tableDesc0" class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -97,7 +97,7 @@
                 </void> 
                 <void method="put"> 
                  <string>location</string> 
-                 <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/dest1</string> 
+                 <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/dest1</string> 
                 </void> 
                </object> 
               </void> 
@@ -117,7 +117,7 @@
              <boolean>true</boolean> 
             </void> 
             <void property="sourceDir"> 
-             <string>/data/users/pchakka/workspace/oshive/ql/../build/ql/tmp/382185459/89077292.10001.insclause-1</string> 
+             <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/48576025/763323393.10001.insclause-1</string> 
             </void> 
             <void property="table"> 
              <object id="tableDesc1" class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -166,7 +166,7 @@
                 </void> 
                 <void method="put"> 
                  <string>location</string> 
-                 <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/dest2</string> 
+                 <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/dest2</string> 
                 </void> 
                </object> 
               </void> 
@@ -195,7 +195,7 @@
              <boolean>true</boolean> 
             </void> 
             <void property="sourceDir"> 
-             <string>/data/users/pchakka/workspace/oshive/ql/../build/ql/tmp/382185459/89077292.10002.insclause-2</string> 
+             <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/48576025/763323393.10002.insclause-2</string> 
             </void> 
             <void property="table"> 
              <object id="tableDesc2" class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -248,7 +248,7 @@
                 </void> 
                 <void method="put"> 
                  <string>location</string> 
-                 <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/dest3</string> 
+                 <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/dest3</string> 
                 </void> 
                </object> 
               </void> 
@@ -292,7 +292,7 @@
                     <void property="conf"> 
                      <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                       <void property="dirName"> 
-                       <string>/data/users/pchakka/workspace/oshive/ql/../build/ql/tmp/382185459/89077292.10000.insclause-0</string> 
+                       <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/48576025/763323393.10000.insclause-0</string> 
                       </void> 
                       <void property="tableInfo"> 
                        <object idref="tableDesc0"/> 
@@ -399,14 +399,14 @@
                  <class>org.apache.hadoop.hive.ql.udf.UDFOPLessThan</class> 
                 </void> 
                 <void property="UDFMethod"> 
-                 <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                 <object class="org.apache.hadoop.hive.ql.udf.UDFOPLessThan" method="getMethod"> 
                   <string>evaluate</string> 
                   <array class="java.lang.Class" length="2"> 
                    <void index="0"> 
-                    <class>java.lang.String</class> 
+                    <class>java.lang.Double</class> 
                    </void> 
                    <void index="1"> 
-                    <class>java.lang.Number</class> 
+                    <class>java.lang.Double</class> 
                    </void> 
                   </array> 
                  </object> 
@@ -414,33 +414,85 @@
                 <void property="children"> 
                  <object class="java.util.ArrayList"> 
                   <void method="add"> 
-                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                    <void property="column"> 
-                     <string>key</string> 
+                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                    <void property="UDFClass"> 
+                     <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                    </void> 
+                    <void property="UDFMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                      <string>evaluate</string> 
+                      <array class="java.lang.Class" length="1"> 
+                       <void index="0"> 
+                        <class>java.lang.String</class> 
+                       </void> 
+                      </array> 
+                     </object> 
+                    </void> 
+                    <void property="children"> 
+                     <object class="java.util.ArrayList"> 
+                      <void method="add"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                        <void property="column"> 
+                         <string>key</string> 
+                        </void> 
+                        <void property="typeInfo"> 
+                         <object idref="PrimitiveTypeInfo0"/> 
+                        </void> 
+                       </object> 
+                      </void> 
+                     </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo0"/> 
+                     <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                      <void property="primitiveClass"> 
+                       <class>java.lang.Double</class> 
+                      </void> 
+                     </object> 
                     </void> 
                    </object> 
                   </void> 
                   <void method="add"> 
-                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
-                    <void property="typeInfo"> 
-                     <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
-                      <void property="primitiveClass"> 
-                       <class>java.lang.Integer</class> 
+                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                    <void property="UDFClass"> 
+                     <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                    </void> 
+                    <void property="UDFMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                      <string>evaluate</string> 
+                      <array class="java.lang.Class" length="1"> 
+                       <void index="0"> 
+                        <class>java.lang.Integer</class> 
+                       </void> 
+                      </array> 
+                     </object> 
+                    </void> 
+                    <void property="children"> 
+                     <object class="java.util.ArrayList"> 
+                      <void method="add"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                        <void property="typeInfo"> 
+                         <object id="PrimitiveTypeInfo2" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                          <void property="primitiveClass"> 
+                           <class>java.lang.Integer</class> 
+                          </void> 
+                         </object> 
+                        </void> 
+                        <void property="value"> 
+                         <int>100</int> 
+                        </void> 
+                       </object> 
                       </void> 
                      </object> 
                     </void> 
-                    <void property="value"> 
-                     <int>100</int> 
+                    <void property="typeInfo"> 
+                     <object idref="PrimitiveTypeInfo1"/> 
                     </void> 
                    </object> 
                   </void> 
                  </object> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object id="PrimitiveTypeInfo2" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                 <object id="PrimitiveTypeInfo3" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
                   <void property="primitiveClass"> 
                    <class>java.lang.Boolean</class> 
                   </void> 
@@ -500,7 +552,7 @@
                     <void property="conf"> 
                      <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                       <void property="dirName"> 
-                       <string>/data/users/pchakka/workspace/oshive/ql/../build/ql/tmp/382185459/89077292.10001.insclause-1</string> 
+                       <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/48576025/763323393.10001.insclause-1</string> 
                       </void> 
                       <void property="tableInfo"> 
                        <object idref="tableDesc1"/> 
@@ -620,14 +672,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPEqualOrGreaterThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPEqualOrGreaterThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -635,29 +687,77 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo2"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>100</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
+                        </void> 
                         <void property="typeInfo"> 
                          <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
-                        <void property="value"> 
-                         <int>100</int> 
-                        </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo3"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -667,14 +767,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPLessThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPLessThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -682,36 +782,84 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo2"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>200</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
+                        </void> 
                         <void property="typeInfo"> 
                          <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
-                        <void property="value"> 
-                         <int>200</int> 
-                        </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo3"/> 
                     </void> 
                    </object> 
                   </void> 
                  </object> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object idref="PrimitiveTypeInfo2"/> 
+                 <object idref="PrimitiveTypeInfo3"/> 
                 </void> 
                </object> 
               </void> 
@@ -746,7 +894,7 @@
                     <void property="conf"> 
                      <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                       <void property="dirName"> 
-                       <string>/data/users/pchakka/workspace/oshive/ql/../build/ql/tmp/382185459/89077292.10002.insclause-2</string> 
+                       <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/48576025/763323393.10002.insclause-2</string> 
                       </void> 
                       <void property="tableInfo"> 
                        <object idref="tableDesc2"/> 
@@ -780,7 +928,7 @@
                            <string>1</string> 
                           </void> 
                           <void property="type"> 
-                           <object idref="PrimitiveTypeInfo1"/> 
+                           <object idref="PrimitiveTypeInfo2"/> 
                           </void> 
                          </object> 
                         </void> 
@@ -809,7 +957,7 @@
                     <void method="add"> 
                      <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
                       <void property="typeInfo"> 
-                       <object idref="PrimitiveTypeInfo1"/> 
+                       <object idref="PrimitiveTypeInfo2"/> 
                       </void> 
                       <void property="value"> 
                        <int>2</int> 
@@ -866,14 +1014,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPEqualOrGreaterThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPEqualOrGreaterThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -881,29 +1029,77 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo2"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>200</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
+                        </void> 
                         <void property="typeInfo"> 
                          <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
-                        <void property="value"> 
-                         <int>200</int> 
-                        </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo3"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -913,14 +1109,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPLessThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPLessThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -928,36 +1124,84 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo2"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>300</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
+                        </void> 
                         <void property="typeInfo"> 
                          <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
-                        <void property="value"> 
-                         <int>300</int> 
-                        </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo3"/> 
                     </void> 
                    </object> 
                   </void> 
                  </object> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object idref="PrimitiveTypeInfo2"/> 
+                 <object idref="PrimitiveTypeInfo3"/> 
                 </void> 
                </object> 
               </void> 
@@ -992,7 +1236,7 @@
                     <void property="conf"> 
                      <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                       <void property="dirName"> 
-                       <string>/data/users/pchakka/workspace/oshive/ql/../build/ql/tmp/382185459/89077292.10003.insclause-3</string> 
+                       <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/48576025/763323393.10003.insclause-3</string> 
                       </void> 
                       <void property="tableInfo"> 
                        <object class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -1094,14 +1338,14 @@
                  <class>org.apache.hadoop.hive.ql.udf.UDFOPEqualOrGreaterThan</class> 
                 </void> 
                 <void property="UDFMethod"> 
-                 <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                 <object class="org.apache.hadoop.hive.ql.udf.UDFOPEqualOrGreaterThan" method="getMethod"> 
                   <string>evaluate</string> 
                   <array class="java.lang.Class" length="2"> 
                    <void index="0"> 
-                    <class>java.lang.String</class> 
+                    <class>java.lang.Double</class> 
                    </void> 
                    <void index="1"> 
-                    <class>java.lang.Number</class> 
+                    <class>java.lang.Double</class> 
                    </void> 
                   </array> 
                  </object> 
@@ -1109,29 +1353,77 @@
                 <void property="children"> 
                  <object class="java.util.ArrayList"> 
                   <void method="add"> 
-                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                    <void property="column"> 
-                     <string>key</string> 
+                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                    <void property="UDFClass"> 
+                     <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                    </void> 
+                    <void property="UDFMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                      <string>evaluate</string> 
+                      <array class="java.lang.Class" length="1"> 
+                       <void index="0"> 
+                        <class>java.lang.String</class> 
+                       </void> 
+                      </array> 
+                     </object> 
+                    </void> 
+                    <void property="children"> 
+                     <object class="java.util.ArrayList"> 
+                      <void method="add"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                        <void property="column"> 
+                         <string>key</string> 
+                        </void> 
+                        <void property="typeInfo"> 
+                         <object idref="PrimitiveTypeInfo0"/> 
+                        </void> 
+                       </object> 
+                      </void> 
+                     </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo0"/> 
+                     <object idref="PrimitiveTypeInfo1"/> 
                     </void> 
                    </object> 
                   </void> 
                   <void method="add"> 
-                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                    <void property="UDFClass"> 
+                     <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                    </void> 
+                    <void property="UDFMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                      <string>evaluate</string> 
+                      <array class="java.lang.Class" length="1"> 
+                       <void index="0"> 
+                        <class>java.lang.Integer</class> 
+                       </void> 
+                      </array> 
+                     </object> 
+                    </void> 
+                    <void property="children"> 
+                     <object class="java.util.ArrayList"> 
+                      <void method="add"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                        <void property="typeInfo"> 
+                         <object idref="PrimitiveTypeInfo2"/> 
+                        </void> 
+                        <void property="value"> 
+                         <int>300</int> 
+                        </void> 
+                       </object> 
+                      </void> 
+                     </object> 
+                    </void> 
                     <void property="typeInfo"> 
                      <object idref="PrimitiveTypeInfo1"/> 
                     </void> 
-                    <void property="value"> 
-                     <int>300</int> 
-                    </void> 
                    </object> 
                   </void> 
                  </object> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object idref="PrimitiveTypeInfo2"/> 
+                 <object idref="PrimitiveTypeInfo3"/> 
                 </void> 
                </object> 
               </void> 
@@ -1169,7 +1461,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>src</string> 
@@ -1181,7 +1473,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -1233,7 +1525,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
diff --git a/ql/src/test/results/compiler/plan/input4.q.xml b/ql/src/test/results/compiler/plan/input4.q.xml
index 3f715ccf9b..d8d49b7066 100755
--- a/ql/src/test/results/compiler/plan/input4.q.xml
+++ b/ql/src/test/results/compiler/plan/input4.q.xml
@@ -31,7 +31,7 @@
              <boolean>true</boolean> 
             </void> 
             <void property="sourceDir"> 
-             <string>/data/users/pchakka/workspace/oshive/ql/../build/ql/tmp/952811677/1477355585.10000.insclause-0</string> 
+             <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/692060421/96243067.10000.insclause-0</string> 
             </void> 
             <void property="table"> 
              <object id="tableDesc0" class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -80,7 +80,7 @@
                 </void> 
                 <void method="put"> 
                  <string>location</string> 
-                 <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/dest1</string> 
+                 <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/dest1</string> 
                 </void> 
                </object> 
               </void> 
@@ -468,7 +468,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>tmap:src</string> 
@@ -480,7 +480,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -532,7 +532,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
@@ -662,14 +662,14 @@
                <class>org.apache.hadoop.hive.ql.udf.UDFOPLessThan</class> 
               </void> 
               <void property="UDFMethod"> 
-               <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+               <object class="org.apache.hadoop.hive.ql.udf.UDFOPLessThan" method="getMethod"> 
                 <string>evaluate</string> 
                 <array class="java.lang.Class" length="2"> 
                  <void index="0"> 
-                  <class>java.lang.String</class> 
+                  <class>java.lang.Double</class> 
                  </void> 
                  <void index="1"> 
-                  <class>java.lang.Number</class> 
+                  <class>java.lang.Double</class> 
                  </void> 
                 </array> 
                </object> 
@@ -677,26 +677,78 @@
               <void property="children"> 
                <object class="java.util.ArrayList"> 
                 <void method="add"> 
-                 <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                  <void property="column"> 
-                   <string>0</string> 
+                 <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                  <void property="UDFClass"> 
+                   <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                  </void> 
+                  <void property="UDFMethod"> 
+                   <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                    <string>evaluate</string> 
+                    <array class="java.lang.Class" length="1"> 
+                     <void index="0"> 
+                      <class>java.lang.String</class> 
+                     </void> 
+                    </array> 
+                   </object> 
+                  </void> 
+                  <void property="children"> 
+                   <object class="java.util.ArrayList"> 
+                    <void method="add"> 
+                     <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                      <void property="column"> 
+                       <string>0</string> 
+                      </void> 
+                      <void property="typeInfo"> 
+                       <object idref="PrimitiveTypeInfo0"/> 
+                      </void> 
+                     </object> 
+                    </void> 
+                   </object> 
                   </void> 
                   <void property="typeInfo"> 
-                   <object idref="PrimitiveTypeInfo0"/> 
+                   <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                    <void property="primitiveClass"> 
+                     <class>java.lang.Double</class> 
+                    </void> 
+                   </object> 
                   </void> 
                  </object> 
                 </void> 
                 <void method="add"> 
-                 <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
-                  <void property="typeInfo"> 
-                   <object class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
-                    <void property="primitiveClass"> 
-                     <class>java.lang.Integer</class> 
+                 <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                  <void property="UDFClass"> 
+                   <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                  </void> 
+                  <void property="UDFMethod"> 
+                   <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                    <string>evaluate</string> 
+                    <array class="java.lang.Class" length="1"> 
+                     <void index="0"> 
+                      <class>java.lang.Integer</class> 
+                     </void> 
+                    </array> 
+                   </object> 
+                  </void> 
+                  <void property="children"> 
+                   <object class="java.util.ArrayList"> 
+                    <void method="add"> 
+                     <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                      <void property="typeInfo"> 
+                       <object class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                        <void property="primitiveClass"> 
+                         <class>java.lang.Integer</class> 
+                        </void> 
+                       </object> 
+                      </void> 
+                      <void property="value"> 
+                       <int>100</int> 
+                      </void> 
+                     </object> 
                     </void> 
                    </object> 
                   </void> 
-                  <void property="value"> 
-                   <int>100</int> 
+                  <void property="typeInfo"> 
+                   <object idref="PrimitiveTypeInfo1"/> 
                   </void> 
                  </object> 
                 </void> 
diff --git a/ql/src/test/results/compiler/plan/input8.q.xml b/ql/src/test/results/compiler/plan/input8.q.xml
index 35b8a9e107..75d4d41001 100644
--- a/ql/src/test/results/compiler/plan/input8.q.xml
+++ b/ql/src/test/results/compiler/plan/input8.q.xml
@@ -26,7 +26,7 @@
                     <void property="conf"> 
                      <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                       <void property="dirName"> 
-                       <string>/tmp/hive-njain/590666906.10001.insclause-0</string> 
+                       <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/156343375.10001.insclause-0</string> 
                       </void> 
                       <void property="tableInfo"> 
                        <object class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -74,7 +74,7 @@
                           <void property="type"> 
                            <object id="PrimitiveTypeInfo0" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
                             <void property="primitiveClass"> 
-                             <class>java.lang.Integer</class> 
+                             <class>java.lang.Double</class> 
                             </void> 
                            </object> 
                           </void> 
@@ -86,11 +86,7 @@
                            <string>1</string> 
                           </void> 
                           <void property="type"> 
-                           <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
-                            <void property="primitiveClass"> 
-                             <class>java.lang.Double</class> 
-                            </void> 
-                           </object> 
+                           <object idref="PrimitiveTypeInfo0"/> 
                           </void> 
                          </object> 
                         </void> 
@@ -100,11 +96,7 @@
                            <string>2</string> 
                           </void> 
                           <void property="type"> 
-                           <object id="PrimitiveTypeInfo2" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
-                            <void property="primitiveClass"> 
-                             <class>java.lang.Byte</class> 
-                            </void> 
-                           </object> 
+                           <object idref="PrimitiveTypeInfo0"/> 
                           </void> 
                          </object> 
                         </void> 
@@ -130,10 +122,10 @@
                         <string>evaluate</string> 
                         <array class="java.lang.Class" length="2"> 
                          <void index="0"> 
-                          <class>java.lang.Integer</class> 
+                          <class>java.lang.Double</class> 
                          </void> 
                          <void index="1"> 
-                          <class>java.lang.Integer</class> 
+                          <class>java.lang.Double</class> 
                          </void> 
                         </array> 
                        </object> 
@@ -141,13 +133,41 @@
                       <void property="children"> 
                        <object class="java.util.ArrayList"> 
                         <void method="add"> 
-                         <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                         <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                          <void property="UDFClass"> 
+                           <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                          </void> 
+                          <void property="UDFMethod"> 
+                           <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                            <string>evaluate</string> 
+                            <array class="java.lang.Class" length="1"> 
+                             <void index="0"> 
+                              <class>java.lang.Integer</class> 
+                             </void> 
+                            </array> 
+                           </object> 
+                          </void> 
+                          <void property="children"> 
+                           <object class="java.util.ArrayList"> 
+                            <void method="add"> 
+                             <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                              <void property="typeInfo"> 
+                               <object class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                                <void property="primitiveClass"> 
+                                 <class>java.lang.Integer</class> 
+                                </void> 
+                               </object> 
+                              </void> 
+                              <void property="value"> 
+                               <int>4</int> 
+                              </void> 
+                             </object> 
+                            </void> 
+                           </object> 
+                          </void> 
                           <void property="typeInfo"> 
                            <object idref="PrimitiveTypeInfo0"/> 
                           </void> 
-                          <void property="value"> 
-                           <int>4</int> 
-                          </void> 
                          </object> 
                         </void> 
                         <void method="add"> 
@@ -207,7 +227,7 @@
                                <string>0</string> 
                               </void> 
                               <void property="typeInfo"> 
-                               <object id="PrimitiveTypeInfo3" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                               <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
                                 <void property="primitiveClass"> 
                                  <class>java.lang.String</class> 
                                 </void> 
@@ -218,21 +238,21 @@
                            </object> 
                           </void> 
                           <void property="typeInfo"> 
-                           <object idref="PrimitiveTypeInfo1"/> 
+                           <object idref="PrimitiveTypeInfo0"/> 
                           </void> 
                          </object> 
                         </void> 
                         <void method="add"> 
                          <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
                           <void property="typeInfo"> 
-                           <object idref="PrimitiveTypeInfo1"/> 
+                           <object idref="PrimitiveTypeInfo0"/> 
                           </void> 
                          </object> 
                         </void> 
                        </object> 
                       </void> 
                       <void property="typeInfo"> 
-                       <object idref="PrimitiveTypeInfo1"/> 
+                       <object idref="PrimitiveTypeInfo0"/> 
                       </void> 
                      </object> 
                     </void> 
@@ -246,10 +266,10 @@
                         <string>evaluate</string> 
                         <array class="java.lang.Class" length="2"> 
                          <void index="0"> 
-                          <class>java.lang.Byte</class> 
+                          <class>java.lang.Double</class> 
                          </void> 
                          <void index="1"> 
-                          <class>java.lang.Byte</class> 
+                          <class>java.lang.Double</class> 
                          </void> 
                         </array> 
                        </object> 
@@ -259,21 +279,21 @@
                         <void method="add"> 
                          <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
                           <void property="typeInfo"> 
-                           <object idref="PrimitiveTypeInfo2"/> 
+                           <object idref="PrimitiveTypeInfo0"/> 
                           </void> 
                          </object> 
                         </void> 
                         <void method="add"> 
                          <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
                           <void property="typeInfo"> 
-                           <object idref="PrimitiveTypeInfo2"/> 
+                           <object idref="PrimitiveTypeInfo0"/> 
                           </void> 
                          </object> 
                         </void> 
                        </object> 
                       </void> 
                       <void property="typeInfo"> 
-                       <object idref="PrimitiveTypeInfo2"/> 
+                       <object idref="PrimitiveTypeInfo0"/> 
                       </void> 
                      </object> 
                     </void> 
@@ -309,7 +329,7 @@
                    <string>key</string> 
                   </void> 
                   <void property="typeInfo"> 
-                   <object idref="PrimitiveTypeInfo3"/> 
+                   <object idref="PrimitiveTypeInfo1"/> 
                   </void> 
                  </object> 
                 </void> 
@@ -334,7 +354,7 @@
                    <string>0</string> 
                   </void> 
                   <void property="type"> 
-                   <object idref="PrimitiveTypeInfo3"/> 
+                   <object idref="PrimitiveTypeInfo1"/> 
                   </void> 
                  </object> 
                 </void> 
@@ -356,7 +376,7 @@
                <string>key</string> 
               </void> 
               <void property="type"> 
-               <object idref="PrimitiveTypeInfo3"/> 
+               <object idref="PrimitiveTypeInfo1"/> 
               </void> 
              </object> 
             </void> 
@@ -366,7 +386,7 @@
                <string>value</string> 
               </void> 
               <void property="type"> 
-               <object idref="PrimitiveTypeInfo3"/> 
+               <object idref="PrimitiveTypeInfo1"/> 
               </void> 
              </object> 
             </void> 
@@ -381,7 +401,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/src1</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src1</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>src1</string> 
@@ -393,7 +413,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/src1</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src1</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -445,7 +465,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/src1</string> 
+             <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src1</string> 
             </void> 
            </object> 
           </void> 
diff --git a/ql/src/test/results/compiler/plan/input9.q.xml b/ql/src/test/results/compiler/plan/input9.q.xml
index 851265c4b1..5e5808a3e2 100644
--- a/ql/src/test/results/compiler/plan/input9.q.xml
+++ b/ql/src/test/results/compiler/plan/input9.q.xml
@@ -31,7 +31,7 @@
              <boolean>true</boolean> 
             </void> 
             <void property="sourceDir"> 
-             <string>/tmp/hive-njain/483179349.10000.insclause-0</string> 
+             <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/902483168.10000.insclause-0</string> 
             </void> 
             <void property="table"> 
              <object id="tableDesc0" class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -80,7 +80,7 @@
                 </void> 
                 <void method="put"> 
                  <string>location</string> 
-                 <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/dest1</string> 
+                 <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/dest1</string> 
                 </void> 
                </object> 
               </void> 
@@ -128,7 +128,7 @@
                         <void property="conf"> 
                          <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                           <void property="dirName"> 
-                           <string>/tmp/hive-njain/483179349.10000.insclause-0</string> 
+                           <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/902483168.10000.insclause-0</string> 
                           </void> 
                           <void property="tableInfo"> 
                            <object idref="tableDesc0"/> 
@@ -237,10 +237,10 @@
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -250,14 +250,18 @@
                       <void method="add"> 
                        <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                          <void property="primitiveClass"> 
+                           <class>java.lang.Double</class> 
+                          </void> 
+                         </object> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
                        <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
@@ -374,7 +378,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/src1</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src1</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>src1</string> 
@@ -386,7 +390,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/src1</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src1</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -438,7 +442,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/src1</string> 
+             <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src1</string> 
             </void> 
            </object> 
           </void> 
diff --git a/ql/src/test/results/compiler/plan/input_part1.q.xml b/ql/src/test/results/compiler/plan/input_part1.q.xml
index 96ca059aee..eafd08f40a 100644
--- a/ql/src/test/results/compiler/plan/input_part1.q.xml
+++ b/ql/src/test/results/compiler/plan/input_part1.q.xml
@@ -26,7 +26,7 @@
                     <void property="conf"> 
                      <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                       <void property="dirName"> 
-                       <string>/data/users/pchakka/workspace/oshive/ql/../build/ql/tmp/60338291/166255580.10001.insclause-0</string> 
+                       <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/51778219/26693039.10001.insclause-0</string> 
                       </void> 
                       <void property="tableInfo"> 
                        <object class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -232,14 +232,14 @@
                          <class>org.apache.hadoop.hive.ql.udf.UDFOPLessThan</class> 
                         </void> 
                         <void property="UDFMethod"> 
-                         <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFOPLessThan" method="getMethod"> 
                           <string>evaluate</string> 
                           <array class="java.lang.Class" length="2"> 
                            <void index="0"> 
-                            <class>java.lang.String</class> 
+                            <class>java.lang.Double</class> 
                            </void> 
                            <void index="1"> 
-                            <class>java.lang.Number</class> 
+                            <class>java.lang.Double</class> 
                            </void> 
                           </array> 
                          </object> 
@@ -247,33 +247,85 @@
                         <void property="children"> 
                          <object class="java.util.ArrayList"> 
                           <void method="add"> 
-                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                            <void property="column"> 
-                             <string>key</string> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                            <void property="UDFClass"> 
+                             <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                            </void> 
+                            <void property="UDFMethod"> 
+                             <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                              <string>evaluate</string> 
+                              <array class="java.lang.Class" length="1"> 
+                               <void index="0"> 
+                                <class>java.lang.String</class> 
+                               </void> 
+                              </array> 
+                             </object> 
+                            </void> 
+                            <void property="children"> 
+                             <object class="java.util.ArrayList"> 
+                              <void method="add"> 
+                               <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                                <void property="column"> 
+                                 <string>key</string> 
+                                </void> 
+                                <void property="typeInfo"> 
+                                 <object idref="PrimitiveTypeInfo0"/> 
+                                </void> 
+                               </object> 
+                              </void> 
+                             </object> 
                             </void> 
                             <void property="typeInfo"> 
-                             <object idref="PrimitiveTypeInfo0"/> 
+                             <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                              <void property="primitiveClass"> 
+                               <class>java.lang.Double</class> 
+                              </void> 
+                             </object> 
                             </void> 
                            </object> 
                           </void> 
                           <void method="add"> 
-                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
-                            <void property="typeInfo"> 
-                             <object class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
-                              <void property="primitiveClass"> 
-                               <class>java.lang.Integer</class> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                            <void property="UDFClass"> 
+                             <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                            </void> 
+                            <void property="UDFMethod"> 
+                             <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                              <string>evaluate</string> 
+                              <array class="java.lang.Class" length="1"> 
+                               <void index="0"> 
+                                <class>java.lang.Integer</class> 
+                               </void> 
+                              </array> 
+                             </object> 
+                            </void> 
+                            <void property="children"> 
+                             <object class="java.util.ArrayList"> 
+                              <void method="add"> 
+                               <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                                <void property="typeInfo"> 
+                                 <object class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                                  <void property="primitiveClass"> 
+                                   <class>java.lang.Integer</class> 
+                                  </void> 
+                                 </object> 
+                                </void> 
+                                <void property="value"> 
+                                 <int>100</int> 
+                                </void> 
+                               </object> 
                               </void> 
                              </object> 
                             </void> 
-                            <void property="value"> 
-                             <int>100</int> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo1"/> 
                             </void> 
                            </object> 
                           </void> 
                          </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                         <object id="PrimitiveTypeInfo2" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
                           <void property="primitiveClass"> 
                            <class>java.lang.Boolean</class> 
                           </void> 
@@ -324,14 +376,14 @@
                          </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo1"/> 
+                         <object idref="PrimitiveTypeInfo2"/> 
                         </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo1"/> 
+                     <object idref="PrimitiveTypeInfo2"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -378,14 +430,14 @@
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo1"/> 
+                     <object idref="PrimitiveTypeInfo2"/> 
                     </void> 
                    </object> 
                   </void> 
                  </object> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object idref="PrimitiveTypeInfo1"/> 
+                 <object idref="PrimitiveTypeInfo2"/> 
                 </void> 
                </object> 
               </void> 
@@ -464,7 +516,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/srcpart/ds=2008-04-08/hr=12</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/srcpart/ds=2008-04-08/hr=12</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>srcpart</string> 
@@ -476,7 +528,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/srcpart/ds=2008-04-08/hr=12</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/srcpart/ds=2008-04-08/hr=12</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"> 
@@ -541,7 +593,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/srcpart</string> 
+             <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/srcpart</string> 
             </void> 
            </object> 
           </void> 
diff --git a/ql/src/test/results/compiler/plan/join4.q.xml b/ql/src/test/results/compiler/plan/join4.q.xml
index 0bb8d9d62d..182ba7e536 100644
--- a/ql/src/test/results/compiler/plan/join4.q.xml
+++ b/ql/src/test/results/compiler/plan/join4.q.xml
@@ -274,14 +274,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -289,33 +289,85 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                          <void property="primitiveClass"> 
+                           <class>java.lang.Double</class> 
+                          </void> 
+                         </object> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
-                        <void property="typeInfo"> 
-                         <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
-                          <void property="primitiveClass"> 
-                           <class>java.lang.Integer</class> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object id="PrimitiveTypeInfo2" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                              <void property="primitiveClass"> 
+                               <class>java.lang.Integer</class> 
+                              </void> 
+                             </object> 
+                            </void> 
+                            <void property="value"> 
+                             <int>15</int> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
-                        <void property="value"> 
-                         <int>15</int> 
+                        <void property="typeInfo"> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object id="PrimitiveTypeInfo2" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                     <object id="PrimitiveTypeInfo3" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
                       <void property="primitiveClass"> 
                        <class>java.lang.Boolean</class> 
                       </void> 
@@ -329,14 +381,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPLessThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPLessThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -344,36 +396,84 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo2"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>25</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
+                        </void> 
                         <void property="typeInfo"> 
                          <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
-                        <void property="value"> 
-                         <int>25</int> 
-                        </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo3"/> 
                     </void> 
                    </object> 
                   </void> 
                  </object> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object idref="PrimitiveTypeInfo2"/> 
+                 <object idref="PrimitiveTypeInfo3"/> 
                 </void> 
                </object> 
               </void> 
@@ -686,14 +786,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -701,29 +801,77 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo2"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>10</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
+                        </void> 
                         <void property="typeInfo"> 
                          <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
-                        <void property="value"> 
-                         <int>10</int> 
-                        </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo3"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -733,14 +881,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPLessThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPLessThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -748,36 +896,84 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo2"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>20</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
+                        </void> 
                         <void property="typeInfo"> 
                          <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
-                        <void property="value"> 
-                         <int>20</int> 
-                        </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo3"/> 
                     </void> 
                    </object> 
                   </void> 
                  </object> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object idref="PrimitiveTypeInfo2"/> 
+                 <object idref="PrimitiveTypeInfo3"/> 
                 </void> 
                </object> 
               </void> 
@@ -842,7 +1038,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>c:a:src1</string> 
@@ -857,7 +1053,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -909,7 +1105,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
@@ -939,7 +1135,7 @@
                   <void property="conf"> 
                    <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                     <void property="dirName"> 
-                     <string>/data/users/pchakka/workspace/oshive/ql/../build/ql/tmp/46163837/318815753.10001.insclause-0</string> 
+                     <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/141770649/591024768.10001.insclause-0</string> 
                     </void> 
                     <void property="tableInfo"> 
                      <object class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
diff --git a/ql/src/test/results/compiler/plan/join5.q.xml b/ql/src/test/results/compiler/plan/join5.q.xml
index ea66a96255..78489707f6 100644
--- a/ql/src/test/results/compiler/plan/join5.q.xml
+++ b/ql/src/test/results/compiler/plan/join5.q.xml
@@ -274,14 +274,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -289,33 +289,85 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                          <void property="primitiveClass"> 
+                           <class>java.lang.Double</class> 
+                          </void> 
+                         </object> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
-                        <void property="typeInfo"> 
-                         <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
-                          <void property="primitiveClass"> 
-                           <class>java.lang.Integer</class> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object id="PrimitiveTypeInfo2" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                              <void property="primitiveClass"> 
+                               <class>java.lang.Integer</class> 
+                              </void> 
+                             </object> 
+                            </void> 
+                            <void property="value"> 
+                             <int>15</int> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
-                        <void property="value"> 
-                         <int>15</int> 
+                        <void property="typeInfo"> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object id="PrimitiveTypeInfo2" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                     <object id="PrimitiveTypeInfo3" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
                       <void property="primitiveClass"> 
                        <class>java.lang.Boolean</class> 
                       </void> 
@@ -329,14 +381,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPLessThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPLessThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -344,36 +396,84 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo2"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>25</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
+                        </void> 
                         <void property="typeInfo"> 
                          <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
-                        <void property="value"> 
-                         <int>25</int> 
-                        </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo3"/> 
                     </void> 
                    </object> 
                   </void> 
                  </object> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object idref="PrimitiveTypeInfo2"/> 
+                 <object idref="PrimitiveTypeInfo3"/> 
                 </void> 
                </object> 
               </void> 
@@ -686,14 +786,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -701,29 +801,77 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo2"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>10</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
+                        </void> 
                         <void property="typeInfo"> 
                          <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
-                        <void property="value"> 
-                         <int>10</int> 
-                        </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo3"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -733,14 +881,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPLessThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPLessThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -748,36 +896,84 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo2"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>20</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
+                        </void> 
                         <void property="typeInfo"> 
                          <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
-                        <void property="value"> 
-                         <int>20</int> 
-                        </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo3"/> 
                     </void> 
                    </object> 
                   </void> 
                  </object> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object idref="PrimitiveTypeInfo2"/> 
+                 <object idref="PrimitiveTypeInfo3"/> 
                 </void> 
                </object> 
               </void> 
@@ -842,7 +1038,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>c:a:src1</string> 
@@ -857,7 +1053,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -909,7 +1105,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
@@ -939,7 +1135,7 @@
                   <void property="conf"> 
                    <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                     <void property="dirName"> 
-                     <string>/data/users/pchakka/workspace/oshive/ql/../build/ql/tmp/67901132/10357416.10001.insclause-0</string> 
+                     <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/1349751296/130011732.10001.insclause-0</string> 
                     </void> 
                     <void property="tableInfo"> 
                      <object class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
diff --git a/ql/src/test/results/compiler/plan/join6.q.xml b/ql/src/test/results/compiler/plan/join6.q.xml
index 366ef53208..2ae269cfc6 100644
--- a/ql/src/test/results/compiler/plan/join6.q.xml
+++ b/ql/src/test/results/compiler/plan/join6.q.xml
@@ -274,14 +274,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -289,33 +289,85 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                          <void property="primitiveClass"> 
+                           <class>java.lang.Double</class> 
+                          </void> 
+                         </object> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
-                        <void property="typeInfo"> 
-                         <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
-                          <void property="primitiveClass"> 
-                           <class>java.lang.Integer</class> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object id="PrimitiveTypeInfo2" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                              <void property="primitiveClass"> 
+                               <class>java.lang.Integer</class> 
+                              </void> 
+                             </object> 
+                            </void> 
+                            <void property="value"> 
+                             <int>15</int> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
-                        <void property="value"> 
-                         <int>15</int> 
+                        <void property="typeInfo"> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object id="PrimitiveTypeInfo2" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                     <object id="PrimitiveTypeInfo3" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
                       <void property="primitiveClass"> 
                        <class>java.lang.Boolean</class> 
                       </void> 
@@ -329,14 +381,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPLessThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPLessThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -344,36 +396,84 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo2"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>25</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
+                        </void> 
                         <void property="typeInfo"> 
                          <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
-                        <void property="value"> 
-                         <int>25</int> 
-                        </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo3"/> 
                     </void> 
                    </object> 
                   </void> 
                  </object> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object idref="PrimitiveTypeInfo2"/> 
+                 <object idref="PrimitiveTypeInfo3"/> 
                 </void> 
                </object> 
               </void> 
@@ -686,14 +786,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -701,29 +801,77 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo2"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>10</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
+                        </void> 
                         <void property="typeInfo"> 
                          <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
-                        <void property="value"> 
-                         <int>10</int> 
-                        </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo3"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -733,14 +881,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPLessThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPLessThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -748,36 +896,84 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo2"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>20</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
+                        </void> 
                         <void property="typeInfo"> 
                          <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
-                        <void property="value"> 
-                         <int>20</int> 
-                        </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo3"/> 
                     </void> 
                    </object> 
                   </void> 
                  </object> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object idref="PrimitiveTypeInfo2"/> 
+                 <object idref="PrimitiveTypeInfo3"/> 
                 </void> 
                </object> 
               </void> 
@@ -842,7 +1038,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>c:a:src1</string> 
@@ -857,7 +1053,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -909,7 +1105,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
@@ -939,7 +1135,7 @@
                   <void property="conf"> 
                    <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                     <void property="dirName"> 
-                     <string>/data/users/pchakka/workspace/oshive/ql/../build/ql/tmp/849791247/24076830.10001.insclause-0</string> 
+                     <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/276317907/1163250400.10001.insclause-0</string> 
                     </void> 
                     <void property="tableInfo"> 
                      <object class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
diff --git a/ql/src/test/results/compiler/plan/join7.q.xml b/ql/src/test/results/compiler/plan/join7.q.xml
index e1a814eeae..e0c20bbda7 100644
--- a/ql/src/test/results/compiler/plan/join7.q.xml
+++ b/ql/src/test/results/compiler/plan/join7.q.xml
@@ -274,14 +274,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -289,33 +289,85 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                          <void property="primitiveClass"> 
+                           <class>java.lang.Double</class> 
+                          </void> 
+                         </object> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
-                        <void property="typeInfo"> 
-                         <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
-                          <void property="primitiveClass"> 
-                           <class>java.lang.Integer</class> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object id="PrimitiveTypeInfo2" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                              <void property="primitiveClass"> 
+                               <class>java.lang.Integer</class> 
+                              </void> 
+                             </object> 
+                            </void> 
+                            <void property="value"> 
+                             <int>15</int> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
-                        <void property="value"> 
-                         <int>15</int> 
+                        <void property="typeInfo"> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object id="PrimitiveTypeInfo2" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                     <object id="PrimitiveTypeInfo3" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
                       <void property="primitiveClass"> 
                        <class>java.lang.Boolean</class> 
                       </void> 
@@ -329,14 +381,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPLessThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPLessThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -344,36 +396,84 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo2"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>25</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
+                        </void> 
                         <void property="typeInfo"> 
                          <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
-                        <void property="value"> 
-                         <int>25</int> 
-                        </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo3"/> 
                     </void> 
                    </object> 
                   </void> 
                  </object> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object idref="PrimitiveTypeInfo2"/> 
+                 <object idref="PrimitiveTypeInfo3"/> 
                 </void> 
                </object> 
               </void> 
@@ -686,14 +786,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -701,29 +801,77 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo2"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>10</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
+                        </void> 
                         <void property="typeInfo"> 
                          <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
-                        <void property="value"> 
-                         <int>10</int> 
-                        </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo3"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -733,14 +881,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPLessThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPLessThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -748,36 +896,84 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo2"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>20</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
+                        </void> 
                         <void property="typeInfo"> 
                          <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
-                        <void property="value"> 
-                         <int>20</int> 
-                        </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo3"/> 
                     </void> 
                    </object> 
                   </void> 
                  </object> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object idref="PrimitiveTypeInfo2"/> 
+                 <object idref="PrimitiveTypeInfo3"/> 
                 </void> 
                </object> 
               </void> 
@@ -1093,14 +1289,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -1108,29 +1304,77 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo2"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>20</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
+                        </void> 
                         <void property="typeInfo"> 
                          <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
-                        <void property="value"> 
-                         <int>20</int> 
-                        </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo3"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -1140,14 +1384,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPLessThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPLessThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -1155,36 +1399,84 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo2"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>25</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
+                        </void> 
                         <void property="typeInfo"> 
                          <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
-                        <void property="value"> 
-                         <int>25</int> 
-                        </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo3"/> 
                     </void> 
                    </object> 
                   </void> 
                  </object> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object idref="PrimitiveTypeInfo2"/> 
+                 <object idref="PrimitiveTypeInfo3"/> 
                 </void> 
                </object> 
               </void> 
@@ -1249,7 +1541,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>c:a:src1</string> 
@@ -1267,7 +1559,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -1319,7 +1611,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
@@ -1349,7 +1641,7 @@
                   <void property="conf"> 
                    <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                     <void property="dirName"> 
-                     <string>/data/users/pchakka/workspace/oshive/ql/../build/ql/tmp/144356131/476198727.10001.insclause-0</string> 
+                     <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/336223571/148113729.10001.insclause-0</string> 
                     </void> 
                     <void property="tableInfo"> 
                      <object class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
diff --git a/ql/src/test/results/compiler/plan/join8.q.xml b/ql/src/test/results/compiler/plan/join8.q.xml
index 7cfc9b0a3b..85d12a367e 100644
--- a/ql/src/test/results/compiler/plan/join8.q.xml
+++ b/ql/src/test/results/compiler/plan/join8.q.xml
@@ -274,14 +274,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -289,33 +289,85 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                          <void property="primitiveClass"> 
+                           <class>java.lang.Double</class> 
+                          </void> 
+                         </object> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
-                        <void property="typeInfo"> 
-                         <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
-                          <void property="primitiveClass"> 
-                           <class>java.lang.Integer</class> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object id="PrimitiveTypeInfo2" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                              <void property="primitiveClass"> 
+                               <class>java.lang.Integer</class> 
+                              </void> 
+                             </object> 
+                            </void> 
+                            <void property="value"> 
+                             <int>15</int> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
-                        <void property="value"> 
-                         <int>15</int> 
+                        <void property="typeInfo"> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object id="PrimitiveTypeInfo2" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                     <object id="PrimitiveTypeInfo3" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
                       <void property="primitiveClass"> 
                        <class>java.lang.Boolean</class> 
                       </void> 
@@ -329,14 +381,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPLessThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPLessThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -344,36 +396,84 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo2"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>25</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
+                        </void> 
                         <void property="typeInfo"> 
                          <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
-                        <void property="value"> 
-                         <int>25</int> 
-                        </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo3"/> 
                     </void> 
                    </object> 
                   </void> 
                  </object> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object idref="PrimitiveTypeInfo2"/> 
+                 <object idref="PrimitiveTypeInfo3"/> 
                 </void> 
                </object> 
               </void> 
@@ -686,14 +786,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -701,29 +801,77 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo2"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>10</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
+                        </void> 
                         <void property="typeInfo"> 
                          <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
-                        <void property="value"> 
-                         <int>10</int> 
-                        </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo3"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -733,14 +881,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPLessThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPLessThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -748,36 +896,84 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo2"/> 
+                            </void> 
+                            <void property="value"> 
+                             <int>20</int> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
+                        </void> 
                         <void property="typeInfo"> 
                          <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
-                        <void property="value"> 
-                         <int>20</int> 
-                        </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo2"/> 
+                     <object idref="PrimitiveTypeInfo3"/> 
                     </void> 
                    </object> 
                   </void> 
                  </object> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object idref="PrimitiveTypeInfo2"/> 
+                 <object idref="PrimitiveTypeInfo3"/> 
                 </void> 
                </object> 
               </void> 
@@ -842,7 +1038,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>c:a:src1</string> 
@@ -857,7 +1053,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -909,7 +1105,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
@@ -943,7 +1139,7 @@
                       <void property="conf"> 
                        <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                         <void property="dirName"> 
-                         <string>/data/users/pchakka/workspace/oshive/ql/../build/ql/tmp/27316771/18134100.10001.insclause-0</string> 
+                         <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/1138017406/17202700.10001.insclause-0</string> 
                         </void> 
                         <void property="tableInfo"> 
                          <object class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -1149,7 +1345,7 @@
                        </object> 
                       </void> 
                       <void property="typeInfo"> 
-                       <object idref="PrimitiveTypeInfo2"/> 
+                       <object idref="PrimitiveTypeInfo3"/> 
                       </void> 
                      </object> 
                     </void> 
@@ -1183,14 +1379,14 @@
                        </object> 
                       </void> 
                       <void property="typeInfo"> 
-                       <object idref="PrimitiveTypeInfo2"/> 
+                       <object idref="PrimitiveTypeInfo3"/> 
                       </void> 
                      </object> 
                     </void> 
                    </object> 
                   </void> 
                   <void property="typeInfo"> 
-                   <object idref="PrimitiveTypeInfo2"/> 
+                   <object idref="PrimitiveTypeInfo3"/> 
                   </void> 
                  </object> 
                 </void> 
diff --git a/ql/src/test/results/compiler/plan/sample7.q.xml b/ql/src/test/results/compiler/plan/sample7.q.xml
index f3c771d7fa..6da8b0898c 100644
--- a/ql/src/test/results/compiler/plan/sample7.q.xml
+++ b/ql/src/test/results/compiler/plan/sample7.q.xml
@@ -31,7 +31,7 @@
              <boolean>true</boolean> 
             </void> 
             <void property="sourceDir"> 
-             <string>/tmp/hive-njain/475551879/391349136.10000.insclause-0</string> 
+             <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/1538040054/309610911.10000.insclause-0</string> 
             </void> 
             <void property="table"> 
              <object id="tableDesc0" class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -80,7 +80,7 @@
                 </void> 
                 <void method="put"> 
                  <string>location</string> 
-                 <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/dest1</string> 
+                 <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/dest1</string> 
                 </void> 
                </object> 
               </void> 
@@ -128,7 +128,7 @@
                         <void property="conf"> 
                          <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                           <void property="dirName"> 
-                           <string>/tmp/hive-njain/475551879/391349136.10000.insclause-0</string> 
+                           <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/1538040054/309610911.10000.insclause-0</string> 
                           </void> 
                           <void property="tableInfo"> 
                            <object idref="tableDesc0"/> 
@@ -235,14 +235,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -250,33 +250,85 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>key</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>key</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo0"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo0"/> 
+                         <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                          <void property="primitiveClass"> 
+                           <class>java.lang.Double</class> 
+                          </void> 
+                         </object> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
-                        <void property="typeInfo"> 
-                         <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
-                          <void property="primitiveClass"> 
-                           <class>java.lang.Integer</class> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object id="PrimitiveTypeInfo2" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                              <void property="primitiveClass"> 
+                               <class>java.lang.Integer</class> 
+                              </void> 
+                             </object> 
+                            </void> 
+                            <void property="value"> 
+                             <int>100</int> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
-                        <void property="value"> 
-                         <int>100</int> 
+                        <void property="typeInfo"> 
+                         <object idref="PrimitiveTypeInfo1"/> 
                         </void> 
                        </object> 
                       </void> 
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object id="PrimitiveTypeInfo2" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                     <object id="PrimitiveTypeInfo3" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
                       <void property="primitiveClass"> 
                        <class>java.lang.Boolean</class> 
                       </void> 
@@ -417,14 +469,14 @@
                              </object> 
                             </void> 
                             <void property="typeInfo"> 
-                             <object idref="PrimitiveTypeInfo1"/> 
+                             <object idref="PrimitiveTypeInfo2"/> 
                             </void> 
                            </object> 
                           </void> 
                           <void method="add"> 
                            <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
                             <void property="typeInfo"> 
-                             <object idref="PrimitiveTypeInfo1"/> 
+                             <object idref="PrimitiveTypeInfo2"/> 
                             </void> 
                             <void property="value"> 
                              <int>2147483647</int> 
@@ -434,14 +486,14 @@
                          </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo1"/> 
+                         <object idref="PrimitiveTypeInfo2"/> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
                        <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo1"/> 
+                         <object idref="PrimitiveTypeInfo2"/> 
                         </void> 
                         <void property="value"> 
                          <int>4</int> 
@@ -451,14 +503,14 @@
                      </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo1"/> 
+                     <object idref="PrimitiveTypeInfo2"/> 
                     </void> 
                    </object> 
                   </void> 
                   <void method="add"> 
                    <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo1"/> 
+                     <object idref="PrimitiveTypeInfo2"/> 
                     </void> 
                     <void property="value"> 
                      <int>0</int> 
@@ -468,7 +520,7 @@
                  </object> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object idref="PrimitiveTypeInfo2"/> 
+                 <object idref="PrimitiveTypeInfo3"/> 
                 </void> 
                </object> 
               </void> 
@@ -499,7 +551,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/srcbucket/kv1.txt</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/srcbucket/kv1.txt</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>s</string> 
@@ -511,7 +563,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/srcbucket/kv1.txt</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/srcbucket/kv1.txt</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -567,7 +619,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/srcbucket</string> 
+             <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/srcbucket</string> 
             </void> 
            </object> 
           </void> 
diff --git a/ql/src/test/results/compiler/plan/subq.q.xml b/ql/src/test/results/compiler/plan/subq.q.xml
index e7144806ae..ff9aa72905 100644
--- a/ql/src/test/results/compiler/plan/subq.q.xml
+++ b/ql/src/test/results/compiler/plan/subq.q.xml
@@ -28,7 +28,7 @@
              <boolean>true</boolean> 
             </void> 
             <void property="sourceDir"> 
-             <string>/data/users/pchakka/workspace/oshive/ql/../build/ql/tmp/797066151/209780209.10000.insclause-0</string> 
+             <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/538025002/104579387.10000.insclause-0</string> 
             </void> 
             <void property="targetDir"> 
              <string>../build/ql/test/data/warehouse/union.out</string> 
@@ -75,7 +75,7 @@
                         <void property="conf"> 
                          <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                           <void property="dirName"> 
-                           <string>/data/users/pchakka/workspace/oshive/ql/../build/ql/tmp/797066151/209780209.10000.insclause-0</string> 
+                           <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/538025002/104579387.10000.insclause-0</string> 
                           </void> 
                           <void property="tableInfo"> 
                            <object class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -274,14 +274,14 @@
                  <class>org.apache.hadoop.hive.ql.udf.UDFOPLessThan</class> 
                 </void> 
                 <void property="UDFMethod"> 
-                 <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                 <object class="org.apache.hadoop.hive.ql.udf.UDFOPLessThan" method="getMethod"> 
                   <string>evaluate</string> 
                   <array class="java.lang.Class" length="2"> 
                    <void index="0"> 
-                    <class>java.lang.String</class> 
+                    <class>java.lang.Double</class> 
                    </void> 
                    <void index="1"> 
-                    <class>java.lang.Number</class> 
+                    <class>java.lang.Double</class> 
                    </void> 
                   </array> 
                  </object> 
@@ -289,26 +289,78 @@
                 <void property="children"> 
                  <object class="java.util.ArrayList"> 
                   <void method="add"> 
-                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                    <void property="column"> 
-                     <string>key</string> 
+                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                    <void property="UDFClass"> 
+                     <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                    </void> 
+                    <void property="UDFMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                      <string>evaluate</string> 
+                      <array class="java.lang.Class" length="1"> 
+                       <void index="0"> 
+                        <class>java.lang.String</class> 
+                       </void> 
+                      </array> 
+                     </object> 
+                    </void> 
+                    <void property="children"> 
+                     <object class="java.util.ArrayList"> 
+                      <void method="add"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                        <void property="column"> 
+                         <string>key</string> 
+                        </void> 
+                        <void property="typeInfo"> 
+                         <object idref="PrimitiveTypeInfo0"/> 
+                        </void> 
+                       </object> 
+                      </void> 
+                     </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo0"/> 
+                     <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                      <void property="primitiveClass"> 
+                       <class>java.lang.Double</class> 
+                      </void> 
+                     </object> 
                     </void> 
                    </object> 
                   </void> 
                   <void method="add"> 
-                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
-                    <void property="typeInfo"> 
-                     <object class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
-                      <void property="primitiveClass"> 
-                       <class>java.lang.Integer</class> 
+                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                    <void property="UDFClass"> 
+                     <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                    </void> 
+                    <void property="UDFMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                      <string>evaluate</string> 
+                      <array class="java.lang.Class" length="1"> 
+                       <void index="0"> 
+                        <class>java.lang.Integer</class> 
+                       </void> 
+                      </array> 
+                     </object> 
+                    </void> 
+                    <void property="children"> 
+                     <object class="java.util.ArrayList"> 
+                      <void method="add"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                        <void property="typeInfo"> 
+                         <object class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                          <void property="primitiveClass"> 
+                           <class>java.lang.Integer</class> 
+                          </void> 
+                         </object> 
+                        </void> 
+                        <void property="value"> 
+                         <int>100</int> 
+                        </void> 
+                       </object> 
                       </void> 
                      </object> 
                     </void> 
-                    <void property="value"> 
-                     <int>100</int> 
+                    <void property="typeInfo"> 
+                     <object idref="PrimitiveTypeInfo1"/> 
                     </void> 
                    </object> 
                   </void> 
@@ -378,7 +430,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>unioninput:src</string> 
@@ -390,7 +442,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -442,7 +494,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
diff --git a/ql/src/test/results/compiler/plan/udf1.q.xml b/ql/src/test/results/compiler/plan/udf1.q.xml
index 448b4d0ed7..a6aba6d56f 100644
--- a/ql/src/test/results/compiler/plan/udf1.q.xml
+++ b/ql/src/test/results/compiler/plan/udf1.q.xml
@@ -30,7 +30,7 @@
                         <void property="conf"> 
                          <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                           <void property="dirName"> 
-                           <string>/tmp/hive-njain/487094769.10001.insclause-0</string> 
+                           <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/1023952720.10001.insclause-0</string> 
                           </void> 
                           <void property="tableInfo"> 
                            <object class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -1141,14 +1141,14 @@
                      <class>org.apache.hadoop.hive.ql.udf.UDFOPEqual</class> 
                     </void> 
                     <void property="UDFMethod"> 
-                     <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFOPEqual" method="getMethod"> 
                       <string>evaluate</string> 
                       <array class="java.lang.Class" length="2"> 
                        <void index="0"> 
-                        <class>java.lang.String</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                        <void index="1"> 
-                        <class>java.lang.Number</class> 
+                        <class>java.lang.Double</class> 
                        </void> 
                       </array> 
                      </object> 
@@ -1156,26 +1156,78 @@
                     <void property="children"> 
                      <object class="java.util.ArrayList"> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                        <void property="column"> 
-                         <string>0</string> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.String</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                            <void property="column"> 
+                             <string>0</string> 
+                            </void> 
+                            <void property="typeInfo"> 
+                             <object idref="PrimitiveTypeInfo1"/> 
+                            </void> 
+                           </object> 
+                          </void> 
+                         </object> 
                         </void> 
                         <void property="typeInfo"> 
-                         <object idref="PrimitiveTypeInfo1"/> 
+                         <object id="PrimitiveTypeInfo2" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                          <void property="primitiveClass"> 
+                           <class>java.lang.Double</class> 
+                          </void> 
+                         </object> 
                         </void> 
                        </object> 
                       </void> 
                       <void method="add"> 
-                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
-                        <void property="typeInfo"> 
-                         <object class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
-                          <void property="primitiveClass"> 
-                           <class>java.lang.Integer</class> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                        <void property="UDFClass"> 
+                         <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                        </void> 
+                        <void property="UDFMethod"> 
+                         <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                          <string>evaluate</string> 
+                          <array class="java.lang.Class" length="1"> 
+                           <void index="0"> 
+                            <class>java.lang.Integer</class> 
+                           </void> 
+                          </array> 
+                         </object> 
+                        </void> 
+                        <void property="children"> 
+                         <object class="java.util.ArrayList"> 
+                          <void method="add"> 
+                           <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                            <void property="typeInfo"> 
+                             <object class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                              <void property="primitiveClass"> 
+                               <class>java.lang.Integer</class> 
+                              </void> 
+                             </object> 
+                            </void> 
+                            <void property="value"> 
+                             <int>86</int> 
+                            </void> 
+                           </object> 
                           </void> 
                          </object> 
                         </void> 
-                        <void property="value"> 
-                         <int>86</int> 
+                        <void property="typeInfo"> 
+                         <object idref="PrimitiveTypeInfo2"/> 
                         </void> 
                        </object> 
                       </void> 
@@ -1288,7 +1340,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>src</string> 
@@ -1300,7 +1352,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -1352,7 +1404,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/home/njain/workspace/hadoophive/trunk/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
diff --git a/ql/src/test/results/compiler/plan/union.q.xml b/ql/src/test/results/compiler/plan/union.q.xml
index f90118f9fb..0eb7f7f326 100644
--- a/ql/src/test/results/compiler/plan/union.q.xml
+++ b/ql/src/test/results/compiler/plan/union.q.xml
@@ -28,7 +28,7 @@
              <boolean>true</boolean> 
             </void> 
             <void property="sourceDir"> 
-             <string>/data/users/pchakka/workspace/oshive/ql/../build/ql/tmp/1982541537/686730669.10000.insclause-0</string> 
+             <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/323358384/1524460804.10000.insclause-0</string> 
             </void> 
             <void property="targetDir"> 
              <string>../build/ql/test/data/warehouse/union.out</string> 
@@ -79,7 +79,7 @@
                             <void property="conf"> 
                              <object class="org.apache.hadoop.hive.ql.plan.fileSinkDesc"> 
                               <void property="dirName"> 
-                               <string>/data/users/pchakka/workspace/oshive/ql/../build/ql/tmp/1982541537/686730669.10000.insclause-0</string> 
+                               <string>/data/users/athusoo/apacheprojects/hive_local_ws3/ql/../build/ql/tmp/323358384/1524460804.10000.insclause-0</string> 
                               </void> 
                               <void property="tableInfo"> 
                                <object class="org.apache.hadoop.hive.ql.plan.tableDesc"> 
@@ -260,14 +260,14 @@
                                  <class>org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan</class> 
                                 </void> 
                                 <void property="UDFMethod"> 
-                                 <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                                 <object class="org.apache.hadoop.hive.ql.udf.UDFOPGreaterThan" method="getMethod"> 
                                   <string>evaluate</string> 
                                   <array class="java.lang.Class" length="2"> 
                                    <void index="0"> 
-                                    <class>java.lang.String</class> 
+                                    <class>java.lang.Double</class> 
                                    </void> 
                                    <void index="1"> 
-                                    <class>java.lang.Number</class> 
+                                    <class>java.lang.Double</class> 
                                    </void> 
                                   </array> 
                                  </object> 
@@ -275,33 +275,85 @@
                                 <void property="children"> 
                                  <object class="java.util.ArrayList"> 
                                   <void method="add"> 
-                                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                                    <void property="column"> 
-                                     <string>key</string> 
+                                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                                    <void property="UDFClass"> 
+                                     <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                                    </void> 
+                                    <void property="UDFMethod"> 
+                                     <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                                      <string>evaluate</string> 
+                                      <array class="java.lang.Class" length="1"> 
+                                       <void index="0"> 
+                                        <class>java.lang.String</class> 
+                                       </void> 
+                                      </array> 
+                                     </object> 
+                                    </void> 
+                                    <void property="children"> 
+                                     <object class="java.util.ArrayList"> 
+                                      <void method="add"> 
+                                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                                        <void property="column"> 
+                                         <string>key</string> 
+                                        </void> 
+                                        <void property="typeInfo"> 
+                                         <object idref="PrimitiveTypeInfo0"/> 
+                                        </void> 
+                                       </object> 
+                                      </void> 
+                                     </object> 
                                     </void> 
                                     <void property="typeInfo"> 
-                                     <object idref="PrimitiveTypeInfo0"/> 
+                                     <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                                      <void property="primitiveClass"> 
+                                       <class>java.lang.Double</class> 
+                                      </void> 
+                                     </object> 
                                     </void> 
                                    </object> 
                                   </void> 
                                   <void method="add"> 
-                                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
-                                    <void property="typeInfo"> 
-                                     <object id="PrimitiveTypeInfo1" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
-                                      <void property="primitiveClass"> 
-                                       <class>java.lang.Integer</class> 
+                                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                                    <void property="UDFClass"> 
+                                     <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                                    </void> 
+                                    <void property="UDFMethod"> 
+                                     <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                                      <string>evaluate</string> 
+                                      <array class="java.lang.Class" length="1"> 
+                                       <void index="0"> 
+                                        <class>java.lang.Integer</class> 
+                                       </void> 
+                                      </array> 
+                                     </object> 
+                                    </void> 
+                                    <void property="children"> 
+                                     <object class="java.util.ArrayList"> 
+                                      <void method="add"> 
+                                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                                        <void property="typeInfo"> 
+                                         <object id="PrimitiveTypeInfo2" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                                          <void property="primitiveClass"> 
+                                           <class>java.lang.Integer</class> 
+                                          </void> 
+                                         </object> 
+                                        </void> 
+                                        <void property="value"> 
+                                         <int>100</int> 
+                                        </void> 
+                                       </object> 
                                       </void> 
                                      </object> 
                                     </void> 
-                                    <void property="value"> 
-                                     <int>100</int> 
+                                    <void property="typeInfo"> 
+                                     <object idref="PrimitiveTypeInfo1"/> 
                                     </void> 
                                    </object> 
                                   </void> 
                                  </object> 
                                 </void> 
                                 <void property="typeInfo"> 
-                                 <object id="PrimitiveTypeInfo2" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
+                                 <object id="PrimitiveTypeInfo3" class="org.apache.hadoop.hive.ql.typeinfo.PrimitiveTypeInfo"> 
                                   <void property="primitiveClass"> 
                                    <class>java.lang.Boolean</class> 
                                   </void> 
@@ -490,14 +542,14 @@
                  <class>org.apache.hadoop.hive.ql.udf.UDFOPLessThan</class> 
                 </void> 
                 <void property="UDFMethod"> 
-                 <object class="org.apache.hadoop.hive.ql.udf.UDFBaseCompare" method="getMethod"> 
+                 <object class="org.apache.hadoop.hive.ql.udf.UDFOPLessThan" method="getMethod"> 
                   <string>evaluate</string> 
                   <array class="java.lang.Class" length="2"> 
                    <void index="0"> 
-                    <class>java.lang.String</class> 
+                    <class>java.lang.Double</class> 
                    </void> 
                    <void index="1"> 
-                    <class>java.lang.Number</class> 
+                    <class>java.lang.Double</class> 
                    </void> 
                   </array> 
                  </object> 
@@ -505,29 +557,77 @@
                 <void property="children"> 
                  <object class="java.util.ArrayList"> 
                   <void method="add"> 
-                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
-                    <void property="column"> 
-                     <string>key</string> 
+                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                    <void property="UDFClass"> 
+                     <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                    </void> 
+                    <void property="UDFMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                      <string>evaluate</string> 
+                      <array class="java.lang.Class" length="1"> 
+                       <void index="0"> 
+                        <class>java.lang.String</class> 
+                       </void> 
+                      </array> 
+                     </object> 
+                    </void> 
+                    <void property="children"> 
+                     <object class="java.util.ArrayList"> 
+                      <void method="add"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeColumnDesc"> 
+                        <void property="column"> 
+                         <string>key</string> 
+                        </void> 
+                        <void property="typeInfo"> 
+                         <object idref="PrimitiveTypeInfo0"/> 
+                        </void> 
+                       </object> 
+                      </void> 
+                     </object> 
                     </void> 
                     <void property="typeInfo"> 
-                     <object idref="PrimitiveTypeInfo0"/> 
+                     <object idref="PrimitiveTypeInfo1"/> 
                     </void> 
                    </object> 
                   </void> 
                   <void method="add"> 
-                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                   <object class="org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc"> 
+                    <void property="UDFClass"> 
+                     <class>org.apache.hadoop.hive.ql.udf.UDFToDouble</class> 
+                    </void> 
+                    <void property="UDFMethod"> 
+                     <object class="org.apache.hadoop.hive.ql.udf.UDFToDouble" method="getMethod"> 
+                      <string>evaluate</string> 
+                      <array class="java.lang.Class" length="1"> 
+                       <void index="0"> 
+                        <class>java.lang.Integer</class> 
+                       </void> 
+                      </array> 
+                     </object> 
+                    </void> 
+                    <void property="children"> 
+                     <object class="java.util.ArrayList"> 
+                      <void method="add"> 
+                       <object class="org.apache.hadoop.hive.ql.plan.exprNodeConstantDesc"> 
+                        <void property="typeInfo"> 
+                         <object idref="PrimitiveTypeInfo2"/> 
+                        </void> 
+                        <void property="value"> 
+                         <int>100</int> 
+                        </void> 
+                       </object> 
+                      </void> 
+                     </object> 
+                    </void> 
                     <void property="typeInfo"> 
                      <object idref="PrimitiveTypeInfo1"/> 
                     </void> 
-                    <void property="value"> 
-                     <int>100</int> 
-                    </void> 
                    </object> 
                   </void> 
                  </object> 
                 </void> 
                 <void property="typeInfo"> 
-                 <object idref="PrimitiveTypeInfo2"/> 
+                 <object idref="PrimitiveTypeInfo3"/> 
                 </void> 
                </object> 
               </void> 
@@ -590,7 +690,7 @@
     <void property="pathToAliases"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="java.util.ArrayList"> 
         <void method="add"> 
          <string>null-subquery1:unioninput-subquery1:src</string> 
@@ -605,7 +705,7 @@
     <void property="pathToPartitionInfo"> 
      <object class="java.util.LinkedHashMap"> 
       <void method="put"> 
-       <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+       <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
        <object class="org.apache.hadoop.hive.ql.plan.partitionDesc"> 
         <void property="partSpec"> 
          <object class="java.util.LinkedHashMap"/> 
@@ -657,7 +757,7 @@
             </void> 
             <void method="put"> 
              <string>location</string> 
-             <string>file:/data/users/pchakka/workspace/oshive/build/ql/test/data/warehouse/src</string> 
+             <string>file:/data/users/athusoo/apacheprojects/hive_local_ws3/build/ql/test/data/warehouse/src</string> 
             </void> 
            </object> 
           </void> 
