diff --git a/CHANGES.txt b/CHANGES.txt
index b623f13367..593284d1d7 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -217,6 +217,9 @@ Trunk - Unreleased
     HIVE-479. Change RCFileOutputFormat's generic signatute.
     (Yongqiang He via zshao)
 
+    HIVE-532. Predicates containing rand() not pushed above
+    (Prasad Chakka via namit)
+
 Release 0.3.1 - Unreleased
 
   INCOMPATIBLE CHANGES
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/ppd/ExprWalkerInfo.java b/ql/src/java/org/apache/hadoop/hive/ql/ppd/ExprWalkerInfo.java
index 4cc6bb81a7..9829e47680 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/ppd/ExprWalkerInfo.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/ppd/ExprWalkerInfo.java
@@ -31,7 +31,6 @@
 import org.apache.hadoop.hive.ql.lib.NodeProcessorCtx;
 import org.apache.hadoop.hive.ql.parse.RowResolver;
 import org.apache.hadoop.hive.ql.plan.exprNodeDesc;
-import org.apache.hadoop.hive.ql.plan.exprNodeFuncDesc;
 
 /**
  * Context for Expression Walker for determining predicate pushdown candidates
@@ -71,6 +70,7 @@ public ExprInfo(boolean isCandidate, String alias, exprNodeDesc replacedNode) {
    * this is a map from the alias to predicates.
    */
   private Map<exprNodeDesc,ExprInfo> exprInfoMap;
+  private boolean isDeterministic = true;
   
   public ExprWalkerInfo() {
     this.pushdownPreds = new HashMap<String, List<exprNodeDesc>>();
@@ -212,4 +212,19 @@ public void merge(ExprWalkerInfo ewi) {
       }
     }
   }
+
+  /**
+   * sets the deterministic flag for this expression 
+   * @param b deterministic or not
+   */
+  public void setDeterministic(boolean b) {
+    isDeterministic = b;
+  }
+  
+  /**
+   * @return whether this expression is deterministic or not
+   */
+  public boolean isDeterministic() {
+    return isDeterministic;
+  }
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/ppd/ExprWalkerProcFactory.java b/ql/src/java/org/apache/hadoop/hive/ql/ppd/ExprWalkerProcFactory.java
index 86821825ea..8884d2ab7b 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/ppd/ExprWalkerProcFactory.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/ppd/ExprWalkerProcFactory.java
@@ -106,6 +106,7 @@ public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx procCtx,
       if(note != null && !note.deterministic()) {
         // this UDF can't be pushed down
         ctx.setIsCandidate(expr, false);
+        ctx.setDeterministic(false);
         return false;
       }
       
@@ -157,6 +158,7 @@ public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx procCtx,
       if(note != null && !note.deterministic()) {
         // this GenericUDF can't be pushed down
         ctx.setIsCandidate(expr, false);
+        ctx.setDeterministic(false);
         return false;
       }
       
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/ppd/OpProcFactory.java b/ql/src/java/org/apache/hadoop/hive/ql/ppd/OpProcFactory.java
index e5b2443da9..8aef2dbb65 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/ppd/OpProcFactory.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/ppd/OpProcFactory.java
@@ -167,6 +167,11 @@ public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx procCtx,
       exprNodeFuncDesc predicate = (exprNodeFuncDesc) (((FilterOperator)nd).getConf()).getPredicate();
       // get pushdown predicates for this operato's predicate
       ExprWalkerInfo ewi = ExprWalkerProcFactory.extractPushdownPreds(owi, op, predicate);
+      if (!ewi.isDeterministic()) {
+        /* predicate is not deterministic */
+        return null;
+      }
+
       logExpr(nd, ewi);
       owi.putPrunedPreds(op, ewi);
       // merge it with children predicates
diff --git a/ql/src/test/queries/clientpositive/rand_partitionpruner3.q b/ql/src/test/queries/clientpositive/rand_partitionpruner3.q
index b5b7a3c519..9f4aaac267 100644
--- a/ql/src/test/queries/clientpositive/rand_partitionpruner3.q
+++ b/ql/src/test/queries/clientpositive/rand_partitionpruner3.q
@@ -1,4 +1,6 @@
+set hive.optimize.ppd=true;
 -- complex predicates in the where clause
+
 explain extended select a.* from srcpart a where rand(1) < 0.1 and a.ds = '2008-04-08' and not(key > 50 or key < 10) and a.hr like '%2';
 select a.* from srcpart a where rand(1) < 0.1 and a.ds = '2008-04-08' and not(key > 50 or key < 10) and a.hr like '%2';
 
diff --git a/ql/src/test/results/clientpositive/rand_partitionpruner3.q.out b/ql/src/test/results/clientpositive/rand_partitionpruner3.q.out
index 048697691d..8af834efce 100644
--- a/ql/src/test/results/clientpositive/rand_partitionpruner3.q.out
+++ b/ql/src/test/results/clientpositive/rand_partitionpruner3.q.out
@@ -1,4 +1,5 @@
 query: -- complex predicates in the where clause
+
 explain extended select a.* from srcpart a where rand(1) < 0.1 and a.ds = '2008-04-08' and not(key > 50 or key < 10) and a.hr like '%2'
 ABSTRACT SYNTAX TREE:
   (TOK_QUERY (TOK_FROM (TOK_TABREF srcpart a)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_ALLCOLREF a))) (TOK_WHERE (and (and (and (< (TOK_FUNCTION rand 1) 0.1) (= (. (TOK_TABLE_OR_COL a) ds) '2008-04-08')) (not (or (> (TOK_TABLE_OR_COL key) 50) (< (TOK_TABLE_OR_COL key) 10)))) (like (. (TOK_TABLE_OR_COL a) hr) '%2')))))
@@ -29,7 +30,7 @@ STAGE PLANS:
                 File Output Operator
                   compressed: false
                   GlobalTableId: 0
-                  directory: /data/users/njain/hive5/hive5/ql/../build/ql/tmp/45335645/29239923.10001.insclause-0
+                  directory: file:/data/users/pchakka/workspace/oshive2/build/ql/tmp/868971644/10001
                   table:
                       input format: org.apache.hadoop.mapred.TextInputFormat
                       output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
@@ -38,9 +39,9 @@ STAGE PLANS:
                         serialization.format 1
       Needs Tagging: false
       Path -> Alias:
-        file:/data/users/njain/hive5/hive5/build/ql/test/data/warehouse/srcpart/ds=2008-04-08/hr=12 
+        file:/data/users/pchakka/workspace/oshive2/build/ql/test/data/warehouse/srcpart/ds=2008-04-08/hr=12 
       Path -> Partition:
-        file:/data/users/njain/hive5/hive5/build/ql/test/data/warehouse/srcpart/ds=2008-04-08/hr=12 
+        file:/data/users/pchakka/workspace/oshive2/build/ql/test/data/warehouse/srcpart/ds=2008-04-08/hr=12 
           Partition
             partition values:
               ds 2008-04-08
@@ -59,7 +60,7 @@ STAGE PLANS:
                 serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                location file:/data/users/njain/hive5/hive5/build/ql/test/data/warehouse/srcpart
+                location file:/data/users/pchakka/workspace/oshive2/build/ql/test/data/warehouse/srcpart
               serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               name: srcpart
 
@@ -70,7 +71,7 @@ STAGE PLANS:
 
 query: select a.* from srcpart a where rand(1) < 0.1 and a.ds = '2008-04-08' and not(key > 50 or key < 10) and a.hr like '%2'
 Input: default/srcpart/ds=2008-04-08/hr=12
-Output: /data/users/njain/hive5/hive5/ql/../build/ql/tmp/47920681/27148542.10000
+Output: file:/data/users/pchakka/workspace/oshive2/build/ql/tmp/499802678/10000
 42	val_42	2008-04-08	12
 44	val_44	2008-04-08	12
 26	val_26	2008-04-08	12
@@ -94,31 +95,35 @@ STAGE PLANS:
               predicate:
                   expr: (((ds = '2008-04-08') and not ((UDFToDouble(key) > UDFToDouble(50)) or (UDFToDouble(key) < UDFToDouble(10)))) and (hr like '%2'))
                   type: boolean
-              Select Operator
-                expressions:
-                      expr: key
-                      type: string
-                      expr: value
-                      type: string
-                      expr: ds
-                      type: string
-                      expr: hr
-                      type: string
-                File Output Operator
-                  compressed: false
-                  GlobalTableId: 0
-                  directory: /data/users/njain/hive5/hive5/ql/../build/ql/tmp/1286189180/888381841.10001.insclause-0
-                  table:
-                      input format: org.apache.hadoop.mapred.TextInputFormat
-                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                      properties:
-                        columns a.key,a.value,a.ds,a.hr
-                        serialization.format 1
+              Filter Operator
+                predicate:
+                    expr: (((ds = '2008-04-08') and not ((UDFToDouble(key) > UDFToDouble(50)) or (UDFToDouble(key) < UDFToDouble(10)))) and (hr like '%2'))
+                    type: boolean
+                Select Operator
+                  expressions:
+                        expr: key
+                        type: string
+                        expr: value
+                        type: string
+                        expr: ds
+                        type: string
+                        expr: hr
+                        type: string
+                  File Output Operator
+                    compressed: false
+                    GlobalTableId: 0
+                    directory: file:/data/users/pchakka/workspace/oshive2/build/ql/tmp/1606994614/10001
+                    table:
+                        input format: org.apache.hadoop.mapred.TextInputFormat
+                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                        properties:
+                          columns a.key,a.value,a.ds,a.hr
+                          serialization.format 1
       Needs Tagging: false
       Path -> Alias:
-        file:/data/users/njain/hive5/hive5/build/ql/test/data/warehouse/srcpart/ds=2008-04-08/hr=12 
+        file:/data/users/pchakka/workspace/oshive2/build/ql/test/data/warehouse/srcpart/ds=2008-04-08/hr=12 
       Path -> Partition:
-        file:/data/users/njain/hive5/hive5/build/ql/test/data/warehouse/srcpart/ds=2008-04-08/hr=12 
+        file:/data/users/pchakka/workspace/oshive2/build/ql/test/data/warehouse/srcpart/ds=2008-04-08/hr=12 
           Partition
             partition values:
               ds 2008-04-08
@@ -137,7 +142,7 @@ STAGE PLANS:
                 serialization.lib org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                 file.inputformat org.apache.hadoop.mapred.TextInputFormat
                 file.outputformat org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
-                location file:/data/users/njain/hive5/hive5/build/ql/test/data/warehouse/srcpart
+                location file:/data/users/pchakka/workspace/oshive2/build/ql/test/data/warehouse/srcpart
               serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
               name: srcpart
 
@@ -148,7 +153,7 @@ STAGE PLANS:
 
 query: select a.* from srcpart a where a.ds = '2008-04-08' and not(key > 50 or key < 10) and a.hr like '%2'
 Input: default/srcpart/ds=2008-04-08/hr=12
-Output: /data/users/njain/hive5/hive5/ql/../build/ql/tmp/249549357/307540214.10000
+Output: file:/data/users/pchakka/workspace/oshive2/build/ql/tmp/1256518849/10000
 27	val_27	2008-04-08	12
 37	val_37	2008-04-08	12
 15	val_15	2008-04-08	12
