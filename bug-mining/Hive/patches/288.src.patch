diff --git a/CHANGES.txt b/CHANGES.txt
index e6cbb5b5d4..c80d170ed2 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -269,6 +269,9 @@ Trunk -  Unreleased
 
     HIVE-940 restrict creation of partitions with empty keys (Prasad Chakka via namit)
 
+    HIVE-941 hiveserver.sh doesn't work with Hadoop 0.20.0 or higher
+    (Ning Zhang via namit)
+
 Release 0.4.0 -  Unreleased
 
   INCOMPATIBLE CHANGES
diff --git a/bin/ext/hiveserver.sh b/bin/ext/hiveserver.sh
index 374730a585..45bb2df64e 100644
--- a/bin/ext/hiveserver.sh
+++ b/bin/ext/hiveserver.sh
@@ -8,10 +8,30 @@ hiveserver() {
     HIVE_LIB=`cygpath -w "$HIVE_LIB"`
   fi
   JAR=${HIVE_LIB}/hive_service.jar
-  if [ "$HIVE_PORT" != "" ]; then
-    HIVE_OPTS=$HIVE_PORT
+
+  version=$($HADOOP version | awk '{if (NR == 1) {print $2;}}');
+
+  # Save the regex to a var to workaround quoting incompatabilities
+  # between Bash 3.1 and 3.2
+  version_re="^([[:digit:]]+)\.([[:digit:]]+)(\.([[:digit:]]+))?.*$"
+
+  if [[ "$version" =~ $version_re ]]; then
+      major_ver=${BASH_REMATCH[1]}
+      minor_ver=${BASH_REMATCH[2]}
+      patch_ver=${BASH_REMATCH[4]}
+  else
+      echo "Unable to determine Hadoop version information."
+      echo "'hadoop version' returned:"
+      echo `$HADOOP version`
+      exit 6
+  fi
+
+  if [ $minor_ver -lt 20 ]; then
+    exec $HADOOP jar $AUX_JARS_CMD_LINE $JAR $CLASS $HIVE_PORT "$@"
+  else 
+    # hadoop 20 or newer - skip the aux_jars option and hiveconf
+    exec $HADOOP jar $JAR $CLASS $HIVE_PORT "$@"
   fi
-  exec $HADOOP jar $AUX_JARS_CMD_LINE $JAR $CLASS $HIVE_OPTS "$@"
 }
 
 hiveserver_help() {
