diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/Bug.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/Bug.java
index cedc6c8f84..9bf7f959f9 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/Bug.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/Bug.java
@@ -41,4 +41,10 @@ public final class Bug {
    * CALCITE-4166</a> is fixed.
    */
   public static final boolean CALCITE_4166_FIXED = false;
+
+  /**
+   * Whether <a href="https://issues.apache.org/jira/browse/CALCITE-4499">issue
+   * CALCITE-4499</a> is fixed.
+   */
+  public static final boolean CALCITE_4499_FIXED = false;
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/HiveSubQRemoveRelBuilder.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/HiveSubQRemoveRelBuilder.java
deleted file mode 100644
index f52ab608cb..0000000000
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/HiveSubQRemoveRelBuilder.java
+++ /dev/null
@@ -1,1693 +0,0 @@
-/*
- * Licensed to the Apache Software Foundation (ASF) under one
- * or more contributor license agreements.  See the NOTICE file
- * distributed with this work for additional information
- * regarding copyright ownership.  The ASF licenses this file
- * to you under the Apache License, Version 2.0 (the
- * "License"); you may not use this file except in compliance
- * with the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.apache.hadoop.hive.ql.optimizer.calcite;
-
-import org.apache.calcite.linq4j.Ord;
-import org.apache.calcite.plan.Context;
-import org.apache.calcite.plan.Contexts;
-import org.apache.calcite.plan.RelOptCluster;
-import org.apache.calcite.plan.RelOptSchema;
-import org.apache.calcite.plan.RelOptTable;
-import org.apache.calcite.plan.RelOptUtil;
-import org.apache.calcite.rel.RelCollation;
-import org.apache.calcite.rel.RelCollations;
-import org.apache.calcite.rel.RelFieldCollation;
-import org.apache.calcite.rel.RelNode;
-import org.apache.calcite.rel.core.Aggregate;
-import org.apache.calcite.rel.core.AggregateCall;
-import org.apache.calcite.rel.core.CorrelationId;
-import org.apache.calcite.rel.core.JoinRelType;
-import org.apache.calcite.rel.core.Project;
-import org.apache.calcite.rel.core.RelFactories;
-import org.apache.calcite.rel.core.Sort;
-import org.apache.calcite.rel.core.TableScan;
-import org.apache.calcite.rel.core.Values;
-import org.apache.calcite.rel.type.RelDataType;
-import org.apache.calcite.rel.type.RelDataTypeFactory;
-import org.apache.calcite.rel.type.RelDataTypeField;
-import org.apache.calcite.rex.RexBuilder;
-import org.apache.calcite.rex.RexCall;
-import org.apache.calcite.rex.RexCorrelVariable;
-import org.apache.calcite.rex.RexInputRef;
-import org.apache.calcite.rex.RexLiteral;
-import org.apache.calcite.rex.RexNode;
-import org.apache.calcite.rex.RexUtil;
-import org.apache.calcite.rex.RexShuttle;
-import org.apache.calcite.schema.SchemaPlus;
-import org.apache.calcite.server.CalciteServerStatement;
-import org.apache.calcite.sql.SqlAggFunction;
-import org.apache.calcite.sql.SqlKind;
-import org.apache.calcite.sql.SqlOperator;
-import org.apache.calcite.sql.fun.SqlStdOperatorTable;
-import org.apache.calcite.sql.type.SqlTypeName;
-import org.apache.calcite.sql.validate.SqlValidatorUtil;
-import org.apache.calcite.tools.RelBuilder;
-import org.apache.calcite.tools.FrameworkConfig;
-import org.apache.calcite.tools.Frameworks;
-import org.apache.calcite.util.CompositeList;
-import org.apache.calcite.util.Holder;
-import org.apache.calcite.util.ImmutableBitSet;
-import org.apache.calcite.util.ImmutableIntList;
-import org.apache.calcite.util.Litmus;
-import org.apache.calcite.util.NlsString;
-import org.apache.calcite.util.Pair;
-import org.apache.calcite.util.Static;
-import org.apache.calcite.util.Util;
-import org.apache.calcite.util.mapping.Mapping;
-import org.apache.calcite.util.mapping.Mappings;
-
-import com.google.common.base.Function;
-import com.google.common.base.Joiner;
-import com.google.common.base.Preconditions;
-import com.google.common.collect.ImmutableList;
-import com.google.common.collect.ImmutableSet;
-import com.google.common.collect.Iterables;
-import com.google.common.collect.Lists;
-
-import java.math.BigDecimal;
-import java.util.AbstractList;
-import java.util.ArrayDeque;
-import java.util.ArrayList;
-import java.util.Deque;
-import java.util.Iterator;
-import java.util.LinkedList;
-import java.util.List;
-import java.util.Objects;
-import java.util.Set;
-import java.util.SortedSet;
-import java.util.TreeSet;
-
-/**
- * Builder for relational expressions.
- * TODO:
- *  Note that this is copied from Calcite's RelBulder
- *  because CALCITE-1493 hasn't been fixed yet
- *  This should be deleted and replaced with RelBuilder in SubqueryRemoveRule
- *  once CALCITE-1493 is fixed.
- *  EDIT: Although CALCITE-1493 has been fixed and released but HIVE now has special handling
- *    in join (it gets a flag to see if semi join is to be created or not). So we still can not
- *    replace this with Calcite's RelBuilder
- *
- * <p>{@code RelBuilder} does not make possible anything that you could not
- * also accomplish by calling the factory methods of the particular relational
- * expression. But it makes common tasks more straightforward and concise.
- *
- * <p>{@code RelBuilder} uses factories to create relational expressions.
- * By default, it uses the default factories, which create logical relational
- * expressions ({@link org.apache.calcite.rel.logical.LogicalFilter},
- * {@link org.apache.calcite.rel.logical.LogicalProject} and so forth).
- * But you could override those factories so that, say, {@code filter} creates
- * instead a {@code HiveFilter}.
- *
- * <p>It is not thread-safe.
- */
-public class HiveSubQRemoveRelBuilder {
-  private static final Function<RexNode, String> FN_TYPE =
-      new Function<RexNode, String>() {
-        public String apply(RexNode input) {
-          return input + ": " + input.getType();
-        }
-      };
-
-  private final RelOptCluster cluster;
-  private final RelOptSchema relOptSchema;
-  private final RelFactories.FilterFactory filterFactory;
-  private final RelFactories.ProjectFactory projectFactory;
-  private final RelFactories.AggregateFactory aggregateFactory;
-  private final RelFactories.SortFactory sortFactory;
-  private final RelFactories.SetOpFactory setOpFactory;
-  private final RelFactories.JoinFactory joinFactory;
-  private final RelFactories.SemiJoinFactory semiJoinFactory;
-  private final RelFactories.CorrelateFactory correlateFactory;
-  private final RelFactories.ValuesFactory valuesFactory;
-  private final RelFactories.TableScanFactory scanFactory;
-  private final Deque<Frame> stack = new ArrayDeque<>();
-
-  public HiveSubQRemoveRelBuilder(Context context, RelOptCluster cluster,
-                                  RelOptSchema relOptSchema) {
-    this.cluster = cluster;
-    this.relOptSchema = relOptSchema;
-    if (context == null) {
-      context = Contexts.EMPTY_CONTEXT;
-    }
-    this.aggregateFactory =
-        Util.first(context.unwrap(RelFactories.AggregateFactory.class),
-            HiveRelFactories.HIVE_AGGREGATE_FACTORY);
-    this.filterFactory =
-        Util.first(context.unwrap(RelFactories.FilterFactory.class),
-            HiveRelFactories.HIVE_FILTER_FACTORY);
-    this.projectFactory =
-        Util.first(context.unwrap(RelFactories.ProjectFactory.class),
-            HiveRelFactories.HIVE_PROJECT_FACTORY);
-    this.sortFactory =
-        Util.first(context.unwrap(RelFactories.SortFactory.class),
-            HiveRelFactories.HIVE_SORT_FACTORY);
-    this.setOpFactory =
-        Util.first(context.unwrap(RelFactories.SetOpFactory.class),
-            HiveRelFactories.HIVE_SET_OP_FACTORY);
-    this.joinFactory =
-        Util.first(context.unwrap(RelFactories.JoinFactory.class),
-            HiveRelFactories.HIVE_JOIN_FACTORY);
-    this.semiJoinFactory =
-        Util.first(context.unwrap(RelFactories.SemiJoinFactory.class),
-            HiveRelFactories.HIVE_SEMI_JOIN_FACTORY);
-    this.correlateFactory =
-        Util.first(context.unwrap(RelFactories.CorrelateFactory.class),
-            RelFactories.DEFAULT_CORRELATE_FACTORY);
-    this.valuesFactory =
-        Util.first(context.unwrap(RelFactories.ValuesFactory.class),
-            RelFactories.DEFAULT_VALUES_FACTORY);
-    this.scanFactory =
-        Util.first(context.unwrap(RelFactories.TableScanFactory.class),
-            RelFactories.DEFAULT_TABLE_SCAN_FACTORY);
-  }
-
-  /** Creates a RelBuilder. */
-  public static HiveSubQRemoveRelBuilder create(FrameworkConfig config) {
-    final RelOptCluster[] clusters = {null};
-    final RelOptSchema[] relOptSchemas = {null};
-    Frameworks.withPrepare(
-        new Frameworks.PrepareAction<Void>(config) {
-          public Void apply(RelOptCluster cluster, RelOptSchema relOptSchema,
-                            SchemaPlus rootSchema, CalciteServerStatement statement) {
-            clusters[0] = cluster;
-            relOptSchemas[0] = relOptSchema;
-            return null;
-          }
-        });
-    return new HiveSubQRemoveRelBuilder(config.getContext(), clusters[0], relOptSchemas[0]);
-  }
-
-  /** Returns the type factory. */
-  public RelDataTypeFactory getTypeFactory() {
-    return cluster.getTypeFactory();
-  }
-
-  /** Returns the builder for {@link RexNode} expressions. */
-  public RexBuilder getRexBuilder() {
-    return cluster.getRexBuilder();
-  }
-
-  /** Adds a relational expression to be the input to the next relational
-   * expression constructed.
-   *
-   * <p>This method is usual when you want to weave in relational expressions
-   * that are not supported by the builder. If, while creating such expressions,
-   * you need to use previously built expressions as inputs, call
-   * {@link #build()} to pop those inputs. */
-  public HiveSubQRemoveRelBuilder push(RelNode node) {
-    stack.push(new Frame(node));
-    return this;
-  }
-
-  /** Pushes a collection of relational expressions. */
-  public HiveSubQRemoveRelBuilder pushAll(Iterable<? extends RelNode> nodes) {
-    for (RelNode node : nodes) {
-      push(node);
-    }
-    return this;
-  }
-
-  /** Returns the final relational expression.
-   *
-   * <p>Throws if the stack is empty.
-   */
-  public RelNode build() {
-    return stack.pop().rel;
-  }
-
-  /** Returns the relational expression at the top of the stack, but does not
-   * remove it. */
-  public RelNode peek() {
-    return peek_().rel;
-  }
-
-  private Frame peek_() {
-    return stack.peek();
-  }
-
-  /** Returns the relational expression {@code n} positions from the top of the
-   * stack, but does not remove it. */
-  public RelNode peek(int n) {
-    return peek_(n).rel;
-  }
-
-  private Frame peek_(int n) {
-    return Iterables.get(stack, n);
-  }
-
-  /** Returns the relational expression {@code n} positions from the top of the
-   * stack, but does not remove it. */
-  public RelNode peek(int inputCount, int inputOrdinal) {
-    return peek_(inputCount, inputOrdinal).rel;
-  }
-
-  private Frame peek_(int inputCount, int inputOrdinal) {
-    return peek_(inputCount - 1 - inputOrdinal);
-  }
-
-  /** Returns the number of fields in all inputs before (to the left of)
-   * the given input.
-   *
-   * @param inputCount Number of inputs
-   * @param inputOrdinal Input ordinal
-   */
-  private int inputOffset(int inputCount, int inputOrdinal) {
-    int offset = 0;
-    for (int i = 0; i < inputOrdinal; i++) {
-      offset += peek(inputCount, i).getRowType().getFieldCount();
-    }
-    return offset;
-  }
-
-  // Methods that return scalar expressions
-
-  /** Creates a literal (constant expression). */
-  public RexNode literal(Object value) {
-    final RexBuilder rexBuilder = cluster.getRexBuilder();
-    if (value == null) {
-      return rexBuilder.constantNull();
-    } else if (value instanceof Boolean) {
-      return rexBuilder.makeLiteral((Boolean) value);
-    } else if (value instanceof BigDecimal) {
-      return rexBuilder.makeExactLiteral((BigDecimal) value);
-    } else if (value instanceof Float || value instanceof Double) {
-      return rexBuilder.makeApproxLiteral(
-          BigDecimal.valueOf(((Number) value).doubleValue()));
-    } else if (value instanceof Number) {
-      return rexBuilder.makeExactLiteral(
-          BigDecimal.valueOf(((Number) value).longValue()));
-    } else if (value instanceof String) {
-      return rexBuilder.makeLiteral((String) value);
-    } else {
-      throw new IllegalArgumentException("cannot convert " + value
-          + " (" + value.getClass() + ") to a constant");
-    }
-  }
-
-  /** Creates a reference to a field by name.
-   *
-   * <p>Equivalent to {@code field(1, 0, fieldName)}.
-   *
-   * @param fieldName Field name
-   */
-  public RexInputRef field(String fieldName) {
-    return field(1, 0, fieldName);
-  }
-
-  /** Creates a reference to a field of given input relational expression
-   * by name.
-   *
-   * @param inputCount Number of inputs
-   * @param inputOrdinal Input ordinal
-   * @param fieldName Field name
-   */
-  public RexInputRef field(int inputCount, int inputOrdinal, String fieldName) {
-    final Frame frame = peek_(inputCount, inputOrdinal);
-    final List<String> fieldNames = Pair.left(frame.fields());
-    int i = fieldNames.indexOf(fieldName);
-    if (i >= 0) {
-      return field(inputCount, inputOrdinal, i);
-    } else {
-      throw new IllegalArgumentException("field [" + fieldName
-          + "] not found; input fields are: " + fieldNames);
-    }
-  }
-
-  /** Creates a reference to an input field by ordinal.
-   *
-   * <p>Equivalent to {@code field(1, 0, ordinal)}.
-   *
-   * @param fieldOrdinal Field ordinal
-   */
-  public RexInputRef field(int fieldOrdinal) {
-    return (RexInputRef) field(1, 0, fieldOrdinal, false);
-  }
-
-  /** Creates a reference to a field of a given input relational expression
-   * by ordinal.
-   *
-   * @param inputCount Number of inputs
-   * @param inputOrdinal Input ordinal
-   * @param fieldOrdinal Field ordinal within input
-   */
-  public RexInputRef field(int inputCount, int inputOrdinal, int fieldOrdinal) {
-    return (RexInputRef) field(inputCount, inputOrdinal, fieldOrdinal, false);
-  }
-
-  /** As {@link #field(int, int, int)}, but if {@code alias} is true, the method
-   * may apply an alias to make sure that the field has the same name as in the
-   * input frame. If no alias is applied the expression is definitely a
-   * {@link RexInputRef}. */
-  private RexNode field(int inputCount, int inputOrdinal, int fieldOrdinal,
-                        boolean alias) {
-    final Frame frame = peek_(inputCount, inputOrdinal);
-    final RelNode input = frame.rel;
-    final RelDataType rowType = input.getRowType();
-    if (fieldOrdinal < 0 || fieldOrdinal > rowType.getFieldCount()) {
-      throw new IllegalArgumentException("field ordinal [" + fieldOrdinal
-          + "] out of range; input fields are: " + rowType.getFieldNames());
-    }
-    final RelDataTypeField field = rowType.getFieldList().get(fieldOrdinal);
-    final int offset = inputOffset(inputCount, inputOrdinal);
-    final RexInputRef ref = cluster.getRexBuilder()
-        .makeInputRef(field.getType(), offset + fieldOrdinal);
-    final RelDataTypeField aliasField = frame.fields().get(fieldOrdinal);
-    if (!alias || field.getName().equals(aliasField.getName())) {
-      return ref;
-    } else {
-      return alias(ref, aliasField.getName());
-    }
-  }
-
-  /** Creates a reference to a field of the current record which originated
-   * in a relation with a given alias. */
-  public RexNode field(String alias, String fieldName) {
-    Preconditions.checkNotNull(alias);
-    Preconditions.checkNotNull(fieldName);
-    final Frame frame = stack.peek();
-    final List<String> aliases = new ArrayList<>();
-    int offset = 0;
-    for (Pair<String, RelDataType> pair : frame.right) {
-      if (pair.left != null && pair.left.equals(alias)) {
-        int i = pair.right.getFieldNames().indexOf(fieldName);
-        if (i >= 0) {
-          return field(offset + i);
-        } else {
-          throw new IllegalArgumentException("no field '" + fieldName
-              + "' in relation '" + alias
-              + "'; fields are: " + pair.right.getFieldNames());
-        }
-      }
-      aliases.add(pair.left);
-      offset += pair.right.getFieldCount();
-    }
-    throw new IllegalArgumentException("no relation wtih alias '" + alias
-        + "'; aliases are: " + aliases);
-  }
-
-  /** Returns references to the fields of the top input. */
-  public ImmutableList<RexNode> fields() {
-    return fields(1, 0);
-  }
-
-  /** Returns references to the fields of a given input. */
-  public ImmutableList<RexNode> fields(int inputCount, int inputOrdinal) {
-    final RelNode input = peek(inputCount, inputOrdinal);
-    final RelDataType rowType = input.getRowType();
-    final ImmutableList.Builder<RexNode> nodes = ImmutableList.builder();
-    for (int fieldOrdinal : Util.range(rowType.getFieldCount())) {
-      nodes.add(field(inputCount, inputOrdinal, fieldOrdinal));
-    }
-    return nodes.build();
-  }
-
-  /** Returns references to fields for a given collation. */
-  public ImmutableList<RexNode> fields(RelCollation collation) {
-    final ImmutableList.Builder<RexNode> nodes = ImmutableList.builder();
-    for (RelFieldCollation fieldCollation : collation.getFieldCollations()) {
-      RexNode node = field(fieldCollation.getFieldIndex());
-      switch (fieldCollation.direction) {
-      case DESCENDING:
-        node = desc(node);
-      }
-      switch (fieldCollation.nullDirection) {
-      case FIRST:
-        node = nullsFirst(node);
-        break;
-      case LAST:
-        node = nullsLast(node);
-        break;
-      }
-      nodes.add(node);
-    }
-    return nodes.build();
-  }
-
-  /** Returns references to fields for a given list of input ordinals. */
-  public ImmutableList<RexNode> fields(List<? extends Number> ordinals) {
-    final ImmutableList.Builder<RexNode> nodes = ImmutableList.builder();
-    for (Number ordinal : ordinals) {
-      RexNode node = field(1, 0, ordinal.intValue(), true);
-      nodes.add(node);
-    }
-    return nodes.build();
-  }
-
-  /** Returns references to fields identified by name. */
-  public ImmutableList<RexNode> fields(Iterable<String> fieldNames) {
-    final ImmutableList.Builder<RexNode> builder = ImmutableList.builder();
-    for (String fieldName : fieldNames) {
-      builder.add(field(fieldName));
-    }
-    return builder.build();
-  }
-
-  /** Returns references to fields identified by a mapping. */
-  public ImmutableList<RexNode> fields(Mappings.TargetMapping mapping) {
-    return fields(Mappings.asList(mapping));
-  }
-
-  /** Creates an access to a field by name. */
-  public RexNode dot(RexNode node, String fieldName) {
-    final RexBuilder builder = cluster.getRexBuilder();
-    return builder.makeFieldAccess(node, fieldName, true);
-  }
-
-  /** Creates an access to a field by ordinal. */
-  public RexNode dot(RexNode node, int fieldOrdinal) {
-    final RexBuilder builder = cluster.getRexBuilder();
-    return builder.makeFieldAccess(node, fieldOrdinal);
-  }
-
-  /** Creates a call to a scalar operator. */
-  public RexNode call(SqlOperator operator, RexNode... operands) {
-    final RexBuilder builder = cluster.getRexBuilder();
-    final List<RexNode> operandList = ImmutableList.copyOf(operands);
-    final RelDataType type = builder.deriveReturnType(operator, operandList);
-    if (type == null) {
-      throw new IllegalArgumentException("cannot derive type: " + operator
-          + "; operands: " + Lists.transform(operandList, FN_TYPE));
-    }
-    return builder.makeCall(type, operator, operandList);
-  }
-
-  /** Creates a call to a scalar operator. */
-  public RexNode call(SqlOperator operator,
-                      Iterable<? extends RexNode> operands) {
-    return cluster.getRexBuilder().makeCall(operator,
-        ImmutableList.copyOf(operands));
-  }
-
-  /** Creates an AND. */
-  public RexNode and(RexNode... operands) {
-    return and(ImmutableList.copyOf(operands));
-  }
-
-  /** Creates an AND.
-   *
-   * <p>Simplifies the expression a little:
-   * {@code e AND TRUE} becomes {@code e};
-   * {@code e AND e2 AND NOT e} becomes {@code e2}. */
-  public RexNode and(Iterable<? extends RexNode> operands) {
-    return RexUtil.composeConjunction(cluster.getRexBuilder(), operands);
-  }
-
-  /** Creates an OR. */
-  public RexNode or(RexNode... operands) {
-    return or(ImmutableList.copyOf(operands));
-  }
-
-  /** Creates an OR. */
-  public RexNode or(Iterable<? extends RexNode> operands) {
-    return RexUtil.composeDisjunction(cluster.getRexBuilder(), operands, false);
-  }
-
-  /** Creates a NOT. */
-  public RexNode not(RexNode operand) {
-    return call(SqlStdOperatorTable.NOT, operand);
-  }
-
-  /** Creates an =. */
-  public RexNode equals(RexNode operand0, RexNode operand1) {
-    return call(SqlStdOperatorTable.EQUALS, operand0, operand1);
-  }
-
-  /** Creates a IS NULL. */
-  public RexNode isNull(RexNode operand) {
-    return call(SqlStdOperatorTable.IS_NULL, operand);
-  }
-
-  /** Creates a IS NOT NULL. */
-  public RexNode isNotNull(RexNode operand) {
-    return call(SqlStdOperatorTable.IS_NOT_NULL, operand);
-  }
-
-  /** Creates an expression that casts an expression to a given type. */
-  public RexNode cast(RexNode expr, SqlTypeName typeName) {
-    final RelDataType type = cluster.getTypeFactory().createSqlType(typeName);
-    return cluster.getRexBuilder().makeCast(type, expr);
-  }
-
-  /** Creates an expression that casts an expression to a type with a given name
-   * and precision or length. */
-  public RexNode cast(RexNode expr, SqlTypeName typeName, int precision) {
-    final RelDataType type =
-        cluster.getTypeFactory().createSqlType(typeName, precision);
-    return cluster.getRexBuilder().makeCast(type, expr);
-  }
-
-  /** Creates an expression that casts an expression to a type with a given
-   * name, precision and scale. */
-  public RexNode cast(RexNode expr, SqlTypeName typeName, int precision,
-                      int scale) {
-    final RelDataType type =
-        cluster.getTypeFactory().createSqlType(typeName, precision, scale);
-    return cluster.getRexBuilder().makeCast(type, expr);
-  }
-
-  /**
-   * Returns an expression wrapped in an alias.
-   *
-   * @see #project
-   */
-  public RexNode alias(RexNode expr, String alias) {
-    return call(SqlStdOperatorTable.AS, expr, literal(alias));
-  }
-
-  /** Converts a sort expression to descending. */
-  public RexNode desc(RexNode node) {
-    return call(SqlStdOperatorTable.DESC, node);
-  }
-
-  /** Converts a sort expression to nulls last. */
-  public RexNode nullsLast(RexNode node) {
-    return call(SqlStdOperatorTable.NULLS_LAST, node);
-  }
-
-  /** Converts a sort expression to nulls first. */
-  public RexNode nullsFirst(RexNode node) {
-    return call(SqlStdOperatorTable.NULLS_FIRST, node);
-  }
-
-  // Methods that create group keys and aggregate calls
-
-  /** Creates an empty group key. */
-  public GroupKey groupKey() {
-    return groupKey(ImmutableList.<RexNode>of());
-  }
-
-  /** Creates a group key. */
-  public GroupKey groupKey(RexNode... nodes) {
-    return groupKey(ImmutableList.copyOf(nodes));
-  }
-
-  /** Creates a group key. */
-  public GroupKey groupKey(Iterable<? extends RexNode> nodes) {
-    return new GroupKeyImpl(ImmutableList.copyOf(nodes), false, null, null);
-  }
-
-  /** Creates a group key with grouping sets. */
-  public GroupKey groupKey(Iterable<? extends RexNode> nodes, boolean indicator,
-                           Iterable<? extends Iterable<? extends RexNode>> nodeLists) {
-    final ImmutableList.Builder<ImmutableList<RexNode>> builder =
-        ImmutableList.builder();
-    for (Iterable<? extends RexNode> nodeList : nodeLists) {
-      builder.add(ImmutableList.copyOf(nodeList));
-    }
-    return new GroupKeyImpl(ImmutableList.copyOf(nodes), indicator, builder.build(), null);
-  }
-
-  /** Creates a group key of fields identified by ordinal. */
-  public GroupKey groupKey(int... fieldOrdinals) {
-    return groupKey(fields(ImmutableIntList.of(fieldOrdinals)));
-  }
-
-  /** Creates a group key of fields identified by name. */
-  public GroupKey groupKey(String... fieldNames) {
-    return groupKey(fields(ImmutableList.copyOf(fieldNames)));
-  }
-
-  /** Creates a group key with grouping sets, both identified by field positions
-   * in the underlying relational expression.
-   *
-   * <p>This method of creating a group key does not allow you to group on new
-   * expressions, only column projections, but is efficient, especially when you
-   * are coming from an existing {@link Aggregate}. */
-  public GroupKey groupKey(ImmutableBitSet groupSet, boolean indicator,
-                           ImmutableList<ImmutableBitSet> groupSets) {
-    if (groupSet.length() > peek().getRowType().getFieldCount()) {
-      throw new IllegalArgumentException("out of bounds: " + groupSet);
-    }
-    if (groupSets == null) {
-      groupSets = ImmutableList.of(groupSet);
-    }
-    final ImmutableList<RexNode> nodes =
-        fields(ImmutableIntList.of(groupSet.toArray()));
-    final List<ImmutableList<RexNode>> nodeLists =
-        Lists.transform(groupSets,
-            new Function<ImmutableBitSet, ImmutableList<RexNode>>() {
-              public ImmutableList<RexNode> apply(ImmutableBitSet input) {
-                return fields(ImmutableIntList.of(input.toArray()));
-              }
-            });
-    return groupKey(nodes, indicator, nodeLists);
-  }
-
-  /** Creates a call to an aggregate function. */
-  public AggCall aggregateCall(SqlAggFunction aggFunction, boolean distinct,
-                               RexNode filter, String alias, RexNode... operands) {
-    return aggregateCall(aggFunction, distinct, filter, alias,
-        ImmutableList.copyOf(operands));
-  }
-
-  /** Creates a call to an aggregate function. */
-  public AggCall aggregateCall(SqlAggFunction aggFunction, boolean distinct,
-                               RexNode filter, String alias, Iterable<? extends RexNode> operands) {
-    if (filter != null) {
-      if (filter.getType().getSqlTypeName() != SqlTypeName.BOOLEAN) {
-        throw Static.RESOURCE.filterMustBeBoolean().ex();
-      }
-      if (filter.getType().isNullable()) {
-        filter = call(SqlStdOperatorTable.IS_TRUE, filter);
-      }
-    }
-    return new AggCallImpl(aggFunction, distinct, filter, alias,
-        ImmutableList.copyOf(operands));
-  }
-
-  /** Creates a call to the COUNT aggregate function. */
-  public AggCall count(boolean distinct, String alias, RexNode... operands) {
-    return aggregateCall(SqlStdOperatorTable.COUNT, distinct, null, alias,
-        operands);
-  }
-
-  /** Creates a call to the COUNT(*) aggregate function. */
-  public AggCall countStar(String alias) {
-    return aggregateCall(SqlStdOperatorTable.COUNT, false, null, alias);
-  }
-
-  /** Creates a call to the SUM aggregate function. */
-  public AggCall sum(boolean distinct, String alias, RexNode operand) {
-    return aggregateCall(SqlStdOperatorTable.SUM, distinct, null, alias,
-        operand);
-  }
-
-  /** Creates a call to the AVG aggregate function. */
-  public AggCall avg(boolean distinct, String alias, RexNode operand) {
-    return aggregateCall(
-        SqlStdOperatorTable.AVG, distinct, null, alias, operand);
-  }
-
-  /** Creates a call to the MIN aggregate function. */
-  public AggCall min(String alias, RexNode operand) {
-    return aggregateCall(SqlStdOperatorTable.MIN, false, null, alias, operand);
-  }
-
-  /** Creates a call to the MAX aggregate function. */
-  public AggCall max(String alias, RexNode operand) {
-    return aggregateCall(SqlStdOperatorTable.MAX, false, null, alias, operand);
-  }
-
-  // Methods that create relational expressions
-
-  /** Creates a {@link org.apache.calcite.rel.core.TableScan} of the table
-   * with a given name.
-   *
-   * <p>Throws if the table does not exist.
-   *
-   * <p>Returns this builder.
-   *
-   * @param tableNames Name of table (can optionally be qualified)
-   */
-  public HiveSubQRemoveRelBuilder scan(Iterable<String> tableNames) {
-    final List<String> names = ImmutableList.copyOf(tableNames);
-    final RelOptTable relOptTable = relOptSchema.getTableForMember(names);
-    if (relOptTable == null) {
-      throw Static.RESOURCE.tableNotFound(Joiner.on(".").join(names)).ex();
-    }
-    final RelNode scan = scanFactory.createScan(cluster, relOptTable);
-    push(scan);
-    return this;
-  }
-
-  /** Creates a {@link org.apache.calcite.rel.core.TableScan} of the table
-   * with a given name.
-   *
-   * <p>Throws if the table does not exist.
-   *
-   * <p>Returns this builder.
-   *
-   * @param tableNames Name of table (can optionally be qualified)
-   */
-  public HiveSubQRemoveRelBuilder scan(String... tableNames) {
-    return scan(ImmutableList.copyOf(tableNames));
-  }
-
-  /** Creates a {@link org.apache.calcite.rel.core.Filter} of an array of
-   * predicates.
-   *
-   * <p>The predicates are combined using AND,
-   * and optimized in a similar way to the {@link #and} method.
-   * If the result is TRUE no filter is created. */
-  public HiveSubQRemoveRelBuilder filter(RexNode... predicates) {
-    return filter(ImmutableList.copyOf(predicates));
-  }
-
-  /** Creates a {@link org.apache.calcite.rel.core.Filter} of a list of
-   * predicates.
-   *
-   * <p>The predicates are combined using AND,
-   * and optimized in a similar way to the {@link #and} method.
-   * If the result is TRUE no filter is created. */
-  public HiveSubQRemoveRelBuilder filter(Iterable<? extends RexNode> predicates) {
-    final RexNode x = RexUtil.composeConjunction(cluster.getRexBuilder(), predicates);
-    if (x.isAlwaysFalse()) {
-      return empty();
-    }
-    if (!x.isAlwaysTrue()) {
-      final Frame frame = stack.pop();
-      final RelNode filter = filterFactory.createFilter(frame.rel, x, ImmutableSet.of());
-      stack.push(new Frame(filter, frame.right));
-    }
-    return this;
-  }
-
-
-  /** Creates a {@link org.apache.calcite.rel.core.Project} of the given list
-   * of expressions.
-   *
-   * <p>Infers names as would {@link #project(Iterable, Iterable)} if all
-   * suggested names were null.
-   *
-   * @param nodes Expressions
-   */
-  public HiveSubQRemoveRelBuilder project(Iterable<? extends RexNode> nodes) {
-    return project(nodes, ImmutableList.<String>of());
-  }
-
-  /** Creates a {@link org.apache.calcite.rel.core.Project} of the given list
-   * of expressions and field names.
-   *
-   * <p>Infers names as would {@link #project(Iterable, Iterable)} if all
-   * suggested names were null.
-   *
-   * @param nodes Expressions
-   * @param fieldNames field names for expressions
-   */
-  public HiveSubQRemoveRelBuilder project(Iterable<? extends RexNode> nodes,
-                                          Iterable<String> fieldNames) {
-    return project(nodes, fieldNames, false);
-  }
-
-  /** Creates a {@link org.apache.calcite.rel.core.Project} of the given list
-   * of expressions, using the given names.
-   *
-   * <p>Names are deduced as follows:
-   * <ul>
-   *   <li>If the length of {@code fieldNames} is greater than the index of
-   *     the current entry in {@code nodes}, and the entry in
-   *     {@code fieldNames} is not null, uses it; otherwise
-   *   <li>If an expression projects an input field,
-   *     or is a cast an input field,
-   *     uses the input field name; otherwise
-   *   <li>If an expression is a call to
-   *     {@link org.apache.calcite.sql.fun.SqlStdOperatorTable#AS}
-   *     (see {@link #alias}), removes the call but uses the intended alias.
-   * </ul>
-   *
-   * <p>After the field names have been inferred, makes the
-   * field names unique by appending numeric suffixes.
-   *
-   * @param nodes Expressions
-   * @param fieldNames Suggested field names
-   * @param force create project even if it is identity
-   */
-  public HiveSubQRemoveRelBuilder project(
-      Iterable<? extends RexNode> nodes,
-      Iterable<String> fieldNames,
-      boolean force) {
-    final List<String> names = new ArrayList<>();
-    final List<RexNode> exprList = Lists.newArrayList(nodes);
-    final Iterator<String> nameIterator = fieldNames.iterator();
-    for (RexNode node : nodes) {
-      final String name = nameIterator.hasNext() ? nameIterator.next() : null;
-      final String name2 = inferAlias(exprList, node);
-      names.add(Util.first(name, name2));
-    }
-    final RelDataType inputRowType = peek().getRowType();
-    if (!force && RexUtil.isIdentity(exprList, inputRowType)) {
-      if (names.equals(inputRowType.getFieldNames())) {
-        // Do not create an identity project if it does not rename any fields
-        return this;
-      } else {
-        // create "virtual" row type for project only rename fields
-        final Frame frame = stack.pop();
-        final RelDataType rowType =
-            RexUtil.createStructType(cluster.getTypeFactory(), exprList,
-                names, SqlValidatorUtil.F_SUGGESTER);
-        stack.push(
-            new Frame(frame.rel,
-                ImmutableList.of(Pair.of(frame.right.get(0).left, rowType))));
-        return this;
-      }
-    }
-    final RelNode project =
-        projectFactory.createProject(build(), ImmutableList.copyOf(exprList),
-            names);
-    push(project);
-    return this;
-  }
-
-  /** Creates a {@link org.apache.calcite.rel.core.Project} of the given
-   * expressions. */
-  public HiveSubQRemoveRelBuilder project(RexNode... nodes) {
-    return project(ImmutableList.copyOf(nodes));
-  }
-
-  /** Infers the alias of an expression.
-   *
-   * <p>If the expression was created by {@link #alias}, replaces the expression
-   * in the project list.
-   */
-  private String inferAlias(List<RexNode> exprList, RexNode expr) {
-    switch (expr.getKind()) {
-    case INPUT_REF:
-      final RexInputRef ref = (RexInputRef) expr;
-      return peek(0).getRowType().getFieldNames().get(ref.getIndex());
-    case CAST:
-      return inferAlias(exprList, ((RexCall) expr).getOperands().get(0));
-    case AS:
-      final RexCall call = (RexCall) expr;
-      for (;;) {
-        final int i = exprList.indexOf(expr);
-        if (i < 0) {
-          break;
-        }
-        exprList.set(i, call.getOperands().get(0));
-      }
-      return ((NlsString) ((RexLiteral) call.getOperands().get(1)).getValue())
-          .getValue();
-    default:
-      return null;
-    }
-  }
-
-  /** Creates an {@link org.apache.calcite.rel.core.Aggregate} that makes the
-   * relational expression distinct on all fields. */
-  public HiveSubQRemoveRelBuilder distinct() {
-    return aggregate(groupKey(fields()));
-  }
-
-  /** Creates an {@link org.apache.calcite.rel.core.Aggregate} with an array of
-   * calls. */
-  public HiveSubQRemoveRelBuilder aggregate(GroupKey groupKey, AggCall... aggCalls) {
-    return aggregate(groupKey, ImmutableList.copyOf(aggCalls));
-  }
-
-  /** Creates an {@link org.apache.calcite.rel.core.Aggregate} with a list of
-   * calls. */
-  public HiveSubQRemoveRelBuilder aggregate(GroupKey groupKey, Iterable<AggCall> aggCalls) {
-    final RelDataType inputRowType = peek().getRowType();
-    final List<RexNode> extraNodes = projects(inputRowType);
-    final GroupKeyImpl groupKey_ = (GroupKeyImpl) groupKey;
-    final ImmutableBitSet groupSet =
-        ImmutableBitSet.of(registerExpressions(extraNodes, groupKey_.nodes));
-    final ImmutableList<ImmutableBitSet> groupSets;
-    if (groupKey_.nodeLists != null) {
-      final int sizeBefore = extraNodes.size();
-      final SortedSet<ImmutableBitSet> groupSetSet =
-          new TreeSet<>(ImmutableBitSet.ORDERING);
-      for (ImmutableList<RexNode> nodeList : groupKey_.nodeLists) {
-        final ImmutableBitSet groupSet2 =
-            ImmutableBitSet.of(registerExpressions(extraNodes, nodeList));
-        if (!groupSet.contains(groupSet2)) {
-          throw new IllegalArgumentException("group set element " + nodeList
-              + " must be a subset of group key");
-        }
-        groupSetSet.add(groupSet2);
-      }
-      groupSets = ImmutableList.copyOf(groupSetSet);
-      if (extraNodes.size() > sizeBefore) {
-        throw new IllegalArgumentException(
-            "group sets contained expressions not in group key: "
-                + extraNodes.subList(sizeBefore, extraNodes.size()));
-      }
-    } else {
-      groupSets = ImmutableList.of(groupSet);
-    }
-    for (AggCall aggCall : aggCalls) {
-      if (aggCall instanceof AggCallImpl) {
-        final AggCallImpl aggCall1 = (AggCallImpl) aggCall;
-        registerExpressions(extraNodes, aggCall1.operands);
-        if (aggCall1.filter != null) {
-          registerExpression(extraNodes, aggCall1.filter);
-        }
-      }
-    }
-    if (extraNodes.size() > inputRowType.getFieldCount()) {
-      project(extraNodes);
-    }
-    final RelNode r = build();
-    final List<AggregateCall> aggregateCalls = new ArrayList<>();
-    for (AggCall aggCall : aggCalls) {
-      final AggregateCall aggregateCall;
-      if (aggCall instanceof AggCallImpl) {
-        final AggCallImpl aggCall1 = (AggCallImpl) aggCall;
-        final List<Integer> args = registerExpressions(extraNodes, aggCall1.operands);
-        final int filterArg = aggCall1.filter == null ? -1
-            : registerExpression(extraNodes, aggCall1.filter);
-        aggregateCall =
-            AggregateCall.create(aggCall1.aggFunction, aggCall1.distinct, args,
-                filterArg, groupSet.cardinality(), r, null, aggCall1.alias);
-      } else {
-        aggregateCall = ((AggCallImpl2) aggCall).aggregateCall;
-      }
-      aggregateCalls.add(aggregateCall);
-    }
-
-    assert ImmutableBitSet.ORDERING.isStrictlyOrdered(groupSets) : groupSets;
-    for (ImmutableBitSet set : groupSets) {
-      assert groupSet.contains(set);
-    }
-    RelNode aggregate = aggregateFactory.createAggregate(r,
-        groupKey_.indicator, groupSet, groupSets, aggregateCalls);
-    push(aggregate);
-    return this;
-  }
-
-  private List<RexNode> projects(RelDataType inputRowType) {
-    final List<RexNode> exprList = new ArrayList<>();
-    for (RelDataTypeField field : inputRowType.getFieldList()) {
-      final RexBuilder rexBuilder = cluster.getRexBuilder();
-      exprList.add(rexBuilder.makeInputRef(field.getType(), field.getIndex()));
-    }
-    return exprList;
-  }
-
-  private static int registerExpression(List<RexNode> exprList, RexNode node) {
-    int i = exprList.indexOf(node);
-    if (i < 0) {
-      i = exprList.size();
-      exprList.add(node);
-    }
-    return i;
-  }
-
-  private static List<Integer> registerExpressions(List<RexNode> extraNodes,
-                                                   Iterable<? extends RexNode> nodes) {
-    final List<Integer> builder = new ArrayList<>();
-    for (RexNode node : nodes) {
-      builder.add(registerExpression(extraNodes, node));
-    }
-    return builder;
-  }
-
-  private HiveSubQRemoveRelBuilder setOp(boolean all, SqlKind kind, int n) {
-    List<RelNode> inputs = new LinkedList<>();
-    for (int i = 0; i < n; i++) {
-      inputs.add(0, build());
-    }
-    switch (kind) {
-    case UNION:
-    case INTERSECT:
-    case EXCEPT:
-      if (n < 1) {
-        throw new IllegalArgumentException(
-            "bad INTERSECT/UNION/EXCEPT input count");
-      }
-      break;
-    default:
-      throw new AssertionError("bad setOp " + kind);
-    }
-    switch (n) {
-    case 1:
-      return push(inputs.get(0));
-    default:
-      return push(setOpFactory.createSetOp(kind, inputs, all));
-    }
-  }
-
-  /** Creates a {@link org.apache.calcite.rel.core.Union} of the two most recent
-   * relational expressions on the stack.
-   *
-   * @param all Whether to create UNION ALL
-   */
-  public HiveSubQRemoveRelBuilder union(boolean all) {
-    return union(all, 2);
-  }
-
-  /** Creates a {@link org.apache.calcite.rel.core.Union} of the {@code n}
-   * most recent relational expressions on the stack.
-   *
-   * @param all Whether to create UNION ALL
-   * @param n Number of inputs to the UNION operator
-   */
-  public HiveSubQRemoveRelBuilder union(boolean all, int n) {
-    return setOp(all, SqlKind.UNION, n);
-  }
-
-  /** Creates an {@link org.apache.calcite.rel.core.Intersect} of the two most
-   * recent relational expressions on the stack.
-   *
-   * @param all Whether to create INTERSECT ALL
-   */
-  public HiveSubQRemoveRelBuilder intersect(boolean all) {
-    return intersect(all, 2);
-  }
-
-  /** Creates an {@link org.apache.calcite.rel.core.Intersect} of the {@code n}
-   * most recent relational expressions on the stack.
-   *
-   * @param all Whether to create INTERSECT ALL
-   * @param n Number of inputs to the INTERSECT operator
-   */
-  public HiveSubQRemoveRelBuilder intersect(boolean all, int n) {
-    return setOp(all, SqlKind.INTERSECT, n);
-  }
-
-  /** Creates a {@link org.apache.calcite.rel.core.Minus} of the two most recent
-   * relational expressions on the stack.
-   *
-   * @param all Whether to create EXCEPT ALL
-   */
-  public HiveSubQRemoveRelBuilder minus(boolean all) {
-    return minus(all, 2);
-  }
-
-  /** Creates a {@link org.apache.calcite.rel.core.Minus} of the {@code n}
-   * most recent relational expressions on the stack.
-   *
-   * @param all Whether to create EXCEPT ALL
-   */
-  public HiveSubQRemoveRelBuilder minus(boolean all, int n) {
-    return setOp(all, SqlKind.EXCEPT, n);
-  }
-
-  /** Creates a {@link org.apache.calcite.rel.core.Join}. */
-  public HiveSubQRemoveRelBuilder join(JoinRelType joinType, RexNode condition0,
-                                       RexNode... conditions) {
-    return join(joinType, Lists.asList(condition0, conditions));
-  }
-
-  /** Creates a {@link org.apache.calcite.rel.core.Join} with multiple
-   * conditions. */
-  public HiveSubQRemoveRelBuilder join(JoinRelType joinType,
-                                       Iterable<? extends RexNode> conditions) {
-    return join(joinType, and(conditions),
-        ImmutableSet.<CorrelationId>of());
-  }
-
-  public HiveSubQRemoveRelBuilder join(JoinRelType joinType, RexNode condition) {
-    return join(joinType, condition, ImmutableSet.<CorrelationId>of());
-  }
-
-  /** Creates a correlation variable for the current input, and writes it into
-   * a Holder. */
-  public HiveSubQRemoveRelBuilder variable(Holder<RexCorrelVariable> v) {
-    v.set((RexCorrelVariable)
-        getRexBuilder().makeCorrel(peek().getRowType(),
-            cluster.createCorrel()));
-    return this;
-  }
-
-  /** Returns a reference to a given field of a record-valued expression. */
-  public RexNode field(RexNode e, String name) {
-    return getRexBuilder().makeFieldAccess(e, name, false);
-  }
-
-  public HiveSubQRemoveRelBuilder join(JoinRelType joinType, RexNode condition,
-                                       Set<CorrelationId> variablesSet, JoinRelType semiJoinType) {
-    assert semiJoinType == JoinRelType.SEMI || semiJoinType == JoinRelType.ANTI || semiJoinType == null;
-    Frame right = stack.pop();
-    final Frame left = stack.pop();
-    final RelNode join;
-    final boolean correlate = variablesSet.size() == 1;
-    RexNode postCondition = literal(true);
-    if (correlate) {
-      final CorrelationId id = Iterables.getOnlyElement(variablesSet);
-      final ImmutableBitSet requiredColumns =
-          RelOptUtil.correlationColumns(id, right.rel);
-      if (!RelOptUtil.notContainsCorrelation(left.rel, id, Litmus.IGNORE)) {
-        throw new IllegalArgumentException("variable " + id
-            + " must not be used by left input to correlation");
-      }
-      switch (joinType) {
-      case LEFT:
-        // Correlate does not have an ON clause.
-        // For a LEFT correlate, predicate must be evaluated first.
-        // For INNER, we can defer.
-        stack.push(right);
-        filter(condition.accept(new Shifter(left.rel, id, right.rel)));
-        right = stack.pop();
-        break;
-      default:
-        postCondition = condition;
-      }
-      if(semiJoinType != null) {
-        join = correlateFactory.createCorrelate(left.rel, right.rel, id,
-                requiredColumns, semiJoinType);
-      } else {
-        join = correlateFactory.createCorrelate(left.rel, right.rel, id,
-                requiredColumns, joinType);
-      }
-    } else {
-      join = joinFactory.createJoin(left.rel, right.rel, condition,
-          variablesSet, joinType, false);
-    }
-    final List<Pair<String, RelDataType>> pairs = new ArrayList<>();
-    pairs.addAll(left.right);
-    pairs.addAll(right.right);
-    stack.push(new Frame(join, ImmutableList.copyOf(pairs)));
-    filter(postCondition);
-    return this;
-  }
-
-  /** Creates a {@link org.apache.calcite.rel.core.Join} with correlating
-   * variables. */
-  public HiveSubQRemoveRelBuilder join(JoinRelType joinType, RexNode condition,
-                                       Set<CorrelationId> variablesSet) {
-    return join(joinType, condition, variablesSet, null);
-  }
-
-  /** Creates a {@link org.apache.calcite.rel.core.Join} using USING syntax.
-   *
-   * <p>For each of the field names, both left and right inputs must have a
-   * field of that name. Constructs a join condition that the left and right
-   * fields are equal.
-   *
-   * @param joinType Join type
-   * @param fieldNames Field names
-   */
-  public HiveSubQRemoveRelBuilder join(JoinRelType joinType, String... fieldNames) {
-    final List<RexNode> conditions = new ArrayList<>();
-    for (String fieldName : fieldNames) {
-      conditions.add(
-          call(SqlStdOperatorTable.EQUALS,
-              field(2, 0, fieldName),
-              field(2, 1, fieldName)));
-    }
-    return join(joinType, conditions);
-  }
-
-  /** Creates a {@link org.apache.calcite.rel.core.SemiJoin}. */
-  public HiveSubQRemoveRelBuilder semiJoin(Iterable<? extends RexNode> conditions) {
-    final Frame right = stack.pop();
-    final Frame left = stack.pop();
-    final RelNode semiJoin =
-        semiJoinFactory.createSemiJoin(left.rel, right.rel, and(conditions));
-    stack.push(new Frame(semiJoin, left.right));
-    return this;
-  }
-
-  /** Creates a {@link org.apache.calcite.rel.core.SemiJoin}. */
-  public HiveSubQRemoveRelBuilder semiJoin(RexNode... conditions) {
-    return semiJoin(ImmutableList.copyOf(conditions));
-  }
-
-  /** Assigns a table alias to the top entry on the stack. */
-  public HiveSubQRemoveRelBuilder as(String alias) {
-    final Frame pair = stack.pop();
-    stack.push(
-        new Frame(pair.rel,
-            ImmutableList.of(Pair.of(alias, pair.right.get(0).right))));
-    return this;
-  }
-
-  /** Creates a {@link Values}.
-   *
-   * <p>The {@code values} array must have the same number of entries as
-   * {@code fieldNames}, or an integer multiple if you wish to create multiple
-   * rows.
-   *
-   * <p>If there are zero rows, or if all values of a any column are
-   * null, this method cannot deduce the type of columns. For these cases,
-   * call {@link #values(Iterable, RelDataType)}.
-   *
-   * @param fieldNames Field names
-   * @param values Values
-   */
-  public HiveSubQRemoveRelBuilder values(String[] fieldNames, Object... values) {
-    if (fieldNames == null
-        || fieldNames.length == 0
-        || values.length % fieldNames.length != 0
-        || values.length < fieldNames.length) {
-      throw new IllegalArgumentException(
-          "Value count must be a positive multiple of field count");
-    }
-    final int rowCount = values.length / fieldNames.length;
-    for (Ord<String> fieldName : Ord.zip(fieldNames)) {
-      if (allNull(values, fieldName.i, fieldNames.length)) {
-        throw new IllegalArgumentException("All values of field '" + fieldName.e
-            + "' are null; cannot deduce type");
-      }
-    }
-    final ImmutableList<ImmutableList<RexLiteral>> tupleList =
-        tupleList(fieldNames.length, values);
-    final RelDataTypeFactory.FieldInfoBuilder rowTypeBuilder =
-        cluster.getTypeFactory().builder();
-    for (final Ord<String> fieldName : Ord.zip(fieldNames)) {
-      final String name =
-          fieldName.e != null ? fieldName.e : "expr$" + fieldName.i;
-      final RelDataType type = cluster.getTypeFactory().leastRestrictive(
-          new AbstractList<RelDataType>() {
-            public RelDataType get(int index) {
-              return tupleList.get(index).get(fieldName.i).getType();
-            }
-
-            public int size() {
-              return rowCount;
-            }
-          });
-      rowTypeBuilder.add(name, type);
-    }
-    final RelDataType rowType = rowTypeBuilder.build();
-    return values(tupleList, rowType);
-  }
-
-  private ImmutableList<ImmutableList<RexLiteral>> tupleList(int columnCount,
-                                                             Object[] values) {
-    final ImmutableList.Builder<ImmutableList<RexLiteral>> listBuilder =
-        ImmutableList.builder();
-    final List<RexLiteral> valueList = new ArrayList<>();
-    for (int i = 0; i < values.length; i++) {
-      Object value = values[i];
-      valueList.add((RexLiteral) literal(value));
-      if ((i + 1) % columnCount == 0) {
-        listBuilder.add(ImmutableList.copyOf(valueList));
-        valueList.clear();
-      }
-    }
-    return listBuilder.build();
-  }
-
-  /** Returns whether all values for a given column are null. */
-  private boolean allNull(Object[] values, int column, int columnCount) {
-    for (int i = column; i < values.length; i += columnCount) {
-      if (values[i] != null) {
-        return false;
-      }
-    }
-    return true;
-  }
-
-  /**
-   * Empty relationship can be expressed in many different ways, e.g.,
-   * filter(cond=false), empty LogicalValues(), etc. Calcite default implementation
-   * uses empty LogicalValues(); however, currently there is not an equivalent to
-   * this expression in Hive. Thus, we use limit 0, since Hive already includes
-   * optimizations that will do early pruning of the result tree when it is found,
-   * e.g., GlobalLimitOptimizer.
-   */
-  public HiveSubQRemoveRelBuilder empty() {
-    final RelNode input = build();
-    final RelNode sort = HiveRelFactories.HIVE_SORT_FACTORY.createSort(
-        input, RelCollations.of(), null, literal(0));
-    return this.push(sort);
-  }
-
-
-  /** Creates a {@link Values} with a specified row type.
-   *
-   * <p>This method can handle cases that {@link #values(String[], Object...)}
-   * cannot, such as all values of a column being null, or there being zero
-   * rows.
-   *
-   * @param rowType Row type
-   * @param columnValues Values
-   */
-  public HiveSubQRemoveRelBuilder values(RelDataType rowType, Object... columnValues) {
-    final ImmutableList<ImmutableList<RexLiteral>> tupleList =
-        tupleList(rowType.getFieldCount(), columnValues);
-    RelNode values = valuesFactory.createValues(cluster, rowType,
-        ImmutableList.copyOf(tupleList));
-    push(values);
-    return this;
-  }
-
-  /** Creates a {@link Values} with a specified row type.
-   *
-   * <p>This method can handle cases that {@link #values(String[], Object...)}
-   * cannot, such as all values of a column being null, or there being zero
-   * rows.
-   *
-   * @param tupleList Tuple list
-   * @param rowType Row type
-   */
-  public HiveSubQRemoveRelBuilder values(Iterable<? extends List<RexLiteral>> tupleList,
-                                         RelDataType rowType) {
-    RelNode values =
-        valuesFactory.createValues(cluster, rowType, copy(tupleList));
-    push(values);
-    return this;
-  }
-
-  /** Creates a {@link Values} with a specified row type and
-   * zero rows.
-   *
-   * @param rowType Row type
-   */
-  public HiveSubQRemoveRelBuilder values(RelDataType rowType) {
-    return values(ImmutableList.<ImmutableList<RexLiteral>>of(), rowType);
-  }
-
-  /** Converts an iterable of lists into an immutable list of immutable lists
-   * with the same contents. Returns the same object if possible. */
-  private static <E> ImmutableList<ImmutableList<E>> copy(Iterable<? extends List<E>> tupleList) {
-    final ImmutableList.Builder<ImmutableList<E>> builder =
-        ImmutableList.builder();
-    int changeCount = 0;
-    for (List<E> literals : tupleList) {
-      final ImmutableList<E> literals2 =
-          ImmutableList.copyOf(literals);
-      builder.add(literals2);
-      if (literals != literals2) {
-        ++changeCount;
-      }
-    }
-    if (changeCount == 0) {
-      // don't make a copy if we don't have to
-      //noinspection unchecked
-      return (ImmutableList<ImmutableList<E>>) tupleList;
-    }
-    return builder.build();
-  }
-
-  /** Creates a limit without a sort. */
-  public HiveSubQRemoveRelBuilder limit(int offset, int fetch) {
-    return sortLimit(offset, fetch, ImmutableList.<RexNode>of());
-  }
-
-  /** Creates a {@link Sort} by field ordinals.
-   *
-   * <p>Negative fields mean descending: -1 means field(0) descending,
-   * -2 means field(1) descending, etc.
-   */
-  public HiveSubQRemoveRelBuilder sort(int... fields) {
-    final ImmutableList.Builder<RexNode> builder = ImmutableList.builder();
-    for (int field : fields) {
-      builder.add(field < 0 ? desc(field(-field - 1)) : field(field));
-    }
-    return sortLimit(-1, -1, builder.build());
-  }
-
-  /** Creates a {@link Sort} by expressions. */
-  public HiveSubQRemoveRelBuilder sort(RexNode... nodes) {
-    return sortLimit(-1, -1, ImmutableList.copyOf(nodes));
-  }
-
-  /** Creates a {@link Sort} by expressions. */
-  public HiveSubQRemoveRelBuilder sort(Iterable<? extends RexNode> nodes) {
-    return sortLimit(-1, -1, nodes);
-  }
-
-  /** Creates a {@link Sort} by expressions, with limit and offset. */
-  public HiveSubQRemoveRelBuilder sortLimit(int offset, int fetch, RexNode... nodes) {
-    return sortLimit(offset, fetch, ImmutableList.copyOf(nodes));
-  }
-
-  /** Creates a {@link Sort} by a list of expressions, with limit and offset.
-   *
-   * @param offset Number of rows to skip; non-positive means don't skip any
-   * @param fetch Maximum number of rows to fetch; negative means no limit
-   * @param nodes Sort expressions
-   */
-  public HiveSubQRemoveRelBuilder sortLimit(int offset, int fetch,
-                                            Iterable<? extends RexNode> nodes) {
-    final List<RelFieldCollation> fieldCollations = new ArrayList<>();
-    final RelDataType inputRowType = peek().getRowType();
-    final List<RexNode> extraNodes = projects(inputRowType);
-    final List<RexNode> originalExtraNodes = ImmutableList.copyOf(extraNodes);
-    for (RexNode node : nodes) {
-      fieldCollations.add(
-          collation(node, RelFieldCollation.Direction.ASCENDING, null,
-              extraNodes));
-    }
-    final RexNode offsetNode = offset <= 0 ? null : literal(offset);
-    final RexNode fetchNode = fetch < 0 ? null : literal(fetch);
-    if (offsetNode == null && fetch == 0) {
-      return empty();
-    }
-    if (offsetNode == null && fetchNode == null && fieldCollations.isEmpty()) {
-      return this; // sort is trivial
-    }
-
-    final boolean addedFields = extraNodes.size() > originalExtraNodes.size();
-    if (fieldCollations.isEmpty()) {
-      assert !addedFields;
-      RelNode top = peek();
-      if (top instanceof Sort) {
-        final Sort sort2 = (Sort) top;
-        if (sort2.offset == null && sort2.fetch == null) {
-          stack.pop();
-          push(sort2.getInput());
-          final RelNode sort =
-              sortFactory.createSort(build(), sort2.collation,
-                  offsetNode, fetchNode);
-          push(sort);
-          return this;
-        }
-      }
-      if (top instanceof Project) {
-        final Project project = (Project) top;
-        if (project.getInput() instanceof Sort) {
-          final Sort sort2 = (Sort) project.getInput();
-          if (sort2.offset == null && sort2.fetch == null) {
-            stack.pop();
-            push(sort2.getInput());
-            final RelNode sort =
-                sortFactory.createSort(build(), sort2.collation,
-                    offsetNode, fetchNode);
-            push(sort);
-            project(project.getProjects());
-            return this;
-          }
-        }
-      }
-    }
-    if (addedFields) {
-      project(extraNodes);
-    }
-    final RelNode sort =
-        sortFactory.createSort(build(), RelCollations.of(fieldCollations),
-            offsetNode, fetchNode);
-    push(sort);
-    if (addedFields) {
-      project(originalExtraNodes);
-    }
-    return this;
-  }
-
-  private static RelFieldCollation collation(RexNode node,
-                                             RelFieldCollation.Direction direction,
-                                             RelFieldCollation.NullDirection nullDirection,
-                                             List<RexNode> extraNodes) {
-    switch (node.getKind()) {
-    case INPUT_REF:
-      return new RelFieldCollation(((RexInputRef) node).getIndex(), direction,
-          Util.first(nullDirection, direction.defaultNullDirection()));
-    case DESCENDING:
-      return collation(((RexCall) node).getOperands().get(0),
-          RelFieldCollation.Direction.DESCENDING,
-          nullDirection, extraNodes);
-    case NULLS_FIRST:
-      return collation(((RexCall) node).getOperands().get(0), direction,
-          RelFieldCollation.NullDirection.FIRST, extraNodes);
-    case NULLS_LAST:
-      return collation(((RexCall) node).getOperands().get(0), direction,
-          RelFieldCollation.NullDirection.LAST, extraNodes);
-    default:
-      final int fieldIndex = extraNodes.size();
-      extraNodes.add(node);
-      return new RelFieldCollation(fieldIndex, direction,
-          Util.first(nullDirection, direction.defaultNullDirection()));
-    }
-  }
-
-  /**
-   * Creates a projection that converts the current relational expression's
-   * output to a desired row type.
-   *
-   * @param castRowType row type after cast
-   * @param rename      if true, use field names from castRowType; if false,
-   *                    preserve field names from rel
-   */
-  public HiveSubQRemoveRelBuilder convert(RelDataType castRowType, boolean rename) {
-    final RelNode r = build();
-    final RelNode r2 =
-        RelOptUtil.createCastRel(r, castRowType, rename, projectFactory);
-    push(r2);
-    return this;
-  }
-
-  public HiveSubQRemoveRelBuilder permute(Mapping mapping) {
-    assert mapping.getMappingType().isSingleSource();
-    assert mapping.getMappingType().isMandatorySource();
-    if (mapping.isIdentity()) {
-      return this;
-    }
-    final List<RexNode> exprList = Lists.newArrayList();
-    for (int i = 0; i < mapping.getTargetCount(); i++) {
-      exprList.add(field(mapping.getSource(i)));
-    }
-    return project(exprList);
-  }
-
-  public HiveSubQRemoveRelBuilder aggregate(GroupKey groupKey,
-                                            List<AggregateCall> aggregateCalls) {
-    return aggregate(groupKey,
-        Lists.transform(
-            aggregateCalls, new Function<AggregateCall, AggCall>() {
-              public AggCall apply(AggregateCall input) {
-                return new AggCallImpl2(input);
-              }
-            }));
-  }
-
-  /** Clears the stack.
-   *
-   * <p>The builder's state is now the same as when it was created. */
-  public void clear() {
-    stack.clear();
-  }
-
-  protected String getAlias() {
-    final Frame frame = stack.peek();
-    return frame.right.size() == 1
-        ? frame.right.get(0).left
-        : null;
-  }
-
-  /** Information necessary to create a call to an aggregate function.
-   *
-   * @see RelBuilder#aggregateCall */
-  public interface AggCall {
-  }
-
-  /** Information necessary to create the GROUP BY clause of an Aggregate.
-   *
-   * @see RelBuilder#groupKey */
-  public interface GroupKey {
-    /** Assigns an alias to this group key.
-     *
-     * <p>Used to assign field names in the {@code group} operation. */
-    GroupKey alias(String alias);
-  }
-
-  /** Implementation of {@link RelBuilder.GroupKey}. */
-  protected static class GroupKeyImpl implements GroupKey {
-    private final ImmutableList<RexNode> nodes;
-    private final boolean indicator;
-    private final ImmutableList<ImmutableList<RexNode>> nodeLists;
-    private final String alias;
-
-    GroupKeyImpl(ImmutableList<RexNode> nodes, boolean indicator,
-                 ImmutableList<ImmutableList<RexNode>> nodeLists, String alias) {
-      this.nodes = Preconditions.checkNotNull(nodes);
-      this.indicator = indicator;
-      this.nodeLists = nodeLists;
-      this.alias = alias;
-    }
-
-    @Override public String toString() {
-      return alias == null ? nodes.toString() : nodes + " as " + alias;
-    }
-
-    public GroupKey alias(String alias) {
-      return Objects.equals(this.alias, alias)
-          ? this
-          : new GroupKeyImpl(nodes, indicator, nodeLists, alias);
-    }
-  }
-
-  /** Implementation of {@link RelBuilder.AggCall}. */
-  private static class AggCallImpl implements AggCall {
-    private final SqlAggFunction aggFunction;
-    private final boolean distinct;
-    private final RexNode filter;
-    private final String alias;
-    private final ImmutableList<RexNode> operands;
-
-    AggCallImpl(SqlAggFunction aggFunction, boolean distinct, RexNode filter,
-                String alias, ImmutableList<RexNode> operands) {
-      this.aggFunction = aggFunction;
-      this.distinct = distinct;
-      this.filter = filter;
-      this.alias = alias;
-      this.operands = operands;
-    }
-  }
-
-  /** Implementation of {@link RelBuilder.AggCall} that wraps an
-   * {@link AggregateCall}. */
-  private static class AggCallImpl2 implements AggCall {
-    private final AggregateCall aggregateCall;
-
-    AggCallImpl2(AggregateCall aggregateCall) {
-      this.aggregateCall = Preconditions.checkNotNull(aggregateCall);
-    }
-  }
-
-  /** Builder stack frame.
-   *
-   * <p>Describes a previously created relational expression and
-   * information about how table aliases map into its row type. */
-  private static final class Frame {
-    static final Function<Pair<String, RelDataType>, List<RelDataTypeField>> FN =
-        new Function<Pair<String, RelDataType>, List<RelDataTypeField>>() {
-          public List<RelDataTypeField> apply(Pair<String, RelDataType> input) {
-            return input.right.getFieldList();
-          }
-        };
-
-    private final RelNode rel;
-    private final ImmutableList<Pair<String, RelDataType>> right;
-
-    private Frame(RelNode rel, ImmutableList<Pair<String, RelDataType>> pairs) {
-      this.rel = rel;
-      this.right = pairs;
-    }
-
-    private Frame(RelNode rel) {
-      this(rel, ImmutableList.of(Pair.of(deriveAlias(rel), rel.getRowType())));
-    }
-
-    private static String deriveAlias(RelNode rel) {
-      if (rel instanceof TableScan) {
-        final List<String> names = rel.getTable().getQualifiedName();
-        if (!names.isEmpty()) {
-          return Util.last(names);
-        }
-      }
-      return null;
-    }
-
-    List<RelDataTypeField> fields() {
-      return CompositeList.ofCopy(Iterables.transform(right, FN));
-    }
-  }
-
-  /** Shuttle that shifts a predicate's inputs to the left, replacing early
-   * ones with references to a
-   * {@link org.apache.calcite.rex.RexCorrelVariable}. */
-  private class Shifter extends RexShuttle {
-    private final RelNode left;
-    private final CorrelationId id;
-    private final RelNode right;
-
-    Shifter(RelNode left, CorrelationId id, RelNode right) {
-      this.left = left;
-      this.id = id;
-      this.right = right;
-    }
-
-    public RexNode visitInputRef(RexInputRef inputRef) {
-      final RelDataType leftRowType = left.getRowType();
-      final RexBuilder rexBuilder = getRexBuilder();
-      final int leftCount = leftRowType.getFieldCount();
-      if (inputRef.getIndex() < leftCount) {
-        final RexNode v = rexBuilder.makeCorrel(leftRowType, id);
-        return rexBuilder.makeFieldAccess(v, inputRef.getIndex());
-      } else {
-        return rexBuilder.makeInputRef(right, inputRef.getIndex() - leftCount);
-      }
-    }
-  }
-}
-
-// End RelBuilder.java
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/reloperators/HiveSemiJoin.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/reloperators/HiveSemiJoin.java
index 1bdfea3e3d..c7b0e810a3 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/reloperators/HiveSemiJoin.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/reloperators/HiveSemiJoin.java
@@ -29,7 +29,6 @@
 import org.apache.calcite.rel.core.JoinRelType;
 import org.apache.calcite.rel.type.RelDataTypeField;
 import org.apache.calcite.rex.RexNode;
-import org.apache.calcite.util.ImmutableIntList;
 import org.apache.hadoop.hive.ql.optimizer.calcite.CalciteSemanticException;
 import org.apache.hadoop.hive.ql.optimizer.calcite.HiveRelOptUtil;
 import org.apache.hadoop.hive.ql.optimizer.calcite.rules.HiveRulesRegistry;
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveFilterJoinRule.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveFilterJoinRule.java
index 8f2deb5077..345579217a 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveFilterJoinRule.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveFilterJoinRule.java
@@ -17,6 +17,9 @@
  */
 package org.apache.hadoop.hive.ql.optimizer.calcite.rules;
 
+import com.google.common.collect.ImmutableList;
+import com.google.common.collect.Sets;
+import java.util.ArrayList;
 import java.util.BitSet;
 import java.util.List;
 
@@ -25,17 +28,29 @@
 import org.apache.calcite.plan.RelOptRuleOperand;
 import org.apache.calcite.plan.RelOptUtil;
 import org.apache.calcite.plan.RelOptUtil.InputFinder;
+import org.apache.calcite.plan.RelOptUtil.RexInputConverter;
+import org.apache.calcite.rel.RelNode;
 import org.apache.calcite.rel.core.Filter;
 import org.apache.calcite.rel.core.Join;
+import org.apache.calcite.rel.core.JoinRelType;
 import org.apache.calcite.rel.rules.FilterJoinRule;
+import org.apache.calcite.rel.type.RelDataType;
+import org.apache.calcite.rel.type.RelDataTypeField;
+import org.apache.calcite.rex.RexBuilder;
+import org.apache.calcite.rex.RexCall;
 import org.apache.calcite.rex.RexNode;
+import org.apache.calcite.rex.RexUtil;
+import org.apache.calcite.tools.RelBuilder;
 import org.apache.calcite.tools.RelBuilderFactory;
 import org.apache.calcite.util.ImmutableBitSet;
+import org.apache.hadoop.hive.ql.optimizer.calcite.Bug;
 import org.apache.hadoop.hive.ql.optimizer.calcite.HiveCalciteUtil;
 import org.apache.hadoop.hive.ql.optimizer.calcite.HiveRelFactories;
 import org.apache.hadoop.hive.ql.optimizer.calcite.HiveRelOptUtil;
 import org.apache.hadoop.hive.ql.optimizer.calcite.HiveRelOptUtil.RewritablePKFKJoinInfo;
 
+import static org.apache.calcite.plan.RelOptUtil.conjunctions;
+
 public abstract class HiveFilterJoinRule extends FilterJoinRule {
 
   public static final HiveFilterJoinRule FILTER_ON_NON_FILTERING_JOIN =
@@ -129,22 +144,327 @@ public void onMatch(RelOptRuleCall call) {
     }
   }
 
-  private boolean filterRefersToBothSidesOfJoin(RexNode filter, Join j) {
-    boolean refersToBothSides = false;
 
-    int joinNoOfProjects = j.getRowType().getFieldCount();
-    ImmutableBitSet filterProjs = ImmutableBitSet.FROM_BIT_SET.apply(new BitSet(joinNoOfProjects));
-    ImmutableBitSet allLeftProjs = filterProjs.union(ImmutableBitSet.range(0, j.getInput(0)
-        .getRowType().getFieldCount()));
-    ImmutableBitSet allRightProjs = filterProjs.union(ImmutableBitSet.range(j.getInput(0)
-        .getRowType().getFieldCount(), joinNoOfProjects));
+  /**
+   * Perform is duplicated from parent class to be able to call the modified
+   * classify filters. The modified classify method can push filter conditions
+   * that refer only to the SJ right input to the corresponding input (the
+   * fix is in the number of fields for the join, which is inferred from the
+   * join in the original method rather than the concatenation of the join
+   * inputs).
+   * TODO: Remove this method once {@link RelOptUtil#classifyFilters} is fixed.
+   */
+  protected void perform(RelOptRuleCall call, Filter filter, Join join) {
+    final List<RexNode> joinFilters =
+        RelOptUtil.conjunctions(join.getCondition());
+    final List<RexNode> origJoinFilters = ImmutableList.copyOf(joinFilters);
+
+    // If there is only the joinRel,
+    // make sure it does not match a cartesian product joinRel
+    // (with "true" condition), otherwise this rule will be applied
+    // again on the new cartesian product joinRel.
+    if (filter == null && joinFilters.isEmpty()) {
+      return;
+    }
+
+    final List<RexNode> aboveFilters =
+        filter != null
+            ? getConjunctions(filter)
+            : new ArrayList<>();
+    final ImmutableList<RexNode> origAboveFilters =
+        ImmutableList.copyOf(aboveFilters);
+
+    // Simplify Outer Joins
+    JoinRelType joinType = join.getJoinType();
+    if (!origAboveFilters.isEmpty()
+        && join.getJoinType() != JoinRelType.INNER) {
+      joinType = RelOptUtil.simplifyJoin(join, origAboveFilters, joinType);
+    }
+
+    final List<RexNode> leftFilters = new ArrayList<>();
+    final List<RexNode> rightFilters = new ArrayList<>();
+
+    // TODO - add logic to derive additional filters.  E.g., from
+    // (t1.a = 1 AND t2.a = 2) OR (t1.b = 3 AND t2.b = 4), you can
+    // derive table filters:
+    // (t1.a = 1 OR t1.b = 3)
+    // (t2.a = 2 OR t2.b = 4)
+
+    // Try to push down above filters. These are typically where clause
+    // filters. They can be pushed down if they are not on the NULL
+    // generating side.
+    boolean filterPushed = classifyFilters(
+        join,
+        aboveFilters,
+        joinType == JoinRelType.INNER || joinType == JoinRelType.SEMI,
+        joinType == JoinRelType.INNER || joinType == JoinRelType.LEFT ||
+            joinType == JoinRelType.SEMI || joinType == JoinRelType.ANTI,
+        joinType == JoinRelType.INNER || joinType == JoinRelType.RIGHT,
+        joinFilters,
+        leftFilters,
+        rightFilters);
+
+    // Move join filters up if needed
+    validateJoinFilters(aboveFilters, joinFilters, join, joinType);
+
+    // If no filter got pushed after validate, reset filterPushed flag
+    if (leftFilters.isEmpty()
+        && rightFilters.isEmpty()
+        && joinFilters.size() == origJoinFilters.size()) {
+      if (Sets.newHashSet(joinFilters)
+          .equals(Sets.newHashSet(origJoinFilters))) {
+        filterPushed = false;
+      }
+    }
+
+    // Try to push down filters in ON clause. A ON clause filter can only be
+    // pushed down if it does not affect the non-matching set, i.e. it is
+    // not on the side which is preserved.
+
+    // Anti-join on conditions can not be pushed into left or right, e.g. for plan:
+    //
+    //     Join(condition=[AND(cond1, $2)], joinType=[anti])
+    //     :  - prj(f0=[$0], f1=[$1], f2=[$2])
+    //     :  - prj(f0=[$0])
+    //
+    // The semantic would change if join condition $2 is pushed into left,
+    // that is, the result set may be smaller. The right can not be pushed
+    // into for the same reason.
+    if (joinType != JoinRelType.ANTI
+        && classifyFilters(
+        join,
+        joinFilters,
+        false,
+        joinType == JoinRelType.INNER || joinType == JoinRelType.RIGHT || joinType == JoinRelType.SEMI,
+        joinType == JoinRelType.INNER || joinType == JoinRelType.LEFT || joinType == JoinRelType.SEMI,
+        joinFilters,
+        leftFilters,
+        rightFilters)) {
+      filterPushed = true;
+    }
+
+    // if nothing actually got pushed and there is nothing leftover,
+    // then this rule is a no-op
+    if ((!filterPushed
+        && joinType == join.getJoinType())
+        || (joinFilters.isEmpty()
+        && leftFilters.isEmpty()
+        && rightFilters.isEmpty())) {
+      return;
+    }
+
+    // create Filters on top of the children if any filters were
+    // pushed to them
+    final RexBuilder rexBuilder = join.getCluster().getRexBuilder();
+    final RelBuilder relBuilder = call.builder();
+    final RelNode leftRel =
+        relBuilder.push(join.getLeft()).filter(leftFilters).build();
+    final RelNode rightRel =
+        relBuilder.push(join.getRight()).filter(rightFilters).build();
+
+    // create the new join node referencing the new children and
+    // containing its new join filters (if there are any)
+    final ImmutableList<RelDataType> fieldTypes =
+        ImmutableList.<RelDataType>builder()
+            .addAll(RelOptUtil.getFieldTypeList(leftRel.getRowType()))
+            .addAll(RelOptUtil.getFieldTypeList(rightRel.getRowType())).build();
+    final RexNode joinFilter =
+        RexUtil.composeConjunction(rexBuilder,
+            RexUtil.fixUp(rexBuilder, joinFilters, fieldTypes));
+
+    // If nothing actually got pushed and there is nothing leftover,
+    // then this rule is a no-op
+    if (joinFilter.isAlwaysTrue()
+        && leftFilters.isEmpty()
+        && rightFilters.isEmpty()
+        && joinType == join.getJoinType()) {
+      return;
+    }
+
+    RelNode newJoinRel =
+        join.copy(
+            join.getTraitSet(),
+            joinFilter,
+            leftRel,
+            rightRel,
+            joinType,
+            join.isSemiJoinDone());
+    call.getPlanner().onCopy(join, newJoinRel);
+    if (!leftFilters.isEmpty()) {
+      call.getPlanner().onCopy(filter, leftRel);
+    }
+    if (!rightFilters.isEmpty()) {
+      call.getPlanner().onCopy(filter, rightRel);
+    }
+
+    relBuilder.push(newJoinRel);
+
+    // Create a project on top of the join if some of the columns have become
+    // NOT NULL due to the join-type getting stricter.
+    relBuilder.convert(join.getRowType(), false);
+
+    // create a FilterRel on top of the join if needed
+    relBuilder.filter(
+        RexUtil.fixUp(rexBuilder, aboveFilters,
+            RelOptUtil.getFieldTypeList(relBuilder.peek().getRowType())));
+    call.transformTo(relBuilder.build());
+  }
+
+  private List<RexNode> getConjunctions(Filter filter) {
+    List<RexNode> conjunctions = conjunctions(filter.getCondition());
+    RexBuilder rexBuilder = filter.getCluster().getRexBuilder();
+    for (int i = 0; i < conjunctions.size(); i++) {
+      RexNode node = conjunctions.get(i);
+      if (node instanceof RexCall) {
+        conjunctions.set(i,
+            RelOptUtil.collapseExpandedIsNotDistinctFromExpr((RexCall) node, rexBuilder));
+      }
+    }
+    return conjunctions;
+  }
+
+  /**
+   * Classifies filters according to where they should be processed. They
+   * either stay where they are, are pushed to the join (if they originated
+   * from above the join), or are pushed to one of the children. Filters that
+   * are pushed are added to list passed in as input parameters.
+   *
+   * @param joinRel      join node
+   * @param filters      filters to be classified
+   * @param pushInto     whether filters can be pushed into the join
+   * @param pushLeft     true if filters can be pushed to the left
+   * @param pushRight    true if filters can be pushed to the right
+   * @param joinFilters  list of filters to push to the join
+   * @param leftFilters  list of filters to push to the left child
+   * @param rightFilters list of filters to push to the right child
+   * @return whether at least one filter was pushed
+   */
+  private static boolean classifyFilters(
+      RelNode joinRel,
+      List<RexNode> filters,
+      boolean pushInto,
+      boolean pushLeft,
+      boolean pushRight,
+      List<RexNode> joinFilters,
+      List<RexNode> leftFilters,
+      List<RexNode> rightFilters) {
+    if (Bug.CALCITE_4499_FIXED) {
+      throw new AssertionError("Remove this method when [CALCITE-4499] "
+          + "has been fixed and use directly Calcite's RelOptUtil.classifyFilters.");
+    }
+    RexBuilder rexBuilder = joinRel.getCluster().getRexBuilder();
+    List<RelDataTypeField> joinFields = joinRel.getRowType().getFieldList();
+    final int nSysFields = 0; // joinRel.getSystemFieldList().size();
+    final List<RelDataTypeField> leftFields =
+        joinRel.getInputs().get(0).getRowType().getFieldList();
+    final int nFieldsLeft = leftFields.size();
+    final List<RelDataTypeField> rightFields =
+        joinRel.getInputs().get(1).getRowType().getFieldList();
+    final int nFieldsRight = rightFields.size();
+    final int nTotalFields = nFieldsLeft + nFieldsRight;
+
+    // set the reference bitmaps for the left and right children
+    ImmutableBitSet leftBitmap =
+        ImmutableBitSet.range(nSysFields, nSysFields + nFieldsLeft);
+    ImmutableBitSet rightBitmap =
+        ImmutableBitSet.range(nSysFields + nFieldsLeft, nTotalFields);
+
+    final List<RexNode> filtersToRemove = new ArrayList<>();
+    for (RexNode filter : filters) {
+      final InputFinder inputFinder = InputFinder.analyze(filter);
+      final ImmutableBitSet inputBits = inputFinder.inputBitSet.build();
 
-    filterProjs = filterProjs.union(InputFinder.bits(filter));
+      // REVIEW - are there any expressions that need special handling
+      // and therefore cannot be pushed?
 
-    if (allLeftProjs.intersects(filterProjs) && allRightProjs.intersects(filterProjs))
-      refersToBothSides = true;
+      // filters can be pushed to the left child if the left child
+      // does not generate NULLs and the only columns referenced in
+      // the filter originate from the left child
+      if (pushLeft && leftBitmap.contains(inputBits)) {
+        // ignore filters that always evaluate to true
+        if (!filter.isAlwaysTrue()) {
+          // adjust the field references in the filter to reflect
+          // that fields in the left now shift over by the number
+          // of system fields
+          final RexNode shiftedFilter =
+              shiftFilter(
+                  nSysFields,
+                  nSysFields + nFieldsLeft,
+                  -nSysFields,
+                  rexBuilder,
+                  joinFields,
+                  nTotalFields,
+                  leftFields,
+                  filter);
 
-    return refersToBothSides;
+          leftFilters.add(shiftedFilter);
+        }
+        filtersToRemove.add(filter);
+
+        // filters can be pushed to the right child if the right child
+        // does not generate NULLs and the only columns referenced in
+        // the filter originate from the right child
+      } else if (pushRight && rightBitmap.contains(inputBits)) {
+        if (!filter.isAlwaysTrue()) {
+          // adjust the field references in the filter to reflect
+          // that fields in the right now shift over to the left;
+          // since we never push filters to a NULL generating
+          // child, the types of the source should match the dest
+          // so we don't need to explicitly pass the destination
+          // fields to RexInputConverter
+          final RexNode shiftedFilter =
+              shiftFilter(
+                  nSysFields + nFieldsLeft,
+                  nTotalFields,
+                  -(nSysFields + nFieldsLeft),
+                  rexBuilder,
+                  joinFields,
+                  nTotalFields,
+                  rightFields,
+                  filter);
+          rightFilters.add(shiftedFilter);
+        }
+        filtersToRemove.add(filter);
+
+      } else {
+        // If the filter can't be pushed to either child, we may push them into the join
+        if (pushInto) {
+          if (!joinFilters.contains(filter)) {
+            joinFilters.add(filter);
+          }
+          filtersToRemove.add(filter);
+        }
+      }
+    }
+
+    // Remove filters after the loop, to prevent concurrent modification.
+    if (!filtersToRemove.isEmpty()) {
+      filters.removeAll(filtersToRemove);
+    }
+
+    // Did anything change?
+    return !filtersToRemove.isEmpty();
+  }
+
+  private static RexNode shiftFilter(
+      int start,
+      int end,
+      int offset,
+      RexBuilder rexBuilder,
+      List<RelDataTypeField> joinFields,
+      int nTotalFields,
+      List<RelDataTypeField> rightFields,
+      RexNode filter) {
+    int[] adjustments = new int[nTotalFields];
+    for (int i = start; i < end; i++) {
+      adjustments[i] = offset;
+    }
+    return filter.accept(
+        new RexInputConverter(
+            rexBuilder,
+            joinFields,
+            rightFields,
+            adjustments));
   }
 }
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveReduceExpressionsRule.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveReduceExpressionsRule.java
index 96fa2df659..235eba5dbf 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveReduceExpressionsRule.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveReduceExpressionsRule.java
@@ -36,6 +36,7 @@
 import org.apache.hadoop.hive.ql.optimizer.calcite.reloperators.HiveFilter;
 import org.apache.hadoop.hive.ql.optimizer.calcite.reloperators.HiveJoin;
 import org.apache.hadoop.hive.ql.optimizer.calcite.reloperators.HiveProject;
+import org.apache.hadoop.hive.ql.optimizer.calcite.reloperators.HiveSemiJoin;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -79,6 +80,13 @@ public abstract class HiveReduceExpressionsRule extends ReduceExpressionsRule {
   public static final ReduceExpressionsRule JOIN_INSTANCE =
       new JoinReduceExpressionsRule(HiveJoin.class, false, HiveRelFactories.HIVE_BUILDER);
 
+  /**
+   * Singleton rule that reduces constants inside a
+   * {@link org.apache.hadoop.hive.ql.optimizer.calcite.reloperators.HiveSemiJoin}.
+   */
+  public static final ReduceExpressionsRule SEMIJOIN_INSTANCE =
+      new JoinReduceExpressionsRule(HiveSemiJoin.class, false, HiveRelFactories.HIVE_BUILDER);
+
   //~ Constructors -----------------------------------------------------------
 
   /**
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveRelDecorrelator.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveRelDecorrelator.java
index c66685945f..bbd606cfea 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveRelDecorrelator.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveRelDecorrelator.java
@@ -1333,6 +1333,12 @@ public Frame decorrelateRel(HiveJoin rel) {
   }
 
   public Frame decorrelateRel(Join rel) {
+    // For SEMI/ANTI join decorrelate it's input directly,
+    // because the correlate variables can only be propagated from
+    // the left side, which is not supported yet.
+    if (!rel.getJoinType().projectsRight()) {
+      return decorrelateRel((RelNode) rel);
+    }
     //
     // Rewrite logic:
     //
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveRemoveGBYSemiJoinRule.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveRemoveGBYSemiJoinRule.java
index abad7db229..a2230a7bdf 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveRemoveGBYSemiJoinRule.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveRemoveGBYSemiJoinRule.java
@@ -21,10 +21,13 @@
 import org.apache.calcite.rel.RelNode;
 import org.apache.calcite.rel.core.Aggregate;
 import org.apache.calcite.rel.core.Join;
-import org.apache.calcite.rel.core.JoinInfo;
 import org.apache.calcite.rel.core.JoinRelType;
 import org.apache.calcite.tools.RelBuilder;
 import org.apache.calcite.util.ImmutableBitSet;
+import org.apache.hadoop.hive.ql.optimizer.calcite.CalciteSemanticException;
+import org.apache.hadoop.hive.ql.optimizer.calcite.HiveCalciteUtil;
+import org.apache.hadoop.hive.ql.optimizer.calcite.HiveCalciteUtil.JoinLeafPredicateInfo;
+import org.apache.hadoop.hive.ql.optimizer.calcite.HiveCalciteUtil.JoinPredicateInfo;
 import org.apache.hadoop.hive.ql.optimizer.calcite.HiveRelFactories;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
@@ -36,6 +39,7 @@
 public class HiveRemoveGBYSemiJoinRule extends RelOptRule {
 
   protected static final Logger LOG = LoggerFactory.getLogger(HiveRemoveGBYSemiJoinRule.class);
+
   public static final HiveRemoveGBYSemiJoinRule INSTANCE =
       new HiveRemoveGBYSemiJoinRule();
 
@@ -71,9 +75,22 @@ public HiveRemoveGBYSemiJoinRule() {
     if(!rightAggregate.getAggCallList().isEmpty()) {
       return;
     }
-    final JoinInfo joinInfo = join.analyzeCondition();
 
-    boolean shouldTransform = joinInfo.rightSet().equals(
+    JoinPredicateInfo joinPredInfo;
+    try {
+      joinPredInfo = HiveCalciteUtil.JoinPredicateInfo.constructJoinPredicateInfo(join);
+    } catch (CalciteSemanticException e) {
+      LOG.warn("Exception while extracting predicate info from {}", join);
+      return;
+    }
+    if (!joinPredInfo.getNonEquiJoinPredicateElements().isEmpty()) {
+      return;
+    }
+    ImmutableBitSet.Builder rightKeys = ImmutableBitSet.builder();
+    for (JoinLeafPredicateInfo leftPredInfo : joinPredInfo.getEquiJoinPredicateElements()) {
+      rightKeys.addAll(leftPredInfo.getProjsFromRightPartOfJoinKeysInChildSchema());
+    }
+    boolean shouldTransform = rightKeys.build().equals(
         ImmutableBitSet.range(rightAggregate.getGroupCount()));
     if(shouldTransform) {
       final RelBuilder relBuilder = call.builder();
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveSubQueryRemoveRule.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveSubQueryRemoveRule.java
index abd0e547fa..b23bb4cb4f 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveSubQueryRemoveRule.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveSubQueryRemoveRule.java
@@ -42,6 +42,7 @@
 import org.apache.calcite.sql.type.OperandTypes;
 import org.apache.calcite.sql.type.ReturnTypes;
 import org.apache.calcite.sql.type.SqlTypeName;
+import org.apache.calcite.tools.RelBuilder;
 import org.apache.calcite.util.Pair;
 
 import com.google.common.collect.ImmutableList;
@@ -55,15 +56,12 @@
 import org.apache.hadoop.hive.ql.optimizer.calcite.CalciteSubqueryRuntimeException;
 import org.apache.hadoop.hive.ql.optimizer.calcite.HiveRelFactories;
 import org.apache.hadoop.hive.ql.optimizer.calcite.HiveRelShuttleImpl;
-import org.apache.hadoop.hive.ql.optimizer.calcite.HiveSubQRemoveRelBuilder;
 import org.apache.hadoop.hive.ql.optimizer.calcite.SubqueryConf;
 import org.apache.hadoop.hive.ql.optimizer.calcite.reloperators.HiveAggregate;
 import org.apache.hadoop.hive.ql.optimizer.calcite.reloperators.HiveFilter;
 import org.apache.hadoop.hive.ql.optimizer.calcite.reloperators.HiveProject;
 import org.apache.hadoop.hive.ql.optimizer.calcite.reloperators.HiveSortLimit;
 
-import static org.apache.hadoop.hive.conf.HiveConf.ConfVars.HIVE_CONVERT_ANTI_JOIN;
-
 /**
  * NOTE: this rule is replicated from Calcite's SubqueryRemoveRule
  * Transform that converts IN, EXISTS and scalar sub-queries into joins.
@@ -101,8 +99,7 @@ private HiveSubQueryRemoveRule(RelOptRuleOperand operand, String description, Hi
 
   @Override public void onMatch(RelOptRuleCall call) {
     final RelNode relNode = call.rel(0);
-    final HiveSubQRemoveRelBuilder builder =
-        new HiveSubQRemoveRelBuilder(null, call.rel(0).getCluster(), null);
+    final RelBuilder builder = call.builder();
 
     // if subquery is in FILTER
     if (relNode instanceof HiveFilter) {
@@ -173,7 +170,7 @@ private SqlTypeName getAggTypeForScalarSub(RexSubQuery e) {
   }
 
   private RexNode rewriteScalar(RelMetadataQuery mq, RexSubQuery e, Set<CorrelationId> variablesSet,
-      HiveSubQRemoveRelBuilder builder, int offset, int inputCount, boolean isCorrScalarAgg) {
+      RelBuilder builder, int offset, int inputCount, boolean isCorrScalarAgg) {
     // if scalar query has aggregate and no windowing and no gby avoid adding sq_count_check
     // since it is guaranteed to produce at most one row
     Double maxRowCount = mq.getMaxRowCount(e.rel);
@@ -236,7 +233,7 @@ private RexNode rewriteScalar(RelMetadataQuery mq, RexSubQuery e, Set<Correlatio
   }
 
   private RexNode rewriteSomeAll(RexSubQuery e, Set<CorrelationId> variablesSet,
-      HiveSubQRemoveRelBuilder builder) {
+      RelBuilder builder) {
     final SqlQuantifyOperator op = (SqlQuantifyOperator) e.op;
 
     // SOME_EQ & SOME_NE should have been rewritten into IN/ NOT IN
@@ -325,7 +322,7 @@ private RexNode rewriteSomeAll(RexSubQuery e, Set<CorrelationId> variablesSet,
   }
 
   private RexNode rewriteInExists(RexSubQuery e, Set<CorrelationId> variablesSet,
-      RelOptUtil.Logic logic, HiveSubQRemoveRelBuilder builder, int offset,
+      RelOptUtil.Logic logic, RelBuilder builder, int offset,
       boolean isCorrScalarAgg) {
     // Most general case, where the left and right keys might have nulls, and
     // caller requires 3-valued logic return.
@@ -508,10 +505,10 @@ private RexNode rewriteInExists(RexSubQuery e, Set<CorrelationId> variablesSet,
     }
     switch (logic) {
     case TRUE:
-      builder.join(JoinRelType.INNER, builder.and(conditions), variablesSet, JoinRelType.SEMI);
+      builder.join(JoinRelType.SEMI, builder.and(conditions), variablesSet);
       return builder.literal(true);
     case FALSE:
-      builder.join(JoinRelType.LEFT, builder.and(conditions), variablesSet, JoinRelType.ANTI);
+      builder.join(JoinRelType.ANTI, builder.and(conditions), variablesSet);
       return builder.literal(false);
     }
     builder.join(JoinRelType.LEFT, builder.and(conditions), variablesSet);
@@ -563,7 +560,7 @@ private RexNode rewriteInExists(RexSubQuery e, Set<CorrelationId> variablesSet,
   }
 
   protected RexNode apply(RelMetadataQuery mq, RexSubQuery e, Set<CorrelationId> variablesSet,
-      RelOptUtil.Logic logic, HiveSubQRemoveRelBuilder builder, int inputCount, int offset,
+      RelOptUtil.Logic logic, RelBuilder builder, int inputCount, int offset,
       boolean isCorrScalarAgg) {
     switch (e.getKind()) {
     case SCALAR_QUERY:
@@ -582,7 +579,7 @@ protected RexNode apply(RelMetadataQuery mq, RexSubQuery e, Set<CorrelationId> v
    * Returns a reference to a particular field, by offset, across several
    * inputs on a {@link RelBuilder}'s stack.
    */
-  private RexInputRef field(HiveSubQRemoveRelBuilder builder, int inputCount, int offset) {
+  private RexInputRef field(RelBuilder builder, int inputCount, int offset) {
     for (int inputOrdinal = 0; ;) {
       final RelNode r = builder.peek(inputCount, inputOrdinal);
       if (offset < r.getRowType().getFieldCount()) {
@@ -597,7 +594,7 @@ private RexInputRef field(HiveSubQRemoveRelBuilder builder, int inputCount, int
    * Returns a list of expressions that project the first {@code fieldCount}
    * fields of the top input on a {@link RelBuilder}'s stack.
    */
-  private static List<RexNode> fields(HiveSubQRemoveRelBuilder builder, int fieldCount) {
+  private static List<RexNode> fields(RelBuilder builder, int fieldCount) {
     final List<RexNode> projects = new ArrayList<>();
     for (int i = 0; i < fieldCount; i++) {
       projects.add(builder.field(i));
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/CalcitePlanner.java b/ql/src/java/org/apache/hadoop/hive/ql/parse/CalcitePlanner.java
index 95f7cc34a0..9f9a05db19 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/CalcitePlanner.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/CalcitePlanner.java
@@ -2035,6 +2035,7 @@ private RelNode applyPreJoinOrderingTransforms(RelNode basePlan, RelMetadataProv
       rules.add(HiveReduceExpressionsRule.PROJECT_INSTANCE);
       rules.add(HiveReduceExpressionsRule.FILTER_INSTANCE);
       rules.add(HiveReduceExpressionsRule.JOIN_INSTANCE);
+      rules.add(HiveReduceExpressionsRule.SEMIJOIN_INSTANCE);
       rules.add(HiveAggregateReduceFunctionsRule.INSTANCE);
       rules.add(HiveAggregateReduceRule.INSTANCE);
       if (conf.getBoolVar(HiveConf.ConfVars.HIVEPOINTLOOKUPOPTIMIZER)) {
@@ -2901,8 +2902,8 @@ private RelNode genJoinRelNode(RelNode leftRel, String leftTableAlias, RelNode r
         List<RexNode> leftJoinKeys = new ArrayList<RexNode>();
         List<RexNode> rightJoinKeys = new ArrayList<RexNode>();
 
-        RexNode nonEquiConds = RelOptUtil.splitJoinCondition(sysFieldList, leftRel, rightRel,
-            calciteJoinCond, leftJoinKeys, rightJoinKeys, null, null);
+        RexNode nonEquiConds = HiveRelOptUtil.splitHiveJoinCondition(sysFieldList, ImmutableList.of(leftRel, rightRel),
+            calciteJoinCond, ImmutableList.of(leftJoinKeys, rightJoinKeys), null, null);
 
         RelNode[] inputRels = new RelNode[] { leftRel, rightRel };
         final List<Integer> leftKeys = new ArrayList<Integer>();
diff --git a/ql/src/test/results/clientpositive/llap/constprog_partitioner.q.out b/ql/src/test/results/clientpositive/llap/constprog_partitioner.q.out
index 3d8d1ad087..8609eec1ff 100644
--- a/ql/src/test/results/clientpositive/llap/constprog_partitioner.q.out
+++ b/ql/src/test/results/clientpositive/llap/constprog_partitioner.q.out
@@ -131,10 +131,10 @@ STAGE PLANS:
                       outputColumnNames: _col0, _col1, _col2
                       Statistics: Num rows: 14 Data size: 224 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
-                        key expressions: _col0 (type: int), 1 (type: int)
-                        null sort order: zz
-                        sort order: ++
-                        Map-reduce partition columns: _col0 (type: int), 1 (type: int)
+                        key expressions: _col0 (type: int)
+                        null sort order: z
+                        sort order: +
+                        Map-reduce partition columns: _col0 (type: int)
                         Statistics: Num rows: 14 Data size: 224 Basic stats: COMPLETE Column stats: COMPLETE
                         value expressions: _col1 (type: int), _col2 (type: int)
             Execution mode: vectorized, llap
@@ -149,21 +149,21 @@ STAGE PLANS:
                     predicate: ((l_linenumber = 1) and (l_shipmode = 'AIR') and l_orderkey is not null) (type: boolean)
                     Statistics: Num rows: 2 Data size: 192 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: l_orderkey (type: int), 1 (type: int)
-                      outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                      expressions: l_orderkey (type: int)
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
-                        keys: _col0 (type: int), _col1 (type: int)
+                        keys: _col0 (type: int)
                         minReductionHashAggr: 0.4
                         mode: hash
-                        outputColumnNames: _col0, _col1
-                        Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: int)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: int)
-                          Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
+                          Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: vectorized, llap
             LLAP IO: all inputs
         Reducer 2 
@@ -173,8 +173,8 @@ STAGE PLANS:
                 condition map:
                      Left Semi Join 0 to 1
                 keys:
-                  0 _col0 (type: int), 1 (type: int)
-                  1 _col0 (type: int), _col1 (type: int)
+                  0 _col0 (type: int)
+                  1 _col0 (type: int)
                 outputColumnNames: _col1, _col2
                 Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
                 Select Operator
diff --git a/ql/src/test/results/clientpositive/llap/constprog_semijoin.q.out b/ql/src/test/results/clientpositive/llap/constprog_semijoin.q.out
index edcd852401..8b0ec3ba45 100644
--- a/ql/src/test/results/clientpositive/llap/constprog_semijoin.q.out
+++ b/ql/src/test/results/clientpositive/llap/constprog_semijoin.q.out
@@ -268,6 +268,7 @@ POSTHOOK: Input: default@table3_n0
 1	t1val01	t2val201
 3	t1val01	t2val203
 3	t1val01	t2val203
+Warning: Shuffle Join MERGEJOIN[13][tables = [$hdt$_0, $hdt$_1]] in Stage 'Reducer 2' is a cross product
 PREHOOK: query: explain select table1_n10.id, table1_n10.val, table1_n10.val1 from table1_n10 left semi join table3_n0 on table1_n10.dimid = table3_n0.id and table3_n0.id = 100 where table1_n10.dimid <> 100
 PREHOOK: type: QUERY
 PREHOOK: Input: default@table1_n10
@@ -280,10 +281,34 @@ POSTHOOK: Input: default@table3_n0
 #### A masked pattern was here ####
 Plan optimized by CBO.
 
+Vertex dependency in root stage
+Reducer 2 <- Map 1 (XPROD_EDGE), Map 3 (XPROD_EDGE)
+
 Stage-0
   Fetch Operator
-    limit:0
+    limit:-1
+    Stage-1
+      Reducer 2 llap
+      File Output Operator [FS_11]
+        Merge Join Operator [MERGEJOIN_13] (rows=1 width=185)
+          Conds:(Left Semi),Output:["_col0","_col1","_col2"]
+        <-Map 1 [XPROD_EDGE] vectorized, llap
+          XPROD_EDGE [RS_16]
+            Select Operator [SEL_15] (rows=1 width=185)
+              Output:["_col0","_col1","_col2"]
+              Limit [LIM_14] (rows=1 width=185)
+                Number of rows:0
+                TableScan [TS_0] (rows=10 width=185)
+                  default@table1_n10,table1_n10,Tbl:COMPLETE,Col:COMPLETE,Output:["id","val","val1"]
+        <-Map 3 [XPROD_EDGE] vectorized, llap
+          XPROD_EDGE [RS_19]
+            Select Operator [SEL_18] (rows=1 width=4)
+              Filter Operator [FIL_17] (rows=1 width=4)
+                predicate:(id = 100)
+                TableScan [TS_4] (rows=5 width=4)
+                  default@table3_n0,table3_n0,Tbl:COMPLETE,Col:COMPLETE,Output:["id"]
 
+Warning: Shuffle Join MERGEJOIN[13][tables = [$hdt$_0, $hdt$_1]] in Stage 'Reducer 2' is a cross product
 PREHOOK: query: select table1_n10.id, table1_n10.val, table1_n10.val1 from table1_n10 left semi join table3_n0 on table1_n10.dimid = table3_n0.id and table3_n0.id = 100 where table1_n10.dimid <> 100
 PREHOOK: type: QUERY
 PREHOOK: Input: default@table1_n10
@@ -294,6 +319,7 @@ POSTHOOK: type: QUERY
 POSTHOOK: Input: default@table1_n10
 POSTHOOK: Input: default@table3_n0
 #### A masked pattern was here ####
+Warning: Shuffle Join MERGEJOIN[13][tables = [$hdt$_0, $hdt$_1]] in Stage 'Reducer 2' is a cross product
 PREHOOK: query: explain select table1_n10.id, table1_n10.val, table1_n10.val1 from table1_n10 left semi join table3_n0 on table1_n10.dimid = table3_n0.id and table3_n0.id = 100 where table1_n10.dimid  IN (100,200)
 PREHOOK: type: QUERY
 PREHOOK: Input: default@table1_n10
@@ -307,37 +333,33 @@ POSTHOOK: Input: default@table3_n0
 Plan optimized by CBO.
 
 Vertex dependency in root stage
-Reducer 2 <- Map 1 (SIMPLE_EDGE), Map 3 (SIMPLE_EDGE)
+Reducer 2 <- Map 1 (XPROD_EDGE), Map 3 (XPROD_EDGE)
 
 Stage-0
   Fetch Operator
     limit:-1
     Stage-1
       Reducer 2 llap
-      File Output Operator [FS_12]
-        Merge Join Operator [MERGEJOIN_17] (rows=3 width=185)
-          Conds:RS_20.100, true=RS_24._col0, _col1(Left Semi),Output:["_col0","_col1","_col2"]
-        <-Map 1 [SIMPLE_EDGE] vectorized, llap
-          SHUFFLE [RS_20]
-            PartitionCols:100, true
-            Select Operator [SEL_19] (rows=3 width=193)
+      File Output Operator [FS_10]
+        Merge Join Operator [MERGEJOIN_13] (rows=3 width=185)
+          Conds:(Left Semi),Output:["_col0","_col1","_col2"]
+        <-Map 1 [XPROD_EDGE] vectorized, llap
+          XPROD_EDGE [RS_16]
+            Select Operator [SEL_15] (rows=3 width=189)
               Output:["_col0","_col1","_col2"]
-              Filter Operator [FIL_18] (rows=3 width=189)
+              Filter Operator [FIL_14] (rows=3 width=189)
                 predicate:(dimid = 100)
                 TableScan [TS_0] (rows=10 width=189)
                   default@table1_n10,table1_n10,Tbl:COMPLETE,Col:COMPLETE,Output:["id","val","val1","dimid"]
-        <-Map 3 [SIMPLE_EDGE] vectorized, llap
-          SHUFFLE [RS_24]
-            PartitionCols:_col0, _col1
-            Group By Operator [GBY_23] (rows=1 width=8)
-              Output:["_col0","_col1"],keys:_col0, _col1
-              Select Operator [SEL_22] (rows=1 width=8)
-                Output:["_col0","_col1"]
-                Filter Operator [FIL_21] (rows=1 width=4)
-                  predicate:(id = 100)
-                  TableScan [TS_3] (rows=5 width=4)
-                    default@table3_n0,table3_n0,Tbl:COMPLETE,Col:COMPLETE,Output:["id"]
+        <-Map 3 [XPROD_EDGE] vectorized, llap
+          XPROD_EDGE [RS_19]
+            Select Operator [SEL_18] (rows=1 width=4)
+              Filter Operator [FIL_17] (rows=1 width=4)
+                predicate:(id = 100)
+                TableScan [TS_3] (rows=5 width=4)
+                  default@table3_n0,table3_n0,Tbl:COMPLETE,Col:COMPLETE,Output:["id"]
 
+Warning: Shuffle Join MERGEJOIN[13][tables = [$hdt$_0, $hdt$_1]] in Stage 'Reducer 2' is a cross product
 PREHOOK: query: select table1_n10.id, table1_n10.val, table1_n10.val1 from table1_n10 left semi join table3_n0 on table1_n10.dimid = table3_n0.id and table3_n0.id = 100 where table1_n10.dimid  IN (100,200)
 PREHOOK: type: QUERY
 PREHOOK: Input: default@table1_n10
@@ -350,6 +372,7 @@ POSTHOOK: Input: default@table3_n0
 #### A masked pattern was here ####
 1	t1val01	val101
 3	t1val01	val104
+Warning: Shuffle Join MERGEJOIN[13][tables = [$hdt$_0, $hdt$_1]] in Stage 'Reducer 2' is a cross product
 PREHOOK: query: explain select table1_n10.id, table1_n10.val, table1_n10.val1 from table1_n10 left semi join table3_n0 on table1_n10.dimid = table3_n0.id and table3_n0.id = 100 where table1_n10.dimid  = 200
 PREHOOK: type: QUERY
 PREHOOK: Input: default@table1_n10
@@ -362,10 +385,34 @@ POSTHOOK: Input: default@table3_n0
 #### A masked pattern was here ####
 Plan optimized by CBO.
 
+Vertex dependency in root stage
+Reducer 2 <- Map 1 (XPROD_EDGE), Map 3 (XPROD_EDGE)
+
 Stage-0
   Fetch Operator
-    limit:0
+    limit:-1
+    Stage-1
+      Reducer 2 llap
+      File Output Operator [FS_11]
+        Merge Join Operator [MERGEJOIN_13] (rows=1 width=185)
+          Conds:(Left Semi),Output:["_col0","_col1","_col2"]
+        <-Map 1 [XPROD_EDGE] vectorized, llap
+          XPROD_EDGE [RS_16]
+            Select Operator [SEL_15] (rows=1 width=185)
+              Output:["_col0","_col1","_col2"]
+              Limit [LIM_14] (rows=1 width=185)
+                Number of rows:0
+                TableScan [TS_0] (rows=10 width=185)
+                  default@table1_n10,table1_n10,Tbl:COMPLETE,Col:COMPLETE,Output:["id","val","val1"]
+        <-Map 3 [XPROD_EDGE] vectorized, llap
+          XPROD_EDGE [RS_19]
+            Select Operator [SEL_18] (rows=1 width=4)
+              Filter Operator [FIL_17] (rows=1 width=4)
+                predicate:(id = 100)
+                TableScan [TS_4] (rows=5 width=4)
+                  default@table3_n0,table3_n0,Tbl:COMPLETE,Col:COMPLETE,Output:["id"]
 
+Warning: Shuffle Join MERGEJOIN[13][tables = [$hdt$_0, $hdt$_1]] in Stage 'Reducer 2' is a cross product
 PREHOOK: query: select table1_n10.id, table1_n10.val, table1_n10.val1 from table1_n10 left semi join table3_n0 on table1_n10.dimid = table3_n0.id and table3_n0.id = 100 where table1_n10.dimid  = 200
 PREHOOK: type: QUERY
 PREHOOK: Input: default@table1_n10
@@ -376,6 +423,7 @@ POSTHOOK: type: QUERY
 POSTHOOK: Input: default@table1_n10
 POSTHOOK: Input: default@table3_n0
 #### A masked pattern was here ####
+Warning: Shuffle Join MERGEJOIN[13][tables = [$hdt$_0, $hdt$_1]] in Stage 'Reducer 2' is a cross product
 PREHOOK: query: explain select table1_n10.id, table1_n10.val, table1_n10.val1 from table1_n10 left semi join table3_n0 on table1_n10.dimid = table3_n0.id and table3_n0.id = 100 where table1_n10.dimid  = 100
 PREHOOK: type: QUERY
 PREHOOK: Input: default@table1_n10
@@ -389,37 +437,33 @@ POSTHOOK: Input: default@table3_n0
 Plan optimized by CBO.
 
 Vertex dependency in root stage
-Reducer 2 <- Map 1 (SIMPLE_EDGE), Map 3 (SIMPLE_EDGE)
+Reducer 2 <- Map 1 (XPROD_EDGE), Map 3 (XPROD_EDGE)
 
 Stage-0
   Fetch Operator
     limit:-1
     Stage-1
       Reducer 2 llap
-      File Output Operator [FS_12]
-        Merge Join Operator [MERGEJOIN_17] (rows=3 width=185)
-          Conds:RS_20.100, true=RS_24._col0, _col1(Left Semi),Output:["_col0","_col1","_col2"]
-        <-Map 1 [SIMPLE_EDGE] vectorized, llap
-          SHUFFLE [RS_20]
-            PartitionCols:100, true
-            Select Operator [SEL_19] (rows=3 width=193)
+      File Output Operator [FS_10]
+        Merge Join Operator [MERGEJOIN_13] (rows=3 width=185)
+          Conds:(Left Semi),Output:["_col0","_col1","_col2"]
+        <-Map 1 [XPROD_EDGE] vectorized, llap
+          XPROD_EDGE [RS_16]
+            Select Operator [SEL_15] (rows=3 width=189)
               Output:["_col0","_col1","_col2"]
-              Filter Operator [FIL_18] (rows=3 width=189)
+              Filter Operator [FIL_14] (rows=3 width=189)
                 predicate:(dimid = 100)
                 TableScan [TS_0] (rows=10 width=189)
                   default@table1_n10,table1_n10,Tbl:COMPLETE,Col:COMPLETE,Output:["id","val","val1","dimid"]
-        <-Map 3 [SIMPLE_EDGE] vectorized, llap
-          SHUFFLE [RS_24]
-            PartitionCols:_col0, _col1
-            Group By Operator [GBY_23] (rows=1 width=8)
-              Output:["_col0","_col1"],keys:_col0, _col1
-              Select Operator [SEL_22] (rows=1 width=8)
-                Output:["_col0","_col1"]
-                Filter Operator [FIL_21] (rows=1 width=4)
-                  predicate:(id = 100)
-                  TableScan [TS_3] (rows=5 width=4)
-                    default@table3_n0,table3_n0,Tbl:COMPLETE,Col:COMPLETE,Output:["id"]
+        <-Map 3 [XPROD_EDGE] vectorized, llap
+          XPROD_EDGE [RS_19]
+            Select Operator [SEL_18] (rows=1 width=4)
+              Filter Operator [FIL_17] (rows=1 width=4)
+                predicate:(id = 100)
+                TableScan [TS_3] (rows=5 width=4)
+                  default@table3_n0,table3_n0,Tbl:COMPLETE,Col:COMPLETE,Output:["id"]
 
+Warning: Shuffle Join MERGEJOIN[13][tables = [$hdt$_0, $hdt$_1]] in Stage 'Reducer 2' is a cross product
 PREHOOK: query: select table1_n10.id, table1_n10.val, table1_n10.val1 from table1_n10 left semi join table3_n0 on table1_n10.dimid = table3_n0.id and table3_n0.id = 100 where table1_n10.dimid  = 100
 PREHOOK: type: QUERY
 PREHOOK: Input: default@table1_n10
@@ -432,6 +476,7 @@ POSTHOOK: Input: default@table3_n0
 #### A masked pattern was here ####
 1	t1val01	val101
 3	t1val01	val104
+Warning: Shuffle Join MERGEJOIN[13][tables = [$hdt$_0, $hdt$_1]] in Stage 'Reducer 2' is a cross product
 PREHOOK: query: explain select table1_n10.id, table1_n10.val, table1_n10.val1 from table1_n10 left semi join table3_n0 on table1_n10.dimid = table3_n0.id and table3_n0.id = 100
 PREHOOK: type: QUERY
 PREHOOK: Input: default@table1_n10
@@ -445,37 +490,33 @@ POSTHOOK: Input: default@table3_n0
 Plan optimized by CBO.
 
 Vertex dependency in root stage
-Reducer 2 <- Map 1 (SIMPLE_EDGE), Map 3 (SIMPLE_EDGE)
+Reducer 2 <- Map 1 (XPROD_EDGE), Map 3 (XPROD_EDGE)
 
 Stage-0
   Fetch Operator
     limit:-1
     Stage-1
       Reducer 2 llap
-      File Output Operator [FS_12]
-        Merge Join Operator [MERGEJOIN_17] (rows=3 width=185)
-          Conds:RS_20.100, true=RS_24._col0, _col1(Left Semi),Output:["_col0","_col1","_col2"]
-        <-Map 1 [SIMPLE_EDGE] vectorized, llap
-          SHUFFLE [RS_20]
-            PartitionCols:100, true
-            Select Operator [SEL_19] (rows=3 width=193)
+      File Output Operator [FS_10]
+        Merge Join Operator [MERGEJOIN_13] (rows=3 width=185)
+          Conds:(Left Semi),Output:["_col0","_col1","_col2"]
+        <-Map 1 [XPROD_EDGE] vectorized, llap
+          XPROD_EDGE [RS_16]
+            Select Operator [SEL_15] (rows=3 width=189)
               Output:["_col0","_col1","_col2"]
-              Filter Operator [FIL_18] (rows=3 width=189)
+              Filter Operator [FIL_14] (rows=3 width=189)
                 predicate:(dimid = 100)
                 TableScan [TS_0] (rows=10 width=189)
                   default@table1_n10,table1_n10,Tbl:COMPLETE,Col:COMPLETE,Output:["id","val","val1","dimid"]
-        <-Map 3 [SIMPLE_EDGE] vectorized, llap
-          SHUFFLE [RS_24]
-            PartitionCols:_col0, _col1
-            Group By Operator [GBY_23] (rows=1 width=8)
-              Output:["_col0","_col1"],keys:_col0, _col1
-              Select Operator [SEL_22] (rows=1 width=8)
-                Output:["_col0","_col1"]
-                Filter Operator [FIL_21] (rows=1 width=4)
-                  predicate:(id = 100)
-                  TableScan [TS_3] (rows=5 width=4)
-                    default@table3_n0,table3_n0,Tbl:COMPLETE,Col:COMPLETE,Output:["id"]
+        <-Map 3 [XPROD_EDGE] vectorized, llap
+          XPROD_EDGE [RS_19]
+            Select Operator [SEL_18] (rows=1 width=4)
+              Filter Operator [FIL_17] (rows=1 width=4)
+                predicate:(id = 100)
+                TableScan [TS_3] (rows=5 width=4)
+                  default@table3_n0,table3_n0,Tbl:COMPLETE,Col:COMPLETE,Output:["id"]
 
+Warning: Shuffle Join MERGEJOIN[13][tables = [$hdt$_0, $hdt$_1]] in Stage 'Reducer 2' is a cross product
 PREHOOK: query: select table1_n10.id, table1_n10.val, table1_n10.val1 from table1_n10 left semi join table3_n0 on table1_n10.dimid = table3_n0.id and table3_n0.id = 100
 PREHOOK: type: QUERY
 PREHOOK: Input: default@table1_n10
diff --git a/ql/src/test/results/clientpositive/llap/dynamic_semijoin_reduction_2.q.out b/ql/src/test/results/clientpositive/llap/dynamic_semijoin_reduction_2.q.out
index a62776dfd4..f400c592e9 100644
--- a/ql/src/test/results/clientpositive/llap/dynamic_semijoin_reduction_2.q.out
+++ b/ql/src/test/results/clientpositive/llap/dynamic_semijoin_reduction_2.q.out
@@ -92,10 +92,10 @@ STAGE PLANS:
             Map Operator Tree:
                 TableScan
                   alias: t1
-                  filterExpr: (bigint_col_7 is not null and decimal2016_col_26 is not null and tinyint_col_3 is not null and timestamp_col_9 is not null and timestamp_col_9 BETWEEN DynamicValue(RS_22_tt2_timestamp_col_18_min) AND DynamicValue(RS_22_tt2_timestamp_col_18_max) and in_bloom_filter(timestamp_col_9, DynamicValue(RS_22_tt2_timestamp_col_18_bloom_filter)) and decimal2016_col_26 BETWEEN DynamicValue(RS[102]_col0) AND DynamicValue(RS[102]_col1) and tinyint_col_3 BETWEEN DynamicValue(RS[102]_col2) AND DynamicValue(RS[102]_col3) and bigint_col_7 BETWEEN DynamicValue(RS[102]_col4) AND DynamicValue(RS[102]_col5) and in_bloom_filter(hash(hash(decimal2016_col_26,tinyint_col_3),bigint_col_7), DynamicValue(RS[102]_col6))) (type: boolean)
+                  filterExpr: (bigint_col_7 is not null and decimal2016_col_26 is not null and tinyint_col_3 is not null and timestamp_col_9 is not null and timestamp_col_9 BETWEEN DynamicValue(RS_22_tt2_timestamp_col_18_min) AND DynamicValue(RS_22_tt2_timestamp_col_18_max) and in_bloom_filter(timestamp_col_9, DynamicValue(RS_22_tt2_timestamp_col_18_bloom_filter)) and decimal2016_col_26 BETWEEN DynamicValue(RS[96]_col0) AND DynamicValue(RS[96]_col1) and tinyint_col_3 BETWEEN DynamicValue(RS[96]_col2) AND DynamicValue(RS[96]_col3) and bigint_col_7 BETWEEN DynamicValue(RS[96]_col4) AND DynamicValue(RS[96]_col5) and in_bloom_filter(hash(hash(decimal2016_col_26,tinyint_col_3),bigint_col_7), DynamicValue(RS[96]_col6))) (type: boolean)
                   Statistics: Num rows: 1 Data size: 164 Basic stats: COMPLETE Column stats: NONE
                   Filter Operator
-                    predicate: (bigint_col_7 is not null and decimal2016_col_26 is not null and tinyint_col_3 is not null and timestamp_col_9 is not null and decimal2016_col_26 BETWEEN DynamicValue(RS[102]_col0) AND DynamicValue(RS[102]_col1) and tinyint_col_3 BETWEEN DynamicValue(RS[102]_col2) AND DynamicValue(RS[102]_col3) and bigint_col_7 BETWEEN DynamicValue(RS[102]_col4) AND DynamicValue(RS[102]_col5) and timestamp_col_9 BETWEEN DynamicValue(RS_22_tt2_timestamp_col_18_min) AND DynamicValue(RS_22_tt2_timestamp_col_18_max) and in_bloom_filter(hash(hash(decimal2016_col_26,tinyint_col_3),bigint_col_7), DynamicValue(RS[102]_col6)) and in_bloom_filter(timestamp_col_9, DynamicValue(RS_22_tt2_timestamp_col_18_bloom_filter))) (type: boolean)
+                    predicate: (bigint_col_7 is not null and decimal2016_col_26 is not null and tinyint_col_3 is not null and timestamp_col_9 is not null and timestamp_col_9 BETWEEN DynamicValue(RS_22_tt2_timestamp_col_18_min) AND DynamicValue(RS_22_tt2_timestamp_col_18_max) and decimal2016_col_26 BETWEEN DynamicValue(RS[96]_col0) AND DynamicValue(RS[96]_col1) and tinyint_col_3 BETWEEN DynamicValue(RS[96]_col2) AND DynamicValue(RS[96]_col3) and bigint_col_7 BETWEEN DynamicValue(RS[96]_col4) AND DynamicValue(RS[96]_col5) and in_bloom_filter(timestamp_col_9, DynamicValue(RS_22_tt2_timestamp_col_18_bloom_filter)) and in_bloom_filter(hash(hash(decimal2016_col_26,tinyint_col_3),bigint_col_7), DynamicValue(RS[96]_col6))) (type: boolean)
                     Statistics: Num rows: 1 Data size: 164 Basic stats: COMPLETE Column stats: NONE
                     Select Operator
                       expressions: bigint_col_7 (type: bigint), decimal2016_col_26 (type: decimal(20,16)), tinyint_col_3 (type: tinyint), timestamp_col_9 (type: timestamp)
@@ -114,14 +114,14 @@ STAGE PLANS:
             Map Operator Tree:
                 TableScan
                   alias: t2
-                  filterExpr: ((UDFToLong(tinyint_col_15) is not null and decimal2709_col_9 is not null and tinyint_col_20 is not null and UDFToInteger(smallint_col_19) is not null) or (timestamp_col_18 is not null and decimal1911_col_16 is not null)) (type: boolean)
+                  filterExpr: (((smallint_col_19 = -92S) and UDFToLong(tinyint_col_15) is not null and decimal2709_col_9 is not null and tinyint_col_20 is not null) or (timestamp_col_18 is not null and decimal1911_col_16 is not null)) (type: boolean)
                   Statistics: Num rows: 1 Data size: 124 Basic stats: COMPLETE Column stats: NONE
                   Filter Operator
-                    predicate: (UDFToLong(tinyint_col_15) is not null and decimal2709_col_9 is not null and tinyint_col_20 is not null and UDFToInteger(smallint_col_19) is not null) (type: boolean)
+                    predicate: ((smallint_col_19 = -92S) and UDFToLong(tinyint_col_15) is not null and decimal2709_col_9 is not null and tinyint_col_20 is not null) (type: boolean)
                     Statistics: Num rows: 1 Data size: 124 Basic stats: COMPLETE Column stats: NONE
                     Select Operator
-                      expressions: tinyint_col_15 (type: tinyint), decimal2709_col_9 (type: decimal(27,9)), tinyint_col_20 (type: tinyint), smallint_col_19 (type: smallint)
-                      outputColumnNames: _col0, _col1, _col2, _col3
+                      expressions: tinyint_col_15 (type: tinyint), decimal2709_col_9 (type: decimal(27,9)), tinyint_col_20 (type: tinyint)
+                      outputColumnNames: _col0, _col1, _col2
                       Statistics: Num rows: 1 Data size: 124 Basic stats: COMPLETE Column stats: NONE
                       Reduce Output Operator
                         key expressions: _col1 (type: decimal(34,16)), _col2 (type: tinyint), UDFToLong(_col0) (type: bigint)
@@ -129,7 +129,6 @@ STAGE PLANS:
                         sort order: +++
                         Map-reduce partition columns: _col1 (type: decimal(34,16)), _col2 (type: tinyint), UDFToLong(_col0) (type: bigint)
                         Statistics: Num rows: 1 Data size: 124 Basic stats: COMPLETE Column stats: NONE
-                        value expressions: _col3 (type: smallint)
                       Select Operator
                         expressions: _col1 (type: decimal(34,16)), _col2 (type: tinyint), UDFToLong(_col0) (type: bigint), hash(hash(_col1,_col2),UDFToLong(_col0)) (type: int)
                         outputColumnNames: _col0, _col1, _col2, _col4
@@ -191,13 +190,13 @@ STAGE PLANS:
                 keys:
                   0 _col1 (type: decimal(34,16)), _col2 (type: tinyint), _col0 (type: bigint)
                   1 _col1 (type: decimal(34,16)), _col2 (type: tinyint), UDFToLong(_col0) (type: bigint)
-                outputColumnNames: _col3, _col7
+                outputColumnNames: _col3
                 Statistics: Num rows: 1 Data size: 180 Basic stats: COMPLETE Column stats: NONE
                 Reduce Output Operator
-                  key expressions: _col3 (type: timestamp), UDFToInteger(_col7) (type: int)
-                  null sort order: zz
-                  sort order: ++
-                  Map-reduce partition columns: _col3 (type: timestamp), UDFToInteger(_col7) (type: int)
+                  key expressions: _col3 (type: timestamp)
+                  null sort order: z
+                  sort order: +
+                  Map-reduce partition columns: _col3 (type: timestamp)
                   Statistics: Num rows: 1 Data size: 180 Basic stats: COMPLETE Column stats: NONE
         Reducer 3 
             Execution mode: llap
@@ -206,8 +205,8 @@ STAGE PLANS:
                 condition map:
                      Left Semi Join 0 to 1
                 keys:
-                  0 _col3 (type: timestamp), UDFToInteger(_col7) (type: int)
-                  1 _col0 (type: timestamp), _col1 (type: int)
+                  0 _col3 (type: timestamp)
+                  1 _col0 (type: timestamp)
                 Statistics: Num rows: 1 Data size: 198 Basic stats: COMPLETE Column stats: NONE
                 Group By Operator
                   aggregations: count()
@@ -260,20 +259,20 @@ STAGE PLANS:
                 outputColumnNames: _col1
                 Statistics: Num rows: 1 Data size: 167 Basic stats: COMPLETE Column stats: NONE
                 Select Operator
-                  expressions: _col1 (type: timestamp), -92 (type: int)
-                  outputColumnNames: _col0, _col1
+                  expressions: _col1 (type: timestamp)
+                  outputColumnNames: _col0
                   Statistics: Num rows: 1 Data size: 167 Basic stats: COMPLETE Column stats: NONE
                   Group By Operator
-                    keys: _col0 (type: timestamp), _col1 (type: int)
+                    keys: _col0 (type: timestamp)
                     minReductionHashAggr: 0.99
                     mode: hash
-                    outputColumnNames: _col0, _col1
+                    outputColumnNames: _col0
                     Statistics: Num rows: 1 Data size: 167 Basic stats: COMPLETE Column stats: NONE
                     Reduce Output Operator
-                      key expressions: _col0 (type: timestamp), _col1 (type: int)
-                      null sort order: zz
-                      sort order: ++
-                      Map-reduce partition columns: _col0 (type: timestamp), _col1 (type: int)
+                      key expressions: _col0 (type: timestamp)
+                      null sort order: z
+                      sort order: +
+                      Map-reduce partition columns: _col0 (type: timestamp)
                       Statistics: Num rows: 1 Data size: 167 Basic stats: COMPLETE Column stats: NONE
                     Select Operator
                       expressions: _col0 (type: timestamp)
diff --git a/ql/src/test/results/clientpositive/llap/explainuser_1.q.out b/ql/src/test/results/clientpositive/llap/explainuser_1.q.out
index 7634f7b18d..8d93908a99 100644
--- a/ql/src/test/results/clientpositive/llap/explainuser_1.q.out
+++ b/ql/src/test/results/clientpositive/llap/explainuser_1.q.out
@@ -2378,25 +2378,25 @@ Stage-0
         Select Operator [SEL_20] (rows=2 width=8)
           Output:["_col0","_col1"]
           Merge Join Operator [MERGEJOIN_51] (rows=2 width=8)
-            Conds:RS_17._col1, _col4=RS_18._col0, _col1(Left Semi),Output:["_col0","_col3"]
+            Conds:RS_17._col1=RS_18._col0(Left Semi),Output:["_col0","_col3"]
           <-Map 4 [SIMPLE_EDGE] llap
             SHUFFLE [RS_18]
-              PartitionCols:_col0, _col1
-              Group By Operator [GBY_16] (rows=2 width=8)
-                Output:["_col0","_col1"],keys:_col0, _col1
-                Select Operator [SEL_14] (rows=2 width=8)
-                  Output:["_col0","_col1"]
+              PartitionCols:_col0
+              Group By Operator [GBY_16] (rows=2 width=4)
+                Output:["_col0"],keys:_col0
+                Select Operator [SEL_14] (rows=2 width=4)
+                  Output:["_col0"]
                   Filter Operator [FIL_29] (rows=2 width=96)
                     predicate:((l_linenumber = 1) and (l_shipmode = 'AIR') and l_orderkey is not null)
                     TableScan [TS_12] (rows=100 width=96)
                       default@lineitem,lineitem,Tbl:COMPLETE,Col:COMPLETE,Output:["l_orderkey","l_linenumber","l_shipmode","l_partkey"]
           <-Reducer 2 [SIMPLE_EDGE] llap
             SHUFFLE [RS_17]
-              PartitionCols:_col1, _col4
+              PartitionCols:_col1
               Select Operator [SEL_11] (rows=14 width=16)
-                Output:["_col0","_col1","_col3","_col4"]
-                Merge Join Operator [MERGEJOIN_50] (rows=14 width=16)
-                  Conds:RS_8._col1=RS_9._col0(Left Semi),Output:["_col0","_col1","_col2","_col3"]
+                Output:["_col0","_col1","_col3"]
+                Merge Join Operator [MERGEJOIN_50] (rows=14 width=12)
+                  Conds:RS_8._col1=RS_9._col0(Left Semi),Output:["_col0","_col1","_col2"]
                 <-Map 4 [SIMPLE_EDGE] llap
                   SHUFFLE [RS_9]
                     PartitionCols:_col0
@@ -2411,7 +2411,7 @@ Stage-0
                   SHUFFLE [RS_8]
                     PartitionCols:_col1
                     Select Operator [SEL_2] (rows=14 width=16)
-                      Output:["_col0","_col1","_col2","_col3"]
+                      Output:["_col0","_col1","_col2"]
                       Filter Operator [FIL_27] (rows=14 width=16)
                         predicate:((l_linenumber = 1) and l_partkey is not null and l_orderkey is not null)
                         TableScan [TS_0] (rows=100 width=16)
diff --git a/ql/src/test/results/clientpositive/llap/external_jdbc_table_perf.q.out b/ql/src/test/results/clientpositive/llap/external_jdbc_table_perf.q.out
index 175f150808..f164a10a21 100644
--- a/ql/src/test/results/clientpositive/llap/external_jdbc_table_perf.q.out
+++ b/ql/src/test/results/clientpositive/llap/external_jdbc_table_perf.q.out
@@ -3053,88 +3053,236 @@ STAGE PLANS:
     Tez
 #### A masked pattern was here ####
       Edges:
-        Map 1 <- Union 2 (CONTAINS)
-        Map 5 <- Union 2 (CONTAINS)
-        Map 6 <- Union 2 (CONTAINS)
-        Reducer 3 <- Union 2 (SIMPLE_EDGE)
-        Reducer 4 <- Reducer 3 (SIMPLE_EDGE)
+        Reducer 10 <- Map 13 (SIMPLE_EDGE), Map 7 (SIMPLE_EDGE)
+        Reducer 11 <- Reducer 10 (SIMPLE_EDGE), Union 4 (CONTAINS)
+        Reducer 2 <- Map 1 (SIMPLE_EDGE), Map 7 (SIMPLE_EDGE)
+        Reducer 3 <- Reducer 2 (SIMPLE_EDGE), Union 4 (CONTAINS)
+        Reducer 5 <- Union 4 (SIMPLE_EDGE)
+        Reducer 6 <- Reducer 5 (SIMPLE_EDGE)
+        Reducer 8 <- Map 12 (SIMPLE_EDGE), Map 7 (SIMPLE_EDGE)
+        Reducer 9 <- Reducer 8 (SIMPLE_EDGE), Union 4 (CONTAINS)
 #### A masked pattern was here ####
       Vertices:
         Map 1 
             Map Operator Tree:
                 TableScan
-                  alias: item
+                  alias: store_sales
+                  properties:
+                    hive.sql.query SELECT "t0"."ss_sold_date_sk", "t0"."ss_sold_time_sk", "t0"."ss_item_sk", "t0"."ss_customer_sk", "t0"."ss_cdemo_sk", "t0"."ss_hdemo_sk", "t0"."ss_addr_sk", "t0"."ss_store_sk", "t0"."ss_promo_sk", "t0"."ss_ticket_number", "t0"."ss_quantity", "t0"."ss_wholesale_cost", "t0"."ss_list_price", "t0"."ss_sales_price", "t0"."ss_ext_discount_amt", "t0"."ss_ext_sales_price", "t0"."ss_ext_wholesale_cost", "t0"."ss_ext_list_price", "t0"."ss_ext_tax", "t0"."ss_coupon_amt", "t0"."ss_net_paid", "t0"."ss_net_paid_inc_tax", "t0"."ss_net_profit", "t6"."d_date_sk", "t6"."d_date_id", "t6"."d_date", "t6"."d_month_seq", "t6"."d_week_seq", "t6"."d_quarter_seq", "t6"."d_year", "t6"."d_dow", "t6"."d_moy", "t6"."d_dom", "t6"."d_qoy", "t6"."d_fy_year", "t6"."d_fy_quarter_seq", "t6"."d_fy_week_seq", "t6"."d_day_name", "t6"."d_quarter_name", "t6"."d_holiday", "t6"."d_weekend", "t6"."d_following_holiday", "t6"."d_first_dom", "t6"."d_last_dom", "t6"."d_same_day_ly", "t6"."d_same_day_lq", "t6"."d_current_day", "t6"."d_current_week", "t6"."d_current_month", "t6"."d_current_quarter", "t6"."d_current_year", "t2"."ca_address_sk", "t2"."ca_address_id", "t2"."ca_street_number", "t2"."ca_street_name", "t2"."ca_street_type", "t2"."ca_suite_number", "t2"."ca_city", "t2"."ca_county", "t2"."ca_state", "t2"."ca_zip", "t2"."ca_country", "t2"."ca_gmt_offset", "t2"."ca_location_type", "t4"."i_item_sk", "t4"."i_item_id", "t4"."i_rec_start_date", "t4"."i_rec_end_date", "t4"."i_item_desc", "t4"."i_current_price", "t4"."i_wholesale_cost", "t4"."i_brand_id", "t4"."i_brand", "t4"."i_class_id", "t4"."i_class", "t4"."i_category_id", "t4"."i_category", "t4"."i_manufact_id", "t4"."i_manufact", "t4"."i_size", "t4"."i_formulation", "t4"."i_color", "t4"."i_units", "t4"."i_container", "t4"."i_manager_id", "t4"."i_product_name"
+FROM (SELECT "ss_sold_date_sk", "ss_sold_time_sk", "ss_item_sk", "ss_customer_sk", "ss_cdemo_sk", "ss_hdemo_sk", "ss_addr_sk", "ss_store_sk", "ss_promo_sk", "ss_ticket_number", "ss_quantity", "ss_wholesale_cost", "ss_list_price", "ss_sales_price", "ss_ext_discount_amt", "ss_ext_sales_price", "ss_ext_wholesale_cost", "ss_ext_list_price", "ss_ext_tax", "ss_coupon_amt", "ss_net_paid", "ss_net_paid_inc_tax", "ss_net_profit"
+FROM "STORE_SALES"
+WHERE "ss_sold_date_sk" IS NOT NULL AND "ss_addr_sk" IS NOT NULL AND "ss_item_sk" IS NOT NULL) AS "t0"
+INNER JOIN (SELECT "ca_address_sk", "ca_address_id", "ca_street_number", "ca_street_name", "ca_street_type", "ca_suite_number", "ca_city", "ca_county", "ca_state", "ca_zip", "ca_country", "ca_gmt_offset", "ca_location_type"
+FROM "CUSTOMER_ADDRESS"
+WHERE "ca_gmt_offset" = -8 AND "ca_address_sk" IS NOT NULL) AS "t2" ON "t0"."ss_addr_sk" = "t2"."ca_address_sk"
+INNER JOIN (SELECT "i_item_sk", "i_item_id", "i_rec_start_date", "i_rec_end_date", "i_item_desc", "i_current_price", "i_wholesale_cost", "i_brand_id", "i_brand", "i_class_id", "i_class", "i_category_id", "i_category", "i_manufact_id", "i_manufact", "i_size", "i_formulation", "i_color", "i_units", "i_container", "i_manager_id", "i_product_name"
+FROM "ITEM"
+WHERE "i_item_id" IS NOT NULL AND "i_item_sk" IS NOT NULL) AS "t4" ON "t0"."ss_item_sk" = "t4"."i_item_sk"
+INNER JOIN (SELECT "d_date_sk", "d_date_id", "d_date", "d_month_seq", "d_week_seq", "d_quarter_seq", "d_year", "d_dow", "d_moy", "d_dom", "d_qoy", "d_fy_year", "d_fy_quarter_seq", "d_fy_week_seq", "d_day_name", "d_quarter_name", "d_holiday", "d_weekend", "d_following_holiday", "d_first_dom", "d_last_dom", "d_same_day_ly", "d_same_day_lq", "d_current_day", "d_current_week", "d_current_month", "d_current_quarter", "d_current_year"
+FROM "DATE_DIM"
+WHERE "d_year" = 2000 AND "d_moy" = 1 AND "d_date_sk" IS NOT NULL) AS "t6" ON "t0"."ss_sold_date_sk" = "t6"."d_date_sk"
+                    hive.sql.query.fieldNames ss_sold_date_sk,ss_sold_time_sk,ss_item_sk,ss_customer_sk,ss_cdemo_sk,ss_hdemo_sk,ss_addr_sk,ss_store_sk,ss_promo_sk,ss_ticket_number,ss_quantity,ss_wholesale_cost,ss_list_price,ss_sales_price,ss_ext_discount_amt,ss_ext_sales_price,ss_ext_wholesale_cost,ss_ext_list_price,ss_ext_tax,ss_coupon_amt,ss_net_paid,ss_net_paid_inc_tax,ss_net_profit,d_date_sk,d_date_id,d_date,d_month_seq,d_week_seq,d_quarter_seq,d_year,d_dow,d_moy,d_dom,d_qoy,d_fy_year,d_fy_quarter_seq,d_fy_week_seq,d_day_name,d_quarter_name,d_holiday,d_weekend,d_following_holiday,d_first_dom,d_last_dom,d_same_day_ly,d_same_day_lq,d_current_day,d_current_week,d_current_month,d_current_quarter,d_current_year,ca_address_sk,ca_address_id,ca_street_number,ca_street_name,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset,ca_location_type,i_item_sk,i_item_id,i_rec_start_date,i_rec_end_date,i_item_desc,i_current_price,i_wholesale_cost,i_brand_id,i_brand,i_class_id,i_class,i_category_id,i_category,i_manufact_id,i_manufact,i_size,i_formulation,i_color,i_units,i_container,i_manager_id,i_product_name
+                    hive.sql.query.fieldTypes int,int,int,int,int,int,int,int,int,int,int,decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),int,char(16),date,int,int,int,int,int,int,int,int,int,int,int,char(9),char(6),char(1),char(1),char(1),int,int,int,int,char(1),char(1),char(1),char(1),char(1),int,char(16),char(10),varchar(60),char(15),char(10),varchar(60),varchar(30),char(2),char(10),varchar(20),decimal(5,2),char(20),int,char(16),date,date,varchar(200),decimal(7,2),decimal(7,2),int,char(50),int,char(50),int,char(50),int,char(50),char(20),char(20),char(20),char(10),char(10),int,char(50)
+                    hive.sql.query.split false
                   Statistics: Num rows: 1 Data size: 212 Basic stats: COMPLETE Column stats: NONE
                   Select Operator
-                    expressions: i_item_id (type: char(16)), $f1 (type: decimal(17,2))
-                    outputColumnNames: _col0, _col1
+                    expressions: ss_ext_sales_price (type: decimal(7,2)), i_item_id (type: char(16))
+                    outputColumnNames: _col15, _col65
                     Statistics: Num rows: 1 Data size: 212 Basic stats: COMPLETE Column stats: NONE
-                    Group By Operator
-                      aggregations: sum(_col1)
-                      keys: _col0 (type: char(16))
-                      minReductionHashAggr: 0.99
-                      mode: hash
-                      outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 3 Data size: 636 Basic stats: COMPLETE Column stats: NONE
-                      Reduce Output Operator
-                        key expressions: _col0 (type: char(16))
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col0 (type: char(16))
-                        Statistics: Num rows: 3 Data size: 636 Basic stats: COMPLETE Column stats: NONE
-                        value expressions: _col1 (type: decimal(27,2))
+                    Reduce Output Operator
+                      key expressions: _col65 (type: char(16))
+                      null sort order: z
+                      sort order: +
+                      Map-reduce partition columns: _col65 (type: char(16))
+                      Statistics: Num rows: 1 Data size: 212 Basic stats: COMPLETE Column stats: NONE
+                      value expressions: _col15 (type: decimal(7,2))
             Execution mode: vectorized, llap
             LLAP IO: no inputs
-        Map 5 
+        Map 12 
             Map Operator Tree:
                 TableScan
-                  alias: item
+                  alias: catalog_sales
+                  properties:
+                    hive.sql.query SELECT "t0"."cs_sold_date_sk", "t0"."cs_sold_time_sk", "t0"."cs_ship_date_sk", "t0"."cs_bill_customer_sk", "t0"."cs_bill_cdemo_sk", "t0"."cs_bill_hdemo_sk", "t0"."cs_bill_addr_sk", "t0"."cs_ship_customer_sk", "t0"."cs_ship_cdemo_sk", "t0"."cs_ship_hdemo_sk", "t0"."cs_ship_addr_sk", "t0"."cs_call_center_sk", "t0"."cs_catalog_page_sk", "t0"."cs_ship_mode_sk", "t0"."cs_warehouse_sk", "t0"."cs_item_sk", "t0"."cs_promo_sk", "t0"."cs_order_number", "t0"."cs_quantity", "t0"."cs_wholesale_cost", "t0"."cs_list_price", "t0"."cs_sales_price", "t0"."cs_ext_discount_amt", "t0"."cs_ext_sales_price", "t0"."cs_ext_wholesale_cost", "t0"."cs_ext_list_price", "t0"."cs_ext_tax", "t0"."cs_coupon_amt", "t0"."cs_ext_ship_cost", "t0"."cs_net_paid", "t0"."cs_net_paid_inc_tax", "t0"."cs_net_paid_inc_ship", "t0"."cs_net_paid_inc_ship_tax", "t0"."cs_net_profit", "t6"."d_date_sk", "t6"."d_date_id", "t6"."d_date", "t6"."d_month_seq", "t6"."d_week_seq", "t6"."d_quarter_seq", "t6"."d_year", "t6"."d_dow", "t6"."d_moy", "t6"."d_dom", "t6"."d_qoy", "t6"."d_fy_year", "t6"."d_fy_quarter_seq", "t6"."d_fy_week_seq", "t6"."d_day_name", "t6"."d_quarter_name", "t6"."d_holiday", "t6"."d_weekend", "t6"."d_following_holiday", "t6"."d_first_dom", "t6"."d_last_dom", "t6"."d_same_day_ly", "t6"."d_same_day_lq", "t6"."d_current_day", "t6"."d_current_week", "t6"."d_current_month", "t6"."d_current_quarter", "t6"."d_current_year", "t2"."ca_address_sk", "t2"."ca_address_id", "t2"."ca_street_number", "t2"."ca_street_name", "t2"."ca_street_type", "t2"."ca_suite_number", "t2"."ca_city", "t2"."ca_county", "t2"."ca_state", "t2"."ca_zip", "t2"."ca_country", "t2"."ca_gmt_offset", "t2"."ca_location_type", "t4"."i_item_sk", "t4"."i_item_id", "t4"."i_rec_start_date", "t4"."i_rec_end_date", "t4"."i_item_desc", "t4"."i_current_price", "t4"."i_wholesale_cost", "t4"."i_brand_id", "t4"."i_brand", "t4"."i_class_id", "t4"."i_class", "t4"."i_category_id", "t4"."i_category", "t4"."i_manufact_id", "t4"."i_manufact", "t4"."i_size", "t4"."i_formulation", "t4"."i_color", "t4"."i_units", "t4"."i_container", "t4"."i_manager_id", "t4"."i_product_name"
+FROM (SELECT "cs_sold_date_sk", "cs_sold_time_sk", "cs_ship_date_sk", "cs_bill_customer_sk", "cs_bill_cdemo_sk", "cs_bill_hdemo_sk", "cs_bill_addr_sk", "cs_ship_customer_sk", "cs_ship_cdemo_sk", "cs_ship_hdemo_sk", "cs_ship_addr_sk", "cs_call_center_sk", "cs_catalog_page_sk", "cs_ship_mode_sk", "cs_warehouse_sk", "cs_item_sk", "cs_promo_sk", "cs_order_number", "cs_quantity", "cs_wholesale_cost", "cs_list_price", "cs_sales_price", "cs_ext_discount_amt", "cs_ext_sales_price", "cs_ext_wholesale_cost", "cs_ext_list_price", "cs_ext_tax", "cs_coupon_amt", "cs_ext_ship_cost", "cs_net_paid", "cs_net_paid_inc_tax", "cs_net_paid_inc_ship", "cs_net_paid_inc_ship_tax", "cs_net_profit"
+FROM "CATALOG_SALES"
+WHERE "cs_sold_date_sk" IS NOT NULL AND "cs_bill_addr_sk" IS NOT NULL AND "cs_item_sk" IS NOT NULL) AS "t0"
+INNER JOIN (SELECT "ca_address_sk", "ca_address_id", "ca_street_number", "ca_street_name", "ca_street_type", "ca_suite_number", "ca_city", "ca_county", "ca_state", "ca_zip", "ca_country", "ca_gmt_offset", "ca_location_type"
+FROM "CUSTOMER_ADDRESS"
+WHERE "ca_gmt_offset" = -8 AND "ca_address_sk" IS NOT NULL) AS "t2" ON "t0"."cs_bill_addr_sk" = "t2"."ca_address_sk"
+INNER JOIN (SELECT "i_item_sk", "i_item_id", "i_rec_start_date", "i_rec_end_date", "i_item_desc", "i_current_price", "i_wholesale_cost", "i_brand_id", "i_brand", "i_class_id", "i_class", "i_category_id", "i_category", "i_manufact_id", "i_manufact", "i_size", "i_formulation", "i_color", "i_units", "i_container", "i_manager_id", "i_product_name"
+FROM "ITEM"
+WHERE "i_item_id" IS NOT NULL AND "i_item_sk" IS NOT NULL) AS "t4" ON "t0"."cs_item_sk" = "t4"."i_item_sk"
+INNER JOIN (SELECT "d_date_sk", "d_date_id", "d_date", "d_month_seq", "d_week_seq", "d_quarter_seq", "d_year", "d_dow", "d_moy", "d_dom", "d_qoy", "d_fy_year", "d_fy_quarter_seq", "d_fy_week_seq", "d_day_name", "d_quarter_name", "d_holiday", "d_weekend", "d_following_holiday", "d_first_dom", "d_last_dom", "d_same_day_ly", "d_same_day_lq", "d_current_day", "d_current_week", "d_current_month", "d_current_quarter", "d_current_year"
+FROM "DATE_DIM"
+WHERE "d_year" = 2000 AND "d_moy" = 1 AND "d_date_sk" IS NOT NULL) AS "t6" ON "t0"."cs_sold_date_sk" = "t6"."d_date_sk"
+                    hive.sql.query.fieldNames cs_sold_date_sk,cs_sold_time_sk,cs_ship_date_sk,cs_bill_customer_sk,cs_bill_cdemo_sk,cs_bill_hdemo_sk,cs_bill_addr_sk,cs_ship_customer_sk,cs_ship_cdemo_sk,cs_ship_hdemo_sk,cs_ship_addr_sk,cs_call_center_sk,cs_catalog_page_sk,cs_ship_mode_sk,cs_warehouse_sk,cs_item_sk,cs_promo_sk,cs_order_number,cs_quantity,cs_wholesale_cost,cs_list_price,cs_sales_price,cs_ext_discount_amt,cs_ext_sales_price,cs_ext_wholesale_cost,cs_ext_list_price,cs_ext_tax,cs_coupon_amt,cs_ext_ship_cost,cs_net_paid,cs_net_paid_inc_tax,cs_net_paid_inc_ship,cs_net_paid_inc_ship_tax,cs_net_profit,d_date_sk,d_date_id,d_date,d_month_seq,d_week_seq,d_quarter_seq,d_year,d_dow,d_moy,d_dom,d_qoy,d_fy_year,d_fy_quarter_seq,d_fy_week_seq,d_day_name,d_quarter_name,d_holiday,d_weekend,d_following_holiday,d_first_dom,d_last_dom,d_same_day_ly,d_same_day_lq,d_current_day,d_current_week,d_current_month,d_current_quarter,d_current_year,ca_address_sk,ca_address_id,ca_street_number,ca_street_name,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset,ca_location_type,i_item_sk,i_item_id,i_rec_start_date,i_rec_end_date,i_item_desc,i_current_price,i_wholesale_cost,i_brand_id,i_brand,i_class_id,i_class,i_category_id,i_category,i_manufact_id,i_manufact,i_size,i_formulation,i_color,i_units,i_container,i_manager_id,i_product_name
+                    hive.sql.query.fieldTypes int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),int,char(16),date,int,int,int,int,int,int,int,int,int,int,int,char(9),char(6),char(1),char(1),char(1),int,int,int,int,char(1),char(1),char(1),char(1),char(1),int,char(16),char(10),varchar(60),char(15),char(10),varchar(60),varchar(30),char(2),char(10),varchar(20),decimal(5,2),char(20),int,char(16),date,date,varchar(200),decimal(7,2),decimal(7,2),int,char(50),int,char(50),int,char(50),int,char(50),char(20),char(20),char(20),char(10),char(10),int,char(50)
+                    hive.sql.query.split false
                   Statistics: Num rows: 1 Data size: 212 Basic stats: COMPLETE Column stats: NONE
                   Select Operator
-                    expressions: i_item_id (type: char(16)), $f1 (type: decimal(17,2))
-                    outputColumnNames: _col0, _col1
+                    expressions: cs_ext_sales_price (type: decimal(7,2)), i_item_id (type: char(16))
+                    outputColumnNames: _col23, _col76
                     Statistics: Num rows: 1 Data size: 212 Basic stats: COMPLETE Column stats: NONE
-                    Group By Operator
-                      aggregations: sum(_col1)
-                      keys: _col0 (type: char(16))
-                      minReductionHashAggr: 0.99
-                      mode: hash
-                      outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 3 Data size: 636 Basic stats: COMPLETE Column stats: NONE
-                      Reduce Output Operator
-                        key expressions: _col0 (type: char(16))
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col0 (type: char(16))
-                        Statistics: Num rows: 3 Data size: 636 Basic stats: COMPLETE Column stats: NONE
-                        value expressions: _col1 (type: decimal(27,2))
+                    Reduce Output Operator
+                      key expressions: _col76 (type: char(16))
+                      null sort order: z
+                      sort order: +
+                      Map-reduce partition columns: _col76 (type: char(16))
+                      Statistics: Num rows: 1 Data size: 212 Basic stats: COMPLETE Column stats: NONE
+                      value expressions: _col23 (type: decimal(7,2))
             Execution mode: vectorized, llap
             LLAP IO: no inputs
-        Map 6 
+        Map 13 
             Map Operator Tree:
                 TableScan
-                  alias: item
+                  alias: web_sales
+                  properties:
+                    hive.sql.query SELECT "t0"."ws_sold_date_sk", "t0"."ws_sold_time_sk", "t0"."ws_ship_date_sk", "t0"."ws_item_sk", "t0"."ws_bill_customer_sk", "t0"."ws_bill_cdemo_sk", "t0"."ws_bill_hdemo_sk", "t0"."ws_bill_addr_sk", "t0"."ws_ship_customer_sk", "t0"."ws_ship_cdemo_sk", "t0"."ws_ship_hdemo_sk", "t0"."ws_ship_addr_sk", "t0"."ws_web_page_sk", "t0"."ws_web_site_sk", "t0"."ws_ship_mode_sk", "t0"."ws_warehouse_sk", "t0"."ws_promo_sk", "t0"."ws_order_number", "t0"."ws_quantity", "t0"."ws_wholesale_cost", "t0"."ws_list_price", "t0"."ws_sales_price", "t0"."ws_ext_discount_amt", "t0"."ws_ext_sales_price", "t0"."ws_ext_wholesale_cost", "t0"."ws_ext_list_price", "t0"."ws_ext_tax", "t0"."ws_coupon_amt", "t0"."ws_ext_ship_cost", "t0"."ws_net_paid", "t0"."ws_net_paid_inc_tax", "t0"."ws_net_paid_inc_ship", "t0"."ws_net_paid_inc_ship_tax", "t0"."ws_net_profit", "t6"."d_date_sk", "t6"."d_date_id", "t6"."d_date", "t6"."d_month_seq", "t6"."d_week_seq", "t6"."d_quarter_seq", "t6"."d_year", "t6"."d_dow", "t6"."d_moy", "t6"."d_dom", "t6"."d_qoy", "t6"."d_fy_year", "t6"."d_fy_quarter_seq", "t6"."d_fy_week_seq", "t6"."d_day_name", "t6"."d_quarter_name", "t6"."d_holiday", "t6"."d_weekend", "t6"."d_following_holiday", "t6"."d_first_dom", "t6"."d_last_dom", "t6"."d_same_day_ly", "t6"."d_same_day_lq", "t6"."d_current_day", "t6"."d_current_week", "t6"."d_current_month", "t6"."d_current_quarter", "t6"."d_current_year", "t2"."ca_address_sk", "t2"."ca_address_id", "t2"."ca_street_number", "t2"."ca_street_name", "t2"."ca_street_type", "t2"."ca_suite_number", "t2"."ca_city", "t2"."ca_county", "t2"."ca_state", "t2"."ca_zip", "t2"."ca_country", "t2"."ca_gmt_offset", "t2"."ca_location_type", "t4"."i_item_sk", "t4"."i_item_id", "t4"."i_rec_start_date", "t4"."i_rec_end_date", "t4"."i_item_desc", "t4"."i_current_price", "t4"."i_wholesale_cost", "t4"."i_brand_id", "t4"."i_brand", "t4"."i_class_id", "t4"."i_class", "t4"."i_category_id", "t4"."i_category", "t4"."i_manufact_id", "t4"."i_manufact", "t4"."i_size", "t4"."i_formulation", "t4"."i_color", "t4"."i_units", "t4"."i_container", "t4"."i_manager_id", "t4"."i_product_name"
+FROM (SELECT "ws_sold_date_sk", "ws_sold_time_sk", "ws_ship_date_sk", "ws_item_sk", "ws_bill_customer_sk", "ws_bill_cdemo_sk", "ws_bill_hdemo_sk", "ws_bill_addr_sk", "ws_ship_customer_sk", "ws_ship_cdemo_sk", "ws_ship_hdemo_sk", "ws_ship_addr_sk", "ws_web_page_sk", "ws_web_site_sk", "ws_ship_mode_sk", "ws_warehouse_sk", "ws_promo_sk", "ws_order_number", "ws_quantity", "ws_wholesale_cost", "ws_list_price", "ws_sales_price", "ws_ext_discount_amt", "ws_ext_sales_price", "ws_ext_wholesale_cost", "ws_ext_list_price", "ws_ext_tax", "ws_coupon_amt", "ws_ext_ship_cost", "ws_net_paid", "ws_net_paid_inc_tax", "ws_net_paid_inc_ship", "ws_net_paid_inc_ship_tax", "ws_net_profit"
+FROM "WEB_SALES"
+WHERE "ws_sold_date_sk" IS NOT NULL AND "ws_bill_addr_sk" IS NOT NULL AND "ws_item_sk" IS NOT NULL) AS "t0"
+INNER JOIN (SELECT "ca_address_sk", "ca_address_id", "ca_street_number", "ca_street_name", "ca_street_type", "ca_suite_number", "ca_city", "ca_county", "ca_state", "ca_zip", "ca_country", "ca_gmt_offset", "ca_location_type"
+FROM "CUSTOMER_ADDRESS"
+WHERE "ca_gmt_offset" = -8 AND "ca_address_sk" IS NOT NULL) AS "t2" ON "t0"."ws_bill_addr_sk" = "t2"."ca_address_sk"
+INNER JOIN (SELECT "i_item_sk", "i_item_id", "i_rec_start_date", "i_rec_end_date", "i_item_desc", "i_current_price", "i_wholesale_cost", "i_brand_id", "i_brand", "i_class_id", "i_class", "i_category_id", "i_category", "i_manufact_id", "i_manufact", "i_size", "i_formulation", "i_color", "i_units", "i_container", "i_manager_id", "i_product_name"
+FROM "ITEM"
+WHERE "i_item_id" IS NOT NULL AND "i_item_sk" IS NOT NULL) AS "t4" ON "t0"."ws_item_sk" = "t4"."i_item_sk"
+INNER JOIN (SELECT "d_date_sk", "d_date_id", "d_date", "d_month_seq", "d_week_seq", "d_quarter_seq", "d_year", "d_dow", "d_moy", "d_dom", "d_qoy", "d_fy_year", "d_fy_quarter_seq", "d_fy_week_seq", "d_day_name", "d_quarter_name", "d_holiday", "d_weekend", "d_following_holiday", "d_first_dom", "d_last_dom", "d_same_day_ly", "d_same_day_lq", "d_current_day", "d_current_week", "d_current_month", "d_current_quarter", "d_current_year"
+FROM "DATE_DIM"
+WHERE "d_year" = 2000 AND "d_moy" = 1 AND "d_date_sk" IS NOT NULL) AS "t6" ON "t0"."ws_sold_date_sk" = "t6"."d_date_sk"
+                    hive.sql.query.fieldNames ws_sold_date_sk,ws_sold_time_sk,ws_ship_date_sk,ws_item_sk,ws_bill_customer_sk,ws_bill_cdemo_sk,ws_bill_hdemo_sk,ws_bill_addr_sk,ws_ship_customer_sk,ws_ship_cdemo_sk,ws_ship_hdemo_sk,ws_ship_addr_sk,ws_web_page_sk,ws_web_site_sk,ws_ship_mode_sk,ws_warehouse_sk,ws_promo_sk,ws_order_number,ws_quantity,ws_wholesale_cost,ws_list_price,ws_sales_price,ws_ext_discount_amt,ws_ext_sales_price,ws_ext_wholesale_cost,ws_ext_list_price,ws_ext_tax,ws_coupon_amt,ws_ext_ship_cost,ws_net_paid,ws_net_paid_inc_tax,ws_net_paid_inc_ship,ws_net_paid_inc_ship_tax,ws_net_profit,d_date_sk,d_date_id,d_date,d_month_seq,d_week_seq,d_quarter_seq,d_year,d_dow,d_moy,d_dom,d_qoy,d_fy_year,d_fy_quarter_seq,d_fy_week_seq,d_day_name,d_quarter_name,d_holiday,d_weekend,d_following_holiday,d_first_dom,d_last_dom,d_same_day_ly,d_same_day_lq,d_current_day,d_current_week,d_current_month,d_current_quarter,d_current_year,ca_address_sk,ca_address_id,ca_street_number,ca_street_name,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset,ca_location_type,i_item_sk,i_item_id,i_rec_start_date,i_rec_end_date,i_item_desc,i_current_price,i_wholesale_cost,i_brand_id,i_brand,i_class_id,i_class,i_category_id,i_category,i_manufact_id,i_manufact,i_size,i_formulation,i_color,i_units,i_container,i_manager_id,i_product_name
+                    hive.sql.query.fieldTypes int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),int,char(16),date,int,int,int,int,int,int,int,int,int,int,int,char(9),char(6),char(1),char(1),char(1),int,int,int,int,char(1),char(1),char(1),char(1),char(1),int,char(16),char(10),varchar(60),char(15),char(10),varchar(60),varchar(30),char(2),char(10),varchar(20),decimal(5,2),char(20),int,char(16),date,date,varchar(200),decimal(7,2),decimal(7,2),int,char(50),int,char(50),int,char(50),int,char(50),char(20),char(20),char(20),char(10),char(10),int,char(50)
+                    hive.sql.query.split false
                   Statistics: Num rows: 1 Data size: 212 Basic stats: COMPLETE Column stats: NONE
                   Select Operator
-                    expressions: i_item_id (type: char(16)), $f1 (type: decimal(17,2))
-                    outputColumnNames: _col0, _col1
+                    expressions: ws_ext_sales_price (type: decimal(7,2)), i_item_id (type: char(16))
+                    outputColumnNames: _col23, _col76
                     Statistics: Num rows: 1 Data size: 212 Basic stats: COMPLETE Column stats: NONE
+                    Reduce Output Operator
+                      key expressions: _col76 (type: char(16))
+                      null sort order: z
+                      sort order: +
+                      Map-reduce partition columns: _col76 (type: char(16))
+                      Statistics: Num rows: 1 Data size: 212 Basic stats: COMPLETE Column stats: NONE
+                      value expressions: _col23 (type: decimal(7,2))
+            Execution mode: vectorized, llap
+            LLAP IO: no inputs
+        Map 7 
+            Map Operator Tree:
+                TableScan
+                  alias: item
+                  properties:
+                    hive.sql.query SELECT "i_item_id"
+FROM "ITEM"
+WHERE "i_color" IN ('orchid              ', 'chiffon             ', 'lace                ') AND "i_item_id" IS NOT NULL
+                    hive.sql.query.fieldNames i_item_id
+                    hive.sql.query.fieldTypes char(16)
+                    hive.sql.query.split true
+                  Statistics: Num rows: 1 Data size: 100 Basic stats: COMPLETE Column stats: NONE
+                  Select Operator
+                    expressions: i_item_id (type: char(16))
+                    outputColumnNames: _col0
+                    Statistics: Num rows: 1 Data size: 100 Basic stats: COMPLETE Column stats: NONE
                     Group By Operator
-                      aggregations: sum(_col1)
                       keys: _col0 (type: char(16))
                       minReductionHashAggr: 0.99
                       mode: hash
-                      outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 3 Data size: 636 Basic stats: COMPLETE Column stats: NONE
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 1 Data size: 100 Basic stats: COMPLETE Column stats: NONE
+                      Reduce Output Operator
+                        key expressions: _col0 (type: char(16))
+                        null sort order: z
+                        sort order: +
+                        Map-reduce partition columns: _col0 (type: char(16))
+                        Statistics: Num rows: 1 Data size: 100 Basic stats: COMPLETE Column stats: NONE
+                      Reduce Output Operator
+                        key expressions: _col0 (type: char(16))
+                        null sort order: z
+                        sort order: +
+                        Map-reduce partition columns: _col0 (type: char(16))
+                        Statistics: Num rows: 1 Data size: 100 Basic stats: COMPLETE Column stats: NONE
                       Reduce Output Operator
                         key expressions: _col0 (type: char(16))
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: char(16))
-                        Statistics: Num rows: 3 Data size: 636 Basic stats: COMPLETE Column stats: NONE
-                        value expressions: _col1 (type: decimal(27,2))
+                        Statistics: Num rows: 1 Data size: 100 Basic stats: COMPLETE Column stats: NONE
             Execution mode: vectorized, llap
             LLAP IO: no inputs
+        Reducer 10 
+            Execution mode: llap
+            Reduce Operator Tree:
+              Merge Join Operator
+                condition map:
+                     Left Semi Join 0 to 1
+                keys:
+                  0 _col76 (type: char(16))
+                  1 _col0 (type: char(16))
+                outputColumnNames: _col23, _col76
+                Statistics: Num rows: 1 Data size: 233 Basic stats: COMPLETE Column stats: NONE
+                Group By Operator
+                  aggregations: sum(_col23)
+                  keys: _col76 (type: char(16))
+                  minReductionHashAggr: 0.99
+                  mode: hash
+                  outputColumnNames: _col0, _col1
+                  Statistics: Num rows: 1 Data size: 233 Basic stats: COMPLETE Column stats: NONE
+                  Reduce Output Operator
+                    key expressions: _col0 (type: char(16))
+                    null sort order: z
+                    sort order: +
+                    Map-reduce partition columns: _col0 (type: char(16))
+                    Statistics: Num rows: 1 Data size: 233 Basic stats: COMPLETE Column stats: NONE
+                    value expressions: _col1 (type: decimal(17,2))
+        Reducer 11 
+            Execution mode: vectorized, llap
+            Reduce Operator Tree:
+              Group By Operator
+                aggregations: sum(VALUE._col0)
+                keys: KEY._col0 (type: char(16))
+                mode: mergepartial
+                outputColumnNames: _col0, _col1
+                Statistics: Num rows: 1 Data size: 233 Basic stats: COMPLETE Column stats: NONE
+                Group By Operator
+                  aggregations: sum(_col1)
+                  keys: _col0 (type: char(16))
+                  minReductionHashAggr: 0.99
+                  mode: hash
+                  outputColumnNames: _col0, _col1
+                  Statistics: Num rows: 3 Data size: 699 Basic stats: COMPLETE Column stats: NONE
+                  Reduce Output Operator
+                    key expressions: _col0 (type: char(16))
+                    null sort order: z
+                    sort order: +
+                    Map-reduce partition columns: _col0 (type: char(16))
+                    Statistics: Num rows: 3 Data size: 699 Basic stats: COMPLETE Column stats: NONE
+                    value expressions: _col1 (type: decimal(27,2))
+        Reducer 2 
+            Execution mode: llap
+            Reduce Operator Tree:
+              Merge Join Operator
+                condition map:
+                     Left Semi Join 0 to 1
+                keys:
+                  0 _col65 (type: char(16))
+                  1 _col0 (type: char(16))
+                outputColumnNames: _col15, _col65
+                Statistics: Num rows: 1 Data size: 233 Basic stats: COMPLETE Column stats: NONE
+                Group By Operator
+                  aggregations: sum(_col15)
+                  keys: _col65 (type: char(16))
+                  minReductionHashAggr: 0.99
+                  mode: hash
+                  outputColumnNames: _col0, _col1
+                  Statistics: Num rows: 1 Data size: 233 Basic stats: COMPLETE Column stats: NONE
+                  Reduce Output Operator
+                    key expressions: _col0 (type: char(16))
+                    null sort order: z
+                    sort order: +
+                    Map-reduce partition columns: _col0 (type: char(16))
+                    Statistics: Num rows: 1 Data size: 233 Basic stats: COMPLETE Column stats: NONE
+                    value expressions: _col1 (type: decimal(17,2))
         Reducer 3 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
@@ -3143,38 +3291,109 @@ STAGE PLANS:
                 keys: KEY._col0 (type: char(16))
                 mode: mergepartial
                 outputColumnNames: _col0, _col1
-                Statistics: Num rows: 1 Data size: 212 Basic stats: COMPLETE Column stats: NONE
+                Statistics: Num rows: 1 Data size: 233 Basic stats: COMPLETE Column stats: NONE
+                Group By Operator
+                  aggregations: sum(_col1)
+                  keys: _col0 (type: char(16))
+                  minReductionHashAggr: 0.99
+                  mode: hash
+                  outputColumnNames: _col0, _col1
+                  Statistics: Num rows: 3 Data size: 699 Basic stats: COMPLETE Column stats: NONE
+                  Reduce Output Operator
+                    key expressions: _col0 (type: char(16))
+                    null sort order: z
+                    sort order: +
+                    Map-reduce partition columns: _col0 (type: char(16))
+                    Statistics: Num rows: 3 Data size: 699 Basic stats: COMPLETE Column stats: NONE
+                    value expressions: _col1 (type: decimal(27,2))
+        Reducer 5 
+            Execution mode: vectorized, llap
+            Reduce Operator Tree:
+              Group By Operator
+                aggregations: sum(VALUE._col0)
+                keys: KEY._col0 (type: char(16))
+                mode: mergepartial
+                outputColumnNames: _col0, _col1
+                Statistics: Num rows: 1 Data size: 233 Basic stats: COMPLETE Column stats: NONE
                 Top N Key Operator
                   sort order: +
                   keys: _col1 (type: decimal(27,2))
                   null sort order: z
-                  Statistics: Num rows: 1 Data size: 212 Basic stats: COMPLETE Column stats: NONE
+                  Statistics: Num rows: 1 Data size: 233 Basic stats: COMPLETE Column stats: NONE
                   top n: 100
                   Reduce Output Operator
                     key expressions: _col1 (type: decimal(27,2))
                     null sort order: z
                     sort order: +
-                    Statistics: Num rows: 1 Data size: 212 Basic stats: COMPLETE Column stats: NONE
+                    Statistics: Num rows: 1 Data size: 233 Basic stats: COMPLETE Column stats: NONE
                     value expressions: _col0 (type: char(16))
-        Reducer 4 
+        Reducer 6 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Select Operator
                 expressions: VALUE._col0 (type: char(16)), KEY.reducesinkkey0 (type: decimal(27,2))
                 outputColumnNames: _col0, _col1
-                Statistics: Num rows: 1 Data size: 212 Basic stats: COMPLETE Column stats: NONE
+                Statistics: Num rows: 1 Data size: 233 Basic stats: COMPLETE Column stats: NONE
                 Limit
                   Number of rows: 100
-                  Statistics: Num rows: 1 Data size: 212 Basic stats: COMPLETE Column stats: NONE
+                  Statistics: Num rows: 1 Data size: 233 Basic stats: COMPLETE Column stats: NONE
                   File Output Operator
                     compressed: false
-                    Statistics: Num rows: 1 Data size: 212 Basic stats: COMPLETE Column stats: NONE
+                    Statistics: Num rows: 1 Data size: 233 Basic stats: COMPLETE Column stats: NONE
                     table:
                         input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                         output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
                         serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-        Union 2 
-            Vertex: Union 2
+        Reducer 8 
+            Execution mode: llap
+            Reduce Operator Tree:
+              Merge Join Operator
+                condition map:
+                     Left Semi Join 0 to 1
+                keys:
+                  0 _col76 (type: char(16))
+                  1 _col0 (type: char(16))
+                outputColumnNames: _col23, _col76
+                Statistics: Num rows: 1 Data size: 233 Basic stats: COMPLETE Column stats: NONE
+                Group By Operator
+                  aggregations: sum(_col23)
+                  keys: _col76 (type: char(16))
+                  minReductionHashAggr: 0.99
+                  mode: hash
+                  outputColumnNames: _col0, _col1
+                  Statistics: Num rows: 1 Data size: 233 Basic stats: COMPLETE Column stats: NONE
+                  Reduce Output Operator
+                    key expressions: _col0 (type: char(16))
+                    null sort order: z
+                    sort order: +
+                    Map-reduce partition columns: _col0 (type: char(16))
+                    Statistics: Num rows: 1 Data size: 233 Basic stats: COMPLETE Column stats: NONE
+                    value expressions: _col1 (type: decimal(17,2))
+        Reducer 9 
+            Execution mode: vectorized, llap
+            Reduce Operator Tree:
+              Group By Operator
+                aggregations: sum(VALUE._col0)
+                keys: KEY._col0 (type: char(16))
+                mode: mergepartial
+                outputColumnNames: _col0, _col1
+                Statistics: Num rows: 1 Data size: 233 Basic stats: COMPLETE Column stats: NONE
+                Group By Operator
+                  aggregations: sum(_col1)
+                  keys: _col0 (type: char(16))
+                  minReductionHashAggr: 0.99
+                  mode: hash
+                  outputColumnNames: _col0, _col1
+                  Statistics: Num rows: 3 Data size: 699 Basic stats: COMPLETE Column stats: NONE
+                  Reduce Output Operator
+                    key expressions: _col0 (type: char(16))
+                    null sort order: z
+                    sort order: +
+                    Map-reduce partition columns: _col0 (type: char(16))
+                    Statistics: Num rows: 3 Data size: 699 Basic stats: COMPLETE Column stats: NONE
+                    value expressions: _col1 (type: decimal(27,2))
+        Union 4 
+            Vertex: Union 4
 
   Stage: Stage-0
     Fetch Operator
@@ -3530,105 +3749,50 @@ STAGE PLANS:
 #### A masked pattern was here ####
       Edges:
         Reducer 10 <- Reducer 9 (SIMPLE_EDGE)
-        Reducer 11 <- Map 8 (SIMPLE_EDGE), Reducer 18 (SIMPLE_EDGE)
+        Reducer 11 <- Map 15 (SIMPLE_EDGE), Reducer 8 (SIMPLE_EDGE)
         Reducer 12 <- Reducer 11 (SIMPLE_EDGE)
-        Reducer 14 <- Map 13 (SIMPLE_EDGE), Reducer 17 (SIMPLE_EDGE)
-        Reducer 16 <- Map 15 (SIMPLE_EDGE), Map 19 (SIMPLE_EDGE)
-        Reducer 17 <- Reducer 16 (SIMPLE_EDGE)
-        Reducer 18 <- Map 20 (SIMPLE_EDGE), Reducer 17 (SIMPLE_EDGE)
-        Reducer 2 <- Map 1 (SIMPLE_EDGE), Reducer 17 (SIMPLE_EDGE)
-        Reducer 3 <- Map 8 (SIMPLE_EDGE), Reducer 2 (SIMPLE_EDGE)
-        Reducer 4 <- Reducer 3 (SIMPLE_EDGE)
-        Reducer 5 <- Reducer 10 (SIMPLE_EDGE), Reducer 4 (SIMPLE_EDGE)
-        Reducer 6 <- Reducer 12 (SIMPLE_EDGE), Reducer 5 (SIMPLE_EDGE)
-        Reducer 7 <- Reducer 6 (SIMPLE_EDGE)
-        Reducer 9 <- Map 8 (SIMPLE_EDGE), Reducer 14 (SIMPLE_EDGE)
+        Reducer 2 <- Map 1 (SIMPLE_EDGE), Reducer 8 (SIMPLE_EDGE)
+        Reducer 3 <- Reducer 2 (SIMPLE_EDGE)
+        Reducer 4 <- Reducer 10 (SIMPLE_EDGE), Reducer 3 (SIMPLE_EDGE)
+        Reducer 5 <- Reducer 12 (SIMPLE_EDGE), Reducer 4 (SIMPLE_EDGE)
+        Reducer 6 <- Reducer 5 (SIMPLE_EDGE)
+        Reducer 8 <- Map 13 (SIMPLE_EDGE), Map 7 (SIMPLE_EDGE)
+        Reducer 9 <- Map 14 (SIMPLE_EDGE), Reducer 8 (SIMPLE_EDGE)
 #### A masked pattern was here ####
       Vertices:
         Map 1 
             Map Operator Tree:
                 TableScan
-                  alias: date_dim
+                  alias: item
                   properties:
-                    hive.sql.query SELECT "t0"."d_date_sk", "t0"."d_date_id", "t0"."d_date", "t0"."d_month_seq", "t0"."d_week_seq", "t0"."d_quarter_seq", "t0"."d_year", "t0"."d_dow", "t0"."d_moy", "t0"."d_dom", "t0"."d_qoy", "t0"."d_fy_year", "t0"."d_fy_quarter_seq", "t0"."d_fy_week_seq", "t0"."d_day_name", "t0"."d_quarter_name", "t0"."d_holiday", "t0"."d_weekend", "t0"."d_following_holiday", "t0"."d_first_dom", "t0"."d_last_dom", "t0"."d_same_day_ly", "t0"."d_same_day_lq", "t0"."d_current_day", "t0"."d_current_week", "t0"."d_current_month", "t0"."d_current_quarter", "t0"."d_current_year", "t2"."sr_returned_date_sk", "t2"."sr_return_time_sk", "t2"."sr_item_sk", "t2"."sr_customer_sk", "t2"."sr_cdemo_sk", "t2"."sr_hdemo_sk", "t2"."sr_addr_sk", "t2"."sr_store_sk", "t2"."sr_reason_sk", "t2"."sr_ticket_number", "t2"."sr_return_quantity", "t2"."sr_return_amt", "t2"."sr_return_tax", "t2"."sr_return_amt_inc_tax", "t2"."sr_fee", "t2"."sr_return_ship_cost", "t2"."sr_refunded_cash", "t2"."sr_reversed_charge", "t2"."sr_store_credit", "t2"."sr_net_loss"
-FROM (SELECT "d_date_sk", "d_date_id", "d_date", "d_month_seq", "d_week_seq", "d_quarter_seq", "d_year", "d_dow", "d_moy", "d_dom", "d_qoy", "d_fy_year", "d_fy_quarter_seq", "d_fy_week_seq", "d_day_name", "d_quarter_name", "d_holiday", "d_weekend", "d_following_holiday", "d_first_dom", "d_last_dom", "d_same_day_ly", "d_same_day_lq", "d_current_day", "d_current_week", "d_current_month", "d_current_quarter", "d_current_year"
-FROM "DATE_DIM"
-WHERE "d_date" IS NOT NULL AND "d_date_sk" IS NOT NULL) AS "t0"
+                    hive.sql.query SELECT "t2"."sr_returned_date_sk", "t2"."sr_return_time_sk", "t2"."sr_item_sk", "t2"."sr_customer_sk", "t2"."sr_cdemo_sk", "t2"."sr_hdemo_sk", "t2"."sr_addr_sk", "t2"."sr_store_sk", "t2"."sr_reason_sk", "t2"."sr_ticket_number", "t2"."sr_return_quantity", "t2"."sr_return_amt", "t2"."sr_return_tax", "t2"."sr_return_amt_inc_tax", "t2"."sr_fee", "t2"."sr_return_ship_cost", "t2"."sr_refunded_cash", "t2"."sr_reversed_charge", "t2"."sr_store_credit", "t2"."sr_net_loss", "t0"."i_item_sk", "t0"."i_item_id", "t0"."i_rec_start_date", "t0"."i_rec_end_date", "t0"."i_item_desc", "t0"."i_current_price", "t0"."i_wholesale_cost", "t0"."i_brand_id", "t0"."i_brand", "t0"."i_class_id", "t0"."i_class", "t0"."i_category_id", "t0"."i_category", "t0"."i_manufact_id", "t0"."i_manufact", "t0"."i_size", "t0"."i_formulation", "t0"."i_color", "t0"."i_units", "t0"."i_container", "t0"."i_manager_id", "t0"."i_product_name", "t4"."d_date_sk", "t4"."d_date_id", "t4"."d_date", "t4"."d_month_seq", "t4"."d_week_seq", "t4"."d_quarter_seq", "t4"."d_year", "t4"."d_dow", "t4"."d_moy", "t4"."d_dom", "t4"."d_qoy", "t4"."d_fy_year", "t4"."d_fy_quarter_seq", "t4"."d_fy_week_seq", "t4"."d_day_name", "t4"."d_quarter_name", "t4"."d_holiday", "t4"."d_weekend", "t4"."d_following_holiday", "t4"."d_first_dom", "t4"."d_last_dom", "t4"."d_same_day_ly", "t4"."d_same_day_lq", "t4"."d_current_day", "t4"."d_current_week", "t4"."d_current_month", "t4"."d_current_quarter", "t4"."d_current_year"
+FROM (SELECT "i_item_sk", "i_item_id", "i_rec_start_date", "i_rec_end_date", "i_item_desc", "i_current_price", "i_wholesale_cost", "i_brand_id", "i_brand", "i_class_id", "i_class", "i_category_id", "i_category", "i_manufact_id", "i_manufact", "i_size", "i_formulation", "i_color", "i_units", "i_container", "i_manager_id", "i_product_name"
+FROM "ITEM"
+WHERE "i_item_sk" IS NOT NULL AND "i_item_id" IS NOT NULL) AS "t0"
 INNER JOIN (SELECT "sr_returned_date_sk", "sr_return_time_sk", "sr_item_sk", "sr_customer_sk", "sr_cdemo_sk", "sr_hdemo_sk", "sr_addr_sk", "sr_store_sk", "sr_reason_sk", "sr_ticket_number", "sr_return_quantity", "sr_return_amt", "sr_return_tax", "sr_return_amt_inc_tax", "sr_fee", "sr_return_ship_cost", "sr_refunded_cash", "sr_reversed_charge", "sr_store_credit", "sr_net_loss"
 FROM "STORE_RETURNS"
-WHERE "sr_item_sk" IS NOT NULL AND "sr_returned_date_sk" IS NOT NULL) AS "t2" ON "t0"."d_date_sk" = "t2"."sr_returned_date_sk"
-                    hive.sql.query.fieldNames d_date_sk,d_date_id,d_date,d_month_seq,d_week_seq,d_quarter_seq,d_year,d_dow,d_moy,d_dom,d_qoy,d_fy_year,d_fy_quarter_seq,d_fy_week_seq,d_day_name,d_quarter_name,d_holiday,d_weekend,d_following_holiday,d_first_dom,d_last_dom,d_same_day_ly,d_same_day_lq,d_current_day,d_current_week,d_current_month,d_current_quarter,d_current_year,sr_returned_date_sk,sr_return_time_sk,sr_item_sk,sr_customer_sk,sr_cdemo_sk,sr_hdemo_sk,sr_addr_sk,sr_store_sk,sr_reason_sk,sr_ticket_number,sr_return_quantity,sr_return_amt,sr_return_tax,sr_return_amt_inc_tax,sr_fee,sr_return_ship_cost,sr_refunded_cash,sr_reversed_charge,sr_store_credit,sr_net_loss
-                    hive.sql.query.fieldTypes int,char(16),date,int,int,int,int,int,int,int,int,int,int,int,char(9),char(6),char(1),char(1),char(1),int,int,int,int,char(1),char(1),char(1),char(1),char(1),int,int,int,int,int,int,int,int,int,int,int,decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2)
-                    hive.sql.query.split false
-                  Statistics: Num rows: 1 Data size: 64 Basic stats: COMPLETE Column stats: NONE
-                  Select Operator
-                    expressions: d_date (type: date), sr_item_sk (type: int), sr_return_quantity (type: int)
-                    outputColumnNames: _col2, _col30, _col38
-                    Statistics: Num rows: 1 Data size: 64 Basic stats: COMPLETE Column stats: NONE
-                    Reduce Output Operator
-                      key expressions: _col2 (type: date)
-                      null sort order: z
-                      sort order: +
-                      Map-reduce partition columns: _col2 (type: date)
-                      Statistics: Num rows: 1 Data size: 64 Basic stats: COMPLETE Column stats: NONE
-                      value expressions: _col30 (type: int), _col38 (type: int)
-            Execution mode: vectorized, llap
-            LLAP IO: no inputs
-        Map 13 
-            Map Operator Tree:
-                TableScan
-                  alias: date_dim
-                  properties:
-                    hive.sql.query SELECT "t0"."d_date_sk", "t0"."d_date_id", "t0"."d_date", "t0"."d_month_seq", "t0"."d_week_seq", "t0"."d_quarter_seq", "t0"."d_year", "t0"."d_dow", "t0"."d_moy", "t0"."d_dom", "t0"."d_qoy", "t0"."d_fy_year", "t0"."d_fy_quarter_seq", "t0"."d_fy_week_seq", "t0"."d_day_name", "t0"."d_quarter_name", "t0"."d_holiday", "t0"."d_weekend", "t0"."d_following_holiday", "t0"."d_first_dom", "t0"."d_last_dom", "t0"."d_same_day_ly", "t0"."d_same_day_lq", "t0"."d_current_day", "t0"."d_current_week", "t0"."d_current_month", "t0"."d_current_quarter", "t0"."d_current_year", "t2"."wr_returned_date_sk", "t2"."wr_returned_time_sk", "t2"."wr_item_sk", "t2"."wr_refunded_customer_sk", "t2"."wr_refunded_cdemo_sk", "t2"."wr_refunded_hdemo_sk", "t2"."wr_refunded_addr_sk", "t2"."wr_returning_customer_sk", "t2"."wr_returning_cdemo_sk", "t2"."wr_returning_hdemo_sk", "t2"."wr_returning_addr_sk", "t2"."wr_web_page_sk", "t2"."wr_reason_sk", "t2"."wr_order_number", "t2"."wr_return_quantity", "t2"."wr_return_amt", "t2"."wr_return_tax", "t2"."wr_return_amt_inc_tax", "t2"."wr_fee", "t2"."wr_return_ship_cost", "t2"."wr_refunded_cash", "t2"."wr_reversed_charge", "t2"."wr_account_credit", "t2"."wr_net_loss"
-FROM (SELECT "d_date_sk", "d_date_id", "d_date", "d_month_seq", "d_week_seq", "d_quarter_seq", "d_year", "d_dow", "d_moy", "d_dom", "d_qoy", "d_fy_year", "d_fy_quarter_seq", "d_fy_week_seq", "d_day_name", "d_quarter_name", "d_holiday", "d_weekend", "d_following_holiday", "d_first_dom", "d_last_dom", "d_same_day_ly", "d_same_day_lq", "d_current_day", "d_current_week", "d_current_month", "d_current_quarter", "d_current_year"
+WHERE "sr_item_sk" IS NOT NULL AND "sr_returned_date_sk" IS NOT NULL) AS "t2" ON "t0"."i_item_sk" = "t2"."sr_item_sk"
+INNER JOIN (SELECT "d_date_sk", "d_date_id", "d_date", "d_month_seq", "d_week_seq", "d_quarter_seq", "d_year", "d_dow", "d_moy", "d_dom", "d_qoy", "d_fy_year", "d_fy_quarter_seq", "d_fy_week_seq", "d_day_name", "d_quarter_name", "d_holiday", "d_weekend", "d_following_holiday", "d_first_dom", "d_last_dom", "d_same_day_ly", "d_same_day_lq", "d_current_day", "d_current_week", "d_current_month", "d_current_quarter", "d_current_year"
 FROM "DATE_DIM"
-WHERE "d_date" IS NOT NULL AND "d_date_sk" IS NOT NULL) AS "t0"
-INNER JOIN (SELECT "wr_returned_date_sk", "wr_returned_time_sk", "wr_item_sk", "wr_refunded_customer_sk", "wr_refunded_cdemo_sk", "wr_refunded_hdemo_sk", "wr_refunded_addr_sk", "wr_returning_customer_sk", "wr_returning_cdemo_sk", "wr_returning_hdemo_sk", "wr_returning_addr_sk", "wr_web_page_sk", "wr_reason_sk", "wr_order_number", "wr_return_quantity", "wr_return_amt", "wr_return_tax", "wr_return_amt_inc_tax", "wr_fee", "wr_return_ship_cost", "wr_refunded_cash", "wr_reversed_charge", "wr_account_credit", "wr_net_loss"
-FROM "WEB_RETURNS"
-WHERE "wr_item_sk" IS NOT NULL AND "wr_returned_date_sk" IS NOT NULL) AS "t2" ON "t0"."d_date_sk" = "t2"."wr_returned_date_sk"
-                    hive.sql.query.fieldNames d_date_sk,d_date_id,d_date,d_month_seq,d_week_seq,d_quarter_seq,d_year,d_dow,d_moy,d_dom,d_qoy,d_fy_year,d_fy_quarter_seq,d_fy_week_seq,d_day_name,d_quarter_name,d_holiday,d_weekend,d_following_holiday,d_first_dom,d_last_dom,d_same_day_ly,d_same_day_lq,d_current_day,d_current_week,d_current_month,d_current_quarter,d_current_year,wr_returned_date_sk,wr_returned_time_sk,wr_item_sk,wr_refunded_customer_sk,wr_refunded_cdemo_sk,wr_refunded_hdemo_sk,wr_refunded_addr_sk,wr_returning_customer_sk,wr_returning_cdemo_sk,wr_returning_hdemo_sk,wr_returning_addr_sk,wr_web_page_sk,wr_reason_sk,wr_order_number,wr_return_quantity,wr_return_amt,wr_return_tax,wr_return_amt_inc_tax,wr_fee,wr_return_ship_cost,wr_refunded_cash,wr_reversed_charge,wr_account_credit,wr_net_loss
-                    hive.sql.query.fieldTypes int,char(16),date,int,int,int,int,int,int,int,int,int,int,int,char(9),char(6),char(1),char(1),char(1),int,int,int,int,char(1),char(1),char(1),char(1),char(1),int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2)
+WHERE "d_date" IS NOT NULL AND "d_date_sk" IS NOT NULL) AS "t4" ON "t2"."sr_returned_date_sk" = "t4"."d_date_sk"
+                    hive.sql.query.fieldNames sr_returned_date_sk,sr_return_time_sk,sr_item_sk,sr_customer_sk,sr_cdemo_sk,sr_hdemo_sk,sr_addr_sk,sr_store_sk,sr_reason_sk,sr_ticket_number,sr_return_quantity,sr_return_amt,sr_return_tax,sr_return_amt_inc_tax,sr_fee,sr_return_ship_cost,sr_refunded_cash,sr_reversed_charge,sr_store_credit,sr_net_loss,i_item_sk,i_item_id,i_rec_start_date,i_rec_end_date,i_item_desc,i_current_price,i_wholesale_cost,i_brand_id,i_brand,i_class_id,i_class,i_category_id,i_category,i_manufact_id,i_manufact,i_size,i_formulation,i_color,i_units,i_container,i_manager_id,i_product_name,d_date_sk,d_date_id,d_date,d_month_seq,d_week_seq,d_quarter_seq,d_year,d_dow,d_moy,d_dom,d_qoy,d_fy_year,d_fy_quarter_seq,d_fy_week_seq,d_day_name,d_quarter_name,d_holiday,d_weekend,d_following_holiday,d_first_dom,d_last_dom,d_same_day_ly,d_same_day_lq,d_current_day,d_current_week,d_current_month,d_current_quarter,d_current_year
+                    hive.sql.query.fieldTypes int,int,int,int,int,int,int,int,int,int,int,decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),int,char(16),date,date,varchar(200),decimal(7,2),decimal(7,2),int,char(50),int,char(50),int,char(50),int,char(50),char(20),char(20),char(20),char(10),char(10),int,char(50),int,char(16),date,int,int,int,int,int,int,int,int,int,int,int,char(9),char(6),char(1),char(1),char(1),int,int,int,int,char(1),char(1),char(1),char(1),char(1)
                     hive.sql.query.split false
-                  Statistics: Num rows: 1 Data size: 64 Basic stats: COMPLETE Column stats: NONE
-                  Select Operator
-                    expressions: d_date (type: date), wr_item_sk (type: int), wr_return_quantity (type: int)
-                    outputColumnNames: _col2, _col30, _col42
-                    Statistics: Num rows: 1 Data size: 64 Basic stats: COMPLETE Column stats: NONE
-                    Reduce Output Operator
-                      key expressions: _col2 (type: date)
-                      null sort order: z
-                      sort order: +
-                      Map-reduce partition columns: _col2 (type: date)
-                      Statistics: Num rows: 1 Data size: 64 Basic stats: COMPLETE Column stats: NONE
-                      value expressions: _col30 (type: int), _col42 (type: int)
-            Execution mode: vectorized, llap
-            LLAP IO: no inputs
-        Map 15 
-            Map Operator Tree:
-                TableScan
-                  alias: date_dim
-                  properties:
-                    hive.sql.query SELECT "d_date", "d_week_seq"
-FROM "DATE_DIM"
-WHERE "d_week_seq" IS NOT NULL AND "d_date" IS NOT NULL
-                    hive.sql.query.fieldNames d_date,d_week_seq
-                    hive.sql.query.fieldTypes date,int
-                    hive.sql.query.split true
-                  Statistics: Num rows: 1 Data size: 60 Basic stats: COMPLETE Column stats: NONE
+                  Statistics: Num rows: 1 Data size: 160 Basic stats: COMPLETE Column stats: NONE
                   Select Operator
-                    expressions: d_date (type: date), d_week_seq (type: int)
-                    outputColumnNames: _col0, _col1
-                    Statistics: Num rows: 1 Data size: 60 Basic stats: COMPLETE Column stats: NONE
+                    expressions: sr_return_quantity (type: int), i_item_id (type: char(16)), d_date (type: date)
+                    outputColumnNames: _col10, _col21, _col44
+                    Statistics: Num rows: 1 Data size: 160 Basic stats: COMPLETE Column stats: NONE
                     Reduce Output Operator
-                      key expressions: _col1 (type: int)
+                      key expressions: _col44 (type: date)
                       null sort order: z
                       sort order: +
-                      Map-reduce partition columns: _col1 (type: int)
-                      Statistics: Num rows: 1 Data size: 60 Basic stats: COMPLETE Column stats: NONE
-                      value expressions: _col0 (type: date)
+                      Map-reduce partition columns: _col44 (type: date)
+                      Statistics: Num rows: 1 Data size: 160 Basic stats: COMPLETE Column stats: NONE
+                      value expressions: _col10 (type: int), _col21 (type: char(16))
             Execution mode: vectorized, llap
             LLAP IO: no inputs
-        Map 19 
+        Map 13 
             Map Operator Tree:
                 TableScan
                   alias: date_dim
@@ -3658,72 +3822,93 @@ WHERE "d_date" IN (DATE '1998-01-02', DATE '1998-10-15', DATE '1998-11-10') AND
                         Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
             Execution mode: vectorized, llap
             LLAP IO: no inputs
-        Map 20 
+        Map 14 
             Map Operator Tree:
                 TableScan
-                  alias: date_dim
+                  alias: web_returns
                   properties:
-                    hive.sql.query SELECT "t0"."d_date_sk", "t0"."d_date_id", "t0"."d_date", "t0"."d_month_seq", "t0"."d_week_seq", "t0"."d_quarter_seq", "t0"."d_year", "t0"."d_dow", "t0"."d_moy", "t0"."d_dom", "t0"."d_qoy", "t0"."d_fy_year", "t0"."d_fy_quarter_seq", "t0"."d_fy_week_seq", "t0"."d_day_name", "t0"."d_quarter_name", "t0"."d_holiday", "t0"."d_weekend", "t0"."d_following_holiday", "t0"."d_first_dom", "t0"."d_last_dom", "t0"."d_same_day_ly", "t0"."d_same_day_lq", "t0"."d_current_day", "t0"."d_current_week", "t0"."d_current_month", "t0"."d_current_quarter", "t0"."d_current_year", "t2"."cr_returned_date_sk", "t2"."cr_returned_time_sk", "t2"."cr_item_sk", "t2"."cr_refunded_customer_sk", "t2"."cr_refunded_cdemo_sk", "t2"."cr_refunded_hdemo_sk", "t2"."cr_refunded_addr_sk", "t2"."cr_returning_customer_sk", "t2"."cr_returning_cdemo_sk", "t2"."cr_returning_hdemo_sk", "t2"."cr_returning_addr_sk", "t2"."cr_call_center_sk", "t2"."cr_catalog_page_sk", "t2"."cr_ship_mode_sk", "t2"."cr_warehouse_sk", "t2"."cr_reason_sk", "t2"."cr_order_number", "t2"."cr_return_quantity", "t2"."cr_return_amount", "t2"."cr_return_tax", "t2"."cr_return_amt_inc_tax", "t2"."cr_fee", "t2"."cr_return_ship_cost", "t2"."cr_refunded_cash", "t2"."cr_reversed_charge", "t2"."cr_store_credit", "t2"."cr_net_loss"
-FROM (SELECT "d_date_sk", "d_date_id", "d_date", "d_month_seq", "d_week_seq", "d_quarter_seq", "d_year", "d_dow", "d_moy", "d_dom", "d_qoy", "d_fy_year", "d_fy_quarter_seq", "d_fy_week_seq", "d_day_name", "d_quarter_name", "d_holiday", "d_weekend", "d_following_holiday", "d_first_dom", "d_last_dom", "d_same_day_ly", "d_same_day_lq", "d_current_day", "d_current_week", "d_current_month", "d_current_quarter", "d_current_year"
+                    hive.sql.query SELECT "t0"."wr_returned_date_sk", "t0"."wr_returned_time_sk", "t0"."wr_item_sk", "t0"."wr_refunded_customer_sk", "t0"."wr_refunded_cdemo_sk", "t0"."wr_refunded_hdemo_sk", "t0"."wr_refunded_addr_sk", "t0"."wr_returning_customer_sk", "t0"."wr_returning_cdemo_sk", "t0"."wr_returning_hdemo_sk", "t0"."wr_returning_addr_sk", "t0"."wr_web_page_sk", "t0"."wr_reason_sk", "t0"."wr_order_number", "t0"."wr_return_quantity", "t0"."wr_return_amt", "t0"."wr_return_tax", "t0"."wr_return_amt_inc_tax", "t0"."wr_fee", "t0"."wr_return_ship_cost", "t0"."wr_refunded_cash", "t0"."wr_reversed_charge", "t0"."wr_account_credit", "t0"."wr_net_loss", "t2"."i_item_sk", "t2"."i_item_id", "t2"."i_rec_start_date", "t2"."i_rec_end_date", "t2"."i_item_desc", "t2"."i_current_price", "t2"."i_wholesale_cost", "t2"."i_brand_id", "t2"."i_brand", "t2"."i_class_id", "t2"."i_class", "t2"."i_category_id", "t2"."i_category", "t2"."i_manufact_id", "t2"."i_manufact", "t2"."i_size", "t2"."i_formulation", "t2"."i_color", "t2"."i_units", "t2"."i_container", "t2"."i_manager_id", "t2"."i_product_name", "t4"."d_date_sk", "t4"."d_date_id", "t4"."d_date", "t4"."d_month_seq", "t4"."d_week_seq", "t4"."d_quarter_seq", "t4"."d_year", "t4"."d_dow", "t4"."d_moy", "t4"."d_dom", "t4"."d_qoy", "t4"."d_fy_year", "t4"."d_fy_quarter_seq", "t4"."d_fy_week_seq", "t4"."d_day_name", "t4"."d_quarter_name", "t4"."d_holiday", "t4"."d_weekend", "t4"."d_following_holiday", "t4"."d_first_dom", "t4"."d_last_dom", "t4"."d_same_day_ly", "t4"."d_same_day_lq", "t4"."d_current_day", "t4"."d_current_week", "t4"."d_current_month", "t4"."d_current_quarter", "t4"."d_current_year"
+FROM (SELECT "wr_returned_date_sk", "wr_returned_time_sk", "wr_item_sk", "wr_refunded_customer_sk", "wr_refunded_cdemo_sk", "wr_refunded_hdemo_sk", "wr_refunded_addr_sk", "wr_returning_customer_sk", "wr_returning_cdemo_sk", "wr_returning_hdemo_sk", "wr_returning_addr_sk", "wr_web_page_sk", "wr_reason_sk", "wr_order_number", "wr_return_quantity", "wr_return_amt", "wr_return_tax", "wr_return_amt_inc_tax", "wr_fee", "wr_return_ship_cost", "wr_refunded_cash", "wr_reversed_charge", "wr_account_credit", "wr_net_loss"
+FROM "WEB_RETURNS"
+WHERE "wr_item_sk" IS NOT NULL AND "wr_returned_date_sk" IS NOT NULL) AS "t0"
+INNER JOIN (SELECT "i_item_sk", "i_item_id", "i_rec_start_date", "i_rec_end_date", "i_item_desc", "i_current_price", "i_wholesale_cost", "i_brand_id", "i_brand", "i_class_id", "i_class", "i_category_id", "i_category", "i_manufact_id", "i_manufact", "i_size", "i_formulation", "i_color", "i_units", "i_container", "i_manager_id", "i_product_name"
+FROM "ITEM"
+WHERE "i_item_sk" IS NOT NULL AND "i_item_id" IS NOT NULL) AS "t2" ON "t0"."wr_item_sk" = "t2"."i_item_sk"
+INNER JOIN (SELECT "d_date_sk", "d_date_id", "d_date", "d_month_seq", "d_week_seq", "d_quarter_seq", "d_year", "d_dow", "d_moy", "d_dom", "d_qoy", "d_fy_year", "d_fy_quarter_seq", "d_fy_week_seq", "d_day_name", "d_quarter_name", "d_holiday", "d_weekend", "d_following_holiday", "d_first_dom", "d_last_dom", "d_same_day_ly", "d_same_day_lq", "d_current_day", "d_current_week", "d_current_month", "d_current_quarter", "d_current_year"
 FROM "DATE_DIM"
-WHERE "d_date" IS NOT NULL AND "d_date_sk" IS NOT NULL) AS "t0"
-INNER JOIN (SELECT "cr_returned_date_sk", "cr_returned_time_sk", "cr_item_sk", "cr_refunded_customer_sk", "cr_refunded_cdemo_sk", "cr_refunded_hdemo_sk", "cr_refunded_addr_sk", "cr_returning_customer_sk", "cr_returning_cdemo_sk", "cr_returning_hdemo_sk", "cr_returning_addr_sk", "cr_call_center_sk", "cr_catalog_page_sk", "cr_ship_mode_sk", "cr_warehouse_sk", "cr_reason_sk", "cr_order_number", "cr_return_quantity", "cr_return_amount", "cr_return_tax", "cr_return_amt_inc_tax", "cr_fee", "cr_return_ship_cost", "cr_refunded_cash", "cr_reversed_charge", "cr_store_credit", "cr_net_loss"
-FROM "CATALOG_RETURNS"
-WHERE "cr_item_sk" IS NOT NULL AND "cr_returned_date_sk" IS NOT NULL) AS "t2" ON "t0"."d_date_sk" = "t2"."cr_returned_date_sk"
-                    hive.sql.query.fieldNames d_date_sk,d_date_id,d_date,d_month_seq,d_week_seq,d_quarter_seq,d_year,d_dow,d_moy,d_dom,d_qoy,d_fy_year,d_fy_quarter_seq,d_fy_week_seq,d_day_name,d_quarter_name,d_holiday,d_weekend,d_following_holiday,d_first_dom,d_last_dom,d_same_day_ly,d_same_day_lq,d_current_day,d_current_week,d_current_month,d_current_quarter,d_current_year,cr_returned_date_sk,cr_returned_time_sk,cr_item_sk,cr_refunded_customer_sk,cr_refunded_cdemo_sk,cr_refunded_hdemo_sk,cr_refunded_addr_sk,cr_returning_customer_sk,cr_returning_cdemo_sk,cr_returning_hdemo_sk,cr_returning_addr_sk,cr_call_center_sk,cr_catalog_page_sk,cr_ship_mode_sk,cr_warehouse_sk,cr_reason_sk,cr_order_number,cr_return_quantity,cr_return_amount,cr_return_tax,cr_return_amt_inc_tax,cr_fee,cr_return_ship_cost,cr_refunded_cash,cr_reversed_charge,cr_store_credit,cr_net_loss
-                    hive.sql.query.fieldTypes int,char(16),date,int,int,int,int,int,int,int,int,int,int,int,char(9),char(6),char(1),char(1),char(1),int,int,int,int,char(1),char(1),char(1),char(1),char(1),int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2)
+WHERE "d_date" IS NOT NULL AND "d_date_sk" IS NOT NULL) AS "t4" ON "t0"."wr_returned_date_sk" = "t4"."d_date_sk"
+                    hive.sql.query.fieldNames wr_returned_date_sk,wr_returned_time_sk,wr_item_sk,wr_refunded_customer_sk,wr_refunded_cdemo_sk,wr_refunded_hdemo_sk,wr_refunded_addr_sk,wr_returning_customer_sk,wr_returning_cdemo_sk,wr_returning_hdemo_sk,wr_returning_addr_sk,wr_web_page_sk,wr_reason_sk,wr_order_number,wr_return_quantity,wr_return_amt,wr_return_tax,wr_return_amt_inc_tax,wr_fee,wr_return_ship_cost,wr_refunded_cash,wr_reversed_charge,wr_account_credit,wr_net_loss,i_item_sk,i_item_id,i_rec_start_date,i_rec_end_date,i_item_desc,i_current_price,i_wholesale_cost,i_brand_id,i_brand,i_class_id,i_class,i_category_id,i_category,i_manufact_id,i_manufact,i_size,i_formulation,i_color,i_units,i_container,i_manager_id,i_product_name,d_date_sk,d_date_id,d_date,d_month_seq,d_week_seq,d_quarter_seq,d_year,d_dow,d_moy,d_dom,d_qoy,d_fy_year,d_fy_quarter_seq,d_fy_week_seq,d_day_name,d_quarter_name,d_holiday,d_weekend,d_following_holiday,d_first_dom,d_last_dom,d_same_day_ly,d_same_day_lq,d_current_day,d_current_week,d_current_month,d_current_quarter,d_current_year
+                    hive.sql.query.fieldTypes int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),int,char(16),date,date,varchar(200),decimal(7,2),decimal(7,2),int,char(50),int,char(50),int,char(50),int,char(50),char(20),char(20),char(20),char(10),char(10),int,char(50),int,char(16),date,int,int,int,int,int,int,int,int,int,int,int,char(9),char(6),char(1),char(1),char(1),int,int,int,int,char(1),char(1),char(1),char(1),char(1)
                     hive.sql.query.split false
-                  Statistics: Num rows: 1 Data size: 64 Basic stats: COMPLETE Column stats: NONE
+                  Statistics: Num rows: 1 Data size: 160 Basic stats: COMPLETE Column stats: NONE
                   Select Operator
-                    expressions: d_date (type: date), cr_item_sk (type: int), cr_return_quantity (type: int)
-                    outputColumnNames: _col2, _col30, _col45
-                    Statistics: Num rows: 1 Data size: 64 Basic stats: COMPLETE Column stats: NONE
+                    expressions: wr_return_quantity (type: int), i_item_id (type: char(16)), d_date (type: date)
+                    outputColumnNames: _col14, _col25, _col48
+                    Statistics: Num rows: 1 Data size: 160 Basic stats: COMPLETE Column stats: NONE
                     Reduce Output Operator
-                      key expressions: _col2 (type: date)
+                      key expressions: _col48 (type: date)
                       null sort order: z
                       sort order: +
-                      Map-reduce partition columns: _col2 (type: date)
-                      Statistics: Num rows: 1 Data size: 64 Basic stats: COMPLETE Column stats: NONE
-                      value expressions: _col30 (type: int), _col45 (type: int)
+                      Map-reduce partition columns: _col48 (type: date)
+                      Statistics: Num rows: 1 Data size: 160 Basic stats: COMPLETE Column stats: NONE
+                      value expressions: _col14 (type: int), _col25 (type: char(16))
             Execution mode: vectorized, llap
             LLAP IO: no inputs
-        Map 8 
+        Map 15 
             Map Operator Tree:
                 TableScan
-                  alias: item
+                  alias: catalog_returns
                   properties:
-                    hive.sql.query SELECT "i_item_sk", "i_item_id", "i_rec_start_date", "i_rec_end_date", "i_item_desc", "i_current_price", "i_wholesale_cost", "i_brand_id", "i_brand", "i_class_id", "i_class", "i_category_id", "i_category", "i_manufact_id", "i_manufact", "i_size", "i_formulation", "i_color", "i_units", "i_container", "i_manager_id", "i_product_name"
+                    hive.sql.query SELECT "t0"."cr_returned_date_sk", "t0"."cr_returned_time_sk", "t0"."cr_item_sk", "t0"."cr_refunded_customer_sk", "t0"."cr_refunded_cdemo_sk", "t0"."cr_refunded_hdemo_sk", "t0"."cr_refunded_addr_sk", "t0"."cr_returning_customer_sk", "t0"."cr_returning_cdemo_sk", "t0"."cr_returning_hdemo_sk", "t0"."cr_returning_addr_sk", "t0"."cr_call_center_sk", "t0"."cr_catalog_page_sk", "t0"."cr_ship_mode_sk", "t0"."cr_warehouse_sk", "t0"."cr_reason_sk", "t0"."cr_order_number", "t0"."cr_return_quantity", "t0"."cr_return_amount", "t0"."cr_return_tax", "t0"."cr_return_amt_inc_tax", "t0"."cr_fee", "t0"."cr_return_ship_cost", "t0"."cr_refunded_cash", "t0"."cr_reversed_charge", "t0"."cr_store_credit", "t0"."cr_net_loss", "t2"."i_item_sk", "t2"."i_item_id", "t2"."i_rec_start_date", "t2"."i_rec_end_date", "t2"."i_item_desc", "t2"."i_current_price", "t2"."i_wholesale_cost", "t2"."i_brand_id", "t2"."i_brand", "t2"."i_class_id", "t2"."i_class", "t2"."i_category_id", "t2"."i_category", "t2"."i_manufact_id", "t2"."i_manufact", "t2"."i_size", "t2"."i_formulation", "t2"."i_color", "t2"."i_units", "t2"."i_container", "t2"."i_manager_id", "t2"."i_product_name", "t4"."d_date_sk", "t4"."d_date_id", "t4"."d_date", "t4"."d_month_seq", "t4"."d_week_seq", "t4"."d_quarter_seq", "t4"."d_year", "t4"."d_dow", "t4"."d_moy", "t4"."d_dom", "t4"."d_qoy", "t4"."d_fy_year", "t4"."d_fy_quarter_seq", "t4"."d_fy_week_seq", "t4"."d_day_name", "t4"."d_quarter_name", "t4"."d_holiday", "t4"."d_weekend", "t4"."d_following_holiday", "t4"."d_first_dom", "t4"."d_last_dom", "t4"."d_same_day_ly", "t4"."d_same_day_lq", "t4"."d_current_day", "t4"."d_current_week", "t4"."d_current_month", "t4"."d_current_quarter", "t4"."d_current_year"
+FROM (SELECT "cr_returned_date_sk", "cr_returned_time_sk", "cr_item_sk", "cr_refunded_customer_sk", "cr_refunded_cdemo_sk", "cr_refunded_hdemo_sk", "cr_refunded_addr_sk", "cr_returning_customer_sk", "cr_returning_cdemo_sk", "cr_returning_hdemo_sk", "cr_returning_addr_sk", "cr_call_center_sk", "cr_catalog_page_sk", "cr_ship_mode_sk", "cr_warehouse_sk", "cr_reason_sk", "cr_order_number", "cr_return_quantity", "cr_return_amount", "cr_return_tax", "cr_return_amt_inc_tax", "cr_fee", "cr_return_ship_cost", "cr_refunded_cash", "cr_reversed_charge", "cr_store_credit", "cr_net_loss"
+FROM "CATALOG_RETURNS"
+WHERE "cr_item_sk" IS NOT NULL AND "cr_returned_date_sk" IS NOT NULL) AS "t0"
+INNER JOIN (SELECT "i_item_sk", "i_item_id", "i_rec_start_date", "i_rec_end_date", "i_item_desc", "i_current_price", "i_wholesale_cost", "i_brand_id", "i_brand", "i_class_id", "i_class", "i_category_id", "i_category", "i_manufact_id", "i_manufact", "i_size", "i_formulation", "i_color", "i_units", "i_container", "i_manager_id", "i_product_name"
 FROM "ITEM"
-WHERE "i_item_sk" IS NOT NULL AND "i_item_id" IS NOT NULL
-                    hive.sql.query.fieldNames i_item_sk,i_item_id,i_rec_start_date,i_rec_end_date,i_item_desc,i_current_price,i_wholesale_cost,i_brand_id,i_brand,i_class_id,i_class,i_category_id,i_category,i_manufact_id,i_manufact,i_size,i_formulation,i_color,i_units,i_container,i_manager_id,i_product_name
-                    hive.sql.query.fieldTypes int,char(16),date,date,varchar(200),decimal(7,2),decimal(7,2),int,char(50),int,char(50),int,char(50),int,char(50),char(20),char(20),char(20),char(10),char(10),int,char(50)
-                    hive.sql.query.split true
-                  Statistics: Num rows: 1 Data size: 104 Basic stats: COMPLETE Column stats: NONE
+WHERE "i_item_sk" IS NOT NULL AND "i_item_id" IS NOT NULL) AS "t2" ON "t0"."cr_item_sk" = "t2"."i_item_sk"
+INNER JOIN (SELECT "d_date_sk", "d_date_id", "d_date", "d_month_seq", "d_week_seq", "d_quarter_seq", "d_year", "d_dow", "d_moy", "d_dom", "d_qoy", "d_fy_year", "d_fy_quarter_seq", "d_fy_week_seq", "d_day_name", "d_quarter_name", "d_holiday", "d_weekend", "d_following_holiday", "d_first_dom", "d_last_dom", "d_same_day_ly", "d_same_day_lq", "d_current_day", "d_current_week", "d_current_month", "d_current_quarter", "d_current_year"
+FROM "DATE_DIM"
+WHERE "d_date" IS NOT NULL AND "d_date_sk" IS NOT NULL) AS "t4" ON "t0"."cr_returned_date_sk" = "t4"."d_date_sk"
+                    hive.sql.query.fieldNames cr_returned_date_sk,cr_returned_time_sk,cr_item_sk,cr_refunded_customer_sk,cr_refunded_cdemo_sk,cr_refunded_hdemo_sk,cr_refunded_addr_sk,cr_returning_customer_sk,cr_returning_cdemo_sk,cr_returning_hdemo_sk,cr_returning_addr_sk,cr_call_center_sk,cr_catalog_page_sk,cr_ship_mode_sk,cr_warehouse_sk,cr_reason_sk,cr_order_number,cr_return_quantity,cr_return_amount,cr_return_tax,cr_return_amt_inc_tax,cr_fee,cr_return_ship_cost,cr_refunded_cash,cr_reversed_charge,cr_store_credit,cr_net_loss,i_item_sk,i_item_id,i_rec_start_date,i_rec_end_date,i_item_desc,i_current_price,i_wholesale_cost,i_brand_id,i_brand,i_class_id,i_class,i_category_id,i_category,i_manufact_id,i_manufact,i_size,i_formulation,i_color,i_units,i_container,i_manager_id,i_product_name,d_date_sk,d_date_id,d_date,d_month_seq,d_week_seq,d_quarter_seq,d_year,d_dow,d_moy,d_dom,d_qoy,d_fy_year,d_fy_quarter_seq,d_fy_week_seq,d_day_name,d_quarter_name,d_holiday,d_weekend,d_following_holiday,d_first_dom,d_last_dom,d_same_day_ly,d_same_day_lq,d_current_day,d_current_week,d_current_month,d_current_quarter,d_current_year
+                    hive.sql.query.fieldTypes int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),int,char(16),date,date,varchar(200),decimal(7,2),decimal(7,2),int,char(50),int,char(50),int,char(50),int,char(50),char(20),char(20),char(20),char(10),char(10),int,char(50),int,char(16),date,int,int,int,int,int,int,int,int,int,int,int,char(9),char(6),char(1),char(1),char(1),int,int,int,int,char(1),char(1),char(1),char(1),char(1)
+                    hive.sql.query.split false
+                  Statistics: Num rows: 1 Data size: 160 Basic stats: COMPLETE Column stats: NONE
                   Select Operator
-                    expressions: i_item_sk (type: int), i_item_id (type: char(16))
-                    outputColumnNames: _col0, _col1
-                    Statistics: Num rows: 1 Data size: 104 Basic stats: COMPLETE Column stats: NONE
+                    expressions: cr_return_quantity (type: int), i_item_id (type: char(16)), d_date (type: date)
+                    outputColumnNames: _col17, _col28, _col51
+                    Statistics: Num rows: 1 Data size: 160 Basic stats: COMPLETE Column stats: NONE
                     Reduce Output Operator
-                      key expressions: _col0 (type: int)
+                      key expressions: _col51 (type: date)
                       null sort order: z
                       sort order: +
-                      Map-reduce partition columns: _col0 (type: int)
-                      Statistics: Num rows: 1 Data size: 104 Basic stats: COMPLETE Column stats: NONE
-                      value expressions: _col1 (type: char(16))
-                    Reduce Output Operator
-                      key expressions: _col0 (type: int)
-                      null sort order: z
-                      sort order: +
-                      Map-reduce partition columns: _col0 (type: int)
-                      Statistics: Num rows: 1 Data size: 104 Basic stats: COMPLETE Column stats: NONE
-                      value expressions: _col1 (type: char(16))
+                      Map-reduce partition columns: _col51 (type: date)
+                      Statistics: Num rows: 1 Data size: 160 Basic stats: COMPLETE Column stats: NONE
+                      value expressions: _col17 (type: int), _col28 (type: char(16))
+            Execution mode: vectorized, llap
+            LLAP IO: no inputs
+        Map 7 
+            Map Operator Tree:
+                TableScan
+                  alias: date_dim
+                  properties:
+                    hive.sql.query SELECT "d_date_sk", "d_date_id", "d_date", "d_month_seq", "d_week_seq", "d_quarter_seq", "d_year", "d_dow", "d_moy", "d_dom", "d_qoy", "d_fy_year", "d_fy_quarter_seq", "d_fy_week_seq", "d_day_name", "d_quarter_name", "d_holiday", "d_weekend", "d_following_holiday", "d_first_dom", "d_last_dom", "d_same_day_ly", "d_same_day_lq", "d_current_day", "d_current_week", "d_current_month", "d_current_quarter", "d_current_year"
+FROM "DATE_DIM"
+WHERE "d_week_seq" IS NOT NULL AND "d_date" IS NOT NULL
+                    hive.sql.query.fieldNames d_date_sk,d_date_id,d_date,d_month_seq,d_week_seq,d_quarter_seq,d_year,d_dow,d_moy,d_dom,d_qoy,d_fy_year,d_fy_quarter_seq,d_fy_week_seq,d_day_name,d_quarter_name,d_holiday,d_weekend,d_following_holiday,d_first_dom,d_last_dom,d_same_day_ly,d_same_day_lq,d_current_day,d_current_week,d_current_month,d_current_quarter,d_current_year
+                    hive.sql.query.fieldTypes int,char(16),date,int,int,int,int,int,int,int,int,int,int,int,char(9),char(6),char(1),char(1),char(1),int,int,int,int,char(1),char(1),char(1),char(1),char(1)
+                    hive.sql.query.split true
+                  Statistics: Num rows: 1 Data size: 60 Basic stats: COMPLETE Column stats: NONE
+                  Select Operator
+                    expressions: d_date (type: date), d_week_seq (type: int)
+                    outputColumnNames: _col2, _col4
+                    Statistics: Num rows: 1 Data size: 60 Basic stats: COMPLETE Column stats: NONE
                     Reduce Output Operator
-                      key expressions: _col0 (type: int)
+                      key expressions: _col4 (type: int)
                       null sort order: z
                       sort order: +
-                      Map-reduce partition columns: _col0 (type: int)
-                      Statistics: Num rows: 1 Data size: 104 Basic stats: COMPLETE Column stats: NONE
-                      value expressions: _col1 (type: char(16))
+                      Map-reduce partition columns: _col4 (type: int)
+                      Statistics: Num rows: 1 Data size: 60 Basic stats: COMPLETE Column stats: NONE
+                      value expressions: _col2 (type: date)
             Execution mode: vectorized, llap
             LLAP IO: no inputs
         Reducer 10 
@@ -3734,42 +3919,42 @@ WHERE "i_item_sk" IS NOT NULL AND "i_item_id" IS NOT NULL
                 keys: KEY._col0 (type: char(16))
                 mode: mergepartial
                 outputColumnNames: _col0, _col1
-                Statistics: Num rows: 1 Data size: 77 Basic stats: COMPLETE Column stats: NONE
+                Statistics: Num rows: 1 Data size: 176 Basic stats: COMPLETE Column stats: NONE
                 Select Operator
                   expressions: _col0 (type: char(16)), _col1 (type: bigint), UDFToDouble(_col1) (type: double)
                   outputColumnNames: _col0, _col1, _col2
-                  Statistics: Num rows: 1 Data size: 77 Basic stats: COMPLETE Column stats: NONE
+                  Statistics: Num rows: 1 Data size: 176 Basic stats: COMPLETE Column stats: NONE
                   Reduce Output Operator
                     key expressions: _col0 (type: char(16))
                     null sort order: z
                     sort order: +
                     Map-reduce partition columns: _col0 (type: char(16))
-                    Statistics: Num rows: 1 Data size: 77 Basic stats: COMPLETE Column stats: NONE
+                    Statistics: Num rows: 1 Data size: 176 Basic stats: COMPLETE Column stats: NONE
                     value expressions: _col1 (type: bigint), _col2 (type: double)
         Reducer 11 
             Execution mode: llap
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Semi Join 0 to 1
                 keys:
-                  0 _col30 (type: int)
-                  1 _col0 (type: int)
-                outputColumnNames: _col45, _col57
-                Statistics: Num rows: 1 Data size: 77 Basic stats: COMPLETE Column stats: NONE
+                  0 _col51 (type: date)
+                  1 _col0 (type: date)
+                outputColumnNames: _col17, _col28
+                Statistics: Num rows: 1 Data size: 176 Basic stats: COMPLETE Column stats: NONE
                 Group By Operator
-                  aggregations: sum(_col45)
-                  keys: _col57 (type: char(16))
+                  aggregations: sum(_col17)
+                  keys: _col28 (type: char(16))
                   minReductionHashAggr: 0.99
                   mode: hash
                   outputColumnNames: _col0, _col1
-                  Statistics: Num rows: 1 Data size: 77 Basic stats: COMPLETE Column stats: NONE
+                  Statistics: Num rows: 1 Data size: 176 Basic stats: COMPLETE Column stats: NONE
                   Reduce Output Operator
                     key expressions: _col0 (type: char(16))
                     null sort order: z
                     sort order: +
                     Map-reduce partition columns: _col0 (type: char(16))
-                    Statistics: Num rows: 1 Data size: 77 Basic stats: COMPLETE Column stats: NONE
+                    Statistics: Num rows: 1 Data size: 176 Basic stats: COMPLETE Column stats: NONE
                     value expressions: _col1 (type: bigint)
         Reducer 12 
             Execution mode: vectorized, llap
@@ -3779,147 +3964,44 @@ WHERE "i_item_sk" IS NOT NULL AND "i_item_id" IS NOT NULL
                 keys: KEY._col0 (type: char(16))
                 mode: mergepartial
                 outputColumnNames: _col0, _col1
-                Statistics: Num rows: 1 Data size: 77 Basic stats: COMPLETE Column stats: NONE
+                Statistics: Num rows: 1 Data size: 176 Basic stats: COMPLETE Column stats: NONE
                 Select Operator
                   expressions: _col0 (type: char(16)), _col1 (type: bigint), UDFToDouble(_col1) (type: double)
                   outputColumnNames: _col0, _col1, _col2
-                  Statistics: Num rows: 1 Data size: 77 Basic stats: COMPLETE Column stats: NONE
+                  Statistics: Num rows: 1 Data size: 176 Basic stats: COMPLETE Column stats: NONE
                   Reduce Output Operator
                     key expressions: _col0 (type: char(16))
                     null sort order: z
                     sort order: +
                     Map-reduce partition columns: _col0 (type: char(16))
-                    Statistics: Num rows: 1 Data size: 77 Basic stats: COMPLETE Column stats: NONE
+                    Statistics: Num rows: 1 Data size: 176 Basic stats: COMPLETE Column stats: NONE
                     value expressions: _col1 (type: bigint), _col2 (type: double)
-        Reducer 14 
-            Execution mode: llap
-            Reduce Operator Tree:
-              Merge Join Operator
-                condition map:
-                     Inner Join 0 to 1
-                keys:
-                  0 _col2 (type: date)
-                  1 _col0 (type: date)
-                outputColumnNames: _col30, _col42
-                Statistics: Num rows: 1 Data size: 70 Basic stats: COMPLETE Column stats: NONE
-                Reduce Output Operator
-                  key expressions: _col30 (type: int)
-                  null sort order: z
-                  sort order: +
-                  Map-reduce partition columns: _col30 (type: int)
-                  Statistics: Num rows: 1 Data size: 70 Basic stats: COMPLETE Column stats: NONE
-                  value expressions: _col42 (type: int)
-        Reducer 16 
-            Execution mode: llap
-            Reduce Operator Tree:
-              Merge Join Operator
-                condition map:
-                     Left Semi Join 0 to 1
-                keys:
-                  0 _col1 (type: int)
-                  1 _col0 (type: int)
-                outputColumnNames: _col0
-                Statistics: Num rows: 1 Data size: 66 Basic stats: COMPLETE Column stats: NONE
-                Group By Operator
-                  keys: _col0 (type: date)
-                  minReductionHashAggr: 0.99
-                  mode: hash
-                  outputColumnNames: _col0
-                  Statistics: Num rows: 1 Data size: 66 Basic stats: COMPLETE Column stats: NONE
-                  Reduce Output Operator
-                    key expressions: _col0 (type: date)
-                    null sort order: z
-                    sort order: +
-                    Map-reduce partition columns: _col0 (type: date)
-                    Statistics: Num rows: 1 Data size: 66 Basic stats: COMPLETE Column stats: NONE
-        Reducer 17 
-            Execution mode: vectorized, llap
-            Reduce Operator Tree:
-              Group By Operator
-                keys: KEY._col0 (type: date)
-                mode: mergepartial
-                outputColumnNames: _col0
-                Statistics: Num rows: 1 Data size: 66 Basic stats: COMPLETE Column stats: NONE
-                Reduce Output Operator
-                  key expressions: _col0 (type: date)
-                  null sort order: z
-                  sort order: +
-                  Map-reduce partition columns: _col0 (type: date)
-                  Statistics: Num rows: 1 Data size: 66 Basic stats: COMPLETE Column stats: NONE
-                Reduce Output Operator
-                  key expressions: _col0 (type: date)
-                  null sort order: z
-                  sort order: +
-                  Map-reduce partition columns: _col0 (type: date)
-                  Statistics: Num rows: 1 Data size: 66 Basic stats: COMPLETE Column stats: NONE
-                Reduce Output Operator
-                  key expressions: _col0 (type: date)
-                  null sort order: z
-                  sort order: +
-                  Map-reduce partition columns: _col0 (type: date)
-                  Statistics: Num rows: 1 Data size: 66 Basic stats: COMPLETE Column stats: NONE
-        Reducer 18 
-            Execution mode: llap
-            Reduce Operator Tree:
-              Merge Join Operator
-                condition map:
-                     Inner Join 0 to 1
-                keys:
-                  0 _col2 (type: date)
-                  1 _col0 (type: date)
-                outputColumnNames: _col30, _col45
-                Statistics: Num rows: 1 Data size: 70 Basic stats: COMPLETE Column stats: NONE
-                Reduce Output Operator
-                  key expressions: _col30 (type: int)
-                  null sort order: z
-                  sort order: +
-                  Map-reduce partition columns: _col30 (type: int)
-                  Statistics: Num rows: 1 Data size: 70 Basic stats: COMPLETE Column stats: NONE
-                  value expressions: _col45 (type: int)
         Reducer 2 
             Execution mode: llap
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Semi Join 0 to 1
                 keys:
-                  0 _col2 (type: date)
+                  0 _col44 (type: date)
                   1 _col0 (type: date)
-                outputColumnNames: _col30, _col38
-                Statistics: Num rows: 1 Data size: 70 Basic stats: COMPLETE Column stats: NONE
-                Reduce Output Operator
-                  key expressions: _col30 (type: int)
-                  null sort order: z
-                  sort order: +
-                  Map-reduce partition columns: _col30 (type: int)
-                  Statistics: Num rows: 1 Data size: 70 Basic stats: COMPLETE Column stats: NONE
-                  value expressions: _col38 (type: int)
-        Reducer 3 
-            Execution mode: llap
-            Reduce Operator Tree:
-              Merge Join Operator
-                condition map:
-                     Inner Join 0 to 1
-                keys:
-                  0 _col30 (type: int)
-                  1 _col0 (type: int)
-                outputColumnNames: _col38, _col50
-                Statistics: Num rows: 1 Data size: 77 Basic stats: COMPLETE Column stats: NONE
+                outputColumnNames: _col10, _col21
+                Statistics: Num rows: 1 Data size: 176 Basic stats: COMPLETE Column stats: NONE
                 Group By Operator
-                  aggregations: sum(_col38)
-                  keys: _col50 (type: char(16))
+                  aggregations: sum(_col10)
+                  keys: _col21 (type: char(16))
                   minReductionHashAggr: 0.99
                   mode: hash
                   outputColumnNames: _col0, _col1
-                  Statistics: Num rows: 1 Data size: 77 Basic stats: COMPLETE Column stats: NONE
+                  Statistics: Num rows: 1 Data size: 176 Basic stats: COMPLETE Column stats: NONE
                   Reduce Output Operator
                     key expressions: _col0 (type: char(16))
                     null sort order: z
                     sort order: +
                     Map-reduce partition columns: _col0 (type: char(16))
-                    Statistics: Num rows: 1 Data size: 77 Basic stats: COMPLETE Column stats: NONE
+                    Statistics: Num rows: 1 Data size: 176 Basic stats: COMPLETE Column stats: NONE
                     value expressions: _col1 (type: bigint)
-        Reducer 4 
+        Reducer 3 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Group By Operator
@@ -3927,19 +4009,19 @@ WHERE "i_item_sk" IS NOT NULL AND "i_item_id" IS NOT NULL
                 keys: KEY._col0 (type: char(16))
                 mode: mergepartial
                 outputColumnNames: _col0, _col1
-                Statistics: Num rows: 1 Data size: 77 Basic stats: COMPLETE Column stats: NONE
+                Statistics: Num rows: 1 Data size: 176 Basic stats: COMPLETE Column stats: NONE
                 Select Operator
                   expressions: _col0 (type: char(16)), _col1 (type: bigint), UDFToDouble(_col1) (type: double)
                   outputColumnNames: _col0, _col1, _col2
-                  Statistics: Num rows: 1 Data size: 77 Basic stats: COMPLETE Column stats: NONE
+                  Statistics: Num rows: 1 Data size: 176 Basic stats: COMPLETE Column stats: NONE
                   Reduce Output Operator
                     key expressions: _col0 (type: char(16))
                     null sort order: z
                     sort order: +
                     Map-reduce partition columns: _col0 (type: char(16))
-                    Statistics: Num rows: 1 Data size: 77 Basic stats: COMPLETE Column stats: NONE
+                    Statistics: Num rows: 1 Data size: 176 Basic stats: COMPLETE Column stats: NONE
                     value expressions: _col1 (type: bigint), _col2 (type: double)
-        Reducer 5 
+        Reducer 4 
             Execution mode: llap
             Reduce Operator Tree:
               Merge Join Operator
@@ -3949,15 +4031,15 @@ WHERE "i_item_sk" IS NOT NULL AND "i_item_id" IS NOT NULL
                   0 _col0 (type: char(16))
                   1 _col0 (type: char(16))
                 outputColumnNames: _col0, _col1, _col2, _col4, _col5
-                Statistics: Num rows: 1 Data size: 84 Basic stats: COMPLETE Column stats: NONE
+                Statistics: Num rows: 1 Data size: 193 Basic stats: COMPLETE Column stats: NONE
                 Reduce Output Operator
                   key expressions: _col0 (type: char(16))
                   null sort order: z
                   sort order: +
                   Map-reduce partition columns: _col0 (type: char(16))
-                  Statistics: Num rows: 1 Data size: 84 Basic stats: COMPLETE Column stats: NONE
+                  Statistics: Num rows: 1 Data size: 193 Basic stats: COMPLETE Column stats: NONE
                   value expressions: _col1 (type: bigint), _col2 (type: double), _col4 (type: bigint), _col5 (type: double)
-        Reducer 6 
+        Reducer 5 
             Execution mode: llap
             Reduce Operator Tree:
               Merge Join Operator
@@ -3967,64 +4049,103 @@ WHERE "i_item_sk" IS NOT NULL AND "i_item_id" IS NOT NULL
                   0 _col0 (type: char(16))
                   1 _col0 (type: char(16))
                 outputColumnNames: _col0, _col1, _col2, _col4, _col5, _col7, _col8
-                Statistics: Num rows: 1 Data size: 92 Basic stats: COMPLETE Column stats: NONE
+                Statistics: Num rows: 1 Data size: 212 Basic stats: COMPLETE Column stats: NONE
                 Top N Key Operator
                   sort order: ++
                   keys: _col0 (type: char(16)), _col1 (type: bigint)
                   null sort order: zz
-                  Statistics: Num rows: 1 Data size: 92 Basic stats: COMPLETE Column stats: NONE
+                  Statistics: Num rows: 1 Data size: 212 Basic stats: COMPLETE Column stats: NONE
                   top n: 100
                   Select Operator
                     expressions: _col0 (type: char(16)), _col1 (type: bigint), (((_col2 / UDFToDouble(((_col1 + _col7) + _col4))) / 3.0D) * 100.0D) (type: double), _col7 (type: bigint), (((_col8 / UDFToDouble(((_col1 + _col7) + _col4))) / 3.0D) * 100.0D) (type: double), _col4 (type: bigint), (((_col5 / UDFToDouble(((_col1 + _col7) + _col4))) / 3.0D) * 100.0D) (type: double), (CAST( ((_col1 + _col7) + _col4) AS decimal(19,0)) / 3) (type: decimal(25,6))
                     outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7
-                    Statistics: Num rows: 1 Data size: 92 Basic stats: COMPLETE Column stats: NONE
+                    Statistics: Num rows: 1 Data size: 212 Basic stats: COMPLETE Column stats: NONE
                     Reduce Output Operator
                       key expressions: _col0 (type: char(16)), _col1 (type: bigint)
                       null sort order: zz
                       sort order: ++
-                      Statistics: Num rows: 1 Data size: 92 Basic stats: COMPLETE Column stats: NONE
+                      Statistics: Num rows: 1 Data size: 212 Basic stats: COMPLETE Column stats: NONE
                       value expressions: _col2 (type: double), _col3 (type: bigint), _col4 (type: double), _col5 (type: bigint), _col6 (type: double), _col7 (type: decimal(25,6))
-        Reducer 7 
+        Reducer 6 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Select Operator
                 expressions: KEY.reducesinkkey0 (type: char(16)), KEY.reducesinkkey1 (type: bigint), VALUE._col0 (type: double), VALUE._col1 (type: bigint), VALUE._col2 (type: double), VALUE._col3 (type: bigint), VALUE._col4 (type: double), VALUE._col5 (type: decimal(25,6))
                 outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7
-                Statistics: Num rows: 1 Data size: 92 Basic stats: COMPLETE Column stats: NONE
+                Statistics: Num rows: 1 Data size: 212 Basic stats: COMPLETE Column stats: NONE
                 Limit
                   Number of rows: 100
-                  Statistics: Num rows: 1 Data size: 92 Basic stats: COMPLETE Column stats: NONE
+                  Statistics: Num rows: 1 Data size: 212 Basic stats: COMPLETE Column stats: NONE
                   File Output Operator
                     compressed: false
-                    Statistics: Num rows: 1 Data size: 92 Basic stats: COMPLETE Column stats: NONE
+                    Statistics: Num rows: 1 Data size: 212 Basic stats: COMPLETE Column stats: NONE
                     table:
                         input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                         output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
                         serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-        Reducer 9 
+        Reducer 8 
             Execution mode: llap
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Semi Join 0 to 1
                 keys:
-                  0 _col30 (type: int)
+                  0 _col4 (type: int)
                   1 _col0 (type: int)
-                outputColumnNames: _col42, _col54
-                Statistics: Num rows: 1 Data size: 77 Basic stats: COMPLETE Column stats: NONE
+                outputColumnNames: _col2
+                Statistics: Num rows: 1 Data size: 66 Basic stats: COMPLETE Column stats: NONE
+                Select Operator
+                  expressions: _col2 (type: date)
+                  outputColumnNames: _col0
+                  Statistics: Num rows: 1 Data size: 66 Basic stats: COMPLETE Column stats: NONE
+                  Group By Operator
+                    keys: _col0 (type: date)
+                    minReductionHashAggr: 0.99
+                    mode: hash
+                    outputColumnNames: _col0
+                    Statistics: Num rows: 1 Data size: 66 Basic stats: COMPLETE Column stats: NONE
+                    Reduce Output Operator
+                      key expressions: _col0 (type: date)
+                      null sort order: z
+                      sort order: +
+                      Map-reduce partition columns: _col0 (type: date)
+                      Statistics: Num rows: 1 Data size: 66 Basic stats: COMPLETE Column stats: NONE
+                    Reduce Output Operator
+                      key expressions: _col0 (type: date)
+                      null sort order: z
+                      sort order: +
+                      Map-reduce partition columns: _col0 (type: date)
+                      Statistics: Num rows: 1 Data size: 66 Basic stats: COMPLETE Column stats: NONE
+                    Reduce Output Operator
+                      key expressions: _col0 (type: date)
+                      null sort order: z
+                      sort order: +
+                      Map-reduce partition columns: _col0 (type: date)
+                      Statistics: Num rows: 1 Data size: 66 Basic stats: COMPLETE Column stats: NONE
+        Reducer 9 
+            Execution mode: llap
+            Reduce Operator Tree:
+              Merge Join Operator
+                condition map:
+                     Left Semi Join 0 to 1
+                keys:
+                  0 _col48 (type: date)
+                  1 _col0 (type: date)
+                outputColumnNames: _col14, _col25
+                Statistics: Num rows: 1 Data size: 176 Basic stats: COMPLETE Column stats: NONE
                 Group By Operator
-                  aggregations: sum(_col42)
-                  keys: _col54 (type: char(16))
+                  aggregations: sum(_col14)
+                  keys: _col25 (type: char(16))
                   minReductionHashAggr: 0.99
                   mode: hash
                   outputColumnNames: _col0, _col1
-                  Statistics: Num rows: 1 Data size: 77 Basic stats: COMPLETE Column stats: NONE
+                  Statistics: Num rows: 1 Data size: 176 Basic stats: COMPLETE Column stats: NONE
                   Reduce Output Operator
                     key expressions: _col0 (type: char(16))
                     null sort order: z
                     sort order: +
                     Map-reduce partition columns: _col0 (type: char(16))
-                    Statistics: Num rows: 1 Data size: 77 Basic stats: COMPLETE Column stats: NONE
+                    Statistics: Num rows: 1 Data size: 176 Basic stats: COMPLETE Column stats: NONE
                     value expressions: _col1 (type: bigint)
 
   Stage: Stage-0
@@ -4204,88 +4325,236 @@ STAGE PLANS:
     Tez
 #### A masked pattern was here ####
       Edges:
-        Map 1 <- Union 2 (CONTAINS)
-        Map 5 <- Union 2 (CONTAINS)
-        Map 6 <- Union 2 (CONTAINS)
-        Reducer 3 <- Union 2 (SIMPLE_EDGE)
-        Reducer 4 <- Reducer 3 (SIMPLE_EDGE)
+        Reducer 10 <- Map 13 (SIMPLE_EDGE), Map 7 (SIMPLE_EDGE)
+        Reducer 11 <- Reducer 10 (SIMPLE_EDGE), Union 4 (CONTAINS)
+        Reducer 2 <- Map 1 (SIMPLE_EDGE), Map 7 (SIMPLE_EDGE)
+        Reducer 3 <- Reducer 2 (SIMPLE_EDGE), Union 4 (CONTAINS)
+        Reducer 5 <- Union 4 (SIMPLE_EDGE)
+        Reducer 6 <- Reducer 5 (SIMPLE_EDGE)
+        Reducer 8 <- Map 12 (SIMPLE_EDGE), Map 7 (SIMPLE_EDGE)
+        Reducer 9 <- Reducer 8 (SIMPLE_EDGE), Union 4 (CONTAINS)
 #### A masked pattern was here ####
       Vertices:
         Map 1 
             Map Operator Tree:
                 TableScan
-                  alias: item
+                  alias: store_sales
+                  properties:
+                    hive.sql.query SELECT "t0"."ss_sold_date_sk", "t0"."ss_sold_time_sk", "t0"."ss_item_sk", "t0"."ss_customer_sk", "t0"."ss_cdemo_sk", "t0"."ss_hdemo_sk", "t0"."ss_addr_sk", "t0"."ss_store_sk", "t0"."ss_promo_sk", "t0"."ss_ticket_number", "t0"."ss_quantity", "t0"."ss_wholesale_cost", "t0"."ss_list_price", "t0"."ss_sales_price", "t0"."ss_ext_discount_amt", "t0"."ss_ext_sales_price", "t0"."ss_ext_wholesale_cost", "t0"."ss_ext_list_price", "t0"."ss_ext_tax", "t0"."ss_coupon_amt", "t0"."ss_net_paid", "t0"."ss_net_paid_inc_tax", "t0"."ss_net_profit", "t6"."d_date_sk", "t6"."d_date_id", "t6"."d_date", "t6"."d_month_seq", "t6"."d_week_seq", "t6"."d_quarter_seq", "t6"."d_year", "t6"."d_dow", "t6"."d_moy", "t6"."d_dom", "t6"."d_qoy", "t6"."d_fy_year", "t6"."d_fy_quarter_seq", "t6"."d_fy_week_seq", "t6"."d_day_name", "t6"."d_quarter_name", "t6"."d_holiday", "t6"."d_weekend", "t6"."d_following_holiday", "t6"."d_first_dom", "t6"."d_last_dom", "t6"."d_same_day_ly", "t6"."d_same_day_lq", "t6"."d_current_day", "t6"."d_current_week", "t6"."d_current_month", "t6"."d_current_quarter", "t6"."d_current_year", "t2"."ca_address_sk", "t2"."ca_address_id", "t2"."ca_street_number", "t2"."ca_street_name", "t2"."ca_street_type", "t2"."ca_suite_number", "t2"."ca_city", "t2"."ca_county", "t2"."ca_state", "t2"."ca_zip", "t2"."ca_country", "t2"."ca_gmt_offset", "t2"."ca_location_type", "t4"."i_item_sk", "t4"."i_item_id", "t4"."i_rec_start_date", "t4"."i_rec_end_date", "t4"."i_item_desc", "t4"."i_current_price", "t4"."i_wholesale_cost", "t4"."i_brand_id", "t4"."i_brand", "t4"."i_class_id", "t4"."i_class", "t4"."i_category_id", "t4"."i_category", "t4"."i_manufact_id", "t4"."i_manufact", "t4"."i_size", "t4"."i_formulation", "t4"."i_color", "t4"."i_units", "t4"."i_container", "t4"."i_manager_id", "t4"."i_product_name"
+FROM (SELECT "ss_sold_date_sk", "ss_sold_time_sk", "ss_item_sk", "ss_customer_sk", "ss_cdemo_sk", "ss_hdemo_sk", "ss_addr_sk", "ss_store_sk", "ss_promo_sk", "ss_ticket_number", "ss_quantity", "ss_wholesale_cost", "ss_list_price", "ss_sales_price", "ss_ext_discount_amt", "ss_ext_sales_price", "ss_ext_wholesale_cost", "ss_ext_list_price", "ss_ext_tax", "ss_coupon_amt", "ss_net_paid", "ss_net_paid_inc_tax", "ss_net_profit"
+FROM "STORE_SALES"
+WHERE "ss_sold_date_sk" IS NOT NULL AND "ss_addr_sk" IS NOT NULL AND "ss_item_sk" IS NOT NULL) AS "t0"
+INNER JOIN (SELECT "ca_address_sk", "ca_address_id", "ca_street_number", "ca_street_name", "ca_street_type", "ca_suite_number", "ca_city", "ca_county", "ca_state", "ca_zip", "ca_country", "ca_gmt_offset", "ca_location_type"
+FROM "CUSTOMER_ADDRESS"
+WHERE "ca_gmt_offset" = -6 AND "ca_address_sk" IS NOT NULL) AS "t2" ON "t0"."ss_addr_sk" = "t2"."ca_address_sk"
+INNER JOIN (SELECT "i_item_sk", "i_item_id", "i_rec_start_date", "i_rec_end_date", "i_item_desc", "i_current_price", "i_wholesale_cost", "i_brand_id", "i_brand", "i_class_id", "i_class", "i_category_id", "i_category", "i_manufact_id", "i_manufact", "i_size", "i_formulation", "i_color", "i_units", "i_container", "i_manager_id", "i_product_name"
+FROM "ITEM"
+WHERE "i_manufact_id" IS NOT NULL AND "i_item_sk" IS NOT NULL) AS "t4" ON "t0"."ss_item_sk" = "t4"."i_item_sk"
+INNER JOIN (SELECT "d_date_sk", "d_date_id", "d_date", "d_month_seq", "d_week_seq", "d_quarter_seq", "d_year", "d_dow", "d_moy", "d_dom", "d_qoy", "d_fy_year", "d_fy_quarter_seq", "d_fy_week_seq", "d_day_name", "d_quarter_name", "d_holiday", "d_weekend", "d_following_holiday", "d_first_dom", "d_last_dom", "d_same_day_ly", "d_same_day_lq", "d_current_day", "d_current_week", "d_current_month", "d_current_quarter", "d_current_year"
+FROM "DATE_DIM"
+WHERE "d_year" = 1999 AND "d_moy" = 3 AND "d_date_sk" IS NOT NULL) AS "t6" ON "t0"."ss_sold_date_sk" = "t6"."d_date_sk"
+                    hive.sql.query.fieldNames ss_sold_date_sk,ss_sold_time_sk,ss_item_sk,ss_customer_sk,ss_cdemo_sk,ss_hdemo_sk,ss_addr_sk,ss_store_sk,ss_promo_sk,ss_ticket_number,ss_quantity,ss_wholesale_cost,ss_list_price,ss_sales_price,ss_ext_discount_amt,ss_ext_sales_price,ss_ext_wholesale_cost,ss_ext_list_price,ss_ext_tax,ss_coupon_amt,ss_net_paid,ss_net_paid_inc_tax,ss_net_profit,d_date_sk,d_date_id,d_date,d_month_seq,d_week_seq,d_quarter_seq,d_year,d_dow,d_moy,d_dom,d_qoy,d_fy_year,d_fy_quarter_seq,d_fy_week_seq,d_day_name,d_quarter_name,d_holiday,d_weekend,d_following_holiday,d_first_dom,d_last_dom,d_same_day_ly,d_same_day_lq,d_current_day,d_current_week,d_current_month,d_current_quarter,d_current_year,ca_address_sk,ca_address_id,ca_street_number,ca_street_name,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset,ca_location_type,i_item_sk,i_item_id,i_rec_start_date,i_rec_end_date,i_item_desc,i_current_price,i_wholesale_cost,i_brand_id,i_brand,i_class_id,i_class,i_category_id,i_category,i_manufact_id,i_manufact,i_size,i_formulation,i_color,i_units,i_container,i_manager_id,i_product_name
+                    hive.sql.query.fieldTypes int,int,int,int,int,int,int,int,int,int,int,decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),int,char(16),date,int,int,int,int,int,int,int,int,int,int,int,char(9),char(6),char(1),char(1),char(1),int,int,int,int,char(1),char(1),char(1),char(1),char(1),int,char(16),char(10),varchar(60),char(15),char(10),varchar(60),varchar(30),char(2),char(10),varchar(20),decimal(5,2),char(20),int,char(16),date,date,varchar(200),decimal(7,2),decimal(7,2),int,char(50),int,char(50),int,char(50),int,char(50),char(20),char(20),char(20),char(10),char(10),int,char(50)
+                    hive.sql.query.split false
                   Statistics: Num rows: 1 Data size: 116 Basic stats: COMPLETE Column stats: NONE
                   Select Operator
-                    expressions: i_manufact_id (type: int), $f1 (type: decimal(17,2))
-                    outputColumnNames: _col0, _col1
+                    expressions: ss_ext_sales_price (type: decimal(7,2)), i_manufact_id (type: int)
+                    outputColumnNames: _col15, _col77
                     Statistics: Num rows: 1 Data size: 116 Basic stats: COMPLETE Column stats: NONE
-                    Group By Operator
-                      aggregations: sum(_col1)
-                      keys: _col0 (type: int)
-                      minReductionHashAggr: 0.99
-                      mode: hash
-                      outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 3 Data size: 348 Basic stats: COMPLETE Column stats: NONE
-                      Reduce Output Operator
-                        key expressions: _col0 (type: int)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col0 (type: int)
-                        Statistics: Num rows: 3 Data size: 348 Basic stats: COMPLETE Column stats: NONE
-                        value expressions: _col1 (type: decimal(27,2))
+                    Reduce Output Operator
+                      key expressions: _col77 (type: int)
+                      null sort order: z
+                      sort order: +
+                      Map-reduce partition columns: _col77 (type: int)
+                      Statistics: Num rows: 1 Data size: 116 Basic stats: COMPLETE Column stats: NONE
+                      value expressions: _col15 (type: decimal(7,2))
             Execution mode: vectorized, llap
             LLAP IO: no inputs
-        Map 5 
+        Map 12 
             Map Operator Tree:
                 TableScan
-                  alias: item
+                  alias: catalog_sales
+                  properties:
+                    hive.sql.query SELECT "t0"."cs_sold_date_sk", "t0"."cs_sold_time_sk", "t0"."cs_ship_date_sk", "t0"."cs_bill_customer_sk", "t0"."cs_bill_cdemo_sk", "t0"."cs_bill_hdemo_sk", "t0"."cs_bill_addr_sk", "t0"."cs_ship_customer_sk", "t0"."cs_ship_cdemo_sk", "t0"."cs_ship_hdemo_sk", "t0"."cs_ship_addr_sk", "t0"."cs_call_center_sk", "t0"."cs_catalog_page_sk", "t0"."cs_ship_mode_sk", "t0"."cs_warehouse_sk", "t0"."cs_item_sk", "t0"."cs_promo_sk", "t0"."cs_order_number", "t0"."cs_quantity", "t0"."cs_wholesale_cost", "t0"."cs_list_price", "t0"."cs_sales_price", "t0"."cs_ext_discount_amt", "t0"."cs_ext_sales_price", "t0"."cs_ext_wholesale_cost", "t0"."cs_ext_list_price", "t0"."cs_ext_tax", "t0"."cs_coupon_amt", "t0"."cs_ext_ship_cost", "t0"."cs_net_paid", "t0"."cs_net_paid_inc_tax", "t0"."cs_net_paid_inc_ship", "t0"."cs_net_paid_inc_ship_tax", "t0"."cs_net_profit", "t6"."d_date_sk", "t6"."d_date_id", "t6"."d_date", "t6"."d_month_seq", "t6"."d_week_seq", "t6"."d_quarter_seq", "t6"."d_year", "t6"."d_dow", "t6"."d_moy", "t6"."d_dom", "t6"."d_qoy", "t6"."d_fy_year", "t6"."d_fy_quarter_seq", "t6"."d_fy_week_seq", "t6"."d_day_name", "t6"."d_quarter_name", "t6"."d_holiday", "t6"."d_weekend", "t6"."d_following_holiday", "t6"."d_first_dom", "t6"."d_last_dom", "t6"."d_same_day_ly", "t6"."d_same_day_lq", "t6"."d_current_day", "t6"."d_current_week", "t6"."d_current_month", "t6"."d_current_quarter", "t6"."d_current_year", "t2"."ca_address_sk", "t2"."ca_address_id", "t2"."ca_street_number", "t2"."ca_street_name", "t2"."ca_street_type", "t2"."ca_suite_number", "t2"."ca_city", "t2"."ca_county", "t2"."ca_state", "t2"."ca_zip", "t2"."ca_country", "t2"."ca_gmt_offset", "t2"."ca_location_type", "t4"."i_item_sk", "t4"."i_item_id", "t4"."i_rec_start_date", "t4"."i_rec_end_date", "t4"."i_item_desc", "t4"."i_current_price", "t4"."i_wholesale_cost", "t4"."i_brand_id", "t4"."i_brand", "t4"."i_class_id", "t4"."i_class", "t4"."i_category_id", "t4"."i_category", "t4"."i_manufact_id", "t4"."i_manufact", "t4"."i_size", "t4"."i_formulation", "t4"."i_color", "t4"."i_units", "t4"."i_container", "t4"."i_manager_id", "t4"."i_product_name"
+FROM (SELECT "cs_sold_date_sk", "cs_sold_time_sk", "cs_ship_date_sk", "cs_bill_customer_sk", "cs_bill_cdemo_sk", "cs_bill_hdemo_sk", "cs_bill_addr_sk", "cs_ship_customer_sk", "cs_ship_cdemo_sk", "cs_ship_hdemo_sk", "cs_ship_addr_sk", "cs_call_center_sk", "cs_catalog_page_sk", "cs_ship_mode_sk", "cs_warehouse_sk", "cs_item_sk", "cs_promo_sk", "cs_order_number", "cs_quantity", "cs_wholesale_cost", "cs_list_price", "cs_sales_price", "cs_ext_discount_amt", "cs_ext_sales_price", "cs_ext_wholesale_cost", "cs_ext_list_price", "cs_ext_tax", "cs_coupon_amt", "cs_ext_ship_cost", "cs_net_paid", "cs_net_paid_inc_tax", "cs_net_paid_inc_ship", "cs_net_paid_inc_ship_tax", "cs_net_profit"
+FROM "CATALOG_SALES"
+WHERE "cs_sold_date_sk" IS NOT NULL AND "cs_bill_addr_sk" IS NOT NULL AND "cs_item_sk" IS NOT NULL) AS "t0"
+INNER JOIN (SELECT "ca_address_sk", "ca_address_id", "ca_street_number", "ca_street_name", "ca_street_type", "ca_suite_number", "ca_city", "ca_county", "ca_state", "ca_zip", "ca_country", "ca_gmt_offset", "ca_location_type"
+FROM "CUSTOMER_ADDRESS"
+WHERE "ca_gmt_offset" = -6 AND "ca_address_sk" IS NOT NULL) AS "t2" ON "t0"."cs_bill_addr_sk" = "t2"."ca_address_sk"
+INNER JOIN (SELECT "i_item_sk", "i_item_id", "i_rec_start_date", "i_rec_end_date", "i_item_desc", "i_current_price", "i_wholesale_cost", "i_brand_id", "i_brand", "i_class_id", "i_class", "i_category_id", "i_category", "i_manufact_id", "i_manufact", "i_size", "i_formulation", "i_color", "i_units", "i_container", "i_manager_id", "i_product_name"
+FROM "ITEM"
+WHERE "i_manufact_id" IS NOT NULL AND "i_item_sk" IS NOT NULL) AS "t4" ON "t0"."cs_item_sk" = "t4"."i_item_sk"
+INNER JOIN (SELECT "d_date_sk", "d_date_id", "d_date", "d_month_seq", "d_week_seq", "d_quarter_seq", "d_year", "d_dow", "d_moy", "d_dom", "d_qoy", "d_fy_year", "d_fy_quarter_seq", "d_fy_week_seq", "d_day_name", "d_quarter_name", "d_holiday", "d_weekend", "d_following_holiday", "d_first_dom", "d_last_dom", "d_same_day_ly", "d_same_day_lq", "d_current_day", "d_current_week", "d_current_month", "d_current_quarter", "d_current_year"
+FROM "DATE_DIM"
+WHERE "d_year" = 1999 AND "d_moy" = 3 AND "d_date_sk" IS NOT NULL) AS "t6" ON "t0"."cs_sold_date_sk" = "t6"."d_date_sk"
+                    hive.sql.query.fieldNames cs_sold_date_sk,cs_sold_time_sk,cs_ship_date_sk,cs_bill_customer_sk,cs_bill_cdemo_sk,cs_bill_hdemo_sk,cs_bill_addr_sk,cs_ship_customer_sk,cs_ship_cdemo_sk,cs_ship_hdemo_sk,cs_ship_addr_sk,cs_call_center_sk,cs_catalog_page_sk,cs_ship_mode_sk,cs_warehouse_sk,cs_item_sk,cs_promo_sk,cs_order_number,cs_quantity,cs_wholesale_cost,cs_list_price,cs_sales_price,cs_ext_discount_amt,cs_ext_sales_price,cs_ext_wholesale_cost,cs_ext_list_price,cs_ext_tax,cs_coupon_amt,cs_ext_ship_cost,cs_net_paid,cs_net_paid_inc_tax,cs_net_paid_inc_ship,cs_net_paid_inc_ship_tax,cs_net_profit,d_date_sk,d_date_id,d_date,d_month_seq,d_week_seq,d_quarter_seq,d_year,d_dow,d_moy,d_dom,d_qoy,d_fy_year,d_fy_quarter_seq,d_fy_week_seq,d_day_name,d_quarter_name,d_holiday,d_weekend,d_following_holiday,d_first_dom,d_last_dom,d_same_day_ly,d_same_day_lq,d_current_day,d_current_week,d_current_month,d_current_quarter,d_current_year,ca_address_sk,ca_address_id,ca_street_number,ca_street_name,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset,ca_location_type,i_item_sk,i_item_id,i_rec_start_date,i_rec_end_date,i_item_desc,i_current_price,i_wholesale_cost,i_brand_id,i_brand,i_class_id,i_class,i_category_id,i_category,i_manufact_id,i_manufact,i_size,i_formulation,i_color,i_units,i_container,i_manager_id,i_product_name
+                    hive.sql.query.fieldTypes int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),int,char(16),date,int,int,int,int,int,int,int,int,int,int,int,char(9),char(6),char(1),char(1),char(1),int,int,int,int,char(1),char(1),char(1),char(1),char(1),int,char(16),char(10),varchar(60),char(15),char(10),varchar(60),varchar(30),char(2),char(10),varchar(20),decimal(5,2),char(20),int,char(16),date,date,varchar(200),decimal(7,2),decimal(7,2),int,char(50),int,char(50),int,char(50),int,char(50),char(20),char(20),char(20),char(10),char(10),int,char(50)
+                    hive.sql.query.split false
                   Statistics: Num rows: 1 Data size: 116 Basic stats: COMPLETE Column stats: NONE
                   Select Operator
-                    expressions: i_manufact_id (type: int), $f1 (type: decimal(17,2))
-                    outputColumnNames: _col0, _col1
+                    expressions: cs_ext_sales_price (type: decimal(7,2)), i_manufact_id (type: int)
+                    outputColumnNames: _col23, _col88
                     Statistics: Num rows: 1 Data size: 116 Basic stats: COMPLETE Column stats: NONE
-                    Group By Operator
-                      aggregations: sum(_col1)
-                      keys: _col0 (type: int)
-                      minReductionHashAggr: 0.99
-                      mode: hash
-                      outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 3 Data size: 348 Basic stats: COMPLETE Column stats: NONE
-                      Reduce Output Operator
-                        key expressions: _col0 (type: int)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col0 (type: int)
-                        Statistics: Num rows: 3 Data size: 348 Basic stats: COMPLETE Column stats: NONE
-                        value expressions: _col1 (type: decimal(27,2))
+                    Reduce Output Operator
+                      key expressions: _col88 (type: int)
+                      null sort order: z
+                      sort order: +
+                      Map-reduce partition columns: _col88 (type: int)
+                      Statistics: Num rows: 1 Data size: 116 Basic stats: COMPLETE Column stats: NONE
+                      value expressions: _col23 (type: decimal(7,2))
             Execution mode: vectorized, llap
             LLAP IO: no inputs
-        Map 6 
+        Map 13 
             Map Operator Tree:
                 TableScan
-                  alias: item
+                  alias: web_sales
+                  properties:
+                    hive.sql.query SELECT "t0"."ws_sold_date_sk", "t0"."ws_sold_time_sk", "t0"."ws_ship_date_sk", "t0"."ws_item_sk", "t0"."ws_bill_customer_sk", "t0"."ws_bill_cdemo_sk", "t0"."ws_bill_hdemo_sk", "t0"."ws_bill_addr_sk", "t0"."ws_ship_customer_sk", "t0"."ws_ship_cdemo_sk", "t0"."ws_ship_hdemo_sk", "t0"."ws_ship_addr_sk", "t0"."ws_web_page_sk", "t0"."ws_web_site_sk", "t0"."ws_ship_mode_sk", "t0"."ws_warehouse_sk", "t0"."ws_promo_sk", "t0"."ws_order_number", "t0"."ws_quantity", "t0"."ws_wholesale_cost", "t0"."ws_list_price", "t0"."ws_sales_price", "t0"."ws_ext_discount_amt", "t0"."ws_ext_sales_price", "t0"."ws_ext_wholesale_cost", "t0"."ws_ext_list_price", "t0"."ws_ext_tax", "t0"."ws_coupon_amt", "t0"."ws_ext_ship_cost", "t0"."ws_net_paid", "t0"."ws_net_paid_inc_tax", "t0"."ws_net_paid_inc_ship", "t0"."ws_net_paid_inc_ship_tax", "t0"."ws_net_profit", "t6"."d_date_sk", "t6"."d_date_id", "t6"."d_date", "t6"."d_month_seq", "t6"."d_week_seq", "t6"."d_quarter_seq", "t6"."d_year", "t6"."d_dow", "t6"."d_moy", "t6"."d_dom", "t6"."d_qoy", "t6"."d_fy_year", "t6"."d_fy_quarter_seq", "t6"."d_fy_week_seq", "t6"."d_day_name", "t6"."d_quarter_name", "t6"."d_holiday", "t6"."d_weekend", "t6"."d_following_holiday", "t6"."d_first_dom", "t6"."d_last_dom", "t6"."d_same_day_ly", "t6"."d_same_day_lq", "t6"."d_current_day", "t6"."d_current_week", "t6"."d_current_month", "t6"."d_current_quarter", "t6"."d_current_year", "t2"."ca_address_sk", "t2"."ca_address_id", "t2"."ca_street_number", "t2"."ca_street_name", "t2"."ca_street_type", "t2"."ca_suite_number", "t2"."ca_city", "t2"."ca_county", "t2"."ca_state", "t2"."ca_zip", "t2"."ca_country", "t2"."ca_gmt_offset", "t2"."ca_location_type", "t4"."i_item_sk", "t4"."i_item_id", "t4"."i_rec_start_date", "t4"."i_rec_end_date", "t4"."i_item_desc", "t4"."i_current_price", "t4"."i_wholesale_cost", "t4"."i_brand_id", "t4"."i_brand", "t4"."i_class_id", "t4"."i_class", "t4"."i_category_id", "t4"."i_category", "t4"."i_manufact_id", "t4"."i_manufact", "t4"."i_size", "t4"."i_formulation", "t4"."i_color", "t4"."i_units", "t4"."i_container", "t4"."i_manager_id", "t4"."i_product_name"
+FROM (SELECT "ws_sold_date_sk", "ws_sold_time_sk", "ws_ship_date_sk", "ws_item_sk", "ws_bill_customer_sk", "ws_bill_cdemo_sk", "ws_bill_hdemo_sk", "ws_bill_addr_sk", "ws_ship_customer_sk", "ws_ship_cdemo_sk", "ws_ship_hdemo_sk", "ws_ship_addr_sk", "ws_web_page_sk", "ws_web_site_sk", "ws_ship_mode_sk", "ws_warehouse_sk", "ws_promo_sk", "ws_order_number", "ws_quantity", "ws_wholesale_cost", "ws_list_price", "ws_sales_price", "ws_ext_discount_amt", "ws_ext_sales_price", "ws_ext_wholesale_cost", "ws_ext_list_price", "ws_ext_tax", "ws_coupon_amt", "ws_ext_ship_cost", "ws_net_paid", "ws_net_paid_inc_tax", "ws_net_paid_inc_ship", "ws_net_paid_inc_ship_tax", "ws_net_profit"
+FROM "WEB_SALES"
+WHERE "ws_sold_date_sk" IS NOT NULL AND "ws_bill_addr_sk" IS NOT NULL AND "ws_item_sk" IS NOT NULL) AS "t0"
+INNER JOIN (SELECT "ca_address_sk", "ca_address_id", "ca_street_number", "ca_street_name", "ca_street_type", "ca_suite_number", "ca_city", "ca_county", "ca_state", "ca_zip", "ca_country", "ca_gmt_offset", "ca_location_type"
+FROM "CUSTOMER_ADDRESS"
+WHERE "ca_gmt_offset" = -6 AND "ca_address_sk" IS NOT NULL) AS "t2" ON "t0"."ws_bill_addr_sk" = "t2"."ca_address_sk"
+INNER JOIN (SELECT "i_item_sk", "i_item_id", "i_rec_start_date", "i_rec_end_date", "i_item_desc", "i_current_price", "i_wholesale_cost", "i_brand_id", "i_brand", "i_class_id", "i_class", "i_category_id", "i_category", "i_manufact_id", "i_manufact", "i_size", "i_formulation", "i_color", "i_units", "i_container", "i_manager_id", "i_product_name"
+FROM "ITEM"
+WHERE "i_manufact_id" IS NOT NULL AND "i_item_sk" IS NOT NULL) AS "t4" ON "t0"."ws_item_sk" = "t4"."i_item_sk"
+INNER JOIN (SELECT "d_date_sk", "d_date_id", "d_date", "d_month_seq", "d_week_seq", "d_quarter_seq", "d_year", "d_dow", "d_moy", "d_dom", "d_qoy", "d_fy_year", "d_fy_quarter_seq", "d_fy_week_seq", "d_day_name", "d_quarter_name", "d_holiday", "d_weekend", "d_following_holiday", "d_first_dom", "d_last_dom", "d_same_day_ly", "d_same_day_lq", "d_current_day", "d_current_week", "d_current_month", "d_current_quarter", "d_current_year"
+FROM "DATE_DIM"
+WHERE "d_year" = 1999 AND "d_moy" = 3 AND "d_date_sk" IS NOT NULL) AS "t6" ON "t0"."ws_sold_date_sk" = "t6"."d_date_sk"
+                    hive.sql.query.fieldNames ws_sold_date_sk,ws_sold_time_sk,ws_ship_date_sk,ws_item_sk,ws_bill_customer_sk,ws_bill_cdemo_sk,ws_bill_hdemo_sk,ws_bill_addr_sk,ws_ship_customer_sk,ws_ship_cdemo_sk,ws_ship_hdemo_sk,ws_ship_addr_sk,ws_web_page_sk,ws_web_site_sk,ws_ship_mode_sk,ws_warehouse_sk,ws_promo_sk,ws_order_number,ws_quantity,ws_wholesale_cost,ws_list_price,ws_sales_price,ws_ext_discount_amt,ws_ext_sales_price,ws_ext_wholesale_cost,ws_ext_list_price,ws_ext_tax,ws_coupon_amt,ws_ext_ship_cost,ws_net_paid,ws_net_paid_inc_tax,ws_net_paid_inc_ship,ws_net_paid_inc_ship_tax,ws_net_profit,d_date_sk,d_date_id,d_date,d_month_seq,d_week_seq,d_quarter_seq,d_year,d_dow,d_moy,d_dom,d_qoy,d_fy_year,d_fy_quarter_seq,d_fy_week_seq,d_day_name,d_quarter_name,d_holiday,d_weekend,d_following_holiday,d_first_dom,d_last_dom,d_same_day_ly,d_same_day_lq,d_current_day,d_current_week,d_current_month,d_current_quarter,d_current_year,ca_address_sk,ca_address_id,ca_street_number,ca_street_name,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset,ca_location_type,i_item_sk,i_item_id,i_rec_start_date,i_rec_end_date,i_item_desc,i_current_price,i_wholesale_cost,i_brand_id,i_brand,i_class_id,i_class,i_category_id,i_category,i_manufact_id,i_manufact,i_size,i_formulation,i_color,i_units,i_container,i_manager_id,i_product_name
+                    hive.sql.query.fieldTypes int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,int,decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),decimal(7,2),int,char(16),date,int,int,int,int,int,int,int,int,int,int,int,char(9),char(6),char(1),char(1),char(1),int,int,int,int,char(1),char(1),char(1),char(1),char(1),int,char(16),char(10),varchar(60),char(15),char(10),varchar(60),varchar(30),char(2),char(10),varchar(20),decimal(5,2),char(20),int,char(16),date,date,varchar(200),decimal(7,2),decimal(7,2),int,char(50),int,char(50),int,char(50),int,char(50),char(20),char(20),char(20),char(10),char(10),int,char(50)
+                    hive.sql.query.split false
                   Statistics: Num rows: 1 Data size: 116 Basic stats: COMPLETE Column stats: NONE
                   Select Operator
-                    expressions: i_manufact_id (type: int), $f1 (type: decimal(17,2))
-                    outputColumnNames: _col0, _col1
+                    expressions: ws_ext_sales_price (type: decimal(7,2)), i_manufact_id (type: int)
+                    outputColumnNames: _col23, _col88
                     Statistics: Num rows: 1 Data size: 116 Basic stats: COMPLETE Column stats: NONE
+                    Reduce Output Operator
+                      key expressions: _col88 (type: int)
+                      null sort order: z
+                      sort order: +
+                      Map-reduce partition columns: _col88 (type: int)
+                      Statistics: Num rows: 1 Data size: 116 Basic stats: COMPLETE Column stats: NONE
+                      value expressions: _col23 (type: decimal(7,2))
+            Execution mode: vectorized, llap
+            LLAP IO: no inputs
+        Map 7 
+            Map Operator Tree:
+                TableScan
+                  alias: item
+                  properties:
+                    hive.sql.query SELECT "i_manufact_id"
+FROM "ITEM"
+WHERE "i_category" = 'Books                                             ' AND "i_manufact_id" IS NOT NULL
+                    hive.sql.query.fieldNames i_manufact_id
+                    hive.sql.query.fieldTypes int
+                    hive.sql.query.split true
+                  Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
+                  Select Operator
+                    expressions: i_manufact_id (type: int)
+                    outputColumnNames: _col0
+                    Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
                     Group By Operator
-                      aggregations: sum(_col1)
                       keys: _col0 (type: int)
                       minReductionHashAggr: 0.99
                       mode: hash
-                      outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 3 Data size: 348 Basic stats: COMPLETE Column stats: NONE
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
+                      Reduce Output Operator
+                        key expressions: _col0 (type: int)
+                        null sort order: z
+                        sort order: +
+                        Map-reduce partition columns: _col0 (type: int)
+                        Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
                       Reduce Output Operator
                         key expressions: _col0 (type: int)
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: int)
-                        Statistics: Num rows: 3 Data size: 348 Basic stats: COMPLETE Column stats: NONE
-                        value expressions: _col1 (type: decimal(27,2))
+                        Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
+                      Reduce Output Operator
+                        key expressions: _col0 (type: int)
+                        null sort order: z
+                        sort order: +
+                        Map-reduce partition columns: _col0 (type: int)
+                        Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
             Execution mode: vectorized, llap
             LLAP IO: no inputs
+        Reducer 10 
+            Execution mode: llap
+            Reduce Operator Tree:
+              Merge Join Operator
+                condition map:
+                     Left Semi Join 0 to 1
+                keys:
+                  0 _col88 (type: int)
+                  1 _col0 (type: int)
+                outputColumnNames: _col23, _col88
+                Statistics: Num rows: 1 Data size: 127 Basic stats: COMPLETE Column stats: NONE
+                Group By Operator
+                  aggregations: sum(_col23)
+                  keys: _col88 (type: int)
+                  minReductionHashAggr: 0.99
+                  mode: hash
+                  outputColumnNames: _col0, _col1
+                  Statistics: Num rows: 1 Data size: 127 Basic stats: COMPLETE Column stats: NONE
+                  Reduce Output Operator
+                    key expressions: _col0 (type: int)
+                    null sort order: z
+                    sort order: +
+                    Map-reduce partition columns: _col0 (type: int)
+                    Statistics: Num rows: 1 Data size: 127 Basic stats: COMPLETE Column stats: NONE
+                    value expressions: _col1 (type: decimal(17,2))
+        Reducer 11 
+            Execution mode: vectorized, llap
+            Reduce Operator Tree:
+              Group By Operator
+                aggregations: sum(VALUE._col0)
+                keys: KEY._col0 (type: int)
+                mode: mergepartial
+                outputColumnNames: _col0, _col1
+                Statistics: Num rows: 1 Data size: 127 Basic stats: COMPLETE Column stats: NONE
+                Group By Operator
+                  aggregations: sum(_col1)
+                  keys: _col0 (type: int)
+                  minReductionHashAggr: 0.99
+                  mode: hash
+                  outputColumnNames: _col0, _col1
+                  Statistics: Num rows: 3 Data size: 381 Basic stats: COMPLETE Column stats: NONE
+                  Reduce Output Operator
+                    key expressions: _col0 (type: int)
+                    null sort order: z
+                    sort order: +
+                    Map-reduce partition columns: _col0 (type: int)
+                    Statistics: Num rows: 3 Data size: 381 Basic stats: COMPLETE Column stats: NONE
+                    value expressions: _col1 (type: decimal(27,2))
+        Reducer 2 
+            Execution mode: llap
+            Reduce Operator Tree:
+              Merge Join Operator
+                condition map:
+                     Left Semi Join 0 to 1
+                keys:
+                  0 _col77 (type: int)
+                  1 _col0 (type: int)
+                outputColumnNames: _col15, _col77
+                Statistics: Num rows: 1 Data size: 127 Basic stats: COMPLETE Column stats: NONE
+                Group By Operator
+                  aggregations: sum(_col15)
+                  keys: _col77 (type: int)
+                  minReductionHashAggr: 0.99
+                  mode: hash
+                  outputColumnNames: _col0, _col1
+                  Statistics: Num rows: 1 Data size: 127 Basic stats: COMPLETE Column stats: NONE
+                  Reduce Output Operator
+                    key expressions: _col0 (type: int)
+                    null sort order: z
+                    sort order: +
+                    Map-reduce partition columns: _col0 (type: int)
+                    Statistics: Num rows: 1 Data size: 127 Basic stats: COMPLETE Column stats: NONE
+                    value expressions: _col1 (type: decimal(17,2))
         Reducer 3 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
@@ -4294,38 +4563,109 @@ STAGE PLANS:
                 keys: KEY._col0 (type: int)
                 mode: mergepartial
                 outputColumnNames: _col0, _col1
-                Statistics: Num rows: 1 Data size: 116 Basic stats: COMPLETE Column stats: NONE
+                Statistics: Num rows: 1 Data size: 127 Basic stats: COMPLETE Column stats: NONE
+                Group By Operator
+                  aggregations: sum(_col1)
+                  keys: _col0 (type: int)
+                  minReductionHashAggr: 0.99
+                  mode: hash
+                  outputColumnNames: _col0, _col1
+                  Statistics: Num rows: 3 Data size: 381 Basic stats: COMPLETE Column stats: NONE
+                  Reduce Output Operator
+                    key expressions: _col0 (type: int)
+                    null sort order: z
+                    sort order: +
+                    Map-reduce partition columns: _col0 (type: int)
+                    Statistics: Num rows: 3 Data size: 381 Basic stats: COMPLETE Column stats: NONE
+                    value expressions: _col1 (type: decimal(27,2))
+        Reducer 5 
+            Execution mode: vectorized, llap
+            Reduce Operator Tree:
+              Group By Operator
+                aggregations: sum(VALUE._col0)
+                keys: KEY._col0 (type: int)
+                mode: mergepartial
+                outputColumnNames: _col0, _col1
+                Statistics: Num rows: 1 Data size: 127 Basic stats: COMPLETE Column stats: NONE
                 Top N Key Operator
                   sort order: +
                   keys: _col1 (type: decimal(27,2))
                   null sort order: z
-                  Statistics: Num rows: 1 Data size: 116 Basic stats: COMPLETE Column stats: NONE
+                  Statistics: Num rows: 1 Data size: 127 Basic stats: COMPLETE Column stats: NONE
                   top n: 100
                   Reduce Output Operator
                     key expressions: _col1 (type: decimal(27,2))
                     null sort order: z
                     sort order: +
-                    Statistics: Num rows: 1 Data size: 116 Basic stats: COMPLETE Column stats: NONE
+                    Statistics: Num rows: 1 Data size: 127 Basic stats: COMPLETE Column stats: NONE
                     value expressions: _col0 (type: int)
-        Reducer 4 
+        Reducer 6 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Select Operator
                 expressions: VALUE._col0 (type: int), KEY.reducesinkkey0 (type: decimal(27,2))
                 outputColumnNames: _col0, _col1
-                Statistics: Num rows: 1 Data size: 116 Basic stats: COMPLETE Column stats: NONE
+                Statistics: Num rows: 1 Data size: 127 Basic stats: COMPLETE Column stats: NONE
                 Limit
                   Number of rows: 100
-                  Statistics: Num rows: 1 Data size: 116 Basic stats: COMPLETE Column stats: NONE
+                  Statistics: Num rows: 1 Data size: 127 Basic stats: COMPLETE Column stats: NONE
                   File Output Operator
                     compressed: false
-                    Statistics: Num rows: 1 Data size: 116 Basic stats: COMPLETE Column stats: NONE
+                    Statistics: Num rows: 1 Data size: 127 Basic stats: COMPLETE Column stats: NONE
                     table:
                         input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                         output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
                         serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-        Union 2 
-            Vertex: Union 2
+        Reducer 8 
+            Execution mode: llap
+            Reduce Operator Tree:
+              Merge Join Operator
+                condition map:
+                     Left Semi Join 0 to 1
+                keys:
+                  0 _col88 (type: int)
+                  1 _col0 (type: int)
+                outputColumnNames: _col23, _col88
+                Statistics: Num rows: 1 Data size: 127 Basic stats: COMPLETE Column stats: NONE
+                Group By Operator
+                  aggregations: sum(_col23)
+                  keys: _col88 (type: int)
+                  minReductionHashAggr: 0.99
+                  mode: hash
+                  outputColumnNames: _col0, _col1
+                  Statistics: Num rows: 1 Data size: 127 Basic stats: COMPLETE Column stats: NONE
+                  Reduce Output Operator
+                    key expressions: _col0 (type: int)
+                    null sort order: z
+                    sort order: +
+                    Map-reduce partition columns: _col0 (type: int)
+                    Statistics: Num rows: 1 Data size: 127 Basic stats: COMPLETE Column stats: NONE
+                    value expressions: _col1 (type: decimal(17,2))
+        Reducer 9 
+            Execution mode: vectorized, llap
+            Reduce Operator Tree:
+              Group By Operator
+                aggregations: sum(VALUE._col0)
+                keys: KEY._col0 (type: int)
+                mode: mergepartial
+                outputColumnNames: _col0, _col1
+                Statistics: Num rows: 1 Data size: 127 Basic stats: COMPLETE Column stats: NONE
+                Group By Operator
+                  aggregations: sum(_col1)
+                  keys: _col0 (type: int)
+                  minReductionHashAggr: 0.99
+                  mode: hash
+                  outputColumnNames: _col0, _col1
+                  Statistics: Num rows: 3 Data size: 381 Basic stats: COMPLETE Column stats: NONE
+                  Reduce Output Operator
+                    key expressions: _col0 (type: int)
+                    null sort order: z
+                    sort order: +
+                    Map-reduce partition columns: _col0 (type: int)
+                    Statistics: Num rows: 3 Data size: 381 Basic stats: COMPLETE Column stats: NONE
+                    value expressions: _col1 (type: decimal(27,2))
+        Union 4 
+            Vertex: Union 4
 
   Stage: Stage-0
     Fetch Operator
diff --git a/ql/src/test/results/clientpositive/llap/groupby_groupingset_bug.q.out b/ql/src/test/results/clientpositive/llap/groupby_groupingset_bug.q.out
index 3c944483fb..9f5247196b 100644
--- a/ql/src/test/results/clientpositive/llap/groupby_groupingset_bug.q.out
+++ b/ql/src/test/results/clientpositive/llap/groupby_groupingset_bug.q.out
@@ -213,109 +213,97 @@ POSTHOOK: Input: default@x1_store_sales@ss_sold_date_sk=2
 Plan optimized by CBO.
 
 Vertex dependency in root stage
-Map 1 <- Reducer 3 (BROADCAST_EDGE)
-Map 4 <- Map 1 (BROADCAST_EDGE), Map 7 (BROADCAST_EDGE)
-Map 7 <- Reducer 9 (BROADCAST_EDGE)
-Reducer 3 <- Map 2 (SIMPLE_EDGE)
+Map 1 <- Map 4 (BROADCAST_EDGE), Map 6 (BROADCAST_EDGE), Reducer 5 (BROADCAST_EDGE), Reducer 7 (BROADCAST_EDGE)
+Reducer 2 <- Map 1 (SIMPLE_EDGE)
+Reducer 3 <- Reducer 2 (SIMPLE_EDGE)
 Reducer 5 <- Map 4 (SIMPLE_EDGE)
-Reducer 6 <- Reducer 5 (SIMPLE_EDGE)
-Reducer 9 <- Map 8 (SIMPLE_EDGE)
+Reducer 7 <- Map 6 (SIMPLE_EDGE)
 
 Stage-0
   Fetch Operator
     limit:100
     Stage-1
-      Reducer 6 vectorized, llap
-      File Output Operator [FS_145]
-        Limit [LIM_144] (rows=2 width=8)
+      Reducer 3 vectorized, llap
+      File Output Operator [FS_149]
+        Limit [LIM_148] (rows=2 width=8)
           Number of rows:100
-          Select Operator [SEL_143] (rows=2 width=8)
+          Select Operator [SEL_147] (rows=2 width=8)
             Output:["_col0"]
-          <-Reducer 5 [SIMPLE_EDGE] vectorized, llap
-            SHUFFLE [RS_142]
-              Select Operator [SEL_141] (rows=2 width=8)
+          <-Reducer 2 [SIMPLE_EDGE] vectorized, llap
+            SHUFFLE [RS_146]
+              Select Operator [SEL_145] (rows=2 width=8)
                 Output:["_col0"]
-                Top N Key Operator [TNK_140] (rows=2 width=12)
+                Top N Key Operator [TNK_144] (rows=2 width=12)
                   keys:_col1,top n:100
-                  Group By Operator [GBY_139] (rows=2 width=12)
+                  Group By Operator [GBY_143] (rows=2 width=12)
                     Output:["_col0","_col1"],aggregations:["count(VALUE._col0)"],keys:KEY._col0
-                  <-Map 4 [SIMPLE_EDGE] vectorized, llap
-                    SHUFFLE [RS_138]
+                  <-Map 1 [SIMPLE_EDGE] llap
+                    SHUFFLE [RS_38]
                       PartitionCols:_col0
-                      Group By Operator [GBY_137] (rows=2 width=12)
-                        Output:["_col0","_col1"],aggregations:["count()"],keys:_col8
-                        Map Join Operator [MAPJOIN_136] (rows=5185194 width=4)
-                          Conds:MAPJOIN_135._col6=RS_129._col0(Inner),Output:["_col8"]
-                        <-Map 7 [BROADCAST_EDGE] vectorized, llap
-                          BROADCAST [RS_129]
-                            PartitionCols:_col0
-                            Map Join Operator [MAPJOIN_128] (rows=28 width=8)
-                              Conds:SEL_127._col1=RS_125._col0(Inner),Output:["_col0","_col1"]
-                            <-Reducer 9 [BROADCAST_EDGE] vectorized, llap
-                              BROADCAST [RS_125]
-                                PartitionCols:_col0
-                                Group By Operator [GBY_124] (rows=2 width=4)
-                                  Output:["_col0"],keys:KEY._col0
-                                <-Map 8 [SIMPLE_EDGE] vectorized, llap
-                                  SHUFFLE [RS_123]
-                                    PartitionCols:_col0
-                                    Group By Operator [GBY_122] (rows=2 width=4)
-                                      Output:["_col0"],keys:d_month_seq
-                                      Select Operator [SEL_121] (rows=4 width=12)
-                                        Output:["d_month_seq"]
-                                        Filter Operator [FIL_120] (rows=4 width=12)
-                                          predicate:((d_year = 2000) and ((d_year * d_moy) > 200000) and (d_moy = 2) and d_month_seq is not null)
-                                          TableScan [TS_17] (rows=28 width=12)
-                                            default@x1_date_dim,x1_date_dim,Tbl:COMPLETE,Col:COMPLETE,Output:["d_month_seq","d_year","d_moy"]
-                            <-Select Operator [SEL_127] (rows=28 width=8)
+                      Group By Operator [GBY_37] (rows=10 width=12)
+                        Output:["_col0","_col1"],aggregations:["count()"],keys:_col0
+                        Select Operator [SEL_36] (rows=5185194 width=228)
+                          Output:["_col0"]
+                          Map Join Operator [MAPJOIN_107] (rows=5185194 width=228)
+                            Conds:SEL_24._col1=RS_123._col1(Inner),Output:["_col0","_col2","_col3"],residual filter predicates:{(_col2 > _col3)}
+                          <-Reducer 5 [BROADCAST_EDGE] vectorized, llap
+                            BROADCAST [RS_123]
+                              PartitionCols:_col1
+                              Select Operator [SEL_122] (rows=1 width=197)
                                 Output:["_col0","_col1"]
-                                Filter Operator [FIL_126] (rows=28 width=8)
-                                  predicate:(d_date_sk is not null and d_month_seq is not null)
-                                  TableScan [TS_14] (rows=28 width=8)
-                                    default@x1_date_dim,d,Tbl:COMPLETE,Col:COMPLETE,Output:["d_date_sk","d_month_seq"]
-                          Dynamic Partitioning Event Operator [EVENT_132] (rows=1 width=4)
-                            Group By Operator [GBY_131] (rows=1 width=4)
-                              Output:["_col0"],keys:_col0
-                              Select Operator [SEL_130] (rows=28 width=4)
-                                Output:["_col0"]
-                                 Please refer to the previous Map Join Operator [MAPJOIN_128]
-                        <-Map Join Operator [MAPJOIN_135] (rows=370371 width=4)
-                            Conds:RS_31._col0=SEL_134._col0(Inner),Output:["_col6"]
-                          <-Map 1 [BROADCAST_EDGE] llap
-                            BROADCAST [RS_31]
-                              PartitionCols:_col0
-                              Map Join Operator [MAPJOIN_103] (rows=6 width=228)
-                                Conds:SEL_2._col1=RS_117._col1(Inner),Output:["_col0","_col2","_col3"],residual filter predicates:{(_col2 > _col3)}
-                              <-Reducer 3 [BROADCAST_EDGE] vectorized, llap
-                                BROADCAST [RS_117]
-                                  PartitionCols:_col1
-                                  Select Operator [SEL_116] (rows=1 width=197)
-                                    Output:["_col0","_col1"]
-                                    Filter Operator [FIL_115] (rows=1 width=197)
-                                      predicate:_col1 is not null
-                                      Group By Operator [GBY_114] (rows=1 width=197)
-                                        Output:["_col0","_col1"],aggregations:["min(VALUE._col0)"],keys:KEY._col0
-                                      <-Map 2 [SIMPLE_EDGE] vectorized, llap
-                                        SHUFFLE [RS_113]
-                                          PartitionCols:_col0
-                                          Group By Operator [GBY_112] (rows=1 width=197)
-                                            Output:["_col0","_col1"],aggregations:["min(i_current_price)"],keys:i_category
-                                            Filter Operator [FIL_111] (rows=18 width=197)
-                                              predicate:i_category is not null
-                                              TableScan [TS_3] (rows=18 width=197)
-                                                default@x1_item,j,Tbl:COMPLETE,Col:COMPLETE,Output:["i_category","i_current_price"]
-                              <-Select Operator [SEL_2] (rows=18 width=201)
-                                  Output:["_col0","_col1","_col2"]
-                                  Filter Operator [FIL_58] (rows=18 width=201)
-                                    predicate:(i_item_sk is not null and i_category is not null and i_current_price is not null)
-                                    TableScan [TS_0] (rows=18 width=201)
-                                      default@x1_item,i,Tbl:COMPLETE,Col:COMPLETE,Output:["i_item_sk","i_category","i_current_price"]
-                          <-Select Operator [SEL_134] (rows=123457 width=8)
-                              Output:["_col0","_col1"]
-                              Filter Operator [FIL_133] (rows=123457 width=8)
-                                predicate:ss_item_sk is not null
-                                TableScan [TS_11] (rows=123457 width=8)
-                                  default@x1_store_sales,s,Tbl:COMPLETE,Col:COMPLETE,Output:["ss_item_sk"]
+                                Filter Operator [FIL_121] (rows=1 width=197)
+                                  predicate:_col1 is not null
+                                  Group By Operator [GBY_120] (rows=1 width=197)
+                                    Output:["_col0","_col1"],aggregations:["min(VALUE._col0)"],keys:KEY._col0
+                                  <-Map 4 [SIMPLE_EDGE] vectorized, llap
+                                    SHUFFLE [RS_119]
+                                      PartitionCols:_col0
+                                      Group By Operator [GBY_117] (rows=1 width=197)
+                                        Output:["_col0","_col1"],aggregations:["min(i_current_price)"],keys:i_category
+                                        Filter Operator [FIL_115] (rows=18 width=197)
+                                          predicate:i_category is not null
+                                          TableScan [TS_3] (rows=18 width=201)
+                                            default@x1_item,i,Tbl:COMPLETE,Col:COMPLETE,Output:["i_item_sk","i_category","i_current_price"]
+                          <-Select Operator [SEL_24] (rows=15555582 width=201)
+                              Output:["_col0","_col1","_col2"]
+                              Map Join Operator [MAPJOIN_106] (rows=15555582 width=201)
+                                Conds:SEL_15._col3=RS_132._col0(Left Semi),Output:["_col3","_col5","_col6"]
+                              <-Map 6 [BROADCAST_EDGE] vectorized, llap
+                                SHUFFLE [RS_132]
+                                  PartitionCols:_col0
+                                  Group By Operator [GBY_130] (rows=2 width=4)
+                                    Output:["_col0"],keys:_col0
+                                    Select Operator [SEL_127] (rows=4 width=4)
+                                      Output:["_col0"]
+                                      Filter Operator [FIL_125] (rows=4 width=12)
+                                        predicate:((d_year = 2000) and ((d_year * d_moy) > 200000) and (d_moy = 2) and d_month_seq is not null)
+                                        TableScan [TS_6] (rows=28 width=8)
+                                          default@x1_date_dim,d,Tbl:COMPLETE,Col:COMPLETE,Output:["d_date_sk","d_month_seq","d_year","d_moy"]
+                              <-Select Operator [SEL_15] (rows=15555582 width=201)
+                                  Output:["_col3","_col5","_col6"]
+                                  Map Join Operator [MAPJOIN_105] (rows=15555582 width=201)
+                                    Conds:MAPJOIN_104._col1=RS_135._col0(Inner),Output:["_col3","_col4","_col6"]
+                                  <-Reducer 7 [BROADCAST_EDGE] vectorized, llap
+                                    BROADCAST [RS_135]
+                                      PartitionCols:_col0
+                                      Select Operator [SEL_134]
+                                        Output:["_col0","_col1"]
+                                  <-Map Join Operator [MAPJOIN_104] (rows=1111113 width=201)
+                                      Conds:SEL_2._col0=RS_118._col0(Inner),Output:["_col1","_col3","_col4"]
+                                    <-Map 4 [BROADCAST_EDGE] vectorized, llap
+                                      SHUFFLE [RS_118]
+                                        PartitionCols:_col0
+                                        Select Operator [SEL_116] (rows=18 width=201)
+                                          Output:["_col0","_col1","_col2"]
+                                          Filter Operator [FIL_114] (rows=18 width=201)
+                                            predicate:(i_item_sk is not null and i_category is not null and i_current_price is not null)
+                                             Please refer to the previous TableScan [TS_3]
+                                    <-Select Operator [SEL_2] (rows=123457 width=8)
+                                        Output:["_col0","_col1"]
+                                        Filter Operator [FIL_59] (rows=123457 width=8)
+                                          predicate:ss_item_sk is not null
+                                          TableScan [TS_0] (rows=123457 width=8)
+                                            default@x1_store_sales,s,Tbl:COMPLETE,Col:COMPLETE,Output:["ss_item_sk"]
 
 PREHOOK: query: select   count(*) cnt
  from
diff --git a/ql/src/test/results/clientpositive/llap/keep_uniform.q.out b/ql/src/test/results/clientpositive/llap/keep_uniform.q.out
index 569aec25f2..dbf08078be 100644
--- a/ql/src/test/results/clientpositive/llap/keep_uniform.q.out
+++ b/ql/src/test/results/clientpositive/llap/keep_uniform.q.out
@@ -437,18 +437,16 @@ STAGE PLANS:
     Tez
 #### A masked pattern was here ####
       Edges:
-        Reducer 10 <- Reducer 9 (SIMPLE_EDGE)
-        Reducer 11 <- Map 1 (SIMPLE_EDGE), Map 17 (SIMPLE_EDGE)
-        Reducer 12 <- Map 1 (SIMPLE_EDGE), Reducer 11 (SIMPLE_EDGE)
-        Reducer 13 <- Reducer 12 (SIMPLE_EDGE)
-        Reducer 2 <- Map 1 (SIMPLE_EDGE), Map 14 (SIMPLE_EDGE)
-        Reducer 3 <- Map 15 (SIMPLE_EDGE), Reducer 2 (SIMPLE_EDGE)
-        Reducer 4 <- Reducer 10 (SIMPLE_EDGE), Reducer 3 (SIMPLE_EDGE)
-        Reducer 5 <- Reducer 13 (SIMPLE_EDGE), Reducer 4 (SIMPLE_EDGE)
-        Reducer 6 <- Map 18 (SIMPLE_EDGE), Reducer 5 (SIMPLE_EDGE)
+        Reducer 10 <- Map 1 (SIMPLE_EDGE), Map 16 (SIMPLE_EDGE)
+        Reducer 11 <- Map 1 (SIMPLE_EDGE), Reducer 10 (SIMPLE_EDGE)
+        Reducer 2 <- Map 1 (SIMPLE_EDGE), Map 12 (SIMPLE_EDGE)
+        Reducer 3 <- Map 13 (SIMPLE_EDGE), Reducer 2 (SIMPLE_EDGE)
+        Reducer 4 <- Map 14 (SIMPLE_EDGE), Reducer 3 (SIMPLE_EDGE)
+        Reducer 5 <- Reducer 4 (SIMPLE_EDGE), Reducer 9 (SIMPLE_EDGE)
+        Reducer 6 <- Reducer 11 (SIMPLE_EDGE), Reducer 5 (SIMPLE_EDGE)
         Reducer 7 <- Reducer 6 (SIMPLE_EDGE)
         Reducer 8 <- Reducer 7 (CUSTOM_SIMPLE_EDGE)
-        Reducer 9 <- Map 1 (SIMPLE_EDGE), Map 16 (SIMPLE_EDGE)
+        Reducer 9 <- Map 1 (SIMPLE_EDGE), Map 15 (SIMPLE_EDGE)
 #### A masked pattern was here ####
       Vertices:
         Map 1 
@@ -476,18 +474,18 @@ STAGE PLANS:
                           projectedOutputColumnNums: [2, 11, 13, 17, 28, 33]
                       Statistics: Num rows: 1 Data size: 240 Basic stats: COMPLETE Column stats: NONE
                       Reduce Output Operator
-                        key expressions: _col1 (type: int)
+                        key expressions: _col0 (type: int)
                         null sort order: z
                         sort order: +
-                        Map-reduce partition columns: _col1 (type: int)
+                        Map-reduce partition columns: _col0 (type: int)
                         Reduce Sink Vectorization:
                             className: VectorReduceSinkLongOperator
-                            keyColumns: 11:int
+                            keyColumns: 2:int
                             native: true
                             nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
-                            valueColumns: 2:int, 13:int, 17:int, 28:decimal(7,2), 33:decimal(7,2)
+                            valueColumns: 11:int, 13:int, 17:int, 28:decimal(7,2), 33:decimal(7,2)
                         Statistics: Num rows: 1 Data size: 240 Basic stats: COMPLETE Column stats: NONE
-                        value expressions: _col0 (type: int), _col2 (type: int), _col3 (type: int), _col4 (type: decimal(7,2)), _col5 (type: decimal(7,2))
+                        value expressions: _col1 (type: int), _col2 (type: int), _col3 (type: int), _col4 (type: decimal(7,2)), _col5 (type: decimal(7,2))
                   Filter Operator
                     Filter Vectorization:
                         className: VectorFilterOperator
@@ -559,7 +557,59 @@ STAGE PLANS:
                     dataColumns: ws_sold_date_sk:int, ws_sold_time_sk:int, ws_ship_date_sk:int, ws_item_sk:int, ws_bill_customer_sk:int, ws_bill_cdemo_sk:int, ws_bill_hdemo_sk:int, ws_bill_addr_sk:int, ws_ship_customer_sk:int, ws_ship_cdemo_sk:int, ws_ship_hdemo_sk:int, ws_ship_addr_sk:int, ws_web_page_sk:int, ws_web_site_sk:int, ws_ship_mode_sk:int, ws_warehouse_sk:int, ws_promo_sk:int, ws_order_number:int, ws_quantity:int, ws_wholesale_cost:decimal(7,2)/DECIMAL_64, ws_list_price:decimal(7,2)/DECIMAL_64, ws_sales_price:decimal(7,2)/DECIMAL_64, ws_ext_discount_amt:decimal(7,2)/DECIMAL_64, ws_ext_sales_price:decimal(7,2)/DECIMAL_64, ws_ext_wholesale_cost:decimal(7,2)/DECIMAL_64, ws_ext_list_price:decimal(7,2)/DECIMAL_64, ws_ext_tax:decimal(7,2)/DECIMAL_64, ws_coupon_amt:decimal(7,2)/DECIMAL_64, ws_ext_ship_cost:decimal(7,2)/DECIMAL_64, ws_net_paid:decimal(7,2)/DECIMAL_64, ws_net_paid_inc_tax:decimal(7,2)/DECIMAL_64, ws_net_paid_inc_ship:decimal(7,2)/DECIMAL_64, ws_net_paid_inc_ship_tax:decimal(7,2)/DECIMAL_64, ws_net_profit:decimal(7,2)/DECIMAL_64
                     partitionColumnCount: 0
                     scratchColumnTypeNames: []
-        Map 14 
+        Map 12 
+            Map Operator Tree:
+                TableScan
+                  alias: date_dim
+                  filterExpr: (CAST( d_date AS TIMESTAMP) BETWEEN TIMESTAMP'1999-05-01 00:00:00' AND TIMESTAMP'1999-06-30 00:00:00' and d_date_sk is not null) (type: boolean)
+                  Statistics: Num rows: 1 Data size: 188 Basic stats: COMPLETE Column stats: NONE
+                  TableScan Vectorization:
+                      native: true
+                      vectorizationSchemaColumns: [0:d_date_sk:int, 1:d_date_id:string, 2:d_date:string, 3:d_month_seq:int, 4:d_week_seq:int, 5:d_quarter_seq:int, 6:d_year:int, 7:d_dow:int, 8:d_moy:int, 9:d_dom:int, 10:d_qoy:int, 11:d_fy_year:int, 12:d_fy_quarter_seq:int, 13:d_fy_week_seq:int, 14:d_day_name:string, 15:d_quarter_name:string, 16:d_holiday:string, 17:d_weekend:string, 18:d_following_holiday:string, 19:d_first_dom:int, 20:d_last_dom:int, 21:d_same_day_ly:int, 22:d_same_day_lq:int, 23:d_current_day:string, 24:d_current_week:string, 25:d_current_month:string, 26:d_current_quarter:string, 27:d_current_year:string, 28:ROW__ID:struct<writeid:bigint,bucketid:int,rowid:bigint>]
+                  Filter Operator
+                    Filter Vectorization:
+                        className: VectorFilterOperator
+                        native: true
+                        predicateExpression: FilterExprAndExpr(children: FilterTimestampColumnBetween(col 29:timestamp, left 1999-04-30 17:00:00.0, right 1999-06-29 17:00:00.0)(children: CastStringToTimestamp(col 2:string) -> 29:timestamp), SelectColumnIsNotNull(col 0:int))
+                    predicate: (CAST( d_date AS TIMESTAMP) BETWEEN TIMESTAMP'1999-05-01 00:00:00' AND TIMESTAMP'1999-06-30 00:00:00' and d_date_sk is not null) (type: boolean)
+                    Statistics: Num rows: 1 Data size: 188 Basic stats: COMPLETE Column stats: NONE
+                    Select Operator
+                      expressions: d_date_sk (type: int)
+                      outputColumnNames: _col0
+                      Select Vectorization:
+                          className: VectorSelectOperator
+                          native: true
+                          projectedOutputColumnNums: [0]
+                      Statistics: Num rows: 1 Data size: 188 Basic stats: COMPLETE Column stats: NONE
+                      Reduce Output Operator
+                        key expressions: _col0 (type: int)
+                        null sort order: z
+                        sort order: +
+                        Map-reduce partition columns: _col0 (type: int)
+                        Reduce Sink Vectorization:
+                            className: VectorReduceSinkLongOperator
+                            keyColumns: 0:int
+                            native: true
+                            nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
+                        Statistics: Num rows: 1 Data size: 188 Basic stats: COMPLETE Column stats: NONE
+            Execution mode: vectorized, llap
+            LLAP IO: may be used (ACID table)
+            Map Vectorization:
+                enabled: true
+                enabledConditionsMet: hive.vectorized.use.vectorized.input.format IS true
+                inputFormatFeatureSupport: [DECIMAL_64]
+                featureSupportInUse: [DECIMAL_64]
+                inputFileFormats: org.apache.hadoop.hive.ql.io.orc.OrcInputFormat
+                allNative: true
+                usesVectorUDFAdaptor: false
+                vectorized: true
+                rowBatchContext:
+                    dataColumnCount: 28
+                    includeColumns: [0, 2]
+                    dataColumns: d_date_sk:int, d_date_id:string, d_date:string, d_month_seq:int, d_week_seq:int, d_quarter_seq:int, d_year:int, d_dow:int, d_moy:int, d_dom:int, d_qoy:int, d_fy_year:int, d_fy_quarter_seq:int, d_fy_week_seq:int, d_day_name:string, d_quarter_name:string, d_holiday:string, d_weekend:string, d_following_holiday:string, d_first_dom:int, d_last_dom:int, d_same_day_ly:int, d_same_day_lq:int, d_current_day:string, d_current_week:string, d_current_month:string, d_current_quarter:string, d_current_year:string
+                    partitionColumnCount: 0
+                    scratchColumnTypeNames: [timestamp]
+        Map 13 
             Map Operator Tree:
                 TableScan
                   alias: customer_address
@@ -611,7 +661,7 @@ STAGE PLANS:
                     dataColumns: ca_address_sk:int, ca_address_id:string, ca_street_number:string, ca_street_name:string, ca_street_type:string, ca_suite_number:string, ca_city:string, ca_county:string, ca_state:string, ca_zip:string, ca_country:string, ca_gmt_offset:decimal(5,2)/DECIMAL_64, ca_location_type:string
                     partitionColumnCount: 0
                     scratchColumnTypeNames: []
-        Map 15 
+        Map 14 
             Map Operator Tree:
                 TableScan
                   alias: web_site
@@ -663,10 +713,10 @@ STAGE PLANS:
                     dataColumns: web_site_sk:int, web_site_id:string, web_rec_start_date:string, web_rec_end_date:string, web_name:string, web_open_date_sk:int, web_close_date_sk:int, web_class:string, web_manager:string, web_mkt_id:int, web_mkt_class:string, web_mkt_desc:string, web_market_manager:string, web_company_id:int, web_company_name:string, web_street_number:string, web_street_name:string, web_street_type:string, web_suite_number:string, web_city:string, web_county:string, web_state:string, web_zip:string, web_country:string, web_gmt_offset:decimal(5,2)/DECIMAL_64, web_tax_percentage:decimal(5,2)/DECIMAL_64
                     partitionColumnCount: 0
                     scratchColumnTypeNames: []
-        Map 16 
+        Map 15 
             Map Operator Tree:
                 TableScan
-                  alias: ws1
+                  alias: ws2
                   filterExpr: ws_order_number is not null (type: boolean)
                   Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE
                   TableScan Vectorization:
@@ -717,7 +767,7 @@ STAGE PLANS:
                     dataColumns: ws_sold_date_sk:int, ws_sold_time_sk:int, ws_ship_date_sk:int, ws_item_sk:int, ws_bill_customer_sk:int, ws_bill_cdemo_sk:int, ws_bill_hdemo_sk:int, ws_bill_addr_sk:int, ws_ship_customer_sk:int, ws_ship_cdemo_sk:int, ws_ship_hdemo_sk:int, ws_ship_addr_sk:int, ws_web_page_sk:int, ws_web_site_sk:int, ws_ship_mode_sk:int, ws_warehouse_sk:int, ws_promo_sk:int, ws_order_number:int, ws_quantity:int, ws_wholesale_cost:decimal(7,2)/DECIMAL_64, ws_list_price:decimal(7,2)/DECIMAL_64, ws_sales_price:decimal(7,2)/DECIMAL_64, ws_ext_discount_amt:decimal(7,2)/DECIMAL_64, ws_ext_sales_price:decimal(7,2)/DECIMAL_64, ws_ext_wholesale_cost:decimal(7,2)/DECIMAL_64, ws_ext_list_price:decimal(7,2)/DECIMAL_64, ws_ext_tax:decimal(7,2)/DECIMAL_64, ws_coupon_amt:decimal(7,2)/DECIMAL_64, ws_ext_ship_cost:decimal(7,2)/DECIMAL_64, ws_net_paid:decimal(7,2)/DECIMAL_64, ws_net_paid_inc_tax:decimal(7,2)/DECIMAL_64, ws_net_paid_inc_ship:decimal(7,2)/DECIMAL_64, ws_net_paid_inc_ship_tax:decimal(7,2)/DECIMAL_64, ws_net_profit:decimal(7,2)/DECIMAL_64
                     partitionColumnCount: 0
                     scratchColumnTypeNames: []
-        Map 17 
+        Map 16 
             Map Operator Tree:
                 TableScan
                   alias: web_returns
@@ -769,98 +819,7 @@ STAGE PLANS:
                     dataColumns: wr_returned_date_sk:int, wr_returned_time_sk:int, wr_item_sk:int, wr_refunded_customer_sk:int, wr_refunded_cdemo_sk:int, wr_refunded_hdemo_sk:int, wr_refunded_addr_sk:int, wr_returning_customer_sk:int, wr_returning_cdemo_sk:int, wr_returning_hdemo_sk:int, wr_returning_addr_sk:int, wr_web_page_sk:int, wr_reason_sk:int, wr_order_number:int, wr_return_quantity:int, wr_return_amt:decimal(7,2)/DECIMAL_64, wr_return_tax:decimal(7,2)/DECIMAL_64, wr_return_amt_inc_tax:decimal(7,2)/DECIMAL_64, wr_fee:decimal(7,2)/DECIMAL_64, wr_return_ship_cost:decimal(7,2)/DECIMAL_64, wr_refunded_cash:decimal(7,2)/DECIMAL_64, wr_reversed_charge:decimal(7,2)/DECIMAL_64, wr_account_credit:decimal(7,2)/DECIMAL_64, wr_net_loss:decimal(7,2)/DECIMAL_64
                     partitionColumnCount: 0
                     scratchColumnTypeNames: []
-        Map 18 
-            Map Operator Tree:
-                TableScan
-                  alias: date_dim
-                  filterExpr: (CAST( d_date AS TIMESTAMP) BETWEEN TIMESTAMP'1999-05-01 00:00:00' AND TIMESTAMP'1999-06-30 00:00:00' and d_date_sk is not null) (type: boolean)
-                  Statistics: Num rows: 1 Data size: 188 Basic stats: COMPLETE Column stats: NONE
-                  TableScan Vectorization:
-                      native: true
-                      vectorizationSchemaColumns: [0:d_date_sk:int, 1:d_date_id:string, 2:d_date:string, 3:d_month_seq:int, 4:d_week_seq:int, 5:d_quarter_seq:int, 6:d_year:int, 7:d_dow:int, 8:d_moy:int, 9:d_dom:int, 10:d_qoy:int, 11:d_fy_year:int, 12:d_fy_quarter_seq:int, 13:d_fy_week_seq:int, 14:d_day_name:string, 15:d_quarter_name:string, 16:d_holiday:string, 17:d_weekend:string, 18:d_following_holiday:string, 19:d_first_dom:int, 20:d_last_dom:int, 21:d_same_day_ly:int, 22:d_same_day_lq:int, 23:d_current_day:string, 24:d_current_week:string, 25:d_current_month:string, 26:d_current_quarter:string, 27:d_current_year:string, 28:ROW__ID:struct<writeid:bigint,bucketid:int,rowid:bigint>]
-                  Filter Operator
-                    Filter Vectorization:
-                        className: VectorFilterOperator
-                        native: true
-                        predicateExpression: FilterExprAndExpr(children: FilterTimestampColumnBetween(col 29:timestamp, left 1999-04-30 17:00:00.0, right 1999-06-29 17:00:00.0)(children: CastStringToTimestamp(col 2:string) -> 29:timestamp), SelectColumnIsNotNull(col 0:int))
-                    predicate: (CAST( d_date AS TIMESTAMP) BETWEEN TIMESTAMP'1999-05-01 00:00:00' AND TIMESTAMP'1999-06-30 00:00:00' and d_date_sk is not null) (type: boolean)
-                    Statistics: Num rows: 1 Data size: 188 Basic stats: COMPLETE Column stats: NONE
-                    Select Operator
-                      expressions: d_date_sk (type: int)
-                      outputColumnNames: _col0
-                      Select Vectorization:
-                          className: VectorSelectOperator
-                          native: true
-                          projectedOutputColumnNums: [0]
-                      Statistics: Num rows: 1 Data size: 188 Basic stats: COMPLETE Column stats: NONE
-                      Reduce Output Operator
-                        key expressions: _col0 (type: int)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col0 (type: int)
-                        Reduce Sink Vectorization:
-                            className: VectorReduceSinkLongOperator
-                            keyColumns: 0:int
-                            native: true
-                            nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
-                        Statistics: Num rows: 1 Data size: 188 Basic stats: COMPLETE Column stats: NONE
-            Execution mode: vectorized, llap
-            LLAP IO: may be used (ACID table)
-            Map Vectorization:
-                enabled: true
-                enabledConditionsMet: hive.vectorized.use.vectorized.input.format IS true
-                inputFormatFeatureSupport: [DECIMAL_64]
-                featureSupportInUse: [DECIMAL_64]
-                inputFileFormats: org.apache.hadoop.hive.ql.io.orc.OrcInputFormat
-                allNative: true
-                usesVectorUDFAdaptor: false
-                vectorized: true
-                rowBatchContext:
-                    dataColumnCount: 28
-                    includeColumns: [0, 2]
-                    dataColumns: d_date_sk:int, d_date_id:string, d_date:string, d_month_seq:int, d_week_seq:int, d_quarter_seq:int, d_year:int, d_dow:int, d_moy:int, d_dom:int, d_qoy:int, d_fy_year:int, d_fy_quarter_seq:int, d_fy_week_seq:int, d_day_name:string, d_quarter_name:string, d_holiday:string, d_weekend:string, d_following_holiday:string, d_first_dom:int, d_last_dom:int, d_same_day_ly:int, d_same_day_lq:int, d_current_day:string, d_current_week:string, d_current_month:string, d_current_quarter:string, d_current_year:string
-                    partitionColumnCount: 0
-                    scratchColumnTypeNames: [timestamp]
         Reducer 10 
-            Execution mode: vectorized, llap
-            Reduce Vectorization:
-                enabled: true
-                enableConditionsMet: hive.vectorized.execution.reduce.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true
-                reduceColumnNullOrder: z
-                reduceColumnSortOrder: +
-                allNative: false
-                usesVectorUDFAdaptor: false
-                vectorized: true
-                rowBatchContext:
-                    dataColumnCount: 1
-                    dataColumns: KEY._col0:int
-                    partitionColumnCount: 0
-                    scratchColumnTypeNames: []
-            Reduce Operator Tree:
-              Group By Operator
-                Group By Vectorization:
-                    className: VectorGroupByOperator
-                    groupByMode: MERGEPARTIAL
-                    keyExpressions: col 0:int
-                    native: false
-                    vectorProcessingMode: MERGE_PARTIAL
-                    projectedOutputColumnNums: []
-                keys: KEY._col0 (type: int)
-                mode: mergepartial
-                outputColumnNames: _col0
-                Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE
-                Reduce Output Operator
-                  key expressions: _col0 (type: int)
-                  null sort order: z
-                  sort order: +
-                  Map-reduce partition columns: _col0 (type: int)
-                  Reduce Sink Vectorization:
-                      className: VectorReduceSinkLongOperator
-                      keyColumns: 0:int
-                      native: true
-                      nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
-                  Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE
-        Reducer 11 
             Execution mode: llap
             Reduce Operator Tree:
               Merge Join Operator
@@ -881,7 +840,7 @@ STAGE PLANS:
             MergeJoin Vectorization:
                 enabled: false
                 enableConditionsNotMet: Vectorizing MergeJoin Supported IS false
-        Reducer 12 
+        Reducer 11 
             Execution mode: llap
             Reduce Operator Tree:
               Merge Join Operator
@@ -895,10 +854,10 @@ STAGE PLANS:
                 Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE
                 Select Operator
                   expressions: _col2 (type: int)
-                  outputColumnNames: _col2
+                  outputColumnNames: _col0
                   Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE
                   Group By Operator
-                    keys: _col2 (type: int)
+                    keys: _col0 (type: int)
                     minReductionHashAggr: 0.99
                     mode: hash
                     outputColumnNames: _col0
@@ -912,45 +871,6 @@ STAGE PLANS:
             MergeJoin Vectorization:
                 enabled: false
                 enableConditionsNotMet: Vectorizing MergeJoin Supported IS false
-        Reducer 13 
-            Execution mode: vectorized, llap
-            Reduce Vectorization:
-                enabled: true
-                enableConditionsMet: hive.vectorized.execution.reduce.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true
-                reduceColumnNullOrder: z
-                reduceColumnSortOrder: +
-                allNative: false
-                usesVectorUDFAdaptor: false
-                vectorized: true
-                rowBatchContext:
-                    dataColumnCount: 1
-                    dataColumns: KEY._col0:int
-                    partitionColumnCount: 0
-                    scratchColumnTypeNames: []
-            Reduce Operator Tree:
-              Group By Operator
-                Group By Vectorization:
-                    className: VectorGroupByOperator
-                    groupByMode: MERGEPARTIAL
-                    keyExpressions: col 0:int
-                    native: false
-                    vectorProcessingMode: MERGE_PARTIAL
-                    projectedOutputColumnNums: []
-                keys: KEY._col0 (type: int)
-                mode: mergepartial
-                outputColumnNames: _col0
-                Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE
-                Reduce Output Operator
-                  key expressions: _col0 (type: int)
-                  null sort order: z
-                  sort order: +
-                  Map-reduce partition columns: _col0 (type: int)
-                  Reduce Sink Vectorization:
-                      className: VectorReduceSinkLongOperator
-                      keyColumns: 0:int
-                      native: true
-                      nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
-                  Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE
         Reducer 2 
             Execution mode: llap
             Reduce Operator Tree:
@@ -958,17 +878,17 @@ STAGE PLANS:
                 condition map:
                      Inner Join 0 to 1
                 keys:
-                  0 _col1 (type: int)
+                  0 _col0 (type: int)
                   1 _col0 (type: int)
-                outputColumnNames: _col0, _col2, _col3, _col4, _col5
+                outputColumnNames: _col1, _col2, _col3, _col4, _col5
                 Statistics: Num rows: 1 Data size: 264 Basic stats: COMPLETE Column stats: NONE
                 Reduce Output Operator
-                  key expressions: _col2 (type: int)
+                  key expressions: _col1 (type: int)
                   null sort order: z
                   sort order: +
-                  Map-reduce partition columns: _col2 (type: int)
+                  Map-reduce partition columns: _col1 (type: int)
                   Statistics: Num rows: 1 Data size: 264 Basic stats: COMPLETE Column stats: NONE
-                  value expressions: _col0 (type: int), _col3 (type: int), _col4 (type: decimal(7,2)), _col5 (type: decimal(7,2))
+                  value expressions: _col2 (type: int), _col3 (type: int), _col4 (type: decimal(7,2)), _col5 (type: decimal(7,2))
             MergeJoin Vectorization:
                 enabled: false
                 enableConditionsNotMet: Vectorizing MergeJoin Supported IS false
@@ -979,17 +899,17 @@ STAGE PLANS:
                 condition map:
                      Inner Join 0 to 1
                 keys:
-                  0 _col2 (type: int)
+                  0 _col1 (type: int)
                   1 _col0 (type: int)
-                outputColumnNames: _col0, _col3, _col4, _col5
+                outputColumnNames: _col2, _col3, _col4, _col5
                 Statistics: Num rows: 1 Data size: 290 Basic stats: COMPLETE Column stats: NONE
                 Reduce Output Operator
-                  key expressions: _col3 (type: int)
+                  key expressions: _col2 (type: int)
                   null sort order: z
                   sort order: +
-                  Map-reduce partition columns: _col3 (type: int)
+                  Map-reduce partition columns: _col2 (type: int)
                   Statistics: Num rows: 1 Data size: 290 Basic stats: COMPLETE Column stats: NONE
-                  value expressions: _col0 (type: int), _col4 (type: decimal(7,2)), _col5 (type: decimal(7,2))
+                  value expressions: _col3 (type: int), _col4 (type: decimal(7,2)), _col5 (type: decimal(7,2))
             MergeJoin Vectorization:
                 enabled: false
                 enableConditionsNotMet: Vectorizing MergeJoin Supported IS false
@@ -1000,9 +920,9 @@ STAGE PLANS:
                 condition map:
                      Inner Join 0 to 1
                 keys:
-                  0 _col3 (type: int)
+                  0 _col2 (type: int)
                   1 _col0 (type: int)
-                outputColumnNames: _col0, _col3, _col4, _col5
+                outputColumnNames: _col3, _col4, _col5
                 Statistics: Num rows: 1 Data size: 319 Basic stats: COMPLETE Column stats: NONE
                 Reduce Output Operator
                   key expressions: _col3 (type: int)
@@ -1010,7 +930,7 @@ STAGE PLANS:
                   sort order: +
                   Map-reduce partition columns: _col3 (type: int)
                   Statistics: Num rows: 1 Data size: 319 Basic stats: COMPLETE Column stats: NONE
-                  value expressions: _col0 (type: int), _col4 (type: decimal(7,2)), _col5 (type: decimal(7,2))
+                  value expressions: _col4 (type: decimal(7,2)), _col5 (type: decimal(7,2))
             MergeJoin Vectorization:
                 enabled: false
                 enableConditionsNotMet: Vectorizing MergeJoin Supported IS false
@@ -1019,19 +939,19 @@ STAGE PLANS:
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Semi Join 0 to 1
                 keys:
                   0 _col3 (type: int)
                   1 _col0 (type: int)
-                outputColumnNames: _col0, _col3, _col4, _col5
+                outputColumnNames: _col3, _col4, _col5
                 Statistics: Num rows: 1 Data size: 350 Basic stats: COMPLETE Column stats: NONE
                 Reduce Output Operator
-                  key expressions: _col0 (type: int)
+                  key expressions: _col3 (type: int)
                   null sort order: z
                   sort order: +
-                  Map-reduce partition columns: _col0 (type: int)
+                  Map-reduce partition columns: _col3 (type: int)
                   Statistics: Num rows: 1 Data size: 350 Basic stats: COMPLETE Column stats: NONE
-                  value expressions: _col3 (type: int), _col4 (type: decimal(7,2)), _col5 (type: decimal(7,2))
+                  value expressions: _col4 (type: decimal(7,2)), _col5 (type: decimal(7,2))
             MergeJoin Vectorization:
                 enabled: false
                 enableConditionsNotMet: Vectorizing MergeJoin Supported IS false
@@ -1040,9 +960,9 @@ STAGE PLANS:
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Semi Join 0 to 1
                 keys:
-                  0 _col0 (type: int)
+                  0 _col3 (type: int)
                   1 _col0 (type: int)
                 outputColumnNames: _col3, _col4, _col5
                 Statistics: Num rows: 1 Data size: 385 Basic stats: COMPLETE Column stats: NONE
@@ -1167,10 +1087,10 @@ STAGE PLANS:
                 Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE
                 Select Operator
                   expressions: _col1 (type: int)
-                  outputColumnNames: _col1
+                  outputColumnNames: _col0
                   Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE
                   Group By Operator
-                    keys: _col1 (type: int)
+                    keys: _col0 (type: int)
                     minReductionHashAggr: 0.99
                     mode: hash
                     outputColumnNames: _col0
diff --git a/ql/src/test/results/clientpositive/llap/nested_column_pruning.q.out b/ql/src/test/results/clientpositive/llap/nested_column_pruning.q.out
index 02f4dd6f71..0e877c5af5 100644
--- a/ql/src/test/results/clientpositive/llap/nested_column_pruning.q.out
+++ b/ql/src/test/results/clientpositive/llap/nested_column_pruning.q.out
@@ -1323,10 +1323,10 @@ STAGE PLANS:
                       outputColumnNames: _col0, _col1
                       Statistics: Num rows: 1 Data size: 316 Basic stats: COMPLETE Column stats: NONE
                       Reduce Output Operator
-                        key expressions: _col1 (type: int), true (type: boolean)
-                        null sort order: zz
-                        sort order: ++
-                        Map-reduce partition columns: _col1 (type: int), true (type: boolean)
+                        key expressions: _col1 (type: int)
+                        null sort order: z
+                        sort order: +
+                        Map-reduce partition columns: _col1 (type: int)
                         Statistics: Num rows: 1 Data size: 316 Basic stats: COMPLETE Column stats: NONE
                         value expressions: _col0 (type: struct<f1:boolean,f2:string,f3:struct<f4:int,f5:double>,f6:int>)
             Execution mode: llap
@@ -1335,27 +1335,27 @@ STAGE PLANS:
             Map Operator Tree:
                 TableScan
                   alias: t2
-                  filterExpr: (s1.f6 is not null and s2.f8.f9 is not null and s2.f8.f9) (type: boolean)
+                  filterExpr: (s1.f6 is not null and s2.f8.f9) (type: boolean)
                   Pruned Column Paths: s1.f6, s2.f8.f9
                   Statistics: Num rows: 1 Data size: 1468 Basic stats: COMPLETE Column stats: NONE
                   Filter Operator
-                    predicate: (s1.f6 is not null and s2.f8.f9 is not null and s2.f8.f9) (type: boolean)
+                    predicate: (s1.f6 is not null and s2.f8.f9) (type: boolean)
                     Statistics: Num rows: 1 Data size: 1468 Basic stats: COMPLETE Column stats: NONE
                     Select Operator
-                      expressions: s1.f6 (type: int), s2.f8.f9 (type: boolean)
-                      outputColumnNames: _col0, _col1
+                      expressions: s1.f6 (type: int)
+                      outputColumnNames: _col0
                       Statistics: Num rows: 1 Data size: 1468 Basic stats: COMPLETE Column stats: NONE
                       Group By Operator
-                        keys: _col0 (type: int), _col1 (type: boolean)
+                        keys: _col0 (type: int)
                         minReductionHashAggr: 0.99
                         mode: hash
-                        outputColumnNames: _col0, _col1
+                        outputColumnNames: _col0
                         Statistics: Num rows: 1 Data size: 1468 Basic stats: COMPLETE Column stats: NONE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: boolean)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: boolean)
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
                           Statistics: Num rows: 1 Data size: 1468 Basic stats: COMPLETE Column stats: NONE
             Execution mode: llap
             LLAP IO: all inputs (cache only)
@@ -1366,8 +1366,8 @@ STAGE PLANS:
                 condition map:
                      Left Semi Join 0 to 1
                 keys:
-                  0 _col1 (type: int), true (type: boolean)
-                  1 _col0 (type: int), _col1 (type: boolean)
+                  0 _col1 (type: int)
+                  1 _col0 (type: int)
                 outputColumnNames: _col0
                 Statistics: Num rows: 1 Data size: 347 Basic stats: COMPLETE Column stats: NONE
                 Select Operator
diff --git a/ql/src/test/results/clientpositive/llap/orc_nested_column_pruning.q.out b/ql/src/test/results/clientpositive/llap/orc_nested_column_pruning.q.out
index 409e42b73f..efdda900a5 100644
--- a/ql/src/test/results/clientpositive/llap/orc_nested_column_pruning.q.out
+++ b/ql/src/test/results/clientpositive/llap/orc_nested_column_pruning.q.out
@@ -1323,10 +1323,10 @@ STAGE PLANS:
                       outputColumnNames: _col0, _col1
                       Statistics: Num rows: 1 Data size: 316 Basic stats: COMPLETE Column stats: NONE
                       Reduce Output Operator
-                        key expressions: _col1 (type: int), true (type: boolean)
-                        null sort order: zz
-                        sort order: ++
-                        Map-reduce partition columns: _col1 (type: int), true (type: boolean)
+                        key expressions: _col1 (type: int)
+                        null sort order: z
+                        sort order: +
+                        Map-reduce partition columns: _col1 (type: int)
                         Statistics: Num rows: 1 Data size: 316 Basic stats: COMPLETE Column stats: NONE
                         value expressions: _col0 (type: struct<f1:boolean,f2:string,f3:struct<f4:int,f5:double>,f6:int>)
             Execution mode: llap
@@ -1335,27 +1335,27 @@ STAGE PLANS:
             Map Operator Tree:
                 TableScan
                   alias: t2
-                  filterExpr: (s1.f6 is not null and s2.f8.f9 is not null and s2.f8.f9) (type: boolean)
+                  filterExpr: (s1.f6 is not null and s2.f8.f9) (type: boolean)
                   Pruned Column Paths: s1.f6, s2.f8.f9
                   Statistics: Num rows: 1 Data size: 1468 Basic stats: COMPLETE Column stats: NONE
                   Filter Operator
-                    predicate: (s1.f6 is not null and s2.f8.f9 is not null and s2.f8.f9) (type: boolean)
+                    predicate: (s1.f6 is not null and s2.f8.f9) (type: boolean)
                     Statistics: Num rows: 1 Data size: 1468 Basic stats: COMPLETE Column stats: NONE
                     Select Operator
-                      expressions: s1.f6 (type: int), s2.f8.f9 (type: boolean)
-                      outputColumnNames: _col0, _col1
+                      expressions: s1.f6 (type: int)
+                      outputColumnNames: _col0
                       Statistics: Num rows: 1 Data size: 1468 Basic stats: COMPLETE Column stats: NONE
                       Group By Operator
-                        keys: _col0 (type: int), _col1 (type: boolean)
+                        keys: _col0 (type: int)
                         minReductionHashAggr: 0.99
                         mode: hash
-                        outputColumnNames: _col0, _col1
+                        outputColumnNames: _col0
                         Statistics: Num rows: 1 Data size: 1468 Basic stats: COMPLETE Column stats: NONE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: boolean)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: boolean)
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
                           Statistics: Num rows: 1 Data size: 1468 Basic stats: COMPLETE Column stats: NONE
             Execution mode: llap
             LLAP IO: all inputs
@@ -1366,8 +1366,8 @@ STAGE PLANS:
                 condition map:
                      Left Semi Join 0 to 1
                 keys:
-                  0 _col1 (type: int), true (type: boolean)
-                  1 _col0 (type: int), _col1 (type: boolean)
+                  0 _col1 (type: int)
+                  1 _col0 (type: int)
                 outputColumnNames: _col0
                 Statistics: Num rows: 1 Data size: 347 Basic stats: COMPLETE Column stats: NONE
                 Select Operator
diff --git a/ql/src/test/results/clientpositive/llap/semijoin.q.out b/ql/src/test/results/clientpositive/llap/semijoin.q.out
index 0152788b40..6bcc4e441d 100644
--- a/ql/src/test/results/clientpositive/llap/semijoin.q.out
+++ b/ql/src/test/results/clientpositive/llap/semijoin.q.out
@@ -526,13 +526,13 @@ STAGE PLANS:
                     Select Operator
                       expressions: key (type: int), value (type: string)
                       outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 11 Data size: 1067 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
-                        key expressions: _col0 (type: int), true (type: boolean)
-                        null sort order: zz
-                        sort order: ++
-                        Map-reduce partition columns: _col0 (type: int), true (type: boolean)
-                        Statistics: Num rows: 11 Data size: 1067 Basic stats: COMPLETE Column stats: COMPLETE
+                        key expressions: _col0 (type: int)
+                        null sort order: z
+                        sort order: +
+                        Map-reduce partition columns: _col0 (type: int)
+                        Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                         value expressions: _col1 (type: string)
             Execution mode: llap
             LLAP IO: all inputs
@@ -546,21 +546,21 @@ STAGE PLANS:
                     predicate: (key < 15) (type: boolean)
                     Statistics: Num rows: 17 Data size: 68 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: key (type: int), key is not null (type: boolean)
-                      outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 17 Data size: 136 Basic stats: COMPLETE Column stats: COMPLETE
+                      expressions: key (type: int)
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 17 Data size: 68 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
-                        keys: _col0 (type: int), _col1 (type: boolean)
-                        minReductionHashAggr: 0.4
+                        keys: _col0 (type: int)
+                        minReductionHashAggr: 0.5294118
                         mode: hash
-                        outputColumnNames: _col0, _col1
-                        Statistics: Num rows: 8 Data size: 64 Basic stats: COMPLETE Column stats: COMPLETE
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 8 Data size: 32 Basic stats: COMPLETE Column stats: COMPLETE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: boolean)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: boolean)
-                          Statistics: Num rows: 8 Data size: 64 Basic stats: COMPLETE Column stats: COMPLETE
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
+                          Statistics: Num rows: 8 Data size: 32 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: llap
             LLAP IO: all inputs
         Reducer 2 
@@ -570,8 +570,8 @@ STAGE PLANS:
                 condition map:
                      Left Semi Join 0 to 1
                 keys:
-                  0 _col0 (type: int), true (type: boolean)
-                  1 _col0 (type: int), _col1 (type: boolean)
+                  0 _col0 (type: int)
+                  1 _col0 (type: int)
                 outputColumnNames: _col1
                 Statistics: Num rows: 11 Data size: 979 Basic stats: COMPLETE Column stats: COMPLETE
                 Select Operator
@@ -660,13 +660,13 @@ STAGE PLANS:
                     Select Operator
                       expressions: key (type: int), value (type: string)
                       outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 11 Data size: 1067 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
-                        key expressions: _col0 (type: int), true (type: boolean)
-                        null sort order: zz
-                        sort order: ++
-                        Map-reduce partition columns: _col0 (type: int), true (type: boolean)
-                        Statistics: Num rows: 11 Data size: 1067 Basic stats: COMPLETE Column stats: COMPLETE
+                        key expressions: _col0 (type: int)
+                        null sort order: z
+                        sort order: +
+                        Map-reduce partition columns: _col0 (type: int)
+                        Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                         value expressions: _col1 (type: string)
             Execution mode: llap
             LLAP IO: all inputs
@@ -680,21 +680,21 @@ STAGE PLANS:
                     predicate: ((value < 'val_10') and key is not null) (type: boolean)
                     Statistics: Num rows: 3 Data size: 279 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: key (type: int), value is not null (type: boolean)
-                      outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 3 Data size: 24 Basic stats: COMPLETE Column stats: COMPLETE
+                      expressions: key (type: int)
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 3 Data size: 12 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
-                        keys: _col0 (type: int), _col1 (type: boolean)
+                        keys: _col0 (type: int)
                         minReductionHashAggr: 0.4
                         mode: hash
-                        outputColumnNames: _col0, _col1
-                        Statistics: Num rows: 3 Data size: 24 Basic stats: COMPLETE Column stats: COMPLETE
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 3 Data size: 12 Basic stats: COMPLETE Column stats: COMPLETE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: boolean)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: boolean)
-                          Statistics: Num rows: 3 Data size: 24 Basic stats: COMPLETE Column stats: COMPLETE
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
+                          Statistics: Num rows: 3 Data size: 12 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: llap
             LLAP IO: all inputs
         Reducer 2 
@@ -704,8 +704,8 @@ STAGE PLANS:
                 condition map:
                      Left Semi Join 0 to 1
                 keys:
-                  0 _col0 (type: int), true (type: boolean)
-                  1 _col0 (type: int), _col1 (type: boolean)
+                  0 _col0 (type: int)
+                  1 _col0 (type: int)
                 outputColumnNames: _col0, _col1
                 Statistics: Num rows: 4 Data size: 372 Basic stats: COMPLETE Column stats: COMPLETE
                 Reduce Output Operator
@@ -908,13 +908,13 @@ STAGE PLANS:
                     Select Operator
                       expressions: key (type: int), value (type: string)
                       outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 6 Data size: 582 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 6 Data size: 558 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
-                        key expressions: _col0 (type: int), true (type: boolean)
-                        null sort order: zz
-                        sort order: ++
-                        Map-reduce partition columns: _col0 (type: int), true (type: boolean)
-                        Statistics: Num rows: 6 Data size: 582 Basic stats: COMPLETE Column stats: COMPLETE
+                        key expressions: _col0 (type: int)
+                        null sort order: z
+                        sort order: +
+                        Map-reduce partition columns: _col0 (type: int)
+                        Statistics: Num rows: 6 Data size: 558 Basic stats: COMPLETE Column stats: COMPLETE
                         value expressions: _col1 (type: string)
             Execution mode: llap
             LLAP IO: all inputs
@@ -928,21 +928,21 @@ STAGE PLANS:
                     predicate: ((key > 5) and (value <= 'val_20')) (type: boolean)
                     Statistics: Num rows: 2 Data size: 186 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: key (type: int), value is not null (type: boolean)
-                      outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                      expressions: key (type: int)
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
-                        keys: _col0 (type: int), _col1 (type: boolean)
+                        keys: _col0 (type: int)
                         minReductionHashAggr: 0.4
                         mode: hash
-                        outputColumnNames: _col0, _col1
-                        Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: boolean)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: boolean)
-                          Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
+                          Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: llap
             LLAP IO: all inputs
         Reducer 2 
@@ -952,8 +952,8 @@ STAGE PLANS:
                 condition map:
                      Left Semi Join 0 to 1
                 keys:
-                  0 _col0 (type: int), true (type: boolean)
-                  1 _col0 (type: int), _col1 (type: boolean)
+                  0 _col0 (type: int)
+                  1 _col0 (type: int)
                 outputColumnNames: _col1
                 Statistics: Num rows: 3 Data size: 267 Basic stats: COMPLETE Column stats: COMPLETE
                 Select Operator
diff --git a/ql/src/test/results/clientpositive/llap/semijoin4.q.out b/ql/src/test/results/clientpositive/llap/semijoin4.q.out
index e09b70f299..f98a0a210f 100644
--- a/ql/src/test/results/clientpositive/llap/semijoin4.q.out
+++ b/ql/src/test/results/clientpositive/llap/semijoin4.q.out
@@ -100,13 +100,13 @@ STAGE PLANS:
                     Statistics: Num rows: 1 Data size: 124 Basic stats: COMPLETE Column stats: NONE
                     Select Operator
                       expressions: bigint_col_13 (type: bigint), decimal1309_col_65 (type: decimal(13,9))
-                      outputColumnNames: _col0, _col1
+                      outputColumnNames: _col0, _col2
                       Statistics: Num rows: 1 Data size: 124 Basic stats: COMPLETE Column stats: NONE
                       Reduce Output Operator
-                        key expressions: _col0 (type: bigint), _col1 (type: decimal(27,9))
+                        key expressions: _col2 (type: decimal(27,9)), _col0 (type: bigint)
                         null sort order: zz
                         sort order: ++
-                        Map-reduce partition columns: _col0 (type: bigint), _col1 (type: decimal(27,9))
+                        Map-reduce partition columns: _col2 (type: decimal(27,9)), _col0 (type: bigint)
                         Statistics: Num rows: 1 Data size: 124 Basic stats: COMPLETE Column stats: NONE
             Execution mode: vectorized, llap
             LLAP IO: all inputs
@@ -133,14 +133,14 @@ STAGE PLANS:
                     predicate: ((tinyint_col_21 = -92Y) and UDFToLong(tinyint_col_18) is not null and decimal2709_col_9 is not null) (type: boolean)
                     Statistics: Num rows: 1 Data size: 120 Basic stats: COMPLETE Column stats: NONE
                     Select Operator
-                      expressions: decimal2709_col_9 (type: decimal(27,9)), UDFToLong(tinyint_col_18) (type: bigint)
+                      expressions: decimal2709_col_9 (type: decimal(27,9)), tinyint_col_18 (type: tinyint)
                       outputColumnNames: _col0, _col1
                       Statistics: Num rows: 1 Data size: 120 Basic stats: COMPLETE Column stats: NONE
                       Reduce Output Operator
-                        key expressions: _col1 (type: bigint), _col0 (type: decimal(27,9))
+                        key expressions: _col0 (type: decimal(27,9)), UDFToLong(_col1) (type: bigint)
                         null sort order: zz
                         sort order: ++
-                        Map-reduce partition columns: _col1 (type: bigint), _col0 (type: decimal(27,9))
+                        Map-reduce partition columns: _col0 (type: decimal(27,9)), UDFToLong(_col1) (type: bigint)
                         Statistics: Num rows: 1 Data size: 120 Basic stats: COMPLETE Column stats: NONE
             Execution mode: vectorized, llap
             LLAP IO: all inputs
@@ -185,7 +185,7 @@ STAGE PLANS:
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Semi Join 0 to 1
                 keys:
                   0 
                   1 
@@ -208,8 +208,8 @@ STAGE PLANS:
                 condition map:
                      Inner Join 0 to 1
                 keys:
-                  0 _col0 (type: bigint), _col1 (type: decimal(27,9))
-                  1 _col1 (type: bigint), _col0 (type: decimal(27,9))
+                  0 _col2 (type: decimal(27,9)), _col0 (type: bigint)
+                  1 _col0 (type: decimal(27,9)), UDFToLong(_col1) (type: bigint)
                 Statistics: Num rows: 1 Data size: 136 Basic stats: COMPLETE Column stats: NONE
                 Reduce Output Operator
                   null sort order: 
diff --git a/ql/src/test/results/clientpositive/llap/semijoin5.q.out b/ql/src/test/results/clientpositive/llap/semijoin5.q.out
index a22e00a57b..4e65a26271 100644
--- a/ql/src/test/results/clientpositive/llap/semijoin5.q.out
+++ b/ql/src/test/results/clientpositive/llap/semijoin5.q.out
@@ -106,14 +106,14 @@ STAGE PLANS:
             Map Operator Tree:
                 TableScan
                   alias: t2
-                  filterExpr: ((UDFToLong(tinyint_col_15) is not null and decimal2709_col_9 is not null and tinyint_col_20 is not null and UDFToInteger(smallint_col_19) is not null) or (timestamp_col_18 is not null and decimal1911_col_16 is not null)) (type: boolean)
+                  filterExpr: (((smallint_col_19 = -92S) and UDFToLong(tinyint_col_15) is not null and decimal2709_col_9 is not null and tinyint_col_20 is not null) or (timestamp_col_18 is not null and decimal1911_col_16 is not null)) (type: boolean)
                   Statistics: Num rows: 1 Data size: 128 Basic stats: COMPLETE Column stats: NONE
                   Filter Operator
-                    predicate: (UDFToLong(tinyint_col_15) is not null and decimal2709_col_9 is not null and tinyint_col_20 is not null and UDFToInteger(smallint_col_19) is not null) (type: boolean)
+                    predicate: ((smallint_col_19 = -92S) and UDFToLong(tinyint_col_15) is not null and decimal2709_col_9 is not null and tinyint_col_20 is not null) (type: boolean)
                     Statistics: Num rows: 1 Data size: 128 Basic stats: COMPLETE Column stats: NONE
                     Select Operator
-                      expressions: decimal2709_col_9 (type: decimal(27,9)), int_col_10 (type: int), tinyint_col_15 (type: tinyint), smallint_col_19 (type: smallint), tinyint_col_20 (type: tinyint)
-                      outputColumnNames: _col0, _col1, _col2, _col3, _col4
+                      expressions: decimal2709_col_9 (type: decimal(27,9)), int_col_10 (type: int), tinyint_col_15 (type: tinyint), tinyint_col_20 (type: tinyint)
+                      outputColumnNames: _col0, _col1, _col2, _col4
                       Statistics: Num rows: 1 Data size: 128 Basic stats: COMPLETE Column stats: NONE
                       Reduce Output Operator
                         key expressions: _col4 (type: tinyint), _col0 (type: decimal(34,16)), UDFToLong(_col2) (type: bigint)
@@ -121,7 +121,7 @@ STAGE PLANS:
                         sort order: +++
                         Map-reduce partition columns: _col4 (type: tinyint), _col0 (type: decimal(34,16)), UDFToLong(_col2) (type: bigint)
                         Statistics: Num rows: 1 Data size: 128 Basic stats: COMPLETE Column stats: NONE
-                        value expressions: _col1 (type: int), _col3 (type: smallint)
+                        value expressions: _col1 (type: int)
                   Filter Operator
                     predicate: (timestamp_col_18 is not null and decimal1911_col_16 is not null) (type: boolean)
                     Statistics: Num rows: 1 Data size: 152 Basic stats: COMPLETE Column stats: NONE
@@ -147,13 +147,13 @@ STAGE PLANS:
                 keys:
                   0 _col0 (type: tinyint), _col4 (type: decimal(34,16)), _col1 (type: bigint)
                   1 _col4 (type: tinyint), _col0 (type: decimal(34,16)), UDFToLong(_col2) (type: bigint)
-                outputColumnNames: _col2, _col3, _col5, _col7, _col9
+                outputColumnNames: _col2, _col3, _col5, _col7
                 Statistics: Num rows: 1 Data size: 193 Basic stats: COMPLETE Column stats: NONE
                 Reduce Output Operator
-                  key expressions: _col2 (type: timestamp), UDFToInteger(_col9) (type: int)
-                  null sort order: zz
-                  sort order: ++
-                  Map-reduce partition columns: _col2 (type: timestamp), UDFToInteger(_col9) (type: int)
+                  key expressions: _col2 (type: timestamp)
+                  null sort order: z
+                  sort order: +
+                  Map-reduce partition columns: _col2 (type: timestamp)
                   Statistics: Num rows: 1 Data size: 193 Basic stats: COMPLETE Column stats: NONE
                   value expressions: _col3 (type: double), _col5 (type: smallint), _col7 (type: int)
         Reducer 3 
@@ -163,8 +163,8 @@ STAGE PLANS:
                 condition map:
                      Left Semi Join 0 to 1
                 keys:
-                  0 _col2 (type: timestamp), UDFToInteger(_col9) (type: int)
-                  1 _col0 (type: timestamp), _col1 (type: int)
+                  0 _col2 (type: timestamp)
+                  1 _col0 (type: timestamp)
                 outputColumnNames: _col3, _col5, _col7
                 Statistics: Num rows: 1 Data size: 212 Basic stats: COMPLETE Column stats: NONE
                 Reduce Output Operator
@@ -224,20 +224,20 @@ STAGE PLANS:
                 outputColumnNames: _col1
                 Statistics: Num rows: 1 Data size: 167 Basic stats: COMPLETE Column stats: NONE
                 Select Operator
-                  expressions: _col1 (type: timestamp), -92 (type: int)
-                  outputColumnNames: _col0, _col1
+                  expressions: _col1 (type: timestamp)
+                  outputColumnNames: _col0
                   Statistics: Num rows: 1 Data size: 167 Basic stats: COMPLETE Column stats: NONE
                   Group By Operator
-                    keys: _col0 (type: timestamp), _col1 (type: int)
+                    keys: _col0 (type: timestamp)
                     minReductionHashAggr: 0.99
                     mode: hash
-                    outputColumnNames: _col0, _col1
+                    outputColumnNames: _col0
                     Statistics: Num rows: 1 Data size: 167 Basic stats: COMPLETE Column stats: NONE
                     Reduce Output Operator
-                      key expressions: _col0 (type: timestamp), _col1 (type: int)
-                      null sort order: zz
-                      sort order: ++
-                      Map-reduce partition columns: _col0 (type: timestamp), _col1 (type: int)
+                      key expressions: _col0 (type: timestamp)
+                      null sort order: z
+                      sort order: +
+                      Map-reduce partition columns: _col0 (type: timestamp)
                       Statistics: Num rows: 1 Data size: 167 Basic stats: COMPLETE Column stats: NONE
 
   Stage: Stage-0
diff --git a/ql/src/test/results/clientpositive/llap/semijoin6.q.out b/ql/src/test/results/clientpositive/llap/semijoin6.q.out
index 03f69f4cc9..5d18babec8 100644
--- a/ql/src/test/results/clientpositive/llap/semijoin6.q.out
+++ b/ql/src/test/results/clientpositive/llap/semijoin6.q.out
@@ -753,20 +753,20 @@ STAGE PLANS:
                     Statistics: Num rows: 6 Data size: 48 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
                       expressions: a (type: int), b (type: int)
-                      outputColumnNames: _col0, _col3
+                      outputColumnNames: _col0, _col2
                       Statistics: Num rows: 6 Data size: 48 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
-                        keys: _col0 (type: int), _col3 (type: int), _col3 (type: int), _col3 (type: int)
+                        keys: _col0 (type: int), _col2 (type: int), _col2 (type: int)
                         minReductionHashAggr: 0.4
                         mode: hash
-                        outputColumnNames: _col0, _col1, _col2, _col3
-                        Statistics: Num rows: 5 Data size: 80 Basic stats: COMPLETE Column stats: COMPLETE
+                        outputColumnNames: _col0, _col1, _col2
+                        Statistics: Num rows: 5 Data size: 60 Basic stats: COMPLETE Column stats: COMPLETE
                         Reduce Output Operator
                           key expressions: _col0 (type: int)
                           null sort order: z
                           sort order: +
                           Map-reduce partition columns: _col0 (type: int)
-                          Statistics: Num rows: 5 Data size: 80 Basic stats: COMPLETE Column stats: COMPLETE
+                          Statistics: Num rows: 5 Data size: 60 Basic stats: COMPLETE Column stats: COMPLETE
                           value expressions: _col1 (type: int)
             Execution mode: vectorized, llap
             LLAP IO: all inputs
@@ -780,7 +780,7 @@ STAGE PLANS:
                   0 _col0 (type: int)
                   1 _col0 (type: int)
                 outputColumnNames: _col0, _col1, _col3
-                residual filter predicates: {((_col0 + _col3) > 400)} {(CASE WHEN ((_col0 > 3)) THEN (true) WHEN ((_col3 > 1900)) THEN (true) ELSE (false) END or ((COALESCE(_col0) + COALESCE(_col3)) > 1900))}
+                residual filter predicates: {((_col0 + _col3) > 400)} {((_col0 > 3) or (_col3 > 1900) or ((_col0 + _col3) > 1900))}
                 Statistics: Num rows: 1 Data size: 12 Basic stats: COMPLETE Column stats: COMPLETE
                 Select Operator
                   expressions: _col0 (type: int), _col1 (type: int)
diff --git a/ql/src/test/results/clientpositive/llap/sort_acid.q.out b/ql/src/test/results/clientpositive/llap/sort_acid.q.out
index 655b8e9f3f..657520d38c 100644
--- a/ql/src/test/results/clientpositive/llap/sort_acid.q.out
+++ b/ql/src/test/results/clientpositive/llap/sort_acid.q.out
@@ -107,9 +107,9 @@ POSTHOOK: Input: default@acidtlb
 POSTHOOK: Output: default@acidtlb
 CBO PLAN:
 HiveSortExchange(distribution=[any], collation=[[0]])
-  HiveProject(row__id=[$0], a=[CAST(30):INTEGER], _o__c2=[350])
-    HiveJoin(condition=[true], joinType=[inner], algorithm=[none], cost=[not available])
-      HiveProject(ROW__ID=[$4])
+  HiveProject(row__id=[$1], a=[CAST(30):INTEGER], _o__c2=[350])
+    HiveSemiJoin(condition=[true], joinType=[semi])
+      HiveProject(a=[CAST(30):INTEGER], ROW__ID=[$4])
         HiveFilter(condition=[=($0, 30)])
           HiveTableScan(table=[[default, acidtlb]], table:alias=[acidtlb])
       HiveProject($f0=[$0])
@@ -208,7 +208,7 @@ POSTHOOK: Input: default@othertlb
 POSTHOOK: Output: default@acidtlb
 CBO PLAN:
 HiveSortExchange(distribution=[any], collation=[[0]])
-  HiveProject(ROW__ID=[$1])
+  HiveProject(row__id=[$1])
     HiveSemiJoin(condition=[=($0, $2)], joinType=[semi])
       HiveProject(a=[$0], ROW__ID=[$4])
         HiveFilter(condition=[IS NOT NULL($0)])
diff --git a/ql/src/test/results/clientpositive/llap/subquery_ALL.q.out b/ql/src/test/results/clientpositive/llap/subquery_ALL.q.out
index afd3c9a8a7..45b3e3281f 100644
--- a/ql/src/test/results/clientpositive/llap/subquery_ALL.q.out
+++ b/ql/src/test/results/clientpositive/llap/subquery_ALL.q.out
@@ -401,7 +401,7 @@ POSTHOOK: Input: default@part
 POSTHOOK: Input: default@part_null_n0
 #### A masked pattern was here ####
 0
-Warning: Shuffle Join MERGEJOIN[45][tables = [$hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
+Warning: Shuffle Join MERGEJOIN[39][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
 PREHOOK: query: select count(*) from part where ((p_partkey <> ALL (select p_partkey from part_null_n0)) == false)
 PREHOOK: type: QUERY
 PREHOOK: Input: default@part
@@ -413,8 +413,8 @@ POSTHOOK: Input: default@part
 POSTHOOK: Input: default@part_null_n0
 #### A masked pattern was here ####
 26
-Warning: Shuffle Join MERGEJOIN[39][tables = [$hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
-Warning: Shuffle Join MERGEJOIN[40][tables = [$hdt$_1, $hdt$_2, $hdt$_0]] in Stage 'Reducer 4' is a cross product
+Warning: Shuffle Join MERGEJOIN[37][tables = [$hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
+Warning: Shuffle Join MERGEJOIN[38][tables = [$hdt$_1, $hdt$_2, $hdt$_0]] in Stage 'Reducer 4' is a cross product
 PREHOOK: query: select count(*) from part where (p_partkey <> ALL (select p_partkey from part_null_n0 where p_partkey is null)) is null
 PREHOOK: type: QUERY
 PREHOOK: Input: default@part
diff --git a/ql/src/test/results/clientpositive/llap/subquery_ANY.q.out b/ql/src/test/results/clientpositive/llap/subquery_ANY.q.out
index 27748d4d52..0c3ac6c7eb 100644
--- a/ql/src/test/results/clientpositive/llap/subquery_ANY.q.out
+++ b/ql/src/test/results/clientpositive/llap/subquery_ANY.q.out
@@ -227,7 +227,7 @@ POSTHOOK: Input: default@part
 #### A masked pattern was here ####
 CBO PLAN:
 HiveAggregate(group=[{}], agg#0=[count()])
-  HiveJoin(condition=[=($0, $1)], joinType=[inner], algorithm=[none], cost=[not available])
+  HiveSemiJoin(condition=[=($0, $1)], joinType=[semi])
     HiveProject(p_partkey=[$0])
       HiveFilter(condition=[IS NOT NULL($0)])
         HiveTableScan(table=[[default, part]], table:alias=[part])
@@ -308,7 +308,7 @@ POSTHOOK: Input: default@part
 POSTHOOK: Input: default@part_null_n0
 #### A masked pattern was here ####
 26
-Warning: Shuffle Join MERGEJOIN[39][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
+Warning: Shuffle Join MERGEJOIN[37][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
 PREHOOK: query: select count(*) from part where (p_size= ANY (select p_partkey from part_null_n0)) is null
 PREHOOK: type: QUERY
 PREHOOK: Input: default@part
@@ -320,8 +320,8 @@ POSTHOOK: Input: default@part
 POSTHOOK: Input: default@part_null_n0
 #### A masked pattern was here ####
 26
-Warning: Shuffle Join MERGEJOIN[39][tables = [$hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
-Warning: Shuffle Join MERGEJOIN[40][tables = [$hdt$_1, $hdt$_2, $hdt$_0]] in Stage 'Reducer 4' is a cross product
+Warning: Shuffle Join MERGEJOIN[37][tables = [$hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
+Warning: Shuffle Join MERGEJOIN[38][tables = [$hdt$_1, $hdt$_2, $hdt$_0]] in Stage 'Reducer 4' is a cross product
 PREHOOK: query: select count(*) from part where (p_partkey = ANY (select p_partkey from part_null_n0 where p_partkey is null)) is null
 PREHOOK: type: QUERY
 PREHOOK: Input: default@part
@@ -376,7 +376,7 @@ POSTHOOK: type: QUERY
 POSTHOOK: Input: default@part
 #### A masked pattern was here ####
 26
-Warning: Shuffle Join MERGEJOIN[43][tables = [$hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
+Warning: Shuffle Join MERGEJOIN[41][tables = [$hdt$_0, $hdt$_1]] in Stage 'Reducer 3' is a cross product
 PREHOOK: query: explain cbo select count(*) from part where p_partkey >= ANY (select p_partkey from part) 
 	AND p_size = ANY (select p_size from part group by p_size)
 PREHOOK: type: QUERY
@@ -389,20 +389,19 @@ POSTHOOK: Input: default@part
 #### A masked pattern was here ####
 CBO PLAN:
 HiveAggregate(group=[{}], agg#0=[count()])
-  HiveJoin(condition=[AND(=($1, $2), OR(AND(>=($0, $3), <>($4, 0)), AND(>=($0, $3), <>($4, 0), IS NOT TRUE(>=($0, $3)), <=($4, $5))))], joinType=[inner], algorithm=[none], cost=[not available])
-    HiveProject(p_partkey=[$0], p_size=[$5])
-      HiveFilter(condition=[IS NOT NULL($5)])
-        HiveTableScan(table=[[default, part]], table:alias=[part])
-    HiveJoin(condition=[true], joinType=[inner], algorithm=[none], cost=[not available])
-      HiveProject(p_size=[$0])
-        HiveAggregate(group=[{5}])
-          HiveFilter(condition=[IS NOT NULL($5)])
-            HiveTableScan(table=[[default, part]], table:alias=[part])
+  HiveSemiJoin(condition=[=($1, $5)], joinType=[semi])
+    HiveJoin(condition=[OR(AND(>=($0, $2), <>($3, 0)), AND(>=($0, $2), <>($3, 0), IS NOT TRUE(>=($0, $2)), <=($3, $4)))], joinType=[inner], algorithm=[none], cost=[not available])
+      HiveProject(p_partkey=[$0], p_size=[$5])
+        HiveFilter(condition=[IS NOT NULL($5)])
+          HiveTableScan(table=[[default, part]], table:alias=[part])
       HiveProject(m=[$0], c=[$1], d=[$2])
         HiveAggregate(group=[{}], m=[MIN($0)], c=[COUNT()], d=[COUNT($0)])
           HiveTableScan(table=[[default, part]], table:alias=[part])
+    HiveProject(p_size=[$5])
+      HiveFilter(condition=[IS NOT NULL($5)])
+        HiveTableScan(table=[[default, part]], table:alias=[part])
 
-Warning: Shuffle Join MERGEJOIN[43][tables = [$hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
+Warning: Shuffle Join MERGEJOIN[41][tables = [$hdt$_0, $hdt$_1]] in Stage 'Reducer 3' is a cross product
 PREHOOK: query: select count(*) from part where p_partkey >= ANY (select p_partkey from part) 
 	AND p_size = ANY (select p_size from part group by p_size)
 PREHOOK: type: QUERY
diff --git a/ql/src/test/results/clientpositive/llap/subquery_exists.q.out b/ql/src/test/results/clientpositive/llap/subquery_exists.q.out
index f2e017f971..f4cf086a54 100644
--- a/ql/src/test/results/clientpositive/llap/subquery_exists.q.out
+++ b/ql/src/test/results/clientpositive/llap/subquery_exists.q.out
@@ -396,7 +396,7 @@ STAGE PLANS:
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Semi Join 0 to 1
                 keys:
                   0 
                   1 
@@ -1045,7 +1045,7 @@ STAGE PLANS:
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Semi Join 0 to 1
                 keys:
                   0 
                   1 
diff --git a/ql/src/test/results/clientpositive/llap/subquery_in.q.out b/ql/src/test/results/clientpositive/llap/subquery_in.q.out
index c42b55c12c..c87af032e4 100644
--- a/ql/src/test/results/clientpositive/llap/subquery_in.q.out
+++ b/ql/src/test/results/clientpositive/llap/subquery_in.q.out
@@ -390,18 +390,24 @@ STAGE PLANS:
                     expressions: (UDFToDouble(_col0) / _col1) (type: double)
                     outputColumnNames: _col0
                     Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
-                    Reduce Output Operator
-                      key expressions: _col0 (type: double)
-                      null sort order: z
-                      sort order: +
-                      Map-reduce partition columns: _col0 (type: double)
+                    Group By Operator
+                      keys: _col0 (type: double)
+                      minReductionHashAggr: 0.4
+                      mode: hash
+                      outputColumnNames: _col0
                       Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
+                      Reduce Output Operator
+                        key expressions: _col0 (type: double)
+                        null sort order: z
+                        sort order: +
+                        Map-reduce partition columns: _col0 (type: double)
+                        Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
         Reducer 4 
             Execution mode: llap
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Semi Join 0 to 1
                 keys:
                   0 UDFToDouble(_col1) (type: double)
                   1 _col0 (type: double)
@@ -1112,13 +1118,13 @@ STAGE PLANS:
                     Select Operator
                       expressions: l_orderkey (type: int), l_partkey (type: int), l_suppkey (type: int)
                       outputColumnNames: _col0, _col1, _col2
-                      Statistics: Num rows: 14 Data size: 168 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 14 Data size: 224 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
                         key expressions: _col1 (type: int)
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col1 (type: int)
-                        Statistics: Num rows: 14 Data size: 168 Basic stats: COMPLETE Column stats: COMPLETE
+                        Statistics: Num rows: 14 Data size: 224 Basic stats: COMPLETE Column stats: COMPLETE
                         value expressions: _col0 (type: int), _col2 (type: int)
             Execution mode: vectorized, llap
             LLAP IO: all inputs
@@ -1179,13 +1185,17 @@ STAGE PLANS:
                   1 _col0 (type: int)
                 outputColumnNames: _col0, _col1, _col2
                 Statistics: Num rows: 14 Data size: 168 Basic stats: COMPLETE Column stats: COMPLETE
-                Reduce Output Operator
-                  key expressions: _col0 (type: int)
-                  null sort order: z
-                  sort order: +
-                  Map-reduce partition columns: _col0 (type: int)
-                  Statistics: Num rows: 14 Data size: 168 Basic stats: COMPLETE Column stats: COMPLETE
-                  value expressions: _col1 (type: int), _col2 (type: int)
+                Select Operator
+                  expressions: _col1 (type: int), _col0 (type: int), _col2 (type: int)
+                  outputColumnNames: _col0, _col1, _col3
+                  Statistics: Num rows: 14 Data size: 224 Basic stats: COMPLETE Column stats: COMPLETE
+                  Reduce Output Operator
+                    key expressions: _col1 (type: int)
+                    null sort order: z
+                    sort order: +
+                    Map-reduce partition columns: _col1 (type: int)
+                    Statistics: Num rows: 14 Data size: 224 Basic stats: COMPLETE Column stats: COMPLETE
+                    value expressions: _col0 (type: int), _col3 (type: int)
         Reducer 3 
             Execution mode: llap
             Reduce Operator Tree:
@@ -1193,12 +1203,12 @@ STAGE PLANS:
                 condition map:
                      Left Semi Join 0 to 1
                 keys:
-                  0 _col0 (type: int)
+                  0 _col1 (type: int)
                   1 _col0 (type: int)
-                outputColumnNames: _col1, _col2
+                outputColumnNames: _col0, _col3
                 Statistics: Num rows: 14 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
                 Select Operator
-                  expressions: _col1 (type: int), _col2 (type: int)
+                  expressions: _col0 (type: int), _col3 (type: int)
                   outputColumnNames: _col0, _col1
                   Statistics: Num rows: 14 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
                   File Output Operator
@@ -1624,15 +1634,15 @@ STAGE PLANS:
                     predicate: p_size is not null (type: boolean)
                     Statistics: Num rows: 26 Data size: 16094 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: p_partkey (type: int), p_name (type: string), p_mfgr (type: string), p_brand (type: string), p_type (type: string), p_size (type: int), p_container (type: string), p_retailprice (type: double), p_comment (type: string), (p_size - 1) (type: int)
-                      outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col9
-                      Statistics: Num rows: 26 Data size: 16198 Basic stats: COMPLETE Column stats: COMPLETE
+                      expressions: p_partkey (type: int), p_name (type: string), p_mfgr (type: string), p_brand (type: string), p_type (type: string), p_size (type: int), p_container (type: string), p_retailprice (type: double), p_comment (type: string)
+                      outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
+                      Statistics: Num rows: 26 Data size: 16094 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
-                        key expressions: _col9 (type: int)
+                        key expressions: (_col5 - 1) (type: int)
                         null sort order: z
                         sort order: +
-                        Map-reduce partition columns: _col9 (type: int)
-                        Statistics: Num rows: 26 Data size: 16198 Basic stats: COMPLETE Column stats: COMPLETE
+                        Map-reduce partition columns: (_col5 - 1) (type: int)
+                        Statistics: Num rows: 26 Data size: 16094 Basic stats: COMPLETE Column stats: COMPLETE
                         value expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
             Execution mode: vectorized, llap
             LLAP IO: all inputs
@@ -1675,7 +1685,7 @@ STAGE PLANS:
                 condition map:
                      Left Semi Join 0 to 1
                 keys:
-                  0 _col9 (type: int)
+                  0 (_col5 - 1) (type: int)
                   1 _col0 (type: int)
                 outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
                 Statistics: Num rows: 26 Data size: 16094 Basic stats: COMPLETE Column stats: COMPLETE
@@ -1759,15 +1769,15 @@ STAGE PLANS:
                     predicate: (p_partkey is not null and p_size is not null) (type: boolean)
                     Statistics: Num rows: 26 Data size: 16094 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: p_partkey (type: int), p_name (type: string), p_mfgr (type: string), p_brand (type: string), p_type (type: string), p_size (type: int), p_container (type: string), p_retailprice (type: double), p_comment (type: string), (p_partkey * p_size) (type: int)
-                      outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col9
-                      Statistics: Num rows: 26 Data size: 16198 Basic stats: COMPLETE Column stats: COMPLETE
+                      expressions: p_partkey (type: int), p_name (type: string), p_mfgr (type: string), p_brand (type: string), p_type (type: string), p_size (type: int), p_container (type: string), p_retailprice (type: double), p_comment (type: string)
+                      outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
+                      Statistics: Num rows: 26 Data size: 16094 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
-                        key expressions: _col9 (type: int)
+                        key expressions: (_col0 * _col5) (type: int)
                         null sort order: z
                         sort order: +
-                        Map-reduce partition columns: _col9 (type: int)
-                        Statistics: Num rows: 26 Data size: 16198 Basic stats: COMPLETE Column stats: COMPLETE
+                        Map-reduce partition columns: (_col0 * _col5) (type: int)
+                        Statistics: Num rows: 26 Data size: 16094 Basic stats: COMPLETE Column stats: COMPLETE
                         value expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
             Execution mode: vectorized, llap
             LLAP IO: all inputs
@@ -1810,7 +1820,7 @@ STAGE PLANS:
                 condition map:
                      Left Semi Join 0 to 1
                 keys:
-                  0 _col9 (type: int)
+                  0 (_col0 * _col5) (type: int)
                   1 _col0 (type: int)
                 outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
                 Statistics: Num rows: 24 Data size: 14856 Basic stats: COMPLETE Column stats: COMPLETE
@@ -2006,15 +2016,15 @@ STAGE PLANS:
                     predicate: p_retailprice is not null (type: boolean)
                     Statistics: Num rows: 26 Data size: 16094 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: p_partkey (type: int), p_name (type: string), p_mfgr (type: string), p_brand (type: string), p_type (type: string), p_size (type: int), p_container (type: string), p_retailprice (type: double), p_comment (type: string), floor(p_retailprice) (type: bigint)
-                      outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col9
-                      Statistics: Num rows: 26 Data size: 16302 Basic stats: COMPLETE Column stats: COMPLETE
+                      expressions: p_partkey (type: int), p_name (type: string), p_mfgr (type: string), p_brand (type: string), p_type (type: string), p_size (type: int), p_container (type: string), p_retailprice (type: double), p_comment (type: string)
+                      outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
+                      Statistics: Num rows: 26 Data size: 16094 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
-                        key expressions: _col9 (type: bigint)
+                        key expressions: floor(_col7) (type: bigint)
                         null sort order: z
                         sort order: +
-                        Map-reduce partition columns: _col9 (type: bigint)
-                        Statistics: Num rows: 26 Data size: 16302 Basic stats: COMPLETE Column stats: COMPLETE
+                        Map-reduce partition columns: floor(_col7) (type: bigint)
+                        Statistics: Num rows: 26 Data size: 16094 Basic stats: COMPLETE Column stats: COMPLETE
                         value expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
             Execution mode: vectorized, llap
             LLAP IO: all inputs
@@ -2057,7 +2067,7 @@ STAGE PLANS:
                 condition map:
                      Left Semi Join 0 to 1
                 keys:
-                  0 _col9 (type: bigint)
+                  0 floor(_col7) (type: bigint)
                   1 _col0 (type: bigint)
                 outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
                 Statistics: Num rows: 24 Data size: 14856 Basic stats: COMPLETE Column stats: COMPLETE
@@ -2782,7 +2792,7 @@ STAGE PLANS:
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Semi Join 0 to 1
                 keys:
                   0 _col1 (type: bigint)
                   1 _col0 (type: bigint)
@@ -2815,12 +2825,18 @@ STAGE PLANS:
                       expressions: _col1 (type: bigint)
                       outputColumnNames: _col0
                       Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
-                      Reduce Output Operator
-                        key expressions: _col0 (type: bigint)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col0 (type: bigint)
+                      Group By Operator
+                        keys: _col0 (type: bigint)
+                        minReductionHashAggr: 0.4
+                        mode: hash
+                        outputColumnNames: _col0
                         Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
+                        Reduce Output Operator
+                          key expressions: _col0 (type: bigint)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: bigint)
+                          Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
 
   Stage: Stage-0
     Fetch Operator
@@ -3006,7 +3022,7 @@ STAGE PLANS:
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Semi Join 0 to 1
                 keys:
                   0 _col1 (type: bigint)
                   1 _col0 (type: bigint)
@@ -3039,12 +3055,18 @@ STAGE PLANS:
                       expressions: _col1 (type: bigint)
                       outputColumnNames: _col0
                       Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
-                      Reduce Output Operator
-                        key expressions: _col0 (type: bigint)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col0 (type: bigint)
+                      Group By Operator
+                        keys: _col0 (type: bigint)
+                        minReductionHashAggr: 0.4
+                        mode: hash
+                        outputColumnNames: _col0
                         Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
+                        Reduce Output Operator
+                          key expressions: _col0 (type: bigint)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: bigint)
+                          Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
 
   Stage: Stage-0
     Fetch Operator
@@ -3140,15 +3162,15 @@ STAGE PLANS:
                     predicate: p_size is not null (type: boolean)
                     Statistics: Num rows: 26 Data size: 16094 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: p_partkey (type: int), p_name (type: string), p_mfgr (type: string), p_brand (type: string), p_type (type: string), p_size (type: int), p_container (type: string), p_retailprice (type: double), p_comment (type: string), (p_size - 1) (type: int)
-                      outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col9
-                      Statistics: Num rows: 26 Data size: 16198 Basic stats: COMPLETE Column stats: COMPLETE
+                      expressions: p_partkey (type: int), p_name (type: string), p_mfgr (type: string), p_brand (type: string), p_type (type: string), p_size (type: int), p_container (type: string), p_retailprice (type: double), p_comment (type: string)
+                      outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
+                      Statistics: Num rows: 26 Data size: 16094 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
-                        key expressions: _col9 (type: int)
+                        key expressions: (_col5 - 1) (type: int)
                         null sort order: z
                         sort order: +
-                        Map-reduce partition columns: _col9 (type: int)
-                        Statistics: Num rows: 26 Data size: 16198 Basic stats: COMPLETE Column stats: COMPLETE
+                        Map-reduce partition columns: (_col5 - 1) (type: int)
+                        Statistics: Num rows: 26 Data size: 16094 Basic stats: COMPLETE Column stats: COMPLETE
                         value expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
             Execution mode: vectorized, llap
             LLAP IO: all inputs
@@ -3191,7 +3213,7 @@ STAGE PLANS:
                 condition map:
                      Left Semi Join 0 to 1
                 keys:
-                  0 _col9 (type: int)
+                  0 (_col5 - 1) (type: int)
                   1 _col0 (type: int)
                 outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
                 Statistics: Num rows: 26 Data size: 16094 Basic stats: COMPLETE Column stats: COMPLETE
@@ -3289,15 +3311,15 @@ STAGE PLANS:
                     predicate: p_size is not null (type: boolean)
                     Statistics: Num rows: 26 Data size: 16094 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: p_partkey (type: int), p_name (type: string), p_mfgr (type: string), p_brand (type: string), p_type (type: string), p_size (type: int), p_container (type: string), p_retailprice (type: double), p_comment (type: string), (p_size - 1) (type: int)
-                      outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col9
-                      Statistics: Num rows: 26 Data size: 16198 Basic stats: COMPLETE Column stats: COMPLETE
+                      expressions: p_partkey (type: int), p_name (type: string), p_mfgr (type: string), p_brand (type: string), p_type (type: string), p_size (type: int), p_container (type: string), p_retailprice (type: double), p_comment (type: string)
+                      outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
+                      Statistics: Num rows: 26 Data size: 16094 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
-                        key expressions: _col9 (type: int)
+                        key expressions: (_col5 - 1) (type: int)
                         null sort order: z
                         sort order: +
-                        Map-reduce partition columns: _col9 (type: int)
-                        Statistics: Num rows: 26 Data size: 16198 Basic stats: COMPLETE Column stats: COMPLETE
+                        Map-reduce partition columns: (_col5 - 1) (type: int)
+                        Statistics: Num rows: 26 Data size: 16094 Basic stats: COMPLETE Column stats: COMPLETE
                         value expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
             Execution mode: vectorized, llap
             LLAP IO: all inputs
@@ -3340,7 +3362,7 @@ STAGE PLANS:
                 condition map:
                      Left Semi Join 0 to 1
                 keys:
-                  0 _col9 (type: int)
+                  0 (_col5 - 1) (type: int)
                   1 _col0 (type: int)
                 outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
                 Statistics: Num rows: 26 Data size: 16094 Basic stats: COMPLETE Column stats: COMPLETE
@@ -5375,7 +5397,7 @@ STAGE PLANS:
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Semi Join 0 to 1
                 keys:
                   0 UDFToLong(_col0) (type: bigint)
                   1 _col0 (type: bigint)
@@ -5399,12 +5421,18 @@ STAGE PLANS:
                 Filter Operator
                   predicate: _col0 is not null (type: boolean)
                   Statistics: Num rows: 1 Data size: 8 Basic stats: PARTIAL Column stats: COMPLETE
-                  Reduce Output Operator
-                    key expressions: _col0 (type: bigint)
-                    null sort order: z
-                    sort order: +
-                    Map-reduce partition columns: _col0 (type: bigint)
+                  Group By Operator
+                    keys: _col0 (type: bigint)
+                    minReductionHashAggr: 0.99
+                    mode: hash
+                    outputColumnNames: _col0
                     Statistics: Num rows: 1 Data size: 8 Basic stats: PARTIAL Column stats: COMPLETE
+                    Reduce Output Operator
+                      key expressions: _col0 (type: bigint)
+                      null sort order: z
+                      sort order: +
+                      Map-reduce partition columns: _col0 (type: bigint)
+                      Statistics: Num rows: 1 Data size: 8 Basic stats: PARTIAL Column stats: COMPLETE
 
   Stage: Stage-0
     Fetch Operator
diff --git a/ql/src/test/results/clientpositive/llap/subquery_in_having.q.out b/ql/src/test/results/clientpositive/llap/subquery_in_having.q.out
index cd819bbb33..c10bc05c64 100644
--- a/ql/src/test/results/clientpositive/llap/subquery_in_having.q.out
+++ b/ql/src/test/results/clientpositive/llap/subquery_in_having.q.out
@@ -348,7 +348,13 @@ STAGE PLANS:
                     expressions: _col0 (type: string)
                     outputColumnNames: _col0
                     Statistics: Num rows: 1 Data size: 188 Basic stats: COMPLETE Column stats: NONE
-                    Dummy Store
+                    Group By Operator
+                      keys: _col0 (type: string)
+                      minReductionHashAggr: 0.99
+                      mode: hash
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 1 Data size: 188 Basic stats: COMPLETE Column stats: NONE
+                      Dummy Store
             Execution mode: llap
             Reduce Operator Tree:
               Group By Operator
@@ -363,7 +369,7 @@ STAGE PLANS:
                   Statistics: Num rows: 1 Data size: 188 Basic stats: COMPLETE Column stats: NONE
                   Merge Join Operator
                     condition map:
-                         Inner Join 0 to 1
+                         Left Semi Join 0 to 1
                     keys:
                       0 _col0 (type: string)
                       1 _col0 (type: string)
@@ -486,7 +492,13 @@ STAGE PLANS:
                     expressions: _col0 (type: string)
                     outputColumnNames: _col0
                     Statistics: Num rows: 1 Data size: 188 Basic stats: COMPLETE Column stats: NONE
-                    Dummy Store
+                    Group By Operator
+                      keys: _col0 (type: string)
+                      minReductionHashAggr: 0.99
+                      mode: hash
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 1 Data size: 188 Basic stats: COMPLETE Column stats: NONE
+                      Dummy Store
             Execution mode: llap
             Reduce Operator Tree:
               Group By Operator
@@ -501,7 +513,7 @@ STAGE PLANS:
                   Statistics: Num rows: 1 Data size: 188 Basic stats: COMPLETE Column stats: NONE
                   Merge Join Operator
                     condition map:
-                         Inner Join 0 to 1
+                         Left Semi Join 0 to 1
                     keys:
                       0 _col0 (type: string)
                       1 _col0 (type: string)
diff --git a/ql/src/test/results/clientpositive/llap/subquery_join_rewrite.q.out b/ql/src/test/results/clientpositive/llap/subquery_join_rewrite.q.out
index 9be9ded585..3f5a7c6319 100644
--- a/ql/src/test/results/clientpositive/llap/subquery_join_rewrite.q.out
+++ b/ql/src/test/results/clientpositive/llap/subquery_join_rewrite.q.out
@@ -217,15 +217,14 @@ POSTHOOK: type: QUERY
 POSTHOOK: Input: default@web_sales
 #### A masked pattern was here ####
 CBO PLAN:
-HiveProject(ws_order_number=[$0], ws_warehouse_sk=[$1])
-  HiveJoin(condition=[true], joinType=[inner], algorithm=[none], cost=[not available])
-    HiveProject(ws_order_number=[$0], ws_warehouse_sk=[$1])
-      HiveTableScan(table=[[default, web_sales]], table:alias=[ws1])
-    HiveProject($f0=[true])
-      HiveSortLimit(fetch=[1])
-        HiveProject(ws_order_number=[CAST(2):INTEGER])
-          HiveFilter(condition=[=($0, 2)])
-            HiveTableScan(table=[[default, web_sales]], table:alias=[ws2])
+HiveSemiJoin(condition=[true], joinType=[semi])
+  HiveProject(ws_order_number=[$0], ws_warehouse_sk=[$1])
+    HiveTableScan(table=[[default, web_sales]], table:alias=[ws1])
+  HiveProject(ws_order_number=[$0])
+    HiveSortLimit(fetch=[1])
+      HiveProject(ws_order_number=[CAST(2):INTEGER])
+        HiveFilter(condition=[=($0, 2)])
+          HiveTableScan(table=[[default, web_sales]], table:alias=[ws2])
 
 Warning: Shuffle Join MERGEJOIN[16][tables = [$hdt$_0, $hdt$_1]] in Stage 'Reducer 2' is a cross product
 PREHOOK: query: select * from web_sales ws1
@@ -260,15 +259,14 @@ POSTHOOK: type: QUERY
 POSTHOOK: Input: default@web_sales
 #### A masked pattern was here ####
 CBO PLAN:
-HiveProject(ws_order_number=[$0], ws_warehouse_sk=[$1])
-  HiveJoin(condition=[true], joinType=[inner], algorithm=[none], cost=[not available])
-    HiveProject(ws_order_number=[$0], ws_warehouse_sk=[$1])
-      HiveTableScan(table=[[default, web_sales]], table:alias=[ws1])
-    HiveProject($f0=[true])
-      HiveSortLimit(fetch=[0])
-        HiveProject(ws_order_number=[CAST(2):INTEGER])
-          HiveFilter(condition=[=($0, 2)])
-            HiveTableScan(table=[[default, web_sales]], table:alias=[ws2])
+HiveSemiJoin(condition=[true], joinType=[semi])
+  HiveProject(ws_order_number=[$0], ws_warehouse_sk=[$1])
+    HiveTableScan(table=[[default, web_sales]], table:alias=[ws1])
+  HiveProject(ws_order_number=[$0])
+    HiveSortLimit(fetch=[0])
+      HiveProject(ws_order_number=[CAST(2):INTEGER])
+        HiveFilter(condition=[=($0, 2)])
+          HiveTableScan(table=[[default, web_sales]], table:alias=[ws2])
 
 Warning: Shuffle Join MERGEJOIN[13][tables = [$hdt$_0, $hdt$_1]] in Stage 'Reducer 2' is a cross product
 PREHOOK: query: select * from web_sales ws1
@@ -294,17 +292,16 @@ POSTHOOK: type: QUERY
 POSTHOOK: Input: default@web_sales
 #### A masked pattern was here ####
 CBO PLAN:
-HiveProject(ws_order_number=[$0], ws_warehouse_sk=[$1])
-  HiveJoin(condition=[=($0, $2)], joinType=[inner], algorithm=[none], cost=[not available])
-    HiveProject(ws_order_number=[$0], ws_warehouse_sk=[$1])
-      HiveFilter(condition=[IS NOT NULL($0)])
-        HiveTableScan(table=[[default, web_sales]], table:alias=[ws1])
-    HiveProject(ws_order_number=[$0])
-      HiveFilter(condition=[IS NOT NULL($0)])
-        HiveProject(ws_order_number=[$0])
-          HiveSortLimit(sort0=[$0], dir0=[ASC], fetch=[1])
-            HiveProject(ws_order_number=[$0])
-              HiveTableScan(table=[[default, web_sales]], table:alias=[ws2])
+HiveSemiJoin(condition=[=($0, $2)], joinType=[semi])
+  HiveProject(ws_order_number=[$0], ws_warehouse_sk=[$1])
+    HiveFilter(condition=[IS NOT NULL($0)])
+      HiveTableScan(table=[[default, web_sales]], table:alias=[ws1])
+  HiveProject(ws_order_number=[$0])
+    HiveFilter(condition=[IS NOT NULL($0)])
+      HiveProject(ws_order_number=[$0])
+        HiveSortLimit(sort0=[$0], dir0=[ASC], fetch=[1])
+          HiveProject(ws_order_number=[$0])
+            HiveTableScan(table=[[default, web_sales]], table:alias=[ws2])
 
 PREHOOK: query: select * from web_sales ws1
 where ws1.ws_order_number in (select ws2.ws_order_number from web_sales ws2 order by ws2.ws_order_number nulls last limit 1)
@@ -331,17 +328,16 @@ POSTHOOK: type: QUERY
 POSTHOOK: Input: default@web_sales
 #### A masked pattern was here ####
 CBO PLAN:
-HiveProject(ws_order_number=[$0], ws_warehouse_sk=[$1])
-  HiveJoin(condition=[=($0, $2)], joinType=[inner], algorithm=[none], cost=[not available])
-    HiveProject(ws_order_number=[$0], ws_warehouse_sk=[$1])
-      HiveFilter(condition=[IS NOT NULL($0)])
-        HiveTableScan(table=[[default, web_sales]], table:alias=[ws1])
-    HiveProject(ws_order_number=[$0])
-      HiveFilter(condition=[IS NOT NULL($0)])
-        HiveProject(ws_order_number=[$0])
-          HiveSortLimit(sort0=[$0], dir0=[ASC-nulls-first], fetch=[1])
-            HiveProject(ws_order_number=[$0])
-              HiveTableScan(table=[[default, web_sales]], table:alias=[ws2])
+HiveSemiJoin(condition=[=($0, $2)], joinType=[semi])
+  HiveProject(ws_order_number=[$0], ws_warehouse_sk=[$1])
+    HiveFilter(condition=[IS NOT NULL($0)])
+      HiveTableScan(table=[[default, web_sales]], table:alias=[ws1])
+  HiveProject(ws_order_number=[$0])
+    HiveFilter(condition=[IS NOT NULL($0)])
+      HiveProject(ws_order_number=[$0])
+        HiveSortLimit(sort0=[$0], dir0=[ASC-nulls-first], fetch=[1])
+          HiveProject(ws_order_number=[$0])
+            HiveTableScan(table=[[default, web_sales]], table:alias=[ws2])
 
 PREHOOK: query: select * from web_sales ws1
 where ws1.ws_order_number in (select ws2.ws_order_number from web_sales ws2 order by ws2.ws_order_number nulls first limit 1)
diff --git a/ql/src/test/results/clientpositive/llap/subquery_multi.q.out b/ql/src/test/results/clientpositive/llap/subquery_multi.q.out
index cb0297e2df..aac3dc9b24 100644
--- a/ql/src/test/results/clientpositive/llap/subquery_multi.q.out
+++ b/ql/src/test/results/clientpositive/llap/subquery_multi.q.out
@@ -246,7 +246,7 @@ POSTHOOK: Input: default@part_null
 85768	almond antique chartreuse lavender yellow	Manufacturer#1	Brand#12	LARGE BRUSHED STEEL	34	SM BAG	1753.76	refull
 86428	almond aquamarine burnished black steel	Manufacturer#1	Brand#12	STANDARD ANODIZED STEEL	28	WRAP BAG	1414.42	arefully 
 90681	almond antique chartreuse khaki white	Manufacturer#3	Brand#31	MEDIUM BURNISHED TIN	17	SM CASE	1671.68	are slyly after the sl
-Warning: Shuffle Join MERGEJOIN[61][tables = [$hdt$_2, $hdt$_3]] in Stage 'Reducer 3' is a cross product
+Warning: Shuffle Join MERGEJOIN[57][tables = [$hdt$_0, $hdt$_1, $hdt$_2, $hdt$_3]] in Stage 'Reducer 4' is a cross product
 PREHOOK: query: explain select * from part_null where p_name IN (select p_name from part_null) AND p_brand NOT IN (select p_name from part_null)
 PREHOOK: type: QUERY
 PREHOOK: Input: default@part_null
@@ -264,14 +264,36 @@ STAGE PLANS:
     Tez
 #### A masked pattern was here ####
       Edges:
-        Reducer 2 <- Map 1 (CUSTOM_SIMPLE_EDGE)
-        Reducer 3 <- Reducer 2 (XPROD_EDGE), Reducer 5 (XPROD_EDGE)
-        Reducer 4 <- Reducer 3 (SIMPLE_EDGE), Reducer 6 (SIMPLE_EDGE)
-        Reducer 5 <- Map 1 (SIMPLE_EDGE)
-        Reducer 6 <- Map 1 (SIMPLE_EDGE), Reducer 5 (SIMPLE_EDGE)
+        Reducer 2 <- Map 1 (SIMPLE_EDGE), Map 5 (SIMPLE_EDGE)
+        Reducer 3 <- Reducer 2 (SIMPLE_EDGE), Reducer 7 (SIMPLE_EDGE)
+        Reducer 4 <- Reducer 3 (XPROD_EDGE), Reducer 6 (XPROD_EDGE)
+        Reducer 6 <- Map 5 (CUSTOM_SIMPLE_EDGE)
+        Reducer 7 <- Map 5 (SIMPLE_EDGE)
 #### A masked pattern was here ####
       Vertices:
         Map 1 
+            Map Operator Tree:
+                TableScan
+                  alias: part_null
+                  filterExpr: p_name is not null (type: boolean)
+                  Statistics: Num rows: 1 Data size: 1120 Basic stats: COMPLETE Column stats: NONE
+                  Filter Operator
+                    predicate: p_name is not null (type: boolean)
+                    Statistics: Num rows: 1 Data size: 1120 Basic stats: COMPLETE Column stats: NONE
+                    Select Operator
+                      expressions: p_partkey (type: int), p_name (type: string), p_mfgr (type: string), p_brand (type: string), p_type (type: string), p_size (type: int), p_container (type: string), p_retailprice (type: double), p_comment (type: string)
+                      outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
+                      Statistics: Num rows: 1 Data size: 1120 Basic stats: COMPLETE Column stats: NONE
+                      Reduce Output Operator
+                        key expressions: _col1 (type: string)
+                        null sort order: z
+                        sort order: +
+                        Map-reduce partition columns: _col1 (type: string)
+                        Statistics: Num rows: 1 Data size: 1120 Basic stats: COMPLETE Column stats: NONE
+                        value expressions: _col0 (type: int), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
+            Execution mode: vectorized, llap
+            LLAP IO: all inputs
+        Map 5 
             Map Operator Tree:
                 TableScan
                   alias: part_null
@@ -307,49 +329,57 @@ STAGE PLANS:
                         Map-reduce partition columns: _col0 (type: string)
                         Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
                     Select Operator
-                      expressions: p_partkey (type: int), p_name (type: string), p_mfgr (type: string), p_brand (type: string), p_type (type: string), p_size (type: int), p_container (type: string), p_retailprice (type: double), p_comment (type: string)
-                      outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
-                      Statistics: Num rows: 1 Data size: 1120 Basic stats: COMPLETE Column stats: NONE
-                      Reduce Output Operator
-                        key expressions: _col3 (type: string)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col3 (type: string)
-                        Statistics: Num rows: 1 Data size: 1120 Basic stats: COMPLETE Column stats: NONE
-                        value expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
+                      expressions: p_name (type: string)
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                      Group By Operator
+                        keys: _col0 (type: string)
+                        minReductionHashAggr: 0.99
+                        mode: hash
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                        Reduce Output Operator
+                          key expressions: _col0 (type: string)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: string)
+                          Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
             Execution mode: vectorized, llap
             LLAP IO: all inputs
         Reducer 2 
-            Execution mode: vectorized, llap
+            Execution mode: llap
             Reduce Operator Tree:
-              Group By Operator
-                aggregations: count(VALUE._col0), count(VALUE._col1)
-                mode: mergepartial
-                outputColumnNames: _col0, _col1
-                Statistics: Num rows: 1 Data size: 200 Basic stats: COMPLETE Column stats: NONE
+              Merge Join Operator
+                condition map:
+                     Left Semi Join 0 to 1
+                keys:
+                  0 _col1 (type: string)
+                  1 _col0 (type: string)
+                outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
+                Statistics: Num rows: 1 Data size: 1232 Basic stats: COMPLETE Column stats: NONE
                 Reduce Output Operator
-                  null sort order: 
-                  sort order: 
-                  Statistics: Num rows: 1 Data size: 200 Basic stats: COMPLETE Column stats: NONE
-                  value expressions: _col0 (type: bigint), _col1 (type: bigint)
+                  key expressions: _col3 (type: string)
+                  null sort order: z
+                  sort order: +
+                  Map-reduce partition columns: _col3 (type: string)
+                  Statistics: Num rows: 1 Data size: 1232 Basic stats: COMPLETE Column stats: NONE
+                  value expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
         Reducer 3 
             Execution mode: llap
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Outer Join 0 to 1
                 keys:
-                  0 
-                  1 
-                outputColumnNames: _col0, _col1, _col2
-                Statistics: Num rows: 1 Data size: 385 Basic stats: COMPLETE Column stats: NONE
+                  0 _col3 (type: string)
+                  1 _col0 (type: string)
+                outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col10
+                Statistics: Num rows: 1 Data size: 1355 Basic stats: COMPLETE Column stats: NONE
                 Reduce Output Operator
-                  key expressions: _col2 (type: string)
-                  null sort order: z
-                  sort order: +
-                  Map-reduce partition columns: _col2 (type: string)
-                  Statistics: Num rows: 1 Data size: 385 Basic stats: COMPLETE Column stats: NONE
-                  value expressions: _col0 (type: bigint), _col1 (type: bigint)
+                  null sort order: 
+                  sort order: 
+                  Statistics: Num rows: 1 Data size: 1355 Basic stats: COMPLETE Column stats: NONE
+                  value expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string), _col10 (type: boolean)
         Reducer 4 
             Execution mode: llap
             Reduce Operator Tree:
@@ -357,41 +387,49 @@ STAGE PLANS:
                 condition map:
                      Inner Join 0 to 1
                 keys:
-                  0 _col1 (type: string)
-                  1 _col2 (type: string)
+                  0 
+                  1 
                 outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col10, _col11, _col12
-                Statistics: Num rows: 1 Data size: 1355 Basic stats: COMPLETE Column stats: NONE
+                Statistics: Num rows: 1 Data size: 1556 Basic stats: COMPLETE Column stats: NONE
                 Select Operator
                   expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string), _col11 (type: bigint), _col12 (type: bigint), _col10 (type: boolean)
-                  outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col10, _col11, _col13
-                  Statistics: Num rows: 1 Data size: 1355 Basic stats: COMPLETE Column stats: NONE
+                  outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col9, _col10, _col12
+                  Statistics: Num rows: 1 Data size: 1556 Basic stats: COMPLETE Column stats: NONE
                   Filter Operator
-                    predicate: ((_col10 = 0L) or (_col13 is null and (_col11 >= _col10) and _col3 is not null)) (type: boolean)
-                    Statistics: Num rows: 1 Data size: 1355 Basic stats: COMPLETE Column stats: NONE
+                    predicate: ((_col9 = 0L) or (_col12 is null and (_col10 >= _col9) and _col3 is not null)) (type: boolean)
+                    Statistics: Num rows: 1 Data size: 1556 Basic stats: COMPLETE Column stats: NONE
                     Select Operator
                       expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
                       outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
-                      Statistics: Num rows: 1 Data size: 1355 Basic stats: COMPLETE Column stats: NONE
+                      Statistics: Num rows: 1 Data size: 1556 Basic stats: COMPLETE Column stats: NONE
                       File Output Operator
                         compressed: false
-                        Statistics: Num rows: 1 Data size: 1355 Basic stats: COMPLETE Column stats: NONE
+                        Statistics: Num rows: 1 Data size: 1556 Basic stats: COMPLETE Column stats: NONE
                         table:
                             input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                             output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
                             serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-        Reducer 5 
+        Reducer 6 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Group By Operator
-                keys: KEY._col0 (type: string)
+                aggregations: count(VALUE._col0), count(VALUE._col1)
                 mode: mergepartial
-                outputColumnNames: _col0
-                Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                outputColumnNames: _col0, _col1
+                Statistics: Num rows: 1 Data size: 200 Basic stats: COMPLETE Column stats: NONE
                 Reduce Output Operator
                   null sort order: 
                   sort order: 
-                  Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
-                  value expressions: _col0 (type: string)
+                  Statistics: Num rows: 1 Data size: 200 Basic stats: COMPLETE Column stats: NONE
+                  value expressions: _col0 (type: bigint), _col1 (type: bigint)
+        Reducer 7 
+            Execution mode: vectorized, llap
+            Reduce Operator Tree:
+              Group By Operator
+                keys: KEY._col0 (type: string)
+                mode: mergepartial
+                outputColumnNames: _col0
+                Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
                 Select Operator
                   expressions: _col0 (type: string), true (type: boolean)
                   outputColumnNames: _col0, _col1
@@ -403,24 +441,6 @@ STAGE PLANS:
                     Map-reduce partition columns: _col0 (type: string)
                     Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
                     value expressions: _col1 (type: boolean)
-        Reducer 6 
-            Execution mode: llap
-            Reduce Operator Tree:
-              Merge Join Operator
-                condition map:
-                     Left Outer Join 0 to 1
-                keys:
-                  0 _col3 (type: string)
-                  1 _col0 (type: string)
-                outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col10
-                Statistics: Num rows: 1 Data size: 1232 Basic stats: COMPLETE Column stats: NONE
-                Reduce Output Operator
-                  key expressions: _col1 (type: string)
-                  null sort order: z
-                  sort order: +
-                  Map-reduce partition columns: _col1 (type: string)
-                  Statistics: Num rows: 1 Data size: 1232 Basic stats: COMPLETE Column stats: NONE
-                  value expressions: _col0 (type: int), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string), _col10 (type: boolean)
 
   Stage: Stage-0
     Fetch Operator
@@ -428,7 +448,7 @@ STAGE PLANS:
       Processor Tree:
         ListSink
 
-Warning: Shuffle Join MERGEJOIN[61][tables = [$hdt$_2, $hdt$_3]] in Stage 'Reducer 3' is a cross product
+Warning: Shuffle Join MERGEJOIN[57][tables = [$hdt$_0, $hdt$_1, $hdt$_2, $hdt$_3]] in Stage 'Reducer 4' is a cross product
 PREHOOK: query: select * from part_null where p_name IN (select p_name from part_null) AND p_brand NOT IN (select p_name from part_null)
 PREHOOK: type: QUERY
 PREHOOK: Input: default@part_null
@@ -437,7 +457,7 @@ POSTHOOK: query: select * from part_null where p_name IN (select p_name from par
 POSTHOOK: type: QUERY
 POSTHOOK: Input: default@part_null
 #### A masked pattern was here ####
-Warning: Shuffle Join MERGEJOIN[61][tables = [$hdt$_2, $hdt$_3]] in Stage 'Reducer 3' is a cross product
+Warning: Shuffle Join MERGEJOIN[57][tables = [$hdt$_0, $hdt$_1, $hdt$_2, $hdt$_3]] in Stage 'Reducer 4' is a cross product
 PREHOOK: query: explain select * from part_null where p_name IN (select p_name from part_null) AND p_brand NOT IN (select p_type from part_null)
 PREHOOK: type: QUERY
 PREHOOK: Input: default@part_null
@@ -455,15 +475,41 @@ STAGE PLANS:
     Tez
 #### A masked pattern was here ####
       Edges:
-        Reducer 2 <- Map 1 (CUSTOM_SIMPLE_EDGE)
-        Reducer 3 <- Reducer 2 (XPROD_EDGE), Reducer 7 (XPROD_EDGE)
-        Reducer 4 <- Reducer 3 (SIMPLE_EDGE), Reducer 6 (SIMPLE_EDGE)
-        Reducer 5 <- Map 1 (SIMPLE_EDGE)
-        Reducer 6 <- Map 1 (SIMPLE_EDGE), Reducer 5 (SIMPLE_EDGE)
-        Reducer 7 <- Map 1 (SIMPLE_EDGE)
+        Reducer 2 <- Map 1 (SIMPLE_EDGE), Map 5 (SIMPLE_EDGE)
+        Reducer 3 <- Reducer 2 (SIMPLE_EDGE), Reducer 7 (SIMPLE_EDGE)
+        Reducer 4 <- Reducer 3 (XPROD_EDGE), Reducer 6 (XPROD_EDGE)
+        Reducer 6 <- Map 5 (CUSTOM_SIMPLE_EDGE)
+        Reducer 7 <- Map 5 (SIMPLE_EDGE)
 #### A masked pattern was here ####
       Vertices:
         Map 1 
+            Map Operator Tree:
+                TableScan
+                  alias: part_null
+                  filterExpr: p_name is not null (type: boolean)
+                  Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                  Filter Operator
+                    predicate: p_name is not null (type: boolean)
+                    Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                    Select Operator
+                      expressions: p_name (type: string)
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                      Group By Operator
+                        keys: _col0 (type: string)
+                        minReductionHashAggr: 0.99
+                        mode: hash
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                        Reduce Output Operator
+                          key expressions: _col0 (type: string)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: string)
+                          Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+            Execution mode: vectorized, llap
+            LLAP IO: all inputs
+        Map 5 
             Map Operator Tree:
                 TableScan
                   alias: part_null
@@ -500,63 +546,54 @@ STAGE PLANS:
                         Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
                   Filter Operator
                     predicate: p_name is not null (type: boolean)
-                    Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
-                    Group By Operator
-                      keys: p_name (type: string)
-                      minReductionHashAggr: 0.99
-                      mode: hash
-                      outputColumnNames: _col0
-                      Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
-                      Reduce Output Operator
-                        key expressions: _col0 (type: string)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col0 (type: string)
-                        Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                    Statistics: Num rows: 1 Data size: 1120 Basic stats: COMPLETE Column stats: NONE
                     Select Operator
                       expressions: p_partkey (type: int), p_name (type: string), p_mfgr (type: string), p_brand (type: string), p_type (type: string), p_size (type: int), p_container (type: string), p_retailprice (type: double), p_comment (type: string)
                       outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
                       Statistics: Num rows: 1 Data size: 1120 Basic stats: COMPLETE Column stats: NONE
                       Reduce Output Operator
-                        key expressions: _col3 (type: string)
+                        key expressions: _col1 (type: string)
                         null sort order: z
                         sort order: +
-                        Map-reduce partition columns: _col3 (type: string)
+                        Map-reduce partition columns: _col1 (type: string)
                         Statistics: Num rows: 1 Data size: 1120 Basic stats: COMPLETE Column stats: NONE
-                        value expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
+                        value expressions: _col0 (type: int), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
             Execution mode: vectorized, llap
             LLAP IO: all inputs
         Reducer 2 
-            Execution mode: vectorized, llap
+            Execution mode: llap
             Reduce Operator Tree:
-              Group By Operator
-                aggregations: count(VALUE._col0), count(VALUE._col1)
-                mode: mergepartial
-                outputColumnNames: _col0, _col1
-                Statistics: Num rows: 1 Data size: 200 Basic stats: COMPLETE Column stats: NONE
+              Merge Join Operator
+                condition map:
+                     Left Semi Join 0 to 1
+                keys:
+                  0 _col1 (type: string)
+                  1 _col0 (type: string)
+                outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
+                Statistics: Num rows: 1 Data size: 1232 Basic stats: COMPLETE Column stats: NONE
                 Reduce Output Operator
-                  null sort order: 
-                  sort order: 
-                  Statistics: Num rows: 1 Data size: 200 Basic stats: COMPLETE Column stats: NONE
-                  value expressions: _col0 (type: bigint), _col1 (type: bigint)
+                  key expressions: _col3 (type: string)
+                  null sort order: z
+                  sort order: +
+                  Map-reduce partition columns: _col3 (type: string)
+                  Statistics: Num rows: 1 Data size: 1232 Basic stats: COMPLETE Column stats: NONE
+                  value expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
         Reducer 3 
             Execution mode: llap
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Outer Join 0 to 1
                 keys:
-                  0 
-                  1 
-                outputColumnNames: _col0, _col1, _col2
-                Statistics: Num rows: 1 Data size: 385 Basic stats: COMPLETE Column stats: NONE
+                  0 _col3 (type: string)
+                  1 _col0 (type: string)
+                outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col10
+                Statistics: Num rows: 1 Data size: 1355 Basic stats: COMPLETE Column stats: NONE
                 Reduce Output Operator
-                  key expressions: _col2 (type: string)
-                  null sort order: z
-                  sort order: +
-                  Map-reduce partition columns: _col2 (type: string)
-                  Statistics: Num rows: 1 Data size: 385 Basic stats: COMPLETE Column stats: NONE
-                  value expressions: _col0 (type: bigint), _col1 (type: bigint)
+                  null sort order: 
+                  sort order: 
+                  Statistics: Num rows: 1 Data size: 1355 Basic stats: COMPLETE Column stats: NONE
+                  value expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string), _col10 (type: boolean)
         Reducer 4 
             Execution mode: llap
             Reduce Operator Tree:
@@ -564,29 +601,42 @@ STAGE PLANS:
                 condition map:
                      Inner Join 0 to 1
                 keys:
-                  0 _col1 (type: string)
-                  1 _col2 (type: string)
+                  0 
+                  1 
                 outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col10, _col11, _col12
-                Statistics: Num rows: 1 Data size: 1355 Basic stats: COMPLETE Column stats: NONE
+                Statistics: Num rows: 1 Data size: 1556 Basic stats: COMPLETE Column stats: NONE
                 Select Operator
                   expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string), _col11 (type: bigint), _col12 (type: bigint), _col10 (type: boolean)
-                  outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col10, _col11, _col13
-                  Statistics: Num rows: 1 Data size: 1355 Basic stats: COMPLETE Column stats: NONE
+                  outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col9, _col10, _col12
+                  Statistics: Num rows: 1 Data size: 1556 Basic stats: COMPLETE Column stats: NONE
                   Filter Operator
-                    predicate: ((_col10 = 0L) or (_col13 is null and (_col11 >= _col10) and _col3 is not null)) (type: boolean)
-                    Statistics: Num rows: 1 Data size: 1355 Basic stats: COMPLETE Column stats: NONE
+                    predicate: ((_col9 = 0L) or (_col12 is null and (_col10 >= _col9) and _col3 is not null)) (type: boolean)
+                    Statistics: Num rows: 1 Data size: 1556 Basic stats: COMPLETE Column stats: NONE
                     Select Operator
                       expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
                       outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
-                      Statistics: Num rows: 1 Data size: 1355 Basic stats: COMPLETE Column stats: NONE
+                      Statistics: Num rows: 1 Data size: 1556 Basic stats: COMPLETE Column stats: NONE
                       File Output Operator
                         compressed: false
-                        Statistics: Num rows: 1 Data size: 1355 Basic stats: COMPLETE Column stats: NONE
+                        Statistics: Num rows: 1 Data size: 1556 Basic stats: COMPLETE Column stats: NONE
                         table:
                             input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                             output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
                             serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-        Reducer 5 
+        Reducer 6 
+            Execution mode: vectorized, llap
+            Reduce Operator Tree:
+              Group By Operator
+                aggregations: count(VALUE._col0), count(VALUE._col1)
+                mode: mergepartial
+                outputColumnNames: _col0, _col1
+                Statistics: Num rows: 1 Data size: 200 Basic stats: COMPLETE Column stats: NONE
+                Reduce Output Operator
+                  null sort order: 
+                  sort order: 
+                  Statistics: Num rows: 1 Data size: 200 Basic stats: COMPLETE Column stats: NONE
+                  value expressions: _col0 (type: bigint), _col1 (type: bigint)
+        Reducer 7 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Group By Operator
@@ -605,37 +655,6 @@ STAGE PLANS:
                     Map-reduce partition columns: _col0 (type: string)
                     Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
                     value expressions: _col1 (type: boolean)
-        Reducer 6 
-            Execution mode: llap
-            Reduce Operator Tree:
-              Merge Join Operator
-                condition map:
-                     Left Outer Join 0 to 1
-                keys:
-                  0 _col3 (type: string)
-                  1 _col0 (type: string)
-                outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col10
-                Statistics: Num rows: 1 Data size: 1232 Basic stats: COMPLETE Column stats: NONE
-                Reduce Output Operator
-                  key expressions: _col1 (type: string)
-                  null sort order: z
-                  sort order: +
-                  Map-reduce partition columns: _col1 (type: string)
-                  Statistics: Num rows: 1 Data size: 1232 Basic stats: COMPLETE Column stats: NONE
-                  value expressions: _col0 (type: int), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string), _col10 (type: boolean)
-        Reducer 7 
-            Execution mode: vectorized, llap
-            Reduce Operator Tree:
-              Group By Operator
-                keys: KEY._col0 (type: string)
-                mode: mergepartial
-                outputColumnNames: _col0
-                Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
-                Reduce Output Operator
-                  null sort order: 
-                  sort order: 
-                  Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
-                  value expressions: _col0 (type: string)
 
   Stage: Stage-0
     Fetch Operator
@@ -643,7 +662,7 @@ STAGE PLANS:
       Processor Tree:
         ListSink
 
-Warning: Shuffle Join MERGEJOIN[61][tables = [$hdt$_2, $hdt$_3]] in Stage 'Reducer 3' is a cross product
+Warning: Shuffle Join MERGEJOIN[57][tables = [$hdt$_0, $hdt$_1, $hdt$_2, $hdt$_3]] in Stage 'Reducer 4' is a cross product
 PREHOOK: query: select * from part_null where p_name IN (select p_name from part_null) AND p_brand NOT IN (select p_type from part_null)
 PREHOOK: type: QUERY
 PREHOOK: Input: default@part_null
@@ -678,7 +697,7 @@ POSTHOOK: Input: default@part_null
 85768	almond antique chartreuse lavender yellow	Manufacturer#1	Brand#12	LARGE BRUSHED STEEL	34	SM BAG	1753.76	refull
 86428	almond aquamarine burnished black steel	Manufacturer#1	Brand#12	STANDARD ANODIZED STEEL	28	WRAP BAG	1414.42	arefully 
 90681	almond antique chartreuse khaki white	Manufacturer#3	Brand#31	MEDIUM BURNISHED TIN	17	SM CASE	1671.68	are slyly after the sl
-Warning: Shuffle Join MERGEJOIN[63][tables = [$hdt$_2, $hdt$_3]] in Stage 'Reducer 3' is a cross product
+Warning: Shuffle Join MERGEJOIN[57][tables = [$hdt$_0, $hdt$_1, $hdt$_2, $hdt$_3]] in Stage 'Reducer 4' is a cross product
 PREHOOK: query: explain select * from part_null where p_brand IN (select p_brand from part_null) AND p_brand NOT IN (select p_name from part_null)
 PREHOOK: type: QUERY
 PREHOOK: Input: default@part_null
@@ -696,15 +715,41 @@ STAGE PLANS:
     Tez
 #### A masked pattern was here ####
       Edges:
-        Reducer 2 <- Map 1 (CUSTOM_SIMPLE_EDGE)
-        Reducer 3 <- Reducer 2 (XPROD_EDGE), Reducer 7 (XPROD_EDGE)
-        Reducer 4 <- Reducer 3 (SIMPLE_EDGE), Reducer 6 (SIMPLE_EDGE)
-        Reducer 5 <- Map 1 (SIMPLE_EDGE)
-        Reducer 6 <- Map 1 (SIMPLE_EDGE), Reducer 5 (SIMPLE_EDGE)
-        Reducer 7 <- Map 1 (SIMPLE_EDGE)
+        Reducer 2 <- Map 1 (SIMPLE_EDGE), Map 5 (SIMPLE_EDGE)
+        Reducer 3 <- Reducer 2 (SIMPLE_EDGE), Reducer 7 (SIMPLE_EDGE)
+        Reducer 4 <- Reducer 3 (XPROD_EDGE), Reducer 6 (XPROD_EDGE)
+        Reducer 6 <- Map 5 (CUSTOM_SIMPLE_EDGE)
+        Reducer 7 <- Map 5 (SIMPLE_EDGE)
 #### A masked pattern was here ####
       Vertices:
         Map 1 
+            Map Operator Tree:
+                TableScan
+                  alias: part_null
+                  filterExpr: p_brand is not null (type: boolean)
+                  Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                  Filter Operator
+                    predicate: p_brand is not null (type: boolean)
+                    Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                    Select Operator
+                      expressions: p_brand (type: string)
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                      Group By Operator
+                        keys: _col0 (type: string)
+                        minReductionHashAggr: 0.99
+                        mode: hash
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                        Reduce Output Operator
+                          key expressions: _col0 (type: string)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: string)
+                          Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+            Execution mode: vectorized, llap
+            LLAP IO: all inputs
+        Map 5 
             Map Operator Tree:
                 TableScan
                   alias: part_null
@@ -741,19 +786,7 @@ STAGE PLANS:
                         Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
                   Filter Operator
                     predicate: p_brand is not null (type: boolean)
-                    Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
-                    Group By Operator
-                      keys: p_brand (type: string)
-                      minReductionHashAggr: 0.99
-                      mode: hash
-                      outputColumnNames: _col0
-                      Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
-                      Reduce Output Operator
-                        key expressions: _col0 (type: string)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col0 (type: string)
-                        Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                    Statistics: Num rows: 1 Data size: 1120 Basic stats: COMPLETE Column stats: NONE
                     Select Operator
                       expressions: p_partkey (type: int), p_name (type: string), p_mfgr (type: string), p_brand (type: string), p_type (type: string), p_size (type: int), p_container (type: string), p_retailprice (type: double), p_comment (type: string)
                       outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
@@ -768,36 +801,39 @@ STAGE PLANS:
             Execution mode: vectorized, llap
             LLAP IO: all inputs
         Reducer 2 
-            Execution mode: vectorized, llap
+            Execution mode: llap
             Reduce Operator Tree:
-              Group By Operator
-                aggregations: count(VALUE._col0), count(VALUE._col1)
-                mode: mergepartial
-                outputColumnNames: _col0, _col1
-                Statistics: Num rows: 1 Data size: 200 Basic stats: COMPLETE Column stats: NONE
+              Merge Join Operator
+                condition map:
+                     Left Semi Join 0 to 1
+                keys:
+                  0 _col3 (type: string)
+                  1 _col0 (type: string)
+                outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
+                Statistics: Num rows: 1 Data size: 1232 Basic stats: COMPLETE Column stats: NONE
                 Reduce Output Operator
-                  null sort order: 
-                  sort order: 
-                  Statistics: Num rows: 1 Data size: 200 Basic stats: COMPLETE Column stats: NONE
-                  value expressions: _col0 (type: bigint), _col1 (type: bigint)
+                  key expressions: _col3 (type: string)
+                  null sort order: z
+                  sort order: +
+                  Map-reduce partition columns: _col3 (type: string)
+                  Statistics: Num rows: 1 Data size: 1232 Basic stats: COMPLETE Column stats: NONE
+                  value expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
         Reducer 3 
             Execution mode: llap
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Outer Join 0 to 1
                 keys:
-                  0 
-                  1 
-                outputColumnNames: _col0, _col1, _col2
-                Statistics: Num rows: 1 Data size: 385 Basic stats: COMPLETE Column stats: NONE
+                  0 _col3 (type: string)
+                  1 _col0 (type: string)
+                outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col10
+                Statistics: Num rows: 1 Data size: 1355 Basic stats: COMPLETE Column stats: NONE
                 Reduce Output Operator
-                  key expressions: _col2 (type: string)
-                  null sort order: z
-                  sort order: +
-                  Map-reduce partition columns: _col2 (type: string)
-                  Statistics: Num rows: 1 Data size: 385 Basic stats: COMPLETE Column stats: NONE
-                  value expressions: _col0 (type: bigint), _col1 (type: bigint)
+                  null sort order: 
+                  sort order: 
+                  Statistics: Num rows: 1 Data size: 1355 Basic stats: COMPLETE Column stats: NONE
+                  value expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string), _col10 (type: boolean)
         Reducer 4 
             Execution mode: llap
             Reduce Operator Tree:
@@ -805,29 +841,42 @@ STAGE PLANS:
                 condition map:
                      Inner Join 0 to 1
                 keys:
-                  0 _col3 (type: string)
-                  1 _col2 (type: string)
+                  0 
+                  1 
                 outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col10, _col11, _col12
-                Statistics: Num rows: 1 Data size: 1355 Basic stats: COMPLETE Column stats: NONE
+                Statistics: Num rows: 1 Data size: 1556 Basic stats: COMPLETE Column stats: NONE
                 Select Operator
                   expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string), _col11 (type: bigint), _col12 (type: bigint), _col10 (type: boolean)
-                  outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col10, _col11, _col13
-                  Statistics: Num rows: 1 Data size: 1355 Basic stats: COMPLETE Column stats: NONE
+                  outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col9, _col10, _col12
+                  Statistics: Num rows: 1 Data size: 1556 Basic stats: COMPLETE Column stats: NONE
                   Filter Operator
-                    predicate: ((_col10 = 0L) or (_col13 is null and (_col11 >= _col10))) (type: boolean)
-                    Statistics: Num rows: 1 Data size: 1355 Basic stats: COMPLETE Column stats: NONE
+                    predicate: ((_col9 = 0L) or (_col12 is null and (_col10 >= _col9))) (type: boolean)
+                    Statistics: Num rows: 1 Data size: 1556 Basic stats: COMPLETE Column stats: NONE
                     Select Operator
                       expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
                       outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
-                      Statistics: Num rows: 1 Data size: 1355 Basic stats: COMPLETE Column stats: NONE
+                      Statistics: Num rows: 1 Data size: 1556 Basic stats: COMPLETE Column stats: NONE
                       File Output Operator
                         compressed: false
-                        Statistics: Num rows: 1 Data size: 1355 Basic stats: COMPLETE Column stats: NONE
+                        Statistics: Num rows: 1 Data size: 1556 Basic stats: COMPLETE Column stats: NONE
                         table:
                             input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                             output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
                             serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-        Reducer 5 
+        Reducer 6 
+            Execution mode: vectorized, llap
+            Reduce Operator Tree:
+              Group By Operator
+                aggregations: count(VALUE._col0), count(VALUE._col1)
+                mode: mergepartial
+                outputColumnNames: _col0, _col1
+                Statistics: Num rows: 1 Data size: 200 Basic stats: COMPLETE Column stats: NONE
+                Reduce Output Operator
+                  null sort order: 
+                  sort order: 
+                  Statistics: Num rows: 1 Data size: 200 Basic stats: COMPLETE Column stats: NONE
+                  value expressions: _col0 (type: bigint), _col1 (type: bigint)
+        Reducer 7 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Group By Operator
@@ -846,37 +895,6 @@ STAGE PLANS:
                     Map-reduce partition columns: _col0 (type: string)
                     Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
                     value expressions: _col1 (type: boolean)
-        Reducer 6 
-            Execution mode: llap
-            Reduce Operator Tree:
-              Merge Join Operator
-                condition map:
-                     Left Outer Join 0 to 1
-                keys:
-                  0 _col3 (type: string)
-                  1 _col0 (type: string)
-                outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col10
-                Statistics: Num rows: 1 Data size: 1232 Basic stats: COMPLETE Column stats: NONE
-                Reduce Output Operator
-                  key expressions: _col3 (type: string)
-                  null sort order: z
-                  sort order: +
-                  Map-reduce partition columns: _col3 (type: string)
-                  Statistics: Num rows: 1 Data size: 1232 Basic stats: COMPLETE Column stats: NONE
-                  value expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string), _col10 (type: boolean)
-        Reducer 7 
-            Execution mode: vectorized, llap
-            Reduce Operator Tree:
-              Group By Operator
-                keys: KEY._col0 (type: string)
-                mode: mergepartial
-                outputColumnNames: _col0
-                Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
-                Reduce Output Operator
-                  null sort order: 
-                  sort order: 
-                  Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
-                  value expressions: _col0 (type: string)
 
   Stage: Stage-0
     Fetch Operator
@@ -884,7 +902,7 @@ STAGE PLANS:
       Processor Tree:
         ListSink
 
-Warning: Shuffle Join MERGEJOIN[63][tables = [$hdt$_2, $hdt$_3]] in Stage 'Reducer 3' is a cross product
+Warning: Shuffle Join MERGEJOIN[57][tables = [$hdt$_0, $hdt$_1, $hdt$_2, $hdt$_3]] in Stage 'Reducer 4' is a cross product
 PREHOOK: query: select * from part_null where p_brand IN (select p_brand from part_null) AND p_brand NOT IN (select p_name from part_null)
 PREHOOK: type: QUERY
 PREHOOK: Input: default@part_null
@@ -1135,7 +1153,7 @@ POSTHOOK: Input: default@tempty
 85768	almond antique chartreuse lavender yellow	Manufacturer#1	Brand#12	LARGE BRUSHED STEEL	34	SM BAG	1753.76	refull
 86428	almond aquamarine burnished black steel	Manufacturer#1	Brand#12	STANDARD ANODIZED STEEL	28	WRAP BAG	1414.42	arefully 
 90681	almond antique chartreuse khaki white	Manufacturer#3	Brand#31	MEDIUM BURNISHED TIN	17	SM CASE	1671.68	are slyly after the sl
-Warning: Shuffle Join MERGEJOIN[40][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 4' is a cross product
+Warning: Shuffle Join MERGEJOIN[38][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
 PREHOOK: query: explain select * from part_null where p_name IN (select p_name from part_null) AND EXISTS (select c from tnull)
 PREHOOK: type: QUERY
 PREHOOK: Input: default@part_null
@@ -1155,9 +1173,8 @@ STAGE PLANS:
     Tez
 #### A masked pattern was here ####
       Edges:
-        Reducer 2 <- Map 1 (SIMPLE_EDGE)
-        Reducer 3 <- Map 1 (SIMPLE_EDGE), Reducer 2 (SIMPLE_EDGE)
-        Reducer 4 <- Reducer 3 (XPROD_EDGE), Reducer 6 (XPROD_EDGE)
+        Reducer 2 <- Map 1 (SIMPLE_EDGE), Map 4 (SIMPLE_EDGE)
+        Reducer 3 <- Reducer 2 (XPROD_EDGE), Reducer 6 (XPROD_EDGE)
         Reducer 6 <- Map 5 (SIMPLE_EDGE)
 #### A masked pattern was here ####
       Vertices:
@@ -1166,22 +1183,10 @@ STAGE PLANS:
                 TableScan
                   alias: part_null
                   filterExpr: p_name is not null (type: boolean)
-                  Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                  Statistics: Num rows: 1 Data size: 1120 Basic stats: COMPLETE Column stats: NONE
                   Filter Operator
                     predicate: p_name is not null (type: boolean)
-                    Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
-                    Group By Operator
-                      keys: p_name (type: string)
-                      minReductionHashAggr: 0.99
-                      mode: hash
-                      outputColumnNames: _col0
-                      Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
-                      Reduce Output Operator
-                        key expressions: _col0 (type: string)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col0 (type: string)
-                        Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                    Statistics: Num rows: 1 Data size: 1120 Basic stats: COMPLETE Column stats: NONE
                     Select Operator
                       expressions: p_partkey (type: int), p_name (type: string), p_mfgr (type: string), p_brand (type: string), p_type (type: string), p_size (type: int), p_container (type: string), p_retailprice (type: double), p_comment (type: string)
                       outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
@@ -1195,6 +1200,33 @@ STAGE PLANS:
                         value expressions: _col0 (type: int), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
             Execution mode: vectorized, llap
             LLAP IO: all inputs
+        Map 4 
+            Map Operator Tree:
+                TableScan
+                  alias: part_null
+                  filterExpr: p_name is not null (type: boolean)
+                  Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                  Filter Operator
+                    predicate: p_name is not null (type: boolean)
+                    Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                    Select Operator
+                      expressions: p_name (type: string)
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                      Group By Operator
+                        keys: _col0 (type: string)
+                        minReductionHashAggr: 0.99
+                        mode: hash
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                        Reduce Output Operator
+                          key expressions: _col0 (type: string)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: string)
+                          Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+            Execution mode: vectorized, llap
+            LLAP IO: all inputs
         Map 5 
             Map Operator Tree:
                 TableScan
@@ -1217,25 +1249,11 @@ STAGE PLANS:
             Execution mode: vectorized, llap
             LLAP IO: all inputs
         Reducer 2 
-            Execution mode: vectorized, llap
-            Reduce Operator Tree:
-              Group By Operator
-                keys: KEY._col0 (type: string)
-                mode: mergepartial
-                outputColumnNames: _col0
-                Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
-                Reduce Output Operator
-                  key expressions: _col0 (type: string)
-                  null sort order: z
-                  sort order: +
-                  Map-reduce partition columns: _col0 (type: string)
-                  Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
-        Reducer 3 
             Execution mode: llap
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Semi Join 0 to 1
                 keys:
                   0 _col1 (type: string)
                   1 _col0 (type: string)
@@ -1246,12 +1264,12 @@ STAGE PLANS:
                   sort order: 
                   Statistics: Num rows: 1 Data size: 1232 Basic stats: COMPLETE Column stats: NONE
                   value expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
-        Reducer 4 
+        Reducer 3 
             Execution mode: llap
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Semi Join 0 to 1
                 keys:
                   0 
                   1 
@@ -1285,7 +1303,7 @@ STAGE PLANS:
       Processor Tree:
         ListSink
 
-Warning: Shuffle Join MERGEJOIN[40][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 4' is a cross product
+Warning: Shuffle Join MERGEJOIN[38][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
 PREHOOK: query: select * from part_null where p_name IN (select p_name from part_null) AND EXISTS (select c from tnull)
 PREHOOK: type: QUERY
 PREHOOK: Input: default@part_null
@@ -1322,7 +1340,7 @@ POSTHOOK: Input: default@tnull
 85768	almond antique chartreuse lavender yellow	Manufacturer#1	Brand#12	LARGE BRUSHED STEEL	34	SM BAG	1753.76	refull
 86428	almond aquamarine burnished black steel	Manufacturer#1	Brand#12	STANDARD ANODIZED STEEL	28	WRAP BAG	1414.42	arefully 
 90681	almond antique chartreuse khaki white	Manufacturer#3	Brand#31	MEDIUM BURNISHED TIN	17	SM CASE	1671.68	are slyly after the sl
-Warning: Shuffle Join MERGEJOIN[40][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 4' is a cross product
+Warning: Shuffle Join MERGEJOIN[38][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
 PREHOOK: query: explain select * from part_null where p_size IN (select p_size from part_null) AND EXISTS (select c from tempty)
 PREHOOK: type: QUERY
 PREHOOK: Input: default@part_null
@@ -1342,9 +1360,8 @@ STAGE PLANS:
     Tez
 #### A masked pattern was here ####
       Edges:
-        Reducer 2 <- Map 1 (SIMPLE_EDGE)
-        Reducer 3 <- Map 1 (SIMPLE_EDGE), Reducer 2 (SIMPLE_EDGE)
-        Reducer 4 <- Reducer 3 (XPROD_EDGE), Reducer 6 (XPROD_EDGE)
+        Reducer 2 <- Map 1 (SIMPLE_EDGE), Map 4 (SIMPLE_EDGE)
+        Reducer 3 <- Reducer 2 (XPROD_EDGE), Reducer 6 (XPROD_EDGE)
         Reducer 6 <- Map 5 (SIMPLE_EDGE)
 #### A masked pattern was here ####
       Vertices:
@@ -1353,22 +1370,10 @@ STAGE PLANS:
                 TableScan
                   alias: part_null
                   filterExpr: p_size is not null (type: boolean)
-                  Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
+                  Statistics: Num rows: 1 Data size: 1120 Basic stats: COMPLETE Column stats: NONE
                   Filter Operator
                     predicate: p_size is not null (type: boolean)
-                    Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
-                    Group By Operator
-                      keys: p_size (type: int)
-                      minReductionHashAggr: 0.99
-                      mode: hash
-                      outputColumnNames: _col0
-                      Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
-                      Reduce Output Operator
-                        key expressions: _col0 (type: int)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col0 (type: int)
-                        Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
+                    Statistics: Num rows: 1 Data size: 1120 Basic stats: COMPLETE Column stats: NONE
                     Select Operator
                       expressions: p_partkey (type: int), p_name (type: string), p_mfgr (type: string), p_brand (type: string), p_type (type: string), p_size (type: int), p_container (type: string), p_retailprice (type: double), p_comment (type: string)
                       outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
@@ -1382,6 +1387,33 @@ STAGE PLANS:
                         value expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col6 (type: string), _col7 (type: double), _col8 (type: string)
             Execution mode: vectorized, llap
             LLAP IO: all inputs
+        Map 4 
+            Map Operator Tree:
+                TableScan
+                  alias: part_null
+                  filterExpr: p_size is not null (type: boolean)
+                  Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
+                  Filter Operator
+                    predicate: p_size is not null (type: boolean)
+                    Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
+                    Select Operator
+                      expressions: p_size (type: int)
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
+                      Group By Operator
+                        keys: _col0 (type: int)
+                        minReductionHashAggr: 0.99
+                        mode: hash
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
+                        Reduce Output Operator
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
+                          Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
+            Execution mode: vectorized, llap
+            LLAP IO: all inputs
         Map 5 
             Map Operator Tree:
                 TableScan
@@ -1404,25 +1436,11 @@ STAGE PLANS:
             Execution mode: vectorized, llap
             LLAP IO: all inputs
         Reducer 2 
-            Execution mode: vectorized, llap
-            Reduce Operator Tree:
-              Group By Operator
-                keys: KEY._col0 (type: int)
-                mode: mergepartial
-                outputColumnNames: _col0
-                Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
-                Reduce Output Operator
-                  key expressions: _col0 (type: int)
-                  null sort order: z
-                  sort order: +
-                  Map-reduce partition columns: _col0 (type: int)
-                  Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
-        Reducer 3 
             Execution mode: llap
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Semi Join 0 to 1
                 keys:
                   0 _col5 (type: int)
                   1 _col0 (type: int)
@@ -1433,12 +1451,12 @@ STAGE PLANS:
                   sort order: 
                   Statistics: Num rows: 1 Data size: 1232 Basic stats: COMPLETE Column stats: NONE
                   value expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
-        Reducer 4 
+        Reducer 3 
             Execution mode: llap
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Semi Join 0 to 1
                 keys:
                   0 
                   1 
@@ -1472,7 +1490,7 @@ STAGE PLANS:
       Processor Tree:
         ListSink
 
-Warning: Shuffle Join MERGEJOIN[40][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 4' is a cross product
+Warning: Shuffle Join MERGEJOIN[38][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
 PREHOOK: query: select * from part_null where p_size IN (select p_size from part_null) AND EXISTS (select c from tempty)
 PREHOOK: type: QUERY
 PREHOOK: Input: default@part_null
@@ -1483,7 +1501,7 @@ POSTHOOK: type: QUERY
 POSTHOOK: Input: default@part_null
 POSTHOOK: Input: default@tempty
 #### A masked pattern was here ####
-Warning: Shuffle Join MERGEJOIN[41][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 4' is a cross product
+Warning: Shuffle Join MERGEJOIN[39][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
 PREHOOK: query: explain select * from part_null where p_name IN (select p_name from part_null) AND NOT EXISTS (select c from tempty)
 PREHOOK: type: QUERY
 PREHOOK: Input: default@part_null
@@ -1503,9 +1521,8 @@ STAGE PLANS:
     Tez
 #### A masked pattern was here ####
       Edges:
-        Reducer 2 <- Map 1 (SIMPLE_EDGE)
-        Reducer 3 <- Map 1 (SIMPLE_EDGE), Reducer 2 (SIMPLE_EDGE)
-        Reducer 4 <- Reducer 3 (CUSTOM_SIMPLE_EDGE), Reducer 6 (CUSTOM_SIMPLE_EDGE)
+        Reducer 2 <- Map 1 (SIMPLE_EDGE), Map 4 (SIMPLE_EDGE)
+        Reducer 3 <- Reducer 2 (CUSTOM_SIMPLE_EDGE), Reducer 6 (CUSTOM_SIMPLE_EDGE)
         Reducer 6 <- Map 5 (SIMPLE_EDGE)
 #### A masked pattern was here ####
       Vertices:
@@ -1514,22 +1531,10 @@ STAGE PLANS:
                 TableScan
                   alias: part_null
                   filterExpr: p_name is not null (type: boolean)
-                  Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                  Statistics: Num rows: 1 Data size: 1120 Basic stats: COMPLETE Column stats: NONE
                   Filter Operator
                     predicate: p_name is not null (type: boolean)
-                    Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
-                    Group By Operator
-                      keys: p_name (type: string)
-                      minReductionHashAggr: 0.99
-                      mode: hash
-                      outputColumnNames: _col0
-                      Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
-                      Reduce Output Operator
-                        key expressions: _col0 (type: string)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col0 (type: string)
-                        Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                    Statistics: Num rows: 1 Data size: 1120 Basic stats: COMPLETE Column stats: NONE
                     Select Operator
                       expressions: p_partkey (type: int), p_name (type: string), p_mfgr (type: string), p_brand (type: string), p_type (type: string), p_size (type: int), p_container (type: string), p_retailprice (type: double), p_comment (type: string)
                       outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
@@ -1543,6 +1548,33 @@ STAGE PLANS:
                         value expressions: _col0 (type: int), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
             Execution mode: vectorized, llap
             LLAP IO: all inputs
+        Map 4 
+            Map Operator Tree:
+                TableScan
+                  alias: part_null
+                  filterExpr: p_name is not null (type: boolean)
+                  Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                  Filter Operator
+                    predicate: p_name is not null (type: boolean)
+                    Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                    Select Operator
+                      expressions: p_name (type: string)
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                      Group By Operator
+                        keys: _col0 (type: string)
+                        minReductionHashAggr: 0.99
+                        mode: hash
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                        Reduce Output Operator
+                          key expressions: _col0 (type: string)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: string)
+                          Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+            Execution mode: vectorized, llap
+            LLAP IO: all inputs
         Map 5 
             Map Operator Tree:
                 TableScan
@@ -1565,25 +1597,11 @@ STAGE PLANS:
             Execution mode: vectorized, llap
             LLAP IO: all inputs
         Reducer 2 
-            Execution mode: vectorized, llap
-            Reduce Operator Tree:
-              Group By Operator
-                keys: KEY._col0 (type: string)
-                mode: mergepartial
-                outputColumnNames: _col0
-                Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
-                Reduce Output Operator
-                  key expressions: _col0 (type: string)
-                  null sort order: z
-                  sort order: +
-                  Map-reduce partition columns: _col0 (type: string)
-                  Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
-        Reducer 3 
             Execution mode: llap
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Semi Join 0 to 1
                 keys:
                   0 _col1 (type: string)
                   1 _col0 (type: string)
@@ -1594,7 +1612,7 @@ STAGE PLANS:
                   sort order: 
                   Statistics: Num rows: 1 Data size: 1232 Basic stats: COMPLETE Column stats: NONE
                   value expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
-        Reducer 4 
+        Reducer 3 
             Execution mode: llap
             Reduce Operator Tree:
               Merge Join Operator
@@ -1603,10 +1621,10 @@ STAGE PLANS:
                 keys:
                   0 
                   1 
-                outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col10
+                outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col9
                 Statistics: Num rows: 1 Data size: 1233 Basic stats: PARTIAL Column stats: NONE
                 Filter Operator
-                  predicate: _col10 is null (type: boolean)
+                  predicate: _col9 is null (type: boolean)
                   Statistics: Num rows: 1 Data size: 1233 Basic stats: PARTIAL Column stats: NONE
                   Select Operator
                     expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
@@ -1639,7 +1657,7 @@ STAGE PLANS:
       Processor Tree:
         ListSink
 
-Warning: Shuffle Join MERGEJOIN[41][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 4' is a cross product
+Warning: Shuffle Join MERGEJOIN[39][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
 PREHOOK: query: select * from part_null where p_name IN (select p_name from part_null) AND NOT EXISTS (select c from tempty)
 PREHOOK: type: QUERY
 PREHOOK: Input: default@part_null
@@ -2068,9 +2086,8 @@ STAGE PLANS:
     Tez
 #### A masked pattern was here ####
       Edges:
-        Reducer 2 <- Map 1 (SIMPLE_EDGE), Reducer 5 (SIMPLE_EDGE)
+        Reducer 2 <- Map 1 (SIMPLE_EDGE), Map 4 (SIMPLE_EDGE)
         Reducer 3 <- Map 4 (SIMPLE_EDGE), Reducer 2 (SIMPLE_EDGE)
-        Reducer 5 <- Map 4 (SIMPLE_EDGE)
 #### A masked pattern was here ####
       Vertices:
         Map 1 
@@ -2123,18 +2140,22 @@ STAGE PLANS:
                   Filter Operator
                     predicate: p_name is not null (type: boolean)
                     Statistics: Num rows: 26 Data size: 3146 Basic stats: COMPLETE Column stats: COMPLETE
-                    Group By Operator
-                      keys: p_name (type: string)
-                      minReductionHashAggr: 0.4
-                      mode: hash
+                    Select Operator
+                      expressions: p_name (type: string)
                       outputColumnNames: _col0
-                      Statistics: Num rows: 25 Data size: 3025 Basic stats: COMPLETE Column stats: COMPLETE
-                      Reduce Output Operator
-                        key expressions: _col0 (type: string)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col0 (type: string)
+                      Statistics: Num rows: 26 Data size: 3146 Basic stats: COMPLETE Column stats: COMPLETE
+                      Group By Operator
+                        keys: _col0 (type: string)
+                        minReductionHashAggr: 0.4
+                        mode: hash
+                        outputColumnNames: _col0
                         Statistics: Num rows: 25 Data size: 3025 Basic stats: COMPLETE Column stats: COMPLETE
+                        Reduce Output Operator
+                          key expressions: _col0 (type: string)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: string)
+                          Statistics: Num rows: 25 Data size: 3025 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: vectorized, llap
             LLAP IO: all inputs
         Reducer 2 
@@ -2142,7 +2163,7 @@ STAGE PLANS:
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Semi Join 0 to 1
                 keys:
                   0 _col1 (type: string)
                   1 _col0 (type: string)
@@ -2173,20 +2194,6 @@ STAGE PLANS:
                       input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                       output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
                       serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-        Reducer 5 
-            Execution mode: vectorized, llap
-            Reduce Operator Tree:
-              Group By Operator
-                keys: KEY._col0 (type: string)
-                mode: mergepartial
-                outputColumnNames: _col0
-                Statistics: Num rows: 25 Data size: 3025 Basic stats: COMPLETE Column stats: COMPLETE
-                Reduce Output Operator
-                  key expressions: _col0 (type: string)
-                  null sort order: z
-                  sort order: +
-                  Map-reduce partition columns: _col0 (type: string)
-                  Statistics: Num rows: 25 Data size: 3025 Basic stats: COMPLETE Column stats: COMPLETE
 
   Stage: Stage-0
     Fetch Operator
@@ -2983,7 +2990,7 @@ POSTHOOK: Input: default@part_null
 85768	almond antique chartreuse lavender yellow	Manufacturer#1	Brand#12	LARGE BRUSHED STEEL	34	SM BAG	1753.76	refull
 86428	almond aquamarine burnished black steel	Manufacturer#1	Brand#12	STANDARD ANODIZED STEEL	28	WRAP BAG	1414.42	arefully 
 90681	almond antique chartreuse khaki white	Manufacturer#3	Brand#31	MEDIUM BURNISHED TIN	17	SM CASE	1671.68	are slyly after the sl
-Warning: Shuffle Join MERGEJOIN[85][tables = [$hdt$_1, $hdt$_2, $hdt$_3]] in Stage 'Reducer 7' is a cross product
+Warning: Shuffle Join MERGEJOIN[84][tables = [$hdt$_1, $hdt$_2, $hdt$_3]] in Stage 'Reducer 7' is a cross product
 PREHOOK: query: explain select p.p_partkey, li.l_suppkey
 from (select distinct l_partkey as p_partkey from lineitem) p join lineitem li on p.p_partkey = li.l_partkey
 where li.l_linenumber = 1 and
@@ -3065,8 +3072,8 @@ STAGE PLANS:
                     predicate: ((l_linenumber = 1) and l_partkey is not null and l_orderkey is not null) (type: boolean)
                     Statistics: Num rows: 14 Data size: 224 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: l_orderkey (type: int), l_partkey (type: int), l_suppkey (type: int), 1 (type: int)
-                      outputColumnNames: _col0, _col1, _col2, _col3
+                      expressions: l_orderkey (type: int), l_partkey (type: int), l_suppkey (type: int)
+                      outputColumnNames: _col0, _col1, _col2
                       Statistics: Num rows: 14 Data size: 224 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
                         key expressions: _col1 (type: int)
@@ -3074,7 +3081,7 @@ STAGE PLANS:
                         sort order: +
                         Map-reduce partition columns: _col1 (type: int)
                         Statistics: Num rows: 14 Data size: 224 Basic stats: COMPLETE Column stats: COMPLETE
-                        value expressions: _col0 (type: int), _col2 (type: int), _col3 (type: int)
+                        value expressions: _col0 (type: int), _col2 (type: int)
                   Filter Operator
                     predicate: ((l_linenumber = 1) and (l_shipmode = 'AIR') and l_orderkey is not null) (type: boolean)
                     Statistics: Num rows: 2 Data size: 208 Basic stats: COMPLETE Column stats: COMPLETE
@@ -3100,17 +3107,17 @@ STAGE PLANS:
                 keys:
                   0 _col1 (type: int)
                   1 _col0 (type: int)
-                outputColumnNames: _col0, _col1, _col2, _col3
-                Statistics: Num rows: 14 Data size: 224 Basic stats: COMPLETE Column stats: COMPLETE
+                outputColumnNames: _col0, _col1, _col2
+                Statistics: Num rows: 14 Data size: 168 Basic stats: COMPLETE Column stats: COMPLETE
                 Select Operator
-                  expressions: _col1 (type: int), _col0 (type: int), _col2 (type: int), _col3 (type: int)
-                  outputColumnNames: _col0, _col1, _col3, _col4
+                  expressions: _col1 (type: int), _col0 (type: int), _col2 (type: int)
+                  outputColumnNames: _col0, _col1, _col3
                   Statistics: Num rows: 14 Data size: 224 Basic stats: COMPLETE Column stats: COMPLETE
                   Reduce Output Operator
-                    key expressions: _col1 (type: int), _col4 (type: int)
-                    null sort order: zz
-                    sort order: ++
-                    Map-reduce partition columns: _col1 (type: int), _col4 (type: int)
+                    key expressions: _col1 (type: int)
+                    null sort order: z
+                    sort order: +
+                    Map-reduce partition columns: _col1 (type: int)
                     Statistics: Num rows: 14 Data size: 224 Basic stats: COMPLETE Column stats: COMPLETE
                     value expressions: _col0 (type: int), _col3 (type: int)
         Reducer 3 
@@ -3120,8 +3127,8 @@ STAGE PLANS:
                 condition map:
                      Left Semi Join 0 to 1
                 keys:
-                  0 _col1 (type: int), _col4 (type: int)
-                  1 _col0 (type: int), _col1 (type: int)
+                  0 _col1 (type: int)
+                  1 _col0 (type: int)
                 outputColumnNames: _col0, _col3
                 Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
                 Select Operator
@@ -3206,21 +3213,21 @@ STAGE PLANS:
                     predicate: ((_col4 = 0L) or (_col7 is null and (_col5 >= _col4) and _col2 is not null)) (type: boolean)
                     Statistics: Num rows: 2 Data size: 64 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: _col0 (type: int), 1 (type: int)
-                      outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                      expressions: _col0 (type: int)
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
-                        keys: _col0 (type: int), _col1 (type: int)
+                        keys: _col0 (type: int)
                         minReductionHashAggr: 0.4
                         mode: hash
-                        outputColumnNames: _col0, _col1
-                        Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: int)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: int)
-                          Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
+                          Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
 
   Stage: Stage-0
     Fetch Operator
@@ -3228,7 +3235,7 @@ STAGE PLANS:
       Processor Tree:
         ListSink
 
-Warning: Shuffle Join MERGEJOIN[85][tables = [$hdt$_1, $hdt$_2, $hdt$_3]] in Stage 'Reducer 7' is a cross product
+Warning: Shuffle Join MERGEJOIN[84][tables = [$hdt$_1, $hdt$_2, $hdt$_3]] in Stage 'Reducer 7' is a cross product
 PREHOOK: query: select p.p_partkey, li.l_suppkey
 from (select distinct l_partkey as p_partkey from lineitem) p join lineitem li on p.p_partkey = li.l_partkey
 where li.l_linenumber = 1 and
@@ -4564,7 +4571,7 @@ POSTHOOK: Input: default@part_null
 #### A masked pattern was here ####
 192697	almond antique blue firebrick mint	Manufacturer#5	Brand#52	MEDIUM BURNISHED TIN	31	LG DRUM	1789.69	ickly ir
 90681	almond antique chartreuse khaki white	Manufacturer#3	Brand#31	MEDIUM BURNISHED TIN	17	SM CASE	1671.68	are slyly after the sl
-Warning: Shuffle Join MERGEJOIN[41][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 4' is a cross product
+Warning: Shuffle Join MERGEJOIN[39][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
 PREHOOK: query: explain select * from part_null where p_size IN (select p_size from part_null) AND NOT EXISTS (select c from tempty)
 PREHOOK: type: QUERY
 PREHOOK: Input: default@part_null
@@ -4584,9 +4591,8 @@ STAGE PLANS:
     Tez
 #### A masked pattern was here ####
       Edges:
-        Reducer 2 <- Map 1 (SIMPLE_EDGE)
-        Reducer 3 <- Map 1 (SIMPLE_EDGE), Reducer 2 (SIMPLE_EDGE)
-        Reducer 4 <- Reducer 3 (CUSTOM_SIMPLE_EDGE), Reducer 6 (CUSTOM_SIMPLE_EDGE)
+        Reducer 2 <- Map 1 (SIMPLE_EDGE), Map 4 (SIMPLE_EDGE)
+        Reducer 3 <- Reducer 2 (CUSTOM_SIMPLE_EDGE), Reducer 6 (CUSTOM_SIMPLE_EDGE)
         Reducer 6 <- Map 5 (SIMPLE_EDGE)
 #### A masked pattern was here ####
       Vertices:
@@ -4595,22 +4601,10 @@ STAGE PLANS:
                 TableScan
                   alias: part_null
                   filterExpr: p_size is not null (type: boolean)
-                  Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
+                  Statistics: Num rows: 1 Data size: 1120 Basic stats: COMPLETE Column stats: NONE
                   Filter Operator
                     predicate: p_size is not null (type: boolean)
-                    Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
-                    Group By Operator
-                      keys: p_size (type: int)
-                      minReductionHashAggr: 0.99
-                      mode: hash
-                      outputColumnNames: _col0
-                      Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
-                      Reduce Output Operator
-                        key expressions: _col0 (type: int)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col0 (type: int)
-                        Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
+                    Statistics: Num rows: 1 Data size: 1120 Basic stats: COMPLETE Column stats: NONE
                     Select Operator
                       expressions: p_partkey (type: int), p_name (type: string), p_mfgr (type: string), p_brand (type: string), p_type (type: string), p_size (type: int), p_container (type: string), p_retailprice (type: double), p_comment (type: string)
                       outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
@@ -4624,6 +4618,33 @@ STAGE PLANS:
                         value expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col6 (type: string), _col7 (type: double), _col8 (type: string)
             Execution mode: vectorized, llap
             LLAP IO: all inputs
+        Map 4 
+            Map Operator Tree:
+                TableScan
+                  alias: part_null
+                  filterExpr: p_size is not null (type: boolean)
+                  Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
+                  Filter Operator
+                    predicate: p_size is not null (type: boolean)
+                    Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
+                    Select Operator
+                      expressions: p_size (type: int)
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
+                      Group By Operator
+                        keys: _col0 (type: int)
+                        minReductionHashAggr: 0.99
+                        mode: hash
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
+                        Reduce Output Operator
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
+                          Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
+            Execution mode: vectorized, llap
+            LLAP IO: all inputs
         Map 5 
             Map Operator Tree:
                 TableScan
@@ -4646,25 +4667,11 @@ STAGE PLANS:
             Execution mode: vectorized, llap
             LLAP IO: all inputs
         Reducer 2 
-            Execution mode: vectorized, llap
-            Reduce Operator Tree:
-              Group By Operator
-                keys: KEY._col0 (type: int)
-                mode: mergepartial
-                outputColumnNames: _col0
-                Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
-                Reduce Output Operator
-                  key expressions: _col0 (type: int)
-                  null sort order: z
-                  sort order: +
-                  Map-reduce partition columns: _col0 (type: int)
-                  Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: NONE
-        Reducer 3 
             Execution mode: llap
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Semi Join 0 to 1
                 keys:
                   0 _col5 (type: int)
                   1 _col0 (type: int)
@@ -4675,7 +4682,7 @@ STAGE PLANS:
                   sort order: 
                   Statistics: Num rows: 1 Data size: 1232 Basic stats: COMPLETE Column stats: NONE
                   value expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
-        Reducer 4 
+        Reducer 3 
             Execution mode: llap
             Reduce Operator Tree:
               Merge Join Operator
@@ -4684,10 +4691,10 @@ STAGE PLANS:
                 keys:
                   0 
                   1 
-                outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col10
+                outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col9
                 Statistics: Num rows: 1 Data size: 1233 Basic stats: PARTIAL Column stats: NONE
                 Filter Operator
-                  predicate: _col10 is null (type: boolean)
+                  predicate: _col9 is null (type: boolean)
                   Statistics: Num rows: 1 Data size: 1233 Basic stats: PARTIAL Column stats: NONE
                   Select Operator
                     expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
@@ -4720,7 +4727,7 @@ STAGE PLANS:
       Processor Tree:
         ListSink
 
-Warning: Shuffle Join MERGEJOIN[41][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 4' is a cross product
+Warning: Shuffle Join MERGEJOIN[39][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
 PREHOOK: query: select * from part_null where p_size IN (select p_size from part_null) AND NOT EXISTS (select c from tempty)
 PREHOOK: type: QUERY
 PREHOOK: Input: default@part_null
@@ -4758,7 +4765,7 @@ POSTHOOK: Input: default@tempty
 85768	almond antique chartreuse lavender yellow	Manufacturer#1	Brand#12	LARGE BRUSHED STEEL	34	SM BAG	1753.76	refull
 86428	almond aquamarine burnished black steel	Manufacturer#1	Brand#12	STANDARD ANODIZED STEEL	28	WRAP BAG	1414.42	arefully 
 90681	almond antique chartreuse khaki white	Manufacturer#3	Brand#31	MEDIUM BURNISHED TIN	17	SM CASE	1671.68	are slyly after the sl
-Warning: Shuffle Join MERGEJOIN[41][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 4' is a cross product
+Warning: Shuffle Join MERGEJOIN[39][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
 PREHOOK: query: explain select * from part_null where p_name IN (select p_name from part_null) AND NOT EXISTS (select c from tempty)
 PREHOOK: type: QUERY
 PREHOOK: Input: default@part_null
@@ -4778,9 +4785,8 @@ STAGE PLANS:
     Tez
 #### A masked pattern was here ####
       Edges:
-        Reducer 2 <- Map 1 (SIMPLE_EDGE)
-        Reducer 3 <- Map 1 (SIMPLE_EDGE), Reducer 2 (SIMPLE_EDGE)
-        Reducer 4 <- Reducer 3 (CUSTOM_SIMPLE_EDGE), Reducer 6 (CUSTOM_SIMPLE_EDGE)
+        Reducer 2 <- Map 1 (SIMPLE_EDGE), Map 4 (SIMPLE_EDGE)
+        Reducer 3 <- Reducer 2 (CUSTOM_SIMPLE_EDGE), Reducer 6 (CUSTOM_SIMPLE_EDGE)
         Reducer 6 <- Map 5 (SIMPLE_EDGE)
 #### A masked pattern was here ####
       Vertices:
@@ -4789,22 +4795,10 @@ STAGE PLANS:
                 TableScan
                   alias: part_null
                   filterExpr: p_name is not null (type: boolean)
-                  Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                  Statistics: Num rows: 1 Data size: 1120 Basic stats: COMPLETE Column stats: NONE
                   Filter Operator
                     predicate: p_name is not null (type: boolean)
-                    Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
-                    Group By Operator
-                      keys: p_name (type: string)
-                      minReductionHashAggr: 0.99
-                      mode: hash
-                      outputColumnNames: _col0
-                      Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
-                      Reduce Output Operator
-                        key expressions: _col0 (type: string)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col0 (type: string)
-                        Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                    Statistics: Num rows: 1 Data size: 1120 Basic stats: COMPLETE Column stats: NONE
                     Select Operator
                       expressions: p_partkey (type: int), p_name (type: string), p_mfgr (type: string), p_brand (type: string), p_type (type: string), p_size (type: int), p_container (type: string), p_retailprice (type: double), p_comment (type: string)
                       outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8
@@ -4818,6 +4812,33 @@ STAGE PLANS:
                         value expressions: _col0 (type: int), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
             Execution mode: vectorized, llap
             LLAP IO: all inputs
+        Map 4 
+            Map Operator Tree:
+                TableScan
+                  alias: part_null
+                  filterExpr: p_name is not null (type: boolean)
+                  Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                  Filter Operator
+                    predicate: p_name is not null (type: boolean)
+                    Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                    Select Operator
+                      expressions: p_name (type: string)
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                      Group By Operator
+                        keys: _col0 (type: string)
+                        minReductionHashAggr: 0.99
+                        mode: hash
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+                        Reduce Output Operator
+                          key expressions: _col0 (type: string)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: string)
+                          Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
+            Execution mode: vectorized, llap
+            LLAP IO: all inputs
         Map 5 
             Map Operator Tree:
                 TableScan
@@ -4840,25 +4861,11 @@ STAGE PLANS:
             Execution mode: vectorized, llap
             LLAP IO: all inputs
         Reducer 2 
-            Execution mode: vectorized, llap
-            Reduce Operator Tree:
-              Group By Operator
-                keys: KEY._col0 (type: string)
-                mode: mergepartial
-                outputColumnNames: _col0
-                Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
-                Reduce Output Operator
-                  key expressions: _col0 (type: string)
-                  null sort order: z
-                  sort order: +
-                  Map-reduce partition columns: _col0 (type: string)
-                  Statistics: Num rows: 1 Data size: 184 Basic stats: COMPLETE Column stats: NONE
-        Reducer 3 
             Execution mode: llap
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Semi Join 0 to 1
                 keys:
                   0 _col1 (type: string)
                   1 _col0 (type: string)
@@ -4869,7 +4876,7 @@ STAGE PLANS:
                   sort order: 
                   Statistics: Num rows: 1 Data size: 1232 Basic stats: COMPLETE Column stats: NONE
                   value expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
-        Reducer 4 
+        Reducer 3 
             Execution mode: llap
             Reduce Operator Tree:
               Merge Join Operator
@@ -4878,10 +4885,10 @@ STAGE PLANS:
                 keys:
                   0 
                   1 
-                outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col10
+                outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col9
                 Statistics: Num rows: 1 Data size: 1233 Basic stats: PARTIAL Column stats: NONE
                 Filter Operator
-                  predicate: _col10 is null (type: boolean)
+                  predicate: _col9 is null (type: boolean)
                   Statistics: Num rows: 1 Data size: 1233 Basic stats: PARTIAL Column stats: NONE
                   Select Operator
                     expressions: _col0 (type: int), _col1 (type: string), _col2 (type: string), _col3 (type: string), _col4 (type: string), _col5 (type: int), _col6 (type: string), _col7 (type: double), _col8 (type: string)
@@ -4914,7 +4921,7 @@ STAGE PLANS:
       Processor Tree:
         ListSink
 
-Warning: Shuffle Join MERGEJOIN[41][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 4' is a cross product
+Warning: Shuffle Join MERGEJOIN[39][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
 PREHOOK: query: select * from part_null where p_name IN (select p_name from part_null) AND NOT EXISTS (select c from tempty)
 PREHOOK: type: QUERY
 PREHOOK: Input: default@part_null
diff --git a/ql/src/test/results/clientpositive/llap/subquery_notin.q.out b/ql/src/test/results/clientpositive/llap/subquery_notin.q.out
index d5eb2f073d..98a4dfe22f 100644
--- a/ql/src/test/results/clientpositive/llap/subquery_notin.q.out
+++ b/ql/src/test/results/clientpositive/llap/subquery_notin.q.out
@@ -3551,7 +3551,7 @@ almond aquamarine sandy cyan gainsboro
 almond aquamarine yellow dodger mint
 almond azure aquamarine papaya violet
 almond azure blanched chiffon midnight
-Warning: Shuffle Join MERGEJOIN[59][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
+Warning: Shuffle Join MERGEJOIN[61][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
 PREHOOK: query: explain select key, count(*) from src where value NOT IN (select key from src) group by key having count(*) in (select count(*) from src s1 where s1.key = '90' group by s1.key )
 PREHOOK: type: QUERY
 PREHOOK: Input: default@src
@@ -3721,7 +3721,7 @@ STAGE PLANS:
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Semi Join 0 to 1
                 keys:
                   0 _col1 (type: bigint)
                   1 _col0 (type: bigint)
@@ -3754,12 +3754,18 @@ STAGE PLANS:
                       expressions: _col1 (type: bigint)
                       outputColumnNames: _col0
                       Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
-                      Reduce Output Operator
-                        key expressions: _col0 (type: bigint)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col0 (type: bigint)
+                      Group By Operator
+                        keys: _col0 (type: bigint)
+                        minReductionHashAggr: 0.4
+                        mode: hash
+                        outputColumnNames: _col0
                         Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
+                        Reduce Output Operator
+                          key expressions: _col0 (type: bigint)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: bigint)
+                          Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
         Reducer 7 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
@@ -3799,7 +3805,7 @@ STAGE PLANS:
       Processor Tree:
         ListSink
 
-Warning: Shuffle Join MERGEJOIN[59][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
+Warning: Shuffle Join MERGEJOIN[61][tables = [$hdt$_0, $hdt$_1, $hdt$_2]] in Stage 'Reducer 3' is a cross product
 PREHOOK: query: select key, count(*) from src where value NOT IN (select key from src) group by key having count(*) in (select count(*) from src s1 where s1.key = '90' group by s1.key )
 PREHOOK: type: QUERY
 PREHOOK: Input: default@src
@@ -4016,7 +4022,7 @@ STAGE PLANS:
             Reduce Operator Tree:
               Merge Join Operator
                 condition map:
-                     Inner Join 0 to 1
+                     Left Semi Join 0 to 1
                 keys:
                   0 _col1 (type: bigint)
                   1 _col0 (type: bigint)
@@ -4084,12 +4090,18 @@ STAGE PLANS:
                       expressions: _col1 (type: bigint)
                       outputColumnNames: _col0
                       Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
-                      Reduce Output Operator
-                        key expressions: _col0 (type: bigint)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col0 (type: bigint)
+                      Group By Operator
+                        keys: _col0 (type: bigint)
+                        minReductionHashAggr: 0.4
+                        mode: hash
+                        outputColumnNames: _col0
                         Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
+                        Reduce Output Operator
+                          key expressions: _col0 (type: bigint)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: bigint)
+                          Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
 
   Stage: Stage-0
     Fetch Operator
diff --git a/ql/src/test/results/clientpositive/llap/vector_leftsemi_mapjoin.q.out b/ql/src/test/results/clientpositive/llap/vector_leftsemi_mapjoin.q.out
index d6831866aa..8b1d07a8a3 100644
--- a/ql/src/test/results/clientpositive/llap/vector_leftsemi_mapjoin.q.out
+++ b/ql/src/test/results/clientpositive/llap/vector_leftsemi_mapjoin.q.out
@@ -530,6 +530,7 @@ STAGE PLANS:
                 TableScan
                   alias: a
                   filterExpr: (key < 15) (type: boolean)
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_29_container, bigKeyColName:key, smallTablePos:1, keyRatio:1.0
                   Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                   Filter Operator
                     predicate: (key < 15) (type: boolean)
@@ -537,13 +538,13 @@ STAGE PLANS:
                     Select Operator
                       expressions: key (type: int), value (type: string)
                       outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 11 Data size: 1067 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                       Map Join Operator
                         condition map:
                              Left Semi Join 0 to 1
                         keys:
-                          0 _col0 (type: int), true (type: boolean)
-                          1 _col0 (type: int), _col1 (type: boolean)
+                          0 _col0 (type: int)
+                          1 _col0 (type: int)
                         outputColumnNames: _col1
                         input vertices:
                           1 Map 3
@@ -569,21 +570,21 @@ STAGE PLANS:
                     predicate: (key < 15) (type: boolean)
                     Statistics: Num rows: 17 Data size: 68 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: key (type: int), key is not null (type: boolean)
-                      outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 17 Data size: 136 Basic stats: COMPLETE Column stats: COMPLETE
+                      expressions: key (type: int)
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 17 Data size: 68 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
-                        keys: _col0 (type: int), _col1 (type: boolean)
-                        minReductionHashAggr: 0.4
+                        keys: _col0 (type: int)
+                        minReductionHashAggr: 0.5294118
                         mode: hash
-                        outputColumnNames: _col0, _col1
-                        Statistics: Num rows: 8 Data size: 64 Basic stats: COMPLETE Column stats: COMPLETE
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 8 Data size: 32 Basic stats: COMPLETE Column stats: COMPLETE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: boolean)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: boolean)
-                          Statistics: Num rows: 8 Data size: 64 Basic stats: COMPLETE Column stats: COMPLETE
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
+                          Statistics: Num rows: 8 Data size: 32 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: llap
             LLAP IO: all inputs
         Reducer 2 
@@ -662,6 +663,7 @@ STAGE PLANS:
                 TableScan
                   alias: a
                   filterExpr: key is not null (type: boolean)
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_29_container, bigKeyColName:key, smallTablePos:1, keyRatio:0.18181818181818182
                   Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                   Filter Operator
                     predicate: key is not null (type: boolean)
@@ -669,13 +671,13 @@ STAGE PLANS:
                     Select Operator
                       expressions: key (type: int), value (type: string)
                       outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 11 Data size: 1067 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                       Map Join Operator
                         condition map:
                              Left Semi Join 0 to 1
                         keys:
-                          0 _col0 (type: int), true (type: boolean)
-                          1 _col0 (type: int), _col1 (type: boolean)
+                          0 _col0 (type: int)
+                          1 _col0 (type: int)
                         outputColumnNames: _col0, _col1
                         input vertices:
                           1 Map 3
@@ -697,21 +699,21 @@ STAGE PLANS:
                     predicate: ((value < 'val_10') and key is not null) (type: boolean)
                     Statistics: Num rows: 3 Data size: 279 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: key (type: int), value is not null (type: boolean)
-                      outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 3 Data size: 24 Basic stats: COMPLETE Column stats: COMPLETE
+                      expressions: key (type: int)
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 3 Data size: 12 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
-                        keys: _col0 (type: int), _col1 (type: boolean)
+                        keys: _col0 (type: int)
                         minReductionHashAggr: 0.4
                         mode: hash
-                        outputColumnNames: _col0, _col1
-                        Statistics: Num rows: 3 Data size: 24 Basic stats: COMPLETE Column stats: COMPLETE
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 3 Data size: 12 Basic stats: COMPLETE Column stats: COMPLETE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: boolean)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: boolean)
-                          Statistics: Num rows: 3 Data size: 24 Basic stats: COMPLETE Column stats: COMPLETE
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
+                          Statistics: Num rows: 3 Data size: 12 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: llap
             LLAP IO: all inputs
         Reducer 2 
@@ -907,6 +909,7 @@ STAGE PLANS:
                 TableScan
                   alias: a
                   filterExpr: (key > 5) (type: boolean)
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_29_container, bigKeyColName:key, smallTablePos:1, keyRatio:0.2727272727272727
                   Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                   Filter Operator
                     predicate: (key > 5) (type: boolean)
@@ -914,13 +917,13 @@ STAGE PLANS:
                     Select Operator
                       expressions: key (type: int), value (type: string)
                       outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 6 Data size: 582 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 6 Data size: 558 Basic stats: COMPLETE Column stats: COMPLETE
                       Map Join Operator
                         condition map:
                              Left Semi Join 0 to 1
                         keys:
-                          0 _col0 (type: int), true (type: boolean)
-                          1 _col0 (type: int), _col1 (type: boolean)
+                          0 _col0 (type: int)
+                          1 _col0 (type: int)
                         outputColumnNames: _col1
                         input vertices:
                           1 Map 3
@@ -946,21 +949,21 @@ STAGE PLANS:
                     predicate: ((key > 5) and (value <= 'val_20')) (type: boolean)
                     Statistics: Num rows: 2 Data size: 186 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: key (type: int), value is not null (type: boolean)
-                      outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                      expressions: key (type: int)
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
-                        keys: _col0 (type: int), _col1 (type: boolean)
+                        keys: _col0 (type: int)
                         minReductionHashAggr: 0.4
                         mode: hash
-                        outputColumnNames: _col0, _col1
-                        Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: boolean)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: boolean)
-                          Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
+                          Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: llap
             LLAP IO: all inputs
         Reducer 2 
@@ -3842,6 +3845,7 @@ STAGE PLANS:
                 TableScan
                   alias: a
                   filterExpr: (key < 15) (type: boolean)
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_29_container, bigKeyColName:key, smallTablePos:1, keyRatio:1.0
                   Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                   Filter Operator
                     predicate: (key < 15) (type: boolean)
@@ -3849,13 +3853,13 @@ STAGE PLANS:
                     Select Operator
                       expressions: key (type: int), value (type: string)
                       outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 11 Data size: 1067 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                       Map Join Operator
                         condition map:
                              Left Semi Join 0 to 1
                         keys:
-                          0 _col0 (type: int), true (type: boolean)
-                          1 _col0 (type: int), _col1 (type: boolean)
+                          0 _col0 (type: int)
+                          1 _col0 (type: int)
                         outputColumnNames: _col1
                         input vertices:
                           1 Map 3
@@ -3882,21 +3886,21 @@ STAGE PLANS:
                     predicate: (key < 15) (type: boolean)
                     Statistics: Num rows: 17 Data size: 68 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: key (type: int), key is not null (type: boolean)
-                      outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 17 Data size: 136 Basic stats: COMPLETE Column stats: COMPLETE
+                      expressions: key (type: int)
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 17 Data size: 68 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
-                        keys: _col0 (type: int), _col1 (type: boolean)
-                        minReductionHashAggr: 0.4
+                        keys: _col0 (type: int)
+                        minReductionHashAggr: 0.5294118
                         mode: hash
-                        outputColumnNames: _col0, _col1
-                        Statistics: Num rows: 8 Data size: 64 Basic stats: COMPLETE Column stats: COMPLETE
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 8 Data size: 32 Basic stats: COMPLETE Column stats: COMPLETE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: boolean)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: boolean)
-                          Statistics: Num rows: 8 Data size: 64 Basic stats: COMPLETE Column stats: COMPLETE
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
+                          Statistics: Num rows: 8 Data size: 32 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: llap
             LLAP IO: all inputs
         Reducer 2 
@@ -3975,6 +3979,7 @@ STAGE PLANS:
                 TableScan
                   alias: a
                   filterExpr: key is not null (type: boolean)
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_29_container, bigKeyColName:key, smallTablePos:1, keyRatio:0.18181818181818182
                   Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                   Filter Operator
                     predicate: key is not null (type: boolean)
@@ -3982,13 +3987,13 @@ STAGE PLANS:
                     Select Operator
                       expressions: key (type: int), value (type: string)
                       outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 11 Data size: 1067 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                       Map Join Operator
                         condition map:
                              Left Semi Join 0 to 1
                         keys:
-                          0 _col0 (type: int), true (type: boolean)
-                          1 _col0 (type: int), _col1 (type: boolean)
+                          0 _col0 (type: int)
+                          1 _col0 (type: int)
                         outputColumnNames: _col0, _col1
                         input vertices:
                           1 Map 3
@@ -4011,21 +4016,21 @@ STAGE PLANS:
                     predicate: ((value < 'val_10') and key is not null) (type: boolean)
                     Statistics: Num rows: 3 Data size: 279 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: key (type: int), value is not null (type: boolean)
-                      outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 3 Data size: 24 Basic stats: COMPLETE Column stats: COMPLETE
+                      expressions: key (type: int)
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 3 Data size: 12 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
-                        keys: _col0 (type: int), _col1 (type: boolean)
+                        keys: _col0 (type: int)
                         minReductionHashAggr: 0.4
                         mode: hash
-                        outputColumnNames: _col0, _col1
-                        Statistics: Num rows: 3 Data size: 24 Basic stats: COMPLETE Column stats: COMPLETE
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 3 Data size: 12 Basic stats: COMPLETE Column stats: COMPLETE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: boolean)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: boolean)
-                          Statistics: Num rows: 3 Data size: 24 Basic stats: COMPLETE Column stats: COMPLETE
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
+                          Statistics: Num rows: 3 Data size: 12 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: llap
             LLAP IO: all inputs
         Reducer 2 
@@ -4222,6 +4227,7 @@ STAGE PLANS:
                 TableScan
                   alias: a
                   filterExpr: (key > 5) (type: boolean)
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_29_container, bigKeyColName:key, smallTablePos:1, keyRatio:0.2727272727272727
                   Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                   Filter Operator
                     predicate: (key > 5) (type: boolean)
@@ -4229,13 +4235,13 @@ STAGE PLANS:
                     Select Operator
                       expressions: key (type: int), value (type: string)
                       outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 6 Data size: 582 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 6 Data size: 558 Basic stats: COMPLETE Column stats: COMPLETE
                       Map Join Operator
                         condition map:
                              Left Semi Join 0 to 1
                         keys:
-                          0 _col0 (type: int), true (type: boolean)
-                          1 _col0 (type: int), _col1 (type: boolean)
+                          0 _col0 (type: int)
+                          1 _col0 (type: int)
                         outputColumnNames: _col1
                         input vertices:
                           1 Map 3
@@ -4262,21 +4268,21 @@ STAGE PLANS:
                     predicate: ((key > 5) and (value <= 'val_20')) (type: boolean)
                     Statistics: Num rows: 2 Data size: 186 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: key (type: int), value is not null (type: boolean)
-                      outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                      expressions: key (type: int)
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
-                        keys: _col0 (type: int), _col1 (type: boolean)
+                        keys: _col0 (type: int)
                         minReductionHashAggr: 0.4
                         mode: hash
-                        outputColumnNames: _col0, _col1
-                        Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: boolean)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: boolean)
-                          Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
+                          Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: llap
             LLAP IO: all inputs
         Reducer 2 
@@ -6949,7 +6955,7 @@ STAGE PLANS:
                           className: VectorSelectOperator
                           native: true
                         Map Join Vectorization:
-                            bigTableKeyExpressions: col 0:int, ConstantVectorExpression(val 1) -> 3:boolean
+                            bigTableKeyExpressions: col 0:int
                             className: VectorMapJoinOperator
                             native: false
                             nativeConditionsMet: hive.mapjoin.optimized.hashtable IS true, hive.execution.engine tez IN [tez, spark] IS true, One MapJoin Condition IS true, No nullsafe IS true, Small table vectorizes IS true, Optimized Table and Supports Key Types IS true
@@ -6982,14 +6988,13 @@ STAGE PLANS:
                       Select Vectorization:
                           className: VectorSelectOperator
                           native: true
-                          selectExpressions: IsNotNull(col 0:int) -> 3:boolean
                         Group By Vectorization:
                             className: VectorGroupByOperator
                             groupByMode: HASH
                             native: false
                             vectorProcessingMode: HASH
                           Reduce Sink Vectorization:
-                              className: VectorReduceSinkMultiKeyOperator
+                              className: VectorReduceSinkLongOperator
                               native: true
                               nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
             Execution mode: vectorized, llap
@@ -7081,7 +7086,7 @@ STAGE PLANS:
                           className: VectorSelectOperator
                           native: true
                         Map Join Vectorization:
-                            bigTableKeyExpressions: col 0:int, ConstantVectorExpression(val 1) -> 3:boolean
+                            bigTableKeyExpressions: col 0:int
                             className: VectorMapJoinOperator
                             native: false
                             nativeConditionsMet: hive.mapjoin.optimized.hashtable IS true, hive.execution.engine tez IN [tez, spark] IS true, One MapJoin Condition IS true, No nullsafe IS true, Small table vectorizes IS true, Optimized Table and Supports Key Types IS true
@@ -7111,14 +7116,13 @@ STAGE PLANS:
                       Select Vectorization:
                           className: VectorSelectOperator
                           native: true
-                          selectExpressions: IsNotNull(col 1:string) -> 3:boolean
                         Group By Vectorization:
                             className: VectorGroupByOperator
                             groupByMode: HASH
                             native: false
                             vectorProcessingMode: HASH
                           Reduce Sink Vectorization:
-                              className: VectorReduceSinkMultiKeyOperator
+                              className: VectorReduceSinkLongOperator
                               native: true
                               nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
             Execution mode: vectorized, llap
@@ -7325,7 +7329,7 @@ STAGE PLANS:
                           className: VectorSelectOperator
                           native: true
                         Map Join Vectorization:
-                            bigTableKeyExpressions: col 0:int, ConstantVectorExpression(val 1) -> 3:boolean
+                            bigTableKeyExpressions: col 0:int
                             className: VectorMapJoinOperator
                             native: false
                             nativeConditionsMet: hive.mapjoin.optimized.hashtable IS true, hive.execution.engine tez IN [tez, spark] IS true, One MapJoin Condition IS true, No nullsafe IS true, Small table vectorizes IS true, Optimized Table and Supports Key Types IS true
@@ -7358,14 +7362,13 @@ STAGE PLANS:
                       Select Vectorization:
                           className: VectorSelectOperator
                           native: true
-                          selectExpressions: IsNotNull(col 1:string) -> 3:boolean
                         Group By Vectorization:
                             className: VectorGroupByOperator
                             groupByMode: HASH
                             native: false
                             vectorProcessingMode: HASH
                           Reduce Sink Vectorization:
-                              className: VectorReduceSinkMultiKeyOperator
+                              className: VectorReduceSinkLongOperator
                               native: true
                               nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
             Execution mode: vectorized, llap
@@ -10333,6 +10336,7 @@ STAGE PLANS:
                 TableScan
                   alias: a
                   filterExpr: (key < 15) (type: boolean)
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_29_container, bigKeyColName:key, smallTablePos:1, keyRatio:1.0
                   Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                   TableScan Vectorization:
                       native: true
@@ -10348,15 +10352,15 @@ STAGE PLANS:
                       Select Vectorization:
                           className: VectorSelectOperator
                           native: true
-                      Statistics: Num rows: 11 Data size: 1067 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                       Map Join Operator
                         condition map:
                              Left Semi Join 0 to 1
                         keys:
-                          0 _col0 (type: int), true (type: boolean)
-                          1 _col0 (type: int), _col1 (type: boolean)
+                          0 _col0 (type: int)
+                          1 _col0 (type: int)
                         Map Join Vectorization:
-                            bigTableKeyExpressions: col 0:int, ConstantVectorExpression(val 1) -> 3:boolean
+                            bigTableKeyExpressions: col 0:int
                             className: VectorMapJoinOperator
                             native: false
                             nativeConditionsMet: hive.mapjoin.optimized.hashtable IS true, hive.execution.engine tez IN [tez, spark] IS true, One MapJoin Condition IS true, No nullsafe IS true, Small table vectorizes IS true, Optimized Table and Supports Key Types IS true
@@ -10408,34 +10412,33 @@ STAGE PLANS:
                     predicate: (key < 15) (type: boolean)
                     Statistics: Num rows: 17 Data size: 68 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: key (type: int), key is not null (type: boolean)
-                      outputColumnNames: _col0, _col1
+                      expressions: key (type: int)
+                      outputColumnNames: _col0
                       Select Vectorization:
                           className: VectorSelectOperator
                           native: true
-                          selectExpressions: IsNotNull(col 0:int) -> 3:boolean
-                      Statistics: Num rows: 17 Data size: 136 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 17 Data size: 68 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
                         Group By Vectorization:
                             className: VectorGroupByOperator
                             groupByMode: HASH
                             native: false
                             vectorProcessingMode: HASH
-                        keys: _col0 (type: int), _col1 (type: boolean)
-                        minReductionHashAggr: 0.4
+                        keys: _col0 (type: int)
+                        minReductionHashAggr: 0.5294118
                         mode: hash
-                        outputColumnNames: _col0, _col1
-                        Statistics: Num rows: 8 Data size: 64 Basic stats: COMPLETE Column stats: COMPLETE
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 8 Data size: 32 Basic stats: COMPLETE Column stats: COMPLETE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: boolean)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: boolean)
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
                           Reduce Sink Vectorization:
-                              className: VectorReduceSinkMultiKeyOperator
+                              className: VectorReduceSinkLongOperator
                               native: true
                               nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
-                          Statistics: Num rows: 8 Data size: 64 Basic stats: COMPLETE Column stats: COMPLETE
+                          Statistics: Num rows: 8 Data size: 32 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: vectorized, llap
             LLAP IO: all inputs
             Map Vectorization:
@@ -10535,6 +10538,7 @@ STAGE PLANS:
                 TableScan
                   alias: a
                   filterExpr: key is not null (type: boolean)
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_29_container, bigKeyColName:key, smallTablePos:1, keyRatio:0.18181818181818182
                   Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                   TableScan Vectorization:
                       native: true
@@ -10550,15 +10554,15 @@ STAGE PLANS:
                       Select Vectorization:
                           className: VectorSelectOperator
                           native: true
-                      Statistics: Num rows: 11 Data size: 1067 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                       Map Join Operator
                         condition map:
                              Left Semi Join 0 to 1
                         keys:
-                          0 _col0 (type: int), true (type: boolean)
-                          1 _col0 (type: int), _col1 (type: boolean)
+                          0 _col0 (type: int)
+                          1 _col0 (type: int)
                         Map Join Vectorization:
-                            bigTableKeyExpressions: col 0:int, ConstantVectorExpression(val 1) -> 3:boolean
+                            bigTableKeyExpressions: col 0:int
                             className: VectorMapJoinOperator
                             native: false
                             nativeConditionsMet: hive.mapjoin.optimized.hashtable IS true, hive.execution.engine tez IN [tez, spark] IS true, One MapJoin Condition IS true, No nullsafe IS true, Small table vectorizes IS true, Optimized Table and Supports Key Types IS true
@@ -10603,34 +10607,33 @@ STAGE PLANS:
                     predicate: ((value < 'val_10') and key is not null) (type: boolean)
                     Statistics: Num rows: 3 Data size: 279 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: key (type: int), value is not null (type: boolean)
-                      outputColumnNames: _col0, _col1
+                      expressions: key (type: int)
+                      outputColumnNames: _col0
                       Select Vectorization:
                           className: VectorSelectOperator
                           native: true
-                          selectExpressions: IsNotNull(col 1:string) -> 3:boolean
-                      Statistics: Num rows: 3 Data size: 24 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 3 Data size: 12 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
                         Group By Vectorization:
                             className: VectorGroupByOperator
                             groupByMode: HASH
                             native: false
                             vectorProcessingMode: HASH
-                        keys: _col0 (type: int), _col1 (type: boolean)
+                        keys: _col0 (type: int)
                         minReductionHashAggr: 0.4
                         mode: hash
-                        outputColumnNames: _col0, _col1
-                        Statistics: Num rows: 3 Data size: 24 Basic stats: COMPLETE Column stats: COMPLETE
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 3 Data size: 12 Basic stats: COMPLETE Column stats: COMPLETE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: boolean)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: boolean)
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
                           Reduce Sink Vectorization:
-                              className: VectorReduceSinkMultiKeyOperator
+                              className: VectorReduceSinkLongOperator
                               native: true
                               nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
-                          Statistics: Num rows: 3 Data size: 24 Basic stats: COMPLETE Column stats: COMPLETE
+                          Statistics: Num rows: 3 Data size: 12 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: vectorized, llap
             LLAP IO: all inputs
             Map Vectorization:
@@ -10916,6 +10919,7 @@ STAGE PLANS:
                 TableScan
                   alias: a
                   filterExpr: (key > 5) (type: boolean)
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_29_container, bigKeyColName:key, smallTablePos:1, keyRatio:0.2727272727272727
                   Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                   TableScan Vectorization:
                       native: true
@@ -10931,15 +10935,15 @@ STAGE PLANS:
                       Select Vectorization:
                           className: VectorSelectOperator
                           native: true
-                      Statistics: Num rows: 6 Data size: 582 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 6 Data size: 558 Basic stats: COMPLETE Column stats: COMPLETE
                       Map Join Operator
                         condition map:
                              Left Semi Join 0 to 1
                         keys:
-                          0 _col0 (type: int), true (type: boolean)
-                          1 _col0 (type: int), _col1 (type: boolean)
+                          0 _col0 (type: int)
+                          1 _col0 (type: int)
                         Map Join Vectorization:
-                            bigTableKeyExpressions: col 0:int, ConstantVectorExpression(val 1) -> 3:boolean
+                            bigTableKeyExpressions: col 0:int
                             className: VectorMapJoinOperator
                             native: false
                             nativeConditionsMet: hive.mapjoin.optimized.hashtable IS true, hive.execution.engine tez IN [tez, spark] IS true, One MapJoin Condition IS true, No nullsafe IS true, Small table vectorizes IS true, Optimized Table and Supports Key Types IS true
@@ -10991,34 +10995,33 @@ STAGE PLANS:
                     predicate: ((key > 5) and (value <= 'val_20')) (type: boolean)
                     Statistics: Num rows: 2 Data size: 186 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: key (type: int), value is not null (type: boolean)
-                      outputColumnNames: _col0, _col1
+                      expressions: key (type: int)
+                      outputColumnNames: _col0
                       Select Vectorization:
                           className: VectorSelectOperator
                           native: true
-                          selectExpressions: IsNotNull(col 1:string) -> 3:boolean
-                      Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
                         Group By Vectorization:
                             className: VectorGroupByOperator
                             groupByMode: HASH
                             native: false
                             vectorProcessingMode: HASH
-                        keys: _col0 (type: int), _col1 (type: boolean)
+                        keys: _col0 (type: int)
                         minReductionHashAggr: 0.4
                         mode: hash
-                        outputColumnNames: _col0, _col1
-                        Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: boolean)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: boolean)
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
                           Reduce Sink Vectorization:
-                              className: VectorReduceSinkMultiKeyOperator
+                              className: VectorReduceSinkLongOperator
                               native: true
                               nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
-                          Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                          Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: vectorized, llap
             LLAP IO: all inputs
             Map Vectorization:
@@ -15088,6 +15091,7 @@ STAGE PLANS:
                 TableScan
                   alias: a
                   filterExpr: (key < 15) (type: boolean)
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_29_container, bigKeyColName:key, smallTablePos:1, keyRatio:1.0
                   Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                   TableScan Vectorization:
                       native: true
@@ -15103,16 +15107,15 @@ STAGE PLANS:
                       Select Vectorization:
                           className: VectorSelectOperator
                           native: true
-                      Statistics: Num rows: 11 Data size: 1067 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                       Map Join Operator
                         condition map:
                              Left Semi Join 0 to 1
                         keys:
-                          0 _col0 (type: int), true (type: boolean)
-                          1 _col0 (type: int), _col1 (type: boolean)
+                          0 _col0 (type: int)
+                          1 _col0 (type: int)
                         Map Join Vectorization:
-                            bigTableKeyExpressions: ConstantVectorExpression(val 1) -> 3:boolean
-                            className: VectorMapJoinLeftSemiMultiKeyOperator
+                            className: VectorMapJoinLeftSemiLongOperator
                             native: true
                             nativeConditionsMet: hive.mapjoin.optimized.hashtable IS true, hive.vectorized.execution.mapjoin.native.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, One MapJoin Condition IS true, No nullsafe IS true, Small table vectorizes IS true, Optimized Table and Supports Key Types IS true
                         outputColumnNames: _col1
@@ -15161,34 +15164,33 @@ STAGE PLANS:
                     predicate: (key < 15) (type: boolean)
                     Statistics: Num rows: 17 Data size: 68 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: key (type: int), key is not null (type: boolean)
-                      outputColumnNames: _col0, _col1
+                      expressions: key (type: int)
+                      outputColumnNames: _col0
                       Select Vectorization:
                           className: VectorSelectOperator
                           native: true
-                          selectExpressions: IsNotNull(col 0:int) -> 3:boolean
-                      Statistics: Num rows: 17 Data size: 136 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 17 Data size: 68 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
                         Group By Vectorization:
                             className: VectorGroupByOperator
                             groupByMode: HASH
                             native: false
                             vectorProcessingMode: HASH
-                        keys: _col0 (type: int), _col1 (type: boolean)
-                        minReductionHashAggr: 0.4
+                        keys: _col0 (type: int)
+                        minReductionHashAggr: 0.5294118
                         mode: hash
-                        outputColumnNames: _col0, _col1
-                        Statistics: Num rows: 8 Data size: 64 Basic stats: COMPLETE Column stats: COMPLETE
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 8 Data size: 32 Basic stats: COMPLETE Column stats: COMPLETE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: boolean)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: boolean)
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
                           Reduce Sink Vectorization:
-                              className: VectorReduceSinkMultiKeyOperator
+                              className: VectorReduceSinkLongOperator
                               native: true
                               nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
-                          Statistics: Num rows: 8 Data size: 64 Basic stats: COMPLETE Column stats: COMPLETE
+                          Statistics: Num rows: 8 Data size: 32 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: vectorized, llap
             LLAP IO: all inputs
             Map Vectorization:
@@ -15288,6 +15290,7 @@ STAGE PLANS:
                 TableScan
                   alias: a
                   filterExpr: key is not null (type: boolean)
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_29_container, bigKeyColName:key, smallTablePos:1, keyRatio:0.18181818181818182
                   Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                   TableScan Vectorization:
                       native: true
@@ -15303,16 +15306,15 @@ STAGE PLANS:
                       Select Vectorization:
                           className: VectorSelectOperator
                           native: true
-                      Statistics: Num rows: 11 Data size: 1067 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                       Map Join Operator
                         condition map:
                              Left Semi Join 0 to 1
                         keys:
-                          0 _col0 (type: int), true (type: boolean)
-                          1 _col0 (type: int), _col1 (type: boolean)
+                          0 _col0 (type: int)
+                          1 _col0 (type: int)
                         Map Join Vectorization:
-                            bigTableKeyExpressions: ConstantVectorExpression(val 1) -> 3:boolean
-                            className: VectorMapJoinLeftSemiMultiKeyOperator
+                            className: VectorMapJoinLeftSemiLongOperator
                             native: true
                             nativeConditionsMet: hive.mapjoin.optimized.hashtable IS true, hive.vectorized.execution.mapjoin.native.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, One MapJoin Condition IS true, No nullsafe IS true, Small table vectorizes IS true, Optimized Table and Supports Key Types IS true
                         outputColumnNames: _col0, _col1
@@ -15354,34 +15356,33 @@ STAGE PLANS:
                     predicate: ((value < 'val_10') and key is not null) (type: boolean)
                     Statistics: Num rows: 3 Data size: 279 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: key (type: int), value is not null (type: boolean)
-                      outputColumnNames: _col0, _col1
+                      expressions: key (type: int)
+                      outputColumnNames: _col0
                       Select Vectorization:
                           className: VectorSelectOperator
                           native: true
-                          selectExpressions: IsNotNull(col 1:string) -> 3:boolean
-                      Statistics: Num rows: 3 Data size: 24 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 3 Data size: 12 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
                         Group By Vectorization:
                             className: VectorGroupByOperator
                             groupByMode: HASH
                             native: false
                             vectorProcessingMode: HASH
-                        keys: _col0 (type: int), _col1 (type: boolean)
+                        keys: _col0 (type: int)
                         minReductionHashAggr: 0.4
                         mode: hash
-                        outputColumnNames: _col0, _col1
-                        Statistics: Num rows: 3 Data size: 24 Basic stats: COMPLETE Column stats: COMPLETE
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 3 Data size: 12 Basic stats: COMPLETE Column stats: COMPLETE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: boolean)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: boolean)
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
                           Reduce Sink Vectorization:
-                              className: VectorReduceSinkMultiKeyOperator
+                              className: VectorReduceSinkLongOperator
                               native: true
                               nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
-                          Statistics: Num rows: 3 Data size: 24 Basic stats: COMPLETE Column stats: COMPLETE
+                          Statistics: Num rows: 3 Data size: 12 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: vectorized, llap
             LLAP IO: all inputs
             Map Vectorization:
@@ -15664,6 +15665,7 @@ STAGE PLANS:
                 TableScan
                   alias: a
                   filterExpr: (key > 5) (type: boolean)
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_29_container, bigKeyColName:key, smallTablePos:1, keyRatio:0.2727272727272727
                   Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                   TableScan Vectorization:
                       native: true
@@ -15679,16 +15681,15 @@ STAGE PLANS:
                       Select Vectorization:
                           className: VectorSelectOperator
                           native: true
-                      Statistics: Num rows: 6 Data size: 582 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 6 Data size: 558 Basic stats: COMPLETE Column stats: COMPLETE
                       Map Join Operator
                         condition map:
                              Left Semi Join 0 to 1
                         keys:
-                          0 _col0 (type: int), true (type: boolean)
-                          1 _col0 (type: int), _col1 (type: boolean)
+                          0 _col0 (type: int)
+                          1 _col0 (type: int)
                         Map Join Vectorization:
-                            bigTableKeyExpressions: ConstantVectorExpression(val 1) -> 3:boolean
-                            className: VectorMapJoinLeftSemiMultiKeyOperator
+                            className: VectorMapJoinLeftSemiLongOperator
                             native: true
                             nativeConditionsMet: hive.mapjoin.optimized.hashtable IS true, hive.vectorized.execution.mapjoin.native.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, One MapJoin Condition IS true, No nullsafe IS true, Small table vectorizes IS true, Optimized Table and Supports Key Types IS true
                         outputColumnNames: _col1
@@ -15737,34 +15738,33 @@ STAGE PLANS:
                     predicate: ((key > 5) and (value <= 'val_20')) (type: boolean)
                     Statistics: Num rows: 2 Data size: 186 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: key (type: int), value is not null (type: boolean)
-                      outputColumnNames: _col0, _col1
+                      expressions: key (type: int)
+                      outputColumnNames: _col0
                       Select Vectorization:
                           className: VectorSelectOperator
                           native: true
-                          selectExpressions: IsNotNull(col 1:string) -> 3:boolean
-                      Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
                         Group By Vectorization:
                             className: VectorGroupByOperator
                             groupByMode: HASH
                             native: false
                             vectorProcessingMode: HASH
-                        keys: _col0 (type: int), _col1 (type: boolean)
+                        keys: _col0 (type: int)
                         minReductionHashAggr: 0.4
                         mode: hash
-                        outputColumnNames: _col0, _col1
-                        Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: boolean)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: boolean)
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
                           Reduce Sink Vectorization:
-                              className: VectorReduceSinkMultiKeyOperator
+                              className: VectorReduceSinkLongOperator
                               native: true
                               nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
-                          Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                          Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: vectorized, llap
             LLAP IO: all inputs
             Map Vectorization:
@@ -19774,6 +19774,7 @@ STAGE PLANS:
                 TableScan
                   alias: a
                   filterExpr: (key < 15) (type: boolean)
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_29_container, bigKeyColName:key, smallTablePos:1, keyRatio:1.0
                   Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                   TableScan Vectorization:
                       native: true
@@ -19789,16 +19790,15 @@ STAGE PLANS:
                       Select Vectorization:
                           className: VectorSelectOperator
                           native: true
-                      Statistics: Num rows: 11 Data size: 1067 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                       Map Join Operator
                         condition map:
                              Left Semi Join 0 to 1
                         keys:
-                          0 _col0 (type: int), true (type: boolean)
-                          1 _col0 (type: int), _col1 (type: boolean)
+                          0 _col0 (type: int)
+                          1 _col0 (type: int)
                         Map Join Vectorization:
-                            bigTableKeyExpressions: ConstantVectorExpression(val 1) -> 3:boolean
-                            className: VectorMapJoinLeftSemiMultiKeyOperator
+                            className: VectorMapJoinLeftSemiLongOperator
                             native: true
                             nativeConditionsMet: hive.mapjoin.optimized.hashtable IS true, hive.vectorized.execution.mapjoin.native.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, One MapJoin Condition IS true, No nullsafe IS true, Small table vectorizes IS true, Optimized Table and Supports Key Types IS true
                         outputColumnNames: _col1
@@ -19848,34 +19848,33 @@ STAGE PLANS:
                     predicate: (key < 15) (type: boolean)
                     Statistics: Num rows: 17 Data size: 68 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: key (type: int), key is not null (type: boolean)
-                      outputColumnNames: _col0, _col1
+                      expressions: key (type: int)
+                      outputColumnNames: _col0
                       Select Vectorization:
                           className: VectorSelectOperator
                           native: true
-                          selectExpressions: IsNotNull(col 0:int) -> 3:boolean
-                      Statistics: Num rows: 17 Data size: 136 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 17 Data size: 68 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
                         Group By Vectorization:
                             className: VectorGroupByOperator
                             groupByMode: HASH
                             native: false
                             vectorProcessingMode: HASH
-                        keys: _col0 (type: int), _col1 (type: boolean)
-                        minReductionHashAggr: 0.4
+                        keys: _col0 (type: int)
+                        minReductionHashAggr: 0.5294118
                         mode: hash
-                        outputColumnNames: _col0, _col1
-                        Statistics: Num rows: 8 Data size: 64 Basic stats: COMPLETE Column stats: COMPLETE
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 8 Data size: 32 Basic stats: COMPLETE Column stats: COMPLETE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: boolean)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: boolean)
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
                           Reduce Sink Vectorization:
-                              className: VectorReduceSinkMultiKeyOperator
+                              className: VectorReduceSinkLongOperator
                               native: true
                               nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
-                          Statistics: Num rows: 8 Data size: 64 Basic stats: COMPLETE Column stats: COMPLETE
+                          Statistics: Num rows: 8 Data size: 32 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: vectorized, llap
             LLAP IO: all inputs
             Map Vectorization:
@@ -19975,6 +19974,7 @@ STAGE PLANS:
                 TableScan
                   alias: a
                   filterExpr: key is not null (type: boolean)
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_29_container, bigKeyColName:key, smallTablePos:1, keyRatio:0.18181818181818182
                   Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                   TableScan Vectorization:
                       native: true
@@ -19990,16 +19990,15 @@ STAGE PLANS:
                       Select Vectorization:
                           className: VectorSelectOperator
                           native: true
-                      Statistics: Num rows: 11 Data size: 1067 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                       Map Join Operator
                         condition map:
                              Left Semi Join 0 to 1
                         keys:
-                          0 _col0 (type: int), true (type: boolean)
-                          1 _col0 (type: int), _col1 (type: boolean)
+                          0 _col0 (type: int)
+                          1 _col0 (type: int)
                         Map Join Vectorization:
-                            bigTableKeyExpressions: ConstantVectorExpression(val 1) -> 3:boolean
-                            className: VectorMapJoinLeftSemiMultiKeyOperator
+                            className: VectorMapJoinLeftSemiLongOperator
                             native: true
                             nativeConditionsMet: hive.mapjoin.optimized.hashtable IS true, hive.vectorized.execution.mapjoin.native.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, One MapJoin Condition IS true, No nullsafe IS true, Small table vectorizes IS true, Optimized Table and Supports Key Types IS true
                         outputColumnNames: _col0, _col1
@@ -20042,34 +20041,33 @@ STAGE PLANS:
                     predicate: ((value < 'val_10') and key is not null) (type: boolean)
                     Statistics: Num rows: 3 Data size: 279 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: key (type: int), value is not null (type: boolean)
-                      outputColumnNames: _col0, _col1
+                      expressions: key (type: int)
+                      outputColumnNames: _col0
                       Select Vectorization:
                           className: VectorSelectOperator
                           native: true
-                          selectExpressions: IsNotNull(col 1:string) -> 3:boolean
-                      Statistics: Num rows: 3 Data size: 24 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 3 Data size: 12 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
                         Group By Vectorization:
                             className: VectorGroupByOperator
                             groupByMode: HASH
                             native: false
                             vectorProcessingMode: HASH
-                        keys: _col0 (type: int), _col1 (type: boolean)
+                        keys: _col0 (type: int)
                         minReductionHashAggr: 0.4
                         mode: hash
-                        outputColumnNames: _col0, _col1
-                        Statistics: Num rows: 3 Data size: 24 Basic stats: COMPLETE Column stats: COMPLETE
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 3 Data size: 12 Basic stats: COMPLETE Column stats: COMPLETE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: boolean)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: boolean)
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
                           Reduce Sink Vectorization:
-                              className: VectorReduceSinkMultiKeyOperator
+                              className: VectorReduceSinkLongOperator
                               native: true
                               nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
-                          Statistics: Num rows: 3 Data size: 24 Basic stats: COMPLETE Column stats: COMPLETE
+                          Statistics: Num rows: 3 Data size: 12 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: vectorized, llap
             LLAP IO: all inputs
             Map Vectorization:
@@ -20353,6 +20351,7 @@ STAGE PLANS:
                 TableScan
                   alias: a
                   filterExpr: (key > 5) (type: boolean)
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_29_container, bigKeyColName:key, smallTablePos:1, keyRatio:0.2727272727272727
                   Statistics: Num rows: 11 Data size: 1023 Basic stats: COMPLETE Column stats: COMPLETE
                   TableScan Vectorization:
                       native: true
@@ -20368,16 +20367,15 @@ STAGE PLANS:
                       Select Vectorization:
                           className: VectorSelectOperator
                           native: true
-                      Statistics: Num rows: 6 Data size: 582 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 6 Data size: 558 Basic stats: COMPLETE Column stats: COMPLETE
                       Map Join Operator
                         condition map:
                              Left Semi Join 0 to 1
                         keys:
-                          0 _col0 (type: int), true (type: boolean)
-                          1 _col0 (type: int), _col1 (type: boolean)
+                          0 _col0 (type: int)
+                          1 _col0 (type: int)
                         Map Join Vectorization:
-                            bigTableKeyExpressions: ConstantVectorExpression(val 1) -> 3:boolean
-                            className: VectorMapJoinLeftSemiMultiKeyOperator
+                            className: VectorMapJoinLeftSemiLongOperator
                             native: true
                             nativeConditionsMet: hive.mapjoin.optimized.hashtable IS true, hive.vectorized.execution.mapjoin.native.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, One MapJoin Condition IS true, No nullsafe IS true, Small table vectorizes IS true, Optimized Table and Supports Key Types IS true
                         outputColumnNames: _col1
@@ -20427,34 +20425,33 @@ STAGE PLANS:
                     predicate: ((key > 5) and (value <= 'val_20')) (type: boolean)
                     Statistics: Num rows: 2 Data size: 186 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: key (type: int), value is not null (type: boolean)
-                      outputColumnNames: _col0, _col1
+                      expressions: key (type: int)
+                      outputColumnNames: _col0
                       Select Vectorization:
                           className: VectorSelectOperator
                           native: true
-                          selectExpressions: IsNotNull(col 1:string) -> 3:boolean
-                      Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
                         Group By Vectorization:
                             className: VectorGroupByOperator
                             groupByMode: HASH
                             native: false
                             vectorProcessingMode: HASH
-                        keys: _col0 (type: int), _col1 (type: boolean)
+                        keys: _col0 (type: int)
                         minReductionHashAggr: 0.4
                         mode: hash
-                        outputColumnNames: _col0, _col1
-                        Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: boolean)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: boolean)
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
                           Reduce Sink Vectorization:
-                              className: VectorReduceSinkMultiKeyOperator
+                              className: VectorReduceSinkLongOperator
                               native: true
                               nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
-                          Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                          Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: vectorized, llap
             LLAP IO: all inputs
             Map Vectorization:
diff --git a/ql/src/test/results/clientpositive/llap/vector_mapjoin_complex_values.q.out b/ql/src/test/results/clientpositive/llap/vector_mapjoin_complex_values.q.out
index fb2a128554..0a6904024d 100644
--- a/ql/src/test/results/clientpositive/llap/vector_mapjoin_complex_values.q.out
+++ b/ql/src/test/results/clientpositive/llap/vector_mapjoin_complex_values.q.out
@@ -62,6 +62,7 @@ POSTHOOK: Lineage: census_clus.email SIMPLE [(census)census.FieldSchema(name:ema
 POSTHOOK: Lineage: census_clus.name SIMPLE [(census)census.FieldSchema(name:name, type:string, comment:null), ]
 POSTHOOK: Lineage: census_clus.ssn SIMPLE [(census)census.FieldSchema(name:ssn, type:int, comment:null), ]
 census.ssn	census.name	census.city	census.email
+Warning: Map Join MAPJOIN[23][bigTable=?] in task 'Map 1' is a cross product
 PREHOOK: query: EXPLAIN VECTORIZATION DETAIL
 UPDATE census_clus SET name = 'updated name' where ssn=100 and   EXISTS (select distinct ssn from census where ssn=census_clus.ssn)
 PREHOOK: type: QUERY
@@ -123,10 +124,9 @@ STAGE PLANS:
                         condition map:
                              Left Semi Join 0 to 1
                         keys:
-                          0 100 (type: int)
-                          1 _col0 (type: int)
+                          0 
+                          1 
                         Map Join Vectorization:
-                            bigTableKeyExpressions: ConstantVectorExpression(val 100) -> 5:int
                             bigTableValueExpressions: col 2:string, col 3:string, col 4:struct<writeid:bigint,bucketid:int,rowid:bigint>
                             className: VectorMapJoinOperator
                             native: false
@@ -175,7 +175,7 @@ STAGE PLANS:
                     dataColumns: ssn:int, name:string, city:string, email:string
                     neededVirtualColumns: [ROWID]
                     partitionColumnCount: 0
-                    scratchColumnTypeNames: [bigint]
+                    scratchColumnTypeNames: []
         Map 3 
             Map Operator Tree:
                 TableScan
@@ -305,38 +305,19 @@ STAGE PLANS:
                 outputColumnNames: _col0
                 Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: COMPLETE
                 Select Operator
-                  expressions: 100 (type: int)
-                  outputColumnNames: _col0
                   Select Vectorization:
                       className: VectorSelectOperator
                       native: true
-                      projectedOutputColumnNums: [1]
-                      selectExpressions: ConstantVectorExpression(val 100) -> 1:int
+                      projectedOutputColumnNums: []
                   Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: COMPLETE
-                  Group By Operator
-                    Group By Vectorization:
-                        className: VectorGroupByOperator
-                        groupByMode: HASH
-                        keyExpressions: col 1:int
-                        native: false
-                        vectorProcessingMode: HASH
-                        projectedOutputColumnNums: []
-                    keys: _col0 (type: int)
-                    minReductionHashAggr: 0.4
-                    mode: hash
-                    outputColumnNames: _col0
+                  Reduce Output Operator
+                    null sort order: 
+                    sort order: 
+                    Reduce Sink Vectorization:
+                        className: VectorReduceSinkEmptyKeyOperator
+                        native: true
+                        nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
                     Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: COMPLETE
-                    Reduce Output Operator
-                      key expressions: _col0 (type: int)
-                      null sort order: z
-                      sort order: +
-                      Map-reduce partition columns: _col0 (type: int)
-                      Reduce Sink Vectorization:
-                          className: VectorReduceSinkLongOperator
-                          keyColumns: 0:int
-                          native: true
-                          nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
-                      Statistics: Num rows: 1 Data size: 4 Basic stats: COMPLETE Column stats: COMPLETE
 
   Stage: Stage-2
     Dependency Collection
@@ -356,6 +337,7 @@ STAGE PLANS:
     Stats Work
       Basic Stats Work:
 
+Warning: Map Join MAPJOIN[23][bigTable=?] in task 'Map 1' is a cross product
 PREHOOK: query: UPDATE census_clus SET name = 'updated name' where ssn=100 and   EXISTS (select distinct ssn from census where ssn=census_clus.ssn)
 PREHOOK: type: QUERY
 PREHOOK: Input: default@census
diff --git a/ql/src/test/results/clientpositive/llap/vector_mapjoin_reduce.q.out b/ql/src/test/results/clientpositive/llap/vector_mapjoin_reduce.q.out
index 71ac980247..b8f7397ff7 100644
--- a/ql/src/test/results/clientpositive/llap/vector_mapjoin_reduce.q.out
+++ b/ql/src/test/results/clientpositive/llap/vector_mapjoin_reduce.q.out
@@ -36,7 +36,7 @@ STAGE PLANS:
                 TableScan
                   alias: li
                   filterExpr: ((l_linenumber = 1) and l_partkey is not null and l_orderkey is not null) (type: boolean)
-                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_49_container, bigKeyColName:l_partkey, smallTablePos:1, keyRatio:0.14
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_50_container, bigKeyColName:l_partkey, smallTablePos:1, keyRatio:0.14
                   Statistics: Num rows: 100 Data size: 1600 Basic stats: COMPLETE Column stats: COMPLETE
                   TableScan Vectorization:
                       native: true
@@ -54,7 +54,7 @@ STAGE PLANS:
                           className: VectorSelectOperator
                           native: true
                           projectedOutputColumnNums: [0, 1, 2]
-                      Statistics: Num rows: 14 Data size: 168 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 14 Data size: 224 Basic stats: COMPLETE Column stats: COMPLETE
                       Map Join Operator
                         condition map:
                              Left Semi Join 0 to 1
@@ -68,41 +68,49 @@ STAGE PLANS:
                             hashTableImplementationType: OPTIMIZED
                         outputColumnNames: _col0, _col1, _col2
                         input vertices:
-                          1 Reducer 3
+                          1 Map 2
                         Statistics: Num rows: 14 Data size: 168 Basic stats: COMPLETE Column stats: COMPLETE
-                        Map Join Operator
-                          condition map:
-                               Left Semi Join 0 to 1
-                          keys:
-                            0 _col0 (type: int)
-                            1 _col0 (type: int)
-                          Map Join Vectorization:
-                              className: VectorMapJoinLeftSemiLongOperator
+                        Select Operator
+                          expressions: _col1 (type: int), _col0 (type: int), _col2 (type: int)
+                          outputColumnNames: _col0, _col1, _col3
+                          Select Vectorization:
+                              className: VectorSelectOperator
                               native: true
-                              nativeConditionsMet: hive.mapjoin.optimized.hashtable IS true, hive.vectorized.execution.mapjoin.native.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, One MapJoin Condition IS true, No nullsafe IS true, Small table vectorizes IS true, Optimized Table and Supports Key Types IS true
-                              hashTableImplementationType: OPTIMIZED
-                          outputColumnNames: _col1, _col2
-                          input vertices:
-                            1 Map 2
-                          Statistics: Num rows: 14 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
-                          Select Operator
-                            expressions: _col1 (type: int), _col2 (type: int)
-                            outputColumnNames: _col0, _col1
-                            Select Vectorization:
-                                className: VectorSelectOperator
+                              projectedOutputColumnNums: [1, 0, 2]
+                          Statistics: Num rows: 14 Data size: 224 Basic stats: COMPLETE Column stats: COMPLETE
+                          Map Join Operator
+                            condition map:
+                                 Left Semi Join 0 to 1
+                            keys:
+                              0 _col1 (type: int)
+                              1 _col0 (type: int)
+                            Map Join Vectorization:
+                                className: VectorMapJoinLeftSemiLongOperator
                                 native: true
-                                projectedOutputColumnNums: [1, 2]
+                                nativeConditionsMet: hive.mapjoin.optimized.hashtable IS true, hive.vectorized.execution.mapjoin.native.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, One MapJoin Condition IS true, No nullsafe IS true, Small table vectorizes IS true, Optimized Table and Supports Key Types IS true
+                                hashTableImplementationType: OPTIMIZED
+                            outputColumnNames: _col0, _col3
+                            input vertices:
+                              1 Reducer 3
                             Statistics: Num rows: 14 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
-                            File Output Operator
-                              compressed: false
-                              File Sink Vectorization:
-                                  className: VectorFileSinkOperator
-                                  native: false
+                            Select Operator
+                              expressions: _col0 (type: int), _col3 (type: int)
+                              outputColumnNames: _col0, _col1
+                              Select Vectorization:
+                                  className: VectorSelectOperator
+                                  native: true
+                                  projectedOutputColumnNums: [1, 2]
                               Statistics: Num rows: 14 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
-                              table:
-                                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
-                                  output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
-                                  serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                              File Output Operator
+                                compressed: false
+                                File Sink Vectorization:
+                                    className: VectorFileSinkOperator
+                                    native: false
+                                Statistics: Num rows: 14 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
+                                table:
+                                    input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                                    output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+                                    serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
             Execution mode: vectorized, llap
             LLAP IO: all inputs
             Map Vectorization:
@@ -234,7 +242,7 @@ STAGE PLANS:
                       className: VectorReduceSinkLongOperator
                       native: true
                       nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
-                  Statistics: Num rows: 100 Data size: 400 Basic stats: COMPLETE Column stats: COMPLETE
+                  Statistics: Num rows: 14 Data size: 56 Basic stats: COMPLETE Column stats: COMPLETE
 
   Stage: Stage-0
     Fetch Operator
@@ -304,7 +312,7 @@ STAGE PLANS:
                 TableScan
                   alias: li
                   filterExpr: ((l_linenumber = 1) and l_partkey is not null and l_orderkey is not null) (type: boolean)
-                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_50_container, bigKeyColName:l_partkey, smallTablePos:1, keyRatio:0.14
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_51_container, bigKeyColName:l_orderkey, smallTablePos:1, keyRatio:0.02
                   Statistics: Num rows: 100 Data size: 1600 Basic stats: COMPLETE Column stats: COMPLETE
                   TableScan Vectorization:
                       native: true
@@ -316,13 +324,12 @@ STAGE PLANS:
                     predicate: ((l_linenumber = 1) and l_partkey is not null and l_orderkey is not null) (type: boolean)
                     Statistics: Num rows: 14 Data size: 224 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: l_orderkey (type: int), l_partkey (type: int), l_suppkey (type: int), 1 (type: int)
-                      outputColumnNames: _col0, _col1, _col2, _col3
+                      expressions: l_orderkey (type: int), l_partkey (type: int), l_suppkey (type: int)
+                      outputColumnNames: _col0, _col1, _col2
                       Select Vectorization:
                           className: VectorSelectOperator
                           native: true
-                          projectedOutputColumnNums: [0, 1, 2, 17]
-                          selectExpressions: ConstantVectorExpression(val 1) -> 17:int
+                          projectedOutputColumnNums: [0, 1, 2]
                       Statistics: Num rows: 14 Data size: 224 Basic stats: COMPLETE Column stats: COMPLETE
                       Map Join Operator
                         condition map:
@@ -331,31 +338,30 @@ STAGE PLANS:
                           0 _col1 (type: int)
                           1 _col0 (type: int)
                         Map Join Vectorization:
-                            bigTableValueExpressions: ConstantVectorExpression(val 1) -> 18:int
                             className: VectorMapJoinLeftSemiLongOperator
                             native: true
                             nativeConditionsMet: hive.mapjoin.optimized.hashtable IS true, hive.vectorized.execution.mapjoin.native.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, One MapJoin Condition IS true, No nullsafe IS true, Small table vectorizes IS true, Optimized Table and Supports Key Types IS true
                             hashTableImplementationType: OPTIMIZED
-                        outputColumnNames: _col0, _col1, _col2, _col3
+                        outputColumnNames: _col0, _col1, _col2
                         input vertices:
                           1 Map 2
-                        Statistics: Num rows: 14 Data size: 224 Basic stats: COMPLETE Column stats: COMPLETE
+                        Statistics: Num rows: 14 Data size: 168 Basic stats: COMPLETE Column stats: COMPLETE
                         Select Operator
-                          expressions: _col1 (type: int), _col0 (type: int), _col2 (type: int), _col3 (type: int)
-                          outputColumnNames: _col0, _col1, _col3, _col4
+                          expressions: _col1 (type: int), _col0 (type: int), _col2 (type: int)
+                          outputColumnNames: _col0, _col1, _col3
                           Select Vectorization:
                               className: VectorSelectOperator
                               native: true
-                              projectedOutputColumnNums: [1, 0, 2, 18]
+                              projectedOutputColumnNums: [1, 0, 2]
                           Statistics: Num rows: 14 Data size: 224 Basic stats: COMPLETE Column stats: COMPLETE
                           Map Join Operator
                             condition map:
                                  Left Semi Join 0 to 1
                             keys:
-                              0 _col1 (type: int), _col4 (type: int)
-                              1 _col0 (type: int), _col1 (type: int)
+                              0 _col1 (type: int)
+                              1 _col0 (type: int)
                             Map Join Vectorization:
-                                className: VectorMapJoinLeftSemiMultiKeyOperator
+                                className: VectorMapJoinLeftSemiLongOperator
                                 native: true
                                 nativeConditionsMet: hive.mapjoin.optimized.hashtable IS true, hive.vectorized.execution.mapjoin.native.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, One MapJoin Condition IS true, No nullsafe IS true, Small table vectorizes IS true, Optimized Table and Supports Key Types IS true
                                 hashTableImplementationType: OPTIMIZED
@@ -408,37 +414,36 @@ STAGE PLANS:
                     predicate: ((l_linenumber = 1) and (l_shipmode = 'AIR') and l_orderkey is not null) (type: boolean)
                     Statistics: Num rows: 2 Data size: 192 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: l_orderkey (type: int), 1 (type: int)
-                      outputColumnNames: _col0, _col1
+                      expressions: l_orderkey (type: int)
+                      outputColumnNames: _col0
                       Select Vectorization:
                           className: VectorSelectOperator
                           native: true
-                          projectedOutputColumnNums: [0, 17]
-                          selectExpressions: ConstantVectorExpression(val 1) -> 17:int
-                      Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                          projectedOutputColumnNums: [0]
+                      Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
                         Group By Vectorization:
                             className: VectorGroupByOperator
                             groupByMode: HASH
-                            keyExpressions: col 0:int, col 17:int
+                            keyExpressions: col 0:int
                             native: false
                             vectorProcessingMode: HASH
                             projectedOutputColumnNums: []
-                        keys: _col0 (type: int), _col1 (type: int)
+                        keys: _col0 (type: int)
                         minReductionHashAggr: 0.4
                         mode: hash
-                        outputColumnNames: _col0, _col1
-                        Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: int)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: int)
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
                           Reduce Sink Vectorization:
-                              className: VectorReduceSinkMultiKeyOperator
+                              className: VectorReduceSinkLongOperator
                               native: true
                               nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
-                          Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                          Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
                   Filter Operator
                     Filter Vectorization:
                         className: VectorFilterOperator
@@ -498,22 +503,22 @@ STAGE PLANS:
                 vectorized: true
             Reduce Operator Tree:
               Select Operator
-                expressions: KEY.reducesinkkey0 (type: int), KEY.reducesinkkey1 (type: int)
-                outputColumnNames: _col0, _col1
+                expressions: KEY.reducesinkkey0 (type: int)
+                outputColumnNames: _col0
                 Select Vectorization:
                     className: VectorSelectOperator
                     native: true
-                    projectedOutputColumnNums: [0, 1]
+                    projectedOutputColumnNums: [0]
                 Reduce Output Operator
-                  key expressions: _col0 (type: int), _col1 (type: int)
-                  null sort order: zz
-                  sort order: ++
-                  Map-reduce partition columns: _col0 (type: int), _col1 (type: int)
+                  key expressions: _col0 (type: int)
+                  null sort order: z
+                  sort order: +
+                  Map-reduce partition columns: _col0 (type: int)
                   Reduce Sink Vectorization:
-                      className: VectorReduceSinkMultiKeyOperator
+                      className: VectorReduceSinkLongOperator
                       native: true
                       nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
-                  Statistics: Num rows: 2 Data size: 16 Basic stats: COMPLETE Column stats: COMPLETE
+                  Statistics: Num rows: 2 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
 
   Stage: Stage-0
     Fetch Operator
diff --git a/ql/src/test/results/clientpositive/llap/vector_orc_nested_column_pruning.q.out b/ql/src/test/results/clientpositive/llap/vector_orc_nested_column_pruning.q.out
index 98539d2d57..d4530b4aaf 100644
--- a/ql/src/test/results/clientpositive/llap/vector_orc_nested_column_pruning.q.out
+++ b/ql/src/test/results/clientpositive/llap/vector_orc_nested_column_pruning.q.out
@@ -1798,13 +1798,12 @@ STAGE PLANS:
                           selectExpressions: VectorUDFStructField(col 10:struct<f4:int,f5:double>, col 0:int)(children: VectorUDFStructField(col 1:struct<f1:boolean,f2:string,f3:struct<f4:int,f5:double>,f6:int>, col 2:int) -> 10:struct<f4:int,f5:double>) -> 11:int
                       Statistics: Num rows: 1 Data size: 316 Basic stats: COMPLETE Column stats: NONE
                       Reduce Output Operator
-                        key expressions: _col1 (type: int), true (type: boolean)
-                        null sort order: zz
-                        sort order: ++
-                        Map-reduce partition columns: _col1 (type: int), true (type: boolean)
+                        key expressions: _col1 (type: int)
+                        null sort order: z
+                        sort order: +
+                        Map-reduce partition columns: _col1 (type: int)
                         Reduce Sink Vectorization:
-                            className: VectorReduceSinkMultiKeyOperator
-                            keyExpressions: ConstantVectorExpression(val 1) -> 9:boolean
+                            className: VectorReduceSinkLongOperator
                             native: true
                             nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
                         Statistics: Num rows: 1 Data size: 316 Basic stats: COMPLETE Column stats: NONE
@@ -1824,61 +1823,36 @@ STAGE PLANS:
             Map Operator Tree:
                 TableScan
                   alias: t2
-                  filterExpr: (s1.f6 is not null and s2.f8.f9 is not null and s2.f8.f9) (type: boolean)
+                  filterExpr: (s1.f6 is not null and s2.f8.f9) (type: boolean)
                   Pruned Column Paths: s1.f6, s2.f8.f9
                   Statistics: Num rows: 1 Data size: 1468 Basic stats: COMPLETE Column stats: NONE
-                  TableScan Vectorization:
-                      native: true
                   Filter Operator
-                    Filter Vectorization:
-                        className: VectorFilterOperator
-                        native: true
-                        predicateExpression: SelectColumnIsTrue(col 15:boolean)(children: VectorUDFAdaptor((s1.f6 is not null and s2.f8.f9 is not null and s2.f8.f9))(children: IsNotNull(col 8:int)(children: VectorUDFStructField(col 1:struct<f1:boolean,f2:string,f3:struct<f4:int,f5:double>,f6:int>, col 3:int) -> 8:int) -> 9:boolean, IsNotNull(col 11:boolean)(children: VectorUDFStructField(col 10:struct<f9:boolean,f10:array<int>,f11:map<string,boolean>>, col 0:int)(children: VectorUDFStructField(col 2:struct<f7:string,f8:struct<f9:boolean,f10:array<int>,f11:map<string,boolean>>>, col 1:int) -> 10:struct<f9:boolean,f10:array<int>,f11:map<string,boolean>>) -> 11:boolean) -> 12:boolean, VectorUDFStructField(col 13:struct<f9:boolean,f10:array<int>,f11:map<string,boolean>>, col 0:int)(children: VectorUDFStructField(col 2:struct<f7:string,f8:struct<f9:boolean,f10:array<int>,f11:map<string,boolean>>>, col 1:int) -> 13:struct<f9:boolean,f10:array<int>,f11:map<string,boolean>>) -> 14:boolean) -> 15:boolean)
-                    predicate: (s1.f6 is not null and s2.f8.f9 is not null and s2.f8.f9) (type: boolean)
+                    predicate: (s1.f6 is not null and s2.f8.f9) (type: boolean)
                     Statistics: Num rows: 1 Data size: 1468 Basic stats: COMPLETE Column stats: NONE
                     Select Operator
-                      expressions: s1.f6 (type: int), s2.f8.f9 (type: boolean)
-                      outputColumnNames: _col0, _col1
-                      Select Vectorization:
-                          className: VectorSelectOperator
-                          native: true
-                          projectedOutputColumnNums: [16, 18]
-                          selectExpressions: VectorUDFStructField(col 1:struct<f1:boolean,f2:string,f3:struct<f4:int,f5:double>,f6:int>, col 3:int) -> 16:int, VectorUDFStructField(col 17:struct<f9:boolean,f10:array<int>,f11:map<string,boolean>>, col 0:int)(children: VectorUDFStructField(col 2:struct<f7:string,f8:struct<f9:boolean,f10:array<int>,f11:map<string,boolean>>>, col 1:int) -> 17:struct<f9:boolean,f10:array<int>,f11:map<string,boolean>>) -> 18:boolean
+                      expressions: s1.f6 (type: int)
+                      outputColumnNames: _col0
                       Statistics: Num rows: 1 Data size: 1468 Basic stats: COMPLETE Column stats: NONE
                       Group By Operator
-                        Group By Vectorization:
-                            className: VectorGroupByOperator
-                            groupByMode: HASH
-                            keyExpressions: col 16:int, col 18:boolean
-                            native: false
-                            vectorProcessingMode: HASH
-                            projectedOutputColumnNums: []
-                        keys: _col0 (type: int), _col1 (type: boolean)
+                        keys: _col0 (type: int)
                         minReductionHashAggr: 0.99
                         mode: hash
-                        outputColumnNames: _col0, _col1
+                        outputColumnNames: _col0
                         Statistics: Num rows: 1 Data size: 1468 Basic stats: COMPLETE Column stats: NONE
                         Reduce Output Operator
-                          key expressions: _col0 (type: int), _col1 (type: boolean)
-                          null sort order: zz
-                          sort order: ++
-                          Map-reduce partition columns: _col0 (type: int), _col1 (type: boolean)
-                          Reduce Sink Vectorization:
-                              className: VectorReduceSinkMultiKeyOperator
-                              native: true
-                              nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
                           Statistics: Num rows: 1 Data size: 1468 Basic stats: COMPLETE Column stats: NONE
-            Execution mode: vectorized, llap
+            Execution mode: llap
             LLAP IO: all inputs
             Map Vectorization:
                 enabled: true
                 enabledConditionsMet: hive.vectorized.use.vectorized.input.format IS true
-                inputFormatFeatureSupport: [DECIMAL_64]
-                featureSupportInUse: [DECIMAL_64]
                 inputFileFormats: org.apache.hadoop.hive.ql.io.orc.OrcInputFormat
-                allNative: false
-                usesVectorUDFAdaptor: true
-                vectorized: true
+                notVectorizedReason: FILTER operator: Could not vectorize expression (mode = FILTER): Column[s2].f8.f9
+                vectorized: false
         Reducer 2 
             Execution mode: llap
             Reduce Operator Tree:
@@ -1886,8 +1860,8 @@ STAGE PLANS:
                 condition map:
                      Left Semi Join 0 to 1
                 keys:
-                  0 _col1 (type: int), true (type: boolean)
-                  1 _col0 (type: int), _col1 (type: boolean)
+                  0 _col1 (type: int)
+                  1 _col0 (type: int)
                 outputColumnNames: _col0
                 Statistics: Num rows: 1 Data size: 347 Basic stats: COMPLETE Column stats: NONE
                 Select Operator
diff --git a/ql/src/test/results/clientpositive/llap/vectorized_mapjoin3.q.out b/ql/src/test/results/clientpositive/llap/vectorized_mapjoin3.q.out
index 63f7eb9eab..9cd749208e 100644
--- a/ql/src/test/results/clientpositive/llap/vectorized_mapjoin3.q.out
+++ b/ql/src/test/results/clientpositive/llap/vectorized_mapjoin3.q.out
@@ -410,7 +410,7 @@ STAGE PLANS:
                 TableScan
                   alias: t1
                   filterExpr: (int_col_1 is not null and decimal0801_col is not null) (type: boolean)
-                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_25_container, bigKeyColName:int_col_1, smallTablePos:1, keyRatio:1.0
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_27_container, bigKeyColName:int_col_1, smallTablePos:1, keyRatio:1.0
                   Statistics: Num rows: 5 Data size: 580 Basic stats: COMPLETE Column stats: NONE
                   TableScan Vectorization:
                       native: true
@@ -432,7 +432,7 @@ STAGE PLANS:
                       Statistics: Num rows: 5 Data size: 580 Basic stats: COMPLETE Column stats: NONE
                       Map Join Operator
                         condition map:
-                             Inner Join 0 to 1
+                             Left Semi Join 0 to 1
                         keys:
                           0 _col1 (type: int)
                           1 _col0 (type: int)
@@ -440,7 +440,7 @@ STAGE PLANS:
                             bigTableKeyColumns: 1:int
                             bigTableRetainColumnNums: [0]
                             bigTableValueColumns: 0:decimal(8,1)
-                            className: VectorMapJoinInnerBigOnlyLongOperator
+                            className: VectorMapJoinLeftSemiLongOperator
                             native: true
                             nativeConditionsMet: hive.mapjoin.optimized.hashtable IS true, hive.vectorized.execution.mapjoin.native.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, One MapJoin Condition IS true, No nullsafe IS true, Small table vectorizes IS true, Optimized Table and Supports Key Types IS true
                             nonOuterSmallTableKeyMapping: []
@@ -568,17 +568,30 @@ STAGE PLANS:
                       predicateExpression: SelectColumnIsNotNull(col 0:int)
                   predicate: _col0 is not null (type: boolean)
                   Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE
-                  Reduce Output Operator
-                    key expressions: _col0 (type: int)
-                    null sort order: z
-                    sort order: +
-                    Map-reduce partition columns: _col0 (type: int)
-                    Reduce Sink Vectorization:
-                        className: VectorReduceSinkLongOperator
-                        keyColumns: 0:int
-                        native: true
-                        nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
+                  Group By Operator
+                    Group By Vectorization:
+                        className: VectorGroupByOperator
+                        groupByMode: HASH
+                        keyExpressions: col 0:int
+                        native: false
+                        vectorProcessingMode: HASH
+                        projectedOutputColumnNums: []
+                    keys: _col0 (type: int)
+                    minReductionHashAggr: 0.99
+                    mode: hash
+                    outputColumnNames: _col0
                     Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE
+                    Reduce Output Operator
+                      key expressions: _col0 (type: int)
+                      null sort order: z
+                      sort order: +
+                      Map-reduce partition columns: _col0 (type: int)
+                      Reduce Sink Vectorization:
+                          className: VectorReduceSinkLongOperator
+                          keyColumns: 0:int
+                          native: true
+                          nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true
+                      Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: NONE
 
   Stage: Stage-0
     Fetch Operator
diff --git a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query23.q.out b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query23.q.out
index 7594a54a54..da08715a6e 100644
--- a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query23.q.out
+++ b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query23.q.out
@@ -1,102 +1,98 @@
-Warning: Map Join MAPJOIN[318][bigTable=?] in task 'Reducer 5' is a cross product
+Warning: Map Join MAPJOIN[318][bigTable=?] in task 'Reducer 7' is a cross product
 CBO PLAN:
 HiveAggregate(group=[{}], agg#0=[sum($0)])
   HiveProject(sales=[$0])
     HiveUnion(all=[true])
-      HiveProject($f0=[*(CAST($1):DECIMAL(10, 0), $2)])
-        HiveSemiJoin(condition=[=($0, $3)], joinType=[semi])
-          HiveProject(cs_item_sk=[$1], cs_quantity=[$2], cs_list_price=[$3])
-            HiveSemiJoin(condition=[=($0, $4)], joinType=[semi])
-              HiveProject(cs_bill_customer_sk=[$0], cs_item_sk=[$1], cs_quantity=[$2], cs_list_price=[$3])
-                HiveJoin(condition=[=($4, $5)], joinType=[inner], algorithm=[none], cost=[not available])
-                  HiveProject(cs_bill_customer_sk=[$2], cs_item_sk=[$14], cs_quantity=[$17], cs_list_price=[$19], cs_sold_date_sk=[$33])
-                    HiveFilter(condition=[AND(IS NOT NULL($2), IS NOT NULL($33))])
-                      HiveTableScan(table=[[default, catalog_sales]], table:alias=[catalog_sales])
-                  HiveProject(d_date_sk=[$0])
-                    HiveFilter(condition=[AND(=($6, 1999), =($8, 1))])
-                      HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-              HiveProject(ss_customer_sk=[$0])
-                HiveJoin(condition=[>($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
-                  HiveProject(ss_customer_sk=[$0], $f1=[$1])
-                    HiveFilter(condition=[IS NOT NULL($1)])
-                      HiveAggregate(group=[{0}], agg#0=[sum($1)])
-                        HiveProject(ss_customer_sk=[CAST($2):BIGINT NOT NULL], *=[*(CAST($9):DECIMAL(10, 0), $12)])
-                          HiveFilter(condition=[IS NOT NULL($2)])
-                            HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
-                  HiveProject(*=[*(0.95:DECIMAL(8, 6), $0)])
-                    HiveFilter(condition=[IS NOT NULL($0)])
-                      HiveProject($f0=[$0])
-                        HiveAggregate(group=[{}], agg#0=[max($1)])
-                          HiveProject(ss_customer_sk=[$0], $f1=[$1])
-                            HiveAggregate(group=[{1}], agg#0=[sum($2)])
-                              HiveJoin(condition=[=($0, $3)], joinType=[inner], algorithm=[none], cost=[not available])
-                                HiveProject(ss_sold_date_sk=[$22], ss_customer_sk=[CAST($2):BIGINT NOT NULL], *=[*(CAST($9):DECIMAL(10, 0), $12)])
-                                  HiveFilter(condition=[AND(IS NOT NULL($2), IS NOT NULL($22))])
-                                    HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
-                                HiveProject(d_date_sk=[$0])
-                                  HiveFilter(condition=[IN($6, 1999, 2000, 2001, 2002)])
-                                    HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-          HiveProject($f1=[$0])
-            HiveFilter(condition=[>($2, 4)])
-              HiveProject(i_item_sk=[$3], d_date=[$1], $f2=[$2])
-                HiveJoin(condition=[=($0, $3)], joinType=[inner], algorithm=[none], cost=[not available])
-                  HiveProject(ss_item_sk=[$0], d_date=[$1], $f2=[$2])
-                    HiveAggregate(group=[{0, 3}], agg#0=[count()])
-                      HiveJoin(condition=[=($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
-                        HiveProject(ss_item_sk=[$1], ss_sold_date_sk=[$22])
-                          HiveFilter(condition=[IS NOT NULL($22)])
-                            HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
-                        HiveProject(d_date_sk=[$0], d_date=[$2])
-                          HiveFilter(condition=[IN($6, 1999, 2000, 2001, 2002)])
-                            HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                  HiveProject(i_item_sk=[$0])
-                    HiveTableScan(table=[[default, item]], table:alias=[item])
-      HiveProject($f0=[*(CAST($1):DECIMAL(10, 0), $2)])
-        HiveSemiJoin(condition=[=($0, $3)], joinType=[semi])
-          HiveProject(ws_item_sk=[$0], ws_quantity=[$2], ws_list_price=[$3])
-            HiveSemiJoin(condition=[=($1, $4)], joinType=[semi])
-              HiveProject(ws_item_sk=[$0], ws_bill_customer_sk=[$1], ws_quantity=[$2], ws_list_price=[$3])
-                HiveJoin(condition=[=($4, $5)], joinType=[inner], algorithm=[none], cost=[not available])
-                  HiveProject(ws_item_sk=[$2], ws_bill_customer_sk=[$3], ws_quantity=[$17], ws_list_price=[$19], ws_sold_date_sk=[$33])
-                    HiveFilter(condition=[AND(IS NOT NULL($3), IS NOT NULL($33))])
-                      HiveTableScan(table=[[default, web_sales]], table:alias=[web_sales])
-                  HiveProject(d_date_sk=[$0])
-                    HiveFilter(condition=[AND(=($6, 1999), =($8, 1))])
-                      HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-              HiveProject(ss_customer_sk=[$0])
-                HiveJoin(condition=[>($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
-                  HiveProject(ss_customer_sk=[$0], $f1=[$1])
-                    HiveFilter(condition=[IS NOT NULL($1)])
-                      HiveAggregate(group=[{0}], agg#0=[sum($1)])
-                        HiveProject(ss_customer_sk=[CAST($2):BIGINT NOT NULL], *=[*(CAST($9):DECIMAL(10, 0), $12)])
-                          HiveFilter(condition=[IS NOT NULL($2)])
-                            HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
-                  HiveProject(*=[*(0.95:DECIMAL(8, 6), $0)])
-                    HiveFilter(condition=[IS NOT NULL($0)])
-                      HiveProject($f0=[$0])
-                        HiveAggregate(group=[{}], agg#0=[max($1)])
-                          HiveProject(ss_customer_sk=[$0], $f1=[$1])
-                            HiveAggregate(group=[{1}], agg#0=[sum($2)])
-                              HiveJoin(condition=[=($0, $3)], joinType=[inner], algorithm=[none], cost=[not available])
-                                HiveProject(ss_sold_date_sk=[$22], ss_customer_sk=[CAST($2):BIGINT NOT NULL], *=[*(CAST($9):DECIMAL(10, 0), $12)])
-                                  HiveFilter(condition=[AND(IS NOT NULL($2), IS NOT NULL($22))])
-                                    HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
-                                HiveProject(d_date_sk=[$0])
-                                  HiveFilter(condition=[IN($6, 1999, 2000, 2001, 2002)])
-                                    HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-          HiveProject($f1=[$0])
-            HiveFilter(condition=[>($2, 4)])
-              HiveProject(i_item_sk=[$3], d_date=[$1], $f2=[$2])
-                HiveJoin(condition=[=($0, $3)], joinType=[inner], algorithm=[none], cost=[not available])
-                  HiveProject(ss_item_sk=[$0], d_date=[$1], $f2=[$2])
-                    HiveAggregate(group=[{0, 3}], agg#0=[count()])
-                      HiveJoin(condition=[=($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
-                        HiveProject(ss_item_sk=[$1], ss_sold_date_sk=[$22])
-                          HiveFilter(condition=[IS NOT NULL($22)])
-                            HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
-                        HiveProject(d_date_sk=[$0], d_date=[$2])
-                          HiveFilter(condition=[IN($6, 1999, 2000, 2001, 2002)])
-                            HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                  HiveProject(i_item_sk=[$0])
-                    HiveTableScan(table=[[default, item]], table:alias=[item])
+      HiveProject(sales=[*(CAST($2):DECIMAL(10, 0), $3)])
+        HiveSemiJoin(condition=[=($0, $8)], joinType=[semi])
+          HiveSemiJoin(condition=[=($1, $8)], joinType=[semi])
+            HiveJoin(condition=[=($4, $5)], joinType=[inner], algorithm=[none], cost=[not available])
+              HiveProject(cs_bill_customer_sk=[$2], cs_item_sk=[$14], cs_quantity=[$17], cs_list_price=[$19], cs_sold_date_sk=[$33])
+                HiveFilter(condition=[AND(IS NOT NULL($2), IS NOT NULL($33))])
+                  HiveTableScan(table=[[default, catalog_sales]], table:alias=[catalog_sales])
+              HiveProject(d_date_sk=[$0], d_year=[CAST(1999):INTEGER], d_moy=[CAST(1):INTEGER])
+                HiveFilter(condition=[AND(=($6, 1999), =($8, 1))])
+                  HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+            HiveProject($f1=[$0])
+              HiveFilter(condition=[>($2, 4)])
+                HiveProject(i_item_sk=[$3], d_date=[$1], $f2=[$2])
+                  HiveJoin(condition=[=($0, $3)], joinType=[inner], algorithm=[none], cost=[not available])
+                    HiveProject(ss_item_sk=[$0], d_date=[$1], $f2=[$2])
+                      HiveAggregate(group=[{0, 3}], agg#0=[count()])
+                        HiveJoin(condition=[=($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
+                          HiveProject(ss_item_sk=[$1], ss_sold_date_sk=[$22])
+                            HiveFilter(condition=[IS NOT NULL($22)])
+                              HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
+                          HiveProject(d_date_sk=[$0], d_date=[$2])
+                            HiveFilter(condition=[IN($6, 1999, 2000, 2001, 2002)])
+                              HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                    HiveProject(i_item_sk=[$0])
+                      HiveTableScan(table=[[default, item]], table:alias=[item])
+          HiveProject($f0=[$0])
+            HiveJoin(condition=[>($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
+              HiveProject(ss_customer_sk=[$0], $f1=[$1])
+                HiveFilter(condition=[IS NOT NULL($1)])
+                  HiveAggregate(group=[{0}], agg#0=[sum($1)])
+                    HiveProject(ss_customer_sk=[CAST($2):BIGINT NOT NULL], *=[*(CAST($9):DECIMAL(10, 0), $12)])
+                      HiveFilter(condition=[IS NOT NULL($2)])
+                        HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
+              HiveProject(*=[*(0.95:DECIMAL(8, 6), $0)])
+                HiveFilter(condition=[IS NOT NULL($0)])
+                  HiveProject($f0=[$0])
+                    HiveAggregate(group=[{}], agg#0=[max($1)])
+                      HiveProject(ss_customer_sk=[$0], $f1=[$1])
+                        HiveAggregate(group=[{1}], agg#0=[sum($2)])
+                          HiveJoin(condition=[=($0, $3)], joinType=[inner], algorithm=[none], cost=[not available])
+                            HiveProject(ss_sold_date_sk=[$22], ss_customer_sk=[CAST($2):BIGINT NOT NULL], *=[*(CAST($9):DECIMAL(10, 0), $12)])
+                              HiveFilter(condition=[AND(IS NOT NULL($2), IS NOT NULL($22))])
+                                HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
+                            HiveProject(d_date_sk=[$0])
+                              HiveFilter(condition=[IN($6, 1999, 2000, 2001, 2002)])
+                                HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+      HiveProject(sales=[*(CAST($2):DECIMAL(10, 0), $3)])
+        HiveSemiJoin(condition=[=($1, $8)], joinType=[semi])
+          HiveSemiJoin(condition=[=($0, $8)], joinType=[semi])
+            HiveJoin(condition=[=($4, $5)], joinType=[inner], algorithm=[none], cost=[not available])
+              HiveProject(ws_item_sk=[$2], ws_bill_customer_sk=[$3], ws_quantity=[$17], ws_list_price=[$19], ws_sold_date_sk=[$33])
+                HiveFilter(condition=[AND(IS NOT NULL($3), IS NOT NULL($33))])
+                  HiveTableScan(table=[[default, web_sales]], table:alias=[web_sales])
+              HiveProject(d_date_sk=[$0], d_year=[CAST(1999):INTEGER], d_moy=[CAST(1):INTEGER])
+                HiveFilter(condition=[AND(=($6, 1999), =($8, 1))])
+                  HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+            HiveProject($f1=[$0])
+              HiveFilter(condition=[>($2, 4)])
+                HiveProject(i_item_sk=[$3], d_date=[$1], $f2=[$2])
+                  HiveJoin(condition=[=($0, $3)], joinType=[inner], algorithm=[none], cost=[not available])
+                    HiveProject(ss_item_sk=[$0], d_date=[$1], $f2=[$2])
+                      HiveAggregate(group=[{0, 3}], agg#0=[count()])
+                        HiveJoin(condition=[=($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
+                          HiveProject(ss_item_sk=[$1], ss_sold_date_sk=[$22])
+                            HiveFilter(condition=[IS NOT NULL($22)])
+                              HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
+                          HiveProject(d_date_sk=[$0], d_date=[$2])
+                            HiveFilter(condition=[IN($6, 1999, 2000, 2001, 2002)])
+                              HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                    HiveProject(i_item_sk=[$0])
+                      HiveTableScan(table=[[default, item]], table:alias=[item])
+          HiveProject($f0=[$0])
+            HiveJoin(condition=[>($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
+              HiveProject(ss_customer_sk=[$0], $f1=[$1])
+                HiveFilter(condition=[IS NOT NULL($1)])
+                  HiveAggregate(group=[{0}], agg#0=[sum($1)])
+                    HiveProject(ss_customer_sk=[CAST($2):BIGINT NOT NULL], *=[*(CAST($9):DECIMAL(10, 0), $12)])
+                      HiveFilter(condition=[IS NOT NULL($2)])
+                        HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
+              HiveProject(*=[*(0.95:DECIMAL(8, 6), $0)])
+                HiveFilter(condition=[IS NOT NULL($0)])
+                  HiveProject($f0=[$0])
+                    HiveAggregate(group=[{}], agg#0=[max($1)])
+                      HiveProject(ss_customer_sk=[$0], $f1=[$1])
+                        HiveAggregate(group=[{1}], agg#0=[sum($2)])
+                          HiveJoin(condition=[=($0, $3)], joinType=[inner], algorithm=[none], cost=[not available])
+                            HiveProject(ss_sold_date_sk=[$22], ss_customer_sk=[CAST($2):BIGINT NOT NULL], *=[*(CAST($9):DECIMAL(10, 0), $12)])
+                              HiveFilter(condition=[AND(IS NOT NULL($2), IS NOT NULL($22))])
+                                HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
+                            HiveProject(d_date_sk=[$0])
+                              HiveFilter(condition=[IN($6, 1999, 2000, 2001, 2002)])
+                                HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
 
diff --git a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query33.q.out b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query33.q.out
index 11ce373201..7df41ac7ed 100644
--- a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query33.q.out
+++ b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query33.q.out
@@ -5,72 +5,66 @@ HiveSortLimit(sort0=[$1], dir0=[ASC], fetch=[100])
       HiveProject($f0=[$0], $f1=[$1])
         HiveUnion(all=[true])
           HiveProject(i_manufact_id=[$0], $f1=[$1])
-            HiveAggregate(group=[{7}], agg#0=[sum($2)])
-              HiveJoin(condition=[=($0, $6)], joinType=[inner], algorithm=[none], cost=[not available])
-                HiveJoin(condition=[=($1, $5)], joinType=[inner], algorithm=[none], cost=[not available])
-                  HiveJoin(condition=[=($3, $4)], joinType=[inner], algorithm=[none], cost=[not available])
-                    HiveProject(ss_item_sk=[$1], ss_addr_sk=[$5], ss_ext_sales_price=[$14], ss_sold_date_sk=[$22])
-                      HiveFilter(condition=[AND(IS NOT NULL($5), IS NOT NULL($22))])
-                        HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
-                    HiveProject(d_date_sk=[$0])
-                      HiveFilter(condition=[AND(=($6, 1999), =($8, 3))])
-                        HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                  HiveProject(ca_address_sk=[$0])
-                    HiveFilter(condition=[=($11, -6)])
-                      HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
-                HiveProject(i_item_sk=[$0], i_manufact_id=[$1], i_manufact_id0=[$2])
-                  HiveJoin(condition=[=($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
-                    HiveProject(i_item_sk=[$0], i_manufact_id=[$13])
-                      HiveFilter(condition=[IS NOT NULL($13)])
-                        HiveTableScan(table=[[default, item]], table:alias=[item])
-                    HiveProject(i_manufact_id=[$0])
-                      HiveAggregate(group=[{13}])
-                        HiveFilter(condition=[AND(=($12, _UTF-16LE'Books                                             '), IS NOT NULL($13))])
-                          HiveTableScan(table=[[default, item]], table:alias=[item])
+            HiveAggregate(group=[{10}], agg#0=[sum($2)])
+              HiveSemiJoin(condition=[=($10, $11)], joinType=[semi])
+                HiveJoin(condition=[=($0, $9)], joinType=[inner], algorithm=[none], cost=[not available])
+                  HiveJoin(condition=[=($1, $7)], joinType=[inner], algorithm=[none], cost=[not available])
+                    HiveJoin(condition=[=($3, $4)], joinType=[inner], algorithm=[none], cost=[not available])
+                      HiveProject(ss_item_sk=[$1], ss_addr_sk=[$5], ss_ext_sales_price=[$14], ss_sold_date_sk=[$22])
+                        HiveFilter(condition=[AND(IS NOT NULL($5), IS NOT NULL($22))])
+                          HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
+                      HiveProject(d_date_sk=[$0], d_year=[CAST(1999):INTEGER], d_moy=[CAST(3):INTEGER])
+                        HiveFilter(condition=[AND(=($6, 1999), =($8, 3))])
+                          HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                    HiveProject(ca_address_sk=[$0], ca_gmt_offset=[CAST(-6:DECIMAL(5, 2)):DECIMAL(5, 2)])
+                      HiveFilter(condition=[=($11, -6)])
+                        HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
+                  HiveProject(i_item_sk=[$0], i_manufact_id=[$13])
+                    HiveFilter(condition=[IS NOT NULL($13)])
+                      HiveTableScan(table=[[default, item]], table:alias=[item])
+                HiveProject(i_manufact_id=[$13])
+                  HiveFilter(condition=[AND(=($12, _UTF-16LE'Books                                             '), IS NOT NULL($13))])
+                    HiveTableScan(table=[[default, item]], table:alias=[item])
           HiveProject(i_manufact_id=[$0], $f1=[$1])
-            HiveAggregate(group=[{7}], agg#0=[sum($2)])
-              HiveJoin(condition=[=($1, $6)], joinType=[inner], algorithm=[none], cost=[not available])
-                HiveJoin(condition=[=($0, $5)], joinType=[inner], algorithm=[none], cost=[not available])
-                  HiveJoin(condition=[=($3, $4)], joinType=[inner], algorithm=[none], cost=[not available])
-                    HiveProject(cs_bill_addr_sk=[$5], cs_item_sk=[$14], cs_ext_sales_price=[$22], cs_sold_date_sk=[$33])
-                      HiveFilter(condition=[AND(IS NOT NULL($5), IS NOT NULL($33))])
-                        HiveTableScan(table=[[default, catalog_sales]], table:alias=[catalog_sales])
-                    HiveProject(d_date_sk=[$0])
-                      HiveFilter(condition=[AND(=($6, 1999), =($8, 3))])
-                        HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                  HiveProject(ca_address_sk=[$0])
-                    HiveFilter(condition=[=($11, -6)])
-                      HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
-                HiveProject(i_item_sk=[$0], i_manufact_id=[$1], i_manufact_id0=[$2])
-                  HiveJoin(condition=[=($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
-                    HiveProject(i_item_sk=[$0], i_manufact_id=[$13])
-                      HiveFilter(condition=[IS NOT NULL($13)])
-                        HiveTableScan(table=[[default, item]], table:alias=[item])
-                    HiveProject(i_manufact_id=[$0])
-                      HiveAggregate(group=[{13}])
-                        HiveFilter(condition=[AND(=($12, _UTF-16LE'Books                                             '), IS NOT NULL($13))])
-                          HiveTableScan(table=[[default, item]], table:alias=[item])
+            HiveAggregate(group=[{10}], agg#0=[sum($2)])
+              HiveSemiJoin(condition=[=($10, $11)], joinType=[semi])
+                HiveJoin(condition=[=($1, $9)], joinType=[inner], algorithm=[none], cost=[not available])
+                  HiveJoin(condition=[=($0, $7)], joinType=[inner], algorithm=[none], cost=[not available])
+                    HiveJoin(condition=[=($3, $4)], joinType=[inner], algorithm=[none], cost=[not available])
+                      HiveProject(cs_bill_addr_sk=[$5], cs_item_sk=[$14], cs_ext_sales_price=[$22], cs_sold_date_sk=[$33])
+                        HiveFilter(condition=[AND(IS NOT NULL($5), IS NOT NULL($33))])
+                          HiveTableScan(table=[[default, catalog_sales]], table:alias=[catalog_sales])
+                      HiveProject(d_date_sk=[$0], d_year=[CAST(1999):INTEGER], d_moy=[CAST(3):INTEGER])
+                        HiveFilter(condition=[AND(=($6, 1999), =($8, 3))])
+                          HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                    HiveProject(ca_address_sk=[$0], ca_gmt_offset=[CAST(-6:DECIMAL(5, 2)):DECIMAL(5, 2)])
+                      HiveFilter(condition=[=($11, -6)])
+                        HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
+                  HiveProject(i_item_sk=[$0], i_manufact_id=[$13])
+                    HiveFilter(condition=[IS NOT NULL($13)])
+                      HiveTableScan(table=[[default, item]], table:alias=[item])
+                HiveProject(i_manufact_id=[$13])
+                  HiveFilter(condition=[AND(=($12, _UTF-16LE'Books                                             '), IS NOT NULL($13))])
+                    HiveTableScan(table=[[default, item]], table:alias=[item])
           HiveProject(i_manufact_id=[$0], $f1=[$1])
-            HiveAggregate(group=[{7}], agg#0=[sum($2)])
-              HiveJoin(condition=[=($0, $6)], joinType=[inner], algorithm=[none], cost=[not available])
-                HiveJoin(condition=[=($1, $5)], joinType=[inner], algorithm=[none], cost=[not available])
-                  HiveJoin(condition=[=($3, $4)], joinType=[inner], algorithm=[none], cost=[not available])
-                    HiveProject(ws_item_sk=[$2], ws_bill_addr_sk=[$6], ws_ext_sales_price=[$22], ws_sold_date_sk=[$33])
-                      HiveFilter(condition=[AND(IS NOT NULL($6), IS NOT NULL($33))])
-                        HiveTableScan(table=[[default, web_sales]], table:alias=[web_sales])
-                    HiveProject(d_date_sk=[$0])
-                      HiveFilter(condition=[AND(=($6, 1999), =($8, 3))])
-                        HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                  HiveProject(ca_address_sk=[$0])
-                    HiveFilter(condition=[=($11, -6)])
-                      HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
-                HiveProject(i_item_sk=[$0], i_manufact_id=[$1], i_manufact_id0=[$2])
-                  HiveJoin(condition=[=($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
-                    HiveProject(i_item_sk=[$0], i_manufact_id=[$13])
-                      HiveFilter(condition=[IS NOT NULL($13)])
-                        HiveTableScan(table=[[default, item]], table:alias=[item])
-                    HiveProject(i_manufact_id=[$0])
-                      HiveAggregate(group=[{13}])
-                        HiveFilter(condition=[AND(=($12, _UTF-16LE'Books                                             '), IS NOT NULL($13))])
-                          HiveTableScan(table=[[default, item]], table:alias=[item])
+            HiveAggregate(group=[{10}], agg#0=[sum($2)])
+              HiveSemiJoin(condition=[=($10, $11)], joinType=[semi])
+                HiveJoin(condition=[=($0, $9)], joinType=[inner], algorithm=[none], cost=[not available])
+                  HiveJoin(condition=[=($1, $7)], joinType=[inner], algorithm=[none], cost=[not available])
+                    HiveJoin(condition=[=($3, $4)], joinType=[inner], algorithm=[none], cost=[not available])
+                      HiveProject(ws_item_sk=[$2], ws_bill_addr_sk=[$6], ws_ext_sales_price=[$22], ws_sold_date_sk=[$33])
+                        HiveFilter(condition=[AND(IS NOT NULL($6), IS NOT NULL($33))])
+                          HiveTableScan(table=[[default, web_sales]], table:alias=[web_sales])
+                      HiveProject(d_date_sk=[$0], d_year=[CAST(1999):INTEGER], d_moy=[CAST(3):INTEGER])
+                        HiveFilter(condition=[AND(=($6, 1999), =($8, 3))])
+                          HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                    HiveProject(ca_address_sk=[$0], ca_gmt_offset=[CAST(-6:DECIMAL(5, 2)):DECIMAL(5, 2)])
+                      HiveFilter(condition=[=($11, -6)])
+                        HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
+                  HiveProject(i_item_sk=[$0], i_manufact_id=[$13])
+                    HiveFilter(condition=[IS NOT NULL($13)])
+                      HiveTableScan(table=[[default, item]], table:alias=[item])
+                HiveProject(i_manufact_id=[$13])
+                  HiveFilter(condition=[AND(=($12, _UTF-16LE'Books                                             '), IS NOT NULL($13))])
+                    HiveTableScan(table=[[default, item]], table:alias=[item])
 
diff --git a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query56.q.out b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query56.q.out
index 286dfb2b3a..f211aa9a72 100644
--- a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query56.q.out
+++ b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query56.q.out
@@ -5,69 +5,63 @@ HiveSortLimit(sort0=[$1], dir0=[ASC], fetch=[100])
       HiveProject($f0=[$0], $f1=[$1])
         HiveUnion(all=[true])
           HiveProject(i_item_id=[$0], $f1=[$1])
-            HiveAggregate(group=[{7}], agg#0=[sum($2)])
-              HiveJoin(condition=[=($0, $6)], joinType=[inner], algorithm=[none], cost=[not available])
-                HiveJoin(condition=[=($1, $5)], joinType=[inner], algorithm=[none], cost=[not available])
-                  HiveJoin(condition=[=($3, $4)], joinType=[inner], algorithm=[none], cost=[not available])
-                    HiveProject(ss_item_sk=[$1], ss_addr_sk=[$5], ss_ext_sales_price=[$14], ss_sold_date_sk=[$22])
-                      HiveFilter(condition=[AND(IS NOT NULL($5), IS NOT NULL($22))])
-                        HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
-                    HiveProject(d_date_sk=[$0])
-                      HiveFilter(condition=[AND(=($6, 2000), =($8, 1))])
-                        HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                  HiveProject(ca_address_sk=[$0])
-                    HiveFilter(condition=[=($11, -8)])
-                      HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
-                HiveProject(i_item_sk=[$0], i_item_id=[$1], i_item_id0=[$2])
-                  HiveJoin(condition=[=($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
-                    HiveProject(i_item_sk=[$0], i_item_id=[$1])
-                      HiveTableScan(table=[[default, item]], table:alias=[item])
-                    HiveProject(i_item_id=[$0])
-                      HiveAggregate(group=[{1}])
-                        HiveFilter(condition=[IN($17, _UTF-16LE'orchid              ', _UTF-16LE'chiffon             ', _UTF-16LE'lace                ')])
-                          HiveTableScan(table=[[default, item]], table:alias=[item])
+            HiveAggregate(group=[{10}], agg#0=[sum($2)])
+              HiveSemiJoin(condition=[=($10, $11)], joinType=[semi])
+                HiveJoin(condition=[=($0, $9)], joinType=[inner], algorithm=[none], cost=[not available])
+                  HiveJoin(condition=[=($1, $7)], joinType=[inner], algorithm=[none], cost=[not available])
+                    HiveJoin(condition=[=($3, $4)], joinType=[inner], algorithm=[none], cost=[not available])
+                      HiveProject(ss_item_sk=[$1], ss_addr_sk=[$5], ss_ext_sales_price=[$14], ss_sold_date_sk=[$22])
+                        HiveFilter(condition=[AND(IS NOT NULL($5), IS NOT NULL($22))])
+                          HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
+                      HiveProject(d_date_sk=[$0], d_year=[CAST(2000):INTEGER], d_moy=[CAST(1):INTEGER])
+                        HiveFilter(condition=[AND(=($6, 2000), =($8, 1))])
+                          HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                    HiveProject(ca_address_sk=[$0], ca_gmt_offset=[CAST(-8:DECIMAL(5, 2)):DECIMAL(5, 2)])
+                      HiveFilter(condition=[=($11, -8)])
+                        HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
+                  HiveProject(i_item_sk=[$0], i_item_id=[$1])
+                    HiveTableScan(table=[[default, item]], table:alias=[item])
+                HiveProject(i_item_id=[$1])
+                  HiveFilter(condition=[IN($17, _UTF-16LE'orchid              ', _UTF-16LE'chiffon             ', _UTF-16LE'lace                ')])
+                    HiveTableScan(table=[[default, item]], table:alias=[item])
           HiveProject(i_item_id=[$0], $f1=[$1])
-            HiveAggregate(group=[{7}], agg#0=[sum($2)])
-              HiveJoin(condition=[=($1, $6)], joinType=[inner], algorithm=[none], cost=[not available])
-                HiveJoin(condition=[=($0, $5)], joinType=[inner], algorithm=[none], cost=[not available])
-                  HiveJoin(condition=[=($3, $4)], joinType=[inner], algorithm=[none], cost=[not available])
-                    HiveProject(cs_bill_addr_sk=[$5], cs_item_sk=[$14], cs_ext_sales_price=[$22], cs_sold_date_sk=[$33])
-                      HiveFilter(condition=[AND(IS NOT NULL($5), IS NOT NULL($33))])
-                        HiveTableScan(table=[[default, catalog_sales]], table:alias=[catalog_sales])
-                    HiveProject(d_date_sk=[$0])
-                      HiveFilter(condition=[AND(=($6, 2000), =($8, 1))])
-                        HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                  HiveProject(ca_address_sk=[$0])
-                    HiveFilter(condition=[=($11, -8)])
-                      HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
-                HiveProject(i_item_sk=[$0], i_item_id=[$1], i_item_id0=[$2])
-                  HiveJoin(condition=[=($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
-                    HiveProject(i_item_sk=[$0], i_item_id=[$1])
-                      HiveTableScan(table=[[default, item]], table:alias=[item])
-                    HiveProject(i_item_id=[$0])
-                      HiveAggregate(group=[{1}])
-                        HiveFilter(condition=[IN($17, _UTF-16LE'orchid              ', _UTF-16LE'chiffon             ', _UTF-16LE'lace                ')])
-                          HiveTableScan(table=[[default, item]], table:alias=[item])
+            HiveAggregate(group=[{10}], agg#0=[sum($2)])
+              HiveSemiJoin(condition=[=($10, $11)], joinType=[semi])
+                HiveJoin(condition=[=($1, $9)], joinType=[inner], algorithm=[none], cost=[not available])
+                  HiveJoin(condition=[=($0, $7)], joinType=[inner], algorithm=[none], cost=[not available])
+                    HiveJoin(condition=[=($3, $4)], joinType=[inner], algorithm=[none], cost=[not available])
+                      HiveProject(cs_bill_addr_sk=[$5], cs_item_sk=[$14], cs_ext_sales_price=[$22], cs_sold_date_sk=[$33])
+                        HiveFilter(condition=[AND(IS NOT NULL($5), IS NOT NULL($33))])
+                          HiveTableScan(table=[[default, catalog_sales]], table:alias=[catalog_sales])
+                      HiveProject(d_date_sk=[$0], d_year=[CAST(2000):INTEGER], d_moy=[CAST(1):INTEGER])
+                        HiveFilter(condition=[AND(=($6, 2000), =($8, 1))])
+                          HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                    HiveProject(ca_address_sk=[$0], ca_gmt_offset=[CAST(-8:DECIMAL(5, 2)):DECIMAL(5, 2)])
+                      HiveFilter(condition=[=($11, -8)])
+                        HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
+                  HiveProject(i_item_sk=[$0], i_item_id=[$1])
+                    HiveTableScan(table=[[default, item]], table:alias=[item])
+                HiveProject(i_item_id=[$1])
+                  HiveFilter(condition=[IN($17, _UTF-16LE'orchid              ', _UTF-16LE'chiffon             ', _UTF-16LE'lace                ')])
+                    HiveTableScan(table=[[default, item]], table:alias=[item])
           HiveProject(i_item_id=[$0], $f1=[$1])
-            HiveAggregate(group=[{7}], agg#0=[sum($2)])
-              HiveJoin(condition=[=($0, $6)], joinType=[inner], algorithm=[none], cost=[not available])
-                HiveJoin(condition=[=($1, $5)], joinType=[inner], algorithm=[none], cost=[not available])
-                  HiveJoin(condition=[=($3, $4)], joinType=[inner], algorithm=[none], cost=[not available])
-                    HiveProject(ws_item_sk=[$2], ws_bill_addr_sk=[$6], ws_ext_sales_price=[$22], ws_sold_date_sk=[$33])
-                      HiveFilter(condition=[AND(IS NOT NULL($6), IS NOT NULL($33))])
-                        HiveTableScan(table=[[default, web_sales]], table:alias=[web_sales])
-                    HiveProject(d_date_sk=[$0])
-                      HiveFilter(condition=[AND(=($6, 2000), =($8, 1))])
-                        HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                  HiveProject(ca_address_sk=[$0])
-                    HiveFilter(condition=[=($11, -8)])
-                      HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
-                HiveProject(i_item_sk=[$0], i_item_id=[$1], i_item_id0=[$2])
-                  HiveJoin(condition=[=($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
-                    HiveProject(i_item_sk=[$0], i_item_id=[$1])
-                      HiveTableScan(table=[[default, item]], table:alias=[item])
-                    HiveProject(i_item_id=[$0])
-                      HiveAggregate(group=[{1}])
-                        HiveFilter(condition=[IN($17, _UTF-16LE'orchid              ', _UTF-16LE'chiffon             ', _UTF-16LE'lace                ')])
-                          HiveTableScan(table=[[default, item]], table:alias=[item])
+            HiveAggregate(group=[{10}], agg#0=[sum($2)])
+              HiveSemiJoin(condition=[=($10, $11)], joinType=[semi])
+                HiveJoin(condition=[=($0, $9)], joinType=[inner], algorithm=[none], cost=[not available])
+                  HiveJoin(condition=[=($1, $7)], joinType=[inner], algorithm=[none], cost=[not available])
+                    HiveJoin(condition=[=($3, $4)], joinType=[inner], algorithm=[none], cost=[not available])
+                      HiveProject(ws_item_sk=[$2], ws_bill_addr_sk=[$6], ws_ext_sales_price=[$22], ws_sold_date_sk=[$33])
+                        HiveFilter(condition=[AND(IS NOT NULL($6), IS NOT NULL($33))])
+                          HiveTableScan(table=[[default, web_sales]], table:alias=[web_sales])
+                      HiveProject(d_date_sk=[$0], d_year=[CAST(2000):INTEGER], d_moy=[CAST(1):INTEGER])
+                        HiveFilter(condition=[AND(=($6, 2000), =($8, 1))])
+                          HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                    HiveProject(ca_address_sk=[$0], ca_gmt_offset=[CAST(-8:DECIMAL(5, 2)):DECIMAL(5, 2)])
+                      HiveFilter(condition=[=($11, -8)])
+                        HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
+                  HiveProject(i_item_sk=[$0], i_item_id=[$1])
+                    HiveTableScan(table=[[default, item]], table:alias=[item])
+                HiveProject(i_item_id=[$1])
+                  HiveFilter(condition=[IN($17, _UTF-16LE'orchid              ', _UTF-16LE'chiffon             ', _UTF-16LE'lace                ')])
+                    HiveTableScan(table=[[default, item]], table:alias=[item])
 
diff --git a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query58.q.out b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query58.q.out
index d678002b30..426475f730 100644
--- a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query58.q.out
+++ b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query58.q.out
@@ -1,94 +1,91 @@
-Warning: Map Join MAPJOIN[396][bigTable=?] in task 'Map 11' is a cross product
+Warning: Map Join MAPJOIN[375][bigTable=?] in task 'Map 5' is a cross product
 CBO PLAN:
 HiveSortLimit(sort0=[$0], sort1=[$1], dir0=[ASC], dir1=[ASC], fetch=[100])
   HiveProject(item_id=[$4], ss_item_rev=[$7], ss_dev=[*(/(/($7, +(+($7, $5), $1)), 3:DECIMAL(10, 0)), 100:DECIMAL(10, 0))], cs_item_rev=[$5], cs_dev=[*(/(/($5, +(+($7, $5), $1)), 3:DECIMAL(10, 0)), 100:DECIMAL(10, 0))], ws_item_rev=[$1], ws_dev=[*(/(/($1, +(+($7, $5), $1)), 3:DECIMAL(10, 0)), 100:DECIMAL(10, 0))], average=[/(+(+($7, $5), $1), 3:DECIMAL(10, 0))])
     HiveJoin(condition=[AND(=($4, $0), BETWEEN(false, $7, $2, $3), BETWEEN(false, $5, $2, $3), BETWEEN(false, $1, *(0.9:DECIMAL(1, 1), $7), *(1.1:DECIMAL(2, 1), $7)), BETWEEN(false, $1, *(0.9:DECIMAL(1, 1), $5), *(1.1:DECIMAL(2, 1), $5)))], joinType=[inner], algorithm=[none], cost=[not available])
       HiveProject(item_id=[$0], ws_item_rev=[$1], *=[*(0.9:DECIMAL(1, 1), $1)], *3=[*(1.1:DECIMAL(2, 1), $1)])
-        HiveAggregate(group=[{7}], agg#0=[sum($1)])
-          HiveJoin(condition=[=($0, $6)], joinType=[inner], algorithm=[none], cost=[not available])
-            HiveJoin(condition=[=($2, $3)], joinType=[inner], algorithm=[none], cost=[not available])
-              HiveProject(ws_item_sk=[$2], ws_ext_sales_price=[$22], ws_sold_date_sk=[$33])
-                HiveFilter(condition=[IS NOT NULL($33)])
-                  HiveTableScan(table=[[default, web_sales]], table:alias=[web_sales])
-              HiveJoin(condition=[=($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
+        HiveAggregate(group=[{6}], agg#0=[sum($1)])
+          HiveJoin(condition=[=($0, $5)], joinType=[inner], algorithm=[none], cost=[not available])
+            HiveSemiJoin(condition=[=($4, $5)], joinType=[semi])
+              HiveJoin(condition=[=($2, $3)], joinType=[inner], algorithm=[none], cost=[not available])
+                HiveProject(ws_item_sk=[$2], ws_ext_sales_price=[$22], ws_sold_date_sk=[$33])
+                  HiveFilter(condition=[IS NOT NULL($33)])
+                    HiveTableScan(table=[[default, web_sales]], table:alias=[web_sales])
                 HiveProject(d_date_sk=[$0], d_date=[$2])
                   HiveFilter(condition=[IS NOT NULL($2)])
                     HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                HiveProject(d_date=[$0])
-                  HiveAggregate(group=[{0}])
-                    HiveJoin(condition=[=($1, $3)], joinType=[inner], algorithm=[none], cost=[not available])
-                      HiveJoin(condition=[true], joinType=[inner], algorithm=[none], cost=[not available])
-                        HiveProject(d_date=[$2], d_week_seq=[$4])
-                          HiveFilter(condition=[AND(IS NOT NULL($4), IS NOT NULL($2))])
-                            HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+              HiveProject(d_date=[$0])
+                HiveJoin(condition=[=($1, $3)], joinType=[inner], algorithm=[none], cost=[not available])
+                  HiveJoin(condition=[true], joinType=[inner], algorithm=[none], cost=[not available])
+                    HiveProject(d_date=[$2], d_week_seq=[$4])
+                      HiveFilter(condition=[AND(IS NOT NULL($4), IS NOT NULL($2))])
+                        HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                    HiveProject(cnt=[$0])
+                      HiveFilter(condition=[<=(sq_count_check($0), 1)])
                         HiveProject(cnt=[$0])
-                          HiveFilter(condition=[<=(sq_count_check($0), 1)])
-                            HiveProject(cnt=[$0])
-                              HiveAggregate(group=[{}], cnt=[COUNT()])
-                                HiveFilter(condition=[=($2, 1998-02-19)])
-                                  HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                      HiveProject(d_week_seq=[$4])
-                        HiveFilter(condition=[AND(=($2, 1998-02-19), IS NOT NULL($4))])
-                          HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                          HiveAggregate(group=[{}], cnt=[COUNT()])
+                            HiveFilter(condition=[=($2, 1998-02-19)])
+                              HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                  HiveProject(d_week_seq=[$4])
+                    HiveFilter(condition=[AND(=($2, 1998-02-19), IS NOT NULL($4))])
+                      HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
             HiveProject(i_item_sk=[$0], i_item_id=[$1])
               HiveTableScan(table=[[default, item]], table:alias=[item])
       HiveJoin(condition=[AND(=($2, $0), BETWEEN(false, $3, *(0.9:DECIMAL(1, 1), $1), *(1.1:DECIMAL(2, 1), $1)), BETWEEN(false, $1, *(0.9:DECIMAL(1, 1), $3), *(1.1:DECIMAL(2, 1), $3)))], joinType=[inner], algorithm=[none], cost=[not available])
         HiveProject(i_item_id=[$0], $f1=[$1])
-          HiveAggregate(group=[{7}], agg#0=[sum($1)])
-            HiveJoin(condition=[=($0, $6)], joinType=[inner], algorithm=[none], cost=[not available])
-              HiveJoin(condition=[=($2, $3)], joinType=[inner], algorithm=[none], cost=[not available])
-                HiveProject(cs_item_sk=[$14], cs_ext_sales_price=[$22], cs_sold_date_sk=[$33])
-                  HiveFilter(condition=[IS NOT NULL($33)])
-                    HiveTableScan(table=[[default, catalog_sales]], table:alias=[catalog_sales])
-                HiveJoin(condition=[=($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
+          HiveAggregate(group=[{6}], agg#0=[sum($1)])
+            HiveJoin(condition=[=($0, $5)], joinType=[inner], algorithm=[none], cost=[not available])
+              HiveSemiJoin(condition=[=($4, $5)], joinType=[semi])
+                HiveJoin(condition=[=($2, $3)], joinType=[inner], algorithm=[none], cost=[not available])
+                  HiveProject(cs_item_sk=[$14], cs_ext_sales_price=[$22], cs_sold_date_sk=[$33])
+                    HiveFilter(condition=[IS NOT NULL($33)])
+                      HiveTableScan(table=[[default, catalog_sales]], table:alias=[catalog_sales])
                   HiveProject(d_date_sk=[$0], d_date=[$2])
                     HiveFilter(condition=[IS NOT NULL($2)])
                       HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                  HiveProject(d_date=[$0])
-                    HiveAggregate(group=[{0}])
-                      HiveJoin(condition=[=($1, $3)], joinType=[inner], algorithm=[none], cost=[not available])
-                        HiveJoin(condition=[true], joinType=[inner], algorithm=[none], cost=[not available])
-                          HiveProject(d_date=[$2], d_week_seq=[$4])
-                            HiveFilter(condition=[AND(IS NOT NULL($4), IS NOT NULL($2))])
-                              HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                HiveProject(d_date=[$0])
+                  HiveJoin(condition=[=($1, $3)], joinType=[inner], algorithm=[none], cost=[not available])
+                    HiveJoin(condition=[true], joinType=[inner], algorithm=[none], cost=[not available])
+                      HiveProject(d_date=[$2], d_week_seq=[$4])
+                        HiveFilter(condition=[AND(IS NOT NULL($4), IS NOT NULL($2))])
+                          HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                      HiveProject(cnt=[$0])
+                        HiveFilter(condition=[<=(sq_count_check($0), 1)])
                           HiveProject(cnt=[$0])
-                            HiveFilter(condition=[<=(sq_count_check($0), 1)])
-                              HiveProject(cnt=[$0])
-                                HiveAggregate(group=[{}], cnt=[COUNT()])
-                                  HiveFilter(condition=[=($2, 1998-02-19)])
-                                    HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                        HiveProject(d_week_seq=[$4])
-                          HiveFilter(condition=[AND(=($2, 1998-02-19), IS NOT NULL($4))])
-                            HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                            HiveAggregate(group=[{}], cnt=[COUNT()])
+                              HiveFilter(condition=[=($2, 1998-02-19)])
+                                HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                    HiveProject(d_week_seq=[$4])
+                      HiveFilter(condition=[AND(=($2, 1998-02-19), IS NOT NULL($4))])
+                        HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
               HiveProject(i_item_sk=[$0], i_item_id=[$1])
                 HiveTableScan(table=[[default, item]], table:alias=[item])
         HiveProject(i_item_id=[$0], $f1=[$1])
-          HiveAggregate(group=[{7}], agg#0=[sum($1)])
-            HiveJoin(condition=[=($0, $6)], joinType=[inner], algorithm=[none], cost=[not available])
-              HiveJoin(condition=[=($2, $3)], joinType=[inner], algorithm=[none], cost=[not available])
-                HiveProject(ss_item_sk=[$1], ss_ext_sales_price=[$14], ss_sold_date_sk=[$22])
-                  HiveFilter(condition=[IS NOT NULL($22)])
-                    HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
-                HiveJoin(condition=[=($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
+          HiveAggregate(group=[{6}], agg#0=[sum($1)])
+            HiveJoin(condition=[=($0, $5)], joinType=[inner], algorithm=[none], cost=[not available])
+              HiveSemiJoin(condition=[=($4, $5)], joinType=[semi])
+                HiveJoin(condition=[=($2, $3)], joinType=[inner], algorithm=[none], cost=[not available])
+                  HiveProject(ss_item_sk=[$1], ss_ext_sales_price=[$14], ss_sold_date_sk=[$22])
+                    HiveFilter(condition=[IS NOT NULL($22)])
+                      HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
                   HiveProject(d_date_sk=[$0], d_date=[$2])
                     HiveFilter(condition=[IS NOT NULL($2)])
                       HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                  HiveProject(d_date=[$0])
-                    HiveAggregate(group=[{0}])
-                      HiveJoin(condition=[=($1, $3)], joinType=[inner], algorithm=[none], cost=[not available])
-                        HiveJoin(condition=[true], joinType=[inner], algorithm=[none], cost=[not available])
-                          HiveProject(d_date=[$2], d_week_seq=[$4])
-                            HiveFilter(condition=[AND(IS NOT NULL($4), IS NOT NULL($2))])
-                              HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                HiveProject(d_date=[$0])
+                  HiveJoin(condition=[=($1, $3)], joinType=[inner], algorithm=[none], cost=[not available])
+                    HiveJoin(condition=[true], joinType=[inner], algorithm=[none], cost=[not available])
+                      HiveProject(d_date=[$2], d_week_seq=[$4])
+                        HiveFilter(condition=[AND(IS NOT NULL($4), IS NOT NULL($2))])
+                          HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                      HiveProject(cnt=[$0])
+                        HiveFilter(condition=[<=(sq_count_check($0), 1)])
                           HiveProject(cnt=[$0])
-                            HiveFilter(condition=[<=(sq_count_check($0), 1)])
-                              HiveProject(cnt=[$0])
-                                HiveAggregate(group=[{}], cnt=[COUNT()])
-                                  HiveFilter(condition=[=($2, 1998-02-19)])
-                                    HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                        HiveProject(d_week_seq=[$4])
-                          HiveFilter(condition=[AND(=($2, 1998-02-19), IS NOT NULL($4))])
-                            HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                            HiveAggregate(group=[{}], cnt=[COUNT()])
+                              HiveFilter(condition=[=($2, 1998-02-19)])
+                                HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                    HiveProject(d_week_seq=[$4])
+                      HiveFilter(condition=[AND(=($2, 1998-02-19), IS NOT NULL($4))])
+                        HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
               HiveProject(i_item_sk=[$0], i_item_id=[$1])
                 HiveTableScan(table=[[default, item]], table:alias=[item])
 
diff --git a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query60.q.out b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query60.q.out
index aaffc73a44..9242b86100 100644
--- a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query60.q.out
+++ b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query60.q.out
@@ -5,69 +5,63 @@ HiveSortLimit(sort0=[$0], sort1=[$1], dir0=[ASC], dir1=[ASC], fetch=[100])
       HiveProject($f0=[$0], $f1=[$1])
         HiveUnion(all=[true])
           HiveProject(i_item_id=[$0], $f1=[$1])
-            HiveAggregate(group=[{7}], agg#0=[sum($2)])
-              HiveJoin(condition=[=($0, $6)], joinType=[inner], algorithm=[none], cost=[not available])
-                HiveJoin(condition=[=($1, $5)], joinType=[inner], algorithm=[none], cost=[not available])
-                  HiveJoin(condition=[=($3, $4)], joinType=[inner], algorithm=[none], cost=[not available])
-                    HiveProject(ss_item_sk=[$1], ss_addr_sk=[$5], ss_ext_sales_price=[$14], ss_sold_date_sk=[$22])
-                      HiveFilter(condition=[AND(IS NOT NULL($5), IS NOT NULL($22))])
-                        HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
-                    HiveProject(d_date_sk=[$0])
-                      HiveFilter(condition=[AND(=($6, 1999), =($8, 9))])
-                        HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                  HiveProject(ca_address_sk=[$0])
-                    HiveFilter(condition=[=($11, -6)])
-                      HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
-                HiveProject(i_item_sk=[$0], i_item_id=[$1], i_item_id0=[$2])
-                  HiveJoin(condition=[=($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
-                    HiveProject(i_item_sk=[$0], i_item_id=[$1])
-                      HiveTableScan(table=[[default, item]], table:alias=[item])
-                    HiveProject(i_item_id=[$0])
-                      HiveAggregate(group=[{1}])
-                        HiveFilter(condition=[=($12, _UTF-16LE'Children                                          ')])
-                          HiveTableScan(table=[[default, item]], table:alias=[item])
+            HiveAggregate(group=[{10}], agg#0=[sum($2)])
+              HiveSemiJoin(condition=[=($10, $11)], joinType=[semi])
+                HiveJoin(condition=[=($0, $9)], joinType=[inner], algorithm=[none], cost=[not available])
+                  HiveJoin(condition=[=($1, $7)], joinType=[inner], algorithm=[none], cost=[not available])
+                    HiveJoin(condition=[=($3, $4)], joinType=[inner], algorithm=[none], cost=[not available])
+                      HiveProject(ss_item_sk=[$1], ss_addr_sk=[$5], ss_ext_sales_price=[$14], ss_sold_date_sk=[$22])
+                        HiveFilter(condition=[AND(IS NOT NULL($5), IS NOT NULL($22))])
+                          HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
+                      HiveProject(d_date_sk=[$0], d_year=[CAST(1999):INTEGER], d_moy=[CAST(9):INTEGER])
+                        HiveFilter(condition=[AND(=($6, 1999), =($8, 9))])
+                          HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                    HiveProject(ca_address_sk=[$0], ca_gmt_offset=[CAST(-6:DECIMAL(5, 2)):DECIMAL(5, 2)])
+                      HiveFilter(condition=[=($11, -6)])
+                        HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
+                  HiveProject(i_item_sk=[$0], i_item_id=[$1])
+                    HiveTableScan(table=[[default, item]], table:alias=[item])
+                HiveProject(i_item_id=[$1])
+                  HiveFilter(condition=[=($12, _UTF-16LE'Children                                          ')])
+                    HiveTableScan(table=[[default, item]], table:alias=[item])
           HiveProject(i_item_id=[$0], $f1=[$1])
-            HiveAggregate(group=[{7}], agg#0=[sum($2)])
-              HiveJoin(condition=[=($1, $6)], joinType=[inner], algorithm=[none], cost=[not available])
-                HiveJoin(condition=[=($0, $5)], joinType=[inner], algorithm=[none], cost=[not available])
-                  HiveJoin(condition=[=($3, $4)], joinType=[inner], algorithm=[none], cost=[not available])
-                    HiveProject(cs_bill_addr_sk=[$5], cs_item_sk=[$14], cs_ext_sales_price=[$22], cs_sold_date_sk=[$33])
-                      HiveFilter(condition=[AND(IS NOT NULL($5), IS NOT NULL($33))])
-                        HiveTableScan(table=[[default, catalog_sales]], table:alias=[catalog_sales])
-                    HiveProject(d_date_sk=[$0])
-                      HiveFilter(condition=[AND(=($6, 1999), =($8, 9))])
-                        HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                  HiveProject(ca_address_sk=[$0])
-                    HiveFilter(condition=[=($11, -6)])
-                      HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
-                HiveProject(i_item_sk=[$0], i_item_id=[$1], i_item_id0=[$2])
-                  HiveJoin(condition=[=($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
-                    HiveProject(i_item_sk=[$0], i_item_id=[$1])
-                      HiveTableScan(table=[[default, item]], table:alias=[item])
-                    HiveProject(i_item_id=[$0])
-                      HiveAggregate(group=[{1}])
-                        HiveFilter(condition=[=($12, _UTF-16LE'Children                                          ')])
-                          HiveTableScan(table=[[default, item]], table:alias=[item])
+            HiveAggregate(group=[{10}], agg#0=[sum($2)])
+              HiveSemiJoin(condition=[=($10, $11)], joinType=[semi])
+                HiveJoin(condition=[=($1, $9)], joinType=[inner], algorithm=[none], cost=[not available])
+                  HiveJoin(condition=[=($0, $7)], joinType=[inner], algorithm=[none], cost=[not available])
+                    HiveJoin(condition=[=($3, $4)], joinType=[inner], algorithm=[none], cost=[not available])
+                      HiveProject(cs_bill_addr_sk=[$5], cs_item_sk=[$14], cs_ext_sales_price=[$22], cs_sold_date_sk=[$33])
+                        HiveFilter(condition=[AND(IS NOT NULL($5), IS NOT NULL($33))])
+                          HiveTableScan(table=[[default, catalog_sales]], table:alias=[catalog_sales])
+                      HiveProject(d_date_sk=[$0], d_year=[CAST(1999):INTEGER], d_moy=[CAST(9):INTEGER])
+                        HiveFilter(condition=[AND(=($6, 1999), =($8, 9))])
+                          HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                    HiveProject(ca_address_sk=[$0], ca_gmt_offset=[CAST(-6:DECIMAL(5, 2)):DECIMAL(5, 2)])
+                      HiveFilter(condition=[=($11, -6)])
+                        HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
+                  HiveProject(i_item_sk=[$0], i_item_id=[$1])
+                    HiveTableScan(table=[[default, item]], table:alias=[item])
+                HiveProject(i_item_id=[$1])
+                  HiveFilter(condition=[=($12, _UTF-16LE'Children                                          ')])
+                    HiveTableScan(table=[[default, item]], table:alias=[item])
           HiveProject(i_item_id=[$0], $f1=[$1])
-            HiveAggregate(group=[{7}], agg#0=[sum($2)])
-              HiveJoin(condition=[=($0, $6)], joinType=[inner], algorithm=[none], cost=[not available])
-                HiveJoin(condition=[=($1, $5)], joinType=[inner], algorithm=[none], cost=[not available])
-                  HiveJoin(condition=[=($3, $4)], joinType=[inner], algorithm=[none], cost=[not available])
-                    HiveProject(ws_item_sk=[$2], ws_bill_addr_sk=[$6], ws_ext_sales_price=[$22], ws_sold_date_sk=[$33])
-                      HiveFilter(condition=[AND(IS NOT NULL($6), IS NOT NULL($33))])
-                        HiveTableScan(table=[[default, web_sales]], table:alias=[web_sales])
-                    HiveProject(d_date_sk=[$0])
-                      HiveFilter(condition=[AND(=($6, 1999), =($8, 9))])
-                        HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                  HiveProject(ca_address_sk=[$0])
-                    HiveFilter(condition=[=($11, -6)])
-                      HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
-                HiveProject(i_item_sk=[$0], i_item_id=[$1], i_item_id0=[$2])
-                  HiveJoin(condition=[=($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
-                    HiveProject(i_item_sk=[$0], i_item_id=[$1])
-                      HiveTableScan(table=[[default, item]], table:alias=[item])
-                    HiveProject(i_item_id=[$0])
-                      HiveAggregate(group=[{1}])
-                        HiveFilter(condition=[=($12, _UTF-16LE'Children                                          ')])
-                          HiveTableScan(table=[[default, item]], table:alias=[item])
+            HiveAggregate(group=[{10}], agg#0=[sum($2)])
+              HiveSemiJoin(condition=[=($10, $11)], joinType=[semi])
+                HiveJoin(condition=[=($0, $9)], joinType=[inner], algorithm=[none], cost=[not available])
+                  HiveJoin(condition=[=($1, $7)], joinType=[inner], algorithm=[none], cost=[not available])
+                    HiveJoin(condition=[=($3, $4)], joinType=[inner], algorithm=[none], cost=[not available])
+                      HiveProject(ws_item_sk=[$2], ws_bill_addr_sk=[$6], ws_ext_sales_price=[$22], ws_sold_date_sk=[$33])
+                        HiveFilter(condition=[AND(IS NOT NULL($6), IS NOT NULL($33))])
+                          HiveTableScan(table=[[default, web_sales]], table:alias=[web_sales])
+                      HiveProject(d_date_sk=[$0], d_year=[CAST(1999):INTEGER], d_moy=[CAST(9):INTEGER])
+                        HiveFilter(condition=[AND(=($6, 1999), =($8, 9))])
+                          HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                    HiveProject(ca_address_sk=[$0], ca_gmt_offset=[CAST(-6:DECIMAL(5, 2)):DECIMAL(5, 2)])
+                      HiveFilter(condition=[=($11, -6)])
+                        HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
+                  HiveProject(i_item_sk=[$0], i_item_id=[$1])
+                    HiveTableScan(table=[[default, item]], table:alias=[item])
+                HiveProject(i_item_id=[$1])
+                  HiveFilter(condition=[=($12, _UTF-16LE'Children                                          ')])
+                    HiveTableScan(table=[[default, item]], table:alias=[item])
 
diff --git a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query70.q.out b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query70.q.out
index c938a9bb39..406d301eff 100644
--- a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query70.q.out
+++ b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query70.q.out
@@ -5,33 +5,32 @@ HiveProject(total_sum=[$0], s_state=[$1], s_county=[$2], lochierarchy=[$3], rank
       HiveProject($f0=[$0], $f1=[$1], $f2=[$2], GROUPING__ID=[$3])
         HiveAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], agg#0=[sum($2)], GROUPING__ID=[GROUPING__ID()])
           HiveProject($f0=[$7], $f1=[$6], $f2=[$1])
-            HiveJoin(condition=[=($5, $0)], joinType=[inner], algorithm=[none], cost=[not available])
-              HiveJoin(condition=[=($3, $2)], joinType=[inner], algorithm=[none], cost=[not available])
-                HiveProject(ss_store_sk=[$6], ss_net_profit=[$21], ss_sold_date_sk=[$22])
-                  HiveFilter(condition=[AND(IS NOT NULL($6), IS NOT NULL($22))])
-                    HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
-                HiveProject(d_date_sk=[$0], d_month_seq=[$3])
-                  HiveFilter(condition=[BETWEEN(false, $3, 1212, 1223)])
-                    HiveTableScan(table=[[default, date_dim]], table:alias=[d1])
-              HiveProject(s_store_sk=[$0], s_county=[$1], s_state=[$2], s_state0=[$3])
-                HiveJoin(condition=[=($2, $3)], joinType=[inner], algorithm=[none], cost=[not available])
-                  HiveProject(s_store_sk=[$0], s_county=[$23], s_state=[$24])
-                    HiveFilter(condition=[IS NOT NULL($24)])
-                      HiveTableScan(table=[[default, store]], table:alias=[store])
-                  HiveProject(s_state=[$0])
-                    HiveFilter(condition=[<=($1, 5)])
-                      HiveProject((tok_table_or_col s_state)=[$0], rank_window_0=[rank() OVER (PARTITION BY $0 ORDER BY $1 DESC NULLS FIRST ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING)])
-                        HiveProject(s_state=[$0], $f1=[$1])
-                          HiveAggregate(group=[{5}], agg#0=[sum($1)])
-                            HiveJoin(condition=[=($4, $0)], joinType=[inner], algorithm=[none], cost=[not available])
-                              HiveJoin(condition=[=($3, $2)], joinType=[inner], algorithm=[none], cost=[not available])
-                                HiveProject(ss_store_sk=[$6], ss_net_profit=[$21], ss_sold_date_sk=[$22])
-                                  HiveFilter(condition=[AND(IS NOT NULL($6), IS NOT NULL($22))])
-                                    HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
-                                HiveProject(d_date_sk=[$0])
-                                  HiveFilter(condition=[BETWEEN(false, $3, 1212, 1223)])
-                                    HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                              HiveProject(s_store_sk=[$0], s_state=[$24])
-                                HiveFilter(condition=[IS NOT NULL($24)])
-                                  HiveTableScan(table=[[default, store]], table:alias=[store])
+            HiveSemiJoin(condition=[=($7, $8)], joinType=[semi])
+              HiveJoin(condition=[=($5, $0)], joinType=[inner], algorithm=[none], cost=[not available])
+                HiveJoin(condition=[=($3, $2)], joinType=[inner], algorithm=[none], cost=[not available])
+                  HiveProject(ss_store_sk=[$6], ss_net_profit=[$21], ss_sold_date_sk=[$22])
+                    HiveFilter(condition=[AND(IS NOT NULL($6), IS NOT NULL($22))])
+                      HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
+                  HiveProject(d_date_sk=[$0], d_month_seq=[$3])
+                    HiveFilter(condition=[BETWEEN(false, $3, 1212, 1223)])
+                      HiveTableScan(table=[[default, date_dim]], table:alias=[d1])
+                HiveProject(s_store_sk=[$0], s_county=[$23], s_state=[$24])
+                  HiveFilter(condition=[IS NOT NULL($24)])
+                    HiveTableScan(table=[[default, store]], table:alias=[store])
+              HiveProject(s_state=[$0])
+                HiveFilter(condition=[<=($1, 5)])
+                  HiveProject((tok_table_or_col s_state)=[$0], rank_window_0=[rank() OVER (PARTITION BY $0 ORDER BY $1 DESC NULLS FIRST ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING)])
+                    HiveProject(s_state=[$0], $f1=[$1])
+                      HiveAggregate(group=[{5}], agg#0=[sum($1)])
+                        HiveJoin(condition=[=($4, $0)], joinType=[inner], algorithm=[none], cost=[not available])
+                          HiveJoin(condition=[=($3, $2)], joinType=[inner], algorithm=[none], cost=[not available])
+                            HiveProject(ss_store_sk=[$6], ss_net_profit=[$21], ss_sold_date_sk=[$22])
+                              HiveFilter(condition=[AND(IS NOT NULL($6), IS NOT NULL($22))])
+                                HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
+                            HiveProject(d_date_sk=[$0])
+                              HiveFilter(condition=[BETWEEN(false, $3, 1212, 1223)])
+                                HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                          HiveProject(s_store_sk=[$0], s_state=[$24])
+                            HiveFilter(condition=[IS NOT NULL($24)])
+                              HiveTableScan(table=[[default, store]], table:alias=[store])
 
diff --git a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query83.q.out b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query83.q.out
index b968adfa46..344832bee8 100644
--- a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query83.q.out
+++ b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query83.q.out
@@ -4,69 +4,66 @@ HiveSortLimit(sort0=[$0], sort1=[$1], dir0=[ASC], dir1=[ASC], fetch=[100])
     HiveJoin(condition=[=($0, $4)], joinType=[inner], algorithm=[none], cost=[not available])
       HiveJoin(condition=[=($2, $0)], joinType=[inner], algorithm=[none], cost=[not available])
         HiveProject(i_item_id=[$0], $f1=[$1])
-          HiveAggregate(group=[{7}], agg#0=[sum($1)])
-            HiveJoin(condition=[=($0, $6)], joinType=[inner], algorithm=[none], cost=[not available])
-              HiveJoin(condition=[=($2, $3)], joinType=[inner], algorithm=[none], cost=[not available])
-                HiveProject(cr_item_sk=[$1], cr_return_quantity=[$16], cr_returned_date_sk=[$26])
-                  HiveFilter(condition=[IS NOT NULL($26)])
-                    HiveTableScan(table=[[default, catalog_returns]], table:alias=[catalog_returns])
-                HiveJoin(condition=[=($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
+          HiveAggregate(group=[{6}], agg#0=[sum($1)])
+            HiveJoin(condition=[=($0, $5)], joinType=[inner], algorithm=[none], cost=[not available])
+              HiveSemiJoin(condition=[=($4, $5)], joinType=[semi])
+                HiveJoin(condition=[=($2, $3)], joinType=[inner], algorithm=[none], cost=[not available])
+                  HiveProject(cr_item_sk=[$1], cr_return_quantity=[$16], cr_returned_date_sk=[$26])
+                    HiveFilter(condition=[IS NOT NULL($26)])
+                      HiveTableScan(table=[[default, catalog_returns]], table:alias=[catalog_returns])
                   HiveProject(d_date_sk=[$0], d_date=[$2])
                     HiveFilter(condition=[IS NOT NULL($2)])
                       HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                  HiveProject(d_date=[$0])
-                    HiveAggregate(group=[{0}])
-                      HiveSemiJoin(condition=[=($1, $2)], joinType=[semi])
-                        HiveProject(d_date=[$2], d_week_seq=[$4])
-                          HiveFilter(condition=[AND(IS NOT NULL($4), IS NOT NULL($2))])
-                            HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                        HiveProject(d_week_seq=[$4])
-                          HiveFilter(condition=[AND(IN($2, 1998-01-02:DATE, 1998-10-15:DATE, 1998-11-10:DATE), IS NOT NULL($4))])
-                            HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                HiveProject(d_date=[$0])
+                  HiveSemiJoin(condition=[=($1, $2)], joinType=[semi])
+                    HiveProject(d_date=[$2], d_week_seq=[$4])
+                      HiveFilter(condition=[AND(IS NOT NULL($4), IS NOT NULL($2))])
+                        HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                    HiveProject(d_week_seq=[$4])
+                      HiveFilter(condition=[AND(IN($2, 1998-01-02:DATE, 1998-10-15:DATE, 1998-11-10:DATE), IS NOT NULL($4))])
+                        HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
               HiveProject(i_item_sk=[$0], i_item_id=[$1])
                 HiveTableScan(table=[[default, item]], table:alias=[item])
         HiveProject(i_item_id=[$0], $f1=[$1])
-          HiveAggregate(group=[{7}], agg#0=[sum($1)])
-            HiveJoin(condition=[=($0, $6)], joinType=[inner], algorithm=[none], cost=[not available])
-              HiveJoin(condition=[=($2, $3)], joinType=[inner], algorithm=[none], cost=[not available])
-                HiveProject(sr_item_sk=[$1], sr_return_quantity=[$9], sr_returned_date_sk=[$19])
-                  HiveFilter(condition=[IS NOT NULL($19)])
-                    HiveTableScan(table=[[default, store_returns]], table:alias=[store_returns])
-                HiveJoin(condition=[=($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
+          HiveAggregate(group=[{6}], agg#0=[sum($1)])
+            HiveJoin(condition=[=($0, $5)], joinType=[inner], algorithm=[none], cost=[not available])
+              HiveSemiJoin(condition=[=($4, $5)], joinType=[semi])
+                HiveJoin(condition=[=($2, $3)], joinType=[inner], algorithm=[none], cost=[not available])
+                  HiveProject(sr_item_sk=[$1], sr_return_quantity=[$9], sr_returned_date_sk=[$19])
+                    HiveFilter(condition=[IS NOT NULL($19)])
+                      HiveTableScan(table=[[default, store_returns]], table:alias=[store_returns])
                   HiveProject(d_date_sk=[$0], d_date=[$2])
                     HiveFilter(condition=[IS NOT NULL($2)])
                       HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                  HiveProject(d_date=[$0])
-                    HiveAggregate(group=[{0}])
-                      HiveSemiJoin(condition=[=($1, $2)], joinType=[semi])
-                        HiveProject(d_date=[$2], d_week_seq=[$4])
-                          HiveFilter(condition=[AND(IS NOT NULL($4), IS NOT NULL($2))])
-                            HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                        HiveProject(d_week_seq=[$4])
-                          HiveFilter(condition=[AND(IN($2, 1998-01-02:DATE, 1998-10-15:DATE, 1998-11-10:DATE), IS NOT NULL($4))])
-                            HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                HiveProject(d_date=[$0])
+                  HiveSemiJoin(condition=[=($1, $2)], joinType=[semi])
+                    HiveProject(d_date=[$2], d_week_seq=[$4])
+                      HiveFilter(condition=[AND(IS NOT NULL($4), IS NOT NULL($2))])
+                        HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                    HiveProject(d_week_seq=[$4])
+                      HiveFilter(condition=[AND(IN($2, 1998-01-02:DATE, 1998-10-15:DATE, 1998-11-10:DATE), IS NOT NULL($4))])
+                        HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
               HiveProject(i_item_sk=[$0], i_item_id=[$1])
                 HiveTableScan(table=[[default, item]], table:alias=[item])
       HiveProject(item_id=[$0], wr_item_qty=[$1], CAST=[CAST($1):DOUBLE])
-        HiveAggregate(group=[{7}], agg#0=[sum($1)])
-          HiveJoin(condition=[=($0, $6)], joinType=[inner], algorithm=[none], cost=[not available])
-            HiveJoin(condition=[=($2, $3)], joinType=[inner], algorithm=[none], cost=[not available])
-              HiveProject(wr_item_sk=[$1], wr_return_quantity=[$13], wr_returned_date_sk=[$23])
-                HiveFilter(condition=[IS NOT NULL($23)])
-                  HiveTableScan(table=[[default, web_returns]], table:alias=[web_returns])
-              HiveJoin(condition=[=($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
+        HiveAggregate(group=[{6}], agg#0=[sum($1)])
+          HiveJoin(condition=[=($0, $5)], joinType=[inner], algorithm=[none], cost=[not available])
+            HiveSemiJoin(condition=[=($4, $5)], joinType=[semi])
+              HiveJoin(condition=[=($2, $3)], joinType=[inner], algorithm=[none], cost=[not available])
+                HiveProject(wr_item_sk=[$1], wr_return_quantity=[$13], wr_returned_date_sk=[$23])
+                  HiveFilter(condition=[IS NOT NULL($23)])
+                    HiveTableScan(table=[[default, web_returns]], table:alias=[web_returns])
                 HiveProject(d_date_sk=[$0], d_date=[$2])
                   HiveFilter(condition=[IS NOT NULL($2)])
                     HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                HiveProject(d_date=[$0])
-                  HiveAggregate(group=[{0}])
-                    HiveSemiJoin(condition=[=($1, $2)], joinType=[semi])
-                      HiveProject(d_date=[$2], d_week_seq=[$4])
-                        HiveFilter(condition=[AND(IS NOT NULL($4), IS NOT NULL($2))])
-                          HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
-                      HiveProject(d_week_seq=[$4])
-                        HiveFilter(condition=[AND(IN($2, 1998-01-02:DATE, 1998-10-15:DATE, 1998-11-10:DATE), IS NOT NULL($4))])
-                          HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+              HiveProject(d_date=[$0])
+                HiveSemiJoin(condition=[=($1, $2)], joinType=[semi])
+                  HiveProject(d_date=[$2], d_week_seq=[$4])
+                    HiveFilter(condition=[AND(IS NOT NULL($4), IS NOT NULL($2))])
+                      HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
+                  HiveProject(d_week_seq=[$4])
+                    HiveFilter(condition=[AND(IN($2, 1998-01-02:DATE, 1998-10-15:DATE, 1998-11-10:DATE), IS NOT NULL($4))])
+                      HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
             HiveProject(i_item_sk=[$0], i_item_id=[$1])
               HiveTableScan(table=[[default, item]], table:alias=[item])
 
diff --git a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query95.q.out b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query95.q.out
index 935028ef22..279de7cfc1 100644
--- a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query95.q.out
+++ b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/cbo_query95.q.out
@@ -1,18 +1,18 @@
 CBO PLAN:
-HiveAggregate(group=[{}], agg#0=[count(DISTINCT $0)], agg#1=[sum($1)], agg#2=[sum($2)])
-  HiveSemiJoin(condition=[=($0, $3)], joinType=[semi])
-    HiveSemiJoin(condition=[=($0, $3)], joinType=[semi])
-      HiveProject(ws_order_number=[$3], ws_ext_ship_cost=[$4], ws_net_profit=[$5])
-        HiveJoin(condition=[=($0, $8)], joinType=[inner], algorithm=[none], cost=[not available])
-          HiveJoin(condition=[=($2, $7)], joinType=[inner], algorithm=[none], cost=[not available])
+HiveAggregate(group=[{}], agg#0=[count(DISTINCT $3)], agg#1=[sum($4)], agg#2=[sum($5)])
+  HiveSemiJoin(condition=[=($3, $12)], joinType=[semi])
+    HiveSemiJoin(condition=[=($3, $12)], joinType=[semi])
+      HiveProject(ws_ship_date_sk=[$0], ws_ship_addr_sk=[$1], ws_web_site_sk=[$2], ws_order_number=[$3], ws_ext_ship_cost=[$4], ws_net_profit=[$5], d_date_sk=[$10], d_date=[$11], ca_address_sk=[$6], ca_state=[$7], web_site_sk=[$8], web_company_name=[$9])
+        HiveJoin(condition=[=($0, $10)], joinType=[inner], algorithm=[none], cost=[not available])
+          HiveJoin(condition=[=($2, $8)], joinType=[inner], algorithm=[none], cost=[not available])
             HiveJoin(condition=[=($1, $6)], joinType=[inner], algorithm=[none], cost=[not available])
               HiveProject(ws_ship_date_sk=[$1], ws_ship_addr_sk=[$10], ws_web_site_sk=[$12], ws_order_number=[$16], ws_ext_ship_cost=[$27], ws_net_profit=[$32])
                 HiveFilter(condition=[AND(IS NOT NULL($10), IS NOT NULL($12), IS NOT NULL($1))])
                   HiveTableScan(table=[[default, web_sales]], table:alias=[ws1])
-              HiveProject(ca_address_sk=[$0])
+              HiveProject(ca_address_sk=[$0], ca_state=[CAST(_UTF-16LE'TX'):CHAR(2) CHARACTER SET "UTF-16LE"])
                 HiveFilter(condition=[=($8, _UTF-16LE'TX')])
                   HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
-            HiveProject(web_site_sk=[$0])
+            HiveProject(web_site_sk=[$0], web_company_name=[CAST(_UTF-16LE'pri                                               '):CHAR(50) CHARACTER SET "UTF-16LE"])
               HiveFilter(condition=[=($14, _UTF-16LE'pri                                               ')])
                 HiveTableScan(table=[[default, web_site]], table:alias=[web_site])
           HiveProject(d_date_sk=[$0], d_date=[$2])
diff --git a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query23.q.out b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query23.q.out
index 27f7ae8d54..29e60c5725 100644
--- a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query23.q.out
+++ b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query23.q.out
@@ -1,4 +1,4 @@
-Warning: Map Join MAPJOIN[318][bigTable=?] in task 'Reducer 5' is a cross product
+Warning: Map Join MAPJOIN[318][bigTable=?] in task 'Reducer 7' is a cross product
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
   Stage-0 depends on stages: Stage-1
@@ -8,18 +8,18 @@ STAGE PLANS:
     Tez
 #### A masked pattern was here ####
       Edges:
-        Map 1 <- Reducer 10 (BROADCAST_EDGE), Reducer 14 (BROADCAST_EDGE), Reducer 5 (BROADCAST_EDGE), Union 2 (CONTAINS)
-        Map 15 <- Map 12 (BROADCAST_EDGE), Reducer 11 (BROADCAST_EDGE), Reducer 6 (BROADCAST_EDGE), Union 2 (CONTAINS)
-        Map 7 <- Map 12 (BROADCAST_EDGE), Reducer 13 (BROADCAST_EDGE)
-        Reducer 10 <- Map 16 (BROADCAST_EDGE), Map 7 (SIMPLE_EDGE)
-        Reducer 11 <- Reducer 10 (SIMPLE_EDGE)
-        Reducer 13 <- Map 12 (SIMPLE_EDGE)
-        Reducer 14 <- Map 12 (SIMPLE_EDGE)
+        Map 1 <- Map 14 (BROADCAST_EDGE), Reducer 12 (BROADCAST_EDGE), Reducer 7 (BROADCAST_EDGE), Union 2 (CONTAINS)
+        Map 4 <- Reducer 13 (BROADCAST_EDGE), Reducer 16 (BROADCAST_EDGE), Reducer 8 (BROADCAST_EDGE), Union 2 (CONTAINS)
+        Map 9 <- Map 14 (BROADCAST_EDGE), Reducer 15 (BROADCAST_EDGE)
+        Reducer 10 <- Map 9 (SIMPLE_EDGE)
+        Reducer 11 <- Reducer 10 (CUSTOM_SIMPLE_EDGE)
+        Reducer 12 <- Map 5 (BROADCAST_EDGE), Map 9 (SIMPLE_EDGE)
+        Reducer 13 <- Reducer 12 (SIMPLE_EDGE)
+        Reducer 15 <- Map 14 (SIMPLE_EDGE)
+        Reducer 16 <- Map 14 (SIMPLE_EDGE)
         Reducer 3 <- Union 2 (CUSTOM_SIMPLE_EDGE)
-        Reducer 5 <- Map 4 (SIMPLE_EDGE), Reducer 9 (BROADCAST_EDGE)
-        Reducer 6 <- Reducer 5 (SIMPLE_EDGE)
-        Reducer 8 <- Map 7 (SIMPLE_EDGE)
-        Reducer 9 <- Reducer 8 (CUSTOM_SIMPLE_EDGE)
+        Reducer 7 <- Map 6 (SIMPLE_EDGE), Reducer 11 (BROADCAST_EDGE)
+        Reducer 8 <- Reducer 7 (SIMPLE_EDGE)
 #### A masked pattern was here ####
       Vertices:
         Map 1 
@@ -27,7 +27,7 @@ STAGE PLANS:
                 TableScan
                   alias: catalog_sales
                   filterExpr: cs_bill_customer_sk is not null (type: boolean)
-                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_319_container, bigKeyColName:cs_bill_customer_sk, smallTablePos:1, keyRatio:0.016815318956164418
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_314_container, bigKeyColName:cs_item_sk, smallTablePos:1, keyRatio:3.0779924292960215E-5
                   Statistics: Num rows: 43005109025 Data size: 6007427450388 Basic stats: COMPLETE Column stats: COMPLETE
                   Filter Operator
                     predicate: cs_bill_customer_sk is not null (type: boolean)
@@ -44,50 +44,46 @@ STAGE PLANS:
                           1 _col0 (type: bigint)
                         outputColumnNames: _col0, _col1, _col2, _col3
                         input vertices:
-                          1 Reducer 14
+                          1 Map 14
                         Statistics: Num rows: 723144625 Data size: 82199941740 Basic stats: COMPLETE Column stats: COMPLETE
                         Map Join Operator
                           condition map:
                                Left Semi Join 0 to 1
                           keys:
-                            0 _col0 (type: bigint)
+                            0 _col1 (type: bigint)
                             1 _col0 (type: bigint)
-                          outputColumnNames: _col1, _col2, _col3
+                          outputColumnNames: _col0, _col2, _col3
                           input vertices:
-                            1 Reducer 5
-                          Statistics: Num rows: 723144625 Data size: 77258432804 Basic stats: COMPLETE Column stats: COMPLETE
-                          Select Operator
-                            expressions: _col1 (type: bigint), _col2 (type: int), _col3 (type: decimal(7,2))
-                            outputColumnNames: _col0, _col1, _col2
-                            Statistics: Num rows: 723144625 Data size: 77258432804 Basic stats: COMPLETE Column stats: COMPLETE
-                            Map Join Operator
-                              condition map:
-                                   Left Semi Join 0 to 1
-                              keys:
-                                0 _col0 (type: bigint)
-                                1 _col0 (type: bigint)
-                              outputColumnNames: _col1, _col2
-                              input vertices:
-                                1 Reducer 10
-                              Statistics: Num rows: 723144625 Data size: 71473275804 Basic stats: COMPLETE Column stats: COMPLETE
-                              Select Operator
-                                expressions: (CAST( _col1 AS decimal(10,0)) * _col2) (type: decimal(18,2))
+                            1 Reducer 12
+                          Statistics: Num rows: 723144625 Data size: 76414784740 Basic stats: COMPLETE Column stats: COMPLETE
+                          Map Join Operator
+                            condition map:
+                                 Left Semi Join 0 to 1
+                            keys:
+                              0 _col0 (type: bigint)
+                              1 _col0 (type: bigint)
+                            outputColumnNames: _col2, _col3
+                            input vertices:
+                              1 Reducer 7
+                            Statistics: Num rows: 723144625 Data size: 71473275804 Basic stats: COMPLETE Column stats: COMPLETE
+                            Select Operator
+                              expressions: (CAST( _col2 AS decimal(10,0)) * _col3) (type: decimal(18,2))
+                              outputColumnNames: _col0
+                              Statistics: Num rows: 723144625 Data size: 80992198000 Basic stats: COMPLETE Column stats: COMPLETE
+                              Group By Operator
+                                aggregations: sum(_col0)
+                                minReductionHashAggr: 0.99
+                                mode: hash
                                 outputColumnNames: _col0
-                                Statistics: Num rows: 723144625 Data size: 80992198000 Basic stats: COMPLETE Column stats: COMPLETE
-                                Group By Operator
-                                  aggregations: sum(_col0)
-                                  minReductionHashAggr: 0.99
-                                  mode: hash
-                                  outputColumnNames: _col0
+                                Statistics: Num rows: 1 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
+                                Reduce Output Operator
+                                  null sort order: 
+                                  sort order: 
                                   Statistics: Num rows: 1 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
-                                  Reduce Output Operator
-                                    null sort order: 
-                                    sort order: 
-                                    Statistics: Num rows: 1 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
-                                    value expressions: _col0 (type: decimal(28,2))
+                                  value expressions: _col0 (type: decimal(28,2))
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
-        Map 12 
+        Map 14 
             Map Operator Tree:
                 TableScan
                   alias: date_dim
@@ -121,7 +117,7 @@ STAGE PLANS:
                             Target Input: store_sales
                             Partition key expr: ss_sold_date_sk
                             Statistics: Num rows: 1468 Data size: 11744 Basic stats: COMPLETE Column stats: COMPLETE
-                            Target Vertex: Map 7
+                            Target Vertex: Map 9
                     Select Operator
                       expressions: d_date_sk (type: bigint), d_date (type: date)
                       outputColumnNames: _col0, _col1
@@ -148,20 +144,20 @@ STAGE PLANS:
                             Target Input: store_sales
                             Partition key expr: ss_sold_date_sk
                             Statistics: Num rows: 1468 Data size: 11744 Basic stats: COMPLETE Column stats: COMPLETE
-                            Target Vertex: Map 7
+                            Target Vertex: Map 9
                   Filter Operator
                     predicate: ((d_year = 1999) and (d_moy = 1)) (type: boolean)
                     Statistics: Num rows: 31 Data size: 496 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
                       expressions: d_date_sk (type: bigint)
                       outputColumnNames: _col0
-                      Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 31 Data size: 496 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
                         key expressions: _col0 (type: bigint)
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
+                        Statistics: Num rows: 31 Data size: 496 Basic stats: COMPLETE Column stats: COMPLETE
                       Select Operator
                         expressions: _col0 (type: bigint)
                         outputColumnNames: _col0
@@ -173,17 +169,17 @@ STAGE PLANS:
                           outputColumnNames: _col0
                           Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
                           Dynamic Partitioning Event Operator
-                            Target column: ws_sold_date_sk (bigint)
-                            Target Input: web_sales
-                            Partition key expr: ws_sold_date_sk
+                            Target column: cs_sold_date_sk (bigint)
+                            Target Input: catalog_sales
+                            Partition key expr: cs_sold_date_sk
                             Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
-                            Target Vertex: Map 15
+                            Target Vertex: Map 1
                       Reduce Output Operator
                         key expressions: _col0 (type: bigint)
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
+                        Statistics: Num rows: 31 Data size: 496 Basic stats: COMPLETE Column stats: COMPLETE
                       Select Operator
                         expressions: _col0 (type: bigint)
                         outputColumnNames: _col0
@@ -195,19 +191,19 @@ STAGE PLANS:
                           outputColumnNames: _col0
                           Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
                           Dynamic Partitioning Event Operator
-                            Target column: cs_sold_date_sk (bigint)
-                            Target Input: catalog_sales
-                            Partition key expr: cs_sold_date_sk
+                            Target column: ws_sold_date_sk (bigint)
+                            Target Input: web_sales
+                            Partition key expr: ws_sold_date_sk
                             Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
-                            Target Vertex: Map 1
+                            Target Vertex: Map 4
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
-        Map 15 
+        Map 4 
             Map Operator Tree:
                 TableScan
                   alias: web_sales
                   filterExpr: ws_bill_customer_sk is not null (type: boolean)
-                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_321_container, bigKeyColName:ws_bill_customer_sk, smallTablePos:1, keyRatio:3.6541477736394603E-7
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_315_container, bigKeyColName:ws_item_sk, smallTablePos:1, keyRatio:0.01697464775419283
                   Statistics: Num rows: 21594638446 Data size: 3022914194636 Basic stats: COMPLETE Column stats: COMPLETE
                   Filter Operator
                     predicate: ws_bill_customer_sk is not null (type: boolean)
@@ -224,50 +220,46 @@ STAGE PLANS:
                           1 _col0 (type: bigint)
                         outputColumnNames: _col0, _col1, _col2, _col3
                         input vertices:
-                          1 Map 12
+                          1 Reducer 16
                         Statistics: Num rows: 366561381 Data size: 48050956264 Basic stats: COMPLETE Column stats: COMPLETE
                         Map Join Operator
                           condition map:
                                Left Semi Join 0 to 1
                           keys:
-                            0 _col1 (type: bigint)
+                            0 _col0 (type: bigint)
                             1 _col0 (type: bigint)
-                          outputColumnNames: _col0, _col2, _col3
+                          outputColumnNames: _col1, _col2, _col3
                           input vertices:
-                            1 Reducer 6
-                          Statistics: Num rows: 366561381 Data size: 45140011592 Basic stats: COMPLETE Column stats: COMPLETE
-                          Select Operator
-                            expressions: _col0 (type: bigint), _col2 (type: int), _col3 (type: decimal(7,2))
-                            outputColumnNames: _col0, _col1, _col2
-                            Statistics: Num rows: 366561381 Data size: 45140011592 Basic stats: COMPLETE Column stats: COMPLETE
-                            Map Join Operator
-                              condition map:
-                                   Left Semi Join 0 to 1
-                              keys:
-                                0 _col0 (type: bigint)
-                                1 _col0 (type: bigint)
-                              outputColumnNames: _col1, _col2
-                              input vertices:
-                                1 Reducer 11
-                              Statistics: Num rows: 366561381 Data size: 42207520544 Basic stats: COMPLETE Column stats: COMPLETE
-                              Select Operator
-                                expressions: (CAST( _col1 AS decimal(10,0)) * _col2) (type: decimal(18,2))
+                            1 Reducer 13
+                          Statistics: Num rows: 366561381 Data size: 45118465216 Basic stats: COMPLETE Column stats: COMPLETE
+                          Map Join Operator
+                            condition map:
+                                 Left Semi Join 0 to 1
+                            keys:
+                              0 _col1 (type: bigint)
+                              1 _col0 (type: bigint)
+                            outputColumnNames: _col2, _col3
+                            input vertices:
+                              1 Reducer 8
+                            Statistics: Num rows: 366561381 Data size: 42207520544 Basic stats: COMPLETE Column stats: COMPLETE
+                            Select Operator
+                              expressions: (CAST( _col2 AS decimal(10,0)) * _col3) (type: decimal(18,2))
+                              outputColumnNames: _col0
+                              Statistics: Num rows: 366561381 Data size: 41054874672 Basic stats: COMPLETE Column stats: COMPLETE
+                              Group By Operator
+                                aggregations: sum(_col0)
+                                minReductionHashAggr: 0.99
+                                mode: hash
                                 outputColumnNames: _col0
-                                Statistics: Num rows: 366561381 Data size: 41054874672 Basic stats: COMPLETE Column stats: COMPLETE
-                                Group By Operator
-                                  aggregations: sum(_col0)
-                                  minReductionHashAggr: 0.99
-                                  mode: hash
-                                  outputColumnNames: _col0
+                                Statistics: Num rows: 1 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
+                                Reduce Output Operator
+                                  null sort order: 
+                                  sort order: 
                                   Statistics: Num rows: 1 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
-                                  Reduce Output Operator
-                                    null sort order: 
-                                    sort order: 
-                                    Statistics: Num rows: 1 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
-                                    value expressions: _col0 (type: decimal(28,2))
+                                  value expressions: _col0 (type: decimal(28,2))
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
-        Map 16 
+        Map 5 
             Map Operator Tree:
                 TableScan
                   alias: item
@@ -284,7 +276,7 @@ STAGE PLANS:
                       Statistics: Num rows: 462000 Data size: 3696000 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
-        Map 4 
+        Map 6 
             Map Operator Tree:
                 TableScan
                   alias: store_sales
@@ -313,7 +305,7 @@ STAGE PLANS:
                           value expressions: _col1 (type: decimal(28,2))
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
-        Map 7 
+        Map 9 
             Map Operator Tree:
                 TableScan
                   alias: store_sales
@@ -333,7 +325,7 @@ STAGE PLANS:
                           1 _col0 (type: bigint)
                         outputColumnNames: _col1, _col2
                         input vertices:
-                          1 Map 12
+                          1 Reducer 15
                         Statistics: Num rows: 64769599664 Data size: 7757159825120 Basic stats: COMPLETE Column stats: COMPLETE
                         Group By Operator
                           aggregations: sum(_col2)
@@ -361,7 +353,7 @@ STAGE PLANS:
                         1 _col0 (type: bigint)
                       outputColumnNames: _col0, _col3
                       input vertices:
-                        1 Reducer 13
+                        1 Map 14
                       Statistics: Num rows: 66333133964 Data size: 4245320573696 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
                         aggregations: count()
@@ -380,6 +372,50 @@ STAGE PLANS:
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
         Reducer 10 
+            Execution mode: vectorized, llap
+            Reduce Operator Tree:
+              Group By Operator
+                aggregations: sum(VALUE._col0)
+                keys: KEY._col0 (type: bigint)
+                mode: mergepartial
+                outputColumnNames: _col0, _col1
+                Statistics: Num rows: 63129535 Data size: 7560736760 Basic stats: COMPLETE Column stats: COMPLETE
+                Select Operator
+                  expressions: _col1 (type: decimal(28,2))
+                  outputColumnNames: _col1
+                  Statistics: Num rows: 63129535 Data size: 7560736760 Basic stats: COMPLETE Column stats: COMPLETE
+                  Group By Operator
+                    aggregations: max(_col1)
+                    minReductionHashAggr: 0.99
+                    mode: hash
+                    outputColumnNames: _col0
+                    Statistics: Num rows: 1 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
+                    Reduce Output Operator
+                      null sort order: 
+                      sort order: 
+                      Statistics: Num rows: 1 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
+                      value expressions: _col0 (type: decimal(28,2))
+        Reducer 11 
+            Execution mode: vectorized, llap
+            Reduce Operator Tree:
+              Group By Operator
+                aggregations: max(VALUE._col0)
+                mode: mergepartial
+                outputColumnNames: _col0
+                Statistics: Num rows: 1 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
+                Filter Operator
+                  predicate: _col0 is not null (type: boolean)
+                  Statistics: Num rows: 1 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
+                  Select Operator
+                    expressions: (0.95 * _col0) (type: decimal(31,4))
+                    outputColumnNames: _col0
+                    Statistics: Num rows: 1 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
+                    Reduce Output Operator
+                      null sort order: 
+                      sort order: 
+                      Statistics: Num rows: 1 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
+                      value expressions: _col0 (type: decimal(31,4))
+        Reducer 12 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Group By Operator
@@ -400,7 +436,7 @@ STAGE PLANS:
                       1 _col0 (type: bigint)
                     outputColumnNames: _col2, _col3
                     input vertices:
-                      1 Map 16
+                      1 Map 5
                     Statistics: Num rows: 16583283491 Data size: 265332535856 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
                       expressions: _col3 (type: bigint), _col2 (type: bigint)
@@ -431,7 +467,7 @@ STAGE PLANS:
                               sort order: +
                               Map-reduce partition columns: _col0 (type: bigint)
                               Statistics: Num rows: 64646121 Data size: 517168968 Basic stats: COMPLETE Column stats: COMPLETE
-        Reducer 11 
+        Reducer 13 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Select Operator
@@ -443,20 +479,19 @@ STAGE PLANS:
                   sort order: +
                   Map-reduce partition columns: _col0 (type: bigint)
                   Statistics: Num rows: 64646121 Data size: 517168968 Basic stats: COMPLETE Column stats: COMPLETE
-        Reducer 13 
+        Reducer 15 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Select Operator
-                expressions: KEY.reducesinkkey0 (type: bigint), VALUE._col0 (type: date)
-                outputColumnNames: _col0, _col1
+                expressions: KEY.reducesinkkey0 (type: bigint)
+                outputColumnNames: _col0
                 Reduce Output Operator
                   key expressions: _col0 (type: bigint)
                   null sort order: z
                   sort order: +
                   Map-reduce partition columns: _col0 (type: bigint)
-                  Statistics: Num rows: 1468 Data size: 93952 Basic stats: COMPLETE Column stats: COMPLETE
-                  value expressions: _col1 (type: date)
-        Reducer 14 
+                  Statistics: Num rows: 1468 Data size: 11744 Basic stats: COMPLETE Column stats: COMPLETE
+        Reducer 16 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Select Operator
@@ -467,7 +502,7 @@ STAGE PLANS:
                   null sort order: z
                   sort order: +
                   Map-reduce partition columns: _col0 (type: bigint)
-                  Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
+                  Statistics: Num rows: 31 Data size: 496 Basic stats: COMPLETE Column stats: COMPLETE
         Reducer 3 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
@@ -483,7 +518,7 @@ STAGE PLANS:
                       input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                       output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
                       serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-        Reducer 5 
+        Reducer 7 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Group By Operator
@@ -503,7 +538,7 @@ STAGE PLANS:
                       1 
                     outputColumnNames: _col0, _col1, _col2
                     input vertices:
-                      1 Reducer 9
+                      1 Reducer 11
                     Statistics: Num rows: 78525966 Data size: 18189742160 Basic stats: COMPLETE Column stats: COMPLETE
                     Filter Operator
                       predicate: (_col1 > _col2) (type: boolean)
@@ -530,7 +565,7 @@ STAGE PLANS:
                             sort order: +
                             Map-reduce partition columns: _col0 (type: bigint)
                             Statistics: Num rows: 26175322 Data size: 199975264 Basic stats: COMPLETE Column stats: COMPLETE
-        Reducer 6 
+        Reducer 8 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Select Operator
@@ -542,50 +577,6 @@ STAGE PLANS:
                   sort order: +
                   Map-reduce partition columns: _col0 (type: bigint)
                   Statistics: Num rows: 26175322 Data size: 199975264 Basic stats: COMPLETE Column stats: COMPLETE
-        Reducer 8 
-            Execution mode: vectorized, llap
-            Reduce Operator Tree:
-              Group By Operator
-                aggregations: sum(VALUE._col0)
-                keys: KEY._col0 (type: bigint)
-                mode: mergepartial
-                outputColumnNames: _col0, _col1
-                Statistics: Num rows: 63129535 Data size: 7560736760 Basic stats: COMPLETE Column stats: COMPLETE
-                Select Operator
-                  expressions: _col1 (type: decimal(28,2))
-                  outputColumnNames: _col1
-                  Statistics: Num rows: 63129535 Data size: 7560736760 Basic stats: COMPLETE Column stats: COMPLETE
-                  Group By Operator
-                    aggregations: max(_col1)
-                    minReductionHashAggr: 0.99
-                    mode: hash
-                    outputColumnNames: _col0
-                    Statistics: Num rows: 1 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
-                    Reduce Output Operator
-                      null sort order: 
-                      sort order: 
-                      Statistics: Num rows: 1 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
-                      value expressions: _col0 (type: decimal(28,2))
-        Reducer 9 
-            Execution mode: vectorized, llap
-            Reduce Operator Tree:
-              Group By Operator
-                aggregations: max(VALUE._col0)
-                mode: mergepartial
-                outputColumnNames: _col0
-                Statistics: Num rows: 1 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
-                Filter Operator
-                  predicate: _col0 is not null (type: boolean)
-                  Statistics: Num rows: 1 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
-                  Select Operator
-                    expressions: (0.95 * _col0) (type: decimal(31,4))
-                    outputColumnNames: _col0
-                    Statistics: Num rows: 1 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
-                    Reduce Output Operator
-                      null sort order: 
-                      sort order: 
-                      Statistics: Num rows: 1 Data size: 112 Basic stats: COMPLETE Column stats: COMPLETE
-                      value expressions: _col0 (type: decimal(31,4))
         Union 2 
             Vertex: Union 2
 
diff --git a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query33.q.out b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query33.q.out
index 1df607292b..1afe5a217b 100644
--- a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query33.q.out
+++ b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query33.q.out
@@ -7,16 +7,17 @@ STAGE PLANS:
     Tez
 #### A masked pattern was here ####
       Edges:
-        Map 1 <- Map 11 (BROADCAST_EDGE), Map 12 (BROADCAST_EDGE), Map 6 (BROADCAST_EDGE)
-        Map 12 <- Reducer 8 (BROADCAST_EDGE)
-        Map 13 <- Map 11 (BROADCAST_EDGE), Map 12 (BROADCAST_EDGE), Map 6 (BROADCAST_EDGE)
-        Map 9 <- Map 11 (BROADCAST_EDGE), Map 12 (BROADCAST_EDGE), Map 6 (BROADCAST_EDGE)
-        Reducer 10 <- Map 9 (SIMPLE_EDGE), Union 3 (CONTAINS)
-        Reducer 14 <- Map 13 (SIMPLE_EDGE), Union 3 (CONTAINS)
+        Map 1 <- Map 13 (BROADCAST_EDGE), Map 6 (BROADCAST_EDGE), Map 7 (BROADCAST_EDGE), Reducer 9 (BROADCAST_EDGE)
+        Map 11 <- Map 13 (BROADCAST_EDGE), Map 6 (BROADCAST_EDGE), Map 7 (BROADCAST_EDGE), Reducer 8 (BROADCAST_EDGE)
+        Map 14 <- Map 13 (BROADCAST_EDGE), Map 6 (BROADCAST_EDGE), Map 7 (BROADCAST_EDGE), Reducer 10 (BROADCAST_EDGE)
+        Reducer 10 <- Map 7 (SIMPLE_EDGE)
+        Reducer 12 <- Map 11 (SIMPLE_EDGE), Union 3 (CONTAINS)
+        Reducer 15 <- Map 14 (SIMPLE_EDGE), Union 3 (CONTAINS)
         Reducer 2 <- Map 1 (SIMPLE_EDGE), Union 3 (CONTAINS)
         Reducer 4 <- Union 3 (SIMPLE_EDGE)
         Reducer 5 <- Reducer 4 (SIMPLE_EDGE)
         Reducer 8 <- Map 7 (SIMPLE_EDGE)
+        Reducer 9 <- Map 7 (SIMPLE_EDGE)
 #### A masked pattern was here ####
       Vertices:
         Map 1 
@@ -24,7 +25,7 @@ STAGE PLANS:
                 TableScan
                   alias: store_sales
                   filterExpr: ss_addr_sk is not null (type: boolean)
-                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_274_container, bigKeyColName:ss_addr_sk, smallTablePos:1, keyRatio:1.5949411774215885E-8
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_271_container, bigKeyColName:ss_addr_sk, smallTablePos:1, keyRatio:1.5949411774215885E-8
                   Statistics: Num rows: 82510879939 Data size: 10987909046272 Basic stats: COMPLETE Column stats: COMPLETE
                   Filter Operator
                     predicate: ss_addr_sk is not null (type: boolean)
@@ -51,7 +52,7 @@ STAGE PLANS:
                             1 _col0 (type: bigint)
                           outputColumnNames: _col0, _col2
                           input vertices:
-                            1 Map 11
+                            1 Map 13
                           Statistics: Num rows: 227952808 Data size: 1823622576 Basic stats: COMPLETE Column stats: COMPLETE
                           Map Join Operator
                             condition map:
@@ -59,27 +60,107 @@ STAGE PLANS:
                             keys:
                               0 _col0 (type: bigint)
                               1 _col0 (type: bigint)
-                            outputColumnNames: _col2, _col7
+                            outputColumnNames: _col2, _col10
                             input vertices:
-                              1 Map 12
-                            Statistics: Num rows: 487484 Data size: 1945456 Basic stats: COMPLETE Column stats: COMPLETE
-                            Group By Operator
-                              aggregations: sum(_col2)
-                              keys: _col7 (type: int)
-                              minReductionHashAggr: 0.99
-                              mode: hash
-                              outputColumnNames: _col0, _col1
-                              Statistics: Num rows: 988 Data size: 114604 Basic stats: COMPLETE Column stats: COMPLETE
-                              Reduce Output Operator
-                                key expressions: _col0 (type: int)
-                                null sort order: z
-                                sort order: +
-                                Map-reduce partition columns: _col0 (type: int)
-                                Statistics: Num rows: 988 Data size: 114604 Basic stats: COMPLETE Column stats: COMPLETE
-                                value expressions: _col1 (type: decimal(17,2))
+                              1 Reducer 9
+                            Statistics: Num rows: 227384408 Data size: 909533152 Basic stats: COMPLETE Column stats: COMPLETE
+                            Map Join Operator
+                              condition map:
+                                   Left Semi Join 0 to 1
+                              keys:
+                                0 _col10 (type: int)
+                                1 _col0 (type: int)
+                              outputColumnNames: _col2, _col10
+                              input vertices:
+                                1 Map 7
+                              Statistics: Num rows: 227384408 Data size: 909533152 Basic stats: COMPLETE Column stats: COMPLETE
+                              Group By Operator
+                                aggregations: sum(_col2)
+                                keys: _col10 (type: int)
+                                minReductionHashAggr: 0.99
+                                mode: hash
+                                outputColumnNames: _col0, _col1
+                                Statistics: Num rows: 3952 Data size: 458432 Basic stats: COMPLETE Column stats: COMPLETE
+                                Reduce Output Operator
+                                  key expressions: _col0 (type: int)
+                                  null sort order: z
+                                  sort order: +
+                                  Map-reduce partition columns: _col0 (type: int)
+                                  Statistics: Num rows: 3952 Data size: 458432 Basic stats: COMPLETE Column stats: COMPLETE
+                                  value expressions: _col1 (type: decimal(17,2))
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
         Map 11 
+            Map Operator Tree:
+                TableScan
+                  alias: catalog_sales
+                  filterExpr: cs_bill_addr_sk is not null (type: boolean)
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_275_container, bigKeyColName:cs_item_sk, smallTablePos:1, keyRatio:0.0027954892505937553
+                  Statistics: Num rows: 43005109025 Data size: 5835793041376 Basic stats: COMPLETE Column stats: COMPLETE
+                  Filter Operator
+                    predicate: cs_bill_addr_sk is not null (type: boolean)
+                    Statistics: Num rows: 42898229145 Data size: 5821289442328 Basic stats: COMPLETE Column stats: COMPLETE
+                    Select Operator
+                      expressions: cs_bill_addr_sk (type: bigint), cs_item_sk (type: bigint), cs_ext_sales_price (type: decimal(7,2)), cs_sold_date_sk (type: bigint)
+                      outputColumnNames: _col0, _col1, _col2, _col3
+                      Statistics: Num rows: 42898229145 Data size: 5821289442328 Basic stats: COMPLETE Column stats: COMPLETE
+                      Map Join Operator
+                        condition map:
+                             Inner Join 0 to 1
+                        keys:
+                          0 _col3 (type: bigint)
+                          1 _col0 (type: bigint)
+                        outputColumnNames: _col0, _col1, _col2
+                        input vertices:
+                          1 Map 6
+                        Statistics: Num rows: 723125004 Data size: 79690279120 Basic stats: COMPLETE Column stats: COMPLETE
+                        Map Join Operator
+                          condition map:
+                               Inner Join 0 to 1
+                          keys:
+                            0 _col0 (type: bigint)
+                            1 _col0 (type: bigint)
+                          outputColumnNames: _col1, _col2
+                          input vertices:
+                            1 Map 13
+                          Statistics: Num rows: 120520838 Data size: 2445693184 Basic stats: COMPLETE Column stats: COMPLETE
+                          Map Join Operator
+                            condition map:
+                                 Inner Join 0 to 1
+                            keys:
+                              0 _col1 (type: bigint)
+                              1 _col0 (type: bigint)
+                            outputColumnNames: _col2, _col10
+                            input vertices:
+                              1 Reducer 8
+                            Statistics: Num rows: 120220320 Data size: 1928745152 Basic stats: COMPLETE Column stats: COMPLETE
+                            Map Join Operator
+                              condition map:
+                                   Left Semi Join 0 to 1
+                              keys:
+                                0 _col10 (type: int)
+                                1 _col0 (type: int)
+                              outputColumnNames: _col2, _col10
+                              input vertices:
+                                1 Map 7
+                              Statistics: Num rows: 120220320 Data size: 1928745152 Basic stats: COMPLETE Column stats: COMPLETE
+                              Group By Operator
+                                aggregations: sum(_col2)
+                                keys: _col10 (type: int)
+                                minReductionHashAggr: 0.99
+                                mode: hash
+                                outputColumnNames: _col0, _col1
+                                Statistics: Num rows: 7904 Data size: 916864 Basic stats: COMPLETE Column stats: COMPLETE
+                                Reduce Output Operator
+                                  key expressions: _col0 (type: int)
+                                  null sort order: z
+                                  sort order: +
+                                  Map-reduce partition columns: _col0 (type: int)
+                                  Statistics: Num rows: 7904 Data size: 916864 Basic stats: COMPLETE Column stats: COMPLETE
+                                  value expressions: _col1 (type: decimal(17,2))
+            Execution mode: vectorized, llap
+            LLAP IO: may be used (ACID table)
+        Map 13 
             Map Operator Tree:
                 TableScan
                   alias: customer_address
@@ -91,79 +172,33 @@ STAGE PLANS:
                     Select Operator
                       expressions: ca_address_sk (type: bigint)
                       outputColumnNames: _col0
-                      Statistics: Num rows: 6666667 Data size: 53333336 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 6666667 Data size: 800000040 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
                         key expressions: _col0 (type: bigint)
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 6666667 Data size: 53333336 Basic stats: COMPLETE Column stats: COMPLETE
+                        Statistics: Num rows: 6666667 Data size: 800000040 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
                         key expressions: _col0 (type: bigint)
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 6666667 Data size: 53333336 Basic stats: COMPLETE Column stats: COMPLETE
+                        Statistics: Num rows: 6666667 Data size: 800000040 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
                         key expressions: _col0 (type: bigint)
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 6666667 Data size: 53333336 Basic stats: COMPLETE Column stats: COMPLETE
+                        Statistics: Num rows: 6666667 Data size: 800000040 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
-        Map 12 
-            Map Operator Tree:
-                TableScan
-                  alias: item
-                  filterExpr: i_manufact_id is not null (type: boolean)
-                  Statistics: Num rows: 462000 Data size: 5539396 Basic stats: COMPLETE Column stats: COMPLETE
-                  Filter Operator
-                    predicate: i_manufact_id is not null (type: boolean)
-                    Statistics: Num rows: 460848 Data size: 5525584 Basic stats: COMPLETE Column stats: COMPLETE
-                    Select Operator
-                      expressions: i_item_sk (type: bigint), i_manufact_id (type: int)
-                      outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 460848 Data size: 5525584 Basic stats: COMPLETE Column stats: COMPLETE
-                      Map Join Operator
-                        condition map:
-                             Inner Join 0 to 1
-                        keys:
-                          0 _col1 (type: int)
-                          1 _col0 (type: int)
-                        outputColumnNames: _col0, _col1
-                        input vertices:
-                          1 Reducer 8
-                        Statistics: Num rows: 461314 Data size: 5531176 Basic stats: COMPLETE Column stats: COMPLETE
-                        Reduce Output Operator
-                          key expressions: _col0 (type: bigint)
-                          null sort order: z
-                          sort order: +
-                          Map-reduce partition columns: _col0 (type: bigint)
-                          Statistics: Num rows: 461314 Data size: 5531176 Basic stats: COMPLETE Column stats: COMPLETE
-                          value expressions: _col1 (type: int)
-                        Reduce Output Operator
-                          key expressions: _col0 (type: bigint)
-                          null sort order: z
-                          sort order: +
-                          Map-reduce partition columns: _col0 (type: bigint)
-                          Statistics: Num rows: 461314 Data size: 5531176 Basic stats: COMPLETE Column stats: COMPLETE
-                          value expressions: _col1 (type: int)
-                        Reduce Output Operator
-                          key expressions: _col0 (type: bigint)
-                          null sort order: z
-                          sort order: +
-                          Map-reduce partition columns: _col0 (type: bigint)
-                          Statistics: Num rows: 461314 Data size: 5531176 Basic stats: COMPLETE Column stats: COMPLETE
-                          value expressions: _col1 (type: int)
-            Execution mode: vectorized, llap
-            LLAP IO: may be used (ACID table)
-        Map 13 
+        Map 14 
             Map Operator Tree:
                 TableScan
                   alias: web_sales
                   filterExpr: ws_bill_addr_sk is not null (type: boolean)
-                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_280_container, bigKeyColName:ws_bill_addr_sk, smallTablePos:1, keyRatio:6.09410527196747E-8
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_277_container, bigKeyColName:ws_bill_addr_sk, smallTablePos:1, keyRatio:6.09410527196747E-8
                   Statistics: Num rows: 21594638446 Data size: 2936546611376 Basic stats: COMPLETE Column stats: COMPLETE
                   Filter Operator
                     predicate: ws_bill_addr_sk is not null (type: boolean)
@@ -190,7 +225,7 @@ STAGE PLANS:
                             1 _col0 (type: bigint)
                           outputColumnNames: _col0, _col2
                           input vertices:
-                            1 Map 11
+                            1 Map 13
                           Statistics: Num rows: 61093544 Data size: 7028655600 Basic stats: COMPLETE Column stats: COMPLETE
                           Map Join Operator
                             condition map:
@@ -198,24 +233,34 @@ STAGE PLANS:
                             keys:
                               0 _col0 (type: bigint)
                               1 _col0 (type: bigint)
-                            outputColumnNames: _col2, _col7
+                            outputColumnNames: _col2, _col10
                             input vertices:
-                              1 Map 12
-                            Statistics: Num rows: 130651 Data size: 518124 Basic stats: COMPLETE Column stats: COMPLETE
-                            Group By Operator
-                              aggregations: sum(_col2)
-                              keys: _col7 (type: int)
-                              minReductionHashAggr: 0.99
-                              mode: hash
-                              outputColumnNames: _col0, _col1
-                              Statistics: Num rows: 281 Data size: 32592 Basic stats: COMPLETE Column stats: COMPLETE
-                              Reduce Output Operator
-                                key expressions: _col0 (type: int)
-                                null sort order: z
-                                sort order: +
-                                Map-reduce partition columns: _col0 (type: int)
-                                Statistics: Num rows: 281 Data size: 32592 Basic stats: COMPLETE Column stats: COMPLETE
-                                value expressions: _col1 (type: decimal(17,2))
+                              1 Reducer 10
+                            Statistics: Num rows: 60941208 Data size: 6766605856 Basic stats: COMPLETE Column stats: COMPLETE
+                            Map Join Operator
+                              condition map:
+                                   Left Semi Join 0 to 1
+                              keys:
+                                0 _col10 (type: int)
+                                1 _col0 (type: int)
+                              outputColumnNames: _col2, _col10
+                              input vertices:
+                                1 Map 7
+                              Statistics: Num rows: 60941208 Data size: 6766605856 Basic stats: COMPLETE Column stats: COMPLETE
+                              Group By Operator
+                                aggregations: sum(_col2)
+                                keys: _col10 (type: int)
+                                minReductionHashAggr: 0.99
+                                mode: hash
+                                outputColumnNames: _col0, _col1
+                                Statistics: Num rows: 26676 Data size: 3094416 Basic stats: COMPLETE Column stats: COMPLETE
+                                Reduce Output Operator
+                                  key expressions: _col0 (type: int)
+                                  null sort order: z
+                                  sort order: +
+                                  Map-reduce partition columns: _col0 (type: int)
+                                  Statistics: Num rows: 26676 Data size: 3094416 Basic stats: COMPLETE Column stats: COMPLETE
+                                  value expressions: _col1 (type: decimal(17,2))
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
         Map 6 
@@ -230,13 +275,13 @@ STAGE PLANS:
                     Select Operator
                       expressions: d_date_sk (type: bigint)
                       outputColumnNames: _col0
-                      Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 31 Data size: 496 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
                         key expressions: _col0 (type: bigint)
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
+                        Statistics: Num rows: 31 Data size: 496 Basic stats: COMPLETE Column stats: COMPLETE
                       Select Operator
                         expressions: _col0 (type: bigint)
                         outputColumnNames: _col0
@@ -258,7 +303,7 @@ STAGE PLANS:
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
+                        Statistics: Num rows: 31 Data size: 496 Basic stats: COMPLETE Column stats: COMPLETE
                       Select Operator
                         expressions: _col0 (type: bigint)
                         outputColumnNames: _col0
@@ -274,13 +319,13 @@ STAGE PLANS:
                             Target Input: web_sales
                             Partition key expr: ws_sold_date_sk
                             Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
-                            Target Vertex: Map 13
+                            Target Vertex: Map 14
                       Reduce Output Operator
                         key expressions: _col0 (type: bigint)
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
+                        Statistics: Num rows: 31 Data size: 496 Basic stats: COMPLETE Column stats: COMPLETE
                       Select Operator
                         expressions: _col0 (type: bigint)
                         outputColumnNames: _col0
@@ -296,24 +341,24 @@ STAGE PLANS:
                             Target Input: catalog_sales
                             Partition key expr: cs_sold_date_sk
                             Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
-                            Target Vertex: Map 9
+                            Target Vertex: Map 11
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
         Map 7 
             Map Operator Tree:
                 TableScan
                   alias: item
-                  filterExpr: ((i_category = 'Books                                             ') and i_manufact_id is not null) (type: boolean)
+                  filterExpr: (((i_category = 'Books                                             ') and i_manufact_id is not null) or i_manufact_id is not null) (type: boolean)
                   Statistics: Num rows: 462000 Data size: 43423396 Basic stats: COMPLETE Column stats: COMPLETE
                   Filter Operator
                     predicate: ((i_category = 'Books                                             ') and i_manufact_id is not null) (type: boolean)
                     Statistics: Num rows: 41895 Data size: 3937718 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
                       expressions: i_manufact_id (type: int)
-                      outputColumnNames: i_manufact_id
-                      Statistics: Num rows: 41895 Data size: 3937718 Basic stats: COMPLETE Column stats: COMPLETE
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 41895 Data size: 167168 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
-                        keys: i_manufact_id (type: int)
+                        keys: _col0 (type: int)
                         minReductionHashAggr: 0.97641724
                         mode: hash
                         outputColumnNames: _col0
@@ -324,69 +369,62 @@ STAGE PLANS:
                           sort order: +
                           Map-reduce partition columns: _col0 (type: int)
                           Statistics: Num rows: 988 Data size: 3948 Basic stats: COMPLETE Column stats: COMPLETE
-            Execution mode: vectorized, llap
-            LLAP IO: may be used (ACID table)
-        Map 9 
-            Map Operator Tree:
-                TableScan
-                  alias: catalog_sales
-                  filterExpr: cs_bill_addr_sk is not null (type: boolean)
-                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_283_container, bigKeyColName:cs_item_sk, smallTablePos:1, keyRatio:5.9931948980799036E-6
-                  Statistics: Num rows: 43005109025 Data size: 5835793041376 Basic stats: COMPLETE Column stats: COMPLETE
+                        Reduce Output Operator
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
+                          Statistics: Num rows: 988 Data size: 3948 Basic stats: COMPLETE Column stats: COMPLETE
+                        Reduce Output Operator
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
+                          Statistics: Num rows: 988 Data size: 3948 Basic stats: COMPLETE Column stats: COMPLETE
                   Filter Operator
-                    predicate: cs_bill_addr_sk is not null (type: boolean)
-                    Statistics: Num rows: 42898229145 Data size: 5821289442328 Basic stats: COMPLETE Column stats: COMPLETE
+                    predicate: i_manufact_id is not null (type: boolean)
+                    Statistics: Num rows: 460848 Data size: 5525584 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
-                      expressions: cs_bill_addr_sk (type: bigint), cs_item_sk (type: bigint), cs_ext_sales_price (type: decimal(7,2)), cs_sold_date_sk (type: bigint)
-                      outputColumnNames: _col0, _col1, _col2, _col3
-                      Statistics: Num rows: 42898229145 Data size: 5821289442328 Basic stats: COMPLETE Column stats: COMPLETE
-                      Map Join Operator
-                        condition map:
-                             Inner Join 0 to 1
-                        keys:
-                          0 _col3 (type: bigint)
-                          1 _col0 (type: bigint)
-                        outputColumnNames: _col0, _col1, _col2
-                        input vertices:
-                          1 Map 6
-                        Statistics: Num rows: 723125004 Data size: 79690279120 Basic stats: COMPLETE Column stats: COMPLETE
-                        Map Join Operator
-                          condition map:
-                               Inner Join 0 to 1
-                          keys:
-                            0 _col0 (type: bigint)
-                            1 _col0 (type: bigint)
-                          outputColumnNames: _col1, _col2
-                          input vertices:
-                            1 Map 11
-                          Statistics: Num rows: 120520838 Data size: 2445693184 Basic stats: COMPLETE Column stats: COMPLETE
-                          Map Join Operator
-                            condition map:
-                                 Inner Join 0 to 1
-                            keys:
-                              0 _col1 (type: bigint)
-                              1 _col0 (type: bigint)
-                            outputColumnNames: _col2, _col7
-                            input vertices:
-                              1 Map 12
-                            Statistics: Num rows: 257738 Data size: 1026472 Basic stats: COMPLETE Column stats: COMPLETE
-                            Group By Operator
-                              aggregations: sum(_col2)
-                              keys: _col7 (type: int)
-                              minReductionHashAggr: 0.99
-                              mode: hash
-                              outputColumnNames: _col0, _col1
-                              Statistics: Num rows: 553 Data size: 64144 Basic stats: COMPLETE Column stats: COMPLETE
-                              Reduce Output Operator
-                                key expressions: _col0 (type: int)
-                                null sort order: z
-                                sort order: +
-                                Map-reduce partition columns: _col0 (type: int)
-                                Statistics: Num rows: 553 Data size: 64144 Basic stats: COMPLETE Column stats: COMPLETE
-                                value expressions: _col1 (type: decimal(17,2))
+                      expressions: i_item_sk (type: bigint), i_manufact_id (type: int)
+                      outputColumnNames: _col0, _col1
+                      Statistics: Num rows: 460848 Data size: 5525584 Basic stats: COMPLETE Column stats: COMPLETE
+                      Reduce Output Operator
+                        key expressions: _col0 (type: bigint)
+                        null sort order: z
+                        sort order: +
+                        Map-reduce partition columns: _col0 (type: bigint)
+                        Statistics: Num rows: 460848 Data size: 5525584 Basic stats: COMPLETE Column stats: COMPLETE
+                        value expressions: _col1 (type: int)
+                      Reduce Output Operator
+                        key expressions: _col0 (type: bigint)
+                        null sort order: z
+                        sort order: +
+                        Map-reduce partition columns: _col0 (type: bigint)
+                        Statistics: Num rows: 460848 Data size: 5525584 Basic stats: COMPLETE Column stats: COMPLETE
+                        value expressions: _col1 (type: int)
+                      Reduce Output Operator
+                        key expressions: _col0 (type: bigint)
+                        null sort order: z
+                        sort order: +
+                        Map-reduce partition columns: _col0 (type: bigint)
+                        Statistics: Num rows: 460848 Data size: 5525584 Basic stats: COMPLETE Column stats: COMPLETE
+                        value expressions: _col1 (type: int)
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
         Reducer 10 
+            Execution mode: vectorized, llap
+            Reduce Operator Tree:
+              Select Operator
+                expressions: KEY.reducesinkkey0 (type: bigint), VALUE._col0 (type: int)
+                outputColumnNames: _col0, _col1
+                Reduce Output Operator
+                  key expressions: _col0 (type: bigint)
+                  null sort order: z
+                  sort order: +
+                  Map-reduce partition columns: _col0 (type: bigint)
+                  Statistics: Num rows: 460848 Data size: 5525584 Basic stats: COMPLETE Column stats: COMPLETE
+                  value expressions: _col1 (type: int)
+        Reducer 12 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Group By Operator
@@ -394,22 +432,22 @@ STAGE PLANS:
                 keys: KEY._col0 (type: int)
                 mode: mergepartial
                 outputColumnNames: _col0, _col1
-                Statistics: Num rows: 553 Data size: 64144 Basic stats: COMPLETE Column stats: COMPLETE
+                Statistics: Num rows: 987 Data size: 114492 Basic stats: COMPLETE Column stats: COMPLETE
                 Group By Operator
                   aggregations: sum(_col1)
                   keys: _col0 (type: int)
-                  minReductionHashAggr: 0.45773876
+                  minReductionHashAggr: 0.66677916
                   mode: hash
                   outputColumnNames: _col0, _col1
-                  Statistics: Num rows: 987 Data size: 114480 Basic stats: COMPLETE Column stats: COMPLETE
+                  Statistics: Num rows: 987 Data size: 114492 Basic stats: COMPLETE Column stats: COMPLETE
                   Reduce Output Operator
                     key expressions: _col0 (type: int)
                     null sort order: z
                     sort order: +
                     Map-reduce partition columns: _col0 (type: int)
-                    Statistics: Num rows: 987 Data size: 114480 Basic stats: COMPLETE Column stats: COMPLETE
+                    Statistics: Num rows: 987 Data size: 114492 Basic stats: COMPLETE Column stats: COMPLETE
                     value expressions: _col1 (type: decimal(27,2))
-        Reducer 14 
+        Reducer 15 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Group By Operator
@@ -417,20 +455,20 @@ STAGE PLANS:
                 keys: KEY._col0 (type: int)
                 mode: mergepartial
                 outputColumnNames: _col0, _col1
-                Statistics: Num rows: 281 Data size: 32592 Basic stats: COMPLETE Column stats: COMPLETE
+                Statistics: Num rows: 988 Data size: 114608 Basic stats: COMPLETE Column stats: COMPLETE
                 Group By Operator
                   aggregations: sum(_col1)
                   keys: _col0 (type: int)
-                  minReductionHashAggr: 0.45773876
+                  minReductionHashAggr: 0.66677916
                   mode: hash
                   outputColumnNames: _col0, _col1
-                  Statistics: Num rows: 987 Data size: 114480 Basic stats: COMPLETE Column stats: COMPLETE
+                  Statistics: Num rows: 987 Data size: 114492 Basic stats: COMPLETE Column stats: COMPLETE
                   Reduce Output Operator
                     key expressions: _col0 (type: int)
                     null sort order: z
                     sort order: +
                     Map-reduce partition columns: _col0 (type: int)
-                    Statistics: Num rows: 987 Data size: 114480 Basic stats: COMPLETE Column stats: COMPLETE
+                    Statistics: Num rows: 987 Data size: 114492 Basic stats: COMPLETE Column stats: COMPLETE
                     value expressions: _col1 (type: decimal(27,2))
         Reducer 2 
             Execution mode: vectorized, llap
@@ -440,20 +478,20 @@ STAGE PLANS:
                 keys: KEY._col0 (type: int)
                 mode: mergepartial
                 outputColumnNames: _col0, _col1
-                Statistics: Num rows: 988 Data size: 114604 Basic stats: COMPLETE Column stats: COMPLETE
+                Statistics: Num rows: 987 Data size: 114492 Basic stats: COMPLETE Column stats: COMPLETE
                 Group By Operator
                   aggregations: sum(_col1)
                   keys: _col0 (type: int)
-                  minReductionHashAggr: 0.45773876
+                  minReductionHashAggr: 0.66677916
                   mode: hash
                   outputColumnNames: _col0, _col1
-                  Statistics: Num rows: 987 Data size: 114480 Basic stats: COMPLETE Column stats: COMPLETE
+                  Statistics: Num rows: 987 Data size: 114492 Basic stats: COMPLETE Column stats: COMPLETE
                   Reduce Output Operator
                     key expressions: _col0 (type: int)
                     null sort order: z
                     sort order: +
                     Map-reduce partition columns: _col0 (type: int)
-                    Statistics: Num rows: 987 Data size: 114480 Basic stats: COMPLETE Column stats: COMPLETE
+                    Statistics: Num rows: 987 Data size: 114492 Basic stats: COMPLETE Column stats: COMPLETE
                     value expressions: _col1 (type: decimal(27,2))
         Reducer 4 
             Execution mode: vectorized, llap
@@ -463,18 +501,18 @@ STAGE PLANS:
                 keys: KEY._col0 (type: int)
                 mode: mergepartial
                 outputColumnNames: _col0, _col1
-                Statistics: Num rows: 987 Data size: 114480 Basic stats: COMPLETE Column stats: COMPLETE
+                Statistics: Num rows: 987 Data size: 114492 Basic stats: COMPLETE Column stats: COMPLETE
                 Top N Key Operator
                   sort order: +
                   keys: _col1 (type: decimal(27,2))
                   null sort order: z
-                  Statistics: Num rows: 987 Data size: 114480 Basic stats: COMPLETE Column stats: COMPLETE
+                  Statistics: Num rows: 987 Data size: 114492 Basic stats: COMPLETE Column stats: COMPLETE
                   top n: 100
                   Reduce Output Operator
                     key expressions: _col1 (type: decimal(27,2))
                     null sort order: z
                     sort order: +
-                    Statistics: Num rows: 987 Data size: 114480 Basic stats: COMPLETE Column stats: COMPLETE
+                    Statistics: Num rows: 987 Data size: 114492 Basic stats: COMPLETE Column stats: COMPLETE
                     value expressions: _col0 (type: int)
         Reducer 5 
             Execution mode: vectorized, llap
@@ -482,7 +520,7 @@ STAGE PLANS:
               Select Operator
                 expressions: VALUE._col0 (type: int), KEY.reducesinkkey0 (type: decimal(27,2))
                 outputColumnNames: _col0, _col1
-                Statistics: Num rows: 987 Data size: 114464 Basic stats: COMPLETE Column stats: COMPLETE
+                Statistics: Num rows: 987 Data size: 114492 Basic stats: COMPLETE Column stats: COMPLETE
                 Limit
                   Number of rows: 100
                   Statistics: Num rows: 100 Data size: 11600 Basic stats: COMPLETE Column stats: COMPLETE
@@ -496,17 +534,29 @@ STAGE PLANS:
         Reducer 8 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
-              Group By Operator
-                keys: KEY._col0 (type: int)
-                mode: mergepartial
-                outputColumnNames: _col0
-                Statistics: Num rows: 988 Data size: 3948 Basic stats: COMPLETE Column stats: COMPLETE
+              Select Operator
+                expressions: KEY.reducesinkkey0 (type: bigint), VALUE._col0 (type: int)
+                outputColumnNames: _col0, _col1
+                Reduce Output Operator
+                  key expressions: _col0 (type: bigint)
+                  null sort order: z
+                  sort order: +
+                  Map-reduce partition columns: _col0 (type: bigint)
+                  Statistics: Num rows: 460848 Data size: 5525584 Basic stats: COMPLETE Column stats: COMPLETE
+                  value expressions: _col1 (type: int)
+        Reducer 9 
+            Execution mode: vectorized, llap
+            Reduce Operator Tree:
+              Select Operator
+                expressions: KEY.reducesinkkey0 (type: bigint), VALUE._col0 (type: int)
+                outputColumnNames: _col0, _col1
                 Reduce Output Operator
-                  key expressions: _col0 (type: int)
+                  key expressions: _col0 (type: bigint)
                   null sort order: z
                   sort order: +
-                  Map-reduce partition columns: _col0 (type: int)
-                  Statistics: Num rows: 988 Data size: 3948 Basic stats: COMPLETE Column stats: COMPLETE
+                  Map-reduce partition columns: _col0 (type: bigint)
+                  Statistics: Num rows: 460848 Data size: 5525584 Basic stats: COMPLETE Column stats: COMPLETE
+                  value expressions: _col1 (type: int)
         Union 3 
             Vertex: Union 3
 
diff --git a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query56.q.out b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query56.q.out
index fa7ec3db82..b1b56d98e9 100644
--- a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query56.q.out
+++ b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query56.q.out
@@ -7,16 +7,17 @@ STAGE PLANS:
     Tez
 #### A masked pattern was here ####
       Edges:
-        Map 1 <- Map 11 (BROADCAST_EDGE), Map 12 (BROADCAST_EDGE), Map 6 (BROADCAST_EDGE)
-        Map 12 <- Reducer 8 (BROADCAST_EDGE)
-        Map 13 <- Map 11 (BROADCAST_EDGE), Map 12 (BROADCAST_EDGE), Map 6 (BROADCAST_EDGE)
-        Map 9 <- Map 11 (BROADCAST_EDGE), Map 12 (BROADCAST_EDGE), Map 6 (BROADCAST_EDGE)
-        Reducer 10 <- Map 9 (SIMPLE_EDGE), Union 3 (CONTAINS)
-        Reducer 14 <- Map 13 (SIMPLE_EDGE), Union 3 (CONTAINS)
+        Map 1 <- Map 13 (BROADCAST_EDGE), Map 6 (BROADCAST_EDGE), Map 7 (BROADCAST_EDGE), Reducer 9 (BROADCAST_EDGE)
+        Map 11 <- Map 13 (BROADCAST_EDGE), Map 6 (BROADCAST_EDGE), Map 7 (BROADCAST_EDGE), Reducer 8 (BROADCAST_EDGE)
+        Map 14 <- Map 13 (BROADCAST_EDGE), Map 6 (BROADCAST_EDGE), Map 7 (BROADCAST_EDGE), Reducer 10 (BROADCAST_EDGE)
+        Reducer 10 <- Map 7 (SIMPLE_EDGE)
+        Reducer 12 <- Map 11 (SIMPLE_EDGE), Union 3 (CONTAINS)
+        Reducer 15 <- Map 14 (SIMPLE_EDGE), Union 3 (CONTAINS)
         Reducer 2 <- Map 1 (SIMPLE_EDGE), Union 3 (CONTAINS)
         Reducer 4 <- Union 3 (SIMPLE_EDGE)
         Reducer 5 <- Reducer 4 (SIMPLE_EDGE)
         Reducer 8 <- Map 7 (SIMPLE_EDGE)
+        Reducer 9 <- Map 7 (SIMPLE_EDGE)
 #### A masked pattern was here ####
       Vertices:
         Map 1 
@@ -24,7 +25,7 @@ STAGE PLANS:
                 TableScan
                   alias: store_sales
                   filterExpr: ss_addr_sk is not null (type: boolean)
-                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_271_container, bigKeyColName:ss_addr_sk, smallTablePos:1, keyRatio:1.5949411774215885E-8
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_268_container, bigKeyColName:ss_addr_sk, smallTablePos:1, keyRatio:1.5949411774215885E-8
                   Statistics: Num rows: 82510879939 Data size: 10987909046272 Basic stats: COMPLETE Column stats: COMPLETE
                   Filter Operator
                     predicate: ss_addr_sk is not null (type: boolean)
@@ -51,7 +52,7 @@ STAGE PLANS:
                             1 _col0 (type: bigint)
                           outputColumnNames: _col0, _col2
                           input vertices:
-                            1 Map 11
+                            1 Map 13
                           Statistics: Num rows: 227952808 Data size: 1823622576 Basic stats: COMPLETE Column stats: COMPLETE
                           Map Join Operator
                             condition map:
@@ -59,27 +60,107 @@ STAGE PLANS:
                             keys:
                               0 _col0 (type: bigint)
                               1 _col0 (type: bigint)
-                            outputColumnNames: _col2, _col7
+                            outputColumnNames: _col2, _col10
                             input vertices:
-                              1 Map 12
-                            Statistics: Num rows: 7198277 Data size: 719827812 Basic stats: COMPLETE Column stats: COMPLETE
-                            Group By Operator
-                              aggregations: sum(_col2)
-                              keys: _col7 (type: string)
-                              minReductionHashAggr: 0.99
-                              mode: hash
-                              outputColumnNames: _col0, _col1
-                              Statistics: Num rows: 2580 Data size: 546960 Basic stats: COMPLETE Column stats: COMPLETE
-                              Reduce Output Operator
-                                key expressions: _col0 (type: string)
-                                null sort order: z
-                                sort order: +
-                                Map-reduce partition columns: _col0 (type: string)
-                                Statistics: Num rows: 2580 Data size: 546960 Basic stats: COMPLETE Column stats: COMPLETE
-                                value expressions: _col1 (type: decimal(17,2))
+                              1 Reducer 9
+                            Statistics: Num rows: 227952808 Data size: 22795280912 Basic stats: COMPLETE Column stats: COMPLETE
+                            Map Join Operator
+                              condition map:
+                                   Left Semi Join 0 to 1
+                              keys:
+                                0 _col10 (type: string)
+                                1 _col0 (type: string)
+                              outputColumnNames: _col2, _col10
+                              input vertices:
+                                1 Map 7
+                              Statistics: Num rows: 13435479 Data size: 1343548012 Basic stats: COMPLETE Column stats: COMPLETE
+                              Group By Operator
+                                aggregations: sum(_col2)
+                                keys: _col10 (type: string)
+                                minReductionHashAggr: 0.99
+                                mode: hash
+                                outputColumnNames: _col0, _col1
+                                Statistics: Num rows: 5160 Data size: 1093920 Basic stats: COMPLETE Column stats: COMPLETE
+                                Reduce Output Operator
+                                  key expressions: _col0 (type: string)
+                                  null sort order: z
+                                  sort order: +
+                                  Map-reduce partition columns: _col0 (type: string)
+                                  Statistics: Num rows: 5160 Data size: 1093920 Basic stats: COMPLETE Column stats: COMPLETE
+                                  value expressions: _col1 (type: decimal(17,2))
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
         Map 11 
+            Map Operator Tree:
+                TableScan
+                  alias: catalog_sales
+                  filterExpr: cs_bill_addr_sk is not null (type: boolean)
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_271_container, bigKeyColName:cs_bill_addr_sk, smallTablePos:1, keyRatio:0.002802477211020162
+                  Statistics: Num rows: 43005109025 Data size: 5835793041376 Basic stats: COMPLETE Column stats: COMPLETE
+                  Filter Operator
+                    predicate: cs_bill_addr_sk is not null (type: boolean)
+                    Statistics: Num rows: 42898229145 Data size: 5821289442328 Basic stats: COMPLETE Column stats: COMPLETE
+                    Select Operator
+                      expressions: cs_bill_addr_sk (type: bigint), cs_item_sk (type: bigint), cs_ext_sales_price (type: decimal(7,2)), cs_sold_date_sk (type: bigint)
+                      outputColumnNames: _col0, _col1, _col2, _col3
+                      Statistics: Num rows: 42898229145 Data size: 5821289442328 Basic stats: COMPLETE Column stats: COMPLETE
+                      Map Join Operator
+                        condition map:
+                             Inner Join 0 to 1
+                        keys:
+                          0 _col3 (type: bigint)
+                          1 _col0 (type: bigint)
+                        outputColumnNames: _col0, _col1, _col2
+                        input vertices:
+                          1 Map 6
+                        Statistics: Num rows: 723125004 Data size: 79690279120 Basic stats: COMPLETE Column stats: COMPLETE
+                        Map Join Operator
+                          condition map:
+                               Inner Join 0 to 1
+                          keys:
+                            0 _col0 (type: bigint)
+                            1 _col0 (type: bigint)
+                          outputColumnNames: _col1, _col2
+                          input vertices:
+                            1 Map 13
+                          Statistics: Num rows: 120520838 Data size: 2445693184 Basic stats: COMPLETE Column stats: COMPLETE
+                          Map Join Operator
+                            condition map:
+                                 Inner Join 0 to 1
+                            keys:
+                              0 _col1 (type: bigint)
+                              1 _col0 (type: bigint)
+                            outputColumnNames: _col2, _col10
+                            input vertices:
+                              1 Reducer 8
+                            Statistics: Num rows: 120520838 Data size: 13533610280 Basic stats: COMPLETE Column stats: COMPLETE
+                            Map Join Operator
+                              condition map:
+                                   Left Semi Join 0 to 1
+                              keys:
+                                0 _col10 (type: string)
+                                1 _col0 (type: string)
+                              outputColumnNames: _col2, _col10
+                              input vertices:
+                                1 Map 7
+                              Statistics: Num rows: 7103466 Data size: 710346712 Basic stats: COMPLETE Column stats: COMPLETE
+                              Group By Operator
+                                aggregations: sum(_col2)
+                                keys: _col10 (type: string)
+                                minReductionHashAggr: 0.99
+                                mode: hash
+                                outputColumnNames: _col0, _col1
+                                Statistics: Num rows: 2580 Data size: 546960 Basic stats: COMPLETE Column stats: COMPLETE
+                                Reduce Output Operator
+                                  key expressions: _col0 (type: string)
+                                  null sort order: z
+                                  sort order: +
+                                  Map-reduce partition columns: _col0 (type: string)
+                                  Statistics: Num rows: 2580 Data size: 546960 Basic stats: COMPLETE Column stats: COMPLETE
+                                  value expressions: _col1 (type: decimal(17,2))
+            Execution mode: vectorized, llap
+            LLAP IO: may be used (ACID table)
+        Map 13 
             Map Operator Tree:
                 TableScan
                   alias: customer_address
@@ -91,75 +172,33 @@ STAGE PLANS:
                     Select Operator
                       expressions: ca_address_sk (type: bigint)
                       outputColumnNames: _col0
-                      Statistics: Num rows: 6666667 Data size: 53333336 Basic stats: COMPLETE Column stats: COMPLETE
-                      Reduce Output Operator
-                        key expressions: _col0 (type: bigint)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 6666667 Data size: 53333336 Basic stats: COMPLETE Column stats: COMPLETE
-                      Reduce Output Operator
-                        key expressions: _col0 (type: bigint)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 6666667 Data size: 53333336 Basic stats: COMPLETE Column stats: COMPLETE
-                      Reduce Output Operator
-                        key expressions: _col0 (type: bigint)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 6666667 Data size: 53333336 Basic stats: COMPLETE Column stats: COMPLETE
-            Execution mode: vectorized, llap
-            LLAP IO: may be used (ACID table)
-        Map 12 
-            Map Operator Tree:
-                TableScan
-                  alias: item
-                  Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
-                  Select Operator
-                    expressions: i_item_sk (type: bigint), i_item_id (type: string)
-                    outputColumnNames: _col0, _col1
-                    Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
-                    Map Join Operator
-                      condition map:
-                           Inner Join 0 to 1
-                      keys:
-                        0 _col1 (type: string)
-                        1 _col0 (type: string)
-                      outputColumnNames: _col0, _col1
-                      input vertices:
-                        1 Reducer 8
-                      Statistics: Num rows: 27230 Data size: 2940840 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 6666667 Data size: 800000040 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
                         key expressions: _col0 (type: bigint)
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 27230 Data size: 2940840 Basic stats: COMPLETE Column stats: COMPLETE
-                        value expressions: _col1 (type: string)
+                        Statistics: Num rows: 6666667 Data size: 800000040 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
                         key expressions: _col0 (type: bigint)
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 27230 Data size: 2940840 Basic stats: COMPLETE Column stats: COMPLETE
-                        value expressions: _col1 (type: string)
+                        Statistics: Num rows: 6666667 Data size: 800000040 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
                         key expressions: _col0 (type: bigint)
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 27230 Data size: 2940840 Basic stats: COMPLETE Column stats: COMPLETE
-                        value expressions: _col1 (type: string)
+                        Statistics: Num rows: 6666667 Data size: 800000040 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
-        Map 13 
+        Map 14 
             Map Operator Tree:
                 TableScan
                   alias: web_sales
                   filterExpr: ws_bill_addr_sk is not null (type: boolean)
-                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_277_container, bigKeyColName:ws_bill_addr_sk, smallTablePos:1, keyRatio:6.09410527196747E-8
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_274_container, bigKeyColName:ws_bill_addr_sk, smallTablePos:1, keyRatio:6.09410527196747E-8
                   Statistics: Num rows: 21594638446 Data size: 2936546611376 Basic stats: COMPLETE Column stats: COMPLETE
                   Filter Operator
                     predicate: ws_bill_addr_sk is not null (type: boolean)
@@ -186,7 +225,7 @@ STAGE PLANS:
                             1 _col0 (type: bigint)
                           outputColumnNames: _col0, _col2
                           input vertices:
-                            1 Map 11
+                            1 Map 13
                           Statistics: Num rows: 61093544 Data size: 7028655600 Basic stats: COMPLETE Column stats: COMPLETE
                           Map Join Operator
                             condition map:
@@ -194,24 +233,34 @@ STAGE PLANS:
                             keys:
                               0 _col0 (type: bigint)
                               1 _col0 (type: bigint)
-                            outputColumnNames: _col2, _col7
+                            outputColumnNames: _col2, _col10
                             input vertices:
-                              1 Map 12
-                            Statistics: Num rows: 1929208 Data size: 192920912 Basic stats: COMPLETE Column stats: COMPLETE
-                            Group By Operator
-                              aggregations: sum(_col2)
-                              keys: _col7 (type: string)
-                              minReductionHashAggr: 0.99
-                              mode: hash
-                              outputColumnNames: _col0, _col1
-                              Statistics: Num rows: 860 Data size: 182320 Basic stats: COMPLETE Column stats: COMPLETE
-                              Reduce Output Operator
-                                key expressions: _col0 (type: string)
-                                null sort order: z
-                                sort order: +
-                                Map-reduce partition columns: _col0 (type: string)
-                                Statistics: Num rows: 860 Data size: 182320 Basic stats: COMPLETE Column stats: COMPLETE
-                                value expressions: _col1 (type: decimal(17,2))
+                              1 Reducer 10
+                            Statistics: Num rows: 61093544 Data size: 12649261648 Basic stats: COMPLETE Column stats: COMPLETE
+                            Map Join Operator
+                              condition map:
+                                   Left Semi Join 0 to 1
+                              keys:
+                                0 _col10 (type: string)
+                                1 _col0 (type: string)
+                              outputColumnNames: _col2, _col10
+                              input vertices:
+                                1 Map 7
+                              Statistics: Num rows: 3600837 Data size: 460807764 Basic stats: COMPLETE Column stats: COMPLETE
+                              Group By Operator
+                                aggregations: sum(_col2)
+                                keys: _col10 (type: string)
+                                minReductionHashAggr: 0.99
+                                mode: hash
+                                outputColumnNames: _col0, _col1
+                                Statistics: Num rows: 1720 Data size: 364640 Basic stats: COMPLETE Column stats: COMPLETE
+                                Reduce Output Operator
+                                  key expressions: _col0 (type: string)
+                                  null sort order: z
+                                  sort order: +
+                                  Map-reduce partition columns: _col0 (type: string)
+                                  Statistics: Num rows: 1720 Data size: 364640 Basic stats: COMPLETE Column stats: COMPLETE
+                                  value expressions: _col1 (type: decimal(17,2))
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
         Map 6 
@@ -226,13 +275,13 @@ STAGE PLANS:
                     Select Operator
                       expressions: d_date_sk (type: bigint)
                       outputColumnNames: _col0
-                      Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 31 Data size: 496 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
                         key expressions: _col0 (type: bigint)
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
+                        Statistics: Num rows: 31 Data size: 496 Basic stats: COMPLETE Column stats: COMPLETE
                       Select Operator
                         expressions: _col0 (type: bigint)
                         outputColumnNames: _col0
@@ -254,7 +303,7 @@ STAGE PLANS:
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
+                        Statistics: Num rows: 31 Data size: 496 Basic stats: COMPLETE Column stats: COMPLETE
                       Select Operator
                         expressions: _col0 (type: bigint)
                         outputColumnNames: _col0
@@ -270,13 +319,13 @@ STAGE PLANS:
                             Target Input: web_sales
                             Partition key expr: ws_sold_date_sk
                             Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
-                            Target Vertex: Map 13
+                            Target Vertex: Map 14
                       Reduce Output Operator
                         key expressions: _col0 (type: bigint)
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
+                        Statistics: Num rows: 31 Data size: 496 Basic stats: COMPLETE Column stats: COMPLETE
                       Select Operator
                         expressions: _col0 (type: bigint)
                         outputColumnNames: _col0
@@ -292,24 +341,23 @@ STAGE PLANS:
                             Target Input: catalog_sales
                             Partition key expr: cs_sold_date_sk
                             Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
-                            Target Vertex: Map 9
+                            Target Vertex: Map 11
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
         Map 7 
             Map Operator Tree:
                 TableScan
                   alias: item
-                  filterExpr: (i_color) IN ('orchid              ', 'chiffon             ', 'lace                ') (type: boolean)
                   Statistics: Num rows: 462000 Data size: 87318000 Basic stats: COMPLETE Column stats: COMPLETE
                   Filter Operator
                     predicate: (i_color) IN ('orchid              ', 'chiffon             ', 'lace                ') (type: boolean)
                     Statistics: Num rows: 14589 Data size: 2757321 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
                       expressions: i_item_id (type: string)
-                      outputColumnNames: i_item_id
-                      Statistics: Num rows: 14589 Data size: 2757321 Basic stats: COMPLETE Column stats: COMPLETE
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 14589 Data size: 1458900 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
-                        keys: i_item_id (type: string)
+                        keys: _col0 (type: string)
                         minReductionHashAggr: 0.4
                         mode: hash
                         outputColumnNames: _col0
@@ -320,69 +368,59 @@ STAGE PLANS:
                           sort order: +
                           Map-reduce partition columns: _col0 (type: string)
                           Statistics: Num rows: 14589 Data size: 1458900 Basic stats: COMPLETE Column stats: COMPLETE
-            Execution mode: vectorized, llap
-            LLAP IO: may be used (ACID table)
-        Map 9 
-            Map Operator Tree:
-                TableScan
-                  alias: catalog_sales
-                  filterExpr: cs_bill_addr_sk is not null (type: boolean)
-                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_280_container, bigKeyColName:cs_item_sk, smallTablePos:1, keyRatio:8.849641557210306E-5
-                  Statistics: Num rows: 43005109025 Data size: 5835793041376 Basic stats: COMPLETE Column stats: COMPLETE
-                  Filter Operator
-                    predicate: cs_bill_addr_sk is not null (type: boolean)
-                    Statistics: Num rows: 42898229145 Data size: 5821289442328 Basic stats: COMPLETE Column stats: COMPLETE
-                    Select Operator
-                      expressions: cs_bill_addr_sk (type: bigint), cs_item_sk (type: bigint), cs_ext_sales_price (type: decimal(7,2)), cs_sold_date_sk (type: bigint)
-                      outputColumnNames: _col0, _col1, _col2, _col3
-                      Statistics: Num rows: 42898229145 Data size: 5821289442328 Basic stats: COMPLETE Column stats: COMPLETE
-                      Map Join Operator
-                        condition map:
-                             Inner Join 0 to 1
-                        keys:
-                          0 _col3 (type: bigint)
-                          1 _col0 (type: bigint)
-                        outputColumnNames: _col0, _col1, _col2
-                        input vertices:
-                          1 Map 6
-                        Statistics: Num rows: 723125004 Data size: 79690279120 Basic stats: COMPLETE Column stats: COMPLETE
-                        Map Join Operator
-                          condition map:
-                               Inner Join 0 to 1
-                          keys:
-                            0 _col0 (type: bigint)
-                            1 _col0 (type: bigint)
-                          outputColumnNames: _col1, _col2
-                          input vertices:
-                            1 Map 11
-                          Statistics: Num rows: 120520838 Data size: 2445693184 Basic stats: COMPLETE Column stats: COMPLETE
-                          Map Join Operator
-                            condition map:
-                                 Inner Join 0 to 1
-                            keys:
-                              0 _col1 (type: bigint)
-                              1 _col0 (type: bigint)
-                            outputColumnNames: _col2, _col7
-                            input vertices:
-                              1 Map 12
-                            Statistics: Num rows: 3805798 Data size: 380579912 Basic stats: COMPLETE Column stats: COMPLETE
-                            Group By Operator
-                              aggregations: sum(_col2)
-                              keys: _col7 (type: string)
-                              minReductionHashAggr: 0.99
-                              mode: hash
-                              outputColumnNames: _col0, _col1
-                              Statistics: Num rows: 1720 Data size: 364640 Basic stats: COMPLETE Column stats: COMPLETE
-                              Reduce Output Operator
-                                key expressions: _col0 (type: string)
-                                null sort order: z
-                                sort order: +
-                                Map-reduce partition columns: _col0 (type: string)
-                                Statistics: Num rows: 1720 Data size: 364640 Basic stats: COMPLETE Column stats: COMPLETE
-                                value expressions: _col1 (type: decimal(17,2))
+                        Reduce Output Operator
+                          key expressions: _col0 (type: string)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: string)
+                          Statistics: Num rows: 14589 Data size: 1458900 Basic stats: COMPLETE Column stats: COMPLETE
+                        Reduce Output Operator
+                          key expressions: _col0 (type: string)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: string)
+                          Statistics: Num rows: 14589 Data size: 1458900 Basic stats: COMPLETE Column stats: COMPLETE
+                  Select Operator
+                    expressions: i_item_sk (type: bigint), i_item_id (type: string)
+                    outputColumnNames: _col0, _col1
+                    Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
+                    Reduce Output Operator
+                      key expressions: _col0 (type: bigint)
+                      null sort order: z
+                      sort order: +
+                      Map-reduce partition columns: _col0 (type: bigint)
+                      Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
+                      value expressions: _col1 (type: string)
+                    Reduce Output Operator
+                      key expressions: _col0 (type: bigint)
+                      null sort order: z
+                      sort order: +
+                      Map-reduce partition columns: _col0 (type: bigint)
+                      Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
+                      value expressions: _col1 (type: string)
+                    Reduce Output Operator
+                      key expressions: _col0 (type: bigint)
+                      null sort order: z
+                      sort order: +
+                      Map-reduce partition columns: _col0 (type: bigint)
+                      Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
+                      value expressions: _col1 (type: string)
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
         Reducer 10 
+            Execution mode: vectorized, llap
+            Reduce Operator Tree:
+              Select Operator
+                expressions: KEY.reducesinkkey0 (type: bigint), VALUE._col0 (type: string)
+                outputColumnNames: _col0, _col1
+                Reduce Output Operator
+                  key expressions: _col0 (type: bigint)
+                  null sort order: z
+                  sort order: +
+                  Map-reduce partition columns: _col0 (type: bigint)
+                  Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
+                  value expressions: _col1 (type: string)
+        Reducer 12 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Group By Operator
@@ -405,7 +443,7 @@ STAGE PLANS:
                     Map-reduce partition columns: _col0 (type: string)
                     Statistics: Num rows: 860 Data size: 182320 Basic stats: COMPLETE Column stats: COMPLETE
                     value expressions: _col1 (type: decimal(27,2))
-        Reducer 14 
+        Reducer 15 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Group By Operator
@@ -492,17 +530,29 @@ STAGE PLANS:
         Reducer 8 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
-              Group By Operator
-                keys: KEY._col0 (type: string)
-                mode: mergepartial
-                outputColumnNames: _col0
-                Statistics: Num rows: 14589 Data size: 1458900 Basic stats: COMPLETE Column stats: COMPLETE
+              Select Operator
+                expressions: KEY.reducesinkkey0 (type: bigint), VALUE._col0 (type: string)
+                outputColumnNames: _col0, _col1
                 Reduce Output Operator
-                  key expressions: _col0 (type: string)
+                  key expressions: _col0 (type: bigint)
                   null sort order: z
                   sort order: +
-                  Map-reduce partition columns: _col0 (type: string)
-                  Statistics: Num rows: 14589 Data size: 1458900 Basic stats: COMPLETE Column stats: COMPLETE
+                  Map-reduce partition columns: _col0 (type: bigint)
+                  Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
+                  value expressions: _col1 (type: string)
+        Reducer 9 
+            Execution mode: vectorized, llap
+            Reduce Operator Tree:
+              Select Operator
+                expressions: KEY.reducesinkkey0 (type: bigint), VALUE._col0 (type: string)
+                outputColumnNames: _col0, _col1
+                Reduce Output Operator
+                  key expressions: _col0 (type: bigint)
+                  null sort order: z
+                  sort order: +
+                  Map-reduce partition columns: _col0 (type: bigint)
+                  Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
+                  value expressions: _col1 (type: string)
         Union 3 
             Vertex: Union 3
 
diff --git a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query58.q.out b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query58.q.out
index 20a1c354b6..e8d6ada061 100644
--- a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query58.q.out
+++ b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query58.q.out
@@ -1,4 +1,4 @@
-Warning: Map Join MAPJOIN[396][bigTable=?] in task 'Map 11' is a cross product
+Warning: Map Join MAPJOIN[375][bigTable=?] in task 'Map 5' is a cross product
 STAGE DEPENDENCIES:
   Stage-1 is a root stage
   Stage-0 depends on stages: Stage-1
@@ -8,19 +8,105 @@ STAGE PLANS:
     Tez
 #### A masked pattern was here ####
       Edges:
-        Map 11 <- Map 1 (BROADCAST_EDGE), Reducer 2 (BROADCAST_EDGE)
-        Reducer 10 <- Reducer 9 (SIMPLE_EDGE)
-        Reducer 12 <- Map 1 (BROADCAST_EDGE), Map 11 (SIMPLE_EDGE)
-        Reducer 14 <- Map 13 (CUSTOM_SIMPLE_EDGE), Map 6 (BROADCAST_EDGE), Reducer 12 (CUSTOM_SIMPLE_EDGE)
-        Reducer 15 <- Reducer 14 (SIMPLE_EDGE)
-        Reducer 2 <- Map 1 (CUSTOM_SIMPLE_EDGE)
-        Reducer 4 <- Map 3 (CUSTOM_SIMPLE_EDGE), Map 6 (BROADCAST_EDGE), Reducer 12 (CUSTOM_SIMPLE_EDGE)
-        Reducer 5 <- Reducer 4 (SIMPLE_EDGE)
-        Reducer 8 <- Map 6 (BROADCAST_EDGE), Map 7 (CUSTOM_SIMPLE_EDGE), Reducer 12 (CUSTOM_SIMPLE_EDGE)
-        Reducer 9 <- Reducer 15 (BROADCAST_EDGE), Reducer 5 (BROADCAST_EDGE), Reducer 8 (SIMPLE_EDGE)
+        Map 1 <- Map 11 (BROADCAST_EDGE), Map 3 (BROADCAST_EDGE), Map 5 (BROADCAST_EDGE)
+        Map 5 <- Map 3 (BROADCAST_EDGE), Reducer 4 (BROADCAST_EDGE)
+        Map 6 <- Map 11 (BROADCAST_EDGE), Map 3 (BROADCAST_EDGE), Map 5 (BROADCAST_EDGE)
+        Map 9 <- Map 11 (BROADCAST_EDGE), Map 3 (BROADCAST_EDGE), Map 5 (BROADCAST_EDGE)
+        Reducer 10 <- Map 9 (SIMPLE_EDGE)
+        Reducer 2 <- Map 1 (SIMPLE_EDGE)
+        Reducer 4 <- Map 3 (CUSTOM_SIMPLE_EDGE)
+        Reducer 7 <- Map 6 (SIMPLE_EDGE), Reducer 10 (BROADCAST_EDGE), Reducer 2 (BROADCAST_EDGE)
+        Reducer 8 <- Reducer 7 (SIMPLE_EDGE)
 #### A masked pattern was here ####
       Vertices:
         Map 1 
+            Map Operator Tree:
+                TableScan
+                  alias: catalog_sales
+                  Statistics: Num rows: 43005109025 Data size: 5492607208208 Basic stats: COMPLETE Column stats: COMPLETE
+                  Select Operator
+                    expressions: cs_item_sk (type: bigint), cs_ext_sales_price (type: decimal(7,2)), cs_sold_date_sk (type: bigint)
+                    outputColumnNames: _col0, _col1, _col2
+                    Statistics: Num rows: 43005109025 Data size: 5492607208208 Basic stats: COMPLETE Column stats: COMPLETE
+                    Map Join Operator
+                      condition map:
+                           Inner Join 0 to 1
+                      keys:
+                        0 _col2 (type: bigint)
+                        1 _col0 (type: bigint)
+                      outputColumnNames: _col0, _col1, _col4
+                      input vertices:
+                        1 Map 3
+                      Statistics: Num rows: 43005109025 Data size: 7556852441408 Basic stats: COMPLETE Column stats: COMPLETE
+                      Map Join Operator
+                        condition map:
+                             Left Semi Join 0 to 1
+                        keys:
+                          0 _col4 (type: date)
+                          1 _col0 (type: date)
+                        outputColumnNames: _col0, _col1
+                        input vertices:
+                          1 Map 5
+                        Statistics: Num rows: 43005109025 Data size: 5148566336008 Basic stats: COMPLETE Column stats: COMPLETE
+                        Map Join Operator
+                          condition map:
+                               Inner Join 0 to 1
+                          keys:
+                            0 _col0 (type: bigint)
+                            1 _col0 (type: bigint)
+                          outputColumnNames: _col1, _col6
+                          input vertices:
+                            1 Map 11
+                          Statistics: Num rows: 43005109025 Data size: 9105036366308 Basic stats: COMPLETE Column stats: COMPLETE
+                          Group By Operator
+                            aggregations: sum(_col1)
+                            keys: _col6 (type: string)
+                            minReductionHashAggr: 0.99
+                            mode: hash
+                            outputColumnNames: _col0, _col1
+                            Statistics: Num rows: 8803686108 Data size: 1866381454896 Basic stats: COMPLETE Column stats: COMPLETE
+                            Reduce Output Operator
+                              key expressions: _col0 (type: string)
+                              null sort order: z
+                              sort order: +
+                              Map-reduce partition columns: _col0 (type: string)
+                              Statistics: Num rows: 8803686108 Data size: 1866381454896 Basic stats: COMPLETE Column stats: COMPLETE
+                              value expressions: _col1 (type: decimal(17,2))
+            Execution mode: vectorized, llap
+            LLAP IO: may be used (ACID table)
+        Map 11 
+            Map Operator Tree:
+                TableScan
+                  alias: item
+                  Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
+                  Select Operator
+                    expressions: i_item_sk (type: bigint), i_item_id (type: string)
+                    outputColumnNames: _col0, _col1
+                    Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
+                    Reduce Output Operator
+                      key expressions: _col0 (type: bigint)
+                      null sort order: z
+                      sort order: +
+                      Map-reduce partition columns: _col0 (type: bigint)
+                      Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
+                      value expressions: _col1 (type: string)
+                    Reduce Output Operator
+                      key expressions: _col0 (type: bigint)
+                      null sort order: z
+                      sort order: +
+                      Map-reduce partition columns: _col0 (type: bigint)
+                      Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
+                      value expressions: _col1 (type: string)
+                    Reduce Output Operator
+                      key expressions: _col0 (type: bigint)
+                      null sort order: z
+                      sort order: +
+                      Map-reduce partition columns: _col0 (type: bigint)
+                      Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
+                      value expressions: _col1 (type: string)
+            Execution mode: vectorized, llap
+            LLAP IO: may be used (ACID table)
+        Map 3 
             Map Operator Tree:
                 TableScan
                   alias: date_dim
@@ -34,12 +120,74 @@ STAGE PLANS:
                       outputColumnNames: _col0, _col1
                       Statistics: Num rows: 73049 Data size: 4675136 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
-                        key expressions: _col1 (type: date)
+                        key expressions: _col0 (type: bigint)
+                        null sort order: z
+                        sort order: +
+                        Map-reduce partition columns: _col0 (type: bigint)
+                        Statistics: Num rows: 73049 Data size: 4675136 Basic stats: COMPLETE Column stats: COMPLETE
+                        value expressions: _col1 (type: date)
+                      Select Operator
+                        expressions: _col0 (type: bigint)
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 73049 Data size: 584392 Basic stats: COMPLETE Column stats: COMPLETE
+                        Group By Operator
+                          keys: _col0 (type: bigint)
+                          minReductionHashAggr: 0.4
+                          mode: hash
+                          outputColumnNames: _col0
+                          Statistics: Num rows: 67850 Data size: 542800 Basic stats: COMPLETE Column stats: COMPLETE
+                          Dynamic Partitioning Event Operator
+                            Target column: cs_sold_date_sk (bigint)
+                            Target Input: catalog_sales
+                            Partition key expr: cs_sold_date_sk
+                            Statistics: Num rows: 67850 Data size: 542800 Basic stats: COMPLETE Column stats: COMPLETE
+                            Target Vertex: Map 1
+                      Reduce Output Operator
+                        key expressions: _col0 (type: bigint)
+                        null sort order: z
+                        sort order: +
+                        Map-reduce partition columns: _col0 (type: bigint)
+                        Statistics: Num rows: 73049 Data size: 4675136 Basic stats: COMPLETE Column stats: COMPLETE
+                        value expressions: _col1 (type: date)
+                      Select Operator
+                        expressions: _col0 (type: bigint)
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 73049 Data size: 584392 Basic stats: COMPLETE Column stats: COMPLETE
+                        Group By Operator
+                          keys: _col0 (type: bigint)
+                          minReductionHashAggr: 0.4
+                          mode: hash
+                          outputColumnNames: _col0
+                          Statistics: Num rows: 67850 Data size: 542800 Basic stats: COMPLETE Column stats: COMPLETE
+                          Dynamic Partitioning Event Operator
+                            Target column: ss_sold_date_sk (bigint)
+                            Target Input: store_sales
+                            Partition key expr: ss_sold_date_sk
+                            Statistics: Num rows: 67850 Data size: 542800 Basic stats: COMPLETE Column stats: COMPLETE
+                            Target Vertex: Map 6
+                      Reduce Output Operator
+                        key expressions: _col0 (type: bigint)
                         null sort order: z
                         sort order: +
-                        Map-reduce partition columns: _col1 (type: date)
+                        Map-reduce partition columns: _col0 (type: bigint)
                         Statistics: Num rows: 73049 Data size: 4675136 Basic stats: COMPLETE Column stats: COMPLETE
-                        value expressions: _col0 (type: bigint)
+                        value expressions: _col1 (type: date)
+                      Select Operator
+                        expressions: _col0 (type: bigint)
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 73049 Data size: 584392 Basic stats: COMPLETE Column stats: COMPLETE
+                        Group By Operator
+                          keys: _col0 (type: bigint)
+                          minReductionHashAggr: 0.4
+                          mode: hash
+                          outputColumnNames: _col0
+                          Statistics: Num rows: 67850 Data size: 542800 Basic stats: COMPLETE Column stats: COMPLETE
+                          Dynamic Partitioning Event Operator
+                            Target column: ws_sold_date_sk (bigint)
+                            Target Input: web_sales
+                            Partition key expr: ws_sold_date_sk
+                            Statistics: Num rows: 67850 Data size: 542800 Basic stats: COMPLETE Column stats: COMPLETE
+                            Target Vertex: Map 9
                   Filter Operator
                     predicate: ((d_date = DATE'1998-02-19') and d_week_seq is not null) (type: boolean)
                     Statistics: Num rows: 36524 Data size: 2191440 Basic stats: COMPLETE Column stats: COMPLETE
@@ -71,7 +219,7 @@ STAGE PLANS:
                           value expressions: _col0 (type: bigint)
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
-        Map 11 
+        Map 5 
             Map Operator Tree:
                 TableScan
                   alias: date_dim
@@ -92,7 +240,7 @@ STAGE PLANS:
                           1 
                         outputColumnNames: _col0, _col1
                         input vertices:
-                          1 Reducer 2
+                          1 Reducer 4
                         Statistics: Num rows: 73049 Data size: 4382940 Basic stats: COMPLETE Column stats: COMPLETE
                         Map Join Operator
                           condition map:
@@ -102,7 +250,7 @@ STAGE PLANS:
                             1 _col0 (type: int)
                           outputColumnNames: _col0
                           input vertices:
-                            1 Map 1
+                            1 Map 3
                           Statistics: Num rows: 236172 Data size: 13225632 Basic stats: COMPLETE Column stats: COMPLETE
                           Group By Operator
                             keys: _col0 (type: date)
@@ -116,77 +264,21 @@ STAGE PLANS:
                               sort order: +
                               Map-reduce partition columns: _col0 (type: date)
                               Statistics: Num rows: 73049 Data size: 4090744 Basic stats: COMPLETE Column stats: COMPLETE
-            Execution mode: vectorized, llap
-            LLAP IO: may be used (ACID table)
-        Map 13 
-            Map Operator Tree:
-                TableScan
-                  alias: web_sales
-                  Statistics: Num rows: 21594638446 Data size: 2763811113552 Basic stats: COMPLETE Column stats: COMPLETE
-                  Select Operator
-                    expressions: ws_item_sk (type: bigint), ws_ext_sales_price (type: decimal(7,2)), ws_sold_date_sk (type: bigint)
-                    outputColumnNames: _col0, _col1, _col2
-                    Statistics: Num rows: 21594638446 Data size: 2763811113552 Basic stats: COMPLETE Column stats: COMPLETE
-                    Reduce Output Operator
-                      key expressions: _col2 (type: bigint)
-                      null sort order: z
-                      sort order: +
-                      Map-reduce partition columns: _col2 (type: bigint)
-                      Statistics: Num rows: 21594638446 Data size: 2763811113552 Basic stats: COMPLETE Column stats: COMPLETE
-                      value expressions: _col0 (type: bigint), _col1 (type: decimal(7,2))
-            Execution mode: vectorized, llap
-            LLAP IO: may be used (ACID table)
-        Map 3 
-            Map Operator Tree:
-                TableScan
-                  alias: catalog_sales
-                  Statistics: Num rows: 43005109025 Data size: 5492607208208 Basic stats: COMPLETE Column stats: COMPLETE
-                  Select Operator
-                    expressions: cs_item_sk (type: bigint), cs_ext_sales_price (type: decimal(7,2)), cs_sold_date_sk (type: bigint)
-                    outputColumnNames: _col0, _col1, _col2
-                    Statistics: Num rows: 43005109025 Data size: 5492607208208 Basic stats: COMPLETE Column stats: COMPLETE
-                    Reduce Output Operator
-                      key expressions: _col2 (type: bigint)
-                      null sort order: z
-                      sort order: +
-                      Map-reduce partition columns: _col2 (type: bigint)
-                      Statistics: Num rows: 43005109025 Data size: 5492607208208 Basic stats: COMPLETE Column stats: COMPLETE
-                      value expressions: _col0 (type: bigint), _col1 (type: decimal(7,2))
+                            Reduce Output Operator
+                              key expressions: _col0 (type: date)
+                              null sort order: z
+                              sort order: +
+                              Map-reduce partition columns: _col0 (type: date)
+                              Statistics: Num rows: 73049 Data size: 4090744 Basic stats: COMPLETE Column stats: COMPLETE
+                            Reduce Output Operator
+                              key expressions: _col0 (type: date)
+                              null sort order: z
+                              sort order: +
+                              Map-reduce partition columns: _col0 (type: date)
+                              Statistics: Num rows: 73049 Data size: 4090744 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
         Map 6 
-            Map Operator Tree:
-                TableScan
-                  alias: item
-                  Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
-                  Select Operator
-                    expressions: i_item_sk (type: bigint), i_item_id (type: string)
-                    outputColumnNames: _col0, _col1
-                    Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
-                    Reduce Output Operator
-                      key expressions: _col0 (type: bigint)
-                      null sort order: z
-                      sort order: +
-                      Map-reduce partition columns: _col0 (type: bigint)
-                      Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
-                      value expressions: _col1 (type: string)
-                    Reduce Output Operator
-                      key expressions: _col0 (type: bigint)
-                      null sort order: z
-                      sort order: +
-                      Map-reduce partition columns: _col0 (type: bigint)
-                      Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
-                      value expressions: _col1 (type: string)
-                    Reduce Output Operator
-                      key expressions: _col0 (type: bigint)
-                      null sort order: z
-                      sort order: +
-                      Map-reduce partition columns: _col0 (type: bigint)
-                      Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
-                      value expressions: _col1 (type: string)
-            Execution mode: vectorized, llap
-            LLAP IO: may be used (ACID table)
-        Map 7 
             Map Operator Tree:
                 TableScan
                   alias: store_sales
@@ -195,155 +287,108 @@ STAGE PLANS:
                     expressions: ss_item_sk (type: bigint), ss_ext_sales_price (type: decimal(7,2)), ss_sold_date_sk (type: bigint)
                     outputColumnNames: _col0, _col1, _col2
                     Statistics: Num rows: 82510879939 Data size: 10343396725952 Basic stats: COMPLETE Column stats: COMPLETE
-                    Reduce Output Operator
-                      key expressions: _col2 (type: bigint)
-                      null sort order: z
-                      sort order: +
-                      Map-reduce partition columns: _col2 (type: bigint)
-                      Statistics: Num rows: 82510879939 Data size: 10343396725952 Basic stats: COMPLETE Column stats: COMPLETE
-                      value expressions: _col0 (type: bigint), _col1 (type: decimal(7,2))
+                    Map Join Operator
+                      condition map:
+                           Inner Join 0 to 1
+                      keys:
+                        0 _col2 (type: bigint)
+                        1 _col0 (type: bigint)
+                      outputColumnNames: _col0, _col1, _col4
+                      input vertices:
+                        1 Map 3
+                      Statistics: Num rows: 82510879939 Data size: 14303918963024 Basic stats: COMPLETE Column stats: COMPLETE
+                      Map Join Operator
+                        condition map:
+                             Left Semi Join 0 to 1
+                        keys:
+                          0 _col4 (type: date)
+                          1 _col0 (type: date)
+                        outputColumnNames: _col0, _col1
+                        input vertices:
+                          1 Map 5
+                        Statistics: Num rows: 82510879939 Data size: 9683309686440 Basic stats: COMPLETE Column stats: COMPLETE
+                        Map Join Operator
+                          condition map:
+                               Inner Join 0 to 1
+                          keys:
+                            0 _col0 (type: bigint)
+                            1 _col0 (type: bigint)
+                          outputColumnNames: _col1, _col6
+                          input vertices:
+                            1 Map 11
+                          Statistics: Num rows: 82510879939 Data size: 17274310640828 Basic stats: COMPLETE Column stats: COMPLETE
+                          Group By Operator
+                            aggregations: sum(_col1)
+                            keys: _col6 (type: string)
+                            minReductionHashAggr: 0.99
+                            mode: hash
+                            outputColumnNames: _col0, _col1
+                            Statistics: Num rows: 16702424472 Data size: 3540913988064 Basic stats: COMPLETE Column stats: COMPLETE
+                            Reduce Output Operator
+                              key expressions: _col0 (type: string)
+                              null sort order: z
+                              sort order: +
+                              Map-reduce partition columns: _col0 (type: string)
+                              Statistics: Num rows: 16702424472 Data size: 3540913988064 Basic stats: COMPLETE Column stats: COMPLETE
+                              value expressions: _col1 (type: decimal(17,2))
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
-        Reducer 10 
-            Execution mode: vectorized, llap
-            Reduce Operator Tree:
-              Select Operator
-                expressions: KEY.reducesinkkey0 (type: string), KEY.reducesinkkey1 (type: decimal(17,2)), VALUE._col0 (type: decimal(38,17)), VALUE._col1 (type: decimal(17,2)), VALUE._col2 (type: decimal(38,17)), VALUE._col3 (type: decimal(17,2)), VALUE._col4 (type: decimal(38,17)), VALUE._col5 (type: decimal(23,6))
-                outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7
-                Statistics: Num rows: 1 Data size: 884 Basic stats: COMPLETE Column stats: COMPLETE
-                Limit
-                  Number of rows: 100
-                  Statistics: Num rows: 1 Data size: 884 Basic stats: COMPLETE Column stats: COMPLETE
-                  File Output Operator
-                    compressed: false
-                    Statistics: Num rows: 1 Data size: 884 Basic stats: COMPLETE Column stats: COMPLETE
-                    table:
-                        input format: org.apache.hadoop.mapred.SequenceFileInputFormat
-                        output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
-                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-        Reducer 12 
-            Execution mode: vectorized, llap
-            Reduce Operator Tree:
-              Group By Operator
-                keys: KEY._col0 (type: date)
-                mode: mergepartial
-                outputColumnNames: _col0
-                Statistics: Num rows: 36524 Data size: 2045344 Basic stats: COMPLETE Column stats: COMPLETE
-                Map Join Operator
-                  condition map:
-                       Inner Join 0 to 1
-                  keys:
-                    0 _col1 (type: date)
-                    1 _col0 (type: date)
-                  outputColumnNames: _col0
-                  input vertices:
-                    0 Map 1
-                  Statistics: Num rows: 2668041676 Data size: 21344333408 Basic stats: COMPLETE Column stats: COMPLETE
-                  Reduce Output Operator
-                    key expressions: _col0 (type: bigint)
-                    null sort order: z
-                    sort order: +
-                    Map-reduce partition columns: _col0 (type: bigint)
-                    Statistics: Num rows: 2668041676 Data size: 21344333408 Basic stats: COMPLETE Column stats: COMPLETE
-                  Select Operator
-                    expressions: _col0 (type: bigint)
-                    outputColumnNames: _col0
-                    Statistics: Num rows: 2668041676 Data size: 21344333408 Basic stats: COMPLETE Column stats: COMPLETE
-                    Group By Operator
-                      keys: _col0 (type: bigint)
-                      minReductionHashAggr: 0.99
-                      mode: hash
-                      outputColumnNames: _col0
-                      Statistics: Num rows: 5699400 Data size: 45595200 Basic stats: COMPLETE Column stats: COMPLETE
-                      Dynamic Partitioning Event Operator
-                        Target column: cs_sold_date_sk (bigint)
-                        Target Input: catalog_sales
-                        Partition key expr: cs_sold_date_sk
-                        Statistics: Num rows: 5699400 Data size: 45595200 Basic stats: COMPLETE Column stats: COMPLETE
-                        Target Vertex: Map 3
-                  Reduce Output Operator
-                    key expressions: _col0 (type: bigint)
-                    null sort order: z
-                    sort order: +
-                    Map-reduce partition columns: _col0 (type: bigint)
-                    Statistics: Num rows: 2668041676 Data size: 21344333408 Basic stats: COMPLETE Column stats: COMPLETE
-                  Select Operator
-                    expressions: _col0 (type: bigint)
-                    outputColumnNames: _col0
-                    Statistics: Num rows: 2668041676 Data size: 21344333408 Basic stats: COMPLETE Column stats: COMPLETE
-                    Group By Operator
-                      keys: _col0 (type: bigint)
-                      minReductionHashAggr: 0.99
-                      mode: hash
-                      outputColumnNames: _col0
-                      Statistics: Num rows: 5699400 Data size: 45595200 Basic stats: COMPLETE Column stats: COMPLETE
-                      Dynamic Partitioning Event Operator
-                        Target column: ss_sold_date_sk (bigint)
-                        Target Input: store_sales
-                        Partition key expr: ss_sold_date_sk
-                        Statistics: Num rows: 5699400 Data size: 45595200 Basic stats: COMPLETE Column stats: COMPLETE
-                        Target Vertex: Map 7
-                  Reduce Output Operator
-                    key expressions: _col0 (type: bigint)
-                    null sort order: z
-                    sort order: +
-                    Map-reduce partition columns: _col0 (type: bigint)
-                    Statistics: Num rows: 2668041676 Data size: 21344333408 Basic stats: COMPLETE Column stats: COMPLETE
+        Map 9 
+            Map Operator Tree:
+                TableScan
+                  alias: web_sales
+                  Statistics: Num rows: 21594638446 Data size: 2763811113552 Basic stats: COMPLETE Column stats: COMPLETE
                   Select Operator
-                    expressions: _col0 (type: bigint)
-                    outputColumnNames: _col0
-                    Statistics: Num rows: 2668041676 Data size: 21344333408 Basic stats: COMPLETE Column stats: COMPLETE
-                    Group By Operator
-                      keys: _col0 (type: bigint)
-                      minReductionHashAggr: 0.99
-                      mode: hash
-                      outputColumnNames: _col0
-                      Statistics: Num rows: 5699400 Data size: 45595200 Basic stats: COMPLETE Column stats: COMPLETE
-                      Dynamic Partitioning Event Operator
-                        Target column: ws_sold_date_sk (bigint)
-                        Target Input: web_sales
-                        Partition key expr: ws_sold_date_sk
-                        Statistics: Num rows: 5699400 Data size: 45595200 Basic stats: COMPLETE Column stats: COMPLETE
-                        Target Vertex: Map 13
-        Reducer 14 
+                    expressions: ws_item_sk (type: bigint), ws_ext_sales_price (type: decimal(7,2)), ws_sold_date_sk (type: bigint)
+                    outputColumnNames: _col0, _col1, _col2
+                    Statistics: Num rows: 21594638446 Data size: 2763811113552 Basic stats: COMPLETE Column stats: COMPLETE
+                    Map Join Operator
+                      condition map:
+                           Inner Join 0 to 1
+                      keys:
+                        0 _col2 (type: bigint)
+                        1 _col0 (type: bigint)
+                      outputColumnNames: _col0, _col1, _col4
+                      input vertices:
+                        1 Map 3
+                      Statistics: Num rows: 21594638446 Data size: 3800353758960 Basic stats: COMPLETE Column stats: COMPLETE
+                      Map Join Operator
+                        condition map:
+                             Left Semi Join 0 to 1
+                        keys:
+                          0 _col4 (type: date)
+                          1 _col0 (type: date)
+                        outputColumnNames: _col0, _col1
+                        input vertices:
+                          1 Map 5
+                        Statistics: Num rows: 21594638446 Data size: 2591054005984 Basic stats: COMPLETE Column stats: COMPLETE
+                        Map Join Operator
+                          condition map:
+                               Inner Join 0 to 1
+                          keys:
+                            0 _col0 (type: bigint)
+                            1 _col0 (type: bigint)
+                          outputColumnNames: _col1, _col6
+                          input vertices:
+                            1 Map 11
+                          Statistics: Num rows: 21594638446 Data size: 4577760743016 Basic stats: COMPLETE Column stats: COMPLETE
+                          Group By Operator
+                            aggregations: sum(_col1)
+                            keys: _col6 (type: string)
+                            minReductionHashAggr: 0.99
+                            mode: hash
+                            outputColumnNames: _col0, _col1
+                            Statistics: Num rows: 4426224168 Data size: 938359523616 Basic stats: COMPLETE Column stats: COMPLETE
+                            Reduce Output Operator
+                              key expressions: _col0 (type: string)
+                              null sort order: z
+                              sort order: +
+                              Map-reduce partition columns: _col0 (type: string)
+                              Statistics: Num rows: 4426224168 Data size: 938359523616 Basic stats: COMPLETE Column stats: COMPLETE
+                              value expressions: _col1 (type: decimal(17,2))
             Execution mode: vectorized, llap
-            Reduce Operator Tree:
-              Map Join Operator
-                condition map:
-                     Inner Join 0 to 1
-                keys:
-                  0 KEY.reducesinkkey0 (type: bigint)
-                  1 KEY.reducesinkkey0 (type: bigint)
-                outputColumnNames: _col3, _col4
-                input vertices:
-                  0 Reducer 12
-                Statistics: Num rows: 1669782601 Data size: 200071304584 Basic stats: COMPLETE Column stats: COMPLETE
-                DynamicPartitionHashJoin: true
-                Map Join Operator
-                  condition map:
-                       Inner Join 0 to 1
-                  keys:
-                    0 _col3 (type: bigint)
-                    1 _col0 (type: bigint)
-                  outputColumnNames: _col4, _col7
-                  input vertices:
-                    1 Map 6
-                  Statistics: Num rows: 1669782601 Data size: 353691303876 Basic stats: COMPLETE Column stats: COMPLETE
-                  Group By Operator
-                    aggregations: sum(_col4)
-                    keys: _col7 (type: string)
-                    minReductionHashAggr: 0.99
-                    mode: hash
-                    outputColumnNames: _col0, _col1
-                    Statistics: Num rows: 342078168 Data size: 72520571616 Basic stats: COMPLETE Column stats: COMPLETE
-                    Reduce Output Operator
-                      key expressions: _col0 (type: string)
-                      null sort order: z
-                      sort order: +
-                      Map-reduce partition columns: _col0 (type: string)
-                      Statistics: Num rows: 342078168 Data size: 72520571616 Basic stats: COMPLETE Column stats: COMPLETE
-                      value expressions: _col1 (type: decimal(17,2))
-        Reducer 15 
+            LLAP IO: may be used (ACID table)
+        Reducer 10 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Group By Operator
@@ -364,61 +409,6 @@ STAGE PLANS:
                     Statistics: Num rows: 247524 Data size: 107920464 Basic stats: COMPLETE Column stats: COMPLETE
                     value expressions: _col1 (type: decimal(17,2)), _col2 (type: decimal(19,3)), _col3 (type: decimal(20,3))
         Reducer 2 
-            Execution mode: vectorized, llap
-            Reduce Operator Tree:
-              Group By Operator
-                aggregations: count(VALUE._col0)
-                mode: mergepartial
-                outputColumnNames: _col0
-                Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
-                Filter Operator
-                  predicate: (sq_count_check(_col0) <= 1) (type: boolean)
-                  Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
-                  Select Operator
-                    Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
-                    Reduce Output Operator
-                      null sort order: 
-                      sort order: 
-                      Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
-        Reducer 4 
-            Execution mode: vectorized, llap
-            Reduce Operator Tree:
-              Map Join Operator
-                condition map:
-                     Inner Join 0 to 1
-                keys:
-                  0 KEY.reducesinkkey0 (type: bigint)
-                  1 KEY.reducesinkkey0 (type: bigint)
-                outputColumnNames: _col3, _col4
-                input vertices:
-                  0 Reducer 12
-                Statistics: Num rows: 3325324616 Data size: 386992206928 Basic stats: COMPLETE Column stats: COMPLETE
-                DynamicPartitionHashJoin: true
-                Map Join Operator
-                  condition map:
-                       Inner Join 0 to 1
-                  keys:
-                    0 _col3 (type: bigint)
-                    1 _col0 (type: bigint)
-                  outputColumnNames: _col4, _col7
-                  input vertices:
-                    1 Map 6
-                  Statistics: Num rows: 3325324616 Data size: 692922071600 Basic stats: COMPLETE Column stats: COMPLETE
-                  Group By Operator
-                    aggregations: sum(_col4)
-                    keys: _col7 (type: string)
-                    minReductionHashAggr: 0.99
-                    mode: hash
-                    outputColumnNames: _col0, _col1
-                    Statistics: Num rows: 670047468 Data size: 142050063216 Basic stats: COMPLETE Column stats: COMPLETE
-                    Reduce Output Operator
-                      key expressions: _col0 (type: string)
-                      null sort order: z
-                      sort order: +
-                      Map-reduce partition columns: _col0 (type: string)
-                      Statistics: Num rows: 670047468 Data size: 142050063216 Basic stats: COMPLETE Column stats: COMPLETE
-                      value expressions: _col1 (type: decimal(17,2))
-        Reducer 5 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Group By Operator
@@ -434,45 +424,24 @@ STAGE PLANS:
                   Map-reduce partition columns: _col0 (type: string)
                   Statistics: Num rows: 247524 Data size: 52475088 Basic stats: COMPLETE Column stats: COMPLETE
                   value expressions: _col1 (type: decimal(17,2))
-        Reducer 8 
+        Reducer 4 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
-              Map Join Operator
-                condition map:
-                     Inner Join 0 to 1
-                keys:
-                  0 KEY.reducesinkkey0 (type: bigint)
-                  1 KEY.reducesinkkey0 (type: bigint)
-                outputColumnNames: _col3, _col4
-                input vertices:
-                  0 Reducer 12
-                Statistics: Num rows: 6380066609 Data size: 547612086840 Basic stats: COMPLETE Column stats: COMPLETE
-                DynamicPartitionHashJoin: true
-                Map Join Operator
-                  condition map:
-                       Inner Join 0 to 1
-                  keys:
-                    0 _col3 (type: bigint)
-                    1 _col0 (type: bigint)
-                  outputColumnNames: _col4, _col7
-                  input vertices:
-                    1 Map 6
-                  Statistics: Num rows: 6380066609 Data size: 1134578214868 Basic stats: COMPLETE Column stats: COMPLETE
-                  Group By Operator
-                    aggregations: sum(_col4)
-                    keys: _col7 (type: string)
-                    minReductionHashAggr: 0.99
-                    mode: hash
-                    outputColumnNames: _col0, _col1
-                    Statistics: Num rows: 1097026368 Data size: 232569590016 Basic stats: COMPLETE Column stats: COMPLETE
+              Group By Operator
+                aggregations: count(VALUE._col0)
+                mode: mergepartial
+                outputColumnNames: _col0
+                Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
+                Filter Operator
+                  predicate: (sq_count_check(_col0) <= 1) (type: boolean)
+                  Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
+                  Select Operator
+                    Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
                     Reduce Output Operator
-                      key expressions: _col0 (type: string)
-                      null sort order: z
-                      sort order: +
-                      Map-reduce partition columns: _col0 (type: string)
-                      Statistics: Num rows: 1097026368 Data size: 232569590016 Basic stats: COMPLETE Column stats: COMPLETE
-                      value expressions: _col1 (type: decimal(17,2))
-        Reducer 9 
+                      null sort order: 
+                      sort order: 
+                      Statistics: Num rows: 1 Data size: 8 Basic stats: COMPLETE Column stats: COMPLETE
+        Reducer 7 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Group By Operator
@@ -489,7 +458,7 @@ STAGE PLANS:
                     1 _col0 (type: string)
                   outputColumnNames: _col0, _col1, _col3
                   input vertices:
-                    0 Reducer 5
+                    0 Reducer 2
                   Statistics: Num rows: 247524 Data size: 80197776 Basic stats: COMPLETE Column stats: COMPLETE
                   Filter Operator
                     predicate: (_col1 BETWEEN (0.9 * _col3) AND (1.1 * _col3) and _col3 BETWEEN (0.9 * _col1) AND (1.1 * _col1)) (type: boolean)
@@ -502,7 +471,7 @@ STAGE PLANS:
                         1 _col0 (type: string)
                       outputColumnNames: _col0, _col1, _col3, _col5, _col6, _col7
                       input vertices:
-                        1 Reducer 15
+                        1 Reducer 10
                       Statistics: Num rows: 3055 Data size: 2016300 Basic stats: COMPLETE Column stats: COMPLETE
                       Filter Operator
                         predicate: (_col5 BETWEEN (0.9 * _col1) AND (1.1 * _col1) and _col5 BETWEEN (0.9 * _col3) AND (1.1 * _col3) and _col1 BETWEEN _col6 AND _col7 and _col3 BETWEEN _col6 AND _col7) (type: boolean)
@@ -523,6 +492,23 @@ STAGE PLANS:
                               sort order: ++
                               Statistics: Num rows: 1 Data size: 884 Basic stats: COMPLETE Column stats: COMPLETE
                               value expressions: _col2 (type: decimal(38,17)), _col3 (type: decimal(17,2)), _col4 (type: decimal(38,17)), _col5 (type: decimal(17,2)), _col6 (type: decimal(38,17)), _col7 (type: decimal(23,6))
+        Reducer 8 
+            Execution mode: vectorized, llap
+            Reduce Operator Tree:
+              Select Operator
+                expressions: KEY.reducesinkkey0 (type: string), KEY.reducesinkkey1 (type: decimal(17,2)), VALUE._col0 (type: decimal(38,17)), VALUE._col1 (type: decimal(17,2)), VALUE._col2 (type: decimal(38,17)), VALUE._col3 (type: decimal(17,2)), VALUE._col4 (type: decimal(38,17)), VALUE._col5 (type: decimal(23,6))
+                outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7
+                Statistics: Num rows: 1 Data size: 884 Basic stats: COMPLETE Column stats: COMPLETE
+                Limit
+                  Number of rows: 100
+                  Statistics: Num rows: 1 Data size: 884 Basic stats: COMPLETE Column stats: COMPLETE
+                  File Output Operator
+                    compressed: false
+                    Statistics: Num rows: 1 Data size: 884 Basic stats: COMPLETE Column stats: COMPLETE
+                    table:
+                        input format: org.apache.hadoop.mapred.SequenceFileInputFormat
+                        output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
+                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
 
   Stage: Stage-0
     Fetch Operator
diff --git a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query60.q.out b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query60.q.out
index 6e7bc6d5b9..4993dfb02e 100644
--- a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query60.q.out
+++ b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query60.q.out
@@ -7,16 +7,17 @@ STAGE PLANS:
     Tez
 #### A masked pattern was here ####
       Edges:
-        Map 1 <- Map 11 (BROADCAST_EDGE), Map 12 (BROADCAST_EDGE), Map 6 (BROADCAST_EDGE)
-        Map 12 <- Reducer 8 (BROADCAST_EDGE)
-        Map 13 <- Map 11 (BROADCAST_EDGE), Map 12 (BROADCAST_EDGE), Map 6 (BROADCAST_EDGE)
-        Map 9 <- Map 11 (BROADCAST_EDGE), Map 12 (BROADCAST_EDGE), Map 6 (BROADCAST_EDGE)
-        Reducer 10 <- Map 9 (SIMPLE_EDGE), Union 3 (CONTAINS)
-        Reducer 14 <- Map 13 (SIMPLE_EDGE), Union 3 (CONTAINS)
+        Map 1 <- Map 13 (BROADCAST_EDGE), Map 6 (BROADCAST_EDGE), Map 7 (BROADCAST_EDGE), Reducer 9 (BROADCAST_EDGE)
+        Map 11 <- Map 13 (BROADCAST_EDGE), Map 6 (BROADCAST_EDGE), Map 7 (BROADCAST_EDGE), Reducer 8 (BROADCAST_EDGE)
+        Map 14 <- Map 13 (BROADCAST_EDGE), Map 6 (BROADCAST_EDGE), Map 7 (BROADCAST_EDGE), Reducer 10 (BROADCAST_EDGE)
+        Reducer 10 <- Map 7 (SIMPLE_EDGE)
+        Reducer 12 <- Map 11 (SIMPLE_EDGE), Union 3 (CONTAINS)
+        Reducer 15 <- Map 14 (SIMPLE_EDGE), Union 3 (CONTAINS)
         Reducer 2 <- Map 1 (SIMPLE_EDGE), Union 3 (CONTAINS)
         Reducer 4 <- Union 3 (SIMPLE_EDGE)
         Reducer 5 <- Reducer 4 (SIMPLE_EDGE)
         Reducer 8 <- Map 7 (SIMPLE_EDGE)
+        Reducer 9 <- Map 7 (SIMPLE_EDGE)
 #### A masked pattern was here ####
       Vertices:
         Map 1 
@@ -24,7 +25,7 @@ STAGE PLANS:
                 TableScan
                   alias: store_sales
                   filterExpr: ss_addr_sk is not null (type: boolean)
-                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_276_container, bigKeyColName:ss_addr_sk, smallTablePos:1, keyRatio:1.5949411774215885E-8
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_273_container, bigKeyColName:ss_addr_sk, smallTablePos:1, keyRatio:1.5949411774215885E-8
                   Statistics: Num rows: 82510879939 Data size: 10987909046272 Basic stats: COMPLETE Column stats: COMPLETE
                   Filter Operator
                     predicate: ss_addr_sk is not null (type: boolean)
@@ -51,7 +52,7 @@ STAGE PLANS:
                             1 _col0 (type: bigint)
                           outputColumnNames: _col0, _col2
                           input vertices:
-                            1 Map 11
+                            1 Map 13
                           Statistics: Num rows: 227952808 Data size: 1823622576 Basic stats: COMPLETE Column stats: COMPLETE
                           Map Join Operator
                             condition map:
@@ -59,27 +60,107 @@ STAGE PLANS:
                             keys:
                               0 _col0 (type: bigint)
                               1 _col0 (type: bigint)
-                            outputColumnNames: _col2, _col7
+                            outputColumnNames: _col2, _col10
                             input vertices:
-                              1 Map 12
-                            Statistics: Num rows: 20722984 Data size: 2072298512 Basic stats: COMPLETE Column stats: COMPLETE
-                            Group By Operator
-                              aggregations: sum(_col2)
-                              keys: _col7 (type: string)
-                              minReductionHashAggr: 0.99
-                              mode: hash
-                              outputColumnNames: _col0, _col1
-                              Statistics: Num rows: 64143 Data size: 13598316 Basic stats: COMPLETE Column stats: COMPLETE
-                              Reduce Output Operator
-                                key expressions: _col0 (type: string)
-                                null sort order: z
-                                sort order: +
-                                Map-reduce partition columns: _col0 (type: string)
-                                Statistics: Num rows: 64143 Data size: 13598316 Basic stats: COMPLETE Column stats: COMPLETE
-                                value expressions: _col1 (type: decimal(17,2))
+                              1 Reducer 9
+                            Statistics: Num rows: 227952808 Data size: 22795280912 Basic stats: COMPLETE Column stats: COMPLETE
+                            Map Join Operator
+                              condition map:
+                                   Left Semi Join 0 to 1
+                              keys:
+                                0 _col10 (type: string)
+                                1 _col0 (type: string)
+                              outputColumnNames: _col2, _col10
+                              input vertices:
+                                1 Map 7
+                              Statistics: Num rows: 38679150 Data size: 3867915112 Basic stats: COMPLETE Column stats: COMPLETE
+                              Group By Operator
+                                aggregations: sum(_col2)
+                                keys: _col10 (type: string)
+                                minReductionHashAggr: 0.99
+                                mode: hash
+                                outputColumnNames: _col0, _col1
+                                Statistics: Num rows: 114032 Data size: 24174784 Basic stats: COMPLETE Column stats: COMPLETE
+                                Reduce Output Operator
+                                  key expressions: _col0 (type: string)
+                                  null sort order: z
+                                  sort order: +
+                                  Map-reduce partition columns: _col0 (type: string)
+                                  Statistics: Num rows: 114032 Data size: 24174784 Basic stats: COMPLETE Column stats: COMPLETE
+                                  value expressions: _col1 (type: decimal(17,2))
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
         Map 11 
+            Map Operator Tree:
+                TableScan
+                  alias: catalog_sales
+                  filterExpr: cs_bill_addr_sk is not null (type: boolean)
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_276_container, bigKeyColName:cs_bill_addr_sk, smallTablePos:1, keyRatio:0.002802477211020162
+                  Statistics: Num rows: 43005109025 Data size: 5835793041376 Basic stats: COMPLETE Column stats: COMPLETE
+                  Filter Operator
+                    predicate: cs_bill_addr_sk is not null (type: boolean)
+                    Statistics: Num rows: 42898229145 Data size: 5821289442328 Basic stats: COMPLETE Column stats: COMPLETE
+                    Select Operator
+                      expressions: cs_bill_addr_sk (type: bigint), cs_item_sk (type: bigint), cs_ext_sales_price (type: decimal(7,2)), cs_sold_date_sk (type: bigint)
+                      outputColumnNames: _col0, _col1, _col2, _col3
+                      Statistics: Num rows: 42898229145 Data size: 5821289442328 Basic stats: COMPLETE Column stats: COMPLETE
+                      Map Join Operator
+                        condition map:
+                             Inner Join 0 to 1
+                        keys:
+                          0 _col3 (type: bigint)
+                          1 _col0 (type: bigint)
+                        outputColumnNames: _col0, _col1, _col2
+                        input vertices:
+                          1 Map 6
+                        Statistics: Num rows: 723125004 Data size: 79690279120 Basic stats: COMPLETE Column stats: COMPLETE
+                        Map Join Operator
+                          condition map:
+                               Inner Join 0 to 1
+                          keys:
+                            0 _col0 (type: bigint)
+                            1 _col0 (type: bigint)
+                          outputColumnNames: _col1, _col2
+                          input vertices:
+                            1 Map 13
+                          Statistics: Num rows: 120520838 Data size: 2445693184 Basic stats: COMPLETE Column stats: COMPLETE
+                          Map Join Operator
+                            condition map:
+                                 Inner Join 0 to 1
+                            keys:
+                              0 _col1 (type: bigint)
+                              1 _col0 (type: bigint)
+                            outputColumnNames: _col2, _col10
+                            input vertices:
+                              1 Reducer 8
+                            Statistics: Num rows: 120520838 Data size: 13533610280 Basic stats: COMPLETE Column stats: COMPLETE
+                            Map Join Operator
+                              condition map:
+                                   Left Semi Join 0 to 1
+                              keys:
+                                0 _col10 (type: string)
+                                1 _col0 (type: string)
+                              outputColumnNames: _col2, _col10
+                              input vertices:
+                                1 Map 7
+                              Statistics: Num rows: 20450037 Data size: 2045003812 Basic stats: COMPLETE Column stats: COMPLETE
+                              Group By Operator
+                                aggregations: sum(_col2)
+                                keys: _col10 (type: string)
+                                minReductionHashAggr: 0.99
+                                mode: hash
+                                outputColumnNames: _col0, _col1
+                                Statistics: Num rows: 57016 Data size: 12087392 Basic stats: COMPLETE Column stats: COMPLETE
+                                Reduce Output Operator
+                                  key expressions: _col0 (type: string)
+                                  null sort order: z
+                                  sort order: +
+                                  Map-reduce partition columns: _col0 (type: string)
+                                  Statistics: Num rows: 57016 Data size: 12087392 Basic stats: COMPLETE Column stats: COMPLETE
+                                  value expressions: _col1 (type: decimal(17,2))
+            Execution mode: vectorized, llap
+            LLAP IO: may be used (ACID table)
+        Map 13 
             Map Operator Tree:
                 TableScan
                   alias: customer_address
@@ -91,75 +172,33 @@ STAGE PLANS:
                     Select Operator
                       expressions: ca_address_sk (type: bigint)
                       outputColumnNames: _col0
-                      Statistics: Num rows: 6666667 Data size: 53333336 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 6666667 Data size: 800000040 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
                         key expressions: _col0 (type: bigint)
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 6666667 Data size: 53333336 Basic stats: COMPLETE Column stats: COMPLETE
+                        Statistics: Num rows: 6666667 Data size: 800000040 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
                         key expressions: _col0 (type: bigint)
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 6666667 Data size: 53333336 Basic stats: COMPLETE Column stats: COMPLETE
+                        Statistics: Num rows: 6666667 Data size: 800000040 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
                         key expressions: _col0 (type: bigint)
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 6666667 Data size: 53333336 Basic stats: COMPLETE Column stats: COMPLETE
+                        Statistics: Num rows: 6666667 Data size: 800000040 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
-        Map 12 
-            Map Operator Tree:
-                TableScan
-                  alias: item
-                  Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
-                  Select Operator
-                    expressions: i_item_sk (type: bigint), i_item_id (type: string)
-                    outputColumnNames: _col0, _col1
-                    Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
-                    Map Join Operator
-                      condition map:
-                           Inner Join 0 to 1
-                      keys:
-                        0 _col1 (type: string)
-                        1 _col0 (type: string)
-                      outputColumnNames: _col0, _col1
-                      input vertices:
-                        1 Reducer 8
-                      Statistics: Num rows: 78392 Data size: 8466336 Basic stats: COMPLETE Column stats: COMPLETE
-                      Reduce Output Operator
-                        key expressions: _col0 (type: bigint)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 78392 Data size: 8466336 Basic stats: COMPLETE Column stats: COMPLETE
-                        value expressions: _col1 (type: string)
-                      Reduce Output Operator
-                        key expressions: _col0 (type: bigint)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 78392 Data size: 8466336 Basic stats: COMPLETE Column stats: COMPLETE
-                        value expressions: _col1 (type: string)
-                      Reduce Output Operator
-                        key expressions: _col0 (type: bigint)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 78392 Data size: 8466336 Basic stats: COMPLETE Column stats: COMPLETE
-                        value expressions: _col1 (type: string)
-            Execution mode: vectorized, llap
-            LLAP IO: may be used (ACID table)
-        Map 13 
+        Map 14 
             Map Operator Tree:
                 TableScan
                   alias: web_sales
                   filterExpr: ws_bill_addr_sk is not null (type: boolean)
-                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_282_container, bigKeyColName:ws_bill_addr_sk, smallTablePos:1, keyRatio:6.09410527196747E-8
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_279_container, bigKeyColName:ws_bill_addr_sk, smallTablePos:1, keyRatio:6.09410527196747E-8
                   Statistics: Num rows: 21594638446 Data size: 2936546611376 Basic stats: COMPLETE Column stats: COMPLETE
                   Filter Operator
                     predicate: ws_bill_addr_sk is not null (type: boolean)
@@ -186,7 +225,7 @@ STAGE PLANS:
                             1 _col0 (type: bigint)
                           outputColumnNames: _col0, _col2
                           input vertices:
-                            1 Map 11
+                            1 Map 13
                           Statistics: Num rows: 61093544 Data size: 7028655600 Basic stats: COMPLETE Column stats: COMPLETE
                           Map Join Operator
                             condition map:
@@ -194,24 +233,34 @@ STAGE PLANS:
                             keys:
                               0 _col0 (type: bigint)
                               1 _col0 (type: bigint)
-                            outputColumnNames: _col2, _col7
+                            outputColumnNames: _col2, _col10
                             input vertices:
-                              1 Map 12
-                            Statistics: Num rows: 5553959 Data size: 874869628 Basic stats: COMPLETE Column stats: COMPLETE
-                            Group By Operator
-                              aggregations: sum(_col2)
-                              keys: _col7 (type: string)
-                              minReductionHashAggr: 0.99
-                              mode: hash
-                              outputColumnNames: _col0, _col1
-                              Statistics: Num rows: 28508 Data size: 6043696 Basic stats: COMPLETE Column stats: COMPLETE
-                              Reduce Output Operator
-                                key expressions: _col0 (type: string)
-                                null sort order: z
-                                sort order: +
-                                Map-reduce partition columns: _col0 (type: string)
-                                Statistics: Num rows: 28508 Data size: 6043696 Basic stats: COMPLETE Column stats: COMPLETE
-                                value expressions: _col1 (type: decimal(17,2))
+                              1 Reducer 10
+                            Statistics: Num rows: 61093544 Data size: 12649261648 Basic stats: COMPLETE Column stats: COMPLETE
+                            Map Join Operator
+                              condition map:
+                                   Left Semi Join 0 to 1
+                              keys:
+                                0 _col10 (type: string)
+                                1 _col0 (type: string)
+                              outputColumnNames: _col2, _col10
+                              input vertices:
+                                1 Map 7
+                              Statistics: Num rows: 10366384 Data size: 1895103728 Basic stats: COMPLETE Column stats: COMPLETE
+                              Group By Operator
+                                aggregations: sum(_col2)
+                                keys: _col10 (type: string)
+                                minReductionHashAggr: 0.99
+                                mode: hash
+                                outputColumnNames: _col0, _col1
+                                Statistics: Num rows: 57016 Data size: 12087392 Basic stats: COMPLETE Column stats: COMPLETE
+                                Reduce Output Operator
+                                  key expressions: _col0 (type: string)
+                                  null sort order: z
+                                  sort order: +
+                                  Map-reduce partition columns: _col0 (type: string)
+                                  Statistics: Num rows: 57016 Data size: 12087392 Basic stats: COMPLETE Column stats: COMPLETE
+                                  value expressions: _col1 (type: decimal(17,2))
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
         Map 6 
@@ -226,13 +275,13 @@ STAGE PLANS:
                     Select Operator
                       expressions: d_date_sk (type: bigint)
                       outputColumnNames: _col0
-                      Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 31 Data size: 496 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
                         key expressions: _col0 (type: bigint)
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
+                        Statistics: Num rows: 31 Data size: 496 Basic stats: COMPLETE Column stats: COMPLETE
                       Select Operator
                         expressions: _col0 (type: bigint)
                         outputColumnNames: _col0
@@ -254,7 +303,7 @@ STAGE PLANS:
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
+                        Statistics: Num rows: 31 Data size: 496 Basic stats: COMPLETE Column stats: COMPLETE
                       Select Operator
                         expressions: _col0 (type: bigint)
                         outputColumnNames: _col0
@@ -270,13 +319,13 @@ STAGE PLANS:
                             Target Input: web_sales
                             Partition key expr: ws_sold_date_sk
                             Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
-                            Target Vertex: Map 13
+                            Target Vertex: Map 14
                       Reduce Output Operator
                         key expressions: _col0 (type: bigint)
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
+                        Statistics: Num rows: 31 Data size: 496 Basic stats: COMPLETE Column stats: COMPLETE
                       Select Operator
                         expressions: _col0 (type: bigint)
                         outputColumnNames: _col0
@@ -292,24 +341,23 @@ STAGE PLANS:
                             Target Input: catalog_sales
                             Partition key expr: cs_sold_date_sk
                             Statistics: Num rows: 31 Data size: 248 Basic stats: COMPLETE Column stats: COMPLETE
-                            Target Vertex: Map 9
+                            Target Vertex: Map 11
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
         Map 7 
             Map Operator Tree:
                 TableScan
                   alias: item
-                  filterExpr: (i_category = 'Children                                          ') (type: boolean)
                   Statistics: Num rows: 462000 Data size: 87780000 Basic stats: COMPLETE Column stats: COMPLETE
                   Filter Operator
                     predicate: (i_category = 'Children                                          ') (type: boolean)
                     Statistics: Num rows: 42000 Data size: 7980000 Basic stats: COMPLETE Column stats: COMPLETE
                     Select Operator
                       expressions: i_item_id (type: string)
-                      outputColumnNames: i_item_id
-                      Statistics: Num rows: 42000 Data size: 7980000 Basic stats: COMPLETE Column stats: COMPLETE
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 42000 Data size: 4200000 Basic stats: COMPLETE Column stats: COMPLETE
                       Group By Operator
-                        keys: i_item_id (type: string)
+                        keys: _col0 (type: string)
                         minReductionHashAggr: 0.4
                         mode: hash
                         outputColumnNames: _col0
@@ -320,69 +368,59 @@ STAGE PLANS:
                           sort order: +
                           Map-reduce partition columns: _col0 (type: string)
                           Statistics: Num rows: 42000 Data size: 4200000 Basic stats: COMPLETE Column stats: COMPLETE
-            Execution mode: vectorized, llap
-            LLAP IO: may be used (ACID table)
-        Map 9 
-            Map Operator Tree:
-                TableScan
-                  alias: catalog_sales
-                  filterExpr: cs_bill_addr_sk is not null (type: boolean)
-                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_285_container, bigKeyColName:cs_item_sk, smallTablePos:1, keyRatio:2.547706830281661E-4
-                  Statistics: Num rows: 43005109025 Data size: 5835793041376 Basic stats: COMPLETE Column stats: COMPLETE
-                  Filter Operator
-                    predicate: cs_bill_addr_sk is not null (type: boolean)
-                    Statistics: Num rows: 42898229145 Data size: 5821289442328 Basic stats: COMPLETE Column stats: COMPLETE
-                    Select Operator
-                      expressions: cs_bill_addr_sk (type: bigint), cs_item_sk (type: bigint), cs_ext_sales_price (type: decimal(7,2)), cs_sold_date_sk (type: bigint)
-                      outputColumnNames: _col0, _col1, _col2, _col3
-                      Statistics: Num rows: 42898229145 Data size: 5821289442328 Basic stats: COMPLETE Column stats: COMPLETE
-                      Map Join Operator
-                        condition map:
-                             Inner Join 0 to 1
-                        keys:
-                          0 _col3 (type: bigint)
-                          1 _col0 (type: bigint)
-                        outputColumnNames: _col0, _col1, _col2
-                        input vertices:
-                          1 Map 6
-                        Statistics: Num rows: 723125004 Data size: 79690279120 Basic stats: COMPLETE Column stats: COMPLETE
-                        Map Join Operator
-                          condition map:
-                               Inner Join 0 to 1
-                          keys:
-                            0 _col0 (type: bigint)
-                            1 _col0 (type: bigint)
-                          outputColumnNames: _col1, _col2
-                          input vertices:
-                            1 Map 11
-                          Statistics: Num rows: 120520838 Data size: 2445693184 Basic stats: COMPLETE Column stats: COMPLETE
-                          Map Join Operator
-                            condition map:
-                                 Inner Join 0 to 1
-                            keys:
-                              0 _col1 (type: bigint)
-                              1 _col0 (type: bigint)
-                            outputColumnNames: _col2, _col7
-                            input vertices:
-                              1 Map 12
-                            Statistics: Num rows: 10956441 Data size: 1095644212 Basic stats: COMPLETE Column stats: COMPLETE
-                            Group By Operator
-                              aggregations: sum(_col2)
-                              keys: _col7 (type: string)
-                              minReductionHashAggr: 0.99
-                              mode: hash
-                              outputColumnNames: _col0, _col1
-                              Statistics: Num rows: 35635 Data size: 7554620 Basic stats: COMPLETE Column stats: COMPLETE
-                              Reduce Output Operator
-                                key expressions: _col0 (type: string)
-                                null sort order: z
-                                sort order: +
-                                Map-reduce partition columns: _col0 (type: string)
-                                Statistics: Num rows: 35635 Data size: 7554620 Basic stats: COMPLETE Column stats: COMPLETE
-                                value expressions: _col1 (type: decimal(17,2))
+                        Reduce Output Operator
+                          key expressions: _col0 (type: string)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: string)
+                          Statistics: Num rows: 42000 Data size: 4200000 Basic stats: COMPLETE Column stats: COMPLETE
+                        Reduce Output Operator
+                          key expressions: _col0 (type: string)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: string)
+                          Statistics: Num rows: 42000 Data size: 4200000 Basic stats: COMPLETE Column stats: COMPLETE
+                  Select Operator
+                    expressions: i_item_sk (type: bigint), i_item_id (type: string)
+                    outputColumnNames: _col0, _col1
+                    Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
+                    Reduce Output Operator
+                      key expressions: _col0 (type: bigint)
+                      null sort order: z
+                      sort order: +
+                      Map-reduce partition columns: _col0 (type: bigint)
+                      Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
+                      value expressions: _col1 (type: string)
+                    Reduce Output Operator
+                      key expressions: _col0 (type: bigint)
+                      null sort order: z
+                      sort order: +
+                      Map-reduce partition columns: _col0 (type: bigint)
+                      Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
+                      value expressions: _col1 (type: string)
+                    Reduce Output Operator
+                      key expressions: _col0 (type: bigint)
+                      null sort order: z
+                      sort order: +
+                      Map-reduce partition columns: _col0 (type: bigint)
+                      Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
+                      value expressions: _col1 (type: string)
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
         Reducer 10 
+            Execution mode: vectorized, llap
+            Reduce Operator Tree:
+              Select Operator
+                expressions: KEY.reducesinkkey0 (type: bigint), VALUE._col0 (type: string)
+                outputColumnNames: _col0, _col1
+                Reduce Output Operator
+                  key expressions: _col0 (type: bigint)
+                  null sort order: z
+                  sort order: +
+                  Map-reduce partition columns: _col0 (type: bigint)
+                  Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
+                  value expressions: _col1 (type: string)
+        Reducer 12 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Group By Operator
@@ -411,7 +449,7 @@ STAGE PLANS:
                       Map-reduce partition columns: _col0 (type: string)
                       Statistics: Num rows: 7127 Data size: 1510924 Basic stats: COMPLETE Column stats: COMPLETE
                       value expressions: _col1 (type: decimal(27,2))
-        Reducer 14 
+        Reducer 15 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Group By Operator
@@ -509,17 +547,29 @@ STAGE PLANS:
         Reducer 8 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
-              Group By Operator
-                keys: KEY._col0 (type: string)
-                mode: mergepartial
-                outputColumnNames: _col0
-                Statistics: Num rows: 42000 Data size: 4200000 Basic stats: COMPLETE Column stats: COMPLETE
+              Select Operator
+                expressions: KEY.reducesinkkey0 (type: bigint), VALUE._col0 (type: string)
+                outputColumnNames: _col0, _col1
                 Reduce Output Operator
-                  key expressions: _col0 (type: string)
+                  key expressions: _col0 (type: bigint)
                   null sort order: z
                   sort order: +
-                  Map-reduce partition columns: _col0 (type: string)
-                  Statistics: Num rows: 42000 Data size: 4200000 Basic stats: COMPLETE Column stats: COMPLETE
+                  Map-reduce partition columns: _col0 (type: bigint)
+                  Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
+                  value expressions: _col1 (type: string)
+        Reducer 9 
+            Execution mode: vectorized, llap
+            Reduce Operator Tree:
+              Select Operator
+                expressions: KEY.reducesinkkey0 (type: bigint), VALUE._col0 (type: string)
+                outputColumnNames: _col0, _col1
+                Reduce Output Operator
+                  key expressions: _col0 (type: bigint)
+                  null sort order: z
+                  sort order: +
+                  Map-reduce partition columns: _col0 (type: bigint)
+                  Statistics: Num rows: 462000 Data size: 49896000 Basic stats: COMPLETE Column stats: COMPLETE
+                  value expressions: _col1 (type: string)
         Union 3 
             Vertex: Union 3
 
diff --git a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query70.q.out b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query70.q.out
index e256cfc2d8..e7eff0812a 100644
--- a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query70.q.out
+++ b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query70.q.out
@@ -7,13 +7,13 @@ STAGE PLANS:
     Tez
 #### A masked pattern was here ####
       Edges:
-        Map 1 <- Map 5 (BROADCAST_EDGE), Reducer 9 (BROADCAST_EDGE)
+        Map 1 <- Map 5 (BROADCAST_EDGE), Map 6 (BROADCAST_EDGE), Reducer 9 (BROADCAST_EDGE)
         Map 7 <- Map 5 (BROADCAST_EDGE), Map 6 (BROADCAST_EDGE)
         Reducer 2 <- Map 1 (SIMPLE_EDGE)
         Reducer 3 <- Reducer 2 (SIMPLE_EDGE)
         Reducer 4 <- Reducer 3 (SIMPLE_EDGE)
         Reducer 8 <- Map 7 (SIMPLE_EDGE)
-        Reducer 9 <- Map 6 (BROADCAST_EDGE), Reducer 8 (SIMPLE_EDGE)
+        Reducer 9 <- Reducer 8 (SIMPLE_EDGE)
 #### A masked pattern was here ####
       Vertices:
         Map 1 
@@ -21,7 +21,7 @@ STAGE PLANS:
                 TableScan
                   alias: store_sales
                   filterExpr: ss_store_sk is not null (type: boolean)
-                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_123_container, bigKeyColName:ss_store_sk, smallTablePos:1, keyRatio:0.1919754858718087
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_120_container, bigKeyColName:ss_store_sk, smallTablePos:1, keyRatio:0.1919754858718087
                   Statistics: Num rows: 82510879939 Data size: 10327900046896 Basic stats: COMPLETE Column stats: COMPLETE
                   Filter Operator
                     predicate: ss_store_sk is not null (type: boolean)
@@ -48,27 +48,37 @@ STAGE PLANS:
                             1 _col0 (type: bigint)
                           outputColumnNames: _col1, _col6, _col7
                           input vertices:
-                            1 Reducer 9
+                            1 Map 6
                           Statistics: Num rows: 15840066266 Data size: 4475829148384 Basic stats: COMPLETE Column stats: COMPLETE
-                          Select Operator
-                            expressions: _col7 (type: char(2)), _col6 (type: varchar(30)), _col1 (type: decimal(7,2))
-                            outputColumnNames: _col0, _col1, _col2
-                            Statistics: Num rows: 15840066266 Data size: 4475829148384 Basic stats: COMPLETE Column stats: COMPLETE
-                            Group By Operator
-                              aggregations: sum(_col2)
-                              keys: _col0 (type: char(2)), _col1 (type: varchar(30)), 0L (type: bigint)
-                              grouping sets: 0, 1, 3
-                              minReductionHashAggr: 0.99
-                              mode: hash
-                              outputColumnNames: _col0, _col1, _col2, _col3
-                              Statistics: Num rows: 10752660 Data size: 3268808640 Basic stats: COMPLETE Column stats: COMPLETE
-                              Reduce Output Operator
-                                key expressions: _col0 (type: char(2)), _col1 (type: varchar(30)), _col2 (type: bigint)
-                                null sort order: zzz
-                                sort order: +++
-                                Map-reduce partition columns: _col0 (type: char(2)), _col1 (type: varchar(30)), _col2 (type: bigint)
-                                Statistics: Num rows: 10752660 Data size: 3268808640 Basic stats: COMPLETE Column stats: COMPLETE
-                                value expressions: _col3 (type: decimal(17,2))
+                          Map Join Operator
+                            condition map:
+                                 Left Semi Join 0 to 1
+                            keys:
+                              0 _col7 (type: char(2))
+                              1 _col0 (type: char(2))
+                            outputColumnNames: _col1, _col6, _col7
+                            input vertices:
+                              1 Reducer 9
+                            Statistics: Num rows: 5040021084 Data size: 1279015774512 Basic stats: COMPLETE Column stats: COMPLETE
+                            Select Operator
+                              expressions: _col7 (type: char(2)), _col6 (type: varchar(30)), _col1 (type: decimal(7,2))
+                              outputColumnNames: _col0, _col1, _col2
+                              Statistics: Num rows: 5040021084 Data size: 1279015774512 Basic stats: COMPLETE Column stats: COMPLETE
+                              Group By Operator
+                                aggregations: sum(_col2)
+                                keys: _col0 (type: char(2)), _col1 (type: varchar(30)), 0L (type: bigint)
+                                grouping sets: 0, 1, 3
+                                minReductionHashAggr: 0.99
+                                mode: hash
+                                outputColumnNames: _col0, _col1, _col2, _col3
+                                Statistics: Num rows: 3073155 Data size: 934239120 Basic stats: COMPLETE Column stats: COMPLETE
+                                Reduce Output Operator
+                                  key expressions: _col0 (type: char(2)), _col1 (type: varchar(30)), _col2 (type: bigint)
+                                  null sort order: zzz
+                                  sort order: +++
+                                  Map-reduce partition columns: _col0 (type: char(2)), _col1 (type: varchar(30)), _col2 (type: bigint)
+                                  Statistics: Num rows: 3073155 Data size: 934239120 Basic stats: COMPLETE Column stats: COMPLETE
+                                  value expressions: _col3 (type: decimal(17,2))
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
         Map 5 
@@ -144,12 +154,12 @@ STAGE PLANS:
                       outputColumnNames: _col0, _col1, _col2
                       Statistics: Num rows: 1704 Data size: 327168 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
-                        key expressions: _col2 (type: char(2))
+                        key expressions: _col0 (type: bigint)
                         null sort order: z
                         sort order: +
-                        Map-reduce partition columns: _col2 (type: char(2))
+                        Map-reduce partition columns: _col0 (type: bigint)
                         Statistics: Num rows: 1704 Data size: 327168 Basic stats: COMPLETE Column stats: COMPLETE
-                        value expressions: _col0 (type: bigint), _col1 (type: varchar(30))
+                        value expressions: _col1 (type: varchar(30)), _col2 (type: char(2))
                     Select Operator
                       expressions: s_store_sk (type: bigint), s_state (type: char(2))
                       outputColumnNames: _col0, _col1
@@ -168,7 +178,7 @@ STAGE PLANS:
                 TableScan
                   alias: store_sales
                   filterExpr: ss_store_sk is not null (type: boolean)
-                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_121_container, bigKeyColName:ss_store_sk, smallTablePos:1, keyRatio:0.1919754858718087
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_122_container, bigKeyColName:ss_store_sk, smallTablePos:1, keyRatio:0.1919754858718087
                   Statistics: Num rows: 82510879939 Data size: 10327900046896 Basic stats: COMPLETE Column stats: COMPLETE
                   Filter Operator
                     predicate: ss_store_sk is not null (type: boolean)
@@ -351,23 +361,18 @@ STAGE PLANS:
                       expressions: _col0 (type: char(2))
                       outputColumnNames: _col0
                       Statistics: Num rows: 14 Data size: 1204 Basic stats: COMPLETE Column stats: COMPLETE
-                      Map Join Operator
-                        condition map:
-                             Inner Join 0 to 1
-                        keys:
-                          0 _col2 (type: char(2))
-                          1 _col0 (type: char(2))
-                        outputColumnNames: _col0, _col1, _col2
-                        input vertices:
-                          0 Map 6
-                        Statistics: Num rows: 542 Data size: 104064 Basic stats: COMPLETE Column stats: COMPLETE
+                      Group By Operator
+                        keys: _col0 (type: char(2))
+                        minReductionHashAggr: 0.4
+                        mode: hash
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 14 Data size: 1204 Basic stats: COMPLETE Column stats: COMPLETE
                         Reduce Output Operator
-                          key expressions: _col0 (type: bigint)
+                          key expressions: _col0 (type: char(2))
                           null sort order: z
                           sort order: +
-                          Map-reduce partition columns: _col0 (type: bigint)
-                          Statistics: Num rows: 542 Data size: 104064 Basic stats: COMPLETE Column stats: COMPLETE
-                          value expressions: _col1 (type: varchar(30)), _col2 (type: char(2))
+                          Map-reduce partition columns: _col0 (type: char(2))
+                          Statistics: Num rows: 14 Data size: 1204 Basic stats: COMPLETE Column stats: COMPLETE
 
   Stage: Stage-0
     Fetch Operator
diff --git a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query83.q.out b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query83.q.out
index c0b6f81403..a1743163ec 100644
--- a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query83.q.out
+++ b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query83.q.out
@@ -7,76 +7,75 @@ STAGE PLANS:
     Tez
 #### A masked pattern was here ####
       Edges:
-        Map 1 <- Map 3 (BROADCAST_EDGE)
-        Map 3 <- Map 14 (BROADCAST_EDGE)
-        Reducer 11 <- Map 10 (CUSTOM_SIMPLE_EDGE), Map 9 (BROADCAST_EDGE), Reducer 2 (CUSTOM_SIMPLE_EDGE)
-        Reducer 12 <- Reducer 11 (SIMPLE_EDGE), Reducer 17 (BROADCAST_EDGE), Reducer 8 (BROADCAST_EDGE)
-        Reducer 13 <- Reducer 12 (SIMPLE_EDGE)
-        Reducer 16 <- Map 15 (CUSTOM_SIMPLE_EDGE), Map 9 (BROADCAST_EDGE), Reducer 4 (CUSTOM_SIMPLE_EDGE)
-        Reducer 17 <- Reducer 16 (SIMPLE_EDGE)
-        Reducer 2 <- Map 1 (SIMPLE_EDGE), Map 3 (BROADCAST_EDGE)
-        Reducer 4 <- Map 3 (SIMPLE_EDGE), Reducer 5 (BROADCAST_EDGE)
-        Reducer 5 <- Map 3 (SIMPLE_EDGE)
-        Reducer 7 <- Map 6 (CUSTOM_SIMPLE_EDGE), Map 9 (BROADCAST_EDGE), Reducer 2 (CUSTOM_SIMPLE_EDGE)
-        Reducer 8 <- Reducer 7 (SIMPLE_EDGE)
+        Map 1 <- Map 3 (BROADCAST_EDGE), Map 4 (BROADCAST_EDGE), Map 8 (BROADCAST_EDGE)
+        Map 12 <- Map 4 (BROADCAST_EDGE), Map 8 (BROADCAST_EDGE), Reducer 9 (BROADCAST_EDGE)
+        Map 3 <- Map 8 (BROADCAST_EDGE)
+        Map 5 <- Map 4 (BROADCAST_EDGE), Map 8 (BROADCAST_EDGE), Reducer 10 (BROADCAST_EDGE)
+        Map 8 <- Map 11 (BROADCAST_EDGE)
+        Reducer 10 <- Map 8 (SIMPLE_EDGE)
+        Reducer 13 <- Map 12 (SIMPLE_EDGE)
+        Reducer 2 <- Map 1 (SIMPLE_EDGE)
+        Reducer 6 <- Map 5 (SIMPLE_EDGE), Reducer 13 (BROADCAST_EDGE), Reducer 2 (BROADCAST_EDGE)
+        Reducer 7 <- Reducer 6 (SIMPLE_EDGE)
+        Reducer 9 <- Map 8 (SIMPLE_EDGE)
 #### A masked pattern was here ####
       Vertices:
         Map 1 
             Map Operator Tree:
                 TableScan
-                  alias: date_dim
-                  filterExpr: (d_week_seq is not null and d_date is not null) (type: boolean)
-                  Statistics: Num rows: 73049 Data size: 4382940 Basic stats: COMPLETE Column stats: COMPLETE
-                  Filter Operator
-                    predicate: (d_week_seq is not null and d_date is not null) (type: boolean)
-                    Statistics: Num rows: 73049 Data size: 4382940 Basic stats: COMPLETE Column stats: COMPLETE
-                    Select Operator
-                      expressions: d_date (type: date), d_week_seq (type: int)
-                      outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 73049 Data size: 4382940 Basic stats: COMPLETE Column stats: COMPLETE
+                  alias: catalog_returns
+                  Statistics: Num rows: 4320980099 Data size: 86073249960 Basic stats: COMPLETE Column stats: COMPLETE
+                  Select Operator
+                    expressions: cr_item_sk (type: bigint), cr_return_quantity (type: int), cr_returned_date_sk (type: bigint)
+                    outputColumnNames: _col0, _col1, _col2
+                    Statistics: Num rows: 4320980099 Data size: 86073249960 Basic stats: COMPLETE Column stats: COMPLETE
+                    Map Join Operator
+                      condition map:
+                           Inner Join 0 to 1
+                      keys:
+                        0 _col2 (type: bigint)
+                        1 _col0 (type: bigint)
+                      outputColumnNames: _col0, _col1, _col4
+                      input vertices:
+                        1 Map 8
+                      Statistics: Num rows: 4320980099 Data size: 293480294712 Basic stats: COMPLETE Column stats: COMPLETE
                       Map Join Operator
                         condition map:
                              Left Semi Join 0 to 1
                         keys:
-                          0 _col1 (type: int)
-                          1 _col0 (type: int)
-                        outputColumnNames: _col0
+                          0 _col4 (type: date)
+                          1 _col0 (type: date)
+                        outputColumnNames: _col0, _col1
                         input vertices:
                           1 Map 3
-                        Statistics: Num rows: 73049 Data size: 4090744 Basic stats: COMPLETE Column stats: COMPLETE
-                        Group By Operator
-                          keys: _col0 (type: date)
-                          minReductionHashAggr: 0.99
-                          mode: hash
-                          outputColumnNames: _col0
-                          Statistics: Num rows: 36524 Data size: 2045344 Basic stats: COMPLETE Column stats: COMPLETE
-                          Reduce Output Operator
-                            key expressions: _col0 (type: date)
-                            null sort order: z
-                            sort order: +
-                            Map-reduce partition columns: _col0 (type: date)
-                            Statistics: Num rows: 36524 Data size: 2045344 Basic stats: COMPLETE Column stats: COMPLETE
-            Execution mode: vectorized, llap
-            LLAP IO: may be used (ACID table)
-        Map 10 
-            Map Operator Tree:
-                TableScan
-                  alias: store_returns
-                  Statistics: Num rows: 8332595709 Data size: 166044313360 Basic stats: COMPLETE Column stats: COMPLETE
-                  Select Operator
-                    expressions: sr_item_sk (type: bigint), sr_return_quantity (type: int), sr_returned_date_sk (type: bigint)
-                    outputColumnNames: _col0, _col1, _col2
-                    Statistics: Num rows: 8332595709 Data size: 166044313360 Basic stats: COMPLETE Column stats: COMPLETE
-                    Reduce Output Operator
-                      key expressions: _col2 (type: bigint)
-                      null sort order: z
-                      sort order: +
-                      Map-reduce partition columns: _col2 (type: bigint)
-                      Statistics: Num rows: 8332595709 Data size: 166044313360 Basic stats: COMPLETE Column stats: COMPLETE
-                      value expressions: _col0 (type: bigint), _col1 (type: int)
+                        Statistics: Num rows: 4320980099 Data size: 51505409168 Basic stats: COMPLETE Column stats: COMPLETE
+                        Map Join Operator
+                          condition map:
+                               Inner Join 0 to 1
+                          keys:
+                            0 _col0 (type: bigint)
+                            1 _col0 (type: bigint)
+                          outputColumnNames: _col1, _col6
+                          input vertices:
+                            1 Map 4
+                          Statistics: Num rows: 4320980099 Data size: 449035578276 Basic stats: COMPLETE Column stats: COMPLETE
+                          Group By Operator
+                            aggregations: sum(_col1)
+                            keys: _col6 (type: string)
+                            minReductionHashAggr: 0.99
+                            mode: hash
+                            outputColumnNames: _col0, _col1
+                            Statistics: Num rows: 434404620 Data size: 46915698960 Basic stats: COMPLETE Column stats: COMPLETE
+                            Reduce Output Operator
+                              key expressions: _col0 (type: string)
+                              null sort order: z
+                              sort order: +
+                              Map-reduce partition columns: _col0 (type: string)
+                              Statistics: Num rows: 434404620 Data size: 46915698960 Basic stats: COMPLETE Column stats: COMPLETE
+                              value expressions: _col1 (type: bigint)
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
-        Map 14 
+        Map 11 
             Map Operator Tree:
                 TableScan
                   alias: date_dim
@@ -103,7 +102,7 @@ STAGE PLANS:
                           Statistics: Num rows: 11297 Data size: 45188 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
-        Map 15 
+        Map 12 
             Map Operator Tree:
                 TableScan
                   alias: web_returns
@@ -112,40 +111,59 @@ STAGE PLANS:
                     expressions: wr_item_sk (type: bigint), wr_return_quantity (type: int), wr_returned_date_sk (type: bigint)
                     outputColumnNames: _col0, _col1, _col2
                     Statistics: Num rows: 2062802370 Data size: 41061626908 Basic stats: COMPLETE Column stats: COMPLETE
-                    Reduce Output Operator
-                      key expressions: _col2 (type: bigint)
-                      null sort order: z
-                      sort order: +
-                      Map-reduce partition columns: _col2 (type: bigint)
-                      Statistics: Num rows: 2062802370 Data size: 41061626908 Basic stats: COMPLETE Column stats: COMPLETE
-                      value expressions: _col0 (type: bigint), _col1 (type: int)
+                    Map Join Operator
+                      condition map:
+                           Inner Join 0 to 1
+                      keys:
+                        0 _col2 (type: bigint)
+                        1 _col0 (type: bigint)
+                      outputColumnNames: _col0, _col1, _col4
+                      input vertices:
+                        1 Reducer 9
+                      Statistics: Num rows: 2062802370 Data size: 140076140668 Basic stats: COMPLETE Column stats: COMPLETE
+                      Map Join Operator
+                        condition map:
+                             Left Semi Join 0 to 1
+                        keys:
+                          0 _col4 (type: date)
+                          1 _col0 (type: date)
+                        outputColumnNames: _col0, _col1
+                        input vertices:
+                          1 Map 8
+                        Statistics: Num rows: 2062802370 Data size: 24559207948 Basic stats: COMPLETE Column stats: COMPLETE
+                        Map Join Operator
+                          condition map:
+                               Inner Join 0 to 1
+                          keys:
+                            0 _col0 (type: bigint)
+                            1 _col0 (type: bigint)
+                          outputColumnNames: _col1, _col6
+                          input vertices:
+                            1 Map 4
+                          Statistics: Num rows: 2062802370 Data size: 214337025988 Basic stats: COMPLETE Column stats: COMPLETE
+                          Group By Operator
+                            aggregations: sum(_col1)
+                            keys: _col6 (type: string)
+                            minReductionHashAggr: 0.99
+                            mode: hash
+                            outputColumnNames: _col0, _col1
+                            Statistics: Num rows: 207425112 Data size: 22401912096 Basic stats: COMPLETE Column stats: COMPLETE
+                            Reduce Output Operator
+                              key expressions: _col0 (type: string)
+                              null sort order: z
+                              sort order: +
+                              Map-reduce partition columns: _col0 (type: string)
+                              Statistics: Num rows: 207425112 Data size: 22401912096 Basic stats: COMPLETE Column stats: COMPLETE
+                              value expressions: _col1 (type: bigint)
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
         Map 3 
             Map Operator Tree:
                 TableScan
                   alias: date_dim
-                  filterExpr: (((d_date) IN (DATE'1998-01-02', DATE'1998-10-15', DATE'1998-11-10') and d_week_seq is not null) or (d_week_seq is not null and d_date is not null) or d_date is not null) (type: boolean)
+                  filterExpr: (d_week_seq is not null and d_date is not null) (type: boolean)
+                  probeDecodeDetails: cacheKey:HASH_MAP_MAPJOIN_322_container, bigKeyColName:d_week_seq, smallTablePos:1, keyRatio:0.0
                   Statistics: Num rows: 73049 Data size: 4382940 Basic stats: COMPLETE Column stats: COMPLETE
-                  Filter Operator
-                    predicate: ((d_date) IN (DATE'1998-01-02', DATE'1998-10-15', DATE'1998-11-10') and d_week_seq is not null) (type: boolean)
-                    Statistics: Num rows: 73049 Data size: 4382940 Basic stats: COMPLETE Column stats: COMPLETE
-                    Select Operator
-                      expressions: d_week_seq (type: int)
-                      outputColumnNames: _col0
-                      Statistics: Num rows: 73049 Data size: 292196 Basic stats: COMPLETE Column stats: COMPLETE
-                      Group By Operator
-                        keys: _col0 (type: int)
-                        minReductionHashAggr: 0.8453504
-                        mode: hash
-                        outputColumnNames: _col0
-                        Statistics: Num rows: 11297 Data size: 45188 Basic stats: COMPLETE Column stats: COMPLETE
-                        Reduce Output Operator
-                          key expressions: _col0 (type: int)
-                          null sort order: z
-                          sort order: +
-                          Map-reduce partition columns: _col0 (type: int)
-                          Statistics: Num rows: 11297 Data size: 45188 Basic stats: COMPLETE Column stats: COMPLETE
                   Filter Operator
                     predicate: (d_week_seq is not null and d_date is not null) (type: boolean)
                     Statistics: Num rows: 73049 Data size: 4382940 Basic stats: COMPLETE Column stats: COMPLETE
@@ -161,7 +179,7 @@ STAGE PLANS:
                           1 _col0 (type: int)
                         outputColumnNames: _col0
                         input vertices:
-                          1 Map 14
+                          1 Map 8
                         Statistics: Num rows: 73049 Data size: 4090744 Basic stats: COMPLETE Column stats: COMPLETE
                         Group By Operator
                           keys: _col0 (type: date)
@@ -175,48 +193,9 @@ STAGE PLANS:
                             sort order: +
                             Map-reduce partition columns: _col0 (type: date)
                             Statistics: Num rows: 36524 Data size: 2045344 Basic stats: COMPLETE Column stats: COMPLETE
-                  Filter Operator
-                    predicate: d_date is not null (type: boolean)
-                    Statistics: Num rows: 73049 Data size: 4675136 Basic stats: COMPLETE Column stats: COMPLETE
-                    Select Operator
-                      expressions: d_date_sk (type: bigint), d_date (type: date)
-                      outputColumnNames: _col0, _col1
-                      Statistics: Num rows: 73049 Data size: 4675136 Basic stats: COMPLETE Column stats: COMPLETE
-                      Reduce Output Operator
-                        key expressions: _col1 (type: date)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col1 (type: date)
-                        Statistics: Num rows: 73049 Data size: 4675136 Basic stats: COMPLETE Column stats: COMPLETE
-                        value expressions: _col0 (type: bigint)
-                      Reduce Output Operator
-                        key expressions: _col1 (type: date)
-                        null sort order: z
-                        sort order: +
-                        Map-reduce partition columns: _col1 (type: date)
-                        Statistics: Num rows: 73049 Data size: 4675136 Basic stats: COMPLETE Column stats: COMPLETE
-                        value expressions: _col0 (type: bigint)
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
-        Map 6 
-            Map Operator Tree:
-                TableScan
-                  alias: catalog_returns
-                  Statistics: Num rows: 4320980099 Data size: 86073249960 Basic stats: COMPLETE Column stats: COMPLETE
-                  Select Operator
-                    expressions: cr_item_sk (type: bigint), cr_return_quantity (type: int), cr_returned_date_sk (type: bigint)
-                    outputColumnNames: _col0, _col1, _col2
-                    Statistics: Num rows: 4320980099 Data size: 86073249960 Basic stats: COMPLETE Column stats: COMPLETE
-                    Reduce Output Operator
-                      key expressions: _col2 (type: bigint)
-                      null sort order: z
-                      sort order: +
-                      Map-reduce partition columns: _col2 (type: bigint)
-                      Statistics: Num rows: 4320980099 Data size: 86073249960 Basic stats: COMPLETE Column stats: COMPLETE
-                      value expressions: _col0 (type: bigint), _col1 (type: int)
-            Execution mode: vectorized, llap
-            LLAP IO: may be used (ACID table)
-        Map 9 
+        Map 4 
             Map Operator Tree:
                 TableScan
                   alias: item
@@ -248,45 +227,249 @@ STAGE PLANS:
                       value expressions: _col1 (type: string)
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
-        Reducer 11 
+        Map 5 
+            Map Operator Tree:
+                TableScan
+                  alias: store_returns
+                  Statistics: Num rows: 8332595709 Data size: 166044313360 Basic stats: COMPLETE Column stats: COMPLETE
+                  Select Operator
+                    expressions: sr_item_sk (type: bigint), sr_return_quantity (type: int), sr_returned_date_sk (type: bigint)
+                    outputColumnNames: _col0, _col1, _col2
+                    Statistics: Num rows: 8332595709 Data size: 166044313360 Basic stats: COMPLETE Column stats: COMPLETE
+                    Map Join Operator
+                      condition map:
+                           Inner Join 0 to 1
+                      keys:
+                        0 _col2 (type: bigint)
+                        1 _col0 (type: bigint)
+                      outputColumnNames: _col0, _col1, _col4
+                      input vertices:
+                        1 Reducer 10
+                      Statistics: Num rows: 8332595709 Data size: 566008907392 Basic stats: COMPLETE Column stats: COMPLETE
+                      Map Join Operator
+                        condition map:
+                             Left Semi Join 0 to 1
+                        keys:
+                          0 _col4 (type: date)
+                          1 _col0 (type: date)
+                        outputColumnNames: _col0, _col1
+                        input vertices:
+                          1 Map 8
+                        Statistics: Num rows: 8332595709 Data size: 99383547688 Basic stats: COMPLETE Column stats: COMPLETE
+                        Map Join Operator
+                          condition map:
+                               Inner Join 0 to 1
+                          keys:
+                            0 _col0 (type: bigint)
+                            1 _col0 (type: bigint)
+                          outputColumnNames: _col1, _col6
+                          input vertices:
+                            1 Map 4
+                          Statistics: Num rows: 8332595709 Data size: 865982352916 Basic stats: COMPLETE Column stats: COMPLETE
+                          Group By Operator
+                            aggregations: sum(_col1)
+                            keys: _col6 (type: string)
+                            minReductionHashAggr: 0.99
+                            mode: hash
+                            outputColumnNames: _col0, _col1
+                            Statistics: Num rows: 837373692 Data size: 90436358736 Basic stats: COMPLETE Column stats: COMPLETE
+                            Reduce Output Operator
+                              key expressions: _col0 (type: string)
+                              null sort order: z
+                              sort order: +
+                              Map-reduce partition columns: _col0 (type: string)
+                              Statistics: Num rows: 837373692 Data size: 90436358736 Basic stats: COMPLETE Column stats: COMPLETE
+                              value expressions: _col1 (type: bigint)
+            Execution mode: vectorized, llap
+            LLAP IO: may be used (ACID table)
+        Map 8 
+            Map Operator Tree:
+                TableScan
+                  alias: date_dim
+                  filterExpr: ((d_week_seq is not null and d_date is not null) or ((d_date) IN (DATE'1998-01-02', DATE'1998-10-15', DATE'1998-11-10') and d_week_seq is not null) or d_date is not null) (type: boolean)
+                  Statistics: Num rows: 73049 Data size: 4382940 Basic stats: COMPLETE Column stats: COMPLETE
+                  Filter Operator
+                    predicate: (d_week_seq is not null and d_date is not null) (type: boolean)
+                    Statistics: Num rows: 73049 Data size: 4382940 Basic stats: COMPLETE Column stats: COMPLETE
+                    Select Operator
+                      expressions: d_date (type: date), d_week_seq (type: int)
+                      outputColumnNames: _col0, _col1
+                      Statistics: Num rows: 73049 Data size: 4382940 Basic stats: COMPLETE Column stats: COMPLETE
+                      Map Join Operator
+                        condition map:
+                             Left Semi Join 0 to 1
+                        keys:
+                          0 _col1 (type: int)
+                          1 _col0 (type: int)
+                        outputColumnNames: _col0
+                        input vertices:
+                          1 Map 11
+                        Statistics: Num rows: 73049 Data size: 4090744 Basic stats: COMPLETE Column stats: COMPLETE
+                        Group By Operator
+                          keys: _col0 (type: date)
+                          minReductionHashAggr: 0.99
+                          mode: hash
+                          outputColumnNames: _col0
+                          Statistics: Num rows: 36524 Data size: 2045344 Basic stats: COMPLETE Column stats: COMPLETE
+                          Reduce Output Operator
+                            key expressions: _col0 (type: date)
+                            null sort order: z
+                            sort order: +
+                            Map-reduce partition columns: _col0 (type: date)
+                            Statistics: Num rows: 36524 Data size: 2045344 Basic stats: COMPLETE Column stats: COMPLETE
+                          Reduce Output Operator
+                            key expressions: _col0 (type: date)
+                            null sort order: z
+                            sort order: +
+                            Map-reduce partition columns: _col0 (type: date)
+                            Statistics: Num rows: 36524 Data size: 2045344 Basic stats: COMPLETE Column stats: COMPLETE
+                  Filter Operator
+                    predicate: ((d_date) IN (DATE'1998-01-02', DATE'1998-10-15', DATE'1998-11-10') and d_week_seq is not null) (type: boolean)
+                    Statistics: Num rows: 73049 Data size: 4382940 Basic stats: COMPLETE Column stats: COMPLETE
+                    Select Operator
+                      expressions: d_week_seq (type: int)
+                      outputColumnNames: _col0
+                      Statistics: Num rows: 73049 Data size: 292196 Basic stats: COMPLETE Column stats: COMPLETE
+                      Group By Operator
+                        keys: _col0 (type: int)
+                        minReductionHashAggr: 0.8453504
+                        mode: hash
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 11297 Data size: 45188 Basic stats: COMPLETE Column stats: COMPLETE
+                        Reduce Output Operator
+                          key expressions: _col0 (type: int)
+                          null sort order: z
+                          sort order: +
+                          Map-reduce partition columns: _col0 (type: int)
+                          Statistics: Num rows: 11297 Data size: 45188 Basic stats: COMPLETE Column stats: COMPLETE
+                  Filter Operator
+                    predicate: d_date is not null (type: boolean)
+                    Statistics: Num rows: 73049 Data size: 4675136 Basic stats: COMPLETE Column stats: COMPLETE
+                    Select Operator
+                      expressions: d_date_sk (type: bigint), d_date (type: date)
+                      outputColumnNames: _col0, _col1
+                      Statistics: Num rows: 73049 Data size: 4675136 Basic stats: COMPLETE Column stats: COMPLETE
+                      Reduce Output Operator
+                        key expressions: _col0 (type: bigint)
+                        null sort order: z
+                        sort order: +
+                        Map-reduce partition columns: _col0 (type: bigint)
+                        Statistics: Num rows: 73049 Data size: 4675136 Basic stats: COMPLETE Column stats: COMPLETE
+                        value expressions: _col1 (type: date)
+                      Select Operator
+                        expressions: _col0 (type: bigint)
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 73049 Data size: 584392 Basic stats: COMPLETE Column stats: COMPLETE
+                        Group By Operator
+                          keys: _col0 (type: bigint)
+                          minReductionHashAggr: 0.4
+                          mode: hash
+                          outputColumnNames: _col0
+                          Statistics: Num rows: 67850 Data size: 542800 Basic stats: COMPLETE Column stats: COMPLETE
+                          Dynamic Partitioning Event Operator
+                            Target column: wr_returned_date_sk (bigint)
+                            Target Input: web_returns
+                            Partition key expr: wr_returned_date_sk
+                            Statistics: Num rows: 67850 Data size: 542800 Basic stats: COMPLETE Column stats: COMPLETE
+                            Target Vertex: Map 12
+                      Reduce Output Operator
+                        key expressions: _col0 (type: bigint)
+                        null sort order: z
+                        sort order: +
+                        Map-reduce partition columns: _col0 (type: bigint)
+                        Statistics: Num rows: 73049 Data size: 4675136 Basic stats: COMPLETE Column stats: COMPLETE
+                        value expressions: _col1 (type: date)
+                      Select Operator
+                        expressions: _col0 (type: bigint)
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 73049 Data size: 584392 Basic stats: COMPLETE Column stats: COMPLETE
+                        Group By Operator
+                          keys: _col0 (type: bigint)
+                          minReductionHashAggr: 0.4
+                          mode: hash
+                          outputColumnNames: _col0
+                          Statistics: Num rows: 67850 Data size: 542800 Basic stats: COMPLETE Column stats: COMPLETE
+                          Dynamic Partitioning Event Operator
+                            Target column: cr_returned_date_sk (bigint)
+                            Target Input: catalog_returns
+                            Partition key expr: cr_returned_date_sk
+                            Statistics: Num rows: 67850 Data size: 542800 Basic stats: COMPLETE Column stats: COMPLETE
+                            Target Vertex: Map 1
+                      Reduce Output Operator
+                        key expressions: _col0 (type: bigint)
+                        null sort order: z
+                        sort order: +
+                        Map-reduce partition columns: _col0 (type: bigint)
+                        Statistics: Num rows: 73049 Data size: 4675136 Basic stats: COMPLETE Column stats: COMPLETE
+                        value expressions: _col1 (type: date)
+                      Select Operator
+                        expressions: _col0 (type: bigint)
+                        outputColumnNames: _col0
+                        Statistics: Num rows: 73049 Data size: 584392 Basic stats: COMPLETE Column stats: COMPLETE
+                        Group By Operator
+                          keys: _col0 (type: bigint)
+                          minReductionHashAggr: 0.4
+                          mode: hash
+                          outputColumnNames: _col0
+                          Statistics: Num rows: 67850 Data size: 542800 Basic stats: COMPLETE Column stats: COMPLETE
+                          Dynamic Partitioning Event Operator
+                            Target column: sr_returned_date_sk (bigint)
+                            Target Input: store_returns
+                            Partition key expr: sr_returned_date_sk
+                            Statistics: Num rows: 67850 Data size: 542800 Basic stats: COMPLETE Column stats: COMPLETE
+                            Target Vertex: Map 5
+            Execution mode: vectorized, llap
+            LLAP IO: may be used (ACID table)
+        Reducer 10 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
-              Map Join Operator
-                condition map:
-                     Inner Join 0 to 1
-                keys:
-                  0 KEY.reducesinkkey0 (type: bigint)
-                  1 KEY.reducesinkkey0 (type: bigint)
-                outputColumnNames: _col3, _col4
-                input vertices:
-                  0 Reducer 2
-                Statistics: Num rows: 322153773 Data size: 3258244456 Basic stats: COMPLETE Column stats: COMPLETE
-                DynamicPartitionHashJoin: true
-                Map Join Operator
-                  condition map:
-                       Inner Join 0 to 1
-                  keys:
-                    0 _col3 (type: bigint)
-                    1 _col0 (type: bigint)
-                  outputColumnNames: _col4, _col7
-                  input vertices:
-                    1 Map 9
-                  Statistics: Num rows: 322153773 Data size: 32896391572 Basic stats: COMPLETE Column stats: COMPLETE
-                  Group By Operator
-                    aggregations: sum(_col4)
-                    keys: _col7 (type: string)
-                    minReductionHashAggr: 0.99
-                    mode: hash
-                    outputColumnNames: _col0, _col1
-                    Statistics: Num rows: 31930596 Data size: 3448504368 Basic stats: COMPLETE Column stats: COMPLETE
-                    Reduce Output Operator
-                      key expressions: _col0 (type: string)
-                      null sort order: z
-                      sort order: +
-                      Map-reduce partition columns: _col0 (type: string)
-                      Statistics: Num rows: 31930596 Data size: 3448504368 Basic stats: COMPLETE Column stats: COMPLETE
-                      value expressions: _col1 (type: bigint)
-        Reducer 12 
+              Select Operator
+                expressions: KEY.reducesinkkey0 (type: bigint), VALUE._col0 (type: date)
+                outputColumnNames: _col0, _col1
+                Reduce Output Operator
+                  key expressions: _col0 (type: bigint)
+                  null sort order: z
+                  sort order: +
+                  Map-reduce partition columns: _col0 (type: bigint)
+                  Statistics: Num rows: 73049 Data size: 4675136 Basic stats: COMPLETE Column stats: COMPLETE
+                  value expressions: _col1 (type: date)
+        Reducer 13 
+            Execution mode: vectorized, llap
+            Reduce Operator Tree:
+              Group By Operator
+                aggregations: sum(VALUE._col0)
+                keys: KEY._col0 (type: string)
+                mode: mergepartial
+                outputColumnNames: _col0, _col1
+                Statistics: Num rows: 247524 Data size: 26732592 Basic stats: COMPLETE Column stats: COMPLETE
+                Select Operator
+                  expressions: _col0 (type: string), _col1 (type: bigint), UDFToDouble(_col1) (type: double)
+                  outputColumnNames: _col0, _col1, _col2
+                  Statistics: Num rows: 247524 Data size: 28712784 Basic stats: COMPLETE Column stats: COMPLETE
+                  Reduce Output Operator
+                    key expressions: _col0 (type: string)
+                    null sort order: z
+                    sort order: +
+                    Map-reduce partition columns: _col0 (type: string)
+                    Statistics: Num rows: 247524 Data size: 28712784 Basic stats: COMPLETE Column stats: COMPLETE
+                    value expressions: _col1 (type: bigint), _col2 (type: double)
+        Reducer 2 
+            Execution mode: vectorized, llap
+            Reduce Operator Tree:
+              Group By Operator
+                aggregations: sum(VALUE._col0)
+                keys: KEY._col0 (type: string)
+                mode: mergepartial
+                outputColumnNames: _col0, _col1
+                Statistics: Num rows: 247524 Data size: 26732592 Basic stats: COMPLETE Column stats: COMPLETE
+                Reduce Output Operator
+                  key expressions: _col0 (type: string)
+                  null sort order: z
+                  sort order: +
+                  Map-reduce partition columns: _col0 (type: string)
+                  Statistics: Num rows: 247524 Data size: 26732592 Basic stats: COMPLETE Column stats: COMPLETE
+                  value expressions: _col1 (type: bigint)
+        Reducer 6 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Group By Operator
@@ -303,7 +486,7 @@ STAGE PLANS:
                     1 _col0 (type: string)
                   outputColumnNames: _col0, _col1, _col3
                   input vertices:
-                    0 Reducer 8
+                    0 Reducer 2
                   Statistics: Num rows: 247524 Data size: 28712784 Basic stats: COMPLETE Column stats: COMPLETE
                   Map Join Operator
                     condition map:
@@ -313,7 +496,7 @@ STAGE PLANS:
                       1 _col0 (type: string)
                     outputColumnNames: _col0, _col1, _col3, _col5, _col6
                     input vertices:
-                      1 Reducer 17
+                      1 Reducer 13
                     Statistics: Num rows: 247524 Data size: 32673168 Basic stats: COMPLETE Column stats: COMPLETE
                     Top N Key Operator
                       sort order: ++
@@ -331,7 +514,7 @@ STAGE PLANS:
                           sort order: ++
                           Statistics: Num rows: 247524 Data size: 64356240 Basic stats: COMPLETE Column stats: COMPLETE
                           value expressions: _col2 (type: double), _col3 (type: bigint), _col4 (type: double), _col5 (type: bigint), _col6 (type: double), _col7 (type: decimal(25,6))
-        Reducer 13 
+        Reducer 7 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Select Operator
@@ -348,233 +531,19 @@ STAGE PLANS:
                         input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                         output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
                         serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
-        Reducer 16 
-            Execution mode: vectorized, llap
-            Reduce Operator Tree:
-              Map Join Operator
-                condition map:
-                     Inner Join 0 to 1
-                keys:
-                  0 KEY.reducesinkkey0 (type: bigint)
-                  1 KEY.reducesinkkey0 (type: bigint)
-                outputColumnNames: _col3, _col4
-                input vertices:
-                  0 Reducer 4
-                Statistics: Num rows: 79751808 Data size: 762601204 Basic stats: COMPLETE Column stats: COMPLETE
-                DynamicPartitionHashJoin: true
-                Map Join Operator
-                  condition map:
-                       Inner Join 0 to 1
-                  keys:
-                    0 _col3 (type: bigint)
-                    1 _col0 (type: bigint)
-                  outputColumnNames: _col4, _col7
-                  input vertices:
-                    1 Map 9
-                  Statistics: Num rows: 79751808 Data size: 8099767540 Basic stats: COMPLETE Column stats: COMPLETE
-                  Group By Operator
-                    aggregations: sum(_col4)
-                    keys: _col7 (type: string)
-                    minReductionHashAggr: 0.99
-                    mode: hash
-                    outputColumnNames: _col0, _col1
-                    Statistics: Num rows: 7920768 Data size: 855442944 Basic stats: COMPLETE Column stats: COMPLETE
-                    Reduce Output Operator
-                      key expressions: _col0 (type: string)
-                      null sort order: z
-                      sort order: +
-                      Map-reduce partition columns: _col0 (type: string)
-                      Statistics: Num rows: 7920768 Data size: 855442944 Basic stats: COMPLETE Column stats: COMPLETE
-                      value expressions: _col1 (type: bigint)
-        Reducer 17 
-            Execution mode: vectorized, llap
-            Reduce Operator Tree:
-              Group By Operator
-                aggregations: sum(VALUE._col0)
-                keys: KEY._col0 (type: string)
-                mode: mergepartial
-                outputColumnNames: _col0, _col1
-                Statistics: Num rows: 247524 Data size: 26732592 Basic stats: COMPLETE Column stats: COMPLETE
-                Select Operator
-                  expressions: _col0 (type: string), _col1 (type: bigint), UDFToDouble(_col1) (type: double)
-                  outputColumnNames: _col0, _col1, _col2
-                  Statistics: Num rows: 247524 Data size: 28712784 Basic stats: COMPLETE Column stats: COMPLETE
-                  Reduce Output Operator
-                    key expressions: _col0 (type: string)
-                    null sort order: z
-                    sort order: +
-                    Map-reduce partition columns: _col0 (type: string)
-                    Statistics: Num rows: 247524 Data size: 28712784 Basic stats: COMPLETE Column stats: COMPLETE
-                    value expressions: _col1 (type: bigint), _col2 (type: double)
-        Reducer 2 
-            Execution mode: vectorized, llap
-            Reduce Operator Tree:
-              Group By Operator
-                keys: KEY._col0 (type: date)
-                mode: mergepartial
-                outputColumnNames: _col0
-                Statistics: Num rows: 18262 Data size: 1022672 Basic stats: COMPLETE Column stats: COMPLETE
-                Map Join Operator
-                  condition map:
-                       Inner Join 0 to 1
-                  keys:
-                    0 _col1 (type: date)
-                    1 _col0 (type: date)
-                  outputColumnNames: _col0
-                  input vertices:
-                    0 Map 3
-                  Statistics: Num rows: 1334020838 Data size: 10672166704 Basic stats: COMPLETE Column stats: COMPLETE
-                  Reduce Output Operator
-                    key expressions: _col0 (type: bigint)
-                    null sort order: z
-                    sort order: +
-                    Map-reduce partition columns: _col0 (type: bigint)
-                    Statistics: Num rows: 1334020838 Data size: 10672166704 Basic stats: COMPLETE Column stats: COMPLETE
-                  Select Operator
-                    expressions: _col0 (type: bigint)
-                    outputColumnNames: _col0
-                    Statistics: Num rows: 1334020838 Data size: 10672166704 Basic stats: COMPLETE Column stats: COMPLETE
-                    Group By Operator
-                      keys: _col0 (type: bigint)
-                      minReductionHashAggr: 0.99
-                      mode: hash
-                      outputColumnNames: _col0
-                      Statistics: Num rows: 2849700 Data size: 22797600 Basic stats: COMPLETE Column stats: COMPLETE
-                      Dynamic Partitioning Event Operator
-                        Target column: cr_returned_date_sk (bigint)
-                        Target Input: catalog_returns
-                        Partition key expr: cr_returned_date_sk
-                        Statistics: Num rows: 2849700 Data size: 22797600 Basic stats: COMPLETE Column stats: COMPLETE
-                        Target Vertex: Map 6
-                  Reduce Output Operator
-                    key expressions: _col0 (type: bigint)
-                    null sort order: z
-                    sort order: +
-                    Map-reduce partition columns: _col0 (type: bigint)
-                    Statistics: Num rows: 1334020838 Data size: 10672166704 Basic stats: COMPLETE Column stats: COMPLETE
-                  Select Operator
-                    expressions: _col0 (type: bigint)
-                    outputColumnNames: _col0
-                    Statistics: Num rows: 1334020838 Data size: 10672166704 Basic stats: COMPLETE Column stats: COMPLETE
-                    Group By Operator
-                      keys: _col0 (type: bigint)
-                      minReductionHashAggr: 0.99
-                      mode: hash
-                      outputColumnNames: _col0
-                      Statistics: Num rows: 2849700 Data size: 22797600 Basic stats: COMPLETE Column stats: COMPLETE
-                      Dynamic Partitioning Event Operator
-                        Target column: sr_returned_date_sk (bigint)
-                        Target Input: store_returns
-                        Partition key expr: sr_returned_date_sk
-                        Statistics: Num rows: 2849700 Data size: 22797600 Basic stats: COMPLETE Column stats: COMPLETE
-                        Target Vertex: Map 10
-        Reducer 4 
-            Execution mode: vectorized, llap
-            Reduce Operator Tree:
-              Group By Operator
-                keys: KEY._col0 (type: date)
-                mode: mergepartial
-                outputColumnNames: _col0
-                Statistics: Num rows: 18262 Data size: 1022672 Basic stats: COMPLETE Column stats: COMPLETE
-                Map Join Operator
-                  condition map:
-                       Inner Join 0 to 1
-                  keys:
-                    0 _col1 (type: date)
-                    1 _col0 (type: date)
-                  outputColumnNames: _col0
-                  input vertices:
-                    0 Reducer 5
-                  Statistics: Num rows: 1334020838 Data size: 10672166704 Basic stats: COMPLETE Column stats: COMPLETE
-                  Reduce Output Operator
-                    key expressions: _col0 (type: bigint)
-                    null sort order: z
-                    sort order: +
-                    Map-reduce partition columns: _col0 (type: bigint)
-                    Statistics: Num rows: 1334020838 Data size: 10672166704 Basic stats: COMPLETE Column stats: COMPLETE
-                  Select Operator
-                    expressions: _col0 (type: bigint)
-                    outputColumnNames: _col0
-                    Statistics: Num rows: 1334020838 Data size: 10672166704 Basic stats: COMPLETE Column stats: COMPLETE
-                    Group By Operator
-                      keys: _col0 (type: bigint)
-                      minReductionHashAggr: 0.99
-                      mode: hash
-                      outputColumnNames: _col0
-                      Statistics: Num rows: 2849700 Data size: 22797600 Basic stats: COMPLETE Column stats: COMPLETE
-                      Dynamic Partitioning Event Operator
-                        Target column: wr_returned_date_sk (bigint)
-                        Target Input: web_returns
-                        Partition key expr: wr_returned_date_sk
-                        Statistics: Num rows: 2849700 Data size: 22797600 Basic stats: COMPLETE Column stats: COMPLETE
-                        Target Vertex: Map 15
-        Reducer 5 
+        Reducer 9 
             Execution mode: vectorized, llap
             Reduce Operator Tree:
               Select Operator
-                expressions: KEY.reducesinkkey0 (type: date), VALUE._col0 (type: bigint)
-                outputColumnNames: _col1, _col0
-                Reduce Output Operator
-                  key expressions: _col1 (type: date)
-                  null sort order: z
-                  sort order: +
-                  Map-reduce partition columns: _col1 (type: date)
-                  Statistics: Num rows: 73049 Data size: 4675136 Basic stats: COMPLETE Column stats: COMPLETE
-                  value expressions: _col0 (type: bigint)
-        Reducer 7 
-            Execution mode: vectorized, llap
-            Reduce Operator Tree:
-              Map Join Operator
-                condition map:
-                     Inner Join 0 to 1
-                keys:
-                  0 KEY.reducesinkkey0 (type: bigint)
-                  1 KEY.reducesinkkey0 (type: bigint)
-                outputColumnNames: _col3, _col4
-                input vertices:
-                  0 Reducer 2
-                Statistics: Num rows: 167057192 Data size: 1658334284 Basic stats: COMPLETE Column stats: COMPLETE
-                DynamicPartitionHashJoin: true
-                Map Join Operator
-                  condition map:
-                       Inner Join 0 to 1
-                  keys:
-                    0 _col3 (type: bigint)
-                    1 _col0 (type: bigint)
-                  outputColumnNames: _col4, _col7
-                  input vertices:
-                    1 Map 9
-                  Statistics: Num rows: 167057192 Data size: 17027595948 Basic stats: COMPLETE Column stats: COMPLETE
-                  Group By Operator
-                    aggregations: sum(_col4)
-                    keys: _col7 (type: string)
-                    minReductionHashAggr: 0.99
-                    mode: hash
-                    outputColumnNames: _col0, _col1
-                    Statistics: Num rows: 16584108 Data size: 1791083664 Basic stats: COMPLETE Column stats: COMPLETE
-                    Reduce Output Operator
-                      key expressions: _col0 (type: string)
-                      null sort order: z
-                      sort order: +
-                      Map-reduce partition columns: _col0 (type: string)
-                      Statistics: Num rows: 16584108 Data size: 1791083664 Basic stats: COMPLETE Column stats: COMPLETE
-                      value expressions: _col1 (type: bigint)
-        Reducer 8 
-            Execution mode: vectorized, llap
-            Reduce Operator Tree:
-              Group By Operator
-                aggregations: sum(VALUE._col0)
-                keys: KEY._col0 (type: string)
-                mode: mergepartial
+                expressions: KEY.reducesinkkey0 (type: bigint), VALUE._col0 (type: date)
                 outputColumnNames: _col0, _col1
-                Statistics: Num rows: 247524 Data size: 26732592 Basic stats: COMPLETE Column stats: COMPLETE
                 Reduce Output Operator
-                  key expressions: _col0 (type: string)
+                  key expressions: _col0 (type: bigint)
                   null sort order: z
                   sort order: +
-                  Map-reduce partition columns: _col0 (type: string)
-                  Statistics: Num rows: 247524 Data size: 26732592 Basic stats: COMPLETE Column stats: COMPLETE
-                  value expressions: _col1 (type: bigint)
+                  Map-reduce partition columns: _col0 (type: bigint)
+                  Statistics: Num rows: 73049 Data size: 4675136 Basic stats: COMPLETE Column stats: COMPLETE
+                  value expressions: _col1 (type: date)
 
   Stage: Stage-0
     Fetch Operator
diff --git a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query95.q.out b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query95.q.out
index 7e107b28c9..40f1110362 100644
--- a/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query95.q.out
+++ b/ql/src/test/results/clientpositive/perf/tpcds30tb/tez/query95.q.out
@@ -62,17 +62,13 @@ STAGE PLANS:
                             input vertices:
                               1 Map 13
                             Statistics: Num rows: 6463723 Data size: 895528872 Basic stats: COMPLETE Column stats: COMPLETE
-                            Select Operator
-                              expressions: _col3 (type: bigint), _col4 (type: decimal(7,2)), _col5 (type: decimal(7,2))
-                              outputColumnNames: _col0, _col1, _col2
+                            Reduce Output Operator
+                              key expressions: _col3 (type: bigint)
+                              null sort order: z
+                              sort order: +
+                              Map-reduce partition columns: _col3 (type: bigint)
                               Statistics: Num rows: 6463723 Data size: 895528872 Basic stats: COMPLETE Column stats: COMPLETE
-                              Reduce Output Operator
-                                key expressions: _col0 (type: bigint)
-                                null sort order: z
-                                sort order: +
-                                Map-reduce partition columns: _col0 (type: bigint)
-                                Statistics: Num rows: 6463723 Data size: 895528872 Basic stats: COMPLETE Column stats: COMPLETE
-                                value expressions: _col1 (type: decimal(7,2)), _col2 (type: decimal(7,2))
+                              value expressions: _col4 (type: decimal(7,2)), _col5 (type: decimal(7,2))
                   Select Operator
                     expressions: ws_warehouse_sk (type: bigint), ws_order_number (type: bigint)
                     outputColumnNames: _col0, _col1
@@ -123,13 +119,13 @@ STAGE PLANS:
                     Select Operator
                       expressions: ca_address_sk (type: bigint)
                       outputColumnNames: _col0
-                      Statistics: Num rows: 754717 Data size: 6037736 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 754717 Data size: 70943398 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
                         key expressions: _col0 (type: bigint)
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 754717 Data size: 6037736 Basic stats: COMPLETE Column stats: COMPLETE
+                        Statistics: Num rows: 754717 Data size: 70943398 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
         Map 12 
@@ -144,13 +140,13 @@ STAGE PLANS:
                     Select Operator
                       expressions: web_site_sk (type: bigint)
                       outputColumnNames: _col0
-                      Statistics: Num rows: 12 Data size: 96 Basic stats: COMPLETE Column stats: COMPLETE
+                      Statistics: Num rows: 12 Data size: 1704 Basic stats: COMPLETE Column stats: COMPLETE
                       Reduce Output Operator
                         key expressions: _col0 (type: bigint)
                         null sort order: z
                         sort order: +
                         Map-reduce partition columns: _col0 (type: bigint)
-                        Statistics: Num rows: 12 Data size: 96 Basic stats: COMPLETE Column stats: COMPLETE
+                        Statistics: Num rows: 12 Data size: 1704 Basic stats: COMPLETE Column stats: COMPLETE
             Execution mode: vectorized, llap
             LLAP IO: may be used (ACID table)
         Map 13 
@@ -237,22 +233,22 @@ STAGE PLANS:
                 keys:
                   0 KEY.reducesinkkey0 (type: bigint)
                   1 KEY.reducesinkkey0 (type: bigint)
-                outputColumnNames: _col0, _col1, _col2
+                outputColumnNames: _col3, _col4, _col5
                 input vertices:
                   1 Reducer 8
                 Statistics: Num rows: 6463723 Data size: 895528872 Basic stats: COMPLETE Column stats: COMPLETE
                 DynamicPartitionHashJoin: true
                 Reduce Output Operator
-                  key expressions: _col0 (type: bigint)
+                  key expressions: _col3 (type: bigint)
                   null sort order: z
                   sort order: +
-                  Map-reduce partition columns: _col0 (type: bigint)
+                  Map-reduce partition columns: _col3 (type: bigint)
                   Statistics: Num rows: 6463723 Data size: 895528872 Basic stats: COMPLETE Column stats: COMPLETE
-                  value expressions: _col1 (type: decimal(7,2)), _col2 (type: decimal(7,2))
+                  value expressions: _col4 (type: decimal(7,2)), _col5 (type: decimal(7,2))
                 Select Operator
-                  expressions: _col0 (type: bigint)
+                  expressions: _col3 (type: bigint)
                   outputColumnNames: _col0
-                  Statistics: Num rows: 6463723 Data size: 51709784 Basic stats: COMPLETE Column stats: COMPLETE
+                  Statistics: Num rows: 6463723 Data size: 103419568 Basic stats: COMPLETE Column stats: COMPLETE
                   Group By Operator
                     aggregations: min(_col0), max(_col0), bloom_filter(_col0, expectedEntries=1000000)
                     minReductionHashAggr: 0.99
@@ -271,13 +267,13 @@ STAGE PLANS:
                 condition map:
                      Left Semi Join 0 to 1
                 keys:
-                  0 _col0 (type: bigint)
+                  0 _col3 (type: bigint)
                   1 _col0 (type: bigint)
-                outputColumnNames: _col0, _col1, _col2
+                outputColumnNames: _col3, _col4, _col5
                 Statistics: Num rows: 6463723 Data size: 895528872 Basic stats: COMPLETE Column stats: COMPLETE
                 Group By Operator
-                  aggregations: sum(_col1), sum(_col2)
-                  keys: _col0 (type: bigint)
+                  aggregations: sum(_col4), sum(_col5)
+                  keys: _col3 (type: bigint)
                   minReductionHashAggr: 0.91645867
                   mode: hash
                   outputColumnNames: _col0, _col2, _col3
