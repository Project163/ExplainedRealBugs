diff --git a/CHANGES.txt b/CHANGES.txt
index 6b129049de..1168f82633 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -22,6 +22,9 @@ Trunk (unreleased changes)
 
   BUG FIXES
 
+    HIVE-349. Fix TestCliDriver when there are test cases with no tasks.
+    (Suresh Antony via zshao)
+
     HIVE-339. Fix count distinct in 1 map-reduce job with map side
     aggregation. (Namit Jain via zshao)
 
diff --git a/ql/src/test/templates/TestCliDriver.vm b/ql/src/test/templates/TestCliDriver.vm
index 1447a5cfef..c776121123 100644
--- a/ql/src/test/templates/TestCliDriver.vm
+++ b/ql/src/test/templates/TestCliDriver.vm
@@ -75,11 +75,13 @@ public class $className extends TestCase {
         Map<String, QueryInfo> jobInfoMap = hv.getJobInfoMap();
         Map<String, TaskInfo> taskInfoMap = hv.getTaskInfoMap();
 
-        String cmd = (String)jobInfoMap.keySet().toArray()[0];
-        QueryInfo ji = jobInfoMap.get(cmd);
+        if(jobInfoMap.size() != 0) {
+          String cmd = (String)jobInfoMap.keySet().toArray()[0];
+          QueryInfo ji = jobInfoMap.get(cmd);
 
-        if (!ji.hm.get(Keys.QUERY_RET_CODE.name()).equals("0")) {
-            fail("Wrong return code in hive history");
+          if (!ji.hm.get(Keys.QUERY_RET_CODE.name()).equals("0")) {
+              fail("Wrong return code in hive history");
+          }
         }
       }
 
diff --git a/serde/src/java/org/apache/hadoop/hive/utils/ByteStream.java b/serde/src/java/org/apache/hadoop/hive/utils/ByteStream.java
deleted file mode 100644
index 4bccba4ec9..0000000000
--- a/serde/src/java/org/apache/hadoop/hive/utils/ByteStream.java
+++ /dev/null
@@ -1,53 +0,0 @@
-/**
- * Licensed to the Apache Software Foundation (ASF) under one
- * or more contributor license agreements.  See the NOTICE file
- * distributed with this work for additional information
- * regarding copyright ownership.  The ASF licenses this file
- * to you under the Apache License, Version 2.0 (the
- * "License"); you may not use this file except in compliance
- * with the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.apache.hadoop.hive.utils;
-
-import java.io.*;
-
-/**
- * Extensions to bytearrayinput/output streams
- *
- */
-public class ByteStream {
-  public static class Input extends ByteArrayInputStream {
-    public byte[] getData() { return buf; }
-    public int getCount() { return count;}
-    public void reset(byte [] argBuf, int argCount) {
-      buf = argBuf; mark = pos = 0; count = argCount;
-    }
-    public Input() {
-      super(new byte [1]);
-    }
-
-    public Input(byte[] buf) {
-      super(buf);
-    }
-    public Input(byte[] buf, int offset, int length) {
-      super(buf, offset, length);
-    }
-  }
-    
-  public static class Output extends ByteArrayOutputStream {
-    public byte[] getData() { return buf; }
-    public int getCount() { return count;}
-
-    public Output() { super(); }
-    public Output(int size) { super(size); }
-  }
-}
