diff --git a/ql/src/java/org/apache/hadoop/hive/ql/history/HiveHistory.java b/ql/src/java/org/apache/hadoop/hive/ql/history/HiveHistory.java
index 05b8a0f86f..55f49ba9ad 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/history/HiveHistory.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/history/HiveHistory.java
@@ -234,7 +234,7 @@ public HiveHistory(SessionState ss) {
       // Create directory
       File f = new File(conf_file_loc);
       if (!f.exists()) {
-        if (!f.mkdir()) {
+        if (!f.mkdirs()) {
           console.printError("Unable to create log directory " + conf_file_loc);
           return;
         }
diff --git a/ql/src/test/org/apache/hadoop/hive/ql/history/TestHiveHistory.java b/ql/src/test/org/apache/hadoop/hive/ql/history/TestHiveHistory.java
index 0c5c1949d7..77736e5261 100644
--- a/ql/src/test/org/apache/hadoop/hive/ql/history/TestHiveHistory.java
+++ b/ql/src/test/org/apache/hadoop/hive/ql/history/TestHiveHistory.java
@@ -187,4 +187,29 @@ public void testSimpleQuery() {
     }
   }
 
+  public void testQueryloglocParentDirNotExist() throws Exception {
+    String parentTmpDir = tmpdir + "/HIVE2654";
+    Path parentDirPath = new Path(parentTmpDir);
+    try {
+      fs.delete(parentDirPath, true);
+    } catch (Exception e) {
+    }
+    try {
+      String actualDir = parentTmpDir + "/test";
+      HiveConf conf = new HiveConf(SessionState.class);
+      conf.set(HiveConf.ConfVars.HIVEHISTORYFILELOC.toString(), actualDir);
+      SessionState ss = new CliSessionState(conf);
+      HiveHistory hiveHistory = new HiveHistory(ss);
+      Path actualPath = new Path(actualDir);
+      if (!fs.exists(actualPath)) {
+        fail("Query location path is not exist :" + actualPath.toString());
+      }
+    } finally {
+      try {
+        fs.delete(parentDirPath, true);
+      } catch (Exception e) {
+      }
+    }
+  }
+
 }
