diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/SecureCmdDoAs.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/SecureCmdDoAs.java
index a9a9874202..8124639ed2 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/exec/SecureCmdDoAs.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/SecureCmdDoAs.java
@@ -24,7 +24,6 @@
 import org.apache.hadoop.hive.conf.HiveConf;
 import org.apache.hadoop.hive.ql.metadata.HiveException;
 import org.apache.hadoop.hive.shims.ShimLoader;
-import org.apache.hadoop.security.UserGroupInformation;
 
 /**
  * SecureCmdDoAs - Helper class for setting parameters and env necessary for
@@ -48,7 +47,7 @@ public String addArg(String cmdline) throws HiveException {
   }
 
   public void addEnv(Map<String, String> env){
-    env.put(UserGroupInformation.HADOOP_TOKEN_FILE_LOCATION,
+    env.put(ShimLoader.getHadoopShims().getTokenFileLocEnvName(),
         tokenPath.toUri().getPath());
   }
 
diff --git a/shims/ivy.xml b/shims/ivy.xml
index 04ef64162f..c0312bc270 100644
--- a/shims/ivy.xml
+++ b/shims/ivy.xml
@@ -121,6 +121,12 @@
     </dependency>
 
     <!-- Hadoop 0.20 shim dependencies. Used for building 0.20 shims. -->
+    <dependency org="commons-io" name="commons-io" rev="${commons-io.version}">
+      <include type="jar"/>
+      <exclude org="commons-daemon" module="commons-daemon"/><!--bad POM-->
+      <exclude org="org.apache.commons" module="commons-daemon"/><!--bad POM-->
+    </dependency>
+
     <dependency org="org.apache.hadoop" name="hadoop-core"
                 rev="${hadoop-0.20.version}"
                 conf="hadoop0.20.shim->default">
