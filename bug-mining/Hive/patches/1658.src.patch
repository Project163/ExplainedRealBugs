diff --git a/hbase-handler/src/test/org/apache/hadoop/hive/hbase/HBaseQTestUtil.java b/hbase-handler/src/test/org/apache/hadoop/hive/hbase/HBaseQTestUtil.java
index a71a0b9244..96a0de2829 100644
--- a/hbase-handler/src/test/org/apache/hadoop/hive/hbase/HBaseQTestUtil.java
+++ b/hbase-handler/src/test/org/apache/hadoop/hive/hbase/HBaseQTestUtil.java
@@ -18,13 +18,14 @@
 package org.apache.hadoop.hive.hbase;
 
 import org.apache.hadoop.hive.ql.QTestUtil;
+import org.apache.hadoop.hive.ql.QTestUtil.MiniClusterType;
 
 /**
  * HBaseQTestUtil initializes HBase-specific test fixtures.
  */
 public class HBaseQTestUtil extends QTestUtil {
   public HBaseQTestUtil(
-    String outDir, String logDir, String miniMr, HBaseTestSetup setup)
+    String outDir, String logDir, MiniClusterType miniMr, HBaseTestSetup setup)
     throws Exception {
 
     super(outDir, logDir, miniMr, null);
diff --git a/hbase-handler/src/test/templates/TestHBaseCliDriver.vm b/hbase-handler/src/test/templates/TestHBaseCliDriver.vm
index 8344fa4350..dee189dd8a 100644
--- a/hbase-handler/src/test/templates/TestHBaseCliDriver.vm
+++ b/hbase-handler/src/test/templates/TestHBaseCliDriver.vm
@@ -24,6 +24,7 @@ import junit.framework.TestSuite;
 import java.io.*;
 import java.util.*;
 
+import org.apache.hadoop.hive.ql.QTestUtil.MiniClusterType;
 import org.apache.hadoop.hive.hbase.HBaseQTestUtil;
 import org.apache.hadoop.hive.hbase.HBaseTestSetup;
 import org.apache.hadoop.hive.ql.session.SessionState;
@@ -42,10 +43,11 @@ public class $className extends TestCase {
 
   @Override
   protected void setUp() {
+
+    MiniClusterType miniMR = MiniClusterType.valueForString("$clusterMode");
+
     try {
-      String miniMR = "$clusterMode";
       qt = new HBaseQTestUtil((HIVE_ROOT + "$resultsDir"), (HIVE_ROOT + "$logDir"), miniMR, setup);
-
     } catch (Exception e) {
       System.err.println("Exception: " + e.getMessage());
       e.printStackTrace();
diff --git a/hbase-handler/src/test/templates/TestHBaseNegativeCliDriver.vm b/hbase-handler/src/test/templates/TestHBaseNegativeCliDriver.vm
index e642aaaeb3..00e7174755 100644
--- a/hbase-handler/src/test/templates/TestHBaseNegativeCliDriver.vm
+++ b/hbase-handler/src/test/templates/TestHBaseNegativeCliDriver.vm
@@ -25,6 +25,7 @@ import junit.framework.TestSuite;
 import java.io.*;
 import java.util.*;
 
+import org.apache.hadoop.hive.ql.QTestUtil.MiniClusterType;
 import org.apache.hadoop.hive.hbase.HBaseQTestUtil;
 import org.apache.hadoop.hive.hbase.HBaseTestSetup;
 
@@ -42,11 +43,11 @@ public class $className extends TestCase {
 
   @Override
   protected void setUp() {
-    try {
-      String miniMR = "$clusterMode";
 
-      qt = new HBaseQTestUtil((HIVE_ROOT + "$resultsDir"), (HIVE_ROOT + "$logDir"), miniMR, setup);
+    MiniClusterType miniMR = MiniClusterType.valueForString("$clusterMode");
 
+    try {
+      qt = new HBaseQTestUtil((HIVE_ROOT + "$resultsDir"), (HIVE_ROOT + "$logDir"), miniMR, setup);
     } catch (Exception e) {
       System.err.println("Exception: " + e.getMessage());
       e.printStackTrace();
diff --git a/ql/src/test/org/apache/hadoop/hive/ql/QTestUtil.java b/ql/src/test/org/apache/hadoop/hive/ql/QTestUtil.java
index 9d2d06cd56..bdd0f191df 100644
--- a/ql/src/test/org/apache/hadoop/hive/ql/QTestUtil.java
+++ b/ql/src/test/org/apache/hadoop/hive/ql/QTestUtil.java
@@ -127,7 +127,6 @@ public class QTestUtil {
   private boolean miniMr = false;
   private String hadoopVer = null;
   private QTestSetup setup = null;
-  private boolean miniTez = false;
 
   public boolean deleteDirectory(File path) {
     if (path.exists()) {
@@ -196,7 +195,7 @@ public void normalizeNames(File path) throws Exception {
   }
 
   public QTestUtil(String outDir, String logDir) throws Exception {
-    this(outDir, logDir, "", "0.20");
+    this(outDir, logDir, MiniClusterType.none, "0.20");
   }
 
   public String getOutputDirectory() {
@@ -289,26 +288,35 @@ private String getHdfsUriString(String uriStr) {
   }
 
   public enum MiniClusterType {
-    miniMr,
-    tez
+    mr,
+    tez,
+    none;
+
+    public static MiniClusterType valueForString(String type) {
+      if (type.equals("miniMR")) {
+        return mr;
+      } else if (type.equals("tez")) {
+        return tez;
+      } else {
+        return none;
+      }
+    }
   }
 
-  public QTestUtil(String outDir, String logDir, String miniMr, String hadoopVer)
+  public QTestUtil(String outDir, String logDir, MiniClusterType clusterType, String hadoopVer)
     throws Exception {
     this.outDir = outDir;
     this.logDir = logDir;
     conf = new HiveConf(Driver.class);
-    this.miniMr = miniMr.equals("miniMr");
-    this.miniTez = miniMr.equals("tez");
+    this.miniMr = (clusterType == MiniClusterType.mr);
     this.hadoopVer = getHadoopMainVersion(hadoopVer);
     qMap = new TreeMap<String, String>();
     qSkipSet = new HashSet<String>();
     qSortSet = new HashSet<String>();
 
     HadoopShims shims = null;
-    MiniClusterType clusterType = MiniClusterType.valueOf(miniMr);
     switch (clusterType) {
-      case miniMr:
+      case mr:
         shims = ShimLoader.getHadoopShims();
         break;
 
@@ -321,14 +329,20 @@ public QTestUtil(String outDir, String logDir, String miniMr, String hadoopVer)
         shims = (HadoopShims) new TezShims();
         break;
 
+      case none:
+        break;
+
       default:
-        throw new Exception("Unknown cluster type");
+        throw new Exception("Unrecognized cluster type");
     }
 
-    dfs = shims.getMiniDfs(conf, 4, true, null);
-    FileSystem fs = dfs.getFileSystem();
-    mr = shims.getMiniMrCluster(conf, 4, getHdfsUriString(fs.getUri().toString()), 1);
+    if (shims != null) {
+      dfs = shims.getMiniDfs(conf, 4, true, null);
+      FileSystem fs = dfs.getFileSystem();
+      mr = shims.getMiniMrCluster(conf, 4, getHdfsUriString(fs.getUri().toString()), 1);
     
+    }
+
     initConf();
 
     // Use the current directory if it is not specified
@@ -1454,7 +1468,7 @@ public static QTestUtil[] queryListRunnerSetup(File[] qfiles, String resDir,
   {
     QTestUtil[] qt = new QTestUtil[qfiles.length];
     for (int i = 0; i < qfiles.length; i++) {
-      qt[i] = new QTestUtil(resDir, logDir, "", "0.20");
+      qt[i] = new QTestUtil(resDir, logDir, MiniClusterType.none, "0.20");
       qt[i].addFile(qfiles[i]);
       qt[i].clearTestSideEffects();
     }
diff --git a/ql/src/test/org/apache/hadoop/hive/ql/TestLocationQueries.java b/ql/src/test/org/apache/hadoop/hive/ql/TestLocationQueries.java
index f53ab6e8dd..9edd7f30ff 100644
--- a/ql/src/test/org/apache/hadoop/hive/ql/TestLocationQueries.java
+++ b/ql/src/test/org/apache/hadoop/hive/ql/TestLocationQueries.java
@@ -24,6 +24,8 @@
 import java.util.regex.Matcher;
 import java.util.regex.Pattern;
 
+import org.apache.hadoop.hive.ql.QTestUtil.MiniClusterType;
+
 /**
  * Suite for testing location. e.g. if "alter table alter partition
  * location" is run, do the partitions end up in the correct location.
@@ -82,7 +84,7 @@ public int checkCliDriverResults(String tname) throws Exception {
       return failedCount;
     }
 
-    public CheckResults(String outDir, String logDir, String miniMr,
+    public CheckResults(String outDir, String logDir, MiniClusterType miniMr,
         String hadoopVer, String locationSubdir)
       throws Exception
     {
@@ -102,8 +104,9 @@ public void testAlterTablePartitionLocation_alter5() throws Exception {
     File[] qfiles = setupQFiles(testNames);
 
     QTestUtil[] qt = new QTestUtil[qfiles.length];
+
     for (int i = 0; i < qfiles.length; i++) {
-      qt[i] = new CheckResults(resDir, logDir, "non-minimr", "0.20", "parta");
+      qt[i] = new CheckResults(resDir, logDir, MiniClusterType.none, "0.20", "parta");
       qt[i].addFile(qfiles[i]);
       qt[i].clearTestSideEffects();
     }
diff --git a/ql/src/test/templates/TestCliDriver.vm b/ql/src/test/templates/TestCliDriver.vm
index 3e5238844e..d6f16202f8 100644
--- a/ql/src/test/templates/TestCliDriver.vm
+++ b/ql/src/test/templates/TestCliDriver.vm
@@ -25,6 +25,7 @@ import java.io.*;
 import java.util.*;
 
 import org.apache.hadoop.hive.ql.QTestUtil;
+import org.apache.hadoop.hive.ql.QTestUtil.MiniClusterType;
 import org.apache.hadoop.hive.ql.session.SessionState;
 
 public class $className extends TestCase {
@@ -33,9 +34,10 @@ public class $className extends TestCase {
   private static QTestUtil qt;
 
   static {
+
+    MiniClusterType miniMR = MiniClusterType.valueForString("$clusterMode");
     try {
       String hadoopVer = "$hadoopVersion";
-      String miniMR = "$clusterMode";
       qt = new QTestUtil((HIVE_ROOT + "$resultsDir"), (HIVE_ROOT + "$logDir"), miniMR, hadoopVer);
 
       // do a one time initialization
diff --git a/ql/src/test/templates/TestNegativeCliDriver.vm b/ql/src/test/templates/TestNegativeCliDriver.vm
index a329693aaa..ec782b6865 100644
--- a/ql/src/test/templates/TestNegativeCliDriver.vm
+++ b/ql/src/test/templates/TestNegativeCliDriver.vm
@@ -25,6 +25,7 @@ import java.io.*;
 import java.util.*;
 
 import org.apache.hadoop.hive.ql.QTestUtil;
+import org.apache.hadoop.hive.ql.QTestUtil.MiniClusterType;
 import org.apache.hadoop.hive.ql.exec.Task;
 
 public class $className extends TestCase {
@@ -33,8 +34,9 @@ public class $className extends TestCase {
   private static QTestUtil qt;
 
   static {
+    MiniClusterType miniMR = MiniClusterType.valueForString("$clusterMode");
+
     try {
-      String miniMR = "$clusterMode";
       String hadoopVer = "$hadoopVersion";
       qt = new QTestUtil((HIVE_ROOT + "$resultsDir"), (HIVE_ROOT + "$logDir"), miniMR, hadoopVer);
       // do a one time initialization
diff --git a/ql/src/test/templates/TestParse.vm b/ql/src/test/templates/TestParse.vm
index 52dbe608c7..1e6e0e5c67 100644
--- a/ql/src/test/templates/TestParse.vm
+++ b/ql/src/test/templates/TestParse.vm
@@ -25,16 +25,18 @@ import java.io.*;
 import java.util.*;
 
 import org.apache.hadoop.hive.ql.QTestUtil;
+import org.apache.hadoop.hive.ql.QTestUtil.MiniClusterType;
 import org.apache.hadoop.hive.ql.exec.Task;
 
 public class $className extends TestCase {
 
   private static final String HIVE_ROOT = QTestUtil.ensurePathEndsInSlash(System.getProperty("hive.root"));
   private static QTestUtil qt;
-
+  
   static {
+    MiniClusterType miniMR = MiniClusterType.valueForString("$clusterMode");
+
     try {
-      String miniMR = "$clusterMode";
       String hadoopVer = "$hadoopVersion";
       qt = new QTestUtil((HIVE_ROOT + "$resultsDir"), (HIVE_ROOT + "$logDir"), miniMR, hadoopVer);
       qt.init(null);
diff --git a/ql/src/test/templates/TestParseNegative.vm b/ql/src/test/templates/TestParseNegative.vm
index fa3bea9679..12e8282efe 100755
--- a/ql/src/test/templates/TestParseNegative.vm
+++ b/ql/src/test/templates/TestParseNegative.vm
@@ -25,6 +25,7 @@ import java.io.*;
 import java.util.*;
 
 import org.apache.hadoop.hive.ql.QTestUtil;
+import org.apache.hadoop.hive.ql.QTestUtil.MiniClusterType;
 import org.apache.hadoop.hive.ql.exec.Task;
 
 public class $className extends TestCase {
@@ -33,8 +34,10 @@ public class $className extends TestCase {
   private static QTestUtil qt;
  
   static {
+
+    MiniClusterType miniMR = MiniClusterType.valueForString("$clusterMode");
+
     try {
-      String miniMR = "$clusterMode";
       String hadoopVer = "$hadoopVersion";
       qt = new QTestUtil((HIVE_ROOT + "$resultsDir"), (HIVE_ROOT + "$logDir"), miniMR, hadoopVer);
     } catch (Exception e) {
