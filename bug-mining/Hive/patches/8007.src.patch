diff --git a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveProjectJoinTransposeRule.java b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveProjectJoinTransposeRule.java
index 3fd76f5048..0cd50b03b5 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveProjectJoinTransposeRule.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveProjectJoinTransposeRule.java
@@ -28,6 +28,7 @@
 import org.apache.calcite.rel.rules.PushProjector;
 import org.apache.calcite.rel.type.RelDataTypeField;
 import org.apache.calcite.rex.RexNode;
+import org.apache.calcite.rex.RexOver;
 import org.apache.calcite.tools.RelBuilderFactory;
 import org.apache.hadoop.hive.ql.optimizer.calcite.HiveRelFactories;
 
@@ -55,7 +56,7 @@ private HiveProjectJoinTransposeRule(RelBuilderFactory relBuilderFactory) {
                 operand(RelNode.class, any()),
                 operand(RelNode.class, any()))),
         relBuilderFactory, "HiveProjectJoinTransposeRule");
-    this.preserveExprCondition = expr -> true;
+    this.preserveExprCondition = expr -> !(expr instanceof RexOver);
   }
 
   @Override
diff --git a/ql/src/test/queries/clientpositive/cbo_proj_join_transpose.q b/ql/src/test/queries/clientpositive/cbo_proj_join_transpose.q
new file mode 100644
index 0000000000..2e96067d4a
--- /dev/null
+++ b/ql/src/test/queries/clientpositive/cbo_proj_join_transpose.q
@@ -0,0 +1,21 @@
+create table table1 (acct_num string, interest_rate decimal(10,7)) stored as orc;
+create table table2 (act_id string) stored as orc;
+
+explain cbo
+CREATE TABLE temp_output AS
+SELECT act_nbr, row_num
+FROM (SELECT t2.act_id as act_nbr,
+row_number() over (PARTITION BY trim(acct_num) ORDER BY interest_rate DESC) AS row_num
+FROM table1 t1
+INNER JOIN table2 t2
+ON trim(acct_num) = t2.act_id) t
+WHERE t.row_num = 1;
+
+CREATE TABLE temp_output AS
+SELECT act_nbr, row_num
+FROM (SELECT t2.act_id as act_nbr,
+row_number() over (PARTITION BY trim(acct_num) ORDER BY interest_rate DESC) AS row_num
+FROM table1 t1
+INNER JOIN table2 t2
+ON trim(acct_num) = t2.act_id) t
+WHERE t.row_num = 1;
diff --git a/ql/src/test/results/clientpositive/llap/cbo_proj_join_transpose.q.out b/ql/src/test/results/clientpositive/llap/cbo_proj_join_transpose.q.out
new file mode 100644
index 0000000000..dfa178f337
--- /dev/null
+++ b/ql/src/test/results/clientpositive/llap/cbo_proj_join_transpose.q.out
@@ -0,0 +1,84 @@
+PREHOOK: query: create table table1 (acct_num string, interest_rate decimal(10,7)) stored as orc
+PREHOOK: type: CREATETABLE
+PREHOOK: Output: database:default
+PREHOOK: Output: default@table1
+POSTHOOK: query: create table table1 (acct_num string, interest_rate decimal(10,7)) stored as orc
+POSTHOOK: type: CREATETABLE
+POSTHOOK: Output: database:default
+POSTHOOK: Output: default@table1
+PREHOOK: query: create table table2 (act_id string) stored as orc
+PREHOOK: type: CREATETABLE
+PREHOOK: Output: database:default
+PREHOOK: Output: default@table2
+POSTHOOK: query: create table table2 (act_id string) stored as orc
+POSTHOOK: type: CREATETABLE
+POSTHOOK: Output: database:default
+POSTHOOK: Output: default@table2
+PREHOOK: query: explain cbo
+CREATE TABLE temp_output AS
+SELECT act_nbr, row_num
+FROM (SELECT t2.act_id as act_nbr,
+row_number() over (PARTITION BY trim(acct_num) ORDER BY interest_rate DESC) AS row_num
+FROM table1 t1
+INNER JOIN table2 t2
+ON trim(acct_num) = t2.act_id) t
+WHERE t.row_num = 1
+PREHOOK: type: CREATETABLE_AS_SELECT
+PREHOOK: Input: default@table1
+PREHOOK: Input: default@table2
+PREHOOK: Output: database:default
+PREHOOK: Output: default@temp_output
+POSTHOOK: query: explain cbo
+CREATE TABLE temp_output AS
+SELECT act_nbr, row_num
+FROM (SELECT t2.act_id as act_nbr,
+row_number() over (PARTITION BY trim(acct_num) ORDER BY interest_rate DESC) AS row_num
+FROM table1 t1
+INNER JOIN table2 t2
+ON trim(acct_num) = t2.act_id) t
+WHERE t.row_num = 1
+POSTHOOK: type: CREATETABLE_AS_SELECT
+POSTHOOK: Input: default@table1
+POSTHOOK: Input: default@table2
+POSTHOOK: Output: database:default
+POSTHOOK: Output: default@temp_output
+CBO PLAN:
+HiveProject(act_nbr=[$0], row_num=[CAST(1):INTEGER])
+  HiveFilter(condition=[=($1, 1)])
+    HiveProject(act_id=[$2], row_number_window_0=[row_number() OVER (PARTITION BY $1 ORDER BY $0 DESC NULLS FIRST ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING)])
+      HiveJoin(condition=[=($1, $2)], joinType=[inner], algorithm=[none], cost=[not available])
+        HiveProject(interest_rate=[$1], trim=[trim($0)])
+          HiveFilter(condition=[IS NOT NULL(trim($0))])
+            HiveTableScan(table=[[default, table1]], table:alias=[t1])
+        HiveProject(act_id=[$0])
+          HiveFilter(condition=[IS NOT NULL($0)])
+            HiveTableScan(table=[[default, table2]], table:alias=[t2])
+
+PREHOOK: query: CREATE TABLE temp_output AS
+SELECT act_nbr, row_num
+FROM (SELECT t2.act_id as act_nbr,
+row_number() over (PARTITION BY trim(acct_num) ORDER BY interest_rate DESC) AS row_num
+FROM table1 t1
+INNER JOIN table2 t2
+ON trim(acct_num) = t2.act_id) t
+WHERE t.row_num = 1
+PREHOOK: type: CREATETABLE_AS_SELECT
+PREHOOK: Input: default@table1
+PREHOOK: Input: default@table2
+PREHOOK: Output: database:default
+PREHOOK: Output: default@temp_output
+POSTHOOK: query: CREATE TABLE temp_output AS
+SELECT act_nbr, row_num
+FROM (SELECT t2.act_id as act_nbr,
+row_number() over (PARTITION BY trim(acct_num) ORDER BY interest_rate DESC) AS row_num
+FROM table1 t1
+INNER JOIN table2 t2
+ON trim(acct_num) = t2.act_id) t
+WHERE t.row_num = 1
+POSTHOOK: type: CREATETABLE_AS_SELECT
+POSTHOOK: Input: default@table1
+POSTHOOK: Input: default@table2
+POSTHOOK: Output: database:default
+POSTHOOK: Output: default@temp_output
+POSTHOOK: Lineage: temp_output.act_nbr SIMPLE [(table2)t2.FieldSchema(name:act_id, type:string, comment:null), ]
+POSTHOOK: Lineage: temp_output.row_num SIMPLE []
