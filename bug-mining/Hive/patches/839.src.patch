diff --git a/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java b/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java
index 13555039b1..386c7a9b4e 100644
--- a/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java
+++ b/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java
@@ -355,6 +355,7 @@ public static enum ConfVars {
     HIVEPARTITIONNAME("hive.partition.name", ""),
     HIVESCRIPTAUTOPROGRESS("hive.script.auto.progress", false),
     HIVESCRIPTIDENVVAR("hive.script.operator.id.env.var", "HIVE_SCRIPT_OPERATOR_ID"),
+    HIVESCRIPTTRUNCATEENV("hive.script.operator.truncate.env", false),
     HIVEMAPREDMODE("hive.mapred.mode", "nonstrict"),
     HIVEALIAS("hive.alias", ""),
     HIVEMAPSIDEAGGREGATE("hive.map.aggr", true),
diff --git a/conf/hive-default.xml.template b/conf/hive-default.xml.template
index dd304c5ae8..db464aec69 100644
--- a/conf/hive-default.xml.template
+++ b/conf/hive-default.xml.template
@@ -494,6 +494,12 @@
   </description>
 </property>
 
+<property>
+  <name>hive.script.operator.truncate.env</name>
+  <value>false</value>
+  <description>Truncate each environment variable for external script in scripts operator to 20KB (to fit system limits)</description>
+</property>
+
 <property>
   <name>hive.exec.compress.output</name>
   <value>false</value>
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/ScriptOperator.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/ScriptOperator.java
index 8f56082c17..7f041592e5 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/exec/ScriptOperator.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/ScriptOperator.java
@@ -91,14 +91,13 @@ public static enum Counter {
   // of the user assumptions.
   transient boolean firstRow;
 
-  /**
-   * addJobConfToEnvironment is shamelessly copied from hadoop streaming.
-   */
-  static String safeEnvVarName(String var) {
+
+  String safeEnvVarName(String name) {
     StringBuilder safe = new StringBuilder();
-    int len = var.length();
+    int len = name.length();
+
     for (int i = 0; i < len; i++) {
-      char c = var.charAt(i);
+      char c = name.charAt(i);
       char s;
       if ((c >= '0' && c <= '9') || (c >= 'A' && c <= 'Z')
           || (c >= 'a' && c <= 'z')) {
@@ -111,8 +110,32 @@ static String safeEnvVarName(String var) {
     return safe.toString();
   }
 
-  static void addJobConfToEnvironment(Configuration conf,
-      Map<String, String> env) {
+  /**
+   * Most UNIX implementations impose some limit on the total size of environment variables and
+   * size of strings. To fit in this limit we need sometimes to truncate strings.
+   * @param value environment variable value to check
+   * @param name name of variable (used only for logging purposes)
+   * @param truncate truncate value or not
+   * @return original value, or truncated one if it's length is more then 20KB and
+   * truncate flag is set
+   * @see <a href="http://www.kernel.org/doc/man-pages/online/pages/man2/execve.2.html">Linux
+   * Man page</a> for more details
+   */
+  String safeEnvVarValue(String value, String name, boolean truncate) {
+    final int lenLimit = 20*1024;
+    if (truncate && value.length() > lenLimit) {
+      value = value.substring(0, lenLimit);
+      LOG.warn("Length of environment variable " + name + " was truncated to " + lenLimit
+          + " bytes to fit system limits.");
+    }
+    return value;
+  }
+
+  /**
+   * addJobConfToEnvironment is mostly shamelessly copied from hadoop streaming. Added additional
+   * check on environment variable length
+   */
+  void addJobConfToEnvironment(Configuration conf, Map<String, String> env) {
     Iterator<Map.Entry<String, String>> it = conf.iterator();
     while (it.hasNext()) {
       Map.Entry<String, String> en = it.next();
@@ -121,6 +144,8 @@ static void addJobConfToEnvironment(Configuration conf,
       // expansion
       String value = conf.get(name); // does variable expansion
       name = safeEnvVarName(name);
+      boolean truncate = conf.getBoolean(HiveConf.ConfVars.HIVESCRIPTTRUNCATEENV.toString(), false);
+      value = safeEnvVarValue(value, name, truncate);
       env.put(name, value);
     }
   }
diff --git a/ql/src/test/org/apache/hadoop/hive/ql/exec/TestOperators.java b/ql/src/test/org/apache/hadoop/hive/ql/exec/TestOperators.java
index 0ee9aeb5a4..1e0b460c14 100644
--- a/ql/src/test/org/apache/hadoop/hive/ql/exec/TestOperators.java
+++ b/ql/src/test/org/apache/hadoop/hive/ql/exec/TestOperators.java
@@ -19,9 +19,7 @@
 package org.apache.hadoop.hive.ql.exec;
 
 import java.io.Serializable;
-import java.util.ArrayList;
-import java.util.LinkedHashMap;
-import java.util.Map;
+import java.util.*;
 
 import junit.framework.TestCase;
 
@@ -185,6 +183,51 @@ public void testFileSinkOperator() throws Throwable {
     }
   }
 
+  /**
+   *  When ScriptOperator runs external script, it passes job configuration as environment
+   *  variables. But environment variables have some system limitations and we have to check
+   *  job configuration properties firstly. This test checks that staff.
+   */
+  public void testScriptOperatorEnvVarsProcessing() throws Throwable {
+    try {
+      ScriptOperator scriptOperator = new ScriptOperator();
+
+      //Environment Variables name
+      assertEquals("a_b_c", scriptOperator.safeEnvVarName("a.b.c"));
+      assertEquals("a_b_c", scriptOperator.safeEnvVarName("a-b-c"));
+
+      //Environment Variables short values
+      assertEquals("value", scriptOperator.safeEnvVarValue("value", "name", false));
+      assertEquals("value", scriptOperator.safeEnvVarValue("value", "name", true));
+
+      //Environment Variables long values
+      char [] array = new char[20*1024+1];
+      Arrays.fill(array, 'a');
+      String hugeEnvVar = new String(array);
+      assertEquals(20*1024+1, hugeEnvVar.length());
+      assertEquals(20*1024+1, scriptOperator.safeEnvVarValue(hugeEnvVar, "name", false).length());
+      assertEquals(20*1024, scriptOperator.safeEnvVarValue(hugeEnvVar, "name", true).length());
+
+      //Full test
+      Configuration hconf = new JobConf(ScriptOperator.class);
+      hconf.set("name", hugeEnvVar);
+      Map<String, String> env = new HashMap<String, String>();
+
+      HiveConf.setBoolVar(hconf, HiveConf.ConfVars.HIVESCRIPTTRUNCATEENV, false);
+      scriptOperator.addJobConfToEnvironment(hconf, env);
+      assertEquals(20*1024+1, env.get("name").length());
+
+      HiveConf.setBoolVar(hconf, HiveConf.ConfVars.HIVESCRIPTTRUNCATEENV, true);
+      scriptOperator.addJobConfToEnvironment(hconf, env);
+      assertEquals(20*1024, env.get("name").length());
+
+      System.out.println("Script Operator Environment Variables processing ok");
+    } catch (Throwable e) {
+      e.printStackTrace();
+      throw e;
+    }
+  }
+
   public void testScriptOperator() throws Throwable {
     try {
       System.out.println("Testing Script Operator");
