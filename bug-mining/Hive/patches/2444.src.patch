diff --git a/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java b/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java
index dcfdcc153d..7f4afd9d64 100644
--- a/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java
+++ b/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java
@@ -36,12 +36,14 @@
 
 import javax.security.auth.login.LoginException;
 
-import static org.apache.hadoop.hive.conf.Validator.*;
 import org.apache.commons.lang.StringUtils;
 import org.apache.commons.logging.Log;
 import org.apache.commons.logging.LogFactory;
 import org.apache.hadoop.conf.Configuration;
 import org.apache.hadoop.hive.common.classification.InterfaceAudience.LimitedPrivate;
+import org.apache.hadoop.hive.conf.Validator.PatternSet;
+import org.apache.hadoop.hive.conf.Validator.RangeValidator;
+import org.apache.hadoop.hive.conf.Validator.StringSet;
 import org.apache.hadoop.hive.shims.ShimLoader;
 import org.apache.hadoop.mapred.JobConf;
 import org.apache.hadoop.security.UserGroupInformation;
@@ -296,9 +298,9 @@ public static enum ConfVars {
 
     LOCALMODEAUTO("hive.exec.mode.local.auto", false,
         "Let Hive determine whether to run in local mode automatically"),
-    LOCALMODEMAXBYTES("hive.exec.mode.local.auto.inputbytes.max", 134217728L, 
+    LOCALMODEMAXBYTES("hive.exec.mode.local.auto.inputbytes.max", 134217728L,
         "When hive.exec.mode.local.auto is true, input bytes should less than this for local mode."),
-    LOCALMODEMAXINPUTFILES("hive.exec.mode.local.auto.input.files.max", 4, 
+    LOCALMODEMAXINPUTFILES("hive.exec.mode.local.auto.input.files.max", 4,
         "When hive.exec.mode.local.auto is true, the number of tasks should less than this for local mode."),
 
     DROPIGNORESNONEXISTENT("hive.exec.drop.ignorenonexistent", true,
@@ -369,7 +371,7 @@ public static enum ConfVars {
         "The number of times to retry a HMSHandler call if there were a connection error"),
     HMSHANDLERINTERVAL("hive.hmshandler.retry.interval", 1000,
         "The number of milliseconds between HMSHandler retry attempts"),
-    HMSHANDLERFORCERELOADCONF("hive.hmshandler.force.reload.conf", false, 
+    HMSHANDLERFORCERELOADCONF("hive.hmshandler.force.reload.conf", false,
         "Whether to force reloading of the HMSHandler configuration (including\n" +
         "the connection URL, before the next metastore query that accesses the\n" +
         "datastore. Once reloaded, this value is reset to false. Used for\n" +
@@ -382,7 +384,7 @@ public static enum ConfVars {
         "Whether to enable TCP keepalive for the metastore server. Keepalive will prevent accumulation of half-open connections."),
 
     METASTORE_INT_ORIGINAL("hive.metastore.archive.intermediate.original",
-        "_INTERMEDIATE_ORIGINAL", 
+        "_INTERMEDIATE_ORIGINAL",
         "Intermediate dir suffixes used for archiving. Not important what they\n" +
         "are, as long as collisions are avoided"),
     METASTORE_INT_ARCHIVED("hive.metastore.archive.intermediate.archived",
@@ -558,7 +560,7 @@ public static enum ConfVars {
     HIVE_SESSION_HISTORY_ENABLED("hive.session.history.enabled", false,
         "Whether to log Hive query, query plan, runtime statistics etc."),
 
-    HIVEQUERYSTRING("hive.query.string", "", 
+    HIVEQUERYSTRING("hive.query.string", "",
         "Query being executed (might be multiple per a session)"),
 
     HIVEQUERYID("hive.query.id", "",
@@ -797,7 +799,7 @@ public static enum ConfVars {
         " for small ORC files. Note that enabling this config will not honor padding tolerance\n" +
         " config (hive.exec.orc.block.padding.tolerance)."),
     HIVEMERGEINPUTFORMATSTRIPELEVEL("hive.merge.input.format.stripe.level",
-        "org.apache.hadoop.hive.ql.io.orc.OrcFileStripeMergeInputFormat", 
+        "org.apache.hadoop.hive.ql.io.orc.OrcFileStripeMergeInputFormat",
 	"Input file format to use for ORC stripe level merging (for internal use only)"),
     HIVEMERGECURRENTJOBHASDYNAMICPARTITIONS(
         "hive.merge.current.job.has.dynamic.partitions", false, ""),
@@ -813,7 +815,7 @@ public static enum ConfVars {
     HIVE_RCFILE_TOLERATE_CORRUPTIONS("hive.io.rcfile.tolerate.corruptions", false, ""),
     HIVE_RCFILE_RECORD_BUFFER_SIZE("hive.io.rcfile.record.buffer.size", 4194304, ""),   // 4M
 
-    HIVE_ORC_FILE_MEMORY_POOL("hive.exec.orc.memory.pool", 0.5f, 
+    HIVE_ORC_FILE_MEMORY_POOL("hive.exec.orc.memory.pool", 0.5f,
         "Maximum fraction of heap that can be used by ORC file writers"),
     HIVE_ORC_WRITE_FORMAT("hive.exec.orc.write.format", null,
         "Define the version of the file to write"),
@@ -1099,8 +1101,8 @@ public static enum ConfVars {
         "The Java class (implementing the StatsAggregator interface) that is used by default if hive.stats.dbclass is custom type."),
     HIVE_STATS_JDBC_TIMEOUT("hive.stats.jdbc.timeout", 30,
         "Timeout value (number of seconds) used by JDBC connection and statements."),
-    HIVE_STATS_ATOMIC("hive.stats.atomic", false, 
-        "whether to update metastore stats only if all stats are available"), 
+    HIVE_STATS_ATOMIC("hive.stats.atomic", false,
+        "whether to update metastore stats only if all stats are available"),
     HIVE_STATS_RETRIES_MAX("hive.stats.retries.max", 0,
         "Maximum number of retries when stats publisher/aggregator got an exception updating intermediate database. \n" +
         "Default is no tries on failures."),
@@ -1328,6 +1330,8 @@ public static enum ConfVars {
         "Enables type checking for registered Hive configurations"),
 
     SEMANTIC_ANALYZER_HOOK("hive.semantic.analyzer.hook", "", ""),
+    HIVE_TEST_AUTHORIZATION_SQLSTD_HS2_MODE(
+        "hive.test.authz.sstd.hs2.mode", false, "test hs2 mode from .q tests", true),
     HIVE_AUTHORIZATION_ENABLED("hive.security.authorization.enabled", false,
         "enable or disable the Hive client authorization"),
     HIVE_AUTHORIZATION_MANAGER("hive.security.authorization.manager",
@@ -1661,7 +1665,7 @@ public static enum ConfVars {
         "Exceeding this will trigger a flush irrelevant of memory pressure condition."),
     HIVE_VECTORIZATION_GROUPBY_FLUSH_PERCENT("hive.vectorized.groupby.flush.percent", (float) 0.1,
         "Percent of entries in the group by aggregation hash flushed when the memory threshold is exceeded."),
-    
+
 
     HIVE_TYPE_CHECK_ON_INSERT("hive.typecheck.on.insert", true, ""),
 
diff --git a/itests/hive-unit/src/test/java/org/apache/hadoop/hive/ql/security/authorization/plugin/TestHiveAuthorizerCheckInvocation.java b/itests/hive-unit/src/test/java/org/apache/hadoop/hive/ql/security/authorization/plugin/TestHiveAuthorizerCheckInvocation.java
index 789ef767f6..0967cee102 100644
--- a/itests/hive-unit/src/test/java/org/apache/hadoop/hive/ql/security/authorization/plugin/TestHiveAuthorizerCheckInvocation.java
+++ b/itests/hive-unit/src/test/java/org/apache/hadoop/hive/ql/security/authorization/plugin/TestHiveAuthorizerCheckInvocation.java
@@ -62,7 +62,7 @@ public class TestHiveAuthorizerCheckInvocation {
   static class MockedHiveAuthorizerFactory implements HiveAuthorizerFactory {
     @Override
     public HiveAuthorizer createHiveAuthorizer(HiveMetastoreClientFactory metastoreClientFactory,
-        HiveConf conf, HiveAuthenticationProvider authenticator) {
+        HiveConf conf, HiveAuthenticationProvider authenticator, HiveAuthzSessionContext ctx) {
       TestHiveAuthorizerCheckInvocation.mockedAuthorizer = Mockito.mock(HiveAuthorizer.class);
       return TestHiveAuthorizerCheckInvocation.mockedAuthorizer;
     }
diff --git a/itests/hive-unit/src/test/java/org/apache/hive/jdbc/authorization/TestCLIAuthzSessionContext.java b/itests/hive-unit/src/test/java/org/apache/hive/jdbc/authorization/TestCLIAuthzSessionContext.java
new file mode 100644
index 0000000000..9a44dfab1d
--- /dev/null
+++ b/itests/hive-unit/src/test/java/org/apache/hive/jdbc/authorization/TestCLIAuthzSessionContext.java
@@ -0,0 +1,88 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.hive.jdbc.authorization;
+
+import static org.junit.Assert.assertEquals;
+import static org.junit.Assert.assertTrue;
+
+import org.apache.hadoop.hive.cli.CliDriver;
+import org.apache.hadoop.hive.cli.CliSessionState;
+import org.apache.hadoop.hive.conf.HiveConf;
+import org.apache.hadoop.hive.conf.HiveConf.ConfVars;
+import org.apache.hadoop.hive.ql.security.HiveAuthenticationProvider;
+import org.apache.hadoop.hive.ql.security.SessionStateUserAuthenticator;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthorizer;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthorizerFactory;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzSessionContext;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveMetastoreClientFactory;
+import org.apache.hadoop.hive.ql.session.SessionState;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
+import org.junit.Test;
+import org.mockito.Mockito;
+/**
+ * Test context information that gets passed to authorization factory
+ */
+public class TestCLIAuthzSessionContext {
+  private static HiveAuthzSessionContext sessionCtx;
+  private static CliDriver driver;
+
+  /**
+   * This factory captures the HiveAuthzSessionContext argument and returns mocked
+   * HiveAuthorizer class
+   */
+  static class MockedHiveAuthorizerFactory implements HiveAuthorizerFactory {
+    @Override
+    public HiveAuthorizer createHiveAuthorizer(HiveMetastoreClientFactory metastoreClientFactory,
+        HiveConf conf, HiveAuthenticationProvider authenticator, HiveAuthzSessionContext ctx) {
+      TestCLIAuthzSessionContext.sessionCtx = ctx;
+      HiveAuthorizer mockedAuthorizer = Mockito.mock(HiveAuthorizer.class);
+      return mockedAuthorizer;
+    }
+  }
+
+  @BeforeClass
+  public static void beforeTest() throws Exception {
+    HiveConf conf = new HiveConf();
+    conf.setVar(ConfVars.HIVE_AUTHORIZATION_MANAGER, MockedHiveAuthorizerFactory.class.getName());
+    conf.setVar(ConfVars.HIVE_AUTHENTICATOR_MANAGER, SessionStateUserAuthenticator.class.getName());
+    conf.setBoolVar(ConfVars.HIVE_AUTHORIZATION_ENABLED, true);
+    conf.setBoolVar(ConfVars.HIVE_SUPPORT_CONCURRENCY, false);
+
+    // once SessionState for thread is set, CliDriver picks conf from it
+    CliSessionState ss = new CliSessionState(conf);
+    ss.err = System.err;
+    ss.out = System.out;
+    SessionState.start(ss);
+    TestCLIAuthzSessionContext.driver = new CliDriver();
+ }
+
+  @AfterClass
+  public static void afterTest() throws Exception {
+  }
+
+  @Test
+  public void testAuthzSessionContextContents() throws Exception {
+    driver.processCmd("show tables");
+    // session string is supposed to be unique, so its got to be of some reasonable size
+    assertTrue("session string size check", sessionCtx.getSessionString().length() > 10);
+    assertEquals("Client type ", HiveAuthzSessionContext.CLIENT_TYPE.HIVECLI, sessionCtx.getClientType());
+  }
+
+}
diff --git a/itests/hive-unit/src/test/java/org/apache/hive/jdbc/authorization/TestHS2AuthzContext.java b/itests/hive-unit/src/test/java/org/apache/hive/jdbc/authorization/TestHS2AuthzContext.java
index f42390c019..d03dba4f9b 100644
--- a/itests/hive-unit/src/test/java/org/apache/hive/jdbc/authorization/TestHS2AuthzContext.java
+++ b/itests/hive-unit/src/test/java/org/apache/hive/jdbc/authorization/TestHS2AuthzContext.java
@@ -33,9 +33,12 @@
 import org.apache.hadoop.hive.conf.HiveConf.ConfVars;
 import org.apache.hadoop.hive.ql.security.HiveAuthenticationProvider;
 import org.apache.hadoop.hive.ql.security.SessionStateUserAuthenticator;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAccessControlException;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthorizer;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthorizerFactory;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzContext;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzPluginException;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzSessionContext;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveMetastoreClientFactory;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveOperationType;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HivePrivilegeObject;
@@ -60,7 +63,7 @@ public class TestHS2AuthzContext {
   static class MockedHiveAuthorizerFactory implements HiveAuthorizerFactory {
     @Override
     public HiveAuthorizer createHiveAuthorizer(HiveMetastoreClientFactory metastoreClientFactory,
-        HiveConf conf, HiveAuthenticationProvider authenticator) {
+        HiveConf conf, HiveAuthenticationProvider authenticator, HiveAuthzSessionContext ctx) {
       TestHS2AuthzContext.mockedAuthorizer = Mockito.mock(HiveAuthorizer.class);
       return TestHS2AuthzContext.mockedAuthorizer;
     }
@@ -88,12 +91,21 @@ public static void afterTest() throws Exception {
   }
 
   @Test
-  public void testAuthzContextContents() throws Exception {
+  public void testAuthzContextContentsDriverCmd() throws Exception {
+    String cmd = "show tables";
+    verifyContextContents(cmd, cmd);
+  }
+
+  @Test
+  public void testAuthzContextContentsCmdProcessorCmd() throws Exception {
+    verifyContextContents("dfs -ls /", "-ls /");
+  }
 
+  private void verifyContextContents(final String cmd, String ctxCmd) throws SQLException,
+      HiveAuthzPluginException, HiveAccessControlException {
     Connection hs2Conn = getConnection("user1");
     Statement stmt = hs2Conn.createStatement();
 
-    final String cmd = "show tables";
     stmt.execute(cmd);
     stmt.close();
     hs2Conn.close();
@@ -107,13 +119,10 @@ public void testAuthzContextContents() throws Exception {
 
     HiveAuthzContext context = contextCapturer.getValue();
 
-    assertEquals("Command ", cmd, context.getCommandString());
+    assertEquals("Command ", ctxCmd, context.getCommandString());
     assertTrue("ip address pattern check", context.getIpAddress().contains("."));
     // ip address size check - check for something better than non zero
     assertTrue("ip address size check", context.getIpAddress().length() > 7);
-    // session string is supposed to be unique, so its got to be of some reasonable size
-    assertTrue("session string size check", context.getSessionString().length() > 10);
-    assertEquals("Client type ", HiveAuthzContext.CLIENT_TYPE.HIVESERVER2, context.getClientType());
   }
 
   private Connection getConnection(String userName) throws SQLException {
diff --git a/itests/hive-unit/src/test/java/org/apache/hive/jdbc/authorization/TestHS2AuthzSessionContext.java b/itests/hive-unit/src/test/java/org/apache/hive/jdbc/authorization/TestHS2AuthzSessionContext.java
new file mode 100644
index 0000000000..eb29e228e1
--- /dev/null
+++ b/itests/hive-unit/src/test/java/org/apache/hive/jdbc/authorization/TestHS2AuthzSessionContext.java
@@ -0,0 +1,88 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.hive.jdbc.authorization;
+
+import static org.junit.Assert.assertEquals;
+import static org.junit.Assert.assertTrue;
+
+import java.util.HashMap;
+
+import org.apache.hadoop.hive.conf.HiveConf;
+import org.apache.hadoop.hive.conf.HiveConf.ConfVars;
+import org.apache.hadoop.hive.ql.security.HiveAuthenticationProvider;
+import org.apache.hadoop.hive.ql.security.SessionStateUserAuthenticator;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthorizer;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthorizerFactory;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzSessionContext;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveMetastoreClientFactory;
+import org.apache.hive.jdbc.miniHS2.MiniHS2;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
+import org.junit.Test;
+import org.mockito.Mockito;
+/**
+ * Test context information that gets passed to authorization factory
+ */
+public class TestHS2AuthzSessionContext {
+  private static MiniHS2 miniHS2 = null;
+  private static HiveAuthzSessionContext sessionCtx;
+
+  /**
+   * This factory captures the HiveAuthzSessionContext argument and returns mocked
+   * HiveAuthorizer class
+   */
+  static class MockedHiveAuthorizerFactory implements HiveAuthorizerFactory {
+    @Override
+    public HiveAuthorizer createHiveAuthorizer(HiveMetastoreClientFactory metastoreClientFactory,
+        HiveConf conf, HiveAuthenticationProvider authenticator, HiveAuthzSessionContext ctx) {
+      TestHS2AuthzSessionContext.sessionCtx = ctx;
+      HiveAuthorizer mockedAuthorizer = Mockito.mock(HiveAuthorizer.class);
+      return mockedAuthorizer;
+    }
+  }
+
+  @BeforeClass
+  public static void beforeTest() throws Exception {
+    Class.forName(MiniHS2.getJdbcDriverName());
+    HiveConf conf = new HiveConf();
+    conf.setVar(ConfVars.HIVE_AUTHORIZATION_MANAGER, MockedHiveAuthorizerFactory.class.getName());
+    conf.setVar(ConfVars.HIVE_AUTHENTICATOR_MANAGER, SessionStateUserAuthenticator.class.getName());
+    conf.setBoolVar(ConfVars.HIVE_AUTHORIZATION_ENABLED, true);
+    conf.setBoolVar(ConfVars.HIVE_SUPPORT_CONCURRENCY, false);
+    conf.setBoolVar(ConfVars.HIVE_SERVER2_ENABLE_DOAS, false);
+
+    miniHS2 = new MiniHS2(conf);
+    miniHS2.start(new HashMap<String, String>());
+  }
+
+  @AfterClass
+  public static void afterTest() throws Exception {
+    if (miniHS2.isStarted()) {
+      miniHS2.stop();
+    }
+  }
+
+  @Test
+  public void testAuthzSessionContextContents() throws Exception {
+    // session string is supposed to be unique, so its got to be of some reasonable size
+    assertTrue("session string size check", sessionCtx.getSessionString().length() > 10);
+    assertEquals("Client type ", HiveAuthzSessionContext.CLIENT_TYPE.HIVESERVER2, sessionCtx.getClientType());
+  }
+
+}
diff --git a/itests/util/src/main/java/org/apache/hadoop/hive/ql/security/authorization/plugin/sqlstd/SQLStdHiveAccessControllerForTest.java b/itests/util/src/main/java/org/apache/hadoop/hive/ql/security/authorization/plugin/sqlstd/SQLStdHiveAccessControllerForTest.java
index bdbe8a7baa..89429b61ee 100644
--- a/itests/util/src/main/java/org/apache/hadoop/hive/ql/security/authorization/plugin/sqlstd/SQLStdHiveAccessControllerForTest.java
+++ b/itests/util/src/main/java/org/apache/hadoop/hive/ql/security/authorization/plugin/sqlstd/SQLStdHiveAccessControllerForTest.java
@@ -21,6 +21,7 @@
 import org.apache.hadoop.hive.conf.HiveConf;
 import org.apache.hadoop.hive.ql.security.HiveAuthenticationProvider;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzPluginException;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzSessionContext;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveMetastoreClientFactory;
 
 /**
@@ -32,8 +33,8 @@
 public class SQLStdHiveAccessControllerForTest extends SQLStdHiveAccessController {
 
   SQLStdHiveAccessControllerForTest(HiveMetastoreClientFactory metastoreClientFactory, HiveConf conf,
-      HiveAuthenticationProvider authenticator) throws HiveAuthzPluginException {
-    super(metastoreClientFactory, conf, authenticator);
+      HiveAuthenticationProvider authenticator, HiveAuthzSessionContext ctx) throws HiveAuthzPluginException {
+    super(metastoreClientFactory, conf, authenticator, ctx);
   }
 
 
diff --git a/itests/util/src/main/java/org/apache/hadoop/hive/ql/security/authorization/plugin/sqlstd/SQLStdHiveAuthorizerFactoryForTest.java b/itests/util/src/main/java/org/apache/hadoop/hive/ql/security/authorization/plugin/sqlstd/SQLStdHiveAuthorizerFactoryForTest.java
index 3395513c42..0f41a8f38e 100644
--- a/itests/util/src/main/java/org/apache/hadoop/hive/ql/security/authorization/plugin/sqlstd/SQLStdHiveAuthorizerFactoryForTest.java
+++ b/itests/util/src/main/java/org/apache/hadoop/hive/ql/security/authorization/plugin/sqlstd/SQLStdHiveAuthorizerFactoryForTest.java
@@ -24,15 +24,16 @@
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthorizerFactory;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthorizerImpl;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzPluginException;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzSessionContext;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveMetastoreClientFactory;
 
 @Private
 public class SQLStdHiveAuthorizerFactoryForTest implements HiveAuthorizerFactory{
   @Override
   public HiveAuthorizer createHiveAuthorizer(HiveMetastoreClientFactory metastoreClientFactory,
-      HiveConf conf, HiveAuthenticationProvider authenticator) throws HiveAuthzPluginException {
+      HiveConf conf, HiveAuthenticationProvider authenticator, HiveAuthzSessionContext ctx) throws HiveAuthzPluginException {
     SQLStdHiveAccessController privilegeManager =
-        new SQLStdHiveAccessControllerForTest(metastoreClientFactory, conf, authenticator);
+        new SQLStdHiveAccessControllerForTest(metastoreClientFactory, conf, authenticator, ctx);
     return new HiveAuthorizerImpl(
         privilegeManager,
         new SQLStdHiveAuthorizationValidatorForTest(metastoreClientFactory, conf, authenticator,
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/Driver.java b/ql/src/java/org/apache/hadoop/hive/ql/Driver.java
index ffb6074b11..2111f14912 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/Driver.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/Driver.java
@@ -103,7 +103,6 @@
 import org.apache.hadoop.hive.ql.security.authorization.AuthorizationUtils;
 import org.apache.hadoop.hive.ql.security.authorization.HiveAuthorizationProvider;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzContext;
-import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzContext.CLIENT_TYPE;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveOperationType;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HivePrivilegeObject;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HivePrivilegeObject.HivePrivObjectActionType;
@@ -703,11 +702,7 @@ private static void doAuthorizationV2(SessionState ss, HiveOperation op, HashSet
       HashSet<WriteEntity> outputs, String command, Map<String, List<String>> tab2cols) throws HiveException {
 
     HiveAuthzContext.Builder authzContextBuilder = new HiveAuthzContext.Builder();
-
-    authzContextBuilder.setClientType(ss.isHiveServerQuery() ? CLIENT_TYPE.HIVESERVER2
-        : CLIENT_TYPE.HIVECLI);
     authzContextBuilder.setUserIpAddress(ss.getUserIpAddress());
-    authzContextBuilder.setSessionString(ss.getSessionId());
     authzContextBuilder.setCommandString(command);
 
     HiveOperationType hiveOpType = getHiveOperationType(op);
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/processors/CommandUtil.java b/ql/src/java/org/apache/hadoop/hive/ql/processors/CommandUtil.java
index 87c8fbb5e9..69783e7d10 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/processors/CommandUtil.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/processors/CommandUtil.java
@@ -22,11 +22,14 @@
 import java.util.List;
 
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAccessControlException;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzContext;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzPluginException;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveOperationType;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HivePrivilegeObject;
 import org.apache.hadoop.hive.ql.session.SessionState;
 
+import com.google.common.base.Joiner;
+
 class CommandUtil {
 
   /**
@@ -68,7 +71,10 @@ static CommandProcessorResponse authorizeCommand(SessionState ss, HiveOperationT
   static void authorizeCommandThrowEx(SessionState ss, HiveOperationType type,
       List<String> command) throws HiveAuthzPluginException, HiveAccessControlException {
     HivePrivilegeObject commandObj = HivePrivilegeObject.createHivePrivilegeObject(command);
-    ss.getAuthorizerV2().checkPrivileges(type, Arrays.asList(commandObj), null, null);
+    HiveAuthzContext.Builder ctxBuilder = new HiveAuthzContext.Builder();
+    ctxBuilder.setCommandString(Joiner.on(' ').join(command));
+    ctxBuilder.setUserIpAddress(ss.getUserIpAddress());
+    ss.getAuthorizerV2().checkPrivileges(type, Arrays.asList(commandObj), null, ctxBuilder.build());
   }
 
 
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/plugin/HiveAuthorizerFactory.java b/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/plugin/HiveAuthorizerFactory.java
index 876527ac1f..27fc128f8e 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/plugin/HiveAuthorizerFactory.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/plugin/HiveAuthorizerFactory.java
@@ -37,9 +37,11 @@ public interface HiveAuthorizerFactory {
    *  different thread, so get the current instance in each method invocation.
    * @param conf - current HiveConf
    * @param hiveAuthenticator - authenticator, provides user name
+   * @param ctx - session context information
    * @return new instance of HiveAuthorizer
    * @throws HiveAuthzPluginException
    */
   HiveAuthorizer createHiveAuthorizer(HiveMetastoreClientFactory metastoreClientFactory,
-      HiveConf conf, HiveAuthenticationProvider hiveAuthenticator) throws HiveAuthzPluginException;
+      HiveConf conf, HiveAuthenticationProvider hiveAuthenticator, HiveAuthzSessionContext ctx)
+      throws HiveAuthzPluginException;
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/plugin/HiveAuthzContext.java b/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/plugin/HiveAuthzContext.java
index bb71a7eac4..248b626e9c 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/plugin/HiveAuthzContext.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/plugin/HiveAuthzContext.java
@@ -29,14 +29,8 @@
 @Evolving
 public final class HiveAuthzContext {
 
-  public enum CLIENT_TYPE {
-    HIVESERVER2, HIVECLI
-  };
-
   public static class Builder {
     private String userIpAddress;
-    private String sessionString;
-    private CLIENT_TYPE clientType;
     private String commandString;
 
     /**
@@ -50,18 +44,6 @@ public String getUserIpAddress() {
     public void setUserIpAddress(String userIpAddress) {
       this.userIpAddress = userIpAddress;
     }
-    public String getSessionString() {
-      return sessionString;
-    }
-    public void setSessionString(String sessionString) {
-      this.sessionString = sessionString;
-    }
-    public CLIENT_TYPE getClientType() {
-      return clientType;
-    }
-    public void setClientType(CLIENT_TYPE clientType) {
-      this.clientType = clientType;
-    }
     public String getCommandString() {
       return commandString;
     }
@@ -76,14 +58,10 @@ public HiveAuthzContext build(){
   }
 
   private final String userIpAddress;
-  private final String sessionString;
-  private final CLIENT_TYPE clientType;
   private final String commandString;
 
   private HiveAuthzContext(Builder builder) {
     this.userIpAddress = builder.userIpAddress;
-    this.sessionString = builder.sessionString;
-    this.clientType = builder.clientType;
     this.commandString = builder.commandString;
 
   }
@@ -92,22 +70,14 @@ public String getIpAddress() {
     return userIpAddress;
   }
 
-  public String getSessionString() {
-    return sessionString;
-  }
-
-  public CLIENT_TYPE getClientType() {
-    return clientType;
-  }
-
   public String getCommandString() {
     return commandString;
   }
 
   @Override
   public String toString() {
-    return "HiveAuthzContext [userIpAddress=" + userIpAddress + ", sessionString=" + sessionString
-        + ", clientType=" + clientType + ", commandString=" + commandString + "]";
+    return "HiveAuthzContext [userIpAddress=" + userIpAddress + ", commandString=" + commandString
+        + "]";
   }
 
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/plugin/HiveAuthzSessionContext.java b/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/plugin/HiveAuthzSessionContext.java
new file mode 100644
index 0000000000..b0aadd5066
--- /dev/null
+++ b/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/plugin/HiveAuthzSessionContext.java
@@ -0,0 +1,89 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.hadoop.hive.ql.security.authorization.plugin;
+
+import org.apache.hadoop.hive.common.classification.InterfaceAudience.LimitedPrivate;
+import org.apache.hadoop.hive.common.classification.InterfaceStability.Evolving;
+
+/**
+ * Provides session context information.
+ * It is an immutable class. Builder inner class is used instantiate it.
+ */
+@LimitedPrivate(value = { "" })
+@Evolving
+public final class HiveAuthzSessionContext {
+
+  public enum CLIENT_TYPE {
+    HIVESERVER2, HIVECLI
+  };
+
+  public static class Builder {
+    private String sessionString;
+    private CLIENT_TYPE clientType;
+
+    public Builder(){};
+
+    /**
+     * Builder that copies values from given instance of HiveAuthzSessionContext
+     * @param other
+     */
+    public Builder(HiveAuthzSessionContext other){
+      this.sessionString = other.getSessionString();
+      this.clientType = other.getClientType();
+    }
+
+    public String getSessionString() {
+      return sessionString;
+    }
+    public void setSessionString(String sessionString) {
+      this.sessionString = sessionString;
+    }
+    public CLIENT_TYPE getClientType() {
+      return clientType;
+    }
+    public void setClientType(CLIENT_TYPE clientType) {
+      this.clientType = clientType;
+    }
+    public HiveAuthzSessionContext build(){
+      return new HiveAuthzSessionContext(this);
+    }
+  }
+
+  private final String sessionString;
+  private final CLIENT_TYPE clientType;
+
+  private HiveAuthzSessionContext(Builder builder) {
+    this.sessionString = builder.sessionString;
+    this.clientType = builder.clientType;
+  }
+
+  public String getSessionString() {
+    return sessionString;
+  }
+
+  public CLIENT_TYPE getClientType() {
+    return clientType;
+  }
+
+  @Override
+  public String toString() {
+    return "HiveAuthzSessionContext [sessionString=" + sessionString + ", clientType=" + clientType
+        + "]";
+  }
+
+}
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/plugin/sqlstd/SQLStdHiveAccessController.java b/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/plugin/sqlstd/SQLStdHiveAccessController.java
index 140882d4f9..532bcc51c5 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/plugin/sqlstd/SQLStdHiveAccessController.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/plugin/sqlstd/SQLStdHiveAccessController.java
@@ -50,6 +50,8 @@
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAccessControlException;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAccessController;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzPluginException;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzSessionContext;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzSessionContext.CLIENT_TYPE;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveMetastoreClientFactory;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HivePrincipal;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HivePrivilege;
@@ -81,13 +83,46 @@ public class SQLStdHiveAccessController implements HiveAccessController {
       + "have it as current role, for this action.";
   private final String HAS_ADMIN_PRIV_MSG = "grantor need to have ADMIN OPTION on role being"
       + " granted and have it as a current role for this action.";
+  private final HiveAuthzSessionContext sessionCtx;
   public static final Log LOG = LogFactory.getLog(SQLStdHiveAccessController.class);
 
   public SQLStdHiveAccessController(HiveMetastoreClientFactory metastoreClientFactory, HiveConf conf,
-      HiveAuthenticationProvider authenticator) throws HiveAuthzPluginException {
+      HiveAuthenticationProvider authenticator, HiveAuthzSessionContext ctx) throws HiveAuthzPluginException {
     this.metastoreClientFactory = metastoreClientFactory;
     this.authenticator = authenticator;
+    this.sessionCtx = applyTestSettings(ctx, conf);
+
+    assertHiveCliAuthDisabled(conf);
     initUserRoles();
+    LOG.info("Created SQLStdHiveAccessController for session context : " + sessionCtx);
+  }
+
+  /**
+   * Change the session context based on configuration to aid in testing of sql std auth
+   * @param ctx
+   * @param conf
+   * @return
+   */
+  private HiveAuthzSessionContext applyTestSettings(HiveAuthzSessionContext ctx, HiveConf conf) {
+    if(conf.getBoolVar(ConfVars.HIVE_TEST_AUTHORIZATION_SQLSTD_HS2_MODE) &&
+        ctx.getClientType() == CLIENT_TYPE.HIVECLI
+        ){
+      // create new session ctx object with HS2 as client type
+      HiveAuthzSessionContext.Builder ctxBuilder = new HiveAuthzSessionContext.Builder(ctx);
+      ctxBuilder.setClientType(CLIENT_TYPE.HIVESERVER2);
+      return ctxBuilder.build();
+    }
+    return ctx;
+  }
+
+  private void assertHiveCliAuthDisabled(HiveConf conf) throws HiveAuthzPluginException {
+    if (sessionCtx.getClientType() == CLIENT_TYPE.HIVECLI
+        && conf.getBoolVar(ConfVars.HIVE_AUTHORIZATION_ENABLED)) {
+      throw new HiveAuthzPluginException(
+          "SQL standards based authorization should not be enabled from hive cli"
+              + "Instead the use of storage based authorization in hive metastore is reccomended. Set "
+              + ConfVars.HIVE_AUTHORIZATION_ENABLED.varname + "=false to disable authz within cli");
+    }
   }
 
   /**
@@ -671,31 +706,37 @@ public List<HiveRoleGrant> getRoleGrantInfoForPrincipal(HivePrincipal principal)
 
   @Override
   public void applyAuthorizationConfigPolicy(HiveConf hiveConf) {
-    // grant all privileges for table to its owner
+    // First apply configuration applicable to both Hive Cli and HiveServer2
+    // Not adding any authorization related restrictions to hive cli
+    // grant all privileges for table to its owner - set this in cli as well so that owner
+    // has permissions via HiveServer2 as well.
     hiveConf.setVar(ConfVars.HIVE_AUTHORIZATION_TABLE_OWNER_GRANTS, "INSERT,SELECT,UPDATE,DELETE");
 
-    // Configure PREEXECHOOKS with DisallowTransformHook to disallow transform queries
-    String hooks = hiveConf.getVar(ConfVars.PREEXECHOOKS).trim();
-    if (hooks.isEmpty()) {
-      hooks = DisallowTransformHook.class.getName();
-    } else {
-      hooks = hooks + "," +DisallowTransformHook.class.getName();
-    }
-    LOG.debug("Configuring hooks : " + hooks);
-    hiveConf.setVar(ConfVars.PREEXECHOOKS, hooks);
-
-    // restrict the variables that can be set using set command to a list in whitelist
-    hiveConf.setIsModWhiteListEnabled(true);
-    String whiteListParamsStr = hiveConf.getVar(ConfVars.HIVE_AUTHORIZATION_SQL_STD_AUTH_CONFIG_WHITELIST);
-    if (whiteListParamsStr == null || whiteListParamsStr.trim().equals("")){
-      // set the default configs in whitelist
-      whiteListParamsStr = Joiner.on(",").join(defaultModWhiteListSqlStdAuth);
-      hiveConf.setVar(ConfVars.HIVE_AUTHORIZATION_SQL_STD_AUTH_CONFIG_WHITELIST, whiteListParamsStr);
-    }
-    for(String whiteListParam : whiteListParamsStr.split(",")){
-      hiveConf.addToModifiableWhiteList(whiteListParam);
+    // Apply rest of the configuration only to HiveServer2
+    if(sessionCtx.getClientType() == CLIENT_TYPE.HIVESERVER2) {
+      // Configure PREEXECHOOKS with DisallowTransformHook to disallow transform queries
+      String hooks = hiveConf.getVar(ConfVars.PREEXECHOOKS).trim();
+      if (hooks.isEmpty()) {
+        hooks = DisallowTransformHook.class.getName();
+      } else {
+        hooks = hooks + "," +DisallowTransformHook.class.getName();
+      }
+      LOG.debug("Configuring hooks : " + hooks);
+      hiveConf.setVar(ConfVars.PREEXECHOOKS, hooks);
+
+      // restrict the variables that can be set using set command to a list in whitelist
+      hiveConf.setIsModWhiteListEnabled(true);
+      String whiteListParamsStr = hiveConf.getVar(ConfVars.HIVE_AUTHORIZATION_SQL_STD_AUTH_CONFIG_WHITELIST);
+      if (whiteListParamsStr == null || whiteListParamsStr.trim().equals("")){
+        // set the default configs in whitelist
+        whiteListParamsStr = Joiner.on(",").join(defaultModWhiteListSqlStdAuth);
+        hiveConf.setVar(ConfVars.HIVE_AUTHORIZATION_SQL_STD_AUTH_CONFIG_WHITELIST, whiteListParamsStr);
+      }
+      for(String whiteListParam : whiteListParamsStr.split(",")){
+        hiveConf.addToModifiableWhiteList(whiteListParam);
+      }
     }
-
   }
 
+
 }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/plugin/sqlstd/SQLStdHiveAuthorizerFactory.java b/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/plugin/sqlstd/SQLStdHiveAuthorizerFactory.java
index c2d50b13f7..9db3d74c41 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/plugin/sqlstd/SQLStdHiveAuthorizerFactory.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/security/authorization/plugin/sqlstd/SQLStdHiveAuthorizerFactory.java
@@ -24,15 +24,16 @@
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthorizerFactory;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthorizerImpl;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzPluginException;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzSessionContext;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveMetastoreClientFactory;
 
 @Private
 public class SQLStdHiveAuthorizerFactory implements HiveAuthorizerFactory{
   @Override
   public HiveAuthorizer createHiveAuthorizer(HiveMetastoreClientFactory metastoreClientFactory,
-      HiveConf conf, HiveAuthenticationProvider authenticator) throws HiveAuthzPluginException {
+      HiveConf conf, HiveAuthenticationProvider authenticator, HiveAuthzSessionContext ctx) throws HiveAuthzPluginException {
     SQLStdHiveAccessController privilegeManager =
-        new SQLStdHiveAccessController(metastoreClientFactory, conf, authenticator);
+        new SQLStdHiveAccessController(metastoreClientFactory, conf, authenticator, ctx);
     return new HiveAuthorizerImpl(
         privilegeManager,
         new SQLStdHiveAuthorizationValidator(metastoreClientFactory, conf, authenticator,
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/session/SessionState.java b/ql/src/java/org/apache/hadoop/hive/ql/session/SessionState.java
index fcfcf42276..9798cf3f53 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/session/SessionState.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/session/SessionState.java
@@ -62,6 +62,8 @@
 import org.apache.hadoop.hive.ql.security.authorization.HiveAuthorizationProvider;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthorizer;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthorizerFactory;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzSessionContext;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzSessionContext.CLIENT_TYPE;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveMetastoreClientFactoryImpl;
 import org.apache.hadoop.hive.ql.util.DosToUnix;
 import org.apache.hadoop.hive.shims.ShimLoader;
@@ -504,8 +506,13 @@ private void setupAuth() {
         HiveAuthorizerFactory authorizerFactory = HiveUtils.getAuthorizerFactory(conf,
             HiveConf.ConfVars.HIVE_AUTHORIZATION_MANAGER);
 
+        HiveAuthzSessionContext.Builder authzContextBuilder = new HiveAuthzSessionContext.Builder();
+        authzContextBuilder.setClientType(isHiveServerQuery() ? CLIENT_TYPE.HIVESERVER2
+            : CLIENT_TYPE.HIVECLI);
+        authzContextBuilder.setSessionString(getSessionId());
+
         authorizerV2 = authorizerFactory.createHiveAuthorizer(new HiveMetastoreClientFactoryImpl(),
-            conf, authenticator);
+            conf, authenticator, authzContextBuilder.build());
 
         authorizerV2.applyAuthorizationConfigPolicy(conf);
         // create the create table grants with new config
diff --git a/ql/src/test/org/apache/hadoop/hive/ql/parse/authorization/TestSessionUserName.java b/ql/src/test/org/apache/hadoop/hive/ql/parse/authorization/TestSessionUserName.java
index 273c4b910b..a81ac44935 100644
--- a/ql/src/test/org/apache/hadoop/hive/ql/parse/authorization/TestSessionUserName.java
+++ b/ql/src/test/org/apache/hadoop/hive/ql/parse/authorization/TestSessionUserName.java
@@ -28,6 +28,7 @@
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthorizer;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthorizerFactory;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthorizerImpl;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzSessionContext;
 import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveMetastoreClientFactory;
 import org.apache.hadoop.hive.ql.session.SessionState;
 import org.junit.Before;
@@ -111,7 +112,7 @@ static class HiveAuthorizerStoringUserNameFactory implements HiveAuthorizerFacto
 
     @Override
     public HiveAuthorizer createHiveAuthorizer(HiveMetastoreClientFactory metastoreClientFactory,
-        HiveConf conf, HiveAuthenticationProvider authenticator) {
+        HiveConf conf, HiveAuthenticationProvider authenticator, HiveAuthzSessionContext ctx) {
       username = authenticator.getUserName();
       HiveAccessController acontroller = Mockito.mock(HiveAccessController.class);
       return new HiveAuthorizerImpl(acontroller, null);
diff --git a/ql/src/test/org/apache/hadoop/hive/ql/security/authorization/plugin/sqlstd/TestSQLStdHiveAccessControllerCLI.java b/ql/src/test/org/apache/hadoop/hive/ql/security/authorization/plugin/sqlstd/TestSQLStdHiveAccessControllerCLI.java
new file mode 100644
index 0000000000..c0d4948325
--- /dev/null
+++ b/ql/src/test/org/apache/hadoop/hive/ql/security/authorization/plugin/sqlstd/TestSQLStdHiveAccessControllerCLI.java
@@ -0,0 +1,89 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd;
+
+import static org.junit.Assert.assertFalse;
+import static org.junit.Assert.assertTrue;
+import static org.junit.Assert.fail;
+
+import org.apache.hadoop.hive.conf.HiveConf;
+import org.apache.hadoop.hive.conf.HiveConf.ConfVars;
+import org.apache.hadoop.hive.ql.security.HadoopDefaultAuthenticator;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.DisallowTransformHook;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzPluginException;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzSessionContext;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzSessionContext.Builder;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzSessionContext.CLIENT_TYPE;
+import org.junit.Test;
+
+/**
+ * Test SQLStdHiveAccessController
+ */
+public class TestSQLStdHiveAccessControllerCLI {
+
+  /**
+   * Test that SQLStdHiveAccessController is not applying config restrictions on CLI
+   *
+   * @throws HiveAuthzPluginException
+   */
+  @Test
+  public void testConfigProcessing() throws HiveAuthzPluginException {
+    HiveConf processedConf = new HiveConf();
+    SQLStdHiveAccessController accessController = new SQLStdHiveAccessController(null,
+        processedConf, new HadoopDefaultAuthenticator(), getCLISessionCtx()
+        );
+    accessController.applyAuthorizationConfigPolicy(processedConf);
+
+    // check that hook to disable transforms has not been added
+    assertFalse("Check for transform query disabling hook",
+        processedConf.getVar(ConfVars.PREEXECHOOKS).contains(DisallowTransformHook.class.getName()));
+
+    // check that set param whitelist is not set
+    assertTrue(processedConf.getVar(ConfVars.HIVE_AUTHORIZATION_SQL_STD_AUTH_CONFIG_WHITELIST) == null
+        || processedConf.getVar(ConfVars.HIVE_AUTHORIZATION_SQL_STD_AUTH_CONFIG_WHITELIST).trim()
+            .equals(""));
+
+    // verify that some dummy param can be set
+    processedConf.verifyAndSet("dummy.param", "dummy.val");
+  }
+
+  private HiveAuthzSessionContext getCLISessionCtx() {
+    Builder ctxBuilder = new HiveAuthzSessionContext.Builder();
+    ctxBuilder.setClientType(CLIENT_TYPE.HIVECLI);
+    return ctxBuilder.build();
+  }
+
+  /**
+   * Verify that exceptiion is thrown if authorization is enabled from hive cli,
+   * when sql std auth is used
+   */
+  @Test
+  public void testAuthEnableError() {
+    HiveConf processedConf = new HiveConf();
+    processedConf.setBoolVar(ConfVars.HIVE_AUTHORIZATION_ENABLED, true);
+    try {
+      SQLStdHiveAccessController accessController = new SQLStdHiveAccessController(null,
+          processedConf, new HadoopDefaultAuthenticator(), getCLISessionCtx());
+      fail("Exception expected");
+    } catch (HiveAuthzPluginException e) {
+      assertTrue(e.getMessage().contains(
+          "SQL standards based authorization should not be enabled from hive cli"));
+    }
+  }
+
+}
diff --git a/ql/src/test/org/apache/hadoop/hive/ql/security/authorization/plugin/sqlstd/TestSQLStdHiveAccessControllerHS2.java b/ql/src/test/org/apache/hadoop/hive/ql/security/authorization/plugin/sqlstd/TestSQLStdHiveAccessControllerHS2.java
new file mode 100644
index 0000000000..f13cf7e9f0
--- /dev/null
+++ b/ql/src/test/org/apache/hadoop/hive/ql/security/authorization/plugin/sqlstd/TestSQLStdHiveAccessControllerHS2.java
@@ -0,0 +1,123 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd;
+
+import static org.junit.Assert.assertTrue;
+import static org.junit.Assert.fail;
+
+import org.apache.hadoop.hive.conf.HiveConf;
+import org.apache.hadoop.hive.conf.HiveConf.ConfVars;
+import org.apache.hadoop.hive.ql.security.HadoopDefaultAuthenticator;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.DisallowTransformHook;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzPluginException;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzSessionContext;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzSessionContext.Builder;
+import org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzSessionContext.CLIENT_TYPE;
+import org.junit.Test;
+
+import com.google.common.base.Joiner;
+
+/**
+ * Test SQLStdHiveAccessController
+ */
+public class TestSQLStdHiveAccessControllerHS2 {
+
+  /**
+   * Test if SQLStdHiveAccessController is applying configuration security
+   * policy on hiveconf correctly
+   *
+   * @throws HiveAuthzPluginException
+   */
+  @Test
+  public void testConfigProcessing() throws HiveAuthzPluginException {
+    HiveConf processedConf = new HiveConf();
+    SQLStdHiveAccessController accessController = new SQLStdHiveAccessController(null,
+        processedConf, new HadoopDefaultAuthenticator(), getHS2SessionCtx()
+        );
+    accessController.applyAuthorizationConfigPolicy(processedConf);
+
+    // check that hook to disable transforms has been added
+    assertTrue("Check for transform query disabling hook",
+        processedConf.getVar(ConfVars.PREEXECHOOKS).contains(DisallowTransformHook.class.getName()));
+
+    verifyParamSettability(SQLStdHiveAccessController.defaultModWhiteListSqlStdAuth, processedConf);
+
+  }
+
+  private HiveAuthzSessionContext getHS2SessionCtx() {
+    Builder ctxBuilder = new HiveAuthzSessionContext.Builder();
+    ctxBuilder.setClientType(CLIENT_TYPE.HIVESERVER2);
+    return ctxBuilder.build();
+  }
+
+  /**
+   * Verify that params in settableParams can be modified, and other random ones can't be modified
+   * @param settableParams
+   * @param processedConf
+   */
+  private void verifyParamSettability(String [] settableParams, HiveConf processedConf) {
+    // verify that the whitlelist params can be set
+    for (String param : settableParams) {
+      try {
+        processedConf.verifyAndSet(param, "dummy");
+      } catch (IllegalArgumentException e) {
+        fail("Unable to set value for parameter in whitelist " + param + " " + e);
+      }
+    }
+
+    // verify that non whitelist params can't be set
+    assertConfModificationException(processedConf, "dummy.param");
+    // does not make sense to have any of the metastore config variables to be
+    // modifiable
+    for (ConfVars metaVar : HiveConf.metaVars) {
+      assertConfModificationException(processedConf, metaVar.varname);
+    }
+  }
+
+  /**
+   * Test that modifying HIVE_AUTHORIZATION_SQL_STD_AUTH_CONFIG_WHITELIST config works
+   * @throws HiveAuthzPluginException
+   */
+  @Test
+  public void testConfigProcessingCustomSetWhitelist() throws HiveAuthzPluginException {
+
+    HiveConf processedConf = new HiveConf();
+    // add custom value, including one from the default, one new one
+    String[] settableParams = { SQLStdHiveAccessController.defaultModWhiteListSqlStdAuth[0],
+        "abcs.dummy.test.param" };
+   processedConf.setVar(HiveConf.ConfVars.HIVE_AUTHORIZATION_SQL_STD_AUTH_CONFIG_WHITELIST,
+        Joiner.on(",").join(settableParams));
+
+    SQLStdHiveAccessController accessController = new SQLStdHiveAccessController(null,
+        processedConf, new HadoopDefaultAuthenticator(), getHS2SessionCtx());
+    accessController.applyAuthorizationConfigPolicy(processedConf);
+    verifyParamSettability(settableParams, processedConf);
+
+  }
+
+  private void assertConfModificationException(HiveConf processedConf, String param) {
+    boolean caughtEx = false;
+    try {
+      processedConf.verifyAndSet(param, "dummy");
+    } catch (IllegalArgumentException e) {
+      caughtEx = true;
+    }
+    assertTrue("Exception should be thrown while modifying the param " + param, caughtEx);
+  }
+
+}
diff --git a/ql/src/test/queries/clientnegative/authorization_addjar.q b/ql/src/test/queries/clientnegative/authorization_addjar.q
index aad703c17b..f7c851d656 100644
--- a/ql/src/test/queries/clientnegative/authorization_addjar.q
+++ b/ql/src/test/queries/clientnegative/authorization_addjar.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.enabled=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactory;
 
diff --git a/ql/src/test/queries/clientnegative/authorization_addpartition.q b/ql/src/test/queries/clientnegative/authorization_addpartition.q
index 8abdd2b3cd..f84ab9880d 100644
--- a/ql/src/test/queries/clientnegative/authorization_addpartition.q
+++ b/ql/src/test/queries/clientnegative/authorization_addpartition.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_alter_db_owner.q b/ql/src/test/queries/clientnegative/authorization_alter_db_owner.q
index f716262e23..83a0efaabd 100644
--- a/ql/src/test/queries/clientnegative/authorization_alter_db_owner.q
+++ b/ql/src/test/queries/clientnegative/authorization_alter_db_owner.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_alter_db_owner_default.q b/ql/src/test/queries/clientnegative/authorization_alter_db_owner_default.q
index f904935018..2140ecadf3 100644
--- a/ql/src/test/queries/clientnegative/authorization_alter_db_owner_default.q
+++ b/ql/src/test/queries/clientnegative/authorization_alter_db_owner_default.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_cannot_create_all_role.q b/ql/src/test/queries/clientnegative/authorization_cannot_create_all_role.q
index 9bbd655937..9bac3e0739 100644
--- a/ql/src/test/queries/clientnegative/authorization_cannot_create_all_role.q
+++ b/ql/src/test/queries/clientnegative/authorization_cannot_create_all_role.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set user.name=hive_admin_user;
diff --git a/ql/src/test/queries/clientnegative/authorization_cannot_create_default_role.q b/ql/src/test/queries/clientnegative/authorization_cannot_create_default_role.q
index 32045e46cb..73c9e88615 100644
--- a/ql/src/test/queries/clientnegative/authorization_cannot_create_default_role.q
+++ b/ql/src/test/queries/clientnegative/authorization_cannot_create_default_role.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set user.name=hive_admin_user;
diff --git a/ql/src/test/queries/clientnegative/authorization_cannot_create_none_role.q b/ql/src/test/queries/clientnegative/authorization_cannot_create_none_role.q
index 42369d85d0..acb03c19c1 100644
--- a/ql/src/test/queries/clientnegative/authorization_cannot_create_none_role.q
+++ b/ql/src/test/queries/clientnegative/authorization_cannot_create_none_role.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set user.name=hive_admin_user;
diff --git a/ql/src/test/queries/clientnegative/authorization_caseinsensitivity.q b/ql/src/test/queries/clientnegative/authorization_caseinsensitivity.q
index 7b47b65d0d..bdedcb1758 100644
--- a/ql/src/test/queries/clientnegative/authorization_caseinsensitivity.q
+++ b/ql/src/test/queries/clientnegative/authorization_caseinsensitivity.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set user.name=hive_admin_user;
diff --git a/ql/src/test/queries/clientnegative/authorization_cli_auth_enable.q b/ql/src/test/queries/clientnegative/authorization_cli_auth_enable.q
new file mode 100644
index 0000000000..476105164f
--- /dev/null
+++ b/ql/src/test/queries/clientnegative/authorization_cli_auth_enable.q
@@ -0,0 +1,7 @@
+set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
+set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
+set user.name=hive_test_user;
+set hive.security.authorization.enabled=true;
+
+-- verify that sql std auth throws an error with hive cli, if auth is enabled
+show tables 'src';
diff --git a/ql/src/test/queries/clientnegative/authorization_compile.q b/ql/src/test/queries/clientnegative/authorization_compile.q
index 857306b920..0d51c99794 100644
--- a/ql/src/test/queries/clientnegative/authorization_compile.q
+++ b/ql/src/test/queries/clientnegative/authorization_compile.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.enabled=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactory;
 
diff --git a/ql/src/test/queries/clientnegative/authorization_create_func1.q b/ql/src/test/queries/clientnegative/authorization_create_func1.q
index 02bbe090cf..1154ce88b0 100644
--- a/ql/src/test/queries/clientnegative/authorization_create_func1.q
+++ b/ql/src/test/queries/clientnegative/authorization_create_func1.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_create_func2.q b/ql/src/test/queries/clientnegative/authorization_create_func2.q
index 8760fa8d82..0d273fa126 100644
--- a/ql/src/test/queries/clientnegative/authorization_create_func2.q
+++ b/ql/src/test/queries/clientnegative/authorization_create_func2.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_create_index.q b/ql/src/test/queries/clientnegative/authorization_create_index.q
index 3c19afe6e1..eeb5673c11 100644
--- a/ql/src/test/queries/clientnegative/authorization_create_index.q
+++ b/ql/src/test/queries/clientnegative/authorization_create_index.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_create_macro1.q b/ql/src/test/queries/clientnegative/authorization_create_macro1.q
index c904a100c5..f96542675c 100644
--- a/ql/src/test/queries/clientnegative/authorization_create_macro1.q
+++ b/ql/src/test/queries/clientnegative/authorization_create_macro1.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_create_role_no_admin.q b/ql/src/test/queries/clientnegative/authorization_create_role_no_admin.q
index a84fe64bd6..b7b2b85312 100644
--- a/ql/src/test/queries/clientnegative/authorization_create_role_no_admin.q
+++ b/ql/src/test/queries/clientnegative/authorization_create_role_no_admin.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 -- this test will fail because hive_test_user is not in admin role.
 create role r1;
diff --git a/ql/src/test/queries/clientnegative/authorization_createview.q b/ql/src/test/queries/clientnegative/authorization_createview.q
index 9b1f2ea6c6..4c91c70881 100644
--- a/ql/src/test/queries/clientnegative/authorization_createview.q
+++ b/ql/src/test/queries/clientnegative/authorization_createview.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_ctas.q b/ql/src/test/queries/clientnegative/authorization_ctas.q
index 1cf74a365d..13e25f5598 100644
--- a/ql/src/test/queries/clientnegative/authorization_ctas.q
+++ b/ql/src/test/queries/clientnegative/authorization_ctas.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_deletejar.q b/ql/src/test/queries/clientnegative/authorization_deletejar.q
index f2e95d29d2..1e6af6017c 100644
--- a/ql/src/test/queries/clientnegative/authorization_deletejar.q
+++ b/ql/src/test/queries/clientnegative/authorization_deletejar.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.enabled=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactory;
 
diff --git a/ql/src/test/queries/clientnegative/authorization_desc_table_nosel.q b/ql/src/test/queries/clientnegative/authorization_desc_table_nosel.q
index 47663c9bb9..598cc75e41 100644
--- a/ql/src/test/queries/clientnegative/authorization_desc_table_nosel.q
+++ b/ql/src/test/queries/clientnegative/authorization_desc_table_nosel.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_dfs.q b/ql/src/test/queries/clientnegative/authorization_dfs.q
index 9dc8a64a19..4553d0290b 100644
--- a/ql/src/test/queries/clientnegative/authorization_dfs.q
+++ b/ql/src/test/queries/clientnegative/authorization_dfs.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.enabled=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactory;
 
diff --git a/ql/src/test/queries/clientnegative/authorization_disallow_transform.q b/ql/src/test/queries/clientnegative/authorization_disallow_transform.q
index 64b300c8d9..342c29a172 100644
--- a/ql/src/test/queries/clientnegative/authorization_disallow_transform.q
+++ b/ql/src/test/queries/clientnegative/authorization_disallow_transform.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set role ALL;
 SELECT TRANSFORM (*) USING 'cat' AS (key, value) FROM src;
diff --git a/ql/src/test/queries/clientnegative/authorization_drop_admin_role.q b/ql/src/test/queries/clientnegative/authorization_drop_admin_role.q
index 9c21b5faac..d30a13bb1d 100644
--- a/ql/src/test/queries/clientnegative/authorization_drop_admin_role.q
+++ b/ql/src/test/queries/clientnegative/authorization_drop_admin_role.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set user.name=hive_admin_user;
diff --git a/ql/src/test/queries/clientnegative/authorization_drop_db_cascade.q b/ql/src/test/queries/clientnegative/authorization_drop_db_cascade.q
index 78ec078f7b..eb573f4294 100644
--- a/ql/src/test/queries/clientnegative/authorization_drop_db_cascade.q
+++ b/ql/src/test/queries/clientnegative/authorization_drop_db_cascade.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_drop_db_empty.q b/ql/src/test/queries/clientnegative/authorization_drop_db_empty.q
index 993a2a3da6..570a0fa439 100644
--- a/ql/src/test/queries/clientnegative/authorization_drop_db_empty.q
+++ b/ql/src/test/queries/clientnegative/authorization_drop_db_empty.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_drop_index.q b/ql/src/test/queries/clientnegative/authorization_drop_index.q
index 1df9f98f47..d984d063d9 100644
--- a/ql/src/test/queries/clientnegative/authorization_drop_index.q
+++ b/ql/src/test/queries/clientnegative/authorization_drop_index.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_drop_role_no_admin.q b/ql/src/test/queries/clientnegative/authorization_drop_role_no_admin.q
index 2593e9ede3..b9a0d2119c 100644
--- a/ql/src/test/queries/clientnegative/authorization_drop_role_no_admin.q
+++ b/ql/src/test/queries/clientnegative/authorization_drop_role_no_admin.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set user.name=hive_admin_user;
diff --git a/ql/src/test/queries/clientnegative/authorization_droppartition.q b/ql/src/test/queries/clientnegative/authorization_droppartition.q
index f05e9458fa..29a27ce073 100644
--- a/ql/src/test/queries/clientnegative/authorization_droppartition.q
+++ b/ql/src/test/queries/clientnegative/authorization_droppartition.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_fail_8.q b/ql/src/test/queries/clientnegative/authorization_fail_8.q
index 37213a2736..3c156a4929 100644
--- a/ql/src/test/queries/clientnegative/authorization_fail_8.q
+++ b/ql/src/test/queries/clientnegative/authorization_fail_8.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 
diff --git a/ql/src/test/queries/clientnegative/authorization_grant_table_allpriv.q b/ql/src/test/queries/clientnegative/authorization_grant_table_allpriv.q
index f3c86b97ce..fb4abd785c 100644
--- a/ql/src/test/queries/clientnegative/authorization_grant_table_allpriv.q
+++ b/ql/src/test/queries/clientnegative/authorization_grant_table_allpriv.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 
diff --git a/ql/src/test/queries/clientnegative/authorization_grant_table_dup.q b/ql/src/test/queries/clientnegative/authorization_grant_table_dup.q
index 7808cb3ec7..13b48dfcfc 100644
--- a/ql/src/test/queries/clientnegative/authorization_grant_table_dup.q
+++ b/ql/src/test/queries/clientnegative/authorization_grant_table_dup.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 
diff --git a/ql/src/test/queries/clientnegative/authorization_grant_table_fail1.q b/ql/src/test/queries/clientnegative/authorization_grant_table_fail1.q
index 8dc8e45a79..80aa7a4323 100644
--- a/ql/src/test/queries/clientnegative/authorization_grant_table_fail1.q
+++ b/ql/src/test/queries/clientnegative/authorization_grant_table_fail1.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 
diff --git a/ql/src/test/queries/clientnegative/authorization_grant_table_fail_nogrant.q b/ql/src/test/queries/clientnegative/authorization_grant_table_fail_nogrant.q
index d51c1c3507..dcde1f990a 100644
--- a/ql/src/test/queries/clientnegative/authorization_grant_table_fail_nogrant.q
+++ b/ql/src/test/queries/clientnegative/authorization_grant_table_fail_nogrant.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 
diff --git a/ql/src/test/queries/clientnegative/authorization_insert_noinspriv.q b/ql/src/test/queries/clientnegative/authorization_insert_noinspriv.q
index 2fa3cb260b..0ab5c08b4c 100644
--- a/ql/src/test/queries/clientnegative/authorization_insert_noinspriv.q
+++ b/ql/src/test/queries/clientnegative/authorization_insert_noinspriv.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_insert_noselectpriv.q b/ql/src/test/queries/clientnegative/authorization_insert_noselectpriv.q
index b9bee4ea40..7b60d56dff 100644
--- a/ql/src/test/queries/clientnegative/authorization_insert_noselectpriv.q
+++ b/ql/src/test/queries/clientnegative/authorization_insert_noselectpriv.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_insertoverwrite_nodel.q b/ql/src/test/queries/clientnegative/authorization_insertoverwrite_nodel.q
index 73cfe82749..d891ca2eb5 100644
--- a/ql/src/test/queries/clientnegative/authorization_insertoverwrite_nodel.q
+++ b/ql/src/test/queries/clientnegative/authorization_insertoverwrite_nodel.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_invalid_priv_v2.q b/ql/src/test/queries/clientnegative/authorization_invalid_priv_v2.q
index 9c724085d9..5d4c95e928 100644
--- a/ql/src/test/queries/clientnegative/authorization_invalid_priv_v2.q
+++ b/ql/src/test/queries/clientnegative/authorization_invalid_priv_v2.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 
 create table if not exists authorization_invalid_v2 (key int, value string);
diff --git a/ql/src/test/queries/clientnegative/authorization_not_owner_alter_tab_rename.q b/ql/src/test/queries/clientnegative/authorization_not_owner_alter_tab_rename.q
index 8a3300cb2e..fe5c1f6828 100644
--- a/ql/src/test/queries/clientnegative/authorization_not_owner_alter_tab_rename.q
+++ b/ql/src/test/queries/clientnegative/authorization_not_owner_alter_tab_rename.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_not_owner_alter_tab_serdeprop.q b/ql/src/test/queries/clientnegative/authorization_not_owner_alter_tab_serdeprop.q
index 0172c4c74c..2eb4180f14 100644
--- a/ql/src/test/queries/clientnegative/authorization_not_owner_alter_tab_serdeprop.q
+++ b/ql/src/test/queries/clientnegative/authorization_not_owner_alter_tab_serdeprop.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_not_owner_drop_tab.q b/ql/src/test/queries/clientnegative/authorization_not_owner_drop_tab.q
index 2d0e52da00..aa8b6847ec 100644
--- a/ql/src/test/queries/clientnegative/authorization_not_owner_drop_tab.q
+++ b/ql/src/test/queries/clientnegative/authorization_not_owner_drop_tab.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_not_owner_drop_view.q b/ql/src/test/queries/clientnegative/authorization_not_owner_drop_view.q
index 76bbab42b3..8e611a021d 100644
--- a/ql/src/test/queries/clientnegative/authorization_not_owner_drop_view.q
+++ b/ql/src/test/queries/clientnegative/authorization_not_owner_drop_view.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_priv_current_role_neg.q b/ql/src/test/queries/clientnegative/authorization_priv_current_role_neg.q
index 29a06a8ec4..c0fb59957f 100644
--- a/ql/src/test/queries/clientnegative/authorization_priv_current_role_neg.q
+++ b/ql/src/test/queries/clientnegative/authorization_priv_current_role_neg.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set user.name=hive_admin_user;
diff --git a/ql/src/test/queries/clientnegative/authorization_revoke_table_fail1.q b/ql/src/test/queries/clientnegative/authorization_revoke_table_fail1.q
index e19bf370fa..dc1f451512 100644
--- a/ql/src/test/queries/clientnegative/authorization_revoke_table_fail1.q
+++ b/ql/src/test/queries/clientnegative/authorization_revoke_table_fail1.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 
diff --git a/ql/src/test/queries/clientnegative/authorization_revoke_table_fail2.q b/ql/src/test/queries/clientnegative/authorization_revoke_table_fail2.q
index 4b0cf3286a..f10be40944 100644
--- a/ql/src/test/queries/clientnegative/authorization_revoke_table_fail2.q
+++ b/ql/src/test/queries/clientnegative/authorization_revoke_table_fail2.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 
diff --git a/ql/src/test/queries/clientnegative/authorization_role_cycles1.q b/ql/src/test/queries/clientnegative/authorization_role_cycles1.q
index fa3fc193ab..739fe00040 100644
--- a/ql/src/test/queries/clientnegative/authorization_role_cycles1.q
+++ b/ql/src/test/queries/clientnegative/authorization_role_cycles1.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set user.name=hive_admin_user;
diff --git a/ql/src/test/queries/clientnegative/authorization_role_cycles2.q b/ql/src/test/queries/clientnegative/authorization_role_cycles2.q
index 069a663c27..ebca827640 100644
--- a/ql/src/test/queries/clientnegative/authorization_role_cycles2.q
+++ b/ql/src/test/queries/clientnegative/authorization_role_cycles2.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 
diff --git a/ql/src/test/queries/clientnegative/authorization_role_grant.q b/ql/src/test/queries/clientnegative/authorization_role_grant.q
index 3f1a7b841e..d0e17050da 100644
--- a/ql/src/test/queries/clientnegative/authorization_role_grant.q
+++ b/ql/src/test/queries/clientnegative/authorization_role_grant.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set user.name=hive_admin_user;
diff --git a/ql/src/test/queries/clientnegative/authorization_role_grant2.q b/ql/src/test/queries/clientnegative/authorization_role_grant2.q
index 7d439cbcf6..f19b912369 100644
--- a/ql/src/test/queries/clientnegative/authorization_role_grant2.q
+++ b/ql/src/test/queries/clientnegative/authorization_role_grant2.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set user.name=hive_admin_user;
diff --git a/ql/src/test/queries/clientnegative/authorization_role_grant_nosuchrole.q b/ql/src/test/queries/clientnegative/authorization_role_grant_nosuchrole.q
index 51ca345681..ed6f972c49 100644
--- a/ql/src/test/queries/clientnegative/authorization_role_grant_nosuchrole.q
+++ b/ql/src/test/queries/clientnegative/authorization_role_grant_nosuchrole.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set user.name=hive_admin_user;
diff --git a/ql/src/test/queries/clientnegative/authorization_role_grant_otherrole.q b/ql/src/test/queries/clientnegative/authorization_role_grant_otherrole.q
index 9440c45365..233cd17255 100644
--- a/ql/src/test/queries/clientnegative/authorization_role_grant_otherrole.q
+++ b/ql/src/test/queries/clientnegative/authorization_role_grant_otherrole.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 
diff --git a/ql/src/test/queries/clientnegative/authorization_role_grant_otheruser.q b/ql/src/test/queries/clientnegative/authorization_role_grant_otheruser.q
index 1db28060f1..c7900fea07 100644
--- a/ql/src/test/queries/clientnegative/authorization_role_grant_otheruser.q
+++ b/ql/src/test/queries/clientnegative/authorization_role_grant_otheruser.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 
diff --git a/ql/src/test/queries/clientnegative/authorization_rolehierarchy_privs.q b/ql/src/test/queries/clientnegative/authorization_rolehierarchy_privs.q
index 8bb776ebe5..ede7dfd12c 100644
--- a/ql/src/test/queries/clientnegative/authorization_rolehierarchy_privs.q
+++ b/ql/src/test/queries/clientnegative/authorization_rolehierarchy_privs.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_select.q b/ql/src/test/queries/clientnegative/authorization_select.q
index 39871793af..d4cc148cd0 100644
--- a/ql/src/test/queries/clientnegative/authorization_select.q
+++ b/ql/src/test/queries/clientnegative/authorization_select.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_select_view.q b/ql/src/test/queries/clientnegative/authorization_select_view.q
index a4071cd0d4..365f239f83 100644
--- a/ql/src/test/queries/clientnegative/authorization_select_view.q
+++ b/ql/src/test/queries/clientnegative/authorization_select_view.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_set_role_neg1.q b/ql/src/test/queries/clientnegative/authorization_set_role_neg1.q
index 9ba3a82a56..8afe68db9b 100644
--- a/ql/src/test/queries/clientnegative/authorization_set_role_neg1.q
+++ b/ql/src/test/queries/clientnegative/authorization_set_role_neg1.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 
 -- an error should be thrown if 'set role ' is done for role that does not exist
diff --git a/ql/src/test/queries/clientnegative/authorization_set_role_neg2.q b/ql/src/test/queries/clientnegative/authorization_set_role_neg2.q
index a810f1a1c7..c1cb2537d3 100644
--- a/ql/src/test/queries/clientnegative/authorization_set_role_neg2.q
+++ b/ql/src/test/queries/clientnegative/authorization_set_role_neg2.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set user.name=hive_admin_user;
diff --git a/ql/src/test/queries/clientnegative/authorization_show_grant_otherrole.q b/ql/src/test/queries/clientnegative/authorization_show_grant_otherrole.q
index e131766d8a..e689c60c62 100644
--- a/ql/src/test/queries/clientnegative/authorization_show_grant_otherrole.q
+++ b/ql/src/test/queries/clientnegative/authorization_show_grant_otherrole.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_show_grant_otheruser_all.q b/ql/src/test/queries/clientnegative/authorization_show_grant_otheruser_all.q
index 4ef501d341..8b55f8d8c1 100644
--- a/ql/src/test/queries/clientnegative/authorization_show_grant_otheruser_all.q
+++ b/ql/src/test/queries/clientnegative/authorization_show_grant_otheruser_all.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_show_grant_otheruser_alltabs.q b/ql/src/test/queries/clientnegative/authorization_show_grant_otheruser_alltabs.q
index 8cfc790a61..912842e960 100644
--- a/ql/src/test/queries/clientnegative/authorization_show_grant_otheruser_alltabs.q
+++ b/ql/src/test/queries/clientnegative/authorization_show_grant_otheruser_alltabs.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_show_grant_otheruser_wtab.q b/ql/src/test/queries/clientnegative/authorization_show_grant_otheruser_wtab.q
index 4c3892cd74..3558c4d881 100644
--- a/ql/src/test/queries/clientnegative/authorization_show_grant_otheruser_wtab.q
+++ b/ql/src/test/queries/clientnegative/authorization_show_grant_otheruser_wtab.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_show_parts_nosel.q b/ql/src/test/queries/clientnegative/authorization_show_parts_nosel.q
index d8190de950..e63dfd87f0 100644
--- a/ql/src/test/queries/clientnegative/authorization_show_parts_nosel.q
+++ b/ql/src/test/queries/clientnegative/authorization_show_parts_nosel.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_show_role_principals_no_admin.q b/ql/src/test/queries/clientnegative/authorization_show_role_principals_no_admin.q
index 2afe87fc30..08c997cf86 100644
--- a/ql/src/test/queries/clientnegative/authorization_show_role_principals_no_admin.q
+++ b/ql/src/test/queries/clientnegative/authorization_show_role_principals_no_admin.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 -- This test will fail because hive_test_user is not in admin role
 show principals role1; 
diff --git a/ql/src/test/queries/clientnegative/authorization_show_roles_no_admin.q b/ql/src/test/queries/clientnegative/authorization_show_roles_no_admin.q
index 0fc9fca940..26277c147d 100644
--- a/ql/src/test/queries/clientnegative/authorization_show_roles_no_admin.q
+++ b/ql/src/test/queries/clientnegative/authorization_show_roles_no_admin.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 -- This test will fail because hive_test_user is not in admin role
 show roles; 
diff --git a/ql/src/test/queries/clientnegative/authorization_table_grant_nosuchrole.q b/ql/src/test/queries/clientnegative/authorization_table_grant_nosuchrole.q
index 20650933a4..54d085a7f8 100644
--- a/ql/src/test/queries/clientnegative/authorization_table_grant_nosuchrole.q
+++ b/ql/src/test/queries/clientnegative/authorization_table_grant_nosuchrole.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 
diff --git a/ql/src/test/queries/clientnegative/authorization_truncate.q b/ql/src/test/queries/clientnegative/authorization_truncate.q
index 285600b23a..da96c61781 100644
--- a/ql/src/test/queries/clientnegative/authorization_truncate.q
+++ b/ql/src/test/queries/clientnegative/authorization_truncate.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_uri_add_partition.q b/ql/src/test/queries/clientnegative/authorization_uri_add_partition.q
index d82ac710cc..5b2e4868d6 100644
--- a/ql/src/test/queries/clientnegative/authorization_uri_add_partition.q
+++ b/ql/src/test/queries/clientnegative/authorization_uri_add_partition.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_uri_alterpart_loc.q b/ql/src/test/queries/clientnegative/authorization_uri_alterpart_loc.q
index d38ba74d90..b7ad814d6a 100644
--- a/ql/src/test/queries/clientnegative/authorization_uri_alterpart_loc.q
+++ b/ql/src/test/queries/clientnegative/authorization_uri_alterpart_loc.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_uri_altertab_setloc.q b/ql/src/test/queries/clientnegative/authorization_uri_altertab_setloc.q
index c446b8636f..653b7bb4a9 100644
--- a/ql/src/test/queries/clientnegative/authorization_uri_altertab_setloc.q
+++ b/ql/src/test/queries/clientnegative/authorization_uri_altertab_setloc.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_uri_create_table1.q b/ql/src/test/queries/clientnegative/authorization_uri_create_table1.q
index c8e1fb43ee..fb50a7dac0 100644
--- a/ql/src/test/queries/clientnegative/authorization_uri_create_table1.q
+++ b/ql/src/test/queries/clientnegative/authorization_uri_create_table1.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_uri_create_table_ext.q b/ql/src/test/queries/clientnegative/authorization_uri_create_table_ext.q
index c8549b4563..82b59169b8 100644
--- a/ql/src/test/queries/clientnegative/authorization_uri_create_table_ext.q
+++ b/ql/src/test/queries/clientnegative/authorization_uri_create_table_ext.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_uri_createdb.q b/ql/src/test/queries/clientnegative/authorization_uri_createdb.q
index edfdf5a8fc..1a257c0576 100644
--- a/ql/src/test/queries/clientnegative/authorization_uri_createdb.q
+++ b/ql/src/test/queries/clientnegative/authorization_uri_createdb.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_uri_index.q b/ql/src/test/queries/clientnegative/authorization_uri_index.q
index 1a8f9cb2ad..795928d0a9 100644
--- a/ql/src/test/queries/clientnegative/authorization_uri_index.q
+++ b/ql/src/test/queries/clientnegative/authorization_uri_index.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_uri_insert.q b/ql/src/test/queries/clientnegative/authorization_uri_insert.q
index 81b6e522c1..39bb4b60d9 100644
--- a/ql/src/test/queries/clientnegative/authorization_uri_insert.q
+++ b/ql/src/test/queries/clientnegative/authorization_uri_insert.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_uri_insert_local.q b/ql/src/test/queries/clientnegative/authorization_uri_insert_local.q
index 0a2fd8919f..4ad350cfe8 100644
--- a/ql/src/test/queries/clientnegative/authorization_uri_insert_local.q
+++ b/ql/src/test/queries/clientnegative/authorization_uri_insert_local.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorization_uri_load_data.q b/ql/src/test/queries/clientnegative/authorization_uri_load_data.q
index 6af41f0cda..a409e180c6 100644
--- a/ql/src/test/queries/clientnegative/authorization_uri_load_data.q
+++ b/ql/src/test/queries/clientnegative/authorization_uri_load_data.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientnegative/authorize_create_tbl.q b/ql/src/test/queries/clientnegative/authorize_create_tbl.q
index d8beac370d..f0f398fdb9 100644
--- a/ql/src/test/queries/clientnegative/authorize_create_tbl.q
+++ b/ql/src/test/queries/clientnegative/authorize_create_tbl.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 
diff --git a/ql/src/test/queries/clientnegative/temp_table_authorize_create_tbl.q b/ql/src/test/queries/clientnegative/temp_table_authorize_create_tbl.q
index bb75777d84..69bcc43a2d 100644
--- a/ql/src/test/queries/clientnegative/temp_table_authorize_create_tbl.q
+++ b/ql/src/test/queries/clientnegative/temp_table_authorize_create_tbl.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 
diff --git a/ql/src/test/queries/clientpositive/authorization_1_sql_std.q b/ql/src/test/queries/clientpositive/authorization_1_sql_std.q
index 34a9b68b2b..82896a4f0e 100644
--- a/ql/src/test/queries/clientpositive/authorization_1_sql_std.q
+++ b/ql/src/test/queries/clientpositive/authorization_1_sql_std.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set user.name=hive_admin_user;
diff --git a/ql/src/test/queries/clientpositive/authorization_admin_almighty1.q b/ql/src/test/queries/clientpositive/authorization_admin_almighty1.q
index 380f5067fe..3ae0ce118b 100644
--- a/ql/src/test/queries/clientpositive/authorization_admin_almighty1.q
+++ b/ql/src/test/queries/clientpositive/authorization_admin_almighty1.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set user.name=hive_test_user;
diff --git a/ql/src/test/queries/clientpositive/authorization_admin_almighty2.q b/ql/src/test/queries/clientpositive/authorization_admin_almighty2.q
index ba43e4059e..c666e97d85 100644
--- a/ql/src/test/queries/clientpositive/authorization_admin_almighty2.q
+++ b/ql/src/test/queries/clientpositive/authorization_admin_almighty2.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactory;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set user.name=hive_admin_user;
diff --git a/ql/src/test/queries/clientpositive/authorization_cli_createtab.q b/ql/src/test/queries/clientpositive/authorization_cli_createtab.q
new file mode 100644
index 0000000000..25fc80ae4a
--- /dev/null
+++ b/ql/src/test/queries/clientpositive/authorization_cli_createtab.q
@@ -0,0 +1,14 @@
+set hive.test.authz.sstd.hs2.mode=true;
+set hive.users.in.admin.role=hive_admin_user;
+set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
+set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
+set user.name=hive_test_user;
+
+-- verify that sql std auth can be set as the authorizer with hive cli
+-- and that the create table/view result in correct permissions (suitable for sql std auth mode)
+
+create table t_cli(i int);
+show grant user hive_test_user on t_cli;
+
+create view v_cli (i) as select i from t_cli;
+show grant user hive_test_user on v_cli;
diff --git a/ql/src/test/queries/clientpositive/authorization_create_func1.q b/ql/src/test/queries/clientpositive/authorization_create_func1.q
index 1f48deb8cc..6c7ebc7d5a 100644
--- a/ql/src/test/queries/clientpositive/authorization_create_func1.q
+++ b/ql/src/test/queries/clientpositive/authorization_create_func1.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientpositive/authorization_create_macro1.q b/ql/src/test/queries/clientpositive/authorization_create_macro1.q
index 741fa92b39..e0297d294c 100644
--- a/ql/src/test/queries/clientpositive/authorization_create_macro1.q
+++ b/ql/src/test/queries/clientpositive/authorization_create_macro1.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientpositive/authorization_create_table_owner_privs.q b/ql/src/test/queries/clientpositive/authorization_create_table_owner_privs.q
index 17f4861cd2..9897657299 100644
--- a/ql/src/test/queries/clientpositive/authorization_create_table_owner_privs.q
+++ b/ql/src/test/queries/clientpositive/authorization_create_table_owner_privs.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 
diff --git a/ql/src/test/queries/clientpositive/authorization_create_temp_table.q b/ql/src/test/queries/clientpositive/authorization_create_temp_table.q
index d49dbb4265..52b9ca7180 100644
--- a/ql/src/test/queries/clientpositive/authorization_create_temp_table.q
+++ b/ql/src/test/queries/clientpositive/authorization_create_temp_table.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 
diff --git a/ql/src/test/queries/clientpositive/authorization_grant_public_role.q b/ql/src/test/queries/clientpositive/authorization_grant_public_role.q
index 9da33dcfbe..fe177ac621 100644
--- a/ql/src/test/queries/clientpositive/authorization_grant_public_role.q
+++ b/ql/src/test/queries/clientpositive/authorization_grant_public_role.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 
diff --git a/ql/src/test/queries/clientpositive/authorization_grant_table_priv.q b/ql/src/test/queries/clientpositive/authorization_grant_table_priv.q
index 9c7a999adc..f0eac73487 100644
--- a/ql/src/test/queries/clientpositive/authorization_grant_table_priv.q
+++ b/ql/src/test/queries/clientpositive/authorization_grant_table_priv.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 
diff --git a/ql/src/test/queries/clientpositive/authorization_index.q b/ql/src/test/queries/clientpositive/authorization_index.q
index 1f177ffd1f..b8dd57734a 100644
--- a/ql/src/test/queries/clientpositive/authorization_index.q
+++ b/ql/src/test/queries/clientpositive/authorization_index.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.stats.dbclass=fs;
diff --git a/ql/src/test/queries/clientpositive/authorization_insert.q b/ql/src/test/queries/clientpositive/authorization_insert.q
index c1e4c1f52d..d589405186 100644
--- a/ql/src/test/queries/clientpositive/authorization_insert.q
+++ b/ql/src/test/queries/clientpositive/authorization_insert.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 
diff --git a/ql/src/test/queries/clientpositive/authorization_owner_actions.q b/ql/src/test/queries/clientpositive/authorization_owner_actions.q
index 85d8b1114b..d186a4434a 100644
--- a/ql/src/test/queries/clientpositive/authorization_owner_actions.q
+++ b/ql/src/test/queries/clientpositive/authorization_owner_actions.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientpositive/authorization_owner_actions_db.q b/ql/src/test/queries/clientpositive/authorization_owner_actions_db.q
index 14a8d7cc9f..ccd4605a0c 100644
--- a/ql/src/test/queries/clientpositive/authorization_owner_actions_db.q
+++ b/ql/src/test/queries/clientpositive/authorization_owner_actions_db.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientpositive/authorization_parts.q b/ql/src/test/queries/clientpositive/authorization_parts.q
index bee091b1d3..141cdeaee5 100644
--- a/ql/src/test/queries/clientpositive/authorization_parts.q
+++ b/ql/src/test/queries/clientpositive/authorization_parts.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientpositive/authorization_reset.q b/ql/src/test/queries/clientpositive/authorization_reset.q
index aa2c1fb311..047474ebbf 100644
--- a/ql/src/test/queries/clientpositive/authorization_reset.q
+++ b/ql/src/test/queries/clientpositive/authorization_reset.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientpositive/authorization_revoke_table_priv.q b/ql/src/test/queries/clientpositive/authorization_revoke_table_priv.q
index 1cd445bea1..1e3e6cf42e 100644
--- a/ql/src/test/queries/clientpositive/authorization_revoke_table_priv.q
+++ b/ql/src/test/queries/clientpositive/authorization_revoke_table_priv.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 
diff --git a/ql/src/test/queries/clientpositive/authorization_role_grant1.q b/ql/src/test/queries/clientpositive/authorization_role_grant1.q
index 1e8a6aff52..f0b8d9ce45 100644
--- a/ql/src/test/queries/clientpositive/authorization_role_grant1.q
+++ b/ql/src/test/queries/clientpositive/authorization_role_grant1.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set user.name=hive_admin_user;
diff --git a/ql/src/test/queries/clientpositive/authorization_role_grant2.q b/ql/src/test/queries/clientpositive/authorization_role_grant2.q
index d87d96fccf..95fa4e6783 100644
--- a/ql/src/test/queries/clientpositive/authorization_role_grant2.q
+++ b/ql/src/test/queries/clientpositive/authorization_role_grant2.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 
diff --git a/ql/src/test/queries/clientpositive/authorization_set_show_current_role.q b/ql/src/test/queries/clientpositive/authorization_set_show_current_role.q
index 413237095e..f10b6490ac 100644
--- a/ql/src/test/queries/clientpositive/authorization_set_show_current_role.q
+++ b/ql/src/test/queries/clientpositive/authorization_set_show_current_role.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set user.name=hive_admin_user;
diff --git a/ql/src/test/queries/clientpositive/authorization_show_grant.q b/ql/src/test/queries/clientpositive/authorization_show_grant.q
index bad1f07ee7..0f17439eef 100644
--- a/ql/src/test/queries/clientpositive/authorization_show_grant.q
+++ b/ql/src/test/queries/clientpositive/authorization_show_grant.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/queries/clientpositive/authorization_view_sqlstd.q b/ql/src/test/queries/clientpositive/authorization_view_sqlstd.q
index 91acd39dca..85d3ca3a93 100644
--- a/ql/src/test/queries/clientpositive/authorization_view_sqlstd.q
+++ b/ql/src/test/queries/clientpositive/authorization_view_sqlstd.q
@@ -1,3 +1,4 @@
+set hive.test.authz.sstd.hs2.mode=true;
 set hive.security.authorization.manager=org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactoryForTest;
 set hive.security.authenticator.manager=org.apache.hadoop.hive.ql.security.SessionStateConfigUserAuthenticator;
 set hive.security.authorization.enabled=true;
diff --git a/ql/src/test/results/clientnegative/authorization_cli_auth_enable.q.out b/ql/src/test/results/clientnegative/authorization_cli_auth_enable.q.out
new file mode 100644
index 0000000000..252eb667a5
--- /dev/null
+++ b/ql/src/test/results/clientnegative/authorization_cli_auth_enable.q.out
@@ -0,0 +1 @@
+FAILED: RuntimeException org.apache.hadoop.hive.ql.security.authorization.plugin.HiveAuthzPluginException: SQL standards based authorization should not be enabled from hive cliInstead the use of storage based authorization in hive metastore is reccomended. Set hive.security.authorization.enabled=false to disable authz within cli
diff --git a/ql/src/test/results/clientpositive/authorization_cli_createtab.q.out b/ql/src/test/results/clientpositive/authorization_cli_createtab.q.out
new file mode 100644
index 0000000000..79a0a9541d
--- /dev/null
+++ b/ql/src/test/results/clientpositive/authorization_cli_createtab.q.out
@@ -0,0 +1,37 @@
+PREHOOK: query: -- verify that sql std auth can be set as the authorizer with hive cli
+-- and that the create table/view result in correct permissions (suitable for sql std auth mode)
+
+create table t_cli(i int)
+PREHOOK: type: CREATETABLE
+PREHOOK: Output: database:default
+PREHOOK: Output: default@t_cli
+POSTHOOK: query: -- verify that sql std auth can be set as the authorizer with hive cli
+-- and that the create table/view result in correct permissions (suitable for sql std auth mode)
+
+create table t_cli(i int)
+POSTHOOK: type: CREATETABLE
+POSTHOOK: Output: database:default
+POSTHOOK: Output: default@t_cli
+PREHOOK: query: show grant user hive_test_user on t_cli
+PREHOOK: type: SHOW_GRANT
+POSTHOOK: query: show grant user hive_test_user on t_cli
+POSTHOOK: type: SHOW_GRANT
+default	t_cli			hive_test_user	USER	DELETE	true	-1	hive_test_user
+default	t_cli			hive_test_user	USER	INSERT	true	-1	hive_test_user
+default	t_cli			hive_test_user	USER	SELECT	true	-1	hive_test_user
+default	t_cli			hive_test_user	USER	UPDATE	true	-1	hive_test_user
+PREHOOK: query: create view v_cli (i) as select i from t_cli
+PREHOOK: type: CREATEVIEW
+PREHOOK: Input: default@t_cli
+POSTHOOK: query: create view v_cli (i) as select i from t_cli
+POSTHOOK: type: CREATEVIEW
+POSTHOOK: Input: default@t_cli
+POSTHOOK: Output: default@v_cli
+PREHOOK: query: show grant user hive_test_user on v_cli
+PREHOOK: type: SHOW_GRANT
+POSTHOOK: query: show grant user hive_test_user on v_cli
+POSTHOOK: type: SHOW_GRANT
+default	v_cli			hive_test_user	USER	DELETE	true	-1	hive_test_user
+default	v_cli			hive_test_user	USER	INSERT	true	-1	hive_test_user
+default	v_cli			hive_test_user	USER	SELECT	true	-1	hive_test_user
+default	v_cli			hive_test_user	USER	UPDATE	true	-1	hive_test_user
