diff --git a/CHANGES.txt b/CHANGES.txt
index 6c99319998..c900bcf3c2 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -46,6 +46,9 @@ Trunk - unreleased changes
     HIVE-414. Add Hive Web Interface code to Eclipse config
     (Prasad Chakka)
 
+    HIVE-372. Fix UDF memory consumptions and bad error messages.
+    (Zheng Shao via namit)
+
 Release 0.3.0 - Unreleased
 
   INCOMPATIBLE CHANGES
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g b/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g
index a894763745..238956c715 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g
+++ b/ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g
@@ -5,7 +5,7 @@ options
 output=AST;
 ASTLabelType=CommonTree;
 backtrack=true;
-k=1;
+k=3;
 }
  
 tokens {
diff --git a/ql/src/test/queries/clientpositive/udf_10_trims.q b/ql/src/test/queries/clientpositive/udf_10_trims.q
new file mode 100644
index 0000000000..8a7e3a5207
--- /dev/null
+++ b/ql/src/test/queries/clientpositive/udf_10_trims.q
@@ -0,0 +1,12 @@
+CREATE TABLE dest1(c1 STRING) STORED AS TEXTFILE;
+
+EXPLAIN
+INSERT OVERWRITE TABLE dest1
+SELECT trim(trim(trim(trim(trim(trim(trim(trim(trim(trim( '  abc  '))))))))))
+FROM src
+WHERE src.key = 86;
+
+INSERT OVERWRITE TABLE dest1
+SELECT trim(trim(trim(trim(trim(trim(trim(trim(trim(trim( '  abc  '))))))))))
+FROM src
+WHERE src.key = 86;
diff --git a/ql/src/test/queries/negative/invalid_create_table.q b/ql/src/test/queries/negative/invalid_create_table.q
new file mode 100644
index 0000000000..899bbd368b
--- /dev/null
+++ b/ql/src/test/queries/negative/invalid_create_table.q
@@ -0,0 +1,4 @@
+CREATE TABLE mytable (
+  a INT
+  b STRING
+);
diff --git a/ql/src/test/queries/negative/invalid_select.q b/ql/src/test/queries/negative/invalid_select.q
new file mode 100644
index 0000000000..fd1298577b
--- /dev/null
+++ b/ql/src/test/queries/negative/invalid_select.q
@@ -0,0 +1,4 @@
+SELECT
+  trim(trim(a))
+  trim(b)
+FROM src;
diff --git a/ql/src/test/results/clientnegative/invalid_create_tbl2.q.out b/ql/src/test/results/clientnegative/invalid_create_tbl2.q.out
index b133478537..595bf67a45 100644
--- a/ql/src/test/results/clientnegative/invalid_create_tbl2.q.out
+++ b/ql/src/test/results/clientnegative/invalid_create_tbl2.q.out
@@ -1,2 +1,2 @@
-FAILED: Parse Error: line 1:7 mismatched input 'tabl' expecting TEMPORARY in create function statement
+FAILED: Parse Error: line 1:0 cannot recognize input 'create' in ddl statement
 
diff --git a/ql/src/test/results/clientnegative/invalid_select_expression.q.out b/ql/src/test/results/clientnegative/invalid_select_expression.q.out
index 8676185831..69ec9ef1f8 100644
--- a/ql/src/test/results/clientnegative/invalid_select_expression.q.out
+++ b/ql/src/test/results/clientnegative/invalid_select_expression.q.out
@@ -1,2 +1,2 @@
-FAILED: Parse Error: line 1:32 cannot recognize input '.' in table column identifier
+FAILED: Parse Error: line 1:32 cannot recognize input '.' in expression specification
 
diff --git a/ql/src/test/results/clientnegative/invalid_tbl_name.q.out b/ql/src/test/results/clientnegative/invalid_tbl_name.q.out
index 113c26c6b7..ae9dafc39d 100644
--- a/ql/src/test/results/clientnegative/invalid_tbl_name.q.out
+++ b/ql/src/test/results/clientnegative/invalid_tbl_name.q.out
@@ -1,2 +1,2 @@
-FAILED: Parse Error: line 1:20 mismatched input '-' expecting EOF in statement
+FAILED: Parse Error: line 1:20 mismatched input '-' expecting EOF
 
diff --git a/ql/src/test/results/clientpositive/udf_10_trims.q.out b/ql/src/test/results/clientpositive/udf_10_trims.q.out
new file mode 100644
index 0000000000..5ee8587c15
--- /dev/null
+++ b/ql/src/test/results/clientpositive/udf_10_trims.q.out
@@ -0,0 +1,44 @@
+ABSTRACT SYNTAX TREE:
+  (TOK_QUERY (TOK_FROM (TOK_TABREF src)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB dest1)) (TOK_SELECT (TOK_SELEXPR (TOK_FUNCTION trim (TOK_FUNCTION trim (TOK_FUNCTION trim (TOK_FUNCTION trim (TOK_FUNCTION trim (TOK_FUNCTION trim (TOK_FUNCTION trim (TOK_FUNCTION trim (TOK_FUNCTION trim (TOK_FUNCTION trim '  abc  ')))))))))))) (TOK_WHERE (= (TOK_COLREF src key) 86))))
+
+STAGE DEPENDENCIES:
+  Stage-1 is a root stage
+  Stage-0 depends on stages: Stage-1
+
+STAGE PLANS:
+  Stage: Stage-1
+    Map Reduce
+      Alias -> Map Operator Tree:
+        src 
+            Select Operator
+              expressions:
+                    expr: key
+                    type: string
+              Filter Operator
+                predicate:
+                    expr: (UDFToDouble(0) = UDFToDouble(86))
+                    type: boolean
+                Select Operator
+                  expressions:
+                        expr: trim(trim(trim(trim(trim(trim(trim(trim(trim(trim('  abc  '))))))))))
+                        type: string
+                  File Output Operator
+                    compressed: false
+                    GlobalTableId: 1
+                    table:
+                        input format: org.apache.hadoop.mapred.TextInputFormat
+                        output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                        serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                        name: dest1
+
+  Stage: Stage-0
+    Move Operator
+      tables:
+            replace: true
+            table:
+                input format: org.apache.hadoop.mapred.TextInputFormat
+                output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
+                serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
+                name: dest1
+
+
diff --git a/ql/src/test/results/compiler/errors/invalid_create_table.q.out b/ql/src/test/results/compiler/errors/invalid_create_table.q.out
new file mode 100644
index 0000000000..f679c53647
--- /dev/null
+++ b/ql/src/test/results/compiler/errors/invalid_create_table.q.out
@@ -0,0 +1 @@
+Parse Error: line 3:2 mismatched input 'b' expecting ) in create statement
diff --git a/ql/src/test/results/compiler/errors/invalid_select.q.out b/ql/src/test/results/compiler/errors/invalid_select.q.out
new file mode 100644
index 0000000000..f6024a7e41
--- /dev/null
+++ b/ql/src/test/results/compiler/errors/invalid_select.q.out
@@ -0,0 +1 @@
+Parse Error: line 3:2 cannot recognize input 'trim' in from clause
diff --git a/ql/src/test/results/compiler/errors/wrong_distinct2.q.out b/ql/src/test/results/compiler/errors/wrong_distinct2.q.out
index 57233db4b6..9155bca893 100644
--- a/ql/src/test/results/compiler/errors/wrong_distinct2.q.out
+++ b/ql/src/test/results/compiler/errors/wrong_distinct2.q.out
@@ -1 +1 @@
-Parse Error: line 2:29 cannot recognize input 'SELECT' in select expression
+Parse Error: line 2:45 cannot recognize input 'DISTINCT' in select expression
