diff --git a/ql/src/java/org/apache/hadoop/hive/ql/processors/SetProcessor.java b/ql/src/java/org/apache/hadoop/hive/ql/processors/SetProcessor.java
index bc9254c1fe..d271d6d3ef 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/processors/SetProcessor.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/processors/SetProcessor.java
@@ -134,6 +134,9 @@ public static int setVariable(String varname, String varvalue) throws Exception
       hive.setMetaConf(propName, new VariableSubstitution().substitute(ss.getConf(), varvalue));
     } else {
       setConf(varname, varname, varvalue, true);
+      if (varname.equals(HiveConf.ConfVars.HIVE_SESSION_HISTORY_ENABLED.toString())) {
+        SessionState.get().updateHistory(Boolean.parseBoolean(varvalue), ss);
+      }
     }
     return 0;
   }
diff --git a/ql/src/java/org/apache/hadoop/hive/ql/session/SessionState.java b/ql/src/java/org/apache/hadoop/hive/ql/session/SessionState.java
index 7930298bf7..5067f06068 100644
--- a/ql/src/java/org/apache/hadoop/hive/ql/session/SessionState.java
+++ b/ql/src/java/org/apache/hadoop/hive/ql/session/SessionState.java
@@ -854,6 +854,25 @@ public HiveHistory getHiveHistory() {
     return hiveHist;
   }
 
+  /**
+   * Update the history if set hive.session.history.enabled
+   *
+   * @param historyEnabled
+   * @param ss
+   */
+  public void updateHistory(boolean historyEnabled, SessionState ss) {
+    if (historyEnabled) {
+      // Uses a no-op proxy
+      if (ss.hiveHist.getHistFileName() == null) {
+        ss.hiveHist = new HiveHistoryImpl(ss);
+      }
+    } else {
+      if (ss.hiveHist.getHistFileName() != null) {
+        ss.hiveHist = HiveHistoryProxyHandler.getNoOpHiveHistoryProxy();
+      }
+    }
+  }
+
   /**
    * Create a session ID. Looks like:
    *   $user_$pid@$host_$date
