diff --git a/CHANGES.txt b/CHANGES.txt
index ece2397326..9578e8e046 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -36,6 +36,9 @@ Trunk (unreleased changes)
 
   BUG FIXES
 
+    HIVE-47. CLI to support multiline queries from an input file.
+    (Ashish through zshao)
+
     HIVE-103. Disable inserts in sub queries. (Namit Jain through zshao)
 
     HIVE-92. Fixed union all for non-embedded query. (Namit Jain through zshao)
diff --git a/cli/src/java/org/apache/hadoop/hive/cli/CliDriver.java b/cli/src/java/org/apache/hadoop/hive/cli/CliDriver.java
index a61afedb9a..037131d1e3 100644
--- a/cli/src/java/org/apache/hadoop/hive/cli/CliDriver.java
+++ b/cli/src/java/org/apache/hadoop/hive/cli/CliDriver.java
@@ -56,25 +56,26 @@ public CliDriver() {
   
   public int processCmd(String cmd) {
     SessionState ss = SessionState.get();
-
-    String[] tokens = cmd.split("\\s+");
-    String cmd_1 = cmd.substring(tokens[0].length());
+    
+    String cmd_trimmed = cmd.trim();
+    String[] tokens = cmd_trimmed.split("\\s+");
+    String cmd_1 = cmd_trimmed.substring(tokens[0].length());
     int ret = 0;
     
     if(tokens[0].toLowerCase().equals("set")) {
 
       ret = sp.run(cmd_1);
 
-    } else if (cmd.toLowerCase().equals("quit") || cmd.toLowerCase().equals("exit")) {
+    } else if (cmd_trimmed.toLowerCase().equals("quit") || cmd_trimmed.toLowerCase().equals("exit")) {
 
       // if we have come this far - either the previous commands
       // are all successful or this is command line. in either case
       // this counts as a successful run
       System.exit(0);
 
-    } else if (cmd.startsWith("!")) {
+    } else if (cmd_trimmed.startsWith("!")) {
 
-      String shell_cmd = cmd.substring(1);
+      String shell_cmd = cmd_trimmed.substring(1);
 
       //shell_cmd = "/bin/bash -c \'" + shell_cmd + "\'";
       try {
@@ -165,7 +166,7 @@ public int processCmd(String cmd) {
         ss.delete_resource(t);
       }
 
-    } else {
+    } else if (!cmd_trimmed.equals("")) {
       PrintStream out = ss.out;
 
       long start = System.currentTimeMillis();
@@ -197,7 +198,6 @@ public int processCmd(String cmd) {
   public int processLine(String line) {
     int ret = 0;
     for(String oneCmd: line.split(";")) {
-      oneCmd = oneCmd.trim();
       if(oneCmd.equals(""))
         continue;
       
@@ -212,13 +212,18 @@ public int processLine(String line) {
 
   public int processReader(BufferedReader r) throws IOException {
     String line;
+    StringBuffer qsb = new StringBuffer();
     int ret = 0;
+
     while((line = r.readLine()) != null) {
-      ret = processLine(line);
-      if(ret != 0) {
-        return ret;
-      }
+      qsb.append(line + "\n");
+    }
+
+    ret = processLine(qsb.toString());
+    if (ret != 0) {
+      return ret;
     }
+
     return 0;
   }
 
diff --git a/ql/src/test/results/clientnegative/clusterbydistributeby.q.out b/ql/src/test/results/clientnegative/clusterbydistributeby.q.out
index c27aec2929..5351ba1db6 100644
--- a/ql/src/test/results/clientnegative/clusterbydistributeby.q.out
+++ b/ql/src/test/results/clientnegative/clusterbydistributeby.q.out
@@ -1 +1 @@
-FAILED: Error in semantic analysis: line 6:14 Cannot have both Cluster By and Distribute By Clauses tkey
+FAILED: Error in semantic analysis: line 8:14 Cannot have both Cluster By and Distribute By Clauses tkey
diff --git a/ql/src/test/results/clientnegative/clusterbysortby.q.out b/ql/src/test/results/clientnegative/clusterbysortby.q.out
index 331739ed88..df001b7cda 100644
--- a/ql/src/test/results/clientnegative/clusterbysortby.q.out
+++ b/ql/src/test/results/clientnegative/clusterbysortby.q.out
@@ -1 +1 @@
-FAILED: Error in semantic analysis: line 6:8 Cannot have both Cluster By and Sort By Clauses one
+FAILED: Error in semantic analysis: line 8:8 Cannot have both Cluster By and Sort By Clauses one
diff --git a/ql/src/test/results/clientnegative/notable_alias3.q.out b/ql/src/test/results/clientnegative/notable_alias3.q.out
index 2aba66c6b4..8aa7ca1858 100644
--- a/ql/src/test/results/clientnegative/notable_alias3.q.out
+++ b/ql/src/test/results/clientnegative/notable_alias3.q.out
@@ -1 +1 @@
-FAILED: Error in semantic analysis: line 2:44 Expression Not In Group By Key key
+FAILED: Error in semantic analysis: line 4:44 Expression Not In Group By Key key
diff --git a/ql/src/test/results/clientnegative/strict_pruning.q.out b/ql/src/test/results/clientnegative/strict_pruning.q.out
index ab6898c48a..29794278cc 100644
--- a/ql/src/test/results/clientnegative/strict_pruning.q.out
+++ b/ql/src/test/results/clientnegative/strict_pruning.q.out
@@ -1 +1 @@
-FAILED: Error in semantic analysis: line 2:7 No Partition Predicate Found 1:  for Alias srcpart Table srcpart
+FAILED: Error in semantic analysis: line 4:7 No Partition Predicate Found 1:  for Alias srcpart Table srcpart
