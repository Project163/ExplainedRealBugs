diff --git a/ql/src/test/queries/clientpositive/recursive_dir.q b/ql/src/test/queries/clientpositive/recursive_dir.q
new file mode 100644
index 0000000000..d703b8ee50
--- /dev/null
+++ b/ql/src/test/queries/clientpositive/recursive_dir.q
@@ -0,0 +1,19 @@
+-- INCLUDE_HADOOP_MAJOR_VERSIONS(0.23)
+
+CREATE TABLE fact_daily(x int) PARTITIONED BY (ds STRING);
+CREATE TABLE fact_tz(x int) PARTITIONED BY (ds STRING, hr STRING)
+LOCATION 'pfile:${system:test.tmp.dir}/fact_tz';
+
+INSERT OVERWRITE TABLE fact_tz PARTITION (ds='1', hr='1')
+SELECT key+11 FROM src WHERE key=484;
+
+ALTER TABLE fact_daily SET TBLPROPERTIES('EXTERNAL'='TRUE');
+ALTER TABLE fact_daily ADD PARTITION (ds='1')
+LOCATION 'pfile:${system:test.tmp.dir}/fact_tz/ds=1';
+
+set mapred.input.dir.recursive=true;
+set hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat;
+
+SELECT * FROM fact_daily WHERE ds='1';
+
+SELECT count(1) FROM fact_daily WHERE ds='1';
diff --git a/ql/src/test/results/clientpositive/recursive_dir.q.out b/ql/src/test/results/clientpositive/recursive_dir.q.out
new file mode 100644
index 0000000000..874c19e518
--- /dev/null
+++ b/ql/src/test/results/clientpositive/recursive_dir.q.out
@@ -0,0 +1,66 @@
+PREHOOK: query: -- INCLUDE_HADOOP_MAJOR_VERSIONS(0.23)
+
+CREATE TABLE fact_daily(x int) PARTITIONED BY (ds STRING)
+PREHOOK: type: CREATETABLE
+POSTHOOK: query: -- INCLUDE_HADOOP_MAJOR_VERSIONS(0.23)
+
+CREATE TABLE fact_daily(x int) PARTITIONED BY (ds STRING)
+POSTHOOK: type: CREATETABLE
+POSTHOOK: Output: default@fact_daily
+PREHOOK: query: CREATE TABLE fact_tz(x int) PARTITIONED BY (ds STRING, hr STRING)
+#### A masked pattern was here ####
+PREHOOK: type: CREATETABLE
+POSTHOOK: query: CREATE TABLE fact_tz(x int) PARTITIONED BY (ds STRING, hr STRING)
+#### A masked pattern was here ####
+POSTHOOK: type: CREATETABLE
+POSTHOOK: Output: default@fact_tz
+PREHOOK: query: INSERT OVERWRITE TABLE fact_tz PARTITION (ds='1', hr='1')
+SELECT key+11 FROM src WHERE key=484
+PREHOOK: type: QUERY
+PREHOOK: Input: default@src
+PREHOOK: Output: default@fact_tz@ds=1/hr=1
+POSTHOOK: query: INSERT OVERWRITE TABLE fact_tz PARTITION (ds='1', hr='1')
+SELECT key+11 FROM src WHERE key=484
+POSTHOOK: type: QUERY
+POSTHOOK: Input: default@src
+POSTHOOK: Output: default@fact_tz@ds=1/hr=1
+POSTHOOK: Lineage: fact_tz PARTITION(ds=1,hr=1).x EXPRESSION [(src)src.FieldSchema(name:key, type:string, comment:default), ]
+PREHOOK: query: ALTER TABLE fact_daily SET TBLPROPERTIES('EXTERNAL'='TRUE')
+PREHOOK: type: ALTERTABLE_PROPERTIES
+PREHOOK: Input: default@fact_daily
+PREHOOK: Output: default@fact_daily
+POSTHOOK: query: ALTER TABLE fact_daily SET TBLPROPERTIES('EXTERNAL'='TRUE')
+POSTHOOK: type: ALTERTABLE_PROPERTIES
+POSTHOOK: Input: default@fact_daily
+POSTHOOK: Output: default@fact_daily
+POSTHOOK: Lineage: fact_tz PARTITION(ds=1,hr=1).x EXPRESSION [(src)src.FieldSchema(name:key, type:string, comment:default), ]
+PREHOOK: query: ALTER TABLE fact_daily ADD PARTITION (ds='1')
+#### A masked pattern was here ####
+PREHOOK: type: ALTERTABLE_ADDPARTS
+PREHOOK: Input: default@fact_daily
+POSTHOOK: query: ALTER TABLE fact_daily ADD PARTITION (ds='1')
+#### A masked pattern was here ####
+POSTHOOK: type: ALTERTABLE_ADDPARTS
+POSTHOOK: Input: default@fact_daily
+POSTHOOK: Output: default@fact_daily@ds=1
+POSTHOOK: Lineage: fact_tz PARTITION(ds=1,hr=1).x EXPRESSION [(src)src.FieldSchema(name:key, type:string, comment:default), ]
+PREHOOK: query: SELECT * FROM fact_daily WHERE ds='1'
+PREHOOK: type: QUERY
+PREHOOK: Input: default@fact_daily@ds=1
+#### A masked pattern was here ####
+POSTHOOK: query: SELECT * FROM fact_daily WHERE ds='1'
+POSTHOOK: type: QUERY
+POSTHOOK: Input: default@fact_daily@ds=1
+#### A masked pattern was here ####
+POSTHOOK: Lineage: fact_tz PARTITION(ds=1,hr=1).x EXPRESSION [(src)src.FieldSchema(name:key, type:string, comment:default), ]
+495	1
+PREHOOK: query: SELECT count(1) FROM fact_daily WHERE ds='1'
+PREHOOK: type: QUERY
+PREHOOK: Input: default@fact_daily@ds=1
+#### A masked pattern was here ####
+POSTHOOK: query: SELECT count(1) FROM fact_daily WHERE ds='1'
+POSTHOOK: type: QUERY
+POSTHOOK: Input: default@fact_daily@ds=1
+#### A masked pattern was here ####
+POSTHOOK: Lineage: fact_tz PARTITION(ds=1,hr=1).x EXPRESSION [(src)src.FieldSchema(name:key, type:string, comment:default), ]
+1
